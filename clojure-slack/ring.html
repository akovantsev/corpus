<!DOCTYPE html>
<head><title>ring</title><meta charset="UTF-8" /><style type="text/css">body {
    font-family: Monaco, Menlo, Consolas, "Courier New", sans-serif;
    font-size: 12px;
    margin: 15px;
}
h2 {text-align: center}
pre,
code {
    font-family: Monaco, Menlo, Consolas, "Courier New", monospace;
    color: #333;
    line-break: anywhere;
}
a {
    line-break: anywhere;
}
code {
    /*line-height: 1.2;*/
    white-space: normal;
    color: #c25;
    background-color: #f7f7f9;
    border: 1px solid #e1e1e8;
}
pre {
    margin: .5rem 0 .2rem;
    font-size: .75rem;
    /*line-height: 1.15rem;*/
    background: #fbfaf8;
    padding: .5rem;
    word-break: normal;
    display: block;
    border: 1px solid rgba(0, 0, 0, .15);
    white-space: pre-wrap;
    word-wrap: break-word;
    border-radius: 4px;
}
/*span {*/
z {
    white-space: pre-wrap;
}

d {padding-right: 8px;}
h {padding-right: 16px;}

w, r {
    margin-right: 10px;
    padding-right: 8px;
    text-align: right;
}

d,h,w,r {
    background-color: lavender;
    margin-top: 1px;
    display: inline-table; /* prevents doubleclick selection spillover into neighbour elements */
}

h:hover,
d:hover {
    text-decoration: underline;
    color: blue;
    cursor: row-resize;
}
d {padding-right: 8px;}
h {padding-right: 16px;}

z {display: block;}

z:target > r,
z:target > w,
z:target > d,
z:target > h {
    background-color: aquamarine
}

#filters-container {
    position: fixed;
    left: 50px;
    z-index: 1;
}
#filters-container > input {
    /*column:*/
    display: block;
    outline-color: aquamarine;
}

y {
    cursor: pointer;
    text-decoration: none;
    color: blue;
    position: absolute;
    left: 3px;
}

y:hover {
    text-decoration: underline;
    color: aquamarine;
}


</style></head><body><style id="css-username">w {min-width: 168px;} r {min-width: 200px;}</style><style id="css-text-filter"></style><style id="css-date-filter"></style><style id="css-filter-override"></style><p id="filters-container"><input id="text-filter" onkeyup="debtextfilter(this.value)" placeholder="filter text" type="string" /><button hidden="hidden" id="date-filter" onclick="cleardatefilter()"></button></p><h2>#ring</h2><pre><i>generated UTC: 2023-11-22 19:45</i><i>
latest data: <a href="https://clojurians-log.clojureverse.org/ring/2023-11-13">https://clojurians-log.clojureverse.org/ring/2023-11-13</a></i><i>
messages: 2960</i>
pro tips:
* Double click on text to filter by it. (doubleclick + cmd-f for extra points).
* Click on date to keep day visible regardless of filter.
* Click on time to keep hour visible regardless of filter.</pre><script>const textFilterInput = document.getElementById("text-filter");
const dateFilterInput = document.getElementById("date-filter");
const filterTextStyle = document.getElementById("css-text-filter");
const filterDateStyle = document.getElementById("css-date-filter");
const filterStyleOverride = document.getElementById("css-filter-override");



function textFilter2(text) {
    var style = '';
    if (text.trim() !== '') {
        text.split(' ').forEach(function (t) {
            if (t !== '') {
                style = style + "z:not([t*='" + t + "' i]) {display: none; opacity: 0.6}";
            }
        });
    }
    filterTextStyle.innerHTML = style;
}
function textFilter(text) {
    filterTextStyle.innerHTML = "";
    if (text.trim() !== '') {
        var sections = document.getElementsByTagName("g");
        var sectionsArr = Array.prototype.slice.call(sections);
        sectionsArr.forEach(function (s){
            var sid = s.getAttribute("id");
            text.split(' ').forEach(function (t) {
                if (t !== '') {
                    filterTextStyle.innerHTML += "\ng#" + sid + " > z:not([t*='" + t + "' i]) {display: none; opacity: 0.6}";
                }
            });
        })
    }
}
function textFilter3(text) {
    console.time("text search");
    filterTextStyle.innerHTML = "";
    if (text.trim() !== '') {
        const re = new RegExp( text, "i");
        var sections = document.getElementsByTagName("g");
        var sectionsArr = Array.prototype.slice.call(sections);
        sectionsArr.forEach(function (w){
            var zs = w.getElementsByTagName ("z");
            var zsArr = Array.prototype.slice.call(zs);
            var ids = zsArr
                .filter(function (el) {
                    return !re.test(el.innerText);
                })
                .map(function (el){
                    return el.getAttribute("id");
                });
            if (ids) {
                filterTextStyle.innerHTML += "\n#" + ids.join(",#") + " {display: none; opacity: 0.6}";
            }
        })
    }
    console.timeEnd("text search");
}


function filterSelection (e) {
    let sel = document.getSelection();
    let txt = sel.toString();
    textFilterInput.value = (txt || "");
    textFilter(txt);
}
function debounce1(callback, delay) {
    let timeout;
    return function(arg) {
        clearTimeout(timeout);
        timeout = setTimeout(callback, delay, arg);
    }
}

function keyUp (e) {
    if (e.code === "KeyF" && e.ctrlKey) {
        let txt = document.getSelection().toString();
        if (txt.length > 0) {
            textFilterInput.value = (txt || "");
            textFilter(txt);
        }
    }
}


function showDateTimes (el, datestr, hourstr) {
    dateFilterInput.innerText = "clear: " + datestr + " " + hourstr;
    dateFilterInput.hidden = false;
    let ids = [];
    const clicked = el.parentElement;  // el = z#id/t
    ids.push(clicked.id);
    // var idbefore, idafter;
    let cursor = clicked;
    function nextCursor (cursor) {
        const id = (cursor && cursor.id);
        const d = (cursor && cursor.children[1]);
        const h = (cursor && cursor.children[2])
        if (id) {
            ids.push(id); //includes 1st next-id not matching date.
        } else {
            cursor = null;
        }
        if (d && (d.textContent === datestr) && (!hourstr || (h && h.textContent.startsWith(hourstr)))) {
        } else {
            cursor = null;
        }
        return cursor;
    }
    while (cursor) {
        cursor = nextCursor(cursor.previousElementSibling);
    }

    cursor = clicked;

    while (cursor) {
        cursor = nextCursor(cursor.nextElementSibling);
    }


    var style1 = '';
    var style2 = '';
    var content;
    if (datestr.includes(" ")) { //hour
        content = " *";
    } else {
        content = "**";
    }
    ids.forEach(function (id) {
        if (id) {
            style1 = style1 + ", #" + id;
            style2 = style2 + ", #" + id + " h:after";
        }
    })
    if (style1) {
        style1 = style1.substring(1) + " {display: block !important}";
    }
    if (style2) {
        style2 = style2.substring(1) + " {content: \"" + content + "\"; position: absolute}"
    }
    filterDateStyle.innerHTML = style1 + "\n" + style2;
}

// https://developer.mozilla.org/en-US/docs/Web/API/Element/scrollIntoView
function filterDay (el) {
    showDateTimes(el, el.textContent);
    el.scrollIntoView({behavior: "smooth", block: "center", inline: "center"});
}

function filterHours (el) {
    showDateTimes(el, el.previousElementSibling.textContent, el.textContent.substring(0, 2));
    el.scrollIntoView({behavior: "smooth", block: "center", inline: "center"});
}

function forceShowSelected (el) {
    var id = el.parentElement.id
    if (id) {
        window.location.hash = "#" + id;
        filterStyleOverride.innerHTML = ""
            + "#" + id
            + " {display: block !important;}"
            + "#" + id + " h:after"
            + " {content: \"  #\"; position: absolute}";

    } else {
        window.location.hash = "";
        filterStyleOverride.innerHTML = "";
    }
}


function cleardatefilter () {
    dateFilterInput.hidden = true;
    dateFilterInput.innerText = "";
    filterDateStyle.innerHTML = "";
}

const debtextfilter = debounce1(textFilter, 200);

function doubleClick (e) {
    if (e.target.tagName !== "INPUT"
        && e.target.tagName !== "D"
        && e.target.tagName !== "H") {

        filterSelection();
        e.target.scrollIntoView({behavior: "auto", block: "center", inline: "start"});
    }
}

function onclick(e) {
    if (e.target.tagName === "Y") {
        e.preventDefault();
        forceShowSelected(e.target);
    } else if (e.target.tagName === "D") {
        e.preventDefault();
        filterDay(e.target);
    } else if (e.target.tagName === "H") {
        e.preventDefault();
        filterHours(e.target);
    }
}

document.onclick = onclick;
document.ondblclick = doubleClick;
document.onkeyup = keyUp;
textFilterInput.focus();
</script><div><g id="s0"><z id="t1441639762" t="nberger [:attrs {:href &quot;/_/_/users/U09GQG2G2&quot;}] I don&apos;t know of any pre-packaged solution for ring, but you should be able to do it by wrapping the body with a java.util.zip.GZIPOutputStream (or java.util.zip.InflaterInputStream ) (when (#{&quot;gzip&quot; &quot;deflate&quot;} (:content-encoding request))) or something like that"><y>#</y><d>2015-09-07</d><h>15:29</h><w>nberger</w><a>@bernhard</a> I don&apos;t know of any pre-packaged solution for ring, but you should be able to do it by wrapping the body with a <code>java.util.zip.GZIPOutputStream</code> (or <code>java.util.zip.InflaterInputStream</code>) <code>(when (#{&quot;gzip&quot; &quot;deflate&quot;} (:content-encoding request)))</code> or something like that</z><z id="t1441639879" t="nberger See a gist for doing this in rack, which is a ruby library that&apos;s similar to ring in philosophy (in fact, ring took inspiration from rack): https://gist.github.com/relistan/2109707"><y>#</y><d>2015-09-07</d><h>15:31</h><w>nberger</w>See a gist for doing this in rack, which is a ruby library that&apos;s similar to ring in philosophy (in fact, ring took inspiration from rack): <a href="https://gist.github.com/relistan/2109707" target="_blank">https://gist.github.com/relistan/2109707</a></z><z id="t1441640283" t="nberger Shameless plug: if you&apos;d like to log the exact headers (and even the body during development) and other stuff from the request &amp; response you might want to take a look to https://github.com/nberger/ring-logger simple_smile"><y>#</y><d>2015-09-07</d><h>15:38</h><w>nberger</w>Shameless plug: if you&apos;d like to log the exact headers (and even the body during development) and other stuff from the request &amp; response you might want to take a look to <a href="https://github.com/nberger/ring-logger" target="_blank">https://github.com/nberger/ring-logger</a> <b>simple_smile</b></z><z id="t1441744636" t="bernhard Haha thanks a lot [:attrs {:href &quot;/_/_/users/U067S6YLW&quot;}] - will try that out tomorrow. Didn&apos;t appear to me it could be that simple...:)"><y>#</y><d>2015-09-08</d><h>20:37</h><w>bernhard</w>Haha thanks a lot <a>@nberger</a> - will try that out tomorrow. Didn&apos;t appear to me it could be that simple...:)</z><z id="t1441745025" t="nberger Cool [:attrs {:href &quot;/_/_/users/U09GQG2G2&quot;}] , good luck simple_smile"><y>#</y><d>2015-09-08</d><h>20:43</h><w>nberger</w>Cool <a>@bernhard</a>, good luck <b>simple_smile</b></z><z id="t1441889271" t="bernhard [:attrs {:href &quot;/_/_/users/U067S6YLW&quot;}] : works like a charm simple_smile"><y>#</y><d>2015-09-10</d><h>12:47</h><w>bernhard</w><a>@nberger</a>: works like a charm <b>simple_smile</b></z><z id="t1441892136" t="nberger Cool :)"><y>#</y><d>2015-09-10</d><h>13:35</h><w>nberger</w>Cool :)</z><z id="t1444185477" t="flyboarder is there a ring adapter for node which is known to work well?"><y>#</y><d>2015-10-07</d><h>02:37</h><w>flyboarder</w>is there a ring adapter for node which is known to work well?</z><z id="t1448913463" t="erik_price Does ring.middleware.session.cookie/cookie-store set a default expiration on the session cookie it creates?"><y>#</y><d>2015-11-30</d><h>19:57</h><w>erik_price</w>Does <code>ring.middleware.session.cookie/cookie-store</code> set a default expiration on the session cookie it creates?</z><z id="t1454410844" t="bbss I am trying to connect to my localhost:3000 where I have a server running, but I get a rather unhelpful error. I can visit it from the outside without a problem though (visit via ngrok tunnel)."><y>#</y><d>2016-02-02</d><h>11:00</h><w>bbss</w>I am trying to connect to my localhost:3000 where I have a server running, but I get a rather unhelpful error. I can visit it from the outside without a problem though (visit via ngrok tunnel).</z><z id="t1454410924" t="bbss any idea what I am doing wrong?"><y>#</y><d>2016-02-02</d><h>11:02</h><w>bbss</w>any idea what I am doing wrong?</z><z id="t1454410943" t="bbss Googling gives me the impression there is a bug in my http client (which is Chrome)"><y>#</y><d>2016-02-02</d><h>11:02</h><w>bbss</w>Googling gives me the impression there is a bug in my http client (which is Chrome)</z><z id="t1455736147" t="flyboarder I just posted this in #C03S1KBA2 but im having issues getting my ring app to serve png‚Äôs, getting a 404 not found??"><y>#</y><d>2016-02-17</d><h>19:09</h><w>flyboarder</w>I just posted this in #C03S1KBA2 but im having issues getting my ring app to serve png‚Äôs, getting a 404 not found??</z><z id="t1455737581" t="flyboarder Solved, folder not on classpath"><y>#</y><d>2016-02-17</d><h>19:33</h><w>flyboarder</w>Solved, folder not on classpath</z><z id="t1455819285" t="actsasgeek I have a ring/compojure app and I‚Äôm using ring/ring-defaults for all my middleware needs‚Ä¶except it doesn‚Äôt quite take care of all my needs. Can anyone suggest a good logging middleware? I‚Äôm sort of used it just ‚Äúbeing there‚Äù in Rails although ideally logging routes and parameter directly to the DB would be better."><y>#</y><d>2016-02-18</d><h>18:14</h><w>actsasgeek</w>I have a ring/compojure app and I‚Äôm using ring/ring-defaults for all my middleware needs‚Ä¶except it doesn‚Äôt quite take care of all my needs. Can anyone suggest a good logging middleware? I‚Äôm sort of used it just ‚Äúbeing there‚Äù in Rails although ideally logging routes and parameter directly to the DB would be better.</z><z id="t1455820018" t="nberger [:attrs {:href &quot;/_/_/users/U0J6QRSMD&quot;}] : see my comment in https://clojurians.slack.com/archives/clojure/p1455797933000509 , I think ring-logger might be of help to you"><y>#</y><d>2016-02-18</d><h>18:26</h><w>nberger</w><a>@actsasgeek</a>: see my comment in <a href="https://clojurians.slack.com/archives/clojure/p1455797933000509" target="_blank">https://clojurians.slack.com/archives/clojure/p1455797933000509</a>, I think ring-logger might be of help to you</z><z id="t1455820072" t="actsasgeek oh, nice! thanks"><y>#</y><d>2016-02-18</d><h>18:27</h><w>actsasgeek</w>oh, nice! thanks</z><z id="t1459803391" t="timgilbert Say, is there any reason I couldn&apos;t use (comp) to compose my middleware instead of the threading macro?"><y>#</y><d>2016-04-04</d><h>20:56</h><w>timgilbert</w>Say, is there any reason I couldn&apos;t use <code>(comp)</code> to compose my middleware instead of the threading macro?</z><z id="t1460240919" t="weavejester timgilbert: You can, but it‚Äôs not as convenient"><y>#</y><d>2016-04-09</d><h>22:28</h><w>weavejester</w>timgilbert: You can, but it‚Äôs not as convenient</z><z id="t1460240958" t="weavejester (-&gt; h (f x) (g x)) compared to ((comp #(f % x) #(g % x)) h)"><y>#</y><d>2016-04-09</d><h>22:29</h><w>weavejester</w><code>(-&gt; h (f x) (g x))</code> compared to <code>((comp #(f % x) #(g % x)) h)</code></z><z id="t1460312176" t="sd is there anything i need to add to my ajax request for anti-forgery to work? I&apos;m getting invalid token errors every time üòû"><y>#</y><d>2016-04-10</d><h>18:16</h><w>sd</w>is there anything i need to add to my ajax request for <code>anti-forgery</code> to work? I&apos;m getting invalid token errors every time <b>üòû</b></z><z id="t1460315950" t="weavejester sd: Either an __anti-forgery-token parameter, or a x-csrf-token header or a x-xsrf-token header."><y>#</y><d>2016-04-10</d><h>19:19</h><w>weavejester</w>sd: Either an <code>__anti-forgery-token</code> parameter, or a <code>x-csrf-token</code> header or a <code>x-xsrf-token</code> header.</z><z id="t1460315986" t="weavejester The README explains it."><y>#</y><d>2016-04-10</d><h>19:19</h><w>weavejester</w>The README explains it.</z><z id="t1460316048" t="sd is it not possible to use the value in the session cookie?"><y>#</y><d>2016-04-10</d><h>19:20</h><w>sd</w>is it not possible to use the value in the session cookie?</z><z id="t1460316074" t="weavejester The token is compared to the token in the session."><y>#</y><d>2016-04-10</d><h>19:21</h><w>weavejester</w>The token is compared to the token in the session.</z><z id="t1460316095" t="weavejester The problem with POSTs is that they don‚Äôt adhere to the same-origin policy"><y>#</y><d>2016-04-10</d><h>19:21</h><w>weavejester</w>The problem with POSTs is that they don‚Äôt adhere to the same-origin policy</z><z id="t1460316100" t="weavejester Because they predate it."><y>#</y><d>2016-04-10</d><h>19:21</h><w>weavejester</w>Because they predate it.</z><z id="t1460316108" t="weavejester So someone can create a form on their own website"><y>#</y><d>2016-04-10</d><h>19:21</h><w>weavejester</w>So someone can create a form on their own website</z><z id="t1460316116" t="weavejester Use Javascript to automatically POST it"><y>#</y><d>2016-04-10</d><h>19:21</h><w>weavejester</w>Use Javascript to automatically POST it</z><z id="t1460316134" t="weavejester And the form will be POSTed to your website with your website&apos;s session"><y>#</y><d>2016-04-10</d><h>19:22</h><w>weavejester</w>And the form will be POSTed to your website with your website&apos;s session</z><z id="t1460316157" t="weavejester The way to stop it is to also pass along a secret token that is compared to the session."><y>#</y><d>2016-04-10</d><h>19:22</h><w>weavejester</w>The way to stop it is to also pass along a secret token that is compared to the session.</z><z id="t1460316174" t="weavejester So the user needs to be logged in, and POSTing from a page under your control."><y>#</y><d>2016-04-10</d><h>19:22</h><w>weavejester</w>So the user needs to be logged in, and POSTing from a page under your control.</z><z id="t1460316366" t="weavejester ring-anti-forgery stores this token in *anti-forgery-token*"><y>#</y><d>2016-04-10</d><h>19:26</h><w>weavejester</w>ring-anti-forgery stores this token in <code>*anti-forgery-token*</code></z><z id="t1460316443" t="sd I saw that token, and it matched the :ring.middleware.anti-forgery/anti-forgery-token in :session"><y>#</y><d>2016-04-10</d><h>19:27</h><w>sd</w>I saw that token, and it matched the <code>:ring.middleware.anti-forgery/anti-forgery-token</code> in <code>:session</code></z><z id="t1460316463" t="sd since the ajax requests are being submitted with the cookie, i figured the token could be extracted that way"><y>#</y><d>2016-04-10</d><h>19:27</h><w>sd</w>since the ajax requests are being submitted with the cookie, i figured the token could be extracted that way</z><z id="t1460316478" t="weavejester No, because the cookie isn‚Äôt safe."><y>#</y><d>2016-04-10</d><h>19:27</h><w>weavejester</w>No, because the cookie isn‚Äôt safe.</z><z id="t1460316480" t="sd but thanks for explaining, i&apos;ll try adding it as a parameter"><y>#</y><d>2016-04-10</d><h>19:28</h><w>sd</w>but thanks for explaining, i&apos;ll try adding it as a parameter</z><z id="t1460316495" t="weavejester The anti-forgery-token needs to be in the session and passed through a parameter."><y>#</y><d>2016-04-10</d><h>19:28</h><w>weavejester</w>The anti-forgery-token needs to be in the session and passed through a parameter.</z><z id="t1460316499" t="sd ok"><y>#</y><d>2016-04-10</d><h>19:28</h><w>sd</w>ok</z><z id="t1460316535" t="sd and it&apos;s alright to just send the token to the client at some point, to include in your ajax requests?"><y>#</y><d>2016-04-10</d><h>19:28</h><w>sd</w>and it&apos;s alright to just send the token to the client at some point, to include in your ajax requests?</z><z id="t1460316571" t="weavejester Yeah. The point of the token is to make sure that the request comes from a page under your control."><y>#</y><d>2016-04-10</d><h>19:29</h><w>weavejester</w>Yeah. The point of the token is to make sure that the request comes from a page under your control.</z><z id="t1460316579" t="sd cool"><y>#</y><d>2016-04-10</d><h>19:29</h><w>sd</w>cool</z><z id="t1460316605" t="weavejester https://en.wikipedia.org/wiki/Cross-site_request_forgery"><y>#</y><d>2016-04-10</d><h>19:30</h><w>weavejester</w><a href="https://en.wikipedia.org/wiki/Cross-site_request_forgery" target="_blank">https://en.wikipedia.org/wiki/Cross-site_request_forgery</a></z><z id="t1460423864" t="fenton Is there a ring handler that can deal with deep linking? Meaning, basically, if a file is requested that doesn&apos;t exist, return a default file."><y>#</y><d>2016-04-12</d><h>01:17</h><w>fenton</w>Is there a ring handler that can deal with deep linking?  Meaning, basically, if a file is requested that doesn&apos;t exist, return a default file.</z><z id="t1460426045" t="fenton found it... just check if file exists, if not just return the index.html file."><y>#</y><d>2016-04-12</d><h>01:54</h><w>fenton</w>found it...  just check if file exists, if not just return the index.html file.</z><z id="t1460499442" t="zane With Ring how common is it to attach application-specific things to the request / response maps?"><y>#</y><d>2016-04-12</d><h>22:17</h><w>zane</w>With Ring how common is it to attach application-specific things to the request / response maps?</z><z id="t1460499473" t="zane For instance, is it normal to attach a Datomic database connection to the request map in middleware so your handler can pull it off later?"><y>#</y><d>2016-04-12</d><h>22:17</h><w>zane</w>For instance, is it normal to attach a Datomic database connection to the request map in middleware so your handler can pull it off later?</z><z id="t1460502215" t="nberger I think so, I use to do that"><y>#</y><d>2016-04-12</d><h>23:03</h><w>nberger</w>I think so, I use to do that</z><z id="t1460504518" t="weavejester zane: I‚Äôd instead use a closure. So more like: (fn [conn] (fn [request] response))"><y>#</y><d>2016-04-12</d><h>23:41</h><w>weavejester</w>zane: I‚Äôd instead use a closure. So more like: <code>(fn [conn] (fn [request] response))</code></z><z id="t1460504935" t="zane [:attrs {:href &quot;/_/_/users/U0BKWMG5B&quot;}] : Yeah, I&apos;m using partial at the moment for the database connection. üëç"><y>#</y><d>2016-04-12</d><h>23:48</h><w>zane</w><a>@weavejester</a>: Yeah, I&apos;m using <code>partial</code> at the moment for the database connection. <b>üëç</b></z><z id="t1460563910" t="zane [:attrs {:href &quot;/_/_/users/U0BKWMG5B&quot;}] : I&apos;m curious. Do you prefer to use a closure for that because the lifetime of the connection spans multiple requests? I&apos;m trying to understand when to use that method vs attaching values to the request itself."><y>#</y><d>2016-04-13</d><h>16:11</h><w>zane</w><a>@weavejester</a>: I&apos;m curious. Do you prefer to use a closure for that because the lifetime of the connection spans multiple requests? I&apos;m trying to understand when to use that method vs attaching values to the request itself.</z><z id="t1460563953" t="weavejester [:attrs {:href &quot;/_/_/users/U050CT4HR&quot;}] it has a few advantages"><y>#</y><d>2016-04-13</d><h>16:12</h><w>weavejester</w><a>@zane</a> it has a few advantages</z><z id="t1460563976" t="weavejester The first is that it means you‚Äôre only destructuring or setting things up once."><y>#</y><d>2016-04-13</d><h>16:12</h><w>weavejester</w>The first is that it means you‚Äôre only destructuring or setting things up once.</z><z id="t1460564012" t="weavejester So (fn [config] (let [x (expensive-operation config)] (fn [request] ‚Ä¶)))"><y>#</y><d>2016-04-13</d><h>16:13</h><w>weavejester</w>So <code>(fn [config] (let [x (expensive-operation config)] (fn [request] ‚Ä¶)))</code></z><z id="t1460564052" t="weavejester The second advantage is that it‚Äôs less complex. You‚Äôre not tying the configuration to your request map."><y>#</y><d>2016-04-13</d><h>16:14</h><w>weavejester</w>The second advantage is that it‚Äôs less complex. You‚Äôre not tying the configuration to your request map.</z><z id="t1460564099" t="weavejester Ideally you should only be passing around the information you need."><y>#</y><d>2016-04-13</d><h>16:14</h><w>weavejester</w>Ideally you should only be passing around the information you need.</z><z id="t1460564124" t="zane Okay."><y>#</y><d>2016-04-13</d><h>16:15</h><w>zane</w>Okay.</z><z id="t1460564132" t="zane I think that makes sense."><y>#</y><d>2016-04-13</d><h>16:15</h><w>zane</w>I think that makes sense.</z><z id="t1460564141" t="weavejester Finally, closures fit in well with architecture like Stuart‚Äôs component library"><y>#</y><d>2016-04-13</d><h>16:15</h><w>weavejester</w>Finally, closures fit in well with architecture like Stuart‚Äôs component library</z><z id="t1460564172" t="zane How so? (We&apos;re using component already.)"><y>#</y><d>2016-04-13</d><h>16:16</h><w>zane</w>How so? (We&apos;re using component already.)</z><z id="t1460564180" t="zane I mean, the handler is going to have to get a database value at some point. And if I&apos;m understanding Ring correctly the way to do that is through the request map."><y>#</y><d>2016-04-13</d><h>16:16</h><w>zane</w>I mean, the handler is going to have to get a database value at some point. And if I&apos;m understanding Ring correctly the way to do that is through the request map.</z><z id="t1460564292" t="weavejester The request map is just for requests. I don‚Äôt think you need to tie your database to your request map."><y>#</y><d>2016-04-13</d><h>16:18</h><w>weavejester</w>The request map is just for requests. I don‚Äôt think you need to tie your database to your request map.</z><z id="t1460564323" t="weavejester There‚Äôs no inherent connection between the information in HTTP request, and a database connection"><y>#</y><d>2016-04-13</d><h>16:18</h><w>weavejester</w>There‚Äôs no inherent connection between the information in HTTP request, and a database connection</z><z id="t1460564333" t="zane Right."><y>#</y><d>2016-04-13</d><h>16:18</h><w>zane</w>Right.</z><z id="t1460564340" t="zane But the handler needs both in order to do its work."><y>#</y><d>2016-04-13</d><h>16:19</h><w>zane</w>But the handler needs both in order to do its work.</z><z id="t1460564351" t="zane And my understanding is that Ring handlers are single-argument functions?"><y>#</y><d>2016-04-13</d><h>16:19</h><w>zane</w>And my understanding is that Ring handlers are single-argument functions?</z><z id="t1460564355" t="weavejester The request map is really designed for data from the HTTP request, or data derived from the HTTP request, like sessions, cookies, etc."><y>#</y><d>2016-04-13</d><h>16:19</h><w>weavejester</w>The request map is really designed for data from the HTTP request, or data derived from the HTTP request, like sessions, cookies, etc.</z><z id="t1460564364" t="zane I feel like I&apos;m missing something here. Maybe I should take a closer look at the doc."><y>#</y><d>2016-04-13</d><h>16:19</h><w>zane</w>I feel like I&apos;m missing something here. Maybe I should take a closer look at the doc.</z><z id="t1460564365" t="weavejester Ring handlers are single-argument functions."><y>#</y><d>2016-04-13</d><h>16:19</h><w>weavejester</w>Ring handlers are single-argument functions.</z><z id="t1460564371" t="weavejester But you can use a closure"><y>#</y><d>2016-04-13</d><h>16:19</h><w>weavejester</w>But you can use a closure</z><z id="t1460564384" t="weavejester (fn [config] (fn [request] response))"><y>#</y><d>2016-04-13</d><h>16:19</h><w>weavejester</w><code>(fn [config] (fn [request] response))</code></z><z id="t1460564385" t="zane Okay, so generate different handlers for each request with a database value in scope."><y>#</y><d>2016-04-13</d><h>16:19</h><w>zane</w>Okay, so generate different handlers for each request with a database value in scope.</z><z id="t1460564400" t="zane That&apos;s more idiomatic?"><y>#</y><d>2016-04-13</d><h>16:20</h><w>zane</w>That&apos;s more idiomatic?</z><z id="t1460564403" t="weavejester In other words you write a function that takes some configuration, and returns a handler."><y>#</y><d>2016-04-13</d><h>16:20</h><w>weavejester</w>In other words you write a function that takes some configuration, and returns a handler.</z><z id="t1460564412" t="zane Right, right."><y>#</y><d>2016-04-13</d><h>16:20</h><w>zane</w>Right, right.</z><z id="t1460564437" t="weavejester I think so. It means that the configuration (e.g. database connections, etc.) is separate from your request map."><y>#</y><d>2016-04-13</d><h>16:20</h><w>weavejester</w>I think so. It means that the configuration (e.g. database connections, etc.) is separate from your request map.</z><z id="t1460564448" t="weavejester It‚Äôs how I do it in Duct."><y>#</y><d>2016-04-13</d><h>16:20</h><w>weavejester</w>It‚Äôs how I do it in Duct.</z><z id="t1460564459" t="weavejester https://github.com/weavejester/duct"><y>#</y><d>2016-04-13</d><h>16:20</h><w>weavejester</w><a href="https://github.com/weavejester/duct" target="_blank">https://github.com/weavejester/duct</a></z><z id="t1460564478" t="zane Oh, I forgot about Duct!"><y>#</y><d>2016-04-13</d><h>16:21</h><w>zane</w>Oh, I forgot about Duct!</z><z id="t1460564488" t="zane Thank you for reminding me. I&apos;ll take a look at how it&apos;s done there."><y>#</y><d>2016-04-13</d><h>16:21</h><w>zane</w>Thank you for reminding me. I&apos;ll take a look at how it&apos;s done there.</z><z id="t1460564535" t="weavejester I also did a presentation that covers this topic: https://skillsmatter.com/skillscasts/7229-duct-covered"><y>#</y><d>2016-04-13</d><h>16:22</h><w>weavejester</w>I also did a presentation that covers this topic: <a href="https://skillsmatter.com/skillscasts/7229-duct-covered" target="_blank">https://skillsmatter.com/skillscasts/7229-duct-covered</a></z><z id="t1460564547" t="zane Awesome!"><y>#</y><d>2016-04-13</d><h>16:22</h><w>zane</w>Awesome!</z><z id="t1460564549" t="weavejester I think you need to sign up to see the video, but it‚Äôs free."><y>#</y><d>2016-04-13</d><h>16:22</h><w>weavejester</w>I think you need to sign up to see the video, but it‚Äôs free.</z><z id="t1460564554" t="zane Just what I was looking for."><y>#</y><d>2016-04-13</d><h>16:22</h><w>zane</w>Just what I was looking for.</z><z id="t1460564571" t="zane I&apos;m a bit wary of using components for so many things."><y>#</y><d>2016-04-13</d><h>16:22</h><w>zane</w>I&apos;m a bit wary of using components for so many things.</z><z id="t1460565259" t="weavejester I don‚Äôt think components should be overused‚Ä¶ in fact I‚Äôm more conservative than Stuart on that point."><y>#</y><d>2016-04-13</d><h>16:34</h><w>weavejester</w>I don‚Äôt think components should be overused‚Ä¶ in fact I‚Äôm more conservative than Stuart on that point.</z><z id="t1460565570" t="zane Right. Dependency injection is kind of insidious in that it kind of wants to take over your whole program."><y>#</y><d>2016-04-13</d><h>16:39</h><w>zane</w>Right. Dependency injection is kind of insidious in that it kind of wants to take over your whole program.</z><z id="t1460566013" t="weavejester My rule of thumb is that components are for things that have a start and a stop."><y>#</y><d>2016-04-13</d><h>16:46</h><w>weavejester</w>My rule of thumb is that components are for things that have a start and a stop.</z><z id="t1460566029" t="weavejester So anything that needs to be initialised or cleaned up"><y>#</y><d>2016-04-13</d><h>16:47</h><w>weavejester</w>So anything that needs to be initialised or cleaned up</z><z id="t1460566042" t="weavejester Sometimes cleanup can be left to the GC"><y>#</y><d>2016-04-13</d><h>16:47</h><w>weavejester</w>Sometimes cleanup can be left to the GC</z><z id="t1460566055" t="weavejester Anything else shouldn‚Äôt be a component IMO."><y>#</y><d>2016-04-13</d><h>16:47</h><w>weavejester</w>Anything else shouldn‚Äôt be a component IMO.</z><z id="t1460566741" t="zane That&apos;s what I thought too, but I see you&apos;re using a component for the Ring handler in Duct, so I was confused."><y>#</y><d>2016-04-13</d><h>16:59</h><w>zane</w>That&apos;s what I thought too, but I see you&apos;re using a component for the Ring handler in Duct, so I was confused.</z><z id="t1460566777" t="weavejester That‚Äôs because they have a setup part to them."><y>#</y><d>2016-04-13</d><h>16:59</h><w>weavejester</w>That‚Äôs because they have a setup part to them.</z><z id="t1460566796" t="weavejester Endpoints are essentially constructors for handlers."><y>#</y><d>2016-04-13</d><h>16:59</h><w>weavejester</w>Endpoints are essentially constructors for handlers.</z><z id="t1460566803" t="zane Ah, I see."><y>#</y><d>2016-04-13</d><h>17:00</h><w>zane</w>Ah, I see.</z><z id="t1460566821" t="weavejester They also have a cleanup - deleting the handler - but this is handled by the GC"><y>#</y><d>2016-04-13</d><h>17:00</h><w>weavejester</w>They also have a cleanup - deleting the handler - but this is handled by the GC</z><z id="t1460566836" t="zane My initial thought was that things that only had setup (and no teardown) would be simpler to represent just using functions, closures, records, etc."><y>#</y><d>2016-04-13</d><h>17:00</h><w>zane</w>My initial thought was that things that only had setup (and no teardown) would be simpler to represent just using functions, closures, records, etc.</z><z id="t1460566885" t="weavejester Well, endpoints are functions, but they‚Äôre promoted into components in order to integrate with the system."><y>#</y><d>2016-04-13</d><h>17:01</h><w>weavejester</w>Well, endpoints are functions, but they‚Äôre promoted into components in order to integrate with the system.</z><z id="t1460566936" t="weavejester I think you want to minimise how many components you have, but if you have something with a setup, even if the cleanup is just to let the GC handle it, then often it makes sense to either wrap it in a component, or hang it off a component somehow."><y>#</y><d>2016-04-13</d><h>17:02</h><w>weavejester</w>I think you want to minimise how many components you have, but if you have something with a setup, even if the cleanup is just to let the GC handle it, then often it makes sense to either wrap it in a component, or hang it off a component somehow.</z><z id="t1460566966" t="zane Yeah, the &quot;in order to integrate with the system&quot; part is what I meant when I said that dependency injection wants to eat the world."><y>#</y><d>2016-04-13</d><h>17:02</h><w>zane</w>Yeah, the &quot;in order to integrate with the system&quot; part is what I meant when I said that dependency injection wants to eat the world.</z><z id="t1460567009" t="weavejester Often you can draw a hard line between the system and everything else."><y>#</y><d>2016-04-13</d><h>17:03</h><w>weavejester</w>Often you can draw a hard line between the system and everything else.</z><z id="t1460567025" t="zane It&apos;s like the IO monad in Haskell. Once one part of your program becomes componentized there&apos;s a strong pull to componentize everything else so it all plays well together."><y>#</y><d>2016-04-13</d><h>17:03</h><w>zane</w>It&apos;s like the IO monad in Haskell. Once one part of your program becomes componentized there&apos;s a strong pull to componentize everything else so it all plays well together.</z><z id="t1460567026" t="weavejester For instance, an endpoint component goes down into an endpoint function."><y>#</y><d>2016-04-13</d><h>17:03</h><w>weavejester</w>For instance, an endpoint component goes down into an endpoint function.</z><z id="t1460567066" t="weavejester I think it is a little like the IO monad, but the same principle applies; you should aim to minimise things the IO monad touches."><y>#</y><d>2016-04-13</d><h>17:04</h><w>weavejester</w>I think it is a little like the IO monad, but the same principle applies; you should aim to minimise things the IO monad touches.</z><z id="t1460567110" t="zane I agree!"><y>#</y><d>2016-04-13</d><h>17:05</h><w>zane</w>I agree!</z><z id="t1460567125" t="weavejester I tend to find there‚Äôs not much initial setup I need to do, outside of IO, threads and things that seem a natural fit for components."><y>#</y><d>2016-04-13</d><h>17:05</h><w>weavejester</w>I tend to find there‚Äôs not much initial setup I need to do, outside of IO, threads and things that seem a natural fit for components.</z><z id="t1460567138" t="zane So, yeah. It&apos;s interesting to me that you drew the line after the handler / middleware stuff. I was going to draw it before."><y>#</y><d>2016-04-13</d><h>17:05</h><w>zane</w>So, yeah. It&apos;s interesting to me that you drew the line after the handler / middleware stuff. I was going to draw it before.</z><z id="t1460567156" t="weavejester I‚Äôd draw the line at the endpoints."><y>#</y><d>2016-04-13</d><h>17:05</h><w>weavejester</w>I‚Äôd draw the line at the endpoints.</z><z id="t1460567169" t="weavejester So the endpoints represent moving from the system into a more functional realm."><y>#</y><d>2016-04-13</d><h>17:06</h><w>weavejester</w>So the endpoints represent moving from the system into a more functional realm.</z><z id="t1460567175" t="zane I see, I see."><y>#</y><d>2016-04-13</d><h>17:06</h><w>zane</w>I see, I see.</z><z id="t1460567185" t="weavejester I also make use of what I‚Äôve taken to calling ‚Äúboundary protocols&quot;"><y>#</y><d>2016-04-13</d><h>17:06</h><w>weavejester</w>I also make use of what I‚Äôve taken to calling ‚Äúboundary protocols&quot;</z><z id="t1460567197" t="weavejester So if I want to interact with a component, I‚Äôll do so through a protocol"><y>#</y><d>2016-04-13</d><h>17:06</h><w>weavejester</w>So if I want to interact with a component, I‚Äôll do so through a protocol</z><z id="t1460567220" t="weavejester That gives me a clean border between the messy outside world of components and IO"><y>#</y><d>2016-04-13</d><h>17:07</h><w>weavejester</w>That gives me a clean border between the messy outside world of components and IO</z><z id="t1460567228" t="weavejester And my cleaner functional world inside."><y>#</y><d>2016-04-13</d><h>17:07</h><w>weavejester</w>And my cleaner functional world inside.</z><z id="t1460567244" t="weavejester It‚Äôs still better to have pure functions"><y>#</y><d>2016-04-13</d><h>17:07</h><w>weavejester</w>It‚Äôs still better to have pure functions</z><z id="t1460567260" t="weavejester But accessing a component through a protocol is better than accessing it directly"><y>#</y><d>2016-04-13</d><h>17:07</h><w>weavejester</w>But accessing a component through a protocol is better than accessing it directly</z><z id="t1460567268" t="weavejester Not least because that makes it much easier to test."><y>#</y><d>2016-04-13</d><h>17:07</h><w>weavejester</w>Not least because that makes it much easier to test.</z><z id="t1460567311" t="zane I like that pattern."><y>#</y><d>2016-04-13</d><h>17:08</h><w>zane</w>I like that pattern.</z><z id="t1460567386" t="zane When you say &quot;through a protocol&quot; I&apos;m assuming you don&apos;t mean through the component protocol itself. You mean through a more abstract protocol that hides the underlying componentness of the implementation?"><y>#</y><d>2016-04-13</d><h>17:09</h><w>zane</w>When you say &quot;through a protocol&quot; I&apos;m assuming you don&apos;t mean through the component protocol itself. You mean through a more abstract protocol that hides the underlying componentness of the implementation?</z><z id="t1460567395" t="weavejester Right"><y>#</y><d>2016-04-13</d><h>17:09</h><w>weavejester</w>Right</z><z id="t1460567410" t="weavejester So if I have a database component"><y>#</y><d>2016-04-13</d><h>17:10</h><w>weavejester</w>So if I have a database component</z><z id="t1460567425" t="weavejester Then I would wrap it in a protocol that abstracts the access"><y>#</y><d>2016-04-13</d><h>17:10</h><w>weavejester</w>Then I would wrap it in a protocol that abstracts the access</z><z id="t1460567450" t="weavejester Allowing me to substitute a mock using something like Shrubbery https://github.com/bguthrie/shrubbery"><y>#</y><d>2016-04-13</d><h>17:10</h><w>weavejester</w>Allowing me to substitute a mock using something like Shrubbery <a href="https://github.com/bguthrie/shrubbery" target="_blank">https://github.com/bguthrie/shrubbery</a></z><z id="t1460567468" t="weavejester The other advantage of it is that it forces me to define a clear boundary."><y>#</y><d>2016-04-13</d><h>17:11</h><w>weavejester</w>The other advantage of it is that it forces me to define a clear boundary.</z><z id="t1460567486" t="weavejester So I know that the database component will only be accessed in these ways."><y>#</y><d>2016-04-13</d><h>17:11</h><w>weavejester</w>So I know that the database component will only be accessed in these ways.</z><z id="t1460567514" t="weavejester It‚Äôs not as good as a pure function, but it‚Äôs better than nothing."><y>#</y><d>2016-04-13</d><h>17:11</h><w>weavejester</w>It‚Äôs not as good as a pure function, but it‚Äôs better than nothing.</z><z id="t1460567580" t="weavejester I tend to view complexity as something that needs to first be destroyed, and if it can‚Äôt be destroyed, it should be contained. So immutable data structures and pure functions first, and then some form of encapsulation if you absolutely have to access some form of I/O or side-effects."><y>#</y><d>2016-04-13</d><h>17:13</h><w>weavejester</w>I tend to view complexity as something that needs to first be destroyed, and if it can‚Äôt be destroyed, it should be contained. So immutable data structures and pure functions first, and then some form of encapsulation if you absolutely have to access some form of I/O or side-effects.</z><z id="t1460567671" t="zane Yeah, I mean. I like to think that one of the nice things about the functional approach in general and Clojure in particular is that you don&apos;t generally need things like stubs and mocks."><y>#</y><d>2016-04-13</d><h>17:14</h><w>zane</w>Yeah, I mean. I like to think that one of the nice things about the functional approach in general and Clojure in particular is that you don&apos;t generally need things like stubs and mocks.</z><z id="t1460567763" t="weavejester Right. Though I think mocks and stubs still have their place, they‚Äôre just much less common."><y>#</y><d>2016-04-13</d><h>17:16</h><w>weavejester</w>Right. Though I think mocks and stubs still have their place, they‚Äôre just much less common.</z><z id="t1460567813" t="weavejester One of the problems with OOP is that it overuses niche tools, like inheritance and encapsulation. They have their place, but most of the time they‚Äôre not the right tool."><y>#</y><d>2016-04-13</d><h>17:16</h><w>weavejester</w>One of the problems with OOP is that it overuses niche tools, like inheritance and encapsulation. They have their place, but most of the time they‚Äôre not the right tool.</z><z id="t1460567855" t="zane Well said."><y>#</y><d>2016-04-13</d><h>17:17</h><w>zane</w>Well said.</z><z id="t1460567879" t="zane I&apos;m curious where you feel like inheritance is best used in Clojure programs!"><y>#</y><d>2016-04-13</d><h>17:17</h><w>zane</w>I&apos;m curious where you feel like inheritance is best used in Clojure programs!</z><z id="t1460567940" t="weavejester I‚Äôve had opportunity to use it once simple_smile"><y>#</y><d>2016-04-13</d><h>17:19</h><w>weavejester</w>I‚Äôve had opportunity to use it once <b>simple_smile</b></z><z id="t1460567974" t="weavejester I‚Äôm currently using it in a game where entities have common behaviour"><y>#</y><d>2016-04-13</d><h>17:19</h><w>weavejester</w>I‚Äôm currently using it in a game where entities have common behaviour</z><z id="t1460568005" t="weavejester I‚Äôm using my Intentions library https://github.com/weavejester/intentions"><y>#</y><d>2016-04-13</d><h>17:20</h><w>weavejester</w>I‚Äôm using my Intentions library <a href="https://github.com/weavejester/intentions" target="_blank">https://github.com/weavejester/intentions</a></z><z id="t1460568028" t="weavejester But it‚Äôs pretty niche. Maybe inheritance has a purpose in validations? Not sure."><y>#</y><d>2016-04-13</d><h>17:20</h><w>weavejester</w>But it‚Äôs pretty niche. Maybe inheritance has a purpose in validations? Not sure.</z><z id="t1460568067" t="zane Hmm. That felt better than pulling the shared behavior out into a function and just passing it to the other functions that needed it?"><y>#</y><d>2016-04-13</d><h>17:21</h><w>zane</w>Hmm. That felt better than pulling the shared behavior out into a function and just passing it to the other functions that needed it?</z><z id="t1460568121" t="weavejester Right, that‚Äôs the way I‚Äôd normally do it‚Ä¶ but the way I have it set up happens to favour inheritance."><y>#</y><d>2016-04-13</d><h>17:22</h><w>weavejester</w>Right, that‚Äôs the way I‚Äôd normally do it‚Ä¶ but the way I have it set up happens to favour inheritance.</z><z id="t1460568131" t="zane How so?"><y>#</y><d>2016-04-13</d><h>17:22</h><w>zane</w>How so?</z><z id="t1460568153" t="weavejester To give some more background, I have a Datomic-like database, Ittyon, that works based around behaviour of aspects keywords."><y>#</y><d>2016-04-13</d><h>17:22</h><w>weavejester</w>To give some more background, I have a Datomic-like database, Ittyon, that works based around behaviour of aspects keywords.</z><z id="t1460568184" t="weavejester So an aspect like, I don‚Äôt know, :player/health, has certain behaviours associated with it."><y>#</y><d>2016-04-13</d><h>17:23</h><w>weavejester</w>So an aspect like, I don‚Äôt know, :player/health, has certain behaviours associated with it.</z><z id="t1460568205" t="weavejester That naturally makes one think about multimethods, right?"><y>#</y><d>2016-04-13</d><h>17:23</h><w>weavejester</w>That naturally makes one think about multimethods, right?</z><z id="t1460568238" t="zane Right."><y>#</y><d>2016-04-13</d><h>17:23</h><w>zane</w>Right.</z><z id="t1460568243" t="weavejester But with Intentions and inheritance, combining behaviour (which is common) is easier than trying to call multimethods with different keys."><y>#</y><d>2016-04-13</d><h>17:24</h><w>weavejester</w>But with Intentions and inheritance, combining behaviour (which is common) is easier than trying to call multimethods with different keys.</z><z id="t1460568308" t="weavejester Because aspects have a lot of behaviour in common, the inheritance model happens to make a lot of sense."><y>#</y><d>2016-04-13</d><h>17:25</h><w>weavejester</w>Because aspects have a lot of behaviour in common, the inheritance model happens to make a lot of sense.</z><z id="t1460568350" t="weavejester Especially if you have a way of combining inherited behaviour automatically."><y>#</y><d>2016-04-13</d><h>17:25</h><w>weavejester</w>Especially if you have a way of combining inherited behaviour automatically.</z><z id="t1460568398" t="weavejester Not sure if that makes sense? I‚Äôd explain it more but that would mean explaining more about Ittyon."><y>#</y><d>2016-04-13</d><h>17:26</h><w>weavejester</w>Not sure if that makes sense? I‚Äôd explain it more but that would mean explaining more about Ittyon.</z><z id="t1460568455" t="zane I think I kind of get it."><y>#</y><d>2016-04-13</d><h>17:27</h><w>zane</w>I think I kind of get it.</z><z id="t1460568470" t="weavejester It‚Äôs a really niche use, though simple_smile"><y>#</y><d>2016-04-13</d><h>17:27</h><w>weavejester</w>It‚Äôs a really niche use, though <b>simple_smile</b></z><z id="t1460568481" t="weavejester And I‚Äôve never had opportunity to use it before."><y>#</y><d>2016-04-13</d><h>17:28</h><w>weavejester</w>And I‚Äôve never had opportunity to use it before.</z><z id="t1460568501" t="weavejester There are a few things in Clojure that seem pretty niche, until you need to use them."><y>#</y><d>2016-04-13</d><h>17:28</h><w>weavejester</w>There are a few things in Clojure that seem pretty niche, until you need to use them.</z><z id="t1460568526" t="weavejester I don‚Äôt think I‚Äôve used refs or agents in a real program yet simple_smile"><y>#</y><d>2016-04-13</d><h>17:28</h><w>weavejester</w>I don‚Äôt think I‚Äôve used refs or agents in a real program yet <b>simple_smile</b></z><z id="t1460569985" t="zane Me either."><y>#</y><d>2016-04-13</d><h>17:53</h><w>zane</w>Me either.</z><z id="t1460996440" t="lwhorton Hey guys, I‚Äôm hoping someone can help me with a conceptual issue i‚Äôm having with middleware?"><y>#</y><d>2016-04-18</d><h>16:20</h><w>lwhorton</w>Hey guys, I‚Äôm hoping someone can help me with a conceptual issue i‚Äôm having with middleware?</z><z id="t1460996481" t="lwhorton If I wanted a middleware to capture particular routes, then proxy them to /different/route, how do I make sure the middleware is invoked with the response from the proxy?"><y>#</y><d>2016-04-18</d><h>16:21</h><w>lwhorton</w>If I wanted a middleware to capture particular routes, then proxy them to /different/route, how do I make sure the middleware is invoked with the response from the proxy?</z><z id="t1462916536" t="zane [:attrs {:href &quot;/_/_/users/U0BKWMG5B&quot;}] : Here&apos;s another one for you: We want all logging done on requests that have a request-id header set to include that id. Would you parameterize logging functions and make them available on the request map, or would you use a closure as with conn . https://clojurians.slack.com/archives/ring/p1460504518000047"><y>#</y><d>2016-05-10</d><h>21:42</h><w>zane</w><a>@weavejester</a>: Here&apos;s another one for you: We want all logging done on requests that have a <code>request-id</code> header set to include that id. Would you parameterize logging functions and make them available on the <code>request</code> map, or would you use a closure as with <code>conn</code>. <a href="https://clojurians.slack.com/archives/ring/p1460504518000047" target="_blank">https://clojurians.slack.com/archives/ring/p1460504518000047</a></z><z id="t1462916558" t="zane Either would clearly work, but I&apos;m wondering what&apos;s more idiomatic."><y>#</y><d>2016-05-10</d><h>21:42</h><w>zane</w>Either would clearly work, but I&apos;m wondering what&apos;s more idiomatic.</z><z id="t1463091585" t="ag is it possible to ‚Äúkill&quot; the server (so I can start it again) from repl, without having to restart the repl?"><y>#</y><d>2016-05-12</d><h>22:19</h><w>ag</w>is it possible to ‚Äúkill&quot; the server (so I can start it again) from repl, without having to restart the repl?</z><z id="t1463091672" t="ag when I do this aleph.http/start-server and after &apos;Ctrl-C‚Äôing try running it again it would throw BindException Address already in use"><y>#</y><d>2016-05-12</d><h>22:21</h><w>ag</w>when I do this <code>aleph.http/start-server</code> and after &apos;Ctrl-C‚Äôing try running it again it would  throw <code>BindException Address already in use</code></z><z id="t1463171433" t="Scot Hey all, has anyone used https://github.com/magnars/optimus or other asset optimization tools in production? I am looking for a tool to compile less/scss and minify and compress static assets, any recommendations or thoughts? I appreciate your advice."><y>#</y><d>2016-05-13</d><h>20:30</h><w>Scot</w>Hey all, has anyone used <a href="https://github.com/magnars/optimus" target="_blank">https://github.com/magnars/optimus</a> or other asset optimization tools in production? I am looking for a tool to compile less/scss and minify and compress static assets, any recommendations or thoughts? I appreciate your advice.</z><z id="t1463176175" t="zane [:attrs {:href &quot;/_/_/users/U0NLT4Z2Q&quot;}] : I have a small amount of experience with using Optimus on hobby projects. Did you have specific questions? Another thing to be aware of is that Arachne (#C1193CCJW/ http://arachne-framework.org/ ) is trying to tackle that problem as well over the next couple months, and is likely to become the de-facto standard."><y>#</y><d>2016-05-13</d><h>21:49</h><w>zane</w><a>@scot-brown</a>: I have a small amount of experience with using Optimus on hobby projects. Did you have specific questions? Another thing to be aware of is that Arachne (#C1193CCJW/ <a href="http://arachne-framework.org/" target="_blank">http://arachne-framework.org/</a>) is trying to tackle that problem as well over the next couple months, and is likely to become the de-facto standard.</z><z id="t1464214592" t="mvaline hey guys, I&apos;m having trouble building my uberjar for a ring project"><y>#</y><d>2016-05-25</d><h>22:16</h><w>mvaline</w>hey guys, I&apos;m having trouble building my uberjar for a ring project</z><z id="t1464214653" t="mvaline lein ring uberjar works, however lein uberjar gives me Warning: The Main-Class specified does not exist within the jar. It may not be executable as expected. A gen-class directive may be missing in the namespace which contains the main method. even having specified :main in project.clj and defined -main within the main namespace"><y>#</y><d>2016-05-25</d><h>22:17</h><w>mvaline</w><code>lein ring uberjar</code> works, however <code>lein uberjar</code> gives me <code>Warning: The Main-Class specified does not exist within the jar. It may not be executable as expected. A gen-class directive may be missing in the namespace which contains the main method.</code> even having specified <code>:main</code> in project.clj and defined <code>-main</code> within the main namespace</z><z id="t1464214685" t="mvaline which is just a call to (ring/run-jetty handler)"><y>#</y><d>2016-05-25</d><h>22:18</h><w>mvaline</w>which is just a call to <code>(ring/run-jetty handler)</code></z><z id="t1464214699" t="mvaline anything I&apos;m missing off the bat?"><y>#</y><d>2016-05-25</d><h>22:18</h><w>mvaline</w>anything I&apos;m missing off the bat?</z><z id="t1464214723" t="mvaline I&apos;m trying to get lein uberjar to work for the heroku clojure buildpack"><y>#</y><d>2016-05-25</d><h>22:18</h><w>mvaline</w>I&apos;m trying to get lein uberjar to work for the heroku clojure buildpack</z><z id="t1464214893" t="mvaline ahh it may be due to lack of :gen-class"><y>#</y><d>2016-05-25</d><h>22:21</h><w>mvaline</w>ahh it may be due to lack of :gen-class</z><z id="t1464214923" t="mvaline wow looking for that forever. Solved üëÜ"><y>#</y><d>2016-05-25</d><h>22:22</h><w>mvaline</w>wow looking for that forever. Solved <b>üëÜ</b></z><z id="t1465419275" t="hoppy using lein ring uberjar to deploy"><y>#</y><d>2016-06-08</d><h>20:54</h><w>hoppy</w>using lein ring uberjar to deploy</z><z id="t1465419318" t="hoppy wondering if there is a way to manage setting the http port from within the ring handler - e.g. I&apos;d read it from my config file."><y>#</y><d>2016-06-08</d><h>20:55</h><w>hoppy</w>wondering if there is a way to manage setting the http port from within the ring handler - e.g. I&apos;d read it from my config file.</z><z id="t1465434072" t="weavejester I believe you‚Äôll need to write your own -main method for that."><y>#</y><d>2016-06-09</d><h>01:01</h><w>weavejester</w>I believe you‚Äôll need to write your own <code>-main</code> method for that.</z><z id="t1466201949" t="pheuter Do people have any experience using the :edn formatter to properly parse custom edn tags?"><y>#</y><d>2016-06-17</d><h>22:19</h><w>pheuter</w>Do people have any experience using the <code>:edn</code> formatter to properly parse custom edn tags?</z><z id="t1466201988" t="pheuter I have confirmed that I have the proper mapping in *data-readers* , but i keep getting the error Attempting to call unbound fn"><y>#</y><d>2016-06-17</d><h>22:19</h><w>pheuter</w>I have confirmed that I have the proper mapping in <code>*data-readers*</code>, but i keep getting the error <code>Attempting to call unbound fn</code></z><z id="t1467214817" t="roberto what is the conventional way to keywordize requests?"><y>#</y><d>2016-06-29</d><h>15:40</h><w>roberto</w>what is the conventional way to keywordize requests?</z><z id="t1467214863" t="roberto I normally have my own function that takes the params in a request and keywordize all the keys, but was wondering if there is some other way of doing this"><y>#</y><d>2016-06-29</d><h>15:41</h><w>roberto</w>I normally have my own function that takes the params in a request and keywordize all the keys, but was wondering if there is some other way of doing this</z><z id="t1467218243" t="zane Doing that via middleware sounds idiomatic to me."><y>#</y><d>2016-06-29</d><h>16:37</h><w>zane</w>Doing that via middleware sounds idiomatic to me.</z><z id="t1467218264" t="zane You could either write your own or use one from a library, e.g. https://github.com/ngrunwald/ring-middleware-format"><y>#</y><d>2016-06-29</d><h>16:37</h><w>zane</w>You could either write your own or use one from a library, e.g. <a href="https://github.com/ngrunwald/ring-middleware-format" target="_blank">https://github.com/ngrunwald/ring-middleware-format</a></z><z id="t1467218302" t="zane See :json-kw in that README ."><y>#</y><d>2016-06-29</d><h>16:38</h><w>zane</w>See <code>:json-kw</code> in that <code>README</code>.</z><z id="t1467218549" t="roberto aw, I was using that, but didn‚Äôt see json-kw . I thought just :json would do it. Thanks"><y>#</y><d>2016-06-29</d><h>16:42</h><w>roberto</w>aw, I was using that, but didn‚Äôt see <code>json-kw</code>. I thought just <code>:json</code> would do it. Thanks</z><z id="t1467218573" t="roberto I think json-kw should be the default tho, I don‚Äôt recall ever having to to use the json payload as a string alone."><y>#</y><d>2016-06-29</d><h>16:42</h><w>roberto</w>I think <code>json-kw</code> should be the default tho, I don‚Äôt recall ever having to to use the json payload as a string alone.</z><z id="t1467221926" t="zane I agree!"><y>#</y><d>2016-06-29</d><h>17:38</h><w>zane</w>I agree!</z><z id="t1469376495" t="ska Has anyone written a ring middleware to validate github webhook calls as described on https://developer.github.com/webhooks/securing/ ?"><y>#</y><d>2016-07-24</d><h>16:08</h><w>ska</w>Has anyone written a ring middleware to validate github webhook calls as described on <a href="https://developer.github.com/webhooks/securing/" target="_blank">https://developer.github.com/webhooks/securing/</a> ?</z><z id="t1469377612" t="ska [:attrs {:href &quot;/_/_/users/U051C77FP&quot;}] : I found your question regarding the hmac computation in Clojure on SO. Could you please tell me how you hooked it into your webapp? I currently have ring.middleware.defaults/wrap-defaults and ring.middleware.json/wrap-json-body on my handler. I guess that makes hmac computation fail as I need the original body."><y>#</y><d>2016-07-24</d><h>16:26</h><w>ska</w><a>@malabarba</a>: I found your question regarding the hmac computation in Clojure on SO. Could you please tell me how you hooked it into your webapp? I currently have <code>ring.middleware.defaults/wrap-defaults</code> and <code>ring.middleware.json/wrap-json-body</code> on my handler.  I guess that makes hmac computation fail as I need the original body.</z><z id="t1469378616" t="malabarba [:attrs {:href &quot;/_/_/users/U066F9CUW&quot;}] my memory fails me üôÇ Could you link to the question?"><y>#</y><d>2016-07-24</d><h>16:43</h><w>malabarba</w><a>@ska</a> my memory fails me <b>üôÇ</b> Could you link to the question?</z><z id="t1469378810" t="ska https://stackoverflow.com/questions/31729163/clojure-or-java-equivalent-to-rubys-hmac-hexdigest"><y>#</y><d>2016-07-24</d><h>16:46</h><w>ska</w><a href="https://stackoverflow.com/questions/31729163/clojure-or-java-equivalent-to-rubys-hmac-hexdigest" target="_blank">https://stackoverflow.com/questions/31729163/clojure-or-java-equivalent-to-rubys-hmac-hexdigest</a></z><z id="t1469379744" t="malabarba Ah"><y>#</y><d>2016-07-24</d><h>17:02</h><w>malabarba</w>Ah</z><z id="t1469379765" t="malabarba I think you just need to do your hmac computation outside other middlewares"><y>#</y><d>2016-07-24</d><h>17:02</h><w>malabarba</w>I think you just need to do your hmac computation outside other middlewares</z><z id="t1469379772" t="malabarba before the body is parsed"><y>#</y><d>2016-07-24</d><h>17:02</h><w>malabarba</w>before the body is parsed</z><z id="t1469379776" t="malabarba that&apos;s what I did"><y>#</y><d>2016-07-24</d><h>17:02</h><w>malabarba</w>that&apos;s what I did</z><z id="t1469379783" t="ska I think, I am already getting close to it. Would you like to join a tiny project on github to provide that middleware?"><y>#</y><d>2016-07-24</d><h>17:03</h><w>ska</w>I think, I am already getting close to it.  Would you like to join a tiny project on github to provide that middleware?</z><z id="t1469379787" t="malabarba Here&apos;s the function I wrote:"><y>#</y><d>2016-07-24</d><h>17:03</h><w>malabarba</w>Here&apos;s the function I wrote:</z><z id="t1469379788" t="malabarba `"><y>#</y><d>2016-07-24</d><h>17:03</h><w>malabarba</w><code></code>`</z><z id="t1469379795" t="malabarba `"><y>#</y><d>2016-07-24</d><h>17:03</h><w>malabarba</w><code></code>`</z><z id="t1469379800" t="malabarba Gah"><y>#</y><d>2016-07-24</d><h>17:03</h><w>malabarba</w>Gah</z><z id="t1469379811" t="malabarba I always mess up slack&apos;s code-blocks"><y>#</y><d>2016-07-24</d><h>17:03</h><w>malabarba</w>I always mess up slack&apos;s code-blocks</z><z id="t1469379816" t="ska üôÇ"><y>#</y><d>2016-07-24</d><h>17:03</h><w>ska</w><b>üôÇ</b></z><z id="t1469379826" t="malabarba (defn wrap-hub-signature &quot;Middleware that checks if a page asked for authentication.&quot; [handler] (fn [{:keys [headers request-method], :as request}] (if (and (= request-method :post) (headers &quot;x-hub-signature&quot;)) (let [body (slurp (:body request))] (or (when (= (hmac body) (headers &quot;x-hub-signature&quot;)) (when-let [json-body (try (json/parse-string body true) (catch JsonParseException e nil))] (handler (assoc request :hub-signature-verified true :body json-body :params json-body)))) {:status 400 :headers {&quot;Content-Type&quot; &quot;text/plain&quot;} :body &quot;Malformed JSON in request body.&quot;})) (handler request)))) "><y>#</y><d>2016-07-24</d><h>17:03</h><w>malabarba</w><pre>(defn wrap-hub-signature
  &quot;Middleware that checks if a page asked for authentication.&quot;
  [handler]
  (fn [{:keys [headers request-method], :as request}]
    (if (and (= request-method :post)
             (headers &quot;x-hub-signature&quot;))
      (let [body (slurp (:body request))]
        (or (when (= (hmac body) (headers &quot;x-hub-signature&quot;))
              (when-let [json-body (try (json/parse-string body true)
                                        (catch JsonParseException e nil))]
                (handler (assoc request :hub-signature-verified true
                                :body json-body
                                :params json-body))))
            {:status  400
             :headers {&quot;Content-Type&quot; &quot;text/plain&quot;}
             :body    &quot;Malformed JSON in request body.&quot;}))
      (handler request))))
</pre></z><z id="t1469379839" t="malabarba Note that I (slurp (:body request)) manually"><y>#</y><d>2016-07-24</d><h>17:03</h><w>malabarba</w>Note that I <code> (slurp (:body request))</code> manually</z><z id="t1469379873" t="malabarba obviously this only works if the body hasn&apos;t been slurped yet"><y>#</y><d>2016-07-24</d><h>17:04</h><w>malabarba</w>obviously this only works if the body hasn&apos;t been slurped yet</z><z id="t1469379884" t="ska Yeah, seen it. Crossing our fingers it will never OOm"><y>#</y><d>2016-07-24</d><h>17:04</h><w>ska</w>Yeah, seen it.  Crossing our fingers it will never OOm</z><z id="t1469379921" t="malabarba If I&apos;m not mistaken, I just borrowed the code used by the default ring middlware"><y>#</y><d>2016-07-24</d><h>17:05</h><w>malabarba</w>If I&apos;m not mistaken, I just borrowed the code used by the default ring middlware</z><z id="t1469379953" t="ska I am writing my own because I need to cover the case that the webapp can have several secret tokens configured."><y>#</y><d>2016-07-24</d><h>17:05</h><w>ska</w>I am writing my own because I need to cover the case that the webapp can have several secret tokens configured.</z><z id="t1469379956" t="malabarba Though we&apos;re talking 1 year ago, and my memory has a half-life of 1 month"><y>#</y><d>2016-07-24</d><h>17:05</h><w>malabarba</w>Though we&apos;re talking 1 year ago, and my memory has a half-life of 1 month</z><z id="t1469379957" t="malabarba hehe"><y>#</y><d>2016-07-24</d><h>17:05</h><w>malabarba</w>hehe</z><z id="t1469380015" t="malabarba h"><y>#</y><d>2016-07-24</d><h>17:06</h><w>malabarba</w>h</z><z id="t1469380016" t="malabarba hm"><y>#</y><d>2016-07-24</d><h>17:06</h><w>malabarba</w>hm</z><z id="t1469380022" t="malabarba that complicates things"><y>#</y><d>2016-07-24</d><h>17:07</h><w>malabarba</w>that complicates things</z><z id="t1469380036" t="malabarba several secret tokens for github signing?"><y>#</y><d>2016-07-24</d><h>17:07</h><w>malabarba</w>several secret tokens for github signing?</z><z id="t1469380041" t="malabarba How do you decide which to use?"><y>#</y><d>2016-07-24</d><h>17:07</h><w>malabarba</w>How do you decide which to use?</z><z id="t1469380160" t="ska I don&apos;t mind as long as anyone validates üôÇ"><y>#</y><d>2016-07-24</d><h>17:09</h><w>ska</w>I don&apos;t mind as long as anyone validates <b>üôÇ</b></z><z id="t1469380169" t="ska I am preparing a gist at the moment..."><y>#</y><d>2016-07-24</d><h>17:09</h><w>ska</w>I am preparing a gist at the moment...</z><z id="t1469380396" t="ska Does that make sense? https://gist.github.com/ska2342/4567b02531ff611db6a1208ebd4316e6"><y>#</y><d>2016-07-24</d><h>17:13</h><w>ska</w>Does that make sense?   <a href="https://gist.github.com/ska2342/4567b02531ff611db6a1208ebd4316e6" target="_blank">https://gist.github.com/ska2342/4567b02531ff611db6a1208ebd4316e6</a></z><z id="t1469380573" t="malabarba Have you tested it?"><y>#</y><d>2016-07-24</d><h>17:16</h><w>malabarba</w>Have you tested it?</z><z id="t1469380586" t="malabarba I&apos;m not sure if calling .getBytes multiple times on the body will work"><y>#</y><d>2016-07-24</d><h>17:16</h><w>malabarba</w>I&apos;m not sure if calling <code>.getBytes</code> multiple times on the body will work</z><z id="t1469380594" t="malabarba Some streams can only be retrieved once"><y>#</y><d>2016-07-24</d><h>17:16</h><w>malabarba</w>Some streams can only be retrieved once</z><z id="t1469385417" t="ska No, not tested a single run. That is 45 lines or written-only code so far üôÇ My testing setup is more complex. I need to deploy an uberjar to an EC2 instance and make sure that I get all information I need to test it. üòâ"><y>#</y><d>2016-07-24</d><h>18:36</h><w>ska</w>No, not tested a single run.  That is 45 lines or written-only code so far <b>üôÇ</b>  My testing setup is more complex.  I need to deploy an uberjar to an EC2 instance and make sure that I get all information I need to test it. <b>üòâ</b></z><z id="t1469385474" t="ska I do have some old recorded requests but only after wrap-json and stuff. Does not help a lot for this."><y>#</y><d>2016-07-24</d><h>18:37</h><w>ska</w>I do have some old recorded requests but only after wrap-json and stuff.  Does not help a lot for this.</z><z id="t1469386773" t="ska If I make my handler the first in the chain, reading the body is a problem: the :body element is a org.eclipse.jetty.server.HttpInputOverHTTP which does not have a .getBytes method."><y>#</y><d>2016-07-24</d><h>18:59</h><w>ska</w>If I make my handler the first in the chain, reading the body is a problem: the <code>:body</code> element is a <code>org.eclipse.jetty.server.HttpInputOverHTTP</code> which does not have a .getBytes method.</z><z id="t1469387104" t="malabarba In my case I just slurp ed the body, and called getBytes on the string"><y>#</y><d>2016-07-24</d><h>19:05</h><w>malabarba</w>In my case I just <code>slurp</code>ed the body, and called <code>getBytes</code> on the string</z><z id="t1469387151" t="malabarba Might be safest to specify an Encoding for the string"><y>#</y><d>2016-07-24</d><h>19:05</h><w>malabarba</w>Might be safest to specify an Encoding for the string</z><z id="t1469387168" t="malabarba but for me it Just Worked ‚Ñ¢Ô∏è"><y>#</y><d>2016-07-24</d><h>19:06</h><w>malabarba</w>but for me it Just Worked <b>‚Ñ¢Ô∏è</b></z><z id="t1469395633" t="ska I think, I can make it work for my reduced use-case. Turning it into something generic and a library would be more work, though. I wonder how the JSON middleware gets away with just slurping the string."><y>#</y><d>2016-07-24</d><h>21:27</h><w>ska</w>I think, I can make it work for my reduced use-case.  Turning it into something generic and a library would be more work, though.  I wonder how the JSON middleware gets away with just slurping the string.</z><z id="t1469396044" t="malabarba maybe ring itself handles any length issues directly in the input stream"><y>#</y><d>2016-07-24</d><h>21:34</h><w>malabarba</w>maybe ring itself handles any length issues directly in the input stream</z><z id="t1469396076" t="malabarba You could post an issue asking about that"><y>#</y><d>2016-07-24</d><h>21:34</h><w>malabarba</w>You could post an issue asking about that</z><z id="t1469396088" t="malabarba Though I&apos;d recomend to actually check their code first"><y>#</y><d>2016-07-24</d><h>21:34</h><w>malabarba</w>Though I&apos;d recomend to actually check their code first</z><z id="t1469396111" t="malabarba I *think* I borrowed that slurp from the middleware, but I wouldn&apos;t bet my life on it. üôÇ"><y>#</y><d>2016-07-24</d><h>21:35</h><w>malabarba</w>I *think* I borrowed that <code>slurp</code> from the middleware, but I wouldn&apos;t bet my life on it. <b>üôÇ</b></z><z id="t1469432307" t="ska I see that the JSON middleware slurps, too: https://github.com/ring-clojure/ring-json/blob/master/src/ring/middleware/json.clj#L14"><y>#</y><d>2016-07-25</d><h>07:38</h><w>ska</w>I see that the JSON middleware slurps, too: <a href="https://github.com/ring-clojure/ring-json/blob/master/src/ring/middleware/json.clj#L14" target="_blank">https://github.com/ring-clojure/ring-json/blob/master/src/ring/middleware/json.clj#L14</a></z><z id="t1469432353" t="ska I guess that will conflict with me slurping first."><y>#</y><d>2016-07-25</d><h>07:39</h><w>ska</w>I guess that will conflict with me slurping first.</z><z id="t1469439956" t="ska FWIW, I updated my gist with the final, working version: https://gist.github.com/ska2342/4567b02531ff611db6a1208ebd4316e6#file-gh-validation-clj"><y>#</y><d>2016-07-25</d><h>09:45</h><w>ska</w>FWIW, I updated my gist with the final, working version: <a href="https://gist.github.com/ska2342/4567b02531ff611db6a1208ebd4316e6#file-gh-validation-clj" target="_blank">https://gist.github.com/ska2342/4567b02531ff611db6a1208ebd4316e6#file-gh-validation-clj</a></z><z id="t1469521477" t="ska Good morning. Has anyone ever managed to get rid of the &quot;Logging initialized&quot; message from Jetty? It was just slightly annoying as long as my JAR would only be run as the Jetty server, but I also introduced some command line switches to e.g. print out documentation or a sample configuration file and in those cases, it may lead to errors for the users."><y>#</y><d>2016-07-26</d><h>08:24</h><w>ska</w>Good morning.  Has anyone ever managed to get rid of the &quot;Logging initialized&quot; message from Jetty? It was just slightly annoying as long as my JAR would only be run as the Jetty server, but I also introduced some command line switches to e.g. print out documentation or a sample configuration file and in those cases, it may lead to errors for the users.</z><z id="t1469521508" t="ska That messages seems to appear when just loading the Jetty classes."><y>#</y><d>2016-07-26</d><h>08:25</h><w>ska</w>That messages seems to appear when just loading the Jetty classes.</z><z id="t1469525968" t="lmergen well you could specifically filter that message away, but yeah i agree it&apos;s pretty annoying"><y>#</y><d>2016-07-26</d><h>09:39</h><w>lmergen</w>well you could specifically filter that message away, but yeah i agree it&apos;s pretty annoying</z><z id="t1469580555" t="malabarba [:attrs {:href &quot;/_/_/users/U066F9CUW&quot;}] answering that comment: yes, it&apos;ll conflict "><y>#</y><d>2016-07-27</d><h>00:49</h><w>malabarba</w><a>@ska</a> answering that comment: yes, it&apos;ll conflict </z><z id="t1469580565" t="malabarba You need to not use the json midddleware "><y>#</y><d>2016-07-27</d><h>00:49</h><w>malabarba</w>You need to not use the json midddleware </z><z id="t1469602975" t="ska Ah, well, learned something about ring today: https://github.com/ring-clojure/ring-json/pull/43"><y>#</y><d>2016-07-27</d><h>07:02</h><w>ska</w>Ah, well, learned something about ring today: <a href="https://github.com/ring-clojure/ring-json/pull/43" target="_blank">https://github.com/ring-clojure/ring-json/pull/43</a></z><z id="t1469650562" t="roberto how can you serve a file with compojure? I don‚Äôt want to serve static files, just a file that gets generated dynamically (like an audio file)"><y>#</y><d>2016-07-27</d><h>20:16</h><w>roberto</w>how can you serve a file with compojure? I don‚Äôt want to serve static files, just a file that gets generated dynamically (like an audio file)</z><z id="t1469678807" t="weavejester [:attrs {:href &quot;/_/_/users/U05207L4M&quot;}] : You can return an InputStream , or use piped-input-stream to write the generated file to an OutputStream ."><y>#</y><d>2016-07-28</d><h>04:06</h><w>weavejester</w><a>@roberto</a>: You can return an <code>InputStream</code>, or use <code>piped-input-stream</code> to write the generated file to an <code>OutputStream</code>.</z><z id="t1469714081" t="roberto thanks [:attrs {:href &quot;/_/_/users/U0BKWMG5B&quot;}]"><y>#</y><d>2016-07-28</d><h>13:54</h><w>roberto</w>thanks <a>@weavejester</a></z><z id="t1469822678" t="actsasgeek so I have a little tiny website that does mostly GET using compojure and ring-defaults. I made my first POST route the other day and imagine my surprise when I saw ‚Äúinvalid anti-forgery token‚Äù instead of my search results. I googled around but since all the libraries seem to have been in flux (aren‚Äôt they always), what is the simplest way out of my difficulty? I‚Äôm using Selmer for templating."><y>#</y><d>2016-07-29</d><h>20:04</h><w>actsasgeek</w>so I have a little tiny website that does mostly GET using compojure and ring-defaults. I made my first POST route the other day and imagine my surprise when I saw ‚Äúinvalid anti-forgery token‚Äù instead of my search results. I googled around but since all the libraries seem to have been in flux (aren‚Äôt they always), what is the simplest way out of my difficulty? I‚Äôm using Selmer for templating.</z><z id="t1469825468" t="weavejester actsasgeek: The anti-forgery token comes from the wrap-anti-forgery middleware. It‚Äôs enabled in the site-defaults map."><y>#</y><d>2016-07-29</d><h>20:51</h><w>weavejester</w>actsasgeek: The anti-forgery token comes from the wrap-anti-forgery middleware. It‚Äôs enabled in the <code>site-defaults</code> map.</z><z id="t1469825527" t="weavejester It prevents CSRF attacks. You can either turn it off, if you‚Äôre not using sessions or don‚Äôt care if people outside a session can fake a POST, or you can add the *anti-forgery-token* var to a hidden field in your form."><y>#</y><d>2016-07-29</d><h>20:52</h><w>weavejester</w>It prevents CSRF attacks. You can either turn it off, if you‚Äôre not using sessions or don‚Äôt care if people outside a session can fake a POST, or you can add the <code>*anti-forgery-token*</code> var to a hidden field in your form.</z><z id="t1469825556" t="actsasgeek ok, I think it‚Äôs the last part that I‚Äôm not sure how to do."><y>#</y><d>2016-07-29</d><h>20:52</h><w>actsasgeek</w>ok, I think it‚Äôs the last part that I‚Äôm not sure how to do.</z><z id="t1469825623" t="actsasgeek would I have to require that var and where is it required from and then just do {{*anti-forgery-token*}} in the form in the Selmer template?"><y>#</y><d>2016-07-29</d><h>20:53</h><w>actsasgeek</w>would I have to require that var and where is it required from and then just do <code>{{*anti-forgery-token*}}</code> in the form in the Selmer template?</z><z id="t1469825662" t="weavejester In the form that you‚Äôre POSTing, you‚Äôll want a HTML tag like: &lt;input type=‚Äúhidden‚Äù name=‚Äú__anti-forgery-token‚Äù value=‚Äú{{*anti-forgery-token*}}‚Äù&gt;"><y>#</y><d>2016-07-29</d><h>20:54</h><w>weavejester</w>In the form that you‚Äôre POSTing, you‚Äôll want a HTML tag like: <code>&lt;input type=‚Äúhidden‚Äù name=‚Äú__anti-forgery-token‚Äù value=‚Äú{{*anti-forgery-token*}}‚Äù&gt;</code></z><z id="t1469825705" t="weavejester Where *anti-forgery-token* is ring.middleware.anti-forgery/*anti-forgery-token*"><y>#</y><d>2016-07-29</d><h>20:55</h><w>weavejester</w>Where <code>*anti-forgery-token*</code> is <code>ring.middleware.anti-forgery/*anti-forgery-token*</code></z><z id="t1469825803" t="weavejester The anti-forgery middleware then checks to see if the token passed as a POST parameter matches the token in the session. This proves that the form is from your site, rather than a site an attacker has set up."><y>#</y><d>2016-07-29</d><h>20:56</h><w>weavejester</w>The anti-forgery middleware then checks to see if the token passed as a POST parameter matches the token in the session. This proves that the form is from your site, rather than a site an attacker has set up.</z><z id="t1469825823" t="weavejester Forms predate sensible cross-origin security policies, hence the need for this."><y>#</y><d>2016-07-29</d><h>20:57</h><w>weavejester</w>Forms predate sensible cross-origin security policies, hence the need for this.</z><z id="t1469825857" t="weavejester https://github.com/ring-clojure/ring-anti-forgery"><y>#</y><d>2016-07-29</d><h>20:57</h><w>weavejester</w><a href="https://github.com/ring-clojure/ring-anti-forgery" target="_blank">https://github.com/ring-clojure/ring-anti-forgery</a></z><z id="t1469825896" t="actsasgeek you‚Äôre a gem. works like a charm. Thanks."><y>#</y><d>2016-07-29</d><h>20:58</h><w>actsasgeek</w>you‚Äôre a gem. works like a charm. Thanks.</z><z id="t1469826028" t="actsasgeek it was like having a red wire and a black wire and going, I know something goes between these two ends but ¬Ø\(„ÉÑ)/¬Ø"><y>#</y><d>2016-07-29</d><h>21:00</h><w>actsasgeek</w>it was like having a red wire and a black wire and going, I know something goes between these two ends but ¬Ø\(„ÉÑ)/¬Ø</z><z id="t1469826139" t="weavejester Yeah, it‚Äôs a common problem. Hard to solve in general given that people can be using any template, though! Web development involves knowing about a lot of edge cases caused by historical artifacts."><y>#</y><d>2016-07-29</d><h>21:02</h><w>weavejester</w>Yeah, it‚Äôs a common problem. Hard to solve in general given that people can be using any template, though! Web development involves knowing about a lot of edge cases caused by historical artifacts.</z><z id="t1470597469" t="ska Is it possible to have different middlewares on different (compojure) routes? E.g. push everything under /api through wrap-keyword-params and everything under /pages through wrap-session (handlers used just as examples)."><y>#</y><d>2016-08-07</d><h>19:17</h><w>ska</w>Is it possible to have different middlewares on different (compojure) routes?  E.g. push everything under <code>/api</code> through <code>wrap-keyword-params</code> and everything under <code>/pages</code> through <code>wrap-session</code> (handlers used just as examples).</z><z id="t1470607123" t="weavejester ska: Yes, you just apply the middleware directly to the routes."><y>#</y><d>2016-08-07</d><h>21:58</h><w>weavejester</w>ska: Yes, you just apply the middleware directly to the routes.</z><z id="t1470641864" t="ska [:attrs {:href &quot;/_/_/users/U0BKWMG5B&quot;}] : and I assume, that works for contexts, too. Will give it a try. Thanks."><y>#</y><d>2016-08-08</d><h>07:37</h><w>ska</w><a>@weavejester</a>: and I assume, that works for contexts, too.  Will give it a try.  Thanks.</z><z id="t1470647293" t="sander in a StreamableResponseBody (1.6.0-beta4), can I somehow detect that the client has closed the http connection (and stop writing a response)?"><y>#</y><d>2016-08-08</d><h>09:08</h><w>sander</w>in a StreamableResponseBody (1.6.0-beta4), can I somehow detect that the client has closed the http connection (and stop writing a response)?</z><z id="t1470647686" t="sander I&apos;m using jetty 9, in case that provides relevant additional API"><y>#</y><d>2016-08-08</d><h>09:14</h><w>sander</w>I&apos;m using jetty 9, in case that provides relevant additional API</z><z id="t1470652326" t="sander (got responses in #C03S1KBA2 already, taking the discussion there)"><y>#</y><d>2016-08-08</d><h>10:32</h><w>sander</w>(got responses in #C03S1KBA2 already, taking the discussion there)</z><z id="t1470664641" t="sander I&apos;m having another issue with 1.6.0-beta4: https://github.com/ring-clojure/ring/issues/257 any idea if I&apos;m doing something wrong?"><y>#</y><d>2016-08-08</d><h>13:57</h><w>sander</w>I&apos;m having another issue with 1.6.0-beta4: <a href="https://github.com/ring-clojure/ring/issues/257" target="_blank">https://github.com/ring-clojure/ring/issues/257</a> any idea if I&apos;m doing something wrong?</z><z id="t1470668402" t="sander (getting help at the github issue already)"><y>#</y><d>2016-08-08</d><h>15:00</h><w>sander</w>(getting help at the github issue already)</z><z id="t1470821969" t="ska Hi. I spent quite some time figuring out how routes and middlewares can be composed and created a little demo project to show several aspects at https://github.com/ska2342/ring-routes-demo It would be great if someone could review that to see if I worked against common patterns, or the ring contract, or if there are other errors. I would like this to be a good demo for users of ring and compojure who want to go beyond the first tutorials."><y>#</y><d>2016-08-10</d><h>09:39</h><w>ska</w>Hi.  I spent quite some time figuring out how routes and middlewares can be composed and created a little demo project to show several aspects at <a href="https://github.com/ska2342/ring-routes-demo" target="_blank">https://github.com/ska2342/ring-routes-demo</a>  It would be great if someone could review that to see if I worked against common patterns, or the ring contract, or if there are other errors.  I would like this to be a good demo for users of ring and compojure who want to go beyond the first tutorials.</z><z id="t1471361875" t="ska Has anyone ever tried to protect a ring-powered Jetty server against very large requests (POST, PUT, the unusual GET with a body)? I know about org.eclipse.jetty.server.Request.maxFormContentSize but that does only protect against requests which contain a valid content-length if I read https://github.com/eclipse/jetty.project/blob/jetty-9.3.x/jetty-server/src/main/java/org/eclipse/jetty/server/Request.java#L495 correctly (stepping into the getContentLength() , too)"><y>#</y><d>2016-08-16</d><h>15:37</h><w>ska</w>Has anyone ever tried to protect a ring-powered Jetty server against very large requests (POST, PUT, the unusual GET with a body)?  I know about <code>org.eclipse.jetty.server.Request.maxFormContentSize</code> but that does only protect against requests which contain a valid content-length if I read <a href="https://github.com/eclipse/jetty.project/blob/jetty-9.3.x/jetty-server/src/main/java/org/eclipse/jetty/server/Request.java#L495" target="_blank">https://github.com/eclipse/jetty.project/blob/jetty-9.3.x/jetty-server/src/main/java/org/eclipse/jetty/server/Request.java#L495</a> correctly (stepping into the <code>getContentLength()</code>, too)</z><z id="t1471361977" t="ska Ideally, I would like to accept only requests with a content length that is small enough and then read only that many bytes from the body. I think, I could do it in a middleware, but I have not yet done enough research on that."><y>#</y><d>2016-08-16</d><h>15:39</h><w>ska</w>Ideally, I would like to accept only requests with a content length that is small enough and then read only that many bytes from the body.  I think, I could do it in a middleware, but I have not yet done enough research on that.</z><z id="t1471848305" t="ikitommi Hi. is there an example how to use the raise with the new async ring?"><y>#</y><d>2016-08-22</d><h>06:45</h><w>ikitommi</w>Hi. is there an example how to use the <code>raise</code> with the new async ring?</z><z id="t1471863758" t="vinnyataide hello, is there any way to show println on the nrepl cider session? my cider-ring plugin only shows the output in the console"><y>#</y><d>2016-08-22</d><h>11:02</h><w>vinnyataide</w>hello, is there any way to show println on the nrepl cider session? my cider-ring plugin only shows the output in the console</z><z id="t1471863818" t="vinnyataide my project.clj is :plugins [[lein-ring &quot;0.9.7&quot;]] :ring {:handler modulo-de-seguranca.clj.core/app :nrepl {:start? true}}) "><y>#</y><d>2016-08-22</d><h>11:03</h><w>vinnyataide</w>my project.clj is
<pre>:plugins [[lein-ring &quot;0.9.7&quot;]]
  :ring    {:handler modulo-de-seguranca.clj.core/app
            :nrepl {:start? true}})
</pre></z><z id="t1471863840" t="vinnyataide then I do cider-connect to the nrepl port"><y>#</y><d>2016-08-22</d><h>11:04</h><w>vinnyataide</w>then I do cider-connect to the nrepl port</z><z id="t1472184292" t="weavejester ikitommi: You just call it with an exception. Pretty much any place you‚Äôd use throw , you can use raise ."><y>#</y><d>2016-08-26</d><h>04:04</h><w>weavejester</w>ikitommi: You just call it with an exception. Pretty much any place you‚Äôd use <code>throw</code>, you can use <code>raise</code>.</z><z id="t1472184342" t="weavejester vinnyataide: Not sure; might need a PR to add that functionality."><y>#</y><d>2016-08-26</d><h>04:05</h><w>weavejester</w>vinnyataide: Not sure; might need a PR to add that functionality.</z><z id="t1472677543" t="zane [:attrs {:href &quot;/_/_/users/U0BKWMG5B&quot;}] : You frown on attaching, for example, datomic db instances to the request, right?"><y>#</y><d>2016-08-31</d><h>21:05</h><w>zane</w><a>@weavejester</a>: You frown on attaching, for example, <b>datomic</b> db instances to the request, right?</z><z id="t1472677563" t="weavejester [:attrs {:href &quot;/_/_/users/U050CT4HR&quot;}] Right, I think it‚Äôs better to use a closure"><y>#</y><d>2016-08-31</d><h>21:06</h><w>weavejester</w><a>@zane</a> Right, I think it‚Äôs better to use a closure</z><z id="t1472677579" t="zane Closing around the connection?"><y>#</y><d>2016-08-31</d><h>21:06</h><w>zane</w>Closing around the connection?</z><z id="t1472677610" t="weavejester Around the handler, so you have a function like..."><y>#</y><d>2016-08-31</d><h>21:06</h><w>weavejester</w>Around the handler, so you have a function like...</z><z id="t1472677612" t="weavejester (defn endpoint [db] (fn [request] ‚Ä¶)) "><y>#</y><d>2016-08-31</d><h>21:06</h><w>weavejester</w><pre>(defn endpoint [db]
  (fn [request]
    ‚Ä¶))
</pre></z><z id="t1472677677" t="zane Right, totally."><y>#</y><d>2016-08-31</d><h>21:07</h><w>zane</w>Right, totally.</z><z id="t1472677688" t="zane But middleware gets assembled at application startup‚Ä¶"><y>#</y><d>2016-08-31</d><h>21:08</h><w>zane</w>But middleware gets assembled at application startup‚Ä¶</z><z id="t1472677702" t="zane I suppose that doesn&apos;t have to be the case."><y>#</y><d>2016-08-31</d><h>21:08</h><w>zane</w>I suppose that doesn&apos;t have to be the case.</z><z id="t1472677749" t="zane Using your example, are you suggesting that we build a new endpoint instance on each request?"><y>#</y><d>2016-08-31</d><h>21:09</h><w>zane</w>Using your example, are you suggesting that we build a new <code>endpoint</code> instance on each request?</z><z id="t1472677770" t="zane (Because each request wants to have an up-to-date db .)"><y>#</y><d>2016-08-31</d><h>21:09</h><w>zane</w>(Because each request wants to have an up-to-date <code>db</code>.)</z><z id="t1472677797" t="weavejester No, you run the endpoint function when your system starts up, and that gives you your handler that you can feed into your adapter."><y>#</y><d>2016-08-31</d><h>21:09</h><w>weavejester</w>No, you run the endpoint function when your system starts up, and that gives you your handler that you can feed into your adapter.</z><z id="t1472677818" t="weavejester Presumably the database is something that you know at startup."><y>#</y><d>2016-08-31</d><h>21:10</h><w>weavejester</w>Presumably the database is something that you know at startup.</z><z id="t1472677840" t="zane Not with datomic ."><y>#</y><d>2016-08-31</d><h>21:10</h><w>zane</w>Not with <b>datomic</b>.</z><z id="t1472677849" t="zane Since &quot;databases&quot; values are essentially snapshots."><y>#</y><d>2016-08-31</d><h>21:10</h><w>zane</w>Since &quot;databases&quot; values are essentially snapshots.</z><z id="t1472677871" t="weavejester In the case of datomic, substitute ‚Äúdatabase‚Äù for ‚Äúconnection&quot;"><y>#</y><d>2016-08-31</d><h>21:11</h><w>weavejester</w>In the case of datomic, substitute ‚Äúdatabase‚Äù for ‚Äúconnection&quot;</z><z id="t1472677873" t="zane We could have endpoint take the database connection instead."><y>#</y><d>2016-08-31</d><h>21:11</h><w>zane</w>We could have <code>endpoint</code> take the database connection instead.</z><z id="t1472677874" t="zane Yeah."><y>#</y><d>2016-08-31</d><h>21:11</h><w>zane</w>Yeah.</z><z id="t1472677895" t="weavejester The database should be derived from the connection on each request."><y>#</y><d>2016-08-31</d><h>21:11</h><w>weavejester</w>The database should be derived from the connection on each request.</z><z id="t1472677899" t="zane Indeed."><y>#</y><d>2016-08-31</d><h>21:11</h><w>zane</w>Indeed.</z><z id="t1472677912" t="weavejester But you don‚Äôt need to attach that to the request..."><y>#</y><d>2016-08-31</d><h>21:11</h><w>weavejester</w>But you don‚Äôt need to attach that to the request...</z><z id="t1472677918" t="zane We&apos;re trying to see if we can reduce the number of functions that take connections because testing against database instances is easier than testing against connections."><y>#</y><d>2016-08-31</d><h>21:11</h><w>zane</w>We&apos;re trying to see if we can reduce the number of functions that take connections because testing against database instances is easier than testing against connections.</z><z id="t1472677946" t="zane So I&apos;m wondering if it would work to have a middleware that basically does this:"><y>#</y><d>2016-08-31</d><h>21:12</h><w>zane</w>So I&apos;m wondering if it would work to have a middleware that basically does this:</z><z id="t1472677959" t="weavejester I see where you‚Äôre going, I think."><y>#</y><d>2016-08-31</d><h>21:12</h><w>weavejester</w>I see where you‚Äôre going, I think.</z><z id="t1472678026" t="zane (defn endpoint [conn] (fn [request] (let [db (d/db conn) rest-of-handlers (-&gt; (some-handler db) (some-middleware db) (some-other-middleware db))] (rest-of-handlers request)))) "><y>#</y><d>2016-08-31</d><h>21:13</h><w>zane</w><pre>(defn endpoint [conn]
  (fn [request]
    (let [db (d/db conn)
          rest-of-handlers (-&gt; (some-handler db)
                               (some-middleware db)
                               (some-other-middleware db))]
      (rest-of-handlers request))))
</pre></z><z id="t1472678033" t="zane ^ Is that bananas?"><y>#</y><d>2016-08-31</d><h>21:13</h><w>zane</w>^ Is that bananas?</z><z id="t1472678070" t="zane Also, thank you for being so accessible!"><y>#</y><d>2016-08-31</d><h>21:14</h><w>zane</w>Also, thank you for being so accessible!</z><z id="t1472678096" t="zane [:attrs {:href &quot;/_/_/users/U1FFEKYHX&quot;}] and I were just talking about how amazing your response time was to our question. üòÑ"><y>#</y><d>2016-08-31</d><h>21:14</h><w>zane</w><a>@annataberski</a> and I were just talking about how amazing your response time was to our question. <b>üòÑ</b></z><z id="t1472678117" t="weavejester You were probably just lucky! I‚Äôm not available all the time üôÇ"><y>#</y><d>2016-08-31</d><h>21:15</h><w>weavejester</w>You were probably just lucky! I‚Äôm not available all the time <b>üôÇ</b></z><z id="t1472678162" t="zane That hasn&apos;t been our experience. üòâ"><y>#</y><d>2016-08-31</d><h>21:16</h><w>zane</w>That hasn&apos;t been our experience. <b>üòâ</b></z><z id="t1472678185" t="weavejester I see the problem you have. With other databases I‚Äôd be inclined to use a protocol as a form of encapsulation."><y>#</y><d>2016-08-31</d><h>21:16</h><w>weavejester</w>I see the problem you have. With other databases I‚Äôd be inclined to use a protocol as a form of encapsulation.</z><z id="t1472678243" t="weavejester I think the same idea could be used here. So something like..."><y>#</y><d>2016-08-31</d><h>21:17</h><w>weavejester</w>I think the same idea could be used here. So something like...</z><z id="t1472678412" t="weavejester (defprotocol FooDatabase (get-foo [abstract-db id])) (extend-type datomic.Connection ;; or a component record (get-foo [conn id] (get-datomic-foo (db conn) id))) (defn endpoint [datomic] (GET ‚Äú/foo/:id‚Äù [id] (get-foo datomic id))) "><y>#</y><d>2016-08-31</d><h>21:20</h><w>weavejester</w><pre>(defprotocol FooDatabase
  (get-foo [abstract-db id]))

(extend-type datomic.Connection   ;; or a component record
  (get-foo [conn id]
    (get-datomic-foo (db conn) id)))

(defn endpoint [datomic]
  (GET ‚Äú/foo/:id‚Äù [id]
    (get-foo datomic id)))
</pre></z></g><g id="s1"><z id="t1472678461" t="weavejester Datomic‚Äôs immutable DBs are really useful, but since you usually need to perform writes as well, they‚Äôre not a complete abstraction."><y>#</y><d>2016-08-31</d><h>21:21</h><w>weavejester</w>Datomic‚Äôs immutable DBs are really useful, but since you usually need to perform writes as well, they‚Äôre not a complete abstraction.</z><z id="t1472678502" t="weavejester Whereas if you wrap the datomic connection, or a containing component, in a protocol, then you have a line of separation."><y>#</y><d>2016-08-31</d><h>21:21</h><w>weavejester</w>Whereas if you wrap the datomic connection, or a containing component, in a protocol, then you have a line of separation.</z><z id="t1472678577" t="weavejester So you can test the HTTP functions with a mock of the protocol"><y>#</y><d>2016-08-31</d><h>21:22</h><w>weavejester</w>So you can test the HTTP functions with a mock of the protocol</z><z id="t1472678594" t="weavejester And you can test functions like get-datomic-foo individually"><y>#</y><d>2016-08-31</d><h>21:23</h><w>weavejester</w>And you can test functions like <code>get-datomic-foo</code> individually</z><z id="t1472678614" t="weavejester And you can test the datomic protocol implementation as well."><y>#</y><d>2016-08-31</d><h>21:23</h><w>weavejester</w>And you can test the datomic protocol implementation as well.</z><z id="t1472678678" t="weavejester My general feeling is that it‚Äôs a good idea to wrap I/O-like operations in a protocol, both as a way of improving testing, and as a formal border between your functional internal code and the not-so-functional outside."><y>#</y><d>2016-08-31</d><h>21:24</h><w>weavejester</w>My general feeling is that it‚Äôs a good idea to wrap I/O-like operations in a protocol, both as a way of improving testing, and as a formal border between your functional internal code and the not-so-functional outside.</z><z id="t1472678724" t="zane I see, I see."><y>#</y><d>2016-08-31</d><h>21:25</h><w>zane</w>I see, I see.</z><z id="t1472678734" t="zane So you&apos;re saying that we should coerce the connections into databases dynamically if necessary?"><y>#</y><d>2016-08-31</d><h>21:25</h><w>zane</w>So you&apos;re saying that we should coerce the connections into databases dynamically if necessary?</z><z id="t1472678755" t="zane The problem with that is that each middleware will get a different database instance, right?"><y>#</y><d>2016-08-31</d><h>21:25</h><w>zane</w>The problem with that is that each middleware will get a different database instance, right?</z><z id="t1472678779" t="weavejester You‚Äôre doing something with the database inside the middleware itself?"><y>#</y><d>2016-08-31</d><h>21:26</h><w>weavejester</w>You‚Äôre doing something with the database inside the middleware itself?</z><z id="t1472678789" t="zane Yes."><y>#</y><d>2016-08-31</d><h>21:26</h><w>zane</w>Yes.</z><z id="t1472678805" t="zane Validation middleware, for example, needs the database to know how to validate."><y>#</y><d>2016-08-31</d><h>21:26</h><w>zane</w>Validation middleware, for example, needs the database to know how to validate.</z><z id="t1472678864" t="weavejester In which case you might need to add the database to the request. to be clear, I‚Äôm not against adding additional information to the request map, but it does represent additional complexity."><y>#</y><d>2016-08-31</d><h>21:27</h><w>weavejester</w>In which case you might need to add the database to the request. to be clear, I‚Äôm not against adding additional information to the request map, but it does represent additional complexity.</z><z id="t1472678874" t="zane Got it."><y>#</y><d>2016-08-31</d><h>21:27</h><w>zane</w>Got it.</z><z id="t1472678894" t="zane I didn&apos;t like adding it to the request map because it doesn&apos;t feel like it&apos;s part of the request."><y>#</y><d>2016-08-31</d><h>21:28</h><w>zane</w>I didn&apos;t like adding it to the request map because it doesn&apos;t feel like it&apos;s part of the request.</z><z id="t1472678902" t="zane This feels worse to you?"><y>#</y><d>2016-08-31</d><h>21:28</h><w>zane</w>This feels worse to you?</z><z id="t1472678906" t="weavejester Right, that‚Äôs my feeling as well üôÇ"><y>#</y><d>2016-08-31</d><h>21:28</h><w>weavejester</w>Right, that‚Äôs my feeling as well <b>üôÇ</b></z><z id="t1472678930" t="weavejester My inclination wouldn‚Äôt be to put validation in middleware"><y>#</y><d>2016-08-31</d><h>21:28</h><w>weavejester</w>My inclination wouldn‚Äôt be to put validation in middleware</z><z id="t1472678954" t="weavejester Since I tend to approach web apps with the idea of ‚ÄúHow to I throw away information as quickly as possible‚Äù."><y>#</y><d>2016-08-31</d><h>21:29</h><w>weavejester</w>Since I tend to approach web apps with the idea of ‚ÄúHow to I throw away information as quickly as possible‚Äù.</z><z id="t1472678965" t="weavejester So a request map comes in, but we typically don‚Äôt need all that info"><y>#</y><d>2016-08-31</d><h>21:29</h><w>weavejester</w>So a request map comes in, but we typically don‚Äôt need all that info</z><z id="t1472678974" t="weavejester Or it can be reduced down"><y>#</y><d>2016-08-31</d><h>21:29</h><w>weavejester</w>Or it can be reduced down</z><z id="t1472678994" t="weavejester The sooner we can do that, the less data we have to deal with, and the simpler our software can be."><y>#</y><d>2016-08-31</d><h>21:29</h><w>weavejester</w>The sooner we can do that, the less data we have to deal with, and the simpler our software can be.</z><z id="t1472679016" t="zane Oh, interesting."><y>#</y><d>2016-08-31</d><h>21:30</h><w>zane</w>Oh, interesting.</z><z id="t1472679043" t="zane So you&apos;re saying we should put validation in a simple function (rather than middleware) and flatten our middleware down?"><y>#</y><d>2016-08-31</d><h>21:30</h><w>zane</w>So you&apos;re saying we should put validation in a simple function (rather than middleware) and flatten our middleware down?</z><z id="t1472679102" t="zane Hmm. Does that mean that the request map should be paired down as you go? Or does it even mean that the value flowing through the middleware will cease to be a request map after a certain point?"><y>#</y><d>2016-08-31</d><h>21:31</h><w>zane</w>Hmm. Does that mean that the request map should be paired down as you go? Or does it even mean that the value flowing through the middleware will cease to be a request map after a certain point?</z><z id="t1472679108" t="zane Just want to make sure I&apos;m understanding."><y>#</y><d>2016-08-31</d><h>21:31</h><w>zane</w>Just want to make sure I&apos;m understanding.</z><z id="t1472679175" t="weavejester My feeling is that it‚Äôs useful for the request map to be a request map, in that all the information inside tends to be connected. Having a lobotomised request map seems like you could be running into type problems; something that looks like a request but is missing data."><y>#</y><d>2016-08-31</d><h>21:32</h><w>weavejester</w>My feeling is that it‚Äôs useful for the request map to be a request map, in that all the information inside tends to be connected. Having a lobotomised request map seems like you could be running into type problems; something that looks like a request but is missing data.</z><z id="t1472679200" t="weavejester But once you no longer need the request map, I think it makes sense to throw away all the information you don‚Äôt need."><y>#</y><d>2016-08-31</d><h>21:33</h><w>weavejester</w>But once you no longer need the request map, I think it makes sense to throw away all the information you don‚Äôt need.</z><z id="t1472679311" t="zane Right."><y>#</y><d>2016-08-31</d><h>21:35</h><w>zane</w>Right.</z><z id="t1472679312" t="zane I see."><y>#</y><d>2016-08-31</d><h>21:35</h><w>zane</w>I see.</z><z id="t1472679321" t="zane Super helpful."><y>#</y><d>2016-08-31</d><h>21:35</h><w>zane</w>Super helpful.</z><z id="t1472679350" t="zane So we could have another chain of handlers inside the bottom-most handler that operates on something other than the request map (and closes over the database)."><y>#</y><d>2016-08-31</d><h>21:35</h><w>zane</w>So we could have another chain of handlers inside the bottom-most handler that operates on something other than the request map (and closes over the database).</z><z id="t1472679351" t="weavejester I think I‚Äôd need to think about this, and it really depends on what you‚Äôre doing! Have you taken a look at Duct?"><y>#</y><d>2016-08-31</d><h>21:35</h><w>weavejester</w>I think I‚Äôd need to think about this, and it really depends on what you‚Äôre doing! Have you taken a look at Duct?</z><z id="t1472679363" t="zane Only a little."><y>#</y><d>2016-08-31</d><h>21:36</h><w>zane</w>Only a little.</z><z id="t1472679385" t="zane &gt; really depends on what you‚Äôre doing Happy to add detail wherever it would be helpful!"><y>#</y><d>2016-08-31</d><h>21:36</h><w>zane</w>&gt; really depends on what you‚Äôre doing
Happy to add detail wherever it would be helpful!</z><z id="t1472679465" t="weavejester So‚Ä¶ lets say you‚Äôre getting some data in. You need to validate it, and if it‚Äôs okay you put it in the database, and return some result. To me that feels like a polymorphic function. Or something that calls polymorphic functions."><y>#</y><d>2016-08-31</d><h>21:37</h><w>weavejester</w>So‚Ä¶ lets say you‚Äôre getting some data in. You need to validate it, and if it‚Äôs okay you put it in the database, and return some result. To me that feels like a polymorphic function. Or something that calls polymorphic functions.</z><z id="t1472679489" t="zane Polymorphic on what?"><y>#</y><d>2016-08-31</d><h>21:38</h><w>zane</w>Polymorphic on what?</z><z id="t1472679497" t="zane I guess I need more detail."><y>#</y><d>2016-08-31</d><h>21:38</h><w>zane</w>I guess I need more detail.</z><z id="t1472679540" t="weavejester On the type of the data you‚Äôre receiving. Or‚Ä¶ since you‚Äôre using Datomic, maybe you just treat each attribute as individually validated."><y>#</y><d>2016-08-31</d><h>21:39</h><w>weavejester</w>On the type of the data you‚Äôre receiving. Or‚Ä¶ since you‚Äôre using Datomic, maybe you just treat each attribute as individually validated.</z><z id="t1472679570" t="weavejester So‚Ä¶ let‚Äôs say you‚Äôre handling user creation"><y>#</y><d>2016-08-31</d><h>21:39</h><w>weavejester</w>So‚Ä¶ let‚Äôs say you‚Äôre handling user creation</z><z id="t1472679609" t="weavejester You might have three values: :user/email, :user/password, :user/retype-password"><y>#</y><d>2016-08-31</d><h>21:40</h><w>weavejester</w>You might have three values: <code>:user/email, :user/password, :user/retype-password</code></z><z id="t1472679676" t="weavejester Maybe you have a validation function like (validate map key value)"><y>#</y><d>2016-08-31</d><h>21:41</h><w>weavejester</w>Maybe you have a validation function like <code>(validate map key value)</code></z><z id="t1472679688" t="weavejester Maybe a multimethod"><y>#</y><d>2016-08-31</d><h>21:41</h><w>weavejester</w>Maybe a multimethod</z><z id="t1472679738" t="weavejester (defmethod validate :user/password [m k v] (and (string? v) (= v (:user/retype-password m)))) "><y>#</y><d>2016-08-31</d><h>21:42</h><w>weavejester</w><pre>(defmethod validate :user/password [m k v]
  (and (string? v) (= v (:user/retype-password m))))
</pre></z><z id="t1472679751" t="zane Ah."><y>#</y><d>2016-08-31</d><h>21:42</h><w>zane</w>Ah.</z><z id="t1472679755" t="weavejester Or something like clojure.spec, schema, or whatever you happen to use"><y>#</y><d>2016-08-31</d><h>21:42</h><w>weavejester</w>Or something like clojure.spec, schema, or whatever you happen to use</z><z id="t1472679758" t="zane Right."><y>#</y><d>2016-08-31</d><h>21:42</h><w>zane</w>Right.</z><z id="t1472679761" t="zane Sure."><y>#</y><d>2016-08-31</d><h>21:42</h><w>zane</w>Sure.</z><z id="t1472679776" t="weavejester So that‚Äôs polymorphic over the attribute"><y>#</y><d>2016-08-31</d><h>21:42</h><w>weavejester</w>So that‚Äôs polymorphic over the attribute</z><z id="t1472679790" t="zane In our particular case the validation is dependent on the state of the database."><y>#</y><d>2016-08-31</d><h>21:43</h><w>zane</w>In our particular case the validation is dependent on the state of the database.</z><z id="t1472679822" t="weavejester Yeah, so add db as an extra argument in the validation function."><y>#</y><d>2016-08-31</d><h>21:43</h><w>weavejester</w>Yeah, so add <code>db</code> as an extra argument in the validation function.</z><z id="t1472679827" t="zane For example, required attributes for each &quot;model&quot; are expressed via a datomic attribute attached to the entity for the attribute that is required. (Hope that makes sense.)"><y>#</y><d>2016-08-31</d><h>21:43</h><w>zane</w>For example, required attributes for each &quot;model&quot; are expressed via a <b>datomic</b> attribute attached to the entity for the attribute that is required. (Hope that makes sense.)</z><z id="t1472679828" t="zane Right."><y>#</y><d>2016-08-31</d><h>21:43</h><w>zane</w>Right.</z><z id="t1472679829" t="zane Makes sense."><y>#</y><d>2016-08-31</d><h>21:43</h><w>zane</w>Makes sense.</z><z id="t1472679841" t="zane So what you&apos;re saying is, request middleware isn&apos;t appropriate here."><y>#</y><d>2016-08-31</d><h>21:44</h><w>zane</w>So what you&apos;re saying is, request middleware isn&apos;t appropriate here.</z><z id="t1472679843" t="zane Just use functions."><y>#</y><d>2016-08-31</d><h>21:44</h><w>zane</w>Just use functions.</z><z id="t1472679845" t="weavejester Then once you have your piece, you can validate the whole data"><y>#</y><d>2016-08-31</d><h>21:44</h><w>weavejester</w>Then once you have your piece, you can validate the whole data</z><z id="t1472679845" t="zane üëç"><y>#</y><d>2016-08-31</d><h>21:44</h><w>zane</w><b>üëç</b></z><z id="t1472679864" t="weavejester I think so‚Ä¶ I tend to look at functions and ask ‚ÄúWhat does this function need to know?‚Äù"><y>#</y><d>2016-08-31</d><h>21:44</h><w>weavejester</w>I think so‚Ä¶ I tend to look at functions and ask ‚ÄúWhat does this function need to know?‚Äù</z><z id="t1472679873" t="zane That&apos;s a good principle. üòÑ"><y>#</y><d>2016-08-31</d><h>21:44</h><w>zane</w>That&apos;s a good principle. <b>üòÑ</b></z><z id="t1472679891" t="zane I think in our early design of this system we overused request middleware. We&apos;re coming around, but it&apos;s taking a while."><y>#</y><d>2016-08-31</d><h>21:44</h><w>zane</w>I think in our early design of this system we overused request middleware. We&apos;re coming around, but it&apos;s taking a while.</z><z id="t1472679930" t="weavejester I think in Clojure it‚Äôs unfortunately easy to make things complex."><y>#</y><d>2016-08-31</d><h>21:45</h><w>weavejester</w>I think in Clojure it‚Äôs unfortunately easy to make things complex.</z><z id="t1472679945" t="zane That&apos;s ironic given Rich&apos;s goals for the language. üòÑ"><y>#</y><d>2016-08-31</d><h>21:45</h><w>zane</w>That&apos;s ironic given Rich&apos;s goals for the language. <b>üòÑ</b></z><z id="t1472679951" t="weavejester Clojure has a lot of tools for dealing with complexity and encouraging simplicity."><y>#</y><d>2016-08-31</d><h>21:45</h><w>weavejester</w>Clojure has a lot of tools for dealing with complexity and encouraging simplicity.</z><z id="t1472679963" t="weavejester But it doesn‚Äôt mandate these tools."><y>#</y><d>2016-08-31</d><h>21:46</h><w>weavejester</w>But it doesn‚Äôt mandate these tools.</z><z id="t1472679995" t="weavejester There‚Äôs no strict type system, framework, or whatever to enforce the idea of keeping things simple."><y>#</y><d>2016-08-31</d><h>21:46</h><w>weavejester</w>There‚Äôs no strict type system, framework, or whatever to enforce the idea of keeping things simple.</z><z id="t1472680031" t="weavejester And because Clojure programming is different from OOP, it‚Äôs easy to layer in complexity without realizing it."><y>#</y><d>2016-08-31</d><h>21:47</h><w>weavejester</w>And because Clojure programming is different from OOP, it‚Äôs easy to layer in complexity without realizing it.</z><z id="t1472680061" t="weavejester Since OOP takes a defensive approach to complexity. You have classes and objects that setup walls to contain complexity and mutable state."><y>#</y><d>2016-08-31</d><h>21:47</h><w>weavejester</w>Since OOP takes a defensive approach to complexity. You have classes and objects that setup walls to contain complexity and mutable state.</z><z id="t1472680098" t="weavejester With Clojure, at least to me, it feels like you have to go on the offensive. Be very aggressive and eliminate instead of contain."><y>#</y><d>2016-08-31</d><h>21:48</h><w>weavejester</w>With Clojure, at least to me, it feels like you have to go on the offensive. Be very aggressive and eliminate instead of contain.</z><z id="t1472680126" t="weavejester So OOP says ‚Äúlet‚Äôs contain mutable state in objects‚Äù, and Clojure says, ‚Äúlet‚Äôs eliminate mutable state where possible‚Äù, as one example."><y>#</y><d>2016-08-31</d><h>21:48</h><w>weavejester</w>So OOP says ‚Äúlet‚Äôs contain mutable state in objects‚Äù, and Clojure says, ‚Äúlet‚Äôs eliminate mutable state where possible‚Äù, as one example.</z><z id="t1472680243" t="weavejester So I think my approach is to ask what a function needs, and whether its needs can be simplified. For instance, an immutable database is simpler than a raw connection."><y>#</y><d>2016-08-31</d><h>21:50</h><w>weavejester</w>So I think my approach is to ask what a function needs, and whether its needs can be simplified. For instance, an immutable database is simpler than a raw connection.</z><z id="t1472680346" t="weavejester So I‚Äôm in favour of your approach of trying to make as many things use databases over connections. But ideally you‚Äôd want to do it without drawing in the request, if possible."><y>#</y><d>2016-08-31</d><h>21:52</h><w>weavejester</w>So I‚Äôm in favour of your approach of trying to make as many things use databases over connections. But ideally you‚Äôd want to do it without drawing in the request, if possible.</z><z id="t1472680408" t="weavejester Not sure if that‚Äôs any help üôÇ"><y>#</y><d>2016-08-31</d><h>21:53</h><w>weavejester</w>Not sure if that‚Äôs any help <b>üôÇ</b></z><z id="t1472680448" t="weavejester bbl"><y>#</y><d>2016-08-31</d><h>21:54</h><w>weavejester</w>bbl</z><z id="t1472689429" t="zane ‚ûï ‚ûï to all of that. Thanks!"><y>#</y><d>2016-09-01</d><h>00:23</h><w>zane</w><b>‚ûï</b> <b>‚ûï</b> to all of that. Thanks!</z><z id="t1473105041" t="sandbags As part of a Compojure app I need to generate and email a PDF report. I‚Äôm interested in recommendations for doing the background processing. I assume a poor-mans implementation would be to spool off a thread from my handler function or possibly use a Core Async channel and another process spun up in init . However I‚Äôd really like a little fault tolerance and so forth. I‚Äôve looked at Storm and Onyx and they appear to be sledgehammers to crack a walnut in this context. Anyone recommend a simpler solution?"><y>#</y><d>2016-09-05</d><h>19:50</h><w>sandbags</w>As part of a Compojure app I need to generate and email a PDF report. I‚Äôm interested in recommendations for doing the background processing. I assume a poor-mans implementation would be to spool off a thread from my handler function or possibly use a Core Async channel and another process spun up in <code>init</code>. However I‚Äôd really like a little fault tolerance and so forth. I‚Äôve looked at Storm and Onyx and they appear to be sledgehammers to crack a walnut in this context. Anyone recommend a simpler solution?</z><z id="t1473105177" t="sandbags this won‚Äôt be high-throughput or anything like that, but i‚Äôm keen that the PDF is generated and sent and that I know both things have happened"><y>#</y><d>2016-09-05</d><h>19:52</h><w>sandbags</w>this won‚Äôt be high-throughput or anything like that, but i‚Äôm keen that the PDF is generated and sent and that I know both things have happened</z><z id="t1473710332" t="weavejester sandbags: Perhaps beanstalk? There are a few Clojure clients for that. It‚Äôs a small and simple queue."><y>#</y><d>2016-09-12</d><h>19:58</h><w>weavejester</w>sandbags: Perhaps beanstalk? There are a few Clojure clients for that. It‚Äôs a small and simple queue.</z><z id="t1473710397" t="sandbags [:attrs {:href &quot;/_/_/users/U0BKWMG5B&quot;}] thanks, i‚Äôll check that out"><y>#</y><d>2016-09-12</d><h>19:59</h><w>sandbags</w><a>@weavejester</a> thanks, i‚Äôll check that out</z><z id="t1473725265" t="sandbags Is there a better channel than this to talk about hiccup?"><y>#</y><d>2016-09-13</d><h>00:07</h><w>sandbags</w>Is there a better channel than this to talk about hiccup?</z><z id="t1473725287" t="sandbags i realise it‚Äôs nothing to do with ring but is used in ring apps somewhat üôÇ"><y>#</y><d>2016-09-13</d><h>00:08</h><w>sandbags</w>i realise it‚Äôs nothing to do with ring but is used in ring apps somewhat <b>üôÇ</b></z><z id="t1473904398" t="lumengxi what is the recommended way to do health checks in a ring application?"><y>#</y><d>2016-09-15</d><h>01:53</h><w>lumengxi</w>what is the recommended way to do health checks in a ring application?</z><z id="t1473953458" t="zane [:attrs {:href &quot;/_/_/users/U0DTAQVT3&quot;}] : You mean like an endpoint that a load balancer can hit to determine whether a particular process should receive incoming traffic?"><y>#</y><d>2016-09-15</d><h>15:30</h><w>zane</w><a>@lumengxi</a>: You mean like an endpoint that a load balancer can hit to determine whether a particular process should receive incoming traffic?</z><z id="t1475594109" t="sandbags Anyone implemented buddy-auth with sessions recently? I can see the :identity key &amp; value present in the session but the :identity key isn‚Äôt being set correctly on the request (it‚Äôs value is nil). I am using the wrap-authentication ring handler. Looking at the example I seem to be doing the same steps. I‚Äôm a little puzzled and wondered if anyone had come across any snafu‚Äôs in implementing this?"><y>#</y><d>2016-10-04</d><h>15:15</h><w>sandbags</w>Anyone implemented buddy-auth with sessions recently? I can see the :identity key &amp; value present in the session but the :identity key isn‚Äôt being set correctly on the request (it‚Äôs value is nil). I am using the wrap-authentication ring handler. Looking at the example I seem to be doing the same steps. I‚Äôm a little puzzled and wondered if anyone had come across any snafu‚Äôs in implementing this?</z><z id="t1475605864" t="niwinz [:attrs {:href &quot;/_/_/users/U06BDH95J&quot;}] is session middleware is set before the auth middleware?"><y>#</y><d>2016-10-04</d><h>18:31</h><w>niwinz</w><a>@sandbags</a> is session middleware is set before the auth middleware?</z><z id="t1475658733" t="sandbags [:attrs {:href &quot;/_/_/users/U06B73YQJ&quot;}] that‚Äôs a good point, i‚Äôll check thanks"><y>#</y><d>2016-10-05</d><h>09:12</h><w>sandbags</w><a>@niwinz</a> that‚Äôs a good point, i‚Äôll check thanks</z><z id="t1476564354" t="mathpunk I&apos;m developing a frontend application, and it came time to write some server-side. I&apos;m trying boot-http to run my server. I can set up ring handlers for routes, but I can no longer see the page I made. I figured this was &quot;static content&quot; but, this does not work: https://github.com/mathpunk/anansi/blob/server/src/clj/anansi/server.clj"><y>#</y><d>2016-10-15</d><h>20:45</h><w>mathpunk</w>I&apos;m developing a frontend application, and it came time to write some server-side. I&apos;m trying boot-http to run my server. I can set up ring handlers for routes, but I can no longer see the page I made. I figured this was &quot;static content&quot; but, this does not work: <a href="https://github.com/mathpunk/anansi/blob/server/src/clj/anansi/server.clj" target="_blank">https://github.com/mathpunk/anansi/blob/server/src/clj/anansi/server.clj</a></z><z id="t1476564427" t="mathpunk halp! I maybe don&apos;t fully understand what static content is"><y>#</y><d>2016-10-15</d><h>20:47</h><w>mathpunk</w>halp! I maybe don&apos;t fully understand what static content is</z><z id="t1476564467" t="mathpunk other than, it gets the page that the rest of the build.boot is making out of my stub index.html and my compiled cljs, and doesn&apos;t run a server function"><y>#</y><d>2016-10-15</d><h>20:47</h><w>mathpunk</w>other than, it gets the page that the rest of the build.boot is making out of my stub index.html and my compiled cljs, and doesn&apos;t run a server function</z><z id="t1476564839" t="mathpunk something like this also didn&apos;t fix my problem: https://github.com/ring-clojure/ring/wiki/Static-Resources"><y>#</y><d>2016-10-15</d><h>20:53</h><w>mathpunk</w>something like this also didn&apos;t fix my problem: <a href="https://github.com/ring-clojure/ring/wiki/Static-Resources" target="_blank">https://github.com/ring-clojure/ring/wiki/Static-Resources</a></z><z id="t1476564931" t="mathpunk i&apos;m probably holding it wrong but i don&apos;t know enough about what static resources are, and how boot makes them, to know what else to try"><y>#</y><d>2016-10-15</d><h>20:55</h><w>mathpunk</w>i&apos;m probably holding it wrong but i don&apos;t know enough about what static resources are, and how boot makes them, to know what else to try</z><z id="t1476814274" t="liamd are there any standard ways to set up a TTL cache with ring on certain endpoints?"><y>#</y><d>2016-10-18</d><h>18:11</h><w>liamd</w>are there any standard ways to set up a TTL cache with ring on certain endpoints?</z><z id="t1477011471" t="lumengxi [:attrs {:href &quot;/_/_/users/U052852ES&quot;}] has your problem been solved? i can help take a look at it. your link does not exist anymore"><y>#</y><d>2016-10-21</d><h>00:57</h><w>lumengxi</w><a>@thomas</a> has your problem been solved? i can help take a look at it. your link does not exist anymore</z><z id="t1477336704" t="deas Hi"><y>#</y><d>2016-10-24</d><h>19:18</h><w>deas</w>Hi</z><z id="t1477336817" t="deas Need a (container independent) websocket endpoint in a ring uberwar. A`@ServerEndpoint` annotation on a Java class works, but the approach feels clumsy. Anyone got a better idea?"><y>#</y><d>2016-10-24</d><h>19:20</h><w>deas</w>Need a (container independent) websocket endpoint in a ring uberwar. A`@ServerEndpoint` annotation on a Java class works, but the approach feels clumsy. Anyone got a better idea?</z><z id="t1477490082" t="Shantanu Kumar Does anyone know if there‚Äôs a way to force a handler-reload in lein-ring ? I update the handler at runtime via nREPL, which I want reloaded. /cc [:attrs {:href &quot;/_/_/users/U0BKWMG5B&quot;}]"><y>#</y><d>2016-10-26</d><h>13:54</h><w>Shantanu Kumar</w>Does anyone know if there‚Äôs a way to force a handler-reload in <code>lein-ring</code>? I update the handler at runtime via nREPL, which I want reloaded. /cc <a>@weavejester</a></z><z id="t1477578647" t="deas [:attrs {:href &quot;/_/_/users/U066J7E2U&quot;}] I have seen this happening. Guess it was me.lomin/component-restart doing the trick."><y>#</y><d>2016-10-27</d><h>14:30</h><w>deas</w><a>@kumarshantanu</a> I have seen this happening. Guess it was <code>me.lomin/component-restart</code> doing the trick.</z><z id="t1477578818" t="deas lein uberjar honors the provided profile for me while lein ring uberwar does not. Shouldn&apos;t it?"><y>#</y><d>2016-10-27</d><h>14:33</h><w>deas</w><code>lein uberjar</code> honors the provided profile for me while <code>lein ring uberwar</code> does not. Shouldn&apos;t it?</z><z id="t1477685903" t="tom Does anyone know a way to do batch requests? Sending a payload in a POST request that contains methods and params/body for subsequent requests to be handled server side. I see running something like ring mock, but I believe that&apos;s for testing purposes primarily."><y>#</y><d>2016-10-28</d><h>20:18</h><w>tom</w>Does anyone know a way to do batch requests? Sending a payload in a POST request that contains methods and params/body for subsequent requests to be handled server side. I see running something like ring mock, but I believe that&apos;s for testing purposes primarily.</z><z id="t1477917563" t="sandbags I need some help with jetty / deploying war files / linux ‚Ä¶ can anyone recommend anyone? It‚Äôs (hopefully) a pretty small gig although I could use some advice around building a proper deployment system."><y>#</y><d>2016-10-31</d><h>12:39</h><w>sandbags</w>I need some help with jetty / deploying war files / linux ‚Ä¶ can anyone recommend anyone? It‚Äôs (hopefully) a pretty small gig although I could use some advice around building a proper deployment system.</z><z id="t1478008261" t="sandbags It‚Äôs been pointed out that my request was ambiguous; I am not looking for free help here but to pay someone experienced to solve our problem. While I don‚Äôt expect its a huge gig I need the problem solved."><y>#</y><d>2016-11-01</d><h>13:51</h><w>sandbags</w>It‚Äôs been pointed out that my request was ambiguous; I am not looking for free help here but to pay someone experienced to solve our problem. While I don‚Äôt expect its a huge gig I need the problem solved.</z><z id="t1478548604" t="sandbags I have a a compojure app that is being deployed to a jetty server running on a linode as an uberwar. I‚Äôm using [:attrs {:href &quot;/_/_/users/U0BKWMG5B&quot;}] environ library to specify database &amp; mandrill configuration etc.. what I can‚Äôt work out is how to specify the configuration in the production environment. I‚Äôm not running java myself to specify environment variables on a command line. Jetty seems to handle war‚Äôs automatically. I don‚Äôt seem to be able to turn up anything relevant via Google which is puzzling me. Is this an unusual way to deploy an app?"><y>#</y><d>2016-11-07</d><h>19:56</h><w>sandbags</w>I have a a compojure app that is being deployed to a jetty server running on a linode as an uberwar. I‚Äôm using <a>@weavejester</a> environ library to specify database &amp; mandrill configuration etc.. what I can‚Äôt work out is how to specify the configuration in the production environment. I‚Äôm not running java myself to specify environment variables on a command line. Jetty seems to handle war‚Äôs automatically. I don‚Äôt seem to be able to turn up anything relevant via Google which is puzzling me. Is this an unusual way to deploy an app?</z><z id="t1478553158" t="roberto I don‚Äôt really like using environ, it has some hiccups for beginners. One of these is that it doesn‚Äôt really offer a clear way to have prod/dev/test environment variables."><y>#</y><d>2016-11-07</d><h>21:12</h><w>roberto</w>I don‚Äôt really like using environ, it has some hiccups for beginners. One of these is that it doesn‚Äôt really offer a clear way to have prod/dev/test environment variables.</z><z id="t1478553182" t="roberto But if you still want to go with environ, what I‚Äôve done in the past is that in production I normally use environment variables."><y>#</y><d>2016-11-07</d><h>21:13</h><w>roberto</w>But if you still want to go with environ, what I‚Äôve done in the past is that in production I normally use environment variables.</z><z id="t1478553225" t="roberto The caveat is that these variables are all strings, while you might have used non-string sin your eviron file during dev. So it might break some things if you don‚Äôt parse the strings in your code."><y>#</y><d>2016-11-07</d><h>21:13</h><w>roberto</w>The caveat is that these variables are all strings, while you might have used non-string sin your eviron file during dev. So it might break some things if you don‚Äôt parse the strings in your code.</z><z id="t1478559731" t="weavejester [:attrs {:href &quot;/_/_/users/U06BDH95J&quot;}] : environ isn‚Äôt a configuration library. It‚Äôs a library for pulling data from the environment. If your production app doesn‚Äôt use environment variables, then environ isn‚Äôt the tool you need."><y>#</y><d>2016-11-07</d><h>23:02</h><w>weavejester</w><a>@sandbags</a>: environ isn‚Äôt a configuration library. It‚Äôs a library for pulling data from the environment. If your production app doesn‚Äôt use environment variables, then environ isn‚Äôt the tool you need.</z><z id="t1478593678" t="sandbags [:attrs {:href &quot;/_/_/users/U0BKWMG5B&quot;}] ah, that‚Äôs my misunderstanding. thank you."><y>#</y><d>2016-11-08</d><h>08:27</h><w>sandbags</w><a>@weavejester</a> ah, that‚Äôs my misunderstanding. thank you.</z><z id="t1478612488" t="ska FWIW, for one of my projects I wrote a very small wrapper around environ which allows me to merge configuration from a file into the already existing environment and system variables picked up by environ. I can configure the file to be read using environment or system variables. üôÇ Works well for me."><y>#</y><d>2016-11-08</d><h>13:41</h><w>ska</w>FWIW, for one of my projects I wrote a very small wrapper around environ which allows me to merge configuration from a file into the already existing environment and system variables picked up by environ.  I can configure the file to be read using environment or system variables. <b>üôÇ</b>  Works well for me.</z><z id="t1479019491" t="seancorfield Anyone using New Relic with their Clojure Ring apps? What sort of setups are you using and what sort of things are you looking for in New Relic?"><y>#</y><d>2016-11-13</d><h>06:44</h><w>seancorfield</w>Anyone using New Relic with their Clojure Ring apps? What sort of setups are you using and what sort of things are you looking for in New Relic?</z><z id="t1479153879" t="sandbags How are people, who are using jetty in production, configuring their applications? I am thinking e.g. database configuration or mandrill configuration. I can find any number of &quot;Clojure web application&quot; guides which sidestep any configuration issues. I feel like I must be missing something essential that speaks to this problem."><y>#</y><d>2016-11-14</d><h>20:04</h><w>sandbags</w>How are people, who are using jetty in production, configuring their applications? I am thinking e.g. database configuration or mandrill configuration. I can find any number of &quot;Clojure web application&quot; guides which sidestep any configuration issues. I feel like I must be missing something essential that speaks to this problem.</z><z id="t1479154574" t="sandbags Deploying a Rails app, e.g. with Capistrano, you had a set of places where you could drop such things. Deploying an app as a war file into, e.g. /usr/share/jetty/webapps there doesn&apos;t seem to be a structure. I was considering whether some kind of plugin could &quot;package&quot; a config file into the war file that could be read at run-time. Feel potentially clunky tho."><y>#</y><d>2016-11-14</d><h>20:16</h><w>sandbags</w>Deploying a Rails app, e.g. with Capistrano, you had a set of places where you could drop such things. Deploying an app as a war file into, e.g. /usr/share/jetty/webapps there doesn&apos;t seem to be a structure. I was considering whether some kind of plugin could &quot;package&quot; a config file into the war file that could be read at run-time. Feel potentially clunky tho.</z><z id="t1479158202" t="seancorfield We have a homegrown configuration library right now but we‚Äôre planning to move to something a bit more standardized (and will probably open source it). We use Component for managing all the startup stuff."><y>#</y><d>2016-11-14</d><h>21:16</h><w>seancorfield</w>We have a homegrown configuration library right now but we‚Äôre planning to move to something a bit more standardized (and will probably open source it). We use Component for managing all the startup stuff.</z><z id="t1479158267" t="seancorfield We start Jetty (or http-kit) as part of that Component startup process."><y>#</y><d>2016-11-14</d><h>21:17</h><w>seancorfield</w>We start Jetty (or http-kit) as part of that Component startup process.</z><z id="t1479158300" t="seancorfield We create an uberjar of our app. We don‚Äôt create a WAR and we don‚Äôt deploy it to a web container."><y>#</y><d>2016-11-14</d><h>21:18</h><w>seancorfield</w>We create an uberjar of our app. We don‚Äôt create a WAR and we don‚Äôt deploy it to a web container.</z><z id="t1479158388" t="seancorfield We will be using an environment variable to tell the app, at startup, where to find the configuration file (which lives on each server, outside the app). Right now we just use a standard location but that won‚Äôt scale as we add more apps."><y>#</y><d>2016-11-14</d><h>21:19</h><w>seancorfield</w>We will be using an environment variable to tell the app, at startup, where to find the configuration file (which lives on each server, outside the app). Right now we just use a standard location but that won‚Äôt scale as we add more apps.</z><z id="t1479160034" t="sandbags [:attrs {:href &quot;/_/_/users/U04V70XH6&quot;}] seems we rock up in a lot of the same places üôÇ"><y>#</y><d>2016-11-14</d><h>21:47</h><w>sandbags</w><a>@seancorfield</a> seems we rock up in a lot of the same places <b>üôÇ</b></z><z id="t1479160072" t="sandbags so you&apos;re running your app through an embedded jetty and using java -jar to start it? (Hence able to use -Denv to configure)?"><y>#</y><d>2016-11-14</d><h>21:47</h><w>sandbags</w>so you&apos;re running your app through an embedded jetty and using java -jar to start it? (Hence able to use -Denv to configure)?</z><z id="t1479160099" t="seancorfield Correct."><y>#</y><d>2016-11-14</d><h>21:48</h><w>seancorfield</w>Correct.</z><z id="t1479160124" t="seancorfield We actually let the app choose Jetty or http-kit at startup based on a command line option (or environment variable)."><y>#</y><d>2016-11-14</d><h>21:48</h><w>seancorfield</w>We actually let the app choose Jetty or http-kit at startup based on a command line option (or environment variable).</z><z id="t1479161612" t="sandbags maybe i should switch to this method... using uberwar seemed simpler but i am baffled as to how one configures such an app"><y>#</y><d>2016-11-14</d><h>22:13</h><w>sandbags</w>maybe i should switch to this method... using uberwar seemed simpler but i am baffled as to how one configures such an app</z><z id="t1479163269" t="seancorfield I think deployment is a lot simpler this way. You can easily control which web server to use, which port to listen on etc. "><y>#</y><d>2016-11-14</d><h>22:41</h><w>seancorfield</w>I think deployment is a lot simpler this way. You can easily control which web server to use, which port to listen on etc. </z><z id="t1479163947" t="sandbags i think you may be right. My ops guy is talking about something called Wildfly, not sure if you&apos;ve come across it"><y>#</y><d>2016-11-14</d><h>22:52</h><w>sandbags</w>i think you may be right. My ops guy is talking about something called Wildfly, not sure if you&apos;ve come across it</z><z id="t1479175056" t="seancorfield I had never heard of it. Bing indicates it&apos;s a modular jee engine for microservices. Not sure what it would take to run Clojure on it. "><y>#</y><d>2016-11-15</d><h>01:57</h><w>seancorfield</w>I had never heard of it. Bing indicates it&apos;s a modular jee engine for microservices. Not sure what it would take to run Clojure on it. </z><z id="t1479175107" t="seancorfield Sounds like you&apos;d probably need war deployment tho for Wildfly? I&apos;d expect it to be like a modular JBoss. "><y>#</y><d>2016-11-15</d><h>01:58</h><w>seancorfield</w>Sounds like you&apos;d probably need war deployment tho for Wildfly? I&apos;d expect it to be like a modular JBoss. </z><z id="t1479226657" t="olegakbarov how can i serve index.html on every request other than /js/ and /css/ paths? (defroutes routes (context &quot;/static&quot; [] (route/resources &quot;/css&quot; {:root &quot;css&quot;}) (route/resources &quot;/js&quot; {:root &quot;js&quot;})) (ANY &quot;*&quot; [] (route/resources &quot;index.html&quot;))) doesn‚Äôt work"><y>#</y><d>2016-11-15</d><h>16:17</h><w>olegakbarov</w>how can i serve index.html on every request other than /js/ and /css/ paths?
<pre>(defroutes routes
  (context &quot;/static&quot; []
    (route/resources &quot;/css&quot; {:root &quot;css&quot;})
    (route/resources &quot;/js&quot; {:root &quot;js&quot;}))
  (ANY &quot;*&quot; []
    (route/resources &quot;index.html&quot;))) 
</pre>
doesn‚Äôt work</z><z id="t1479350929" t="geoffs [:attrs {:href &quot;/_/_/users/U0K9UU4G2&quot;}] : I think your issue is that route/resources doesn&apos;t work how you think it does (assuming that&apos;s an alias for compojure.route ). Check out the documentation here https://weavejester.github.io/compojure/compojure.route.html#var-resources"><y>#</y><d>2016-11-17</d><h>02:48</h><w>geoffs</w><a>@olegakbarov</a>: I think your issue is that <code>route/resources</code> doesn&apos;t work how you think it does (assuming that&apos;s an alias for <code>compojure.route</code>). Check out the documentation here <a href="https://weavejester.github.io/compojure/compojure.route.html#var-resources" target="_blank">https://weavejester.github.io/compojure/compojure.route.html#var-resources</a></z><z id="t1479351049" t="geoffs What you probably want to do instead of resources, is just explicitly load the &quot;index.thml&quot; file and serve it. For instance (ANY &quot;*&quot; [] (ring.util.response/response (slurp (io/resource &quot;index.html&quot;))))"><y>#</y><d>2016-11-17</d><h>02:50</h><w>geoffs</w>What you probably want to do instead of resources, is just explicitly load the &quot;index.thml&quot; file and serve it.  For instance <code>(ANY &quot;*&quot; [] (ring.util.response/response (slurp (io/resource &quot;index.html&quot;))))</code></z><z id="t1479351066" t="geoffs where io is "><y>#</y><d>2016-11-17</d><h>02:51</h><w>geoffs</w>where <code>io</code> is <code></code></z><z id="t1479373299" t="olegakbarov [:attrs {:href &quot;/_/_/users/U051J9UCT&quot;}] thanks, ill give it a try"><y>#</y><d>2016-11-17</d><h>09:01</h><w>olegakbarov</w><a>@geoffs</a> thanks, ill give it a try</z><z id="t1480753401" t="hans Not sure if this is a bug to report in a GitHub issue as async mode is currently unreleased. Thoughts?"><y>#</y><d>2016-12-03</d><h>08:23</h><w>hans</w>Not sure if this is a bug to report in a GitHub issue as async mode is currently unreleased.  Thoughts?</z><z id="t1480753581" t="hans In the sample above, GET requests work as expected, but any POST request hangs: paracetamol 1162_% curl -dxx -vv * Trying ::1... * Connected to localhost (::1) port 3803 (#0) &gt; POST /x HTTP/1.1 &gt; Host: localhost:3803 &gt; User-Agent: curl/7.49.1 &gt; Accept: */* &gt; Content-Length: 2 &gt; Content-Type: application/x-www-form-urlencoded &gt; * upload completely sent off: 2 out of 2 bytes ^C "><y>#</y><d>2016-12-03</d><h>08:26</h><w>hans</w>In the sample above, GET requests work as expected, but any POST request hangs:
<pre>paracetamol 1162_% curl -dxx -vv 
*   Trying ::1...
* Connected to localhost (::1) port 3803 (#0)
&gt; POST /x HTTP/1.1
&gt; Host: localhost:3803
&gt; User-Agent: curl/7.49.1
&gt; Accept: */*
&gt; Content-Length: 2
&gt; Content-Type: application/x-www-form-urlencoded
&gt;
* upload completely sent off: 2 out of 2 bytes
^C
</pre></z><z id="t1480825271" t="bcbradley I just took a web dev class and next semester is my last semester for software engineering. We were taught about server side scripts, CGI, the document object model, servlets, the role of javascript, html and css, and the browser as an application hosting platform, and node.js. We worked heavily with the idea of asynchronous execution both within node.js event loop and in the browser with AJAX. We talked about the traditional view of the web as a means to serve documents in a synchronous fashion, serving the entire page on every request, and how requests are idempotent, but also how the above technologies have sort of moved the web towards something more interactive."><y>#</y><d>2016-12-04</d><h>04:21</h><w>bcbradley</w>I just took a web dev class and next semester is my last semester for software engineering. We were taught about server side scripts, CGI, the document object model, servlets, the role of javascript, html and css, and the browser as an application hosting platform, and node.js. We worked heavily with the idea of asynchronous execution both within node.js event loop and in the browser with AJAX. We talked about the traditional view of the web as a means to serve documents in a synchronous fashion, serving the entire page on every request, and how requests are idempotent, but also how the above technologies have sort of moved the web towards something more interactive.</z><z id="t1480825307" t="bcbradley I was wondering if anyone had any resources for someone at my level that would help me get up to speed with what is considered the &quot;golden standard&quot; for web dev in clojure and clojurescript"><y>#</y><d>2016-12-04</d><h>04:21</h><w>bcbradley</w>I was wondering if anyone had any resources for someone at my level that would help me get up to speed with what is considered the &quot;golden standard&quot; for web dev in clojure and clojurescript</z><z id="t1480825349" t="bcbradley On my own browsing I&apos;ve come to the conclusion that ring seems to be the de-facto standard, but I&apos;m having trouble understanding how and where all the pieces fit together."><y>#</y><d>2016-12-04</d><h>04:22</h><w>bcbradley</w>On my own browsing I&apos;ve come to the conclusion that ring seems to be the de-facto standard, but I&apos;m having trouble understanding how and where all the pieces fit together.</z><z id="t1480845999" t="weavejester There‚Äôs a book, Web Development in Clojure, that covers a lot of the core concepts. There‚Äôs also Luminus, a project template, that includes a tutorial for building a simple guestbook: http://www.luminusweb.net/docs"><y>#</y><d>2016-12-04</d><h>10:06</h><w>weavejester</w>There‚Äôs a book, Web Development in Clojure, that covers a lot of the core concepts. There‚Äôs also Luminus, a project template, that includes a tutorial for building a simple guestbook: <a href="http://www.luminusweb.net/docs" target="_blank">http://www.luminusweb.net/docs</a></z><z id="t1480846099" t="weavejester Is there anything specific you had trouble understanding, [:attrs {:href &quot;/_/_/users/U1ACUMJKX&quot;}] ?"><y>#</y><d>2016-12-04</d><h>10:08</h><w>weavejester</w>Is there anything specific you had trouble understanding, <a>@bcbradley</a>?</z><z id="t1480850153" t="bcbradley [:attrs {:href &quot;/_/_/users/U0BKWMG5B&quot;}] I just needed some direction first, so that I&apos;ll have the chance to have trouble understanding the things I ought to be trying to understand, rather than spin my wheels on things that aren&apos;t crucial"><y>#</y><d>2016-12-04</d><h>11:15</h><w>bcbradley</w><a>@weavejester</a> I just needed some direction first, so that I&apos;ll have the chance to have trouble understanding the things I ought to be trying to understand, rather than spin my wheels on things that aren&apos;t crucial</z><z id="t1480856638" t="weavejester [:attrs {:href &quot;/_/_/users/U1ACUMJKX&quot;}] , the Luminus tutorial might be a good place to start in that case."><y>#</y><d>2016-12-04</d><h>13:03</h><w>weavejester</w><a>@bcbradley</a>, the Luminus tutorial might be a good place to start in that case.</z><z id="t1480880965" t="joshkh Maybe someone can help me understand a (probably basic) problem I&apos;m having with ring? I&apos;m attempting to send a file in a response that&apos;s read from disk (io/file &quot;something.pdf&quot;) and I&apos;d like to delete it after the file has been sent, but obviously io/delete-file within the (response...) form deletes the file before its sent . Is the right place to be looking?"><y>#</y><d>2016-12-04</d><h>19:49</h><w>joshkh</w>Maybe someone can help me understand a (probably basic) problem I&apos;m having with ring? I&apos;m attempting to send a file in a response that&apos;s read from disk <code>(io/file &quot;something.pdf&quot;)</code> and I&apos;d like to delete it after the file has been sent, but obviously <code>io/delete-file</code> within the <code>(response...)</code> form deletes the file before its sent . Is <code></code> the right place to be looking?</z><z id="t1480882749" t="weavejester [:attrs {:href &quot;/_/_/users/U0H46T23C&quot;}] You can use piped-input-stream . io/copy the file to the output stream, then delete the file."><y>#</y><d>2016-12-04</d><h>20:19</h><w>weavejester</w><a>@rodeorockstar</a> You can use <code>piped-input-stream</code>. <code>io/copy</code> the file to the output stream, then delete the file.</z><z id="t1480882952" t="joshkh Ah, thanks!"><y>#</y><d>2016-12-04</d><h>20:22</h><w>joshkh</w>Ah, thanks!</z><z id="t1481097668" t="niwinz [:attrs {:href &quot;/_/_/users/U0BKWMG5B&quot;}] hi, I have readed a little bit the ring 1.6 async support and I have a question: why the async handlers has two callbacks, one for continue and the other for raise. There are some rationale for this?, I think that it can be simplified just to one callback called next and capture error by the type. In fact, the handling of the value passed to the next callback can be handled using protocols, so allowing to the user define its own behavior..."><y>#</y><d>2016-12-07</d><h>08:01</h><w>niwinz</w><a>@weavejester</a> hi, I have readed a little bit the ring 1.6 async support and I have a question: why the async handlers has two callbacks, one for continue and the other for raise. There are some rationale for this?, I think that it can be simplified just to one callback called <code>next</code> and capture error by the type. In fact, the handling of the value passed to the <code>next</code> callback can be handled using protocols, so allowing to the user define its own behavior...</z><z id="t1481099357" t="hans [:attrs {:href &quot;/_/_/users/U06B73YQJ&quot;}] I like having error handling and normal control flow separated. It makes the code clearer as handlers and middlewares don&apos;t have to dispatch first (all of them would have to do it)."><y>#</y><d>2016-12-07</d><h>08:29</h><w>hans</w><a>@niwinz</a> I like having error handling and normal control flow separated.  It makes the code clearer as handlers and middlewares don&apos;t have to dispatch first (all of them would have to do it).</z><z id="t1481145705" t="weavejester [:attrs {:href &quot;/_/_/users/U06B73YQJ&quot;}] We have respond and raise for much the same reason that we distinguish between the return value and throw . In theory we could return exceptions instead of throwing them, and then dispatch on the type of the return value. In practice, it‚Äôs useful to ‚Äúshort-circuit‚Äù instead, and allow exceptions to bypass the normal return value mechanism."><y>#</y><d>2016-12-07</d><h>21:21</h><w>weavejester</w><a>@niwinz</a> We have <code>respond</code> and <code>raise</code> for much the same reason that we distinguish between the return value and <code>throw</code>. In theory we could return exceptions instead of throwing them, and then dispatch on the type of the return value. In practice, it‚Äôs useful to ‚Äúshort-circuit‚Äù instead, and allow exceptions to bypass the normal return value mechanism.</z><z id="t1481145840" t="weavejester If respond also returned exceptions, then we‚Äôd have to check the type at each middleware function. Since asynchronous handlers are a performance optimisation, we ideally want a performant implementation. raise allows us to skip the normal processing steps in the same way that throw does."><y>#</y><d>2016-12-07</d><h>21:24</h><w>weavejester</w>If <code>respond</code> also returned exceptions, then we‚Äôd have to check the type at each middleware function. Since asynchronous handlers are a performance optimisation, we ideally want a performant implementation. <code>raise</code> allows us to skip the normal processing steps in the same way that <code>throw</code> does.</z><z id="t1481147893" t="niwinz [:attrs {:href &quot;/_/_/users/U0BKWMG5B&quot;}] thanks for the explanation, that makes sense üòâ"><y>#</y><d>2016-12-07</d><h>21:58</h><w>niwinz</w><a>@weavejester</a> thanks for the explanation, that makes sense <b>üòâ</b></z><z id="t1481612990" t="tgk One thing that has always been a bit of a sore point for me in Clojure web development is how to handle parameter validation and sequential execution in general. For example, in Rails it‚Äôs trivial to terminate control flow early if parameters are invalid, if the current user is not authorised to perform the operation she attempts, etc. In Clojure this can be done using nested conditionals but that gets convoluted quite quickly."><y>#</y><d>2016-12-13</d><h>07:09</h><w>tgk</w>One thing that has always been a bit of a sore point for me in Clojure web development is how to handle parameter validation and sequential execution in general. For example, in Rails it‚Äôs trivial to terminate control flow early if parameters are invalid, if the current user is not authorised to perform the operation she attempts, etc. In Clojure this can be done using nested conditionals but that gets convoluted quite quickly.</z><z id="t1481613093" t="tgk I‚Äôve used a technique similar to monads/ring handlers in which a handler is wrapped with the steps that we go through such that we can terminate at any given point. For example wrap-check-params returns a handler that will check if the needed parameters are there and on the right format before calling the next handler in the stack. If they are not, it will return an appropriate HTTP status code."><y>#</y><d>2016-12-13</d><h>07:11</h><w>tgk</w>I‚Äôve used a technique similar to monads/ring handlers in which a handler is wrapped with the steps that we go through such that we can terminate at any given point. For example <code>wrap-check-params</code> returns a handler that will check if the needed parameters are there and on the right format before calling the next handler in the stack. If they are not, it will return an appropriate HTTP status code.</z><z id="t1481613128" t="tgk This works but I can‚Äôt help but feel there might be a better solution out there somewhere. Is there something I‚Äôm missing? Some amazing technique that I just haven‚Äôt stumbled upon?"><y>#</y><d>2016-12-13</d><h>07:12</h><w>tgk</w>This works but I can‚Äôt help but feel there might be a better solution out there somewhere. Is there something I‚Äôm missing? Some amazing technique that I just haven‚Äôt stumbled upon?</z><z id="t1481613642" t="seancorfield [:attrs {:href &quot;/_/_/users/U060Q0J8M&quot;}] take a look at clojure.spec -- that&apos;s what we&apos;re using now for parameter validation in web apps."><y>#</y><d>2016-12-13</d><h>07:20</h><w>seancorfield</w><a>@tgk</a> take a look at <code>clojure.spec</code> -- that&apos;s what we&apos;re using now for parameter validation in web apps.</z><z id="t1481613710" t="tgk [:attrs {:href &quot;/_/_/users/U04V70XH6&quot;}] : thanks, we‚Äôre already using clojure.spec . It‚Äôs a great tool but it doesn‚Äôt solve the control flow problem."><y>#</y><d>2016-12-13</d><h>07:21</h><w>tgk</w><a>@seancorfield</a>: thanks, we‚Äôre already using <code>clojure.spec</code>. It‚Äôs a great tool but it doesn‚Äôt solve the control flow problem.</z><z id="t1481613761" t="seancorfield (let [params (s/conform ::my-arg-spec (:params req))] (if (s/invalid? params) ...explain-data and report error... (do-stuff-with params))) You don&apos;t like that?"><y>#</y><d>2016-12-13</d><h>07:22</h><w>seancorfield</w><pre>(let [params (s/conform ::my-arg-spec (:params req))]
  (if (s/invalid? params)
    ...explain-data and report error...
    (do-stuff-with params)))</pre> You don&apos;t like that?</z><z id="t1481613799" t="tgk Exactly. Because often do-stuff-with will contain a new conditional and so on and so on."><y>#</y><d>2016-12-13</d><h>07:23</h><w>tgk</w>Exactly. Because often <code>do-stuff-with</code> will contain a new conditional and so on and so on.</z><z id="t1481613822" t="tgk Parameters were just an example of a conditional branch that incurs a new nesting point."><y>#</y><d>2016-12-13</d><h>07:23</h><w>tgk</w>Parameters were just an example of a conditional branch that incurs a new nesting point.</z><z id="t1481613843" t="seancorfield Ah, because you need to check more than just the shape of the params? You need to check their values too, such as unique username or valid password or such?"><y>#</y><d>2016-12-13</d><h>07:24</h><w>seancorfield</w>Ah, because you need to check more than just the shape of the params? You need to check their values too, such as unique username or valid password or such?</z><z id="t1481613868" t="tgk Sure, or I need to look up data based on the parameters and check that the current user has the right to manipulate the data"><y>#</y><d>2016-12-13</d><h>07:24</h><w>tgk</w>Sure, or I need to look up data based on the parameters and check that the current user has the right to manipulate the data</z><z id="t1481613883" t="tgk In general, I just need to break execution at any given point"><y>#</y><d>2016-12-13</d><h>07:24</h><w>tgk</w>In general, I just need to break execution at any given point</z><z id="t1481613894" t="seancorfield I generally find a simple cond works in most cases so it doesn&apos;t get very nested..."><y>#</y><d>2016-12-13</d><h>07:24</h><w>seancorfield</w>I generally find a simple <code>cond</code> works in most cases so it doesn&apos;t get very nested...</z><z id="t1481613906" t="seancorfield ...but, sure, sometimes your control logic is inherently complex."><y>#</y><d>2016-12-13</d><h>07:25</h><w>seancorfield</w>...but, sure, sometimes your control logic is inherently complex.</z><z id="t1481613922" t="seancorfield That should be fairly rare tho&apos; really...?"><y>#</y><d>2016-12-13</d><h>07:25</h><w>seancorfield</w>That should be fairly rare tho&apos; really...?</z><z id="t1481613933" t="tgk Ah, alright. I can see how that can collapse it a bit."><y>#</y><d>2016-12-13</d><h>07:25</h><w>tgk</w>Ah, alright. I can see how that can collapse it a bit.</z><z id="t1481613964" t="tgk I hadn‚Äôt though about that being a sequential execution but I guess you could use it as such in many cases. I‚Äôll give that a try!"><y>#</y><d>2016-12-13</d><h>07:26</h><w>tgk</w>I hadn‚Äôt though about that being a sequential execution but I guess you could use it as such in many cases. I‚Äôll give that a try!</z><z id="t1481613984" t="seancorfield The other thing to consider is a variant of cond-&gt; that threads the value (the req ) through the predicates as well. We call that condp-&gt; (and we have a condp-&gt;&gt; macro as well)."><y>#</y><d>2016-12-13</d><h>07:26</h><w>seancorfield</w>The other thing to consider is a variant of <code>cond-&gt;</code> that threads the value (the <code>req</code>) through the predicates as well. We call that <code>condp-&gt;</code> (and we have a <code>condp-&gt;&gt;</code> macro as well).</z><z id="t1481614873" t="tgk Hmm yes. I can never figure out if I ever grow fond of that form but maybe it‚Äôs time to revisit it!"><y>#</y><d>2016-12-13</d><h>07:41</h><w>tgk</w>Hmm yes. I can never figure out if I ever grow fond of that form but maybe it‚Äôs time to revisit it!</z><z id="t1482362264" t="liamd what do i need to add to my project clj to use the multipart-params middleware"><y>#</y><d>2016-12-21</d><h>23:17</h><w>liamd</w>what do i need to add to my project clj to use the multipart-params middleware</z><z id="t1482362865" t="seancorfield Just ring itself, I think."><y>#</y><d>2016-12-21</d><h>23:27</h><w>seancorfield</w>Just <code>ring</code> itself, I think.</z><z id="t1482362998" t="seancorfield So [ring ‚Äú1.5.0‚Äù] or [ring/ring-core ‚Äú1.5.0‚Äù] since it‚Äôs all part of the ring-core project: https://github.com/ring-clojure/ring/tree/master/ring-core/src/ring/middleware"><y>#</y><d>2016-12-21</d><h>23:29</h><w>seancorfield</w>So <code>[ring ‚Äú1.5.0‚Äù]</code> or <code>[ring/ring-core ‚Äú1.5.0‚Äù]</code> since it‚Äôs all part of the <code>ring-core</code> project: <a href="https://github.com/ring-clojure/ring/tree/master/ring-core/src/ring/middleware" target="_blank">https://github.com/ring-clojure/ring/tree/master/ring-core/src/ring/middleware</a></z><z id="t1482363130" t="seancorfield Are there any ports of Ring to other languages? I know Ring itself is inspired by libraries in other languages (Python‚Äôs WSGI and Ruby‚Äôs Rack, per the README) but I wondered if Ring had spread elsewhere?"><y>#</y><d>2016-12-21</d><h>23:32</h><w>seancorfield</w>Are there any ports of Ring to other languages? I know Ring itself is inspired by libraries in other languages (Python‚Äôs WSGI and Ruby‚Äôs Rack, per the README) but I wondered if Ring had spread elsewhere?</z><z id="t1482369526" t="weavejester Macchiato implements Ring in ClojureScript. Other than that, I don‚Äôt believe there‚Äôs any other implementation."><y>#</y><d>2016-12-22</d><h>01:18</h><w>weavejester</w>Macchiato implements Ring in ClojureScript. Other than that, I don‚Äôt believe there‚Äôs any other implementation.</z><z id="t1482370385" t="seancorfield [:attrs {:href &quot;/_/_/users/U0BKWMG5B&quot;}] As a fun experiment for the holidays, I‚Äôve ported it to CFML (ColdFusion): https://github.com/seancorfield/ring-cfml"><y>#</y><d>2016-12-22</d><h>01:33</h><w>seancorfield</w><a>@weavejester</a> As a fun experiment for the holidays, I‚Äôve ported it to CFML (ColdFusion): <a href="https://github.com/seancorfield/ring-cfml" target="_blank">https://github.com/seancorfield/ring-cfml</a></z><z id="t1482370612" t="seancorfield This is after I decided my port of FW/1 from CFML to Clojure ( https://github.com/framework-one/fw1-clj ) was not worth continuing since it wasn‚Äôt buying me much beyond Ring + Compojure + Component + Selmer (the four libraries it wrapped up) ‚Äî despite it being one of the two most popular CFML frameworks (I originally created it back in 2009 for CFML and ported it to Clojure starting in 2011)."><y>#</y><d>2016-12-22</d><h>01:36</h><w>seancorfield</w>This is after I decided my port of FW/1 from CFML to Clojure (<a href="https://github.com/framework-one/fw1-clj" target="_blank">https://github.com/framework-one/fw1-clj</a>) was not worth continuing since it wasn‚Äôt buying me much beyond Ring + Compojure + Component + Selmer (the four libraries it wrapped up) ‚Äî despite it being one of the two most popular CFML frameworks (I originally created it back in 2009 for CFML and ported it to Clojure starting in 2011).</z><z id="t1482875620" t="petr.mensik Hey guys, I&apos;ve got a problem with packaging ring application, everything works fine when I run it with lein ring server however it fails to compile with message port ring.util.response/find-header, try updating to Ring 1.5.0+ when I run lein ring uberwar . Relevant deps are [ring 1.5.0.] and [metosin/compojure-api &quot;1.2.0-alpha1&quot;] . Any idea what could be wrong (tried to dig into it for some time but I don&apos;t really know since the dependency is there)? Thanks a lot"><y>#</y><d>2016-12-27</d><h>21:53</h><w>petr.mensik</w>Hey guys, I&apos;ve got a problem with packaging ring application, everything works fine when I run it with <code>lein ring server</code> however it fails to compile with message <code>port ring.util.response/find-header, try updating to Ring 1.5.0+</code> when I run <code>lein ring uberwar</code>. Relevant deps are <code>[ring 1.5.0.]</code> and <code>[metosin/compojure-api &quot;1.2.0-alpha1&quot;]</code>. Any idea what could be wrong (tried to dig into it for some time but I don&apos;t really know since the dependency is there)? Thanks a lot</z><z id="t1482875877" t="seancorfield Does lein deps :tree show multiple versions of ring-core being pulled in, perhaps?"><y>#</y><d>2016-12-27</d><h>21:57</h><w>seancorfield</w>Does <code>lein deps :tree</code> show multiple versions of <code>ring-core</code> being pulled in, perhaps?</z><z id="t1482876098" t="seancorfield The error is from compojure-api and seems to date back to 0.7.0 https://github.com/metosin/ring-http-response/commit/43673745a71e0608bc5696318e9d00acfdba0f5c ‚Äî so it thinks you have an older version of Ring being pulled into your dependencies (or perhaps the dependency is missing altogether in that profile?)."><y>#</y><d>2016-12-27</d><h>22:01</h><w>seancorfield</w>The error is from compojure-api and seems to date back to 0.7.0 <a href="https://github.com/metosin/ring-http-response/commit/43673745a71e0608bc5696318e9d00acfdba0f5c" target="_blank">https://github.com/metosin/ring-http-response/commit/43673745a71e0608bc5696318e9d00acfdba0f5c</a> ‚Äî so it thinks you have an older version of Ring being pulled into your dependencies (or perhaps the dependency is missing altogether in that profile?).</z><z id="t1482876239" t="petr.mensik I am doing everything under dev so this should be fine. Seems like there is an older version on the classpath but I am importing the ring in dependencies section and lein deps :tree | grep ring doesn&apos;t show anything suspicious"><y>#</y><d>2016-12-27</d><h>22:03</h><w>petr.mensik</w>I am doing everything under <code>dev</code> so this should be fine. Seems like there is an older version on the classpath but I am importing the ring in dependencies section and <code>lein deps :tree | grep ring</code> doesn&apos;t show anything suspicious</z><z id="t1482876299" t="petr.mensik maybe just that compojure api has [metosin/ring-http-response &quot;0.8.0&quot;] but that is a correct version with aforementioned function I suppose"><y>#</y><d>2016-12-27</d><h>22:04</h><w>petr.mensik</w>maybe just that compojure api has <code>[metosin/ring-http-response &quot;0.8.0&quot;]</code> but that is a correct version with aforementioned function I suppose</z><z id="t1482935221" t="ikitommi lein-ring pushes it&apos;s deps first when packaging jars, so if it uses older version of ring, it overrides the project settings. 0.10.0 uses the 1.5.0 ( https://github.com/weavejester/lein-ring/commit/21a99e9cabec94cfd840b0e3c8e105f87ffd7f81 )"><y>#</y><d>2016-12-28</d><h>14:27</h><w>ikitommi</w>lein-ring pushes it&apos;s deps first when packaging jars, so if it uses older version of ring, it overrides the project settings. 0.10.0 uses the 1.5.0 (<a href="https://github.com/weavejester/lein-ring/commit/21a99e9cabec94cfd840b0e3c8e105f87ffd7f81" target="_blank">https://github.com/weavejester/lein-ring/commit/21a99e9cabec94cfd840b0e3c8e105f87ffd7f81</a>)</z><z id="t1482935279" t="ikitommi So :plugins [[lein-ring &quot;0.10.0&quot;]] should help"><y>#</y><d>2016-12-28</d><h>14:27</h><w>ikitommi</w>So <code>:plugins [[lein-ring &quot;0.10.0&quot;]]</code> should help</z><z id="t1482944911" t="seancorfield Does that mean you can‚Äôt use lein-ring with the 1.6 alphas?"><y>#</y><d>2016-12-28</d><h>17:08</h><w>seancorfield</w>Does that mean you can‚Äôt use <code>lein-ring</code> with the 1.6 alphas?</z><z id="t1482954172" t="petr.mensik [:attrs {:href &quot;/_/_/users/U055NJ5CC&quot;}] Actually I am using [ring &quot;1.5.0&quot;] and also 0.10.0 version of the plugin so it should be fine - however result is still the same"><y>#</y><d>2016-12-28</d><h>19:42</h><w>petr.mensik</w><a>@ikitommi</a> Actually I am using <code>[ring &quot;1.5.0&quot;]</code> and also 0.10.0 version of the plugin so it should be fine - however result is still the same</z><z id="t1482954297" t="petr.mensik This is my project.clj https://pastebin.com/Zr8SdEqJ"><y>#</y><d>2016-12-28</d><h>19:44</h><w>petr.mensik</w>This is my project.clj <a href="https://pastebin.com/Zr8SdEqJ" target="_blank">https://pastebin.com/Zr8SdEqJ</a></z><z id="t1482959752" t="seancorfield [:attrs {:href &quot;/_/_/users/U3H4PBCLE&quot;}] with a minimal src/veit/handler.clj file to allow lein ring uberwar to run, these are the ring -related libraries that get pulled into the war file for me: 4079 Wed Dec 28 13:14:06 PST 2016 WEB-INF/lib/ring-session-timeout-0.1.0.jar 4997 Wed Dec 28 13:14:06 PST 2016 WEB-INF/lib/ring-servlet-1.5.0.jar 6181 Wed Dec 28 13:14:06 PST 2016 WEB-INF/lib/ring-headers-0.1.1.jar 5370 Wed Dec 28 13:14:06 PST 2016 WEB-INF/lib/ring-ssl-0.2.1.jar 5337 Wed Dec 28 13:14:06 PST 2016 WEB-INF/lib/ring-codec-1.0.1.jar 5199 Wed Dec 28 13:14:06 PST 2016 WEB-INF/lib/ring-jetty-adapter-1.5.0.jar 14322 Wed Dec 28 13:14:06 PST 2016 WEB-INF/lib/ring-middleware-format-0.5.0.jar 6732 Wed Dec 28 13:14:08 PST 2016 WEB-INF/lib/ring-defaults-0.1.2.jar 4969 Wed Dec 28 13:14:08 PST 2016 WEB-INF/lib/ring-1.5.0.jar 6089 Wed Dec 28 13:14:08 PST 2016 WEB-INF/lib/ring-anti-forgery-1.0.0.jar 29212 Wed Dec 28 13:14:08 PST 2016 WEB-INF/lib/ring-core-1.5.0.jar 20794 Wed Dec 28 13:14:08 PST 2016 WEB-INF/lib/ring-http-response-0.8.0.jar 956459 Wed Dec 28 13:14:08 PST 2016 WEB-INF/lib/ring-swagger-ui-2.2.5-0.jar 9549 Wed Dec 28 13:14:08 PST 2016 WEB-INF/lib/ring-devel-1.5.0.jar 36757 Wed Dec 28 13:14:08 PST 2016 WEB-INF/lib/ring-swagger-0.22.12.jar "><y>#</y><d>2016-12-28</d><h>21:15</h><w>seancorfield</w><a>@petr.mensik</a> with a minimal <code>src/veit/handler.clj</code> file to allow <code>lein ring uberwar</code> to run, these are the <code>ring</code>-related libraries that get pulled into the <code>war</code> file for me: <pre>4079 Wed Dec 28 13:14:06 PST 2016 WEB-INF/lib/ring-session-timeout-0.1.0.jar
  4997 Wed Dec 28 13:14:06 PST 2016 WEB-INF/lib/ring-servlet-1.5.0.jar
  6181 Wed Dec 28 13:14:06 PST 2016 WEB-INF/lib/ring-headers-0.1.1.jar
  5370 Wed Dec 28 13:14:06 PST 2016 WEB-INF/lib/ring-ssl-0.2.1.jar
  5337 Wed Dec 28 13:14:06 PST 2016 WEB-INF/lib/ring-codec-1.0.1.jar
  5199 Wed Dec 28 13:14:06 PST 2016 WEB-INF/lib/ring-jetty-adapter-1.5.0.jar
 14322 Wed Dec 28 13:14:06 PST 2016 WEB-INF/lib/ring-middleware-format-0.5.0.jar
  6732 Wed Dec 28 13:14:08 PST 2016 WEB-INF/lib/ring-defaults-0.1.2.jar
  4969 Wed Dec 28 13:14:08 PST 2016 WEB-INF/lib/ring-1.5.0.jar
  6089 Wed Dec 28 13:14:08 PST 2016 WEB-INF/lib/ring-anti-forgery-1.0.0.jar
 29212 Wed Dec 28 13:14:08 PST 2016 WEB-INF/lib/ring-core-1.5.0.jar
 20794 Wed Dec 28 13:14:08 PST 2016 WEB-INF/lib/ring-http-response-0.8.0.jar
956459 Wed Dec 28 13:14:08 PST 2016 WEB-INF/lib/ring-swagger-ui-2.2.5-0.jar
  9549 Wed Dec 28 13:14:08 PST 2016 WEB-INF/lib/ring-devel-1.5.0.jar
 36757 Wed Dec 28 13:14:08 PST 2016 WEB-INF/lib/ring-swagger-0.22.12.jar
</pre></z><z id="t1482959784" t="seancorfield could you run jar tvf target/veit-is.war | fgrep ring and confirm that‚Äôs what you get too?"><y>#</y><d>2016-12-28</d><h>21:16</h><w>seancorfield</w>could you run <code>jar tvf target/veit-is.war | fgrep ring</code> and confirm that‚Äôs what you get too?</z><z id="t1483031904" t="petr.mensik [:attrs {:href &quot;/_/_/users/U04V70XH6&quot;}] yes, it&apos;s the same for me with minimal project - but I am not still not sure how to fix it for my original project"><y>#</y><d>2016-12-29</d><h>17:18</h><w>petr.mensik</w><a>@seancorfield</a>  yes, it&apos;s the same for me with minimal project - but I am not still not sure how to fix it for my original project</z><z id="t1483032164" t="petr.mensik btw it worked with https://github.com/weavejester/ring-server (btw what is the relation between those two?)"><y>#</y><d>2016-12-29</d><h>17:22</h><w>petr.mensik</w>btw it worked with <a href="https://github.com/weavejester/ring-server" target="_blank">https://github.com/weavejester/ring-server</a> (btw what is the relation between those two?)</z><z id="t1483032722" t="seancorfield Sorry, I don‚Äôt use ring-server or the ring plugin for Leiningen so I don‚Äôt have any further suggestions. I just start a web server directly in my app (either Jetty via the adapter, or http-kit)."><y>#</y><d>2016-12-29</d><h>17:32</h><w>seancorfield</w>Sorry, I don‚Äôt use <code>ring-server</code> or the <code>ring</code> plugin for Leiningen so I don‚Äôt have any further suggestions. I just start a web server directly in my app (either Jetty via the adapter, or http-kit).</z><z id="t1483033092" t="petr.mensik I deleted ring-server dependency from the project I posted here. So current state is that I am using ring 1.5.0 and lein-ring 0.10.0 and I am still getting the http-response error"><y>#</y><d>2016-12-29</d><h>17:38</h><w>petr.mensik</w>I deleted ring-server dependency from the project I posted here. So current state is that I am using ring 1.5.0 and lein-ring 0.10.0 and I am still getting the http-response error</z><z id="t1483033132" t="petr.mensik Basically what I have stated above. Anyway, thanks for help"><y>#</y><d>2016-12-29</d><h>17:38</h><w>petr.mensik</w>Basically what I have stated above. Anyway, thanks for help</z><z id="t1483033836" t="petr.mensik Ok, it works when I add [metosin/ring-http-response &quot;0.8.0&quot;] dependency but I would expect to be there by default"><y>#</y><d>2016-12-29</d><h>17:50</h><w>petr.mensik</w>Ok, it works when I add <code>[metosin/ring-http-response &quot;0.8.0&quot;]</code> dependency but I would expect to be there by default</z><z id="t1483035168" t="seancorfield Looks like it comes in as a transitive dep of [metosin/compojure-api ‚Äú1.2.0-alpha1‚Äù] so I would also expect that to be fine. shrug"><y>#</y><d>2016-12-29</d><h>18:12</h><w>seancorfield</w>Looks like it comes in as a transitive dep of <code>[metosin/compojure-api ‚Äú1.2.0-alpha1‚Äù]</code> so I would also expect that to be fine. shrug</z><z id="t1484076284" t="sova-soars-the-sora Hi. I am working on a cljs project. Figwheel runs it Awesomely. I want to make sure I can deploy this to my remote server when i&apos;m all done, so I&apos;m making sure lein ring uberjar works as expected"><y>#</y><d>2017-01-10</d><h>19:24</h><w>sova-soars-the-sora</w>Hi.  I am working on a cljs project.  Figwheel runs it Awesomely.  I want to make sure I can deploy this to my remote server when i&apos;m all done, so I&apos;m making sure <code>lein ring uberjar</code> works as expected</z><z id="t1484076320" t="sova-soars-the-sora However, when I make an uberjar and try java -jar target/nf-0.0.2-standalone.jar ... the server does start but accessing the root url gives the following error:"><y>#</y><d>2017-01-10</d><h>19:25</h><w>sova-soars-the-sora</w>However, when I make an uberjar and try <code>java -jar target/nf-0.0.2-standalone.jar</code> ... the server does start but accessing the root url gives the following error:</z><z id="t1484076324" t="sova-soars-the-sora &quot;Problem accessing /. Reason: java.lang.NullPointerException&quot;"><y>#</y><d>2017-01-10</d><h>19:25</h><w>sova-soars-the-sora</w>&quot;Problem accessing /. Reason:

    java.lang.NullPointerException&quot;</z><z id="t1484076356" t="sova-soars-the-sora So I get a 500 response and I don&apos;t know why."><y>#</y><d>2017-01-10</d><h>19:25</h><w>sova-soars-the-sora</w>So I get a 500 response and I don&apos;t know why.</z><z id="t1484076376" t="sova-soars-the-sora My :figwheel line in my &gt;project.clj"><y>#</y><d>2017-01-10</d><h>19:26</h><w>sova-soars-the-sora</w>My :figwheel line in my &gt;project.clj</z><z id="t1484076383" t="sova-soars-the-sora looks like :figwheel {:ring-handler nf.core/handler}"><y>#</y><d>2017-01-10</d><h>19:26</h><w>sova-soars-the-sora</w>looks like   :figwheel {:ring-handler nf.core/handler}</z><z id="t1484076392" t="sova-soars-the-sora and my :ring line looks very similar..."><y>#</y><d>2017-01-10</d><h>19:26</h><w>sova-soars-the-sora</w>and my :ring line looks very similar...</z><z id="t1484076398" t="sova-soars-the-sora :ring {:handler nf.core/handler :port 8440}"><y>#</y><d>2017-01-10</d><h>19:26</h><w>sova-soars-the-sora</w>:ring {:handler nf.core/handler
         :port 8440}</z><z id="t1484076419" t="sova-soars-the-sora but the lein ring uberjar ... no dice ... lil help?"><y>#</y><d>2017-01-10</d><h>19:26</h><w>sova-soars-the-sora</w>but the <code>lein ring uberjar</code> ... no dice  ... lil help?</z><z id="t1484076686" t="weavejester sova: How are you compiling your production cljs code? cljsbuild?"><y>#</y><d>2017-01-10</d><h>19:31</h><w>weavejester</w>sova: How are you compiling your production cljs code? cljsbuild?</z><z id="t1484077270" t="sova-soars-the-sora [:attrs {:href &quot;/_/_/users/U0BKWMG5B&quot;}] I totally forgot about that step."><y>#</y><d>2017-01-10</d><h>19:41</h><w>sova-soars-the-sora</w><a>@weavejester</a> I totally forgot about that step.</z><z id="t1484077296" t="sova-soars-the-sora I just tried lein cljsbuild once but I still get the same error after packing up the uberjar..."><y>#</y><d>2017-01-10</d><h>19:41</h><w>sova-soars-the-sora</w>I just tried <code>lein cljsbuild once</code> but I still get the same error after packing up the uberjar...</z><z id="t1484077340" t="weavejester You need to have a :cljsbuild key in your project file, and you need to build your JS as part of your compilation."><y>#</y><d>2017-01-10</d><h>19:42</h><w>weavejester</w>You need to have a <code>:cljsbuild</code> key in your project file, and you need to build your JS as part of your compilation.</z><z id="t1484077347" t="weavejester Let me dig out an example"><y>#</y><d>2017-01-10</d><h>19:42</h><w>weavejester</w>Let me dig out an example</z><z id="t1484077406" t="weavejester Ah, give me a few minutes."><y>#</y><d>2017-01-10</d><h>19:43</h><w>weavejester</w>Ah, give me a few minutes.</z><z id="t1484077411" t="sova-soars-the-sora Okay no stress. Thanks a lot"><y>#</y><d>2017-01-10</d><h>19:43</h><w>sova-soars-the-sora</w>Okay no stress. Thanks a lot</z><z id="t1484077419" t="sova-soars-the-sora I have a pretty good idea of what that looks like.."><y>#</y><d>2017-01-10</d><h>19:43</h><w>sova-soars-the-sora</w>I have a pretty good idea of what that looks like..</z><z id="t1484077422" t="sova-soars-the-sora based on.."><y>#</y><d>2017-01-10</d><h>19:43</h><w>sova-soars-the-sora</w>based on..</z><z id="t1484077429" t="sova-soars-the-sora https://github.com/hlolli/om-next-template/blob/master/project.clj"><y>#</y><d>2017-01-10</d><h>19:43</h><w>sova-soars-the-sora</w><a href="https://github.com/hlolli/om-next-template/blob/master/project.clj" target="_blank">https://github.com/hlolli/om-next-template/blob/master/project.clj</a></z><z id="t1484077462" t="sova-soars-the-sora it&apos;s great because everything loads perfectly with lein figwheel but i&apos;m losing something in translation.."><y>#</y><d>2017-01-10</d><h>19:44</h><w>sova-soars-the-sora</w>it&apos;s great because everything loads perfectly with <code>lein figwheel</code> but i&apos;m losing something in translation..</z><z id="t1484078334" t="sova-soars-the-sora [:attrs {:href &quot;/_/_/users/U0BKWMG5B&quot;}] hey it works now"><y>#</y><d>2017-01-10</d><h>19:58</h><w>sova-soars-the-sora</w><a>@weavejester</a> hey it works now</z><z id="t1484078340" t="sova-soars-the-sora thanks for your good juju haha"><y>#</y><d>2017-01-10</d><h>19:59</h><w>sova-soars-the-sora</w>thanks for your good juju haha</z><z id="t1484078358" t="sova-soars-the-sora (by the way, thanks a lot for ring and all the awesome work you do, i&apos;m a big fan.)"><y>#</y><d>2017-01-10</d><h>19:59</h><w>sova-soars-the-sora</w>(by the way, thanks a lot for ring and all the awesome work you do, i&apos;m a big fan.)</z><z id="t1484078364" t="weavejester Sorry for the delay. Do you have keys like:"><y>#</y><d>2017-01-10</d><h>19:59</h><w>weavejester</w>Sorry for the delay. Do you have keys like:</z><z id="t1484078371" t="weavejester :resource-paths [&quot;resources&quot; &quot;target/cljsbuild&quot;] :prep-tasks [[&quot;javac&quot;] [&quot;cljsbuild&quot; &quot;once&quot;] [‚Äùcompile&quot;]] "><y>#</y><d>2017-01-10</d><h>19:59</h><w>weavejester</w><pre>:resource-paths [&quot;resources&quot; &quot;target/cljsbuild&quot;]
  :prep-tasks [[&quot;javac&quot;] [&quot;cljsbuild&quot; &quot;once&quot;] [‚Äùcompile&quot;]]
</pre></z><z id="t1484078413" t="sova-soars-the-sora Aum... I have a :resource-paths [&quot;resources&quot;] ... I shall add the prep-tasks one now"><y>#</y><d>2017-01-10</d><h>20:00</h><w>sova-soars-the-sora</w>Aum... I have a :resource-paths [&quot;resources&quot;]  ... I shall add the prep-tasks one now</z><z id="t1484078418" t="weavejester Because to make it work consistently, you need to ensure that the code is built in the prep-tasks before the jar, and that the cljs code you build is somewhere on the resource path"><y>#</y><d>2017-01-10</d><h>20:00</h><w>weavejester</w>Because to make it work consistently, you need to ensure that the code is built in the prep-tasks before the jar, and that the cljs code you build is somewhere on the resource path</z><z id="t1484078707" t="sova-soars-the-sora Gotcha. So those lines make sure the cljs gets compiled and added?"><y>#</y><d>2017-01-10</d><h>20:05</h><w>sova-soars-the-sora</w>Gotcha.   So those lines make sure the cljs gets compiled and added?</z><z id="t1484078860" t="weavejester Yeah, as long as your compile target for cljsbuild is ‚Äútarget/cljsbuild&quot;"><y>#</y><d>2017-01-10</d><h>20:07</h><w>weavejester</w>Yeah, as long as your compile target for cljsbuild is ‚Äútarget/cljsbuild&quot;</z><z id="t1484078871" t="weavejester Yours might be different."><y>#</y><d>2017-01-10</d><h>20:07</h><w>weavejester</w>Yours might be different.</z><z id="t1484078936" t="sova-soars-the-sora It is different. :output-to &quot;resources/public/js/nf_app.js&quot; :output-dir &quot;resources/public/js/out&quot; ..."><y>#</y><d>2017-01-10</d><h>20:08</h><w>sova-soars-the-sora</w>It is different.  :output-to &quot;resources/public/js/nf_app.js&quot;
                                   :output-dir &quot;resources/public/js/out&quot;  ...</z><z id="t1484078981" t="sova-soars-the-sora would it then be :resource-paths [&quot;resources&quot; &quot;resources/public/js&quot;] ?"><y>#</y><d>2017-01-10</d><h>20:09</h><w>sova-soars-the-sora</w>would it then be <code>:resource-paths [&quot;resources&quot; &quot;resources/public/js&quot;]</code> ?</z><z id="t1484079053" t="weavejester Oh, there‚Äôs no need because ‚Äúresources‚Äù covers ‚Äúresources/public/js&quot;"><y>#</y><d>2017-01-10</d><h>20:10</h><w>weavejester</w>Oh, there‚Äôs no need because ‚Äúresources‚Äù covers ‚Äúresources/public/js&quot;</z><z id="t1484079076" t="sova-soars-the-sora Ah, ok. Very good"><y>#</y><d>2017-01-10</d><h>20:11</h><w>sova-soars-the-sora</w>Ah, ok.   Very good</z><z id="t1484079088" t="weavejester So you‚Äôre fine. You just need to either manually call cljsbuild once before every build, or add it to a prep-task"><y>#</y><d>2017-01-10</d><h>20:11</h><w>weavejester</w>So you‚Äôre fine. You just need to either manually call <code>cljsbuild once</code> before every build, or add it to a prep-task</z><z id="t1484079126" t="sova-soars-the-sora Awesome!"><y>#</y><d>2017-01-10</d><h>20:12</h><w>sova-soars-the-sora</w>Awesome!</z><z id="t1484079129" t="sova-soars-the-sora Thank you so much"><y>#</y><d>2017-01-10</d><h>20:12</h><w>sova-soars-the-sora</w>Thank you so much</z><z id="t1484079148" t="sova-soars-the-sora I love working with Clojure and Cljs because typically when you get something working you never have to touch it again haha"><y>#</y><d>2017-01-10</d><h>20:12</h><w>sova-soars-the-sora</w>I love working with Clojure and Cljs because typically when you get something working you never have to touch it again haha</z><z id="t1484079171" t="weavejester I also tend to have a line like:"><y>#</y><d>2017-01-10</d><h>20:12</h><w>weavejester</w>I also tend to have a line like:</z><z id="t1484079198" t="weavejester :profiles {:repl {:prep-tasks ^:replace [[&quot;javac&quot;] [‚Äùcompile‚Äù]]}} "><y>#</y><d>2017-01-10</d><h>20:13</h><w>weavejester</w><pre>:profiles {:repl {:prep-tasks ^:replace [[&quot;javac&quot;] [‚Äùcompile‚Äù]]}}
</pre></z><z id="t1484079215" t="weavejester Because that ensures that starting the REPL doesn‚Äôt recompile my cljs."><y>#</y><d>2017-01-10</d><h>20:13</h><w>weavejester</w>Because that ensures that starting the REPL doesn‚Äôt recompile my cljs.</z><z id="t1484079281" t="sova-soars-the-sora Interesting! So that makes sure that when you run lein repl it doesn&apos;t do the cljs prep-task... that&apos;s good to have &amp; know"><y>#</y><d>2017-01-10</d><h>20:14</h><w>sova-soars-the-sora</w>Interesting!  So that makes sure that when you run <code>lein repl</code> it doesn&apos;t do the cljs prep-task... that&apos;s good to have &amp; know</z><z id="t1484079298" t="sova-soars-the-sora man there are so many possibilities for project.clj ... is crazey"><y>#</y><d>2017-01-10</d><h>20:14</h><w>sova-soars-the-sora</w>man there are so many possibilities for project.clj ... is crazey</z><z id="t1484079400" t="weavejester Yep. Because I have Figwheel to do that, I only want to have the cljbuild happen during lein uberjar or lein run ."><y>#</y><d>2017-01-10</d><h>20:16</h><w>weavejester</w>Yep. Because I have Figwheel to do that, I only want to have the cljbuild happen during <code>lein uberjar</code> or <code>lein run</code>.</z><z id="t1484079461" t="sova-soars-the-sora Supersweet. Thanks very much for your help dear sir."><y>#</y><d>2017-01-10</d><h>20:17</h><w>sova-soars-the-sora</w>Supersweet.  Thanks very much for your help dear sir.</z><z id="t1484079607" t="weavejester np üôÇ"><y>#</y><d>2017-01-10</d><h>20:20</h><w>weavejester</w>np <b>üôÇ</b></z><z id="t1484386166" t="leov did someone encounter &quot;Malformed transit&quot; exception when making requests from cljs-ajax to ring-transit middleware?"><y>#</y><d>2017-01-14</d><h>09:29</h><w>leov</w>did someone encounter &quot;Malformed transit&quot; exception when making requests from cljs-ajax to ring-transit middleware?</z><z id="t1484434891" t="sova-soars-the-sora Hi is there a place where I can ask about using http-kit? maybe #httpkit ? or somesuch place?"><y>#</y><d>2017-01-14</d><h>23:01</h><w>sova-soars-the-sora</w>Hi is there a place where I can ask about using http-kit?  maybe #httpkit ? or somesuch place?</z><z id="t1484437697" t="seancorfield [:attrs {:href &quot;/_/_/users/U3ES97LAC&quot;}] You can try here or maybe in #clojure ‚Äî there‚Äôs no dedicated place for http-kit right now."><y>#</y><d>2017-01-14</d><h>23:48</h><w>seancorfield</w><a>@sova</a> You can try here or maybe in #clojure ‚Äî there‚Äôs no dedicated place for http-kit right now.</z><z id="t1484445560" t="sova-soars-the-sora I&apos;m trying to migrate my application from ring &amp; jtty to http-kit. Mainly because I want to use sente with it now."><y>#</y><d>2017-01-15</d><h>01:59</h><w>sova-soars-the-sora</w>I&apos;m trying to migrate my application from ring &amp; jtty to http-kit.  Mainly because I want to use sente with it now.</z><z id="t1484445711" t="sova-soars-the-sora I get funky errors on websocket stuff.. no :close method implemented.... some stuff I read on github suggests the error disappears on transition to httpkit..."><y>#</y><d>2017-01-15</d><h>02:01</h><w>sova-soars-the-sora</w>I get funky errors on websocket stuff.. no :close method implemented.... some stuff I read on github suggests the error disappears on transition to httpkit...</z><z id="t1484452989" t="seancorfield [:attrs {:href &quot;/_/_/users/U3ES97LAC&quot;}] You&apos;ll need to be a fair bit more specific about what you&apos;re doing and what exact problems you&apos;re seeing."><y>#</y><d>2017-01-15</d><h>04:03</h><w>seancorfield</w><a>@sova</a> You&apos;ll need to be a fair bit more specific about what you&apos;re doing and what exact problems you&apos;re seeing.</z><z id="t1484509187" t="sova-soars-the-sora https://pastebin.com/8gTKx8Lu"><y>#</y><d>2017-01-15</d><h>19:39</h><w>sova-soars-the-sora</w><a href="https://pastebin.com/8gTKx8Lu" target="_blank">https://pastebin.com/8gTKx8Lu</a></z><z id="t1484509225" t="sova-soars-the-sora A paste-bin of the errors I see. My site still loads and i&apos;m gonna find out if sockets will still work"><y>#</y><d>2017-01-15</d><h>19:40</h><w>sova-soars-the-sora</w>A paste-bin of the errors I see.  My site still loads and i&apos;m gonna find out if sockets will still work</z><z id="t1484595609" t="seancorfield [:attrs {:href &quot;/_/_/users/U3ES97LAC&quot;}] Those say you have a nil value where a non-nil value is expected."><y>#</y><d>2017-01-16</d><h>19:40</h><w>seancorfield</w><a>@sova</a> Those say you have a nil value where a non-nil value is expected.</z><z id="t1484596308" t="sova-soars-the-sora [:attrs {:href &quot;/_/_/users/U04V70XH6&quot;}] Thank you Sean. So it&apos;s not about implementing :on-close but it&apos;s a nil hanging out someplace?"><y>#</y><d>2017-01-16</d><h>19:51</h><w>sova-soars-the-sora</w><a>@seancorfield</a> Thank you Sean.  So it&apos;s not about implementing :on-close but it&apos;s a nil hanging out someplace?</z><z id="t1484596342" t="seancorfield Yeah, you‚Äôre passing nil where it expects a non-`nil` value. With protocols, you get a ‚Äúnot implemented‚Äù message rather than a NPE."><y>#</y><d>2017-01-16</d><h>19:52</h><w>seancorfield</w>Yeah, you‚Äôre passing <code>nil</code> where it expects a non-`nil` value. With protocols, you get a ‚Äúnot implemented‚Äù message rather than a NPE.</z><z id="t1484598501" t="sova-soars-the-sora Oh, thanks a lot, that&apos;s very good to know! üôÇ"><y>#</y><d>2017-01-16</d><h>20:28</h><w>sova-soars-the-sora</w>Oh, thanks a lot, that&apos;s very good to know! <b>üôÇ</b></z><z id="t1484598507" t="sova-soars-the-sora Helps me track it down a bit better."><y>#</y><d>2017-01-16</d><h>20:28</h><w>sova-soars-the-sora</w>Helps me track it down a bit better.</z><z id="t1484691465" t="sova-soars-the-sora Is there a definitive &quot;how to install http kit from the ground-up&quot; or &quot;how to replace your current run-jetty with run-server&quot; guide?"><y>#</y><d>2017-01-17</d><h>22:17</h><w>sova-soars-the-sora</w>Is there a definitive &quot;how to install http kit from the ground-up&quot; or &quot;how to replace your current run-jetty with run-server&quot; guide?</z><z id="t1484691513" t="sova-soars-the-sora I ask because I&apos;m moving my setup (ring on the backend w/ compojure) to use HTTP Kit so I can use Sente (websockets) and... I&apos;m not certain where the heck ring invokes jetty-server, nor am I sure how to replace that with a call to run-server (from httpkit)"><y>#</y><d>2017-01-17</d><h>22:18</h><w>sova-soars-the-sora</w>I ask because I&apos;m moving my setup (ring on the backend w/ compojure) to use HTTP Kit so I can use Sente (websockets) and... I&apos;m not certain where the heck ring invokes jetty-server, nor am I sure how to replace that with a call to run-server (from httpkit)</z><z id="t1484692695" t="seancorfield How do you normally start your server up?"><y>#</y><d>2017-01-17</d><h>22:38</h><w>seancorfield</w>How do you normally start your server up?</z><z id="t1484692771" t="seancorfield (since you don‚Äôt seem to think your code is calling the run-jetty function, I suspect you‚Äôre relying on a plugin or you‚Äôre building an uberjar via a plugin?)"><y>#</y><d>2017-01-17</d><h>22:39</h><w>seancorfield</w>(since you don‚Äôt seem to think your code is calling the <code>run-jetty</code> function, I suspect you‚Äôre relying on a plugin or you‚Äôre building an uberjar via a plugin?)</z><z id="t1484692889" t="seancorfield The ‚Äúsimple‚Äù answer is that you‚Äôll need a -main that requires the http-kit namespace and calls run-server directly (and then ‚Äúwaits around‚Äù ‚Äî by default Jetty starts and joins the main thread so your program automatically waits for Jetty to shutdown; http-kit starts in the background and you have to do something to wait around yourself)."><y>#</y><d>2017-01-17</d><h>22:41</h><w>seancorfield</w>The ‚Äúsimple‚Äù answer is that you‚Äôll need a <code>-main</code> that requires the http-kit namespace and calls <code>run-server</code> directly (and then ‚Äúwaits around‚Äù ‚Äî by default Jetty starts and joins the main thread so your program automatically waits for Jetty to shutdown; http-kit starts in the background and you have to do something to wait around yourself).</z><z id="t1484692959" t="seancorfield If you‚Äôre using Stuart Sierra‚Äôs Component library to manage the start/stop lifecycle, you may find this example helpful: https://github.com/framework-one/fw1-clj/blob/master/examples/usermanager/main.clj#L91-L126"><y>#</y><d>2017-01-17</d><h>22:42</h><w>seancorfield</w>If you‚Äôre using Stuart Sierra‚Äôs Component library to manage the start/stop lifecycle, you may find this example helpful: <a href="https://github.com/framework-one/fw1-clj/blob/master/examples/usermanager/main.clj#L91-L126" target="_blank">https://github.com/framework-one/fw1-clj/blob/master/examples/usermanager/main.clj#L91-L126</a></z><z id="t1484692985" t="seancorfield It uses a runtime option to decide whether to start Jetty or start http-kit, and it also has the shutdown code."><y>#</y><d>2017-01-17</d><h>22:43</h><w>seancorfield</w>It uses a runtime option to decide whether to start Jetty or start http-kit, and it also has the shutdown code.</z><z id="t1484692998" t="seancorfield Here‚Äôs the -main : https://github.com/framework-one/fw1-clj/blob/master/examples/usermanager/main.clj#L156-L164"><y>#</y><d>2017-01-17</d><h>22:43</h><w>seancorfield</w>Here‚Äôs the <code>-main</code>: <a href="https://github.com/framework-one/fw1-clj/blob/master/examples/usermanager/main.clj#L156-L164" target="_blank">https://github.com/framework-one/fw1-clj/blob/master/examples/usermanager/main.clj#L156-L164</a></z><z id="t1484701231" t="sova-soars-the-sora @seancornfield I have my application startup using a ring plugin with a ring handler provided in project.clj ..."><y>#</y><d>2017-01-18</d><h>01:00</h><w>sova-soars-the-sora</w>@seancornfield I have my application startup using a ring plugin with a ring handler provided in project.clj ...</z><z id="t1484701236" t="sova-soars-the-sora [:attrs {:href &quot;/_/_/users/U04V70XH6&quot;}] *"><y>#</y><d>2017-01-18</d><h>01:00</h><w>sova-soars-the-sora</w><a>@seancorfield</a> *</z><z id="t1484701286" t="sova-soars-the-sora but I think now I&apos;m just going to take the sente base application (that works with sockets and httpkit) and just superimpose my application-thus-far onto it. easier than trying to reason about layers of web intestine imho"><y>#</y><d>2017-01-18</d><h>01:01</h><w>sova-soars-the-sora</w>but I think now I&apos;m just going to take the sente base application (that works with sockets and httpkit) and just superimpose my application-thus-far onto it.  easier than trying to reason about layers of web intestine imho</z><z id="t1484701507" t="seancorfield That would be my recommendation. I‚Äôve always avoided the plugins as being too much ‚Äúmagic‚Äù ‚Äî so I can control my web app startup / shutdown directly myself."><y>#</y><d>2017-01-18</d><h>01:05</h><w>seancorfield</w>That would be my recommendation. I‚Äôve always avoided the plugins as being too much ‚Äúmagic‚Äù ‚Äî so I can control my web app startup / shutdown directly myself.</z><z id="t1484701521" t="seancorfield Makes it easier to switch build tools too üôÇ"><y>#</y><d>2017-01-18</d><h>01:05</h><w>seancorfield</w>Makes it easier to switch build tools too <b>üôÇ</b></z><z id="t1484708841" t="sova-soars-the-sora Okay new qustion, (file-response) causes Opera to download the file (html file) instead of rendering it.. Content-Type being funky?"><y>#</y><d>2017-01-18</d><h>03:07</h><w>sova-soars-the-sora</w>Okay new qustion, (file-response) causes Opera to download the file (html file) instead of rendering it..  Content-Type being funky?</z><z id="t1484711491" t="seancorfield [:attrs {:href &quot;/_/_/users/U3ES97LAC&quot;}] Possibly. If you&apos;re on a unix-y system you can use curl -I to see what HTTP headers you get back from that request."><y>#</y><d>2017-01-18</d><h>03:51</h><w>seancorfield</w><a>@sova</a> Possibly. If you&apos;re on a unix-y system you can use <code>curl -I </code> to see what HTTP headers you get back from that request.</z><z id="t1484711542" t="seancorfield That would tell you whether Content-Type is being set or not. I&apos;d have to look at the source (of Ring) to know whether (file-response ...) sets that header."><y>#</y><d>2017-01-18</d><h>03:52</h><w>seancorfield</w>That would tell you whether Content-Type is being set or not. I&apos;d have to look at the source (of Ring) to know whether <code>(file-response ...)</code> sets that header.</z><z id="t1484712387" t="seancorfield OK, [:attrs {:href &quot;/_/_/users/U3ES97LAC&quot;}] no, ring.util.response/file-response does not set Content-Type so you need to explicitly set that yourself: https://github.com/ring-clojure/ring/blob/master/ring-core/src/ring/util/response.clj#L136-L148"><y>#</y><d>2017-01-18</d><h>04:06</h><w>seancorfield</w>OK, <a>@sova</a> no, <code>ring.util.response/file-response</code> does not set Content-Type so you need to explicitly set that yourself: <a href="https://github.com/ring-clojure/ring/blob/master/ring-core/src/ring/util/response.clj#L136-L148" target="_blank">https://github.com/ring-clojure/ring/blob/master/ring-core/src/ring/util/response.clj#L136-L148</a></z><z id="t1484712577" t="seancorfield (-&gt; (resp/file-response ...) (resp/content-type &quot;text/html&quot;)) or you could use the content-type middleware (which will automatically set the Content-Type header based on the file extension in the URL, if no Content-Type is already set)."><y>#</y><d>2017-01-18</d><h>04:09</h><w>seancorfield</w><code>(-&gt; (resp/file-response ...) (resp/content-type &quot;text/html&quot;))</code> or you could use the <code>content-type</code> middleware (which will automatically set the Content-Type header based on the file extension in the URL, if no Content-Type is already set).</z><z id="t1484712693" t="seancorfield To be honest, I&apos;d recommend using ring-defaults to set up your middleware so you don&apos;t have to worry about this much. That automatically adds the content type middleware and a bunch of other useful stuff..."><y>#</y><d>2017-01-18</d><h>04:11</h><w>seancorfield</w>To be honest, I&apos;d recommend using <code>ring-defaults</code> to set up your middleware so you don&apos;t have to worry about this much. That automatically adds the content type middleware and a bunch of other useful stuff...</z><z id="t1484712717" t="seancorfield https://github.com/ring-clojure/ring-defaults"><y>#</y><d>2017-01-18</d><h>04:11</h><w>seancorfield</w><a href="https://github.com/ring-clojure/ring-defaults" target="_blank">https://github.com/ring-clojure/ring-defaults</a></z><z id="t1484715727" t="sova-soars-the-sora [:attrs {:href &quot;/_/_/users/U04V70XH6&quot;}] ah thank you so much. what i&apos;m using already has wrap-defaults and wrap-params but they are not doing the content-type setting, which is interesting..."><y>#</y><d>2017-01-18</d><h>05:02</h><w>sova-soars-the-sora</w><a>@seancorfield</a> ah thank you so much.  what i&apos;m using already has wrap-defaults and wrap-params but they are not doing the content-type setting, which is interesting...</z><z id="t1484716203" t="seancorfield What is your URI for the request? The content type middleware assumes the URI ends in .something and uses that something to look up a content type."><y>#</y><d>2017-01-18</d><h>05:10</h><w>seancorfield</w>What is your URI for the request? The content type middleware assumes the URI ends in .something and uses that something to look up a content type.</z><z id="t1484716231" t="seancorfield So your URI would need to end in .htm or .html to automatically set Content-Type to &quot;text/html&quot; ."><y>#</y><d>2017-01-18</d><h>05:10</h><w>seancorfield</w>So your URI would need to end in <code>.htm</code> or <code>.html</code> to automatically set Content-Type to <code>&quot;text/html&quot;</code>.</z><z id="t1484716276" t="sova-soars-the-sora Oh. Yeah I suppose I&apos;ll have to set it manually then. I was just working with (defroutes (GET &quot;/&quot; [] (index)))"><y>#</y><d>2017-01-18</d><h>05:11</h><w>sova-soars-the-sora</w>Oh.  Yeah I suppose I&apos;ll have to set it manually then.  I was just working with 
<pre>(defroutes 
  (GET &quot;/&quot; [] (index)))</pre></z><z id="t1484716353" t="seancorfield Yup, if you&apos;re serving files that don&apos;t match any presumed &quot;extension&quot; in the URI, you&apos;ll need to set the content type yourself (I&apos;ve run into this several times before -- (resp/response &quot;Hello!&quot;) doesn&apos;t set &quot;text/html&quot; or &quot;text/plain&quot; so some browsers will download that response..."><y>#</y><d>2017-01-18</d><h>05:12</h><w>seancorfield</w>Yup, if you&apos;re serving files that don&apos;t match any presumed &quot;extension&quot; in the URI, you&apos;ll need to set the content type yourself (I&apos;ve run into this several times before -- <code>(resp/response &quot;Hello!&quot;)</code> doesn&apos;t set <code>&quot;text/html&quot;</code> or <code>&quot;text/plain&quot;</code> so some browsers will download that response...</z><z id="t1484716402" t="sova-soars-the-sora Yeah the download is kinda funny. I dig why it happens but I think every page I want to serve is &quot;text/html&quot;"><y>#</y><d>2017-01-18</d><h>05:13</h><w>sova-soars-the-sora</w>Yeah the download is kinda funny.  I dig why it happens but I think every page I want to serve is &quot;text/html&quot;</z><z id="t1484716428" t="sova-soars-the-sora I guess I can just use the normal ring response map and manually have a :headers field"><y>#</y><d>2017-01-18</d><h>05:13</h><w>sova-soars-the-sora</w>I guess I can just use the normal ring response map and manually have a :headers field</z><z id="t1484716522" t="seancorfield I tend to have a html function in my Ring apps like this: (defn html [body] (-&gt; (resp/response body) (resp/content-type &quot;text/html&quot;)))"><y>#</y><d>2017-01-18</d><h>05:15</h><w>seancorfield</w>I tend to have a <code>html</code> function in my Ring apps like this: <code>(defn html [body] (-&gt; (resp/response body) (resp/content-type &quot;text/html&quot;)))</code></z><z id="t1484716540" t="seancorfield (from memory -- I&apos;m not at my main computer right now)"><y>#</y><d>2017-01-18</d><h>05:15</h><w>seancorfield</w>(from memory -- I&apos;m not at my main computer right now)</z><z id="t1484718005" t="sova-soars-the-sora Ah okay. Things are working. Awesome üôÇ"><y>#</y><d>2017-01-18</d><h>05:40</h><w>sova-soars-the-sora</w>Ah okay. Things are working.  Awesome <b>üôÇ</b></z><z id="t1484718010" t="sova-soars-the-sora Thanks a lot for your help [:attrs {:href &quot;/_/_/users/U04V70XH6&quot;}]"><y>#</y><d>2017-01-18</d><h>05:40</h><w>sova-soars-the-sora</w>Thanks a lot for your help <a>@seancorfield</a></z><z id="t1485874110" t="thomas Hi, the upgrade to Ring 1.5.1 is causing some little problems... we are using Immutant and we have some images stored in our resources/public/img directory... and after the upgrade we get 404&apos;s on them...."><y>#</y><d>2017-01-31</d><h>14:48</h><w>thomas</w>Hi, the upgrade to Ring 1.5.1 is causing some little problems... we are using  Immutant and we have some images stored in our resources/public/img directory... and after the upgrade we get 404&apos;s on them....</z><z id="t1485874312" t="thomas and while writing this I realised that we don&apos;t have a problem serving the JS from resources/public..."><y>#</y><d>2017-01-31</d><h>14:51</h><w>thomas</w>and while writing this I realised that we don&apos;t have a problem serving the JS from resources/public...</z><z id="t1485874331" t="thomas hmmm {:tag :a, :attrs {:href &quot;/cdn-cgi/l/email-protection&quot;, :class &quot;__cf_email__&quot;, :data-cfemail &quot;8beff9fcf3f9a6f3f9a6f3cb&quot;}, :content (&quot;[email¬†protected]&quot;)} and I think the @ means it is a symlink..."><y>#</y><d>2017-01-31</d><h>14:52</h><w>thomas</w>hmmm <pre>{:tag :a, :attrs {:href &quot;/cdn-cgi/l/email-protection&quot;, :class &quot;__cf_email__&quot;, :data-cfemail &quot;8beff9fcf3f9a6f3f9a6f3cb&quot;}, :content (&quot;[email¬†protected]&quot;)}</pre> and I think the @ means it is a symlink...</z><z id="t1485874342" t="thomas and that is what 1.5.1 no longer allows."><y>#</y><d>2017-01-31</d><h>14:52</h><w>thomas</w>and that is what 1.5.1 no longer allows.</z><z id="t1485874747" t="thomas ok on Mac OS X it means extended atribute.."><y>#</y><d>2017-01-31</d><h>14:59</h><w>thomas</w>ok on Mac OS X it means extended atribute..</z><z id="t1485885545" t="weavejester If you are having a problem with symlinks, then you can set the :allow-symlinks? option to true ."><y>#</y><d>2017-01-31</d><h>17:59</h><w>weavejester</w>If you are having a problem with symlinks, then you can set the <code>:allow-symlinks?</code> option to <code>true</code>.</z><z id="t1485907435" t="liamd how do i send back a file as a download? file-response just renders as text in the browser"><y>#</y><d>2017-02-01</d><h>00:03</h><w>liamd</w>how do i send back a file as a download? <code>file-response</code> just renders as text in the browser</z><z id="t1485908631" t="liamd nvm merged in a content-disposition header and that did it"><y>#</y><d>2017-02-01</d><h>00:23</h><w>liamd</w>nvm merged in a content-disposition header and that did it</z><z id="t1485917891" t="mattly is there any known problem with ring 1.5 and clojure 1.9 ?"><y>#</y><d>2017-02-01</d><h>02:58</h><w>mattly</w>is there any known problem with ring 1.5 and clojure 1.9 ?</z><z id="t1485917917" t="mattly I pulled in a new third-party library that has a dependency on ring and now I&apos;m getting this compile error:"><y>#</y><d>2017-02-01</d><h>02:58</h><w>mattly</w>I pulled in a new third-party library that has a dependency on ring and now I&apos;m getting this compile error:</z><z id="t1485918152" t="mattly ah, it seems &quot;require&quot; isn&apos;t a keyword"><y>#</y><d>2017-02-01</d><h>03:02</h><w>mattly</w>ah, it seems &quot;require&quot; isn&apos;t a keyword</z><z id="t1485918337" t="mattly weird, it seems it&apos;s using ring 1.2 instead of the declared version"><y>#</y><d>2017-02-01</d><h>03:05</h><w>mattly</w>weird, it seems it&apos;s using ring 1.2 instead of the declared version</z><z id="t1485919937" t="seancorfield Probably some library you‚Äôre using is pulling in an old version via a transitive dependency."><y>#</y><d>2017-02-01</d><h>03:32</h><w>seancorfield</w>Probably some library you‚Äôre using is pulling in an old version via a transitive dependency.</z><z id="t1485919945" t="seancorfield lein deps :tree is your friend."><y>#</y><d>2017-02-01</d><h>03:32</h><w>seancorfield</w><code>lein deps :tree</code> is your friend.</z><z id="t1486026513" t="thomas Hi [:attrs {:href &quot;/_/_/users/U0BKWMG5B&quot;}] I have seen that option... but we don&apos;t seem to have an explicit call to resource-response anywhere... I suspect it is called in one of the many other libs we use."><y>#</y><d>2017-02-02</d><h>09:08</h><w>thomas</w>Hi <a>@weavejester</a>  I have seen that option... but we don&apos;t seem to have an explicit  call to <code>resource-response</code> anywhere... I suspect it is called in one of the many other libs we use.</z><z id="t1486048694" t="ikitommi hi. Is there a release plan/schedule for ring 1.6.0? porting our libs for async..."><y>#</y><d>2017-02-02</d><h>15:18</h><w>ikitommi</w>hi. Is there a release plan/schedule for ring 1.6.0? porting our libs for async...</z><z id="t1486048949" t="ikitommi are there existing async-ring adapters (for different web servers) already around?"><y>#</y><d>2017-02-02</d><h>15:22</h><w>ikitommi</w>are there existing async-ring adapters (for different web servers) already around?</z><z id="t1486049281" t="weavejester ikitommi: my tentative plan is to release an RC at the end of this month. The only async adapter I‚Äôm aware of is the one in Ring 1.6.0."><y>#</y><d>2017-02-02</d><h>15:28</h><w>weavejester</w>ikitommi: my tentative plan is to release an RC at the end of this month. The only async adapter I‚Äôm aware of is the one in Ring 1.6.0.</z><z id="t1486049492" t="ikitommi great, thanks."><y>#</y><d>2017-02-02</d><h>15:31</h><w>ikitommi</w>great, thanks.</z><z id="t1486066601" t="talexxx I‚Äôm trying to get a simple user/pass prompt in front of access to the root server route, but I‚Äôm having trouble finding the right section of the docs. Where do I refer?"><y>#</y><d>2017-02-02</d><h>20:16</h><w>talexxx</w>I‚Äôm trying to get a simple user/pass prompt in front of access to the root server route, but I‚Äôm having trouble finding the right section of the docs. Where do I refer?</z></g><g id="s2"><z id="t1486164824" t="weavejester talexxx: Ring is a bit low level for that. You‚Äôll want a general tutorial on how to write a login."><y>#</y><d>2017-02-03</d><h>23:33</h><w>weavejester</w>talexxx: Ring is a bit low level for that. You‚Äôll want a general tutorial on how to write a login.</z><z id="t1486180495" t="talexxx [:attrs {:href &quot;/_/_/users/U0BKWMG5B&quot;}] True. I ended up using ring.middleware.basic-authentication"><y>#</y><d>2017-02-04</d><h>03:54</h><w>talexxx</w><a>@weavejester</a> True. I ended up using ring.middleware.basic-authentication</z><z id="t1486182636" t="seancorfield [:attrs {:href &quot;/_/_/users/U22F1UE0H&quot;}] There&apos;s an amazing amount of middleware out there and it takes a while to navigate. I came to Clojure webs from a different tech where there was a lot of core built-in functionality and at first I thought I needed to write a lot of code myself... but as I read more about Ring and looked deeper into the middleware ecosystem, I found nearly everything was already available somewhere and just needed to be composed."><y>#</y><d>2017-02-04</d><h>04:30</h><w>seancorfield</w><a>@talexxx</a> There&apos;s an amazing amount of middleware out there and it takes a while to navigate. I came to Clojure webs from a different tech where there was a lot of core built-in functionality and at first I thought I needed to write a lot of code myself... but as I read more about Ring and looked deeper into the middleware ecosystem, I found nearly everything was already available somewhere and just needed to be composed.</z><z id="t1486182658" t="talexxx Good old FP"><y>#</y><d>2017-02-04</d><h>04:30</h><w>talexxx</w>Good old FP</z><z id="t1486182767" t="seancorfield Since then we&apos;ve written our own middleware for a variety of things (such as New Relic transaction monitoring) and anything that is &quot;common&quot; across parts of our application."><y>#</y><d>2017-02-04</d><h>04:32</h><w>seancorfield</w>Since then we&apos;ve written our own middleware for a variety of things (such as New Relic transaction monitoring) and anything that is &quot;common&quot; across parts of our application.</z><z id="t1486189185" t="isaac How can I let compojure destructure key instead of key_json from ‚Äù/ticker_:key_json‚Äù"><y>#</y><d>2017-02-04</d><h>06:19</h><w>isaac</w>How can I let compojure destructure <code>key</code> instead of <code>key_json</code> from <code>‚Äù/ticker_:key_json‚Äù</code></z><z id="t1486190266" t="seancorfield You&apos;d need to write a coercion function for that."><y>#</y><d>2017-02-04</d><h>06:37</h><w>seancorfield</w>You&apos;d need to write a coercion function for that.</z><z id="t1486190506" t="seancorfield so you&apos;d write (GET &quot;/ticker_:key&quot; [key :&lt;&lt; from-json] my/handler) and from-json would parse JSON and produce either a data structure or nil if parsing failed ^ [:attrs {:href &quot;/_/_/users/U061RAB7C&quot;}]"><y>#</y><d>2017-02-04</d><h>06:41</h><w>seancorfield</w>so you&apos;d write <code>(GET &quot;/ticker_:key&quot; [key :&lt;&lt; from-json] my/handler)</code> and <code>from-json</code> would parse JSON and produce either a data structure or <code>nil</code> if parsing failed ^ <a>@isaac</a></z><z id="t1486190822" t="isaac Thanks [:attrs {:href &quot;/_/_/users/U04V70XH6&quot;}] , I think compojure can not customize boundary of binding pattern, is it?"><y>#</y><d>2017-02-04</d><h>06:47</h><w>isaac</w>Thanks <a>@seancorfield</a> , I think compojure can not customize boundary of binding pattern, is it?</z><z id="t1486190932" t="seancorfield Not sure what you mean?"><y>#</y><d>2017-02-04</d><h>06:48</h><w>seancorfield</w>Not sure what you mean?</z><z id="t1486191028" t="isaac eg. (GET ‚Äú/ticker_:{key}_json&quot; [key :&lt;&lt; from-json] my/handler) , {} as boudary"><y>#</y><d>2017-02-04</d><h>06:50</h><w>isaac</w>eg. <code>(GET ‚Äú/ticker_:{key}_json&quot; [key :&lt;&lt; from-json] my/handler)</code>, <code>{}</code> as boudary</z><z id="t1486191084" t="seancorfield Oh, I see... so you have /ticker_SOMETHING_json and you want the SOMETHING part?"><y>#</y><d>2017-02-04</d><h>06:51</h><w>seancorfield</w>Oh, I see... so you have <code>/ticker_SOMETHING_json</code> and you want the <code>SOMETHING</code> part?</z><z id="t1486191102" t="isaac yeah"><y>#</y><d>2017-02-04</d><h>06:51</h><w>isaac</w>yeah</z><z id="t1486191123" t="seancorfield Hmm, that&apos;s tricky... I just simply wouldn&apos;t define an end point like that üôÇ"><y>#</y><d>2017-02-04</d><h>06:52</h><w>seancorfield</w>Hmm, that&apos;s tricky... I just simply wouldn&apos;t define an end point like that <b>üôÇ</b></z><z id="t1486191138" t="seancorfield /ticket/THING/json would be my preference"><y>#</y><d>2017-02-04</d><h>06:52</h><w>seancorfield</w><code>/ticket/THING/json</code> would be my preference</z><z id="t1486191271" t="isaac Yeah, your‚Äôs suggestion is good, but I have some old apis, I must compatible with it."><y>#</y><d>2017-02-04</d><h>06:54</h><w>isaac</w>Yeah, your‚Äôs suggestion is good, but I have some old apis, I must compatible with it.</z><z id="t1486191292" t="seancorfield Sorry üôÇ"><y>#</y><d>2017-02-04</d><h>06:54</h><w>seancorfield</w>Sorry <b>üôÇ</b></z><z id="t1486191307" t="seancorfield Is there a limited set of things that key can be?"><y>#</y><d>2017-02-04</d><h>06:55</h><w>seancorfield</w>Is there a limited set of things that <code>key</code> can be?</z><z id="t1486191338" t="seancorfield If so, define all those routes to map to a single function that picks apart (:uri req) and &quot;does the right thing&quot;."><y>#</y><d>2017-02-04</d><h>06:55</h><w>seancorfield</w>If so, define all those routes to map to a single function that picks apart <code>(:uri req)</code> and &quot;does the right thing&quot;.</z><z id="t1486191382" t="seancorfield Otherwise /ticker_:key and map that to a handler and pick {X}_json apart dynamically..."><y>#</y><d>2017-02-04</d><h>06:56</h><w>seancorfield</w>Otherwise <code>/ticker_:key</code> and map that to a handler and pick <code>{X}_json</code> apart dynamically...</z><z id="t1486191437" t="isaac It seems that is best way. thank you, seancorfield"><y>#</y><d>2017-02-04</d><h>06:57</h><w>isaac</w>It seems that is best way. thank you, seancorfield</z><z id="t1486191706" t="seancorfield It might be an interesting enhancement to routes tho&apos;, to accept :{thing} ... you might consider a Pull Request to add that to Compojure?"><y>#</y><d>2017-02-04</d><h>07:01</h><w>seancorfield</w>It might be an interesting enhancement to routes tho&apos;, to accept <code>:{thing}</code>... you might consider a Pull Request to add that to Compojure?</z><z id="t1486191887" t="isaac OK, i will try"><y>#</y><d>2017-02-04</d><h>07:04</h><w>isaac</w>OK, i will try</z><z id="t1486478682" t="thomas I have recently update to Ring 1.5.1 and now some of my static stuff is broken... and all I have is the site-default: :static {:resources &quot;public&quot;}"><y>#</y><d>2017-02-07</d><h>14:44</h><w>thomas</w>I have recently update to Ring 1.5.1 and now some of my static stuff is broken... and all I have is the site-default: <code>:static    {:resources &quot;public&quot;}</code></z><z id="t1486478732" t="thomas how can I add the :allow-symlinks? flag to that? Any ideas?"><y>#</y><d>2017-02-07</d><h>14:45</h><w>thomas</w>how can I add the <code>:allow-symlinks?</code> flag to that? Any ideas?</z><z id="t1486478749" t="thomas TIA!"><y>#</y><d>2017-02-07</d><h>14:45</h><w>thomas</w>TIA!</z><z id="t1486486052" t="mgrbyte Noob question. I&apos;m having difficulty getting anti-forgery to work - think I&apos;ve narrowed it down to the token not persisting in the session. I&apos;ve quickly created a very minimal example that reproduces the issue, could anyone help? https://github.com/mgrbyte/ring-test/tree/master"><y>#</y><d>2017-02-07</d><h>16:47</h><w>mgrbyte</w>Noob question. I&apos;m having difficulty getting anti-forgery to work - think I&apos;ve narrowed it down to the token not persisting in the session. I&apos;ve quickly created a very minimal example that reproduces the issue, could anyone help? <a href="https://github.com/mgrbyte/ring-test/tree/master" target="_blank">https://github.com/mgrbyte/ring-test/tree/master</a></z><z id="t1486501249" t="mgrbyte [:attrs {:href &quot;/_/_/users/U052852ES&quot;}] https://groups.google.com/forum/#!topic/clojure/YDrKBV26rnA"><y>#</y><d>2017-02-07</d><h>21:00</h><w>mgrbyte</w><a>@thomas</a> <a href="https://groups.google.com/forum/#!topic/clojure/YDrKBV26rnA" target="_blank">https://groups.google.com/forum/#!topic/clojure/YDrKBV26rnA</a></z><z id="t1486502581" t="thomas [:attrs {:href &quot;/_/_/users/U08715BSS&quot;}] I have seen that... but I don&apos;t see a call to resource-response or route/resources anywhere in the code. so not sure how I can use that option. Thank you for your help though."><y>#</y><d>2017-02-07</d><h>21:23</h><w>thomas</w><a>@mgrbyte</a>  I have seen that... but I don&apos;t see a call to <code>resource-response</code> or <code>route/resources</code> anywhere in the code. so not sure how I can use that option.  Thank you for your help though.</z><z id="t1486502762" t="mgrbyte [:attrs {:href &quot;/_/_/users/U052852ES&quot;}] I believe the option is an argument to ring.util.file-response, which typically is invoked by ring.middleware.file/wrap-file I believe - so you should be able to pass the option to that middleware."><y>#</y><d>2017-02-07</d><h>21:26</h><w>mgrbyte</w><a>@thomas</a> I believe the option is an argument to ring.util.file-response, which typically is invoked by <code>ring.middleware.file/wrap-file</code> I believe - so you should be able to pass the option to that middleware.</z><z id="t1486571422" t="weavejester [:attrs {:href &quot;/_/_/users/U08715BSS&quot;}] The problem is that you‚Äôre adding the middleware from scratch each time a request is being received."><y>#</y><d>2017-02-08</d><h>16:30</h><w>weavejester</w><a>@mgrbyte</a> The problem is that you‚Äôre adding the middleware from scratch each time a request is being received.</z><z id="t1486571482" t="weavejester [:attrs {:href &quot;/_/_/users/U08715BSS&quot;}] And because session storage is in-memory by default, you‚Äôre clearing the session store each time a request is received."><y>#</y><d>2017-02-08</d><h>16:31</h><w>weavejester</w><a>@mgrbyte</a> And because session storage is in-memory by default, you‚Äôre clearing the session store each time a request is received.</z><z id="t1486571519" t="weavejester Instead of: (defn my-handler [request] (let [handler (-&gt; app-routes (wrap-defaults site-defaults))] (handler request))) "><y>#</y><d>2017-02-08</d><h>16:31</h><w>weavejester</w>Instead of:
<pre>(defn my-handler [request]
  (let [handler (-&gt; app-routes
                    (wrap-defaults site-defaults))]
    (handler request)))
</pre></z><z id="t1486571550" t="weavejester You want something like: (def my-handler (-&gt; app-routes (wrap-defaults site-defaults))) "><y>#</y><d>2017-02-08</d><h>16:32</h><w>weavejester</w>You want something like:
<pre>(def my-handler
  (-&gt; app-routes
      (wrap-defaults site-defaults)))
</pre></z><z id="t1486571570" t="mgrbyte [:attrs {:href &quot;/_/_/users/U0BKWMG5B&quot;}] how could I not see that! thank you! üôÇ"><y>#</y><d>2017-02-08</d><h>16:32</h><w>mgrbyte</w><a>@weavejester</a> how could I not see that! thank you! <b>üôÇ</b></z><z id="t1486571586" t="mgrbyte In my &quot;real&quot; app, the reason for this is the design of my handlers"><y>#</y><d>2017-02-08</d><h>16:33</h><w>mgrbyte</w>In my &quot;real&quot; app, the reason for this is the design of my handlers</z><z id="t1486571588" t="weavejester No problem. Sorry it took me so long to reply."><y>#</y><d>2017-02-08</d><h>16:33</h><w>weavejester</w>No problem. Sorry it took me so long to reply.</z><z id="t1486571611" t="mgrbyte they all take a datomic db object that&apos;s got on each request, so using &apos;def&apos; isn&apos;t an option with my current scheme"><y>#</y><d>2017-02-08</d><h>16:33</h><w>mgrbyte</w>they all take a datomic db object that&apos;s got on each request, so using &apos;def&apos; isn&apos;t an option with my current scheme</z><z id="t1486571638" t="weavejester Have you considered using a closure instead?"><y>#</y><d>2017-02-08</d><h>16:33</h><w>weavejester</w>Have you considered using a closure instead?</z><z id="t1486571640" t="mgrbyte need to find a way to inject the db val into each handler, or simply have each handler use (d/db conn) rather than passing it in"><y>#</y><d>2017-02-08</d><h>16:34</h><w>mgrbyte</w>need to find a way to inject the db val into each handler, or simply have each handler use (d/db conn) rather than passing it in</z><z id="t1486571643" t="weavejester So something like:"><y>#</y><d>2017-02-08</d><h>16:34</h><w>weavejester</w>So something like:</z><z id="t1486571717" t="weavejester (defn app-routes [conn] (routes (GET ‚Ä¶))) (defn make-handler [conn] (-&gt; (app-routes conn) (wrap-defaults site-defaults))) "><y>#</y><d>2017-02-08</d><h>16:35</h><w>weavejester</w><pre>(defn app-routes [conn]
  (routes
   (GET ‚Ä¶)))

(defn make-handler [conn]
  (-&gt; (app-routes conn)
      (wrap-defaults site-defaults)))
</pre></z><z id="t1486571753" t="weavejester I tend to use the term ‚Äúendpoint‚Äù to denote a function that returns a handler."><y>#</y><d>2017-02-08</d><h>16:35</h><w>weavejester</w>I tend to use the term ‚Äúendpoint‚Äù to denote a function that returns a handler.</z><z id="t1486571769" t="mgrbyte :thumbsup:"><y>#</y><d>2017-02-08</d><h>16:36</h><w>mgrbyte</w><b>:thumbsup:</b></z><z id="t1486571884" t="mgrbyte thanks again [:attrs {:href &quot;/_/_/users/U0BKWMG5B&quot;}] , sometimes can&apos;t see wood from üå≥"><y>#</y><d>2017-02-08</d><h>16:38</h><w>mgrbyte</w>thanks again <a>@weavejester</a> , sometimes can&apos;t see wood from <b>üå≥</b></z><z id="t1486571969" t="weavejester np üôÇ"><y>#</y><d>2017-02-08</d><h>16:39</h><w>weavejester</w>np <b>üôÇ</b></z><z id="t1486586400" t="owen hey I have a question regarding sessions, it seems like if I&apos;m not specifically setting a session key the session/cookie (I&apos;m using a cookie store) is cleared but if I do set it, the expiration of the cookie is reset every time, is both of these expected behavior?"><y>#</y><d>2017-02-08</d><h>20:40</h><w>owen</w>hey I have a question regarding sessions, it seems like if I&apos;m not specifically setting a session key the session/cookie (I&apos;m using a cookie store) is cleared but if I do set it, the expiration of the cookie is reset every time, is both of these expected behavior?</z><z id="t1486587341" t="owen I think I got confused thinking the wrap-session middleware with a cookie-store supports the same options as wrap-cookie (ie. max-age ) but I think I still see behavior where if I don&apos;t set a key on a session it is nil even if it was set before, is that correct? also then do we have to manually expire sessions?"><y>#</y><d>2017-02-08</d><h>20:55</h><w>owen</w>I think I got confused thinking the <code>wrap-session</code> middleware with a cookie-store supports the same options as <code>wrap-cookie</code> (ie. <code>max-age</code>) but I think I still see behavior where if I don&apos;t set a key on a session it is <code>nil</code> even if it was set before, is that correct? also then do we have to manually expire sessions?</z><z id="t1486593945" t="weavejester [:attrs {:href &quot;/_/_/users/U2J4YH6BG&quot;}] the cookie sessions should expire when the cookies expire, or when the encryption key is changed."><y>#</y><d>2017-02-08</d><h>22:45</h><w>weavejester</w><a>@owen</a> the cookie sessions should expire when the cookies expire, or when the encryption key is changed.</z><z id="t1486632986" t="ska Hi. Has anyone experience with running a ring/compojure app behind a proxy? In particular with using compojure contexts. I develop an app which locally listens on &quot;/&quot; and various URIs from there, some defined as (nested) contexts, which will be running behind an nginx which makes the app available as https://server/app-name/ ..."><y>#</y><d>2017-02-09</d><h>09:36</h><w>ska</w>Hi. Has anyone experience with running a ring/compojure app behind a proxy? In particular with using compojure contexts. I develop an app which locally listens on &quot;/&quot; and various URIs from there, some defined as (nested) contexts, which will be running behind an nginx which makes the app available as <a href="https://server/app-name/" target="_blank">https://server/app-name/</a> ...</z><z id="t1486633029" t="ska I found https://groups.google.com/forum/#!topic/compojure/lsDQcYSntos which is not very helpful."><y>#</y><d>2017-02-09</d><h>09:37</h><w>ska</w>I found <a href="https://groups.google.com/forum/#!topic/compojure/lsDQcYSntos" target="_blank">https://groups.google.com/forum/#!topic/compojure/lsDQcYSntos</a> which is not very helpful.</z><z id="t1486648439" t="sineer Hi! I&apos;m trying to launch jetty ring adapter through boot-http and I run into a strange error I can&apos;t figure out: HTTP ERROR: 500 Problem accessing /. Reason: java.lang.Exception: Found lib name &apos;clojure.pprint&apos; containing period with prefix &apos;quote&apos;. lib names inside prefix lists must not contain periods, compiling:(NO_SOURCE_PATH:0:0)"><y>#</y><d>2017-02-09</d><h>13:53</h><w>sineer</w>Hi! I&apos;m trying to launch jetty ring adapter through boot-http and I run into a strange error I can&apos;t figure out:
HTTP ERROR: 500

Problem accessing /. Reason:

    java.lang.Exception: Found lib name &apos;clojure.pprint&apos; containing period with prefix &apos;quote&apos;.  lib names inside prefix lists must not contain periods, compiling:(NO_SOURCE_PATH:0:0)</z><z id="t1486648565" t="sineer ... at ring.middleware.reload$wrap_reload$fn__1057.invoke(reload.clj:21)"><y>#</y><d>2017-02-09</d><h>13:56</h><w>sineer</w>...	at ring.middleware.reload$wrap_reload$fn__1057.invoke(reload.clj:21)</z><z id="t1486648596" t="sineer I can&apos;t find any more clue üòû I don&apos;t use pprint and I can&apos;t find it being used anywhere either"><y>#</y><d>2017-02-09</d><h>13:56</h><w>sineer</w>I can&apos;t find any more clue <b>üòû</b> I don&apos;t use pprint and I can&apos;t find it being used anywhere either</z><z id="t1486648614" t="sineer I&apos;m sure it must be and I just can&apos;t find it..."><y>#</y><d>2017-02-09</d><h>13:56</h><w>sineer</w>I&apos;m sure it must be and I just can&apos;t find it...</z><z id="t1486648777" t="thomas not sure if there is a lein deps :tree equivalent for boot.."><y>#</y><d>2017-02-09</d><h>13:59</h><w>thomas</w>not sure if there is a lein deps :tree equivalent for boot..</z><z id="t1486648792" t="thomas (I assume there is.... but have a google)"><y>#</y><d>2017-02-09</d><h>13:59</h><w>thomas</w>(I assume there is.... but have a google)</z><z id="t1486648795" t="sineer that&apos;s a good question üôÇ I&apos;ll look"><y>#</y><d>2017-02-09</d><h>13:59</h><w>sineer</w>that&apos;s a good question <b>üôÇ</b> I&apos;ll look</z><z id="t1486648814" t="thomas that&apos;d be a good starting point though I suspect"><y>#</y><d>2017-02-09</d><h>14:00</h><w>thomas</w>that&apos;d be a good starting point though I suspect</z><z id="t1486649093" t="sineer boot show -d is equivalent to lein deps:tree but that&apos;s not going to help.. pprint is built-in clojure core and I can&apos;t see anything depending on it..."><y>#</y><d>2017-02-09</d><h>14:04</h><w>sineer</w>boot show -d is equivalent to lein deps:tree but that&apos;s not going to help.. pprint is built-in clojure core and I can&apos;t see anything depending on it...</z><z id="t1486650096" t="thomas DOH"><y>#</y><d>2017-02-09</d><h>14:21</h><w>thomas</w>DOH</z><z id="t1486658906" t="thomas When I do a lein ring uberjar my (compiled) js files in the resources dir get deleted for some reason. How can I make sure they get included in my uberjar?"><y>#</y><d>2017-02-09</d><h>16:48</h><w>thomas</w>When I do a <code>lein ring uberjar</code> my (compiled) js files in the resources  dir get deleted for some reason. How can I make sure they get included in my uberjar?</z><z id="t1486740214" t="weavejester [:attrs {:href &quot;/_/_/users/U052852ES&quot;}] : I believe there‚Äôs a ‚Äúprep-task‚Äù or something like that that allows you to add your JS compile to your build. The uberjar might run a clean, so if your JS compilation isn‚Äôt included in your build, it might get wiped."><y>#</y><d>2017-02-10</d><h>15:23</h><w>weavejester</w><a>@thomas</a>: I believe there‚Äôs a ‚Äúprep-task‚Äù or something like that that allows you to add your JS compile to your build. The uberjar might run a clean, so if your JS compilation isn‚Äôt included in your build, it might get wiped.</z><z id="t1486740318" t="thomas I&apos;ve added a :auto-clean false to my project.clj and that did the trick"><y>#</y><d>2017-02-10</d><h>15:25</h><w>thomas</w>I&apos;ve added a <code>:auto-clean false</code> to my project.clj and that did the trick</z><z id="t1486740338" t="weavejester [:attrs {:href &quot;/_/_/users/U2QDZ8CNA&quot;}] : If you‚Äôre still having that error, the cause might be because you‚Äôve put something like (:require ‚Äòclojure.pprint) instead of (:require clojure.pprint) ."><y>#</y><d>2017-02-10</d><h>15:25</h><w>weavejester</w><a>@sineer</a>: If you‚Äôre still having that error, the cause might be because you‚Äôve put something like <code>(:require ‚Äòclojure.pprint)</code> instead of <code>(:require clojure.pprint)</code>.</z><z id="t1486740437" t="weavejester [:attrs {:href &quot;/_/_/users/U052852ES&quot;}] : Ah good üôÇ . :prep-tasks [[‚Äùcljsbuild‚Äù ‚Äúonce‚Äù] ‚Äújavac‚Äù ‚Äúcompile‚Äù] might also work, so you add your CLJS building to your build."><y>#</y><d>2017-02-10</d><h>15:27</h><w>weavejester</w><a>@thomas</a>: Ah good <b>üôÇ</b>. <code>:prep-tasks [[‚Äùcljsbuild‚Äù ‚Äúonce‚Äù] ‚Äújavac‚Äù ‚Äúcompile‚Äù]</code> might also work, so you add your CLJS building to your build.</z><z id="t1486740477" t="thomas [:attrs {:href &quot;/_/_/users/U0BKWMG5B&quot;}] that looks very useful indeed. I might add that"><y>#</y><d>2017-02-10</d><h>15:27</h><w>thomas</w><a>@weavejester</a>  that looks very useful indeed. I might add that</z><z id="t1486740595" t="weavejester [:attrs {:href &quot;/_/_/users/U052852ES&quot;}] I generally have that, but in my :repl profile I turn it off with :profiles {:repl {:prep-tasks ^:replace [‚Äùjavac‚Äù ‚Äúcompile‚Äù]}} because I‚Äôm typically using Figwheel during REPL development."><y>#</y><d>2017-02-10</d><h>15:29</h><w>weavejester</w><a>@thomas</a> I generally have that, but in my <code>:repl</code> profile I turn it off with <code>:profiles {:repl {:prep-tasks ^:replace [‚Äùjavac‚Äù ‚Äúcompile‚Äù]}}</code> because I‚Äôm typically using Figwheel during REPL development.</z><z id="t1486746260" t="ikitommi are there any helpers in creating async-ring handlers &amp; mw out of sync-ring counterparts? Should there be?"><y>#</y><d>2017-02-10</d><h>17:04</h><w>ikitommi</w>are there any helpers in creating async-ring handlers &amp; mw out of sync-ring counterparts? Should there be?</z><z id="t1486746423" t="ikitommi with sync, you return something of throw, a wrapper with try woudn&apos;t cause a perf impact."><y>#</y><d>2017-02-10</d><h>17:07</h><w>ikitommi</w>with sync, you return something of throw, a wrapper with try woudn&apos;t cause a perf impact.</z><z id="t1486758515" t="weavejester [:attrs {:href &quot;/_/_/users/U055NJ5CC&quot;}] You can convert a sync handler into an async handler fairly easily: (fn [handler] (fn [request respond raise] (respond (handler request)))) "><y>#</y><d>2017-02-10</d><h>20:28</h><w>weavejester</w><a>@ikitommi</a> You can convert a sync handler into an async handler fairly easily:
<pre>(fn [handler]
  (fn [request respond raise]
    (respond (handler request))))
</pre></z><z id="t1486758609" t="weavejester You can‚Äôt really do the same with middleware without resorting to blocking, so a sync middleware would negate the advantages of an async handler."><y>#</y><d>2017-02-10</d><h>20:30</h><w>weavejester</w>You can‚Äôt really do the same with middleware without resorting to blocking, so a sync middleware would negate the advantages of an async handler.</z><z id="t1486758653" t="weavejester Essentially everything under a sync handler is synchronous, so it‚Äôs a one-way conversion."><y>#</y><d>2017-02-10</d><h>20:30</h><w>weavejester</w>Essentially everything under a sync handler is synchronous, so it‚Äôs a one-way conversion.</z><z id="t1486818637" t="ikitommi thanks. So, it‚Äôs ok not to catch the exception (and pass it into raise )? execption-handling mw‚Äôs should catch both exceptions and handle raise s?"><y>#</y><d>2017-02-11</d><h>13:10</h><w>ikitommi</w>thanks. So, it‚Äôs ok not to catch the exception (and pass it into <code>raise</code>)? execption-handling mw‚Äôs should catch both exceptions and handle <code>raise</code>s?</z><z id="t1486820565" t="weavejester [:attrs {:href &quot;/_/_/users/U055NJ5CC&quot;}] Right. We can‚Äôt really get rid of exceptions, so we need to handle both thrown exceptions and anything sent through raise ."><y>#</y><d>2017-02-11</d><h>13:42</h><w>weavejester</w><a>@ikitommi</a> Right. We can‚Äôt really get rid of exceptions, so we need to handle both thrown exceptions and anything sent through <code>raise</code>.</z><z id="t1487573228" t="jumar is there a way (middleware?) to automatically reload webapp without a restart when I add a new depedency to project.clj?"><y>#</y><d>2017-02-20</d><h>06:47</h><w>jumar</w>is there a way (middleware?) to automatically reload webapp without a restart when I add a new depedency to project.clj?</z><z id="t1487573247" t="jumar so far, I have an impression that I need to restart webapp every time I add new dependency"><y>#</y><d>2017-02-20</d><h>06:47</h><w>jumar</w>so far, I have an impression that I need to restart webapp every time I add new dependency</z><z id="t1487573254" t="jumar btw. I&apos;m using luminus template right now."><y>#</y><d>2017-02-20</d><h>06:47</h><w>jumar</w>btw. I&apos;m using luminus template right now.</z><z id="t1487573315" t="tgk [:attrs {:href &quot;/_/_/users/U06BE1L6T&quot;}] : I don‚Äôt think that exists. It would be a pretty heavy-weight operation where the VM is shut down and up again to add the dependency, or a pretty magical piece of code to load the jar file into the classpath on runtime."><y>#</y><d>2017-02-20</d><h>06:48</h><w>tgk</w><a>@jumar</a>: I don‚Äôt think that exists. It would be a pretty heavy-weight operation where the VM is shut down and up again to add the dependency, or a pretty magical piece of code to load the jar file into the classpath on runtime.</z><z id="t1487573349" t="jumar I believe cider refactor supports this - but I don&apos;t know what it&apos;s doing under the hood"><y>#</y><d>2017-02-20</d><h>06:49</h><w>jumar</w>I believe cider refactor supports this - but I don&apos;t know what it&apos;s doing under the hood</z><z id="t1487573416" t="tgk Interesting üôÇ No, that would be worth a study."><y>#</y><d>2017-02-20</d><h>06:50</h><w>tgk</w>Interesting <b>üôÇ</b> No, that would be worth a study.</z><z id="t1487573471" t="jumar I mean cljr-add-project-dependency - I&apos;ll probably look into it in the near future"><y>#</y><d>2017-02-20</d><h>06:51</h><w>jumar</w>I mean cljr-add-project-dependency - I&apos;ll probably look into it in the near future</z><z id="t1487573479" t="jumar nevertheless, thanks for info"><y>#</y><d>2017-02-20</d><h>06:51</h><w>jumar</w>nevertheless, thanks for info</z><z id="t1487682492" t="leov hi all! which ring middleware should I use, so that my javascripts would not be cached by the browser (chrome)?"><y>#</y><d>2017-02-21</d><h>13:08</h><w>leov</w>hi all!
which ring middleware should I use, so that my javascripts would not be cached by the browser (chrome)?</z><z id="t1487784866" t="sova-soars-the-sora Don&apos;t suppose there is a #compojure channel?"><y>#</y><d>2017-02-22</d><h>17:34</h><w>sova-soars-the-sora</w>Don&apos;t suppose there is a #compojure channel?</z><z id="t1487785282" t="sova-soars-the-sora [:attrs {:href &quot;/_/_/users/U0G0JKXGW&quot;}] great question. I don&apos;t know myself, but from my own adventures in web stuff, if you have a favicon that you need updated by the cache you can do a fun trick like add ?v=2 or ?v=3 to the string. If you had an incremental javascript file name, I think the same behavior would apply. Hackier than ring middleware, but may have the desired effect."><y>#</y><d>2017-02-22</d><h>17:41</h><w>sova-soars-the-sora</w><a>@leov</a> great question.  I don&apos;t know myself, but from my own adventures in web stuff, if you have a favicon that you need updated by the cache you can do a fun trick like add ?v=2 or ?v=3 to the string.  If you had an incremental javascript file name, I think the same behavior would apply.  Hackier than ring middleware, but may have the desired effect.</z><z id="t1487785335" t="sova-soars-the-sora ( favicon.ico?v=3 ... etc) will force a new download of the favicon. (just to elucidate more concretely)"><y>#</y><d>2017-02-22</d><h>17:42</h><w>sova-soars-the-sora</w>( favicon.ico?v=3 ... etc)   will force a new download of the favicon.  (just to elucidate more concretely)</z><z id="t1487866312" t="scknkkrer Guys, I have to implement something really silly. A dynamic variable for each request‚Äôs session data. I know I can take it inline but I don‚Äôt wanna do it with long way."><y>#</y><d>2017-02-23</d><h>16:11</h><w>scknkkrer</w>Guys, I have to implement something really silly.
A dynamic variable for each request‚Äôs session data.
I know I can take it inline but I don‚Äôt wanna do it with long way.</z><z id="t1487944344" t="baptiste-from-paris hello folks, is it possible to encode directly a ring request to byte-array (as soon as it comes in)"><y>#</y><d>2017-02-24</d><h>13:52</h><w>baptiste-from-paris</w>hello folks, is it possible to encode directly a ring request to <code>byte-array</code> (as soon as it comes in)</z><z id="t1487949995" t="scknkkrer Will you use it for distributed programming ?"><y>#</y><d>2017-02-24</d><h>15:26</h><w>scknkkrer</w>Will you use it for distributed programming ?</z><z id="t1487998218" t="weavejester [:attrs {:href &quot;/_/_/users/U2N9GDB1U&quot;}] Yes, certainly."><y>#</y><d>2017-02-25</d><h>04:50</h><w>weavejester</w><a>@baptiste-from-paris</a> Yes, certainly.</z><z id="t1488106680" t="baptiste-from-paris thx [:attrs {:href &quot;/_/_/users/U0BKWMG5B&quot;}] , I would love to find out how, did not succeed yet"><y>#</y><d>2017-02-26</d><h>10:58</h><w>baptiste-from-paris</w>thx <a>@weavejester</a>, I would love to find out how, did not succeed yet</z><z id="t1488113401" t="weavejester [:attrs {:href &quot;/_/_/users/U2N9GDB1U&quot;}] Well, the ‚Äòhow‚Äô depends on what you mean. If you mean you want to turn the body into a byte-array, then you could use a library like https://github.com/ztellman/byte-streams"><y>#</y><d>2017-02-26</d><h>12:50</h><w>weavejester</w><a>@baptiste-from-paris</a> Well, the ‚Äòhow‚Äô depends on what you mean. If you mean you want to turn the body into a byte-array, then you could use a library like <a href="https://github.com/ztellman/byte-streams" target="_blank">https://github.com/ztellman/byte-streams</a></z><z id="t1488113471" t="weavejester If you want to serialise the entire request you could use something like https://github.com/ptaoussanis/nippy"><y>#</y><d>2017-02-26</d><h>12:51</h><w>weavejester</w>If you want to serialise the entire request you could use something like <a href="https://github.com/ptaoussanis/nippy" target="_blank">https://github.com/ptaoussanis/nippy</a></z><z id="t1488113572" t="weavejester If you want to ensure that the body is cached, you can write some middleware that reads in the InputStream body into a byte array, then wrap that in a ByteArrayInputStream."><y>#</y><d>2017-02-26</d><h>12:52</h><w>weavejester</w>If you want to ensure that the body is cached, you can write some middleware that reads in the InputStream body into a byte array, then wrap that in a ByteArrayInputStream.</z><z id="t1488187947" t="baptiste-from-paris ok, thx [:attrs {:href &quot;/_/_/users/U0BKWMG5B&quot;}] ; I‚Äôll take a look; I found out how to serialize only the body but my real need is on the entire request"><y>#</y><d>2017-02-27</d><h>09:32</h><w>baptiste-from-paris</w>ok, thx <a>@weavejester</a> ; I‚Äôll take a look; I found out how to serialize only the body but my real need is on the entire request</z><z id="t1488382289" t="rb1719 I am getting this ring request to my compojure route and I don&apos;t know how to deal with it {:remote-addr 0:0:0:0:0:0:0:1, :params nil, :route-params nil, :headers {origin , host localhost:3300, user-agent Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Ubuntu Chromium/55.0.2883.87 Chrome/55.0.2883.87 Safari/537.36, content-type application/transit+json, content-length 36, referer , connection keep-alive, accept application/transit+json, application/transit+transit, application/json, text/plain, text/html, */*, accept-language en-GB,en-US;q=0.8,en;q=0.6, accept-encoding gzip, deflate, br}, :server-port 3300, :keep-alive? true, :uri /add-user!, :server-name ip6-localhost, :query-string nil, :body &lt;&lt; stream: {:pending-puts 0, :drained? false, :buffer-size 36, :permanent? false, :type netty, :sink? true, :closed? true, :pending-takes 0, :buffer-capacity 16384, :connection {:local-address ip6-localhost/0:0:0:0:0:0:0:1:3300, :remote-address /0:0:0:0:0:0:0:1:33688, :writable? true, :readable? true, :closed? false, :direction :inbound}, :source? true} &gt;&gt;, :scheme :http, :request-method :post}"><y>#</y><d>2017-03-01</d><h>15:31</h><w>rb1719</w>I am getting this ring request to my compojure route and I don&apos;t know how to deal with it <pre>{:remote-addr 0:0:0:0:0:0:0:1, :params nil, :route-params nil, :headers {origin , host localhost:3300, user-agent Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Ubuntu Chromium/55.0.2883.87 Chrome/55.0.2883.87 Safari/537.36, content-type application/transit+json, content-length 36, referer , connection keep-alive, accept application/transit+json, application/transit+transit, application/json, text/plain, text/html, */*, accept-language en-GB,en-US;q=0.8,en;q=0.6, accept-encoding gzip, deflate, br}, :server-port 3300, :keep-alive? true, :uri /add-user!, :server-name ip6-localhost, :query-string nil, :body &lt;&lt; stream: {:pending-puts 0, :drained? false, :buffer-size 36, :permanent? false, :type netty, :sink? true, :closed? true, :pending-takes 0, :buffer-capacity 16384, :connection {:local-address ip6-localhost/0:0:0:0:0:0:0:1:3300, :remote-address /0:0:0:0:0:0:0:1:33688, :writable? true, :readable? true, :closed? false, :direction :inbound}, :source? true} &gt;&gt;, :scheme :http, :request-method :post}</pre></z><z id="t1488382343" t="rb1719 I don&apos;t see the params that I passed in (which should be in the form {:id id :pass pass} )"><y>#</y><d>2017-03-01</d><h>15:32</h><w>rb1719</w>I don&apos;t see the params that I passed in (which should be in the form <code>{:id id :pass pass}</code>)</z><z id="t1488382376" t="rb1719 It says that the :params are nil (in the first line) so I think that is my problem"><y>#</y><d>2017-03-01</d><h>15:32</h><w>rb1719</w>It says that the :params are nil (in the first line) so I think that is my problem</z><z id="t1488388032" t="seancorfield The request was a POST and the body is a stream ‚Äî I suspect you don‚Äôt have middleware to decode the body into parameters?"><y>#</y><d>2017-03-01</d><h>17:07</h><w>seancorfield</w>The request was a POST and the body is a stream ‚Äî I suspect you don‚Äôt have middleware to decode the body into parameters?</z><z id="t1488471684" t="rickmoynihan speaking of request bodies as streams ‚Äî ring doesn‚Äôt seem to package a middleware that coerces bodies in to tempfiles (like ring multipart does). Does anyone know of such an implementation in the wild, and if not would such a thing be a useful contribution to ring?"><y>#</y><d>2017-03-02</d><h>16:21</h><w>rickmoynihan</w>speaking of request bodies as streams ‚Äî ring doesn‚Äôt seem to package a middleware that coerces bodies in to tempfiles (like ring multipart does).

Does anyone know of such an implementation in the wild, and if not would such a thing be a useful contribution to ring?</z><z id="t1488471734" t="rickmoynihan the reason I raise it; is because it‚Äôs something we implemented a few years back"><y>#</y><d>2017-03-02</d><h>16:22</h><w>rickmoynihan</w>the reason I raise it; is because it‚Äôs something we implemented a few years back</z><z id="t1488471745" t="rickmoynihan not sure if the landscape has changed"><y>#</y><d>2017-03-02</d><h>16:22</h><w>rickmoynihan</w>not sure if the landscape has changed</z><z id="t1488477615" t="seancorfield [:attrs {:href &quot;/_/_/users/U06HHF230&quot;}] We use ring-defaults and I think that ‚Äúpackages‚Äù multipart file handling?"><y>#</y><d>2017-03-02</d><h>18:00</h><w>seancorfield</w><a>@rickmoynihan</a> We use ring-defaults and I think that ‚Äúpackages‚Äù multipart file handling?</z><z id="t1488477634" t="rickmoynihan it‚Äôs not multipart that I‚Äôm talking about"><y>#</y><d>2017-03-02</d><h>18:00</h><w>rickmoynihan</w>it‚Äôs not multipart that I‚Äôm talking about</z><z id="t1488477651" t="rickmoynihan its when the body is itself the encoded file"><y>#</y><d>2017-03-02</d><h>18:00</h><w>rickmoynihan</w>its when the body is itself the encoded file</z><z id="t1488477698" t="seancorfield Ah, I misunderstood when you referenced ring multipart‚Ä¶"><y>#</y><d>2017-03-02</d><h>18:01</h><w>seancorfield</w>Ah, I misunderstood when you referenced ring multipart‚Ä¶</z><z id="t1488477740" t="rickmoynihan basically I think there‚Äôs a gap in the ring middlewares, which is handling large non multipart request bodies"><y>#</y><d>2017-03-02</d><h>18:02</h><w>rickmoynihan</w>basically I think there‚Äôs a gap in the ring middlewares, which is handling large non multipart request bodies</z><z id="t1488479397" t="weavejester I think that would be fine as a third-party library."><y>#</y><d>2017-03-02</d><h>18:29</h><w>weavejester</w>I think that would be fine as a third-party library.</z><z id="t1488502383" t="sova-soars-the-sora Hi everyone. I&apos;m trying to host my cljs app +server using SSL"><y>#</y><d>2017-03-03</d><h>00:53</h><w>sova-soars-the-sora</w>Hi everyone.  I&apos;m trying to host my cljs app  +server using SSL</z><z id="t1488502397" t="sova-soars-the-sora so I just found (wrap-ssl-redirect )"><y>#</y><d>2017-03-03</d><h>00:53</h><w>sova-soars-the-sora</w>so I just found (wrap-ssl-redirect
)</z><z id="t1488502416" t="sova-soars-the-sora but I don&apos;t know how to change my existing middleware lines appropriately.. i was wondering if someone had a sec to help out"><y>#</y><d>2017-03-03</d><h>00:53</h><w>sova-soars-the-sora</w>but I don&apos;t know how to change my existing middleware lines appropriately.. i was wondering if someone had a sec to help out</z><z id="t1488502434" t="sova-soars-the-sora (def main-ring-handler &quot;**NB**: Sente requires the Ring `wrap-params` + `wrap-keyword-params` middleware to work. These are included with `ring.middleware.defaults/wrap-defaults` - but you&apos;ll need to ensure that they&apos;re included yourself if you&apos;re not using `wrap-defaults`.&quot; (ring.middleware.defaults/wrap-defaults ring-routes ring.middleware.defaults/site-defaults)) "><y>#</y><d>2017-03-03</d><h>00:53</h><w>sova-soars-the-sora</w><pre>(def main-ring-handler
  &quot;**NB**: Sente requires the Ring `wrap-params` + `wrap-keyword-params`
  middleware to work. These are included with
  `ring.middleware.defaults/wrap-defaults` - but you&apos;ll need to ensure
  that they&apos;re included yourself if you&apos;re not using `wrap-defaults`.&quot;

    (ring.middleware.defaults/wrap-defaults
      ring-routes
        ring.middleware.defaults/site-defaults))
</pre></z><z id="t1488502586" t="sova-soars-the-sora Nvm, it seems as though I can just change ring.middleware.defaults/site-defaults to ring.middleware.defaults/secure-site-defaults"><y>#</y><d>2017-03-03</d><h>00:56</h><w>sova-soars-the-sora</w>Nvm, it seems as though I can just change  <code>ring.middleware.defaults/site-defaults</code> to <code>ring.middleware.defaults/secure-site-defaults</code></z><z id="t1488503295" t="sova-soars-the-sora Hrm. Well, the secure site defaults is a nice idea, but it just makes my SSL-enabled site redirect to &quot;localhost&apos; with proxypass /"><y>#</y><d>2017-03-03</d><h>01:08</h><w>sova-soars-the-sora</w>Hrm.  Well, the secure site defaults is a nice idea, but it just makes my SSL-enabled site redirect to &quot;localhost&apos; with proxypass /</z><z id="t1488503331" t="sova-soars-the-sora ... something is weird and my (sente ) websockets are not working right... investigates"><y>#</y><d>2017-03-03</d><h>01:08</h><w>sova-soars-the-sora</w>... something is weird and my (sente ) websockets are not working right... investigates</z><z id="t1488511091" t="weavejester [:attrs {:href &quot;/_/_/users/U3ES97LAC&quot;}] Have you set :proxy to true ?"><y>#</y><d>2017-03-03</d><h>03:18</h><w>weavejester</w><a>@sova</a> Have you set <code>:proxy</code> to <code>true</code>?</z><z id="t1488511098" t="weavejester https://github.com/ring-clojure/ring-defaults#proxies"><y>#</y><d>2017-03-03</d><h>03:18</h><w>weavejester</w><a href="https://github.com/ring-clojure/ring-defaults#proxies" target="_blank">https://github.com/ring-clojure/ring-defaults#proxies</a></z><z id="t1488648031" t="scknkkrer guys, I wanna use a wrapper for my routes. `(defn wrap-metamiddlewares [rs] (reduce (fn [xs r] (conj xs (reduce (fn [ir m] (apply compojure.core/wrap-routes ir m)) r (-&gt; r meta :middleware)))) [] rs))` for defined routes like this; ` (defroutes ^{:doc ‚Äú............&quot; :middleware [[buddy.auth.accessrules/restrict {:handler #(identity true) :on-error (layout/error-page {:status 403 :message &quot;&quot;})}]]} main-route ............))`"><y>#</y><d>2017-03-04</d><h>17:20</h><w>scknkkrer</w>guys, I wanna use a wrapper for my routes.
`(defn wrap-metamiddlewares
  [rs]
  (reduce (fn [xs r]
            (conj xs (reduce (fn [ir m]
                               (apply compojure.core/wrap-routes ir m)) r (-&gt; r meta :middleware)))) [] rs))`

for defined routes like this;
` (defroutes ^{:doc ‚Äú............&quot;
             :middleware [[buddy.auth.accessrules/restrict {:handler #(identity true) :on-error (layout/error-page {:status 403 :message &quot;&quot;})}]]} main-route
           ............))`</z><z id="t1488648086" t="scknkkrer My code work but I can‚Äôt go to page, it takes me to this; `(defn wrap-context [handler] (fn [request] (binding [app-context (if-let [context (:servlet-context request)] ;; If we&apos;re not inside a servlet environment ;; (for example when using mock requests), then ;; .getContextPath might not exist (try (.getContextPath ^ServletContext context) (catch IllegalArgumentException _ context)) ;; if the context is not specified in the request ;; we check if one has been specified in the environment ;; instead (:app-context env))] (handler request))))` Wrong number of args (1)"><y>#</y><d>2017-03-04</d><h>17:21</h><w>scknkkrer</w>My code work but I can‚Äôt go to page, it takes me to this;
`(defn wrap-context [handler]
  (fn [request]
    (binding [app-context
              (if-let [context (:servlet-context request)]
                ;; If we&apos;re not inside a servlet environment
                ;; (for example when using mock requests), then
                ;; .getContextPath might not exist
                (try (.getContextPath ^ServletContext context)
                     (catch IllegalArgumentException _ context))
                ;; if the context is not specified in the request
                ;; we check if one has been specified in the environment
                ;; instead
                (:app-context env))]
      (handler request))))`

Wrong number of args (1)</z><z id="t1488648103" t="scknkkrer what is the relation of this with my wrappers ?"><y>#</y><d>2017-03-04</d><h>17:21</h><w>scknkkrer</w>what is the relation of this with my wrappers ?</z><z id="t1488649663" t="sova-soars-the-sora [:attrs {:href &quot;/_/_/users/U0BKWMG5B&quot;}] do you think something like the following would work"><y>#</y><d>2017-03-04</d><h>17:47</h><w>sova-soars-the-sora</w><a>@weavejester</a> do you think something like the following would work</z><z id="t1488649679" t="sova-soars-the-sora ` (def main-ring-handler &quot;**NB**: Sente requires the Ring `wrap-params` + `wrap-keyword-params` middleware to work. These are included with `ring.middleware.defaults/wrap-defaults` - but you&apos;ll need to ensure that they&apos;re included yourself if you&apos;re not using `wrap-defaults`.&quot; (let [ssd ring.middleware.defaults/secure-site-defaults] (assoc ssd :proxy true) (ring.middleware.defaults/wrap-defaults ring-routes ssd))) `"><y>#</y><d>2017-03-04</d><h>17:47</h><w>sova-soars-the-sora</w><pre>`
(def main-ring-handler
  &quot;**NB**: Sente requires the Ring `wrap-params` + `wrap-keyword-params`
  middleware to work. These are included with
  `ring.middleware.defaults/wrap-defaults` - but you&apos;ll need to ensure
  that they&apos;re included yourself if you&apos;re not using `wrap-defaults`.&quot;

  (let [ssd ring.middleware.defaults/secure-site-defaults]
        (assoc ssd :proxy true)

        (ring.middleware.defaults/wrap-defaults
                 ring-routes
                        ssd)))
</pre>`</z><z id="t1488649738" t="sova-soars-the-sora because I can access my site using r.m.d/site-defaults but simply get a http://localhost redirect when I am trying to use the secure-site-defaults, even with the code above"><y>#</y><d>2017-03-04</d><h>17:48</h><w>sova-soars-the-sora</w>because I can access my site using r.m.d/site-defaults but simply get a <a href="http://localhost" target="_blank">http://localhost</a> redirect when I am trying to use the secure-site-defaults, even with the code above</z><z id="t1488650508" t="sova-soars-the-sora [:attrs {:href &quot;/_/_/users/U3JJH3URY&quot;}] do you know which fxn is expecting more args?"><y>#</y><d>2017-03-04</d><h>18:01</h><w>sova-soars-the-sora</w><a>@scknkkrer</a> do you know which fxn is expecting more args?</z><z id="t1488650916" t="scknkkrer Yeah, I am getting close to fix. But I don‚Äôt get it. buddy.auth.accessrules/restrict wrapper is expecting an argument a map for auth fn and error value."><y>#</y><d>2017-03-04</d><h>18:08</h><w>scknkkrer</w>Yeah, I am getting close to fix. But I don‚Äôt get it.
buddy.auth.accessrules/restrict wrapper is expecting an argument a map for auth fn and error value.</z><z id="t1488650954" t="scknkkrer I am trying with another middleware and getting normal page. üòÑ I don‚Äôt get it guys..."><y>#</y><d>2017-03-04</d><h>18:09</h><w>scknkkrer</w>I am trying with another middleware and getting normal page. <b>üòÑ</b>
I don‚Äôt get it guys...</z><z id="t1488651368" t="sova-soars-the-sora [:attrs {:href &quot;/_/_/users/U3JJH3URY&quot;}] have not used buddy to comment intelligently.. it&apos;s for authentication right?"><y>#</y><d>2017-03-04</d><h>18:16</h><w>sova-soars-the-sora</w><a>@scknkkrer</a>  have not used buddy to comment intelligently.. it&apos;s for authentication right?</z><z id="t1488652015" t="scknkkrer Yes."><y>#</y><d>2017-03-04</d><h>18:26</h><w>scknkkrer</w>Yes.</z><z id="t1488652067" t="scknkkrer I solved it, but I am really confused much more than 5 min ago."><y>#</y><d>2017-03-04</d><h>18:27</h><w>scknkkrer</w>I solved it, but I am really confused much more than 5 min ago.</z><z id="t1488652100" t="scknkkrer I just used fn function not the syntax sugar."><y>#</y><d>2017-03-04</d><h>18:28</h><w>scknkkrer</w>I just used fn function not the syntax sugar.</z><z id="t1488654089" t="weavejester [:attrs {:href &quot;/_/_/users/U3ES97LAC&quot;}] You‚Äôre not assigning :proxy to true. Remember that maps in Clojure are immutable."><y>#</y><d>2017-03-04</d><h>19:01</h><w>weavejester</w><a>@sova</a> You‚Äôre not assigning <code>:proxy</code> to true. Remember that maps in Clojure are immutable.</z><z id="t1488654792" t="sova-soars-the-sora Oh. Good point."><y>#</y><d>2017-03-04</d><h>19:13</h><w>sova-soars-the-sora</w>Oh.  Good point.</z><z id="t1488654798" t="sova-soars-the-sora But something like"><y>#</y><d>2017-03-04</d><h>19:13</h><w>sova-soars-the-sora</w>But something like</z><z id="t1488654832" t="sova-soars-the-sora (let [ssd (assoc ring.middleware.defaults/secure-site-defaults :proxy true)] ... and then using ssd would work, yes?"><y>#</y><d>2017-03-04</d><h>19:13</h><w>sova-soars-the-sora</w><code>(let [ssd (assoc ring.middleware.defaults/secure-site-defaults :proxy true)] ...</code>  and then using ssd would work, yes?</z><z id="t1488654886" t="sova-soars-the-sora Man I wish someone would whack me over the head with a functional programming baton, but i don&apos;t think it&apos;d materialize until the instant I needed it"><y>#</y><d>2017-03-04</d><h>19:14</h><w>sova-soars-the-sora</w>Man I wish someone would whack me over the head with a functional programming baton, but i don&apos;t think it&apos;d materialize until the instant I needed it</z><z id="t1488655681" t="weavejester [:attrs {:href &quot;/_/_/users/U3ES97LAC&quot;}] , yes."><y>#</y><d>2017-03-04</d><h>19:28</h><w>weavejester</w><a>@sova</a>, yes.</z><z id="t1488655704" t="weavejester Assuming that your proxy is set up correctly and there aren‚Äôt any other issues."><y>#</y><d>2017-03-04</d><h>19:28</h><w>weavejester</w>Assuming that your proxy is set up correctly and there aren‚Äôt any other issues.</z><z id="t1488742714" t="sova-soars-the-sora [:attrs {:href &quot;/_/_/users/U0BKWMG5B&quot;}] hm. well thank you for your help, i must be having another issue then. i still get https://localhost when trying to access my domain over ze web"><y>#</y><d>2017-03-05</d><h>19:38</h><w>sova-soars-the-sora</w><a>@weavejester</a> hm. well thank you for your help, i must be having another issue then.  i still get <a href="https://localhost" target="_blank">https://localhost</a> when trying to access my domain over ze web</z><z id="t1488742813" t="weavejester Have you ensured that the x-forwarded-for header is set by the proxy, [:attrs {:href &quot;/_/_/users/U3ES97LAC&quot;}]"><y>#</y><d>2017-03-05</d><h>19:40</h><w>weavejester</w>Have you ensured that the x-forwarded-for header is set by the proxy, <a>@sova</a></z><z id="t1488743013" t="sova-soars-the-sora Have not yet... I&apos;m not sure how I would go about that. you mean by (in this case) apache2 and not by ring/server.clj ?"><y>#</y><d>2017-03-05</d><h>19:43</h><w>sova-soars-the-sora</w>Have not yet... I&apos;m not sure how I would go about that.   you mean by (in this case) apache2 and not by ring/server.clj ?</z><z id="t1488743071" t="weavejester Yeah, the server you‚Äôre proxying from needs to set certain headers. X-Forwarded-For and X-Forwarded-Proto I believe."><y>#</y><d>2017-03-05</d><h>19:44</h><w>weavejester</w>Yeah, the server you‚Äôre proxying from needs to set certain headers. <code>X-Forwarded-For</code> and <code>X-Forwarded-Proto</code> I believe.</z><z id="t1488743224" t="weavejester Although I think the Host header should be sufficient for the redirect."><y>#</y><d>2017-03-05</d><h>19:47</h><w>weavejester</w>Although I think the <code>Host</code> header should be sufficient for the redirect.</z><z id="t1488743285" t="sova-soars-the-sora Hmm well that&apos;s excellent to know, that helps tremendously... now I just gotta find out how to set that up to happen"><y>#</y><d>2017-03-05</d><h>19:48</h><w>sova-soars-the-sora</w>Hmm well that&apos;s excellent to know, that helps tremendously... now I just gotta find out how to set that up to happen</z><z id="t1488743307" t="weavejester What are you using as a proxy?"><y>#</y><d>2017-03-05</d><h>19:48</h><w>weavejester</w>What are you using as a proxy?</z><z id="t1488743516" t="sova-soars-the-sora My setup is: lein start gets a localhost:56162 [some port] going... I have an apache2.4.7 install and I&apos;m just using simple ProxyPass directives to redirect my domain name to localhost:/56162 ..."><y>#</y><d>2017-03-05</d><h>19:51</h><w>sova-soars-the-sora</w>My setup is: <code>lein start</code> gets a localhost:56162 [some port] going... I have an apache2.4.7 install and I&apos;m just using simple ProxyPass directives to redirect my domain name to localhost:/56162 ...</z><z id="t1488743595" t="sova-soars-the-sora I just changed something (ProxyPreserveHost) and now I get a different message: site not working, redirected you too many times."><y>#</y><d>2017-03-05</d><h>19:53</h><w>sova-soars-the-sora</w>I just changed something (ProxyPreserveHost) and now I get a different message: site not working, redirected you too many times.</z><z id="t1488743677" t="weavejester So ProxyPreserveHost sounds like it fixed your Host header problem."><y>#</y><d>2017-03-05</d><h>19:54</h><w>weavejester</w>So ProxyPreserveHost sounds like it fixed your Host header problem.</z><z id="t1488743696" t="weavejester Before, your site was being told that the Host was localhost, hence the erroneous redirection."><y>#</y><d>2017-03-05</d><h>19:54</h><w>weavejester</w>Before, your site was being told that the Host was localhost, hence the erroneous redirection.</z><z id="t1488743721" t="weavejester Now I suspect that its not setting X-Forwarded-Proto, so your site doesn‚Äôt know whether it‚Äôs getting HTTPS"><y>#</y><d>2017-03-05</d><h>19:55</h><w>weavejester</w>Now I suspect that its not setting X-Forwarded-Proto, so your site doesn‚Äôt know whether it‚Äôs getting HTTPS</z><z id="t1488743732" t="weavejester So it just gets HTTP each time, and redirects forever."><y>#</y><d>2017-03-05</d><h>19:55</h><w>weavejester</w>So it just gets HTTP each time, and redirects forever.</z><z id="t1488743745" t="sova-soars-the-sora Ahh okay."><y>#</y><d>2017-03-05</d><h>19:55</h><w>sova-soars-the-sora</w>Ahh okay.</z><z id="t1488743829" t="weavejester You might need to add: RequestHeader set X-Forwarded-Proto https "><y>#</y><d>2017-03-05</d><h>19:57</h><w>weavejester</w>You might need to add:
<pre>RequestHeader set X-Forwarded-Proto https
</pre></z><z id="t1488744018" t="weavejester Although if you allow HTTP as well, maybe $scheme . Not sure how it works in Apache - I usually use nginx."><y>#</y><d>2017-03-05</d><h>20:00</h><w>weavejester</w>Although if you allow HTTP as well, maybe <code>$scheme</code>. Not sure how it works in Apache - I usually use nginx.</z><z id="t1488744125" t="sova-soars-the-sora Dude excellent"><y>#</y><d>2017-03-05</d><h>20:02</h><w>sova-soars-the-sora</w>Dude excellent</z><z id="t1488744151" t="weavejester I guess in Apache you just set it to ‚Äúhttp‚Äù on your :80 config, and ‚Äúhttps‚Äù on your :443 config"><y>#</y><d>2017-03-05</d><h>20:02</h><w>weavejester</w>I guess in Apache you just set it to ‚Äúhttp‚Äù on your :80 config, and ‚Äúhttps‚Äù on your :443 config</z><z id="t1488744153" t="weavejester Did it work?"><y>#</y><d>2017-03-05</d><h>20:02</h><w>weavejester</w>Did it work?</z><z id="t1488744158" t="sova-soars-the-sora I had to enable the request header module using sudo a2enmod headers and ... now it works."><y>#</y><d>2017-03-05</d><h>20:02</h><w>sova-soars-the-sora</w>I had to enable the request header module using <code> sudo a2enmod headers</code> and ... now it works.</z><z id="t1488744173" t="sova-soars-the-sora The site loads over https:// which is sweet!"><y>#</y><d>2017-03-05</d><h>20:02</h><w>sova-soars-the-sora</w>The site loads over https:// which is sweet!</z><z id="t1488744188" t="sova-soars-the-sora But my sente sockets are still not working, and my /login page is 403 forbidden via ajax"><y>#</y><d>2017-03-05</d><h>20:03</h><w>sova-soars-the-sora</w>But my sente sockets are still not working, and my /login page is 403 forbidden via ajax</z><z id="t1488744212" t="sova-soars-the-sora but hey, thanks a lot for your help thusfar. seems like it just needs a few more tweaks. nginx might be a much better way to go at this point... will see"><y>#</y><d>2017-03-05</d><h>20:03</h><w>sova-soars-the-sora</w>but hey, thanks a lot for your help thusfar.  seems like it just needs a few more tweaks.  nginx might be a much better way to go at this point... will see</z><z id="t1488744239" t="weavejester Not sure how Apache proxies websockets."><y>#</y><d>2017-03-05</d><h>20:03</h><w>weavejester</w>Not sure how Apache proxies websockets.</z><z id="t1488744263" t="weavejester I only vague recall how nginx does it. I do remember you need extra configuration for nginx though."><y>#</y><d>2017-03-05</d><h>20:04</h><w>weavejester</w>I only vague recall how nginx does it. I do remember you need extra configuration for nginx though.</z><z id="t1488748680" t="sova-soars-the-sora Oh my god"><y>#</y><d>2017-03-05</d><h>21:18</h><w>sova-soars-the-sora</w>Oh my god</z><z id="t1488748681" t="sova-soars-the-sora it works"><y>#</y><d>2017-03-05</d><h>21:18</h><w>sova-soars-the-sora</w>it works</z><z id="t1488748705" t="sova-soars-the-sora mother-effing stack overflow ftw"><y>#</y><d>2017-03-05</d><h>21:18</h><w>sova-soars-the-sora</w>mother-effing stack overflow ftw</z><z id="t1488748709" t="sova-soars-the-sora RewriteEngine On RewriteCond %{HTTP:Upgrade} =websocket [NC] RewriteRule /(.*) [P,L] RewriteCond %{HTTP:Upgrade} !=websocket [NC] RewriteRule /(.*) [P,L] "><y>#</y><d>2017-03-05</d><h>21:18</h><w>sova-soars-the-sora</w><pre>RewriteEngine On
  RewriteCond %{HTTP:Upgrade} =websocket [NC]
  RewriteRule /(.*)            [P,L]
  RewriteCond %{HTTP:Upgrade} !=websocket [NC]
  RewriteRule /(.*)            [P,L]
</pre></z><z id="t1488748724" t="sova-soars-the-sora whatever i never have to look at that file again. i&apos;m glad it works xD"><y>#</y><d>2017-03-05</d><h>21:18</h><w>sova-soars-the-sora</w>whatever i never have to look at that file again.  i&apos;m glad it works xD</z><z id="t1488748739" t="sova-soars-the-sora [:attrs {:href &quot;/_/_/users/U0BKWMG5B&quot;}] thanks a tonnne for your help homie"><y>#</y><d>2017-03-05</d><h>21:18</h><w>sova-soars-the-sora</w><a>@weavejester</a> thanks a tonnne for your help homie</z><z id="t1488748764" t="weavejester No problem. Glad you got it sorted üôÇ"><y>#</y><d>2017-03-05</d><h>21:19</h><w>weavejester</w>No problem. Glad you got it sorted <b>üôÇ</b></z><z id="t1488921968" t="trevor re: ring session middleware - is there a way to modify the expires attribute of a cookie that&apos;s already been created? E.g. HttpOnly cookie that you want to force the browser to remove"><y>#</y><d>2017-03-07</d><h>21:26</h><w>trevor</w>re: ring session middleware - is there a way to modify the expires attribute of a cookie that&apos;s already been created? E.g. HttpOnly cookie that you want to force the browser to remove</z><z id="t1488922012" t="trevor I basically want to force the browser to remove the cookie on logout by setting the expires attribute to yesterday"><y>#</y><d>2017-03-07</d><h>21:26</h><w>trevor</w>I basically want to force the browser to remove the cookie on logout by setting the expires attribute to yesterday</z><z id="t1488922098" t="trevor (assoc rep :session nil) doesn&apos;t seem to do the trick"><y>#</y><d>2017-03-07</d><h>21:28</h><w>trevor</w><code>(assoc rep :session nil)</code> doesn&apos;t seem to do the trick</z><z id="t1489003141" t="weavejester You can overwrite the cookie, or delete it by setting it to nil. Session nil works for cookie sessions I believe."><y>#</y><d>2017-03-08</d><h>19:59</h><w>weavejester</w>You can overwrite the cookie, or delete it by setting it to nil. Session <code>nil</code> works for cookie sessions I believe.</z><z id="t1489003211" t="weavejester Its been a while since I‚Äôve touched that code. You could also set the expiration of the cookie to last the session."><y>#</y><d>2017-03-08</d><h>20:00</h><w>weavejester</w>Its been a while since I‚Äôve touched that code. You could also set the expiration of the cookie to last the session.</z><z id="t1489003262" t="weavejester [:attrs {:href &quot;/_/_/users/U0516F690&quot;}] you might also want to take a look at https://github.com/ring-clojure/ring-session-timeout/blob/master/src/ring/middleware/session_timeout.clj"><y>#</y><d>2017-03-08</d><h>20:01</h><w>weavejester</w><a>@trevor</a> you might also want to take a look at <a href="https://github.com/ring-clojure/ring-session-timeout/blob/master/src/ring/middleware/session_timeout.clj" target="_blank">https://github.com/ring-clojure/ring-session-timeout/blob/master/src/ring/middleware/session_timeout.clj</a></z><z id="t1489269492" t="trevor [:attrs {:href &quot;/_/_/users/U0BKWMG5B&quot;}] thanks, I&apos;ll check it out"><y>#</y><d>2017-03-11</d><h>21:58</h><w>trevor</w><a>@weavejester</a> thanks, I&apos;ll check it out</z><z id="t1489269616" t="trevor I use session cookies: (assoc rep :session {:token token}) is basically what I do on login"><y>#</y><d>2017-03-11</d><h>22:00</h><w>trevor</w>I use session cookies: <code>(assoc rep :session {:token token})</code> is basically what I do on login</z><z id="t1489269658" t="trevor but on logout, I want to force the browser to remove the cookie because it&apos;s expired"><y>#</y><d>2017-03-11</d><h>22:00</h><w>trevor</w>but on logout, I want to force the browser to remove the cookie because it&apos;s expired</z><z id="t1489276653" t="seylerius Okay, is there a &quot;right&quot; way to setup project.clj to use cider with ring projects? The goal is to hit C-c M-j and have the server launch and the REPL start in the handler namespace."><y>#</y><d>2017-03-11</d><h>23:57</h><w>seylerius</w>Okay, is there a &quot;right&quot; way to setup project.clj to use cider with ring projects? The goal is to hit <code>C-c M-j</code> and have the server launch and the REPL start in the handler namespace.</z><z id="t1489306821" t="Ethan Miller I am trying to get a ring server running but am getting this error that I can‚Äôt decode: &gt; Exception in thread &quot;main&quot; java.lang.NoClassDefFoundError: org/eclipse/jetty/http/HttpParser$ProxyHandler, compiling:(ring/adapter/jetty.clj:27:11)"><y>#</y><d>2017-03-12</d><h>08:20</h><w>Ethan Miller</w>I am trying to get a ring server running but am getting this error that I can‚Äôt decode:
&gt; Exception in thread &quot;main&quot; java.lang.NoClassDefFoundError: org/eclipse/jetty/http/HttpParser$ProxyHandler, compiling:(ring/adapter/jetty.clj:27:11)</z><z id="t1489307031" t="Ethan Miller Looking at the stack, it seems to occur before any of my application‚Äôs code actually runs‚Ä¶ Not sure what I‚Äôm doing wrong."><y>#</y><d>2017-03-12</d><h>08:23</h><w>Ethan Miller</w>Looking at the stack, it seems to occur before any of my application‚Äôs code actually runs‚Ä¶ Not sure what I‚Äôm doing wrong.</z><z id="t1489311736" t="scknkkrer guys, I am developing a project with ring. And I have a silly question; Is ring safe ? Is there any protection to should I take ?"><y>#</y><d>2017-03-12</d><h>09:42</h><w>scknkkrer</w>guys, I am developing a project with ring. And I have a silly question;
Is ring safe ?
Is there any protection to should I take ?</z><z id="t1489311848" t="Ethan Miller [:attrs {:href &quot;/_/_/users/U3JJH3URY&quot;}] what do you mean by safe?"><y>#</y><d>2017-03-12</d><h>09:44</h><w>Ethan Miller</w><a>@scknkkrer</a> what do you mean by safe?</z><z id="t1489311869" t="Ethan Miller I think the answer might be that it‚Äôs as safe as the protections that you configure."><y>#</y><d>2017-03-12</d><h>09:44</h><w>Ethan Miller</w>I think the answer might be that it‚Äôs as safe as the protections that you configure.</z><z id="t1489311874" t="scknkkrer for security."><y>#</y><d>2017-03-12</d><h>09:44</h><w>scknkkrer</w>for security.</z><z id="t1489311922" t="Ethan Miller You can build as server with little or no security or with a lot using ring."><y>#</y><d>2017-03-12</d><h>09:45</h><w>Ethan Miller</w>You can build as server with little or no security or with a lot using ring.</z><z id="t1489311969" t="Ethan Miller Take a look at ring-defaults which includes some pre-batched protections for different kinds of services, e.g. ‚Äúsecure-site-defaults‚Äù: https://github.com/ring-clojure/ring-defaults"><y>#</y><d>2017-03-12</d><h>09:46</h><w>Ethan Miller</w>Take a look at <code>ring-defaults</code> which includes some pre-batched protections for different kinds of services, e.g. ‚Äúsecure-site-defaults‚Äù: <a href="https://github.com/ring-clojure/ring-defaults" target="_blank">https://github.com/ring-clojure/ring-defaults</a></z><z id="t1489312037" t="Ethan Miller I‚Äôm certainly not a ring expert, but it‚Äôs my understanding that the idea behind these ‚Äúdefaults‚Äù is to make it easy to follow best practices when it comes to setting up sensible features, including security protections, for different kind of services."><y>#</y><d>2017-03-12</d><h>09:47</h><w>Ethan Miller</w>I‚Äôm certainly not a ring expert, but it‚Äôs my understanding that the idea behind these ‚Äúdefaults‚Äù is to make it easy to follow best practices when it comes to setting up sensible features, including security protections, for different kind of services.</z><z id="t1489312066" t="Ethan Miller So you can‚Äôt go wrong, I don‚Äôt think, by starting there, even if your service could ultimately require more specialized configuration."><y>#</y><d>2017-03-12</d><h>09:47</h><w>Ethan Miller</w>So you can‚Äôt go wrong, I don‚Äôt think, by starting there, even if your service could ultimately require more specialized configuration.</z><z id="t1489312144" t="Ethan Miller If you don‚Äôt use these tools, and just build the bare-minimum server, I think it‚Äôs fair to say that your server will not be secure."><y>#</y><d>2017-03-12</d><h>09:49</h><w>Ethan Miller</w>If you don‚Äôt use these tools, and just build the bare-minimum server, I think it‚Äôs fair to say that your server will not be secure.</z><z id="t1489327199" t="scknkkrer Thanks a lot."><y>#</y><d>2017-03-12</d><h>13:59</h><w>scknkkrer</w>Thanks a lot.</z><z id="t1489594812" t="iGEL Hello. Is there a way to get all the usual CGI environment variables like REMOTE_ADDR , SERVER_NAME or HTTP_REFERER as a map? I would like to post it to honeybadger when exceptions happen and the API expects it like that"><y>#</y><d>2017-03-15</d><h>16:20</h><w>iGEL</w>Hello. Is there a way to get all the usual CGI environment variables like <code>REMOTE_ADDR</code>, <code>SERVER_NAME</code> or <code>HTTP_REFERER</code> as a map? I would like to post it to honeybadger when exceptions happen and the API expects it like that</z><z id="t1489598901" t="seancorfield :remote-addr is available (and, if you use the wrap-proxy (?) middleware it handles load balancer forwarding as well). Not sure about the others."><y>#</y><d>2017-03-15</d><h>17:28</h><w>seancorfield</w><code>:remote-addr</code> is available (and, if you use the <code>wrap-proxy</code>(?) middleware it handles load balancer forwarding as well). Not sure about the others.</z><z id="t1489601504" t="ikitommi Hi. Finalizing a new fast content negotiation &amp; formatting lib for Clojure/Ring/Pedestal, based on ring-middleware-format. Would appreciate feedback on the public apis and naming (or anything), still easy to change things as it‚Äôs not ‚Äúout&quot;. Here it is: https://github.com/metosin/muuntaja"><y>#</y><d>2017-03-15</d><h>18:11</h><w>ikitommi</w>Hi. Finalizing a new fast content negotiation &amp; formatting lib for Clojure/Ring/Pedestal, based on ring-middleware-format. Would appreciate feedback on the public apis and naming (or anything), still easy to change things as it‚Äôs not ‚Äúout&quot;. Here it is: <a href="https://github.com/metosin/muuntaja" target="_blank">https://github.com/metosin/muuntaja</a></z><z id="t1490368940" t="mattsfrey has anyone had issues where continuous requests start to take longer and longer and then eventually start timing out?"><y>#</y><d>2017-03-24</d><h>15:22</h><w>mattsfrey</w>has anyone had issues where continuous requests start to take longer and longer and then eventually start timing out?</z><z id="t1490369406" t="weavejester Continuous requests?"><y>#</y><d>2017-03-24</d><h>15:30</h><w>weavejester</w>Continuous requests?</z><z id="t1490371891" t="mattsfrey just having a client repeatedly make requests over a period of time"><y>#</y><d>2017-03-24</d><h>16:11</h><w>mattsfrey</w>just having a client repeatedly make requests over a period of time</z><z id="t1490371907" t="mattsfrey polling for data basically"><y>#</y><d>2017-03-24</d><h>16:11</h><w>mattsfrey</w>polling for data basically</z><z id="t1490371932" t="mattsfrey it usually runs under 250ms but then every so often just starts to take more and more time, until its in the hundreds of seconds"><y>#</y><d>2017-03-24</d><h>16:12</h><w>mattsfrey</w>it usually runs under 250ms but then every so often just starts to take more and more time, until its in the hundreds of seconds</z><z id="t1490371955" t="mattsfrey eventually the healtcheck request from the instance manager times out and it restarts the machine"><y>#</y><d>2017-03-24</d><h>16:12</h><w>mattsfrey</w>eventually the healtcheck request from the instance manager times out and it restarts the machine</z><z id="t1490371962" t="mattsfrey and the problem is gone again for a period of time"><y>#</y><d>2017-03-24</d><h>16:12</h><w>mattsfrey</w>and the problem is gone again for a period of time</z><z id="t1490371992" t="mattsfrey seems like some sort of resource is getting tied up, threads arent being freed or something but I don&apos;t know enough about the underlying server architecture to really know whats going on"><y>#</y><d>2017-03-24</d><h>16:13</h><w>mattsfrey</w>seems like some sort of resource is getting tied up, threads arent being freed or something but I don&apos;t know enough about the underlying server architecture to really know whats going on</z><z id="t1490372728" t="weavejester Which adapter are you using? Are you using async or synchronous handlers? If you‚Äôre just using ring-jetty with synchronous handlers, which is the most common setup, you might have something in your handler that‚Äôs holding resources but not releasing them."><y>#</y><d>2017-03-24</d><h>16:25</h><w>weavejester</w>Which adapter are you using? Are you using async or synchronous handlers? If you‚Äôre just using ring-jetty with synchronous handlers, which is the most common setup, you might have something in your handler that‚Äôs holding resources but not releasing them.</z><z id="t1490372742" t="weavejester Ring-Jetty with sync handlers doesn‚Äôt keep anything open by default."><y>#</y><d>2017-03-24</d><h>16:25</h><w>weavejester</w>Ring-Jetty with sync handlers doesn‚Äôt keep anything open by default.</z><z id="t1490375064" t="seancorfield 250ms is a pretty slow request in the first place. I‚Äôm curious as to what work you‚Äôre doing in such a request [:attrs {:href &quot;/_/_/users/U12FDCE4V&quot;}] ?"><y>#</y><d>2017-03-24</d><h>17:04</h><w>seancorfield</w>250ms is a pretty slow request in the first place. I‚Äôm curious as to what work you‚Äôre doing in such a request <a>@mattsfrey</a> ?</z><z id="t1490375556" t="mattsfrey it has to essentially make multiple calls out to s3 before returning a response"><y>#</y><d>2017-03-24</d><h>17:12</h><w>mattsfrey</w>it has to essentially make multiple calls out to s3 before returning a response</z><z id="t1490375562" t="mattsfrey so thats causing the larger times"><y>#</y><d>2017-03-24</d><h>17:12</h><w>mattsfrey</w>so thats causing the larger times</z><z id="t1490375620" t="mattsfrey using async I believe"><y>#</y><d>2017-03-24</d><h>17:13</h><w>mattsfrey</w>using async I believe</z><z id="t1490375763" t="weavejester Does it use async handlers? Maybe it‚Äôs not closing the response?"><y>#</y><d>2017-03-24</d><h>17:16</h><w>weavejester</w>Does it use async handlers? Maybe it‚Äôs not closing the response?</z><z id="t1490375790" t="weavejester Or maybe you‚Äôre keeping I/O connections open"><y>#</y><d>2017-03-24</d><h>17:16</h><w>weavejester</w>Or maybe you‚Äôre keeping I/O connections open</z><z id="t1490375838" t="mattsfrey potentially"><y>#</y><d>2017-03-24</d><h>17:17</h><w>mattsfrey</w>potentially</z><z id="t1490375879" t="mattsfrey do you know of an easy way inherent to ring to view whats going on behind the scenes? I&apos;m at the point of hooking up a jvm profiler really"><y>#</y><d>2017-03-24</d><h>17:17</h><w>mattsfrey</w>do you know of an easy way inherent to ring to view whats going on behind the scenes? I&apos;m at the point of hooking up a jvm profiler really</z><z id="t1490376443" t="weavejester It doesn‚Äôt sound like it‚Äôs Ring specifically that‚Äôs the problem, but what‚Äôs going on in your handler after Ring has passed off the request to it."><y>#</y><d>2017-03-24</d><h>17:27</h><w>weavejester</w>It doesn‚Äôt sound like it‚Äôs Ring specifically that‚Äôs the problem, but what‚Äôs going on in your handler after Ring has passed off the request to it.</z><z id="t1490376460" t="weavejester A profiler is a good place to start."><y>#</y><d>2017-03-24</d><h>17:27</h><w>weavejester</w>A profiler is a good place to start.</z><z id="t1490383427" t="mattsfrey yeah haven&apos;t hooked up the profiler but checking our datadog logs it seems to be using an increasing amount of memory until it breeches the box&apos;s allocation"><y>#</y><d>2017-03-24</d><h>19:23</h><w>mattsfrey</w>yeah haven&apos;t hooked up the profiler but checking our datadog logs it seems to be using an increasing amount of memory until it breeches the box&apos;s allocation</z><z id="t1490383437" t="mattsfrey so something is using memory and not freeing it"><y>#</y><d>2017-03-24</d><h>19:23</h><w>mattsfrey</w>so something is using memory and not freeing it</z><z id="t1490574519" t="petr.mensik Hello, I am wondering how to correctly serve static files in a uberwar. I have bunch of static files (html, css, etc) under resources/public folder. I serve the login page with following route (GET &quot;/&quot; [] (resource-response &quot;login.html&quot;)) . This works fine because I defined public folder as resource-path in project.clj . However links between the files are broken (for example login page won&apos;t find its CSS file which is linked with href=&quot;styles/login-styles.css&quot; ). So what is the best way how to overcome this? I also tried defining resources as :war-resource-paths but then I cannot even serve the login page itself. Thanks for any advice üôÇ"><y>#</y><d>2017-03-27</d><h>00:28</h><w>petr.mensik</w>Hello, I am wondering how to correctly serve static files in a uberwar. I have bunch of static files (html, css, etc) under <code>resources/public</code> folder. I serve the login page with following route <code>(GET &quot;/&quot; []  (resource-response &quot;login.html&quot;))</code>. This works fine because I defined <code>public</code> folder as resource-path in <code>project.clj</code>. However links between the files are broken (for example login page won&apos;t find its CSS file which is linked with <code>href=&quot;styles/login-styles.css&quot;</code>). So what is the best way how to overcome this? I also tried defining resources as <code>:war-resource-paths</code> but then I cannot even serve the login page itself. Thanks for any advice <b>üôÇ</b></z><z id="t1490611428" t="weavejester [:attrs {:href &quot;/_/_/users/U3H4PBCLE&quot;}] are you using the wrap-resource middleware?"><y>#</y><d>2017-03-27</d><h>10:43</h><w>weavejester</w><a>@petr.mensik</a> are you using the <code>wrap-resource</code> middleware?</z><z id="t1490611481" t="weavejester Also you don‚Äôt want to set resources/public as a resources-path"><y>#</y><d>2017-03-27</d><h>10:44</h><w>weavejester</w>Also you don‚Äôt want to set <code>resources/public</code> as a resources-path</z><z id="t1490611492" t="weavejester There‚Äôs a reason we use a subdirectory."><y>#</y><d>2017-03-27</d><h>10:44</h><w>weavejester</w>There‚Äôs a reason we use a subdirectory.</z><z id="t1490616455" t="petr.mensik [:attrs {:href &quot;/_/_/users/U0BKWMG5B&quot;}] I am using compojure-api so I am not sure whether it&apos;s included in default middleware"><y>#</y><d>2017-03-27</d><h>12:07</h><w>petr.mensik</w><a>@weavejester</a> I am using compojure-api so I am not sure whether it&apos;s included in default middleware</z><z id="t1490616463" t="petr.mensik let me take a look"><y>#</y><d>2017-03-27</d><h>12:07</h><w>petr.mensik</w>let me take a look</z><z id="t1490616493" t="petr.mensik so the subdir for frontend part of the application should be something like resources/public/my-app ?"><y>#</y><d>2017-03-27</d><h>12:08</h><w>petr.mensik</w>so the subdir for frontend part of the application should be something like <code>resources/public/my-app</code>?</z><z id="t1490617591" t="petr.mensik ok, looks like it&apos;s not so I&apos;ll try adding it"><y>#</y><d>2017-03-27</d><h>12:26</h><w>petr.mensik</w>ok, looks like it&apos;s not so I&apos;ll try adding it</z><z id="t1490618552" t="petr.mensik ok, defining middleware as :middleware [wrap-session wrap-not-modified [wrap-resource &quot;public&quot;]]} worked for me (EDIT - worked with lein ring server , not in uberwar). However I am still wondering what is the best practice for static content serving? You mentioned that using resources/public is wrong, can I ask what would be a better solution? thanks a lot"><y>#</y><d>2017-03-27</d><h>12:42</h><w>petr.mensik</w>ok, defining middleware as <code>:middleware [wrap-session wrap-not-modified [wrap-resource &quot;public&quot;]]}</code> worked for me (EDIT - worked with <code>lein ring server</code>, not in uberwar). However I am still wondering what is the best practice for static content serving? You mentioned that using <code>resources/public</code> is wrong, can I ask what would be a better solution? thanks a lot</z><z id="t1490624001" t="weavejester [:attrs {:href &quot;/_/_/users/U3H4PBCLE&quot;}] Using resources/public is correct; it‚Äôs adding resources/public to the classpath that‚Äôs wrong. You need some way of distinguishing between resources you want to make public, and resources you want to keep private."><y>#</y><d>2017-03-27</d><h>14:13</h><w>weavejester</w><a>@petr.mensik</a> Using <code>resources/public</code> is correct; it‚Äôs adding <code>resources/public</code> to the classpath that‚Äôs wrong. You need some way of distinguishing between resources you want to make public, and resources you want to keep private.</z><z id="t1490624037" t="weavejester https://github.com/ring-clojure/ring-defaults is a library that sets up sensible default middleware, and includes wrap-resource ."><y>#</y><d>2017-03-27</d><h>14:13</h><w>weavejester</w><a href="https://github.com/ring-clojure/ring-defaults" target="_blank">https://github.com/ring-clojure/ring-defaults</a> is a library that sets up sensible default middleware, and includes <code>wrap-resource</code>.</z><z id="t1490624560" t="petr.mensik To me it&apos;s still makes sense to put all the website related stuff (html, css, ...) into resources/public and make it available to the classpath. Then I can have let&apos;s say resources/images and these will be for internal use of my application and I am not going to make that public. So is anything wrong such a setup?"><y>#</y><d>2017-03-27</d><h>14:22</h><w>petr.mensik</w>To me it&apos;s still makes sense to put all the website related stuff (html, css, ...) into <code>resources/public</code> and make it available to the classpath. Then I can have let&apos;s say <code>resources/images</code> and these will be for internal use of my application and I am not going to make that public. So is anything wrong such a setup?</z><z id="t1490624633" t="petr.mensik So it sounds to me I should have :war-resource-paths [&quot;resources/public&quot;] and :resource-paths [&quot;resources/images&quot;]"><y>#</y><d>2017-03-27</d><h>14:23</h><w>petr.mensik</w>So it sounds to me I should have <code>:war-resource-paths [&quot;resources/public&quot;]</code> and <code>:resource-paths [&quot;resources/images&quot;]</code></z><z id="t1490625099" t="petr.mensik With the only problem that this doesn&apos;t work when I package the application into the WAR file with lein ring uberwar . Again, links between files are broken (and I guess this is because Tomcat is not prepending the application name before link)"><y>#</y><d>2017-03-27</d><h>14:31</h><w>petr.mensik</w>With the only problem that this doesn&apos;t work when I package the application into the WAR file with <code>lein ring uberwar</code>. Again, links between files are broken (and I guess this is because Tomcat is not prepending the application name before link)</z><z id="t1490625260" t="petr.mensik Because servers the login page without styles, however works. So is there any standard way how to make application work for both development and deployment? Because I feel like I am trying to reinvent wheel right now üòï"><y>#</y><d>2017-03-27</d><h>14:34</h><w>petr.mensik</w>Because <code></code> servers the login page without styles, however <code></code> works. So is there any standard way how to make application work for both development and deployment? Because I feel like I am trying to reinvent wheel right now <b>üòï</b></z><z id="t1490625288" t="petr.mensik And I cannot be the first one who wants to have relative links working when serving static content üôÇ"><y>#</y><d>2017-03-27</d><h>14:34</h><w>petr.mensik</w>And I cannot be the first one who wants to have relative links working when serving static content <b>üôÇ</b></z><z id="t1490627906" t="weavejester [:attrs {:href &quot;/_/_/users/U3H4PBCLE&quot;}] No, you shouldn‚Äôt do that. Let‚Äôs say you have a file resources/public/foo.html . If you set your :resource-paths to [‚Äùresources‚Äù] , which is the default, then you‚Äôll be able to access your HTML file at public/foo.html ."><y>#</y><d>2017-03-27</d><h>15:18</h><w>weavejester</w><a>@petr.mensik</a> No, you shouldn‚Äôt do that. Let‚Äôs say you have a file <code>resources/public/foo.html</code>. If you set your <code>:resource-paths</code> to <code>[‚Äùresources‚Äù]</code>, which is the default, then you‚Äôll be able to access your HTML file at <code>public/foo.html</code>.</z><z id="t1490627969" t="weavejester We can then say ‚Äúany resource that starts with public/ is accessible‚Äù"><y>#</y><d>2017-03-27</d><h>15:19</h><w>weavejester</w>We can then say ‚Äúany resource that starts with <code>public/</code> is accessible‚Äù</z><z id="t1490628024" t="weavejester But if you set the :resource-paths to [‚Äùresources/public‚Äù], then your HTML file will be accessible at foo.html , and how do you know if that is public or not?"><y>#</y><d>2017-03-27</d><h>15:20</h><w>weavejester</w>But if you set the <code>:resource-paths</code> to [‚Äùresources/public‚Äù], then your HTML file will be accessible at <code>foo.html</code>, and how do you know if that is public or not?</z><z id="t1490628089" t="weavejester Also, ignore :war-resource-paths . Those are for war resources, which are different to the normal resources. They‚Äôre not on the classpath. Typically we don‚Äôt use them in Clojure, we just use normal Java resources."><y>#</y><d>2017-03-27</d><h>15:21</h><w>weavejester</w>Also, ignore <code>:war-resource-paths</code>. Those are for war resources, which are different to the normal resources. They‚Äôre not on the classpath. Typically we don‚Äôt use them in Clojure, we just use normal Java resources.</z><z id="t1490628364" t="petr.mensik Ok, that makes sense, thanks. However I am not sure how for instance login.html can link styles.css when the CSS file is burried inside the WAR file under WEB-INF/classes/public"><y>#</y><d>2017-03-27</d><h>15:26</h><w>petr.mensik</w>Ok, that makes sense, thanks. However I am not sure how for instance <code>login.html</code>can link <code>styles.css</code> when the CSS file is burried inside the WAR file under <code>WEB-INF/classes/public</code></z><z id="t1490628525" t="weavejester It doesn‚Äôt matter where it is in the jar, or where it is on the filesystem. What matters is where the classpath is."><y>#</y><d>2017-03-27</d><h>15:28</h><w>weavejester</w>It doesn‚Äôt matter where it is in the jar, or where it is on the filesystem. What matters is where the classpath is.</z><z id="t1490628541" t="weavejester So WEB-INF/classes is part of the classpath."><y>#</y><d>2017-03-27</d><h>15:29</h><w>weavejester</w>So <code>WEB-INF/classes</code> is part of the classpath.</z><z id="t1490628578" t="weavejester Effectively the classpath is lots of different places for resources merged together"><y>#</y><d>2017-03-27</d><h>15:29</h><w>weavejester</w>Effectively the classpath is lots of different places for resources merged together</z><z id="t1490628592" t="weavejester Java tries them in order until it finds a matching file"><y>#</y><d>2017-03-27</d><h>15:29</h><w>weavejester</w>Java tries them in order until it finds a matching file</z><z id="t1490628619" t="weavejester While you‚Äôre developing, src , test and resources are all on your classpath."><y>#</y><d>2017-03-27</d><h>15:30</h><w>weavejester</w>While you‚Äôre developing, <code>src</code>, <code>test</code> and <code>resources</code> are all on your classpath.</z><z id="t1490628662" t="weavejester So if you try to find the resource public/foo.html , it‚Äôll look for a file src/public/foo.html , ‚Äòtest/public/foo.html` and resources/public/foo.html ."><y>#</y><d>2017-03-27</d><h>15:31</h><w>weavejester</w>So if you try to find the resource <code>public/foo.html</code>, it‚Äôll look for a file <code>src/public/foo.html</code>, ‚Äòtest/public/foo.html` and <code>resources/public/foo.html</code>.</z><z id="t1490629346" t="petr.mensik sure, I got this one. However what I meant is that if one static file is referencing other (like the example above), then it breaks. At least in my case, I can correctly serve login.html with (GET &quot;/&quot; [] (resource-response &quot;login.html&quot; {:root &quot;public&quot;})) however login.html doesn&apos;t see the main.css specified as href=&quot;styles/main.css&quot;"><y>#</y><d>2017-03-27</d><h>15:42</h><w>petr.mensik</w>sure, I got this one. However what I meant is that if one static file is referencing other (like the example above), then it breaks. At least in my case, I can correctly serve <code>login.html</code> with <code>(GET &quot;/&quot; []  (resource-response &quot;login.html&quot; {:root &quot;public&quot;}))</code> however <code>login.html</code> doesn&apos;t see the <code>main.css</code> specified as <code>href=&quot;styles/main.css&quot;</code></z><z id="t1490629408" t="weavejester Do you have a resources/public/styles/main.css file?"><y>#</y><d>2017-03-27</d><h>15:43</h><w>weavejester</w>Do you have a <code>resources/public/styles/main.css</code> file?</z><z id="t1490629826" t="weavejester Also if you‚Äôre serving from a subpath, styles/main.css might be problematic"><y>#</y><d>2017-03-27</d><h>15:50</h><w>weavejester</w>Also if you‚Äôre serving from a subpath, <code>styles/main.css</code> might be problematic</z><z id="t1490630036" t="petr.mensik 1) yes"><y>#</y><d>2017-03-27</d><h>15:53</h><w>petr.mensik</w>1) yes</z><z id="t1490630044" t="petr.mensik 2) what do you mean?"><y>#</y><d>2017-03-27</d><h>15:54</h><w>petr.mensik</w>2) what do you mean?</z><z id="t1490630083" t="petr.mensik Sorry for being noob here, I just have a feeling that I am missing something important so I&apos;d rather ask than stay as dumb as I am now üôÇ"><y>#</y><d>2017-03-27</d><h>15:54</h><w>petr.mensik</w>Sorry for being noob here, I just have a feeling that I am missing something important so I&apos;d rather ask than stay as dumb as I am now <b>üôÇ</b></z><z id="t1490630296" t="weavejester With relative paths, the ending slash on a URL is significant"><y>#</y><d>2017-03-27</d><h>15:58</h><w>weavejester</w>With relative paths, the ending slash on a URL is significant</z><z id="t1490630299" t="weavejester So for instance..."><y>#</y><d>2017-03-27</d><h>15:58</h><w>weavejester</w>So for instance...</z><z id="t1490630339" t="weavejester If your page is at /foo , then a link to styles/main.css will go to /styles/main.css"><y>#</y><d>2017-03-27</d><h>15:58</h><w>weavejester</w>If your page is at <code>/foo</code>, then a link to <code>styles/main.css</code> will go to <code>/styles/main.css</code></z><z id="t1490630361" t="weavejester If your page is at /foo/ , then a link to styles/main.css will go to /foo/styles/main.css ."><y>#</y><d>2017-03-27</d><h>15:59</h><w>weavejester</w>If your page is at <code>/foo/</code>, then a link to <code>styles/main.css</code> will go to <code>/foo/styles/main.css</code>.</z><z id="t1490630421" t="weavejester So if your war file is being loaded from a subpath, you might run into problems with relative paths."><y>#</y><d>2017-03-27</d><h>16:00</h><w>weavejester</w>So if your war file is being loaded from a subpath, you might run into problems with relative paths.</z><z id="t1490630479" t="weavejester That‚Äôs why Hiccup has the wrap-base-url middleware, for instance"><y>#</y><d>2017-03-27</d><h>16:01</h><w>weavejester</w>That‚Äôs why Hiccup has the <code>wrap-base-url</code> middleware, for instance</z><z id="t1490630882" t="petr.mensik That&apos;s the thing, I am refactoring older application so I dont really want to modify whole frontend part."><y>#</y><d>2017-03-27</d><h>16:08</h><w>petr.mensik</w>That&apos;s the thing, I am refactoring older application so I dont really want to modify whole frontend part.</z><z id="t1490630994" t="weavejester Are you serving from a subpath?"><y>#</y><d>2017-03-27</d><h>16:09</h><w>weavejester</w>Are you serving from a subpath?</z><z id="t1490631033" t="weavejester And does the issue of not being able to find styles/main.css only occur when you‚Äôve deployed via a war?"><y>#</y><d>2017-03-27</d><h>16:10</h><w>weavejester</w>And does the issue of not being able to find <code>styles/main.css</code> only occur when you‚Äôve deployed via a war?</z><z id="t1490632532" t="alex.ter.weele Is it possible to use compojure middleware to reject a request with a Bad Request status?"><y>#</y><d>2017-03-27</d><h>16:35</h><w>alex.ter.weele</w>Is it possible to use compojure middleware to reject a request with a Bad Request status?</z><z id="t1490632970" t="weavejester [:attrs {:href &quot;/_/_/users/U36FNSJUC&quot;}] Sure"><y>#</y><d>2017-03-27</d><h>16:42</h><w>weavejester</w><a>@alex.ter.weele</a> Sure</z><z id="t1490633013" t="weavejester Just return a 400 status code if the request is bad."><y>#</y><d>2017-03-27</d><h>16:43</h><w>weavejester</w>Just return a 400 status code if the request is bad.</z><z id="t1490650927" t="alex.ter.weele ah, makes sense. I think I can make it work but I‚Äôm struggling with spec now üòõ"><y>#</y><d>2017-03-27</d><h>21:42</h><w>alex.ter.weele</w>ah, makes sense. I think I can make it work but I‚Äôm struggling with spec now <b>üòõ</b></z><z id="t1490658311" t="alex.ter.weele My application isn‚Äôt returning ‚Äô() when I expect it to. I think it‚Äôs because (isa? &apos;() compojure.response/Renderable) is false. Renderable is extended to ISeq , but (isa? &apos;() clojure.lang.ISeq) is also false. Is this by design? I can file a bug report if desired."><y>#</y><d>2017-03-27</d><h>23:45</h><w>alex.ter.weele</w>My application isn‚Äôt returning <code>‚Äô()</code> when I expect it to. I think it‚Äôs because <code>(isa? &apos;() compojure.response/Renderable)</code> is false. <code>Renderable</code> is extended to <code>ISeq</code>, but <code>(isa? &apos;() clojure.lang.ISeq)</code> is also false. Is this by design? I can file a bug report if desired.</z><z id="t1490659844" t="seancorfield Do you mean (isa? (class &apos;()) compojure.response/Renderable)"><y>#</y><d>2017-03-28</d><h>00:10</h><w>seancorfield</w>Do you mean <code>(isa? (class &apos;()) compojure.response/Renderable)</code></z><z id="t1490659887" t="seancorfield According to the docstring it looks like isa? expects classes, not an instance and a class‚Ä¶ (I don‚Äôt recall ever using isa? myself)"><y>#</y><d>2017-03-28</d><h>00:11</h><w>seancorfield</w>According to the docstring it looks like <code>isa?</code> expects classes, not an instance and a class‚Ä¶ (I don‚Äôt recall ever using <code>isa?</code> myself)</z><z id="t1490660529" t="alex.ter.weele you‚Äôre right, I meant to do (instance? clojure.lang.ISeq &apos;()) ‚Ä¶which evaluates to true. So now I‚Äôm not sure why what I had wasn‚Äôt working"><y>#</y><d>2017-03-28</d><h>00:22</h><w>alex.ter.weele</w>you‚Äôre right, I meant to do <code>(instance? clojure.lang.ISeq &apos;())</code>‚Ä¶which evaluates to true. So now I‚Äôm not sure why what I had wasn‚Äôt working</z><z id="t1490703289" t="weavejester What do you mean by ‚Äúisn‚Äôt returning &apos;()‚Äù?"><y>#</y><d>2017-03-28</d><h>12:14</h><w>weavejester</w>What do you mean by ‚Äúisn‚Äôt returning &apos;()‚Äù?</z><z id="t1490703316" t="weavejester [:attrs {:href &quot;/_/_/users/U36FNSJUC&quot;}] If &apos;() is in your response body, your body is empty."><y>#</y><d>2017-03-28</d><h>12:15</h><w>weavejester</w><a>@alex.ter.weele</a> If &apos;() is in your response body, your body is empty.</z><z id="t1490718055" t="scknkkrer Is there someone use docker swarm ?"><y>#</y><d>2017-03-28</d><h>16:20</h><w>scknkkrer</w>Is there someone use docker swarm ?</z><z id="t1490718082" t="scknkkrer My lein repl image doesn‚Äôt start."><y>#</y><d>2017-03-28</d><h>16:21</h><w>scknkkrer</w>My lein repl image doesn‚Äôt start.</z><z id="t1490718086" t="scknkkrer in swarm."><y>#</y><d>2017-03-28</d><h>16:21</h><w>scknkkrer</w>in swarm.</z><z id="t1490726997" t="alex.ter.weele sorry for not including more detail. I have endpoints like this: (GET &quot;/list&quot; _ (ok ())) (GET &quot;/vec&quot; _ (ok [])) The first will return an empty body. Looking at how compojure.response/render works, I see that returning an empty body is the intended behavior. (My problem is that I‚Äôm used to the extra behaviors of compojure-api, which would take a result like this and make it into an empty JSON list.) The second one is a little confusing. When I hit it, I get a 500 with an error message (from Jetty, maybe) in the body, saying &quot;Unrecognized body: []‚Äù. Seems like render doesn‚Äôt handle that type. Now that I know this, I can get around it by putting write-json in the right place. Thanks for the help!"><y>#</y><d>2017-03-28</d><h>18:49</h><w>alex.ter.weele</w>sorry for not including more detail. I have endpoints like this:
<pre>(GET &quot;/list&quot; _ (ok ()))
(GET &quot;/vec&quot; _ (ok []))</pre>
The first will return an empty body. Looking at how <code>compojure.response/render</code> works, I see that returning an empty body is the intended behavior.
(My problem is that I‚Äôm used to the extra behaviors of compojure-api, which would take a result like this and make it into an empty JSON list.)
The second one is a little confusing. When I hit it, I get a 500 with an error message (from Jetty, maybe) in the body, saying &quot;Unrecognized body: []‚Äù. Seems like <code>render</code> doesn‚Äôt handle that type.
Now that I know this, I can get around it by putting <code>write-json</code> in the right place. Thanks for the help!</z><z id="t1491501563" t="juliobarros anyone know of a good example using a new style ring async handler? I‚Äôm following the ring docs and returning a three argument function but am getting an Arity exception ‚ÄúWrong number of args ‚Ä¶‚Äù"><y>#</y><d>2017-04-06</d><h>17:59</h><w>juliobarros</w>anyone know of a good example using a new style ring async handler? I‚Äôm following the ring docs and returning a three argument function but am getting an Arity exception ‚ÄúWrong number of args ‚Ä¶‚Äù</z><z id="t1491533133" t="weavejester [:attrs {:href &quot;/_/_/users/U050N5T47&quot;}] Have you set the adapter to :async? true ?"><y>#</y><d>2017-04-07</d><h>02:45</h><w>weavejester</w><a>@juliobarros</a> Have you set the adapter to <code>:async? true</code>?</z><z id="t1491533308" t="juliobarros [:attrs {:href &quot;/_/_/users/U0BKWMG5B&quot;}] yes I have. Thought maybe it was some idle ware getting in the way. I even tried a bare bones ring app. Don&apos;t know what I could be missing. "><y>#</y><d>2017-04-07</d><h>02:48</h><w>juliobarros</w><a>@weavejester</a> yes I have. Thought maybe it was some idle ware getting in the way. I even tried a bare bones ring app. Don&apos;t know what I could be missing. </z><z id="t1491534452" t="seancorfield [:attrs {:href &quot;/_/_/users/U050N5T47&quot;}] Just a wild thought: have you confirmed that a rogue version of Ring isn&apos;t being pulled in?"><y>#</y><d>2017-04-07</d><h>03:07</h><w>seancorfield</w><a>@juliobarros</a> Just a wild thought: have you confirmed that a rogue version of Ring isn&apos;t being pulled in?</z><z id="t1491534633" t="juliobarros [:attrs {:href &quot;/_/_/users/U04V70XH6&quot;}] no. I didn&apos;t check for that. I&apos;ll look again with a clear head in the morning. Thanks. "><y>#</y><d>2017-04-07</d><h>03:10</h><w>juliobarros</w><a>@seancorfield</a> no. I didn&apos;t check for that. I&apos;ll look again with a clear head in the morning. Thanks. </z><z id="t1491539922" t="seancorfield First time I&apos;ve tried the async handlers in Ring... works fine as long as I only call respond to return normal responses. If I call raise , that first request completes (with a server 500 error as expected)... but then no further requests work and I see thread death exceptions in the console log. I can&apos;t find a tutorial for the async version of Ring to see if I&apos;m doing wrong..."><y>#</y><d>2017-04-07</d><h>04:38</h><w>seancorfield</w>First time I&apos;ve tried the async handlers in Ring... works fine as long as I only call <code>respond</code> to return normal responses. If I call <code>raise</code>, that first request completes (with a server 500 error as expected)... but then no further requests work and I see thread death exceptions in the console log. I can&apos;t find a tutorial for the async version of Ring to see if I&apos;m doing wrong...</z><z id="t1491570406" t="weavejester [:attrs {:href &quot;/_/_/users/U04V70XH6&quot;}] It‚Äôs possible that might not have been tested, especially if you‚Äôre not using wrap-stacktrace or some other form of middleware that catches the error. I‚Äôll look into it."><y>#</y><d>2017-04-07</d><h>13:06</h><w>weavejester</w><a>@seancorfield</a> It‚Äôs possible that might not have been tested, especially if you‚Äôre not using <code>wrap-stacktrace</code> or some other form of middleware that catches the error. I‚Äôll look into it.</z><z id="t1491570926" t="weavejester Hm, I‚Äôm not able to reproduce the error, I‚Äôm afraid."><y>#</y><d>2017-04-07</d><h>13:15</h><w>weavejester</w>Hm, I‚Äôm not able to reproduce the error, I‚Äôm afraid.</z><z id="t1491571358" t="weavejester I added some tests ( https://github.com/ring-clojure/ring/commit/4b5423336f8b948620a9dffb295aff551055499f ), but maybe you‚Äôre doing something I haven‚Äôt thought of, or there‚Äôs some combination of middleware that‚Äôs messing up somehow."><y>#</y><d>2017-04-07</d><h>13:22</h><w>weavejester</w>I added some tests (<a href="https://github.com/ring-clojure/ring/commit/4b5423336f8b948620a9dffb295aff551055499f" target="_blank">https://github.com/ring-clojure/ring/commit/4b5423336f8b948620a9dffb295aff551055499f</a>), but maybe you‚Äôre doing something I haven‚Äôt thought of, or there‚Äôs some combination of middleware that‚Äôs messing up somehow.</z><z id="t1491571405" t="weavejester If you can give me something reproducible [:attrs {:href &quot;/_/_/users/U04V70XH6&quot;}] , it would be a lot of help üôÇ"><y>#</y><d>2017-04-07</d><h>13:23</h><w>weavejester</w>If you can give me something reproducible <a>@seancorfield</a>, it would be a lot of help <b>üôÇ</b></z><z id="t1491937527" t="seancorfield [:attrs {:href &quot;/_/_/users/U0BKWMG5B&quot;}] Here‚Äôs a minimal repo showing the problem I ran into https://github.com/seancorfield/ring-async-bug ‚Äî not sure if it‚Äôs a bug or user error üôÇ"><y>#</y><d>2017-04-11</d><h>19:05</h><r>seancorfield</r><a>@weavejester</a> Here‚Äôs a minimal repo showing the problem I ran into <a href="https://github.com/seancorfield/ring-async-bug" target="_blank">https://github.com/seancorfield/ring-async-bug</a> ‚Äî not sure if it‚Äôs a bug or user error <b>üôÇ</b></z><z id="t1491938178" t="weavejester Thanks for the repo. Unfortunately I can‚Äôt reproduce the error, even with the repo! What O/S and Java version are you running it under?"><y>#</y><d>2017-04-11</d><h>19:16</h><r>weavejester</r>Thanks for the repo. Unfortunately I can‚Äôt reproduce the error, even with the repo! What O/S and Java version are you running it under?</z><z id="t1491942139" t="seancorfield I repro‚Äôd on both Mac OS X, Java 8, and Windows 10, Java 8."><y>#</y><d>2017-04-11</d><h>20:22</h><r>seancorfield</r>I repro‚Äôd on both Mac OS X, Java 8, and Windows 10, Java 8.</z><z id="t1491942191" t="seancorfield Specifically on Mac OS X java version &quot;1.8.0_31&quot; Java(TM) SE Runtime Environment (build 1.8.0_31-b13) Java HotSpot(TM) 64-Bit Server VM (build 25.31-b07, mixed mode) "><y>#</y><d>2017-04-11</d><h>20:23</h><r>seancorfield</r>Specifically on Mac OS X <pre>java version &quot;1.8.0_31&quot;
Java(TM) SE Runtime Environment (build 1.8.0_31-b13)
Java HotSpot(TM) 64-Bit Server VM (build 25.31-b07, mixed mode)
</pre></z><z id="t1491942215" t="seancorfield Roughly the same on W10 but I can check for sure if you need it."><y>#</y><d>2017-04-11</d><h>20:23</h><r>seancorfield</r>Roughly the same on W10 but I can check for sure if you need it.</z><z id="t1491942285" t="seancorfield Pretty sure on W10 I‚Äôve tried it both natively on Windows and also via WSL (Ubuntu)."><y>#</y><d>2017-04-11</d><h>20:24</h><r>seancorfield</r>Pretty sure on W10 I‚Äôve tried it both natively on Windows and also via WSL (Ubuntu).</z><z id="t1492027271" t="weavejester Hm, odd. I‚Äôm using MacOS and Java 8 as well. Let me try upgrading to the exact version you‚Äôre using, and wiping out my .m2 directory just in case there‚Äôs something there that‚Äôs making it work for me."><y>#</y><d>2017-04-12</d><h>20:01</h><r>weavejester</r>Hm, odd. I‚Äôm using MacOS and Java 8 as well. Let me try upgrading to the exact version you‚Äôre using, and wiping out my .m2 directory just in case there‚Äôs something there that‚Äôs making it work for me.</z><z id="t1492027772" t="seancorfield LMK if there‚Äôs additional debugging I can do for you based on that repo. It‚Äôs 100% reproducible for me on every platform so far üôÇ"><y>#</y><d>2017-04-12</d><h>20:09</h><r>seancorfield</r>LMK if there‚Äôs additional debugging I can do for you based on that repo. It‚Äôs 100% reproducible for me on every platform so far <b>üôÇ</b></z><z id="t1492027822" t="weavejester Thanks. I‚Äôm going to try and reproduce it on my machine first. So far no dice. I‚Äôve wiped out my .m2 directory and it still works fine. Going to try upgrading the patch version of Java."><y>#</y><d>2017-04-12</d><h>20:10</h><r>weavejester</r>Thanks. I‚Äôm going to try and reproduce it on my machine first. So far no dice. I‚Äôve wiped out my .m2 directory and it still works fine. Going to try upgrading the patch version of Java.</z><z id="t1492028007" t="weavejester Oh, another thought strikes me: what are you using to test it? curl?"><y>#</y><d>2017-04-12</d><h>20:13</h><r>weavejester</r>Oh, another thought strikes me: what are you using to test it? curl?</z><z id="t1492028450" t="weavejester Updated Java, still no error..."><y>#</y><d>2017-04-12</d><h>20:20</h><r>weavejester</r>Updated Java, still no error...</z><z id="t1492029997" t="weavejester I am seeing some weirdness in the logs, however. It might be related to .sendError and .complete ."><y>#</y><d>2017-04-12</d><h>20:46</h><r>weavejester</r>I am seeing some weirdness in the logs, however. It might be related to <code>.sendError</code> and <code>.complete</code>.</z><z id="t1492030078" t="weavejester The Javadocs for .sendError say &quot;After using this method, the response should be considered to be committed‚Äù, but maybe that doesn‚Äôt mean the response actually is committed, and therefore .complete should still be used."><y>#</y><d>2017-04-12</d><h>20:47</h><r>weavejester</r>The Javadocs for <code>.sendError</code> say &quot;After using this method, the response should be considered to be committed‚Äù, but maybe that doesn‚Äôt mean the response actually is committed, and therefore <code>.complete</code> should still be used.</z><z id="t1492030304" t="weavejester Okay, I think I might know why it‚Äôs failing. Can you try adding [weavejester/ring-jetty-adapter ‚Äú1.6.0-SNAPSHOT‚Äù] to your dependencies and see if that code works?"><y>#</y><d>2017-04-12</d><h>20:51</h><r>weavejester</r>Okay, I think I might know why it‚Äôs failing. Can you try adding <code>[weavejester/ring-jetty-adapter ‚Äú1.6.0-SNAPSHOT‚Äù]</code> to your dependencies and see if that code works?</z><z id="t1492044857" t="seancorfield Just tested ‚Äî that seems to fix it! Excellent!"><y>#</y><d>2017-04-13</d><h>00:54</h><r>seancorfield</r>Just tested ‚Äî that seems to fix it! Excellent!</z><z id="t1492044884" t="seancorfield I gather an updated ring/ring-jetty-adapter release is in our near future? üôÇ"><y>#</y><d>2017-04-13</d><h>00:54</h><r>seancorfield</r>I gather an updated <code>ring/ring-jetty-adapter</code> release is in our near future? <b>üôÇ</b></z><z id="t1492115675" t="weavejester Great! I‚Äôll release RC3 in a little while. It looks like I misinterpreted the Javadoc for the .sendError method, or else it‚Äôs misinterpreted by Jetty! In either case, it shouldn‚Äôt hurt to add a .complete after .sendError ."><y>#</y><d>2017-04-13</d><h>20:34</h><r>weavejester</r>Great! I‚Äôll release RC3 in a little while. It looks like I misinterpreted the Javadoc for the  <code>.sendError</code> method, or else it‚Äôs misinterpreted by Jetty! In either case, it shouldn‚Äôt hurt to add a <code>.complete</code> after <code>.sendError</code>.</z></g><g id="s3"><z id="t1491601675" t="seancorfield Sure. I&apos;m on vacation but will try to remember on Monday. I have a minimal example with just wrap-params and wrap-keyword-params and nothing else. "><y>#</y><d>2017-04-07</d><h>21:47</h><w>seancorfield</w>Sure. I&apos;m on vacation but will try to remember on Monday. I have a minimal example with just wrap-params and wrap-keyword-params and nothing else. </z><z id="t1491856096" t="urbanslug Hello, under jetty docs ( https://www.eclipse.org/jetty/documentation/current/high-load.html ) it mentions that on a server we should pass it the -server option. Is this what leing ring server does? Because I can&apos;t see it mentioned here https://ring-clojure.github.io/ring/ring.adapter.jetty.html"><y>#</y><d>2017-04-10</d><h>20:28</h><w>urbanslug</w>Hello, under jetty docs (<a href="https://www.eclipse.org/jetty/documentation/current/high-load.html" target="_blank">https://www.eclipse.org/jetty/documentation/current/high-load.html</a>) it mentions that on a server we should pass it the <code>-server</code> option. Is this what <code>leing ring server</code> does? Because I can&apos;t see it mentioned here <a href="https://ring-clojure.github.io/ring/ring.adapter.jetty.html" target="_blank">https://ring-clojure.github.io/ring/ring.adapter.jetty.html</a></z><z id="t1491856133" t="urbanslug Seems like an obvious question but I have to ask"><y>#</y><d>2017-04-10</d><h>20:28</h><w>urbanslug</w>Seems like an obvious question but I have to ask</z><z id="t1491856227" t="urbanslug Can&apos;t find the answer by quickly looking in the jetty-adapter code."><y>#</y><d>2017-04-10</d><h>20:30</h><w>urbanslug</w>Can&apos;t find the answer by quickly looking in the jetty-adapter code.</z><z id="t1491868399" t="weavejester -server is just an option you can pass to the JVM. It used to be the case that you could run Java in -client or -server mode. I believe that at least for 64bit versions, those options no longer do anything."><y>#</y><d>2017-04-10</d><h>23:53</h><w>weavejester</w><code>-server</code> is just an option you can pass to the JVM. It used to be the case that you could run Java in <code>-client</code> or <code>-server</code> mode. I believe that at least for 64bit versions, those options no longer do anything.</z><z id="t1491870552" t="kasuko Hey I am having an issue that the :body of my request is empty. I have read that you can only read the body of a request once. Is there a way to debug where that read is happening? It‚Äôs a pretty complex webapp with a bunch of middleware and endpoints and stuff and I can‚Äôt seem to find it via manually tracing it."><y>#</y><d>2017-04-11</d><h>00:29</h><w>kasuko</w>Hey I am having an issue that the :body of my request is empty. I have read that you can only read the body of a request once. Is there a way to debug where that read is happening? It‚Äôs a pretty complex webapp with a bunch of middleware and endpoints and stuff and I can‚Äôt seem to find it via manually tracing it.</z><z id="t1491879677" t="weavejester [:attrs {:href &quot;/_/_/users/U0YKGA0BT&quot;}] There‚Äôs a BrokenInputStream class in Apache Commons I/O that you could use. Create a request and use the broken input stream as the body, then push it through your handler and use the stacktrace to see where the body was read from."><y>#</y><d>2017-04-11</d><h>03:01</h><w>weavejester</w><a>@kasuko</a> There‚Äôs a <code>BrokenInputStream</code> class in Apache Commons I/O that you could use. Create a request and use the broken input stream as the body, then push it through your handler and use the stacktrace to see where the body was read from.</z><z id="t1491917458" t="eostman Hello! How would one make a ‚Äúpath-for‚Äù a route in another namespace?"><y>#</y><d>2017-04-11</d><h>13:30</h><w>eostman</w>Hello! How would one make a ‚Äúpath-for‚Äù a route in another namespace?</z><z id="t1491934268" t="weavejester [:attrs {:href &quot;/_/_/users/U3H65DSKV&quot;}] Not sure what you mean by that"><y>#</y><d>2017-04-11</d><h>18:11</h><w>weavejester</w><a>@eostman</a> Not sure what you mean by that</z><z id="t1491937569" t="seancorfield LMK if you‚Äôd rather I opened an issue directly for tracking purposes‚Ä¶"><y>#</y><d>2017-04-11</d><h>19:06</h><w>seancorfield</w>LMK if you‚Äôd rather I opened an issue directly for tracking purposes‚Ä¶</z><z id="t1492018935" t="jussi Hi, I‚Äôm using ring-logger 0.7.7. When I wrap my app with wrap-with-logger , I get an odd logging output: Apr 12, 2017 8:40:29 PM clojure.tools.logging$eval3622$fn__3626 invoke INFO: Finished :post / for 0:0:0:0:0:0:0:1 Status: 200 What does that clojure.tools.logging$eval3622$fn__3626 invoke mean?"><y>#</y><d>2017-04-12</d><h>17:42</h><w>jussi</w>Hi, I‚Äôm using ring-logger 0.7.7. When I wrap my app with <code>wrap-with-logger</code>, I get an odd logging output:

<pre>Apr 12, 2017 8:40:29 PM clojure.tools.logging$eval3622$fn__3626 invoke
INFO: Finished :post / for 0:0:0:0:0:0:0:1 Status: 200
</pre>

What does that <code>clojure.tools.logging$eval3622$fn__3626 invoke</code> mean?</z><z id="t1492031618" t="lumengxi [:attrs {:href &quot;/_/_/users/U3BUZ2BPZ&quot;}] this is probably the caller location, meaning this log line is generated around that function"><y>#</y><d>2017-04-12</d><h>21:13</h><w>lumengxi</w><a>@jussi</a> this is probably the caller location, meaning this log line is generated around that function</z><z id="t1492103653" t="tjtolton is there a good ring middleware that will convert the keys of incoming json requests to use dashes instead of underscores?"><y>#</y><d>2017-04-13</d><h>17:14</h><w>tjtolton</w>is there a good ring middleware that will convert the keys of incoming json requests to use dashes instead of underscores?</z><z id="t1492106517" t="bostonaholic that might be a good PR suggestion for ring.middleware.keyword-params/wrap-keyword-params"><y>#</y><d>2017-04-13</d><h>18:01</h><w>bostonaholic</w>that might be a good PR suggestion for <code>ring.middleware.keyword-params/wrap-keyword-params</code></z><z id="t1492106547" t="bostonaholic as an option"><y>#</y><d>2017-04-13</d><h>18:02</h><w>bostonaholic</w>as an option</z><z id="t1492184644" t="tjtolton that&apos;s exactly what I ended up doing. just forked it and had it pass a :key-fn in opts the same way wrap-json-response works. could submit it as a PR, but i suspect its probably opening up to many unanswered questions"><y>#</y><d>2017-04-14</d><h>15:44</h><w>tjtolton</w>that&apos;s exactly what I ended up doing.  just forked it and had it pass a :key-fn in opts the same way <code>wrap-json-response</code> works.  could submit it as a PR, but i suspect its probably opening up to many unanswered questions</z><z id="t1492184655" t="tjtolton [:attrs {:href &quot;/_/_/users/U066DVDM5&quot;}]"><y>#</y><d>2017-04-14</d><h>15:44</h><w>tjtolton</w><a>@bostonaholic</a></z><z id="t1492184765" t="bostonaholic I would still open up the PR, maybe the author has thought about it and why it might be a good or bad idea. If the author of ring wishes to not include your feature, then stick with your fork (Knowing that you‚Äôll want to pull from upstream when new versions are released)."><y>#</y><d>2017-04-14</d><h>15:46</h><w>bostonaholic</w>I would still open up the PR, maybe the author has thought about it and why it might be a good or bad idea. If the author of ring wishes to not include your feature, then stick with your fork (Knowing that you‚Äôll want to pull from upstream when new versions are released).</z><z id="t1492363115" t="Benjamin C [:attrs {:href &quot;/_/_/users/U0BKWMG5B&quot;}] What is the preferred way to convert keywords from camelCase to kebab when using wrap-json-body in ring/ring-json?"><y>#</y><d>2017-04-16</d><h>17:18</h><w>Benjamin C</w><a>@weavejester</a> What is the preferred way to convert keywords from camelCase to kebab when using wrap-json-body in ring/ring-json?</z><z id="t1492363235" t="weavejester [:attrs {:href &quot;/_/_/users/U0D7QDZ6J&quot;}] However you want. If you search https://www.clojure-toolbox.com/ for ‚ÄúString Manipulation‚Äù there are a few libraries that provide naming conversions."><y>#</y><d>2017-04-16</d><h>17:20</h><w>weavejester</w><a>@benjamingramlich</a> However you want. If you search <a href="https://www.clojure-toolbox.com/" target="_blank">https://www.clojure-toolbox.com/</a> for ‚ÄúString Manipulation‚Äù there are a few libraries that provide naming conversions.</z><z id="t1492363305" t="Benjamin C are you open to a PR which supports it with a :key-fn option?"><y>#</y><d>2017-04-16</d><h>17:21</h><w>Benjamin C</w>are you open to a PR which supports it with a :key-fn option?</z><z id="t1492363478" t="Benjamin C something like (wrap-json-body handler {:keywords? true :key-fn -&gt;kebab-case-keyword}) ?"><y>#</y><d>2017-04-16</d><h>17:24</h><w>Benjamin C</w>something like <code>(wrap-json-body handler {:keywords? true :key-fn -&gt;kebab-case-keyword})</code>?</z><z id="t1492363512" t="weavejester Support for a :key-fn would be fine. It might be a week until I can get around to merging it though."><y>#</y><d>2017-04-16</d><h>17:25</h><w>weavejester</w>Support for a <code>:key-fn</code> would be fine. It might be a week until I can get around to merging it though.</z><z id="t1492363550" t="Benjamin C okay. thanks. i‚Äôll make a PR soonish."><y>#</y><d>2017-04-16</d><h>17:25</h><w>Benjamin C</w>okay. thanks. i‚Äôll make a PR soonish.</z><z id="t1492363709" t="weavejester Thanks üôÇ"><y>#</y><d>2017-04-16</d><h>17:28</h><w>weavejester</w>Thanks <b>üôÇ</b></z><z id="t1492708764" t="uwo Is it generally discouraged to encode data structures as values in cookie - say, using url-encoding - even if they are small?"><y>#</y><d>2017-04-20</d><h>17:19</h><w>uwo</w>Is it generally discouraged to encode data structures as values in cookie - say, using url-encoding - even if they are small?</z><z id="t1492778859" t="weavejester [:attrs {:href &quot;/_/_/users/U09QBCNBY&quot;}] Well, the client can alter the cookie unless you HMAC it. I guess you could use it for settings, but typically you‚Äôd use the session."><y>#</y><d>2017-04-21</d><h>12:47</h><w>weavejester</w><a>@uwo</a> Well, the client can alter the cookie unless you HMAC it. I guess you could use it for settings, but typically you‚Äôd use the session.</z><z id="t1492780682" t="uwo [:attrs {:href &quot;/_/_/users/U0BKWMG5B&quot;}] thx!"><y>#</y><d>2017-04-21</d><h>13:18</h><w>uwo</w><a>@weavejester</a> thx!</z><z id="t1493385572" t="dergutemoritz Is anyone aware of a gzip Ring middleware that produces Transfer-Encoding headers rather than Content-Encoding ? The latter comes with a whole bag of consequences (e.g. for validity of ETag headers) but all middlewares I could find so far use it for some reason..."><y>#</y><d>2017-04-28</d><h>13:19</h><w>dergutemoritz</w>Is anyone aware of a gzip Ring middleware that produces <code>Transfer-Encoding</code> headers rather than <code>Content-Encoding</code>? The latter comes with a whole bag of consequences (e.g. for validity of <code>ETag</code> headers) but all middlewares I could find so far use it for some reason...</z><z id="t1493385985" t="dergutemoritz OK some further research suggests that many clients don&apos;t implement Transfer-Encoding: gzip üòï"><y>#</y><d>2017-04-28</d><h>13:26</h><w>dergutemoritz</w>OK some further research suggests that many clients don&apos;t implement <code>Transfer-Encoding: gzip</code> <b>üòï</b></z><z id="t1493386031" t="dergutemoritz Makes these middlewares kinda hard to use properly with ETag . Oh well."><y>#</y><d>2017-04-28</d><h>13:27</h><w>dergutemoritz</w>Makes these middlewares kinda hard to use properly with <code>ETag</code>. Oh well.</z><z id="t1494952675" t="fabrao Hello all, is there any way to do async response of a route?"><y>#</y><d>2017-05-16</d><h>16:37</h><w>fabrao</w>Hello all, is there any way to do async response of a route?</z><z id="t1494952778" t="fabrao (GET &quot;/login&quot; {params :params} (valid-login (params :username) (params :password))) -&gt; calls an ajax request and handles async response"><y>#</y><d>2017-05-16</d><h>16:39</h><w>fabrao</w><pre>(GET &quot;/login&quot; {params :params} (valid-login (params :username) (params :password)))</pre> -&gt; calls an ajax request and handles async response</z><z id="t1494952800" t="fabrao how to handle with that?"><y>#</y><d>2017-05-16</d><h>16:40</h><w>fabrao</w>how to handle with that?</z><z id="t1494952850" t="fabrao (defn valid-login [usuario senha] (ajax/ajax-request {:uri &quot;https://******/login?$format=JSON&quot; :method :post :params {:username usuario :password senha} :format (ajax/url-request-format) :response-format (ajax/json-response-format {:keywords? true}) :error-handler #(response {:resposta &quot;OK&quot;}) :handler #(response {:resposta &quot;OK&quot;}) }) )"><y>#</y><d>2017-05-16</d><h>16:40</h><w>fabrao</w><pre>(defn valid-login [usuario senha]
  (ajax/ajax-request
   {:uri &quot;https://******/login?$format=JSON&quot;
    :method :post
    :params {:username usuario
             :password senha}
    :format (ajax/url-request-format)
    :response-format (ajax/json-response-format {:keywords? true})
    :error-handler #(response {:resposta &quot;OK&quot;})
    :handler #(response {:resposta &quot;OK&quot;})
    })
  )</pre></z><z id="t1494954784" t="weavejester [:attrs {:href &quot;/_/_/users/U0YJJPFRA&quot;}] Yes, you return a three-argument handler, like:"><y>#</y><d>2017-05-16</d><h>17:13</h><w>weavejester</w><a>@fabrao</a> Yes, you return a three-argument handler, like:</z><z id="t1494954834" t="weavejester (GET &quot;/login&quot; [username password] (fn [_ respond _] (respond (valid-login username password)))) "><y>#</y><d>2017-05-16</d><h>17:13</h><w>weavejester</w><pre>(GET &quot;/login&quot; [username password]
  (fn [_ respond _]
    (respond (valid-login username password))))
</pre></z><z id="t1494954849" t="weavejester That‚Äôs using respond synchronously, but you can pass it as a callback."><y>#</y><d>2017-05-16</d><h>17:14</h><w>weavejester</w>That‚Äôs using <code>respond</code> synchronously, but you can pass it as a callback.</z><z id="t1494954875" t="weavejester Or extend the compojure.response/Sendable protocol for channels or some other asynchronous abstraction."><y>#</y><d>2017-05-16</d><h>17:14</h><w>weavejester</w>Or extend the <code>compojure.response/Sendable</code> protocol for channels or some other asynchronous abstraction.</z><z id="t1494955100" t="fabrao [:attrs {:href &quot;/_/_/users/U0BKWMG5B&quot;}] I tested it but it¬¥s getting &quot;class ajax.apache$to_clojure_future$reify__72385 is not understandable&quot;"><y>#</y><d>2017-05-16</d><h>17:18</h><w>fabrao</w><a>@weavejester</a> I tested it but it¬¥s getting &quot;class ajax.apache$to_clojure_future$reify__72385 is not understandable&quot;</z><z id="t1494955186" t="weavejester Do you have the :async? option set on the adapter? Are you using Compojure 1.6.0 and Ring 1.6.1? Are you trying to return some kind of custom async object?"><y>#</y><d>2017-05-16</d><h>17:19</h><w>weavejester</w>Do you have the <code>:async?</code> option set on the adapter? Are you using Compojure 1.6.0 and Ring 1.6.1? Are you trying to return some kind of custom async object?</z><z id="t1494955250" t="fabrao [ring/ring-defaults &quot;0.2.1&quot;] [ring/ring-json &quot;0.5.0-beta1&quot;] [buddy/buddy-auth &quot;1.4.1&quot;] [compojure &quot;1.5.0&quot;]"><y>#</y><d>2017-05-16</d><h>17:20</h><w>fabrao</w>[ring/ring-defaults &quot;0.2.1&quot;]
                 [ring/ring-json &quot;0.5.0-beta1&quot;]
                 [buddy/buddy-auth &quot;1.4.1&quot;]

                 [compojure &quot;1.5.0&quot;]</z><z id="t1494955342" t="fabrao how do I set :async?"><y>#</y><d>2017-05-16</d><h>17:22</h><w>fabrao</w>how do I set <code>:async?</code></z><z id="t1494955371" t="weavejester You need to upgrade your dependencies, and you need to set :async? true to your Jetty adapter."><y>#</y><d>2017-05-16</d><h>17:22</h><w>weavejester</w>You need to upgrade your dependencies, and you need to set <code>:async? true</code> to your Jetty adapter.</z><z id="t1494955440" t="fabrao I¬¥m using figwheel ring handler"><y>#</y><d>2017-05-16</d><h>17:24</h><w>fabrao</w>I¬¥m using figwheel ring handler</z><z id="t1494955483" t="fabrao is that possible to set :async? true to ring-handler?"><y>#</y><d>2017-05-16</d><h>17:24</h><w>fabrao</w>is that possible to set <code>:async? true</code> to ring-handler?</z><z id="t1494955505" t="weavejester Not sure. It might be an option. Take a look through the docs."><y>#</y><d>2017-05-16</d><h>17:25</h><w>weavejester</w>Not sure. It might be an option. Take a look through the docs.</z><z id="t1494955520" t="weavejester I need to go. bbl"><y>#</y><d>2017-05-16</d><h>17:25</h><w>weavejester</w>I need to go. bbl</z><z id="t1496164019" t="petr.mensik Hello, just a quickie, is it possible to use some middleware to automatically process JSON array as Clojure vector? :params {:contact_id &quot;1&quot;, :companies &quot;[1, 2]&quot;}, Thanks a lot"><y>#</y><d>2017-05-30</d><h>17:06</h><w>petr.mensik</w>Hello, just a quickie, is it possible to use some middleware to automatically process JSON array as Clojure vector? 
<pre>:params {:contact_id &quot;1&quot;, :companies &quot;[1, 2]&quot;},</pre> 
Thanks a lot</z><z id="t1496164063" t="petr.mensik I can do (get-in request [:params :companies]) , however the array is interpreted as string"><y>#</y><d>2017-05-30</d><h>17:07</h><w>petr.mensik</w>I can do <code>(get-in request [:params :companies])</code>, however the array is interpreted as string</z><z id="t1496164098" t="petr.mensik I am using wrap-json-params from ring.middleware.json"><y>#</y><d>2017-05-30</d><h>17:08</h><w>petr.mensik</w>I am using <code>wrap-json-params</code> from <code>ring.middleware.json</code></z><z id="t1496186403" t="weavejester Yes, but you‚Äôll need to write your own middleware, @pter.mensik"><y>#</y><d>2017-05-30</d><h>23:20</h><w>weavejester</w>Yes, but you‚Äôll need to write your own middleware, @pter.mensik</z><z id="t1496383145" t="isaac IMO, the ring should use namespaced keys, eg. :ring/body, :ring/headers"><y>#</y><d>2017-06-02</d><h>05:59</h><w>isaac</w>IMO, the ring should use namespaced  keys, eg. <code>:ring/body, :ring/headers</code></z><z id="t1496383234" t="seancorfield isaac: The Ring spec predates the recent popularity of namespaced keywords."><y>#</y><d>2017-06-02</d><h>06:00</h><r>seancorfield</r>isaac: The Ring spec predates the recent popularity of namespaced keywords.</z><z id="t1496414881" t="weavejester It‚Äôs something I‚Äôm planning to put forward for Ring 2.0, though the namespaces will be :ring.request/* and :ring.response/* ."><y>#</y><d>2017-06-02</d><h>14:48</h><r>weavejester</r>It‚Äôs something I‚Äôm planning to put forward for Ring 2.0, though the namespaces will be <code>:ring.request/*</code> and <code>:ring.response/*</code>.</z><z id="t1496643219" t="isaac üëç that would be better"><y>#</y><d>2017-06-05</d><h>06:13</h><r>isaac</r><b>üëç</b> that would be better</z><z id="t1496644878" t="isaac I think also, ring should use deferred to support asynchronize, instead of arity of handler"><y>#</y><d>2017-06-05</d><h>06:41</h><r>isaac</r>I think also, ring should use <code>deferred</code> to support asynchronize, instead of arity of handler</z><z id="t1496702571" t="weavejester deferred from Manifold?"><y>#</y><d>2017-06-05</d><h>22:42</h><r>weavejester</r>deferred from Manifold?</z><z id="t1496702590" t="weavejester Manifold is a significant size - it‚Äôs larger than Ring itself."><y>#</y><d>2017-06-05</d><h>22:43</h><r>weavejester</r>Manifold is a significant size - it‚Äôs larger than Ring itself.</z><z id="t1496702602" t="weavejester And others might want to use different async systems."><y>#</y><d>2017-06-05</d><h>22:43</h><r>weavejester</r>And others might want to use different async systems.</z><z id="t1496702626" t="weavejester Ring uses the lowest-common-denominator. The simplest async solution that can be translated into any other async system."><y>#</y><d>2017-06-05</d><h>22:43</h><r>weavejester</r>Ring uses the lowest-common-denominator. The simplest async solution that can be translated into any other async system.</z><z id="t1496702650" t="weavejester If you want to use deferreds instead of the three-arity syntax, then it‚Äôs just three lines of middleware away."><y>#</y><d>2017-06-05</d><h>22:44</h><r>weavejester</r>If you want to use deferreds instead of the three-arity syntax, then it‚Äôs just three lines of middleware away.</z><z id="t1496799489" t="isaac actually, I like more async, I use promise-chan support asynchronization in my app internally. üôÇ"><y>#</y><d>2017-06-07</d><h>01:38</h><r>isaac</r>actually, I like more async, I use promise-chan support asynchronization in my app internally. <b>üôÇ</b></z><z id="t1496804443" t="weavejester Adding promise-chan support is also just a middleware away üôÇ"><y>#</y><d>2017-06-07</d><h>03:00</h><r>weavejester</r>Adding promise-chan support is also just a middleware away <b>üôÇ</b></z><z id="t1496705951" t="JAtkins Hi all! I have a question about partial file serving with ring. I have a handler that takes a file id, finds that file location, and then serves it. I want to make this endpoint compatible with partial file loading, but I can&apos;t find any information about it on the web, aside from ( https://github.com/remvee/ring-partial-content ). (It seems to work only with wrap-file , and I don&apos;t think that fits my usecase, but I may be wrong). Does anyone have experiance with this problem?"><y>#</y><d>2017-06-05</d><h>23:39</h><w>JAtkins</w>Hi all! I have a question about partial file serving with ring. I have a handler that takes a file id, finds that file location, and then serves it. I want to make this endpoint compatible with partial file loading, but I can&apos;t find any information about it on the web, aside from (<a href="https://github.com/remvee/ring-partial-content" target="_blank">https://github.com/remvee/ring-partial-content</a>).  (It seems to work only with <code>wrap-file</code>, and I don&apos;t think that fits my usecase, but I may be wrong). Does anyone have experiance with this problem?</z><z id="t1496706319" t="weavejester [:attrs {:href &quot;/_/_/users/U5P29DSUS&quot;}] ring-partial-content looks like it works with strings, input streams, and files. It uses a multimethod, so it can be extended to any other type you want."><y>#</y><d>2017-06-05</d><h>23:45</h><w>weavejester</w><a>@jatkin</a> ring-partial-content looks like it works with strings, input streams, and files. It uses a multimethod, so it can be extended to any other type you want.</z><z id="t1496707174" t="JAtkins Ok, now I&apos;m a bit confused. I had this code: (def http-handler (-&gt; routes (wrap-defaults api-defaults) pc/wrap-partial-content wrap-gzip)) But that didn&apos;t work, as far as I could tell."><y>#</y><d>2017-06-05</d><h>23:59</h><w>JAtkins</w>Ok, now I&apos;m a bit confused. I had this code: <pre>(def http-handler
  (-&gt; routes
      (wrap-defaults api-defaults)
      pc/wrap-partial-content
      wrap-gzip))</pre> But that didn&apos;t work, as far as I could tell.</z><z id="t1496760119" t="kah0ona Hello guys, I have a problem with Content-Security-Headers being returned and preventing my .js files to be loaded. Where/how can I configure those? Is this something a recent version of Ring is doing, or is it in ring-headers?"><y>#</y><d>2017-06-06</d><h>14:41</h><w>kah0ona</w>Hello guys, I have a problem with Content-Security-Headers being returned and preventing my .js files to be loaded. Where/how can I configure those? Is this something a recent version of Ring is doing, or is it in ring-headers?</z><z id="t1496763378" t="weavejester [:attrs {:href &quot;/_/_/users/U2VRAHXEX&quot;}] Ring doesn‚Äôt add any itself, but Ring-Defaults does. Are you using that middleware?"><y>#</y><d>2017-06-06</d><h>15:36</h><w>weavejester</w><a>@kah0ona</a> Ring doesn‚Äôt add any itself, but Ring-Defaults does. Are you using that middleware?</z><z id="t1496763412" t="weavejester https://github.com/ring-clojure/ring-defaults#customizing"><y>#</y><d>2017-06-06</d><h>15:36</h><w>weavejester</w><a href="https://github.com/ring-clojure/ring-defaults#customizing" target="_blank">https://github.com/ring-clojure/ring-defaults#customizing</a></z><z id="t1496763459" t="kah0ona aah thanks"><y>#</y><d>2017-06-06</d><h>15:37</h><w>kah0ona</w>aah thanks</z><z id="t1496763530" t="kah0ona Do you know which specific middleware adds Content-Security-Headers?"><y>#</y><d>2017-06-06</d><h>15:38</h><w>kah0ona</w>Do you know which specific middleware adds Content-Security-Headers?</z><z id="t1496763771" t="kah0ona hm it seems to be ring.middleware.x-headers, but that only adds X-Content-Secuirty-Policy headers, rather than the one without X- prefix.."><y>#</y><d>2017-06-06</d><h>15:42</h><w>kah0ona</w>hm it seems to be ring.middleware.x-headers, but that only adds X-Content-Secuirty-Policy headers, rather than the one without X- prefix..</z><z id="t1496764520" t="weavejester [:attrs {:href &quot;/_/_/users/U2VRAHXEX&quot;}] Oh, you mean like Content-Security-Policy ?"><y>#</y><d>2017-06-06</d><h>15:55</h><w>weavejester</w><a>@kah0ona</a> Oh, you mean like <code>Content-Security-Policy</code>?</z><z id="t1496764534" t="weavejester So you‚Äôre not talking about security headers in general?"><y>#</y><d>2017-06-06</d><h>15:55</h><w>weavejester</w>So you‚Äôre not talking about security headers in general?</z><z id="t1496764563" t="kah0ona aah"><y>#</y><d>2017-06-06</d><h>15:56</h><w>kah0ona</w>aah</z><z id="t1496764566" t="kah0ona i just realized the problem"><y>#</y><d>2017-06-06</d><h>15:56</h><w>kah0ona</w>i just realized the problem</z><z id="t1496764568" t="kah0ona it‚Äôs in pedestal"><y>#</y><d>2017-06-06</d><h>15:56</h><w>kah0ona</w>it‚Äôs in pedestal</z><z id="t1496764574" t="kah0ona well; since our pedestal upgrade"><y>#</y><d>2017-06-06</d><h>15:56</h><w>kah0ona</w>well; since our pedestal upgrade</z><z id="t1496764579" t="weavejester X-Content-Security-Policy is the old name for the header. That should probably be updated."><y>#</y><d>2017-06-06</d><h>15:56</h><w>weavejester</w><code>X-Content-Security-Policy</code> is the old name for the header. That should probably be updated.</z><z id="t1496764580" t="kah0ona they also add middleware"><y>#</y><d>2017-06-06</d><h>15:56</h><w>kah0ona</w>they also add middleware</z><z id="t1496764588" t="kah0ona https://github.com/pedestal/pedestal/issues/466"><y>#</y><d>2017-06-06</d><h>15:56</h><w>kah0ona</w><a href="https://github.com/pedestal/pedestal/issues/466" target="_blank">https://github.com/pedestal/pedestal/issues/466</a></z><z id="t1496764604" t="kah0ona sorry for the inconvenience üôÇ I can fix this problem now"><y>#</y><d>2017-06-06</d><h>15:56</h><w>kah0ona</w>sorry for the inconvenience <b>üôÇ</b> I can fix this problem now</z><z id="t1496764621" t="weavejester No problem üôÇ - it can be hard to find which middleware adds which headers."><y>#</y><d>2017-06-06</d><h>15:57</h><w>weavejester</w>No problem <b>üôÇ</b> - it can be hard to find which middleware adds which headers.</z><z id="t1496764628" t="weavejester Or interceptor, in Pedestal‚Äôs case."><y>#</y><d>2017-06-06</d><h>15:57</h><w>weavejester</w>Or interceptor, in Pedestal‚Äôs case.</z><z id="t1496764632" t="kah0ona yeah indeed"><y>#</y><d>2017-06-06</d><h>15:57</h><w>kah0ona</w>yeah indeed</z><z id="t1496764710" t="kah0ona we use both pedestal and ring in this codebase, i mixed it up. end of the day here‚Ä¶ not too sharp üôÇ"><y>#</y><d>2017-06-06</d><h>15:58</h><w>kah0ona</w>we use both pedestal and ring in this codebase, i mixed it up. end of the day here‚Ä¶ not too sharp <b>üôÇ</b></z><z id="t1496766693" t="JAtkins How do I use middleware? I want to use ring-partial-content, but I&apos;m not sure how to use it. (I&apos;m working on my first ring/clojure/web project, so I don&apos;t know much about servers)"><y>#</y><d>2017-06-06</d><h>16:31</h><w>JAtkins</w>How do I use middleware? I want to use ring-partial-content, but I&apos;m not sure how to use it. (I&apos;m working on my first ring/clojure/web project, so I don&apos;t know much about servers)</z><z id="t1496770294" t="weavejester [:attrs {:href &quot;/_/_/users/U5P29DSUS&quot;}] Middleware takes in a handler as an argument, and returns a handler."><y>#</y><d>2017-06-06</d><h>17:31</h><w>weavejester</w><a>@jatkin</a> Middleware takes in a handler as an argument, and returns a handler.</z><z id="t1496770299" t="weavejester There‚Äôs more about it here: https://github.com/ring-clojure/ring/wiki/Concepts#middleware"><y>#</y><d>2017-06-06</d><h>17:31</h><w>weavejester</w>There‚Äôs more about it here: <a href="https://github.com/ring-clojure/ring/wiki/Concepts#middleware" target="_blank">https://github.com/ring-clojure/ring/wiki/Concepts#middleware</a></z><z id="t1496781974" t="petr.mensik Hello guys, I am currently facing strange problem that I can build my project with lein repl or lein ring server , however when I try lein ring uberwar I get Can&apos;t import ring.util.response/find-header, try updating to Ring 1.6.0+ Above problem is caused by https://github.com/metosin/ring-http-response/ library. It almost seems like ring-http-response is being added as dev dependency but I really don&apos;t know why üòï"><y>#</y><d>2017-06-06</d><h>20:46</h><w>petr.mensik</w>Hello guys, I am currently facing strange problem that I can build my project with <code>lein repl</code> or <code>lein ring server</code>, however when I try <code>lein ring uberwar</code> I get 
<pre>Can&apos;t import ring.util.response/find-header, try updating to Ring 1.6.0+</pre>
Above problem is caused by <a href="https://github.com/metosin/ring-http-response/" target="_blank">https://github.com/metosin/ring-http-response/</a> library. It almost seems like <code>ring-http-response</code> is being added as dev dependency but I really don&apos;t know why <b>üòï</b></z><z id="t1496782240" t="seancorfield Sounds like something is pulling in an older version of Ring as a (transitive) dependency. Try lein deps :tree to see if you can identify where the older Ring is coming from?"><y>#</y><d>2017-06-06</d><h>20:50</h><w>seancorfield</w>Sounds like something is pulling in an older version of Ring as a (transitive) dependency. Try <code>lein deps :tree</code> to see if you can identify where the older Ring is coming from?</z><z id="t1496782492" t="petr.mensik Yeah, I tried that before and nothing seems to collide with ring or ring/ring-core"><y>#</y><d>2017-06-06</d><h>20:54</h><w>petr.mensik</w>Yeah, I tried that before and nothing seems to collide with <code>ring</code> or <code>ring/ring-core</code></z><z id="t1496782603" t="petr.mensik Actually it does, weird is that lein deps :tree | less is actually not giving suggestions by lein"><y>#</y><d>2017-06-06</d><h>20:56</h><w>petr.mensik</w>Actually it does, weird is that <code>lein deps :tree | less</code> is actually not giving suggestions by lein</z><z id="t1496782611" t="petr.mensik that&apos;s why I didn&apos;t see it"><y>#</y><d>2017-06-06</d><h>20:56</h><w>petr.mensik</w>that&apos;s why I didn&apos;t see it</z><z id="t1496782950" t="petr.mensik Ok, even so, I don&apos;t really see any offending deps there https://pastebin.com/tPe6qXBH"><y>#</y><d>2017-06-06</d><h>21:02</h><w>petr.mensik</w>Ok, even so, I don&apos;t really see any offending deps there <a href="https://pastebin.com/tPe6qXBH" target="_blank">https://pastebin.com/tPe6qXBH</a></z><z id="t1496784027" t="seancorfield [lib-noir &quot;0.9.3&quot;] -&gt; [ring-middleware-format &quot;0.4.0&quot;] -&gt; [ring &quot;1.3.0&quot;] -&gt; [ring/ring-devel &quot;1.3.0&quot;] -&gt; [hiccup &quot;1.0.5&quot;] "><y>#</y><d>2017-06-06</d><h>21:20</h><w>seancorfield</w><pre>[lib-noir &quot;0.9.3&quot;] -&gt; [ring-middleware-format &quot;0.4.0&quot;] -&gt; [ring &quot;1.3.0&quot;] -&gt; [ring/ring-devel &quot;1.3.0&quot;] -&gt; [hiccup &quot;1.0.5&quot;]
</pre></z><z id="t1496784039" t="seancorfield That‚Äôs bringing in an old version of Ring."><y>#</y><d>2017-06-06</d><h>21:20</h><w>seancorfield</w>That‚Äôs bringing in an old version of Ring.</z><z id="t1496784179" t="seancorfield You might also want to check which version of lein-ring you‚Äôre using."><y>#</y><d>2017-06-06</d><h>21:22</h><w>seancorfield</w>You might also want to check which version of <code>lein-ring</code> you‚Äôre using.</z><z id="t1496787123" t="petr.mensik I&apos;ll look at it, thank you"><y>#</y><d>2017-06-06</d><h>22:12</h><w>petr.mensik</w>I&apos;ll look at it, thank you</z><z id="t1496801543" t="JAtkins [:attrs {:href &quot;/_/_/users/U0BKWMG5B&quot;}] Thanks! I had already seen that post, but it gave me the idea to insert my own debugger middleware, which helped immensely in clearing up the confusion. I wasn&apos;t using wrap-file , and thus :content-length wasn&apos;t set. I put that in my response header, and it now works like a charm!"><y>#</y><d>2017-06-07</d><h>02:12</h><w>JAtkins</w><a>@weavejester</a> Thanks! I had already seen that post, but it gave me the idea to insert my own debugger middleware, which helped immensely in clearing up the confusion. I wasn&apos;t using <code>wrap-file</code>, and thus <code>:content-length</code> wasn&apos;t set. I put that in my response header, and it now works like a charm!</z><z id="t1496804399" t="weavejester [:attrs {:href &quot;/_/_/users/U5P29DSUS&quot;}] Glad you found the answer!"><y>#</y><d>2017-06-07</d><h>02:59</h><w>weavejester</w><a>@jatkin</a> Glad you found the answer!</z><z id="t1496973834" t="tomerweller I know that this is not a compojure channel, still - Can compojure work with Ring‚Äôs new async handlers?"><y>#</y><d>2017-06-09</d><h>02:03</h><w>tomerweller</w>I know that this is not a <code>compojure</code> channel, still - Can compojure work with Ring‚Äôs new async handlers?</z><z id="t1496975153" t="seancorfield [:attrs {:href &quot;/_/_/users/U1739BP1C&quot;}] Based on this code, yes: https://github.com/weavejester/compojure/blob/master/src/compojure/core.clj#L193"><y>#</y><d>2017-06-09</d><h>02:25</h><w>seancorfield</w><a>@tomerweller</a> Based on this code, yes: <a href="https://github.com/weavejester/compojure/blob/master/src/compojure/core.clj#L193" target="_blank">https://github.com/weavejester/compojure/blob/master/src/compojure/core.clj#L193</a></z><z id="t1496982372" t="tomerweller [:attrs {:href &quot;/_/_/users/U04V70XH6&quot;}] Thanks. Looks like it supports it indeed. Still, I‚Äôm running the jetty ring adapter with :async true but getting Wrong number of args (1) passed to: handler/async-root when using a 3-arity handler. What can I be missing?"><y>#</y><d>2017-06-09</d><h>04:26</h><w>tomerweller</w><a>@seancorfield</a> Thanks. Looks like it supports it indeed. Still, I‚Äôm running the jetty ring adapter with <code>:async true</code> but getting <code>Wrong number of args (1) passed to: handler/async-root</code> when using a 3-arity handler. What can I be missing?</z><z id="t1496982560" t="tomerweller Shit. It‚Äôs :async? with a question mark. missed that."><y>#</y><d>2017-06-09</d><h>04:29</h><w>tomerweller</w>Shit. It‚Äôs <code>:async?</code> with a question mark. missed that.</z><z id="t1498608429" t="puzzler What is recommended for gzip on ring? https://github.com/bertrandk/ring-gzip or https://github.com/amalloy/ring-gzip-middleware or something else?"><y>#</y><d>2017-06-28</d><h>00:07</h><w>puzzler</w>What is recommended for gzip on ring?  <a href="https://github.com/bertrandk/ring-gzip" target="_blank">https://github.com/bertrandk/ring-gzip</a> or <a href="https://github.com/amalloy/ring-gzip-middleware" target="_blank">https://github.com/amalloy/ring-gzip-middleware</a> or something else?</z><z id="t1498611794" t="lumengxi [:attrs {:href &quot;/_/_/users/U0518RMLD&quot;}] i did a quick look at both of the project and they all look good to me. It is pretty straightforward so I think either one is fine. We have been using the latter in production for almost a year without any problems"><y>#</y><d>2017-06-28</d><h>01:03</h><w>lumengxi</w><a>@puzzler</a> i did a quick look at both of the project and they all look good to me. It is pretty straightforward so I think either one is fine. We have been using the latter in production for almost a year without any problems</z><z id="t1498623270" t="puzzler [:attrs {:href &quot;/_/_/users/U0DTAQVT3&quot;}] Thanks!"><y>#</y><d>2017-06-28</d><h>04:14</h><w>puzzler</w><a>@lumengxi</a> Thanks!</z><z id="t1498635335" t="puzzler I&apos;d like a little more guidance about how to use the ring-gzip-middleware effectively. Ideally, I&apos;d like to gzip all the javascripts found in the js subdirectory of the resources directory. Problem is that the static resources are configured through site-defaults/wrap-defaults which puts the static file handling in the middle of a huge stack of middleware. It&apos;s not really obvious to me how to isolate the js subdirectory for gzip behavior, yet keep all the other options which are vital to good static resource handling. Can anyone point me to a good example?"><y>#</y><d>2017-06-28</d><h>07:35</h><w>puzzler</w>I&apos;d like a little more guidance about how to use the ring-gzip-middleware effectively.  Ideally, I&apos;d like to gzip all the javascripts found in the js subdirectory of the resources directory.  Problem is that the static resources are configured through site-defaults/wrap-defaults which puts the static file handling in the middle of a huge stack of middleware.  It&apos;s not really obvious to me how to isolate the js subdirectory for gzip behavior, yet keep all the other options which are vital to good static resource handling.  Can anyone point me to a good example?</z><z id="t1498637511" t="puzzler [:attrs {:href &quot;/_/_/users/U0DTAQVT3&quot;}] The more I read up on this, the more it looks like a gzip middleware is not advisable unless you have some way of whitelisting or blacklisting certain content types. For example, you never want to gzip pdfs or pngs because those are already compressed and you&apos;ll just burn CPU time and make the file bigger. It doesn&apos;t look like either of these middleware libs support that out of the box. How are you using the ring-gzip-middleware lib? Are you applying it to everything and if not, how do you discriminate between file types?"><y>#</y><d>2017-06-28</d><h>08:11</h><w>puzzler</w><a>@lumengxi</a> The more I read up on this, the more it looks like a gzip middleware is not advisable unless you have some way of whitelisting or blacklisting certain content types.  For example, you never want to gzip pdfs or pngs because those are already compressed and you&apos;ll just burn CPU time and make the file bigger.  It doesn&apos;t look like either of these middleware libs support that out of the box.  How are you using the ring-gzip-middleware lib?  Are you applying it to everything and if not, how do you discriminate between file types?</z><z id="t1498637987" t="puzzler Upon closer inspection, it looks like ring-gzip has its own reasonable whitelist built in, and there are forks that support static gzip files."><y>#</y><d>2017-06-28</d><h>08:19</h><w>puzzler</w>Upon closer inspection, it looks like ring-gzip has its own reasonable whitelist built in, and there are forks that support static gzip files.</z><z id="t1498647938" t="metametadata [:attrs {:href &quot;/_/_/users/U0518RMLD&quot;}] it&apos;s also possible to gzip at the level of the server, e.g. in Jetty: https://martintrojer.github.io/clojure/2015/10/04/enable-gzip-with-ring-and-jetty"><y>#</y><d>2017-06-28</d><h>11:05</h><w>metametadata</w><a>@puzzler</a> it&apos;s also possible to gzip at the level of the server, e.g. in Jetty: <a href="https://martintrojer.github.io/clojure/2015/10/04/enable-gzip-with-ring-and-jetty" target="_blank">https://martintrojer.github.io/clojure/2015/10/04/enable-gzip-with-ring-and-jetty</a></z><z id="t1498653065" t="puzzler That&apos;s elegant. That may make more sense than to do it at the ring level. I wish immutant had as simple a way to add gzip."><y>#</y><d>2017-06-28</d><h>12:31</h><w>puzzler</w>That&apos;s elegant.  That may make more sense than to do it at the ring level.  I wish immutant had as simple a way to add gzip.</z><z id="t1498668839" t="lumengxi [:attrs {:href &quot;/_/_/users/U0518RMLD&quot;}] we use it only in API services, if your service is serving static contents, I would suggest doing that behind something like nginx, or as [:attrs {:href &quot;/_/_/users/U06BDK9S7&quot;}] suggested, in Jetty."><y>#</y><d>2017-06-28</d><h>16:53</h><w>lumengxi</w><a>@puzzler</a> we use it only in API services, if your service is serving static contents, I would suggest doing that behind something like nginx, or as <a>@metametadata</a> suggested, in Jetty.</z><z id="t1499180239" t="petr.mensik I have a (hopefully) simple question. I want to use both wrap-json-params and wrap-multipart-params middleware. So far I needed just parse JSON into my request map which worked fine. Now I&apos;ve added multipart route but it&apos;s not getting found by client which yields 404 error - however it&apos;s found when if I put there application/json as content type (but obviously ends up with parsing error). So how can I make Ring accept both content types? Here is my handler (def app (middleware/app-handler [routes] :middleware [wrap-all-cors wrap-public-resource wrap-static-content-reload wrap-json-params wrap-exceptions] :formats [:json-kw :edn] :ring-defaults (-&gt; ring-defaults/site-defaults (assoc :params {:multipart true})))) "><y>#</y><d>2017-07-04</d><h>14:57</h><w>petr.mensik</w>I have a (hopefully) simple question. I want to use both <code>wrap-json-params</code> and <code>wrap-multipart-params</code> middleware. So far I needed just parse JSON into my request map which worked fine. Now I&apos;ve added multipart route but it&apos;s not getting found by client which yields 404 error - however it&apos;s found when if I put there <code>application/json</code> as content type (but obviously ends up with parsing error). So how can I make Ring accept both content types?
Here is my handler 
<pre>(def app (middleware/app-handler
          [routes]
          :middleware [wrap-all-cors wrap-public-resource wrap-static-content-reload
                       wrap-json-params wrap-exceptions]
          :formats [:json-kw :edn]
          :ring-defaults (-&gt; ring-defaults/site-defaults
                             (assoc :params {:multipart true}))))
</pre></z><z id="t1499180278" t="petr.mensik Thanks a lot for help"><y>#</y><d>2017-07-04</d><h>14:57</h><w>petr.mensik</w>Thanks a lot for help</z><z id="t1499195549" t="petr.mensik basically the question is how to handle multiple content types in one Ring application"><y>#</y><d>2017-07-04</d><h>19:12</h><w>petr.mensik</w>basically the question is how to handle multiple content types in one Ring application</z><z id="t1499243765" t="petr.mensik I&apos;ve managed to solve it with https://github.com/ngrunwald/ring-middleware-format replacing the wrap-json-params"><y>#</y><d>2017-07-05</d><h>08:36</h><w>petr.mensik</w>I&apos;ve managed to solve it with <a href="https://github.com/ngrunwald/ring-middleware-format" target="_blank">https://github.com/ngrunwald/ring-middleware-format</a> replacing the <code>wrap-json-params</code></z><z id="t1499343476" t="weavejester [:attrs {:href &quot;/_/_/users/U3H4PBCLE&quot;}] Have you looked at https://github.com/metosin/muuntaja ?"><y>#</y><d>2017-07-06</d><h>12:17</h><w>weavejester</w><a>@petr.mensik</a> Have you looked at <a href="https://github.com/metosin/muuntaja" target="_blank">https://github.com/metosin/muuntaja</a> ?</z><z id="t1500829137" t="petr.mensik Is it safe to use input stream without closing like this? Or should I somehow close it after user downloads the file? (let [response {:status 200 :headers {&quot;Content-Type&quot; (:content-type file)} :body (-&gt; (:content file) io/input-stream)}] response) "><y>#</y><d>2017-07-23</d><h>16:58</h><w>petr.mensik</w>Is it safe to use input stream without closing like this? Or should I somehow close it after user downloads the file?
<pre>(let [response {:status 200
                  :headers {&quot;Content-Type&quot; (:content-type file)}
                  :body (-&gt; (:content file)
                             io/input-stream)}]
     response)
</pre></z><z id="t1500829863" t="weavejester [:attrs {:href &quot;/_/_/users/U3H4PBCLE&quot;}] That‚Äôs safe - input streams in the response body are closed for you"><y>#</y><d>2017-07-23</d><h>17:11</h><w>weavejester</w><a>@petr.mensik</a> That‚Äôs safe - input streams in the response body are closed for you</z><z id="t1500830169" t="petr.mensik [:attrs {:href &quot;/_/_/users/U0BKWMG5B&quot;}] Thanks üôÇ"><y>#</y><d>2017-07-23</d><h>17:16</h><w>petr.mensik</w><a>@weavejester</a> Thanks <b>üôÇ</b></z><z id="t1501006140" t="Garrett Hopper Does ring automatically add a :content-type key to the request based on the Content-Type in :headers , or does anyone know of a ring server or middleware that does this?"><y>#</y><d>2017-07-25</d><h>18:09</h><w>Garrett Hopper</w>Does ring automatically add a <code>:content-type</code> key to the request based on the <code>Content-Type</code> in <code>:headers</code>, or does anyone know of a ring server or middleware that does this?</z><z id="t1501013946" t="plins is anyone aware of an async ring middleware to log requests and responses?"><y>#</y><d>2017-07-25</d><h>20:19</h><w>plins</w>is anyone aware of an async ring middleware to log requests and responses?</z><z id="t1501026903" t="weavejester [:attrs {:href &quot;/_/_/users/U5JUDH2UE&quot;}] The :content-type key is deprecated in favour of ring.util.request/content-type"><y>#</y><d>2017-07-25</d><h>23:55</h><w>weavejester</w><a>@ghopper</a> The <code>:content-type</code> key is deprecated in favour of <code>ring.util.request/content-type</code></z><z id="t1501026971" t="weavejester [:attrs {:href &quot;/_/_/users/U3QUAHZJ6&quot;}] I wrote one for Duct that you could easily adapt: https://github.com/duct-framework/module.web/blob/master/src/duct/middleware/web.clj#L12"><y>#</y><d>2017-07-25</d><h>23:56</h><w>weavejester</w><a>@plins</a> I wrote one for Duct that you could easily adapt: <a href="https://github.com/duct-framework/module.web/blob/master/src/duct/middleware/web.clj#L12" target="_blank">https://github.com/duct-framework/module.web/blob/master/src/duct/middleware/web.clj#L12</a></z><z id="t1501077010" t="Garrett Hopper [:attrs {:href &quot;/_/_/users/U0BKWMG5B&quot;}] Thanks, I did eventually figure this out. Apparently http-kit still sets it, but Aleph doesn&apos;t. I submitted a PR to the library in question which was making deprecated assumptions."><y>#</y><d>2017-07-26</d><h>13:50</h><w>Garrett Hopper</w><a>@weavejester</a> Thanks, I did eventually figure this out. Apparently http-kit still sets it, but Aleph doesn&apos;t. I submitted a PR to the library in question which was making deprecated assumptions.</z><z id="t1501158262" t="justrag Looking for Clojure lib/framework for REST API server. Server-side only, JSON-API spec compliant, with JWT auth and SQL (MySQL or PostgreSQL) persistence. Any suggestions?"><y>#</y><d>2017-07-27</d><h>12:24</h><w>justrag</w>Looking for Clojure lib/framework for REST API server. Server-side only, JSON-API spec compliant, with JWT auth and SQL (MySQL or PostgreSQL) persistence. Any suggestions?</z><z id="t1501173781" t="justrag Would Compojure-API be a good start? "><y>#</y><d>2017-07-27</d><h>16:43</h><w>justrag</w>Would Compojure-API be a good start? </z><z id="t1501243104" t="weavejester That‚Äôs a reasonable choice, [:attrs {:href &quot;/_/_/users/U6DSN3QEM&quot;}] . You might also want to look at Yada orLiberator as an alternative to Compojure-API, Buddy for JWT auth, and HugSQL or HoneySQL for database queries (depending on whether you like writing in SQL or data)."><y>#</y><d>2017-07-28</d><h>11:58</h><w>weavejester</w>That‚Äôs a reasonable choice, <a>@justrag</a>. You might also want to look at Yada orLiberator as an alternative to Compojure-API, Buddy for JWT auth, and HugSQL or HoneySQL for database queries (depending on whether you like writing in SQL or data).</z><z id="t1501589234" t="justrag Thanks for the pointer to Yada. Looks quite interesting."><y>#</y><d>2017-08-01</d><h>12:07</h><w>justrag</w>Thanks for the pointer to Yada. Looks quite interesting.</z><z id="t1501849125" t="ikitommi warning those using nginx-clojure with ring: https://github.com/nginx-clojure/nginx-clojure/issues/182#issuecomment-319090255"><y>#</y><d>2017-08-04</d><h>12:18</h><w>ikitommi</w>warning those using nginx-clojure with ring: <a href="https://github.com/nginx-clojure/nginx-clojure/issues/182#issuecomment-319090255" target="_blank">https://github.com/nginx-clojure/nginx-clojure/issues/182#issuecomment-319090255</a></z><z id="t1502237025" t="cjhowe is it bad to do (wrap-resource handler &quot;&quot;) ? like, there&apos;s no way class files could leak through that, right?"><y>#</y><d>2017-08-09</d><h>00:03</h><w>cjhowe</w>is it bad to do <code>(wrap-resource handler &quot;&quot;)</code>? like, there&apos;s no way class files could leak through that, right?</z><z id="t1502385145" t="weavejester [:attrs {:href &quot;/_/_/users/U0QKTTY4D&quot;}] Yes, that‚Äôs super bad. That basically gives anyone full access to every file on your classpath."><y>#</y><d>2017-08-10</d><h>17:12</h><w>weavejester</w><a>@cjhowe</a> Yes, that‚Äôs super bad. That basically gives anyone full access to every file on your classpath.</z><z id="t1502385506" t="cjhowe i see... thanks!"><y>#</y><d>2017-08-10</d><h>17:18</h><w>cjhowe</w>i see... thanks!</z><z id="t1502403736" t="vadyalex Hello fellow clojurians. Yet another question about ServletContext and :init I am trying to figure out how to get servlet-context-path during :init stage. I am aware that servlet-context-path is available in the request map but I need to have it on earlier stage. What I am trying to achieve is to dynamically initialize Logback and create log file with a name that reflects application context name i.e. service#v1##201708111212.log :thinking_face:"><y>#</y><d>2017-08-10</d><h>22:22</h><w>vadyalex</w>Hello fellow clojurians. Yet another question about <code>ServletContext</code> and <code>:init</code>
I am trying to figure out how to get <code>servlet-context-path</code> during <code>:init</code> stage. I am aware that <code>servlet-context-path</code> is available in the request map but I need to have it on earlier stage.
What I am trying to achieve is to dynamically initialize Logback and create log file with a name that reflects application context name i.e. <code>service#v1##201708111212.log</code> <b>:thinking_face:</b></z><z id="t1502414046" t="weavejester [:attrs {:href &quot;/_/_/users/U69HWBFB3&quot;}] You mean in Lein-Ring?"><y>#</y><d>2017-08-11</d><h>01:14</h><w>weavejester</w><a>@vadyalex</a> You mean in Lein-Ring?</z><z id="t1502414353" t="weavejester The init function doesn‚Äôt take any arguments, though, so you might be out of luck. You may have to write your own Servlet genclass."><y>#</y><d>2017-08-11</d><h>01:19</h><w>weavejester</w>The <code>init</code> function doesn‚Äôt take any arguments, though, so you might be out of luck. You may have to write your own Servlet genclass.</z><z id="t1502449252" t="vadyalex [:attrs {:href &quot;/_/_/users/U0BKWMG5B&quot;}] Exactly that what is my problem. Can you point me into direction regarding ‚ÄúServlet genclass‚Äù. Do you mean ServletContexListener ?.."><y>#</y><d>2017-08-11</d><h>11:00</h><w>vadyalex</w><a>@weavejester</a> Exactly that what is my problem. Can you point me into direction regarding ‚ÄúServlet genclass‚Äù. Do you mean <code>ServletContexListener</code>?..</z><z id="t1503046297" t="ikitommi Hi. What would a good ‚ÄúRing‚Äôish‚Äù default for a predicate whether to automatically encode response :body into JSON/EDN/Transit by the format-encoder middleware‚Ä¶ ring-json has (coll? body) , ring-middleware-format has https://github.com/ngrunwald/ring-middleware-format/blob/master/src/ring/middleware/format_response.clj#L22-L30 . We have the ring-json-like predicate in Muuntaja ( https://github.com/metosin/muuntaja/blob/master/src/clj/muuntaja/core.clj#L200-L203 ). Just got bitten by it."><y>#</y><d>2017-08-18</d><h>08:51</h><w>ikitommi</w>Hi. What would a good ‚ÄúRing‚Äôish‚Äù default for a predicate whether to automatically encode response <code>:body</code> into JSON/EDN/Transit by the format-encoder middleware‚Ä¶ ring-json has <code>(coll? body)</code>, ring-middleware-format has <a href="https://github.com/ngrunwald/ring-middleware-format/blob/master/src/ring/middleware/format_response.clj#L22-L30" target="_blank">https://github.com/ngrunwald/ring-middleware-format/blob/master/src/ring/middleware/format_response.clj#L22-L30</a>. We have the ring-json-like predicate in Muuntaja (<a href="https://github.com/metosin/muuntaja/blob/master/src/clj/muuntaja/core.clj#L200-L203" target="_blank">https://github.com/metosin/muuntaja/blob/master/src/clj/muuntaja/core.clj#L200-L203</a>). Just got bitten by it.</z><z id="t1503276105" t="derveloper hi, i have an app behind a proxy (caddy) for ssl, i&apos;ve added the ssl middleware to parse the x-forwarded-proto header, this works fine, the schema is correctly set to :https , however, my (response/found &quot;/redirect-target&quot;) results in a location header without the correct schema, i think i&apos;m doing something wrong here, i&apos;ll tried to find the code where ring will create a absolute URL from the relative to set breakpoint there, but i didn&apos;t found it."><y>#</y><d>2017-08-21</d><h>00:41</h><w>derveloper</w>hi, i have an app behind a proxy (caddy) for ssl, i&apos;ve added the ssl middleware to parse the <code>x-forwarded-proto</code> header, this works fine, the schema is correctly set to <code>:https</code>, however, my <code>(response/found &quot;/redirect-target&quot;)</code> results in a location header without the correct schema, i think i&apos;m doing something wrong here, i&apos;ll tried to find the code where ring will create a absolute URL from the relative to set breakpoint there, but i didn&apos;t found it.</z><z id="t1503278928" t="derveloper okay, it seems that the request in ring.util.request/request-url is not the the one that i see in my handler"><y>#</y><d>2017-08-21</d><h>01:28</h><w>derveloper</w>okay, it seems that the request in <code>ring.util.request/request-url</code> is not the the one that i see in my handler</z><z id="t1503279077" t="derveloper the :scheme there is :http , i added the ring.middleware.ssl/wrap-forwarded-scheme middleware as soon as i can, i&apos;m used luminus-template for bootstrapping adding the middleware in front of all others in wrap-base"><y>#</y><d>2017-08-21</d><h>01:31</h><w>derveloper</w>the <code>:scheme</code> there is <code>:http</code>, i added the <code>ring.middleware.ssl/wrap-forwarded-scheme</code> middleware as soon as i can, i&apos;m used luminus-template for bootstrapping adding the middleware in front of all others in <code>wrap-base</code></z><z id="t1503280306" t="weavejester [:attrs {:href &quot;/_/_/users/U6M8DCR1P&quot;}] You may want to look at the Ring-Default project, which manages common Ring middleware."><y>#</y><d>2017-08-21</d><h>01:51</h><w>weavejester</w><a>@derveloper</a> You may want to look at the Ring-Default project, which manages common Ring middleware.</z><z id="t1503438833" t="derveloper [:attrs {:href &quot;/_/_/users/U0BKWMG5B&quot;}] thanks! that was the missing bit"><y>#</y><d>2017-08-22</d><h>21:53</h><w>derveloper</w><a>@weavejester</a> thanks! that was the missing bit</z><z id="t1504841824" t="stvnmllr2 any obvious answer to an infinite 301 redirect with ring? I used the secure-site-defaults, on amazon elb."><y>#</y><d>2017-09-08</d><h>03:37</h><w>stvnmllr2</w>any obvious answer to an infinite 301 redirect with ring? I used the secure-site-defaults, on amazon elb.</z><z id="t1504842593" t="seancorfield [:attrs {:href &quot;/_/_/users/U2AAUNY7J&quot;}] I&apos;d use curl -I to debug it. That&apos;ll show exactly what Location: header is coming back, then request that via curl -I and you should have a good idea of what&apos;s going wrong."><y>#</y><d>2017-09-08</d><h>03:49</h><w>seancorfield</w><a>@stvnmllr2</a> I&apos;d use <code>curl -I</code> to debug it. That&apos;ll show exactly what <code>Location:</code> header is coming back, then request that via <code>curl -I</code> and you should have a good idea of what&apos;s going wrong.</z><z id="t1504842850" t="stvnmllr2 thanks [:attrs {:href &quot;/_/_/users/U04V70XH6&quot;}] . Will try it. Not sure it helped. Just redirecting to itself, hence the infinite loop. Seems the request must not have the scheme passed in correctly to ring. Just a guess."><y>#</y><d>2017-09-08</d><h>03:54</h><w>stvnmllr2</w>thanks <a>@seancorfield</a>. Will try it. Not sure it helped. Just redirecting to itself, hence the infinite loop. Seems the request must not have the scheme passed in correctly to ring. Just a guess.</z><z id="t1504842928" t="stvnmllr2 Guess I can add some debugging in somewhere."><y>#</y><d>2017-09-08</d><h>03:55</h><w>stvnmllr2</w>Guess I can add some debugging in somewhere.</z><z id="t1504962281" t="weavejester [:attrs {:href &quot;/_/_/users/U2AAUNY7J&quot;}] Have you set the :proxy option to true ? If you‚Äôre behind ELB, you‚Äôre behind a proxy."><y>#</y><d>2017-09-09</d><h>13:04</h><w>weavejester</w><a>@stvnmllr2</a> Have you set the <code>:proxy</code> option to <code>true</code>? If you‚Äôre behind ELB, you‚Äôre behind a proxy.</z><z id="t1504962398" t="stvnmllr2 I have not. So I will try that now. thanks [:attrs {:href &quot;/_/_/users/U0BKWMG5B&quot;}]"><y>#</y><d>2017-09-09</d><h>13:06</h><w>stvnmllr2</w>I have not. So I will try that now. thanks <a>@weavejester</a></z><z id="t1504965263" t="stvnmllr2 that was it [:attrs {:href &quot;/_/_/users/U0BKWMG5B&quot;}] . Makes perfect sense now that you pointed it out. Thanks again."><y>#</y><d>2017-09-09</d><h>13:54</h><w>stvnmllr2</w>that was it <a>@weavejester</a>. Makes perfect sense now that you pointed it out. Thanks again.</z><z id="t1505329845" t="laujensen Evening - Do Ring sessions guarantee any kind of uniqueness, or will they repeat over time?"><y>#</y><d>2017-09-13</d><h>19:10</h><w>laujensen</w>Evening - Do Ring sessions guarantee any kind of uniqueness, or will they repeat over time?</z><z id="t1505330614" t="chrisjd Do you mean the cookie for in-memory server-side storage? If so, you shouldn&apos;t get collisions - the cookie is generated using java.util.UUID/randomUUID (see https://github.com/ring-clojure/ring/blob/master/ring-core/src/ring/middleware/session/memory.clj )"><y>#</y><d>2017-09-13</d><h>19:23</h><w>chrisjd</w>Do you mean the cookie for in-memory server-side storage? If so, you shouldn&apos;t get collisions - the cookie is generated using <code>java.util.UUID/randomUUID</code> (see <a href="https://github.com/ring-clojure/ring/blob/master/ring-core/src/ring/middleware/session/memory.clj" target="_blank">https://github.com/ring-clojure/ring/blob/master/ring-core/src/ring/middleware/session/memory.clj</a>)</z><z id="t1505335451" t="laujensen No then there shouldnt be collisions. Thanks [:attrs {:href &quot;/_/_/users/U228XBX7D&quot;}]"><y>#</y><d>2017-09-13</d><h>20:44</h><w>laujensen</w>No then there shouldnt be collisions. Thanks <a>@chrisjd</a></z><z id="t1505468119" t="kennethkalmer hey everyone, cross-posting for a broader audience"><y>#</y><d>2017-09-15</d><h>09:35</h><w>kennethkalmer</w>hey everyone, cross-posting for a broader audience</z><z id="t1505834874" t="rickmoynihan Does anyone know of a ring middleware that will log the total time a request takes to process? Obviously a simple middleware is easy to write, but I‚Äôd like to handle the case where the body is a PipedInputStream as well"><y>#</y><d>2017-09-19</d><h>15:27</h><w>rickmoynihan</w>Does anyone know of a ring middleware that will log the total time a request takes to process?  Obviously a simple middleware is easy to write, but I‚Äôd like to handle the case where the body is a PipedInputStream as well</z><z id="t1506588088" t="puzzler I&apos;m trying to grab the requester&apos;s ip address on my heroku server, using remote-addr from the ring header, but I&apos;m getting a &quot;private IP address&quot; (i.e., starts with 10). How do I get the public ip address?"><y>#</y><d>2017-09-28</d><h>08:41</h><w>puzzler</w>I&apos;m trying to grab the requester&apos;s ip address on my heroku server, using remote-addr from the ring header, but I&apos;m getting a &quot;private IP address&quot; (i.e., starts with 10).  How do I get the public ip address?</z><z id="t1506590096" t="puzzler It looks like I need to grab x-forwarded-for since I&apos;m behind a load balancer. Only thing I&apos;m not sure of is that from this: https://stackoverflow.com/questions/30018044/how-to-get-the-client-ip-address-in-ring-clojure it appears that sometimes, x-forwarded-for is a comma separated list. In such a case, is it valuable to retain the whole string of addresses (e.g., does that represent one computer within a lab that shares the same ip address?) or should I really just throw away everything after the first comma?"><y>#</y><d>2017-09-28</d><h>09:14</h><w>puzzler</w>It looks like I need to grab x-forwarded-for since I&apos;m behind a load balancer.  Only thing I&apos;m not sure of is that from this: <a href="https://stackoverflow.com/questions/30018044/how-to-get-the-client-ip-address-in-ring-clojure" target="_blank">https://stackoverflow.com/questions/30018044/how-to-get-the-client-ip-address-in-ring-clojure</a> it appears that sometimes, x-forwarded-for is a comma separated list.  In such a case, is it valuable to retain the whole string of addresses (e.g., does that represent one computer within a lab that shares the same ip address?) or should I really just throw away everything after the first comma?</z><z id="t1506615753" t="seancorfield [:attrs {:href &quot;/_/_/users/U0518RMLD&quot;}] x-forwarded-for ends up being the list of IPs from the client (what you want) through the routers and load balancers etc to your server. We initially assumed we could use ring-proxy and wrap-proxy-headers to get the updated :remote-addr but that pulls the last IP from the list -- which in our case was the F5 BigIP load balancer -- so we wrote our own two line middleware to pull the first IP from the list which is the client IP address (or whatever they&apos;ve spoofed it to be... we don&apos;t care, we just want it for logging."><y>#</y><d>2017-09-28</d><h>16:22</h><w>seancorfield</w><a>@puzzler</a> <code>x-forwarded-for</code> ends up being the list of IPs from the client (what you want) through the routers and load balancers etc to your server. We initially assumed we could use <code>ring-proxy</code> and <code>wrap-proxy-headers</code> to get the updated <code>:remote-addr</code> but that pulls the last IP from the list -- which in our case was the F5 BigIP load balancer -- so we wrote our own two line middleware to pull the first IP from the list which is the client IP address (or whatever they&apos;ve spoofed it to be... we don&apos;t care, we just want it for logging.</z><z id="t1506621759" t="puzzler [:attrs {:href &quot;/_/_/users/U04V70XH6&quot;}] I&apos;m mainly interested in determining unique users, and a lot of our users are going to be in schools, which I assume are usually behind some firewall with a single public Internet IP. So in that context, is the school&apos;s IP address going to show up as the leftmost address in the list, or the rightmost one? I was thinking the school&apos;s IP address would be the rightmost (last IP address before it hits the Internet), and the student&apos;s assigned IP within the school&apos;s local network is on the left (and not guaranteed to be unique from someone on a completely different local network). If my assumptions are correct, that would mean I need to capture the whole comma separated list to determine a unique user. Does that analysis seem correct, or flawed?"><y>#</y><d>2017-09-28</d><h>18:02</h><w>puzzler</w><a>@seancorfield</a> I&apos;m mainly interested in determining unique users, and a lot of our users are going to be in schools, which I assume are usually behind some firewall with a single public Internet IP.  So in that context, is the school&apos;s IP address going to show up as the leftmost address in the list, or the rightmost one?  I was thinking the school&apos;s IP address would be the rightmost (last IP address before it hits the Internet), and the student&apos;s assigned IP within the school&apos;s local network is on the left (and not guaranteed to be unique from someone on a completely different local network).  If my assumptions are correct, that would mean I need to capture the whole comma separated list to determine a unique user.  Does that analysis seem correct, or flawed?</z><z id="t1506621995" t="seancorfield The addresses go from left to right, client to server."><y>#</y><d>2017-09-28</d><h>18:06</h><w>seancorfield</w>The addresses go from left to right, client to server.</z><z id="t1506622043" t="seancorfield The same client IP could go through different proxies at different times to get to you -- so you&apos;d get a different set of IPs for the same client (user)."><y>#</y><d>2017-09-28</d><h>18:07</h><w>seancorfield</w>The same client IP could go through different proxies at different times to get to you -- so you&apos;d get a different set of IPs for the same client (user).</z><z id="t1506622101" t="seancorfield That said, some ISPs don&apos;t expose the actual client IP at all and only give you an IP for an edge proxy (AOL is a good example -- or was... can&apos;t remember if it still does)."><y>#</y><d>2017-09-28</d><h>18:08</h><w>seancorfield</w>That said, some ISPs don&apos;t expose the actual client IP at all and only give you an IP for an edge proxy (AOL is a good example -- or was... can&apos;t remember if it still does).</z><z id="t1507023553" t="mpenet evaluating routing libs for a project. so much choice now... a lot of good stuff out there"><y>#</y><d>2017-10-03</d><h>09:39</h><w>mpenet</w>evaluating routing libs for a project. so much choice now... a lot of good stuff out there</z><z id="t1507023675" t="mpenet feel free to suggest good options/experiences"><y>#</y><d>2017-10-03</d><h>09:41</h><w>mpenet</w>feel free to suggest good options/experiences</z><z id="t1507040378" t="ikitommi [:attrs {:href &quot;/_/_/users/U050SC7SV&quot;}] just cooking up metosin/reitit as was not happy with any of the existing ones. Main features: route syntax for humans, best part of existing libs, supports cljs, middleware &amp; interceptors, pluggable coercion (clojure.spec) &amp; designed perf in mind. First release out soon, would appreciate feedback. https://metosin.github.io/reitit/ &amp; some reasoning https://www.slideshare.net/metosin/performance-and-abstraction#30"><y>#</y><d>2017-10-03</d><h>14:19</h><w>ikitommi</w><a>@mpenet</a> just cooking up <code>metosin/reitit</code> as was not happy with any of the existing ones. Main features: route syntax for humans, best part of existing libs, supports cljs, middleware &amp; interceptors, pluggable coercion (clojure.spec) &amp; designed perf in mind. First release out soon, would appreciate feedback. <a href="https://metosin.github.io/reitit/" target="_blank">https://metosin.github.io/reitit/</a> &amp; some reasoning <a href="https://www.slideshare.net/metosin/performance-and-abstraction#30" target="_blank">https://www.slideshare.net/metosin/performance-and-abstraction#30</a></z><z id="t1507040707" t="mpenet I noticed it, looks interesting but it was too much in alpha state for my needs."><y>#</y><d>2017-10-03</d><h>14:25</h><w>mpenet</w>I noticed it, looks interesting but it was too much in alpha state for my needs.</z><z id="t1507040715" t="mpenet are you using it already?"><y>#</y><d>2017-10-03</d><h>14:25</h><w>mpenet</w>are you using it already?</z><z id="t1507040748" t="mpenet I am leaning towards bidi atm"><y>#</y><d>2017-10-03</d><h>14:25</h><w>mpenet</w>I am leaning towards bidi atm</z><z id="t1507040998" t="mpenet I mostly want a simple but extensible data format to describe routing and associated metadata then what it compiles to has little importance for now. I need to port a fairly large legacy app that uses compojure to that format"><y>#</y><d>2017-10-03</d><h>14:29</h><w>mpenet</w>I mostly want a simple but extensible data format to describe routing and associated metadata then what it compiles to has little importance for now. I need to port a fairly large legacy app that uses compojure to that format</z><z id="t1507041222" t="mpenet [:attrs {:href &quot;/_/_/users/U055NJ5CC&quot;}] first impression, it seems to do too much. Should coercion/middleware&apos;ing be part of a routing lib?"><y>#</y><d>2017-10-03</d><h>14:33</h><w>mpenet</w><a>@ikitommi</a> first impression, it seems to do too much. Should coercion/middleware&apos;ing be part of a routing lib?</z><z id="t1507041325" t="mpenet seems nice otherwise. Another nitpick would be the route params encoded in urls strings is not very friendly to generate stuff from it"><y>#</y><d>2017-10-03</d><h>14:35</h><w>mpenet</w>seems nice otherwise. Another nitpick would be the route params encoded in urls strings is not very friendly to generate stuff from it</z><z id="t1507041351" t="mpenet &gt; &quot;/api/orders/:id&quot;"><y>#</y><d>2017-10-03</d><h>14:35</h><w>mpenet</w>&gt; &quot;/api/orders/:id&quot;</z><z id="t1507041724" t="mpenet [:attrs {:href &quot;/_/_/users/U055NJ5CC&quot;}] some links 404 in the intro ex: https://metosin.github.io/reitit/routing/parameter-coercion.md"><y>#</y><d>2017-10-03</d><h>14:42</h><w>mpenet</w><a>@ikitommi</a> some links 404 in the intro ex: <a href="https://metosin.github.io/reitit/routing/parameter-coercion.md" target="_blank">https://metosin.github.io/reitit/routing/parameter-coercion.md</a></z><z id="t1507046929" t="ikitommi [:attrs {:href &quot;/_/_/users/U050SC7SV&quot;}] thanks for the feedback! Idea was to deploy as separate artifacts, one could only depend on the core, which is tiny."><y>#</y><d>2017-10-03</d><h>16:08</h><w>ikitommi</w><a>@mpenet</a> thanks for the feedback! Idea was to deploy as separate artifacts, one could only depend on the core, which is tiny.</z><z id="t1507046988" t="ikitommi not in prod yet, but going there in a ~month. "><y>#</y><d>2017-10-03</d><h>16:09</h><w>ikitommi</w>not in prod yet, but going there in a ~month. </z><z id="t1507047025" t="ikitommi about the path-params... generate stuff from, could you explain a bit?"><y>#</y><d>2017-10-03</d><h>16:10</h><w>ikitommi</w>about the path-params... generate stuff from, could you explain a bit?</z><z id="t1507047048" t="mpenet &quot;/api/orders/:id&quot; hardcodes the id presence into the url"><y>#</y><d>2017-10-03</d><h>16:10</h><w>mpenet</w>&quot;/api/orders/:id&quot; hardcodes the id presence into the url</z><z id="t1507047104" t="mpenet it&apos;s not really &quot;data&quot; in the sense if I want to document it or its presence I might have to parse the route"><y>#</y><d>2017-10-03</d><h>16:11</h><w>mpenet</w>it&apos;s not really &quot;data&quot; in the sense if I want to document it or its presence I might have to parse the route</z><z id="t1507053590" t="ikitommi [:attrs {:href &quot;/_/_/users/U050SC7SV&quot;}] added route-info , which provides the parsed route too: (def router (r/router [&quot;/api&quot; {:middleware [::body-params]} [&quot;/ping&quot; ::ping] [&quot;/admin&quot; {::roles #{:admin}} [&quot;/db/:db&quot; {:summary &quot;delete a post&quot; :middleware [::db] :name ::delete-db}] [&quot;/ping&quot; ::pong]]])) (r/routes router) ;[[&quot;/api/ping&quot; {:middleware [::body-params] ; :name ::ping}] ; [&quot;/api/admin/db/:db&quot; {:middleware [::body-params ::db], ; ::roles #{:admin}, ; :summary &quot;delete a post&quot;, ; :name ::delete-db}] ; [&quot;/api/admin/ping&quot; {:middleware [::body-params] ; ::roles #{:admin}, :name ::pong}]] (mapv r/route-info (r/routes router)) ;[{:path &quot;/api/ping&quot;, ; :parts [&quot;api&quot; &quot;ping&quot;], ; :params #{}, ; :result nil, ; :meta {:middleware [::body-params] ; :name ::ping}} ; {:path &quot;/api/admin/db/:fb&quot;, ; :parts [&quot;api&quot; &quot;admin&quot; &quot;db&quot; :db], ; :params #{:db}, ; :result nil, ; :meta {:middleware [::body-params ::db], ; ::roles #{:admin}, ; :summary &quot;delete a post&quot;, ; :name ::delete-db}} ; {:path &quot;/api/admin/ping&quot;, ; :parts [&quot;api&quot; &quot;admin&quot; &quot;ping&quot;], ; :params #{}, ; :result nil, ; :meta {:middleware [::body-params] ; ::roles #{:admin} ; :name ::pong}}] "><y>#</y><d>2017-10-03</d><h>17:59</h><r>ikitommi</r><a>@mpenet</a> added <code>route-info</code>,  which provides the parsed route too:
<pre>(def router
  (r/router
    [&quot;/api&quot; {:middleware [::body-params]}
     [&quot;/ping&quot; ::ping]
     [&quot;/admin&quot; {::roles #{:admin}}
      [&quot;/db/:db&quot; {:summary &quot;delete a post&quot;
                  :middleware [::db]
                  :name ::delete-db}]
      [&quot;/ping&quot; ::pong]]]))

(r/routes router)
;[[&quot;/api/ping&quot; {:middleware [::body-params]
;               :name ::ping}]
; [&quot;/api/admin/db/:db&quot; {:middleware [::body-params ::db],
;                       ::roles #{:admin},
;                       :summary &quot;delete a post&quot;,
;                       :name ::delete-db}]
; [&quot;/api/admin/ping&quot; {:middleware [::body-params]
;                     ::roles #{:admin}, :name ::pong}]]

(mapv r/route-info (r/routes router))
;[{:path &quot;/api/ping&quot;,
;  :parts [&quot;api&quot; &quot;ping&quot;],
;  :params #{},
;  :result nil,
;  :meta {:middleware [::body-params]
;         :name ::ping}}
; {:path &quot;/api/admin/db/:fb&quot;,
;  :parts [&quot;api&quot; &quot;admin&quot; &quot;db&quot; :db],
;  :params #{:db},
;  :result nil,
;  :meta {:middleware [::body-params ::db],
;         ::roles #{:admin},
;         :summary &quot;delete a post&quot;,
;         :name ::delete-db}}
; {:path &quot;/api/admin/ping&quot;,
;  :parts [&quot;api&quot; &quot;admin&quot; &quot;ping&quot;],
;  :params #{},
;  :result nil,
;  :meta {:middleware [::body-params]
;         ::roles #{:admin}
;         :name ::pong}}]
</pre></z><z id="t1507053712" t="mpenet I ll have a look tomorrow, thanks! "><y>#</y><d>2017-10-03</d><h>18:01</h><r>mpenet</r>I ll have a look tomorrow, thanks! </z><z id="t1507047117" t="mpenet could be a vector instead"><y>#</y><d>2017-10-03</d><h>16:11</h><w>mpenet</w>could be a vector instead</z><z id="t1507047138" t="mpenet [&quot;/api/orders/&quot; :id]"><y>#</y><d>2017-10-03</d><h>16:12</h><w>mpenet</w>[&quot;/api/orders/&quot; :id]</z><z id="t1507047438" t="ikitommi There is a parser withing reitit. I‚Äôll paste an example."><y>#</y><d>2017-10-03</d><h>16:17</h><w>ikitommi</w>There is a parser withing reitit. I‚Äôll paste an example.</z><z id="t1507047831" t="ikitommi oh well, it‚Äôs not exposed üòÆ internally, the routes are parsed into just that form. I‚Äôll add those to r/routes result too."><y>#</y><d>2017-10-03</d><h>16:23</h><w>ikitommi</w>oh well, it‚Äôs not exposed <b>üòÆ</b> internally, the routes are parsed into just that form. I‚Äôll add those to <code>r/routes</code> result too.</z><z id="t1507047907" t="ikitommi Ataraxy and Bidi both separate parameters and path fragments. It‚Äôs a matter of taste."><y>#</y><d>2017-10-03</d><h>16:25</h><w>ikitommi</w>Ataraxy and Bidi both separate parameters and path fragments. It‚Äôs a matter of taste.</z><z id="t1507047919" t="ikitommi (def routes [&quot;/&quot; [[&quot;auth/login&quot; :auth/login] [[&quot;auth/recovery/token/&quot; :token] :auth/recovery] [&quot;workspace/&quot; [[[:project-uuid &quot;/&quot; :page-uuid] :workspace/page]]]]]) "><y>#</y><d>2017-10-03</d><h>16:25</h><w>ikitommi</w><pre>(def routes
  [&quot;/&quot; [[&quot;auth/login&quot; :auth/login]
        [[&quot;auth/recovery/token/&quot; :token] :auth/recovery]
        [&quot;workspace/&quot; [[[:project-uuid &quot;/&quot; :page-uuid] :workspace/page]]]]])
</pre></z><z id="t1507047927" t="ikitommi (def routes [[&quot;/auth/login&quot; :auth/login] [&quot;/auth/recovery/token/:token&quot; :auth/recovery] [&quot;/workspace/:project-uuid/:page-uuid&quot; :workspace/page]]) "><y>#</y><d>2017-10-03</d><h>16:25</h><w>ikitommi</w><pre>(def routes
  [[&quot;/auth/login&quot; :auth/login]
   [&quot;/auth/recovery/token/:token&quot; :auth/recovery]
   [&quot;/workspace/:project-uuid/:page-uuid&quot; :workspace/page]])
</pre></z><z id="t1507048159" t="ikitommi those were btw from bide, which has a rationale for the syntax too: https://github.com/funcool/bide#why-another-routing-library"><y>#</y><d>2017-10-03</d><h>16:29</h><w>ikitommi</w>those were btw from bide, which has a rationale for the syntax too: <a href="https://github.com/funcool/bide#why-another-routing-library" target="_blank">https://github.com/funcool/bide#why-another-routing-library</a></z><z id="t1507119357" t="mpenet [:attrs {:href &quot;/_/_/users/U055NJ5CC&quot;}] I like that router lib, it&apos;s well put together really"><y>#</y><d>2017-10-04</d><h>12:15</h><w>mpenet</w><a>@ikitommi</a> I like that router lib, it&apos;s well put together really</z><z id="t1507119503" t="mpenet I d like it even more if it limited itself to routing tho. Shouldn&apos;t the coercion/middlware&apos;intercept be a &quot;resource&quot; level concern?"><y>#</y><d>2017-10-04</d><h>12:18</h><w>mpenet</w>I d like it even more if it limited itself to routing tho. Shouldn&apos;t the coercion/middlware&apos;intercept be a &quot;resource&quot; level concern?</z><z id="t1507119700" t="mpenet maybe that&apos;s what you meant with separate artifacts tho"><y>#</y><d>2017-10-04</d><h>12:21</h><w>mpenet</w>maybe that&apos;s what you meant with separate artifacts tho</z><z id="t1507119968" t="mpenet I think I might give it a try"><y>#</y><d>2017-10-04</d><h>12:26</h><w>mpenet</w>I think I might give it a try</z><z id="t1507121327" t="ikitommi [:attrs {:href &quot;/_/_/users/U050SC7SV&quot;}] great to hear you like that! Agree that the simplest definition for a routing lib is just route definition &amp; matching, e.g. reitit.core . Have to learn how to maintain a mono-/multirepo to be able deploy the layers as separate artefacts. Only dependency in the lib is meta-merge , so it has been easy to develop all in same repo/project."><y>#</y><d>2017-10-04</d><h>12:48</h><w>ikitommi</w><a>@mpenet</a> great to hear you like that! Agree that the simplest definition for a routing lib is just route definition &amp; matching, e.g. <code>reitit.core</code>. Have to learn how to maintain a mono-/multirepo to be able deploy the layers as separate artefacts. Only dependency in the lib is <code>meta-merge</code>, so it has been easy to develop all in same repo/project.</z><z id="t1507121384" t="mpenet not claiming this is the best way, but I do it one way that works for me on https://github.com/mpenet/alia"><y>#</y><d>2017-10-04</d><h>12:49</h><w>mpenet</w>not claiming this is the best way, but I do it one way that works for me on <a href="https://github.com/mpenet/alia" target="_blank">https://github.com/mpenet/alia</a></z><z id="t1507121441" t="mpenet this one uses lein, but it s very similar (easier actually) with boot, that&apos;s what I use on internal stuff now"><y>#</y><d>2017-10-04</d><h>12:50</h><w>mpenet</w>this one uses lein, but it s very similar (easier actually) with boot, that&apos;s what I use on internal stuff now</z><z id="t1507121488" t="mpenet I guess it&apos;s kinda similar to the way ring is organized too"><y>#</y><d>2017-10-04</d><h>12:51</h><w>mpenet</w>I guess it&apos;s kinda similar to the way ring is organized too</z><z id="t1507299944" t="chadhs what‚Äôs the best practice for combining routes from multiple namespaces in a ring app using compojure?"><y>#</y><d>2017-10-06</d><h>14:25</h><w>chadhs</w>what‚Äôs the best practice for combining routes from multiple namespaces in a ring app using compojure?</z><z id="t1507299973" t="chadhs for example if you had a lists and items namespace with a route.clj using the defroutes macro"><y>#</y><d>2017-10-06</d><h>14:26</h><w>chadhs</w>for example if you had a lists and items namespace with a route.clj using the defroutes macro</z><z id="t1507299999" t="chadhs is there a common pattern for bringing all those routes together in your app‚Äôs core.clj or perhaps a top level route.clj?"><y>#</y><d>2017-10-06</d><h>14:26</h><w>chadhs</w>is there a common pattern for bringing all those routes together in your app‚Äôs core.clj or perhaps a top level route.clj?</z><z id="t1507300428" t="mgrbyte [:attrs {:href &quot;/_/_/users/U060QNFEZ&quot;}] that&apos;s what we do - not sure if that&apos;s best practice or not: https://github.com/WormBase/datomic-to-catalyst/blob/develop/src/rest_api/main.clj"><y>#</y><d>2017-10-06</d><h>14:33</h><w>mgrbyte</w><a>@chadhs</a> that&apos;s what we do - not sure if that&apos;s best practice or not: <a href="https://github.com/WormBase/datomic-to-catalyst/blob/develop/src/rest_api/main.clj" target="_blank">https://github.com/WormBase/datomic-to-catalyst/blob/develop/src/rest_api/main.clj</a></z><z id="t1507300479" t="chadhs [:attrs {:href &quot;/_/_/users/U08715BSS&quot;}] thanks, i‚Äôll take a look at this üëç"><y>#</y><d>2017-10-06</d><h>14:34</h><w>chadhs</w><a>@mgrbyte</a> thanks, i‚Äôll take a look at this <b>üëç</b></z><z id="t1507300967" t="chadhs [:attrs {:href &quot;/_/_/users/U08715BSS&quot;}] so you‚Äôre essentially just storing all the routes (defined via defroutees) from each namespace in a vector called all-routes yes?"><y>#</y><d>2017-10-06</d><h>14:42</h><w>chadhs</w><a>@mgrbyte</a> so you‚Äôre essentially just storing all the routes (defined via defroutees) from each namespace in a vector called <code>all-routes</code> yes?</z><z id="t1507300993" t="mgrbyte yes"><y>#</y><d>2017-10-06</d><h>14:43</h><w>mgrbyte</w>yes</z><z id="t1507300998" t="chadhs don‚Äôt you need to combine/merge these then?"><y>#</y><d>2017-10-06</d><h>14:43</h><w>chadhs</w>don‚Äôt you need to combine/merge these then?</z><z id="t1507301041" t="mgrbyte https://github.com/WormBase/datomic-to-catalyst/blob/develop/src/rest_api/main.clj#L149-L151"><y>#</y><d>2017-10-06</d><h>14:44</h><w>mgrbyte</w><a href="https://github.com/WormBase/datomic-to-catalyst/blob/develop/src/rest_api/main.clj#L149-L151" target="_blank">https://github.com/WormBase/datomic-to-catalyst/blob/develop/src/rest_api/main.clj#L149-L151</a></z><z id="t1507301163" t="mgrbyte [:attrs {:href &quot;/_/_/users/U060QNFEZ&quot;}] yes, ‚òùÔ∏è all-routes flattened, then given to compojure.api.sweet/routes"><y>#</y><d>2017-10-06</d><h>14:46</h><w>mgrbyte</w><a>@chadhs</a> yes, <b>‚òùÔ∏è</b> <code>all-routes</code> flattened, then given to <code>compojure.api.sweet/routes</code></z><z id="t1507301271" t="chadhs nice! i was thinking about something like this, but didn‚Äôt know if it was idiomatic."><y>#</y><d>2017-10-06</d><h>14:47</h><w>chadhs</w>nice!  i was thinking about something like this, but didn‚Äôt know if it was idiomatic.</z><z id="t1507301281" t="chadhs seems reasonable to me either way thanks for your help [:attrs {:href &quot;/_/_/users/U08715BSS&quot;}]"><y>#</y><d>2017-10-06</d><h>14:48</h><w>chadhs</w>seems reasonable to me either way thanks for your help <a>@mgrbyte</a></z><z id="t1507745799" t="mikerod Does anyone know of any problems using ring-jetty-adapter with a higher version of jetty-server than it brings in as a dependency?"><y>#</y><d>2017-10-11</d><h>18:16</h><w>mikerod</w>Does anyone know of any problems using <code>ring-jetty-adapter</code> with a higher version of <code>jetty-server</code> than it brings in as a dependency?</z><z id="t1507745854" t="mikerod Main issue: ring/ring-jetty-adapter &quot;1.6.2&quot; is the most recent release I see, it uses [org.eclipse.jetty/jetty-server &quot;9.2.21.v20170120&quot;] which behind several versions from current"><y>#</y><d>2017-10-11</d><h>18:17</h><w>mikerod</w>Main issue: <code>ring/ring-jetty-adapter &quot;1.6.2&quot;</code> is the most recent release I see, it uses <code>[org.eclipse.jetty/jetty-server &quot;9.2.21.v20170120&quot;]</code> which behind several versions from current</z><z id="t1507745883" t="mikerod In particular, the class org.eclipse.jetty.server.handler.gzip.GzipHandler is missing, which can be useful"><y>#</y><d>2017-10-11</d><h>18:18</h><w>mikerod</w>In particular, the class  <code>org.eclipse.jetty.server.handler.gzip.GzipHandler</code> is missing, which can be useful</z><z id="t1507745914" t="mikerod Also, I noticed this post https://martintrojer.github.io/clojure/2015/10/04/enable-gzip-with-ring-and-jetty where the project is clearly configured to use an even older ring-jetty-adapter with a newer jetty-server"><y>#</y><d>2017-10-11</d><h>18:18</h><w>mikerod</w>Also, I noticed this post <a href="https://martintrojer.github.io/clojure/2015/10/04/enable-gzip-with-ring-and-jetty" target="_blank">https://martintrojer.github.io/clojure/2015/10/04/enable-gzip-with-ring-and-jetty</a>
where the project is clearly configured to use an even older <code>ring-jetty-adapter</code> with a newer <code>jetty-server</code></z><z id="t1507745928" t="mikerod It just isn‚Äôt clear to me where the issues may be in doing so and if there is any docs anywhere about it"><y>#</y><d>2017-10-11</d><h>18:18</h><w>mikerod</w>It just isn‚Äôt clear to me where the issues may be in doing so and if there is any docs anywhere about it</z><z id="t1507746116" t="seancorfield We‚Äôre using Jetty 9.3 I believe with no issues. We may even be on a later version (but there are some issues with New Relic and some more recent Jetty versions)."><y>#</y><d>2017-10-11</d><h>18:21</h><w>seancorfield</w>We‚Äôre using Jetty 9.3 I believe with no issues. We may even be on a later version (but there are some issues with New Relic and some more recent Jetty versions).</z><z id="t1507746347" t="bostonaholic I‚Äôd love to hear more, or if you could point me to, the issues with jetty and new relic."><y>#</y><d>2017-10-11</d><h>18:25</h><r>bostonaholic</r>I‚Äôd love to hear more, or if you could point me to, the issues with jetty and new relic.</z><z id="t1507746975" t="seancorfield I&apos;d have to dig thru all the support tickets I opened with New Relic about compatibility issues I ran into with various Jetty releases. Some were minor (exceptions thrown at startup that didn&apos;t seem to affect operation), some caused monitoring to fail, most were very minor issues (log messages indicating potential problems that didn&apos;t seem to be actual problems)."><y>#</y><d>2017-10-11</d><h>18:36</h><r>seancorfield</r>I&apos;d have to dig thru all the support tickets I opened with New Relic about compatibility issues I ran into with various Jetty releases. Some were minor (exceptions thrown at startup that didn&apos;t seem to affect operation), some caused monitoring to fail, most were very minor issues (log messages indicating potential problems that didn&apos;t seem to be actual problems).</z><z id="t1507747126" t="bostonaholic gotcha. thanks!"><y>#</y><d>2017-10-11</d><h>18:38</h><r>bostonaholic</r>gotcha. thanks!</z><z id="t1507746163" t="seancorfield I‚Äôll try to remember to check when I get back to work (at lunch in Baltimore right now)."><y>#</y><d>2017-10-11</d><h>18:22</h><w>seancorfield</w>I‚Äôll try to remember to check when I get back to work (at lunch in Baltimore right now).</z><z id="t1507746418" t="mikerod [:attrs {:href &quot;/_/_/users/U04V70XH6&quot;}] thanks. That is good to hear that you‚Äôve had experience using a higher version in combination with the adapter"><y>#</y><d>2017-10-11</d><h>18:26</h><w>mikerod</w><a>@seancorfield</a> thanks. That is good to hear that you‚Äôve had experience using a higher version in combination with the adapter</z><z id="t1507746426" t="mikerod 9.3 would be suitable for me at this point"><y>#</y><d>2017-10-11</d><h>18:27</h><w>mikerod</w>9.3 would be suitable for me at this point</z><z id="t1507746851" t="seancorfield Back at the hotel (and therefore at work). Our versions.properties file has org.eclipse.jetty/jetty-server=9.3.14.v20161028 # this version seems to work but is not yet officially supported by New Relic: #org.eclipse.jetty/jetty-server=9.4.0.v20161208 So that&apos;s what we&apos;re using and also what we&apos;ve tested against more recently."><y>#</y><d>2017-10-11</d><h>18:34</h><w>seancorfield</w>Back at the hotel (and therefore at work). Our <code>versions.properties</code> file has <pre>org.eclipse.jetty/jetty-server=9.3.14.v20161028
# this version seems to work but is not yet officially supported by New Relic:
#org.eclipse.jetty/jetty-server=9.4.0.v20161208
</pre> So that&apos;s what we&apos;re using and also what we&apos;ve tested against more recently.</z><z id="t1507748900" t="mikerod Nice. Thank you for the information!"><y>#</y><d>2017-10-11</d><h>19:08</h><w>mikerod</w>Nice. Thank you for the information!</z><z id="t1508797394" t="zlrth what could i be doing wrong? i need a url endpoint i can post to from a different website. I made a separate route: (defroutes service-routes (POST &quot;/thirdpartyservice&quot; [query] (thirdpartyservice query) (redirect &quot;&quot;)) ) then i think i made service-routes not do csrf: (def app-routes (routes (-&gt; #&apos;home-routes (friend/authenticate conus.middleware/auth-opts) (wrap-routes middleware/wrap-csrf) (wrap-routes middleware/wrap-formats)) (-&gt; #&apos;service-routes (wrap-routes middleware/wrap-formats)) (route/not-found (:body (error-page {:status 404 :title &quot;page not found&quot;}))))) but when i post to http://website.com/thirdpartyservice , i get ‚Äúinvalid anti-forgery token‚Äù"><y>#</y><d>2017-10-23</d><h>22:23</h><w>zlrth</w>what could i be doing wrong?
i need a url endpoint i can post to from a different website. I made a separate route:
<pre>(defroutes service-routes
(POST &quot;/thirdpartyservice&quot; [query] (thirdpartyservice query)
        (redirect &quot;&quot;))
)</pre>
then i think i made <code>service-routes</code> not do csrf:
<pre>(def app-routes
  (routes
   (-&gt; #&apos;home-routes
        (friend/authenticate conus.middleware/auth-opts)
        (wrap-routes middleware/wrap-csrf)
        (wrap-routes middleware/wrap-formats))
   (-&gt; #&apos;service-routes
       (wrap-routes middleware/wrap-formats))
    (route/not-found
      (:body
        (error-page {:status 404
                     :title &quot;page not found&quot;})))))</pre>
but when i post to <a href="http://website.com/thirdpartyservice" target="_blank">http://website.com/thirdpartyservice</a>, i get ‚Äúinvalid anti-forgery token‚Äù</z><z id="t1508859444" t="weavejester [:attrs {:href &quot;/_/_/users/U0HJ4RAGY&quot;}] That looks fine‚Ä¶ Do you happen to have any other middleware wrapping your routes?"><y>#</y><d>2017-10-24</d><h>15:37</h><w>weavejester</w><a>@mfm</a> That looks fine‚Ä¶ Do you happen to have any other middleware wrapping your routes?</z><z id="t1508859993" t="zlrth i got it to work hours later, then fell asleep. i think i understand what happened. let me know if i‚Äôm off-base. i have what i posted above, but, per the project created by the template lein new luminus my-app , i also have in middleware.clj (defn wrap-base [handler] (-&gt; ((:middleware defaults) handler) ... (wrap-defaults site-defaults) wrap-context wrap-internal-error)) where site-defaults has under :security :anti-forgery set to true . so, yes [:attrs {:href &quot;/_/_/users/U0BKWMG5B&quot;}] , if i understand correctly, i had csrf protection set in two places, middleware.clj , in my app-routes with wrap-csrf ."><y>#</y><d>2017-10-24</d><h>15:46</h><w>zlrth</w>i got it to work hours later, then fell asleep. i think i understand what happened. let me know if i‚Äôm off-base.
i have what i posted above, but, per the project created by the template <code>lein new luminus my-app</code>, i also have in <code>middleware.clj</code>
<pre>(defn wrap-base [handler]
  (-&gt; ((:middleware defaults) handler)
      ...
        (wrap-defaults site-defaults)
        wrap-context
        wrap-internal-error))</pre>
where <code>site-defaults</code> has under <code>:security</code> <code>:anti-forgery</code> set to <code>true</code>.
so, yes <a>@weavejester</a>, if i understand correctly, i had csrf protection set in two places, <code>middleware.clj</code>, in my <code>app-routes</code> with <code>wrap-csrf</code>.</z><z id="t1508860023" t="weavejester Thanks for the update, [:attrs {:href &quot;/_/_/users/U0HJ4RAGY&quot;}] . Glad you got it fixed."><y>#</y><d>2017-10-24</d><h>15:47</h><w>weavejester</w>Thanks for the update, <a>@mfm</a>. Glad you got it fixed.</z><z id="t1508860028" t="zlrth : )"><y>#</y><d>2017-10-24</d><h>15:47</h><w>zlrth</w>: )</z><z id="t1509111337" t="chadhs I‚Äôm having an odd issue. I‚Äôm using ring, compojure, and hiccup together. my site renders fine when i‚Äôm using (-&gt; app ... (wrap-resource &quot;static&quot;) wrap-file-info wrap-web-jars) however if i replace wrap-file-info with wrap-content-type wrap-not-modified loading my site downloads the rendered html as an Unknown.dms file"><y>#</y><d>2017-10-27</d><h>13:35</h><w>chadhs</w>I‚Äôm having an odd issue.  I‚Äôm using ring, compojure, and hiccup together.
my site renders fine when i‚Äôm using
<pre>(-&gt; app
    ...
    (wrap-resource &quot;static&quot;)
    wrap-file-info
    wrap-web-jars)
</pre>
however if i replace wrap-file-info with 
<pre>wrap-content-type
    wrap-not-modified
</pre>
loading my site downloads the rendered html as an <code>Unknown.dms</code> file</z><z id="t1509111416" t="chadhs I‚Äôd like to refactor and replace the deprecated wrap-file-info but seem to be stuck at this point; looking for a little push to help me solve this thanks."><y>#</y><d>2017-10-27</d><h>13:36</h><w>chadhs</w>I‚Äôd like to refactor and replace the deprecated <code>wrap-file-info</code> but seem to be stuck at this point; looking for a little push to help me solve this thanks.</z><z id="t1509130412" t="weavejester [:attrs {:href &quot;/_/_/users/U060QNFEZ&quot;}] What route in particular isn‚Äôt working?"><y>#</y><d>2017-10-27</d><h>18:53</h><w>weavejester</w><a>@chadhs</a> What route in particular isn‚Äôt working?</z><z id="t1509130489" t="chadhs just the default route itself"><y>#</y><d>2017-10-27</d><h>18:54</h><w>chadhs</w>just the default route itself</z><z id="t1509130526" t="chadhs [:attrs {:href &quot;/_/_/users/U0BKWMG5B&quot;}] it‚Äôs a toy app i‚Äôm using to learn and i have it on github https://github.com/chadhs/listopia/blob/master/src/listopia/core.clj"><y>#</y><d>2017-10-27</d><h>18:55</h><w>chadhs</w><a>@weavejester</a> it‚Äôs a toy app i‚Äôm using to learn and i have it on github <a href="https://github.com/chadhs/listopia/blob/master/src/listopia/core.clj" target="_blank">https://github.com/chadhs/listopia/blob/master/src/listopia/core.clj</a></z><z id="t1509130617" t="chadhs was hoping replacing wrap-file-info with wrap-content-type and wrap-not-modified would be a no-op but results in the behavior i mentioned above üòû"><y>#</y><d>2017-10-27</d><h>18:56</h><w>chadhs</w>was hoping replacing <code>wrap-file-info</code> with <code>wrap-content-type</code> and <code>wrap-not-modified</code> would be a no-op but results in the behavior i mentioned above <b>üòû</b></z><z id="t1509130695" t="weavejester [:attrs {:href &quot;/_/_/users/U060QNFEZ&quot;}] Your code is telling Compojure to explicitly not use any content-type, and wrap-content-type works off the file extension, so that will default to application/octet-stream ."><y>#</y><d>2017-10-27</d><h>18:58</h><w>weavejester</w><a>@chadhs</a> Your code is telling Compojure to explicitly not use any content-type, and <code>wrap-content-type</code> works off the file extension, so that will default to <code>application/octet-stream</code>.</z><z id="t1509130741" t="chadhs interesting, where is my compojure code explicitly not using any content-type?"><y>#</y><d>2017-10-27</d><h>18:59</h><w>chadhs</w>interesting, where is my compojure code explicitly not using any content-type?</z><z id="t1509130774" t="weavejester You‚Äôre returning the full response map; essentially saying ‚ÄúDon‚Äôt fill anything in, I‚Äôm going to take care of everything.‚Äù"><y>#</y><d>2017-10-27</d><h>18:59</h><w>weavejester</w>You‚Äôre returning the full response map; essentially saying ‚ÄúDon‚Äôt fill anything in, I‚Äôm going to take care of everything.‚Äù</z><z id="t1509130812" t="weavejester If you return a string from Compojure, then it will turn it into a HTTP response with a HTML content-type, for example."><y>#</y><d>2017-10-27</d><h>19:00</h><w>weavejester</w>If you return a string from Compojure, then it will turn it into a HTTP response with a HTML content-type, for example.</z><z id="t1509130855" t="weavejester You‚Äôre also handling the request yourself, instead of getting Compojure to destructure it."><y>#</y><d>2017-10-27</d><h>19:00</h><w>weavejester</w>You‚Äôre also handling the request yourself, instead of getting Compojure to destructure it.</z><z id="t1509130963" t="chadhs [:attrs {:href &quot;/_/_/users/U0BKWMG5B&quot;}] clearly i need to look at some examples; i don‚Äôt understand how this is working nearly as well as I thought I did."><y>#</y><d>2017-10-27</d><h>19:02</h><w>chadhs</w><a>@weavejester</a> clearly i need to look at some examples; i don‚Äôt understand how this is working nearly as well as I thought I did.</z><z id="t1509131035" t="chadhs i was expecting route ‚Üí handler ‚Üí view and hiccup in the view is returning html output so was expecting it to render"><y>#</y><d>2017-10-27</d><h>19:03</h><w>chadhs</w>i was expecting route ‚Üí handler ‚Üí view and hiccup in the view is returning html output so was expecting it to render</z><z id="t1509131086" t="weavejester Right, but you need to tell it that it‚Äôs HTML output. If you just return a string, then Compojure will assume it‚Äôs HTML. If you return a full response map, it assumes you know what you‚Äôre doing."><y>#</y><d>2017-10-27</d><h>19:04</h><w>weavejester</w>Right, but you need to tell it that it‚Äôs HTML output. If you just return a string, then Compojure will assume it‚Äôs HTML. If you return a full response map, it assumes you know what you‚Äôre doing.</z><z id="t1509131261" t="weavejester (defn build-list-routes [db] (routes (GET &quot;/list/:list-id&quot; [list-id :&lt;&lt; coerce/as-uuid] (view/list-page (model/get-list db list-id)))) "><y>#</y><d>2017-10-27</d><h>19:07</h><w>weavejester</w><pre>(defn build-list-routes [db]
  (routes
   (GET &quot;/list/:list-id&quot; [list-id :&lt;&lt; coerce/as-uuid]
     (view/list-page (model/get-list db list-id))))
</pre></z><z id="t1509131282" t="weavejester That‚Äôs more how I‚Äôd do it."><y>#</y><d>2017-10-27</d><h>19:08</h><w>weavejester</w>That‚Äôs more how I‚Äôd do it.</z><z id="t1509131299" t="weavejester Although I‚Äôm using Ataraxy more than Compojure these days."><y>#</y><d>2017-10-27</d><h>19:08</h><w>weavejester</w>Although I‚Äôm using Ataraxy more than Compojure these days.</z><z id="t1509131384" t="chadhs much appreciated! gives me a good place to start"><y>#</y><d>2017-10-27</d><h>19:09</h><w>chadhs</w>much appreciated!  gives me a good place to start</z><z id="t1509388113" t="kennytilton I am working on a client framework and am hoping to find a way to mock responses, not requests. I see a few mentions that ring.mock does that, but no sign of it in the source or doc. Am I just deeply confused?"><y>#</y><d>2017-10-30</d><h>18:28</h><w>kennytilton</w>I am working on a client framework and am hoping to find a way to mock responses, not requests. I see a few mentions that ring.mock does that, but no sign of it in the source or doc. Am I just deeply confused?</z><z id="t1509389860" t="seancorfield I thought ring.mock only mocked requests...?"><y>#</y><d>2017-10-30</d><h>18:57</h><w>seancorfield</w>I thought <code>ring.mock</code> only mocked requests...?</z><z id="t1509389983" t="seancorfield For responses, what sort of things are you looking to mock [:attrs {:href &quot;/_/_/users/U0PUGPSFR&quot;}] ? By the time a response reaches the client, isn&apos;t just an regular HTTP response, i.e., a bunch of lines of text starting with headers?"><y>#</y><d>2017-10-30</d><h>18:59</h><w>seancorfield</w>For responses, what sort of things are you looking to mock <a>@hiskennyness</a>? By the time a response reaches the client, isn&apos;t just an regular HTTP response, i.e., a bunch of lines of text starting with headers?</z><z id="t1509390037" t="seancorfield You&apos;d be mocking ajax requests and responses I guess. I&apos;d expect there to be a JS library for that...?"><y>#</y><d>2017-10-30</d><h>19:00</h><w>seancorfield</w>You&apos;d be mocking ajax requests and responses I guess. I&apos;d expect there to be a JS library for that...?</z><z id="t1509392564" t="kennytilton Agreed, [:attrs {:href &quot;/_/_/users/U04V70XH6&quot;}] on the scope of ring mock, but a stack overflow response and the doc for https://github.com/johanhaleby/stub-http itself both cite ring.mock as alternatives to response faking. Now you know why I proposed ‚Äúdeeply confused‚Äù as one explanation. üôÇ My test code will be executing a callback hell sequence of Ajax requests (that is the functional capability I am targeting)‚Ä¶ hmmm, maybe I need to bring up a cooperating server to truly simulate asynchronous chaos. A fixed test I can hit any public REST API."><y>#</y><d>2017-10-30</d><h>19:42</h><w>kennytilton</w>Agreed, <a>@seancorfield</a> on the scope of ring mock, but a stack overflow response and the doc for <a href="https://github.com/johanhaleby/stub-http" target="_blank">https://github.com/johanhaleby/stub-http</a> itself both cite ring.mock as alternatives to response faking. Now you know why I proposed ‚Äúdeeply confused‚Äù as one explanation. <b>üôÇ</b> My test code will be executing a callback hell sequence of Ajax requests (that is the functional capability I am targeting)‚Ä¶ hmmm, maybe I need to bring up a cooperating server to truly simulate asynchronous chaos.  A fixed test I can hit any public REST API.</z><z id="t1509393717" t="seancorfield I think it&apos;s a matter of how you read that doc... &quot;A Clojure library designed to stub HTTP responses regardless of which client library that is used to make the actual HTTP requests. There are several client specific &quot;http mocking/stubbing/faking&quot; libraries out there such as clj-http-fake and ring-mock but they work on the level of the library and not the HTTP level.&quot; -- to me that just implies that ring-mock can be used for mocking around Ring (since it mocks how a client behaves in terms of interacting with Ring)."><y>#</y><d>2017-10-30</d><h>20:01</h><w>seancorfield</w>I think it&apos;s a matter of how you read that doc... &quot;A Clojure library designed to stub HTTP responses regardless of which client library that is used to make the actual HTTP requests.
There are several client specific &quot;http mocking/stubbing/faking&quot; libraries out there such as clj-http-fake and ring-mock but they work on the level of the library and not the HTTP level.&quot; -- to me that just implies that ring-mock can be used for mocking around Ring (since it mocks how a client behaves in terms of interacting with Ring).</z><z id="t1509393732" t="seancorfield But, yeah, it could certainly be clearer."><y>#</y><d>2017-10-30</d><h>20:02</h><w>seancorfield</w>But, yeah, it could certainly be clearer.</z><z id="t1509403055" t="kennytilton Ah, right: the sequence of /-delimited functions broadened the context beyond stubbing. Thx."><y>#</y><d>2017-10-30</d><h>22:37</h><w>kennytilton</w>Ah, right: the sequence of /-delimited functions broadened the context beyond stubbing. Thx.</z><z id="t1509506997" t="alice Right now I&apos;m having this weird issue, I have a POST endpoint /api/upload and if I send a request with curl it gets handled like 4 times curl -X POST -H &quot;content-type: multipart/form-data&quot; 127.0.0.1:3000/api/upload -F &quot;key=lol&quot; -F &quot; debug print: http://shekels.wtf/i/7d2b8f6cd894.meme.png"><y>#</y><d>2017-11-01</d><h>03:29</h><w>alice</w>Right now I&apos;m having this weird issue, I have a POST endpoint <code>/api/upload</code> and if I send a request with curl it gets handled like 4 times
<code>curl -X POST -H &quot;content-type: multipart/form-data&quot; 127.0.0.1:3000/api/upload -F &quot;key=lol&quot; -F &quot;</code>

debug print: <a href="http://shekels.wtf/i/7d2b8f6cd894.meme.png" target="_blank">http://shekels.wtf/i/7d2b8f6cd894.meme.png</a></z><z id="t1509511083" t="weavejester [:attrs {:href &quot;/_/_/users/U5Z4ECHCM&quot;}] Can you provide some code?"><y>#</y><d>2017-11-01</d><h>04:38</h><w>weavejester</w><a>@alice</a> Can you provide some code?</z><z id="t1509520667" t="alice What would you need to see? [:attrs {:href &quot;/_/_/users/U0BKWMG5B&quot;}]"><y>#</y><d>2017-11-01</d><h>07:17</h><w>alice</w>What would you need to see? <a>@weavejester</a></z><z id="t1509520672" t="alice I wouldn&apos;t know what to send"><y>#</y><d>2017-11-01</d><h>07:17</h><w>alice</w>I wouldn&apos;t know what to send</z><z id="t1509520682" t="alice as far as I know the whole implementation is very standard"><y>#</y><d>2017-11-01</d><h>07:18</h><w>alice</w>as far as I know the whole implementation is very standard</z><z id="t1509520688" t="alice and I wouldn&apos;t wanna spam the entire project here"><y>#</y><d>2017-11-01</d><h>07:18</h><w>alice</w>and I wouldn&apos;t wanna spam the entire project here</z><z id="t1509522938" t="alice Alright, using my besst judgement I guess it&apos;s really just two functions"><y>#</y><d>2017-11-01</d><h>07:55</h><w>alice</w>Alright, using my besst judgement I guess it&apos;s really just two functions</z><z id="t1509522946" t="alice (context &quot;/api&quot; [] (POST &quot;/upload&quot; {params :params} (upload params))) "><y>#</y><d>2017-11-01</d><h>07:55</h><w>alice</w><pre>(context &quot;/api&quot; []
           (POST &quot;/upload&quot; {params :params} (upload params)))
</pre></z><z id="t1509522975" t="alice (defn upload [request] (println &quot;thing called&quot;)) "><y>#</y><d>2017-11-01</d><h>07:56</h><w>alice</w><pre>(defn upload [request]
    (println &quot;thing called&quot;))
</pre></z><z id="t1509522979" t="alice and it&apos;ll print twice"><y>#</y><d>2017-11-01</d><h>07:56</h><w>alice</w>and it&apos;ll print twice</z><z id="t1509523160" t="alice Yeah, upload is ONLY referenced in that bit there"><y>#</y><d>2017-11-01</d><h>07:59</h><w>alice</w>Yeah, <code>upload</code> is ONLY referenced in that bit there</z><z id="t1509523165" t="alice it always prints two times"><y>#</y><d>2017-11-01</d><h>07:59</h><w>alice</w>it always prints two times</z><z id="t1509523180" t="alice the request is only handled once afaik but the route wants to happen twice"><y>#</y><d>2017-11-01</d><h>07:59</h><w>alice</w>the request is only handled once afaik but the route wants to happen twice</z><z id="t1509546151" t="weavejester [:attrs {:href &quot;/_/_/users/U5Z4ECHCM&quot;}] It might be related to the lack of an explicit return value. println returns nil , and in Compojure, a return value of nil from a route means ‚Äúthis route didn‚Äôt match, try the next one‚Äù. Try returning a valid response from the route and see if that fixes it."><y>#</y><d>2017-11-01</d><h>14:22</h><w>weavejester</w><a>@alice</a> It might be related to the lack of an explicit return value. <code>println</code> returns <code>nil</code>, and in Compojure, a return value of <code>nil</code> from a route means ‚Äúthis route didn‚Äôt match, try the next one‚Äù. Try returning a valid response from the route and see if that fixes it.</z><z id="t1509828098" t="chadhs [:attrs {:href &quot;/_/_/users/U0BKWMG5B&quot;}] thanks for your help ~last week with my wrap-content-type question. everything finally clicked for me. i know understand that i really should only return response maps (and then it‚Äôs actually easier to just use ring.util.response when i do) when i really need to, and if i just return a string compojure will build the response for me and the middleware behaves as expected üëç :skin-tone-2:"><y>#</y><d>2017-11-04</d><h>20:41</h><w>chadhs</w><a>@weavejester</a> thanks for your help ~last week with my wrap-content-type question.  everything finally clicked for me.  i know understand that i really should only return response maps (and then it‚Äôs actually easier to just use ring.util.response when i do) when i really need to, and if i just return a string compojure will build the response for me and the middleware behaves as expected <b>üëç</b><b>:skin-tone-2:</b></z><z id="t1509828149" t="weavejester [:attrs {:href &quot;/_/_/users/U060QNFEZ&quot;}] You‚Äôre welcome"><y>#</y><d>2017-11-04</d><h>20:42</h><w>weavejester</w><a>@chadhs</a> You‚Äôre welcome</z><z id="t1509828217" t="chadhs was a fun rollercoaster ride of ‚Äúi know how to build clojure web apps ‚Üí i don‚Äôt know anything ‚Üí AHA!‚Äú üòâ"><y>#</y><d>2017-11-04</d><h>20:43</h><w>chadhs</w>was a fun rollercoaster ride of ‚Äúi know how to build clojure web apps ‚Üí i don‚Äôt know anything ‚Üí AHA!‚Äú <b>üòâ</b></z><z id="t1509828256" t="weavejester Returning response maps isn‚Äôt necessarily bad; it‚Äôs just that Compojure has a few shortcuts based on type that make things easier: https://github.com/weavejester/compojure/blob/master/src/compojure/response.clj"><y>#</y><d>2017-11-04</d><h>20:44</h><w>weavejester</w>Returning response maps isn‚Äôt necessarily bad; it‚Äôs just that Compojure has a few shortcuts based on type that make things easier: <a href="https://github.com/weavejester/compojure/blob/master/src/compojure/response.clj" target="_blank">https://github.com/weavejester/compojure/blob/master/src/compojure/response.clj</a></z><z id="t1509828276" t="weavejester But I‚Äôm glad everything clicked for you üôÇ"><y>#</y><d>2017-11-04</d><h>20:44</h><w>weavejester</w>But I‚Äôm glad everything clicked for you <b>üôÇ</b></z><z id="t1509828413" t="chadhs this was born of a middleware refactor; wanted to conform to wrap-defaults + wrap-file-info deprecation. starting with returning response maps was actually good for learning/understanding ring."><y>#</y><d>2017-11-04</d><h>20:46</h><w>chadhs</w>this was born of a middleware refactor; wanted to conform to wrap-defaults + wrap-file-info deprecation.  starting with returning response maps was actually good for learning/understanding ring.</z><z id="t1509828426" t="chadhs cheers!"><y>#</y><d>2017-11-04</d><h>20:47</h><w>chadhs</w>cheers!</z><z id="t1510783915" t="lucian303 i&apos;m trying to set up ring middleware to log all exceptions, but i can&apos;t seem to trigger the catch block in my middleware handler. any ideas? (defn wrap-exception-handler [handler] (fn [request] (try (handler request) (catch Exception e (println &quot;logged error&quot;) (timbre/error e) {:status 500 :body &quot;An error occurred&quot;})))) "><y>#</y><d>2017-11-15</d><h>22:11</h><w>lucian303</w>i&apos;m trying to set up ring middleware to log all exceptions, but i can&apos;t seem to trigger the catch block in my middleware handler. any ideas?
<pre>(defn wrap-exception-handler [handler]
  (fn [request]
    (try (handler request)
         (catch Exception e
           (println &quot;logged error&quot;)
           (timbre/error e)
           {:status 500 :body &quot;An error occurred&quot;}))))
</pre></z><z id="t1510785607" t="zignd [:attrs {:href &quot;/_/_/users/U053KNT7C&quot;}] I have a wrapper to handle exceptions just like yours in my current project and it works. But there&apos;s one thing that it&apos;s worth looking into, the thing trowing inherits from Error or Exception ? there&apos;s a difference in those two types of errors in Java and the ones inheriting from Error will not be caught in a catch for Exception"><y>#</y><d>2017-11-15</d><h>22:40</h><w>zignd</w><a>@lucian303</a> I have a wrapper to handle exceptions just like yours in my current project and it works. But there&apos;s one thing that it&apos;s worth looking into, the thing trowing inherits from <code>Error</code> or <code>Exception</code>? there&apos;s a difference in those two types of errors in Java and the ones inheriting from <code>Error</code> will not be caught in a <code>catch</code> for <code>Exception</code></z><z id="t1510785840" t="lucian303 [:attrs {:href &quot;/_/_/users/U6PCW7E9F&quot;}] i have defined a route with the below throw statement for testing. it&apos;s just a regular Exception ... i also tried modifying the handler to take a Throwable, but it won&apos;t catch the exception: (throw (Exception. &quot;An error has occurred&quot;)) "><y>#</y><d>2017-11-15</d><h>22:44</h><w>lucian303</w><a>@zignd</a> i have defined a route with the below throw statement for testing. it&apos;s just a regular Exception ... i also tried modifying the handler to take a Throwable, but it won&apos;t catch the exception:
<pre>(throw (Exception. &quot;An error has occurred&quot;))
</pre></z><z id="t1510785935" t="zignd [:attrs {:href &quot;/_/_/users/U053KNT7C&quot;}] in this case I&apos;d check the order in which you&apos;re registering your wrappers, can you post it?"><y>#</y><d>2017-11-15</d><h>22:45</h><w>zignd</w><a>@lucian303</a> in this case I&apos;d check the order in which you&apos;re registering your wrappers, can you post it?</z><z id="t1510786157" t="lucian303 sure. i&apos;ve tried it as both the first and last handlers in the chain below. also without the wrap-defaults : (defn wrap-base [handler] (-&gt; ((:middleware defaults) handler) (wrap-sentry (environ/env :sentry-url) [&quot;api-proxy&quot;]) (wrap-defaults (-&gt; api-defaults (assoc-in [:security :anti-forgery] false) (dissoc :session))) wrap-exception-handler)) "><y>#</y><d>2017-11-15</d><h>22:49</h><w>lucian303</w>sure. i&apos;ve tried it as both the first and last handlers in the chain below. also without the <code>wrap-defaults</code>:
<pre>(defn wrap-base [handler]
  (-&gt; ((:middleware defaults) handler)
      (wrap-sentry (environ/env :sentry-url) [&quot;api-proxy&quot;])
      (wrap-defaults
        (-&gt; api-defaults
            (assoc-in [:security :anti-forgery] false)
            (dissoc :session)))
      wrap-exception-handler))
</pre></z><z id="t1510786935" t="zignd i&apos;m kind of confused here, i&apos;m still kind of beginner, but (-&gt; api-defaults (assoc-in [:security :anti-forgery] false) (dissoc :session)) works as expected? because api-defaults from ring.middleware.defaults doesn&apos;t seem to have :session key. but still, i don&apos;t think this would be the issue"><y>#</y><d>2017-11-15</d><h>23:02</h><w>zignd</w>i&apos;m kind of confused here, i&apos;m still kind of beginner, but
<pre>(-&gt; api-defaults
            (assoc-in [:security :anti-forgery] false)
            (dissoc :session))
</pre>
works as expected? because <code>api-defaults</code> from <code>ring.middleware.defaults</code> doesn&apos;t seem to have <code>:session</code> key. but still, i don&apos;t think this would be the issue</z><z id="t1510787681" t="lucian303 you&apos;re right about that. that was left over from when the app was using site-defaults i&apos;ve changed that call to simply (wrap-defaults api-defaults)"><y>#</y><d>2017-11-15</d><h>23:14</h><w>lucian303</w>you&apos;re right about that. that was left over from when the app was using <code>site-defaults</code> i&apos;ve changed that call to simply <code>(wrap-defaults api-defaults)</code></z><z id="t1510787707" t="lucian303 but yeah, it&apos;s not the issue"><y>#</y><d>2017-11-15</d><h>23:15</h><w>lucian303</w>but yeah, it&apos;s not the issue</z><z id="t1510787799" t="zignd i wonder if it even gets called: (defn wrap-exception-handler [handler] (fn [request] (println &quot;called&quot;) ; &lt;----- here (try (handler request) (catch Exception e (println &quot;logged error&quot;) (timbre/error e) {:status 500 :body &quot;An error occurred&quot;})))) "><y>#</y><d>2017-11-15</d><h>23:16</h><w>zignd</w>i wonder if it even gets called:
<pre>(defn wrap-exception-handler [handler]
  (fn [request]
    (println &quot;called&quot;) ; &lt;----- here
    (try (handler request)
         (catch Exception e
           (println &quot;logged error&quot;)
           (timbre/error e)
           {:status 500 :body &quot;An error occurred&quot;}))))
</pre></z><z id="t1510787865" t="zignd [:attrs {:href &quot;/_/_/users/U053KNT7C&quot;}] do your request reaches that point i indicated in the snippet above?"><y>#</y><d>2017-11-15</d><h>23:17</h><w>zignd</w><a>@lucian303</a> do your request reaches that point i indicated in the snippet above?</z><z id="t1510787933" t="zignd cause, maybe it&apos;s not a problem with the error handling, but something related to the other wrappers"><y>#</y><d>2017-11-15</d><h>23:18</h><w>zignd</w>cause, maybe it&apos;s not a problem with the error handling, but something related to the other wrappers</z><z id="t1510787974" t="zignd [:attrs {:href &quot;/_/_/users/U053KNT7C&quot;}] does the sentry wrapper attempts to catch exceptions?"><y>#</y><d>2017-11-15</d><h>23:19</h><w>zignd</w><a>@lucian303</a> does the sentry wrapper attempts to catch exceptions?</z><z id="t1510788631" t="lucian303 [:attrs {:href &quot;/_/_/users/U6PCW7E9F&quot;}] yes, the handler is called, it&apos;s just that the exception is never caught. the sentry handler does catch exceptions but rethrows them. i&apos;ve actually removed the other handlers including wrap-defaults but it still won&apos;t catch exceptions"><y>#</y><d>2017-11-15</d><h>23:30</h><w>lucian303</w><a>@zignd</a> yes, the handler is called, it&apos;s just that the exception is never caught. the sentry handler does catch exceptions but rethrows them. i&apos;ve actually removed the other handlers including <code>wrap-defaults</code> but it still won&apos;t catch exceptions</z><z id="t1510789074" t="lucian303 the wrap-sentry handler seems to actually be very similar to mine, but it is also not working (which is why i&apos;m trying to write my own). very strange ... (defn wrap-sentry [handler dsn &amp; [opts]] (fn [req] (let [alter-fn (or (:http-alter-fn opts) identity)] (try (handler req) (catch Exception e (capture-error dsn req e (:extra opts) (:namespaces opts) alter-fn) (throw e)) (catch AssertionError e (capture-error dsn req e (:extra opts) (:namespaces opts) alter-fn) (throw e)))))) "><y>#</y><d>2017-11-15</d><h>23:37</h><w>lucian303</w>the <code>wrap-sentry</code> handler seems to actually be very similar to mine, but it is also not working (which is why i&apos;m trying to write my own). very strange ...
<pre>(defn wrap-sentry [handler dsn &amp; [opts]]
  (fn [req]
    (let [alter-fn (or (:http-alter-fn opts)
                       identity)]
      (try
        (handler req)
        (catch Exception e
          (capture-error dsn req e (:extra opts) (:namespaces opts) alter-fn)
          (throw e))
        (catch AssertionError e
          (capture-error dsn req e (:extra opts) (:namespaces opts) alter-fn)
          (throw e))))))
</pre></z><z id="t1510790091" t="zignd that&apos;s weird, my last bet would be on the handler returned from this call ((:middleware defaults) handler) , maybe there&apos;s something in it worth investigating"><y>#</y><d>2017-11-15</d><h>23:54</h><w>zignd</w>that&apos;s weird, my last bet would be on the handler returned from this call <code>((:middleware defaults) handler)</code>, maybe there&apos;s something in it worth investigating</z><z id="t1510792832" t="lucian303 yeah, that&apos;s not it either. i can remove that and it still doesn&apos;t work. i do see the exception in stdout so i&apos;m almost certain something is capturing it and not rethrowing it, i&apos;m just not sure what"><y>#</y><d>2017-11-16</d><h>00:40</h><w>lucian303</w>yeah, that&apos;s not it either. i can remove that and it still doesn&apos;t work. i do see the exception in stdout so i&apos;m almost certain something is capturing it and not rethrowing it, i&apos;m just not sure what</z><z id="t1510850721" t="weavejester [:attrs {:href &quot;/_/_/users/U053KNT7C&quot;}] Does it work if you remove all other middleware?"><y>#</y><d>2017-11-16</d><h>16:45</h><w>weavejester</w><a>@lucian303</a> Does it work if you remove all other middleware?</z><z id="t1510855850" t="lucian303 [:attrs {:href &quot;/_/_/users/U0BKWMG5B&quot;}] [:attrs {:href &quot;/_/_/users/U6PCW7E9F&quot;}] i didn&apos;t realize there was a middleware capturing exceptions being added by the macro i was using to set up the routes. once i removed that, i was able to capture exceptions"><y>#</y><d>2017-11-16</d><h>18:10</h><w>lucian303</w><a>@weavejester</a> <a>@zignd</a> i didn&apos;t realize there was a middleware capturing exceptions being added by the macro i was using to set up the routes. once i removed that, i was able to capture exceptions</z><z id="t1510856588" t="weavejester [:attrs {:href &quot;/_/_/users/U053KNT7C&quot;}] Ah, glad you sorted it out üôÇ"><y>#</y><d>2017-11-16</d><h>18:23</h><w>weavejester</w><a>@lucian303</a> Ah, glad you sorted it out <b>üôÇ</b></z><z id="t1510937520" t="sova-soars-the-sora [:attrs {:href &quot;/_/_/users/U0BKWMG5B&quot;}] hey weave how are you my friend?"><y>#</y><d>2017-11-17</d><h>16:52</h><w>sova-soars-the-sora</w><a>@weavejester</a> hey weave how are you my friend?</z><z id="t1510937578" t="weavejester Hullo [:attrs {:href &quot;/_/_/users/U3ES97LAC&quot;}]"><y>#</y><d>2017-11-17</d><h>16:52</h><w>weavejester</w>Hullo <a>@sova</a></z><z id="t1510937696" t="sova-soars-the-sora do you do any realtime backend/frontend comms on your projects?"><y>#</y><d>2017-11-17</d><h>16:54</h><w>sova-soars-the-sora</w>do you do any realtime backend/frontend comms on your projects?</z><z id="t1510937742" t="weavejester [:attrs {:href &quot;/_/_/users/U3ES97LAC&quot;}] I have an ongoing project that uses websockets"><y>#</y><d>2017-11-17</d><h>16:55</h><w>weavejester</w><a>@sova</a> I have an ongoing project that uses websockets</z></g><g id="s4"><z id="t1510937743" t="chadhs does anyone have an example of using ring-mock passing form data (not query params)?"><y>#</y><d>2017-11-17</d><h>16:55</h><w>chadhs</w>does anyone have an example of using <code>ring-mock</code> passing form data (not query params)?</z><z id="t1510937787" t="weavejester [:attrs {:href &quot;/_/_/users/U060QNFEZ&quot;}] (-&gt; (mock/request :post &quot;/foo&quot;) (mock/body {:something &quot;blah&quot;})) "><y>#</y><d>2017-11-17</d><h>16:56</h><w>weavejester</w><a>@chadhs</a> 
<pre>(-&gt; (mock/request :post &quot;/foo&quot;)
    (mock/body {:something &quot;blah&quot;}))
</pre></z><z id="t1510937813" t="chadhs ah the mock/body function; thnx dude!"><y>#</y><d>2017-11-17</d><h>16:56</h><w>chadhs</w>ah the mock/body function; thnx dude!</z><z id="t1510937834" t="sova-soars-the-sora [:attrs {:href &quot;/_/_/users/U0BKWMG5B&quot;}] cool! are you implementing websockets yourself or are you using something well known?"><y>#</y><d>2017-11-17</d><h>16:57</h><w>sova-soars-the-sora</w><a>@weavejester</a> cool!  are you implementing websockets yourself or are you using something well known?</z><z id="t1510937939" t="weavejester [:attrs {:href &quot;/_/_/users/U3ES97LAC&quot;}] I use http-kit for websockets on the server side, and on the client side, Haslett ( https://github.com/weavejester/haslett )"><y>#</y><d>2017-11-17</d><h>16:58</h><w>weavejester</w><a>@sova</a> I use http-kit for websockets on the server side, and on the client side, Haslett (<a href="https://github.com/weavejester/haslett" target="_blank">https://github.com/weavejester/haslett</a>)</z><z id="t1510937955" t="sova-soars-the-sora fockn glorius"><y>#</y><d>2017-11-17</d><h>16:59</h><w>sova-soars-the-sora</w>fockn glorius</z><z id="t1510938006" t="chadhs oh nice, i‚Äôve only played with sente a bit when going through yogthos‚Äô clojure webdev book üëç :skin-tone-2:"><y>#</y><d>2017-11-17</d><h>17:00</h><w>chadhs</w>oh nice, i‚Äôve only played with sente a bit when going through yogthos‚Äô clojure webdev book <b>üëç</b><b>:skin-tone-2:</b></z><z id="t1510938055" t="weavejester I used to use Chord, but the bi-directional channels were a little against the design of core.async."><y>#</y><d>2017-11-17</d><h>17:00</h><w>weavejester</w>I used to use Chord, but the bi-directional channels were a little against the design of core.async.</z><z id="t1510938069" t="weavejester Channels in core.async are more like queues; they‚Äôre deliberately one way."><y>#</y><d>2017-11-17</d><h>17:01</h><w>weavejester</w>Channels in core.async are more like queues; they‚Äôre deliberately one way.</z><z id="t1510938547" t="sova-soars-the-sora you mean with put and take &gt;!"><y>#</y><d>2017-11-17</d><h>17:09</h><w>sova-soars-the-sora</w>you mean with put and take &gt;!</z><z id="t1510938567" t="sova-soars-the-sora I lik channels and the idea / underlying concept, I don&apos;t know of a good use case. I&apos;m sure there are manyv"><y>#</y><d>2017-11-17</d><h>17:09</h><w>sova-soars-the-sora</w>I lik channels and the idea / underlying concept, I don&apos;t know of a good use case.  I&apos;m sure there are manyv</z><z id="t1510938899" t="sova-soars-the-sora sente is great! but a little over my newbie head"><y>#</y><d>2017-11-17</d><h>17:14</h><w>sova-soars-the-sora</w>sente is great!  but a little over my newbie head</z><z id="t1510938947" t="sova-soars-the-sora my current implementation using sente works quite well but the callbacks, i never really figured out cleanly, so my login script at the moment is the hackiest hack job in the world lol"><y>#</y><d>2017-11-17</d><h>17:15</h><w>sova-soars-the-sora</w>my current implementation using sente works quite well but the callbacks, i never really figured out cleanly, so my login script at the moment is the hackiest hack job in the world lol</z><z id="t1510939017" t="sova-soars-the-sora thanks for pointing out haslett [:attrs {:href &quot;/_/_/users/U0BKWMG5B&quot;}] , it&apos;s really quite fascinating and amazing !! how much you can learn implementing the same project using different approaches / libs"><y>#</y><d>2017-11-17</d><h>17:16</h><w>sova-soars-the-sora</w>thanks for pointing out haslett <a>@weavejester</a>, it&apos;s really quite fascinating and amazing !! how much you can learn implementing the same project using different approaches / libs</z><z id="t1511365087" t="magra Hi, I used luminus to write a small programm for a small team. I want people to authenticate using their google accounts. I am trying to use ring-oauth2 . The redirect to google and the redirect back work fine. But when ring-oauth2 gets called on the callback-uri with the Code in the url it throws &quot;Missing required parameter: code&quot;. But the devtools show the parameter to be there. I put the error with stacktrace here: https://pastebin.com/wWeNMrFp . Can somebody tell me what that means. I can not tell where in the process it blows. Or does anyone know of some working code that authenticates ring, ideally luminus against google so I can learn where I am going wrong?"><y>#</y><d>2017-11-22</d><h>15:38</h><w>magra</w>Hi, I used luminus to write a small programm for a small team. I want people to authenticate using their google accounts. I am trying to use <code>ring-oauth2</code>. The redirect to google and the redirect back work fine. But when ring-oauth2 gets called on the callback-uri with the Code in the url it throws &quot;Missing required parameter: code&quot;. But the devtools show the parameter to be there. I put the error with stacktrace here: <a href="https://pastebin.com/wWeNMrFp" target="_blank">https://pastebin.com/wWeNMrFp</a>. Can somebody tell me what that means. I can not tell where in the process it blows. Or does anyone know of some working code that authenticates ring, ideally luminus against google so I can learn where I am going wrong?</z><z id="t1511387061" t="magra I have started a standalone test-project. Just ring as per the ring getting started guide and ring-oauth2. It seems to me that wrap-params does not recognise the parameters from the query-string. I instrumented wrap-oauth2 to pprint the request. It looks like this https://pastebin.com/J9Vinea0 . The :query-string is there but the :params are not. If I feed this map to wrap-params it chockes and will not add the params to the list. When I delete the kv-pair :body #object[https...] then wrap-params works fine. Please help."><y>#</y><d>2017-11-22</d><h>21:44</h><w>magra</w>I have started a standalone test-project. Just ring as per the ring getting started guide and ring-oauth2. It seems to me that wrap-params does not recognise the parameters from the query-string. I instrumented wrap-oauth2 to pprint the request. It looks like this <a href="https://pastebin.com/J9Vinea0" target="_blank">https://pastebin.com/J9Vinea0</a>. The <code>:query-string</code> is there but the <code>:params</code> are not. If I feed this map to wrap-params it chockes and will not add the params to the list. When I delete the kv-pair <code>:body #object[https...]</code> then wrap-params works fine. Please help.</z><z id="t1511388240" t="magra Here is the source of the testing project. Bare ring and ring-oauth2 plus the printout of wrap-params choking. Maybe I ordered things wrong. Please help. https://pastebin.com/4LrdV4GJ ."><y>#</y><d>2017-11-22</d><h>22:04</h><w>magra</w>Here is the source of the testing project. Bare ring and ring-oauth2 plus the printout of wrap-params choking. Maybe I ordered things wrong. Please help. <a href="https://pastebin.com/4LrdV4GJ" target="_blank">https://pastebin.com/4LrdV4GJ</a>.</z><z id="t1511425057" t="magra Ok. That was late yesterday and the wrap choking might be due to me pasting in a string. Today I can rephrase: How do I nest the ring middleware to get oauth2 working? With this code (let [settings (-&gt; site-defaults (assoc-in [:session :cookie-attrs :same-site] :lax))] (run-jetty (wrap-oauth2 (wrap-params (wrap-defaults handler settings)) authmap) {:port 3000})) ring-oauth2/wrap-oauth2 receives the request with :query-string set but no :params . So in ring-oauth2/get-access-token sends a request to the google Server with code set to nil ."><y>#</y><d>2017-11-23</d><h>08:17</h><w>magra</w>Ok. That was late yesterday and the wrap choking might be due to me pasting in a string.
Today I can rephrase: How do I nest the ring middleware to get oauth2 working?
With this code 
<pre>(let [settings (-&gt; site-defaults
                   (assoc-in [:session :cookie-attrs :same-site] :lax))]
  (run-jetty
   (wrap-oauth2 (wrap-params (wrap-defaults handler settings)) authmap) 
   {:port 3000}))</pre>
ring-oauth2/wrap-oauth2 receives the request with <code>:query-string</code> set but no <code>:params</code>. So in ring-oauth2/get-access-token sends a request to the google Server with <code>code</code> set to <code>nil</code>.</z><z id="t1511425275" t="jumar [:attrs {:href &quot;/_/_/users/U15BH4U4V&quot;}] try putting wrap-params to the outermost level. (using threading macro put it as the last middleware in your run-jetty )"><y>#</y><d>2017-11-23</d><h>08:21</h><w>jumar</w><a>@magra</a> try putting wrap-params to the outermost level. (using threading macro put it as the last middleware in your <code>run-jetty</code>)</z><z id="t1511425321" t="jumar this is the source for wrap-params: (fn [request] (handler (params-request request options)))) you can see that it makes params available to the handler it wraps"><y>#</y><d>2017-11-23</d><h>08:22</h><w>jumar</w>this is the source for wrap-params:
<pre>(fn [request]
    (handler (params-request request options))))
</pre>
you can see that it makes params available to the handler it wraps</z><z id="t1511426324" t="magra [:attrs {:href &quot;/_/_/users/U06BE1L6T&quot;}] thanks!!! That solves the params problem!"><y>#</y><d>2017-11-23</d><h>08:38</h><w>magra</w><a>@jumar</a> thanks!!! That solves the params problem!</z><z id="t1511426429" t="magra Now I get a state mismatch üòâ"><y>#</y><d>2017-11-23</d><h>08:40</h><w>magra</w>Now I get a <code>state mismatch</code> <b>üòâ</b></z><z id="t1511466076" t="sova-soars-the-sora [:attrs {:href &quot;/_/_/users/U15BH4U4V&quot;}] did you figure it out üòÑ ?"><y>#</y><d>2017-11-23</d><h>19:41</h><w>sova-soars-the-sora</w><a>@magra</a> did you figure it out <b>üòÑ</b>?</z><z id="t1511515712" t="magra [:attrs {:href &quot;/_/_/users/U3ES97LAC&quot;}] Thanks for asking, but no, i didn&apos;t."><y>#</y><d>2017-11-24</d><h>09:28</h><w>magra</w><a>@sova</a> Thanks for asking, but no, i didn&apos;t.</z><z id="t1511515930" t="magra I switched back to the original ring-oauth2 since I had replaced it with a clone with debugging statements just to make sure that I have not disrupted anything."><y>#</y><d>2017-11-24</d><h>09:32</h><w>magra</w>I switched back to the original ring-oauth2 since I had replaced it with a clone with debugging statements just to make sure that I have not disrupted anything.</z><z id="t1511515947" t="magra The code is (let [settings (-&gt; site-defaults (assoc-in [:session :cookie-attrs :same-site] :lax))] (run-jetty (wrap-params (wrap-oauth2 (wrap-defaults handler settings) authmap)) {:port 3000})) now"><y>#</y><d>2017-11-24</d><h>09:32</h><w>magra</w>The code is <pre>(let [settings (-&gt; site-defaults
                   (assoc-in [:session :cookie-attrs :same-site] :lax))]
  (run-jetty
   (wrap-params (wrap-oauth2 (wrap-defaults handler settings) authmap)) 
   {:port 3000}))</pre> now</z><z id="t1511515983" t="magra It returns State mismatch"><y>#</y><d>2017-11-24</d><h>09:33</h><w>magra</w>It returns <pre>State mismatch</pre></z><z id="t1511516220" t="magra I do not have enough understanding of ring, compojure to know where to place ring-oauth. I spend yesterday reading the code of ring, compojure and ring-oauth."><y>#</y><d>2017-11-24</d><h>09:37</h><w>magra</w>I do not have enough understanding of ring, compojure to know where to place ring-oauth. I spend yesterday reading the code of ring, compojure and ring-oauth.</z><z id="t1511549521" t="seancorfield If you&apos;re already using wrap-defaults I don&apos;t think you need wrap-params as well -- but it&apos;s likely that you need to swap wrap-defaults and wrap-oauth2 since the latter probably relies on some stuff in the former for setup."><y>#</y><d>2017-11-24</d><h>18:52</h><w>seancorfield</w>If you&apos;re already using <code>wrap-defaults</code> I don&apos;t think you need <code>wrap-params</code> as well -- but it&apos;s likely that you need to swap <code>wrap-defaults</code> and <code>wrap-oauth2</code> since the latter probably relies on some stuff in the former for setup.</z><z id="t1511549557" t="seancorfield [:attrs {:href &quot;/_/_/users/U15BH4U4V&quot;}] Ring middleware is executed from the outside-in for requests and from the inside-out for responses."><y>#</y><d>2017-11-24</d><h>18:52</h><w>seancorfield</w><a>@magra</a> Ring middleware is executed from the outside-in for requests and from the inside-out for responses.</z><z id="t1511549780" t="seancorfield Since wrap-oauth2 looks to depend on :session data, it will need the session middleware executed first and that&apos;s part of the defaults so you will want (run-jetty (wrap-defaults (wrap-oauth2 handler authmap) settings) {:port 3000})"><y>#</y><d>2017-11-24</d><h>18:56</h><w>seancorfield</w>Since <code>wrap-oauth2</code> looks to depend on <code>:session</code> data, it will need the session middleware executed first and that&apos;s part of the defaults so you will want <code>(run-jetty (wrap-defaults (wrap-oauth2 handler authmap) settings) {:port 3000})</code></z><z id="t1511633345" t="buzzdan hi everyone üôÇ any idea how can i check if my server is busy? for example in node i have the toobusy-js npm package that checkes the task queue in v8 i have a microservice that chokes sometimes and i want to have a route that checks how busy is it"><y>#</y><d>2017-11-25</d><h>18:09</h><w>buzzdan</w>hi everyone <b>üôÇ</b>
any idea how can i check if my server is busy?
for example in node i have the toobusy-js npm package that checkes the task queue in v8 
i have a microservice that chokes sometimes and i want to have a route that checks how busy is it</z><z id="t1511723223" t="sova-soars-the-sora [:attrs {:href &quot;/_/_/users/U6NU3UY7R&quot;}] you&apos;re using ring... toobusy-js looks like middleware that tracks &quot;maxLag&quot; in seconds for queue processing... i have not heard of anything like this before, but if there is something in java land you can probably use it. i am not sure how one would watch the length of the operation queue through clojure... others may have a better idea"><y>#</y><d>2017-11-26</d><h>19:07</h><w>sova-soars-the-sora</w><a>@buzzdan</a> you&apos;re using ring... toobusy-js looks like middleware that tracks &quot;maxLag&quot; in seconds for queue processing... i have not heard of anything like this before, but if there is something in java land you can probably use it.   i am not sure how one would watch the length of the operation queue through clojure... others may have a better idea</z><z id="t1511782295" t="magra [:attrs {:href &quot;/_/_/users/U04V70XH6&quot;}] wow! Thank you!! I would have been chasing my own tail for a while to figure that out, if ever!"><y>#</y><d>2017-11-27</d><h>11:31</h><w>magra</w><a>@seancorfield</a> wow! Thank you!! I would have been chasing my own tail for a while to figure that out, if ever!</z><z id="t1511887627" t="petr.mensik I&apos;ve already asked this in #ring-swagger but since it&apos;s related to Ring and Compojure I am gonna try it here as well üôÇ I am trying to serve both static content and JSON responses from API however I am struggling with return of correct content type (currently everything is either plain or octet-stream, even files linked from index.html like CSS or SVG). This is the API configuration (def app (api (assoc api-config :middleware [[wrap-resource resources-root] [wrap-cors :access-control-allow-origin [#&quot;\\*&quot;] :access-control-allow-methods [:get :post :put :delete :patch]] wrap-reload [wrap-defaults (-&gt; site-defaults (assoc-in [:not-modified-responses] true) (assoc-in [:security :anti-forgery] false) (assoc-in [:security :ssl-redirect] (not (:dev env))) (assoc-in [:security :hsts] (not (:dev env))))]]) (context &quot;/auth&quot; [] api-routes-login api-routes-password) (context &quot;/api&quot; [] :header-params [authorization :- String] :middleware [[wrap-authentication config/backend]] api-routes-calendar ; more routes here (undocumented (route/resources &quot;/&quot; {:root resources-root}) app-routes not-found-routes))) Where app-routes are (defn- get-page &quot;Servers HTML page from server&quot; ([] (get-page &quot;index.html&quot;)) ([page] (content-type (resource-response page {:root resources-root}) &quot;text/html&quot;))) (defroutes app-routes (GET &quot;/&quot; [] (get-page))) ;etc Basically the same configration worked with plan Compojure (now I am using compojure-api) so what am I doing wrong here? I also tried wrap-content middleware (which can&apos;t really work according to https://stackoverflow.com/questions/29337676/why-does-rings-resource-response-respond-with-application-octet-stream-content )"><y>#</y><d>2017-11-28</d><h>16:47</h><w>petr.mensik</w>I&apos;ve already asked this in #ring-swagger but since it&apos;s related to Ring and Compojure I am gonna try it here as well <b>üôÇ</b>

I am trying to serve both static content and JSON responses from API however I am struggling with return of correct 
content type (currently everything is either plain or octet-stream, even files linked from index.html like CSS or SVG). This is the API configuration
<pre>(def app
(api
(assoc api-config
:middleware [[wrap-resource resources-root]
[wrap-cors :access-control-allow-origin [#&quot;\\*&quot;] :access-control-allow-methods [:get :post :put :delete :patch]]
wrap-reload
[wrap-defaults (-&gt; site-defaults
(assoc-in [:not-modified-responses] true)
(assoc-in [:security :anti-forgery] false)
(assoc-in [:security :ssl-redirect] (not (:dev env)))
(assoc-in [:security :hsts] (not (:dev env))))]])
(context &quot;/auth&quot; []
api-routes-login
api-routes-password)

(context &quot;/api&quot; []
:header-params [authorization :- String]
:middleware [[wrap-authentication config/backend]]
api-routes-calendar ; more routes here
(undocumented (route/resources &quot;/&quot; {:root resources-root})
app-routes
not-found-routes)))
</pre>
Where app-routes are
<pre>(defn- get-page
&quot;Servers HTML page from server&quot;
([]
(get-page &quot;index.html&quot;))
([page]
(content-type (resource-response page {:root resources-root}) &quot;text/html&quot;)))

(defroutes app-routes
(GET &quot;/&quot; [] (get-page))) ;etc
</pre>
Basically the same configration worked with plan Compojure (now I am using compojure-api) so what am I doing wrong here? I also tried <code>wrap-content</code> middleware (which can&apos;t really work according to <a href="https://stackoverflow.com/questions/29337676/why-does-rings-resource-response-respond-with-application-octet-stream-content" target="_blank">https://stackoverflow.com/questions/29337676/why-does-rings-resource-response-respond-with-application-octet-stream-content</a> )</z><z id="t1511920261" t="petr.mensik ok, after some digging I manage to fix it with following middleware configuration. However it now returns octet-stream for all JSON responses, is there a way to fix it? I also would be grateful for some kind of explanation of what&apos;s going on here (I realize it&apos;s because wrap-content middleware but I don&apos;t get why Ring strip content-type header from static content if I omit it - so how can I have both?) (def app (api (assoc api-config :middleware [[wrap-cors :access-control-allow-origin [#&quot;\\*&quot;] :access-control-allow-methods [:get :post :put :delete :patch]] wrap-reload [wrap-defaults (-&gt; site-defaults (assoc-in [:responses :not-modified-responses] true) (assoc-in [:static :resources] resources-root) (assoc-in [:security :anti-forgery] false) (assoc-in [:security :frame-options] :deny) (assoc-in [:security :ssl-redirect] (not (:dev env))) (assoc-in [:security :hsts] (not (:dev env))))]]) "><y>#</y><d>2017-11-29</d><h>01:51</h><w>petr.mensik</w>ok, after some digging I manage to fix it with following middleware configuration. However it now returns octet-stream for all JSON responses, is there a way to fix it? I also would be grateful for some kind of explanation of what&apos;s going on here (I realize it&apos;s because wrap-content middleware but I don&apos;t get why Ring strip content-type header from static content if I omit it - so how can I have both?)
<pre>(def app
  (api
   (assoc api-config
          :middleware
          [[wrap-cors :access-control-allow-origin [#&quot;\\*&quot;] :access-control-allow-methods [:get :post :put :delete :patch]]
           wrap-reload
           [wrap-defaults (-&gt; site-defaults
                              (assoc-in [:responses :not-modified-responses] true)
                              (assoc-in [:static :resources] resources-root)
                              (assoc-in [:security :anti-forgery] false)
                              (assoc-in [:security :frame-options] :deny)
                              (assoc-in [:security :ssl-redirect] (not (:dev env)))
                              (assoc-in [:security :hsts] (not (:dev env))))]])
</pre></z><z id="t1511922400" t="seancorfield [:attrs {:href &quot;/_/_/users/U3H4PBCLE&quot;}] What are you using that expects middleware in that format? I would expect wrap-cors , wrap-reload , and wrap-defaults all to be function calls threaded together around a handler..."><y>#</y><d>2017-11-29</d><h>02:26</h><w>seancorfield</w><a>@petr.mensik</a> What are you using that expects middleware in that format? I would expect <code>wrap-cors</code>, <code>wrap-reload</code>, and <code>wrap-defaults</code> all to be function calls threaded together around a handler...</z><z id="t1511922816" t="seancorfield The &quot;simple&quot; answer is that wrap-content-type doesn&apos;t do what many people expect it to: it sets the content type based on the requested rather than anything intrinsic to the data you are returning."><y>#</y><d>2017-11-29</d><h>02:33</h><w>seancorfield</w>The &quot;simple&quot; answer is that <code>wrap-content-type</code> doesn&apos;t do what many people expect it to: it sets the content type based on the requested  rather than anything intrinsic to the data you are returning.</z><z id="t1511923094" t="seancorfield You need wrap-json-response on the inside, which will set Content-Type: application/json; charset=utf-8 if it gets a response containing :body that satisfies coll?"><y>#</y><d>2017-11-29</d><h>02:38</h><w>seancorfield</w>You need <code>wrap-json-response</code> on the inside, which will set <code>Content-Type: application/json; charset=utf-8</code> if it gets a response containing <code>:body</code> that satisfies <code>coll?</code></z><z id="t1511923122" t="seancorfield If Content-Type is already set before wrap-content-type (in ring-defaults ) gets control, it&apos;ll just pass that through."><y>#</y><d>2017-11-29</d><h>02:38</h><w>seancorfield</w>If <code>Content-Type</code> is already set before <code>wrap-content-type</code> (in <code>ring-defaults</code>) gets control, it&apos;ll just pass that through.</z><z id="t1511923323" t="seancorfield We tend to have (-&gt; handler (wrap-json-response) (wrap-defaults config) (wrap-json-params) (cors)) so that CORS goes first on requests, then json params, then defaults, then your handler (as wrap-json-response does nothing on the way in). When your handler responds, json response goes first, then defaults, then CORS (since wrap-json-params does nothing on the way out)."><y>#</y><d>2017-11-29</d><h>02:42</h><w>seancorfield</w>We tend to have <pre>(-&gt; handler
    (wrap-json-response)
    (wrap-defaults config)
    (wrap-json-params)
    (cors))</pre> so that CORS goes first on requests, then json params, then defaults, then your handler (as wrap-json-response does nothing on the way in). When your handler responds, json response goes first, then defaults, then CORS (since wrap-json-params does nothing on the way out).</z><z id="t1511923364" t="seancorfield Ring middleware is often very order-sensitive."><y>#</y><d>2017-11-29</d><h>02:42</h><w>seancorfield</w>Ring middleware is often very order-sensitive.</z><z id="t1511923505" t="seancorfield It looks like you have two questions in there (based on the above code and your SO question):"><y>#</y><d>2017-11-29</d><h>02:45</h><w>seancorfield</w>It looks like you have two questions in there (based on the above code and your SO question):</z><z id="t1511923536" t="seancorfield 1. why is my JSON response not getting application/json content type? A: you don&apos;t have wrap-json-response in your code above."><y>#</y><d>2017-11-29</d><h>02:45</h><w>seancorfield</w>1. why is my JSON response not getting <code>application/json</code> content type? A: you don&apos;t have <code>wrap-json-response</code> in your code above.</z><z id="t1511923597" t="seancorfield 2. why is resource-response producing application/octet-stream ? A: because it doesn&apos;t set a content type at all, and then wrap-content-type tries to deduce it from the incoming URI (which has no &quot;extension&quot;)."><y>#</y><d>2017-11-29</d><h>02:46</h><w>seancorfield</w>2. why is <code>resource-response</code> producing <code>application/octet-stream</code>? A: because it doesn&apos;t set a content type at all, and then <code>wrap-content-type</code> tries to deduce it from the incoming URI (which has no &quot;extension&quot;).</z><z id="t1511923611" t="seancorfield Hope that helps [:attrs {:href &quot;/_/_/users/U3H4PBCLE&quot;}] ?"><y>#</y><d>2017-11-29</d><h>02:46</h><w>seancorfield</w>Hope that helps <a>@petr.mensik</a>?</z><z id="t1511955452" t="petr.mensik [:attrs {:href &quot;/_/_/users/U04V70XH6&quot;}] I am using Compojure-API which wraps middleware inside it&apos;s app configuration. Your response is definitely helpful, thanks a lot. However Compojure-API uses Muuntaja for content negotiation (which replaces ring-json I guess) and the content type is not recognized even if I use muuntaja.middleware/wrap-format as a first middleware (which is suppose to handle application/json response)"><y>#</y><d>2017-11-29</d><h>11:37</h><w>petr.mensik</w><a>@seancorfield</a> I am using Compojure-API which wraps middleware inside it&apos;s app configuration. Your response is definitely helpful, thanks a lot. However Compojure-API uses Muuntaja for content negotiation (which replaces <code>ring-json</code> I guess) and the content type is not recognized even if I use <code>muuntaja.middleware/wrap-format</code> as a first middleware (which is suppose to handle application/json response)</z><z id="t1511963014" t="ikitommi [:attrs {:href &quot;/_/_/users/U3H4PBCLE&quot;}] hi, I can take a look at that."><y>#</y><d>2017-11-29</d><h>13:43</h><w>ikitommi</w><a>@petr.mensik</a> hi, I can take a look at that.</z><z id="t1511963132" t="petr.mensik [:attrs {:href &quot;/_/_/users/U055NJ5CC&quot;}] thanks a lot, this issue causes me a serious headache right now üòÑ"><y>#</y><d>2017-11-29</d><h>13:45</h><w>petr.mensik</w><a>@ikitommi</a> thanks a lot, this issue causes me a serious headache right now <b>üòÑ</b></z><z id="t1511964383" t="ikitommi [:attrs {:href &quot;/_/_/users/U3H4PBCLE&quot;}] so, what was the actual problem you had?"><y>#</y><d>2017-11-29</d><h>14:06</h><w>ikitommi</w><a>@petr.mensik</a> so, what was the actual problem you had?</z><z id="t1511966312" t="ikitommi By default, Muuntaja returns Streams, you can slurp the :body to get the actual JSON. Or you can configure to use the streaming JSON, in which case you get a lazy muuntaja.protocols.StreamableResponse ."><y>#</y><d>2017-11-29</d><h>14:38</h><w>ikitommi</w>By default, Muuntaja returns Streams, you can <code>slurp</code> the <code>:body</code> to get the actual JSON. Or you can configure to use the streaming JSON, in which case you get a lazy <code>muuntaja.protocols.StreamableResponse</code>.</z><z id="t1511967205" t="petr.mensik 1 All the endpoints returns something like (ok {:thing &quot;another&quot;}) 2. Application returns index.html on GET / which is a SPA downloading and linking other resources (this works well) 3. Routes are configured as in app above. So the problem here is that my responses are not explicitly converted to JSON and don&apos;t contain Content Type header like in your example? Is there a way how to automate that with Muuntaja?"><y>#</y><d>2017-11-29</d><h>14:53</h><w>petr.mensik</w>1 All the endpoints returns something like <code>(ok {:thing &quot;another&quot;})</code>
2. Application returns <code>index.html</code> on GET / which is a SPA downloading and linking other resources (this works well)
3. Routes are configured as in <code>app</code> above.
So the problem here is that my responses are not explicitly converted to JSON and don&apos;t contain Content Type header like in your example? Is there a way how to automate that with Muuntaja?</z><z id="t1511967870" t="ikitommi oh, I see. missed the content-type. It seems that ring-defaults does something odd here. If you run it outside of api , it seems do do better."><y>#</y><d>2017-11-29</d><h>15:04</h><w>ikitommi</w>oh, I see. missed the content-type. It seems that <code>ring-defaults</code> does something odd here. If you run it outside of <code>api</code>, it seems do do better.</z><z id="t1511967890" t="ikitommi does that look better?"><y>#</y><d>2017-11-29</d><h>15:04</h><w>ikitommi</w>does that look better?</z><z id="t1511968001" t="ikitommi My guess is that ring-defaults sets the content-type and Muuntaja is smart/dumb enough to respect the user defined content-type and thus, does not override it."><y>#</y><d>2017-11-29</d><h>15:06</h><w>ikitommi</w>My guess is that ring-defaults sets the content-type and Muuntaja is smart/dumb enough to respect the user defined content-type and thus, does not override it.</z><z id="t1511968079" t="ikitommi https://github.com/metosin/muuntaja/blob/master/src/clj/muuntaja/core.clj#L408"><y>#</y><d>2017-11-29</d><h>15:07</h><w>ikitommi</w><a href="https://github.com/metosin/muuntaja/blob/master/src/clj/muuntaja/core.clj#L408" target="_blank">https://github.com/metosin/muuntaja/blob/master/src/clj/muuntaja/core.clj#L408</a></z><z id="t1511968242" t="petr.mensik Yes, that&apos;s the result I want - but that&apos;s kinda the problem, if I say (assoc-in [:responses :content-type] false) then the adding content-type for static resources stops working. However it adds application/json for the API"><y>#</y><d>2017-11-29</d><h>15:10</h><w>petr.mensik</w>Yes, that&apos;s the result I want - but that&apos;s kinda the problem, if I say <code>(assoc-in [:responses :content-type] false)</code> then the adding content-type for static resources stops working. However it adds application/json for the API</z><z id="t1511968334" t="ikitommi I would serve the static resources as a route in Compojure."><y>#</y><d>2017-11-29</d><h>15:12</h><w>ikitommi</w>I would serve the static resources as a route in Compojure.</z><z id="t1511968376" t="ikitommi something like https://github.com/metosin/compojure-api/wiki/Serving-static-resources#embedded-routes"><y>#</y><d>2017-11-29</d><h>15:12</h><w>ikitommi</w>something like <a href="https://github.com/metosin/compojure-api/wiki/Serving-static-resources#embedded-routes" target="_blank">https://github.com/metosin/compojure-api/wiki/Serving-static-resources#embedded-routes</a></z><z id="t1511968402" t="ikitommi that should work."><y>#</y><d>2017-11-29</d><h>15:13</h><w>ikitommi</w>that should work.</z><z id="t1511968478" t="petr.mensik thats what I have right now, have I? https://pastebin.com/rjgKZsFz"><y>#</y><d>2017-11-29</d><h>15:14</h><w>petr.mensik</w>thats what I have right now, have I? <a href="https://pastebin.com/rjgKZsFz" target="_blank">https://pastebin.com/rjgKZsFz</a></z><z id="t1511968634" t="ikitommi Oh, but you have also the static resources defined via ring-defaults?"><y>#</y><d>2017-11-29</d><h>15:17</h><w>ikitommi</w>Oh, but you have also the static resources defined via ring-defaults?</z><z id="t1511968671" t="petr.mensik Yes, I have to because resources-root differens between dev and production"><y>#</y><d>2017-11-29</d><h>15:17</h><w>petr.mensik</w>Yes, I have to because resources-root differens between dev and production</z><z id="t1511968686" t="petr.mensik I wouldn&apos;t mess with that otherwise"><y>#</y><d>2017-11-29</d><h>15:18</h><w>petr.mensik</w>I wouldn&apos;t mess with that otherwise</z><z id="t1511968725" t="petr.mensik actually I used Noir before so I hoped it can work basically the same way with Compojure API https://github.com/noir-clojure/lib-noir/blob/master/src/noir/util/middleware.clj#L140"><y>#</y><d>2017-11-29</d><h>15:18</h><w>petr.mensik</w>actually I used Noir before so I hoped it can work basically the same way with Compojure API <a href="https://github.com/noir-clojure/lib-noir/blob/master/src/noir/util/middleware.clj#L140" target="_blank">https://github.com/noir-clojure/lib-noir/blob/master/src/noir/util/middleware.clj#L140</a></z><z id="t1511968867" t="ikitommi Not 100% sure, but I would guess that the ring-defaults mw is now serving your static resources and the compojure resource route in the end IS never called."><y>#</y><d>2017-11-29</d><h>15:21</h><w>ikitommi</w>Not 100% sure, but I would guess that the ring-defaults mw is now serving your static resources and the compojure resource route in the end IS never called.</z><z id="t1511969412" t="petr.mensik So what do you think is the best solution which should work?"><y>#</y><d>2017-11-29</d><h>15:30</h><w>petr.mensik</w>So what do you think is the best solution which should work?</z><z id="t1511970076" t="ikitommi so, my 17:04 snippet doesn&apos;t work?"><y>#</y><d>2017-11-29</d><h>15:41</h><w>ikitommi</w>so, my 17:04 snippet doesn&apos;t work?</z><z id="t1511970316" t="ikitommi in it, the muuntaja &amp; ring-defaults are in different order: muuntaja sets the json etc &amp; the defaults should guess the content-type from the resources."><y>#</y><d>2017-11-29</d><h>15:45</h><w>ikitommi</w>in it, the muuntaja &amp; ring-defaults are in different order: muuntaja sets the json etc &amp; the defaults should guess the content-type from the resources.</z><z id="t1511970383" t="petr.mensik I am gonna try it again, thx"><y>#</y><d>2017-11-29</d><h>15:46</h><w>petr.mensik</w>I am gonna try it again, thx</z><z id="t1511978457" t="ikitommi btw, ring-defaults seems to add quite a lot of overhead to the request processing."><y>#</y><d>2017-11-29</d><h>18:00</h><w>ikitommi</w>btw, ring-defaults seems to add quite a lot of overhead to the request processing.</z><z id="t1512030956" t="petr.mensik hmm, it really seems like that - however I am not sure how can I avoid it except wrapping all the middleware by myself"><y>#</y><d>2017-11-30</d><h>08:35</h><w>petr.mensik</w>hmm, it really seems like that - however I am not sure how can I avoid it except wrapping all the middleware by myself</z><z id="t1512040298" t="ikitommi I don‚Äôt think the ring-defaults itself is slow, it‚Äôs just a collection of things. Someone could bench the included mw separately and see if there are slow ones. I would guess it‚Äôs the static resource encoding inspector thingie that‚Äôs causing 98% of the computation. If so, you could take some parts of those for the api-routes and apply the site-stuff only for the static routes. Does that make sense?"><y>#</y><d>2017-11-30</d><h>11:11</h><w>ikitommi</w>I don‚Äôt think the ring-defaults itself is slow, it‚Äôs just a collection of things. Someone could bench the included mw separately and see if there are slow ones. I would guess it‚Äôs the static resource encoding inspector thingie that‚Äôs causing 98% of the computation. If so, you could take some parts of those for the api-routes and apply the site-stuff only for the static routes. Does that make sense?</z><z id="t1512040397" t="ikitommi and, when done, some ‚Äúgood practise‚Äù example setup would be great."><y>#</y><d>2017-11-30</d><h>11:13</h><w>ikitommi</w>and, when done, some ‚Äúgood practise‚Äù example setup would be great.</z><z id="t1512041298" t="ikitommi also, ring-defaults has some parameter-settings, which also are included in compojure-api defaults. Here are the chains: * https://github.com/metosin/compojure-api/blob/master/src/compojure/api/middleware.clj#L264-L290 * https://github.com/ring-clojure/ring-defaults/blob/master/src/ring/middleware/defaults.clj#L98-L117"><y>#</y><d>2017-11-30</d><h>11:28</h><w>ikitommi</w>also, ring-defaults has some parameter-settings, which also are included in compojure-api defaults. Here are the chains:
* <a href="https://github.com/metosin/compojure-api/blob/master/src/compojure/api/middleware.clj#L264-L290" target="_blank">https://github.com/metosin/compojure-api/blob/master/src/compojure/api/middleware.clj#L264-L290</a>
* <a href="https://github.com/ring-clojure/ring-defaults/blob/master/src/ring/middleware/defaults.clj#L98-L117" target="_blank">https://github.com/ring-clojure/ring-defaults/blob/master/src/ring/middleware/defaults.clj#L98-L117</a></z><z id="t1512059164" t="jazzytomato I am trying to use compojure-api with spec tools but I get Caused by: java.lang.NullPointerException, compiling:(ring/util/http_response.clj:1142:1) ... Can&apos;t import ring.util.response/get-charset, try updating to Ring 1.6.0+ my project looks like that [ring/ring-core &quot;1.6.3&quot;] [metosin/compojure-api &quot;2.0.0-alpha15&quot;] and lein deps :tree only yields ring-core version 1.6.3 I can&apos;t figure out what&apos;s wrong üò≠"><y>#</y><d>2017-11-30</d><h>16:26</h><w>jazzytomato</w>I am trying to use compojure-api with spec tools but I get 
<pre>Caused by: java.lang.NullPointerException, compiling:(ring/util/http_response.clj:1142:1) 
...
Can&apos;t import ring.util.response/get-charset, try updating to Ring 1.6.0+
</pre>
my project looks like that
<pre>[ring/ring-core &quot;1.6.3&quot;]
                 [metosin/compojure-api &quot;2.0.0-alpha15&quot;]
</pre>
and <code>lein deps :tree</code> only yields ring-core version 1.6.3

I can&apos;t figure out what&apos;s wrong <b>üò≠</b></z><z id="t1512059744" t="ikitommi [:attrs {:href &quot;/_/_/users/U50QMCY3S&quot;}] do you use lein-ring ? It brings extra (potentially) old deps at runtime, overriding the project setup. Updating to latest should help."><y>#</y><d>2017-11-30</d><h>16:35</h><w>ikitommi</w><a>@jazzytomato</a> do you use <code>lein-ring</code>? It brings extra (potentially) old deps at runtime, overriding the project setup. Updating to latest should help.</z><z id="t1512059785" t="jazzytomato I don&apos;t use lein-ring"><y>#</y><d>2017-11-30</d><h>16:36</h><w>jazzytomato</w>I don&apos;t use lein-ring</z><z id="t1512060241" t="jazzytomato I think lein clean fixed it..."><y>#</y><d>2017-11-30</d><h>16:44</h><w>jazzytomato</w>I think lein clean fixed it...</z><z id="t1512060266" t="jazzytomato sorry, I&apos;m a newbie üòÑ"><y>#</y><d>2017-11-30</d><h>16:44</h><w>jazzytomato</w>sorry, I&apos;m a newbie <b>üòÑ</b></z><z id="t1512060354" t="ikitommi was about to suggest lein-clean :)"><y>#</y><d>2017-11-30</d><h>16:45</h><w>ikitommi</w>was about to suggest lein-clean :)</z><z id="t1512061084" t="jazzytomato thanks üôá"><y>#</y><d>2017-11-30</d><h>16:58</h><w>jazzytomato</w>thanks <b>üôá</b></z><z id="t1512352145" t="Drew Verlee When i start my compure-api app i get the following warning about the /config.json response map being nil I dont think its an issue, but why is it warning me about that?"><y>#</y><d>2017-12-04</d><h>01:49</h><w>Drew Verlee</w>When i start my compure-api app i get the following warning about the /config.json response map being nil

I dont think its an issue, but why is it warning me about that?</z><z id="t1512352204" t="Drew Verlee I searched around and didnt see anything relating to it."><y>#</y><d>2017-12-04</d><h>01:50</h><w>Drew Verlee</w>I searched around and didnt see anything relating to it.</z><z id="t1512355321" t="seancorfield [:attrs {:href &quot;/_/_/users/U0DJ4T5U1&quot;}] Do you mean like this SO question? https://stackoverflow.com/questions/46299061/response-map-is-nil-compojure"><y>#</y><d>2017-12-04</d><h>02:42</h><w>seancorfield</w><a>@drewverlee</a> Do you mean like this SO question? <a href="https://stackoverflow.com/questions/46299061/response-map-is-nil-compojure" target="_blank">https://stackoverflow.com/questions/46299061/response-map-is-nil-compojure</a></z><z id="t1512366398" t="ikitommi [:attrs {:href &quot;/_/_/users/U0DJ4T5U1&quot;}] the alpha-15 used wrong version of the bundled swagger-ui, pushed a fix to alpha-16. So: c-api wires the swagger-ui and the server together so that one can configure how the swagger-ui works just by configuring the server app. Just that swagger-ui 3.0.0* is a total rewrite and https://github.com/metosin/ring-swagger/pull/123 needs to be fixed first."><y>#</y><d>2017-12-04</d><h>05:46</h><w>ikitommi</w><a>@drewverlee</a> the alpha-15 used wrong version of the bundled swagger-ui, pushed a fix to alpha-16. So: c-api wires the swagger-ui and the server together so that one can configure how the swagger-ui works just by configuring the server app. Just that swagger-ui 3.0.0* is a total rewrite and <a href="https://github.com/metosin/ring-swagger/pull/123" target="_blank">https://github.com/metosin/ring-swagger/pull/123</a> needs to be fixed first.</z><z id="t1512395019" t="Drew Verlee [:attrs {:href &quot;/_/_/users/U055NJ5CC&quot;}] Gotcha, thanks for the update."><y>#</y><d>2017-12-04</d><h>13:43</h><w>Drew Verlee</w><a>@ikitommi</a> Gotcha, thanks for the update.</z><z id="t1512584159" t="sova-soars-the-sora Hi everyone. How can I set sessions without using a (POST &quot;/something) that returns a {:session .. :body... :headers .. } map.? I want to do logins over sockets and I want to set the ring session once a login is verified, but it looks like it needs POST?"><y>#</y><d>2017-12-06</d><h>18:15</h><w>sova-soars-the-sora</w>Hi everyone.  How can I set sessions without using a (POST &quot;/something) that returns a {:session  .. :body... :headers .. } map.?  I want to do logins over sockets and I want to set the ring session once a login is verified, but it looks like it needs POST?</z><z id="t1512585298" t="sova-soars-the-sora I would like to set the session variable for a user serverside without a page refresh. Possible?"><y>#</y><d>2017-12-06</d><h>18:34</h><w>sova-soars-the-sora</w>I would like to set the session variable for a user serverside without a page refresh.  Possible?</z><z id="t1512605983" t="weavejester [:attrs {:href &quot;/_/_/users/U3ES97LAC&quot;}] sessions are for maintaining state across requests. If you‚Äôre logging in over a websocket, maybe you just store the login details in local state? Alternatively, you could write to the session store manually, if the store doesn‚Äôt use cookies. If you are storing the session state in cookies, then you might have to get more creative, e.g. by sending the encrypted data through the socket, and letting js put it into a cookie. Or use XHRs."><y>#</y><d>2017-12-07</d><h>00:19</h><w>weavejester</w><a>@sova</a> sessions are for maintaining state across requests. If you‚Äôre logging in over a websocket, maybe you just store the login details in local state? Alternatively, you could write to the session store manually, if the store doesn‚Äôt use cookies. If you are storing the session state in cookies, then you might have to get more creative, e.g. by sending the encrypted data through the socket, and letting js put it into a cookie. Or use XHRs.</z><z id="t1512610693" t="sova-soars-the-sora thanks weave, yes i came to the conclusion that it is best to store the session stuff locally"><y>#</y><d>2017-12-07</d><h>01:38</h><w>sova-soars-the-sora</w>thanks weave, yes i came to the conclusion that it is best to store the session stuff locally</z><z id="t1512615182" t="sova-soars-the-sora [:attrs {:href &quot;/_/_/users/U0BKWMG5B&quot;}] do you know how I can destructure sente data"><y>#</y><d>2017-12-07</d><h>02:53</h><w>sova-soars-the-sora</w><a>@weavejester</a> do you know how I can destructure sente data</z><z id="t1512615361" t="sova-soars-the-sora that looks like"><y>#</y><d>2017-12-07</d><h>02:56</h><w>sova-soars-the-sora</w>that looks like</z><z id="t1512644829" t="weavejester [:attrs {:href &quot;/_/_/users/U3ES97LAC&quot;}] the same way you destructure any other data, I assume."><y>#</y><d>2017-12-07</d><h>11:07</h><w>weavejester</w><a>@sova</a> the same way you destructure any other data, I assume.</z><z id="t1512691905" t="sova-soars-the-sora [:attrs {:href &quot;/_/_/users/U0BKWMG5B&quot;}] thanks I just grabbed (first and (second ..."><y>#</y><d>2017-12-08</d><h>00:11</h><w>sova-soars-the-sora</w><a>@weavejester</a> thanks I just grabbed (first and (second ...</z><z id="t1512691927" t="sova-soars-the-sora I feel bad to ask so many questions to you, but I have one more..."><y>#</y><d>2017-12-08</d><h>00:12</h><w>sova-soars-the-sora</w>I feel bad to ask so many questions to you, but I have one more...</z><z id="t1512691943" t="sova-soars-the-sora how can I write directly to the session? is the session data stored on the clientside?"><y>#</y><d>2017-12-08</d><h>00:12</h><w>sova-soars-the-sora</w>how can I write directly to the session?  is the session data stored on the clientside?</z><z id="t1512692013" t="sova-soars-the-sora I want to change the session data via sente event, which does have a ring-map but i don&apos;t think affecting the incoming copy of the ring parameters would do anything to the session. it seems like a redirect / url shift would be required to change session data w/ my understanding at this point"><y>#</y><d>2017-12-08</d><h>00:13</h><w>sova-soars-the-sora</w>I want to change the session data via sente event, which does have a ring-map but i don&apos;t think affecting the incoming copy of the ring parameters would do anything to the session.  it seems like a redirect / url shift would be required to change session data w/ my understanding at this point</z><z id="t1512692885" t="weavejester [:attrs {:href &quot;/_/_/users/U3ES97LAC&quot;}] It depends how you‚Äôre storing the session."><y>#</y><d>2017-12-08</d><h>00:28</h><w>weavejester</w><a>@sova</a> It depends how you‚Äôre storing the session.</z><z id="t1512693562" t="weavejester What session store are you using?"><y>#</y><d>2017-12-08</d><h>00:39</h><w>weavejester</w>What session store are you using?</z><z id="t1512719550" t="sova-soars-the-sora [:attrs {:href &quot;/_/_/users/U0BKWMG5B&quot;}] i want to write directly to the ring session, as part of the map, if possible. my current scheme just stores at atom in the clientside of login email, login time, and hash."><y>#</y><d>2017-12-08</d><h>07:52</h><w>sova-soars-the-sora</w><a>@weavejester</a> i want to write directly to the ring session, as part of the map, if possible.  my current scheme just stores at atom in the clientside of login email, login time, and hash.</z><z id="t1512719566" t="sova-soars-the-sora user submits info over socket -&gt; gets authentication information over socket"><y>#</y><d>2017-12-08</d><h>07:52</h><w>sova-soars-the-sora</w>user submits info over socket -&gt; gets authentication information over socket</z><z id="t1512719622" t="sova-soars-the-sora but I want to make sure that if a user navigated to say /article/:whatever they would still have their login creds active. writing to localStorage won&apos;t persist this if the user has localStorage disabled, so i am thinking having ring session as a directory-level fallback"><y>#</y><d>2017-12-08</d><h>07:53</h><w>sova-soars-the-sora</w>but I want to make sure that if a user navigated to say /article/:whatever they would still have their login creds active.  writing to localStorage won&apos;t persist this if the user has localStorage disabled, so i am thinking having ring session as a directory-level fallback</z><z id="t1512719695" t="sova-soars-the-sora does my approach make sense? maybe the authentication can all be ring session level..."><y>#</y><d>2017-12-08</d><h>07:54</h><w>sova-soars-the-sora</w>does my approach make sense?  maybe the authentication can all be ring session level...</z><z id="t1512719896" t="sova-soars-the-sora to be honest, i was not aware that there are different ways to store the session. what are the alternatives? (googles furiously)"><y>#</y><d>2017-12-08</d><h>07:58</h><w>sova-soars-the-sora</w>to be honest, i was not aware that there are different ways to store the session.  what are the alternatives?  (googles furiously)</z><z id="t1512735804" t="weavejester [:attrs {:href &quot;/_/_/users/U3ES97LAC&quot;}] Sessions persist over requests, so they require some form of storage. By default, Ring provides two stores: an in-memory atom held on the server, and through encrypted cookies. You can also use third-party stores, or write your own, that store sessions on the filesystem or in a database."><y>#</y><d>2017-12-08</d><h>12:23</h><w>weavejester</w><a>@sova</a> Sessions persist over requests, so they require some form of storage. By default, Ring provides two stores: an in-memory atom held on the server, and through encrypted cookies. You can also use third-party stores, or write your own, that store sessions on the filesystem or in a database.</z><z id="t1512735899" t="weavejester You can access the store directly to update the session in most cases. Cookie stores are an exception, since they require a HTTP response."><y>#</y><d>2017-12-08</d><h>12:24</h><w>weavejester</w>You can access the store directly to update the session in most cases. Cookie stores are an exception, since they require a HTTP response.</z><z id="t1512735970" t="weavejester If you want to have the session stored when the user logs in via a session, you need some way of setting a cookie. I believe you could do this via an XHR, or you could grab the value of the session cookie and set it with Java/Clojurescript instead."><y>#</y><d>2017-12-08</d><h>12:26</h><w>weavejester</w>If you want to have the session stored when the user logs in via a session, you need some way of setting a cookie. I believe you could do this via an XHR, or you could grab the value of the session cookie and set it with Java/Clojurescript instead.</z><z id="t1512853516" t="Drew Verlee this is the right place to asking questions about compjure-api right?"><y>#</y><d>2017-12-09</d><h>21:05</h><w>Drew Verlee</w>this is the right place to asking questions about compjure-api right?</z><z id="t1512864812" t="sova-soars-the-sora [:attrs {:href &quot;/_/_/users/U0BKWMG5B&quot;}] aha thanks my friend. So theoretically I can change the in-memory ring session atom ... that sounds messy. I think I will just go back to sessions in the ring middleware, it makes not too much sense to trouble myself with reinventing wheels"><y>#</y><d>2017-12-10</d><h>00:13</h><w>sova-soars-the-sora</w><a>@weavejester</a> aha thanks my friend.  So theoretically I can change the in-memory ring session atom ... that sounds messy.   I think I will just go back to sessions in the ring middleware, it makes not too much sense to trouble myself with reinventing wheels</z><z id="t1512874989" t="Drew Verlee So randomly, the compjure-api start returning &quot;unkown exception&quot; class &quot;illegalArgugmentsException&quot;. I just evaled the same expression like 10 times and on the 10th time it did it. If i restart my repl, it goes back to normal. Maybe a resource issue?"><y>#</y><d>2017-12-10</d><h>03:03</h><w>Drew Verlee</w>So randomly, the compjure-api start returning &quot;unkown exception&quot; class &quot;illegalArgugmentsException&quot;. I just evaled the same expression like 10 times and on the 10th time it did it. If i restart my repl, it goes back to normal. Maybe a resource issue?</z><z id="t1512897030" t="ikitommi [:attrs {:href &quot;/_/_/users/U0DJ4T5U1&quot;}] there is #ring-swagger, haven&apos;t seen that kind error, with latest alpha I guess?"><y>#</y><d>2017-12-10</d><h>09:10</h><w>ikitommi</w><a>@drewverlee</a> there is #ring-swagger, haven&apos;t seen that kind error, with latest alpha I guess?</z><z id="t1512897211" t="ikitommi If you can share your setup, I could take a look."><y>#</y><d>2017-12-10</d><h>09:13</h><w>ikitommi</w>If you can share your setup, I could take a look.</z><z id="t1513013595" t="mikerod Doing something like lein ring uberwar keeps failing in my project with an exception of the form: java.lang.AssertionError: Assert failed: (dep-spec? dep-spec) at leinjacker.deps$dep_name.invokeStatic(deps.clj:23) at leinjacker.deps$dep_name.invoke(deps.clj:23) at leinjacker.deps$has_dep_QMARK_$fn__9834.invoke(deps.clj:41) at clojure.core$some.invokeStatic(core.clj:2592) at clojure.core$some.invoke(core.clj:2583) at leinjacker.deps$has_dep_QMARK_.invokeStatic(deps.clj:41) at leinjacker.deps$has_dep_QMARK_.invoke(deps.clj:30) at leinjacker.deps$add_if_missing.invokeStatic(deps.clj:50) at leinjacker.deps$add_if_missing.invoke(deps.clj:43) at leiningen.ring.war$add_servlet_dep.invokeStatic(war.clj:223) at leiningen.ring.war$add_servlet_dep.invoke(war.clj:221) at leiningen.ring.war$war.invokeStatic(war.clj:232) at leiningen.ring.war$war.doInvoke(war.clj:226) at clojure.lang.RestFn.invoke(RestFn.java:521) at leiningen.ring.uberwar$uberwar.invokeStatic(uberwar.clj:42) at leiningen.ring.uberwar$uberwar.invoke(uberwar.clj:37) at leiningen.ring.uberwar$uberwar.invokeStatic(uberwar.clj:40) at leiningen.ring.uberwar$uberwar.invoke(uberwar.clj:37) at clojure.lang.AFn.applyToHelper(AFn.java:154) at clojure.lang.AFn.applyTo(AFn.java:144) at clojure.core$apply.invokeStatic(core.clj:648) at clojure.core$apply.invoke(core.clj:641) at leiningen.ring$ring.invokeStatic(ring.clj:28) "><y>#</y><d>2017-12-11</d><h>17:33</h><w>mikerod</w>Doing something like <code>lein ring uberwar</code> keeps failing in my project with an exception of the form:
<pre>java.lang.AssertionError: Assert failed: (dep-spec? dep-spec)
	at leinjacker.deps$dep_name.invokeStatic(deps.clj:23)
	at leinjacker.deps$dep_name.invoke(deps.clj:23)
	at leinjacker.deps$has_dep_QMARK_$fn__9834.invoke(deps.clj:41)
	at clojure.core$some.invokeStatic(core.clj:2592)
	at clojure.core$some.invoke(core.clj:2583)
	at leinjacker.deps$has_dep_QMARK_.invokeStatic(deps.clj:41)
	at leinjacker.deps$has_dep_QMARK_.invoke(deps.clj:30)
	at leinjacker.deps$add_if_missing.invokeStatic(deps.clj:50)
	at leinjacker.deps$add_if_missing.invoke(deps.clj:43)
	at leiningen.ring.war$add_servlet_dep.invokeStatic(war.clj:223)
	at leiningen.ring.war$add_servlet_dep.invoke(war.clj:221)
	at leiningen.ring.war$war.invokeStatic(war.clj:232)
	at leiningen.ring.war$war.doInvoke(war.clj:226)
	at clojure.lang.RestFn.invoke(RestFn.java:521)
	at leiningen.ring.uberwar$uberwar.invokeStatic(uberwar.clj:42)
	at leiningen.ring.uberwar$uberwar.invoke(uberwar.clj:37)
	at leiningen.ring.uberwar$uberwar.invokeStatic(uberwar.clj:40)
	at leiningen.ring.uberwar$uberwar.invoke(uberwar.clj:37)
	at clojure.lang.AFn.applyToHelper(AFn.java:154)
	at clojure.lang.AFn.applyTo(AFn.java:144)
	at clojure.core$apply.invokeStatic(core.clj:648)
	at clojure.core$apply.invoke(core.clj:641)
	at leiningen.ring$ring.invokeStatic(ring.clj:28)
</pre></z><z id="t1513013613" t="mikerod I see that lein.ring.war/war attempts to automatically add more deps to project when needed"><y>#</y><d>2017-12-11</d><h>17:33</h><w>mikerod</w>I see that <code>lein.ring.war/war</code> attempts to automatically add more deps to project when needed</z><z id="t1513013627" t="mikerod I leave those dependencies out and get this error, I try to explicitly include them to skip the problem and I still get the error"><y>#</y><d>2017-12-11</d><h>17:33</h><w>mikerod</w>I leave those dependencies out and get this error, I try to explicitly include them to skip the problem and I still get the error</z><z id="t1513013643" t="mikerod I tried this with both [lein-ring &quot;0.12.1&quot;] and [lein-ring &quot;0.12.2&quot;]"><y>#</y><d>2017-12-11</d><h>17:34</h><w>mikerod</w>I tried this with both <code>[lein-ring &quot;0.12.1&quot;]</code> and <code>[lein-ring &quot;0.12.2&quot;]</code></z><z id="t1513013662" t="mikerod I don‚Äôt get why it‚Äôd be failing. I can‚Äôt see anything I can control in my project.clj to make this not happen"><y>#</y><d>2017-12-11</d><h>17:34</h><w>mikerod</w>I don‚Äôt get why it‚Äôd be failing. I can‚Äôt see anything I can control in my project.clj to make this not happen</z><z id="t1513013735" t="mikerod the assert failure also isn‚Äôt super informative. I wish it printed out the actual value"><y>#</y><d>2017-12-11</d><h>17:35</h><w>mikerod</w>the assert failure also isn‚Äôt super informative. I wish it printed out the actual value</z><z id="t1513016168" t="mikerod Figured it out. lein-ring uses leinjacker which didn‚Äôt add support to :managed-dependencies in any released version."><y>#</y><d>2017-12-11</d><h>18:16</h><w>mikerod</w>Figured it out. <code>lein-ring</code> uses <code>leinjacker</code> which didn‚Äôt add support to <code>:managed-dependencies</code> in any released version.</z><z id="t1513016175" t="mikerod My project is using managed deps"><y>#</y><d>2017-12-11</d><h>18:16</h><w>mikerod</w>My project is using managed deps</z><z id="t1513016194" t="mikerod So, looks like there isn‚Äôt a super graceful way to handle this other than to just not used managed deps yet."><y>#</y><d>2017-12-11</d><h>18:16</h><w>mikerod</w>So, looks like there isn‚Äôt a super graceful way to handle this other than to just not used managed deps yet.</z><z id="t1513016292" t="mikerod I guess it does look like a fork may have it covered. Will try that for now."><y>#</y><d>2017-12-11</d><h>18:18</h><w>mikerod</w>I guess it does look like a fork may have it covered. Will try that for now.</z><z id="t1513986334" t="jgh hey, how do i get ring-json to return proper status codes?"><y>#</y><d>2017-12-22</d><h>23:45</h><w>jgh</w>hey, how do i get <code>ring-json</code> to return proper status codes?</z><z id="t1513986358" t="jgh also, why dont the ring-json examples include status codes? They‚Äôre p. cool and a few people use them here and there üòõ"><y>#</y><d>2017-12-22</d><h>23:45</h><w>jgh</w>also, why dont the <code>ring-json</code> examples include status codes?  They‚Äôre p. cool and a few people use them here and there <b>üòõ</b></z><z id="t1513986981" t="jgh ah got it working, this guy‚Äôs got the good stuff: "><y>#</y><d>2017-12-22</d><h>23:56</h><w>jgh</w>ah got it working, this guy‚Äôs got the good stuff: <code></code></z><z id="t1514649513" t="sandbags I&apos;m getting an assertion error from inside Ring related to the CookieStore. It&apos;s been working okay for some time and to my knowledge I&apos;ve not altered anything relating to it: https://gist.github.com/anonymous/e05eadc647dda32a90f0d031126eedf6"><y>#</y><d>2017-12-30</d><h>15:58</h><w>sandbags</w>I&apos;m getting an assertion error from inside Ring related to the CookieStore. It&apos;s been working okay for some time and to my knowledge I&apos;ve not altered anything relating to it: <a href="https://gist.github.com/anonymous/e05eadc647dda32a90f0d031126eedf6" target="_blank">https://gist.github.com/anonymous/e05eadc647dda32a90f0d031126eedf6</a></z><z id="t1514649645" t="sandbags The last things i&apos;ve been doing have been related to switching from sqlite to mysql but... not implicated with ring, sessions, or cookies that I know of"><y>#</y><d>2017-12-30</d><h>16:00</h><w>sandbags</w>The last things i&apos;ve been doing have been related to switching from sqlite to mysql but... not implicated with ring, sessions, or cookies that I know of</z><z id="t1514649773" t="sandbags Ah!"><y>#</y><d>2017-12-30</d><h>16:02</h><w>sandbags</w>Ah!</z><z id="t1514649827" t="sandbags Except that Friend stores the user identity in the session, and I switched from sqlite to Mysql because sqlite was returning datetimes as strings, MySQL is returning them as some kind of object, presumably one which does not serialise!"><y>#</y><d>2017-12-30</d><h>16:03</h><w>sandbags</w>Except that Friend stores the user identity in the session, and I switched from sqlite to Mysql because sqlite was returning datetimes as strings, MySQL is returning them as some kind of object, presumably one which does not serialise!</z><z id="t1514649869" t="sandbags everything is connected to everything‚Ä¶"><y>#</y><d>2017-12-30</d><h>16:04</h><w>sandbags</w>everything is connected to everything‚Ä¶</z><z id="t1514823867" t="Shantanu Kumar Can anybody tell what‚Äôs the difference between Ring-reload middleware and https://github.com/jakemcc/reload ?"><y>#</y><d>2018-01-01</d><h>16:24</h><w>Shantanu Kumar</w>Can anybody tell what‚Äôs the difference between Ring-reload middleware and <a href="https://github.com/jakemcc/reload" target="_blank">https://github.com/jakemcc/reload</a> ?</z><z id="t1514995605" t="petr.mensik Is there a way how to get servers DNS name or IP without having the request or response map?"><y>#</y><d>2018-01-03</d><h>16:06</h><w>petr.mensik</w>Is there a way how to get servers DNS name or IP without having the request or response map?</z><z id="t1514996377" t="weavejester [:attrs {:href &quot;/_/_/users/U3H4PBCLE&quot;}] You can look up the IP address of the machine the process is running on, but if you‚Äôre behind a load balancer‚Ä¶"><y>#</y><d>2018-01-03</d><h>16:19</h><w>weavejester</w><a>@petr.mensik</a> You can look up the IP address of the machine the process is running on, but if you‚Äôre behind a load balancer‚Ä¶</z><z id="t1514996560" t="petr.mensik [:attrs {:href &quot;/_/_/users/U0BKWMG5B&quot;}] I am, unfortunately (hosted on AWS)."><y>#</y><d>2018-01-03</d><h>16:22</h><w>petr.mensik</w><a>@weavejester</a> I am, unfortunately (hosted on AWS).</z><z id="t1514996613" t="weavejester There might be some AWS way to provide the host. And AWS I believe can instantiate VMs with shell variables."><y>#</y><d>2018-01-03</d><h>16:23</h><w>weavejester</w>There might be some AWS way to provide the host. And AWS I believe can instantiate VMs with shell variables.</z><z id="t1514996637" t="weavejester So you could set up something to pass the host/IP to the servers that way."><y>#</y><d>2018-01-03</d><h>16:23</h><w>weavejester</w>So you could set up something to pass the host/IP to the servers that way.</z><z id="t1514997099" t="petr.mensik yep, I was thought I&apos;ll try this way. I was just thinking that Ring might store that information somewhere"><y>#</y><d>2018-01-03</d><h>16:31</h><w>petr.mensik</w>yep, I was thought I&apos;ll try this way. I was just thinking that Ring might store that information somewhere</z><z id="t1515336367" t="Shantanu Kumar Hi. Can anybody point me to a good example for understanding async Ring handlers and middleware? Esp raising exceptions."><y>#</y><d>2018-01-07</d><h>14:46</h><w>Shantanu Kumar</w>Hi. Can anybody point me to a good example for understanding async Ring handlers and middleware? Esp raising exceptions.</z><z id="t1515337456" t="Shantanu Kumar In the middleware, do I need to catch any exceptions and call (raise thrown) ?"><y>#</y><d>2018-01-07</d><h>15:04</h><w>Shantanu Kumar</w>In the middleware, do I need to catch any exceptions and call <code>(raise thrown)</code>?</z><z id="t1515337714" t="Shantanu Kumar For example, in the middleware below: (defn ping-middleware ([handler] (ping-middleware handler #{&quot;/ping&quot; &quot;/ping/&quot;})) ([handler ping-uris] (ping-middleware handler ping-uris (constantly &quot;pong&quot;))) ([handler ping-uris body-generator] (let [ping-uris-set (set ping-uris) ping-response (fn [] {:status 200 :body (body-generator) :headers {&quot;Content-Type&quot; &quot;text/plain&quot; &quot;Cache-Control&quot; &quot;no-store, no-cache, must-revalidate&quot;}})] (fn ([request] (if (-&gt;&gt; (:uri request) (contains? ping-uris-set)) (ping-response) (handler request))) ([request respond raise] (if (-&gt;&gt; (:uri request) (contains? ping-uris-set)) (respond (ping-response)) (handler request respond raise))))))) "><y>#</y><d>2018-01-07</d><h>15:08</h><w>Shantanu Kumar</w>For example, in the middleware below:
<pre>(defn ping-middleware
  ([handler]
    (ping-middleware handler #{&quot;/ping&quot; &quot;/ping/&quot;}))
  ([handler ping-uris]
    (ping-middleware handler ping-uris (constantly &quot;pong&quot;)))
  ([handler ping-uris body-generator]
    (let [ping-uris-set (set ping-uris)
          ping-response (fn [] {:status 200
                                :body (body-generator)
                                :headers {&quot;Content-Type&quot;  &quot;text/plain&quot;
                                          &quot;Cache-Control&quot; &quot;no-store, no-cache, must-revalidate&quot;}})]
      (fn
        ([request]
          (if (-&gt;&gt; (:uri request)
                (contains? ping-uris-set))
            (ping-response)
            (handler request)))
        ([request respond raise]
          (if (-&gt;&gt; (:uri request)
                (contains? ping-uris-set))
            (respond (ping-response))
            (handler request respond raise)))))))
</pre></z><z id="t1515381156" t="weavejester [:attrs {:href &quot;/_/_/users/U066J7E2U&quot;}] in async middleware, exceptions can be thrown as usual or passed through raise ."><y>#</y><d>2018-01-08</d><h>03:12</h><w>weavejester</w><a>@kumarshantanu</a> in async middleware, exceptions can be thrown as usual or passed through <code>raise</code>.</z><z id="t1515381198" t="weavejester The raise function should be used when you‚Äôre in a new thread."><y>#</y><d>2018-01-08</d><h>03:13</h><w>weavejester</w>The <code>raise</code> function should be used when you‚Äôre in a new thread.</z><z id="t1515381239" t="weavejester In your case, you probably don‚Äôt need to do anything."><y>#</y><d>2018-01-08</d><h>03:13</h><w>weavejester</w>In your case, you probably don‚Äôt need to do anything.</z><z id="t1515381276" t="weavejester Async middleware generally only cares about errors if it‚Äôs consuming them for logging or display purposes."><y>#</y><d>2018-01-08</d><h>03:14</h><w>weavejester</w>Async middleware generally only cares about errors if it‚Äôs consuming them for logging or display purposes.</z><z id="t1515386277" t="Shantanu Kumar Thanks [:attrs {:href &quot;/_/_/users/U0BKWMG5B&quot;}] Is &apos;respond&apos; required btw? I just copied the style from your 2016 blog post."><y>#</y><d>2018-01-08</d><h>04:37</h><w>Shantanu Kumar</w>Thanks <a>@weavejester</a> Is &apos;respond&apos; required btw? I just copied the style from your 2016 blog post.</z><z id="t1515421815" t="weavejester [:attrs {:href &quot;/_/_/users/U066J7E2U&quot;}] For async? Yes. How else would it communicate the information?"><y>#</y><d>2018-01-08</d><h>14:30</h><w>weavejester</w><a>@kumarshantanu</a> For async? Yes. How else would it communicate the information?</z><z id="t1515594826" t="chadhs what are most folks using for authentication with ring apps these days?"><y>#</y><d>2018-01-10</d><h>14:33</h><w>chadhs</w>what are most folks using for authentication with ring apps these days?</z><z id="t1515602610" t="jumar [:attrs {:href &quot;/_/_/users/U060QNFEZ&quot;}] we use buddy and friend (two different apps) As much as I can tell both works fine. I know friend more and I think it&apos;s a good default choice."><y>#</y><d>2018-01-10</d><h>16:43</h><r>jumar</r><a>@U060QNFEZ</a> we use <code>buddy</code> and <code>friend</code> (two different apps)
As much as I can tell both works fine. I know <code>friend</code> more and I think it&apos;s a good default choice.</z><z id="t1515602653" t="chadhs [:attrs {:href &quot;/_/_/users/U06BE1L6T&quot;}] thnx, friend and it‚Äôs deps just seemed a bit dated, or is it just considered ‚Äúfeature complete‚Äù?"><y>#</y><d>2018-01-10</d><h>16:44</h><r>chadhs</r><a>@U06BE1L6T</a> thnx, friend and it‚Äôs deps just seemed a bit dated, or is it just considered ‚Äúfeature complete‚Äù?</z><z id="t1515606530" t="seancorfield A lot of things in Clojure are &quot;feature complete&quot; and stable -- and therefore look dated or even unmaintained."><y>#</y><d>2018-01-10</d><h>17:48</h><r>seancorfield</r>A lot of things in Clojure are &quot;feature complete&quot; and stable -- and therefore look dated or even unmaintained.</z><z id="t1515606550" t="seancorfield That&apos;s one of the benefits of writing small, focused libraries -- they can actual achieve &quot;completeness&quot; üôÇ"><y>#</y><d>2018-01-10</d><h>17:49</h><r>seancorfield</r>That&apos;s one of the benefits of writing small, focused libraries -- they can actual achieve &quot;completeness&quot; <b>üôÇ</b></z><z id="t1516140851" t="yogidevbear Hello everyone. I&apos;m trying to figure out the serving of static files (e.g. css / js) within compojure. My current understanding is that I should be making use of the compojure.route/resources function. I&apos;ve defined (route/resources &quot;/&quot;) inside of my (defroutes app ... declaration. I also added (app {:uri &quot;/public/main.css&quot; :request-method :get}) after the defroutes function. If I try browsing to , I keep getting the route/not-found route."><y>#</y><d>2018-01-16</d><h>22:14</h><w>yogidevbear</w>Hello everyone. I&apos;m trying to figure out the serving of static files (e.g. css / js) within compojure. My current understanding is that I should be making use of the <code>compojure.route/resources</code> function. I&apos;ve defined <code>(route/resources &quot;/&quot;)</code> inside of my <code>(defroutes app ...</code> declaration. I also added <code>(app {:uri &quot;/public/main.css&quot; :request-method :get})</code> after the <code>defroutes</code> function. If I try browsing to <code></code>, I keep getting the <code>route/not-found</code> route.</z><z id="t1516142984" t="seancorfield You put main.css in resources/public/ in your project?"><y>#</y><d>2018-01-16</d><h>22:49</h><w>seancorfield</w>You put <code>main.css</code> in <code>resources/public/</code> in your project?</z><z id="t1516143006" t="seancorfield (and remove /public from the URL)"><y>#</y><d>2018-01-16</d><h>22:50</h><w>seancorfield</w>(and remove <code>/public</code> from the URL)</z><z id="t1516143033" t="seancorfield I believe the default behavior for (route/resources &quot;/&quot;) is to assume resources/public/ as the root for assets?"><y>#</y><d>2018-01-16</d><h>22:50</h><w>seancorfield</w>I believe the default behavior for <code>(route/resources &quot;/&quot;)</code> is to assume <code>resources/public/</code> as the root for assets?</z><z id="t1516143114" t="seancorfield &gt; I also added (app {:uri &quot;/public/main.css&quot; :request-method :get}) after the defroutes function. Why did you do that [:attrs {:href &quot;/_/_/users/U0MFQNXFZ&quot;}] ? Just to test in the REPL what it will do?"><y>#</y><d>2018-01-16</d><h>22:51</h><w>seancorfield</w>&gt; I also added <code>(app {:uri &quot;/public/main.css&quot; :request-method :get})</code> after the <code>defroutes</code> function.
Why did you do that <a>@yogidevbear</a>? Just to test in the REPL what it will do?</z><z id="t1516143368" t="yogidevbear I was reading through https://learnxinyminutes.com/docs/compojure/ which showed that usage"><y>#</y><d>2018-01-16</d><h>22:56</h><w>yogidevbear</w>I was reading through <a href="https://learnxinyminutes.com/docs/compojure/" target="_blank">https://learnxinyminutes.com/docs/compojure/</a> which showed that usage</z><z id="t1516143482" t="yogidevbear I didn&apos;t have the public folder inside of resources . Moved it and testing again now"><y>#</y><d>2018-01-16</d><h>22:58</h><w>yogidevbear</w>I didn&apos;t have the <code>public</code> folder inside of <code>resources</code>. Moved it and testing again now</z><z id="t1516143652" t="yogidevbear So I have resources/public/main.css in my example. I have (route/resources &quot;/&quot;) in my defroutes , and I&apos;ve removed (app {:uri &quot;/public/main.css&quot; :request-method :get}) . I&apos;m still seeing page not found when trying to access "><y>#</y><d>2018-01-16</d><h>23:00</h><w>yogidevbear</w>So I have <code>resources/public/main.css</code> in my example. I have <code>(route/resources &quot;/&quot;)</code> in my <code>defroutes</code>, and I&apos;ve removed <code>(app {:uri &quot;/public/main.css&quot; :request-method :get})</code>. I&apos;m still seeing page not found when trying to access <code></code></z><z id="t1516143740" t="seancorfield Remove /public from that URL."><y>#</y><d>2018-01-16</d><h>23:02</h><w>seancorfield</w>Remove <code>/public</code> from that URL.</z><z id="t1516143767" t="yogidevbear ah"><y>#</y><d>2018-01-16</d><h>23:02</h><w>yogidevbear</w>ah</z><z id="t1516143777" t="yogidevbear Bingo"><y>#</y><d>2018-01-16</d><h>23:02</h><w>yogidevbear</w>Bingo</z><z id="t1516143780" t="yogidevbear Thanks Sean üôÇ"><y>#</y><d>2018-01-16</d><h>23:03</h><w>yogidevbear</w>Thanks Sean <b>üôÇ</b></z><z id="t1516143786" t="seancorfield The public part is on the file system (so web-accessible stuff is in that folder and non-web-accessible resources such as config files are outside it)."><y>#</y><d>2018-01-16</d><h>23:03</h><w>seancorfield</w>The <code>public</code> part is on the file system (so web-accessible stuff is in that folder and non-web-accessible resources such as config files are outside it).</z><z id="t1516143792" t="yogidevbear All makes sense now that it&apos;s working"><y>#</y><d>2018-01-16</d><h>23:03</h><w>yogidevbear</w>All makes sense now that it&apos;s working</z><z id="t1516143813" t="seancorfield You can override that behavior by specifying a configuration option map in the route/resources call."><y>#</y><d>2018-01-16</d><h>23:03</h><w>seancorfield</w>You can override that behavior by specifying a configuration option map in the <code>route/resources</code> call.</z><z id="t1516143823" t="yogidevbear In particular this part https://github.com/weavejester/compojure/blob/master/src/compojure/route.clj#L22-L23"><y>#</y><d>2018-01-16</d><h>23:03</h><w>yogidevbear</w>In particular this part <a href="https://github.com/weavejester/compojure/blob/master/src/compojure/route.clj#L22-L23" target="_blank">https://github.com/weavejester/compojure/blob/master/src/compojure/route.clj#L22-L23</a></z><z id="t1516143845" t="seancorfield Yup, there ya go!"><y>#</y><d>2018-01-16</d><h>23:04</h><w>seancorfield</w>Yup, there ya go!</z><z id="t1516143878" t="seancorfield Actually that&apos;s for files , https://github.com/weavejester/compojure/blob/master/src/compojure/route.clj#L41 is for resources"><y>#</y><d>2018-01-16</d><h>23:04</h><w>seancorfield</w>Actually that&apos;s for <code>files</code>, <a href="https://github.com/weavejester/compojure/blob/master/src/compojure/route.clj#L41" target="_blank">https://github.com/weavejester/compojure/blob/master/src/compojure/route.clj#L41</a> is for <code>resources</code></z><z id="t1516143880" t="yogidevbear So which library within Clojure knows to look inside resources by default? Is that a Ring thing?"><y>#</y><d>2018-01-16</d><h>23:04</h><w>yogidevbear</w>So which library within Clojure knows to look inside <code>resources</code> by default? Is that a Ring thing?</z><z id="t1516143974" t="seancorfield The compojure middleware defers to https://github.com/ring-clojure/ring/blob/master/ring-core/src/ring/util/response.clj#L320"><y>#</y><d>2018-01-16</d><h>23:06</h><w>seancorfield</w>The compojure middleware defers to <a href="https://github.com/ring-clojure/ring/blob/master/ring-core/src/ring/util/response.clj#L320" target="_blank">https://github.com/ring-clojure/ring/blob/master/ring-core/src/ring/util/response.clj#L320</a></z><z id="t1516144037" t="seancorfield and that uses -- which looks on the classpath and the convention is that both resources and src are on your classpath in most Clojure tooling."><y>#</y><d>2018-01-16</d><h>23:07</h><w>seancorfield</w>and that uses <code></code> -- which looks on the classpath and the convention is that both <code>resources</code> and <code>src</code> are on your classpath in most Clojure tooling.</z><z id="t1516144054" t="yogidevbear TIL üôÇ"><y>#</y><d>2018-01-16</d><h>23:07</h><w>yogidevbear</w>TIL <b>üôÇ</b></z><z id="t1516144391" t="seancorfield In a typical web app at work, we have resources/public/assets containing css , img , and js subfolders -- and URLs have /assets/css etc -- and we have resources/templates containing HTML files that are used as templates and rendered via Selmer (our preferred templating engine -- inspired by Django)."><y>#</y><d>2018-01-16</d><h>23:13</h><w>seancorfield</w>In a typical web app at work, we have <code>resources/public/assets</code> containing <code>css</code>, <code>img</code>, and <code>js</code> subfolders -- and URLs have <code>/assets/css</code> etc -- and we have <code>resources/templates</code> containing HTML files that are used as templates and rendered via Selmer (our preferred templating engine -- inspired by Django).</z><z id="t1516144411" t="seancorfield And we also often have resources/public/favicon.ico for browsers üôÇ"><y>#</y><d>2018-01-16</d><h>23:13</h><w>seancorfield</w>And we also often have <code>resources/public/favicon.ico</code> for browsers <b>üôÇ</b></z><z id="t1516144435" t="seancorfield Other files in resources include EDN config files etc."><y>#</y><d>2018-01-16</d><h>23:13</h><w>seancorfield</w>Other files in <code>resources</code> include EDN config files etc.</z><z id="t1516144560" t="yogidevbear And anything inside resources , but outside of public is not accessible via the browser URL field?"><y>#</y><d>2018-01-16</d><h>23:16</h><w>yogidevbear</w>And anything inside <code>resources</code>, but outside of <code>public</code> is not accessible via the browser URL field?</z><z id="t1516144600" t="yogidevbear e.g. resources/my.edn wouldn&apos;t be accessible from or similar route?"><y>#</y><d>2018-01-16</d><h>23:16</h><w>yogidevbear</w>e.g. <code>resources/my.edn</code> wouldn&apos;t be accessible from <code></code> or similar route?</z><z id="t1516148403" t="seancorfield [:attrs {:href &quot;/_/_/users/U0MFQNXFZ&quot;}] Correct. Only resources/public is web-accessible."><y>#</y><d>2018-01-17</d><h>00:20</h><w>seancorfield</w><a>@yogidevbear</a> Correct. Only <code>resources/public</code> is web-accessible.</z><z id="t1516148421" t="seancorfield (assuming you don&apos;t override :root in route/resources üôÇ )"><y>#</y><d>2018-01-17</d><h>00:20</h><w>seancorfield</w>(assuming you don&apos;t override <code>:root</code> in <code>route/resources</code> <b>üôÇ</b> )</z><z id="t1516300399" t="pablore Hi! I‚Äôm using ring/compojure to setup a web microservice in clojure. I need CORS to integrate test it, is there any way to setup to :access-control-allow-origin [#&quot;all&quot;] Wildcard * is not working"><y>#</y><d>2018-01-18</d><h>18:33</h><w>pablore</w>Hi! I‚Äôm using ring/compojure to setup a web microservice in clojure. I need CORS to integrate test it, is there any way to setup to <code>:access-control-allow-origin [#&quot;all&quot;]</code> Wildcard * is not working</z><z id="t1516307172" t="seancorfield [:attrs {:href &quot;/_/_/users/U7V9HE682&quot;}] It should be a single regex, I believe. We have :access-control-allow-origin #&quot;.*&quot; and that seems to work."><y>#</y><d>2018-01-18</d><h>20:26</h><w>seancorfield</w><a>@pablore</a> It should be a single regex, I believe. We have <code>:access-control-allow-origin #&quot;.*&quot;</code> and that seems to work.</z><z id="t1516307188" t="seancorfield (I assume you&apos;re talking about wrap-cors ?)"><y>#</y><d>2018-01-18</d><h>20:26</h><w>seancorfield</w>(I assume you&apos;re talking about <code>wrap-cors</code>?)</z><z id="t1516392866" t="pablore yes. For some reason, having #&quot;.*&quot; caused a null pointer exception"><y>#</y><d>2018-01-19</d><h>20:14</h><r>pablore</r>yes. For some reason, having <code>#&quot;.*&quot;</code> caused a null pointer exception</z><z id="t1516397042" t="seancorfield Well, #&quot;.*&quot; is what we have so I doubt that was the cause of your NPE."><y>#</y><d>2018-01-19</d><h>21:24</h><r>seancorfield</r>Well, <code>#&quot;.*&quot;</code> is what we have so I doubt that was the cause of your NPE.</z><z id="t1516397089" t="seancorfield Specifically, here&apos;s the code we have in production: (let [h (ring-cors/wrap-cors handler :access-control-allow-headers #{&quot;accept&quot; &quot;authorization&quot; &quot;content-type&quot; &quot;origin&quot;} :access-control-allow-methods [:delete :get :patch :post :put] ;; 24 hours (in seconds) -- note that only Firefox ;; will honor this; other browsers cap lower! :access-control-max-age &quot;86400&quot; :access-control-allow-origin #&quot;.*&quot;)] ...)"><y>#</y><d>2018-01-19</d><h>21:24</h><r>seancorfield</r>Specifically, here&apos;s the code we have in production: <pre>(let [h (ring-cors/wrap-cors handler
                               :access-control-allow-headers #{&quot;accept&quot;
                                                               &quot;authorization&quot;
                                                               &quot;content-type&quot;
                                                               &quot;origin&quot;}
                               :access-control-allow-methods [:delete :get
                                                              :patch :post :put]
                               ;; 24 hours (in seconds) -- note that only Firefox
                               ;; will honor this; other browsers cap lower!
                               :access-control-max-age &quot;86400&quot;
                               :access-control-allow-origin #&quot;.*&quot;)]
  ...)</pre></z><z id="t1516397135" t="seancorfield (the ... part returns (fn [req] ...) and inside that it calls (h req) and handles the result)"><y>#</y><d>2018-01-19</d><h>21:25</h><r>seancorfield</r>(the <code>...</code> part returns <code>(fn [req] ...)</code> and inside that it calls <code>(h req)</code> and handles the result)</z><z id="t1516603439" t="ikitommi What is a good way to implement ‚Äúnot-found‚Äù handler for async ring? For a case that a handler responded nil ."><y>#</y><d>2018-01-22</d><h>06:43</h><w>ikitommi</w>What is a good way to implement ‚Äúnot-found‚Äù handler for async ring? For a case that a handler responded <code>nil</code>.</z><z id="t1516630967" t="pablore [:attrs {:href &quot;/_/_/users/U055NJ5CC&quot;}] You can use compojure.route/not-found"><y>#</y><d>2018-01-22</d><h>14:22</h><w>pablore</w><a>@ikitommi</a> You can use <code>compojure.route/not-found</code></z><z id="t1516780645" t="ikitommi thanks [:attrs {:href &quot;/_/_/users/U7V9HE682&quot;}] . I believe &quot;handler responds nil &quot; is a special case and I need to wrap the respond into local callback to know wether is was called. The routes in compojure does about that."><y>#</y><d>2018-01-24</d><h>07:57</h><w>ikitommi</w>thanks <a>@pablore</a>. I believe &quot;handler responds <code>nil</code>&quot; is a special case and I need to wrap the <code>respond</code> into local callback to know wether is was called. The <code>routes</code> in compojure does about that.</z><z id="t1516803675" t="pablore I find it crazy to use ring without compojure"><y>#</y><d>2018-01-24</d><h>14:21</h><w>pablore</w>I find it crazy to use ring without compojure</z><z id="t1516812451" t="seancorfield [:attrs {:href &quot;/_/_/users/U7V9HE682&quot;}] we have several Ring apps that don&apos;t use Compojure. It depends what you need in terms of routing. "><y>#</y><d>2018-01-24</d><h>16:47</h><w>seancorfield</w><a>@pablore</a> we have several Ring apps that don&apos;t use Compojure. It depends what you need in terms of routing. </z><z id="t1517253896" t="danielbraun what‚Äôs a good way to run a secure-site-defaults app locally?"><y>#</y><d>2018-01-29</d><h>19:24</h><w>danielbraun</w>what‚Äôs a good way to run a <code>secure-site-defaults</code> app locally?</z><z id="t1517253926" t="danielbraun other than generate an SSL certifcate"><y>#</y><d>2018-01-29</d><h>19:25</h><w>danielbraun</w>other than generate an SSL certifcate</z><z id="t1517253939" t="danielbraun using lein-ring as well"><y>#</y><d>2018-01-29</d><h>19:25</h><w>danielbraun</w>using lein-ring as well</z><z id="t1517256903" t="danielbraun ended up using an environment variable to use the non-secure defaults"><y>#</y><d>2018-01-29</d><h>20:15</h><w>danielbraun</w>ended up using an environment variable to use the non-secure defaults</z><z id="t1517344347" t="weavejester [:attrs {:href &quot;/_/_/users/U0CMACWJW&quot;}] You usually want to run a secure site behind a reverse proxy anyway, so you can either use Vagrant or something like it to set up a production-like environment, or run it with the SSL proxy options turned off."><y>#</y><d>2018-01-30</d><h>20:32</h><w>weavejester</w><a>@dabra</a> You usually want to run a secure site behind a reverse proxy anyway, so you can either use Vagrant or something like it to set up a production-like environment, or run it with the SSL proxy options turned off.</z><z id="t1517603505" t="zalky Hi all, I&apos;ve been using ring-defaults with the default settings and have added some links to a third party resources: [:link {:href &quot;&quot; :integrity &quot;sha512-...&quot; :crossorigin &quot;&quot;}] [:link {:src &quot;&quot; :integrity &quot;sha512-...&quot; :crossorigin &quot;&quot;}] The end result is that the js request goes through, but the css doesn&apos;t. I would have thought that neither would work without some CORS middleware, like https://github.com/r0man/ring-cors . What I&apos;m missing?"><y>#</y><d>2018-02-02</d><h>20:31</h><w>zalky</w>Hi all, I&apos;ve been using <code>ring-defaults</code> with the default settings and have added some links to a third party resources:

<pre>[:link {:href        &quot;&quot;
        :integrity   &quot;sha512-...&quot;
        :crossorigin &quot;&quot;}]
[:link {:src         &quot;&quot;
        :integrity   &quot;sha512-...&quot;
        :crossorigin &quot;&quot;}]</pre>

The end result is that the js request goes through, but the css doesn&apos;t. I would have thought that neither would work without some CORS middleware, like <a href="https://github.com/r0man/ring-cors" target="_blank">https://github.com/r0man/ring-cors</a>. What I&apos;m missing?</z><z id="t1517607052" t="zalky Ah, nm, misunderstood how CORS works, got some clarification."><y>#</y><d>2018-02-02</d><h>21:30</h><w>zalky</w>Ah, nm, misunderstood how CORS works, got some clarification.</z><z id="t1518180157" t="Niclas What‚Äôs your opinion of the state-of-the-art of logging with ring servers? My impression is that timbre seems like the most adopted alternative"><y>#</y><d>2018-02-09</d><h>12:42</h><w>Niclas</w>What‚Äôs your opinion of the state-of-the-art of logging with ring servers? My impression is that <code>timbre</code> seems like the most adopted alternative</z><z id="t1518184643" t="mpenet clojure.tools.logging + whatever you like for config (unilog, properties file etc)"><y>#</y><d>2018-02-09</d><h>13:57</h><w>mpenet</w>clojure.tools.logging + whatever you like for config (unilog, properties file etc)</z><z id="t1518788410" t="pablore Is compojure asynchronous by default?"><y>#</y><d>2018-02-16</d><h>13:40</h><w>pablore</w>Is compojure asynchronous by default?</z><z id="t1518801986" t="seancorfield [:attrs {:href &quot;/_/_/users/U7V9HE682&quot;}] Compojure is just middleware for routing. Not sure what would be async about that. Can you clarify what you&apos;re asking?"><y>#</y><d>2018-02-16</d><h>17:26</h><w>seancorfield</w><a>@pablore</a> Compojure is just middleware for routing. Not sure what would be async about that. Can you clarify what you&apos;re asking?</z><z id="t1518815799" t="pablore [:attrs {:href &quot;/_/_/users/U04V70XH6&quot;}] just discovering that my understanding of ring is even less that I thought. Nevermind me"><y>#</y><d>2018-02-16</d><h>21:16</h><w>pablore</w><a>@seancorfield</a> just discovering that my understanding of ring is even less that I thought. Nevermind me</z><z id="t1519042222" t="buzzdan hi üôÇ does anyone have any experience with ring-cors ?"><y>#</y><d>2018-02-19</d><h>12:10</h><w>buzzdan</w>hi <b>üôÇ</b>
does anyone have any experience with ring-cors ?</z><z id="t1519062781" t="seancorfield [:attrs {:href &quot;/_/_/users/U6NU3UY7R&quot;}] We use it in production. What&apos;s your question?"><y>#</y><d>2018-02-19</d><h>17:53</h><w>seancorfield</w><a>@buzzdan</a> We use it in production. What&apos;s your question?</z><z id="t1519063439" t="petr.mensik How can I add something like shutdown hook into the Jetty or other servers? I know that I can do it via Ring&apos;s init and destroy functions but what if I just want to run server via lein run (which calls (jetty/run-jetty dummy-app {:port 8090}) )? So is there a way how to gracefully shutdown such an application?"><y>#</y><d>2018-02-19</d><h>18:03</h><w>petr.mensik</w>How can I add something like shutdown hook into the Jetty or other servers? I know that I can do it via Ring&apos;s <code>init</code> and <code>destroy</code> functions but what if I just want to run server via <code>lein run</code>(which calls <code>(jetty/run-jetty dummy-app {:port 8090})</code>)? So is there a way how to gracefully shutdown such an application?</z><z id="t1519063626" t="petr.mensik I have a application on the AWS which uses a threadpool so I suppose that it needs to shutdown the pool between deployments"><y>#</y><d>2018-02-19</d><h>18:07</h><w>petr.mensik</w>I have a application on the AWS which uses a threadpool so I suppose that it needs to shutdown the pool between deployments</z><z id="t1519063668" t="petr.mensik So far I was doing it with Ring on the Tomcat, now I want to run the app in Java SE environment therefore is not an option anymore"><y>#</y><d>2018-02-19</d><h>18:07</h><w>petr.mensik</w>So far I was doing it with Ring on the Tomcat, now I want to run the app in Java SE environment therefore is not an option anymore</z><z id="t1519091884" t="weavejester [:attrs {:href &quot;/_/_/users/U3H4PBCLE&quot;}] You can add a shutdown hook to the Java process, but in general it‚Äôs good practice to code your application so that it doesn‚Äôt expect to be shut down cleanly. At some point your application is going to be SIGKILLed, so if you design your application to not require a cleanup, then SIGKILL is no different from SIGTERM."><y>#</y><d>2018-02-20</d><h>01:58</h><w>weavejester</w><a>@petr.mensik</a> You can add a shutdown hook to the Java process, but in general it‚Äôs good practice to code your application so that it doesn‚Äôt expect to be shut down cleanly. At some point your application is going to be SIGKILLed, so if you design your application to not require a cleanup, then SIGKILL is no different from SIGTERM.</z><z id="t1519119675" t="petr.mensik [:attrs {:href &quot;/_/_/users/U0BKWMG5B&quot;}] a what about threads and thread pools? Shouldn&apos;t be killed gracefully during shutdown if possible?"><y>#</y><d>2018-02-20</d><h>09:41</h><w>petr.mensik</w><a>@weavejester</a> a what about threads and thread pools? Shouldn&apos;t be killed gracefully during shutdown if possible?</z><z id="t1519119782" t="petr.mensik So JVM shutdown hook would be the only option?"><y>#</y><d>2018-02-20</d><h>09:43</h><w>petr.mensik</w>So JVM shutdown hook would be the only option?</z><z id="t1519120999" t="mpenet it&apos;s the advised option"><y>#</y><d>2018-02-20</d><h>10:03</h><w>mpenet</w>it&apos;s the advised option</z><z id="t1519121043" t="mpenet you can call whatever you like from there: a component system/stop or equivalent from another lib"><y>#</y><d>2018-02-20</d><h>10:04</h><w>mpenet</w>you can call whatever you like from there: a component system/stop or equivalent from another lib</z><z id="t1519121109" t="mpenet Threads ll be terminated when the jvm shuts down otherwise"><y>#</y><d>2018-02-20</d><h>10:05</h><w>mpenet</w>Threads ll be terminated when the jvm shuts down otherwise</z><z id="t1519121184" t="mpenet fyi: https://github.com/mpenet/commons/blob/master/src/clj/qbits/commons/jvm.clj#L3"><y>#</y><d>2018-02-20</d><h>10:06</h><w>mpenet</w>fyi: <a href="https://github.com/mpenet/commons/blob/master/src/clj/qbits/commons/jvm.clj#L3" target="_blank">https://github.com/mpenet/commons/blob/master/src/clj/qbits/commons/jvm.clj#L3</a></z><z id="t1519130882" t="petr.mensik [:attrs {:href &quot;/_/_/users/U050SC7SV&quot;}] ok, thanks üôÇ"><y>#</y><d>2018-02-20</d><h>12:48</h><w>petr.mensik</w><a>@mpenet</a> ok, thanks <b>üôÇ</b></z><z id="t1519378407" t="hawari Hi, does anybody use the ring-cors library here? https://github.com/r0man/ring-cors"><y>#</y><d>2018-02-23</d><h>09:33</h><w>hawari</w>Hi, does anybody use the <code>ring-cors</code> library here? <a href="https://github.com/r0man/ring-cors" target="_blank">https://github.com/r0man/ring-cors</a></z><z id="t1519378620" t="hawari It is supposed to be an &quot;outer part&quot; middleware right? For example if I have a route, other middlewares, and a ring wrap-defaults , it should look like this right? : (-&gt; routes wrap-middlewares ... ... (wrap-cors :access-control-allow-origin [#&quot;&quot;] :access-control-allow-methods [:get :put :post :delete]) (wrap-defaults api-defaults)) "><y>#</y><d>2018-02-23</d><h>09:37</h><w>hawari</w>It is supposed to be an &quot;outer part&quot; middleware right? For example if I have a route, other middlewares, and a ring <code>wrap-defaults</code>, it should look like this right? :
<pre>(-&gt; routes
    wrap-middlewares
    ...
    ...
    (wrap-cors :access-control-allow-origin [#&quot;&quot;] :access-control-allow-methods [:get :put :post :delete])
    (wrap-defaults api-defaults))
</pre></z><z id="t1519404827" t="seancorfield [:attrs {:href &quot;/_/_/users/U84FTP06P&quot;}] I think you need to swap defaults and cors there. "><y>#</y><d>2018-02-23</d><h>16:53</h><w>seancorfield</w><a>@hawari.rahman17</a> I think you need to swap defaults and cors there. </z><z id="t1519426886" t="hawari Yeah, I finally realized that [:attrs {:href &quot;/_/_/users/U04V70XH6&quot;}] , but sadly the middleware still doesn&apos;t work as I expected it to be. It doesn&apos;t return any of CORS related headers."><y>#</y><d>2018-02-23</d><h>23:01</h><w>hawari</w>Yeah, I finally realized that <a>@seancorfield</a>, but sadly the middleware still doesn&apos;t work as I expected it to be. It doesn&apos;t return any of CORS related headers.</z><z id="t1519427001" t="seancorfield We use it in production and it works just fine."><y>#</y><d>2018-02-23</d><h>23:03</h><w>seancorfield</w>We use it in production and it works just fine.</z><z id="t1519427345" t="seancorfield (ring-cors/wrap-cors handler :access-control-allow-headers #{&quot;accept&quot; &quot;authorization&quot; &quot;content-type&quot; &quot;origin&quot;} :access-control-allow-methods [:delete :get :patch :post :put] ;; 24 hours (in seconds) -- note that only Firefox ;; will honor this; other browsers cap lower! :access-control-max-age &quot;86400&quot; :access-control-allow-origin #&quot;.*&quot;) That&apos;s how we compute our outermost handler."><y>#</y><d>2018-02-23</d><h>23:09</h><w>seancorfield</w><pre>(ring-cors/wrap-cors handler
                             :access-control-allow-headers #{&quot;accept&quot;
                                                             &quot;authorization&quot;
                                                             &quot;content-type&quot;
                                                             &quot;origin&quot;}
                             :access-control-allow-methods [:delete :get
                                                            :patch :post :put]
                             ;; 24 hours (in seconds) -- note that only Firefox
                             ;; will honor this; other browsers cap lower!
                             :access-control-max-age &quot;86400&quot;
                             :access-control-allow-origin #&quot;.*&quot;)</pre> That&apos;s how we compute our outermost handler.</z><z id="t1519427486" t="seancorfield You probably need :access-control-allow-headers ..."><y>#</y><d>2018-02-23</d><h>23:11</h><w>seancorfield</w>You probably need <code>:access-control-allow-headers</code>...</z><z id="t1519559039" t="hawari Well that&apos;s strange, I have other projects too that works perfectly fine with this middleware"><y>#</y><d>2018-02-25</d><h>11:43</h><w>hawari</w>Well that&apos;s strange, I have other projects too that works perfectly fine with this middleware</z><z id="t1519559162" t="hawari Are you also using compojure by any chance?"><y>#</y><d>2018-02-25</d><h>11:46</h><w>hawari</w>Are you also using <code>compojure</code> by any chance?</z><z id="t1519585028" t="seancorfield [:attrs {:href &quot;/_/_/users/U84FTP06P&quot;}] Yes, we use Compojure in most of our Ring apps, but Bidi in one of them. We use CORS with both."><y>#</y><d>2018-02-25</d><h>18:57</h><w>seancorfield</w><a>@hawari.rahman17</a> Yes, we use Compojure in most of our Ring apps, but Bidi in one of them. We use CORS with both.</z><z id="t1519677837" t="pablore How could I print s/explain to Ring logger?"><y>#</y><d>2018-02-26</d><h>20:43</h><w>pablore</w>How could I print <code>s/explain</code> to Ring logger?</z><z id="t1519788361" t="hawari Hi, can anyone explain the concept behind the asynchronous ring handler? Why was it created, what advantages does it give along with the downside?"><y>#</y><d>2018-02-28</d><h>03:26</h><w>hawari</w>Hi, can anyone explain the concept behind the asynchronous ring handler? Why was it created, what advantages does it give along with the downside?</z><z id="t1519788417" t="hawari Also what would happen if some of the ring middleware is async capable but some others aren&apos;t?"><y>#</y><d>2018-02-28</d><h>03:26</h><w>hawari</w>Also what would happen if some of the ring middleware is async capable but some others aren&apos;t?</z><z id="t1519947259" t="weavejester [:attrs {:href &quot;/_/_/users/U84FTP06P&quot;}] The advantage is that the handler doesn‚Äôt need to block a thread if it‚Äôs waiting for data. Asynchronous handlers are more efficient in terms of thread usage, at the cost of being more complicated to work with."><y>#</y><d>2018-03-01</d><h>23:34</h><w>weavejester</w><a>@hawari.rahman17</a> The advantage is that the handler doesn‚Äôt need to block a thread if it‚Äôs waiting for data. Asynchronous handlers are more efficient in terms of thread usage, at the cost of being more complicated to work with.</z><z id="t1519947287" t="weavejester All middleware in the chain needs to be async for the final handler to be async."><y>#</y><d>2018-03-01</d><h>23:34</h><w>weavejester</w>All middleware in the chain needs to be async for the final handler to be async.</z><z id="t1519961450" t="hawari With that being said [:attrs {:href &quot;/_/_/users/U0BKWMG5B&quot;}] , if performance and efficiency are something of high importance, then is asynchronous handler is the absolute way to go? Or is it not a silver bullet in terms of performance (e.g. in some cases it could hinder performance instead)?"><y>#</y><d>2018-03-02</d><h>03:30</h><w>hawari</w>With that being said <a>@weavejester</a>, if performance and efficiency are something of high importance, then is asynchronous handler is the absolute way to go? Or is it not a silver bullet in terms of performance (e.g. in some cases it could hinder performance instead)?</z><z id="t1519969438" t="seancorfield My first reaction to that is &quot;nothing is a silver bullet&quot; üôÇ Everything is trade offs..."><y>#</y><d>2018-03-02</d><h>05:43</h><w>seancorfield</w>My first reaction to that is &quot;nothing is a silver bullet&quot; <b>üôÇ</b> Everything is trade offs...</z><z id="t1519978353" t="hawari Yeah, that is as expected, but I&apos;d like to be more informed on what is the trade off on using async handlers beside the complexity it introduces."><y>#</y><d>2018-03-02</d><h>08:12</h><w>hawari</w>Yeah, that is as expected, but I&apos;d like to be more informed on what is the trade off on using async handlers beside the complexity it introduces.</z><z id="t1519981662" t="mpenet If you handler does &quot;slow&quot; IO (and has an async interface) async would be more efficient, if not that&apos;s a bit useless, ex: for a simple &quot;fast&quot; handler the cost of context switching might cost you more if you use async. async handlers also come with a cost in complexity. So yeah the answer is &quot;it depends&quot;"><y>#</y><d>2018-03-02</d><h>09:07</h><w>mpenet</w>If you handler does &quot;slow&quot; IO (and has an async interface) async would be more efficient, if not that&apos;s a bit useless, ex: for a simple &quot;fast&quot; handler the cost of context switching might cost you more if you use async. async handlers also come with a cost in complexity. So yeah the answer is &quot;it depends&quot;</z><z id="t1519981752" t="mpenet in general, I would say don&apos;t bother with async at the beginning"><y>#</y><d>2018-03-02</d><h>09:09</h><w>mpenet</w>in general, I would say don&apos;t bother with async at the beginning</z><z id="t1519987333" t="hawari Thank you [:attrs {:href &quot;/_/_/users/U050SC7SV&quot;}] for clarifying, I was contemplating to use async but unsure whether the benefit will outweigh the effort."><y>#</y><d>2018-03-02</d><h>10:42</h><w>hawari</w>Thank you <a>@mpenet</a> for clarifying, I was contemplating to use async but unsure whether the benefit will outweigh the effort.</z><z id="t1520329419" t="bteuber Hi - after upgrading to compojure-api 2.0.0-alpha18 and ring-jetty-adapter 1.6.3 I now always get a 500 instead of 404 for invalid routes. I am wondering if this has just been removed and I need to add my own middleware / default handler, or whether something else is going on (e.g. content formats)."><y>#</y><d>2018-03-06</d><h>09:43</h><w>bteuber</w>Hi - after upgrading to compojure-api 2.0.0-alpha18 and ring-jetty-adapter 1.6.3 I now always get a 500 instead of 404 for invalid routes. I am wondering if this has just been removed and I need to add my own middleware / default handler, or whether something else is going on (e.g. content formats).</z><z id="t1520356955" t="seancorfield [:attrs {:href &quot;/_/_/users/U0BA8QYM9&quot;}] Normally 500 means an exception... anything in your logs?"><y>#</y><d>2018-03-06</d><h>17:22</h><w>seancorfield</w><a>@bteuber</a> Normally 500 means an exception... anything in your logs?</z><z id="t1520816688" t="mathpunk I&apos;m trying to write a POST route with Compojure. I&apos;m not sure how to get the body of what it sends to my functions --- I&apos;m getting null s that I don&apos;t expect. It&apos;s probably something fairly obvious: https://github.com/mathpunk/certainty-derivative/blob/rest-server/src/certainty_derivative/server.clj#L55"><y>#</y><d>2018-03-12</d><h>01:04</h><w>mathpunk</w>I&apos;m trying to write a POST route with Compojure. I&apos;m not sure how to get the body of what it sends to my functions --- I&apos;m getting <code>null</code>s that I don&apos;t expect. It&apos;s probably something fairly obvious: <a href="https://github.com/mathpunk/certainty-derivative/blob/rest-server/src/certainty_derivative/server.clj#L55" target="_blank">https://github.com/mathpunk/certainty-derivative/blob/rest-server/src/certainty_derivative/server.clj#L55</a></z><z id="t1520816748" t="mathpunk I figured, this would just give me what the content was back.... instead I get {:status 200, :headers {&quot;Content-Type&quot; &quot;application/json; charset=utf-8&quot;}, :body &quot;{\&quot;description\&quot;:\&quot;Success! Probably!\&quot;,\&quot;record\&quot;:null}&quot;}"><y>#</y><d>2018-03-12</d><h>01:05</h><w>mathpunk</w>I figured, this would just give me what the content was back.... instead I get <code>{:status 200, :headers {&quot;Content-Type&quot; &quot;application/json; charset=utf-8&quot;}, :body &quot;{\&quot;description\&quot;:\&quot;Success! Probably!\&quot;,\&quot;record\&quot;:null}&quot;}</code></z><z id="t1520849452" t="tianshu Hi, I want to provide a link for xls downloading. how to provide a stream that represent a file for download in ring response?"><y>#</y><d>2018-03-12</d><h>10:10</h><w>tianshu</w>Hi, I want to provide a link for <code>xls</code> downloading. how to provide a stream that represent a file for download in ring response?</z><z id="t1520919323" t="nakiya I have a compojure api, I get a request from a device to the endpoint. The log is something like this: 2018-03-13 05:27:11,846 [XNIO-1 task-6] INFO ring.logger.tools-logging - Starting :post /api/comms/new_packet for 115.42.250.66 {&quot;connection&quot; &quot;close&quot;, &quot;accept&quot; &quot;application/json&quot;, &quot;keep-alive&quot; &quot;timeout=30&quot;, &quot;from&quot; &quot;xxxxx&quot;, &quot;content-type&quot; &quot;application/json&quot;, &quot;content-length&quot; &quot;217&quot;, &quot;user-agent&quot; &quot;curl/7.54.0&quot;, &quot;host&quot; &quot;xxxxx&quot;} 2018-03-13 05:27:11,847 [XNIO-1 task-6] DEBUG ring.logger.tools-logging - Request details: {:remote-addr &quot;xxxxx&quot;, :server-port 8000, :content-length 217, :content-type &quot;application/json&quot;, :character-encoding &quot;ISO-8859-1&quot;, :uri &quot;/api/comms/new_packet&quot;, :server-name &quot;xxxxx&quot;, :query-string nil, :scheme :http, :request-method :post} 2018-03-13 05:27:11,847 [XNIO-1 task-6] INFO ring.logger.tools-logging - \ - - - - Params: {} After this, there‚Äôs nothing. No response, and my handler is not invoked. If I send a request from swagger ui to this endpoint, I see the response in the logs after that last line. I am sure that this is a bug in the device‚Äôs request. I only want to know how to get details on server side why the request is not reaching the handler. Any logging/debugging methods to find this out?"><y>#</y><d>2018-03-13</d><h>05:35</h><w>nakiya</w>I have a compojure api,

I get a request from a device to the endpoint. The log is something like this:

<pre>2018-03-13 05:27:11,846 [XNIO-1 task-6] INFO  ring.logger.tools-logging - Starting :post /api/comms/new_packet for 115.42.250.66 {&quot;connection&quot; &quot;close&quot;, &quot;accept&quot; &quot;application/json&quot;, &quot;keep-alive&quot; &quot;timeout=30&quot;, &quot;from&quot; &quot;xxxxx&quot;, &quot;content-type&quot; &quot;application/json&quot;, &quot;content-length&quot; &quot;217&quot;, &quot;user-agent&quot; &quot;curl/7.54.0&quot;, &quot;host&quot; &quot;xxxxx&quot;}
2018-03-13 05:27:11,847 [XNIO-1 task-6] DEBUG ring.logger.tools-logging - Request details: {:remote-addr &quot;xxxxx&quot;, :server-port 8000, :content-length 217, :content-type &quot;application/json&quot;, :character-encoding &quot;ISO-8859-1&quot;, :uri &quot;/api/comms/new_packet&quot;, :server-name &quot;xxxxx&quot;, :query-string nil, :scheme :http, :request-method :post}
2018-03-13 05:27:11,847 [XNIO-1 task-6] INFO  ring.logger.tools-logging -   \ - - - -  Params: {}</pre>

After this, there‚Äôs nothing. No response, and my handler is not invoked. If I send a request from swagger ui to this endpoint, I see the response in the logs after that last line.

I am sure that this is a bug in the device‚Äôs request. I only want to know how to get details on server side why the request is not reaching the handler.

Any logging/debugging methods to find this out?</z><z id="t1521313418" t="Shantanu Kumar Hi, does anybody here know how to express Compojure‚Äôs ANY method match in Ataraxy?"><y>#</y><d>2018-03-17</d><h>19:03</h><w>Shantanu Kumar</w>Hi, does anybody here know how to express Compojure‚Äôs <code>ANY</code> method match in Ataraxy?</z><z id="t1521378718" t="jumar I guess you just leave out a method in your route definition. Like &quot;/example&quot; [:root/example] instead of [:get &quot;/example&quot;] [:root/example]"><y>#</y><d>2018-03-18</d><h>13:11</h><r>jumar</r>I guess you just leave out a method in your route definition. Like <code>&quot;/example&quot; [:root/example]</code> instead of  <code>[:get &quot;/example&quot;] [:root/example]</code></z><z id="t1521379154" t="Shantanu Kumar [:attrs {:href &quot;/_/_/users/U06BE1L6T&quot;}] Thanks. I‚Äôm doing this in a sub-map {:get [:foo] :put [:bar] :any [:baz]} so can‚Äôt use that style"><y>#</y><d>2018-03-18</d><h>13:19</h><r>Shantanu Kumar</r><a>@U06BE1L6T</a> Thanks. I‚Äôm doing this in a sub-map <code>{:get [:foo] :put [:bar] :any [:baz]}</code> so can‚Äôt use that style</z><z id="t1521379226" t="Shantanu Kumar Like {&quot;/the/uri&quot; {:get [:foo] :put [:bar] :any [:baz]}}"><y>#</y><d>2018-03-18</d><h>13:20</h><r>Shantanu Kumar</r>Like <code>{&quot;/the/uri&quot; {:get [:foo] :put [:bar] :any [:baz]}}</code></z><z id="t1521380475" t="jumar I tried a hack with using nil instead of method keyword but that&apos;s not a valid route. I can&apos;t think of any other option than to explicitly state other methods. I looked here: https://github.com/weavejester/ataraxy/blob/master/src/ataraxy/core.clj#L199 Perhaps [:attrs {:href &quot;/_/_/users/U0BKWMG5B&quot;}] can give us a better solution for ANY ."><y>#</y><d>2018-03-18</d><h>13:41</h><r>jumar</r>I tried a hack with using <code>nil</code> instead of method keyword but that&apos;s not a valid route. I can&apos;t think of any other option than to explicitly state other methods.
I looked here: <a href="https://github.com/weavejester/ataraxy/blob/master/src/ataraxy/core.clj#L199" target="_blank">https://github.com/weavejester/ataraxy/blob/master/src/ataraxy/core.clj#L199</a>
 Perhaps <a>@U0BKWMG5B</a> can give us a better solution for <code>ANY</code>.</z><z id="t1521380555" t="weavejester You can do it a few different ways, depending on what you intend to do."><y>#</y><d>2018-03-18</d><h>13:42</h><r>weavejester</r>You can do it a few different ways, depending on what you intend to do.</z><z id="t1521380602" t="weavejester {&quot;/the/uri&quot; {:get [:foo] :put [:bar] &quot;&quot; [:baz]}} will work"><y>#</y><d>2018-03-18</d><h>13:43</h><r>weavejester</r><code>{&quot;/the/uri&quot; {:get [:foo] :put [:bar] &quot;&quot; [:baz]}}</code> will work</z><z id="t1521380650" t="weavejester But often a method ‚Äúcatch-all‚Äù route is used to return a ‚Äúmethod not found‚Äù status"><y>#</y><d>2018-03-18</d><h>13:44</h><r>weavejester</r>But often a method ‚Äúcatch-all‚Äù route is used to return a ‚Äúmethod not found‚Äù status</z><z id="t1521380675" t="weavejester And for that purpose the :ataraxy.error/unmatched-method result is a better solution."><y>#</y><d>2018-03-18</d><h>13:44</h><r>weavejester</r>And for that purpose the <code>:ataraxy.error/unmatched-method</code> result is a better solution.</z><z id="t1521393667" t="Shantanu Kumar [:attrs {:href &quot;/_/_/users/U0BKWMG5B&quot;}] Could you point me to some doc that shows how to customize the response for :ataraxy.error/unmatched-method ?"><y>#</y><d>2018-03-18</d><h>17:21</h><r>Shantanu Kumar</r><a>@U0BKWMG5B</a> Could you point me to some doc that shows how to customize the response for <code>:ataraxy.error/unmatched-method</code>?</z><z id="t1521396141" t="weavejester [:attrs {:href &quot;/_/_/users/U066J7E2U&quot;}] It‚Äôs documented in the README under ‚ÄúHandlers‚Äù: https://github.com/weavejester/ataraxy#handlers"><y>#</y><d>2018-03-18</d><h>18:02</h><r>weavejester</r><a>@U066J7E2U</a> It‚Äôs documented in the README under ‚ÄúHandlers‚Äù: <a href="https://github.com/weavejester/ataraxy#handlers" target="_blank">https://github.com/weavejester/ataraxy#handlers</a></z><z id="t1521396196" t="weavejester The way you attach handlers to results in Ataraxy works for both the results you set up, and the error results Ataraxy uses when an error happens."><y>#</y><d>2018-03-18</d><h>18:03</h><r>weavejester</r>The way you attach handlers to results in Ataraxy works for both the results you set up, and the error results Ataraxy uses when an error happens.</z><z id="t1521396874" t="Shantanu Kumar [:attrs {:href &quot;/_/_/users/U0BKWMG5B&quot;}] Thanks for the tip!"><y>#</y><d>2018-03-18</d><h>18:14</h><r>Shantanu Kumar</r><a>@U0BKWMG5B</a> Thanks for the tip!</z><z id="t1522052946" t="hawari How can I apply a middleware only on certain route? For example GET /userinfo will need to authenticate a user first, whereas GET /somethingelse won&apos;t require an access token at all."><y>#</y><d>2018-03-26</d><h>08:29</h><w>hawari</w>How can I apply a middleware only on certain route? For example <code>GET /userinfo</code> will need to authenticate a user first, whereas <code>GET /somethingelse</code> won&apos;t require an access token at all.</z><z id="t1522053073" t="hawari Is path + method matching on the middleware is the way to go here?"><y>#</y><d>2018-03-26</d><h>08:31</h><w>hawari</w>Is path + method matching on the middleware is the way to go here?</z><z id="t1522056275" t="ikitommi [:attrs {:href &quot;/_/_/users/U84FTP06P&quot;}] many routing libs support this out-of-the-box, some samples: Compojure-api (macros): (context &quot;/api&quot; [] :middleware [wrap-api] (GET &quot;/userinfo&quot; [] :middleware [wrap-auth] (ok ...)) (GET &quot;/somethingelse&quot; [] (ok ...))) Reitit (data): [&quot;/api&quot; {:middleware [wrap-api]} [&quot;/userinfo&quot; {:get {:middleware [wrap-require-auth] :handler ...}}] [&quot;/somethingelse&quot; {:get ...}]] "><y>#</y><d>2018-03-26</d><h>09:24</h><w>ikitommi</w><a>@hawari.rahman17</a> many routing libs support this out-of-the-box, some samples:

Compojure-api (macros):
<pre>(context &quot;/api&quot; []
  :middleware [wrap-api]
  (GET &quot;/userinfo&quot; []
    :middleware [wrap-auth]
    (ok ...))
  (GET &quot;/somethingelse&quot; []
    (ok ...)))
</pre>

Reitit (data):
<pre>[&quot;/api&quot; {:middleware [wrap-api]}
 [&quot;/userinfo&quot; {:get {:middleware [wrap-require-auth]
                     :handler ...}}]
 [&quot;/somethingelse&quot; {:get ...}]]
</pre></z><z id="t1522056734" t="hawari [:attrs {:href &quot;/_/_/users/U055NJ5CC&quot;}] I&apos;ve found that routes in compojure is quite extendable, I ended up doing something like this: (def restricted-routes (-&gt; (routes (GET &quot;/protected-path&quot; [] protected-fn)) (wrap-routes authorize))) (defroutes app-routes (GET &quot;/unprotected-routes&quot; [] &quot;Hello&quot;) restricted-routes) "><y>#</y><d>2018-03-26</d><h>09:32</h><w>hawari</w><a>@ikitommi</a> I&apos;ve found that <code>routes</code> in compojure is quite extendable, I ended up doing something like this:
<pre>(def restricted-routes
  (-&gt; (routes (GET &quot;/protected-path&quot; [] protected-fn))
      (wrap-routes authorize)))

(defroutes app-routes
  (GET &quot;/unprotected-routes&quot; [] &quot;Hello&quot;)
  restricted-routes)
</pre></z><z id="t1522056799" t="ikitommi I think you don‚Äôt need the routes within the restricted-routes ."><y>#</y><d>2018-03-26</d><h>09:33</h><w>ikitommi</w>I think you don‚Äôt need the <code>routes</code> within the <code>restricted-routes</code>.</z><z id="t1522056832" t="hawari I was planning to add another routes later on"><y>#</y><d>2018-03-26</d><h>09:33</h><r>hawari</r>I was planning to add another routes later on</z><z id="t1522056902" t="ikitommi oh, then, yes."><y>#</y><d>2018-03-26</d><h>09:35</h><r>ikitommi</r>oh, then, yes.</z><z id="t1522056801" t="hawari My problem is sometimes in the same context, there exists a route that doesn&apos;t need to be authorized first"><y>#</y><d>2018-03-26</d><h>09:33</h><w>hawari</w>My problem is sometimes in the same context, there exists a route that doesn&apos;t need to be authorized first</z><z id="t1522056832" t="hawari I was planning to add another routes later on"><y>#</y><d>2018-03-26</d><h>09:33</h><w>hawari</w>I was planning to add another routes later on</z><z id="t1522056889" t="ikitommi yes, but that‚Äôs to way to do it with Compojure. Compojure-api just adds sugar for it, e.g. the :middleware key."><y>#</y><d>2018-03-26</d><h>09:34</h><w>ikitommi</w>yes, but that‚Äôs to way to do it with Compojure. Compojure-api just adds sugar for it, e.g. the <code>:middleware</code> key.</z><z id="t1522056974" t="ikitommi if you are using nginx-clojure, you should be carefull with wrap-routes . It uses mutable request maps and the wrap-routes doesn‚Äôt work with it."><y>#</y><d>2018-03-26</d><h>09:36</h><w>ikitommi</w>if you are using nginx-clojure, you should be carefull with  <code>wrap-routes</code>. It uses mutable request maps and the <code>wrap-routes</code> doesn‚Äôt work with it.</z><z id="t1522057061" t="hawari Wow, that&apos;s news to me, can you elaborate on this please?"><y>#</y><d>2018-03-26</d><h>09:37</h><r>hawari</r>Wow, that&apos;s news to me, can you elaborate on this please?</z><z id="t1522057061" t="hawari Wow, that&apos;s news to me, can you elaborate on this please?"><y>#</y><d>2018-03-26</d><h>09:37</h><w>hawari</w>Wow, that&apos;s news to me, can you elaborate on this please?</z><z id="t1522057101" t="hawari I mean, I&apos;m not using nginx-clojure but I&apos;d like to know what I&apos;d signed up for with wrap-routes"><y>#</y><d>2018-03-26</d><h>09:38</h><w>hawari</w>I mean, I&apos;m not using <code>nginx-clojure</code> but I&apos;d like to know what I&apos;d signed up for with <code>wrap-routes</code></z><z id="t1522057215" t="ikitommi https://github.com/nginx-clojure/nginx-clojure/issues/182#issuecomment-318829347"><y>#</y><d>2018-03-26</d><h>09:40</h><w>ikitommi</w><a href="https://github.com/nginx-clojure/nginx-clojure/issues/182#issuecomment-318829347" target="_blank">https://github.com/nginx-clojure/nginx-clojure/issues/182#issuecomment-318829347</a></z><z id="t1522057325" t="ikitommi e.g. wrap-routes adds ‚Äúcall me if the path matches‚Äù info to the request. As the request is mutable, the info is still present in the request for the next routes. Next route will see that and invoke the mw. Kinda fatal."><y>#</y><d>2018-03-26</d><h>09:42</h><w>ikitommi</w>e.g. <code>wrap-routes</code> adds ‚Äúcall me if the path matches‚Äù info to the request. As the request is mutable, the info is still present in the request for the next routes. Next route will see that and invoke the mw. Kinda fatal.</z><z id="t1522057668" t="hawari So in other words, even if the path matches the routes not listed in restricted-routes , the middleware authorize will still gets invoked?"><y>#</y><d>2018-03-26</d><h>09:47</h><w>hawari</w>So in other words, even if the path matches the routes not listed in <code>restricted-routes</code>, the middleware <code>authorize</code> will still gets invoked?</z><z id="t1522057692" t="hawari Wow, thanks for the warning [:attrs {:href &quot;/_/_/users/U055NJ5CC&quot;}] , I&apos;ll be sure to remember that"><y>#</y><d>2018-03-26</d><h>09:48</h><w>hawari</w>Wow, thanks for the warning <a>@ikitommi</a>, I&apos;ll be sure to remember that</z><z id="t1522058150" t="ikitommi yes, it gets called for the next route by Compojure. np."><y>#</y><d>2018-03-26</d><h>09:55</h><w>ikitommi</w>yes, it gets called for the next route by Compojure. np.</z><z id="t1522649407" t="claudiu Hi, don&apos;t know if it&apos;s the write place to ask. Can somebody help me understand war output. After doing lein ring uberwar and jar xf name.war , in WEB-INF I have lib &amp; classes. Seems that a most of the project dependencies are in both. If I remove from classes all the dependencies and leave just the project files, the app works, but it seems to increase the startup time a bit."><y>#</y><d>2018-04-02</d><h>06:10</h><w>claudiu</w>Hi, don&apos;t know if it&apos;s the write place to ask. Can somebody help me understand war output. After doing <code>lein ring uberwar</code> and <code>jar xf name.war</code>, in <code>WEB-INF</code> I have lib &amp; classes. Seems that a most of the project dependencies are in both. If I remove from classes all the dependencies and leave just the project files, the app works, but it seems to increase the startup time a bit.</z><z id="t1522649500" t="claudiu Asking this because for &quot;google appengine standard env&quot; there is a 10k file limit per app, and I have 7k just for my base template. Curious if there are any other implications in deleting the libs from classes apart from startup time"><y>#</y><d>2018-04-02</d><h>06:11</h><w>claudiu</w>Asking this because for &quot;google appengine standard env&quot; there is a 10k file limit per app, and I have 7k just for my base template. Curious if there are any other implications in deleting the libs from <code>classes</code> apart from startup time</z><z id="t1523923980" t="stvnmllr2 anyone know a simple example posted online for downloading file stream? Like, generating a csv file for example. Or serving any file really."><y>#</y><d>2018-04-17</d><h>00:13</h><w>stvnmllr2</w>anyone know a simple example posted online for downloading file stream?  Like, generating a csv file for example. Or serving any file really.</z><z id="t1523924150" t="alice [:attrs {:href &quot;/_/_/users/U2AAUNY7J&quot;}] You want to serve a filestream, do I understand correctly?"><y>#</y><d>2018-04-17</d><h>00:15</h><w>alice</w><a>@stvnmllr2</a> You want to serve a filestream, do I understand correctly?</z><z id="t1523924168" t="stvnmllr2 well.. any stream. Or just a file if I have to."><y>#</y><d>2018-04-17</d><h>00:16</h><w>stvnmllr2</w>well.. any stream.  Or just a file if I have to.</z><z id="t1523924178" t="stvnmllr2 so people can download their data from an app"><y>#</y><d>2018-04-17</d><h>00:16</h><w>stvnmllr2</w>so people can download their data from an app</z><z id="t1523924181" t="stvnmllr2 web app"><y>#</y><d>2018-04-17</d><h>00:16</h><w>stvnmllr2</w>web app</z><z id="t1523924304" t="alice I&apos;m serving images from a GridFS db in clojure like this, gimme a sec"><y>#</y><d>2018-04-17</d><h>00:18</h><w>alice</w>I&apos;m serving images from a GridFS db in clojure like this, gimme a sec</z><z id="t1523924363" t="alice (defn make-file-stream &quot;Takes an input stream `file` -- such as a MongoDBObject stream and streams it&quot; [file] (rio/piped-input-stream (fn [output-stream] (.writeTo file output-stream)))) (defn download-file-by-id &quot;Downloads the requested file with `md5`&quot; [md5] (let [mongo-file (first (db/get-file-md5 md5)) file-map (db/find-map-by-md5 md5) content-type (-&gt; file-map :contentType) file-name (-&gt; file-map :filename)] (res/content-type {:status 200 :body (make-file-stream mongo-file)} content-type))) ;; then in my routes (GET &quot;/i/:md5&quot; [md5] (download-file-by-id (first (string/split md5 #&quot;\.&quot;)))) "><y>#</y><d>2018-04-17</d><h>00:19</h><w>alice</w><pre>(defn make-file-stream
  &quot;Takes an input stream `file` -- such as a MongoDBObject stream and streams it&quot;
  [file]
  (rio/piped-input-stream
   (fn [output-stream]
     (.writeTo file output-stream))))


(defn download-file-by-id
  &quot;Downloads the requested file with `md5`&quot;
  [md5]
  (let [mongo-file   (first (db/get-file-md5 md5))
        file-map     (db/find-map-by-md5 md5)
        content-type (-&gt; file-map :contentType)
        file-name    (-&gt; file-map :filename)]
    (res/content-type {:status 200 :body (make-file-stream mongo-file)} content-type)))

;; then in my routes
  (GET &quot;/i/:md5&quot; [md5] (download-file-by-id (first (string/split md5 #&quot;\.&quot;))))
</pre></z><z id="t1523924541" t="stvnmllr2 [:attrs {:href &quot;/_/_/users/U5Z4ECHCM&quot;}] . Closer than anything else I&apos;ve found. Thanks! Will give it a go."><y>#</y><d>2018-04-17</d><h>00:22</h><w>stvnmllr2</w><a>@alice</a>. Closer than anything else I&apos;ve found. Thanks! Will give it a go.</z><z id="t1523924566" t="alice Keep in mind I only have to pipe the stream because I originate with an input stream"><y>#</y><d>2018-04-17</d><h>00:22</h><w>alice</w>Keep in mind I only have to pipe the stream because I originate with an input stream</z><z id="t1524125749" t="mping Hi all, I&apos;m using ring-instrument and am hitting the following error: Wrong number of args (3) passed to: instrument/eval25027/instrument--25028/fn--25029 "><y>#</y><d>2018-04-19</d><h>08:15</h><w>mping</w>Hi all, I&apos;m using <code>ring-instrument</code> and am hitting the following error: 
<pre>Wrong number of args (3) passed to: instrument/eval25027/instrument--25028/fn--25029
</pre></z><z id="t1524125774" t="mping I basically added ring-instrument to this proj: https://github.com/metosin/c2"><y>#</y><d>2018-04-19</d><h>08:16</h><w>mping</w>I basically added ring-instrument to this proj: <a href="https://github.com/metosin/c2" target="_blank">https://github.com/metosin/c2</a></z><z id="t1524126762" t="ikitommi [:attrs {:href &quot;/_/_/users/U0MQW27QB&quot;}] c2 uses ring-async, which requires middleware to be 3-arity. ring-instrument doesn‚Äôt support that I guess? Where is the code for it?"><y>#</y><d>2018-04-19</d><h>08:32</h><w>ikitommi</w><a>@mping</a> c2 uses ring-async, which requires middleware to be 3-arity. <code>ring-instrument</code> doesn‚Äôt support that I guess? Where is the code for it?</z><z id="t1524126812" t="mping [:attrs {:href &quot;/_/_/users/U055NJ5CC&quot;}] ring instrument is here: https://github.com/metrics-clojure/metrics-clojure/blob/master/metrics-clojure-ring/src/metrics/ring/instrument.clj"><y>#</y><d>2018-04-19</d><h>08:33</h><w>mping</w><a>@ikitommi</a> ring instrument is here: <a href="https://github.com/metrics-clojure/metrics-clojure/blob/master/metrics-clojure-ring/src/metrics/ring/instrument.clj" target="_blank">https://github.com/metrics-clojure/metrics-clojure/blob/master/metrics-clojure-ring/src/metrics/ring/instrument.clj</a></z><z id="t1524127396" t="mping I‚Äôm not familiar with ring-async"><y>#</y><d>2018-04-19</d><h>08:43</h><w>mping</w>I‚Äôm not familiar with ring-async</z><z id="t1524132199" t="ikitommi [:attrs {:href &quot;/_/_/users/U0MQW27QB&quot;}] yeah, it&apos;s sync only. Adding async support is easy, here&apos;s an example: https://github.com/ring-clojure/ring/wiki/Concepts#middleware"><y>#</y><d>2018-04-19</d><h>10:03</h><w>ikitommi</w><a>@mping</a> yeah, it&apos;s sync only. Adding async support is easy, here&apos;s an example: <a href="https://github.com/ring-clojure/ring/wiki/Concepts#middleware" target="_blank">https://github.com/ring-clojure/ring/wiki/Concepts#middleware</a></z><z id="t1524132258" t="ikitommi if you don&apos;t need async, just change :async? to false in project.clj"><y>#</y><d>2018-04-19</d><h>10:04</h><w>ikitommi</w>if you don&apos;t need async, just change <code>:async?</code> to false in <code>project.clj</code></z><z id="t1524132892" t="mping I‚Äôll take a look, thanks for the tips!"><y>#</y><d>2018-04-19</d><h>10:14</h><w>mping</w>I‚Äôll take a look, thanks for the tips!</z><z id="t1526583864" t="plins its possible to set the port to start ring via an enviroment variable? I am using environ in the project"><y>#</y><d>2018-05-17</d><h>19:04</h><w>plins</w>its possible to set the port to start ring via an enviroment variable? I am using <code>environ</code> in the project</z><z id="t1526584625" t="seancorfield [:attrs {:href &quot;/_/_/users/U3QUAHZJ6&quot;}] Ring will start on whatever port you tell it to so, yes, your code could let that be selected via an environment variable."><y>#</y><d>2018-05-17</d><h>19:17</h><w>seancorfield</w><a>@plins</a> Ring will start on whatever port you tell it to so, yes, your code could let that be selected via an environment variable.</z><z id="t1526630341" t="jumar [:attrs {:href &quot;/_/_/users/U3QUAHZJ6&quot;}] as sean said, just read that port from environ&apos;s env and pass it to ring adapter, e.g. ring-jetty-adapter : https://github.com/ring-clojure/ring/blob/master/ring-jetty-adapter/src/ring/adapter/jetty.clj#L134"><y>#</y><d>2018-05-18</d><h>07:59</h><w>jumar</w><a>@plins</a> as sean said, just read that port from environ&apos;s env and pass it to ring adapter, e.g. <code>ring-jetty-adapter</code>: <a href="https://github.com/ring-clojure/ring/blob/master/ring-jetty-adapter/src/ring/adapter/jetty.clj#L134" target="_blank">https://github.com/ring-clojure/ring/blob/master/ring-jetty-adapter/src/ring/adapter/jetty.clj#L134</a></z><z id="t1527241450" t="laujensen I have a handler which returns a 302 redirect if you hit a disabled url. Active urls trigger a rendering function, but suprisingly enough the render function is not triggered if the user first hits a 302. Where do I start debugging?"><y>#</y><d>2018-05-25</d><h>09:44</h><w>laujensen</w>I have a handler which returns a 302 redirect if you hit a disabled url. Active urls trigger a rendering function, but suprisingly enough the render function is not triggered if the user first hits a 302. Where do I start debugging?</z></g><g id="s5"><z id="t1527244679" t="weavejester How are you calling the render function?"><y>#</y><d>2018-05-25</d><h>10:37</h><w>weavejester</w>How are you calling the render function?</z><z id="t1527295726" t="sova-soars-the-sora [:attrs {:href &quot;/_/_/users/U3VC9DLG2&quot;}] so say a user tries to access a disabled url, it comes back 302, but then when they go to a legitimate one it also doesn&apos;t work?"><y>#</y><d>2018-05-26</d><h>00:48</h><w>sova-soars-the-sora</w><a>@laujensen</a> so say a user tries to access a disabled url, it comes back 302, but then when they go to a legitimate one it also doesn&apos;t work?</z><z id="t1527362724" t="laujensen [:attrs {:href &quot;/_/_/users/U0BKWMG5B&quot;}] &amp; [:attrs {:href &quot;/_/_/users/U3ES97LAC&quot;}] -&gt; turns out a max-age cache value was added somewhere down the line, so the browser wouldnt re-request"><y>#</y><d>2018-05-26</d><h>19:25</h><w>laujensen</w><a>@weavejester</a> &amp; <a>@sova</a> -&gt; turns out a max-age cache value was added somewhere down the line, so the browser wouldnt re-request</z><z id="t1527383682" t="sova-soars-the-sora [:attrs {:href &quot;/_/_/users/U3VC9DLG2&quot;}] very interesting. makes sense. perhaps you can disable caching for urls that kickback 302"><y>#</y><d>2018-05-27</d><h>01:14</h><w>sova-soars-the-sora</w><a>@laujensen</a> very interesting.  makes sense.  perhaps you can disable caching for urls that kickback 302</z><z id="t1527489123" t="ikitommi I think it would be a good idea if ring (the implementation) would support &amp; enforce returning byte-array :s."><y>#</y><d>2018-05-28</d><h>06:32</h><w>ikitommi</w>I think it would be a good idea if ring (the implementation) would support &amp; enforce returning <code>byte-array</code>:s.</z><z id="t1527489169" t="ikitommi It seems to be the fastest way to return things out from memory, e.g. Clojure data -&gt; JSON."><y>#</y><d>2018-05-28</d><h>06:32</h><w>ikitommi</w>It seems to be the fastest way to return things out from memory, e.g. Clojure data -&gt; JSON.</z><z id="t1527489487" t="ikitommi related: https://github.com/metosin/muuntaja/pull/64"><y>#</y><d>2018-05-28</d><h>06:38</h><r>ikitommi</r>related: <a href="https://github.com/metosin/muuntaja/pull/64" target="_blank">https://github.com/metosin/muuntaja/pull/64</a></z><z id="t1527489214" t="ikitommi NIO-servers can send it as ByteBuffer and non-NIO can write it directly to a ByteArrayOutputStream with .write ."><y>#</y><d>2018-05-28</d><h>06:33</h><w>ikitommi</w>NIO-servers can send it as <code>ByteBuffer</code> and non-NIO can write it directly to a ByteArrayOutputStream with <code>.write</code>.</z><z id="t1527489253" t="ikitommi ‚Ä¶ and Jackson (and Jsonista) has optimized path for producing it, no intemediate Strings or Streams."><y>#</y><d>2018-05-28</d><h>06:34</h><w>ikitommi</w>‚Ä¶ and Jackson (and Jsonista) has optimized path for producing it, no intemediate Strings or Streams.</z><z id="t1527489299" t="ikitommi what do you think [:attrs {:href &quot;/_/_/users/U0BKWMG5B&quot;}] ? I think there was a catch on implementing Protocols for primitive-arrays. Seem to work thou."><y>#</y><d>2018-05-28</d><h>06:34</h><w>ikitommi</w>what do you think <a>@weavejester</a>? I think there was a catch on implementing Protocols for primitive-arrays. Seem to work thou.</z><z id="t1527515059" t="weavejester ByteBuffer s are not supported by all NIO servers. The problem with NIO in particular is that many Java NIO servers predate Java‚Äôs own NIO classes, so for instance Netty uses its own system (last I looked)."><y>#</y><d>2018-05-28</d><h>13:44</h><w>weavejester</w><code>ByteBuffer</code>s are not supported by all NIO servers. The problem with NIO in particular is that many Java NIO servers predate Java‚Äôs own NIO classes, so for instance Netty uses its own system (last I looked).</z><z id="t1527515100" t="weavejester If it‚Äôs feasible to extend a protocol to a byte array without issue, then I don‚Äôt see any reason not to add this as a body return type."><y>#</y><d>2018-05-28</d><h>13:45</h><w>weavejester</w>If it‚Äôs feasible to extend a protocol to a byte array without issue, then I don‚Äôt see any reason not to add this as a body return type.</z><z id="t1527522377" t="ikitommi Oh, didn&apos;t know about the Netty non-NIO internals. Anyway, both Aleph &amp; Immutant(alpha) serve over 1M req/sec in the latest TechEmpower JSON test, both with byte-arrays ."><y>#</y><d>2018-05-28</d><h>15:46</h><w>ikitommi</w>Oh, didn&apos;t know about the Netty non-NIO internals. Anyway, both Aleph &amp; Immutant(alpha) serve over 1M req/sec in the latest TechEmpower JSON test, both with <code>byte-arrays</code>.</z><z id="t1527522408" t="ikitommi I&apos;ll check if it works in all cases and do a PR."><y>#</y><d>2018-05-28</d><h>15:46</h><w>ikitommi</w>I&apos;ll check if it works in all cases and do a PR.</z><z id="t1527761513" t="conan Hi, I&apos;m using ring-defaults middleware to get the ring.middleware.params/wrap-params (I&apos;m also using munntaja.middleware/wrap-format ), and these seem to be adding in nil values for :body (and :query-string respectively). This stops the requests being ring-spec compliant, as these keys are not nilable - is there a way to get wrap-params to remove the key instead of adding in a nil value to keep the request spec-compliant?"><y>#</y><d>2018-05-31</d><h>10:11</h><w>conan</w>Hi, I&apos;m using <code>ring-defaults</code> middleware to get the <code>ring.middleware.params/wrap-params</code> (I&apos;m also using <code>munntaja.middleware/wrap-format</code>), and these seem to be adding in <code>nil</code> values for <code>:body</code> (and <code>:query-string</code> respectively).  This stops the requests being ring-spec compliant, as these keys are not <code>nilable</code> - is there a way to get <code>wrap-params</code> to remove the key instead of adding in a <code>nil</code> value to keep the request spec-compliant?</z><z id="t1527761587" t="conan I see a failure on the first invocation of my handler function after locating it with reitit routing"><y>#</y><d>2018-05-31</d><h>10:13</h><r>conan</r>I see a failure on the first invocation of my handler function after locating it with reitit routing</z><z id="t1527761698" t="conan Here&apos;s my error (via expound): Call to #&apos;hanabi.web/initialise did not conform to spec: web.clj:181 -- Spec failed -------------------- Function arguments ({:reitit.core/match ..., :reitit.core/router ..., :remote-addr ..., :params ..., :headers ..., :async-channel ..., :server-port ..., :content-length ..., :form-params ..., :websocket? ..., :web/session ..., :query-params ..., :content-type ..., :character-encoding ..., :uri ..., :server-name ..., :query-string ..., :path-params ..., :body nil, ^^^ :scheme ..., :request-method ...}) should satisfy #object[clojure.spec.alpha$regex_spec_impl$reify__2436 0x765709fc &quot;"><y>#</y><d>2018-05-31</d><h>10:14</h><r>conan</r>Here&apos;s my error (via expound):
<pre>Call to #&apos;hanabi.web/initialise did not conform to spec:
web.clj:181

-- Spec failed --------------------

Function arguments

  ({:reitit.core/match ...,
    :reitit.core/router ...,
    :remote-addr ...,
    :params ...,
    :headers ...,
    :async-channel ...,
    :server-port ...,
    :content-length ...,
    :form-params ...,
    :websocket? ...,
    :web/session ...,
    :query-params ...,
    :content-type ...,
    :character-encoding ...,
    :uri ...,
    :server-name ...,
    :query-string ...,
    :path-params ...,
    :body nil,
          ^^^
    :scheme ...,
    :request-method ...})

should satisfy

  #object[clojure.spec.alpha$regex_spec_impl$reify__2436 0x765709fc &quot;</pre></z><z id="t1527762087" t="conan i&apos;m using httpkit"><y>#</y><d>2018-05-31</d><h>10:21</h><r>conan</r>i&apos;m using httpkit</z><z id="t1527762147" t="conan it appears that the request that reaches my handler contains the :body and :query-string keys both with nil values, so the problem is not with middleware, sorry"><y>#</y><d>2018-05-31</d><h>10:22</h><r>conan</r>it appears that the request that reaches my handler contains the <code>:body</code> and <code>:query-string</code> keys both with <code>nil</code> values, so the problem is not with middleware, sorry</z><z id="t1527762819" t="conan i&apos;ve raised an issue with httpkit: https://github.com/http-kit/http-kit/issues/377"><y>#</y><d>2018-05-31</d><h>10:33</h><r>conan</r>i&apos;ve raised an issue with httpkit: <a href="https://github.com/http-kit/http-kit/issues/377" target="_blank">https://github.com/http-kit/http-kit/issues/377</a></z><z id="t1527764917" t="conan I&apos;ve just tried with jetty, same result. Both send requests with nil values for :body and :query-string"><y>#</y><d>2018-05-31</d><h>11:08</h><r>conan</r>I&apos;ve just tried with jetty, same result.  Both send requests with <code>nil</code> values for <code>:body</code>and <code>:query-string</code></z><z id="t1527764935" t="conan So i guess this must be a problem with ring itself?"><y>#</y><d>2018-05-31</d><h>11:08</h><r>conan</r>So i guess this must be a problem with ring itself?</z><z id="t1527766746" t="conan The spec: https://github.com/ring-clojure/ring-spec/blob/master/src/ring/core/spec.clj#L115"><y>#</y><d>2018-05-31</d><h>11:39</h><r>conan</r>The spec: <a href="https://github.com/ring-clojure/ring-spec/blob/master/src/ring/core/spec.clj#L115" target="_blank">https://github.com/ring-clojure/ring-spec/blob/master/src/ring/core/spec.clj#L115</a></z><z id="t1527764655" t="ikitommi like the response :headers , could all the empty request keys be defined as s/nillable ?"><y>#</y><d>2018-05-31</d><h>11:04</h><w>ikitommi</w>like the response <code>:headers</code>, could all the empty request keys be defined as <code>s/nillable</code>?</z><z id="t1527774419" t="conan I also seem to get a missing :protocol from time to time as well"><y>#</y><d>2018-05-31</d><h>13:46</h><w>conan</w>I also seem to get a missing <code>:protocol</code> from time to time as well</z><z id="t1527774506" t="conan I actually think the spec is good here, I don&apos;t see the point of including nil values in maps, but at the moment it seems pretty unusable because I can&apos;t find anywhere to get a valid ring request."><y>#</y><d>2018-05-31</d><h>13:48</h><w>conan</w>I actually think the spec is good here, I don&apos;t see the point of including <code>nil</code> values in maps, but at the moment it seems pretty unusable because I can&apos;t find anywhere to get a valid ring request.</z><z id="t1528058642" t="Ethan Miller Has anyone here had any trouble getting ring to work with Datomic Cloud. I&apos;ve hit a set of dependency conflicts that are very challenging to resolve."><y>#</y><d>2018-06-03</d><h>20:44</h><w>Ethan Miller</w>Has anyone here had any trouble getting ring to work with Datomic Cloud. I&apos;ve hit a set of dependency conflicts that are very challenging to resolve.</z><z id="t1528071629" t="Ethan Miller Here&apos;s a repo illustrating the problem I&apos;ve been having: https://github.com/ezmiller/datomic-ring-dep-conflict"><y>#</y><d>2018-06-04</d><h>00:20</h><w>Ethan Miller</w>Here&apos;s a repo illustrating the problem I&apos;ve been having: <a href="https://github.com/ezmiller/datomic-ring-dep-conflict" target="_blank">https://github.com/ezmiller/datomic-ring-dep-conflict</a></z><z id="t1528082511" t="seancorfield [:attrs {:href &quot;/_/_/users/U3RGL6XNF&quot;}] You might want to update the README to explain what the problem actually is and what you&apos;ve tried so far to resolve it..."><y>#</y><d>2018-06-04</d><h>03:21</h><w>seancorfield</w><a>@ezmiller77</a> You might want to update the README to explain what the problem actually is and what you&apos;ve tried so far to resolve it...</z><z id="t1528082865" t="Ethan Miller [:attrs {:href &quot;/_/_/users/U04V70XH6&quot;}] : https://github.com/ezmiller/datomic-ring-dep-conflict/tree/exlusions-from-datomic-cloud"><y>#</y><d>2018-06-04</d><h>03:27</h><w>Ethan Miller</w><a>@seancorfield</a>:  <a href="https://github.com/ezmiller/datomic-ring-dep-conflict/tree/exlusions-from-datomic-cloud" target="_blank">https://github.com/ezmiller/datomic-ring-dep-conflict/tree/exlusions-from-datomic-cloud</a></z><z id="t1528119778" t="weavejester Looks like a dependency issue, [:attrs {:href &quot;/_/_/users/U3RGL6XNF&quot;}] . Perhaps try checking lein deps :tree for conflicts."><y>#</y><d>2018-06-04</d><h>13:42</h><w>weavejester</w>Looks like a dependency issue, <a>@ezmiller77</a>. Perhaps try checking <code>lein deps :tree</code> for conflicts.</z><z id="t1528119842" t="Ethan Miller [:attrs {:href &quot;/_/_/users/U0BKWMG5B&quot;}] got solved overnight. The trick was to specify a jetty-server version. Hopefully, the datomic folks will add it to there docs. Seems others wasted a bunch of time trying to figure this one out as well."><y>#</y><d>2018-06-04</d><h>13:44</h><w>Ethan Miller</w><a>@weavejester</a> got solved overnight. The trick was to specify a jetty-server version. Hopefully, the datomic folks will add it to there docs. Seems others wasted a bunch of time trying to figure this one out as well.</z><z id="t1528119870" t="weavejester Glad you got it sorted"><y>#</y><d>2018-06-04</d><h>13:44</h><w>weavejester</w>Glad you got it sorted</z><z id="t1528119873" t="Ethan Miller https://forum.datomic.com/t/dependency-conflict-with-ring-jetty/447"><y>#</y><d>2018-06-04</d><h>13:44</h><w>Ethan Miller</w><a href="https://forum.datomic.com/t/dependency-conflict-with-ring-jetty/447" target="_blank">https://forum.datomic.com/t/dependency-conflict-with-ring-jetty/447</a></z><z id="t1528131838" t="seancorfield To be honest [:attrs {:href &quot;/_/_/users/U3RGL6XNF&quot;}] this sort of thing -- version conflicts in transitive dependencies -- is fairly common, so adding exclusions and then also adding specific versions of the excluded libraries is just something we have to get used to with Maven dependency resolution üòê We have several dependencies at work on external Java libraries and we have to have a fairly long list of exclusions and a long list of top-level dependencies for stuff that our code &quot;needs&quot; transitively even tho&apos; none of those libraries are explicitly used by our code."><y>#</y><d>2018-06-04</d><h>17:03</h><w>seancorfield</w>To be honest <a>@ezmiller77</a> this sort of thing -- version conflicts in transitive dependencies -- is fairly common, so adding exclusions and then also adding specific versions of the excluded libraries is just something we have to get used to with Maven dependency resolution <b>üòê</b> We have several dependencies at work on external Java libraries and we have to have a fairly long list of exclusions and a long list of top-level dependencies for stuff that our code &quot;needs&quot; transitively even tho&apos; none of those libraries are explicitly used by our code.</z><z id="t1528131927" t="seancorfield We rely on Microsoft Azure authentication for a couple of apps and their libraries bring in all sorts of transitive dependencies that conflict with several other libraries we use. Every time we want to update the Azure library, we have to go through a big dependency dance to ensure we have the right exclusions and the right set of top-level dependencies üòû"><y>#</y><d>2018-06-04</d><h>17:05</h><w>seancorfield</w>We rely on Microsoft Azure authentication for a couple of apps and their libraries bring in all sorts of transitive dependencies that conflict with several other libraries we use. Every time we want to update the Azure library, we have to go through a big dependency dance to ensure we have the right exclusions and the right set of top-level dependencies <b>üòû</b></z><z id="t1528133008" t="Ethan Miller Yeah. I saw somewhere else that this has something to do with how Java and thus clojure deals with dependencies. It&apos;s a pretty big weakness. I haven&apos;t been that frustrated in solving a problem in years. Ironically, I was longing to get back to the ease of the Javascript dev environment, and if that&apos;s the case you know something&apos;s off üòâ"><y>#</y><d>2018-06-04</d><h>17:23</h><w>Ethan Miller</w>Yeah. I saw somewhere else that this has something to do with how Java and thus clojure deals with dependencies. It&apos;s a pretty big weakness. I haven&apos;t been that frustrated in solving a problem in years. Ironically, I was longing to get back to the ease of the Javascript dev environment, and if that&apos;s the case you know something&apos;s off <b>üòâ</b></z><z id="t1528186359" t="jumar To be honest, I think Java/JVM has one of the best tools for dependency resolution. It&apos;s still broken, but others are so much worse."><y>#</y><d>2018-06-05</d><h>08:12</h><r>jumar</r>To be honest, I think Java/JVM has one of the best tools for dependency resolution. It&apos;s still broken, but others are so much worse.</z><z id="t1528283408" t="laujensen Im seeing an issue where GET requests set certain session keys and these persist, but when client sends an AJAX request from Internet Explorer, most of these keys are nil - Though they are not affected by my own code. Its only when ajax‚Äôing from IE, not Edge/Chrome/Firefox. Where do I start looking for the culprit?"><y>#</y><d>2018-06-06</d><h>11:10</h><w>laujensen</w>Im seeing an issue where GET requests set certain session keys and these persist, but when client sends an AJAX request from Internet Explorer, most of these keys are nil - Though they are not affected by my own code. Its only when ajax‚Äôing from IE, not Edge/Chrome/Firefox. Where do I start looking for the culprit?</z><z id="t1528416199" t="weavejester That sounds like cookies aren‚Äôt being sent."><y>#</y><d>2018-06-08</d><h>00:03</h><w>weavejester</w>That sounds like cookies aren‚Äôt being sent.</z><z id="t1528696893" t="ikitommi what was the reason to deprecate :content-type key in the Ring Request SPEC?"><y>#</y><d>2018-06-11</d><h>06:01</h><w>ikitommi</w>what was the reason to deprecate <code>:content-type</code> key in the Ring Request SPEC?</z><z id="t1528697011" t="ikitommi should apps re-parse it from the headers when it‚Äôs needed?"><y>#</y><d>2018-06-11</d><h>06:03</h><w>ikitommi</w>should apps re-parse it from the headers when it‚Äôs needed?</z><z id="t1528723081" t="weavejester [:attrs {:href &quot;/_/_/users/U055NJ5CC&quot;}] It‚Äôs simpler and more consistent to treat it as a normal header, rather than a special case."><y>#</y><d>2018-06-11</d><h>13:18</h><w>weavejester</w><a>@ikitommi</a> It‚Äôs simpler and more consistent to treat it as a normal header, rather than a special case.</z><z id="t1528723096" t="weavejester There‚Äôs a ring.util.response/content-type function instead."><y>#</y><d>2018-06-11</d><h>13:18</h><w>weavejester</w>There‚Äôs a <code>ring.util.response/content-type</code> function instead.</z><z id="t1528961500" t="ikitommi [:attrs {:href &quot;/_/_/users/U0BKWMG5B&quot;}] thanks. There doesn‚Äôt seem to get get-content-type available, the ring.util.response/get-header returns the raw string, which might have stuff like encoding, e.g.`&quot;application/json; encoding=utf-8&quot;`. My use case is that I need it multiple times in a request pipeline for different purposes, I guess the current good practise is to parse it once (in a content-negotiation middleware) and push it to request so it doesn‚Äôt need to be reparsed for all users."><y>#</y><d>2018-06-14</d><h>07:31</h><w>ikitommi</w><a>@weavejester</a> thanks. There doesn‚Äôt seem to get <code>get-content-type</code> available, the <code>ring.util.response/get-header</code> returns the raw string, which might have stuff like encoding, e.g.`&quot;application/json; encoding=utf-8&quot;`. My use case is that I need it multiple times in a request pipeline for different purposes, I guess the current good practise is to parse it once (in a content-negotiation middleware) and push it to request so it doesn‚Äôt need to be reparsed for all users.</z><z id="t1528962002" t="ikitommi But well, just wanted to know the cause, I‚Äôll wire together the libs using Muuntaja keys. Only gets parsed once and the reads are fast (despite stored under a library-spesific key): ;; Muuntaja pushes the parsed results into a Record for fast access (defrecord RequestAndCharset [format charset]) ;; a Sample request (def req {:headers {&quot;origin&quot; &quot;&quot;, &quot;host&quot; &quot;localhost:3000&quot;, &quot;user-agent&quot; &quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/67.0.3396.87 Safari/537.36&quot;, &quot;content-type&quot; &quot;application/json&quot;, &quot;cookie&quot; &quot;JSESSIONID=fo2TyZwq24rKinCsfcHI_DgKz611PO9Lpyh1mLqf; _ga=GA1.1.1363736022.1528784471&quot;, &quot;content-length&quot; &quot;22&quot;, &quot;referer&quot; &quot;&quot;, &quot;connection&quot; &quot;keep-alive&quot;, &quot;accept&quot; &quot;application/json&quot;, &quot;accept-language&quot; &quot;en-US,en;q=0.9,fi-FI;q=0.8,fi;q=0.7&quot;, &quot;accept-encoding&quot; &quot;gzip, deflate, br&quot;, &quot;dnt&quot; &quot;1&quot;} :muuntaja/request (-&gt;RequestAndCharset &quot;application/json&quot; nil) :muuntaja/response (-&gt;RequestAndCharset &quot;application/json&quot; nil)}) ;; 352ns (cc/quick-bench (ring.util.response/get-header req &quot;content-type&quot;)) ;; 45ns (cc/quick-bench (-&gt; req :headers (get &quot;content-type&quot;))) ;; 13ns (cc/quick-bench (-&gt; req :muuntaja/request :format)) "><y>#</y><d>2018-06-14</d><h>07:40</h><w>ikitommi</w>But well, just wanted to know the cause, I‚Äôll wire together the libs using Muuntaja keys. Only gets parsed once and the reads are fast (despite stored under a library-spesific key):
<pre>;; Muuntaja pushes the parsed results into a Record for fast access
(defrecord RequestAndCharset [format charset])

;; a Sample request
(def req {:headers {&quot;origin&quot; &quot;&quot;,
                    &quot;host&quot; &quot;localhost:3000&quot;,
                    &quot;user-agent&quot; &quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/67.0.3396.87 Safari/537.36&quot;,
                    &quot;content-type&quot; &quot;application/json&quot;,
                    &quot;cookie&quot; &quot;JSESSIONID=fo2TyZwq24rKinCsfcHI_DgKz611PO9Lpyh1mLqf; _ga=GA1.1.1363736022.1528784471&quot;,
                    &quot;content-length&quot; &quot;22&quot;,
                    &quot;referer&quot; &quot;&quot;,
                    &quot;connection&quot; &quot;keep-alive&quot;,
                    &quot;accept&quot; &quot;application/json&quot;,
                    &quot;accept-language&quot; &quot;en-US,en;q=0.9,fi-FI;q=0.8,fi;q=0.7&quot;,
                    &quot;accept-encoding&quot; &quot;gzip, deflate, br&quot;,
                    &quot;dnt&quot; &quot;1&quot;}
          :muuntaja/request (-&gt;RequestAndCharset &quot;application/json&quot; nil)
          :muuntaja/response (-&gt;RequestAndCharset &quot;application/json&quot; nil)})

;; 352ns
(cc/quick-bench
  (ring.util.response/get-header req &quot;content-type&quot;))

;; 45ns
(cc/quick-bench
  (-&gt; req :headers (get &quot;content-type&quot;)))

;; 13ns
(cc/quick-bench
  (-&gt; req :muuntaja/request :format))
</pre></z><z id="t1528990795" t="weavejester [:attrs {:href &quot;/_/_/users/U055NJ5CC&quot;}] There‚Äôs a ring.util.request/content-type function."><y>#</y><d>2018-06-14</d><h>15:39</h><w>weavejester</w><a>@ikitommi</a> There‚Äôs a <code>ring.util.request/content-type</code> function.</z><z id="t1528990842" t="weavejester Sorry, before I wrote ring.util.response/content-type when I meant ring.util.request/content-type ."><y>#</y><d>2018-06-14</d><h>15:40</h><w>weavejester</w>Sorry, before I wrote <code>ring.util.response/content-type</code> when I meant <code>ring.util.request/content-type</code>.</z><z id="t1528993275" t="ikitommi oh, thanks again! For some reason I haven‚Äôt ever used the .request ns. It does the trick indeed."><y>#</y><d>2018-06-14</d><h>16:21</h><w>ikitommi</w>oh, thanks again! For some reason I haven‚Äôt ever used the <code>.request</code> ns. It does the trick indeed.</z><z id="t1528993351" t="ikitommi ;; 874ns (cc/quick-bench (ring.util.request/content-type req)) "><y>#</y><d>2018-06-14</d><h>16:22</h><w>ikitommi</w><pre>;; 874ns
(cc/quick-bench
  (ring.util.request/content-type req))
</pre></z><z id="t1529424182" t="petr.mensik How to correctly return a file for download in Ring? I am returning this response however the file in there is a mess (but it&apos;s not empty either) {:status 200 :headers {&quot;Content-Type&quot; &quot;application/vnd.openxmlformats-officedocument.spreadsheetml.sheet&quot; &quot;Content-Disposition&quot; &quot;attachment; filename=listing_offer.xlsx&quot;} :body (io/input-stream &quot;/tmp/sheet.xlsx&quot;) File in the /tmp is ok and can be opened normally. Thanks for advice!"><y>#</y><d>2018-06-19</d><h>16:03</h><w>petr.mensik</w>How to correctly return a file for download in Ring? I am returning this response however the file in there is a mess (but it&apos;s not empty either)
<pre>{:status 200
       :headers {&quot;Content-Type&quot; &quot;application/vnd.openxmlformats-officedocument.spreadsheetml.sheet&quot;
                 &quot;Content-Disposition&quot; &quot;attachment; filename=listing_offer.xlsx&quot;}
       :body (io/input-stream &quot;/tmp/sheet.xlsx&quot;)
</pre>
File in the /tmp is ok and can be opened normally. Thanks for advice!</z><z id="t1529429647" t="seancorfield [:attrs {:href &quot;/_/_/users/U3H4PBCLE&quot;}] Have you tried using https://ring-clojure.github.io/ring/ring.util.response.html#var-file-response instead of constructing the response yourself?"><y>#</y><d>2018-06-19</d><h>17:34</h><w>seancorfield</w><a>@petr.mensik</a> Have you tried using <a href="https://ring-clojure.github.io/ring/ring.util.response.html#var-file-response" target="_blank">https://ring-clojure.github.io/ring/ring.util.response.html#var-file-response</a> instead of constructing the response yourself?</z><z id="t1529509197" t="petr.mensik [:attrs {:href &quot;/_/_/users/U04V70XH6&quot;}] Result is actually the same - however I&apos;ve noticed that the file itself has 17 KB but the one returned by Ring has 28 KB (and at the same time LibreOffice is complaining about downloaded file being corrupted)"><y>#</y><d>2018-06-20</d><h>15:39</h><w>petr.mensik</w><a>@seancorfield</a> Result is actually the same - however I&apos;ve noticed that the file itself has 17 KB but the one returned by Ring has 28 KB (and at the same time LibreOffice is complaining about downloaded file being corrupted)</z><z id="t1529509506" t="seancorfield Hmm, we serve images via Ring&apos;s file-response with content-type applied to it. Are you sure none of your middleware is messing with the response? Have you tried examining the response headers either in the browser devtools or via curl -I [:attrs {:href &quot;/_/_/users/U3H4PBCLE&quot;}] ?"><y>#</y><d>2018-06-20</d><h>15:45</h><w>seancorfield</w>Hmm, we serve images via Ring&apos;s <code>file-response</code> with <code>content-type</code> applied to it. Are you sure none of your middleware is messing with the response? Have you tried examining the response headers either in the browser devtools or via <code>curl -I</code> <a>@petr.mensik</a>?</z><z id="t1529509702" t="petr.mensik These headers are being returned { &quot;cache-control&quot;: &quot;no-cache, must-revalidate, proxy-revalidate&quot;, &quot;content-disposition&quot;: &quot;attachment; filename=supply.xlsx&quot;, &quot;content-length&quot;: &quot;16584&quot;, &quot;content-type&quot;: &quot;application/vnd.openxmlformats-officedocument.spreadsheetml.sheet&quot;, &quot;date&quot;: &quot;Wed, 20 Jun 2018 15:46:59 GMT&quot;, &quot;last-modified&quot;: &quot;Wed, 20 Jun 2018 15:46:59 GMT&quot;, &quot;server&quot;: &quot;http-kit&quot;, &quot;x-content-type-options&quot;: &quot;nosniff&quot;, &quot;x-frame-options&quot;: &quot;DENY&quot;, &quot;x-xss-protection&quot;: &quot;1; mode=block&quot; } "><y>#</y><d>2018-06-20</d><h>15:48</h><w>petr.mensik</w>These headers are being returned 
<pre>{
  &quot;cache-control&quot;: &quot;no-cache, must-revalidate, proxy-revalidate&quot;,
  &quot;content-disposition&quot;: &quot;attachment; filename=supply.xlsx&quot;,
  &quot;content-length&quot;: &quot;16584&quot;,
  &quot;content-type&quot;: &quot;application/vnd.openxmlformats-officedocument.spreadsheetml.sheet&quot;,
  &quot;date&quot;: &quot;Wed, 20 Jun 2018 15:46:59 GMT&quot;,
  &quot;last-modified&quot;: &quot;Wed, 20 Jun 2018 15:46:59 GMT&quot;,
  &quot;server&quot;: &quot;http-kit&quot;,
  &quot;x-content-type-options&quot;: &quot;nosniff&quot;,
  &quot;x-frame-options&quot;: &quot;DENY&quot;,
  &quot;x-xss-protection&quot;: &quot;1; mode=block&quot;
}
</pre></z><z id="t1529509727" t="petr.mensik I&apos;ll try to disable some middleware and see if ti changes anything"><y>#</y><d>2018-06-20</d><h>15:48</h><w>petr.mensik</w>I&apos;ll try to disable some middleware and see if ti changes anything</z><z id="t1529509888" t="seancorfield Those headers look reasonable -- and the Content-Length looks close to your expected 17K."><y>#</y><d>2018-06-20</d><h>15:51</h><w>seancorfield</w>Those headers look reasonable -- and the Content-Length looks close to your expected 17K.</z><z id="t1529510200" t="petr.mensik hmm, weird, it&apos;s probably Swagger issue because I can download the file with curl"><y>#</y><d>2018-06-20</d><h>15:56</h><w>petr.mensik</w>hmm, weird, it&apos;s probably Swagger issue because I can download the file with curl</z><z id="t1529510207" t="petr.mensik so I guess it&apos;s fine - thanks you üôÇ"><y>#</y><d>2018-06-20</d><h>15:56</h><w>petr.mensik</w>so I guess it&apos;s fine - thanks you <b>üôÇ</b></z><z id="t1529510242" t="seancorfield Cool. File downloads (and uploads) always seem to be the most problematic aspects of dealing with Ring üôÇ"><y>#</y><d>2018-06-20</d><h>15:57</h><w>seancorfield</w>Cool. File downloads (and uploads) always seem to be the most problematic aspects of dealing with Ring <b>üôÇ</b></z><z id="t1529945735" t="sova-soars-the-sora Hi, i&apos;m wondering about uploading files via html form and /post..."><y>#</y><d>2018-06-25</d><h>16:55</h><w>sova-soars-the-sora</w>Hi, i&apos;m wondering about uploading files via html form and /post...</z><z id="t1529945780" t="sova-soars-the-sora I&apos;m not really sure how it&apos;s supposed to work. does an upload action put a file at a :tempfile &quot;/path/&quot; that I can then reference with java.io.copy to store locally?"><y>#</y><d>2018-06-25</d><h>16:56</h><w>sova-soars-the-sora</w>I&apos;m not really sure how it&apos;s supposed to work.  does an upload action put a file at a :tempfile &quot;/path/&quot; that I can then reference with java.io.copy to store locally?</z><z id="t1530171963" t="jumar We use sth. like this: (mp/wrap-multipart-params (POST &quot;/teams/import&quot; {{{tempfile :tempfile filename :filename} :importteamsfile} :params :as params} (friend/authorize #{roles/project-configuration} (import-developer-teams project-id tempfile filename)))) mp is ring.middleware.multipart-params"><y>#</y><d>2018-06-28</d><h>07:46</h><r>jumar</r>We use sth. like this: 
<pre>(mp/wrap-multipart-params
         (POST &quot;/teams/import&quot; {{{tempfile :tempfile filename :filename} :importteamsfile} :params :as params}
           (friend/authorize #{roles/project-configuration} (import-developer-teams project-id tempfile filename))))
</pre>
<code>mp</code> is <code>ring.middleware.multipart-params</code></z><z id="t1529945794" t="sova-soars-the-sora i keep getting null pointer exceptions it&apos;s difficult to debug."><y>#</y><d>2018-06-25</d><h>16:56</h><w>sova-soars-the-sora</w>i keep getting null pointer exceptions it&apos;s difficult to debug.</z><z id="t1529946063" t="sova-soars-the-sora is there a reason {:enctype &quot;multipart/formdata&quot;} doesn&apos;t want to play nicely?"><y>#</y><d>2018-06-25</d><h>17:01</h><w>sova-soars-the-sora</w>is there a reason <code> {:enctype &quot;multipart/formdata&quot;} </code> doesn&apos;t want to play nicely?</z><z id="t1530849393" t="Yehonathan Sharvit Is Ring written natively in Clojure or does it run on top of a Java web server framework?"><y>#</y><d>2018-07-06</d><h>03:56</h><w>Yehonathan Sharvit</w>Is Ring written natively in Clojure or does it run on top of a Java web server framework?</z><z id="t1530859757" t="mpenet ring is a unified clj format to talk to http libs from clojure. It can &quot;run&quot; with various adapters (jetty, undertow, netty etc), but yes the adapters are usually thin wrappers to java libs."><y>#</y><d>2018-07-06</d><h>06:49</h><w>mpenet</w>ring is a unified clj format to talk to http libs from clojure. It can &quot;run&quot; with various adapters (jetty, undertow, netty etc), but yes the adapters are usually thin wrappers to java libs.</z><z id="t1530859875" t="mpenet Aleph is arguably the one that has the most lower level bits written in clojure (I think), but it relies heavily on netty."><y>#</y><d>2018-07-06</d><h>06:51</h><w>mpenet</w>Aleph is arguably the one that has the most lower level bits written in clojure (I think), but it relies heavily on netty.</z><z id="t1531235708" t="Charleshd Hi, I&apos;m having a strange behavior with ring.anti-forgery. I&apos;m doing an ajax POST request and it keeps telling me the X-CSRF token is invalid. I just setuped a project with luminus template, in my request headers I have the correct x-csrf header with the correct token. Any ideas ?"><y>#</y><d>2018-07-10</d><h>15:15</h><w>Charleshd</w>Hi, I&apos;m having a strange behavior with ring.anti-forgery. I&apos;m doing an ajax POST request and it keeps telling me the X-CSRF token is invalid. I just setuped a project with luminus template, in my request headers I have the correct x-csrf header with the correct token. Any ideas ?</z><z id="t1531236789" t="Charleshd OK the problem is when i use http-kit instead of immutant. Maybe I&apos;ll talk about that in luminus section"><y>#</y><d>2018-07-10</d><h>15:33</h><w>Charleshd</w>OK the problem is when i use http-kit instead of immutant. Maybe I&apos;ll talk about that in luminus section</z><z id="t1531322141" t="manas_marthi hi basic question, how can I add dependencies to my project.clj and get it hot reloaded into running ring server?"><y>#</y><d>2018-07-11</d><h>15:15</h><w>manas_marthi</w>hi basic question, how can I add dependencies to my project.clj and get it hot reloaded into running ring server?</z><z id="t1531322186" t="manas_marthi I saw one API called alembic. I want to know if this is a common practice in the community"><y>#</y><d>2018-07-11</d><h>15:16</h><w>manas_marthi</w>I saw one API called alembic. I want to know if this is a common practice in the community</z><z id="t1531339568" t="weavejester Hot reloading is possible, but you need to have the dependencies in place to do it, and generally speaking it‚Äôs more reliable to use a load balancer that can restart its servers one at a time and avoid downtime."><y>#</y><d>2018-07-11</d><h>20:06</h><w>weavejester</w>Hot reloading is possible, but you need to have the dependencies in place to do it, and generally speaking it‚Äôs more reliable to use a load balancer that can restart its servers one at a time and avoid downtime.</z><z id="t1531344391" t="manas_marthi [:attrs {:href &quot;/_/_/users/U0BKWMG5B&quot;}] I am looking for hot reloading of updates to dependencies during development on my laptop"><y>#</y><d>2018-07-11</d><h>21:26</h><w>manas_marthi</w><a>@weavejester</a>  I am looking for hot reloading of updates to dependencies during development on my laptop</z><z id="t1531348212" t="weavejester [:attrs {:href &quot;/_/_/users/U7ANZ2MTK&quot;}] I‚Äôve seen https://github.com/cemerick/pomegranate used for that purpose"><y>#</y><d>2018-07-11</d><h>22:30</h><w>weavejester</w><a>@manas.marthi</a> I‚Äôve seen <a href="https://github.com/cemerick/pomegranate" target="_blank">https://github.com/cemerick/pomegranate</a> used for that purpose</z><z id="t1531377734" t="vxe If you use emacs there is this: https://github.com/clojure-emacs/clj-refactor.el/wiki/cljr-add-project-dependency , which not only does what pomegranate does, but also updates your project.clj. It is currently broken but a fix is to be released in the coming week(s)"><y>#</y><d>2018-07-12</d><h>06:42</h><w>vxe</w>If you use emacs there is this: <a href="https://github.com/clojure-emacs/clj-refactor.el/wiki/cljr-add-project-dependency" target="_blank">https://github.com/clojure-emacs/clj-refactor.el/wiki/cljr-add-project-dependency</a> , which not only does what pomegranate does, but also updates your project.clj.   It is currently broken but a fix is to be released in the coming week(s)</z><z id="t1531385599" t="manas_marthi Yes, i tried this in spacemacs, i got json parsing error.."><y>#</y><d>2018-07-12</d><h>08:53</h><r>manas_marthi</r>Yes, i tried this in spacemacs,  i got json parsing error..</z><z id="t1531385629" t="manas_marthi It tried to fetch list of repos and broke with parsing exception"><y>#</y><d>2018-07-12</d><h>08:53</h><r>manas_marthi</r>It tried to fetch list of repos and broke with parsing exception</z><z id="t1531751336" t="jumar [:attrs {:href &quot;/_/_/users/U7ANZ2MTK&quot;}] this was a known issue - not sure if it&apos;s properly solved or not: https://github.com/clojure-emacs/refactor-nrepl/issues/226"><y>#</y><d>2018-07-16</d><h>14:28</h><r>jumar</r><a>@U7ANZ2MTK</a> this was a known issue - not sure if it&apos;s properly solved or not: <a href="https://github.com/clojure-emacs/refactor-nrepl/issues/226" target="_blank">https://github.com/clojure-emacs/refactor-nrepl/issues/226</a></z><z id="t1531752064" t="manas_marthi [:attrs {:href &quot;/_/_/users/U06BE1L6T&quot;}] thank you. [:attrs {:href &quot;/_/_/users/U7QP6QHEW&quot;}] fyi."><y>#</y><d>2018-07-16</d><h>14:41</h><r>manas_marthi</r><a>@U06BE1L6T</a> thank you. <a>@U7QP6QHEW</a> fyi.</z><z id="t1531752118" t="manas_marthi I looked up the github repo of refactor-nrepl . the fix was merged"><y>#</y><d>2018-07-16</d><h>14:41</h><r>manas_marthi</r>I looked up the github repo of refactor-nrepl . the fix was merged</z><z id="t1531517484" t="Andy qq: what is the best way in ring/compojure to define something like https://expressjs.com/en/api.html#req.baseUrl ?"><y>#</y><d>2018-07-13</d><h>21:31</h><w>Andy</w>qq: what is the best way in ring/compojure to define something like <a href="https://expressjs.com/en/api.html#req.baseUrl" target="_blank">https://expressjs.com/en/api.html#req.baseUrl</a> ?</z><z id="t1531517551" t="Andy I mean I would like to be able to easily define the base URL for my service without touching the routing code"><y>#</y><d>2018-07-13</d><h>21:32</h><w>Andy</w>I mean I would like to be able to easily define the base URL for my service without touching the routing code</z><z id="t1531870600" t="mikerod [:attrs {:href &quot;/_/_/users/U1LJAM1U7&quot;}] if you know the base before compiling (can store in var prior to route definitions), you should be able to refer to the var via compojure.core/context when defining routes (if I understand you correctly)"><y>#</y><d>2018-07-17</d><h>23:36</h><w>mikerod</w><a>@happy.lisper</a> if you know the base before compiling (can store in var prior to route definitions), you should be able to refer to the var via <code>compojure.core/context</code> when defining routes (if I understand you correctly)</z><z id="t1531975691" t="Andy thx. just wanted to check if there is another construct or standard solution. context should work for me and in fact it is dynamic enough I can pass the mountpath from configuration to runtime."><y>#</y><d>2018-07-19</d><h>04:48</h><r>Andy</r>thx.  just wanted to check if there is another construct or standard solution. <code>context</code> should work for me and in fact it is dynamic enough I can pass the mountpath from configuration to runtime.</z><z id="t1531870629" t="mikerod if things have to be more dynamic than that, you could try just doing something similar to what these macros are doing (the fn‚Äôs they are using) to do things at later runtime"><y>#</y><d>2018-07-17</d><h>23:37</h><w>mikerod</w>if things have to be more dynamic than that, you could try just doing something similar to what these macros are doing (the fn‚Äôs they are using) to do things at later runtime</z><z id="t1532088752" t="Hukka Is there a way to use Filter&apos;s with jetty and ring-adapter-jetty?"><y>#</y><d>2018-07-20</d><h>12:12</h><w>Hukka</w>Is there a way to use Filter&apos;s with jetty and ring-adapter-jetty?</z><z id="t1532088776" t="Hukka More concretely, https://www.eclipse.org/jetty/documentation/9.3.x/http2-configuring-push.html"><y>#</y><d>2018-07-20</d><h>12:12</h><r>Hukka</r>More concretely, <a href="https://www.eclipse.org/jetty/documentation/9.3.x/http2-configuring-push.html" target="_blank">https://www.eclipse.org/jetty/documentation/9.3.x/http2-configuring-push.html</a></z><z id="t1532091109" t="Hukka Bah. Never mind. I just realised that http1.1 is still being used, and can&apos;t get either chrome or curl to switch to http/2 with my jetty"><y>#</y><d>2018-07-20</d><h>12:51</h><r>Hukka</r>Bah. Never mind. I just realised that http1.1 is still being used, and can&apos;t get either chrome or curl to switch to http/2 with my jetty</z><z id="t1532455491" t="David Reno beginner Clojurist with compojure-api questions‚Ä¶ I‚Äôd like to start development of an API but would like to use spec. Does this imply that I should be using compojure-api 2.0? Thinking that i can‚Äôt simply use 1.1.12 and add clojure.spec.alpha and expect the swagger part to display models."><y>#</y><d>2018-07-24</d><h>18:04</h><w>David Reno</w>beginner Clojurist with compojure-api questions‚Ä¶
I‚Äôd like to start development of an API but would like to use spec. Does this imply that I should be using compojure-api 2.0? Thinking that i can‚Äôt simply use 1.1.12 and add <code>clojure.spec.alpha</code> and expect the swagger part to display models.</z><z id="t1532505537" t="ikitommi [:attrs {:href &quot;/_/_/users/UBMFBEWKY&quot;}] for spec, you need the 2.0 alpha. It‚Äôs alpha mostly because spec is too‚Ä¶"><y>#</y><d>2018-07-25</d><h>07:58</h><w>ikitommi</w><a>@dcreno</a> for spec, you need the 2.0 alpha. It‚Äôs alpha mostly because spec is too‚Ä¶</z><z id="t1532532007" t="David Reno I‚Äôm looking for a hello-world type compojure-api 2.0 example to start from. Can‚Äôt find it anywhere, only this which isn‚Äôt super helpful at my level: https://github.com/metosin/compojure-api/wiki/Migration-Guide-to-2.0.0 Any suggestions?"><y>#</y><d>2018-07-25</d><h>15:20</h><r>David Reno</r>I‚Äôm looking for a hello-world type compojure-api 2.0 example to start from. Can‚Äôt find it anywhere, only this which isn‚Äôt super helpful at my level: <a href="https://github.com/metosin/compojure-api/wiki/Migration-Guide-to-2.0.0" target="_blank">https://github.com/metosin/compojure-api/wiki/Migration-Guide-to-2.0.0</a>

Any suggestions?</z><z id="t1532533397" t="ikitommi [:attrs {:href &quot;/_/_/users/UBMFBEWKY&quot;}] maybe https://github.com/jarcane/clojurice (it&apos;s 1.x, mut the syntax is the same) or https://github.com/yogthos/memory-hole (1.x too)"><y>#</y><d>2018-07-25</d><h>15:43</h><r>ikitommi</r><a>@dcreno</a> maybe <a href="https://github.com/jarcane/clojurice" target="_blank">https://github.com/jarcane/clojurice</a> (it&apos;s 1.x, mut the syntax is the same) or <a href="https://github.com/yogthos/memory-hole" target="_blank">https://github.com/yogthos/memory-hole</a> (1.x too)</z><z id="t1532533545" t="David Reno I should describe what I‚Äôm trying to do a little better‚Ä¶ I understand and can use compojure-api but would like to start with spec instead of schema. I‚Äôm just intending to write an API service with integrated swagger docs."><y>#</y><d>2018-07-25</d><h>15:45</h><r>David Reno</r>I should describe what I‚Äôm trying to do a little better‚Ä¶
I understand and can use compojure-api but would like to start with spec instead of schema. I‚Äôm just intending to write an API service with integrated swagger docs.</z><z id="t1532534556" t="ikitommi ok, there is a minimalistic sample at https://github.com/metosin/c2"><y>#</y><d>2018-07-25</d><h>16:02</h><r>ikitommi</r>ok, there is a minimalistic sample at <a href="https://github.com/metosin/c2" target="_blank">https://github.com/metosin/c2</a></z><z id="t1532535299" t="ikitommi [:attrs {:href &quot;/_/_/users/UBMFBEWKY&quot;}] there is also the reitit -library, that has spec &amp; swagger. Like c-api, but fully data-driven. Disclaimer: I&apos;m part of dev team for both libs. Example app here: https://github.com/metosin/reitit/tree/master/examples/ring-swagger"><y>#</y><d>2018-07-25</d><h>16:14</h><r>ikitommi</r><a>@dcreno</a> there is also the reitit -library, that has spec &amp; swagger. Like c-api, but fully data-driven. Disclaimer: I&apos;m part of dev team for both libs. Example app here: <a href="https://github.com/metosin/reitit/tree/master/examples/ring-swagger" target="_blank">https://github.com/metosin/reitit/tree/master/examples/ring-swagger</a></z><z id="t1532536959" t="David Reno that c2 example is great. Any guidance on which to choose, compjure-api vs reitit? I want spec, swagger, an API that I can do async functions in when necessary, but generally low performance requirements (1000 requests/day)."><y>#</y><d>2018-07-25</d><h>16:42</h><r>David Reno</r>that c2 example is great. Any guidance on which to choose, compjure-api vs reitit? I want spec, swagger, an API that I can do async functions in when necessary, but generally low performance requirements (1000 requests/day).</z><z id="t1532540228" t="ikitommi c-api is more proven, I might go with that. I think reitit is the future &amp; with much better docs, but not all the batteries are there yet. Clojure Spec is still in alpha, and most likely will break the current contracts before finalizing. We try to keep the libs up with spec changes, but just remember it&apos;s alpha. Schema-support has been stable for years."><y>#</y><d>2018-07-25</d><h>17:37</h><r>ikitommi</r>c-api is more proven, I might go with that. I think reitit is the future &amp; with much better docs, but not all the batteries are there yet. Clojure Spec is still in alpha, and most likely will break the current contracts before finalizing. We try to keep the libs up with spec changes, but just remember it&apos;s alpha. Schema-support has been stable for years.</z><z id="t1532527741" t="henrik I‚Äôm encountering java.lang.NoClassDefFoundError: javax/servlet/http/HttpServletRequest, compiling:(ring/middleware/multipart_params.clj:54:20) ` With any of the 4 latest versions of ring. Any ideas on how I can debug this one?"><y>#</y><d>2018-07-25</d><h>14:09</h><w>henrik</w>I‚Äôm encountering 

<pre>java.lang.NoClassDefFoundError: javax/servlet/http/HttpServletRequest, compiling:(ring/middleware/multipart_params.clj:54:20)</pre>`


With any of the 4 latest versions of ring. Any ideas on how I can debug this one?</z><z id="t1532533597" t="ikitommi [:attrs {:href &quot;/_/_/users/U06B8J0AJ&quot;}] see https://github.com/ring-clojure/ring/issues/251"><y>#</y><d>2018-07-25</d><h>15:46</h><w>ikitommi</w><a>@henrik</a> see <a href="https://github.com/ring-clojure/ring/issues/251" target="_blank">https://github.com/ring-clojure/ring/issues/251</a></z><z id="t1532534337" t="henrik [:attrs {:href &quot;/_/_/users/U055NJ5CC&quot;}] I see, thank you. So the solution for the moment is for me to manually add the dep?"><y>#</y><d>2018-07-25</d><h>15:58</h><w>henrik</w><a>@ikitommi</a> I see, thank you. So the solution for the moment is for me to manually add the dep?</z><z id="t1532534488" t="ikitommi yes"><y>#</y><d>2018-07-25</d><h>16:01</h><w>ikitommi</w>yes</z><z id="t1532535299" t="ikitommi [:attrs {:href &quot;/_/_/users/UBMFBEWKY&quot;}] there is also the reitit -library, that has spec &amp; swagger. Like c-api, but fully data-driven. Disclaimer: I&apos;m part of dev team for both libs. Example app here: https://github.com/metosin/reitit/tree/master/examples/ring-swagger"><y>#</y><d>2018-07-25</d><h>16:14</h><w>ikitommi</w><a>@dcreno</a> there is also the reitit -library, that has spec &amp; swagger. Like c-api, but fully data-driven. Disclaimer: I&apos;m part of dev team for both libs. Example app here: <a href="https://github.com/metosin/reitit/tree/master/examples/ring-swagger" target="_blank">https://github.com/metosin/reitit/tree/master/examples/ring-swagger</a></z><z id="t1532641604" t="chadhs I‚Äôm having a hard time wrapping my head around how to update :session data for handling logins. I actually have working code for user registration and user login that works properly but i feel like any example or docs i‚Äôm looking up jump from step 1 to step 3 or 4."><y>#</y><d>2018-07-26</d><h>21:46</h><w>chadhs</w>I‚Äôm having a hard time wrapping my head around how to update :session data for handling logins.
I actually have working code for user registration and user login that works properly but i feel like any example or docs i‚Äôm looking up jump from step 1 to step 3 or 4.</z><z id="t1532641814" t="chadhs for example in this code: https://gist.github.com/chadhs/8798193e3b70b1c08c2427ad59f04f94 i‚Äôd love to insert the account-id into the :session :identity key and use that as a basis for access and queries"><y>#</y><d>2018-07-26</d><h>21:50</h><w>chadhs</w>for example in this code:
<a href="https://gist.github.com/chadhs/8798193e3b70b1c08c2427ad59f04f94" target="_blank">https://gist.github.com/chadhs/8798193e3b70b1c08c2427ad59f04f94</a>
i‚Äôd love to insert the <code>account-id</code> into the :session :identity key and use that as a basis for access and queries</z><z id="t1534040375" t="stardiviner #compojure"><y>#</y><d>2018-08-12</d><h>02:19</h><w>stardiviner</w>#compojure</z><z id="t1534969707" t="micahasmith anyone around to help me with diagnosing an issue with compojure-api"><y>#</y><d>2018-08-22</d><h>20:28</h><w>micahasmith</w>anyone around to help me with diagnosing an issue with compojure-api</z><z id="t1534971430" t="micahasmith https://github.com/metosin/compojure-api/issues/389"><y>#</y><d>2018-08-22</d><h>20:57</h><w>micahasmith</w><a href="https://github.com/metosin/compojure-api/issues/389" target="_blank">https://github.com/metosin/compojure-api/issues/389</a></z><z id="t1535210808" t="mping [:attrs {:href &quot;/_/_/users/U050M5F75&quot;}] maybe you have some middleware that doesn‚Äôt support async?"><y>#</y><d>2018-08-25</d><h>15:26</h><w>mping</w><a>@micahasmith</a> maybe you have some middleware that doesn‚Äôt support async?</z><z id="t1535210833" t="mping gooten_preview_api ?"><y>#</y><d>2018-08-25</d><h>15:27</h><w>mping</w><code>gooten_preview_api</code> ?</z><z id="t1535725048" t="dbernal has anyone ran into any issues when using lein ring and mount with swapped states? I&apos;m having difficulty using lein ring&apos;s reload features. Whenever a file is changed it runs that respective file&apos;s tests during reload, calls mounts swaps, and subsequently removes the original mounted state. Is there a way to avoid this?"><y>#</y><d>2018-08-31</d><h>14:17</h><w>dbernal</w>has anyone ran into any issues when using lein ring and mount with swapped states? I&apos;m having difficulty using lein ring&apos;s reload features. Whenever a file is changed it runs that respective file&apos;s tests during reload, calls mounts swaps, and subsequently removes the original mounted state. Is there a way to avoid this?</z><z id="t1535729563" t="seancorfield [:attrs {:href &quot;/_/_/users/U2JACTBMX&quot;}] That sounds like just a factor of how Mount works since it relies on global mutable state. It&apos;s why a lot of people prefer something like Component."><y>#</y><d>2018-08-31</d><h>15:32</h><w>seancorfield</w><a>@dbernal</a> That sounds like just a factor of how Mount works since it relies on global mutable state. It&apos;s why a lot of people prefer something like Component.</z><z id="t1535739769" t="Dormo Hello. I&apos;m trying to implement file upload with a progress reporter. I am using ring.middleware.multipart-params https://ring-clojure.github.io/ring/ring.middleware.multipart-params.html Before the upload actually starts transferring data, I need to do some other stuff, namely give the upload an identifier, save that to a database, and add the identifier to the request so it can be included with the progress events dispatched to clients I am able to write my own :store function, where I have access to the java.io.InputStream , but I do not have access to the request I am able to write my own :progress-fn where I have access to the request, but I do not know how to add an upload-id to the request before it gets there"><y>#</y><d>2018-08-31</d><h>18:22</h><w>Dormo</w>Hello. I&apos;m trying to implement file upload with a progress reporter. I am using <code>ring.middleware.multipart-params</code> <a href="https://ring-clojure.github.io/ring/ring.middleware.multipart-params.html" target="_blank">https://ring-clojure.github.io/ring/ring.middleware.multipart-params.html</a>

Before the upload actually starts transferring data, I need to do some other stuff, namely give the upload an identifier, save that to a database, and add the identifier to the request so it can be included with the progress events dispatched to clients

I am able to write my own <code>:store</code> function, where I have access to the <code>java.io.InputStream</code>, but I do not have access to the request
I am able to write my own <code>:progress-fn</code> where I have access to the request, but I do not know how to add an upload-id to the request before it gets there</z><z id="t1535740031" t="Dormo I mean, if I can just add some arbitrary data to the request before it hits :progress-fn , that should be enough"><y>#</y><d>2018-08-31</d><h>18:27</h><w>Dormo</w>I mean, if I can just add some arbitrary data to the request before it hits <code>:progress-fn</code>, that should be enough</z><z id="t1535747235" t="Dormo Before I wanted to add upload progress, I just made my route like this (POST &quot;/room/:room-id/upload&quot; req (upload/upload (add-upload-id req)))) and upload/upload would get the request and the uploaded file"><y>#</y><d>2018-08-31</d><h>20:27</h><w>Dormo</w>Before I wanted to add upload progress, I just made my route like this <code>(POST &quot;/room/:room-id/upload&quot; req (upload/upload (add-upload-id req))))</code> and <code>upload/upload</code> would get the request and the uploaded file</z><z id="t1535747247" t="Dormo but not until after the upload was complete"><y>#</y><d>2018-08-31</d><h>20:27</h><w>Dormo</w>but not until after the upload was complete</z><z id="t1535971647" t="ikitommi how is the backpressure handled with async-ring and let‚Äôs say jetty-adapter?"><y>#</y><d>2018-09-03</d><h>10:47</h><w>ikitommi</w>how is the backpressure handled with async-ring and let‚Äôs say jetty-adapter?</z><z id="t1536008981" t="weavejester It‚Äôs up to the adapter how its handled. For the Jetty adapter in particular, the best place to look for the details would be in Jetty‚Äôs official documentation."><y>#</y><d>2018-09-03</d><h>21:09</h><r>weavejester</r>It‚Äôs up to the adapter how its handled. For the Jetty adapter in particular, the best place to look for the details would be in Jetty‚Äôs official documentation.</z><z id="t1536065053" t="ikitommi thanks!"><y>#</y><d>2018-09-04</d><h>12:44</h><r>ikitommi</r>thanks!</z><z id="t1536346132" t="Christian Johansen If I run the ring jetty handler with {:async? true} must all handlers then have arity 3? I thought I could mix and match arity 1 and 3"><y>#</y><d>2018-09-07</d><h>18:48</h><w>Christian Johansen</w>If I run the ring jetty handler with <code>{:async? true}</code> must all handlers then have arity 3? I thought I could mix and match arity 1 and 3</z><z id="t1536533036" t="weavejester Yes, they must all support arity 3. It&apos;s not possible to go from blocking code to asynchronous code, so if you have an asynchronous adapter, all of your middleware and handlers need to be asynchronous as well."><y>#</y><d>2018-09-09</d><h>22:43</h><r>weavejester</r>Yes, they must all support arity 3. It&apos;s not possible to go from blocking code to asynchronous code, so if you have an asynchronous adapter, all of your middleware and handlers need to be asynchronous as well.</z><z id="t1536915167" t="grierson How do I log incoming request params so that I can debug why I am getting a nil response?"><y>#</y><d>2018-09-14</d><h>08:52</h><w>grierson</w>How do I log incoming request params so that I can debug why I am getting a nil response?</z><z id="t1536915718" t="grierson"><y>#</y><d>2018-09-14</d><h>09:01</h><w>grierson</w></z><z id="t1536916348" t="grierson"><y>#</y><d>2018-09-14</d><h>09:12</h><w>grierson</w></z><z id="t1536937438" t="seancorfield That says syntax error on line 32 of app.clj ... [:attrs {:href &quot;/_/_/users/U3G3MBL9H&quot;}] "><y>#</y><d>2018-09-14</d><h>15:03</h><w>seancorfield</w>That says syntax error on line 32 of <code>app.clj</code>... <a>@grierson</a> </z><z id="t1536937772" t="grierson [:attrs {:href &quot;/_/_/users/U04V70XH6&quot;}] I manged to work it out, it&apos;s because compojure was destructing request looking for a :request key causing nil to be passed into the handler. However being able to log the incoming request and params would of helped."><y>#</y><d>2018-09-14</d><h>15:09</h><w>grierson</w><a>@seancorfield</a> I manged to work it out, it&apos;s because compojure was destructing <code>request</code> looking for a <code>:request</code> key causing nil to be passed into the handler. However being able to log the incoming request and params would of helped.</z><z id="t1536937944" t="borkdude I‚Äôm not sure lib-noir should still be used, but there was a question asked on SO: https://stackoverflow.com/questions/52334131/why-is-username-not-saved-in-noir-session-in-clojure-project Maybe someone can recommend a better current day approach"><y>#</y><d>2018-09-14</d><h>15:12</h><w>borkdude</w>I‚Äôm not sure lib-noir should still be used, but there was a question asked on SO:
<a href="https://stackoverflow.com/questions/52334131/why-is-username-not-saved-in-noir-session-in-clojure-project" target="_blank">https://stackoverflow.com/questions/52334131/why-is-username-not-saved-in-noir-session-in-clojure-project</a>
Maybe someone can recommend a better current day approach</z><z id="t1536937956" t="borkdude Seems to me that lib-noir is very old and abandoned"><y>#</y><d>2018-09-14</d><h>15:12</h><w>borkdude</w>Seems to me that lib-noir is very old and abandoned</z><z id="t1536942142" t="dbernal is it possible to maintain order for a map in a response while utilizing the compojure api &quot;return&quot; parameter with a defined schema? I&apos;m running into an issue where I would like to validate the outgoing response but when I do this it re-orders it"><y>#</y><d>2018-09-14</d><h>16:22</h><w>dbernal</w>is it possible to maintain order for a map in a response while utilizing the compojure api &quot;return&quot; parameter with a defined schema? I&apos;m running into an issue where I would like to validate the outgoing response but when I do this it re-orders it</z><z id="t1536958749" t="borkdude [:attrs {:href &quot;/_/_/users/U2JACTBMX&quot;}] maps aren‚Äôt ordered collections"><y>#</y><d>2018-09-14</d><h>20:59</h><w>borkdude</w><a>@dbernal</a> maps aren‚Äôt ordered collections</z><z id="t1536958801" t="borkdude if you want to have a specific order, use a seq of tuples or a sorted-map"><y>#</y><d>2018-09-14</d><h>21:00</h><w>borkdude</w>if you want to have a specific order, use a seq of tuples or a sorted-map</z><z id="t1536966549" t="dbernal [:attrs {:href &quot;/_/_/users/U04V15CAJ&quot;}] I have a sorted map but the problem I&apos;m having right now is that when I coerce a response value through compojure api it seems to re-order my map and I haven&apos;t been able to get around that. When I take off the coercion it maintains the order"><y>#</y><d>2018-09-14</d><h>23:09</h><w>dbernal</w><a>@borkdude</a> I have a sorted map but the problem I&apos;m having right now is that when I coerce a response value through compojure api it seems to re-order my map and I haven&apos;t been able to get around that. When I take off the coercion it maintains the order</z><z id="t1536994594" t="aaron51 I‚Äôm trying to avoid restarting the server on changes. How do I use wrap-reload and mount together? wrap-reload takes the var of a handler, which means it has to be a def , so the handler can‚Äôt use a defstate (it‚Äôs not started yet) Here‚Äôs an example - https://gist.github.com/apeckham/d30169162d96cb2c42722743f1fdcd6e Can anyone point me in the right direction?"><y>#</y><d>2018-09-15</d><h>06:56</h><w>aaron51</w>I‚Äôm trying to avoid restarting the server on changes. How do I use <code>wrap-reload</code> and <code>mount</code> together?

<code>wrap-reload</code> takes the var of a handler, which means it has to be a <code>def</code>, so the handler can‚Äôt use a <code>defstate</code> (it‚Äôs not started yet)

Here‚Äôs an example - <a href="https://gist.github.com/apeckham/d30169162d96cb2c42722743f1fdcd6e" target="_blank">https://gist.github.com/apeckham/d30169162d96cb2c42722743f1fdcd6e</a>

Can anyone point me in the right direction?</z><z id="t1537030816" t="seancorfield #mount might be a good place to ask, if you haven&apos;t already [:attrs {:href &quot;/_/_/users/U3JH0P5LJ&quot;}] "><y>#</y><d>2018-09-15</d><h>17:00</h><w>seancorfield</w>#mount might be a good place to ask, if you haven&apos;t already <a>@aaron51</a> </z><z id="t1537422036" t="Andy Hi, In my use case, I need to have different middle-ware for specific routes. This is the code: (ns my-api.handler (:require [compojure.api.sweet :refer :all] [ring.util.http-response :refer :all])) (defn echo0[handler] (fn [request] (prn &quot;ECHO0&quot; #_request) (handler request) )) (defn echo1[handler] (fn [request] (prn &quot;ECHO1&quot; #_request) (handler request) )) (def app (api (middleware [echo0] (swagger-routes)) (context &quot;/api&quot; [] :middleware [echo1] (GET &quot;/test&quot; [] (ok &quot;1&quot;))))) However, when I run the code echo0 is invoked for /api/test as well. Is there is any way to make those completely separate?"><y>#</y><d>2018-09-20</d><h>05:40</h><w>Andy</w>Hi,
In my use case, I need to have different middle-ware for specific routes. This is the code:
<pre>(ns my-api.handler
  (:require [compojure.api.sweet :refer :all]
            [ring.util.http-response :refer :all]))

(defn echo0[handler]
  (fn [request]
    (prn &quot;ECHO0&quot; #_request)
    (handler request)
    ))

(defn echo1[handler]
  (fn [request]
    (prn &quot;ECHO1&quot; #_request)
    (handler request)
    ))

(def app
  (api
   (middleware [echo0] (swagger-routes))
   (context &quot;/api&quot; []
            :middleware [echo1]
            (GET &quot;/test&quot; [] (ok &quot;1&quot;)))))
</pre>

However, when I run the code <code>echo0</code> is invoked for <code>/api/test</code> as well. Is there is any way to make those completely separate?</z><z id="t1537456570" t="borkdude [:attrs {:href &quot;/_/_/users/U1LJAM1U7&quot;}] you might want to try the #ring-swagger channel, that‚Äôs where the Metosin guys hang out I think"><y>#</y><d>2018-09-20</d><h>15:16</h><w>borkdude</w><a>@happy.lisper</a> you might want to try the #ring-swagger channel, that‚Äôs where the Metosin guys hang out I think</z><z id="t1537456583" t="Andy ty"><y>#</y><d>2018-09-20</d><h>15:16</h><w>Andy</w>ty</z><z id="t1537477506" t="ikitommi [:attrs {:href &quot;/_/_/users/U1LJAM1U7&quot;}] if you want better control on when middleware is applied, there is also reitit-ring . More verbose syntax with no default middleware. It implements route-first architecture: the mw chain is only applied if there is a full route match. Your example would be:"><y>#</y><d>2018-09-20</d><h>21:05</h><w>ikitommi</w><a>@happy.lisper</a> if you want better control on when middleware is applied, there is also <code>reitit-ring</code>. More verbose syntax with no default middleware. It implements route-first architecture: the mw chain is only applied if there is a full route match. Your example would be:</z><z id="t1537574401" t="Andy Thx for this option, I will definitely consider it as well."><y>#</y><d>2018-09-22</d><h>00:00</h><r>Andy</r>Thx for this option, I will definitely consider it as well.</z><z id="t1537812779" t="ikitommi there is #reitit to get help if you want to try that"><y>#</y><d>2018-09-24</d><h>18:12</h><r>ikitommi</r>there is #reitit to get help if you want to try that</z><z id="t1537477516" t="ikitommi (require &apos;[reitit.ring :as ring]) (require &apos;[reitit.swagger :as swagger]) (require &apos;[reitit.swagger-ui :as swagger-ui]) (def app (ring/ring-handler (ring/router [[&quot;/swagger.json&quot; {:get {:no-doc true :middleware [echo0] :handler (swagger/create-swagger-handler)}}] [&quot;/api-docs/*&quot; {:no-doc true :middleware [echo0] :handler (swagger-ui/create-swagger-ui-handler)}] [&quot;/api&quot; {:middleware [echo1]} [&quot;/test&quot; {:get (fn [_] {:status 200, :body &quot;1&quot;})}]]]))) (app {:request-method :get, :uri &quot;/swagger.json&quot;}) (app {:request-method :get, :uri &quot;/api-docs/index.html&quot;}) (app {:request-method :get, :uri &quot;/api/test&quot;}) "><y>#</y><d>2018-09-20</d><h>21:05</h><w>ikitommi</w><pre>(require &apos;[reitit.ring :as ring])
(require &apos;[reitit.swagger :as swagger])
(require &apos;[reitit.swagger-ui :as swagger-ui])

(def app
  (ring/ring-handler
    (ring/router
      [[&quot;/swagger.json&quot;
        {:get {:no-doc true
               :middleware [echo0]
               :handler (swagger/create-swagger-handler)}}]

       [&quot;/api-docs/*&quot;
        {:no-doc true
         :middleware [echo0]
         :handler (swagger-ui/create-swagger-ui-handler)}]

       [&quot;/api&quot;
        {:middleware [echo1]}

        [&quot;/test&quot;
         {:get (fn [_]
                 {:status 200, :body &quot;1&quot;})}]]])))

(app {:request-method :get, :uri &quot;/swagger.json&quot;})
(app {:request-method :get, :uri &quot;/api-docs/index.html&quot;})
(app {:request-method :get, :uri &quot;/api/test&quot;})
</pre></z><z id="t1537477645" t="ikitommi ‚Ä¶ but you would need to add coercion, formatting etc. mw yourself. there are examples for it, but no things like api from compojure-api."><y>#</y><d>2018-09-20</d><h>21:07</h><w>ikitommi</w>‚Ä¶ but you would need to add coercion, formatting etc. mw yourself. there are examples for it, but no things like <code>api</code> from compojure-api.</z><z id="t1538143752" t="bringe I am trying to achieve a similar goal to the above user, with just compojure and ring. I&apos;m wondering why this code does not only run the verify-token middleware for the GET request, but also runs it for the POST request, even though I specified the middleware just for the GET."><y>#</y><d>2018-09-28</d><h>14:09</h><w>bringe</w>I am trying to achieve a similar goal to the above user, with just compojure and ring. I&apos;m wondering why this code does not only run the <code>verify-token</code> middleware for the GET request, but also runs it for the POST request, even though I specified the middleware just for the GET.</z><z id="t1538144166" t="bringe Or should I be implementing per-route logic differently?"><y>#</y><d>2018-09-28</d><h>14:16</h><w>bringe</w>Or should I be implementing per-route logic differently?</z><z id="t1538148055" t="ikitommi [:attrs {:href &quot;/_/_/users/U9A1RLFNV&quot;}] with normal compojure, you can use wrap-routes . Just don&apos;t use nginx-clojure with it ( https://github.com/nginx-clojure/nginx-clojure/issues/182 ) "><y>#</y><d>2018-09-28</d><h>15:20</h><w>ikitommi</w><a>@brandon.ringe</a> with normal compojure, you can use <code>wrap-routes</code>. Just don&apos;t use nginx-clojure with it (<a href="https://github.com/nginx-clojure/nginx-clojure/issues/182" target="_blank">https://github.com/nginx-clojure/nginx-clojure/issues/182</a>) </z><z id="t1538148198" t="bringe Thanks [:attrs {:href &quot;/_/_/users/U055NJ5CC&quot;}]"><y>#</y><d>2018-09-28</d><h>15:23</h><w>bringe</w>Thanks <a>@ikitommi</a></z><z id="t1542485123" t="abdullahibra hello guys"><y>#</y><d>2018-11-17</d><h>20:05</h><w>abdullahibra</w>hello guys</z><z id="t1542485152" t="abdullahibra how can i destructing route &quot;/users/:id&quot; [id] how can i include full request too ?"><y>#</y><d>2018-11-17</d><h>20:05</h><w>abdullahibra</w>how can i destructing route &quot;/users/:id&quot; [id] how can i include full request too ?</z><z id="t1542495498" t="seancorfield [:attrs {:href &quot;/_/_/users/U145X0BPE&quot;}] I&apos;m not I understand what you&apos;re asking there. What do mean by &quot;include full request&quot; in that context?"><y>#</y><d>2018-11-17</d><h>22:58</h><w>seancorfield</w><a>@abdullahibra</a> I&apos;m not I understand what you&apos;re asking there. What do mean by &quot;include full request&quot; in that context?</z><z id="t1542495587" t="seancorfield If you have (GET &quot;/users/:id&quot; [id] handler-fn) then the handler function is still passed the whole Ring request."><y>#</y><d>2018-11-17</d><h>22:59</h><w>seancorfield</w>If you have <code>(GET &quot;/users/:id&quot; [id] handler-fn)</code> then the handler function is still passed the whole Ring request.</z><z id="t1542495996" t="abdullahibra [id :as request] ?"><y>#</y><d>2018-11-17</d><h>23:06</h><w>abdullahibra</w>[id :as request] ?</z><z id="t1542496125" t="seancorfield (defn handler-fn [req] ...)"><y>#</y><d>2018-11-17</d><h>23:08</h><w>seancorfield</w><code>(defn handler-fn [req] ...)</code></z><z id="t1542496135" t="seancorfield It will be passed the Ring request hash map."><y>#</y><d>2018-11-17</d><h>23:08</h><w>seancorfield</w>It will be passed the Ring request hash map.</z><z id="t1542496237" t="seancorfield (you don&apos;t actually need id in the route parameters, as I recall, so (GET &quot;/users/:id&quot; [] handler-fn) would also work -- but I tend to list them there for clarity of intent)"><y>#</y><d>2018-11-17</d><h>23:10</h><w>seancorfield</w>(you don&apos;t actually need <code>id</code> in the route parameters, as I recall, so <code>(GET &quot;/users/:id&quot; [] handler-fn)</code> would also work -- but I tend to list them there for clarity of intent)</z><z id="t1543296175" t="valerauko hi"><y>#</y><d>2018-11-27</d><h>05:22</h><w>valerauko</w>hi</z><z id="t1543296188" t="valerauko i&apos;ve got this really weird problem with sessions using default-middleware"><y>#</y><d>2018-11-27</d><h>05:23</h><w>valerauko</w>i&apos;ve got this really weird problem with sessions using default-middleware</z><z id="t1543296214" t="valerauko the session cookie is set correctly and is handled correctly as long as i keep reloading the same page"><y>#</y><d>2018-11-27</d><h>05:23</h><w>valerauko</w>the session cookie is set correctly and is handled correctly as long as i keep reloading the same page</z><z id="t1543296243" t="valerauko but as soon as i navigate to another path (still on localhost) the session contents are &quot;forgotten&quot; and a different session id is returned"><y>#</y><d>2018-11-27</d><h>05:24</h><w>valerauko</w>but as soon as i navigate to another path (still on localhost) the session contents are &quot;forgotten&quot; and a different session id is returned</z><z id="t1543296248" t="valerauko any idea what could be causing this?"><y>#</y><d>2018-11-27</d><h>05:24</h><w>valerauko</w>any idea what could be causing this?</z><z id="t1544141154" t="macrobartfast I found something odd or don&apos;t understand something... a repl started via lein repl in an untouched app created with &apos;lein new app &lt;appname&gt;&apos; and which includes the following dependencies auto-starts jetty as a process: (defproject autojetty &quot;0.1.0-SNAPSHOT&quot; :description &quot;FIXME: write description&quot; :url &quot; http://example.com/FIXME &quot; :license {:name &quot;Eclipse Public License&quot; :url &quot; https://www.eclipse.org/legal/epl-v10.html &quot;} :dependencies [[org.clojure/clojure &quot;-1.8.0&quot;] [ring/ring-defaults &quot;0.3.2&quot;] [ring/ring-jetty-adapter &quot;1.7.1&quot;]] :main ^:skip-aot autojetty.core :target-path &quot;target/%s&quot; :profiles {:uberjar {:aot :all}})"><y>#</y><d>2018-12-07</d><h>00:05</h><w>macrobartfast</w>I found something odd or don&apos;t understand something... a repl started via lein repl in an untouched app created with &apos;lein new app &lt;appname&gt;&apos; and which includes the following dependencies auto-starts jetty as a process:

(defproject autojetty &quot;0.1.0-SNAPSHOT&quot;
  :description &quot;FIXME: write description&quot;
  :url &quot;<a href="http://example.com/FIXME" target="_blank">http://example.com/FIXME</a>&quot;
  :license {:name &quot;Eclipse Public License&quot;
            :url &quot;<a href="https://www.eclipse.org/legal/epl-v10.html" target="_blank">https://www.eclipse.org/legal/epl-v10.html</a>&quot;}
  :dependencies [[org.clojure/clojure &quot;-1.8.0&quot;]
                 [ring/ring-defaults &quot;0.3.2&quot;]
                 [ring/ring-jetty-adapter &quot;1.7.1&quot;]]
  :main ^:skip-aot autojetty.core
  :target-path &quot;target/%s&quot;
  :profiles {:uberjar {:aot :all}})</z><z id="t1544141293" t="weavejester What&apos;s in autojetty.core ?"><y>#</y><d>2018-12-07</d><h>00:08</h><r>weavejester</r>What&apos;s in <code>autojetty.core</code>?</z><z id="t1544141391" t="macrobartfast (ns autojetty.core (:gen-class)) (defn -main &quot;I don&apos;t do a whole lot ... yet.&quot; [&amp; args] (println &quot;Hello, World!&quot;))"><y>#</y><d>2018-12-07</d><h>00:09</h><r>macrobartfast</r>(ns autojetty.core
  (:gen-class))

(defn -main
  &quot;I don&apos;t do a whole lot ... yet.&quot;
  [&amp; args]
  (println &quot;Hello, World!&quot;))</z><z id="t1544141479" t="weavejester There&apos;s nothing there that should start Jetty. Perhaps you have some sort of plugin starting it? How do you know Jetty has started?"><y>#</y><d>2018-12-07</d><h>00:11</h><r>weavejester</r>There&apos;s nothing there that should start Jetty. Perhaps you have some sort of plugin starting it? How do you know Jetty has started?</z><z id="t1544141482" t="macrobartfast I couldn&apos;t figure out why a jetty process was starting with every start of the app I am working on, so I started removing things one by one and ended up with those two deps and nothing else. I then created a new project, included them, and got the result."><y>#</y><d>2018-12-07</d><h>00:11</h><r>macrobartfast</r>I couldn&apos;t figure out why a jetty process was starting with every start of the app I am working on, so I started removing things one by one and ended up with those two deps and nothing else. I then created a new project, included them, and got the result.</z><z id="t1544141579" t="macrobartfast so, to reproduce: lein new app autojetty add [ring/ring-defaults &quot;0.3.2&quot;] and [ring/ring-jetty-adapter &quot;1.7.1&quot;] to the dependencies in project.clj, and then run &apos;lein repl&apos;; ps aux | grep jetty will show a new process; quitting the repl will stop that process."><y>#</y><d>2018-12-07</d><h>00:12</h><r>macrobartfast</r>so, to reproduce:
lein new app autojetty
add [ring/ring-defaults &quot;0.3.2&quot;] and [ring/ring-jetty-adapter &quot;1.7.1&quot;] to the dependencies in project.clj, and then run &apos;lein repl&apos;; ps aux | grep jetty will show a new process; quitting the repl will stop that process.</z><z id="t1544141770" t="seancorfield Are you sure that&apos;s not just the Java process that is running the REPL itself?"><y>#</y><d>2018-12-07</d><h>00:16</h><r>seancorfield</r>Are you sure that&apos;s not just the Java process that is running the REPL itself?</z><z id="t1544141783" t="seancorfield I do not see Jetty starting up with your code as-is."><y>#</y><d>2018-12-07</d><h>00:16</h><r>seancorfield</r>I do not see Jetty starting up with your code as-is.</z><z id="t1544141790" t="macrobartfast ok, stand by."><y>#</y><d>2018-12-07</d><h>00:16</h><r>macrobartfast</r>ok, stand by.</z><z id="t1544141826" t="weavejester I can&apos;t replicate it either. There is a process with &quot;jetty&quot; in the command, but that&apos;s because the dependency is on the classpath setup by Leiningen."><y>#</y><d>2018-12-07</d><h>00:17</h><r>weavejester</r>I can&apos;t replicate it either. There is a process with &quot;jetty&quot; in the command, but that&apos;s because the dependency is on the classpath setup by Leiningen.</z><z id="t1544141835" t="seancorfield ps aux | fgrep jetty shows me the Java processes that Leiningen starts -- as expected, because your project has autojetty in the name."><y>#</y><d>2018-12-07</d><h>00:17</h><r>seancorfield</r><code>ps aux | fgrep jetty</code> shows me the Java processes that Leiningen starts -- as expected, because your project has <code>autojetty</code> in the name.</z><z id="t1544141853" t="macrobartfast I suspect that&apos;s it. I&apos;m pretty embarrassed."><y>#</y><d>2018-12-07</d><h>00:17</h><r>macrobartfast</r>I suspect that&apos;s it. I&apos;m pretty embarrassed.</z><z id="t1544141857" t="seancorfield (and the classpath for that process also includes a JAR with jetty in the name)"><y>#</y><d>2018-12-07</d><h>00:17</h><r>seancorfield</r>(and the classpath for that process also includes a JAR with <code>jetty</code> in the name)</z><z id="t1544141884" t="weavejester It&apos;s an easy mistake to make if you&apos;re not familiar with Leiningen and Java classpaths."><y>#</y><d>2018-12-07</d><h>00:18</h><r>weavejester</r>It&apos;s an easy mistake to make if you&apos;re not familiar with Leiningen and Java classpaths.</z><z id="t1544141899" t="macrobartfast thank you for your understanding (and time!)."><y>#</y><d>2018-12-07</d><h>00:18</h><r>macrobartfast</r>thank you for your understanding (and time!).</z><z id="t1544631378" t="sova-soars-the-sora Hi, I&apos;m interested in adding fb/goog logins to my site, and i&apos;m looking at Oauth2 ... it looks like i can set the session token just with the help of redirects?"><y>#</y><d>2018-12-12</d><h>16:16</h><w>sova-soars-the-sora</w>Hi, I&apos;m interested in adding fb/goog logins to my site, and i&apos;m looking at Oauth2 ... it looks like i can set the session token just with the help of redirects?</z><z id="t1544811449" t="devth i have a local ring dev server that&apos;s serving up html. i want to support clean urls like: /foo instead of /foo.html . what part of ring do i need to hack on to do this? thanks"><y>#</y><d>2018-12-14</d><h>18:17</h><w>devth</w>i have a local ring dev server that&apos;s serving up html. i want to support clean urls like: <code>/foo</code> instead of <code>/foo.html</code>. what part of ring do i need to hack on to do this? thanks</z><z id="t1544813209" t="seancorfield Middleware. You could add middleware that looked at the incoming :uri and if it didn&apos;t end in .html , just add the extension."><y>#</y><d>2018-12-14</d><h>18:46</h><w>seancorfield</w>Middleware. You could add middleware that looked at the incoming <code>:uri</code> and if it didn&apos;t end in <code>.html</code>, just add the extension.</z><z id="t1544817907" t="devth thanks, will try that"><y>#</y><d>2018-12-14</d><h>20:05</h><r>devth</r>thanks, will try that</z><z id="t1545352073" t="sova-soars-the-sora Thanks again for Ring, [:attrs {:href &quot;/_/_/users/U0BKWMG5B&quot;}] ! makes my life a breeze"><y>#</y><d>2018-12-21</d><h>00:27</h><w>sova-soars-the-sora</w>Thanks again for Ring, <a>@weavejester</a> !  makes my life a breeze</z><z id="t1545352079" t="sova-soars-the-sora ^_^"><y>#</y><d>2018-12-21</d><h>00:27</h><w>sova-soars-the-sora</w>^_^</z><z id="t1545352091" t="weavejester You&apos;re welcome!"><y>#</y><d>2018-12-21</d><h>00:28</h><w>weavejester</w>You&apos;re welcome!</z><z id="t1546885728" t="dbernal anyone know if it&apos;s possible to version routes using ring and compojure?"><y>#</y><d>2019-01-07</d><h>18:28</h><w>dbernal</w>anyone know if it&apos;s possible to version routes using ring and compojure?</z><z id="t1546886048" t="seancorfield [:attrs {:href &quot;/_/_/users/U2JACTBMX&quot;}] Are you thinking about passing API version in query string / form data, rather than embed the version in the URI itself? (i.e., GET vs GET )"><y>#</y><d>2019-01-07</d><h>18:34</h><w>seancorfield</w><a>@dbernal</a> Are you thinking about passing API version in query string / form data, rather than embed the version in the URI itself? (i.e., <code>GET </code> vs <code>GET </code> )</z><z id="t1546886138" t="dbernal [:attrs {:href &quot;/_/_/users/U04V70XH6&quot;}] yes. As a header param"><y>#</y><d>2019-01-07</d><h>18:35</h><w>dbernal</w><a>@seancorfield</a> yes. As a header param</z><z id="t1546886484" t="seancorfield You&apos;d have to write some middleware for that, but it would be fairly straightforward."><y>#</y><d>2019-01-07</d><h>18:41</h><w>seancorfield</w>You&apos;d have to write some middleware for that, but it would be fairly straightforward.</z><z id="t1546886584" t="seancorfield If you had your Compojure routes set up grouped under &quot;/v1&quot; and &quot;/v2&quot; then you could have middleware that looked for the header and updated the :uri field in the Ring Request (before the Compojure middleware gets control)"><y>#</y><d>2019-01-07</d><h>18:43</h><w>seancorfield</w>If you had your Compojure routes set up grouped under <code>&quot;/v1&quot;</code> and <code>&quot;/v2&quot;</code> then you could have middleware that looked for the header and updated the <code>:uri</code> field in the Ring Request (before the Compojure middleware gets control)</z><z id="t1546886619" t="seancorfield Assuming your routes are different for the different versions..."><y>#</y><d>2019-01-07</d><h>18:43</h><w>seancorfield</w>Assuming your routes are different for the different versions...</z><z id="t1546887505" t="dbernal gotcha. So the only way to do it would be to have separate compojure routes?"><y>#</y><d>2019-01-07</d><h>18:58</h><r>dbernal</r>gotcha. So the only way to do it would be to have separate compojure routes?</z><z id="t1546889564" t="seancorfield If the routes for V1 and V2 are different, you still have to define both."><y>#</y><d>2019-01-07</d><h>19:32</h><r>seancorfield</r>If the routes for V1 and V2 are different, you still have to define both.</z><z id="t1546889616" t="seancorfield If the routes are identical for V1 and V2, then just check the version inside your handler(s)."><y>#</y><d>2019-01-07</d><h>19:33</h><r>seancorfield</r>If the routes are identical for V1 and V2, then just check the version inside your handler(s).</z><z id="t1546889651" t="seancorfield (I&apos;m puzzled by your response so perhaps I&apos;m misunderstanding your original question)"><y>#</y><d>2019-01-07</d><h>19:34</h><r>seancorfield</r>(I&apos;m puzzled by your response so perhaps I&apos;m misunderstanding your original question)</z><z id="t1546890924" t="ikitommi I would do something like: (defn on-version [versions] (fn [request] (let [version (get-in request [:headers &quot;x-version&quot;]) handler (get versions version (constantly nil))] (handler request)))) (GET &quot;/ping&quot; [] (on-version {&quot;v1&quot; (fn [req] ...) &quot;v2&quot; (fn [req] ...)})) "><y>#</y><d>2019-01-07</d><h>19:55</h><r>ikitommi</r>I would do something like:
<pre>(defn on-version [versions]
  (fn [request]
    (let [version (get-in request [:headers &quot;x-version&quot;])
          handler (get versions version (constantly nil))]
      (handler request))))

(GET &quot;/ping&quot; []
  (on-version
    {&quot;v1&quot; (fn [req] ...)
     &quot;v2&quot; (fn [req] ...)}))
</pre></z><z id="t1546893434" t="dbernal [:attrs {:href &quot;/_/_/users/U04V70XH6&quot;}] sorry. I misunderstood. I thought you meant that if they were the same route then I would need to look at the headers and dispatch it to another compojure route but it seems like it just needs to be dispatched to a certain handler. I can kind of see that from [:attrs {:href &quot;/_/_/users/U055NJ5CC&quot;}] &apos;s example. If I was using the compojure api would it be something similar?"><y>#</y><d>2019-01-07</d><h>20:37</h><r>dbernal</r><a>@seancorfield</a> sorry. I misunderstood. I thought you meant that if they were the same route then I would need to look at the headers and dispatch it to another compojure route but it seems like it just needs to be dispatched to a certain handler. I can kind of see that from <a>@U055NJ5CC</a>&apos;s example. If I was using the compojure api would it be something similar?</z><z id="t1546893574" t="seancorfield compojure-api instead of compojure ? I don&apos;t know, I&apos;ve never used the former. I&apos;ve only ever used the latter."><y>#</y><d>2019-01-07</d><h>20:39</h><r>seancorfield</r><code>compojure-api</code> instead of <code>compojure</code>? I don&apos;t know, I&apos;ve never used the former. I&apos;ve only ever used the latter.</z><z id="t1546893959" t="dbernal ah, I see. ok, I&apos;ll dig around a little bit more"><y>#</y><d>2019-01-07</d><h>20:45</h><r>dbernal</r>ah, I see. ok, I&apos;ll dig around a little bit more</z><z id="t1546919631" t="ikitommi compojure-api sits on top of compojure-api, so same rules apply"><y>#</y><d>2019-01-08</d><h>03:53</h><r>ikitommi</r>compojure-api sits on top of compojure-api, so same rules apply</z><z id="t1546920340" t="seancorfield ...on top of compojure‚Ä¶ ?"><y>#</y><d>2019-01-08</d><h>04:05</h><r>seancorfield</r>...on top of compojure‚Ä¶ ?</z><z id="t1547147983" t="mathpunk I have this data tool and I&apos;m trying to create an interface for it, so I&apos;m trying to write a server"><y>#</y><d>2019-01-10</d><h>19:19</h><w>mathpunk</w>I have this data tool and I&apos;m trying to create an interface for it, so I&apos;m trying to write a server</z><z id="t1547148016" t="mathpunk I&apos;d like it to print some text output if you curl, and some markup if you access it another way"><y>#</y><d>2019-01-10</d><h>19:20</h><w>mathpunk</w>I&apos;d like it to print some text output if you curl, and some markup if you access it another way</z><z id="t1547148022" t="mathpunk (defroutes app-routes (GET &quot;/&quot; [] (html (view/last-night []))) (GET &quot;/agent&quot; {:keys [headers params] :as request} (if-let [agent (get headers &quot;user-agent&quot;)] (str &quot;Your user agent is &quot; agent) (html [:div.agent [:h2 &quot;Welcome,&quot;] [:p &quot;Mysterious friend&quot;]]))) (GET &quot;/pipeline/:id&quot; [id] (html (view/pipeline id))) (route/not-found &quot;Not Found&quot;)) "><y>#</y><d>2019-01-10</d><h>19:20</h><w>mathpunk</w><pre>(defroutes app-routes
  (GET &quot;/&quot; [] (html (view/last-night [])))
  (GET &quot;/agent&quot; {:keys [headers params] :as request}
       (if-let [agent (get headers &quot;user-agent&quot;)]
         (str &quot;Your user agent is &quot; agent)
         (html [:div.agent
                [:h2 &quot;Welcome,&quot;]
                [:p &quot;Mysterious friend&quot;]])))
  (GET &quot;/pipeline/:id&quot; [id] (html (view/pipeline id)))
  (route/not-found &quot;Not Found&quot;))
</pre></z><z id="t1547148055" t="mathpunk In these routes, I&apos;ve figured out how to get at the headers in the /agent route. And I&apos;ve figured out how to get data out of the URL in the /pipeline/:id route"><y>#</y><d>2019-01-10</d><h>19:20</h><w>mathpunk</w>In these routes, I&apos;ve figured out how to get at the headers in the <code>/agent</code> route. And I&apos;ve figured out how to get data out of the URL in the <code>/pipeline/:id</code> route</z><z id="t1547148084" t="mathpunk Can these be combined? E.g., can I have a route /pipeline/:id that accesses the headers?"><y>#</y><d>2019-01-10</d><h>19:21</h><w>mathpunk</w>Can these be combined? E.g., can I have a route <code>/pipeline/:id</code> that accesses the headers?</z><z id="t1547148142" t="mathpunk I&apos;ve looked at the Compojure Destructuring document but, I&apos;m not clear on whether that :id is a &apos;param&apos; or not"><y>#</y><d>2019-01-10</d><h>19:22</h><w>mathpunk</w>I&apos;ve looked at the Compojure Destructuring document but, I&apos;m not clear on whether that :id is a &apos;param&apos; or not</z><z id="t1547150072" t="seancorfield If you use functions as handlers, instead of just code blocks, they will be passed the whole Ring request hash map."><y>#</y><d>2019-01-10</d><h>19:54</h><w>seancorfield</w>If you use functions as handlers, instead of just code blocks, they will be passed the whole Ring request hash map.</z><z id="t1547150150" t="seancorfield The declaration of variables in routes -- [id] in your code -- is good for coercion of parameter types and documentation (and very, very simple handlers) but not much use beyond that really."><y>#</y><d>2019-01-10</d><h>19:55</h><w>seancorfield</w>The declaration of variables in routes -- <code>[id]</code> in your code -- is good for coercion of parameter types  and documentation (and very, very simple handlers) but not much use beyond that really.</z><z id="t1547150185" t="seancorfield So your handlers could be (fn [{:keys [headers params] :as request}] ‚Ä¶) or named functions."><y>#</y><d>2019-01-10</d><h>19:56</h><w>seancorfield</w>So your handlers could be <code>(fn [{:keys [headers params] :as request}] ‚Ä¶)</code> or named functions.</z><z id="t1547150197" t="seancorfield Does that help [:attrs {:href &quot;/_/_/users/U0E9KE222&quot;}] ?"><y>#</y><d>2019-01-10</d><h>19:56</h><w>seancorfield</w>Does that help <a>@mathpunk</a>?</z><z id="t1547150230" t="mathpunk kiiiiind of.... does that mean that the segments of the URL are in the request itself?"><y>#</y><d>2019-01-10</d><h>19:57</h><w>mathpunk</w>kiiiiind of.... does that mean that the segments of the URL are in the request itself?</z><z id="t1547150259" t="mathpunk like I&apos;m just looking at this form, (GET &quot;/pipeline/:id&quot; [id] (html (view/pipeline id))) and it looks like magic that turns &quot;a bit of URL in the browser bar&quot; into &quot;a bound var&quot;"><y>#</y><d>2019-01-10</d><h>19:57</h><w>mathpunk</w>like I&apos;m just looking at this form, <code>(GET &quot;/pipeline/:id&quot; [id] (html (view/pipeline id)))</code> and it looks like magic that turns &quot;a bit of URL in the browser bar&quot; into &quot;a bound var&quot;</z><z id="t1547150310" t="mathpunk so, if use that destructuring form, I&apos;m responsible for splitting up (:compojure-uri request) myself"><y>#</y><d>2019-01-10</d><h>19:58</h><w>mathpunk</w>so, if use that destructuring form, I&apos;m responsible for splitting up <code>(:compojure-uri request)</code> myself</z><z id="t1547150349" t="seancorfield (GET &quot;/pipeline/:id&quot; [] show-pipeline) where (defn show-pipeline [{:keys [headers params] :as request}] (html (view/pipeline (:id params))))"><y>#</y><d>2019-01-10</d><h>19:59</h><w>seancorfield</w><code>(GET &quot;/pipeline/:id&quot; [] show-pipeline)</code> where <pre>(defn show-pipeline [{:keys [headers params] :as request}] (html (view/pipeline (:id params))))</pre></z><z id="t1547150442" t="mathpunk ok I think I see it"><y>#</y><d>2019-01-10</d><h>20:00</h><w>mathpunk</w>ok I think I see it</z><z id="t1547150474" t="seancorfield I try to avoid Compojure&apos;s destructuring to be honest -- it isn&apos;t powerful enough in the general case."><y>#</y><d>2019-01-10</d><h>20:01</h><w>seancorfield</w>I try to avoid Compojure&apos;s destructuring to be honest -- it isn&apos;t powerful enough in the general case.</z><z id="t1547150501" t="mathpunk I didn&apos;t realize that the params and the URI had anything to do with each other.... my mental model was, &quot;headers are key-value pairs you&apos;re not shown, and params are things after a question mark&quot;"><y>#</y><d>2019-01-10</d><h>20:01</h><w>mathpunk</w>I didn&apos;t realize that the params and the URI had anything to do with each other.... my mental model was, &quot;headers are key-value pairs you&apos;re not shown, and params are things after a question mark&quot;</z><z id="t1547150553" t="mathpunk hmm... I have tried using Ring directly but I very quickly got overwhelmed by options I didn&apos;t understand"><y>#</y><d>2019-01-10</d><h>20:02</h><w>mathpunk</w>hmm... I have tried using Ring directly but I very quickly got overwhelmed by options I didn&apos;t understand</z><z id="t1547150586" t="mathpunk (there&apos;s a lotta stuff in a request and a response)"><y>#</y><d>2019-01-10</d><h>20:03</h><w>mathpunk</w>(there&apos;s a lotta stuff in a request and a response)</z><z id="t1547151221" t="seancorfield Looking at the source code, I&apos;m not quite sure how it ends up working with function values in the handler slot (but it definitely does) so I need to play with macroexpand in the REPL a bit..."><y>#</y><d>2019-01-10</d><h>20:13</h><w>seancorfield</w>Looking at the source code, I&apos;m not quite sure how it ends up working with function values in the handler slot (but it definitely does) so I need to play with <code>macroexpand</code> in the REPL a bit...</z><z id="t1547151754" t="seancorfield ...ah, OK, I get it now. So the bound symbols are available literally in the handler form, whatever that is, so this would work: (GET &quot;/pipeline/:id&quot; [id] (fn [req] (html (view/pipeline id)))) and you could destructure req to get at the parameters etc. Looks like it puts id directly in the request hash map as well, but I&apos;d have to play with that some more."><y>#</y><d>2019-01-10</d><h>20:22</h><w>seancorfield</w>...ah, OK, I get it now. So the bound symbols are available literally in the handler form, whatever that is, so this would work: <pre>(GET &quot;/pipeline/:id&quot; [id] (fn [req] (html (view/pipeline id))))</pre> and you could destructure <code>req</code> to get at the parameters etc. Looks like it puts <code>id</code> directly in the <code>request</code> hash map as well, but I&apos;d have to play with that some more.</z><z id="t1547151814" t="seancorfield (I&apos;ve never bother to dig through the source to understand it before -- &quot;It. Just. Works.&quot; so I haven&apos;t needed to)"><y>#</y><d>2019-01-10</d><h>20:23</h><w>seancorfield</w>(I&apos;ve never bother to dig through the source to understand it before -- &quot;It. Just. Works.&quot; so I haven&apos;t needed to)</z><z id="t1547153308" t="seancorfield [:attrs {:href &quot;/_/_/users/U0E9KE222&quot;}] Just as a follow-up user=&gt; (GET &quot;/pipeline/:id&quot; [id] (fn [req] (println &apos;id id) (println &apos;req req) &quot;Hi!&quot;)) #object[compojure.core$wrap_route_matches$fn__2291 0x76134b9b &quot; So we can see that the parsed value ends up in :route-params (and, this, in :params as well) and is also bound as a local symbol for the form supplied in the handler slot."><y>#</y><d>2019-01-10</d><h>20:48</h><w>seancorfield</w><a>@mathpunk</a> Just as a follow-up <pre>user=&gt; (GET &quot;/pipeline/:id&quot; [id] (fn [req] (println &apos;id id) (println &apos;req req) &quot;Hi!&quot;))
#object[compojure.core$wrap_route_matches$fn__2291 0x76134b9b &quot;</pre> So we can see that the parsed value ends up in <code>:route-params</code> (and, this, in <code>:params</code> as well) and is also bound as a local symbol for the form supplied in the handler slot.</z><z id="t1547153320" t="mathpunk O_O"><y>#</y><d>2019-01-10</d><h>20:48</h><w>mathpunk</w>O_O</z><z id="t1547153389" t="mathpunk I have grabbed all of this text, put it somewhere safe, and I will stare at + experiment with it üôÇ"><y>#</y><d>2019-01-10</d><h>20:49</h><w>mathpunk</w>I have grabbed all of this text, put it somewhere safe, and I will stare at + experiment with it <b>üôÇ</b></z><z id="t1547153472" t="seancorfield If the binding form is a vector, it just binds the route parameter values it seems. If the binding form is a hash map, then it binds the whole request map."><y>#</y><d>2019-01-10</d><h>20:51</h><w>seancorfield</w>If the binding form is a vector, it just binds the route parameter values it seems. If the binding form is a hash map, then it binds the whole request map.</z><z id="t1547153490" t="seancorfield That was one of the pieces I was missing."><y>#</y><d>2019-01-10</d><h>20:51</h><w>seancorfield</w>That was one of the pieces I was missing.</z><z id="t1547153509" t="mathpunk thanks Sean! helpful as always üôè :skin-tone-2:"><y>#</y><d>2019-01-10</d><h>20:51</h><w>mathpunk</w>thanks Sean! helpful as always <b>üôè</b><b>:skin-tone-2:</b></z><z id="t1547153574" t="seancorfield Helping other people often teaches me new stuff and improves my understanding of tech. I&apos;m not as altruistic as people might think üôÇ"><y>#</y><d>2019-01-10</d><h>20:52</h><w>seancorfield</w>Helping other people often teaches me new stuff and improves my understanding of tech. I&apos;m not as altruistic as people might think <b>üôÇ</b></z><z id="t1547153592" t="mathpunk hahaha"><y>#</y><d>2019-01-10</d><h>20:53</h><w>mathpunk</w>hahaha</z><z id="t1547233915" t="cryan anyone during reverse routing / url generation with compojure?"><y>#</y><d>2019-01-11</d><h>19:11</h><w>cryan</w>anyone during reverse routing / url generation with compojure?</z><z id="t1547235606" t="seancorfield [:attrs {:href &quot;/_/_/users/U52HA6V0E&quot;}] I think folks who need reverse routing are using something like Bidi instead of Compojure."><y>#</y><d>2019-01-11</d><h>19:40</h><w>seancorfield</w><a>@cryan</a> I think folks who need reverse routing are using something like Bidi instead of Compojure.</z><z id="t1547238298" t="ikitommi [:attrs {:href &quot;/_/_/users/U52HA6V0E&quot;}] compojure-api adds reverse routing to compojure. Besides bidi, there is also reitit."><y>#</y><d>2019-01-11</d><h>20:24</h><w>ikitommi</w><a>@cryan</a> compojure-api adds reverse routing to compojure. Besides bidi, there is also reitit.</z><z id="t1547301597" t="kwladyka Is ring already compatible with clj ? In the context to be not depend on lein-ring during developing?"><y>#</y><d>2019-01-12</d><h>13:59</h><w>kwladyka</w>Is ring already compatible with <code>clj</code>? In the context to be not depend on <code>lein-ring</code> during developing?</z><z id="t1547317058" t="seancorfield I&apos;ve never used lein-ring -- even when I used to use Leiningen. Ring is just code -- you don&apos;t need any plugins to use it. We use Ring heavily with clj now. We used to use Boot with Ring too. [:attrs {:href &quot;/_/_/users/U0WL6FA77&quot;}] "><y>#</y><d>2019-01-12</d><h>18:17</h><w>seancorfield</w>I&apos;ve never used <code>lein-ring</code> -- even when I used to use Leiningen. Ring is just code -- you don&apos;t need any plugins to use it. We use Ring heavily with <code>clj</code> now. We used to use Boot with Ring too. <a>@kwladyka</a> </z><z id="t1547374131" t="kwladyka [:attrs {:href &quot;/_/_/users/U04V70XH6&quot;}] What is your flow during developing? Just [ring.middleware.reload :refer [wrap-reload]] or do you have something extra?"><y>#</y><d>2019-01-13</d><h>10:08</h><w>kwladyka</w><a>@seancorfield</a> What is your flow during developing? Just <code>[ring.middleware.reload :refer [wrap-reload]]</code> or do you have something extra?</z><z id="t1547420515" t="seancorfield [:attrs {:href &quot;/_/_/users/U0WL6FA77&quot;}] I evaluate code directly into the running application as I&apos;m developing it. I don&apos;t need the app to &quot;reload on save&quot;."><y>#</y><d>2019-01-13</d><h>23:01</h><w>seancorfield</w><a>@kwladyka</a> I evaluate code directly into the running application as I&apos;m developing it. I don&apos;t need the app to &quot;reload on save&quot;.</z><z id="t1547420782" t="seancorfield I actually don&apos;t like the reload-on-save and run-tests-on-save workflows -- I prefer to stay in my editor and control what gets executed. I evaluate code as I write it, I have &quot;test code&quot; in a comment form that I also evaluate as I write code and tests."><y>#</y><d>2019-01-13</d><h>23:06</h><w>seancorfield</w>I actually don&apos;t like the reload-on-save and run-tests-on-save workflows -- I prefer to stay in my editor and control what gets executed. I evaluate code as I write it, I have &quot;test code&quot; in a <code>comment</code> form that I also evaluate as I write code and tests.</z><z id="t1547420841" t="seancorfield I find the auto-reloading processes just break stuff and get in the way more than they help."><y>#</y><d>2019-01-13</d><h>23:07</h><w>seancorfield</w>I find the auto-reloading processes just break stuff and get in the way more than they help.</z><z id="t1550010324" t="chadhs just a heads up, latest lein-ring-server and leiningen 2.9 aren‚Äôt playing well together right now on clojure 1.10; had to revert to lein 2.8.3"><y>#</y><d>2019-02-12</d><h>22:25</h><w>chadhs</w>just a heads up, latest lein-ring-server and leiningen 2.9 aren‚Äôt playing well together right now on clojure 1.10; had to revert to lein 2.8.3</z><z id="t1550012299" t="seancorfield [:attrs {:href &quot;/_/_/users/U060QNFEZ&quot;}] Did you open an issue against Leiningen that it broke things in 2.9?"><y>#</y><d>2019-02-12</d><h>22:58</h><w>seancorfield</w><a>@chadhs</a> Did you open an issue against Leiningen that it broke things in 2.9?</z><z id="t1550012366" t="seancorfield (perhaps you can share more details of what &quot;aren&apos;t playing well together&quot; means?)"><y>#</y><d>2019-02-12</d><h>22:59</h><w>seancorfield</w>(perhaps you can share more details of what &quot;aren&apos;t playing well together&quot; means?)</z><z id="t1550012474" t="chadhs [:attrs {:href &quot;/_/_/users/U04V70XH6&quot;}] i need to open an issue, i agree. in the #leiningen channel i posted a gist for mikerod and he looked at it a bit."><y>#</y><d>2019-02-12</d><h>23:01</h><w>chadhs</w><a>@seancorfield</a> i need to open an issue, i agree.  in the #leiningen channel i posted a gist for mikerod and he looked at it a bit.</z><z id="t1550012490" t="chadhs need to head out for the day, thanks for the kind reply"><y>#</y><d>2019-02-12</d><h>23:01</h><w>chadhs</w>need to head out for the day, thanks for the kind reply</z><z id="t1550012818" t="seancorfield [:attrs {:href &quot;/_/_/users/U060QNFEZ&quot;}] It&apos;s due to an old version of clojure.core.unify being pulled in by leinjacker (whatever that is) which seems to be pulled in from lein-ring-server ."><y>#</y><d>2019-02-12</d><h>23:06</h><w>seancorfield</w><a>@chadhs</a> It&apos;s due to an old version of <code>clojure.core.unify</code> being pulled in by <code>leinjacker</code> (whatever that is) which seems to be pulled in from <code>lein-ring-server</code>.</z><z id="t1550012937" t="seancorfield OK, so the problematic library is actually leinjacker https://github.com/sattvik/leinjacker/blob/master/project.clj pulling in really old versions of things, including core.contracts which is where I think core.unify comes from."><y>#</y><d>2019-02-12</d><h>23:08</h><w>seancorfield</w>OK, so the problematic library is actually <code>leinjacker</code> <a href="https://github.com/sattvik/leinjacker/blob/master/project.clj" target="_blank">https://github.com/sattvik/leinjacker/blob/master/project.clj</a> pulling in really old versions of things, including <code>core.contracts</code> which is where I think <code>core.unify</code> comes from.</z><z id="t1550012958" t="mikerod Nice "><y>#</y><d>2019-02-12</d><h>23:09</h><w>mikerod</w>Nice </z><z id="t1550012999" t="seancorfield Doesn&apos;t look like leinjacker is maintained any more... so lein-ring probably ought to override the transitive deps and bring in newer versions? [:attrs {:href &quot;/_/_/users/U0BKWMG5B&quot;}]"><y>#</y><d>2019-02-12</d><h>23:09</h><w>seancorfield</w>Doesn&apos;t look like <code>leinjacker</code> is maintained any more... so <code>lein-ring</code> probably ought  to override the transitive deps and bring in newer versions? <a>@weavejester</a></z><z id="t1550013061" t="weavejester If someone wants to submit a PR that mimics lein-jacker&apos;s dependency update function then that&apos;s fine by me."><y>#</y><d>2019-02-12</d><h>23:11</h><w>weavejester</w>If someone wants to submit a PR that mimics lein-jacker&apos;s dependency update function then that&apos;s fine by me.</z><z id="t1550013082" t="weavejester But lein-ring should just need core.unify updated to 0.5.7 to get it working again."><y>#</y><d>2019-02-12</d><h>23:11</h><w>weavejester</w>But lein-ring should just need core.unify updated to 0.5.7 to get it working again.</z><z id="t1550013087" t="weavejester Codox had the same issue."><y>#</y><d>2019-02-12</d><h>23:11</h><w>weavejester</w>Codox had the same issue.</z><z id="t1550013113" t="seancorfield [org.clojure/core.contracts &quot;0.0.6&quot;] should do it...?"><y>#</y><d>2019-02-12</d><h>23:11</h><w>seancorfield</w><code>[org.clojure/core.contracts &quot;0.0.6&quot;]</code> should do it...?</z><z id="t1550013172" t="weavejester For Codox I just added a dependency for core.unify 0.5.7"><y>#</y><d>2019-02-12</d><h>23:12</h><w>weavejester</w>For Codox I just added a dependency for core.unify 0.5.7</z><z id="t1550013201" t="seancorfield leinjacker depends on 0.0.1 üòû -- yeah, updating just core.unify might well be enough."><y>#</y><d>2019-02-12</d><h>23:13</h><w>seancorfield</w><code>leinjacker</code> depends on <code>0.0.1</code> <b>üòû</b> -- yeah, updating just <code>core.unify</code> might well be enough.</z><z id="t1550013230" t="weavejester I just use leinjacker to insert dependencies."><y>#</y><d>2019-02-12</d><h>23:13</h><w>weavejester</w>I just use leinjacker to insert dependencies.</z><z id="t1550013361" t="seancorfield (I&apos;ve never used lein-ring -- I&apos;ve always managed my Ring apps &quot;by hand&quot;)"><y>#</y><d>2019-02-12</d><h>23:16</h><w>seancorfield</w>(I&apos;ve never used <code>lein-ring</code> -- I&apos;ve always managed my Ring apps &quot;by hand&quot;)</z><z id="t1550025258" t="chadhs [:attrs {:href &quot;/_/_/users/U0BKWMG5B&quot;}] https://github.com/weavejester/lein-ring/pull/205"><y>#</y><d>2019-02-13</d><h>02:34</h><w>chadhs</w><a>@weavejester</a> <a href="https://github.com/weavejester/lein-ring/pull/205" target="_blank">https://github.com/weavejester/lein-ring/pull/205</a></z><z id="t1550025300" t="chadhs oh‚Ä¶ looks like someone beat me to it. üôÇ https://github.com/weavejester/lein-ring/pull/204"><y>#</y><d>2019-02-13</d><h>02:35</h><w>chadhs</w>oh‚Ä¶ looks like someone beat me to it.  <b>üôÇ</b> <a href="https://github.com/weavejester/lein-ring/pull/204" target="_blank">https://github.com/weavejester/lein-ring/pull/204</a></z><z id="t1550025304" t="chadhs either way thanks guys"><y>#</y><d>2019-02-13</d><h>02:35</h><w>chadhs</w>either way thanks guys</z><z id="t1550803813" t="mdrago1026 Hi guys, quick question. Is there any with ring/compojure to read the raw body of a request that is application/x-www-form-urlencoded No matter what I do, even when I remove all middleware it&apos;s always a map"><y>#</y><d>2019-02-22</d><h>02:50</h><w>mdrago1026</w>Hi guys, quick question. Is there any with ring/compojure to read the raw body of a request that is <code>application/x-www-form-urlencoded</code> No matter what I do, even when I remove all middleware it&apos;s always a map</z><z id="t1550803842" t="mdrago1026 I need the raw request to do a an hmac digest on it to verify the request"><y>#</y><d>2019-02-22</d><h>02:50</h><w>mdrago1026</w>I need the raw request to do a an hmac digest on it to verify the request</z><z id="t1550803882" t="mdrago1026 I thought about using (ring.util.codec/url-encode payload) but obviously these maps aren&apos;t ordered"><y>#</y><d>2019-02-22</d><h>02:51</h><w>mdrago1026</w>I thought about using <code>(ring.util.codec/url-encode payload)</code> but obviously these maps aren&apos;t ordered</z><z id="t1550805261" t="seancorfield [:attrs {:href &quot;/_/_/users/U5XDR5QKS&quot;}] I&apos;m pretty sure the answer is &quot;no&quot; because by the time Ring has passed you the request, it has already been read and decoded -- and not all servers allow the raw body of a request to be read twice, as I recall..."><y>#</y><d>2019-02-22</d><h>03:14</h><w>seancorfield</w><a>@mdrago1026</a> I&apos;m pretty sure the answer is &quot;no&quot; because by the time Ring has passed you the request, it has already been read and decoded -- and not all servers allow the raw body of a request to be read twice, as I recall...</z><z id="t1550805425" t="mdrago1026 Yeah, i believe you are right, which is unfortunate. Still digging in to it. It&apos;s weird, even if I intercept the BytesInputStream and slurp it, it already seems to be a map"><y>#</y><d>2019-02-22</d><h>03:17</h><w>mdrago1026</w>Yeah, i believe you are right, which is unfortunate. Still digging in to it. It&apos;s weird, even if I intercept the <code>BytesInputStream</code> and slurp it, it already seems to be a map</z><z id="t1550806858" t="mdrago1026 For what it&apos;s worth, I found a workaround. I&apos;m using http-kit. Before I hand the request off to any of my compojure handlers, I&apos;m consuming the :body of the request. At this point it is still in the &quot;raw&quot; form. I just assoc it to the request as a different key, then pass on to the handlers. Not pretty, but it works"><y>#</y><d>2019-02-22</d><h>03:40</h><w>mdrago1026</w>For what it&apos;s worth, I found a workaround. I&apos;m using http-kit. Before I hand the request off to any of my compojure handlers, I&apos;m consuming the :body of the request. At this point it is still in the &quot;raw&quot; form. I just assoc it to the request as a different key, then pass on to the handlers. Not pretty, but it works</z><z id="t1551026814" t="jonathanj I‚Äôm using compojure-api and I‚Äôm wondering if there‚Äôs a way to specify (and coerce) a multipart POST that contains both a file and some JSON, presumably in different multipart params."><y>#</y><d>2019-02-24</d><h>16:46</h><w>jonathanj</w>I‚Äôm using compojure-api and I‚Äôm wondering if there‚Äôs a way to specify (and coerce) a multipart POST that contains both a file and some JSON, presumably in different multipart params.</z><z id="t1551026876" t="jonathanj Trying the obvious thing :multipart-params [file :- TempFileUpload metadata :- {s/Keyword s/Any}] fails claiming that metadata isn‚Äôt a map, which I guess is obvious since it‚Äôs serialized JSON but I‚Äôm not sure how to get the result I want."><y>#</y><d>2019-02-24</d><h>16:47</h><w>jonathanj</w>Trying the obvious thing <code>:multipart-params [file :- TempFileUpload metadata :- {s/Keyword s/Any}]</code> fails claiming that <code>metadata</code> isn‚Äôt a map, which I guess is obvious since it‚Äôs serialized JSON but I‚Äôm not sure how to get the result I want.</z><z id="t1551096066" t="mping this is what i got with spec (not schema): ;; file upload (s/def ::filename spec/string?) (s/def ::content-type spec/string?) (s/def ::size spec/int?) (s/def ::tempfile #(instance? File %)) (s/def ::file (st/spec {:spec (s/keys :req-un [::filename ::content-type ::size] :opt-un [::tempfile]) :json-schema/type &quot;file&quot;})) (POST &quot;/file&quot; [] :summary &quot;post a file&quot; :multipart-params [file :- ::file] :return ::any? :middleware [multipart/wrap-multipart-params] (ok (do (println file) (dissoc file :tempfile)))) "><y>#</y><d>2019-02-25</d><h>12:01</h><w>mping</w>this is what i got with spec (not schema):
<pre>;; file upload
(s/def ::filename spec/string?)
(s/def ::content-type spec/string?)
(s/def ::size spec/int?)
(s/def ::tempfile #(instance? File %))
(s/def ::file (st/spec {:spec (s/keys :req-un [::filename ::content-type ::size]
                                      :opt-un [::tempfile])
                        :json-schema/type &quot;file&quot;}))

(POST &quot;/file&quot; []
        :summary &quot;post a file&quot;
        :multipart-params [file :- ::file]
        :return ::any?
        :middleware [multipart/wrap-multipart-params]
        (ok (do (println file)
                (dissoc file :tempfile))))
</pre></z><z id="t1551096074" t="mping you should be able to add more multipart-params?"><y>#</y><d>2019-02-25</d><h>12:01</h><w>mping</w>you should be able to add more multipart-params?</z><z id="t1551174785" t="mping [:attrs {:href &quot;/_/_/users/U0DQY8L81&quot;}] feel free to ask about compojure-api on #ring-swagger"><y>#</y><d>2019-02-26</d><h>09:53</h><w>mping</w><a>@jonathanj</a> feel free to ask about compojure-api on #ring-swagger</z><z id="t1553782492" t="mping how do you guys deal with request validation? use spec? schema? monads? exceptions?"><y>#</y><d>2019-03-28</d><h>14:14</h><w>mping</w>how do you guys deal with request validation? use spec? schema? monads? exceptions?</z><z id="t1553782553" t="mping suppose I&apos;m deep in the code, and I want to invalidate the current request being processed. do you throw an exception and use a catch-all to map the ex-data to a 400 bad request or something?"><y>#</y><d>2019-03-28</d><h>14:15</h><w>mping</w>suppose I&apos;m deep in the code, and I want to invalidate the current request being processed. do you throw an exception and use a catch-all to map the ex-data to a 400 bad request or something?</z><z id="t1553782571" t="mping I have the idea that exceptions may be a bit costly, besides its basically a goto"><y>#</y><d>2019-03-28</d><h>14:16</h><w>mping</w>I have the idea that exceptions may be a bit costly, besides its basically a <code>goto</code></z><z id="t1553784119" t="mping this reading was quite interesting, specially the inline bit https://shipilev.net/blog/2014/exceptional-performance/"><y>#</y><d>2019-03-28</d><h>14:41</h><w>mping</w>this reading was quite interesting, specially the inline bit <a href="https://shipilev.net/blog/2014/exceptional-performance/" target="_blank">https://shipilev.net/blog/2014/exceptional-performance/</a></z><z id="t1553791659" t="grierson [:attrs {:href &quot;/_/_/users/U0MQW27QB&quot;}] This is something I have been looking into recently. I have started using Reitit + Interceptors. Reitit and Spec for coercion and data validation at the front door then Interceptors for more ?&apos;advanced validation&apos;? such as making queries to a databases then performing validation with that data. If an error occurs just throw an exception and return the context in the :enter function and return a 400 in the :error function."><y>#</y><d>2019-03-28</d><h>16:47</h><w>grierson</w><a>@mping</a> This is something I have been looking into recently. I have started using Reitit + Interceptors. Reitit and Spec for coercion and data validation at the front door then Interceptors for more ?&apos;advanced validation&apos;? such as making queries to a databases then performing validation with that data. If an error occurs just throw an exception and return the context in the :enter function and return a 400 in the :error function.</z><z id="t1553792592" t="mping [:attrs {:href &quot;/_/_/users/U3G3MBL9H&quot;}] tks I&apos;ll take a look; do u have some reference gist/project?"><y>#</y><d>2019-03-28</d><h>17:03</h><w>mping</w><a>@grierson</a> tks I&apos;ll take a look; do u have some reference gist/project?</z><z id="t1553792658" t="mping I&apos;m using compojure-api in one proj but sometimes you dont want to validate at the &quot;front door&quot;"><y>#</y><d>2019-03-28</d><h>17:04</h><w>mping</w>I&apos;m using compojure-api in one proj but sometimes you dont want to validate at the &quot;front door&quot;</z><z id="t1553792765" t="grierson [:attrs {:href &quot;/_/_/users/U0MQW27QB&quot;}] The reitit github has some documentation for coercion and validation. https://github.com/metosin/reitit"><y>#</y><d>2019-03-28</d><h>17:06</h><w>grierson</w><a>@mping</a> The reitit github has some documentation for coercion and validation. <a href="https://github.com/metosin/reitit" target="_blank">https://github.com/metosin/reitit</a></z><z id="t1553792803" t="grierson but for Interceptors + Exceptions they don&apos;t have any. I had loads of trouble finding resources."><y>#</y><d>2019-03-28</d><h>17:06</h><w>grierson</w>but for Interceptors + Exceptions they don&apos;t have any. I had loads of trouble finding resources.</z><z id="t1553792879" t="grierson In terms of &quot;sometimes you dont want to validate at the &quot;front door&quot;, it&apos;s optional in Reitit you don&apos;t have to if you don&apos;t want to."><y>#</y><d>2019-03-28</d><h>17:07</h><w>grierson</w>In terms of &quot;sometimes you dont want to validate at the &quot;front door&quot;, it&apos;s optional in Reitit you don&apos;t have to if you don&apos;t want to.</z><z id="t1554215404" t="kwladyka Who and why / why not use nginx on top of ring server?"><y>#</y><d>2019-04-02</d><h>14:30</h><w>kwladyka</w>Who and why / why not use nginx on top of ring server?</z><z id="t1554215466" t="kwladyka Personally I am thinking about it because of CORS purpose, but on the other hand maybe it is better to implement it in the app. Not sure."><y>#</y><d>2019-04-02</d><h>14:31</h><w>kwladyka</w>Personally I am thinking about it because of CORS purpose, but on the other hand maybe it is better to implement it in the app. Not sure.</z><z id="t1554215532" t="kwladyka I know we have https://github.com/r0man/ring-cors but it just doesn‚Äôt work for me. Nothing is happening. (wrap-cors :access-control-allow-origin [#&quot;&quot;] :access-control-allow-headers [&quot;Content-Type&quot; &quot;User-Agent&quot;] :access-control-allow-methods [:options :get :post]) curl -v -i -H &quot;Origin: &quot; -X DELETE Tue Apr 2 16:23:06 2019 * Trying 127.0.0.1... * TCP_NODELAY set * Connected to dev.localhost (127.0.0.1) port 8080 (#0) &gt; DELETE /authorize HTTP/1.1 &gt; Host: dev.localhost:8080 &gt; User-Agent: curl/7.54.0 &gt; Accept: */* &gt; Origin: &gt; &lt; HTTP/1.1 200 OK HTTP/1.1 200 OK &lt; Set-Cookie: auth-session=4594d762-8b71-42ed-bdb1-a27575410196;Path=/;HttpOnly Set-Cookie: auth-session=4594d762-8b71-42ed-bdb1-a27575410196;Path=/;HttpOnly &lt; Content-Length: 3 Content-Length: 3 &lt; Server: http-kit Server: http-kit &lt; Date: Tue, 02 Apr 2019 14:23:33 GMT Date: Tue, 02 Apr 2019 14:23:33 GMT &lt; * Connection #0 to host dev.localhost left intact foo‚èé "><y>#</y><d>2019-04-02</d><h>14:32</h><w>kwladyka</w>I know we have <a href="https://github.com/r0man/ring-cors" target="_blank">https://github.com/r0man/ring-cors</a> but it just doesn‚Äôt work for me. Nothing is happening.
<pre>(wrap-cors :access-control-allow-origin [#&quot;&quot;]
                 :access-control-allow-headers [&quot;Content-Type&quot; &quot;User-Agent&quot;]
                 :access-control-allow-methods [:options :get :post])
</pre>

<pre>curl -v -i -H &quot;Origin: &quot; -X DELETE                  Tue Apr  2 16:23:06 2019
*   Trying 127.0.0.1...
* TCP_NODELAY set
* Connected to dev.localhost (127.0.0.1) port 8080 (#0)
&gt; DELETE /authorize HTTP/1.1
&gt; Host: dev.localhost:8080
&gt; User-Agent: curl/7.54.0
&gt; Accept: */*
&gt; Origin: 
&gt;
&lt; HTTP/1.1 200 OK
HTTP/1.1 200 OK
&lt; Set-Cookie: auth-session=4594d762-8b71-42ed-bdb1-a27575410196;Path=/;HttpOnly
Set-Cookie: auth-session=4594d762-8b71-42ed-bdb1-a27575410196;Path=/;HttpOnly
&lt; Content-Length: 3
Content-Length: 3
&lt; Server: http-kit
Server: http-kit
&lt; Date: Tue, 02 Apr 2019 14:23:33 GMT
Date: Tue, 02 Apr 2019 14:23:33 GMT

&lt;
* Connection #0 to host dev.localhost left intact
foo‚èé
</pre></z><z id="t1554215551" t="kwladyka it should be rejected, because :delete is not in allowed methods"><y>#</y><d>2019-04-02</d><h>14:32</h><w>kwladyka</w>it should be rejected, because :delete is not in allowed methods</z><z id="t1554215810" t="kwladyka It doesn‚Äôt add headers with -X OPTIONS"><y>#</y><d>2019-04-02</d><h>14:36</h><w>kwladyka</w>It doesn‚Äôt add headers with <code>-X OPTIONS</code></z><z id="t1554217231" t="kwladyka (ring.middleware.cors/allow-request? {:headers {&quot;origin&quot; &quot;&quot;} :request-method :options} {:access-control-allow-origin [#&quot;&quot;] ;:access-control-allow-headers #{&quot;Content-Type&quot; &quot;User-Agent&quot;} :access-control-allow-methods #{:options :get :post} }) return false hmm"><y>#</y><d>2019-04-02</d><h>15:00</h><w>kwladyka</w><pre>(ring.middleware.cors/allow-request? {:headers {&quot;origin&quot; &quot;&quot;}
                                        :request-method :options}
                                       {:access-control-allow-origin [#&quot;&quot;]
                                        ;:access-control-allow-headers #{&quot;Content-Type&quot; &quot;User-Agent&quot;}
                                        :access-control-allow-methods #{:options :get :post}
                                        })
</pre>
return false hmm</z><z id="t1554217427" t="kwladyka oh I see, it looks like ring-cors use forbidden header access-control-request-method"><y>#</y><d>2019-04-02</d><h>15:03</h><w>kwladyka</w>oh I see, it looks like ring-cors use forbidden header <code>access-control-request-method</code></z><z id="t1554217519" t="kwladyka solved‚Ä¶. well, it will be easier to write my own wrapper on this"><y>#</y><d>2019-04-02</d><h>15:05</h><w>kwladyka</w>solved‚Ä¶. well, it will be easier to write my own wrapper on this</z><z id="t1554217623" t="kwladyka or use nginx on top of ring, because of no good support for this. What is your choice?"><y>#</y><d>2019-04-02</d><h>15:07</h><w>kwladyka</w>or use nginx on top of ring, because of no good support for this. What is your choice?</z><z id="t1554218182" t="kwladyka well‚Ä¶ probably I will do it on nginx üôÇ"><y>#</y><d>2019-04-02</d><h>15:16</h><w>kwladyka</w>well‚Ä¶ probably I will do it on nginx <b>üôÇ</b></z><z id="t1556296260" t="jmromrell I&apos;m running into a design problem with compojure. Given there is no compojure channel, might this be an appropriate place to discuss it?"><y>#</y><d>2019-04-26</d><h>16:31</h><w>jmromrell</w>I&apos;m running into a design problem with compojure. Given there is no compojure channel, might this be an appropriate place to discuss it?</z><z id="t1556296375" t="jmromrell Specifically, I am trying to implement auth middleware. The desired behavior is that the middleware will prevent handler execution for unauthenticated or unauthorized users. However, I also do not want to force a user to be authenticated if the request does not match any of the routes that are wrapped by the middleware"><y>#</y><d>2019-04-26</d><h>16:32</h><w>jmromrell</w>Specifically, I am trying to implement auth middleware. The desired behavior is that the middleware will prevent handler execution for unauthenticated or unauthorized users. However, I also do not want to force a user to be authenticated if the request does not match any of the routes that are wrapped by the middleware</z><z id="t1556296660" t="jmromrell If I wrap routes in such middleware now, I have two options: 1. Ensure user is authenticated/authorized before passing request along. Problem is that at this point I do not know that the user&apos;s request will match any routes, so the authentication/authorization may be unnecessary and I might incorrectly return a HTTP 401 or 403 for a request when it should have been a 404 or a successful response from a route not in this middleware&apos;s context. 2. Ensure authentication/authorization after a response has been provided, ensuring a route has been matched in the middleware&apos;s context. Problem is this means that the handler has already been executed, which may mean the user just deleted something from a database they shouldn&apos;t have been authorized to do."><y>#</y><d>2019-04-26</d><h>16:37</h><w>jmromrell</w>If I wrap routes in such middleware now, I have two options:
1. Ensure user is authenticated/authorized before passing request along. Problem is that at this point I do not know that the user&apos;s request will match any routes, so the authentication/authorization may be unnecessary and I might incorrectly return a HTTP 401 or 403 for a request when it should have been a 404 or a successful response from a route not in this middleware&apos;s context.
2. Ensure authentication/authorization after a response has been provided, ensuring a route has been matched in the middleware&apos;s context. Problem is this means that the handler has already been executed, which may mean the user just deleted something from a database they shouldn&apos;t have been authorized to do.</z><z id="t1556296819" t="jmromrell I can address the second point by making every single endpoint return a [delay]( https://clojuredocs.org/clojure.core/delay ) which is realized by the auth middleware after ensuring the user is authenticated/authorized. But this potentially breaks middleware between the handler and the auth middleware which expected a realized response to inspect and modify. It also does not allow for auth middleware to be composed (for example, require authentication and basic permissions for an entire API, but more specific permissions for a particular set of routes)"><y>#</y><d>2019-04-26</d><h>16:40</h><w>jmromrell</w>I can address the second point by making every single endpoint return a [delay](<a href="https://clojuredocs.org/clojure.core/delay" target="_blank">https://clojuredocs.org/clojure.core/delay</a>) which is realized by the auth middleware after ensuring the user is authenticated/authorized. But this potentially breaks middleware between the handler and the auth middleware which expected a realized response to inspect and modify. It also does not allow for auth middleware to be composed (for example, require authentication and basic permissions for an entire API, but more specific permissions for a particular set of routes)</z><z id="t1556296919" t="jmromrell Is there a generally accepted solution to this problem? I feel others have to have run into this issue before."><y>#</y><d>2019-04-26</d><h>16:41</h><w>jmromrell</w>Is there a generally accepted solution to this problem? I feel others have to have run into this issue before.</z><z id="t1556300365" t="seancorfield [:attrs {:href &quot;/_/_/users/U5HEAFFAM&quot;}] I often find I need middleware that runs only when routes are matched so I&apos;ve created a variant of defroutes called defroutes-wrapped that takes an extra argument before the route definitions, which is middleware to wrap the handler in."><y>#</y><d>2019-04-26</d><h>17:39</h><w>seancorfield</w><a>@jmromrell</a> I often find I need middleware that runs only when routes are matched so I&apos;ve created a variant of <code>defroutes</code> called <code>defroutes-wrapped</code> that takes an extra argument before the route definitions, which is middleware to wrap the handler in.</z><z id="t1556300405" t="seancorfield So I&apos;ll have something like (defroutes-wrapped api-routes #&apos;api-middleware (POST &quot;/accept&quot; [] #&apos;ctl-covalence/accept) (POST &quot;/block&quot; [] #&apos;ctl-member/block) (GET &quot;/blocked&quot; [] #&apos;ctl-search/blocked) ..."><y>#</y><d>2019-04-26</d><h>17:40</h><w>seancorfield</w>So I&apos;ll have something like <pre>(defroutes-wrapped api-routes #&apos;api-middleware
  (POST  &quot;/accept&quot;             [] #&apos;ctl-covalence/accept)
  (POST  &quot;/block&quot;              [] #&apos;ctl-member/block)
  (GET   &quot;/blocked&quot;            [] #&apos;ctl-search/blocked)
  ...</pre></z><z id="t1556300478" t="seancorfield And the api-middleware function can then check :compojure/route to see if it is exempt from auth checking."><y>#</y><d>2019-04-26</d><h>17:41</h><w>seancorfield</w>And the <code>api-middleware</code> function can then check <code>:compojure/route</code> to see if it is exempt from auth checking.</z><z id="t1556300508" t="seancorfield (defmacro defroutes-wrapped &quot;Like Compojure&apos;s defroutes except it takes a middleware function and wraps all of the routes&apos; handlers in that.&quot; [name middleware &amp; routes] (concat [`compojure/defroutes name] (map (fn [[verb pattern args handler :as route]] (if (= 4 (count route)) (list verb pattern args (list middleware handler)) route)) routes))) "><y>#</y><d>2019-04-26</d><h>17:41</h><w>seancorfield</w><pre>(defmacro defroutes-wrapped
  &quot;Like Compojure&apos;s defroutes except it takes a middleware function and wraps
  all of the routes&apos; handlers in that.&quot;
  [name middleware &amp; routes]
  (concat [`compojure/defroutes name]
          (map (fn [[verb pattern args handler :as route]]
                 (if (= 4 (count route))
                   (list verb pattern args (list middleware handler))
                   route))
               routes)))
</pre></z><z id="t1556301103" t="jmromrell I was actually just looking into an option similar to this. The auth middleware would push/pop the auth expectations onto a stack contained in a dynamic var which would be checked immediately prior to handler execution. I&apos;m currently looking for a good hook in the compojure library to do a with-redefs around the handler execution rather than replacing an entire macro, if possible."><y>#</y><d>2019-04-26</d><h>17:51</h><w>jmromrell</w>I was actually just looking into an option similar to this. The auth middleware would push/pop the auth expectations onto a stack contained in a dynamic var which would be checked immediately prior to handler execution. I&apos;m currently looking for a good hook in the compojure library to do a with-redefs around the handler execution rather than replacing an entire macro, if possible.</z><z id="t1556301121" t="jmromrell Thanks for the helpful response! I&apos;ll definitely go this route (heh) if there isn&apos;t a good place to with-redefs"><y>#</y><d>2019-04-26</d><h>17:52</h><w>jmromrell</w>Thanks for the helpful response! I&apos;ll definitely go this route (heh) if there isn&apos;t a good place to with-redefs</z><z id="t1556301194" t="seancorfield with-redefs isn&apos;t something you want outside your test-only code. And I&apos;d stay away from dynamic variables as much as possible too."><y>#</y><d>2019-04-26</d><h>17:53</h><w>seancorfield</w><code>with-redefs</code> isn&apos;t something you want outside your test-only code. And I&apos;d stay away from dynamic variables as much as possible too.</z><z id="t1556301485" t="jmromrell Why would it be discouraged for me to do something like: (defn my-create [path method info childs handler] (if (nil? childs) (-&gt;Route path method info childs (resolve-auth-requirement-stack handler)) (-&gt;Route path method info childs handler))) (with-redefs [compojure.api.routes/create my-create] ...) It seems simpler than overriding their entire macro and replacing all places I reference it."><y>#</y><d>2019-04-26</d><h>17:58</h><w>jmromrell</w>Why would it be discouraged for me to do something like:
<pre>(defn my-create [path method info childs handler]
  (if (nil? childs)
    (-&gt;Route path method info childs (resolve-auth-requirement-stack handler))
    (-&gt;Route path method info childs handler)))

(with-redefs [compojure.api.routes/create my-create]
  ...)</pre>
It seems simpler than overriding their entire macro and replacing all places I reference it.</z></g><g id="s6"><z id="t1556301558" t="jmromrell And why should dynamic vars be avoided? I was inspired to this approach by the perseverance library, which uses a similar dynamic var approach to great effect."><y>#</y><d>2019-04-26</d><h>17:59</h><w>jmromrell</w>And why should dynamic vars be avoided? I was inspired to this approach by the perseverance library, which uses a similar dynamic var approach to great effect.</z><z id="t1556304578" t="ikitommi There is compojure.core/wrap-routes for that. But it doesn&apos;t help on mounting mw other than on enpoint."><y>#</y><d>2019-04-26</d><h>18:49</h><w>ikitommi</w>There is <code>compojure.core/wrap-routes</code> for that. But it doesn&apos;t help on mounting mw other than on  enpoint.</z><z id="t1556305681" t="ikitommi As you are using compojure-api, you could also check reitit-ring - has all the same features but it implements a route-first architecture: the mw-chain is only applied if there is a full match. You could most likely do same with bidi too."><y>#</y><d>2019-04-26</d><h>19:08</h><w>ikitommi</w>As you are using compojure-api, you could also check reitit-ring - has all the same features but it implements a route-first architecture: the mw-chain is only applied if there is a full match. You could most likely do same with bidi too.</z><z id="t1556307048" t="jmromrell I&apos;ll check out reitit, thank you!"><y>#</y><d>2019-04-26</d><h>19:30</h><w>jmromrell</w>I&apos;ll check out reitit, thank you!</z><z id="t1556307348" t="seancorfield [:attrs {:href &quot;/_/_/users/U5HEAFFAM&quot;}] with-redefs is not thread safe -- so make sure you&apos;re only doing this in one thread, presumably at startup, rather than using it on the fly; dynamic vars make it impossible to have multiple instances of things that depend on them if they run in the same thread -- so their use needs to be isolated to a single function call tree, i.e., keeping them tightly coupled with an internal implementation only. That&apos;s why you&apos;ll often hear people tell you to avoid them."><y>#</y><d>2019-04-26</d><h>19:35</h><w>seancorfield</w><a>@jmromrell</a> <code>with-redefs</code> is not thread safe -- so make sure you&apos;re only doing this in one thread, presumably at startup, rather than using it on the fly; dynamic vars make it impossible to have multiple instances of things that depend on them if they run in the same thread -- so their use needs to be isolated to a single function call tree, i.e., keeping them tightly coupled with an internal implementation only. That&apos;s why you&apos;ll often hear people tell you to avoid them.</z><z id="t1556307409" t="seancorfield I thought they were pretty cool when I got started with Clojure nearly nine years ago but I&apos;ve learned to avoid them except in very specific situations -- and there are nearly always much cleaner ways of achieving similar things."><y>#</y><d>2019-04-26</d><h>19:36</h><w>seancorfield</w>I thought they were pretty cool when I got started with Clojure nearly nine years ago but I&apos;ve learned to avoid them except in very specific situations -- and there are nearly always much cleaner ways of achieving similar things.</z><z id="t1556307485" t="seancorfield I don&apos;t use with-redefs anywhere except in tests to mock certain lower-level functions. And I very rarely use dynamic variables at all, preferring to pass values through the call tree instead."><y>#</y><d>2019-04-26</d><h>19:38</h><w>seancorfield</w>I don&apos;t use <code>with-redefs</code> anywhere except in tests to mock certain lower-level functions. And I very rarely use dynamic variables at all, preferring to pass values through the call tree instead.</z><z id="t1556307907" t="seancorfield In our 82,000 lines of Clojure at work, the only dynamic vars we use fall into two categories (with one exception): debug flags that can be dynamically rebound when testing/debugging; hooks for context that be dynamically rebound within tests. The one exception is a thread-specific context that is used entirely within a single call tree to simplify value passing."><y>#</y><d>2019-04-26</d><h>19:45</h><w>seancorfield</w>In our 82,000 lines of Clojure at work, the only dynamic vars we use fall into two categories (with one exception): debug flags that can be dynamically rebound when testing/debugging; hooks for context that be dynamically rebound within tests. The one exception is a thread-specific context that is used entirely within a single call tree to simplify value passing.</z><z id="t1556307940" t="jmromrell I&apos;ve been reading into threading problems with with-redefs, and I can see why it should be avoided outside of testing or areas you can be certain are single-threaded (certainly not request handling on a busy web server)."><y>#</y><d>2019-04-26</d><h>19:45</h><w>jmromrell</w>I&apos;ve been reading into threading problems with with-redefs, and I can see why it should be avoided outside of testing or areas you can be certain are single-threaded (certainly not request handling on a busy web server).</z><z id="t1556308009" t="jmromrell I&apos;m still reading up on the concerns with dynamic vars, but appreciate you pointing me in that direction. I expect I will arrive at the same conclusions as you."><y>#</y><d>2019-04-26</d><h>19:46</h><w>jmromrell</w>I&apos;m still reading up on the concerns with dynamic vars, but appreciate you pointing me in that direction. I expect I will arrive at the same conclusions as you.</z><z id="t1556308080" t="jmromrell You are saying in this case you would prefer to define a copy of the compojure macro(s), and instead of having the auth middleware add auth requirements to a stack in a dynamic var, to instead assoc that data in the request map?"><y>#</y><d>2019-04-26</d><h>19:48</h><w>jmromrell</w>You are saying in this case you would prefer to define a copy of the compojure macro(s), and instead of having the auth middleware add auth requirements to a stack in a dynamic var, to instead assoc that data in the request map?</z><z id="t1556308089" t="jmromrell That way it is passed through the call tree?"><y>#</y><d>2019-04-26</d><h>19:48</h><w>jmromrell</w>That way it is passed through the call tree?</z><z id="t1556308189" t="seancorfield See my macro above -- it wraps the Compojure defroutes macro so that it can automatically apply middleware to routes that match (in terms of the number of elements in the route definitions). It&apos;s a syntactic convenience."><y>#</y><d>2019-04-26</d><h>19:49</h><w>seancorfield</w>See my macro above -- it wraps the Compojure <code>defroutes</code> macro so that it can automatically apply middleware to routes that match (in terms of the number of elements in the route definitions). It&apos;s a syntactic convenience.</z><z id="t1556308215" t="seancorfield In a smaller app, I&apos;ve used let-routes from Compojure and explicitly wrapped the handlers in middleware."><y>#</y><d>2019-04-26</d><h>19:50</h><w>seancorfield</w>In a smaller app, I&apos;ve used <code>let-routes</code> from Compojure and explicitly wrapped the handlers in middleware.</z><z id="t1556308262" t="jmromrell I see. Thank you for the advice!"><y>#</y><d>2019-04-26</d><h>19:51</h><w>jmromrell</w>I see. Thank you for the advice!</z><z id="t1556308271" t="seancorfield Here&apos;s an example of the latter, in a small web app designed to show beginners how to get started with common Clojure libs: https://github.com/seancorfield/usermanager-example/blob/master/src/usermanager/main.clj#L108-L132"><y>#</y><d>2019-04-26</d><h>19:51</h><w>seancorfield</w>Here&apos;s an example of the latter, in a small web app designed to show beginners how to get started with common Clojure libs: <a href="https://github.com/seancorfield/usermanager-example/blob/master/src/usermanager/main.clj#L108-L132" target="_blank">https://github.com/seancorfield/usermanager-example/blob/master/src/usermanager/main.clj#L108-L132</a></z><z id="t1556308285" t="seancorfield If there were a lot more routes, that would be painful."><y>#</y><d>2019-04-26</d><h>19:51</h><w>seancorfield</w>If there were a lot more routes, that would be painful.</z><z id="t1556308311" t="jmromrell Yeah. In my case I&apos;m implementing this for APIs with tens to hundreds of routes in various nested contexts"><y>#</y><d>2019-04-26</d><h>19:51</h><w>jmromrell</w>Yeah. In my case I&apos;m implementing this for APIs with tens to hundreds of routes in various nested contexts</z><z id="t1556308552" t="seancorfield If your routing is that complex, you might want to look at alternatives to Compojure. In my experience, it doesn&apos;t really scale to a large number of routes, and it&apos;s not particularly fast either."><y>#</y><d>2019-04-26</d><h>19:55</h><w>seancorfield</w>If your routing is that complex, you might want to look at alternatives to Compojure. In my experience, it doesn&apos;t really scale to a large number of routes, and it&apos;s not particularly fast either.</z><z id="t1556308598" t="jmromrell The largest API is essentially a team toolbox that we don&apos;t expose externally (even to other teams) and where performance is a non-issue. I have been looking into aleph/yada as possible alternatives for us to try later if needed"><y>#</y><d>2019-04-26</d><h>19:56</h><w>jmromrell</w>The largest API is essentially a team toolbox that we don&apos;t expose externally (even to other teams) and where performance is a non-issue. I have been looking into aleph/yada as possible alternatives for us to try later if needed</z><z id="t1556308681" t="seancorfield Tommi&apos;s suggestion of reitit-ring is a good one to look at. We&apos;ve used Bidi on one app and we&apos;ve considered switching all our Compojure apps over to Bidi (partly because we could generate the routing data structure from other data/metadata which would make maintenance easier)."><y>#</y><d>2019-04-26</d><h>19:58</h><w>seancorfield</w>Tommi&apos;s suggestion of reitit-ring is a good one to look at. We&apos;ve used Bidi on one app and we&apos;ve considered switching all our Compojure apps over to Bidi (partly because we could generate the routing data structure from other data/metadata which would make maintenance easier).</z><z id="t1556308701" t="seancorfield I haven&apos;t looked at Yada but I know a lot of people love it."><y>#</y><d>2019-04-26</d><h>19:58</h><w>seancorfield</w>I haven&apos;t looked at Yada but I know a lot of people love it.</z><z id="t1556308755" t="jmromrell I&apos;m definitely planning on looking into reitit at some point. I think I know someone at my company who uses it already. Just need to find time to do a deep dive on the available options. üôÇ"><y>#</y><d>2019-04-26</d><h>19:59</h><w>jmromrell</w>I&apos;m definitely planning on looking into reitit at some point. I think I know someone at my company who uses it already. Just need to find time to do a deep dive on the available options. <b>üôÇ</b></z><z id="t1556308764" t="jmromrell Thank you for all the help and advice!"><y>#</y><d>2019-04-26</d><h>19:59</h><w>jmromrell</w>Thank you for all the help and advice!</z><z id="t1556315472" t="ikitommi some rationale &amp; benefits about the route-first (and reitit) here: https://www.slideshare.net/mobile/metosin/reitit-clojurenorth-2019-141438093/30 . The example is actually the authorization middleware, so close. Disclaimer: maintainer in both compojure-api &amp; reitit. I think similar things could be done with stacks like bidi+yada."><y>#</y><d>2019-04-26</d><h>21:51</h><w>ikitommi</w>some rationale &amp; benefits about the route-first (and reitit) here:  <a href="https://www.slideshare.net/mobile/metosin/reitit-clojurenorth-2019-141438093/30" target="_blank">https://www.slideshare.net/mobile/metosin/reitit-clojurenorth-2019-141438093/30</a>. The example is actually the authorization middleware, so close. Disclaimer: maintainer in both compojure-api &amp; reitit. I think similar things could be done with stacks like bidi+yada.</z><z id="t1556897396" t="conan I love how reitit allows you to put middleware anywhere in the route tree, so it&apos;s really clear what does what. i&apos;ve used compojure and bidi, and heartily recommend reitit."><y>#</y><d>2019-05-03</d><h>15:29</h><w>conan</w>I love how reitit allows you to put middleware anywhere in the route tree, so it&apos;s really clear what does what.  i&apos;ve used compojure and bidi, and heartily recommend reitit.</z><z id="t1557206231" t="ikitommi could the next version of Ring be based on protocols? e.g. Request and Response protocols. Maps could implement this, so one could use it as before, but it would enable faster processing in libraries: 1) request comes in (via Immutant), does a zero-copy request proxy, implementing the ring protocols (now: own custom protocols for this) + map interfaces so it can be used as a map 2) when a request needs to be inspected in a routing / middleware / web library - it coud use the protocols like (ring2.core/get-uri request) &amp; (ring2.core/get-request-method request) , which would basically translate to direct java method calls to Undertow Java Request implementation =&gt; much faster, no need to realize the full request maps if they are not used 3) apps could choose to use the map-syntax or the protocol-syntax"><y>#</y><d>2019-05-07</d><h>05:17</h><w>ikitommi</w>could the next version of Ring be based on protocols? e.g. <code>Request</code> and  <code>Response</code> protocols. Maps could implement this, so one could use it as before, but it would enable faster processing in libraries:
1) request comes in (via Immutant), does a zero-copy request proxy, implementing the ring protocols (now: own custom protocols for this) + map interfaces so it can be used as a map
2) when a request needs to be inspected in a routing / middleware / web library - it coud use the protocols like <code>(ring2.core/get-uri request)</code> &amp; <code>(ring2.core/get-request-method request)</code>, which would basically translate to direct java method calls to Undertow Java Request implementation =&gt; much faster, no need to realize the full request maps if they are not used
3) apps could choose to use the map-syntax or the protocol-syntax</z><z id="t1557223825" t="mpenet You can turn the problem around and use a request/response ds that &quot;behaves&quot; like a map but only realizes (and potentially caches) the values as requested"><y>#</y><d>2019-05-07</d><h>10:10</h><w>mpenet</w>You can turn the problem around and use a request/response ds that &quot;behaves&quot; like a map but only realizes (and potentially caches) the values as requested</z><z id="t1557223850" t="mpenet potemkin had something like that"><y>#</y><d>2019-05-07</d><h>10:10</h><w>mpenet</w>potemkin had something like that</z><z id="t1557223881" t="mpenet https://github.com/ztellman/potemkin#def-derived-map"><y>#</y><d>2019-05-07</d><h>10:11</h><w>mpenet</w><a href="https://github.com/ztellman/potemkin#def-derived-map" target="_blank">https://github.com/ztellman/potemkin#def-derived-map</a></z><z id="t1557223946" t="mpenet seems to be what aleph is doing on some parts too: https://github.com/ztellman/aleph/search?q=def-derived-map&amp;amp;unscoped_q=def-derived-map"><y>#</y><d>2019-05-07</d><h>10:12</h><w>mpenet</w>seems to be what aleph is doing on some parts too: <a href="https://github.com/ztellman/aleph/search?q=def-derived-map&amp;amp;unscoped_q=def-derived-map" target="_blank">https://github.com/ztellman/aleph/search?q=def-derived-map&amp;amp;unscoped_q=def-derived-map</a></z><z id="t1557225411" t="ikitommi Copied that to my immutant(-nio) fork too ( https://github.com/ikitommi/immutant/blob/master/web/src/immutant/web/internal/undertow.clj#L226-L244 ). I think it‚Äôs a good approach, but there is still a extra hop (and internal cache) between the caller and the data. Could bench that out, but an exposed protocol would be truely zero-fat."><y>#</y><d>2019-05-07</d><h>10:36</h><w>ikitommi</w>Copied that to my immutant(-nio) fork too (<a href="https://github.com/ikitommi/immutant/blob/master/web/src/immutant/web/internal/undertow.clj#L226-L244" target="_blank">https://github.com/ikitommi/immutant/blob/master/web/src/immutant/web/internal/undertow.clj#L226-L244</a>). I think it‚Äôs a good approach, but there is still a extra hop (and internal cache) between the caller and the data. Could bench that out, but an exposed protocol would be truely zero-fat.</z><z id="t1557225538" t="ikitommi but, true, it would be less intrusive to do that behind the scenes (like those two web servers do it today)"><y>#</y><d>2019-05-07</d><h>10:38</h><w>ikitommi</w>but, true, it would be less intrusive to do that behind the scenes (like those two web servers do it today)</z><z id="t1557225553" t="mpenet should be quite close, it&apos;s just a method call that calls another method under the hood"><y>#</y><d>2019-05-07</d><h>10:39</h><w>mpenet</w>should be quite close, it&apos;s just a method call that calls another method under the hood</z><z id="t1557225573" t="mpenet I guess the jvm might do some magic to remove the overhead after a while"><y>#</y><d>2019-05-07</d><h>10:39</h><w>mpenet</w>I guess the jvm might do some magic to remove the overhead after a while</z><z id="t1557225601" t="ikitommi could be, I did some benching while ago, could rerun."><y>#</y><d>2019-05-07</d><h>10:40</h><w>ikitommi</w>could be, I did some benching while ago, could rerun.</z><z id="t1557225614" t="mpenet (I am not super familiar with the internals of derived-map, but you could simplify it to the strict minimum and tune it to that use case)"><y>#</y><d>2019-05-07</d><h>10:40</h><w>mpenet</w>(I am not super familiar with the internals of derived-map, but you could simplify it to the strict minimum and tune it to that use case)</z><z id="t1557226231" t="ikitommi I‚Äôll run some numbers and get back. thanks for the thoughts"><y>#</y><d>2019-05-07</d><h>10:50</h><w>ikitommi</w>I‚Äôll run some numbers and get back. thanks for the thoughts</z><z id="t1557351495" t="ikitommi [:attrs {:href &quot;/_/_/users/U050SC7SV&quot;}] re-run the perf-test, protocols are 1-2 orders of magnitude faster. def-derived-map is the slowest, it‚Äôs get does multiple hash-lookups internally."><y>#</y><d>2019-05-08</d><h>21:38</h><w>ikitommi</w><a>@mpenet</a> re-run the perf-test, protocols are 1-2 orders of magnitude faster. <code>def-derived-map</code> is the slowest, it‚Äôs <code>get</code> does multiple hash-lookups internally.</z><z id="t1557351515" t="ikitommi"><y>#</y><d>2019-05-08</d><h>21:38</h><w>ikitommi</w></z><z id="t1557351600" t="ikitommi e.g. 530ns (potemkin) vs 73ns (optimized map) vs 7ns (protocol) to construct a Request proxy and ask 10 times a pre-calculated value from it."><y>#</y><d>2019-05-08</d><h>21:40</h><w>ikitommi</w>e.g. 530ns (potemkin) vs 73ns (optimized map) vs 7ns (protocol) to construct a Request proxy and ask 10 times a pre-calculated value from it.</z><z id="t1557351627" t="ikitommi please tell if there is something fishy in the tests."><y>#</y><d>2019-05-08</d><h>21:40</h><w>ikitommi</w>please tell if there is something fishy in the tests.</z><z id="t1557351747" t="ikitommi if they are correct, having protocols would enable ring-apps to speed-up a lot. Also, many things have optimized impls already in the java-side, we couls just use those instead of the default ring impls."><y>#</y><d>2019-05-08</d><h>21:42</h><w>ikitommi</w>if they are correct, having protocols would enable ring-apps to speed-up a lot. Also, many things have optimized impls already in the java-side, we couls just use those instead of the default ring impls.</z><z id="t1557414494" t="mpenet [:attrs {:href &quot;/_/_/users/U055NJ5CC&quot;}] Surprising. But I meant you could write your own version of derived-map that&apos;s basically a simple wrapper for map functions (assoc/get/dissoc) with an inlined switch on the correct piece of code and fallback on normal fns for extras (like extmap for records). But yeah protocols are easier but I have the feeling that&apos;s not something that would be added to ring without resistance (I could be wrong)"><y>#</y><d>2019-05-09</d><h>15:08</h><w>mpenet</w><a>@ikitommi</a> Surprising. But I meant you could write your own version of derived-map that&apos;s basically a simple wrapper for map functions (assoc/get/dissoc) with an inlined switch on the correct piece of code and fallback on normal fns for extras (like extmap for records). But yeah protocols are easier but I have the feeling that&apos;s not something that would be added to ring without resistance (I could be wrong)</z><z id="t1557414584" t="mpenet also I imagine some adapters might not do caching of the returned values (ex when parsing headers) while others do. So sometimes acting as a simple method proxy might not be the best thing to do, but I guess that&apos;s a concern for the implementer of the protocol (or whatever is used)"><y>#</y><d>2019-05-09</d><h>15:09</h><w>mpenet</w>also I imagine some adapters might not do caching of the returned values (ex when parsing headers) while others do. So sometimes acting as a simple method proxy might not be the best thing to do, but I guess that&apos;s a concern for the implementer of the protocol (or whatever is used)</z><z id="t1557417489" t="ikitommi the def-derived-map seems to emit fast access functions for all fields (`.get__0`...). Immutant exposes the ServerExchange as a key so we could extend the Immutant Request Type to satisfy a new common protocol. I think this is best of both worlds: a map-like request to be compliant with the ring spec, a zero-copy construction and can be used via (the new) protocols for really fast access."><y>#</y><d>2019-05-09</d><h>15:58</h><w>ikitommi</w>the <code>def-derived-map</code> seems to emit fast access functions for all fields (`.get__0`...). Immutant exposes the <code>ServerExchange</code> as a key so we could extend the Immutant Request Type to satisfy a new common protocol. I think this is best of both worlds: a map-like request to be compliant with the ring spec, a zero-copy construction and can be used via (the new) protocols for really fast access.</z><z id="t1557417603" t="ikitommi Could add the new protocols to in reitit-ring and rewire the internal middleware &amp; interceptors to use those. And a new reitit-immutant module to make it fast with Immutant."><y>#</y><d>2019-05-09</d><h>16:00</h><w>ikitommi</w>Could add the new protocols to in reitit-ring and rewire the internal middleware &amp; interceptors to use those. And a new <code>reitit-immutant</code> module to make it fast with Immutant.</z><z id="t1557417672" t="ikitommi Aleph doesn&apos;t expose the Netty Request, so would need a PR for it to work. Could try that after seeing if the perf gains are visible in the real usage."><y>#</y><d>2019-05-09</d><h>16:01</h><w>ikitommi</w>Aleph doesn&apos;t expose the Netty Request, so would need a PR for it to work. Could try that after seeing if the perf gains are visible in the real usage.</z><z id="t1557417771" t="ikitommi getting the protocols into ring.... Wouldn&apos;t break anything and the default would be to make maps satisfy those. Would like to hear what [:attrs {:href &quot;/_/_/users/U0BKWMG5B&quot;}] thinks about this."><y>#</y><d>2019-05-09</d><h>16:02</h><w>ikitommi</w>getting the protocols into ring.... Wouldn&apos;t break anything and the default would be to make maps satisfy those. Would like to hear what <a>@weavejester</a> thinks about this.</z><z id="t1557417810" t="ikitommi btw, didn&apos;t know about __extmap , thanks."><y>#</y><d>2019-05-09</d><h>16:03</h><w>ikitommi</w>btw, didn&apos;t know about <code>__extmap</code>, thanks.</z><z id="t1557422271" t="weavejester [:attrs {:href &quot;/_/_/users/U055NJ5CC&quot;}] What protocols?"><y>#</y><d>2019-05-09</d><h>17:17</h><w>weavejester</w><a>@ikitommi</a> What protocols?</z><z id="t1557594984" t="Kari Marttila Is it possible to use Cognitect&apos;s AWS library with Ring? I reported one dependency issue when using both libraries in #aws channel."><y>#</y><d>2019-05-11</d><h>17:16</h><w>Kari Marttila</w>Is it possible to use Cognitect&apos;s AWS library with Ring? I reported one dependency issue when using both libraries in #aws channel.</z><z id="t1557600661" t="seancorfield It should be possible. You&apos;ll need to specify the version of Jetty directly in your dependencies so it overrides the default version in those two other libraries."><y>#</y><d>2019-05-11</d><h>18:51</h><w>seancorfield</w>It should be possible. You&apos;ll need to specify the version of Jetty directly in your dependencies so it overrides the default version in those two other libraries.</z><z id="t1557600696" t="seancorfield If the AWS library doesn&apos;t work with Jetty 9.4.x, specify 9.3.x and Ring should still work with that."><y>#</y><d>2019-05-11</d><h>18:51</h><w>seancorfield</w>If the AWS library doesn&apos;t work with Jetty 9.4.x, specify 9.3.x and Ring should still work with that.</z><z id="t1557605255" t="Kari Marttila Thanks [:attrs {:href &quot;/_/_/users/U04V70XH6&quot;}] ! I try it tomorrow!"><y>#</y><d>2019-05-11</d><h>20:07</h><w>Kari Marttila</w>Thanks <a>@seancorfield</a> ! I try it tomorrow!</z><z id="t1557648375" t="Kari Marttila It worked. [:attrs {:href &quot;/_/_/users/U04V70XH6&quot;}] : thanks for your help!"><y>#</y><d>2019-05-12</d><h>08:06</h><r>Kari Marttila</r>It worked. <a>@seancorfield</a>: thanks for your help!</z><z id="t1558042766" t="dogenpunk Does anyone here have any experience writing deployment descriptors for Weblogic? I need to write one for a simple ring app and honestly I&apos;m a bit lost."><y>#</y><d>2019-05-16</d><h>21:39</h><w>dogenpunk</w>Does anyone here have any experience writing deployment descriptors for Weblogic? I need to write one for a simple ring app and honestly I&apos;m a bit lost.</z><z id="t1558042823" t="dogenpunk And by &quot;a bit lost&quot; I should probably say &quot;completely lost&quot;"><y>#</y><d>2019-05-16</d><h>21:40</h><w>dogenpunk</w>And by &quot;a bit lost&quot; I should probably say &quot;completely lost&quot;</z><z id="t1558208763" t="sova-soars-the-sora [:attrs {:href &quot;/_/_/users/U0E0553EF&quot;}] do you know how you&apos;d proceed in java? i&apos;m not familiar with Weblogic."><y>#</y><d>2019-05-18</d><h>19:46</h><w>sova-soars-the-sora</w><a>@dogenpunk</a> do you know how you&apos;d proceed in java?  i&apos;m not familiar with Weblogic.</z><z id="t1559249621" t="jeaye I&apos;ve hit an odd issue. Using the default lein new compojure mp4 template and then modifying a bit, I&apos;ve created a 12 line handler ns which serves up some public resources. The only resource is an index.html which plays a video. This works perfectly in my web browser, and on my Android device. However, the video doesn&apos;t play on iOS. After enumerating every possible H.256 profile for the video, I realized it had nothing to do with the video itself and was instead due to the HTTP response given for the video. To my surprise, I can view the same site using npx http-server and it works on iOS just fine. So, what is ring doing wrong, or what am I doing wrong with ring such that videos on iOS won&apos;t work? To make this easy, a complete and absolutely minimal test case repo: https://github.com/jeaye/lein-ring-mp4"><y>#</y><d>2019-05-30</d><h>20:53</h><w>jeaye</w>I&apos;ve hit an odd issue. Using the default <code>lein new compojure mp4</code> template and then modifying a bit, I&apos;ve created a 12 line handler ns which serves up some public resources. The only resource is an <code>index.html</code> which plays a video. This works perfectly in my web browser, and on my Android device. However, the video doesn&apos;t play on iOS. After enumerating every possible H.256 profile for the video, I realized it had nothing to do with the video itself and was instead due to the HTTP response given for the video.

To my surprise, I can view the same site using <code>npx http-server</code> and it works on iOS just fine. So, what is ring doing wrong, or what am I doing wrong with ring such that videos on iOS won&apos;t work?

To make this easy, a complete and absolutely minimal test case repo: <a href="https://github.com/jeaye/lein-ring-mp4" target="_blank">https://github.com/jeaye/lein-ring-mp4</a></z><z id="t1559250017" t="jeaye More completely, the response from Ring: &lt; HTTP/1.1 200 OK &lt; Date: Thu, 30 May 2019 20:58:20 GMT &lt; Last-Modified: Thu, 30 May 2019 20:41:42 GMT &lt; Content-Type: video/mp4 &lt; X-XSS-Protection: 1; mode=block &lt; X-Frame-Options: SAMEORIGIN &lt; X-Content-Type-Options: nosniff &lt; Content-Length: 9048957 &lt; Server: Jetty(9.2.21.v20170120) And the response from npx http-server : &lt; HTTP/1.1 200 OK &lt; server: ecstatic-3.3.2 &lt; cache-control: max-age=3600 &lt; last-modified: Wed, 29 May 2019 22:13:55 GMT &lt; etag: W/&quot;681886-9048957-2019-05-29T22:13:55.245Z&quot; &lt; content-length: 9048957 &lt; content-type: video/mp4; charset=utf-8 &lt; Date: Thu, 30 May 2019 20:56:57 GMT &lt; Connection: keep-alive Note that the content type for the latter includes ; charset=utf-8 , which may be unrelated but is still noteworthy."><y>#</y><d>2019-05-30</d><h>21:00</h><w>jeaye</w>More completely, the response from Ring:

<pre>&lt; HTTP/1.1 200 OK
&lt; Date: Thu, 30 May 2019 20:58:20 GMT
&lt; Last-Modified: Thu, 30 May 2019 20:41:42 GMT
&lt; Content-Type: video/mp4
&lt; X-XSS-Protection: 1; mode=block
&lt; X-Frame-Options: SAMEORIGIN
&lt; X-Content-Type-Options: nosniff
&lt; Content-Length: 9048957
&lt; Server: Jetty(9.2.21.v20170120)
</pre>

And the response from <code>npx http-server</code>:

<pre>&lt; HTTP/1.1 200 OK
&lt; server: ecstatic-3.3.2
&lt; cache-control: max-age=3600
&lt; last-modified: Wed, 29 May 2019 22:13:55 GMT
&lt; etag: W/&quot;681886-9048957-2019-05-29T22:13:55.245Z&quot;
&lt; content-length: 9048957
&lt; content-type: video/mp4; charset=utf-8
&lt; Date: Thu, 30 May 2019 20:56:57 GMT
&lt; Connection: keep-alive
</pre>
Note that the content type for the latter includes <code>; charset=utf-8</code>, which may be unrelated but is still noteworthy.</z><z id="t1562166730" t="ivana can anyone suggest me a usable way for parsing/unparsing bodies, params, etc on both requests and responses using ring middleware? I found out and tried some libraries https://github.com/ngrunwald/ring-middleware-format https://github.com/metosin/muuntaja/ https://github.com/ring-clojure/ring-json but noone was usable for me. Or maybe I can not prepare them rigth. For example, I have one handler and add all middlewares for it: (def handler (-&gt; routes wrap-keyword-params wrap-json-params wrap-json-body wrap-json-response)) and it shows an error java.lang.IllegalArgumentException: Cannot open &lt;{&quot;p&quot; 1, &quot;q&quot; &quot;22&quot;}&gt; as an InputStream"><y>#</y><d>2019-07-03</d><h>15:12</h><w>ivana</w>can anyone suggest me a usable way for parsing/unparsing bodies, params, etc on both requests and responses using ring middleware? I found out and tried some libraries
<a href="https://github.com/ngrunwald/ring-middleware-format" target="_blank">https://github.com/ngrunwald/ring-middleware-format</a>
<a href="https://github.com/metosin/muuntaja/" target="_blank">https://github.com/metosin/muuntaja/</a>
<a href="https://github.com/ring-clojure/ring-json" target="_blank">https://github.com/ring-clojure/ring-json</a>
but noone was  usable for me. Or maybe I can not prepare them rigth. For example, I have one handler and add all middlewares for it:
<pre>(def handler (-&gt; routes
                     wrap-keyword-params
                     wrap-json-params
                     wrap-json-body
                     wrap-json-response))
</pre>
and it shows an error <code>java.lang.IllegalArgumentException: Cannot open &lt;{&quot;p&quot; 1, &quot;q&quot; &quot;22&quot;}&gt; as an InputStream</code></z><z id="t1562174936" t="seancorfield [:attrs {:href &quot;/_/_/users/U0A6H3MFT&quot;}] I don&apos;t think you can have both wrap-json-params and wrap-json-body -- the docs indicate they are alternatives."><y>#</y><d>2019-07-03</d><h>17:28</h><w>seancorfield</w><a>@ivana</a> I don&apos;t think you can have both <code>wrap-json-params</code> and <code>wrap-json-body</code> -- the docs indicate they are alternatives.</z><z id="t1562180345" t="ikitommi (-&gt; routes muuntaja.middleware/wrap-format) should work. handles all of json, edn &amp; transit. Your error suggest you have multiple formatters in the chain."><y>#</y><d>2019-07-03</d><h>18:59</h><w>ikitommi</w><pre>(-&gt; routes muuntaja.middleware/wrap-format)
</pre>
should work. handles all of json, edn &amp; transit. Your error suggest you have multiple formatters in the chain.</z><z id="t1562180415" t="ikitommi ring is not the easiest to debug the mw chain, what mws are there and how they transform the request &amp; response"><y>#</y><d>2019-07-03</d><h>19:00</h><w>ikitommi</w>ring is not the easiest to debug the mw chain, what mws are there and how they transform the request &amp; response</z><z id="t1562243694" t="ivana ok, thanks, now I find one mw which did all the job expect query params, but I can parse them myself outside mw cause this is simple string"><y>#</y><d>2019-07-04</d><h>12:34</h><w>ivana</w>ok, thanks, now I find one mw which did all the job expect query params, but I can parse them myself outside mw cause this is simple string</z><z id="t1562412267" t="ikitommi [:attrs {:href &quot;/_/_/users/U0BKWMG5B&quot;}] wrote about the protocols I was mumbling about: https://github.com/ring-clojure/ring/issues/372"><y>#</y><d>2019-07-06</d><h>11:24</h><w>ikitommi</w><a>@weavejester</a> wrote about the protocols I was mumbling about: <a href="https://github.com/ring-clojure/ring/issues/372" target="_blank">https://github.com/ring-clojure/ring/issues/372</a></z><z id="t1563837202" t="allentiak Hi, Would anyone know of a boot-based ring tutorial? All the ones I can find use lein..."><y>#</y><d>2019-07-22</d><h>23:13</h><w>allentiak</w>Hi,
Would anyone know of a boot-based ring tutorial?
All the ones I can find use lein...</z><z id="t1565774917" t="iGEL I finally want to try the new Clojure tooling (deps.edn etc), but I fail already with running a developent server. Is there something like lein-ring, doing code reloading etc ?"><y>#</y><d>2019-08-14</d><h>09:28</h><w>iGEL</w>I finally want to try the new Clojure tooling (deps.edn etc), but I fail already with running a developent server. Is there something like lein-ring, doing code reloading etc ?</z><z id="t1568827008" t="Mattias Hey all, please have patience with a confused question. This is Clojure noob mode... making a simple web app with Ring and not getting then anti-forgery token set (it gets the ‚ÄúUnbound...‚Äù value). Not sure how to go about debugging."><y>#</y><d>2019-09-18</d><h>17:16</h><w>Mattias</w>Hey all, please have patience with a confused question. This is Clojure noob mode... making a simple web app with Ring and not getting then anti-forgery token set (it gets the ‚ÄúUnbound...‚Äù value). Not sure how to go about debugging.</z><z id="t1568827068" t="Mattias I have a simple tutorial app (x y coords thing) that works as expected... I‚Äôm obviously doing something silly but have a hard time figuring it out üò¨"><y>#</y><d>2019-09-18</d><h>17:17</h><w>Mattias</w>I have a simple tutorial app (x y coords thing) that works as expected... I‚Äôm obviously doing something silly but have a hard time figuring it out <b>üò¨</b></z><z id="t1568834654" t="jumar [:attrs {:href &quot;/_/_/users/UCW3QKWKT&quot;}] do you mean *anti-forgery-token* . Can you shared your code and where exactly are you hitting the issue?"><y>#</y><d>2019-09-18</d><h>19:24</h><r>jumar</r><a>@UCW3QKWKT</a> do you mean <code>*anti-forgery-token*</code>.
Can you shared your code and where exactly are you hitting the issue?</z><z id="t1568839252" t="Mattias Thanks, I‚Äôll try to share the code in some sensible way. Not many lines involved, at least... üôÇ"><y>#</y><d>2019-09-18</d><h>20:40</h><r>Mattias</r>Thanks, I‚Äôll try to share the code in some sensible way. Not many lines involved, at least... <b>üôÇ</b></z><z id="t1568873349" t="Mattias Follow up - turns out, after a silly mistake was fixed, the next problem was I keep my FireFox in turbo-break-everything-privacy-mode. I‚Äôm actually a bit happy about that, but I haven‚Äôt studied what they do with the recent releases so... more to learn. üòÖ"><y>#</y><d>2019-09-19</d><h>06:09</h><r>Mattias</r>Follow up - turns out, after a silly mistake was fixed, the next problem was I keep my FireFox in turbo-break-everything-privacy-mode. I‚Äôm actually a bit happy about that, but I haven‚Äôt studied what they do with the recent releases so... more to learn. <b>üòÖ</b></z><z id="t1570474407" t="Steven Zhou Could anyone take a look at this issue? https://github.com/ring-clojure/ring/issues/379 I‚Äôm trying to do mutually auth TLS for my HTTPS server with the help of ring-jetty-adapter , but having some troubles getting client certs in my requests."><y>#</y><d>2019-10-07</d><h>18:53</h><w>Steven Zhou</w>Could anyone take a look at this issue?
<a href="https://github.com/ring-clojure/ring/issues/379" target="_blank">https://github.com/ring-clojure/ring/issues/379</a>

I‚Äôm trying to do mutually auth TLS for my HTTPS server with the help of <code>ring-jetty-adapter</code>, but having some troubles getting client certs in my requests.</z><z id="t1570544303" t="weavejester [:attrs {:href &quot;/_/_/users/U0HK23V08&quot;}] I‚Äôm afraid I don‚Äôt have time to delve into the issue, but I will accept a PR that resolves it if it turns out to be a bug."><y>#</y><d>2019-10-08</d><h>14:18</h><w>weavejester</w><a>@stevenz</a> I‚Äôm afraid I don‚Äôt have time to delve into the issue, but I will accept a PR that resolves it if it turns out to be a bug.</z><z id="t1570574245" t="Steven Zhou [:attrs {:href &quot;/_/_/users/U0BKWMG5B&quot;}] This PR fixed my issue, but I also feel the tests could be better. Do you want to take a look when you get a chance? https://github.com/ring-clojure/ring/pull/380"><y>#</y><d>2019-10-08</d><h>22:37</h><w>Steven Zhou</w><a>@weavejester</a> This PR fixed my issue, but I also feel the tests could be better. Do you want to take a look when you get a chance?
<a href="https://github.com/ring-clojure/ring/pull/380" target="_blank">https://github.com/ring-clojure/ring/pull/380</a></z><z id="t1570574483" t="weavejester [:attrs {:href &quot;/_/_/users/U0HK23V08&quot;}] That looks fine, I‚Äôll take a closer look later, but rather than trying to catch the exceptions, you might want to set :throw-exceptions false and instead check the response directly."><y>#</y><d>2019-10-08</d><h>22:41</h><w>weavejester</w><a>@stevenz</a> That looks fine, I‚Äôll take a closer look later, but rather than trying to catch the exceptions, you might want to set <code>:throw-exceptions false</code> and instead check the response directly.</z><z id="t1570574632" t="Steven Zhou That‚Äôs a good suggestion! I‚Äôll push a commit to address that."><y>#</y><d>2019-10-08</d><h>22:43</h><w>Steven Zhou</w>That‚Äôs a good suggestion! I‚Äôll push a commit to address that.</z><z id="t1570636743" t="mgrbyte Hi! does anyone know if there an equivilent to lein ring for CLI tools ?"><y>#</y><d>2019-10-09</d><h>15:59</h><w>mgrbyte</w>Hi!  does anyone know if there an equivilent to <code>lein ring</code> for CLI tools ?</z><z id="t1570649920" t="seancorfield I never used lein ring back when I was using Leiningen anyway."><y>#</y><d>2019-10-09</d><h>19:38</h><w>seancorfield</w>I never used <code>lein ring</code> back when I was using Leiningen anyway.</z><z id="t1570649956" t="seancorfield I just start my HTTP server in my -main function and used to lein run -- which is now clojure -m my.entry.point"><y>#</y><d>2019-10-09</d><h>19:39</h><w>seancorfield</w>I just start my HTTP server in my <code>-main</code> function and used to <code>lein run</code> -- which is now <code>clojure -m my.entry.point</code></z><z id="t1570649977" t="seancorfield [:attrs {:href &quot;/_/_/users/U08715BSS&quot;}] What do you actually rely on lein ring for?"><y>#</y><d>2019-10-09</d><h>19:39</h><w>seancorfield</w><a>@mgrbyte</a> What do you actually rely on <code>lein ring</code> for?</z><z id="t1571220313" t="mgrbyte Hi, sorry for the delay in reply (long weekend away). Using lein ring for starting a ring service (jetty-adapter under the hood i guess), with the init and handler hooks (creating the db connection in init ). Currently using mount . I&apos;m guessing I could remove the use of lein ring just by doing mount/start before jetty-adapter in main, then handling db connectivity in some mw :thinking_face:"><y>#</y><d>2019-10-16</d><h>10:05</h><r>mgrbyte</r>Hi, sorry for the delay in reply (long weekend away).
Using lein ring for starting a ring service (jetty-adapter under the hood i guess), with the <code>init</code> and <code>handler</code> hooks (creating the db connection in <code>init</code>).
Currently using <code>mount</code>.
I&apos;m guessing I could remove the use of <code>lein ring</code> just by doing <code>mount/start</code> before <code>jetty-adapter</code> in main, then handling db connectivity in some mw <b>:thinking_face:</b></z><z id="t1571240697" t="seancorfield That sounds simpler -- less &quot;magic&quot; via plugins."><y>#</y><d>2019-10-16</d><h>15:44</h><r>seancorfield</r>That sounds simpler -- less &quot;magic&quot; via plugins.</z><z id="t1570650060" t="seancorfield We use Component anyway so our HTTP server is wrapped up with a start / stop lifecycle anyway, which makes it really easy to work with from the REPL."><y>#</y><d>2019-10-09</d><h>19:41</h><w>seancorfield</w>We use Component anyway so our HTTP server is wrapped up with a <code>start</code> / <code>stop</code> lifecycle anyway, which makes it really easy to work with from the REPL.</z><z id="t1570787329" t="Shaitan Hello! could someone advice me a good book where Ring and Compojure are in detail please üòâ ?"><y>#</y><d>2019-10-11</d><h>09:48</h><w>Shaitan</w>Hello! could someone advice me a good book where Ring and Compojure are in detail please <b>üòâ</b> ?</z><z id="t1570809099" t="jumar I&apos;d say your best bet is online documentation."><y>#</y><d>2019-10-11</d><h>15:51</h><w>jumar</w>I&apos;d say your best bet is online documentation.</z><z id="t1570809129" t="jumar Perhaps Web Development with Clojure has something useful too"><y>#</y><d>2019-10-11</d><h>15:52</h><w>jumar</w>Perhaps Web Development with Clojure has something useful too</z><z id="t1570812544" t="seancorfield The &quot;Web Development with Clojure&quot; book uses reitit for routing. It doesn&apos;t mention compojure anywhere (I just searched the PDF of the 3rd edition)."><y>#</y><d>2019-10-11</d><h>16:49</h><w>seancorfield</w>The &quot;Web Development with Clojure&quot; book uses <code>reitit</code> for routing. It doesn&apos;t mention <code>compojure</code> anywhere (I just searched the PDF of the 3rd edition).</z><z id="t1570819052" t="jumar I thought about the second edition - that one has some ring and compojure, especially in Chapter 2, Although it&apos;s a bit outdated I&apos;d say that the core concepts stay same"><y>#</y><d>2019-10-11</d><h>18:37</h><w>jumar</w>I thought about the second edition - that one has some ring and compojure, especially in Chapter 2,
Although it&apos;s a bit outdated I&apos;d say that the core concepts stay same</z><z id="t1570827942" t="seancorfield Ah yes, I think I remember Dmitri saying that they switched to reitit for the 3rd ed so it would make sense that the 2d ed still uses Compojure."><y>#</y><d>2019-10-11</d><h>21:05</h><w>seancorfield</w>Ah yes, I think I remember Dmitri saying that they switched to <code>reitit</code> for the 3rd ed so it would make sense that the 2d ed still uses Compojure.</z><z id="t1570979329" t="Shaitan how to give status response 500 from Compojure? I can not see any function for that..."><y>#</y><d>2019-10-13</d><h>15:08</h><w>Shaitan</w>how to give status response 500 from Compojure? I can not see any function for that...</z><z id="t1570979374" t="jumar How about just {:status 500} ?"><y>#</y><d>2019-10-13</d><h>15:09</h><w>jumar</w>How about just <code>{:status 500}</code> ?</z><z id="t1570979406" t="Shaitan is there any idiomatic way? :thinking_face:"><y>#</y><d>2019-10-13</d><h>15:10</h><w>Shaitan</w>is there any idiomatic way? <b>:thinking_face:</b></z><z id="t1570979476" t="jumar What do you mean by idiomatic - a ring response is a map so I&apos;d say it&apos;s idiomatic. Perhaps I&apos;d make sure that headers and body is set too but i&apos;m not 100% sure if that matters in this case (-&gt; (ring.util.response/response) (assoc :status 500)) "><y>#</y><d>2019-10-13</d><h>15:11</h><w>jumar</w>What do you mean by idiomatic - a ring response is a map so I&apos;d say it&apos;s idiomatic.
Perhaps I&apos;d make sure that headers and body is set too but i&apos;m not 100% sure if that matters in this case
<pre>(-&gt; (ring.util.response/response) (assoc :status 500))
</pre></z><z id="t1570991005" t="ikitommi there is also https://github.com/metosin/ring-http-response"><y>#</y><d>2019-10-13</d><h>18:23</h><w>ikitommi</w>there is also <a href="https://github.com/metosin/ring-http-response" target="_blank">https://github.com/metosin/ring-http-response</a></z><z id="t1571184645" t="cch1 Is anybody using async handlers in an uberwar with Tomcat? It works fine for us when run with lein ring server but when running out of a servlet under Tomcat, we see this : 15-Oct-2019 20:17:22.932 WARNING [http-nio-8080-exec-3] org.apache.catalina.connector.Request.startAsync Unable to start async because the following classes in the processing chain do not support async [apij.servlet] "><y>#</y><d>2019-10-16</d><h>00:10</h><w>cch1</w>Is anybody using async handlers in an uberwar with Tomcat?  It works fine for us when run with <code>lein ring server</code> but when running out of a servlet under Tomcat, we see this :
<pre>15-Oct-2019 20:17:22.932 WARNING [http-nio-8080-exec-3] org.apache.catalina.connector.Request.startAsync Unable to start async because the following classes in the processing chain do not support async [apij.servlet]
</pre></z><z id="t1572892138" t="dangercoder Hi, Is it possible to set a cookie on redirect? I have a &quot;/callback&quot;-route which I want to redirect to &quot;/&quot; and set an cookie. I have wrapped my routes with the wrap-cookies middleware. I return this from my callback-route as a response but it does not work. (Redirect works but not cookie). {:status 302, :headers {&quot;Location&quot; &quot;/&quot;}, :body &quot;&quot;, :cookies {:t {:value &quot;1337&quot;}}} "><y>#</y><d>2019-11-04</d><h>18:28</h><w>dangercoder</w>Hi, Is it possible to set a cookie on redirect?

I have a &quot;/callback&quot;-route which I want to redirect to &quot;/&quot; and set an cookie. I have wrapped my routes with the wrap-cookies middleware. I return this from my callback-route as a response but it does not work. (Redirect works but not cookie).


<pre>{:status 302, :headers {&quot;Location&quot; &quot;/&quot;}, :body &quot;&quot;, :cookies {:t {:value &quot;1337&quot;}}}
</pre></z><z id="t1572893708" t="seancorfield [:attrs {:href &quot;/_/_/users/UBN9SNVB4&quot;}] This is not something that all HTTP clients will honor, even if you can get Ring to do it, so I&apos;d be wary of relying on it."><y>#</y><d>2019-11-04</d><h>18:55</h><w>seancorfield</w><a>@jarvinenemil</a> This is not something that all HTTP clients will honor, even if you can get Ring to do it, so I&apos;d be wary of relying on it.</z><z id="t1572893862" t="seancorfield It used to be that some popular browsers ignored cookies on a redirect response. Chromium had a long-standing bug report about this and marked it WontFix / Permanent Bug."><y>#</y><d>2019-11-04</d><h>18:57</h><w>seancorfield</w>It used to be that some popular browsers ignored cookies on a redirect response. Chromium had a long-standing bug report about this and marked it WontFix / Permanent Bug.</z><z id="t1572893925" t="dangercoder Yeah I found the Chromium bug as well. I&apos;ll come up with a different strategy"><y>#</y><d>2019-11-04</d><h>18:58</h><w>dangercoder</w>Yeah I found the Chromium bug as well. I&apos;ll come up with a different strategy</z><z id="t1572960895" t="mping I think the spec doesnt allow for cookies on redirect"><y>#</y><d>2019-11-05</d><h>13:34</h><w>mping</w>I think the spec doesnt allow for cookies on redirect</z><z id="t1572961042" t="mping Hmm can&apos;t find anything on that... Maybe I&apos;m wrong."><y>#</y><d>2019-11-05</d><h>13:37</h><w>mping</w>Hmm can&apos;t find anything on that... Maybe I&apos;m wrong.</z><z id="t1573461455" t="clarice Hi there, are any of you able to help me with the following https://stackoverflow.com/questions/58797701/why-are-my-endpoints-not-passing-headers-cookies-across-and-responding-as-expect ?"><y>#</y><d>2019-11-11</d><h>08:37</h><w>clarice</w>Hi there, are any of you able to help me with the following <a href="https://stackoverflow.com/questions/58797701/why-are-my-endpoints-not-passing-headers-cookies-across-and-responding-as-expect" target="_blank">https://stackoverflow.com/questions/58797701/why-are-my-endpoints-not-passing-headers-cookies-across-and-responding-as-expect</a>?</z><z id="t1573497655" t="seancorfield [:attrs {:href &quot;/_/_/users/UCM1FJA4E&quot;}] A similar question popped up here about a week ago and I said https://clojurians.slack.com/archives/C0A5GSC6T/p1572893708023900"><y>#</y><d>2019-11-11</d><h>18:40</h><w>seancorfield</w><a>@cbillowes</a> A similar question popped up here about a week ago and I said <a href="https://clojurians.slack.com/archives/C0A5GSC6T/p1572893708023900" target="_blank">https://clojurians.slack.com/archives/C0A5GSC6T/p1572893708023900</a></z><z id="t1573539854" t="clarice Thanks [:attrs {:href &quot;/_/_/users/U04V70XH6&quot;}] !"><y>#</y><d>2019-11-12</d><h>06:24</h><r>clarice</r>Thanks <a>@seancorfield</a>!</z><z id="t1573498324" t="paulspencerwilliams I did post over on #clojure but perhaps my question was a tad specific, and thought it might fit better in this channel. Is there any Ring middleware or similar that can validate OAuth2 / OpenId Connect JWT‚Äôs for resource servers? I can always build my own middleware wrapping something like Okta‚Äôs JwtVerifier, but I‚Äôd have thought there was a fair bit of demand for oauth2 securing microservices etc. In particular, I‚Äôm looking for functionality similar to the following code which, based on issuer pulls down the Authentication Server‚Äôs public keys and checks signature: AccessTokenVerifier jwtVerifier = JwtVerifiers.accessTokenVerifierBuilder() .setIssuer(&quot;&quot;) .setAudience(&quot;&quot;) // defaults to &apos;&apos; .setConnectionTimeout(Duration.ofSeconds(1)) // defaults to 1s .setReadTimeout(Duration.ofSeconds(1)) // defaults to 1s .build(); try { Jwt jwt = jwtVerifier.decode(&quot;jwt-token-here&quot;); System.out.print(jwt.getClaims().get(&quot;upn&quot;)); } catch (JwtVerificationException e) { e.printStackTrace(); } "><y>#</y><d>2019-11-11</d><h>18:52</h><w>paulspencerwilliams</w>I did post over on #clojure but perhaps my question was a tad specific, and thought it might fit better in this channel. Is there any Ring middleware or similar that can validate OAuth2 / OpenId Connect JWT‚Äôs for resource servers? I can always build my own middleware wrapping something like Okta‚Äôs JwtVerifier, but I‚Äôd have thought there was a fair bit of demand for oauth2 securing microservices etc. In particular, I‚Äôm looking for functionality similar to the following code which, based on issuer pulls down the Authentication Server‚Äôs public keys and checks signature:
<pre>AccessTokenVerifier jwtVerifier = JwtVerifiers.accessTokenVerifierBuilder()
                .setIssuer(&quot;&quot;)
                .setAudience(&quot;&quot;)                // defaults to &apos;&apos;
                .setConnectionTimeout(Duration.ofSeconds(1)) // defaults to 1s
                .setReadTimeout(Duration.ofSeconds(1))       // defaults to 1s
                .build();
        try {
            Jwt jwt = jwtVerifier.decode(&quot;jwt-token-here&quot;);
            System.out.print(jwt.getClaims().get(&quot;upn&quot;));
        } catch (JwtVerificationException e) {
            e.printStackTrace();
        }
</pre></z><z id="t1573539854" t="clarice Thanks [:attrs {:href &quot;/_/_/users/U04V70XH6&quot;}] !"><y>#</y><d>2019-11-12</d><h>06:24</h><w>clarice</w>Thanks <a>@seancorfield</a>!</z><z id="t1573548833" t="iarenaza [:attrs {:href &quot;/_/_/users/U064B4L0K&quot;}] We built this library ( https://github.com/magnetcoop/buddy-auth.jwt-oidc ) to use it from Duct, but if you strip the Duct/Integrant specific parts, it will do what you are looking for."><y>#</y><d>2019-11-12</d><h>08:53</h><w>iarenaza</w><a>@paulspencerwilliams</a> We built this library (<a href="https://github.com/magnetcoop/buddy-auth.jwt-oidc" target="_blank">https://github.com/magnetcoop/buddy-auth.jwt-oidc</a>) to use it from Duct, but if you strip the Duct/Integrant specific parts, it will do what you are looking for.</z><z id="t1573550172" t="paulspencerwilliams oh brilliant [:attrs {:href &quot;/_/_/users/U8T05KBEW&quot;}] , that&apos;s tonight&apos;s activity sorted!"><y>#</y><d>2019-11-12</d><h>09:16</h><w>paulspencerwilliams</w>oh brilliant <a>@iarenaza</a>, that&apos;s tonight&apos;s activity sorted!</z><z id="t1574259213" t="rickmoynihan Does anyone know of if there‚Äôs a set of CSRF middleware that is split into two middlewares, one for providing the token, and the other for enforcing it? It‚Äôs a problem for us that https://github.com/ring-clojure/ring-anti-forgery complects these two responsibilities into one middleware."><y>#</y><d>2019-11-20</d><h>14:13</h><w>rickmoynihan</w>Does anyone know of if there‚Äôs a set of CSRF middleware that is split into two middlewares, one for providing the token, and the other for enforcing it?

It‚Äôs a problem for us that <a href="https://github.com/ring-clojure/ring-anti-forgery" target="_blank">https://github.com/ring-clojure/ring-anti-forgery</a> complects these two responsibilities into one middleware.</z><z id="t1575297137" t="Pavel Klav√≠k Hi, what is the common approach to deal with session timeouts? For instance when a user wake up laptop after a while. How should I detect on the client that session timeouted?"><y>#</y><d>2019-12-02</d><h>14:32</h><w>Pavel Klav√≠k</w>Hi, what is the common approach to deal with session timeouts? For instance when a user wake up laptop after a while. How should I detect on the client that session timeouted?</z><z id="t1575327692" t="weavejester You can store a timestamp when the session is created, and delete the session if it exceeds the timestamp."><y>#</y><d>2019-12-02</d><h>23:01</h><r>weavejester</r>You can store a timestamp when the session is created, and delete the session if it exceeds the timestamp.</z><z id="t1575437560" t="Pavel Klav√≠k [:attrs {:href &quot;/_/_/users/U0BKWMG5B&quot;}] But that is on the server, isn&apos;t it? Should I set a timeout on the client as well? How to deal with the situation when session is extended after a user action?"><y>#</y><d>2019-12-04</d><h>05:32</h><r>Pavel Klav√≠k</r><a>@U0BKWMG5B</a> But that is on the server, isn&apos;t it? Should I set a timeout on the client as well? How to deal with the situation when session is extended after a user action?</z><z id="t1575544267" t="weavejester You can also set a timeout on the client. Some sites do, some sites don‚Äôt. If you want to, you‚Äôd take the timestamp from the session and generate some javascript to trigger a function after a timeout. To extend the timeout, you can just update the session value on user action."><y>#</y><d>2019-12-05</d><h>11:11</h><r>weavejester</r>You can also set a timeout on the client. Some sites do, some sites don‚Äôt. If you want to, you‚Äôd take the timestamp from the session and generate some javascript to trigger a function after a timeout. To extend the timeout, you can just update the session value on user action.</z><z id="t1576019765" t="Pavel Klav√≠k How do I get a timestamp from the session? How is it stored on the client?"><y>#</y><d>2019-12-10</d><h>23:16</h><r>Pavel Klav√≠k</r>How do I get a timestamp from the session? How is it stored on the client?</z><z id="t1576019885" t="Pavel Klav√≠k [:attrs {:href &quot;/_/_/users/U0BKWMG5B&quot;}] Our application is something close to Google Docs, so it is a tool which users should use over long periods of time. Ideally, after waking up laptop, it should get refreshed automatically and be ready to work."><y>#</y><d>2019-12-10</d><h>23:18</h><r>Pavel Klav√≠k</r><a>@U0BKWMG5B</a> Our application is something close to Google Docs, so it is a tool which users should use over long periods of time. Ideally, after waking up laptop, it should get refreshed automatically and be ready to work.</z><z id="t1576026351" t="weavejester You just generate the current date or timestamp and add it to the session. Are you asking how to generate a time in Clojure, or how to store things in the session?"><y>#</y><d>2019-12-11</d><h>01:05</h><r>weavejester</r>You just generate the current date or timestamp and add it to the session. Are you asking how to generate a time in Clojure, or how to store things in the session?</z><z id="t1576061323" t="Pavel Klav√≠k So I store the time in the session on the server. How do I access it on the client?"><y>#</y><d>2019-12-11</d><h>10:48</h><r>Pavel Klav√≠k</r>So I store the time in the session on the server. How do I access it on the client?</z><z id="t1576086659" t="weavejester You can generate a &lt;script&gt; tag in order to pass additional information to your client scripts. Or have the client make an Ajax call."><y>#</y><d>2019-12-11</d><h>17:50</h><r>weavejester</r>You can generate a <code>&lt;script&gt;</code> tag in order to pass additional information to your client scripts. Or have the client make an Ajax call.</z><z id="t1576116937" t="Pavel Klav√≠k Ok, makes sense, I will try to build some prototype and will see how it works. Thanks."><y>#</y><d>2019-12-12</d><h>02:15</h><r>Pavel Klav√≠k</r>Ok, makes sense, I will try to build some prototype and will see how it works. Thanks.</z><z id="t1575432344" t="cch1 Is it possible to get a jetty-based server using wrap-ssl-redirect to redirect http requests to https and employ dynamically assigned ports? There is a chicken-and-egg problem in that the handler (including the middleware) must be provided to create the server, but the port is not known until after the server starts."><y>#</y><d>2019-12-04</d><h>04:05</h><w>cch1</w>Is it possible to get a jetty-based server using <code>wrap-ssl-redirect</code> to redirect http requests to https and employ dynamically assigned ports?  There is a chicken-and-egg problem in that the handler (including the middleware) must be provided to create the server, but the port is not known until after the server starts.</z><z id="t1575432376" t="cch1 Jetty itself (as of version 9) appears to get around this problem by injecting a sort of middleware (the SecuredRedirectHandler ) that has access to the resolved ssl port in the HttpConfiguration."><y>#</y><d>2019-12-04</d><h>04:06</h><w>cch1</w>Jetty itself (as of version 9) appears to get around this problem by injecting a sort of middleware (the <code>SecuredRedirectHandler</code>) that has access to the resolved ssl port in the HttpConfiguration.</z><z id="t1577789309" t="Santiago I&apos;m using compojure for an API. All is fine except I can&apos;t get access to the original JSON payload from POST requests, which I need for verifying requests. Is this done by changing middlewear?"><y>#</y><d>2020-12-31</d><h>10:48</h><w>Santiago</w>I&apos;m using compojure for an API. All is fine except I can&apos;t get access to the original JSON payload from POST requests, which I need for verifying requests. Is this done by changing middlewear?</z><z id="t1577807534" t="AJ Jaro [:attrs {:href &quot;/_/_/users/UFPEDL1LY&quot;}] Are you capturing the request argument to the route? For a GET macro, they should be in params and for a POST they should be in body (GET &quot;/basic/route/structure&quot; request (let [params (:params request)] ...)) "><y>#</y><d>2020-12-31</d><h>15:52</h><w>AJ Jaro</w><a>@slack.jcpsantiago</a> Are you capturing the <code>request</code> argument to the route? For a <code>GET</code> macro, they should be in <code>params</code> and for a <code>POST</code> they should be in <code>body</code>

<pre>(GET &quot;/basic/route/structure&quot; request
  (let [params (:params request)]
    ...))</pre>
</z><z id="t1577808956" t="Santiago [:attrs {:href &quot;/_/_/users/UGMAVSMUM&quot;}] Yes, I&apos;m doing that already. What I need is the raw json payload, not the parsed payload as a clojure structure"><y>#</y><d>2020-12-31</d><h>16:15</h><w>Santiago</w><a>@ajarosinski</a>  Yes, I&apos;m doing that already. What I need is the raw json payload, not the parsed payload as a clojure structure</z><z id="t1577809301" t="AJ Jaro [:attrs {:href &quot;/_/_/users/UFPEDL1LY&quot;}] Ah, hmm. That definitely is different than what I responded with, sorry. I don‚Äôt know exactly, but I have used the wrap-routes to add a middleware function and I think that still has the payload as a clojure structure. What are you trying to accomplish with the raw JSON instead of using the clojure structure?"><y>#</y><d>2020-12-31</d><h>16:21</h><w>AJ Jaro</w><a>@slack.jcpsantiago</a> Ah, hmm. That definitely is different than what I responded with, sorry. I don‚Äôt know exactly, but I have used the <code>wrap-routes</code> to add a middleware function and I think that still has the payload as a clojure structure.

What are you trying to accomplish with the raw JSON instead of using the clojure structure?</z><z id="t1577809861" t="Santiago I need to verify a request from Slack. To do that I need to build a signature from the raw json plus a timestamp they send in the header"><y>#</y><d>2020-12-31</d><h>16:31</h><w>Santiago</w>I need to verify a request from Slack. To do that I need to build a signature from the raw json plus a timestamp they send in the header</z><z id="t1577810764" t="ikitommi [:attrs {:href &quot;/_/_/users/UFPEDL1LY&quot;}] you need to add a custom middleware that slurps the :body InputStream, places the slurped (raw) string under some key, e.g. :raw-body and either a) parses the body itself from JSON into :body-params , :json-params (or whatever your application expects) or b) re-creates the InputStream from the parsed body and let‚Äôs the normal body-parsing middleware read it."><y>#</y><d>2020-12-31</d><h>16:46</h><w>ikitommi</w><a>@slack.jcpsantiago</a> you need to add a custom middleware that slurps the <code>:body</code> InputStream, places the slurped (raw) string under some key, e.g. <code>:raw-body</code>  and either a) parses the body itself from JSON into <code>:body-params</code>, <code>:json-params</code> (or whatever your application expects) or b) re-creates the InputStream from the parsed body and let‚Äôs the normal body-parsing middleware read it.</z><z id="t1577810813" t="ikitommi (fn [handler] (fn [request] (let [raw-body (slurp (:body request)) request&apos; (-&gt; request (assoc :raw-body raw-body) (assoc :body (ByteArrayInputStream. raw-body)))] (handler request&apos;))))"><y>#</y><d>2020-12-31</d><h>16:46</h><w>ikitommi</w><pre>(fn [handler]
  (fn [request]
    (let [raw-body (slurp (:body request))
          request&apos; (-&gt; request
                       (assoc :raw-body raw-body)
                       (assoc :body (ByteArrayInputStream. raw-body)))]
      (handler request&apos;))))</pre></z><z id="t1577810907" t="ikitommi something like that."><y>#</y><d>2020-12-31</d><h>16:48</h><w>ikitommi</w>something like that.</z><z id="t1577815052" t="Santiago [:attrs {:href &quot;/_/_/users/U055NJ5CC&quot;}] thanks! I&apos;ll try that out"><y>#</y><d>2020-12-31</d><h>17:57</h><w>Santiago</w><a>@ikitommi</a> thanks! I&apos;ll try that out</z><z id="t1578592394" t="Drew Verlee ring.util.response/header seems to take one header (key value). Whats the way to add multiple at once?"><y>#</y><d>2020-01-09</d><h>17:53</h><w>Drew Verlee</w>ring.util.response/header seems to take one header (key value). Whats the way to add multiple at once?</z><z id="t1578860344" t="weavejester Make the value a collection. e.g. {&quot;X-Foo&quot; [&quot;bar&quot; &quot;baz&quot;]}"><y>#</y><d>2020-01-12</d><h>20:19</h><r>weavejester</r>Make the value a collection. e.g. <code>{&quot;X-Foo&quot; [&quot;bar&quot; &quot;baz&quot;]}</code></z><z id="t1578925228" t="Drew Verlee ah."><y>#</y><d>2020-01-13</d><h>14:20</h><r>Drew Verlee</r>ah.</z><z id="t1578592695" t="Drew Verlee hmm it looks like you can just assoc in (assoc-in (handler request) [:headers &lt;header&gt;] &lt;value&gt;))`"><y>#</y><d>2020-01-09</d><h>17:58</h><w>Drew Verlee</w>hmm it looks like you can just assoc in <code>(assoc-in</code>(handler request) [:headers &lt;header&gt;] &lt;value&gt;))`</z><z id="t1578592791" t="Drew Verlee I mean, thats just what the header function does. i dont know what i expected."><y>#</y><d>2020-01-09</d><h>17:59</h><w>Drew Verlee</w>I mean, thats just what the header function does. i dont know what i expected.</z><z id="t1579552050" t="robertfw Is there a way to close a connection and not return a response?"><y>#</y><d>2020-01-20</d><h>20:27</h><w>robertfw</w>Is there a way to close a connection and not return a response?</z><z id="t1579552066" t="robertfw I am using async handlers"><y>#</y><d>2020-01-20</d><h>20:27</h><w>robertfw</w>I am using async handlers</z><z id="t1579552238" t="robertfw My best guess currently is that I&apos;d need to write my own jetty adapter but hoping there is something simpler"><y>#</y><d>2020-01-20</d><h>20:30</h><w>robertfw</w>My best guess currently is that I&apos;d need to write my own jetty adapter but hoping there is something simpler</z><z id="t1580139142" t="yogidevbear Morning üôÇ I read somewhere recently (it might have been an old post as I can&apos;t find it now) that Ring only supported synchronous handlers, but I can see examples in the docs showing the use of middleware to add support for asynchronous handlers. Something along the lines of: (defn content-type-response [response content-type] (assoc-in response [:headers &quot;Content-Type&quot;] content-type)) (defn wrap-content-type [handler content-type] (fn ([request] (-&gt; (handler request) (content-type-response content-type))) ([request respond raise] (handler request #(respond (content-type-response % content-type)) raise)))) Is this example the currently supported/preferred method for adding asynchronous handler support within ring projects or is there some other method that is/will be supported with ring core?"><y>#</y><d>2020-01-27</d><h>15:32</h><w>yogidevbear</w>Morning <b>üôÇ</b> I read somewhere recently (it might have been an old post as I can&apos;t find it now) that Ring only supported synchronous handlers, but I can see examples in the docs showing the use of middleware to add support for asynchronous handlers. Something along the lines of:
<pre>(defn content-type-response [response content-type]
  (assoc-in response [:headers &quot;Content-Type&quot;] content-type))

(defn wrap-content-type [handler content-type]
  (fn
    ([request]
      (-&gt; (handler request) (content-type-response content-type)))
    ([request respond raise]
      (handler request #(respond (content-type-response % content-type)) raise))))</pre>
Is this example the currently supported/preferred method for adding asynchronous handler support within ring projects or is there some other method that is/will be supported with ring core?</z><z id="t1580220263" t="weavejester Yes, that example is correct. Async support in Ring is handled by the three-arity handler function. It‚Äôs also a good idea to split the middleware into -request and -response functions so that people can manually create their own async interceptors, etc."><y>#</y><d>2020-01-28</d><h>14:04</h><r>weavejester</r>Yes, that example is correct. Async support in Ring is handled by the three-arity handler function. It‚Äôs also a good idea to split the middleware into <code>-request</code> and <code>-response</code> functions so that people can manually create their own async interceptors, etc.</z><z id="t1580220294" t="yogidevbear Perfect, thanks [:attrs {:href &quot;/_/_/users/U0BKWMG5B&quot;}] üëç"><y>#</y><d>2020-01-28</d><h>14:04</h><r>yogidevbear</r>Perfect, thanks <a>@U0BKWMG5B</a> <b>üëç</b></z><z id="t1580210274" t="yogidevbear Any takers on my question above? üòÑ"><y>#</y><d>2020-01-28</d><h>11:17</h><w>yogidevbear</w>Any takers on my question above? <b>üòÑ</b></z><z id="t1580234630" t="seancorfield [:attrs {:href &quot;/_/_/users/U0BKWMG5B&quot;}] &apos;grats on the Clojurists Together funding -- what&apos;s the roadmap for Ring that you&apos;re going to be focused on for the next quarter? Feel free to just link me to a doc if that&apos;s easier."><y>#</y><d>2020-01-28</d><h>18:03</h><w>seancorfield</w><a>@weavejester</a> &apos;grats on the Clojurists Together funding -- what&apos;s the roadmap for Ring that you&apos;re going to be focused on for the next quarter? Feel free to just link me to a doc if that&apos;s easier.</z><z id="t1580260651" t="weavejester Thanks! I‚Äôm planning on writing up a draft specification and explanation that‚Äôll go into more detail about what I intend to do. It should be ready sometime next week."><y>#</y><d>2020-01-29</d><h>01:17</h><r>weavejester</r>Thanks! I‚Äôm planning on writing up a draft specification and explanation that‚Äôll go into more detail about what I intend to do. It should be ready sometime next week.</z><z id="t1580367855" t="ikitommi looking forward to it."><y>#</y><d>2020-01-30</d><h>07:04</h><r>ikitommi</r>looking forward to it.</z><z id="t1580296838" t="dharrigan Is there any way to debug a Connection Reset By Peer that I&apos;m observing after X seconds when the client requests from the server again? Using Ring 1.8.0 that comes with Jetty j9.4.22.v20191022."><y>#</y><d>2020-01-29</d><h>11:20</h><w>dharrigan</w>Is there any way to debug a Connection Reset By Peer that I&apos;m observing after X seconds when the client requests from the server again? Using Ring 1.8.0 that comes with Jetty j9.4.22.v20191022.</z><z id="t1580299336" t="dharrigan Ignore - it&apos;s happening in another part of my system üòâ"><y>#</y><d>2020-01-29</d><h>12:02</h><w>dharrigan</w>Ignore - it&apos;s happening in another part of my system <b>üòâ</b></z><z id="t1580352766" t="Scot Hey, I noticed that ring.middleware.session is not thread-safe, and so a long-running http request could overwrite the session with stale data. Is anyone concerned about this, or do people generally write their own session implementations that deal with this?"><y>#</y><d>2020-01-30</d><h>02:52</h><w>Scot</w>Hey, I noticed that ring.middleware.session is not thread-safe, and so a long-running http request could overwrite the session with stale data. Is anyone concerned about this, or do people generally write their own session implementations that deal with this?</z><z id="t1580371524" t="jumar Interesting, do you have more details about that?"><y>#</y><d>2020-01-30</d><h>08:05</h><r>jumar</r>Interesting, do you have more details about that?</z><z id="t1580390378" t="weavejester In practice, session data is rarely used in a manner where this would be an issue, and not all session stores (encrypted cookies for example) can support an atomic ‚Äúswap‚Äù. Where concurrency is required, it‚Äôs often better to store an identifier in the session that links to a database that supports atomic updates."><y>#</y><d>2020-01-30</d><h>13:19</h><r>weavejester</r>In practice, session data is rarely used in a manner where this would be an issue, and not all session stores (encrypted cookies for example) can support an atomic ‚Äúswap‚Äù. Where concurrency is required, it‚Äôs often better to store an identifier in the session that links to a database that supports atomic updates.</z><z id="t1580392977" t="jumar Any details about how exactly this could happen (possible with some code pointers)? üôÇ"><y>#</y><d>2020-01-30</d><h>14:02</h><r>jumar</r>Any details about how exactly this could happen (possible with some code pointers)? <b>üôÇ</b></z><z id="t1580393100" t="weavejester Two handlers overlap and want to write at the same time. So A reads session, B reads session, B writes session, A writes session. In this case, B‚Äôs changes would be overwritten by A‚Äôs changes."><y>#</y><d>2020-01-30</d><h>14:05</h><r>weavejester</r>Two handlers overlap and want to write at the same time. So A reads session, B reads session, B writes session, A writes session. In this case, B‚Äôs changes would be overwritten by A‚Äôs changes.</z><z id="t1580393153" t="jumar Ah, I see. Thanks!"><y>#</y><d>2020-01-30</d><h>14:05</h><r>jumar</r>Ah, I see. Thanks!</z><z id="t1580393178" t="weavejester For certain types of session store this is unavoidable, as not all stores support atomic updates."><y>#</y><d>2020-01-30</d><h>14:06</h><r>weavejester</r>For certain types of session store this is unavoidable, as not all stores support atomic updates.</z><z id="t1580411618" t="Scot Thanks for the reply. Makes sense."><y>#</y><d>2020-01-30</d><h>19:13</h><r>Scot</r>Thanks for the reply. Makes sense.</z><z id="t1581115572" t="Endre Bakken Stovner Web noob here: is there any point at all with a CSRF-token for a same machine app? (Using clj for computation, cljs for visualization in browser). I am 99.999% sure there is not"><y>#</y><d>2020-02-07</d><h>22:46</h><w>Endre Bakken Stovner</w>Web noob here: is there any point at all with a CSRF-token for a same machine app? (Using clj for computation, cljs for visualization in browser). I am 99.999% sure there is not</z><z id="t1581116068" t="aisamu I&apos;ll add an extra 9 to your confidence value"><y>#</y><d>2020-02-07</d><h>22:54</h><r>aisamu</r>I&apos;ll add an extra 9 to your confidence value</z><z id="t1581151736" t="jumar What does the same machine app mean? Do you have any post handlers in your app?"><y>#</y><d>2020-02-08</d><h>08:48</h><r>jumar</r>What does the same machine app mean? Do you have any post handlers in your app?</z><z id="t1581361722" t="Endre Bakken Stovner Yes, there are post handlers which the user uses to send data to the running application üôÇ Same-machine app: meant to be used on the same machine, not serve web pages to clients (dunno if this is the terminology)"><y>#</y><d>2020-02-10</d><h>19:08</h><r>Endre Bakken Stovner</r>Yes, there are post handlers which the user uses to send data to the running application <b>üôÇ</b> Same-machine app: meant to be used on the same machine, not serve web pages to clients (dunno if this is the terminology)</z><z id="t1581362485" t="jumar Who‚Äôs gonna consume the cljs app then? Is it only going to run locally and never ever served over a network? In that case I‚Äôd say you‚Äôre pretty safe :)"><y>#</y><d>2020-02-10</d><h>19:21</h><r>jumar</r>Who‚Äôs gonna consume the cljs app then? Is it only going to run locally and never ever served over a network? In that case I‚Äôd say you‚Äôre pretty safe :)</z><z id="t1581444228" t="weavejester CSRF covers the confused deputy attack, which relies on an attacker tricking a user into making a request on their behalf."><y>#</y><d>2020-02-11</d><h>18:03</h><r>weavejester</r>CSRF covers the confused deputy attack, which relies on an attacker tricking a user into making a request on their behalf.</z><z id="t1581444287" t="weavejester It‚Äôs a problem if an attacker knows about your system and where it is, and can get you to visit a website under their control."><y>#</y><d>2020-02-11</d><h>18:04</h><r>weavejester</r>It‚Äôs a problem if an attacker knows about your system and where it is, and can get you to visit a website under their control.</z><z id="t1581531909" t="plins Hello everyone, not sure if this the right place to ask but Im looking for a lib/middleware that enables me to name clojure specs (to be displayed with swagger) using kebab-case, but would expose this to the outer world using camelCase is anyone aware of such tools, Ive googled it but without success"><y>#</y><d>2020-02-12</d><h>18:25</h><w>plins</w>Hello everyone, not sure if this the right place to ask but
Im looking for a lib/middleware that enables me to name clojure specs (to be displayed with swagger) using kebab-case, but would expose this to the outer world using camelCase

is anyone aware of such tools, Ive googled it but without success</z><z id="t1581616032" t="robertfw I had similar needs - specs being kebab-case, but API is specified and validated for underscore. Didn&apos;t find an acceptable solution - we were working off of json schemas and so I ended up using those for in-production validation, had middleware to kebab-case any request data, then used kebab-cased specs internally"><y>#</y><d>2020-02-13</d><h>17:47</h><w>robertfw</w>I had similar needs - specs being kebab-case, but API is specified and validated for underscore. Didn&apos;t find an acceptable solution - we were working off of json schemas and so I ended up using those for in-production validation, had middleware to kebab-case any request data, then used kebab-cased specs internally</z><z id="t1581616093" t="robertfw not the cleanest setup and hoping to revisit this possibly when spec2 comes out, which has some improvements for programmatically making specs. that could make it easier to alter a spec to use a different casing"><y>#</y><d>2020-02-13</d><h>17:48</h><w>robertfw</w>not the cleanest setup and hoping to revisit this possibly when spec2 comes out, which has some improvements for programmatically making specs. that could make it easier to alter a spec to use a different casing</z><z id="t1581634977" t="plins Im thinking of doing the same thing, one middleware to change the swagger json to camelCase and another one to convert the data to kebab case when a request arrives"><y>#</y><d>2020-02-13</d><h>23:02</h><r>plins</r>Im thinking of doing the same thing, one middleware to change the swagger json to camelCase and another one to convert the data to kebab case when a request arrives</z><z id="t1582934696" t="robertfw fyi, Ring 2.0 design details are out for feedback: https://github.com/ring-clojure/ring/issues/393"><y>#</y><d>2020-02-29</d><h>00:04</h><w>robertfw</w>fyi, Ring 2.0 design details are out for feedback: <a href="https://github.com/ring-clojure/ring/issues/393" target="_blank">https://github.com/ring-clojure/ring/issues/393</a></z><z id="t1583362879" t="sova-soars-the-sora Hello everyone, I have non-authenticated routes, authenticated, and super-authenticated. my middleware seems to be doing extra evaluations because it&apos;s noticeably slower to access something as super-authenticated vs non-auth. what could be the cause? the ordering of functions in defroutes?"><y>#</y><d>2020-03-04</d><h>23:01</h><w>sova-soars-the-sora</w>Hello everyone, I have non-authenticated routes, authenticated, and super-authenticated.  my middleware seems to be doing extra evaluations because it&apos;s noticeably slower to access something as super-authenticated vs non-auth.  what could be the cause?  the ordering of functions in defroutes?</z><z id="t1584607586" t="Akiz Hi everybody, I am asking for help üôÇ . I am using https://github.com/weavejester/ring-oauth2 to use corporate IDP. My application is SPA served on /webpage . And launch_uri (initializes auth) is on /login/ . My redirect URI is /login/callback . I do not know what should be set in this route so there is nothing right now. Do I have to have some logic there? When I recieve the code from IDP I am redirected to /login/callback where I recieve state mismatch error. But I can see that state query string parameter is same as the first time I call IDP. Can somebody point me to the right direction as I am hopeless right now? The only hint I found is https://github.com/jupyterhub/jupyterhub/issues/1438 I am not using Auth0 but I am using NGINX with Let&apos;sEncrypt certificate for providing HTTP content over HTTPS. Maybe this can cause some issues? Thank you!"><y>#</y><d>2020-03-19</d><h>08:46</h><w>Akiz</w>Hi everybody,
I am asking for help <b>üôÇ</b>.

I am using <a href="https://github.com/weavejester/ring-oauth2" target="_blank">https://github.com/weavejester/ring-oauth2</a> to use corporate IDP.
My application is SPA served on <code>/webpage</code>. And launch_uri (initializes auth) is on <code>/login/</code>.
My redirect URI is <code>/login/callback</code>. I do not know what should be set in this route so there is nothing right now. Do I have to have some logic there?

When I recieve the code from IDP I am redirected to <code>/login/callback</code> where I recieve <code>state mismatch</code> error.  But I can see that <code>state</code>  query string parameter is same as the first time I call IDP.

Can somebody point me to the right direction as I am hopeless right now?
The only hint I found is <a href="https://github.com/jupyterhub/jupyterhub/issues/1438" target="_blank">https://github.com/jupyterhub/jupyterhub/issues/1438</a>
I am not using Auth0 but I am using NGINX with Let&apos;sEncrypt certificate for providing HTTP content over HTTPS.
Maybe this can cause some issues?
Thank you!</z><z id="t1584726710" t="weavejester It‚Äôs hard to tell whether or not you‚Äôre doing anything wrong without seeing your source code. A state mismatch means that the state passed by the query parameter from your OAuth provider doesn‚Äôt match the state stored in the session. So my first question is whether you have your session middleware added correctly, and whether you‚Äôre not accidentally overriding it with ring-defaults."><y>#</y><d>2020-03-20</d><h>17:51</h><r>weavejester</r>It‚Äôs hard to tell whether or not you‚Äôre doing anything wrong without seeing your source code. A state mismatch means that the state passed by the query parameter from your OAuth provider doesn‚Äôt match the state stored in the session. So my first question is whether you have your session middleware added correctly, and whether you‚Äôre not accidentally overriding it with ring-defaults.</z><z id="t1584951389" t="Akiz These are routes: (defroutes routes (GET &quot;/&quot; [] greet) (GET &quot;/request&quot; [] handle-dump) ;; will be used later for debuging (GET &quot;/status&quot; [] handle-driver-status) (GET &quot;/login&quot; [] handle-dump) (GET &quot;/login/loopback&quot; [] (response/redirect &quot;/&quot;)) (not-found &quot;Page not found&quot;)) (As I said I am not sure what to do on &quot;login/loopback&quot; which is &quot;redirect_uri&quot;, &quot;/&quot; is landing page) (def app (wrap-file-info (wrap-resource (wrap-params (middleware/wrap-format ( idp-handler routes ) )) &quot;public&quot;))) And this is the handler. (defn idp-handler [routes] (wrap-oauth2 routes {:xxx {:authorize-uri &quot;&quot; :access-token-uri &quot;&quot; :client-id &quot;???? :client-secret &quot;????&quot; :scopes [&quot;openid xxxx&quot;] :grant-type &quot;refresh_token,authorization_code&quot; :launch-uri &quot;/login&quot; :redirect-uri &quot;&quot; :landing-uri &quot;/&quot;}})) "><y>#</y><d>2020-03-23</d><h>08:16</h><r>Akiz</r>These are routes:
<pre>(defroutes routes
  (GET &quot;/&quot; [] greet)
  (GET &quot;/request&quot; [] handle-dump) ;; will be used later for debuging
  (GET &quot;/status&quot; [] handle-driver-status)
  (GET &quot;/login&quot; [] handle-dump)
  (GET &quot;/login/loopback&quot; [] (response/redirect &quot;/&quot;))
  (not-found &quot;Page not found&quot;))</pre>
(As I said I am not sure what to do on &quot;login/loopback&quot; which is &quot;redirect_uri&quot;, &quot;/&quot; is landing page)
<pre>(def app
  (wrap-file-info
   (wrap-resource
    (wrap-params 
     (middleware/wrap-format
      (
       idp-handler
       routes
       )
      ))
    &quot;public&quot;)))   </pre>
And this is the handler.
<pre>(defn idp-handler [routes]
  (wrap-oauth2
   routes
   {:xxx
    {:authorize-uri    &quot;&quot;
     :access-token-uri &quot;&quot;
     :client-id        &quot;????
     :client-secret    &quot;????&quot;
     :scopes           [&quot;openid xxxx&quot;]
     :grant-type       &quot;refresh_token,authorization_code&quot;
     :launch-uri       &quot;/login&quot;
     :redirect-uri     &quot;&quot;
     :landing-uri      &quot;/&quot;}}))</pre>
</z><z id="t1585230191" t="Akiz Hi everyone, does anybody have experience with implementing refreshing token (oauth2) in ring?"><y>#</y><d>2020-03-26</d><h>13:43</h><w>Akiz</w>Hi everyone, does anybody have experience with implementing refreshing token (oauth2) in ring?</z><z id="t1585239548" t="witek Hi. I would like to make AJAX POST requests from the browser to my ring server. How do I get the anti-request-forgery-token which is stored in my http session to the browser? Is it ok to expose a public GET route which returns the token? Do I need to provide this route myself? Or does ring-defaults already provide such a route somehow? Thank you!"><y>#</y><d>2020-03-26</d><h>16:19</h><w>witek</w>Hi. I would like to make AJAX POST requests from the browser to my ring server. How do I get the <code>anti-request-forgery-token</code> which is stored in my http session to the browser? Is it ok to expose a public GET route which returns the token? Do I need to provide this route myself? Or does <code>ring-defaults</code> already provide such a route somehow? Thank you!</z><z id="t1585277691" t="weavejester Typically you add it to the page you‚Äôre generating, either as a form hidden field, or inside a script element where the anti-forgery token is assigned to a variable."><y>#</y><d>2020-03-27</d><h>02:54</h><r>weavejester</r>Typically you add it to the page you‚Äôre generating, either as a form hidden field, or inside a script element where the anti-forgery token is assigned to a variable.</z><z id="t1585504584" t="Spaceman I&apos;m sending the following response in clojure ring: (res/set-cookie (res/redirect (env :some-url)) &quot;some-id&quot; (-&gt; req foo-ns/bar :id ) {:max-age (* 30 24 60 60 1000) :path &quot;/&quot;}) And on printing this response I get: {:status 302, :headers {&quot;Location&quot; &quot;&quot;}, :body &quot;&quot;, :cookies {&quot;some-id&quot; {:value &quot;1341313515135490454&quot;, :max-age 2592000000, :path &quot;/&quot;}}} But on the client side, the cookie isn&apos;t set, which I can see in the console. What am I doing wrong?"><y>#</y><d>2020-03-29</d><h>17:56</h><w>Spaceman</w>I&apos;m sending the following response in clojure ring:
<pre>(res/set-cookie
         (res/redirect (env :some-url))
         &quot;some-id&quot;
         (-&gt;
          req
          foo-ns/bar
          :id
          )
         {:max-age (* 30 24 60 60 1000) :path &quot;/&quot;})</pre>
And on printing this response I get:
<pre>{:status 302, :headers {&quot;Location&quot; &quot;&quot;}, :body &quot;&quot;, :cookies {&quot;some-id&quot; {:value &quot;1341313515135490454&quot;, :max-age 2592000000, :path &quot;/&quot;}}}</pre>
But on the client side, the cookie isn&apos;t set, which I can see in the console. What am I doing wrong?</z><z id="t1585505147" t="seancorfield [:attrs {:href &quot;/_/_/users/U010Z4Y1J4Q&quot;}] I&apos;m pretty sure you cannot reliably set cookies on a redirect response. It&apos;s not supported by all browsers."><y>#</y><d>2020-03-29</d><h>18:05</h><w>seancorfield</w><a>@pshar10</a> I&apos;m pretty sure you cannot reliably set cookies on a redirect response. It&apos;s not supported by all browsers.</z><z id="t1585508003" t="Spaceman The point is that the req is coming from google oauth, and after the request arrives I want to redirect the user to some route, while setting a cookie that they are logged in. So how can I do both if one cannot set cookies in a redirect?"><y>#</y><d>2020-03-29</d><h>18:53</h><w>Spaceman</w>The point is that the req is coming from google oauth, and after the request arrives I want to redirect the user to some route, while setting a cookie that they are logged in. So how can I do both if one cannot set cookies in a redirect?</z><z id="t1585545091" t="Saikyun how would one set some code from the http-server that is &quot;injected&quot; into my cljs-code? in my case I want to set an url to a server depending on which server my cljs-code is running from. like so: server hosting cljs rest api server localhost localhost:1234 right now I use ring and just serve static files. was thinking that maybe one could modify something in the files when ring sends the static files"><y>#</y><d>2020-03-30</d><h>05:11</h><w>Saikyun</w>how would one set some code from the http-server that is &quot;injected&quot; into my cljs-code? in my case I want to set an url to a server depending on which server my cljs-code is running from. like so:
<pre>server hosting cljs          rest api server
localhost                    localhost:1234
              
                     </pre>
right now I use ring and just serve static files. was thinking that maybe one could modify something in the files when ring sends the static files</z><z id="t1585545330" t="seancorfield [:attrs {:href &quot;/_/_/users/UCG86LJFN&quot;}] Maybe use Selmer to have mostly static templates with a few variables substituted?"><y>#</y><d>2020-03-30</d><h>05:15</h><w>seancorfield</w><a>@saikyun</a> Maybe use Selmer to have mostly static templates with a few variables substituted?</z><z id="t1585545508" t="Saikyun [:attrs {:href &quot;/_/_/users/U04V70XH6&quot;}] thanks for the tip! I&apos;ll check it out üôÇ definitely seems to do what I want to do üôÇ"><y>#</y><d>2020-03-30</d><h>05:18</h><w>Saikyun</w><a>@seancorfield</a> thanks for the tip! I&apos;ll check it out <b>üôÇ</b> definitely seems to do what I want to do <b>üôÇ</b></z><z id="t1585546112" t="seancorfield We use Selmer very heavily at work to generate HTML pages from templates and data."><y>#</y><d>2020-03-30</d><h>05:28</h><w>seancorfield</w>We use Selmer very heavily at work to generate HTML pages from templates and data.</z><z id="t1585546583" t="Saikyun cool üôÇ did I understand Selmer correctly, that it doesn&apos;t re-generate html pages if the data hasn&apos;t changed?"><y>#</y><d>2020-03-30</d><h>05:36</h><w>Saikyun</w>cool <b>üôÇ</b> did I understand Selmer correctly, that it doesn&apos;t re-generate html pages if the data hasn&apos;t changed?</z><z id="t1585546586" t="Saikyun sounds very useful"><y>#</y><d>2020-03-30</d><h>05:36</h><w>Saikyun</w>sounds very useful</z><z id="t1585547565" t="seancorfield It precompiles the templates (if I recall correctly), but it still generates the HTML each time -- but it&apos;s fast. We serve millions of pages a day with it."><y>#</y><d>2020-03-30</d><h>05:52</h><w>seancorfield</w>It precompiles the templates (if I recall correctly), but it still generates the HTML each time -- but it&apos;s fast. We serve millions of pages a day with it.</z><z id="t1585547606" t="seancorfield (we use it to generate all the emails we send, as well as all the HTML pages we generate from several apps)"><y>#</y><d>2020-03-30</d><h>05:53</h><w>seancorfield</w>(we use it to generate all the emails we send, as well as all the HTML pages we generate from several apps)</z><z id="t1585547619" t="Saikyun aha, cool. we&apos;re nowhere that amount, so that&apos;s reassuring üôÇ"><y>#</y><d>2020-03-30</d><h>05:53</h><w>Saikyun</w>aha, cool. we&apos;re nowhere that amount, so that&apos;s reassuring <b>üôÇ</b></z><z id="t1585547718" t="Saikyun decided to solve it using :closure-defines in shadow-cljs for now, but I&apos;ll probably need more than &quot;environment variables&quot; in the future. then I&apos;ll keep Selmer in mind üôÇ"><y>#</y><d>2020-03-30</d><h>05:55</h><w>Saikyun</w>decided to solve it using <code>:closure-defines</code> in shadow-cljs for now, but I&apos;ll probably need more than &quot;environment variables&quot; in the future. then I&apos;ll keep Selmer in mind <b>üôÇ</b></z><z id="t1585841996" t="restenb anybody aware of an actively maintained CSP library for Ring? all I can find is https://github.com/ecmendenhall/malcontent"><y>#</y><d>2020-04-02</d><h>15:39</h><w>restenb</w>anybody aware of an actively maintained CSP library for Ring? all I can find is <a href="https://github.com/ecmendenhall/malcontent" target="_blank">https://github.com/ecmendenhall/malcontent</a></z><z id="t1585842024" t="restenb it&apos;ll probably work fine for my use, but it is 7 years old at this time"><y>#</y><d>2020-04-02</d><h>15:40</h><w>restenb</w>it&apos;ll probably work fine for my use, but it is 7 years old at this time</z><z id="t1585842059" t="restenb i&apos;m not aware that CSP was ever added to Ring itself, even as a separate lib?"><y>#</y><d>2020-04-02</d><h>15:40</h><w>restenb</w>i&apos;m not aware that CSP was ever added to Ring itself, even as a separate lib?</z><z id="t1585846649" t="victorb [:attrs {:href &quot;/_/_/users/U52RNHDRN&quot;}] not exactly sure what you&apos;re looking for in the library, can&apos;t you just add Content-Security-Policy header manually to the requests? Feels a bit over the top to include a library to write one header. Otherwise I think ring-defaults have a &quot;security-profile&quot; but not sure that includes CSP, as it&apos;s very application specific and hard to provide good defaults for"><y>#</y><d>2020-04-02</d><h>16:57</h><w>victorb</w><a>@restenb</a> not exactly sure what you&apos;re looking for in the library, can&apos;t you just add <code>Content-Security-Policy</code> header manually to the requests? Feels a bit over the top to include a library to write one header. Otherwise I think <code>ring-defaults</code> have a &quot;security-profile&quot; but not sure that includes CSP, as it&apos;s very application specific and hard to provide good defaults for</z><z id="t1585846765" t="victorb the header is not that complicated once you look at it https://content-security-policy.com/ and I&apos;m guessing you normally set the values once and use it, I&apos;m not aware of use cases where you want to change it dynamically"><y>#</y><d>2020-04-02</d><h>16:59</h><w>victorb</w>the header is not that complicated once you look at it <a href="https://content-security-policy.com/" target="_blank">https://content-security-policy.com/</a> and I&apos;m guessing you normally set the values once and use it, I&apos;m not aware of use cases where you want to change it dynamically</z><z id="t1585846829" t="victorb lastly, even though the library is 7 years old, is it actually not working, have issues that prevent you from using it or it&apos;s just about the age? I&apos;ve found clojure libraries that are old not to mean they are bad but they are done and stable (at least most of the times, YMMV)"><y>#</y><d>2020-04-02</d><h>17:00</h><w>victorb</w>lastly, even though the library is 7 years old, is it actually not working, have issues that prevent you from using it or it&apos;s just about the age? I&apos;ve found clojure libraries that are old not to mean they are bad but they are done and stable (at least most of the times, YMMV)</z><z id="t1585847326" t="restenb i&apos;m mainly looking for something to make it easier to configure custom directives for CSP"><y>#</y><d>2020-04-02</d><h>17:08</h><w>restenb</w>i&apos;m mainly looking for something to make it easier to configure custom directives for CSP</z><z id="t1585847340" t="restenb but yeah that lib will probably do the job for me still"><y>#</y><d>2020-04-02</d><h>17:09</h><w>restenb</w>but yeah that lib will probably do the job for me still</z><z id="t1586241473" t="EmmanuelOga sup, is there any nice middleware to serve a random folder that is not on resources/ of my project? Can&apos;t find it and been googling for a while"><y>#</y><d>2020-04-07</d><h>06:37</h><w>EmmanuelOga</w>sup, is there any nice middleware to serve a random folder that is not on resources/ of my project? Can&apos;t find it and been googling for a while</z><z id="t1586241495" t="EmmanuelOga thinking something akin to python -m SimpleHTTPServer , which serves the folder where you run that command"><y>#</y><d>2020-04-07</d><h>06:38</h><w>EmmanuelOga</w>thinking something akin to <code>python -m SimpleHTTPServer</code>, which serves the folder where you run that command</z><z id="t1586245795" t="EmmanuelOga weird, can&apos;t find anything"><y>#</y><d>2020-04-07</d><h>07:49</h><w>EmmanuelOga</w>weird, can&apos;t find anything</z><z id="t1586245819" t="EmmanuelOga I&apos;m using reitit, which includes something like I&apos;m looking for but only for io/resources https://github.com/metosin/reitit/blob/master/doc/ring/static.md"><y>#</y><d>2020-04-07</d><h>07:50</h><w>EmmanuelOga</w>I&apos;m using reitit, which includes something like I&apos;m looking for but only for io/resources <a href="https://github.com/metosin/reitit/blob/master/doc/ring/static.md" target="_blank">https://github.com/metosin/reitit/blob/master/doc/ring/static.md</a></z><z id="t1586245836" t="EmmanuelOga seems like I&apos;m gonna have to roll my own"><y>#</y><d>2020-04-07</d><h>07:50</h><w>EmmanuelOga</w>seems like I&apos;m gonna have to roll my own</z><z id="t1586246119" t="EmmanuelOga hmmmm it seems like ring&apos;s wrap-file may be what I need. Despite the name, it seems like it also wraps directories"><y>#</y><d>2020-04-07</d><h>07:55</h><w>EmmanuelOga</w>hmmmm it seems like ring&apos;s wrap-file may be what I need. Despite the name, it seems like it also wraps directories</z><z id="t1586248696" t="EmmanuelOga effectively: (-&gt; my-handler (ring-file/wrap-file &quot;/path&quot;)) is what I was looking for."><y>#</y><d>2020-04-07</d><h>08:38</h><w>EmmanuelOga</w>effectively: <code>(-&gt; my-handler (ring-file/wrap-file &quot;/path&quot;))</code> is what I was looking for.</z><z id="t1587067470" t="jonathanj When trying to assoc a map into the [:session :identity] key (I‚Äôm using cookie-store ) I get java.lang.RuntimeException: No reader function for tag object , it turns out the issue is caused by some values in my map that are java.time.ZonedDateTime instances."><y>#</y><d>2020-04-16</d><h>20:04</h><w>jonathanj</w>When trying to assoc a map into the <code>[:session :identity]</code> key (I‚Äôm using <code>cookie-store</code>) I get <code>java.lang.RuntimeException: No reader function for tag object</code>, it turns out the issue is caused by some values in my map that are <code>java.time.ZonedDateTime</code> instances.</z><z id="t1587067527" t="jonathanj I‚Äôm trying to pass the :readers key into (cookie-store ‚Ä¶) but I can‚Äôt understand how it works, it seems like it stems from core.edn/read but the documentation seems extremely thin."><y>#</y><d>2020-04-16</d><h>20:05</h><w>jonathanj</w>I‚Äôm trying to pass the <code>:readers</code> key into <code>(cookie-store ‚Ä¶)</code> but I can‚Äôt understand how it works, it seems like it stems from <code>core.edn/read</code> but the documentation seems extremely thin.</z><z id="t1587162602" t="jtth how am i supposed to be, say, redirecting back to a url after a login attempt? I keep getting csrf errors with this (luminus) (defn login! [{:keys [session params]}] &quot;logs user in&quot; (if-let [user-identity (authenticate (get-in params [:email]) (get-in params [:pass]))] (-&gt; (response/found &quot;/authenticated-test&quot;) ;; fixme: this just... doesn&apos;t work (response/ok) (assoc :session (assoc session :identity user-identity))) (response/unauthorized {:result :unauthorized :message &quot;login failure&quot;})))"><y>#</y><d>2020-04-17</d><h>22:30</h><w>jtth</w>how am i supposed to be, say, redirecting back to a url after a login attempt? I keep getting csrf errors with this (luminus)
<pre>(defn login! [{:keys [session params]}]
  &quot;logs user in&quot;
  (if-let [user-identity (authenticate
                           (get-in params [:email])
                           (get-in params [:pass]))]
    (-&gt; (response/found &quot;/authenticated-test&quot;) ;; fixme: this just... doesn&apos;t work
        (response/ok)
        (assoc :session (assoc session :identity user-identity)))
    (response/unauthorized {:result  :unauthorized
                            :message &quot;login failure&quot;})))</pre></z><z id="t1587163220" t="seancorfield [:attrs {:href &quot;/_/_/users/U4Q7NLNMC&quot;}] Looks like you&apos;re overriding the redirect response/found with response/ok there?"><y>#</y><d>2020-04-17</d><h>22:40</h><w>seancorfield</w><a>@jtth</a> Looks like you&apos;re overriding the redirect <code>response/found</code> with <code>response/ok</code> there?</z><z id="t1587397673" t="jtth that was it! thank you very much!"><y>#</y><d>2020-04-20</d><h>15:47</h><r>jtth</r>that was it! thank you very much!</z><z id="t1587399067" t="jtth is there a middleware for displaying session information in a footer or something? or do i have to do that by hand?"><y>#</y><d>2020-04-20</d><h>16:11</h><w>jtth</w>is there a middleware for displaying session information in a footer or something? or do i have to do that by hand?</z><z id="t1587399109" t="jtth like the debugging/error page that looks like rails‚Äô, but just‚Ä¶ always there showing params/session info"><y>#</y><d>2020-04-20</d><h>16:11</h><r>jtth</r>like the debugging/error page that looks like rails‚Äô, but just‚Ä¶ always there showing params/session info</z><z id="t1587410713" t="jtth answering my own question: at least for selmer, my question was really how do i pass parameters into a template, which is done with {% debug %}"><y>#</y><d>2020-04-20</d><h>19:25</h><r>jtth</r>answering my own question: at least for selmer, my question was really how do i pass parameters into a template, which is done with <code>{% debug %}</code></z><z id="t1587414241" t="jtth so after login i‚Äôm redirecting to another page using the following, but it doesn‚Äôt seem to preserve session information. any ideas on where i should look? (-&gt; (response/found &quot;/authenticated-test&quot;) (assoc :session (assoc session :identity user-identity)))"><y>#</y><d>2020-04-20</d><h>20:24</h><w>jtth</w>so after login i‚Äôm redirecting to another page using the following, but it doesn‚Äôt seem to preserve session information. any ideas on where i should look?
<pre>(-&gt; (response/found &quot;/authenticated-test&quot;)
        (assoc :session (assoc session :identity user-identity)))</pre></z><z id="t1587414286" t="jtth there isn‚Äôt even a :session value in :params . (This is based on the luminus template. I‚Äôll ask in there too.)"><y>#</y><d>2020-04-20</d><h>20:24</h><r>jtth</r>there isn‚Äôt even a <code>:session</code> value in <code>:params</code>. (This is based on the luminus template. I‚Äôll ask in there too.)</z><z id="t1587479360" t="weavejester Where are you getting session from?"><y>#</y><d>2020-04-21</d><h>14:29</h><r>weavejester</r>Where are you getting <code>session</code> from?</z><z id="t1587479405" t="weavejester Are you pulling it from the request, and have you added the session middleware?"><y>#</y><d>2020-04-21</d><h>14:30</h><r>weavejester</r>Are you pulling it from the request, and have you added the session middleware?</z><z id="t1587482271" t="jtth here https://bitbucket.org/jtth/irbportal/src/bb8382ddc933842023f8bfba4353a5dcd7a5ace1/src/clj/irbportal/routes/auth.clj#lines-49"><y>#</y><d>2020-04-21</d><h>15:17</h><r>jtth</r>here <a href="https://bitbucket.org/jtth/irbportal/src/bb8382ddc933842023f8bfba4353a5dcd7a5ace1/src/clj/irbportal/routes/auth.clj#lines-49" target="_blank">https://bitbucket.org/jtth/irbportal/src/bb8382ddc933842023f8bfba4353a5dcd7a5ace1/src/clj/irbportal/routes/auth.clj#lines-49</a></z><z id="t1587486345" t="jtth I tried putting wrap-session above the wrap-defaults and nothing changed."><y>#</y><d>2020-04-21</d><h>16:25</h><r>jtth</r>I tried putting <code>wrap-session</code> above the <code>wrap-defaults</code> and nothing changed.</z><z id="t1587488103" t="weavejester You shouldn‚Äôt need an additional wrap-session if you already have wrap-default . Have you tried using a different session store?"><y>#</y><d>2020-04-21</d><h>16:55</h><r>weavejester</r>You shouldn‚Äôt need an additional <code>wrap-session</code> if you already have <code>wrap-default</code>. Have you tried using a different session store?</z><z id="t1587488963" t="jtth just tried setting it to cookie-store following https://luminusweb.com/docs/sessions_cookies.html and there‚Äôs no change."><y>#</y><d>2020-04-21</d><h>17:09</h><r>jtth</r>just tried setting it to <code>cookie-store</code> following <a href="https://luminusweb.com/docs/sessions_cookies.html" target="_blank">https://luminusweb.com/docs/sessions_cookies.html</a> and there‚Äôs no change.</z><z id="t1587489000" t="weavejester Have you checked the browser to see if the cookie is being set correctly?"><y>#</y><d>2020-04-21</d><h>17:10</h><r>weavejester</r>Have you checked the browser to see if the cookie is being set correctly?</z><z id="t1587489163" t="weavejester Have you checked the session directly? Perhaps the problem is with how you‚Äôre integrating it into Buddy."><y>#</y><d>2020-04-21</d><h>17:12</h><r>weavejester</r>Have you checked the session directly? Perhaps the problem is with how you‚Äôre integrating it into Buddy.</z><z id="t1587489351" t="jtth I think I‚Äôm passing these things on but honestly I don‚Äôt know. I‚Äôm trying to follow documentation, and this looks like what everyone else is doing. I don‚Äôt want to have to worry about this stuff; I guess I figured that in a mature library ecosystem this would be a solved problem."><y>#</y><d>2020-04-21</d><h>17:15</h><r>jtth</r>I think I‚Äôm passing these things on but honestly I don‚Äôt know. I‚Äôm trying to follow documentation, and this looks like what everyone else is doing. I don‚Äôt want to have to worry about this stuff; I guess I figured that in a mature library ecosystem this would be a solved problem.</z><z id="t1587489506" t="weavejester Why do you think the session information isn‚Äôt being preserved?"><y>#</y><d>2020-04-21</d><h>17:18</h><r>weavejester</r>Why do you think the session information isn‚Äôt being preserved?</z><z id="t1587489535" t="weavejester Also by your use of :identity are you using Buddy authentication? If so, where have you set it up?"><y>#</y><d>2020-04-21</d><h>17:18</h><r>weavejester</r>Also by your use of <code>:identity</code> are you using Buddy authentication? If so, where have you set it up?</z><z id="t1587489724" t="jtth entire repo is here: https://bitbucket.org/jtth/irbportal/src/master/ . I don‚Äôt think the session information is being preserved because I can‚Äôt see it as accessible from my templates. The CSRF code gets passed. I figured luminus would pass it on to the layout function (because literally if it did not what would be the point of the template at all?) but I have assumed my way into a frustrating corner before."><y>#</y><d>2020-04-21</d><h>17:22</h><r>jtth</r>entire repo is here: <a href="https://bitbucket.org/jtth/irbportal/src/master/" target="_blank">https://bitbucket.org/jtth/irbportal/src/master/</a>. I don‚Äôt think the session information is being preserved because I can‚Äôt see it as accessible from my templates. The CSRF code gets passed. I figured luminus would pass it on to the layout function (because literally if it did not what would be the point of the template at all?) but I have assumed my way into a frustrating corner before.</z><z id="t1587489886" t="jtth Ah. It doesn‚Äôt."><y>#</y><d>2020-04-21</d><h>17:24</h><r>jtth</r>Ah. It doesn‚Äôt.</z><z id="t1587489936" t="weavejester It looks like you‚Äôre passing the request into the template, but then assuming that there‚Äôs an :identity key? But I don‚Äôt see where that would come from."><y>#</y><d>2020-04-21</d><h>17:25</h><r>weavejester</r>It looks like you‚Äôre passing the request into the template, but then assuming that there‚Äôs an <code>:identity</code> key? But I don‚Äôt see where that would come from.</z><z id="t1587489969" t="jtth Yeah, I‚Äôm seeing that now."><y>#</y><d>2020-04-21</d><h>17:26</h><r>jtth</r>Yeah, I‚Äôm seeing that now.</z><z id="t1587490003" t="jtth Once again, I assumed the point of the template would be to be helpful and pass the whole session to the template‚Ä¶ ug."><y>#</y><d>2020-04-21</d><h>17:26</h><r>jtth</r>Once again, I assumed the point of the template would be to be helpful and pass the whole session to the template‚Ä¶ ug.</z><z id="t1587508799" t="Spaceman I have yet another cors issue: Access to XMLHttpRequest at &apos;&apos; from origin &apos;&apos; has been blocked by CORS policy: The value of the &apos;Access-Control-Allow-Origin&apos; header in the response must not be the wildcard &apos;*&apos; when the request&apos;s credentials mode is &apos;include&apos;. The credentials mode of requests initiated by the XMLHttpRequest is controlled by the withCredentials attribute. So it&apos;s a cors error, and I follow the instruction and set the credentials to false: {&quot;Content-Type&quot; &quot;application/edn&quot; &quot;Access-Control-Allow-Headers&quot; &quot;Content-Type&quot; &quot;Access-Control-Allow-Origin&quot; &quot;*&quot; &quot;Access-Control-Request-Method&quot; &quot;GET, OPTIONS&quot; &quot;Access-Control-Allow-Credentials&quot; false} But still getting the same error. Fixes?"><y>#</y><d>2020-04-21</d><h>22:39</h><w>Spaceman</w>I have yet another cors issue:
<pre>Access to XMLHttpRequest at &apos;&apos; from origin &apos;&apos; has been blocked by CORS policy: The value of the &apos;Access-Control-Allow-Origin&apos; header in the response must not be the wildcard &apos;*&apos; when the request&apos;s credentials mode is &apos;include&apos;. The credentials mode of requests initiated by the XMLHttpRequest is controlled by the withCredentials attribute.</pre>
So it&apos;s a cors error, and I follow the instruction and set the credentials to false:
<pre>{&quot;Content-Type&quot; &quot;application/edn&quot;
             &quot;Access-Control-Allow-Headers&quot; &quot;Content-Type&quot;
             &quot;Access-Control-Allow-Origin&quot; &quot;*&quot;
             &quot;Access-Control-Request-Method&quot; &quot;GET, OPTIONS&quot;
             &quot;Access-Control-Allow-Credentials&quot; false}</pre>
But still getting the same error. Fixes?</z><z id="t1587509128" t="seancorfield [:attrs {:href &quot;/_/_/users/U010Z4Y1J4Q&quot;}] It wants you to fix the request not the response."><y>#</y><d>2020-04-21</d><h>22:45</h><w>seancorfield</w><a>@pshar10</a> It wants you to fix the request not the response.</z><z id="t1587509422" t="seancorfield Ah, further reading suggests that you can&apos;t provide &quot;Access-Control-Allow-Credentials&quot; false -- you must omit the header completely. Only a true value is permitted if the header is present."><y>#</y><d>2020-04-21</d><h>22:50</h><w>seancorfield</w>Ah, further reading suggests that you can&apos;t provide <code>&quot;Access-Control-Allow-Credentials&quot; false</code> -- you must omit the header completely. Only a <code>true</code> value is permitted if the header is present.</z><z id="t1587509468" t="seancorfield (I was initially thinking you could change the request to opt out of credentials but reading more on that has just confused me üôÇ )"><y>#</y><d>2020-04-21</d><h>22:51</h><w>seancorfield</w>(I was initially thinking you could change the request to opt out of credentials but reading more on that has just confused me <b>üôÇ</b> )</z><z id="t1587509654" t="Spaceman That solved credentials. But what about the new error? Access to XMLHttpRequest at &apos; http://localhost:3000/fetch-categories &apos; from origin &apos; http://localhost:3689 &apos; has been blocked by CORS policy: The value of the &apos;Access-Control-Allow-Origin&apos; header in the response must not be the wildcard &apos;*&apos; when the request&apos;s credentials mode is &apos;include&apos;."><y>#</y><d>2020-04-21</d><h>22:54</h><w>Spaceman</w>That solved credentials. But what about the new error?
Access to XMLHttpRequest at &apos;<a href="http://localhost:3000/fetch-categories" target="_blank">http://localhost:3000/fetch-categories</a>&apos; from origin &apos;<a href="http://localhost:3689" target="_blank">http://localhost:3689</a>&apos; has been blocked by CORS policy: The value of the &apos;Access-Control-Allow-Origin&apos; header in the response must not be the wildcard &apos;*&apos; when the request&apos;s credentials mode is &apos;include&apos;.</z><z id="t1587510472" t="seancorfield That&apos;s the same error you posted above."><y>#</y><d>2020-04-21</d><h>23:07</h><w>seancorfield</w>That&apos;s the same error you posted above.</z><z id="t1587510542" t="seancorfield That&apos;s what I was responding to. Either you need to change the request (so credentials mode is not &apos;include&apos;) or change the headers you send back (to omit the allow credentials one)."><y>#</y><d>2020-04-21</d><h>23:09</h><w>seancorfield</w>That&apos;s what I was responding to. Either you need to change the request (so credentials mode is not &apos;include&apos;) or change the headers you send back (to omit the allow credentials one).</z><z id="t1587903899" t="uiltjesrups Is there a way to distinguish between uppercase and lowercase request methods? Is suspect not, because in ring.util.servlet I find: (defn build-request-map {[...] :request-method (keyword (.toLowerCase (.getMethod request) Locale/ENGLISH)) [...]}) But may be I&apos;m missing something. I want to respond with a method-not-allowed when request methods are lower case, I can use a reversed proxy for this but I&apos;m curious if it&apos;s also possible with Ring."><y>#</y><d>2020-04-26</d><h>12:24</h><w>uiltjesrups</w>Is there a way to distinguish between uppercase and lowercase request methods? Is suspect not, because in <code>ring.util.servlet</code> I find:
<pre>(defn build-request-map
  {[...]
  :request-method     (keyword (.toLowerCase (.getMethod request) Locale/ENGLISH))
  [...]})</pre>
But may be I&apos;m missing something. I want to respond with a <code>method-not-allowed</code> when request methods are lower case, I can use a reversed proxy for this but I&apos;m curious if it&apos;s also possible with Ring.</z><z id="t1588088941" t="javahippie I am trying to use the ‚ÄúLog In with Apple‚Äù Oauth Flow with ring, ring-oauth2 and site-defaults. Site defaults adds an anti forgery token, which needs to be included in any POST requests. Unfortunately, Apple insists that the Token redirect uses POST, and obviously it doesnt know about the anti forgery token. Has anybody managed to do this, is there a way to disable the AF token for a specific URL? Or even better, pass it into the OAuth flow? There is already the state for that, so it would be redundant, wouldn‚Äôt it? I don‚Äôt want to disable it entirely"><y>#</y><d>2020-04-28</d><h>15:49</h><w>javahippie</w>I am trying to use the ‚ÄúLog In with Apple‚Äù Oauth Flow with ring, ring-oauth2 and site-defaults. Site defaults adds an anti forgery token, which needs to be included in any POST requests. Unfortunately, Apple insists that the Token redirect uses POST, and obviously it doesnt know about the anti forgery token. Has anybody managed to do this, is there a way to disable the AF token for a specific URL? Or even better, pass it into the OAuth flow? There is already the state for that, so it would be redundant, wouldn‚Äôt it? I don‚Äôt want to disable it entirely</z><z id="t1588090184" t="seancorfield [:attrs {:href &quot;/_/_/users/U0N9SJHCH&quot;}] If you want to disable it for all requests, you should be able to do something like this in your middleware stack (ring-defaults/wrap-defaults (-&gt; ring-defaults/site-defaults (as-&gt; % (merge-with merge % (:ring-defaults config))) (assoc-in [:security :anti-forgery] false)))"><y>#</y><d>2020-04-28</d><h>16:09</h><w>seancorfield</w><a>@javahippie</a> If you want to disable it for all requests, you should be able to do something like this in your middleware stack
<pre>(ring-defaults/wrap-defaults
       (-&gt; ring-defaults/site-defaults
           (as-&gt; % (merge-with merge % (:ring-defaults config)))
           (assoc-in [:security :anti-forgery] false)))</pre></z><z id="t1588090210" t="seancorfield (ignore the as-&gt; line if you don&apos;t want to override other stuff)"><y>#</y><d>2020-04-28</d><h>16:10</h><w>seancorfield</w>(ignore the <code>as-&gt;</code> line if you don&apos;t want to override other stuff)</z><z id="t1588090238" t="javahippie Thanks for your response. For debugging, I already disabled it like this, but in general, having this anti forgery token is a good idea and I‚Äôd like to keep it"><y>#</y><d>2020-04-28</d><h>16:10</h><w>javahippie</w>Thanks for your response. For debugging, I already disabled it like this, but in general, having this anti forgery token is a good idea and I‚Äôd like to keep it</z><z id="t1588113133" t="Pavel Klav√≠k Hi, you can set different ring middleware for different routes so your solution would be disable antiforgery on just a single route. For this, you have to have routing before wrap-defaults. In Orgpad, we do routing twice (using Bidi): (b/make-handler [&quot;&quot; [[&quot;/api/&quot; [[true api-handler]]] [true site-handler]]]) For site-handler, I am using site defaults. But for api-handler, I am checking the access permissions directly."><y>#</y><d>2020-04-28</d><h>22:32</h><r>Pavel Klav√≠k</r>Hi, you can set different ring middleware for different routes so your solution would be disable antiforgery on just a single route. For this, you have to have routing before wrap-defaults. In Orgpad, we do routing twice (using Bidi):
<pre>(b/make-handler [&quot;&quot; [[&quot;/api/&quot; [[true api-handler]]]
                         [true site-handler]]])</pre>
For site-handler, I am using site defaults. But for api-handler, I am checking the access permissions directly.</z><z id="t1588156208" t="javahippie Nice, I forgot about that. We even have our routes split into web app and rest api routes, that‚Äôs a great idea, thank you!"><y>#</y><d>2020-04-29</d><h>10:30</h><r>javahippie</r>Nice, I forgot about that. We even have our routes split into web app and rest api routes, that‚Äôs a great idea, thank you!</z><z id="t1588090295" t="seancorfield Our apps are nearly all REST APIs and have their security (we have our own OAuth2 service and separate Auth/Login servers) so the Ring built-in stuff isn&apos;t useful."><y>#</y><d>2020-04-28</d><h>16:11</h><w>seancorfield</w>Our apps are nearly all REST APIs and have their security (we have our own OAuth2 service and separate Auth/Login servers) so the Ring built-in stuff isn&apos;t useful.</z><z id="t1588090460" t="javahippie I will have to think about this. I am going with serverside rendering, and I have some forms on the page with post data to the server"><y>#</y><d>2020-04-28</d><h>16:14</h><w>javahippie</w>I will have to think about this. I am going with serverside rendering, and I have some forms on the page with post data to the server</z><z id="t1588735840" t="tianshu I ran into entity is too large when receive a large file upload. Where can I modify the limit for file size?"><y>#</y><d>2020-05-06</d><h>03:30</h><w>tianshu</w>I ran into entity is too large when receive a large file upload. Where can I modify the limit for file size?</z><z id="t1588739899" t="seancorfield [:attrs {:href &quot;/_/_/users/U0NBGRGD6&quot;}] It will depend on which web server you are using. Some of them have JVM options you can set at start up, some have configuration files."><y>#</y><d>2020-05-06</d><h>04:38</h><w>seancorfield</w><a>@doglooksgood</a> It will depend on which web server you are using. Some of them have JVM options you can set at start up, some have configuration files.</z><z id="t1588739925" t="seancorfield (and how big is the file you are uploading??)"><y>#</y><d>2020-05-06</d><h>04:38</h><w>seancorfield</w>(and how big is the file you are uploading??)</z><z id="t1588746762" t="tianshu [:attrs {:href &quot;/_/_/users/U04V70XH6&quot;}] Okay, I&apos;m using the old jetty adapter, I did not notice it could be a JVM option. Support uploading for about 10mb."><y>#</y><d>2020-05-06</d><h>06:32</h><w>tianshu</w><a>@seancorfield</a> Okay, I&apos;m using the old jetty adapter, I did not notice it could be a JVM option. Support uploading for about 10mb.</z><z id="t1588747052" t="seancorfield [:attrs {:href &quot;/_/_/users/U0NBGRGD6&quot;}] I haven&apos;t tried this but... https://www.eclipse.org/jetty/documentation/current/setting-form-size.html#_for_all_apps_in_the_jvm"><y>#</y><d>2020-05-06</d><h>06:37</h><w>seancorfield</w><a>@doglooksgood</a> I haven&apos;t tried this but... <a href="https://www.eclipse.org/jetty/documentation/current/setting-form-size.html#_for_all_apps_in_the_jvm" target="_blank">https://www.eclipse.org/jetty/documentation/current/setting-form-size.html#_for_all_apps_in_the_jvm</a></z><z id="t1588747096" t="seancorfield (that said, we upload 10MB files with the default Jetty settings with no problems -- using the latest Ring/Jetty versions)"><y>#</y><d>2020-05-06</d><h>06:38</h><w>seancorfield</w>(that said, we upload 10MB files with the default Jetty settings with no problems -- using the latest Ring/Jetty versions)</z><z id="t1588747422" t="tianshu okay, thanks!"><y>#</y><d>2020-05-06</d><h>06:43</h><w>tianshu</w>okay, thanks!</z><z id="t1588885574" t="kwladyka How do you remove file after download it by client (web browser / API client)? So the client request , download the file and after all I want to remove the file what app generated."><y>#</y><d>2020-05-07</d><h>21:06</h><w>kwladyka</w>How do you remove file after download it by client (web browser / API client)?
So the client request <code></code>, download the file and after all I want to remove the file what app generated.</z><z id="t1588940555" t="jumar You could stream the content directly and thus avoid generating the file altogether. Or you implement a periodic cleanup process (Cron job)"><y>#</y><d>2020-05-08</d><h>12:22</h><r>jumar</r>You could stream the content directly and thus avoid generating the file altogether. Or you implement a periodic cleanup process (Cron job)</z><z id="t1588963243" t="kwladyka I have to generate file during processing anyway"><y>#</y><d>2020-05-08</d><h>18:40</h><r>kwladyka</r>I have to generate file during processing anyway</z><z id="t1588963250" t="kwladyka yes, there are things which I wanted to avoid"><y>#</y><d>2020-05-08</d><h>18:40</h><r>kwladyka</r>yes, there are things which I wanted to avoid</z><z id="t1588963261" t="kwladyka just wanted to do something after response complete"><y>#</y><d>2020-05-08</d><h>18:41</h><r>kwladyka</r>just wanted to do something after response complete</z><z id="t1588963267" t="kwladyka so remove file in this case"><y>#</y><d>2020-05-08</d><h>18:41</h><r>kwladyka</r>so remove file in this case</z><z id="t1589172141" t="jumar Why do you need to create the file on the disk when it&apos;s only purpose is to be sent over the wire?"><y>#</y><d>2020-05-11</d><h>04:42</h><r>jumar</r>Why do you need to create the file on the disk when it&apos;s only purpose is to be sent over the wire?</z><z id="t1589304056" t="kwladyka because I am using converter to PDF and later another library to rotate pages ‚Ä¶.. generally generating PDF when you have to care about each 1mm is so bad in Java"><y>#</y><d>2020-05-12</d><h>17:20</h><r>kwladyka</r>because I am using converter to PDF and later another library to rotate pages ‚Ä¶.. generally generating PDF when you have to care about each 1mm is so bad in Java</z><z id="t1589304064" t="kwladyka so I use external solutions in different laguages"><y>#</y><d>2020-05-12</d><h>17:21</h><r>kwladyka</r>so I use external solutions in different laguages</z><z id="t1588885619" t="kwladyka Any way to add action after response finish?"><y>#</y><d>2020-05-07</d><h>21:06</h><w>kwladyka</w>Any way to add action after response finish?</z><z id="t1589296090" t="Black How can you stream video file response so you are able to fast forward in html5 video control?"><y>#</y><d>2020-05-12</d><h>15:08</h><w>Black</w>How can you stream video file response so you are able to fast forward in html5 video control?</z><z id="t1589297168" t="Black Well, researching it all day and by adding next line it is solved üòÑ (header res &quot;accept-ranges&quot; &quot;bytes&quot;)"><y>#</y><d>2020-05-12</d><h>15:26</h><r>Black</r>Well, researching it all day and by adding next line it is solved <b>üòÑ</b>
<pre>(header res &quot;accept-ranges&quot; &quot;bytes&quot;)</pre></z><z id="t1590303590" t="EmmanuelOga I wonder if ring apps are generally vulnerable to keyword attacks... looking at https://github.com/mmcgrana/ring/blob/master/ring-core/src/ring/middleware/keyword_params.clj#L15 it looks like an attacker could request random url parameters repeatedly until filling the java process memory with interned keywords. I remember a similar attack on ruby/rails and symbols"><y>#</y><d>2020-05-24</d><h>06:59</h><w>EmmanuelOga</w>I wonder if ring apps are generally vulnerable to  keyword attacks... looking at <a href="https://github.com/mmcgrana/ring/blob/master/ring-core/src/ring/middleware/keyword_params.clj#L15" target="_blank">https://github.com/mmcgrana/ring/blob/master/ring-core/src/ring/middleware/keyword_params.clj#L15</a> it looks like an attacker could request random url parameters repeatedly until filling the java process memory with interned keywords. I remember a similar attack on ruby/rails and symbols</z><z id="t1590307847" t="mpenet I think they&apos;re interned into a weakmap, so they&apos;d be gc"><y>#</y><d>2020-05-24</d><h>08:10</h><w>mpenet</w>I think they&apos;re interned into a weakmap, so they&apos;d be gc</z><z id="t1590307886" t="mpenet So it would just cause some gc churn, not a memory leak"><y>#</y><d>2020-05-24</d><h>08:11</h><w>mpenet</w>So it would just cause some gc churn, not a memory leak</z><z id="t1590307936" t="mpenet If i recall correctly what you mention was an issue early on, like clj 1.1 or stg"><y>#</y><d>2020-05-24</d><h>08:12</h><w>mpenet</w>If i recall correctly what you mention was an issue early on, like clj 1.1 or stg</z><z id="t1590345535" t="kwladyka How to create prefix for URIs? I mean which can be whatever. :server-port :server-name :schema I was thinking about values above, but I am not sure how ring determine :server-name . Let‚Äôs say it will be in docker in k8s cluster. What will be this value then? How are you doing this? I have to return URLs to files on the server and I wanted keep it simple and not create additional configuration for host domain."><y>#</y><d>2020-05-24</d><h>18:38</h><w>kwladyka</w>How to create prefix for URIs? I mean <code></code> which can be whatever.

<pre>:server-port
  :server-name
  :schema</pre>
I was thinking about values above, but I am not sure how ring determine <code>:server-name</code>. Let‚Äôs say it will be in docker in k8s cluster. What will be this value then?

How are you doing this?

I have to return URLs to files on the server and I wanted keep it simple and not create additional configuration for host domain.</z><z id="t1590345550" t="kwladyka Can I use server-name for this purpose without issues?"><y>#</y><d>2020-05-24</d><h>18:39</h><w>kwladyka</w>Can I use <code>server-name</code> for this purpose without issues?</z><z id="t1590345687" t="kwladyka What is the best practice?"><y>#</y><d>2020-05-24</d><h>18:41</h><w>kwladyka</w>What is the best practice?</z><z id="t1590347348" t="Franklin I&apos;m looking for documentation/example on uploading files to a server using reitit and ring... please point me to the direction of such a resource if you know of any, thanks"><y>#</y><d>2020-05-24</d><h>19:09</h><w>Franklin</w>I&apos;m looking for documentation/example on uploading files to a server using reitit and ring... please point me to the direction of such a resource if you know of any, thanks</z><z id="t1590347639" t="Franklin I have spent hours trying to figure out how to do this.... you could even point me to what documentation I should read üò¢"><y>#</y><d>2020-05-24</d><h>19:13</h><r>Franklin</r>I have spent hours trying to figure out how to do this.... you could even point me to what documentation I should read <b>üò¢</b></z><z id="t1590348844" t="ikitommi all reitit swagger-examples have upload implemented"><y>#</y><d>2020-05-24</d><h>19:34</h><w>ikitommi</w>all reitit swagger-examples have upload implemented</z><z id="t1590348853" t="ikitommi https://github.com/metosin/reitit/tree/master/examples"><y>#</y><d>2020-05-24</d><h>19:34</h><r>ikitommi</r><a href="https://github.com/metosin/reitit/tree/master/examples" target="_blank">https://github.com/metosin/reitit/tree/master/examples</a></z><z id="t1590389937" t="Franklin thanks for replying, I have seen these examples, however there are issues I still face that I can&apos;t figure out https://github.com/FrankApiyo/PainAndSuffering"><y>#</y><d>2020-05-25</d><h>06:58</h><r>Franklin</r>thanks for replying, I have seen these examples, however there are issues I still face that I can&apos;t figure out <a href="https://github.com/FrankApiyo/PainAndSuffering" target="_blank">https://github.com/FrankApiyo/PainAndSuffering</a></z><z id="t1590389966" t="Franklin I&apos;m still stuck whith this"><y>#</y><d>2020-05-25</d><h>06:59</h><r>Franklin</r>I&apos;m still stuck whith this</z><z id="t1590389966" t="Franklin I&apos;m still stuck whith this"><y>#</y><d>2020-05-25</d><h>06:59</h><w>Franklin</w>I&apos;m still stuck whith this</z><z id="t1591512638" t="aaron51 Using [:attrs {:href &quot;/_/_/users/U0BKWMG5B&quot;}] ‚Äôs latest ring-oauth2 and clj-time 0.15.2, I‚Äôm getting ‚ÄúNo reader function for tag clj-time/date-time‚Äù in the callback step. It only happens in production and not in development or test. The error is similar to https://github.com/weavejester/ring-oauth2/issues/27 but my message is ‚Äúfor tag clj-time/date-time‚Äù. Any ideas how to work around this, or why it‚Äôs only in production? Thank you."><y>#</y><d>2020-06-07</d><h>06:50</h><w>aaron51</w>Using <a>@weavejester</a>‚Äôs latest ring-oauth2 and clj-time 0.15.2, I‚Äôm getting ‚ÄúNo reader function for tag clj-time/date-time‚Äù in the callback step. It only happens in production and not in development or test.

The error is similar to <a href="https://github.com/weavejester/ring-oauth2/issues/27" target="_blank">https://github.com/weavejester/ring-oauth2/issues/27</a> but my message is ‚Äúfor tag clj-time/date-time‚Äù.

Any ideas how to work around this, or why it‚Äôs only in production? Thank you.</z><z id="t1591544756" t="seancorfield [:attrs {:href &quot;/_/_/users/U3JH0P5LJ&quot;}] sounds like maybe the data_readers.clj file from clj-time didn&apos;t make it into your uberjar? How are you building that JAR?"><y>#</y><d>2020-06-07</d><h>15:45</h><w>seancorfield</w><a>@aaron51</a> sounds like maybe the <code>data_readers.clj</code> file from <code>clj-time</code> didn&apos;t make it into your uberjar? How are you building that JAR?</z><z id="t1591558742" t="aaron51 Thanks [:attrs {:href &quot;/_/_/users/U04V70XH6&quot;}] ‚Äî it‚Äôs built with lein uberjar . I jar xf ‚Äôd it and find clj_time | grep reader doesn‚Äôt show any files. Lein is in :pedantic mode so we had to add :exclusions to get it to compile ‚Äî could one of those have removed this file? clj-time.core is also in :aot in project.clj. We added some logging in production, and the value that fails to serialize/deserialize is #clj-time/date-time &quot;2020-06-07T20:20:56.554Z&quot; Thanks for any tips!"><y>#</y><d>2020-06-07</d><h>19:39</h><r>aaron51</r>Thanks <a>@U04V70XH6</a> ‚Äî it‚Äôs built with <code>lein uberjar</code>.

I <code>jar xf</code>‚Äôd it and <code>find clj_time | grep reader</code> doesn‚Äôt show any files.

Lein is in <code>:pedantic</code> mode so we had to add <code>:exclusions</code> to get it to compile ‚Äî could one of those have removed this file?

<code>clj-time.core</code> is also in <code>:aot</code> in project.clj.

We added some logging in production, and the value that fails to serialize/deserialize is <code>#clj-time/date-time &quot;2020-06-07T20:20:56.554Z&quot;</code>

Thanks for any tips!</z><z id="t1591566729" t="seancorfield Can you share your project.clj ?"><y>#</y><d>2020-06-07</d><h>21:52</h><r>seancorfield</r>Can you share your <code>project.clj</code> ?</z><z id="t1591572577" t="aaron51 Yes, I‚Äôll send via DM. Thanks!"><y>#</y><d>2020-06-07</d><h>23:29</h><r>aaron51</r>Yes, I‚Äôll send via DM. Thanks!</z><z id="t1591910359" t="aaron51 For future reference ‚Äî the fix was to specify :readers when creating cookie-store, like (cookie-store {:key admin-auth-cookie-store-key :readers *data-readers*})"><y>#</y><d>2020-06-11</d><h>21:19</h><r>aaron51</r>For future reference ‚Äî the fix was to specify :readers when creating cookie-store, like <code>(cookie-store {:key admin-auth-cookie-store-key :readers *data-readers*})</code></z><z id="t1591910452" t="seancorfield (that will make sure folks can find the answer in the Clojurians Log and in Zulip: https://clojurians.zulipchat.com/#narrow/stream/180378-slack-archive/topic/ring/near/200607738 )"><y>#</y><d>2020-06-11</d><h>21:20</h><r>seancorfield</r>(that will make sure folks can find the answer in the Clojurians Log and in Zulip: <a href="https://clojurians.zulipchat.com/#narrow/stream/180378-slack-archive/topic/ring/near/200607738" target="_blank">https://clojurians.zulipchat.com/#narrow/stream/180378-slack-archive/topic/ring/near/200607738</a> )</z><z id="t1591825105" t="naomarik I have a weird issue where redirects from Instagram are blowing away my session cookies. What&apos;s really weird is that logging in from the same tab as the fresh redirect, then refreshing will also blow it away. Only when I open a new tab my session will start sticking again. Googling anything similar doesn&apos;t show anything, any ideas? Here&apos;s the relevant ring code: (defn wrap-base [handler] (-&gt; ((:middleware defaults) handler) (wrap-defaults (-&gt; site-defaults (assoc-in [:session :store] (cookie-store {:key &quot;(censored-out)&quot;})) (assoc-in [:session :cookie-attrs :max-age] (encore/secs :years 5)) (assoc-in [:session :cookie-name] &quot;sayartii&quot;))) wrap-flash wrap-context wrap-internal-error)) Can test this pretty fast with this URL with localhost: https://l.instagram.com/?u=http://localhost/&amp;amp;e=ATOZD4ap2qEIu9s8WqSMxXEb-Uz4MB293WKSrvgHBDFAH6ZQc4rIudY-1yzmHhrQDXcT1lGjtNEM9pweBTNKvmNajNfyN3I8jW1lmA&amp;amp;s=1 but this bug happening on production too. Tested other websites and I seem to stay logged in fine."><y>#</y><d>2020-06-10</d><h>21:38</h><w>naomarik</w>I have a weird issue where redirects from Instagram are blowing away my session cookies. What&apos;s really weird is that logging in from the same tab as the fresh redirect, then refreshing will also blow it away. Only when I open a new tab my session will start sticking again. Googling anything similar doesn&apos;t show anything, any ideas? Here&apos;s the relevant ring code:

<pre>(defn wrap-base [handler]
  (-&gt; ((:middleware defaults) handler)
      (wrap-defaults
       (-&gt; site-defaults
           (assoc-in [:session :store] (cookie-store {:key &quot;(censored-out)&quot;}))
           (assoc-in [:session :cookie-attrs :max-age] (encore/secs :years 5))
           (assoc-in [:session :cookie-name] &quot;sayartii&quot;)))
      wrap-flash
      wrap-context
      wrap-internal-error))</pre>
Can test this pretty fast with this URL with localhost: <a href="https://l.instagram.com/?u=http://localhost/&amp;amp;e=ATOZD4ap2qEIu9s8WqSMxXEb-Uz4MB293WKSrvgHBDFAH6ZQc4rIudY-1yzmHhrQDXcT1lGjtNEM9pweBTNKvmNajNfyN3I8jW1lmA&amp;amp;s=1" target="_blank">https://l.instagram.com/?u=http://localhost/&amp;amp;e=ATOZD4ap2qEIu9s8WqSMxXEb-Uz4MB293WKSrvgHBDFAH6ZQc4rIudY-1yzmHhrQDXcT1lGjtNEM9pweBTNKvmNajNfyN3I8jW1lmA&amp;amp;s=1</a> but this bug happening on production too. Tested other websites and I seem to stay logged in fine.</z><z id="t1591825203" t="naomarik Refreshing the tab will constantly change the session cookie on the instagram redirected tab, but a normal tab it will stay as is."><y>#</y><d>2020-06-10</d><h>21:40</h><r>naomarik</r>Refreshing the tab will constantly change the session cookie on the instagram redirected tab, but a normal tab it will stay as is.</z><z id="t1591825244" t="naomarik Seems consistent across browsers too, was first found out on iOS Safari"><y>#</y><d>2020-06-10</d><h>21:40</h><r>naomarik</r>Seems consistent across browsers too, was first found out on iOS Safari</z><z id="t1591828020" t="naomarik Found it: https://github.com/ring-clojure/ring-defaults/blob/master/src/ring/middleware/defaults.clj#L45 same-site strict causes this. https://www.netsparker.com/blog/web-security/same-site-cookie-attribute-prevent-cross-site-request-forgery/#:~:text=When%20the%20SameSite%20attribute%20is,can%20affect%20browsing%20experience%20negatively.&amp;amp;text=Only%20in%20this%20way%2C%20the,as%20LAX%20will%20be%20sent ."><y>#</y><d>2020-06-10</d><h>22:27</h><r>naomarik</r>Found it: <a href="https://github.com/ring-clojure/ring-defaults/blob/master/src/ring/middleware/defaults.clj#L45" target="_blank">https://github.com/ring-clojure/ring-defaults/blob/master/src/ring/middleware/defaults.clj#L45</a> same-site strict causes this. <a href="https://www.netsparker.com/blog/web-security/same-site-cookie-attribute-prevent-cross-site-request-forgery/#:~:text=When%20the%20SameSite%20attribute%20is,can%20affect%20browsing%20experience%20negatively.&amp;amp;text=Only%20in%20this%20way%2C%20the,as%20LAX%20will%20be%20sent" target="_blank">https://www.netsparker.com/blog/web-security/same-site-cookie-attribute-prevent-cross-site-request-forgery/#:~:text=When%20the%20SameSite%20attribute%20is,can%20affect%20browsing%20experience%20negatively.&amp;amp;text=Only%20in%20this%20way%2C%20the,as%20LAX%20will%20be%20sent</a>.</z><z id="t1592903799" t="teodorlu Hey! Seeing that there&apos;s a dedicated channel for Ring, I&apos;m posting here too."><y>#</y><d>2020-06-23</d><h>09:16</h><w>teodorlu</w>Hey! Seeing that there&apos;s a dedicated channel for Ring, I&apos;m posting here too.</z><z id="t1592932904" t="seancorfield [:attrs {:href &quot;/_/_/users/U3X7174KS&quot;}] My general advice is &quot;don&apos;t use the ring plugin at all&quot;. Have a standard Leiningen project, with standard :dependencies , and set up your -main so you can just lein run it to start the server. Then plain ol&apos; lein uberjar should work and you&apos;re back in the land of standard, simple, composable tools -- instead of relying on the behavior of a plugin (that just obscures what is going on)."><y>#</y><d>2020-06-23</d><h>17:21</h><w>seancorfield</w><a>@teodorlu</a> My general advice is &quot;don&apos;t use the <code>ring</code> plugin at all&quot;. Have a standard Leiningen project, with standard <code>:dependencies</code>, and set up your <code>-main</code> so you can just <code>lein run</code> it to start the server. Then plain ol&apos; <code>lein uberjar</code> should work and you&apos;re back in the land of standard, simple, composable tools -- instead of relying on the behavior of a plugin (that just obscures what is going on).</z><z id="t1592940450" t="teodorlu Thanks. I&apos;m inclined to agree. Not knowing which dependencies are added to my jar file is ... a bit more magical than I&apos;d prefer. This is an existing project that already uses lein ring server , but I&apos;ll have to consider the cost of that magic."><y>#</y><d>2020-06-23</d><h>19:27</h><r>teodorlu</r>Thanks. I&apos;m inclined to agree. Not knowing which dependencies are added to my jar file is ... a bit more magical than I&apos;d prefer. This is an existing project that already uses <code>lein ring server</code>, but I&apos;ll have to consider the cost of that magic.</z><z id="t1593416380" t="ouvasam Hi all, I have some trouble to set the name of the cookie for the ring-session Here is what i have but the name of the cookie stay ring-sesssion If someone have an idea ? (def my-site-defaults &quot;A default configuration for a browser-accessible website that&apos;s accessed securely over HTTPS.&quot; (-&gt; api-defaults (assoc-in [:session :cookie-name] &quot;jsessionid&quot;))) (def fw-app (-&gt; (handler/site app-routes) (reload/wrap-reload) (wrap-default-charset &quot;utf-8&quot;) (wrap-defaults my-site-defaults) (wrap-multipart-params) (wrap-json-params) (wrap-json-response {:pretty false}) (wrap-gzip)))"><y>#</y><d>2020-06-29</d><h>07:39</h><w>ouvasam</w>Hi all,
I have some trouble to set the name of the cookie for the ring-session
Here is what i have but the name of the cookie stay ring-sesssion
If someone have an idea ?
<pre>(def my-site-defaults
  &quot;A default configuration for a browser-accessible website that&apos;s accessed
  securely over HTTPS.&quot;
  (-&gt; api-defaults
      (assoc-in [:session :cookie-name] &quot;jsessionid&quot;)))

(def fw-app
  (-&gt; (handler/site app-routes)
      (reload/wrap-reload)
      (wrap-default-charset &quot;utf-8&quot;)
      (wrap-defaults my-site-defaults)
      (wrap-multipart-params)
      (wrap-json-params)
      (wrap-json-response {:pretty false})
      (wrap-gzip)))</pre></z><z id="t1593417853" t="ouvasam It seems my problem is with anti-forgery when using site-default"><y>#</y><d>2020-06-29</d><h>08:04</h><r>ouvasam</r>It seems my problem is with anti-forgery when using site-default</z><z id="t1593417912" t="ouvasam &lt;h1&gt;Invalid anti-forgery token&lt;/h1&gt;"><y>#</y><d>2020-06-29</d><h>08:05</h><r>ouvasam</r>&lt;h1&gt;Invalid anti-forgery token&lt;/h1&gt;</z><z id="t1593418143" t="ouvasam setting anti-forgery to false make my site work but can&apos;t rename the cookie..."><y>#</y><d>2020-06-29</d><h>08:09</h><r>ouvasam</r>setting anti-forgery to false make my site work but can&apos;t rename the cookie...</z><z id="t1593423052" t="ouvasam i use http-kit may be there is a problem here ?"><y>#</y><d>2020-06-29</d><h>09:30</h><r>ouvasam</r>i use http-kit may be there is a problem here ?</z><z id="t1593497585" t="ouvasam I can&apos;t set the name and can&apos;t set the cookie secure don&apos;t understand what i am doing wrong ... I did the same as examples found on the web"><y>#</y><d>2020-06-30</d><h>06:13</h><w>ouvasam</w>I can&apos;t set the name and can&apos;t set the cookie secure don&apos;t understand what i am doing wrong ... I did the same as examples found on the web</z></g><g id="s7"><z id="t1593497595" t="ouvasam I fanybody has some tips ?"><y>#</y><d>2020-06-30</d><h>06:13</h><w>ouvasam</w>I fanybody has some tips ?</z><z id="t1593497596" t="ouvasam thanks"><y>#</y><d>2020-06-30</d><h>06:13</h><w>ouvasam</w>thanks</z><z id="t1593506540" t="ouvasam Hi, I have some troubles to have a secure session cookie with ring I tried all the solutions i could find on the web, but it does not work and i still have a cookie named &quot;ring-session&quot; once i set a value in the session. The cookie name is not reflected and the cookie not secure Here is my code (defroutes app-routes (GET &quot;/&quot; req {:body (str req) :session {:test 1}})) (def my-api-defaults (-&gt; secure-api-defaults (assoc-in [:session :store] (cookie-store)) (assoc-in [:session :cookie-name] &quot;JSESSIONID&quot;))) (def app (-&gt; (handler/site app-routes) (wrap-defaults my-api-defaults))) (defn start-server [] (run-jetty app {:port 9291 :ssl? true})) (defn -main [&amp; args] (start-server)) Does someone have any ideay on what i am doing wrong ? (i use tomcat to deploy the war )"><y>#</y><d>2020-06-30</d><h>08:42</h><w>ouvasam</w>Hi,
I have some troubles to have a secure session cookie with ring
I tried all the solutions i could find on the web, but it does not work and i still have a cookie named &quot;ring-session&quot; once i set a value in the session. The cookie name is not reflected and the cookie not secure
Here is my code
<pre>(defroutes app-routes
           (GET &quot;/&quot; req  {:body  (str req)
                          :session {:test 1}}))

(def my-api-defaults
  (-&gt; secure-api-defaults
      (assoc-in [:session :store] (cookie-store))
      (assoc-in [:session :cookie-name] &quot;JSESSIONID&quot;)))

(def app
  (-&gt; (handler/site app-routes)
      (wrap-defaults my-api-defaults)))

(defn start-server
  []
  (run-jetty app {:port 9291
                  :ssl? true}))

(defn -main [&amp; args]
  (start-server))</pre>
Does someone have any ideay on what i am doing wrong ?
(i use tomcat to deploy the war )</z><z id="t1593511370" t="jumar Is the &quot;tomcat deployment&quot; part of the problem? Does it work when running from the REPL?"><y>#</y><d>2020-06-30</d><h>10:02</h><r>jumar</r>Is the &quot;tomcat deployment&quot; part of the problem? Does it work when running from the REPL?</z><z id="t1593511543" t="jumar [:attrs {:href &quot;/_/_/users/U0F7M1KA7&quot;}] I haven&apos;t used this with apis only UI. Looking at the api-defaults and site-defaults I&apos;d say that the problem is there&apos;s no top-level :session config in api-defaults."><y>#</y><d>2020-06-30</d><h>10:05</h><r>jumar</r><a>@U0F7M1KA7</a> I haven&apos;t used this with apis only UI.
Looking at the <code>api-defaults</code> and <code>site-defaults</code> I&apos;d say that the problem is there&apos;s no top-level <code>:session</code> config in api-defaults.</z><z id="t1593511759" t="ouvasam Many thanks but if i set as secure-site-defaults, it stay the same. It create cookie for the session, but also create a ring-session once i want to set a value in the session üòû"><y>#</y><d>2020-06-30</d><h>10:09</h><r>ouvasam</r>Many thanks but if i set as secure-site-defaults,  it stay the same. It create cookie for the session, but also create a ring-session once i want to set a value in the session <b>üòû</b></z><z id="t1593511910" t="jumar I don&apos;t use special :cookie-name It might be a stupid question but why do you need that?"><y>#</y><d>2020-06-30</d><h>10:11</h><r>jumar</r>I don&apos;t use special <code>:cookie-name</code> It might be a stupid question but why do you need that?</z><z id="t1593512057" t="ouvasam Cookie name is not really the problem, but it show that these params are not taken in account. Secure cookie is the main problem. With secure-site-defaults, it create a correct cookie with the correct name and the coorect secure flag. But once i set avalue, it create a ring-session cookienon secure I think the problem should come from tomcat (servlet) but i can&apos;t find how to set and use the sesssion there"><y>#</y><d>2020-06-30</d><h>10:14</h><r>ouvasam</r>Cookie name is not really the problem, but it show that these params are not taken in account.
Secure cookie is the main problem.
With secure-site-defaults, it create a correct cookie with the correct name and the coorect secure flag. But once i set avalue, it create a ring-session cookienon secure
I think the problem should come from tomcat (servlet) but i can&apos;t find how to set and use the sesssion there</z><z id="t1593512146" t="jumar Does it work in the REPL?"><y>#</y><d>2020-06-30</d><h>10:15</h><r>jumar</r>Does it work in the REPL?</z><z id="t1593512271" t="ouvasam i can&apos;t test a secure connection wihtout tomcat"><y>#</y><d>2020-06-30</d><h>10:17</h><r>ouvasam</r>i can&apos;t test a secure connection wihtout tomcat</z><z id="t1593512311" t="ouvasam The code is from all the place that use seomthing similar so i think it should work, but they don&apos;t use tomcat"><y>#</y><d>2020-06-30</d><h>10:18</h><r>ouvasam</r>The code is from all the place that use seomthing similar so i think it should work, but they don&apos;t use tomcat</z><z id="t1593512898" t="ouvasam many thanks to had a look [:attrs {:href &quot;/_/_/users/U06BE1L6T&quot;}] ! üôè"><y>#</y><d>2020-06-30</d><h>10:28</h><r>ouvasam</r>many thanks to had a look <a>@U06BE1L6T</a>! <b>üôè</b></z><z id="t1594154888" t="Johnny When exactly do ring sessions get deleted? I have a &quot;log in via oauth2&quot; thing on a website and before redirecting to the authorisation url I store a few things (such as the original uri requested) in the session. But after the login is completed and redirected to my website, the previous session is gone. For some reason (I really have no clue why) this didn&apos;t happen until I started tampering with it again. I tried to reproduce the state of the code in which it worked but had no success. Now it again drops the session every time."><y>#</y><d>2020-07-07</d><h>20:48</h><w>Johnny</w>When exactly do ring sessions get deleted? I have a &quot;log in via oauth2&quot; thing on a website and before redirecting to the authorisation url I store a few things (such as the original uri requested) in the session. But after the login is completed and redirected to my website, the previous session is gone. For some reason (I really have no clue why) this didn&apos;t happen until I started tampering with it again. I tried to reproduce the state of the code in which it worked but had no success. Now it again drops the session every time.</z><z id="t1594154952" t="Johnny I&apos;m looking for an explanation as well as how to circumvent/fix this"><y>#</y><d>2020-07-07</d><h>20:49</h><w>Johnny</w>I&apos;m looking for an explanation as well as how to circumvent/fix this</z><z id="t1594154986" t="Johnny I can send the code, but it&apos;s really just the default middleware + oauth2 middleware from clj-oauth2"><y>#</y><d>2020-07-07</d><h>20:49</h><w>Johnny</w>I can send the code, but it&apos;s really just the default middleware + oauth2 middleware from <code>clj-oauth2</code></z><z id="t1594198749" t="Johnny Figured it out with the help of [:attrs {:href &quot;/_/_/users/U24QP2D4J&quot;}] . :same-site in the cookie attributes was set to :strict , needed to be :lax to get the same cookie when redirecting back from the oauth authorisation."><y>#</y><d>2020-07-08</d><h>08:59</h><w>Johnny</w>Figured it out with the help of <a>@lsenjov</a>. <code>:same-site</code>  in the cookie attributes was set to <code>:strict</code> , needed to be <code>:lax</code> to get the same cookie when redirecting back from the oauth authorisation.</z><z id="t1594297646" t="synthomat Hey, I have a rather weird bug: after authentification with friend , the browser (sometimes?) redirects to /favicon.ico ‚Äì¬†I don‚Äôt have a favicon in my code and this error also happens from time to time in my other projects; is this a known ring issue, does it have to do with order of middlewares or is it connected to friend-auth? I can‚Äôt find a reason for this behaviour; Does someone have an idea? ‚Äì Thank you!"><y>#</y><d>2020-07-09</d><h>12:27</h><w>synthomat</w>Hey, I have a rather weird bug: after authentification with <code>friend</code> , the browser (sometimes?) redirects to <code>/favicon.ico</code>  ‚Äì¬†I don‚Äôt have a favicon in my code and this error also happens from time to time in my other projects; is this a known ring issue, does it have to do with order of middlewares or is it connected to friend-auth? I can‚Äôt find a reason for this behaviour; Does someone have an idea? ‚Äì Thank you!</z><z id="t1594321107" t="jumar Browsers often request favicon.ico to display it as a mini-icon in the browser tab but I don&apos;t see a reason why you should be explicitly redirected there. We use both friend and ring and I&apos;ve never seen such a behavior"><y>#</y><d>2020-07-09</d><h>18:58</h><w>jumar</w>Browsers often request favicon.ico to display it as a mini-icon in the browser tab but I don&apos;t see a reason why you should be explicitly redirected there. We use both friend and ring and I&apos;ve never seen such a behavior</z><z id="t1594329009" t="synthomat so after a successful login the POST /login endpoint returns a 303, and a location header pointing to the favicon file üòê"><y>#</y><d>2020-07-09</d><h>21:10</h><w>synthomat</w>so after a successful login the <code>POST /login</code> endpoint returns a 303, and a <code>location</code>  header pointing to the favicon file <b>üòê</b></z><z id="t1594332286" t="synthomat seems like :default-landing-uri of friend is being ignored when this favicon thingy kicks in‚Ä¶ on a subsequent login, it works as expected"><y>#</y><d>2020-07-09</d><h>22:04</h><w>synthomat</w>seems like <code>:default-landing-uri</code>  of friend is being ignored when this favicon thingy kicks in‚Ä¶ on a subsequent login, it works as expected</z><z id="t1594333408" t="synthomat just looking at the session data, there is :cemerick.friend/unauthorized-uri ‚Ä¶ I don‚Äôt even‚Ä¶"><y>#</y><d>2020-07-09</d><h>22:23</h><w>synthomat</w>just looking at the session data, there is <code>:cemerick.friend/unauthorized-uri </code> ‚Ä¶ I don‚Äôt even‚Ä¶</z><z id="t1594333775" t="seancorfield [:attrs {:href &quot;/_/_/users/U4E39A29Y&quot;}] So a request is being made for the favicon before you&apos;ve auth&apos;d -- which makes sense. I would recommend setting up auth so /favicon.ico is allowed through without requiring auth -- make it an exempt route."><y>#</y><d>2020-07-09</d><h>22:29</h><w>seancorfield</w><a>@synthomat</a> So a request is being made for the <code>favicon</code> before you&apos;ve auth&apos;d -- which makes sense. I would recommend setting up auth so <code>/favicon.ico</code> is allowed through without requiring auth -- make it an exempt route.</z><z id="t1594333828" t="synthomat oh god, no please‚Ä¶"><y>#</y><d>2020-07-09</d><h>22:30</h><w>synthomat</w>oh god, no please‚Ä¶</z><z id="t1594333831" t="synthomat yes!"><y>#</y><d>2020-07-09</d><h>22:30</h><w>synthomat</w>yes!</z><z id="t1594333852" t="synthomat just found this out myself:man-facepalming:"><y>#</y><d>2020-07-09</d><h>22:30</h><w>synthomat</w>just found this out myself:man-facepalming:</z><z id="t1594333873" t="synthomat had do inject a logging middleware to find out what‚Äôs going on‚Ä¶"><y>#</y><d>2020-07-09</d><h>22:31</h><w>synthomat</w>had do inject a logging middleware to find out what‚Äôs going on‚Ä¶</z><z id="t1594334017" t="synthomat so friend stores the originally requested resource before the authentication page kicks in to conveniently redirect the user back to the original request after successful authentification; but because (technically) favicon.ico happens to be the latest requested resource, friend redirects the user to that file after successful authentification"><y>#</y><d>2020-07-09</d><h>22:33</h><w>synthomat</w>so friend stores the originally requested resource before the authentication page kicks in to conveniently redirect the user back to the original request after successful authentification; but because (technically) <code>favicon.ico</code>  happens to be the latest requested resource, <code>friend</code>  redirects the user to that file after successful authentification</z><z id="t1594334023" t="synthomat mind -&gt; blown"><y>#</y><d>2020-07-09</d><h>22:33</h><w>synthomat</w>mind -&gt; blown</z><z id="t1594334050" t="synthomat thanks [:attrs {:href &quot;/_/_/users/U06BE1L6T&quot;}] and [:attrs {:href &quot;/_/_/users/U04V70XH6&quot;}] !"><y>#</y><d>2020-07-09</d><h>22:34</h><w>synthomat</w>thanks <a>@jumar</a> and <a>@seancorfield</a>!</z><z id="t1594334827" t="seancorfield I only know because it has bitten me countless times in various situations and so now I always make sure that URL is readable regardless of auth/login stuff..."><y>#</y><d>2020-07-09</d><h>22:47</h><w>seancorfield</w>I only know because it has bitten me countless times in various situations and so now I always make sure that URL is readable regardless of auth/login stuff...</z><z id="t1594334867" t="synthomat wouldn‚Äôt it be better if friend stored the redirect url in a query parameter like many other libs do instead in the session?"><y>#</y><d>2020-07-09</d><h>22:47</h><w>synthomat</w>wouldn‚Äôt it be better if friend stored the redirect url in a query parameter like many other libs do instead in the session?</z><z id="t1594335062" t="synthomat good point [:attrs {:href &quot;/_/_/users/U04V70XH6&quot;}] , I now just added a fake favicon to my resource folder and it seems to do the trick; friend does not intercept because it‚Äôs a file that can actually be fetched"><y>#</y><d>2020-07-09</d><h>22:51</h><w>synthomat</w>good point <a>@seancorfield</a>, I now just added a fake favicon to my resource folder and it seems to do the trick; friend does not intercept because it‚Äôs a file that can actually be fetched</z><z id="t1594335520" t="seancorfield (I&apos;ve never used Friend or Buddy or any other Clojure auth lib)"><y>#</y><d>2020-07-09</d><h>22:58</h><w>seancorfield</w>(I&apos;ve never used Friend or Buddy or any other Clojure auth lib)</z><z id="t1595139704" t="benny i need to use http-kit for websockets but would prefer to keep the simplicity of using the lein-ring plugin, is it possible without jetty?"><y>#</y><d>2020-07-19</d><h>06:21</h><w>benny</w>i need to use http-kit for websockets but would prefer to keep the simplicity of using the lein-ring plugin, is it possible without jetty?</z><z id="t1595941831" t="ouvasam Hi, I don&apos;t think so. you should use lein run instead i think"><y>#</y><d>2020-07-28</d><h>13:10</h><r>ouvasam</r>Hi,
I don&apos;t think so. you should use <code>lein run</code> instead i think</z><z id="t1595187086" t="seancorfield [:attrs {:href &quot;/_/_/users/U4ZJ5UHQD&quot;}] I&apos;ve never used lein-ring . I&apos;ve always just started Jetty directly, which makes it much easier to switch web servers (we&apos;ve gone back and forth between Jetty and http-kit in production over the years). Also, I thought Jetty supported WebSockets these days?"><y>#</y><d>2020-07-19</d><h>19:31</h><w>seancorfield</w><a>@benny</a> I&apos;ve never used <code>lein-ring</code>. I&apos;ve always just started Jetty directly, which makes it much easier to switch web servers (we&apos;ve gone back and forth between Jetty and http-kit in production over the years). Also, I thought Jetty supported WebSockets these days?</z><z id="t1595941735" t="ouvasam Hi, i am trying to start a crux node when my ring app is launched. I use lein ring uberwar and deploy it with tomcat. My ring config is :ring { :handler app.core/app :init app.core/start-app! :destroy app.core/stop-app! :servlet-name &quot;ehdsicts2_servlet&quot; :servlet-class &quot;ehdsicts2_servlet&quot; :resources-war-path &quot;WEB-INF/classes/&quot; :uberwar-name &quot;ehdsicts2.war&quot;} the start-app! function start the crux node like (defonce node (atom nil)); (start-node &quot;crux-store&quot;)) (defn start-node [storage-dir] (reset! node (crux/start-node {:crux.node/topology &apos;[crux.standalone/topology crux.kv.rocksdb/kv-store] :crux.standalone/event-log-dir &quot;/Users/ouvanous/ehdsi-cts/crux-store/eventlog-1&quot; :crux.standalone/event-log-kv-store &apos;crux.kv.rocksdb/kv :crux.kv/db-dir (str &quot;/Users/ouvanous/ehdsi-cts/crux-store/db&quot;)})) nil) (defn stop-node [] (.close @node)) While using it as a jar, everything works correctly but when deploying it on tomcat, tomcat is crashing and i can&apos;t find any useful inofmration on what the problem can be ... May b e someone here know what i miss here? I did post also this question on #crux channel but it is not really related to crux itself as this works outside tomcat. Any tip would be very appreciated Many thanks and have a nice day!"><y>#</y><d>2020-07-28</d><h>13:08</h><w>ouvasam</w>Hi, i am trying to start a crux node when my ring app is launched.
I use lein ring uberwar and deploy it with tomcat.
My ring config is
<pre>:ring {
                   :handler app.core/app
                   :init app.core/start-app!
                   :destroy app.core/stop-app!
                   :servlet-name &quot;ehdsicts2_servlet&quot;
                   :servlet-class &quot;ehdsicts2_servlet&quot;
                   :resources-war-path &quot;WEB-INF/classes/&quot;
                   :uberwar-name &quot;ehdsicts2.war&quot;}</pre>
the start-app! function start the crux node like
<pre>(defonce node (atom nil)); (start-node &quot;crux-store&quot;))

(defn start-node [storage-dir]
  (reset! node
          (crux/start-node {:crux.node/topology &apos;[crux.standalone/topology
                                                  crux.kv.rocksdb/kv-store]
                            :crux.standalone/event-log-dir &quot;/Users/ouvanous/ehdsi-cts/crux-store/eventlog-1&quot;
                            :crux.standalone/event-log-kv-store &apos;crux.kv.rocksdb/kv
                            :crux.kv/db-dir (str &quot;/Users/ouvanous/ehdsi-cts/crux-store/db&quot;)}))
  nil)

(defn stop-node
  []
  (.close @node))</pre>
While using it as a jar, everything works correctly but when deploying it on tomcat, tomcat is crashing and i can&apos;t find any useful inofmration on what the problem can be ...
May b e someone here know what i miss here?
I did post also this question on #crux channel but it is not really related to crux itself as this works outside tomcat.
Any tip would be very appreciated
Many thanks and have a nice day!</z><z id="t1597289091" t="benny i‚Äôm getting mixed signals on how best to hot-reload my app. i‚Äôm using compojure + httpkit and have a healthy stack of existing middleware. i have (reset! server (http-kit/run-server #&apos;app {:host &quot;0.0.0.0&quot; :port port})) what else do i need?"><y>#</y><d>2020-08-13</d><h>03:24</h><w>benny</w>i‚Äôm getting mixed signals on how best to hot-reload my app. i‚Äôm using compojure + httpkit and have a healthy stack of existing middleware. i have
<pre>(reset! server (http-kit/run-server #&apos;app {:host &quot;0.0.0.0&quot; :port port}))</pre>
what else do i need?</z><z id="t1597330683" t="frankitox https://ring-clojure.github.io/ring/ring.middleware.reload.html ?"><y>#</y><d>2020-08-13</d><h>14:58</h><w>frankitox</w><a href="https://ring-clojure.github.io/ring/ring.middleware.reload.html" target="_blank">https://ring-clojure.github.io/ring/ring.middleware.reload.html</a> ?</z><z id="t1597553344" t="benny i tried adding that to my middelware stack and it doesn‚Äôt reload üòï"><y>#</y><d>2020-08-16</d><h>04:49</h><r>benny</r>i tried adding that to my middelware stack and it doesn‚Äôt reload <b>üòï</b></z><z id="t1597553385" t="benny just kidding, i just needed to load my namespace to the repl"><y>#</y><d>2020-08-16</d><h>04:49</h><r>benny</r>just kidding, i just needed to load my namespace to the repl</z><z id="t1598972328" t="Twan üëã Hi! I&apos;m trying to use https://github.com/weavejester/ring-oauth2 to do OAuth2 with (hosted) Azure AD. For some reason, I&apos;m not able to pick up an access token after logging into Azure. However, for Github this login flow works. I get the feeling that the cookie the JWT of Azure is cramped in is too big. Might this be of an issue?"><y>#</y><d>2020-09-01</d><h>14:58</h><w>Twan</w><b>üëã</b>  Hi! I&apos;m trying to use <a href="https://github.com/weavejester/ring-oauth2" target="_blank">https://github.com/weavejester/ring-oauth2</a> to do OAuth2 with (hosted) Azure AD. For some reason, I&apos;m not able to pick up an access token after logging into Azure. However, for Github this login flow works. I get the feeling that the cookie the JWT of Azure is cramped in is too big. Might this be of an issue?</z><z id="t1598972405" t="Twan I&apos;m thinking this, because if I hardcode a little access token into https://github.com/weavejester/ring-oauth2/blob/master/src/ring/middleware/oauth2.clj#L106 the result is that I get that (fake) token back, but only then"><y>#</y><d>2020-09-01</d><h>15:00</h><r>Twan</r>I&apos;m thinking this, because if I hardcode a little access token into <a href="https://github.com/weavejester/ring-oauth2/blob/master/src/ring/middleware/oauth2.clj#L106" target="_blank">https://github.com/weavejester/ring-oauth2/blob/master/src/ring/middleware/oauth2.clj#L106</a> the result is that I get that (fake) token back, but only then</z><z id="t1599798108" t="Crispin Hi there everyone. I&apos;m trying to write a ring middleware that will check a stripe webhook callback&apos;s signature. The signature is in the header. Can get that fine. But I need to verify it by comparing it with the raw body, as that is what is signed. The raw body is json. Then if it passes, future middleware will decode the json."><y>#</y><d>2020-09-11</d><h>04:21</h><w>Crispin</w>Hi there everyone. I&apos;m trying to write a ring middleware that will check a stripe webhook callback&apos;s signature. The signature is in the header. Can get that fine. But I need to verify it by comparing it with the raw body, as that is what is signed. The raw body is json. Then if it passes, future middleware will decode the json.</z><z id="t1599798151" t="Crispin The issue is that body is presented as a stream. And if I slurp the stream, then future json middleware gets an empty body content, and the stream has been consumed"><y>#</y><d>2020-09-11</d><h>04:22</h><w>Crispin</w>The issue is that body is presented as a stream. And if I slurp the stream, then future json middleware gets an empty body content, and the stream has been consumed</z><z id="t1599798184" t="Crispin how do I verify a header signature against the raw body contents, without consuming the stream?"><y>#</y><d>2020-09-11</d><h>04:23</h><w>Crispin</w>how do I verify a header signature against the raw body contents, without consuming the stream?</z><z id="t1599798191" t="Crispin any ideas on the best approach?"><y>#</y><d>2020-09-11</d><h>04:23</h><w>Crispin</w>any ideas on the best approach?</z><z id="t1599798456" t="Crispin is the best way to create a new stream and push the contents back onto it? or is there an easier way?"><y>#</y><d>2020-09-11</d><h>04:27</h><w>Crispin</w>is the best way to create a new stream and push the contents back onto it? or is there an easier way?</z><z id="t1599800139" t="Crispin Ok. I made this test and it seems to work:"><y>#</y><d>2020-09-11</d><h>04:55</h><w>Crispin</w>Ok. I made this test and it seems to work:</z><z id="t1599800206" t="Crispin (defn wrap-test [handler] (fn ([request] (log/info &quot;wrap-test/1&quot;) (let [content (slurp (:body request))] (log/info &quot;body is&quot; content) (handler (assoc request :body (io/input-stream (.getBytes content)))))) ([request respond raise] (log/info &quot;wrap-test/3&quot;) (let [content (slurp (:body request))] (log/info &quot;body is&quot; content) (handler (assoc request :body (io/input-stream (.getBytes content))) respond raise)))))"><y>#</y><d>2020-09-11</d><h>04:56</h><w>Crispin</w><pre>(defn wrap-test [handler]
  (fn
    ([request]
     (log/info &quot;wrap-test/1&quot;)
     (let [content (slurp (:body request))]
       (log/info &quot;body is&quot; content)
       (handler (assoc request :body (io/input-stream (.getBytes content))))))
    ([request respond raise]
     (log/info &quot;wrap-test/3&quot;)
     (let [content (slurp (:body request))]
       (log/info &quot;body is&quot; content)
       (handler (assoc request :body (io/input-stream (.getBytes content))) respond raise)))))</pre></z><z id="t1599800251" t="Crispin slurps the body... but then creates a new body for subsequent processing by creating a input-stream from the contents"><y>#</y><d>2020-09-11</d><h>04:57</h><w>Crispin</w>slurps the body... but then creates a new body for subsequent processing by creating a input-stream from the contents</z><z id="t1599800266" t="Crispin I will proceed with this, but if there is a better way please let me know"><y>#</y><d>2020-09-11</d><h>04:57</h><w>Crispin</w>I will proceed with this, but if there is a better way please let me know</z><z id="t1599801644" t="Crispin I guess I would have to be careful of a DoS attack with this of someone sending a multi terrabyte body...?"><y>#</y><d>2020-09-11</d><h>05:20</h><w>Crispin</w>I guess I would have to be careful of a DoS attack with this of someone sending a multi terrabyte body...?</z><z id="t1599834474" t="jumar Why don&apos;t you validate only after it&apos;s read as JSON? And do you really need a middleware? Do you have more than one stripe webhook route?"><y>#</y><d>2020-09-11</d><h>14:27</h><w>jumar</w>Why don&apos;t you validate only after it&apos;s read as JSON?
And do you really need a middleware? Do you have more than one stripe webhook route?</z><z id="t1599912811" t="Crispin &gt; Why don&apos;t you validate only after it&apos;s read as JSON?"><y>#</y><d>2020-09-12</d><h>12:13</h><r>Crispin</r>&gt; Why don&apos;t you validate only after it&apos;s read as JSON?</z><z id="t1599912822" t="Crispin because I have no access to the raw body at that stage"><y>#</y><d>2020-09-12</d><h>12:13</h><r>Crispin</r>because I have no access to the raw body at that stage</z><z id="t1599912871" t="Crispin and the signature is of the raw body, not of the decoded json. Even if I re-encoded the json, its not garunteed to be byte for byte identical"><y>#</y><d>2020-09-12</d><h>12:14</h><r>Crispin</r>and the signature is of the raw body, not of the decoded json. Even if I re-encoded the json, its not garunteed to be byte for byte identical</z><z id="t1599912894" t="Crispin &gt; Do you have more than one stripe webhook route?"><y>#</y><d>2020-09-12</d><h>12:14</h><r>Crispin</r>&gt; Do you have more than one stripe webhook route?</z><z id="t1599912896" t="Crispin yes"><y>#</y><d>2020-09-12</d><h>12:14</h><r>Crispin</r>yes</z><z id="t1599912904" t="Crispin actually no."><y>#</y><d>2020-09-12</d><h>12:15</h><r>Crispin</r>actually no.</z><z id="t1599912921" t="Crispin sorry. only one route. but multiple messages"><y>#</y><d>2020-09-12</d><h>12:15</h><r>Crispin</r>sorry. only one route. but multiple messages</z><z id="t1599912953" t="Crispin I guess I could just process it raw then without any middleware at all... :thinking_face:"><y>#</y><d>2020-09-12</d><h>12:15</h><r>Crispin</r>I guess I could just process it raw then without any middleware at all... <b>:thinking_face:</b></z><z id="t1599879125" t="antonmos ive got kind of an obscure question üôÇ I have 2 apps, both with jetty/ring-adapter 1.8.1, muuntaja 0.6.7 for transit. I‚Äôd like to stream it all the way to the browser. the browser calls app A, which calls app B using clj-http 3.10.1 and with the following options (defn as-stream [params] (-&gt; params (assoc :as :stream :decompress-body false) (update :headers assoc :accept-encoding &quot;gzip&quot;))) to avoid unziping and rezipping the response. App B pulls a large dataset from the db. I just enabled streaming in muuntaja with :return :output-stream When i call app B directly via curl, i get the response within a reasonable time. When i call app A, the streaming happens very very slowly, with multi second pauses. Does this ring any bells for anyone?"><y>#</y><d>2020-09-12</d><h>02:52</h><w>antonmos</w>ive got kind of an obscure question <b>üôÇ</b>

I have 2 apps, both with jetty/ring-adapter 1.8.1, muuntaja 0.6.7 for transit.
I‚Äôd like to stream it all the way to the  browser.

the  browser calls app A, which calls app B using clj-http 3.10.1 and with the following options
<pre>(defn as-stream [params]
  (-&gt; params
      (assoc :as :stream :decompress-body false)
      (update :headers assoc :accept-encoding &quot;gzip&quot;)))</pre>
to avoid unziping and rezipping the response.

App B  pulls a large dataset from the db. I just enabled streaming in muuntaja with <code>:return :output-stream</code>
When i call app B directly via curl, i get the response within a reasonable time.
When i call app A, the streaming happens very very slowly, with multi second pauses.

Does this ring any bells for anyone?</z><z id="t1599879214" t="antonmos cc [:attrs {:href &quot;/_/_/users/U055NJ5CC&quot;}] because muuntaja is involved"><y>#</y><d>2020-09-12</d><h>02:53</h><r>antonmos</r>cc <a>@U055NJ5CC</a> because muuntaja is involved</z><z id="t1599880513" t="antonmos google has led me to http://jetty.4.x6.nabble.com/Streaming-proxy-of-content-using-jetty-and-jetty-client-with-end-to-end-flow-control-td4967006.html#a4967012 which seems potentially relevant except that i just want to proxy the response, not the request"><y>#</y><d>2020-09-12</d><h>03:15</h><r>antonmos</r>google has led me to <a href="http://jetty.4.x6.nabble.com/Streaming-proxy-of-content-using-jetty-and-jetty-client-with-end-to-end-flow-control-td4967006.html#a4967012" target="_blank">http://jetty.4.x6.nabble.com/Streaming-proxy-of-content-using-jetty-and-jetty-client-with-end-to-end-flow-control-td4967006.html#a4967012</a> which seems potentially relevant except that i just want to proxy the response, not the request</z><z id="t1599896300" t="ikitommi Not sure how transit &amp; clj-http play together when streaming. The :as :stream might be blocking operation as I think is the transit write (but, with different streams). Might also be a bug in muuntaja-streamong-transit. If there is a jsva-side reverse proxy code available, I would anyway go with that."><y>#</y><d>2020-09-12</d><h>07:38</h><r>ikitommi</r>Not sure how transit &amp; clj-http play together when streaming. The <code>:as :stream</code>  might be blocking operation as I think is the transit write (but, with different streams). Might also be a bug in muuntaja-streamong-transit. If there is a jsva-side reverse proxy code available, I would anyway go with that.</z><z id="t1599897108" t="ikitommi for async clj-proxy, I believe you need: - run server in (ring-)async-mode - use the async mode in clj-http - stream out asynchronously: ring1 only defines blocking writes, but usually this is not a problem. You could bypass ring here and write lazily to the underlaying java web servers channel etc."><y>#</y><d>2020-09-12</d><h>07:51</h><r>ikitommi</r>for async clj-proxy, I believe you need:
- run server in (ring-)async-mode
- use the async mode in clj-http
- stream out asynchronously: ring1 only defines blocking writes, but usually this is not a problem. You could bypass ring here and write lazily to the underlaying java web servers channel etc.</z><z id="t1599897139" t="ikitommi [:attrs {:href &quot;/_/_/users/U0BKWMG5B&quot;}] is the best person to help I guess"><y>#</y><d>2020-09-12</d><h>07:52</h><r>ikitommi</r><a>@U0BKWMG5B</a> is the best person to help I guess</z><z id="t1599963480" t="antonmos Thank you!"><y>#</y><d>2020-09-13</d><h>02:18</h><r>antonmos</r>Thank you!</z><z id="t1599896300" t="ikitommi Not sure how transit &amp; clj-http play together when streaming. The :as :stream might be blocking operation as I think is the transit write (but, with different streams). Might also be a bug in muuntaja-streamong-transit. If there is a jsva-side reverse proxy code available, I would anyway go with that."><y>#</y><d>2020-09-12</d><h>07:38</h><w>ikitommi</w>Not sure how transit &amp; clj-http play together when streaming. The <code>:as :stream</code>  might be blocking operation as I think is the transit write (but, with different streams). Might also be a bug in muuntaja-streamong-transit. If there is a jsva-side reverse proxy code available, I would anyway go with that.</z><z id="t1600093117" t="restenb is there a &quot;correct&quot; way with Ring to handle different middleware configurations in different environments?"><y>#</y><d>2020-09-14</d><h>14:18</h><w>restenb</w>is there a &quot;correct&quot; way with Ring to handle different middleware configurations in different environments?</z><z id="t1600354826" t="Malik Kennedy db/get-paste-by-id is giving me a &apos;spicy&apos; edn file with a #object i dunno how to (and don&apos;t want to) print."><y>#</y><d>2020-09-17</d><h>15:00</h><w>Malik Kennedy</w>db/get-paste-by-id is giving me a &apos;spicy&apos; edn file with a #object i dunno how to (and don&apos;t want to) print.</z><z id="t1600354848" t="Malik Kennedy (http/defroutes main-routes (http/GET &quot;/&quot; [] (views/index-page)) (http/POST &quot;/&quot; req (if (empty? (:body (:params req))) (views/index-page) (do (let [ins (db/create-paste req) id (db/get-last-paste)] (str ixio/url(:id (first id)) &quot;\n&quot; #_req))))) (http/GET &quot;/favicon.ico&quot; [] &quot;Hello World&quot;) (http/GET &quot;/:id&quot; [id] (views/individual-paste id) #_(db/get-pastes-by-id id)) (route/resources &quot;/&quot;) (route/not-found &quot;Page not found&quot;)) (defn get-paste-by-id [id] (let [query-string (str &quot;SELECT id,body FROM pastes WHERE id=&quot;id &quot;;&quot;)] (query my-db [query-string]))) (defn individual-paste [row] (page/html5 (:body (clojure.edn/read-string (str (first (db/get-paste-by-id row)))))))"><y>#</y><d>2020-09-17</d><h>15:00</h><w>Malik Kennedy</w><pre>(http/defroutes main-routes
  (http/GET &quot;/&quot; [] (views/index-page))
  (http/POST &quot;/&quot; req  
    (if (empty? (:body (:params req)))
      (views/index-page)
      (do
        (let [ins (db/create-paste req)
              id (db/get-last-paste)]      
          (str ixio/url(:id (first id)) &quot;\n&quot;
            #_req)))))
  (http/GET &quot;/favicon.ico&quot; []
    &quot;Hello World&quot;) 
  (http/GET &quot;/:id&quot; [id]
    (views/individual-paste id)
    #_(db/get-pastes-by-id id))
  (route/resources &quot;/&quot;)
  (route/not-found &quot;Page not found&quot;))

(defn get-paste-by-id [id]
  (let [query-string (str &quot;SELECT id,body FROM pastes WHERE id=&quot;id &quot;;&quot;)]
    (query my-db [query-string])))

(defn individual-paste [row]
  (page/html5
    (:body
     (clojure.edn/read-string 
       (str (first (db/get-paste-by-id row)))))))</pre></z><z id="t1600374579" t="seancorfield [:attrs {:href &quot;/_/_/users/U010A2QSG9H&quot;}] This is very unsafe: (let [query-string (str &quot;SELECT id,body FROM pastes WHERE id=&quot;id &quot;;&quot;)] (query my-db [query-string])) You&apos;re opening yourself up to SQL injection attacks by doing that. Do thing instead, so you get a parameterized SQL query: (query my-db [&quot;SELECT id,body FROM pastes WHERE id = ?&quot; id]) You should always use parameterized queries, instead of constructing an entire SQL string that includes its parameters!"><y>#</y><d>2020-09-17</d><h>20:29</h><r>seancorfield</r><a>@U010A2QSG9H</a> This is very unsafe:
<pre>(let [query-string (str &quot;SELECT id,body FROM pastes WHERE id=&quot;id &quot;;&quot;)]
    (query my-db [query-string]))</pre>
You&apos;re opening yourself up to SQL injection attacks by doing that. Do thing instead, so you get a parameterized SQL query:
<pre>(query my-db [&quot;SELECT id,body FROM pastes WHERE id = ?&quot; id])</pre>
You should always use parameterized queries, instead of constructing an entire SQL string that includes its parameters!</z><z id="t1600880366" t="Malik Kennedy Just now seeing this. Thank you for the safety advice!"><y>#</y><d>2020-09-23</d><h>16:59</h><r>Malik Kennedy</r>Just now seeing this. Thank you for the safety advice!</z><z id="t1600354888" t="Malik Kennedy Prints out a bunch of stuff but I think the offending object is :body #object[org.eclipse.jetty.server.HttpInput 0x451be3bd &quot; And when I try to turn the string into an edn format it complains about #object"><y>#</y><d>2020-09-17</d><h>15:01</h><w>Malik Kennedy</w>Prints out a bunch of stuff but I think the offending object is
<pre>:body #object[org.eclipse.jetty.server.HttpInput 0x451be3bd &quot;</pre>
And when I try to turn the string into an edn format it complains about #object</z><z id="t1601328521" t="reefersleep I‚Äôm supplying :send-server-version? false to a Jetty server, but it‚Äôs still supplying a Server header in its responses. Similarly, :send-date-header? false seems to have no effect. Has anyone else experienced this?"><y>#</y><d>2020-09-28</d><h>21:28</h><w>reefersleep</w>I‚Äôm supplying <code>:send-server-version? false</code> to a Jetty server, but it‚Äôs still supplying a <code>Server</code> header in its responses. Similarly, <code>:send-date-header? false</code> seems to have no effect. Has anyone else experienced this?</z><z id="t1601360442" t="dharrigan Seems to work for me...."><y>#</y><d>2020-09-29</d><h>06:20</h><w>dharrigan</w>Seems to work for me....</z><z id="t1601379505" t="reefersleep Thank you very much for testing it out. I probably should have tried to do a minimal example myself before asking here in the channel; the project I‚Äôm working on has many layers on top of the ‚Äúraw‚Äù jetty server."><y>#</y><d>2020-09-29</d><h>11:38</h><r>reefersleep</r>Thank you very much for testing it out. I probably should have tried to do a minimal example myself before asking here in the channel; the project I‚Äôm working on has many layers on top of the ‚Äúraw‚Äù jetty server.</z><z id="t1601379574" t="dharrigan np üôÇ"><y>#</y><d>2020-09-29</d><h>11:39</h><r>dharrigan</r>np <b>üôÇ</b></z><z id="t1601360451" t="dharrigan before..."><y>#</y><d>2020-09-29</d><h>06:20</h><w>dharrigan</w>before...</z><z id="t1601360460" t="dharrigan ‚ùØ http --verbose :8080/api/ping GET /api/ping HTTP/1.1 Accept: */* Accept-Encoding: gzip, deflate Connection: keep-alive Host: localhost:8080 User-Agent: HTTPie/2.2.0 HTTP/1.1 200 OK Content-Length: 5 Date: Tue, 29 Sep 2020 06:19:35 GMT Server: Jetty(9.4.28.v20200408) Pong!"><y>#</y><d>2020-09-29</d><h>06:21</h><w>dharrigan</w><pre>‚ùØ http --verbose :8080/api/ping
GET /api/ping HTTP/1.1
Accept: */*
Accept-Encoding: gzip, deflate
Connection: keep-alive
Host: localhost:8080
User-Agent: HTTPie/2.2.0



HTTP/1.1 200 OK
Content-Length: 5
Date: Tue, 29 Sep 2020 06:19:35 GMT
Server: Jetty(9.4.28.v20200408)

Pong!</pre></z><z id="t1601360476" t="dharrigan after:"><y>#</y><d>2020-09-29</d><h>06:21</h><w>dharrigan</w>after:</z><z id="t1601360480" t="dharrigan (defn jetty-start [handler opts] (jetty/run-jetty handler (-&gt; opts (assoc :send-server-version? false :send-date-header? false :join? false)))) ;; false so that we can stop it at the repl!"><y>#</y><d>2020-09-29</d><h>06:21</h><w>dharrigan</w><pre>(defn jetty-start
  [handler opts]
  (jetty/run-jetty handler (-&gt; opts (assoc :send-server-version? false
                                           :send-date-header? false
                                           :join? false)))) ;; false so that we can stop it at the repl!</pre></z><z id="t1601360488" t="dharrigan ‚ùØ http --verbose :8080/api/ping GET /api/ping HTTP/1.1 Accept: */* Accept-Encoding: gzip, deflate Connection: keep-alive Host: localhost:8080 User-Agent: HTTPie/2.2.0 HTTP/1.1 200 OK Content-Length: 5 Pong!"><y>#</y><d>2020-09-29</d><h>06:21</h><w>dharrigan</w><pre>‚ùØ http --verbose :8080/api/ping
GET /api/ping HTTP/1.1
Accept: */*
Accept-Encoding: gzip, deflate
Connection: keep-alive
Host: localhost:8080
User-Agent: HTTPie/2.2.0



HTTP/1.1 200 OK
Content-Length: 5

Pong!</pre></z><z id="t1602424578" t="mpenet Anything new since the ring2 proposal? I was tempted to adopt some/most of it for an http client we use internally"><y>#</y><d>2020-10-11</d><h>13:56</h><w>mpenet</w>Anything new since the ring2 proposal? I was tempted to adopt some/most of it for an http client we use internally</z><z id="t1605548941" t="st3fan Is there a formal definition of what :body should be? Should it be a Reader or a String?"><y>#</y><d>2020-11-16</d><h>17:49</h><w>st3fan</w>Is there a formal definition of what <code>:body</code> should be? Should it be a Reader or a String?</z><z id="t1605549219" t="mpenet Depends if request/response. There is a spec file in the ring repo that formalizes this"><y>#</y><d>2020-11-16</d><h>17:53</h><w>mpenet</w>Depends if request/response. There is a spec file in the ring repo that formalizes this</z><z id="t1605549250" t="mpenet https://github.com/ring-clojure/ring/blob/master/SPEC"><y>#</y><d>2020-11-16</d><h>17:54</h><w>mpenet</w><a href="https://github.com/ring-clojure/ring/blob/master/SPEC" target="_blank">https://github.com/ring-clojure/ring/blob/master/SPEC</a></z><z id="t1605549591" t="st3fan Hmm InputStream .. I have a middleware that turns the body into a map - maybe that is not correct from a spec perspective"><y>#</y><d>2020-11-16</d><h>17:59</h><w>st3fan</w>Hmm InputStream .. I have a middleware that turns the body into a map - maybe that is not correct from a spec perspective</z><z id="t1605549611" t="st3fan i guess body is tricky anyway because once you consume the InputStream, you can‚Äôt re-read it again"><y>#</y><d>2020-11-16</d><h>18:00</h><w>st3fan</w>i guess body is tricky anyway because once you consume the InputStream, you can‚Äôt re-read it again</z><z id="t1605712526" t="ska you can return a stream on the byte-buffer"><y>#</y><d>2020-11-18</d><h>15:15</h><r>ska</r>you can return a stream on the byte-buffer</z><z id="t1605712584" t="ska Example can be found at https://gist.github.com/ska2342/4567b02531ff611db6a1208ebd4316e6#file-gh-validation-clj-L129"><y>#</y><d>2020-11-18</d><h>15:16</h><r>ska</r>Example can be found at <a href="https://gist.github.com/ska2342/4567b02531ff611db6a1208ebd4316e6#file-gh-validation-clj-L129" target="_blank">https://gist.github.com/ska2342/4567b02531ff611db6a1208ebd4316e6#file-gh-validation-clj-L129</a></z><z id="t1605549722" t="mpenet Depends if you control whatever consumes it. For instance turning an inputstream representing json data to a map is ok depending on the context"><y>#</y><d>2020-11-16</d><h>18:02</h><w>mpenet</w>Depends if you control whatever consumes it. For instance turning an inputstream representing json data to a map is ok depending on the context</z><z id="t1605550366" t="st3fan specially if it is the last in a chain of middleware"><y>#</y><d>2020-11-16</d><h>18:12</h><w>st3fan</w>specially if it is the last in a chain of middleware</z><z id="t1605821541" t="st3fan Is there a middleware that prints basics about the request and maybe also execution time?"><y>#</y><d>2020-11-19</d><h>21:32</h><w>st3fan</w>Is there a middleware that prints basics about the request and maybe also execution time?</z><z id="t1605821572" t="st3fan This seems useful for debugging and I bet there is already a good one"><y>#</y><d>2020-11-19</d><h>21:32</h><w>st3fan</w>This seems useful for debugging and I bet there is already a good one</z><z id="t1606288030" t="Sebastian Hi, I am using the lein-ring plugin and code refresh works for selmer templates called with render-file but if I change an extended template (say the layout), I have to restart the dev server for the changes to take effect. Any idea how to solve this?"><y>#</y><d>2020-11-25</d><h>07:07</h><w>Sebastian</w>Hi, I am using the lein-ring plugin and code refresh works for selmer templates called with <code>render-file</code> but if I change an extended template (say the layout), I have to restart the dev server for the changes to take effect. Any idea how to solve this?</z><z id="t1606319402" t="Sebastian The solution is to turn the selmer cache off. (selmer.p/cache-off!) works like a charm."><y>#</y><d>2020-11-25</d><h>15:50</h><r>Sebastian</r>The solution is to turn the selmer cache off. <code>(selmer.p/cache-off!)</code> works like a charm.</z><z id="t1608070677" t="Gleb Posobin I am using ring-jetty, and getting this exception after the request is finished: org.eclipse.jetty.server.Request.recycle Request.java: 1870 java.lang.NoSuchMethodError: &apos;org.eclipse.jetty.util.Attributes org.eclipse.jetty.util.Attributes.unwrap(org.eclipse.jetty.util.Attributes)&apos; ` What could be the reason? I&apos;ll post the whole message in the thread."><y>#</y><d>2020-12-15</d><h>22:17</h><w>Gleb Posobin</w>I am using ring-jetty, and getting this exception after the request is finished:
<pre>org.eclipse.jetty.server.Request.recycle       Request.java: 1870
java.lang.NoSuchMethodError: &apos;org.eclipse.jetty.util.Attributes org.eclipse.jetty.util.Attributes.unwrap(org.eclipse.jetty.util.Attributes)&apos;</pre>`
What could be the reason? I&apos;ll post the whole message in the thread.</z><z id="t1608070830" t="Gleb Posobin"><y>#</y><d>2020-12-15</d><h>22:20</h><r>Gleb Posobin</r></z><z id="t1608070900" t="Gleb Posobin Click the link to view it in full width in a new tab: https://clojurians.slack.com/files/UQ4RJ22EA/F01H01KTFGB/untitled"><y>#</y><d>2020-12-15</d><h>22:21</h><r>Gleb Posobin</r>Click the link to view it in full width in a new tab: <a href="https://clojurians.slack.com/files/UQ4RJ22EA/F01H01KTFGB/untitled" target="_blank">https://clojurians.slack.com/files/UQ4RJ22EA/F01H01KTFGB/untitled</a></z><z id="t1608071588" t="Gleb Posobin Looks like the problem has appeared after I have updated the dependencies. Downgrading ring and ring-jetty-adapter to 1.8.1 seems to solve the problem."><y>#</y><d>2020-12-15</d><h>22:33</h><w>Gleb Posobin</w>Looks like the problem has appeared after I have updated the dependencies. Downgrading ring and ring-jetty-adapter to 1.8.1 seems to solve the problem.</z><z id="t1608564022" t="dharrigan A quick poll, are most people on ring/ring-core 1.8.2 (either explicitly, or via a transitive dependency?) Thank you."><y>#</y><d>2020-12-21</d><h>15:20</h><w>dharrigan</w>A quick poll, are most people on <code>ring/ring-core</code> <code>1.8.2</code> (either explicitly, or via a transitive dependency?) Thank you.</z><z id="t1608578112" t="Steven Deobald [ring/ring-core &quot;1.8.2&quot;] here (folks can +1 this message or post their version if they‚Äôre on something else?)"><y>#</y><d>2020-12-21</d><h>19:15</h><w>Steven Deobald</w><code>[ring/ring-core &quot;1.8.2&quot;]</code> here (folks can +1 this message or post their version if they‚Äôre on something else?)</z><z id="t1608578194" t="dharrigan thank you"><y>#</y><d>2020-12-21</d><h>19:16</h><w>dharrigan</w>thank you</z><z id="t1608631738" t="Tim Robinson Hi everyone, I&apos;m just getting started with ring and I&apos;m concerned about case-sensitivity of HTTP headers. Obviously in HTTP, header names are case-insensitive but clojure map keys are case-sensitive which doesn&apos;t play nice with this. I can see that in an incoming request (using httpkit), all the keys are lower case. Do we have a convention that all ring middleware and handlers only ever use lower-case headers, or are there special rules I need to abide by make sure I process headers in a case-insensitive way?"><y>#</y><d>2020-12-22</d><h>10:08</h><w>Tim Robinson</w>Hi everyone, I&apos;m just getting started with ring and I&apos;m concerned about case-sensitivity of HTTP headers. Obviously in HTTP, header names are case-insensitive but  clojure map keys are case-sensitive which doesn&apos;t play nice with this.

I can see that in an incoming request (using httpkit), all the keys are lower case. Do we have a convention that all ring middleware and handlers only ever use lower-case headers, or are there special rules I need to abide by make sure I process headers in a case-insensitive way?</z><z id="t1608637647" t="jumar Some info here: https://github.com/ring-clojure/ring/issues/311 Example here from ring-devel where they just use &quot;accept&quot;: https://github.com/ring-clojure/ring/blob/ae6a42108286ca95f33e2d9d6f33172ae7233730/ring-devel/src/ring/middleware/stacktrace.clj#L87 You can also use ring.util.response/*get-header* : https://github.com/ring-clojure/ring/blob/ae6a42108286ca95f33e2d9d6f33172ae7233730/ring-core/src/ring/util/response.clj#L195"><y>#</y><d>2020-12-22</d><h>11:47</h><r>jumar</r>Some info here: <a href="https://github.com/ring-clojure/ring/issues/311" target="_blank">https://github.com/ring-clojure/ring/issues/311</a>
Example here from ring-devel where they just use &quot;accept&quot;: <a href="https://github.com/ring-clojure/ring/blob/ae6a42108286ca95f33e2d9d6f33172ae7233730/ring-devel/src/ring/middleware/stacktrace.clj#L87" target="_blank">https://github.com/ring-clojure/ring/blob/ae6a42108286ca95f33e2d9d6f33172ae7233730/ring-devel/src/ring/middleware/stacktrace.clj#L87</a>

You can also use <code>ring.util.response/*get-header*</code> : <a href="https://github.com/ring-clojure/ring/blob/ae6a42108286ca95f33e2d9d6f33172ae7233730/ring-core/src/ring/util/response.clj#L195" target="_blank">https://github.com/ring-clojure/ring/blob/ae6a42108286ca95f33e2d9d6f33172ae7233730/ring-core/src/ring/util/response.clj#L195</a></z><z id="t1608641045" t="Tim Robinson OK Thanks. I have just found in here &quot; https://github.com/ring-clojure/ring/blob/master/SPEC &quot; it says &quot;A Clojure map of downcased header name Strings&quot; so I guess I can rely on them being in lower case in the original request at least. (I was googling for &quot;lowercase&quot; and &quot;lower case&quot; but didn&apos;t think of looking for &quot;downcase&quot;!"><y>#</y><d>2020-12-22</d><h>12:44</h><r>Tim Robinson</r>OK Thanks. I have just found in here &quot;<a href="https://github.com/ring-clojure/ring/blob/master/SPEC" target="_blank">https://github.com/ring-clojure/ring/blob/master/SPEC</a>&quot; it says &quot;A Clojure map of downcased header name Strings&quot; so I guess I can rely on them being in lower case in the original request at least.

(I was googling for &quot;lowercase&quot; and &quot;lower case&quot; but didn&apos;t think of looking for &quot;downcase&quot;!</z><z id="t1611346566" t="kwladyka I have to debug ring request. body-string as a first wrapper read nil from body. It works after wrap-restful-format but then it is too late. I want to see original string sent by client. How can I do it? While it looks easy it is not üôÇ To be specific I debug JSON request, so something like this curl -H &quot;Content-Type: application/json&quot; -d @foo.json -i ."><y>#</y><d>2021-01-22</d><h>20:16</h><w>kwladyka</w>I have to debug ring request.
<code>body-string</code> as a first wrapper read <code>nil</code> from body. It works after <code>wrap-restful-format</code> but then it is too late. I want to see original string sent by client. How can I do it? While it looks easy it is not <b>üôÇ</b>

To be specific I debug JSON request, so something like this <code>curl -H &quot;Content-Type: application/json&quot; -d @foo.json -i </code>.</z><z id="t1611346672" t="kwladyka I expect client send numbers in wrong format, but I can‚Äôt prove it, because it looks ring correct them, but in some magic way not everywhere."><y>#</y><d>2021-01-22</d><h>20:17</h><w>kwladyka</w>I expect client send numbers in wrong format, but I can‚Äôt prove it, because it looks ring correct them, but in some magic way not everywhere.</z><z id="t1611346702" t="kwladyka Otherwise it is magic ring bug"><y>#</y><d>2021-01-22</d><h>20:18</h><w>kwladyka</w>Otherwise it is magic ring bug</z><z id="t1611346936" t="kwladyka The issue is about (wrap-json-body {:keywords? true :bigdecimals? true}) which have correct values 0.1M , but in only one client has 0.10000000000000001M . params and body-params are qual. Only body has a difference. It is weird."><y>#</y><d>2021-01-22</d><h>20:22</h><w>kwladyka</w>The issue is about <code>(wrap-json-body {:keywords? true :bigdecimals? true})</code> which have correct values <code>0.1M</code>, but in only one client has <code>0.10000000000000001M</code>.

<code>params</code> and <code>body-params</code> are qual. Only <code>body</code> has a difference. It is weird.</z><z id="t1611348187" t="kwladyka So it looks like wrap-restful-format doesn‚Äôt work with string as a :body . So reading body before this wrapper is an issue. I am curious why it is working like that."><y>#</y><d>2021-01-22</d><h>20:43</h><w>kwladyka</w>So it looks like <code>wrap-restful-format</code> doesn‚Äôt work with <code>string</code> as a <code>:body</code>. So reading <code>body</code> before this wrapper is an issue. I am curious why it is working like that.</z><z id="t1611348405" t="kwladyka another fact is slurp can read body while ring.util.request/body-string can‚Äôt"><y>#</y><d>2021-01-22</d><h>20:46</h><w>kwladyka</w>another fact is <code>slurp</code> can read body while <code>ring.util.request/body-string</code> can‚Äôt</z><z id="t1611411872" t="zendevil.eth I have a ring related issue posted in #clojure"><y>#</y><d>2021-01-23</d><h>14:24</h><w>zendevil.eth</w>I have a ring related issue posted in #clojure</z><z id="t1611412089" t="zendevil.eth my multipart params is {} even though I have wrap-multipart-params middleware and sending a multipart request"><y>#</y><d>2021-01-23</d><h>14:28</h><w>zendevil.eth</w>my multipart params is {} even though I have wrap-multipart-params middleware and sending a multipart request</z><z id="t1611412120" t="zendevil.eth and I don‚Äôt know how to extract the file data from the request"><y>#</y><d>2021-01-23</d><h>14:28</h><w>zendevil.eth</w>and I don‚Äôt know how to extract the file data from the request</z><z id="t1611416680" t="zendevil.eth and the problem is not solved"><y>#</y><d>2021-01-23</d><h>15:44</h><w>zendevil.eth</w>and the problem is not solved</z><z id="t1611421543" t="dharrigan Seems to work for me"><y>#</y><d>2021-01-23</d><h>17:05</h><w>dharrigan</w>Seems to work for me</z><z id="t1611421567" t="dharrigan :multipart-params {&quot;hello&quot; &quot;world&quot;}"><y>#</y><d>2021-01-23</d><h>17:06</h><w>dharrigan</w><code>:multipart-params {&quot;hello&quot; &quot;world&quot;}</code></z><z id="t1611421585" t="dharrigan How are you posting the data?"><y>#</y><d>2021-01-23</d><h>17:06</h><w>dharrigan</w>How are you posting the data?</z><z id="t1611421640" t="dharrigan http --multipart POST :3000 @foo.txt hello=world"><y>#</y><d>2021-01-23</d><h>17:07</h><w>dharrigan</w><code>http --multipart POST :3000 @foo.txt hello=world</code></z><z id="t1611421658" t="dharrigan The request is thus:"><y>#</y><d>2021-01-23</d><h>17:07</h><w>dharrigan</w>The request is thus:</z><z id="t1611421666" t="dharrigan {:body #&lt;"><y>#</y><d>2021-01-23</d><h>17:07</h><w>dharrigan</w><pre>{:body #&lt;</pre></z><z id="t1611489428" t="zendevil.eth [:attrs {:href &quot;/_/_/users/U11EL3P9U&quot;}] I‚Äôm posting the data like so: (reg-event-fx :upload-shot-video-server (fn [coeffects [_ blob]] (let [body (js/FormData.)] (.append body &quot;video&quot; blob &quot;video.mov&quot;) (.append body &quot;key&quot; &quot;VAL&quot;) {:http-xhrio {:method :post :uri (str &quot;&quot; &quot;/api/upload-shot-video&quot;) :body body :on-success [:upload-success] :on-failure [:upload-error] :format (json-request-format) :response-format (raw-response-format) #_(edn/edn-response-format)}})) )"><y>#</y><d>2021-01-24</d><h>11:57</h><w>zendevil.eth</w><a>@dharrigan</a> I‚Äôm posting the data like so:
<pre>(reg-event-fx
 :upload-shot-video-server
 (fn [coeffects [_ blob]]
   (let [body (js/FormData.)]
     (.append body &quot;video&quot; blob &quot;video.mov&quot;)
     (.append body &quot;key&quot; &quot;VAL&quot;)
     {:http-xhrio {:method :post
                   :uri (str &quot;&quot; &quot;/api/upload-shot-video&quot;)
                   :body body
                   :on-success [:upload-success]
                   :on-failure [:upload-error]
                   :format (json-request-format)
                   :response-format (raw-response-format) #_(edn/edn-response-format)}}))
 )</pre></z><z id="t1611489595" t="zendevil.eth yet the multipart params aren‚Äôt showing."><y>#</y><d>2021-01-24</d><h>11:59</h><w>zendevil.eth</w>yet the multipart params aren‚Äôt showing.</z><z id="t1611489616" t="zendevil.eth and I‚Äôm sending a blob in the multipart data"><y>#</y><d>2021-01-24</d><h>12:00</h><w>zendevil.eth</w>and I‚Äôm sending a blob in the multipart data</z><z id="t1611716927" t="suren Does ring support a way to parse query strings into number? I need ?author_id=2 to be parsed as {:author_id 2} instead of {:author_id &quot;2&quot;} ."><y>#</y><d>2021-01-27</d><h>03:08</h><w>suren</w>Does <code>ring</code> support a way to parse query strings into number?
I need <code>?author_id=2</code>  to be parsed as <code>{:author_id 2}</code> instead of <code>{:author_id &quot;2&quot;}</code>.</z><z id="t1611720953" t="seancorfield [:attrs {:href &quot;/_/_/users/U1CQ2GB3M&quot;}] We use a combination of Spec and exoscale/coax for that."><y>#</y><d>2021-01-27</d><h>04:15</h><w>seancorfield</w><a>@suren</a> We use a combination of Spec and exoscale/coax for that.</z><z id="t1611720994" t="seancorfield (we&apos;ve only just started using coax -- we have our own library that combines Spec and coercion but we&apos;re backing off using that)"><y>#</y><d>2021-01-27</d><h>04:16</h><w>seancorfield</w>(we&apos;ve only just started using coax -- we have our own library that combines Spec and coercion but we&apos;re backing off using that)</z><z id="t1611731562" t="dharrigan [:attrs {:href &quot;/_/_/users/U1CQ2GB3M&quot;}] reitit+malli will coerce too. I use those and once you&apos;ve defined a spec (in malli for example - it does support clojure spec too), then the values will end up in {:query {:parameters {:author_id 2}}}"><y>#</y><d>2021-01-27</d><h>07:12</h><w>dharrigan</w><a>@suren</a> reitit+malli will coerce too. I use those and once you&apos;ve defined a spec (in malli for example - it does support clojure spec too), then the values will end up in <code>{:query {:parameters {:author_id 2}}}</code></z><z id="t1612312595" t="suren [:attrs {:href &quot;/_/_/users/U04V70XH6&quot;}] I haven&apos;t used spec and to be honest do not know much about it (even though its a big deal in the community, thinking to dive later). [:attrs {:href &quot;/_/_/users/U11EL3P9U&quot;}] malli seems too heavy for my use case I have end up creating custom parser. Please checkout a snippet below : (defn parse-query [{params :params}] (p/parse params {:org_id p/to-integer})) Thanks guys"><y>#</y><d>2021-02-03</d><h>00:36</h><w>suren</w><a>@seancorfield</a> I haven&apos;t used spec and to be honest do not know much about it (even though its a big deal in the community, thinking to dive later).
<a>@dharrigan</a> <code>malli</code> seems too heavy for my use case

I have end up creating custom parser. Please checkout a snippet below :
<pre>(defn parse-query [{params :params}]
  (p/parse params {:org_id p/to-integer}))</pre>
Thanks guys</z><z id="t1612313749" t="seancorfield [:attrs {:href &quot;/_/_/users/U1CQ2GB3M&quot;}] That sounds like a #clojurescript or #reagent question -- not Ring?"><y>#</y><d>2021-02-03</d><h>00:55</h><w>seancorfield</w><a>@suren</a> That sounds like a #clojurescript or #reagent question -- not Ring?</z><z id="t1612315736" t="suren Thanks for pointing out. I have removed the post.Also thanks for all the help."><y>#</y><d>2021-02-03</d><h>01:28</h><r>suren</r>Thanks for pointing out. I have removed the post.Also thanks for all the help.</z><z id="t1612523696" t="aratare Hi there. I have a question regarding how to use the ring anti forgery middleware. As I understand the middleware is used to check if the request has the CSRF header, but how would one set it up in the first place? Currently I&apos;m sending a new token back to the clientside via response header, which the client will pull it out and put it in subsequent requests. But so far all I have is Invalid anti-forgery token . I suspect this has something to do with *anti-forgery-token* but not quite sure how to set it up properly. Would appreciate any insight. Thanks in advance."><y>#</y><d>2021-02-05</d><h>11:14</h><w>aratare</w>Hi there. I have a question regarding how to use the ring anti forgery middleware. As I understand the middleware is used to check if the request has the CSRF header, but how would one set it up in the first place? Currently I&apos;m sending a new token back to the clientside via response header, which the client will pull it out and put it in subsequent requests. But so far all I have is <code>Invalid anti-forgery token</code>. I suspect this has something to do with <code>*anti-forgery-token*</code> but not quite sure how to set it up properly. Would appreciate any insight. Thanks in advance.</z><z id="t1612597953" t="serioga Do you add the token in request headers of the failing request?"><y>#</y><d>2021-02-06</d><h>07:52</h><r>serioga</r>Do you add the token in request headers of the failing request?</z><z id="t1612618105" t="jumar The docs say it: (defn wrap-anti-forgery &quot;Middleware that prevents CSRF attacks. Any POST request to the handler returned by this function must contain a valid anti-forgery token, or else an access-denied response is returned. The anti-forgery token can be placed into a HTML page via the *anti-forgery-token* var, which is bound to a random key unique to the current session. By default, the token is expected to be in a form field named &apos;__anti-forgery-token&apos;, or in the &apos;X-CSRF-Token&apos; or &apos;X-XSRF-Token&apos; headers. That is the *anti-forgerky-token* var should be set by ring and you should use the var to pass the value to the http response, save it on client and then pass it back to the server when you&apos;re doing the POST request. E.g. we use Selmer so we pass this as a html template param: :csrf-token *anti-forgery-token* This is used by javascript functions like this: &lt;script&gt; (() =&gt; { abc.init({ ... csrfToken: &apos;{{csrf-token}}&apos; }); and we also use the convenient anti-forgery-field function and add the csrf token automatically to all html templates (selmer.parser/add-tag! :csrf-field (fn [_ _] (anti-forgery-field))) "><y>#</y><d>2021-02-06</d><h>13:28</h><r>jumar</r>The docs say it:
<pre>(defn wrap-anti-forgery
  &quot;Middleware that prevents CSRF attacks. Any POST request to the handler
  returned by this function must contain a valid anti-forgery token, or else an
  access-denied response is returned.

  The anti-forgery token can be placed into a HTML page via the
  *anti-forgery-token* var, which is bound to a random key unique to the
  current session. By default, the token is expected to be in a form field
  named &apos;__anti-forgery-token&apos;, or in the &apos;X-CSRF-Token&apos; or &apos;X-XSRF-Token&apos;
  headers.</pre>
That is the <code>*anti-forgerky-token*</code> var should be set by ring and you should use the var to pass the value to the http response, save it on client and then pass it back to the server when you&apos;re doing the POST request.

E.g. we use Selmer so we pass this as a html template param:
<pre>:csrf-token *anti-forgery-token*</pre>
This is used by javascript functions like this:
<pre>&lt;script&gt;
  (() =&gt; {
    abc.init({
...
      csrfToken: &apos;{{csrf-token}}&apos;
    });</pre>
and we also use the convenient <code>anti-forgery-field</code> function and add the csrf token automatically to all html templates
<pre>(selmer.parser/add-tag! :csrf-field (fn [_ _] (anti-forgery-field)))</pre>
</z><z id="t1612624453" t="aratare will give it a try thanks. Somehow the last time I was using *anti-forgery-token* it was empty."><y>#</y><d>2021-02-06</d><h>15:14</h><r>aratare</r>will give it a try thanks. Somehow the last time I was using <code>*anti-forgery-token*</code> it was empty.</z><z id="t1613741501" t="Marco Pas I am trying to create my first ring/compojure application and seem to hit a wall. I am returning a simple JSON response and the app seems to always return with the incorrect content type. (ns clojure-rest-server.handler (:require [compojure.core :refer :all] [compojure.route :as route] [ring.util.response :refer [response]] [clojure.pprint] [ring.handler.dump :refer [handle-dump]] [ring.middleware.json :refer [wrap-json-response wrap-json-body]] [ring.middleware.defaults :refer [wrap-defaults api-defaults]])) (defroutes app-routes (POST &quot;/&quot; {body :body} (response {:msg &quot;hello-world&quot;})) (route/not-found &quot;Not Found&quot;)) (def app (-&gt; (wrap-defaults app-routes api-defaults) (wrap-json-body) (wrap-json-response))) When i do a curl or use postman i allays get a $ curl -i --header &quot;Content-Type: application/json&quot; \ --request POST \ HTTP/1.1 200 OK Date: Fri, 19 Feb 2021 13:30:50 GMT Content-Type: application/octet-stream Transfer-Encoding: chunked Server: Jetty(9.2.21.v20170120) {&quot;msg&quot;:&quot;hello-world&quot;}% Any hint what i am doing wrong?"><y>#</y><d>2021-02-19</d><h>13:31</h><w>Marco Pas</w>I am trying to create my first ring/compojure application and seem to hit a wall. I am returning a simple JSON response and the app seems to always return with the incorrect content type.

<pre>(ns clojure-rest-server.handler
  (:require [compojure.core :refer :all]
            [compojure.route :as route]
            [ring.util.response :refer [response]]
            [clojure.pprint]
            [ring.handler.dump :refer [handle-dump]]
            [ring.middleware.json :refer [wrap-json-response wrap-json-body]]
            [ring.middleware.defaults :refer [wrap-defaults api-defaults]]))

(defroutes app-routes
  (POST &quot;/&quot; {body :body} (response {:msg &quot;hello-world&quot;}))
  (route/not-found &quot;Not Found&quot;))

(def app
  (-&gt; (wrap-defaults app-routes api-defaults)
      (wrap-json-body)
      (wrap-json-response)))</pre>
When i do a curl or use postman i allays get a

<pre>$ curl -i --header &quot;Content-Type: application/json&quot; \
  --request POST \
  

HTTP/1.1 200 OK
Date: Fri, 19 Feb 2021 13:30:50 GMT
Content-Type: application/octet-stream
Transfer-Encoding: chunked
Server: Jetty(9.2.21.v20170120)

{&quot;msg&quot;:&quot;hello-world&quot;}%</pre>
Any hint what i am doing wrong?</z><z id="t1613743277" t="dharrigan Oh I see you are here already"><y>#</y><d>2021-02-19</d><h>14:01</h><w>dharrigan</w>Oh I see you are here already</z><z id="t1613743283" t="dharrigan I hope my posting in #beginners helps"><y>#</y><d>2021-02-19</d><h>14:01</h><w>dharrigan</w>I hope my posting in #beginners helps</z><z id="t1613745270" t="dharrigan [:attrs {:href &quot;/_/_/users/U01DC2RC5CG&quot;}] here&apos;s what I&apos;ve done. it&apos;s quite simple. I am no means a user of compojure, but I hope it helps: https://github.com/dharrigan/ring-json"><y>#</y><d>2021-02-19</d><h>14:34</h><w>dharrigan</w><a>@marco.pasopas</a> here&apos;s what I&apos;ve done. it&apos;s quite simple. I am no means a user of compojure, but I hope it helps: <a href="https://github.com/dharrigan/ring-json" target="_blank">https://github.com/dharrigan/ring-json</a></z><z id="t1613745360" t="Marco Pas [:attrs {:href &quot;/_/_/users/U11EL3P9U&quot;}] Many thanks!! It seems to work now indeed with your help."><y>#</y><d>2021-02-19</d><h>14:36</h><w>Marco Pas</w><a>@dharrigan</a> Many thanks!! It seems to work now indeed with your help.</z><z id="t1613745370" t="Marco Pas Found an old issue that more or less dscribes this"><y>#</y><d>2021-02-19</d><h>14:36</h><w>Marco Pas</w>Found an old issue that more or less dscribes this</z><z id="t1613745374" t="Marco Pas"><y>#</y><d>2021-02-19</d><h>14:36</h><w>Marco Pas</w></z><z id="t1613745377" t="Marco Pas https://github.com/ring-clojure/ring-defaults/issues/20"><y>#</y><d>2021-02-19</d><h>14:36</h><w>Marco Pas</w><a href="https://github.com/ring-clojure/ring-defaults/issues/20" target="_blank">https://github.com/ring-clojure/ring-defaults/issues/20</a></z><z id="t1613745391" t="dharrigan very good"><y>#</y><d>2021-02-19</d><h>14:36</h><w>dharrigan</w>very good</z><z id="t1613745453" t="Marco Pas That whole middleware stuff is a bit confusing. Every demo on the internet more or less make the same mistake. The content type is not taken into account"><y>#</y><d>2021-02-19</d><h>14:37</h><w>Marco Pas</w>That whole middleware stuff is a bit confusing. Every demo on the internet more or less make the same mistake. The content type is not taken into account</z><z id="t1613745476" t="Marco Pas I should read the manual üôÇ"><y>#</y><d>2021-02-19</d><h>14:37</h><w>Marco Pas</w>I should read the manual <b>üôÇ</b></z><z id="t1613745504" t="dharrigan I don&apos;t use compojure myself, I prefer #reitit (which uses ring underneath, as the&apos;s sorta the defacto standard)"><y>#</y><d>2021-02-19</d><h>14:38</h><w>dharrigan</w>I don&apos;t use compojure myself, I prefer #reitit (which uses ring underneath, as the&apos;s sorta the defacto standard)</z><z id="t1613747777" t="Marco Pas I am hit by the middleware from ring and not so much by compojure, retit will be my next thiing on the todo list üôÇ"><y>#</y><d>2021-02-19</d><h>15:16</h><w>Marco Pas</w>I am hit by the middleware from ring and not so much by compojure, retit will be my next thiing on the todo list <b>üôÇ</b></z><z id="t1614750096" t="robertfw What are people using for authentication these days? I&apos;m trying to suss out whether buddy and/or friend are still recommended for usage, I&apos;m not sure if their lack of activity is because they are &quot;done&quot; or because people are using other approaches these days. Thanks for any input"><y>#</y><d>2021-03-03</d><h>05:41</h><w>robertfw</w>What are people using for authentication these days? I&apos;m trying to suss out whether buddy and/or friend are still recommended for usage, I&apos;m not sure if their lack of activity is because they are &quot;done&quot; or because people are using other approaches these days. Thanks for any input</z><z id="t1614752103" t="seancorfield I just had that discussion with some folks in another channel and the consensus seems to be that Friend is &quot;done&quot; and is widely-used and Buddy is still actively maintained, although it&apos;s not obvious from the repo: it has been split into four subprojects (listed &quot;below the fold&quot;) and at least two of those have continued to be updated recently."><y>#</y><d>2021-03-03</d><h>06:15</h><w>seancorfield</w>I just had that discussion with some folks in another channel and the consensus seems to be that Friend is &quot;done&quot; and is widely-used and Buddy is still actively maintained, although it&apos;s not obvious from the repo: it has been split into four subprojects (listed &quot;below the fold&quot;) and at least two of those have continued to be updated recently.</z><z id="t1614752185" t="seancorfield See https://github.com/funcool/buddy-core and https://github.com/funcool/buddy-hashers for recently updated parts of Buddy."><y>#</y><d>2021-03-03</d><h>06:16</h><w>seancorfield</w>See <a href="https://github.com/funcool/buddy-core" target="_blank">https://github.com/funcool/buddy-core</a> and <a href="https://github.com/funcool/buddy-hashers" target="_blank">https://github.com/funcool/buddy-hashers</a> for recently updated parts of Buddy.</z><z id="t1614752211" t="seancorfield Oh, and https://github.com/funcool/buddy-sign has been updated recently too!"><y>#</y><d>2021-03-03</d><h>06:16</h><w>seancorfield</w>Oh, and <a href="https://github.com/funcool/buddy-sign" target="_blank">https://github.com/funcool/buddy-sign</a> has been updated recently too!</z><z id="t1614752369" t="robertfw Thanks [:attrs {:href &quot;/_/_/users/U04V70XH6&quot;}] ! Great to know. I hadn&apos;t spotted those sub-projects on buddy."><y>#</y><d>2021-03-03</d><h>06:19</h><w>robertfw</w>Thanks <a>@seancorfield</a>! Great to know. I hadn&apos;t spotted those sub-projects on buddy.</z><z id="t1614752465" t="robertfw Which now that I look were right in front of my nose"><y>#</y><d>2021-03-03</d><h>06:21</h><w>robertfw</w>Which now that I look were right in front of my nose</z><z id="t1614752520" t="seancorfield I had missed them too -- and had been telling people &quot;Buddy hasn&apos;t been updated for years!&quot;... üòû but now I know better."><y>#</y><d>2021-03-03</d><h>06:22</h><w>seancorfield</w>I had missed them too -- and had been telling people &quot;Buddy hasn&apos;t been updated for years!&quot;... <b>üòû</b> but now I know better.</z><z id="t1616296167" t="fullNameHere Hey guys, i&apos;ve been trying to understand ring-clojure lib. I was reading the through the examples and ran into the form parameters one. (defn page [name] (str &quot;&lt;html&gt;&lt;body&gt;&quot; (if name (str &quot;Nice to meet you, &quot; name &quot;!&quot;) (str &quot;&lt;form&gt;&quot; &quot;Name: &lt;input name=&apos;name&apos; type=&apos;text&apos;&gt;&quot; &quot;&lt;input type=&apos;submit&apos;&gt;&quot; &quot;&lt;/form&gt;&quot; &quot;&lt;/body&gt;&lt;/html&gt;&quot;)))) (defn handler [{{name &quot;name&quot;} :params}] (-&gt; (response (page name)) (content-type &quot;text/html&quot;))) (def app (-&gt; handler wrap-params)) (run-jetty app {:port 8080}) Im guessing this is mostly a clojure itself question opposed to a ring one, but I dont really know what [{{name &quot;name&quot;} :params}] is doing. Could anyone explain? Thanks in advance!!"><y>#</y><d>2021-03-21</d><h>03:09</h><w>fullNameHere</w>Hey guys, i&apos;ve been trying to understand ring-clojure lib. I was reading the through the examples and ran into the form parameters one.

(defn page [name]
    (str &quot;&lt;html&gt;&lt;body&gt;&quot;
      (if name
        (str &quot;Nice to meet you, &quot; name &quot;!&quot;)
        (str &quot;&lt;form&gt;&quot;
             &quot;Name: &lt;input name=&apos;name&apos; type=&apos;text&apos;&gt;&quot;
             &quot;&lt;input type=&apos;submit&apos;&gt;&quot;
             &quot;&lt;/form&gt;&quot;
             &quot;&lt;/body&gt;&lt;/html&gt;&quot;))))

(defn handler [{{name &quot;name&quot;} :params}]
    (-&gt; (response (page name))
        (content-type &quot;text/html&quot;)))

(def app
    (-&gt; handler wrap-params))

(run-jetty app {:port 8080})


Im guessing this is mostly a clojure itself question opposed to a ring one,
but I dont really know what [{{name &quot;name&quot;} :params}] is doing. Could anyone explain?
Thanks in advance!!</z><z id="t1616297125" t="robertfw [:attrs {:href &quot;/_/_/users/U015CTPB4HZ&quot;}] that&apos;s associative destructuring, which you can read about here https://clojure.org/guides/destructuring"><y>#</y><d>2021-03-21</d><h>03:25</h><r>robertfw</r><a>@U015CTPB4HZ</a> that&apos;s associative destructuring, which you can read about here <a href="https://clojure.org/guides/destructuring" target="_blank">https://clojure.org/guides/destructuring</a></z><z id="t1616297191" t="robertfw in this case you&apos;re having a map passed in, which will have a value under the :params key, which itself will be a map with a value under the &quot;name&quot; key, which is being bound to name"><y>#</y><d>2021-03-21</d><h>03:26</h><r>robertfw</r>in this case you&apos;re having a map passed in, which will have a value under the <code>:params</code> key, which itself will be a map with a value under the <code>&quot;name&quot;</code> key, which is being bound to <code>name</code></z><z id="t1616297256" t="fullNameHere Thank you, ill read into it some more."><y>#</y><d>2021-03-21</d><h>03:27</h><r>fullNameHere</r>Thank you, ill read into it some more.</z><z id="t1616297453" t="robertfw happy to help. if you run into more questions with destructuring pop a question in #beginners, there&apos;ll be more people responding there"><y>#</y><d>2021-03-21</d><h>03:30</h><r>robertfw</r>happy to help. if you run into more questions with destructuring pop a question in #beginners, there&apos;ll be more people responding there</z><z id="t1616437859" t="zendevil.eth I‚Äôm sending a request with the following params {:user/foo 1 :user/bar 2} , however, in the request map in the server, this map is converted to: {:foo 1 :bar 2} . Is there a way to preserve the namespacing?"><y>#</y><d>2021-03-22</d><h>18:30</h><w>zendevil.eth</w>I‚Äôm sending a request with the following params <code>{:user/foo 1 :user/bar 2}</code>, however, in the request map in the server, this map is converted to:
<code>{:foo 1 :bar 2}</code> . Is there a way to preserve the namespacing?</z><z id="t1616439355" t="seancorfield How exactly are you sending the request to your Ring server?"><y>#</y><d>2021-03-22</d><h>18:55</h><w>seancorfield</w>How exactly are you sending the request to your Ring server?</z><z id="t1616439381" t="seancorfield And what middleware do you have active in your Ring server?"><y>#</y><d>2021-03-22</d><h>18:56</h><w>seancorfield</w>And what middleware do you have active in your Ring server?</z><z id="t1616439421" t="seancorfield Are you sending that hash map as text, JSON, EDN, Transit?"><y>#</y><d>2021-03-22</d><h>18:57</h><w>seancorfield</w>Are you sending that hash map as text, JSON, EDN, Transit?</z><z id="t1616440156" t="zendevil.eth [:attrs {:href &quot;/_/_/users/U04V70XH6&quot;}] I‚Äôm using this library to send the request: https://github.com/day8/re-frame-http-fx This is my :http-xhrio map: {:method :get :uri &quot;/my/uri&quot; :params {:user/foo 1 :user/bar 2} :on-success [:on-success] :on-failure [:on-failure] :response-format (edn/edn-response-format) :format (edn/edn-request-format) } The middleware active in my ring server are: {:middleware [#(wrap-keyword-params % {:parse-namespaces? true}) middleware/wrap-formats wrap-multipart-params ]} "><y>#</y><d>2021-03-22</d><h>19:09</h><w>zendevil.eth</w><a>@seancorfield</a> I‚Äôm using this library to send the request: <a href="https://github.com/day8/re-frame-http-fx" target="_blank">https://github.com/day8/re-frame-http-fx</a>
This is my :http-xhrio map:
<pre>{:method :get
   :uri &quot;/my/uri&quot;
   :params {:user/foo 1 :user/bar 2}
   :on-success [:on-success]
   :on-failure [:on-failure]
   :response-format (edn/edn-response-format)
   :format (edn/edn-request-format)
   }  </pre>
 The middleware active in my ring server are:
<pre>{:middleware [#(wrap-keyword-params % {:parse-namespaces? true})
                 middleware/wrap-formats
                 wrap-multipart-params
                 ]}                </pre></z><z id="t1616443571" t="seancorfield Can you check in your browser dev tools that the URL being sent to the server actually has the qualified query parameter names? Since you‚Äôre using a GET you should see /my/uri?user/foo=1&amp;user/bar=2 being sent. Or possibly with : in front of user in each slot?"><y>#</y><d>2021-03-22</d><h>20:06</h><w>seancorfield</w>Can you check in your browser dev tools that the URL being sent to the server actually has the qualified query parameter names? Since you‚Äôre using a GET you should see <code>/my/uri?user/foo=1&amp;user/bar=2</code> being sent. Or possibly with <code>:</code> in front of <code>user</code> in each slot?</z><z id="t1616443646" t="seancorfield (I would expect POST params to be sent as qualified names I think, although you may have to ask in #re-frame to be sure of that)"><y>#</y><d>2021-03-22</d><h>20:07</h><w>seancorfield</w>(I would expect POST params to be sent as qualified names I think, although you may have to ask in #re-frame to be sure of that)</z><z id="t1616444142" t="zendevil.eth"><y>#</y><d>2021-03-22</d><h>20:15</h><w>zendevil.eth</w></z><z id="t1616444148" t="seancorfield Looking at wrap-keyword-params with :parse-namespaces? true it looks like it should preserve the qualifier in any string params that arrive at the server. But I‚Äôd probably add some debugging at the outermost layer of your middleware to print the whole Ring req uest to be certain that you are getting the raw string data at the server as you expect. You don‚Äôt have wrap-params in your middleware stack so the :query-params and :form-params may not be processed into the common :params slot that wrap-keyword-params expects (middleware is hard ‚Äî which is why I always use ring-defaults to try to get everything all in one place)."><y>#</y><d>2021-03-22</d><h>20:15</h><w>seancorfield</w>Looking at <code>wrap-keyword-params</code> with <code>:parse-namespaces? true</code> it looks like it should preserve the qualifier in any string params that arrive at the server. But I‚Äôd probably add some debugging at the outermost layer of your middleware to print the whole Ring <code>req</code>uest to be certain that you are getting the raw string data at the server as you expect. You don‚Äôt have <code>wrap-params</code> in your middleware stack so the <code>:query-params</code> and <code>:form-params</code> may not be processed into the common <code>:params</code> slot that <code>wrap-keyword-params</code> expects (middleware is hard ‚Äî which is why I always use <code>ring-defaults</code> to try to get everything all in one place).</z><z id="t1616444197" t="seancorfield OK, good that confirms the browser is sending what you expect. Now add some debugging on the server side to see what is in the raw Ring request at the outermost layer."><y>#</y><d>2021-03-22</d><h>20:16</h><w>seancorfield</w>OK, good that confirms the browser is sending what you expect. Now add some debugging on the server side to see what is in the raw Ring request at the outermost layer.</z><z id="t1616444265" t="zendevil.eth [:attrs {:href &quot;/_/_/users/U04V70XH6&quot;}] does ring-defaults come with qualified keywords?"><y>#</y><d>2021-03-22</d><h>20:17</h><w>zendevil.eth</w><a>@seancorfield</a> does <code>ring-defaults</code> come with qualified keywords?</z><z id="t1616444318" t="zendevil.eth What is the outermost layer? Since I‚Äôm using the luminus framework, ring is a complete black-box to me"><y>#</y><d>2021-03-22</d><h>20:18</h><w>zendevil.eth</w>What is the outermost layer? Since I‚Äôm using the luminus framework, ring is a complete black-box to me</z><z id="t1616444341" t="seancorfield This is why I do not recommend Luminus to beginners üòû"><y>#</y><d>2021-03-22</d><h>20:19</h><w>seancorfield</w>This is why I do not recommend Luminus to beginners <b>üòû</b></z><z id="t1616444350" t="zendevil.eth I‚Äôm not even sure if #(wrap-keyword-params % {:parse-namespaces? true}) is the correct way to specify that middleware"><y>#</y><d>2021-03-22</d><h>20:19</h><w>zendevil.eth</w>I‚Äôm not even sure if <code>#(wrap-keyword-params % {:parse-namespaces? true})</code> is the correct way to specify that middleware</z><z id="t1616444589" t="zendevil.eth would finding out about the outermost layer entail a print statement somewhere in the app-routes function in handler.clj ?: (mount/defstate app-routes :start (ring/ring-handler (ring/router [(home-routes)]) (ring/routes (ring/create-resource-handler {:path &quot;/&quot;}) (wrap-content-type (wrap-webjars (constantly nil))) (ring/create-default-handler {:not-found (constantly (error-page {:status 404, :title &quot;404 - Page not found&quot;})) :method-not-allowed (constantly (error-page {:status 405, :title &quot;405 - Not allowed&quot;})) :not-acceptable (constantly (error-page {:status 406, :title &quot;406 - Not acceptable&quot;}))}))))"><y>#</y><d>2021-03-22</d><h>20:23</h><w>zendevil.eth</w>would finding out about the outermost layer entail a print statement somewhere in the <code>app-routes</code> function in <code>handler.clj</code>?:
<pre>(mount/defstate app-routes
  :start
  (ring/ring-handler
    (ring/router
      [(home-routes)])
    (ring/routes
      (ring/create-resource-handler
        {:path &quot;/&quot;})
      (wrap-content-type
        (wrap-webjars (constantly nil)))
      (ring/create-default-handler
        {:not-found
         (constantly (error-page {:status 404, :title &quot;404 - Page not found&quot;}))
         :method-not-allowed
         (constantly (error-page {:status 405, :title &quot;405 - Not allowed&quot;}))
         :not-acceptable
         (constantly (error-page {:status 406, :title &quot;406 - Not acceptable&quot;}))}))))</pre></z><z id="t1616444642" t="seancorfield Oh, Luminus uses Mount as well üòû Something else I advise beginners to avoid."><y>#</y><d>2021-03-22</d><h>20:24</h><w>seancorfield</w>Oh, Luminus uses Mount as well <b>üòû</b> Something else I advise beginners to avoid.</z><z id="t1616444775" t="seancorfield Okay, so your debugging would need to be in the form of a middleware function that you would write that would need to go in that :middleware vector. I‚Äôm not sure which end because I don‚Äôt know what order Luminus wraps the middleware, so I‚Äôd probably add it to both ends."><y>#</y><d>2021-03-22</d><h>20:26</h><w>seancorfield</w>Okay, so your debugging would need to be in the form of a middleware function that you would write that would need to go in that <code>:middleware</code> vector. I‚Äôm not sure which end because I don‚Äôt know what order Luminus wraps the middleware, so I‚Äôd probably add it to both ends.</z><z id="t1616444790" t="seancorfield (defn debug [h] (fn [req] (println req) (h req))) is middleware that prints the whole Ring request (and still invokes the handler on the request)."><y>#</y><d>2021-03-22</d><h>20:26</h><w>seancorfield</w><pre>(defn debug [h] (fn [req] (println req) (h req)))</pre>
is middleware that prints the whole Ring request (and still invokes the handler on the request).</z><z id="t1616444839" t="seancorfield So you‚Äôd have: {:middleware [debug #(wrap-keyword-params % {:parse-namespaces? true}) middleware/wrap-formats wrap-multipart-params debug ]} "><y>#</y><d>2021-03-22</d><h>20:27</h><w>seancorfield</w>So you‚Äôd have:
<pre>{:middleware [debug
                 #(wrap-keyword-params % {:parse-namespaces? true})
                 middleware/wrap-formats
                 wrap-multipart-params
                 debug
                 ]}   </pre></z><z id="t1616444864" t="seancorfield That should let you see what‚Äôs coming into the server at one end and what‚Äôs going into your handler at the other end."><y>#</y><d>2021-03-22</d><h>20:27</h><w>seancorfield</w>That should let you see what‚Äôs coming into the server at one end and what‚Äôs going into your handler at the other end.</z><z id="t1616445104" t="zendevil.eth I‚Äôm not seeing the print statements when the request comes in"><y>#</y><d>2021-03-22</d><h>20:31</h><w>zendevil.eth</w>I‚Äôm not seeing the print statements when the request comes in</z><z id="t1616445174" t="seancorfield Did you restart the server with that new middleware in place?"><y>#</y><d>2021-03-22</d><h>20:32</h><w>seancorfield</w>Did you restart the server with that new middleware in place?</z><z id="t1616445482" t="zendevil.eth Upon restarting the server, I do see the logs. And the params don‚Äôt have qualified keywords on both ends"><y>#</y><d>2021-03-22</d><h>20:38</h><w>zendevil.eth</w>Upon restarting the server, I do see the logs. And the params don‚Äôt have qualified keywords on both ends</z><z id="t1616445716" t="seancorfield OK, I just confirmed in the REPL that you need wrap-params as well as wrap-keyword-params : dev=&gt; ((p/wrap-params (kp/wrap-keyword-params identity {:parse-namespaces? true})) {:query-string &quot;user/foo=1&amp;user/bar=2&quot;}) {:query-string &quot;user/foo=1&amp;user/bar=2&quot;, :form-params {}, :params #:user{:foo &quot;1&quot;, :bar &quot;2&quot;}, :query-params {&quot;user/foo&quot; &quot;1&quot;, &quot;user/bar&quot; &quot;2&quot;}} dev=&gt; ((kp/wrap-keyword-params identity {:parse-namespaces? true}) {:query-string &quot;user/foo=1&amp;user/bar=2&quot;}) {:query-string &quot;user/foo=1&amp;user/bar=2&quot;, :params nil}"><y>#</y><d>2021-03-22</d><h>20:41</h><w>seancorfield</w>OK, I just confirmed in the REPL that you need <code>wrap-params</code> as well as <code>wrap-keyword-params</code>:
<pre>dev=&gt; ((p/wrap-params (kp/wrap-keyword-params identity {:parse-namespaces? true})) {:query-string &quot;user/foo=1&amp;user/bar=2&quot;})
{:query-string &quot;user/foo=1&amp;user/bar=2&quot;, :form-params {}, :params #:user{:foo &quot;1&quot;, :bar &quot;2&quot;}, :query-params {&quot;user/foo&quot; &quot;1&quot;, &quot;user/bar&quot; &quot;2&quot;}}
dev=&gt; ((kp/wrap-keyword-params identity {:parse-namespaces? true}) {:query-string &quot;user/foo=1&amp;user/bar=2&quot;})
{:query-string &quot;user/foo=1&amp;user/bar=2&quot;, :params nil}</pre></z><z id="t1616445770" t="seancorfield p is an alias for ring.middleware.wrap-params , kp is ring.middleware.wrap-keyword-params"><y>#</y><d>2021-03-22</d><h>20:42</h><w>seancorfield</w><code>p</code> is an alias for <code>ring.middleware.wrap-params</code>, <code>kp</code> is <code>ring.middleware.wrap-keyword-params</code></z><z id="t1616445836" t="seancorfield Here‚Äôs my complete REPL session where I debugged this so you can see how I did it: dev=&gt; (require &apos;[ring.middleware.keyword-params :as kp]) nil dev=&gt; ((kp/wrap-keyword-params identity {:parse-namespaces? true}) {:query-params {&quot;user/foo&quot; &quot;1&quot; &quot;user/bar&quot; &quot;2&quot;}}) {:query-params {&quot;user/foo&quot; &quot;1&quot;, &quot;user/bar&quot; &quot;2&quot;}, :params nil} dev=&gt; (require &apos;[ring.middleware.params :as p]) nil dev=&gt; ((kp/wrap-keyword-params (p/wrap-params identity) {:parse-namespaces? true}) {:query-params {&quot;user/foo&quot; &quot;1&quot; &quot;user/bar&quot; &quot;2&quot;}}) {:query-params {&quot;user/foo&quot; &quot;1&quot;, &quot;user/bar&quot; &quot;2&quot;}, :params {}, :form-params {}} dev=&gt; ((p/wrap-params (kp/wrap-keyword-params identity {:parse-namespaces? true})) {:query-params {&quot;user/foo&quot; &quot;1&quot; &quot;user/bar&quot; &quot;2&quot;}}) {:query-params {&quot;user/foo&quot; &quot;1&quot;, &quot;user/bar&quot; &quot;2&quot;}, :form-params {}, :params {}} dev=&gt; ((p/wrap-params (kp/wrap-keyword-params identity {:parse-namespaces? true})) {:query-string &quot;user/foo=1&amp;user/bar=2&quot;}) {:query-string &quot;user/foo=1&amp;user/bar=2&quot;, :form-params {}, :params #:user{:foo &quot;1&quot;, :bar &quot;2&quot;}, :query-params {&quot;user/foo&quot; &quot;1&quot;, &quot;user/bar&quot; &quot;2&quot;}} dev=&gt; ((kp/wrap-keyword-params identity {:parse-namespaces? true}) {:query-string &quot;user/foo=1&amp;user/bar=2&quot;}) {:query-string &quot;user/foo=1&amp;user/bar=2&quot;, :params nil} I initially thought it would depend on :query-params but then I realized that is created by wrap-params from :query-string ."><y>#</y><d>2021-03-22</d><h>20:43</h><w>seancorfield</w>Here‚Äôs my complete REPL session where I debugged this so you can see how I did it:
<pre>dev=&gt; (require &apos;[ring.middleware.keyword-params :as kp])
nil
dev=&gt; ((kp/wrap-keyword-params identity {:parse-namespaces? true}) {:query-params {&quot;user/foo&quot; &quot;1&quot; &quot;user/bar&quot; &quot;2&quot;}})
{:query-params {&quot;user/foo&quot; &quot;1&quot;, &quot;user/bar&quot; &quot;2&quot;}, :params nil}
dev=&gt; (require &apos;[ring.middleware.params :as p])
nil
dev=&gt; ((kp/wrap-keyword-params (p/wrap-params identity) {:parse-namespaces? true}) {:query-params {&quot;user/foo&quot; &quot;1&quot; &quot;user/bar&quot; &quot;2&quot;}})
{:query-params {&quot;user/foo&quot; &quot;1&quot;, &quot;user/bar&quot; &quot;2&quot;}, :params {}, :form-params {}}
dev=&gt; ((p/wrap-params (kp/wrap-keyword-params identity {:parse-namespaces? true})) {:query-params {&quot;user/foo&quot; &quot;1&quot; &quot;user/bar&quot; &quot;2&quot;}})
{:query-params {&quot;user/foo&quot; &quot;1&quot;, &quot;user/bar&quot; &quot;2&quot;}, :form-params {}, :params {}}
dev=&gt; ((p/wrap-params (kp/wrap-keyword-params identity {:parse-namespaces? true})) {:query-string &quot;user/foo=1&amp;user/bar=2&quot;})
{:query-string &quot;user/foo=1&amp;user/bar=2&quot;, :form-params {}, :params #:user{:foo &quot;1&quot;, :bar &quot;2&quot;}, :query-params {&quot;user/foo&quot; &quot;1&quot;, &quot;user/bar&quot; &quot;2&quot;}}
dev=&gt; ((kp/wrap-keyword-params identity {:parse-namespaces? true}) {:query-string &quot;user/foo=1&amp;user/bar=2&quot;})
{:query-string &quot;user/foo=1&amp;user/bar=2&quot;, :params nil}</pre>
I initially thought it would depend on <code>:query-params</code> but then I realized that is created by <code>wrap-params</code> from <code>:query-string</code>.</z><z id="t1616445886" t="seancorfield But that‚Äôs how you can debug the pieces via the REPL. identity is just taking the place of a handler function that does nothing (just returns the input Ring request) so it‚Äôs easier to debug."><y>#</y><d>2021-03-22</d><h>20:44</h><w>seancorfield</w>But that‚Äôs how you can debug the pieces via the REPL. <code>identity</code> is just taking the place of a handler function that does nothing (just returns the input Ring request) so it‚Äôs easier to debug.</z><z id="t1616445958" t="seancorfield And just to show what happens if you have them the other way round in the middleware stack: dev=&gt; ((kp/wrap-keyword-params (p/wrap-params identity) {:parse-namespaces? true}) {:query-string &quot;user/foo=1&amp;user/bar=2&quot;}) {:query-string &quot;user/foo=1&amp;user/bar=2&quot;, :params {&quot;user/foo&quot; &quot;1&quot;, &quot;user/bar&quot; &quot;2&quot;}, :form-params {}, :query-params {&quot;user/foo&quot; &quot;1&quot;, &quot;user/bar&quot; &quot;2&quot;}}"><y>#</y><d>2021-03-22</d><h>20:45</h><w>seancorfield</w>And just to show what happens if you have them the other way round in the middleware stack:
<pre>dev=&gt; ((kp/wrap-keyword-params (p/wrap-params identity) {:parse-namespaces? true}) {:query-string &quot;user/foo=1&amp;user/bar=2&quot;})
{:query-string &quot;user/foo=1&amp;user/bar=2&quot;, :params {&quot;user/foo&quot; &quot;1&quot;, &quot;user/bar&quot; &quot;2&quot;}, :form-params {}, :query-params {&quot;user/foo&quot; &quot;1&quot;, &quot;user/bar&quot; &quot;2&quot;}}</pre></z><z id="t1616446048" t="seancorfield Having middleware in the wrong order is often the same as not having it at all: dev=&gt; ((p/wrap-params identity) {:query-string &quot;user/foo=1&amp;user/bar=2&quot;}) {:query-string &quot;user/foo=1&amp;user/bar=2&quot;, :form-params {}, :params {&quot;user/foo&quot; &quot;1&quot;, &quot;user/bar&quot; &quot;2&quot;}, :query-params {&quot;user/foo&quot; &quot;1&quot;, &quot;user/bar&quot; &quot;2&quot;}}"><y>#</y><d>2021-03-22</d><h>20:47</h><w>seancorfield</w>Having middleware in the wrong order is often the same as not having it at all:
<pre>dev=&gt; ((p/wrap-params identity) {:query-string &quot;user/foo=1&amp;user/bar=2&quot;})
{:query-string &quot;user/foo=1&amp;user/bar=2&quot;, :form-params {}, :params {&quot;user/foo&quot; &quot;1&quot;, &quot;user/bar&quot; &quot;2&quot;}, :query-params {&quot;user/foo&quot; &quot;1&quot;, &quot;user/bar&quot; &quot;2&quot;}}</pre></z><z id="t1616446183" t="seancorfield As for ring-defaults , yes, you can have it parse namespaces but that isn‚Äôt the default ‚Äî and it‚Äôs not entirely obvious how to tell it to do it. You need to pass something like (assoc-in api-defaults [:params :keywordize] {:parse-namespaces? true}) I think, instead of just api-defaults (you may want to tweak other settings too ‚Äî it‚Äôs all just data)."><y>#</y><d>2021-03-22</d><h>20:49</h><w>seancorfield</w>As for <code>ring-defaults</code>, yes, you can have it parse namespaces but that isn‚Äôt the default ‚Äî and it‚Äôs not entirely obvious how to tell it to do it. You need to pass something like <code>(assoc-in api-defaults [:params :keywordize] {:parse-namespaces? true})</code> I think, instead of just <code>api-defaults</code> (you may want to tweak other settings too ‚Äî it‚Äôs all just data).</z><z id="t1616446262" t="seancorfield The nice thing about ring-defaults is it provides out-of-the-box stacks of middleware in the correct order for both API style apps and website style apps (the latter has CSRF enabled by default and a few other differences), and you can also control how HTTP vs HTTPS behaves and several other useful things very easily."><y>#</y><d>2021-03-22</d><h>20:51</h><w>seancorfield</w>The nice thing about <code>ring-defaults</code> is it provides out-of-the-box stacks of middleware in the correct order for both API style apps and website style apps (the latter has CSRF enabled by default and a few other differences), and you can also control how HTTP vs HTTPS behaves and several other useful things very easily.</z><z id="t1616446400" t="seancorfield But all this is why I recommend beginners avoid ‚Äúframeworks‚Äù like Luminus and start with just Ring at first and learn how Ring works on its own, and then either learn Compojure or Reitit for routing (mapping URLs to handlers), and then learn Component or Integrant for managing the start/stop lifecycle of components (web servers, database connection pools, anything that has some process to ‚Äústart‚Äù it up and another process to ‚Äústop‚Äù it when you‚Äôre done)."><y>#</y><d>2021-03-22</d><h>20:53</h><w>seancorfield</w>But all this is why I recommend beginners avoid ‚Äúframeworks‚Äù like Luminus and start with just Ring at first and learn how Ring works on its own, and then either learn Compojure or Reitit for routing (mapping URLs to handlers), and then learn Component or Integrant for managing the start/stop lifecycle of components (web servers, database connection pools, anything that has some process to ‚Äústart‚Äù it up and another process to ‚Äústop‚Äù it when you‚Äôre done).</z><z id="t1616446701" t="zendevil.eth [:attrs {:href &quot;/_/_/users/U04V70XH6&quot;}] I tried: {:middleware [debug wrap-params #(wrap-keyword-params % {:parse-namespaces? true}) middleware/wrap-formats wrap-multipart-params debug ]} and also: {:middleware [debug #(wrap-keyword-params % {:parse-namespaces? true}) wrap-params middleware/wrap-formats wrap-multipart-params debug ]} But I‚Äôm not seeing the qualified keywords in the params. Could it possibly be because of other middleware?"><y>#</y><d>2021-03-22</d><h>20:58</h><w>zendevil.eth</w><a>@seancorfield</a> I tried:
<pre>{:middleware [debug
                 wrap-params
                 #(wrap-keyword-params % {:parse-namespaces? true})
                 middleware/wrap-formats
                 wrap-multipart-params
                 debug
                 ]}</pre>
and also:
<pre>{:middleware [debug
                 #(wrap-keyword-params % {:parse-namespaces? true})
                 wrap-params
                 middleware/wrap-formats
                 wrap-multipart-params
                 debug
                 ]}</pre>
But I‚Äôm not seeing the qualified keywords in the params. Could it possibly be because of other middleware?</z><z id="t1616447232" t="seancorfield Hard to be sure ‚Äî as I said, I‚Äôve no idea how Luminus rolls that middleware vector up."><y>#</y><d>2021-03-22</d><h>21:07</h><w>seancorfield</w>Hard to be sure ‚Äî as I said, I‚Äôve no idea how Luminus rolls that middleware vector up.</z><z id="t1616447289" t="seancorfield Here‚Äôs the order that ring-defaults composes them: https://github.com/ring-clojure/ring-defaults/blob/master/src/ring/middleware/defaults.clj#L98-L117"><y>#</y><d>2021-03-22</d><h>21:08</h><w>seancorfield</w>Here‚Äôs the order that <code>ring-defaults</code> composes them: <a href="https://github.com/ring-clojure/ring-defaults/blob/master/src/ring/middleware/defaults.clj#L98-L117" target="_blank">https://github.com/ring-clojure/ring-defaults/blob/master/src/ring/middleware/defaults.clj#L98-L117</a></z><z id="t1616447323" t="seancorfield That suggests you probably want wrap-params at the end (after wrap-multipart-params )."><y>#</y><d>2021-03-22</d><h>21:08</h><w>seancorfield</w>That suggests you probably want <code>wrap-params</code> at the end (after <code>wrap-multipart-params</code>).</z><z id="t1616447468" t="zendevil.eth [:attrs {:href &quot;/_/_/users/U04V70XH6&quot;}] , in my request, I checked {‚Ä¶:data {:middleware ‚Ä¶}} and found this: {:middleware [#function[humboiserver.routes.home/debug] #function[ring.middleware.params/wrap-params] #function[humboiserver.routes.home/home-routes/fn--19313] #function[humboiserver.middleware/wrap-formats] #function[ring.middleware.multipart-params/wrap-multipart-params] #function[humboiserver.routes.home/debug]] "><y>#</y><d>2021-03-22</d><h>21:11</h><w>zendevil.eth</w><a>@seancorfield</a>, in my request, I checked <code>{‚Ä¶:data {:middleware ‚Ä¶}}</code> and found this:
<pre>{:middleware [#function[humboiserver.routes.home/debug] #function[ring.middleware.params/wrap-params] #function[humboiserver.routes.home/home-routes/fn--19313] #function[humboiserver.middleware/wrap-formats] #function[ring.middleware.multipart-params/wrap-multipart-params] #function[humboiserver.routes.home/debug]]</pre>
</z><z id="t1616447483" t="zendevil.eth It seems like wrap-keyword-params isn‚Äôt being applied"><y>#</y><d>2021-03-22</d><h>21:11</h><w>zendevil.eth</w>It seems like wrap-keyword-params isn‚Äôt being applied</z><z id="t1616447555" t="zendevil.eth No, actually: #function[humboiserver.routes.home/home-routes/fn--19313] is that"><y>#</y><d>2021-03-22</d><h>21:12</h><w>zendevil.eth</w>No, actually: <code>#function[humboiserver.routes.home/home-routes/fn--19313]</code> is that</z><z id="t1616447577" t="seancorfield #(..) is an anonymous fn so, yes, #function[humboiserver.routes.home/home-routes/fn--19313] is that üôÇ"><y>#</y><d>2021-03-22</d><h>21:12</h><w>seancorfield</w><code>#(..)</code> is an anonymous fn so, yes, <code>#function[humboiserver.routes.home/home-routes/fn--19313]</code> is that <b>üôÇ</b></z><z id="t1616447618" t="seancorfield As I said above, looking at ring-defaults , I think you want: {:middleware [debug #(wrap-keyword-params % {:parse-namespaces? true}) middleware/wrap-formats wrap-multipart-params wrap-params debug ]}"><y>#</y><d>2021-03-22</d><h>21:13</h><w>seancorfield</w>As I said above, looking at <code>ring-defaults</code>, I think you want:
<pre>{:middleware [debug
                 #(wrap-keyword-params % {:parse-namespaces? true})
                 middleware/wrap-formats
                 wrap-multipart-params
                 wrap-params
                 debug
                 ]}</pre></z><z id="t1616447654" t="seancorfield BTW, the wrap-formats middleware there is specific to Luminus and is a conditional wrapper around this library: https://github.com/metosin/muuntaja"><y>#</y><d>2021-03-22</d><h>21:14</h><w>seancorfield</w>BTW, the <code>wrap-formats</code> middleware there is specific to Luminus and is a conditional wrapper around this library: <a href="https://github.com/metosin/muuntaja" target="_blank">https://github.com/metosin/muuntaja</a></z><z id="t1616447674" t="seancorfield (just so you understand how many ‚Äúmoving parts‚Äù are being pulled in by Luminus)"><y>#</y><d>2021-03-22</d><h>21:14</h><w>seancorfield</w>(just so you understand how many ‚Äúmoving parts‚Äù are being pulled in by Luminus)</z><z id="t1616447845" t="zendevil.eth [:attrs {:href &quot;/_/_/users/U04V70XH6&quot;}] I tried this order but still no qualified keywords"><y>#</y><d>2021-03-22</d><h>21:17</h><w>zendevil.eth</w><a>@seancorfield</a> I tried this order but still no qualified keywords</z><z id="t1616447925" t="seancorfield And you restarted your server again?"><y>#</y><d>2021-03-22</d><h>21:18</h><w>seancorfield</w>And you restarted your server again?</z><z id="t1616447932" t="zendevil.eth yes"><y>#</y><d>2021-03-22</d><h>21:18</h><w>zendevil.eth</w>yes</z><z id="t1616447961" t="seancorfield Then maybe try in #luminus ‚Äî if this was plain ol‚Äô Ring, what I showed above would solve this."><y>#</y><d>2021-03-22</d><h>21:19</h><w>seancorfield</w>Then maybe try in #luminus ‚Äî if this was plain ol‚Äô Ring, what I showed above would solve this.</z><z id="t1616447982" t="seancorfield But, seriously, consider abandoning Luminus for now and learn the basics so you can debug this sort of stuff yourself."><y>#</y><d>2021-03-22</d><h>21:19</h><w>seancorfield</w>But, seriously, consider abandoning Luminus for now and learn the basics so you can debug this sort of stuff yourself.</z><z id="t1616448510" t="zendevil.eth [:attrs {:href &quot;/_/_/users/U04V70XH6&quot;}] the incoming :query-string doesn‚Äôt have qualified namespaces in the log. I mean, it‚Äôs just foo=1&amp;bar=2 and not user/foo=1&amp;user/bar=2"><y>#</y><d>2021-03-22</d><h>21:28</h><w>zendevil.eth</w><a>@seancorfield</a> the incoming <code>:query-string</code> doesn‚Äôt have qualified namespaces in the log. I mean, it‚Äôs just <code>foo=1&amp;bar=2</code> and not <code>user/foo=1&amp;user/bar=2</code></z><z id="t1616448896" t="seancorfield Since you‚Äôre using Luminus, I have no idea at this point."><y>#</y><d>2021-03-22</d><h>21:34</h><w>seancorfield</w>Since you‚Äôre using Luminus, I have no idea at this point.</z><z id="t1616449050" t="seancorfield My advice is to build a very simple pure Ring server and make sure you can get it working with that."><y>#</y><d>2021-03-22</d><h>21:37</h><w>seancorfield</w>My advice is to build a very simple pure Ring server and make sure you can get it working with that.</z><z id="t1616449306" t="zendevil.eth [:attrs {:href &quot;/_/_/users/U04V70XH6&quot;}] In pure ring, is it true that the query-string always contains the qualified keywords whether or not ‚Äúwrap-keyword-params parse-namespace true‚Äù and ‚Äúwrap params‚Äù middleware are applied?"><y>#</y><d>2021-03-22</d><h>21:41</h><w>zendevil.eth</w><a>@seancorfield</a> In pure ring, is it true that the query-string always contains the qualified keywords whether or not ‚Äúwrap-keyword-params parse-namespace true‚Äù and ‚Äúwrap params‚Äù middleware are applied?</z><z id="t1616449991" t="zendevil.eth [:attrs {:href &quot;/_/_/users/U04V70XH6&quot;}] , I confirmed that it doesn‚Äôt have to do with #luminus . I do get qualified keywords when I make the request from the browser with ‚Äúuser/foo=1‚Ä¶‚Äú, but it doesn‚Äôt work with the reframe http library"><y>#</y><d>2021-03-22</d><h>21:53</h><w>zendevil.eth</w><a>@seancorfield</a>, I confirmed that it doesn‚Äôt have to do with #luminus . I do get qualified keywords when I make the request from the browser with ‚Äúuser/foo=1‚Ä¶‚Äú, but it doesn‚Äôt work with the reframe http library</z><z id="t1616452435" t="seancorfield When I asked about what browser devtools showed, at the beginning of this discussion, I meant while you were using the re-frame app ‚Äî that was the first thing you needed to verify üòû"><y>#</y><d>2021-03-22</d><h>22:33</h><w>seancorfield</w>When I asked about what browser devtools showed, at the beginning of this discussion, I meant while you were using the re-frame app ‚Äî that was the first thing you needed to verify <b>üòû</b></z><z id="t1616452568" t="seancorfield I hope that the REPL session showing how to debug middleware was useful?"><y>#</y><d>2021-03-22</d><h>22:36</h><w>seancorfield</w>I hope that the REPL session showing how to debug middleware was useful?</z><z id="t1616452903" t="zendevil.eth [:attrs {:href &quot;/_/_/users/U04V70XH6&quot;}] yes it was useful thanks üôè"><y>#</y><d>2021-03-22</d><h>22:41</h><w>zendevil.eth</w><a>@seancorfield</a> yes it was useful thanks <b>üôè</b></z><z id="t1616646993" t="cschep sorry if this isn‚Äôt the right place, but I‚Äôve got some compojure routes like so (defroutes routes (GET &quot;/&quot; [] (index/index)) (route/resources &quot;/&quot;) (route/not-found &quot;oh no&quot;))"><y>#</y><d>2021-03-25</d><h>04:36</h><w>cschep</w>sorry if this isn‚Äôt the right place, but I‚Äôve got some compojure routes like so
<pre>(defroutes routes
  (GET &quot;/&quot; [] (index/index))
  (route/resources &quot;/&quot;)
  (route/not-found &quot;oh no&quot;))</pre></z><z id="t1616647009" t="cschep i‚Äôve got some static assets in resources/public"><y>#</y><d>2021-03-25</d><h>04:36</h><w>cschep</w>i‚Äôve got some static assets in <code>resources/public</code></z><z id="t1616647016" t="cschep and they are 404&apos;ing"><y>#</y><d>2021-03-25</d><h>04:36</h><w>cschep</w>and they are 404&apos;ing</z><z id="t1616647089" t="cschep is it laid out somewhere what directory to use?"><y>#</y><d>2021-03-25</d><h>04:38</h><w>cschep</w>is it laid out somewhere what directory to use?</z><z id="t1616648100" t="seancorfield Hmm, I thought the default was public on the classpath. Ah, how are you starting/running your app? Leiningen or Clojure CLI?"><y>#</y><d>2021-03-25</d><h>04:55</h><w>seancorfield</w>Hmm, I thought the default was <code>public</code> on the classpath. Ah, how are you starting/running your app? Leiningen or Clojure CLI?</z><z id="t1616648165" t="seancorfield I can&apos;t remember whether lein puts resources on the classpath by default but deps.edn certainly doesn&apos;t -- you need to set :paths [&quot;src&quot; &quot;resources&quot;] in your deps.edn ."><y>#</y><d>2021-03-25</d><h>04:56</h><w>seancorfield</w>I can&apos;t remember whether <code>lein</code> puts <code>resources</code> on the classpath by default but <code>deps.edn</code> certainly doesn&apos;t -- you need to set <code>:paths [&quot;src&quot; &quot;resources&quot;]</code> in your <code>deps.edn</code>.</z><z id="t1616648190" t="seancorfield ^ [:attrs {:href &quot;/_/_/users/U2ZSU4A4B&quot;}]"><y>#</y><d>2021-03-25</d><h>04:56</h><w>seancorfield</w>^ <a>@cschep</a></z><z id="t1616648209" t="cschep ahhhh"><y>#</y><d>2021-03-25</d><h>04:56</h><w>cschep</w>ahhhh</z><z id="t1616648233" t="cschep clj -M -m schepball.main"><y>#</y><d>2021-03-25</d><h>04:57</h><w>cschep</w><code>clj -M -m schepball.main</code></z><z id="t1616648242" t="cschep with a pretty bare deps.edn"><y>#</y><d>2021-03-25</d><h>04:57</h><w>cschep</w>with a pretty bare deps.edn</z><z id="t1616648247" t="cschep i was wondering how the tool knew where to look"><y>#</y><d>2021-03-25</d><h>04:57</h><w>cschep</w>i was wondering how the tool knew where to look</z><z id="t1616648260" t="cschep maybe ‚Äúresources‚Äù was a magic jvm directory or something"><y>#</y><d>2021-03-25</d><h>04:57</h><w>cschep</w>maybe ‚Äúresources‚Äù was a magic jvm directory or something</z><z id="t1616648277" t="cschep is src in deps.edn by default?"><y>#</y><d>2021-03-25</d><h>04:57</h><w>cschep</w>is <code>src</code> in deps.edn by default?</z><z id="t1616648285" t="cschep {:deps {org.jsoup/jsoup {:mvn/version &quot;1.13.1&quot;} dk.ative/docjure {:mvn/version &quot;1.14.0&quot;} compojure/compojure {:mvn/version &quot;1.6.2&quot;} ring/ring {:mvn/version &quot;1.9.2&quot;}}}"><y>#</y><d>2021-03-25</d><h>04:58</h><w>cschep</w><pre>{:deps
 {org.jsoup/jsoup {:mvn/version &quot;1.13.1&quot;}
  dk.ative/docjure {:mvn/version &quot;1.14.0&quot;}
  compojure/compojure {:mvn/version &quot;1.6.2&quot;}
  ring/ring {:mvn/version &quot;1.9.2&quot;}}}</pre></z><z id="t1616648291" t="cschep this is my entire deps.edn"><y>#</y><d>2021-03-25</d><h>04:58</h><w>cschep</w>this is my entire <code>deps.edn</code></z><z id="t1616648319" t="cschep but i have code in src"><y>#</y><d>2021-03-25</d><h>04:58</h><w>cschep</w>but i have code in <code>src</code></z><z id="t1616648514" t="cschep that fixed it thank you!!"><y>#</y><d>2021-03-25</d><h>05:01</h><w>cschep</w>that fixed it thank you!!</z><z id="t1616651644" t="seancorfield Yes, &quot;src&quot; is the default value for :paths . If you need additional directories, you need to specific (all of) them in your project deps.edn , so :paths [&quot;src&quot; &quot;resources&quot;] would need to be added."><y>#</y><d>2021-03-25</d><h>05:54</h><w>seancorfield</w>Yes, <code>&quot;src&quot;</code> is the default value for <code>:paths</code>. If you need additional directories, you need to specific (all of) them in your project <code>deps.edn</code>, so <code>:paths [&quot;src&quot; &quot;resources&quot;]</code> would need to be added.</z><z id="t1616651777" t="seancorfield You can see it reflected in the classpath here: {:tag :a, :attrs {:href &quot;/cdn-cgi/l/email-protection&quot;, :class &quot;__cf_email__&quot;, :data-cfemail &quot;a6d5c3c7c8c5e6e2e3f5edf2e9f68b9596efe5e79190&quot;}, :content (&quot;[email¬†protected]&quot;)}"><y>#</y><d>2021-03-25</d><h>05:56</h><w>seancorfield</w>You can see it reflected in the classpath here:
<pre>{:tag :a, :attrs {:href &quot;/cdn-cgi/l/email-protection&quot;, :class &quot;__cf_email__&quot;, :data-cfemail &quot;a6d5c3c7c8c5e6e2e3f5edf2e9f68b9596efe5e79190&quot;}, :content (&quot;[email¬†protected]&quot;)}</pre></z><z id="t1616854737" t="pez Total beginner question: In an example project I am testing I lose the REPL after having evaluated (run-jetty ‚Ä¶) . The server seems to work fine, but no more REPL for me. Anyone have a hint for me what I should check to see why it locks up like this?"><y>#</y><d>2021-03-27</d><h>14:18</h><w>pez</w>Total beginner question: In an example project I am testing I lose the REPL after having evaluated <code>(run-jetty ‚Ä¶)</code>. The server seems to work fine, but no more REPL for me. Anyone have a hint for me what I should check to see why it locks up like this?</z><z id="t1616856014" t="dharrigan Doesn&apos;t that block? If you&apos;re evaling from the repl, then the run-jetty will block the REPL thread"><y>#</y><d>2021-03-27</d><h>14:40</h><w>dharrigan</w>Doesn&apos;t that block? If you&apos;re evaling from the repl, then the <code>run-jetty</code> will block the REPL thread</z><z id="t1616856030" t="dharrigan the normal thing to do is to (def server (run-jetty.... )"><y>#</y><d>2021-03-27</d><h>14:40</h><w>dharrigan</w>the normal thing to do is to <code>(def server (run-jetty....</code>)</z><z id="t1616856046" t="dharrigan to store the server instance in a var which you can then close later"><y>#</y><d>2021-03-27</d><h>14:40</h><w>dharrigan</w>to store the server instance in a var which you can then close later</z><z id="t1616856080" t="dharrigan i.e., "><y>#</y><d>2021-03-27</d><h>14:41</h><w>dharrigan</w>i.e., <code></code></z><z id="t1616856085" t="dharrigan line 46"><y>#</y><d>2021-03-27</d><h>14:41</h><w>dharrigan</w>line 46</z><z id="t1616856536" t="thegeez [:attrs {:href &quot;/_/_/users/U0ETXRFEW&quot;}] there&apos;s a :join? option for run-jetty: https://ring-clojure.github.io/ring/ring.adapter.jetty.html"><y>#</y><d>2021-03-27</d><h>14:48</h><w>thegeez</w><a>@pez</a> there&apos;s a <code>:join?</code> option for run-jetty: <a href="https://ring-clojure.github.io/ring/ring.adapter.jetty.html" target="_blank">https://ring-clojure.github.io/ring/ring.adapter.jetty.html</a></z><z id="t1616862653" t="pez Thanks! It was the :join? option I had missed. I took inspiration from the example [:attrs {:href &quot;/_/_/users/U11EL3P9U&quot;}] provided and now have this: (def ^:private server-ref (atom nil)) (defn start! [] (if-let [server @server-ref] (log/warn &quot;Server already running? (stop!) it first.&quot;) (do (api/init) (reset! server-ref (run-jetty api/app {:port (Integer/valueOf (or (System/getenv &quot;port&quot;) &quot;6003&quot;) 10) :join? false}))))) (defn stop! [] (if-let [server @server-ref] (do (api/destroy) (.stop server) (reset! server-ref nil)) (log/warn &quot;No server&quot;))) (defn -main [&amp; _args] (start!)) Please let me know if it looks crazy to you. üòÉ"><y>#</y><d>2021-03-27</d><h>16:30</h><w>pez</w>Thanks! It was the <code>:join?</code> option I had missed. I took inspiration from the example <a>@dharrigan</a> provided and now have this:
<pre>(def ^:private server-ref (atom nil))

(defn start! []
  (if-let [server @server-ref]
    (log/warn &quot;Server already running? (stop!) it first.&quot;)
    (do
      (api/init)
      (reset! server-ref
              (run-jetty api/app
                         {:port (Integer/valueOf
                                 (or (System/getenv &quot;port&quot;)
                                     &quot;6003&quot;)
                                 10)
                          :join? false})))))

(defn stop! []
  (if-let [server @server-ref]
    (do (api/destroy)
        (.stop server)
        (reset! server-ref nil))
    (log/warn &quot;No server&quot;)))

(defn -main [&amp; _args]
  (start!))</pre>
Please let me know if it looks crazy to you. <b>üòÉ</b></z><z id="t1617122042" t="danm Morning! I&apos;m trying to properly understand ring &apos;s async support in combination with Jetty. We&apos;re using it with ring-jetty-adapter , and are starting the server with :async? true , so all our handlers have arity [request response raise] , where response and raise are functions. We&apos;re doing this because some of our requests can be quite long-running, and we need to make a blocking I/O call to get the response data. The thing is, Jetty JMX metrics are showing us that a long-running request is still holding onto one of the threads from Jetty&apos;s threadpool while in progress, so during a load test we hit in-progress requests = threadpool max, the thread queue size spikes, and we see healthcheck requests start timing out (we think due to being stuck in the queue), even though they have no blocking calls etc to slow things down. I thought the whole point of async here was that that didn&apos;t happen. I&apos;ve found various overly-simplistic examples detailing Jetty async (e.g. https://www.baeldung.com/jetty-embedded and https://webtide.com/servlet-3-1-async-io-and-jetty/ ), which show setting up a WriteListener with onWritePossible method, but they just use &apos;content&apos; to write as a string buffer or similar, not a blocking I/O call like we have. I can&apos;t find any equivalent to that within ring . I was expecting something that (for example) spawned a future to run handler within and used the response of that future to write the output response, but from https://github.com/ring-clojure/ring/blob/1.6/ring-jetty-adapter/src/ring/adapter/jetty.clj#L29-L41 it looks like any work we do in handler to get the data and build the response-map will just block the thread. Are we supposed to be doing work within our handler to create a future and build the response within it, then servlet/update-servlet-response will make sure that is correctly matched up with the request? If so, is core.async/thread a good thing to look at for this? (I know go is not, because of its use of a small threadpool, so blocking I/O is a no-no)"><y>#</y><d>2021-03-30</d><h>16:34</h><w>danm</w>Morning! I&apos;m trying to properly understand <code>ring</code>&apos;s async support in combination with Jetty. We&apos;re using it with <code>ring-jetty-adapter</code>, and are starting the server with <code>:async? true</code>, so all our handlers have arity <code>[request response raise]</code>, where <code>response</code> and <code>raise</code> are functions. We&apos;re doing this because some of our requests can be quite long-running, and we need to make a blocking I/O call to get the response data. The thing is, Jetty JMX metrics are showing us that a long-running request is still holding onto one of the threads from Jetty&apos;s threadpool while in progress, so during a load test we hit in-progress requests = threadpool max, the thread queue size spikes, and we see healthcheck requests start timing out (we think due to being stuck in the queue), even though they have no blocking calls etc to slow things down. I thought the whole point of async here was that that didn&apos;t happen.

I&apos;ve found various overly-simplistic examples detailing Jetty async (e.g. <a href="https://www.baeldung.com/jetty-embedded" target="_blank">https://www.baeldung.com/jetty-embedded</a> and <a href="https://webtide.com/servlet-3-1-async-io-and-jetty/" target="_blank">https://webtide.com/servlet-3-1-async-io-and-jetty/</a>), which show setting up a <code>WriteListener</code> with <code>onWritePossible</code> method, but they just use &apos;content&apos; to write as a string buffer or similar, not a blocking I/O call like we have. I can&apos;t find any equivalent to that within <code>ring</code>. I was expecting something that (for example) spawned a future to run <code>handler</code> within and used the response of that future to write the output response, but from <a href="https://github.com/ring-clojure/ring/blob/1.6/ring-jetty-adapter/src/ring/adapter/jetty.clj#L29-L41" target="_blank">https://github.com/ring-clojure/ring/blob/1.6/ring-jetty-adapter/src/ring/adapter/jetty.clj#L29-L41</a> it looks like any work we do in <code>handler</code> to get the data and build the <code>response-map</code> will just block the thread. Are we supposed to be doing work within our handler to create a future and build the response within it, then <code>servlet/update-servlet-response</code> will make sure that is correctly matched up with the request? If so, is <code>core.async/thread</code> a good thing to look at for this? (I know <code>go</code> is not, because of its use of a small threadpool, so blocking I/O is a no-no)</z><z id="t1617124559" t="robertfw Your handler should be handing off the work (along with the provided respond/raise functions), and then returning immediately. You can use core.async for the co-ordination of this, e.g, something along the lines of (defn my-handler [req respond _raise] (a/go (respond (a/&lt;! (handle-work req)))) handle-work would do something like putting the work into a worker queue, and you can then have some control over number of those threads you have processing the work. meanwhile the piece of code that is waiting for the work to finish is efficiently parked in the async threadpool"><y>#</y><d>2021-03-30</d><h>17:15</h><w>robertfw</w>Your handler should be handing off the work (along with the provided respond/raise functions), and then returning immediately. You can use <code>core.async</code> for the co-ordination of this, e.g, something along the lines of

<pre>(defn my-handler [req respond _raise]
  (a/go
    (respond (a/&lt;! (handle-work req))))</pre>
<code>handle-work</code> would do something like putting the work into a worker queue, and you can then have some control over number of those threads you have processing the work. meanwhile the piece of code that is waiting for the work to finish is efficiently parked in the async threadpool</z><z id="t1617130244" t="danm Cool, ta. If I‚Äôm going to have a constrained thread pool anyway, which I set the size of, is there any disadvantage to a/go as opposed to a/thread ? My reading was that blocking I/O was bad in go specifically, because by default it uses a small thread pool (8?) and you could easily end up with all threads blocked and waiting on response data (so new requests would... what? Just sit waiting for one of the go threads to become available for handling, but the main Jetty thread would be free to process another request?), but I don‚Äôt see the difference between using a/thread and limiting the number of concurrent calls vs a/go with a thread pool set to the same size"><y>#</y><d>2021-03-30</d><h>18:50</h><w>danm</w>Cool, ta. If I‚Äôm going to have a constrained thread pool anyway, which I set the size of, is there any disadvantage to <code>a/go</code> as opposed to <code>a/thread</code>? My reading was that blocking I/O was bad in <code>go</code> specifically, because by default it uses a small thread pool (8?) and you could easily end up with all threads blocked and waiting on response data (so new requests would... what? Just sit waiting for one of the <code>go</code> threads to become available for handling, but the main Jetty thread would be free to process another request?), but I don‚Äôt see the difference between using <code>a/thread</code> and limiting the number of concurrent calls vs <code>a/go</code> with a thread pool set to the same size</z><z id="t1617136648" t="robertfw I would suggest asking in #core-async for advice from practitioners more experience than I, but my initial thought is that you can probably get away with just using a/thread in this case. I&apos;m not sure off the top of my head what will happen if you lock up the async threadpool, my suspicion is that you would not be able to park new requests there, though I could be wrong."><y>#</y><d>2021-03-30</d><h>20:37</h><w>robertfw</w>I would suggest asking in #core-async for advice from practitioners more experience than I, but my initial thought is that you can probably get away with just using <code>a/thread</code> in this case. I&apos;m not sure off the top of my head what will happen if you lock up the async threadpool, my suspicion is that you would not be able to park new requests there, though I could be wrong.</z><z id="t1617136729" t="robertfw [:attrs {:href &quot;/_/_/users/U6SUWNB9N&quot;}] ^^"><y>#</y><d>2021-03-30</d><h>20:38</h><w>robertfw</w><a>@carr0t</a> ^^</z><z id="t1617138851" t="danm Thanks :)"><y>#</y><d>2021-03-30</d><h>21:14</h><w>danm</w>Thanks :)</z><z id="t1617900507" t="danm Me again (sorry!). I&apos;ve got the above working, in more or less the way suggested by [:attrs {:href &quot;/_/_/users/UG00LE5TN&quot;}] . My handler now looks like this at its core: (a/go (a/alt! respond-ch ([response] (respond response)) timeout-ch ([_] (respond timeout-response)))) So the handler is immediately returning and delegating responding to an async process, which is what I wanted. And that seems to be working, in that if I make a curl request to the server I get my expected response. But I also get an exception from Jetty on every request, saying org.eclipse.jetty.http.BadMessageException: 500: No version . Following the stacktrace, it looks like Jetty is maybe cleaning something up so that there is no output to actually write the response to by the time my go block returns? But in that case, how am I getting my response in curl ?..."><y>#</y><d>2021-04-08</d><h>16:48</h><w>danm</w>Me again (sorry!). I&apos;ve got the above working, in more or less the way suggested by <a>@robertfrederickwarner</a>. My handler now looks like this at its core:

<pre>(a/go
  (a/alt!
    respond-ch ([response] (respond response))
    timeout-ch ([_] (respond timeout-response))))</pre>
So the handler is immediately returning and delegating responding to an async process, which is what I wanted. And that seems to be working, in that if I make a <code>curl</code> request to the server I get my expected response. But I also get an exception from Jetty on every request, saying <code>org.eclipse.jetty.http.BadMessageException: 500: No version</code>. Following the stacktrace, it looks like Jetty is maybe cleaning something up so that there is no output to actually write the response to by the time my go block returns? But in that case, how am I getting my response in <code>curl</code>?...</z><z id="t1618353184" t="robertfw [:attrs {:href &quot;/_/_/users/U6SUWNB9N&quot;}] Any luck figuring this out? I haven&apos;t seen that error before and nothing obvious came up on my brief search"><y>#</y><d>2021-04-13</d><h>22:33</h><r>robertfw</r><a>@U6SUWNB9N</a>  Any luck figuring this out? I haven&apos;t seen that error before and nothing obvious came up on my brief search</z><z id="t1618387829" t="danm Yes! Sorry, I forgot to write a follow up here. I was also debugging with [:attrs {:href &quot;/_/_/users/U0BKWMG5B&quot;}] via a Reddit thread, where he was very helpful (If I&apos;m honest, he worked out the source of the issue üòâ ). The original problem above was that we were running an old version of Ring (1.6.0, which was the first version to have the async support). So that&apos;s entirely on me. I should have checked what version we were running (only 2 months on this project and team, still lots to understand myself), and tried upgrading. I never worked out what the actual cause in the code was, but upgrading to the latest 1.9.2 gave us a different stacktrace (and an empty response). For that, I worked out that 1.8.2 was fine, so that&apos;s what we&apos;re running for now. [:attrs {:href &quot;/_/_/users/U0BKWMG5B&quot;}] worked out there was a weird incompatibility with muuntaja and Ring 1.9.0+, and I wrote up a minimal repro as an issue here: https://github.com/ring-clojure/ring/issues/436"><y>#</y><d>2021-04-14</d><h>08:10</h><r>danm</r>Yes! Sorry, I forgot to write a follow up here. I was also debugging with <a>@U0BKWMG5B</a> via a Reddit thread, where he was very helpful (If I&apos;m honest, he worked out the source of the issue <b>üòâ</b>).

The original problem above was that we were running an old version of Ring (1.6.0, which was the first version to have the async support). So that&apos;s entirely on me. I should have checked what version we were running (only 2 months on this project and team, still lots to understand myself), and tried upgrading. I never worked out what the actual cause in the code was, but upgrading to the latest 1.9.2 gave us a different stacktrace (and an empty response). For that, I worked out that 1.8.2 was fine, so that&apos;s what we&apos;re running for now. <a>@U0BKWMG5B</a> worked out there was a weird incompatibility with muuntaja and Ring 1.9.0+, and I wrote up a minimal repro as an issue here: <a href="https://github.com/ring-clojure/ring/issues/436" target="_blank">https://github.com/ring-clojure/ring/issues/436</a></z><z id="t1618412346" t="robertfw Great! Glad to hear"><y>#</y><d>2021-04-14</d><h>14:59</h><r>robertfw</r>Great! Glad to hear</z><z id="t1617901487" t="danm If I wrap the a/go in a/&lt;!! , effectively forcing it to be synchronous again and making all the other work pointless, the error goes away"><y>#</y><d>2021-04-08</d><h>17:04</h><w>danm</w>If I wrap the <code>a/go</code> in <code>a/&lt;!!</code>, effectively forcing it to be synchronous again and making all the other work pointless, the error goes away</z><z id="t1618240529" t="kevinmershon Google is failing me on this one. Anyone have experience wrapping a ring sub route over a legacy Java JAX-RS webservice defined via annotations?"><y>#</y><d>2021-04-12</d><h>15:15</h><w>kevinmershon</w>Google is failing me on this one. Anyone have experience wrapping a ring sub route over a legacy Java JAX-RS webservice defined via annotations?</z><z id="t1618240625" t="kevinmershon Trying to wrap this and its siblings into a clojure application https://github.com/atlasmap/atlasmap/blob/atlasmap-2.0.5/lib/service/src/main/java/io/atlasmap/service/AtlasService.java"><y>#</y><d>2021-04-12</d><h>15:17</h><r>kevinmershon</r>Trying to wrap this and its siblings into a clojure application <a href="https://github.com/atlasmap/atlasmap/blob/atlasmap-2.0.5/lib/service/src/main/java/io/atlasmap/service/AtlasService.java" target="_blank">https://github.com/atlasmap/atlasmap/blob/atlasmap-2.0.5/lib/service/src/main/java/io/atlasmap/service/AtlasService.java</a></z><z id="t1618241081" t="kevinmershon seems maybe related? https://stackoverflow.com/questions/7237424/is-it-possible-to-call-java-servlet-from-ring-compojure"><y>#</y><d>2021-04-12</d><h>15:24</h><r>kevinmershon</r>seems maybe related? <a href="https://stackoverflow.com/questions/7237424/is-it-possible-to-call-java-servlet-from-ring-compojure" target="_blank">https://stackoverflow.com/questions/7237424/is-it-possible-to-call-java-servlet-from-ring-compojure</a></z><z id="t1618361439" t="fullNameHere Hey guys I know this code isnt ideal. Eventually I would like to add Authentication/Authorization with an actual database such as postgres, but thats a different beast for a different day. I dont understand why (get-login-infoV2) is printing false. (def users {:email &quot;user1&quot; :password &quot;fakepass&quot;}) (defn get-login-infoV2 [req] (let [{:keys [params]} req param-name (get params &quot;name&quot;) email (get params &quot;email&quot;) password (get params &quot;password&quot;) user-exists (does-user-exist? users email password)] (html [:h1 (str user-exists) &quot; lost&quot;]))) (defn login [] (html [:div (form/form-to [:post &quot;get-login-info&quot;] [:label {:for &quot;email&quot;} &quot;Email:&quot;] [:br] [:input {:type &quot;text&quot; :id &quot;email&quot; :name &quot;email&quot; :placeholder &quot;email&quot;}] [:br] [:label {:for &quot;password&quot;} &quot;Password:&quot;] [:br] [:input {:type &quot;text&quot; :id &quot;password&quot; :name &quot;password&quot; :placeholder &quot;password&quot;}] [:br] [:br] [:input {:type &quot;submit&quot; :value &quot;Submit&quot;}])])) (defn main [req] &quot;&lt;div&gt; &lt;h1&gt;Hello Web Page with Routing!&lt;/h1&gt; &lt;p&gt;What would you like to do?&lt;/p&gt; &lt;p&gt;&lt;a href=&apos;./get-form.html&apos;&gt;Submit a GET request&lt;/a&gt;&lt;/p&gt; &lt;p&gt;&lt;a href=&apos;./post-form.html&apos;&gt;Submit a POST request&lt;/a&gt;&lt;/p&gt; &lt;p&gt;&lt;a href=&apos;./login&apos;&gt;login&lt;/a&gt;&lt;/p&gt; &lt;/div&gt;&quot;) (defroutes routes (GET &quot;/&quot; [req] (main req)) (GET &quot;/login&quot; [] (login)) (GET &quot;/doesnt-exist&quot; [] (doesnt-exist)) (GET &quot;/does-exist&quot; [] (does-exist)) ;(GET &quot;/test&quot; (test1)) (POST &quot;/get-login-info&quot; [req] (get-login-infoV2 req)) ;(GET &quot;/does-user-exist?&quot; req (does-user-exist?)) (not-found (not-found1))) (def app (-&gt; routes p/wrap-params)) (defonce server (run-jetty #&apos;app {:port 8080 :join? false})) Thanks in advance! actual code https://github.com/SantoHerrera/learning-compojure/blob/main/src/learning_compojure/core.clj"><y>#</y><d>2021-04-14</d><h>00:50</h><w>fullNameHere</w>Hey guys I know this code isnt ideal. Eventually I would like to add
Authentication/Authorization with an actual database such as postgres,
but thats a different beast for a different day.

I dont understand why (get-login-infoV2) is printing false.

(def users {:email &quot;user1&quot;
            :password &quot;fakepass&quot;})


(defn get-login-infoV2 [req]
    (let [{:keys [params]} req
          param-name (get params &quot;name&quot;)
          email (get params &quot;email&quot;)
          password (get params &quot;password&quot;)
          user-exists (does-user-exist? users email password)]
        (html [:h1 (str user-exists) &quot; lost&quot;])))


(defn login
  []
  (html [:div
          (form/form-to [:post &quot;get-login-info&quot;]
              [:label {:for &quot;email&quot;} &quot;Email:&quot;]
              [:br]
              [:input {:type &quot;text&quot; :id &quot;email&quot; :name &quot;email&quot; :placeholder &quot;email&quot;}]
              [:br]
              [:label {:for &quot;password&quot;} &quot;Password:&quot;]
              [:br]
              [:input {:type &quot;text&quot; :id &quot;password&quot; :name &quot;password&quot; :placeholder &quot;password&quot;}]
              [:br]
              [:br]
              [:input {:type &quot;submit&quot; :value &quot;Submit&quot;}])]))


(defn main [req]
   &quot;&lt;div&gt;
      &lt;h1&gt;Hello Web Page with Routing!&lt;/h1&gt;
       &lt;p&gt;What would you like to do?&lt;/p&gt;
       &lt;p&gt;&lt;a href=&apos;./get-form.html&apos;&gt;Submit a GET request&lt;/a&gt;&lt;/p&gt;
       &lt;p&gt;&lt;a href=&apos;./post-form.html&apos;&gt;Submit a POST request&lt;/a&gt;&lt;/p&gt;
       &lt;p&gt;&lt;a href=&apos;./login&apos;&gt;login&lt;/a&gt;&lt;/p&gt;
   &lt;/div&gt;&quot;)


(defroutes routes
  (GET &quot;/&quot; [req] (main req))
  (GET &quot;/login&quot; [] (login))
  (GET &quot;/doesnt-exist&quot; [] (doesnt-exist))
  (GET &quot;/does-exist&quot; [] (does-exist))
  ;(GET &quot;/test&quot; (test1))
  (POST &quot;/get-login-info&quot; [req] (get-login-infoV2 req))
  ;(GET &quot;/does-user-exist?&quot; req (does-user-exist?))
  (not-found (not-found1)))


(def app
  (-&gt; routes
      p/wrap-params))


(defonce server
  (run-jetty #&apos;app {:port 8080 :join? false}))


Thanks in advance!
actual code
<a href="https://github.com/SantoHerrera/learning-compojure/blob/main/src/learning_compojure/core.clj" target="_blank">https://github.com/SantoHerrera/learning-compojure/blob/main/src/learning_compojure/core.clj</a></z><z id="t1618363898" t="seancorfield [:attrs {:href &quot;/_/_/users/U015CTPB4HZ&quot;}] You want (POST &quot;/get-login-info&quot; req (get-login-infoV2 req)) not (POST &quot;/get-login-info&quot; [req] (get-login-infoV2 req)) The first form binds the whole request to req , the second form only binds named pieces of the URI, such as if you had (GET &quot;/example/:id&quot; [id] (do-stuff id))"><y>#</y><d>2021-04-14</d><h>01:31</h><w>seancorfield</w><a>@santosx99xx</a> You want
<pre>(POST &quot;/get-login-info&quot; req (get-login-infoV2 req))</pre>
not
<pre>(POST &quot;/get-login-info&quot; [req] (get-login-infoV2 req))</pre>
The first form binds the whole request to <code>req</code>, the second form only binds named pieces of the URI, such as if you had <code>(GET &quot;/example/:id&quot; [id] (do-stuff id))</code></z><z id="t1618364342" t="fullNameHere Thanks, it was driving me a little crazy. Another question would be, how come I need to have req or [] or [req]. If I just have something like (GET &quot;/login&quot; (login)), I get an error?"><y>#</y><d>2021-04-14</d><h>01:39</h><r>fullNameHere</r>Thanks, it was driving me a little crazy. Another question would be, how come I need to have req or [] or [req]. If I just have something like
(GET &quot;/login&quot;  (login)), I get an error?</z><z id="t1618364386" t="seancorfield Because the GET (and other macros) require a binding form."><y>#</y><d>2021-04-14</d><h>01:39</h><r>seancorfield</r>Because the <code>GET</code> (and other macros) require a binding form.</z><z id="t1618364444" t="seancorfield I tend to do this instead: (GET &quot;/foo&quot; [] #&apos;my-handler) ‚Äî [] don‚Äôt bind anything particular, pass the whole Ring request to my-handler"><y>#</y><d>2021-04-14</d><h>01:40</h><r>seancorfield</r>I tend to do this instead: <code>(GET &quot;/foo&quot; [] #&apos;my-handler)</code> ‚Äî <code>[]</code> don‚Äôt bind anything particular, pass the whole Ring request to <code>my-handler</code></z><z id="t1618364476" t="seancorfield The #&apos; just means you get the Var, not the function value, so you can still redefine the function while the server is running and changes get picked up."><y>#</y><d>2021-04-14</d><h>01:41</h><r>seancorfield</r>The <code>#&apos;</code> just means you get the Var, not the function value, so you can still redefine the function while the server is running and changes get picked up.</z><z id="t1618364512" t="seancorfield See https://github.com/seancorfield/usermanager-example as a good example for getting started with Ring, Compojure, and a couple of other libs."><y>#</y><d>2021-04-14</d><h>01:41</h><r>seancorfield</r>See <a href="https://github.com/seancorfield/usermanager-example" target="_blank">https://github.com/seancorfield/usermanager-example</a> as a good example for getting started with Ring, Compojure, and a couple of other libs.</z><z id="t1618364530" t="seancorfield In particular: https://github.com/seancorfield/usermanager-example/blob/develop/src/usermanager/main.clj#L128-L134"><y>#</y><d>2021-04-14</d><h>01:42</h><r>seancorfield</r>In particular: <a href="https://github.com/seancorfield/usermanager-example/blob/develop/src/usermanager/main.clj#L128-L134" target="_blank">https://github.com/seancorfield/usermanager-example/blob/develop/src/usermanager/main.clj#L128-L134</a></z><z id="t1618364579" t="seancorfield The [id :&lt;&lt; as-int] is relying on compojure.coercions to turn certain parameters into int etc."><y>#</y><d>2021-04-14</d><h>01:42</h><r>seancorfield</r>The <code>[id :&lt;&lt; as-int]</code> is relying on <code>compojure.coercions</code> to turn certain parameters into <code>int</code> etc.</z><z id="t1618364589" t="fullNameHere Ill look into it. Why lie, im kinda walking in the dark"><y>#</y><d>2021-04-14</d><h>01:43</h><r>fullNameHere</r>Ill look into it. Why lie, im kinda walking in the dark</z><z id="t1618364712" t="seancorfield You can look at the difference between those binding forms like this: (println (macroexpand &apos;(GET &quot;/&quot; v (foo v)))) (println (macroexpand &apos;(GET &quot;/&quot; [v] (foo v))))"><y>#</y><d>2021-04-14</d><h>01:45</h><r>seancorfield</r>You can look at the difference between those binding forms like this:
<pre>(println (macroexpand &apos;(GET &quot;/&quot; v (foo v))))
(println (macroexpand &apos;(GET &quot;/&quot; [v] (foo v))))</pre></z><z id="t1618364725" t="seancorfield (compojure.core/make-route :get #clout.core.CompiledRoute{:source /, :re #&quot;/&quot;, :keys [], :absolute? false} (clojure.core/fn [request__2341__auto__] (compojure.core/let-request [v request__2341__auto__] (foo v)))) nil (compojure.core/make-route :get #clout.core.CompiledRoute{:source /, :re #&quot;/&quot;, :keys [], :absolute? false} (clojure.core/fn [request__2341__auto__] (compojure.core/let-request [[v] request__2341__auto__] (foo v)))) nil"><y>#</y><d>2021-04-14</d><h>01:45</h><r>seancorfield</r><pre>(compojure.core/make-route :get #clout.core.CompiledRoute{:source /, :re #&quot;/&quot;, :keys [], :absolute? false} (clojure.core/fn [request__2341__auto__] (compojure.core/let-request [v request__2341__auto__] (foo v))))
nil
(compojure.core/make-route :get #clout.core.CompiledRoute{:source /, :re #&quot;/&quot;, :keys [], :absolute? false} (clojure.core/fn [request__2341__auto__] (compojure.core/let-request [[v] request__2341__auto__] (foo v))))
nil</pre></z><z id="t1618919598" t="restenb is there some standard HTTP request timeout built in to the ring-jetty-component, or underlying jetty server?"><y>#</y><d>2021-04-20</d><h>11:53</h><w>restenb</w>is there some standard HTTP request timeout built in to the ring-jetty-component, or underlying jetty server?</z><z id="t1618919644" t="restenb i&apos;m experimenting with some &quot;long polling&quot;, but the server (which runs jetty via [:attrs {:href &quot;/_/_/users/U0BKWMG5B&quot;}] &apos;s ring-jetty-component) boots my requests before any timeout I&apos;ve actually programmed in happens"><y>#</y><d>2021-04-20</d><h>11:54</h><w>restenb</w>i&apos;m experimenting with some &quot;long polling&quot;, but the server (which runs jetty via <a>@weavejester</a>&apos;s ring-jetty-component) boots my requests before any timeout I&apos;ve actually programmed in happens</z><z id="t1618951165" t="robertfw Could be :thread-idle-timeout ? https://github.com/ring-clojure/ring/blob/master/ring-jetty-adapter/src/ring/adapter/jetty.clj#L197"><y>#</y><d>2021-04-20</d><h>20:39</h><r>robertfw</r>Could be <code>:thread-idle-timeout</code>? <a href="https://github.com/ring-clojure/ring/blob/master/ring-jetty-adapter/src/ring/adapter/jetty.clj#L197" target="_blank">https://github.com/ring-clojure/ring/blob/master/ring-jetty-adapter/src/ring/adapter/jetty.clj#L197</a></z><z id="t1619002887" t="rickmoynihan What is the current status of ring 2.0 / ring 2.1? My particular use case is to authenticate a request and use java.nio to serve files out of a zip efficiently, as it stands I need to spawn a thread to run the Files/copy to copy the file out of the zip to the ring output stream. It‚Äôd be nice to be able to just return a java.nio.Path (in a zip filesystem) to ring and have it automatically copy it via nio (presumably through SeekableByteChannel ) for me. Reading through the threads at https://github.com/ring-clojure/ring/issues/393 it seems nio support is planned after websocket support and slated for ring 2.1, so likely some years off yet, is that right?!"><y>#</y><d>2021-04-21</d><h>11:01</h><w>rickmoynihan</w>What is the current status of ring 2.0 / ring 2.1?

My particular use case is to authenticate a request and use java.nio to serve files out of a zip efficiently, as it stands I need to spawn a thread to run the <code>Files/copy</code> to copy the file out of the zip to the ring output stream.  It‚Äôd be nice to be able to just return a <code>java.nio.Path</code> (in a zip filesystem) to ring and have it automatically copy it via nio (presumably through <code>SeekableByteChannel</code>) for me.

Reading through the threads at <a href="https://github.com/ring-clojure/ring/issues/393" target="_blank">https://github.com/ring-clojure/ring/issues/393</a> it seems nio support is planned after websocket support and slated for ring 2.1, so likely some years off yet, is that right?!</z><z id="t1619007813" t="mpenet it&apos;s in stasis I think"><y>#</y><d>2021-04-21</d><h>12:23</h><w>mpenet</w>it&apos;s in stasis I think</z><z id="t1619007837" t="mpenet it&apos;s mostly a one man show sadly, so not sure when/if it will evolve"><y>#</y><d>2021-04-21</d><h>12:23</h><w>mpenet</w>it&apos;s mostly a one man show sadly, so not sure when/if it will evolve</z><z id="t1619007897" t="mpenet I am eager to have ring evolve too personally, but wouln&apos;t mind ring2 leaving out WS out of the picture"><y>#</y><d>2021-04-21</d><h>12:24</h><w>mpenet</w>I am eager to have ring evolve too personally, but wouln&apos;t mind ring2 leaving out WS out of the picture</z><z id="t1619007943" t="mpenet WS is full of little quirks/details that make it tricky to build a spec that will work nicely/efficiently for everybody (every server impl.) imho"><y>#</y><d>2021-04-21</d><h>12:25</h><w>mpenet</w>WS is full of little quirks/details that make it tricky to build a spec that will work nicely/efficiently for everybody (every server impl.) imho</z><z id="t1621503051" t="Crispin Hi there. I am using the ring session middleware to implement sessions. I had the :cookie-attrs set to {:max-age cookie-expiry-time} which was ok but now browsers are changing their behavoir. And I recently got the warning in firefox: Cookie ‚ÄúmyCookie‚Äù will be soon rejected because it has the ‚ÄúSameSite‚Äù attribute set to ‚ÄúNone‚Äù or an invalid value, without the ‚Äúsecure‚Äù attribute. To know more about the ‚ÄúSameSite‚Äù attribute, read . So i need to upgrade my cookies to be secure. So I set :cookie-attrs to {:max-age cookie-expiry-time :secure true} , and this does set the Secure flag on the sent cookie. However, clients with existing cookies with Secure=false do not get a new upgraded cookie sent to them. If the cookie is sent from the client ring adopts it and uses it for the session id. I need it to send a new upgraded cookie setting in the response if the client sent cookie does not match the one that would be sent (like doesnt have secure set). Is there some setting in the middleware to achieve this behavior?"><y>#</y><d>2021-05-20</d><h>09:30</h><w>Crispin</w>Hi there. I am using the ring session middleware to implement sessions. I had the :cookie-attrs set to  <code>{:max-age cookie-expiry-time}</code> which was ok but now browsers are changing their behavoir. And I recently got the warning in firefox: <code>Cookie ‚ÄúmyCookie‚Äù will be soon rejected because it has the ‚ÄúSameSite‚Äù attribute set to ‚ÄúNone‚Äù or an invalid value, without the ‚Äúsecure‚Äù attribute. To know more about the ‚ÄúSameSite‚Äù attribute, read </code>. So i need to upgrade my cookies to be secure. So I set :cookie-attrs to <code>{:max-age cookie-expiry-time :secure true}</code>, and this does set the Secure flag on the sent cookie. However, clients with existing cookies with Secure=false do not get a new upgraded cookie sent to them. If the cookie is sent from the client ring adopts it and uses it for the session id. I need it to send a new upgraded cookie setting in the response if the client sent cookie does not match the one that would be sent (like doesnt have secure set). Is there some setting in the middleware to achieve this behavior?</z><z id="t1621563239" t="hiredman Add the ring session middleware twice with a different name for the secure cookie"><y>#</y><d>2021-05-21</d><h>02:13</h><w>hiredman</w>Add the ring session middleware twice with a different name for the secure cookie</z><z id="t1621972681" t="Ian Fernandez Hi folks"><y>#</y><d>2021-05-25</d><h>19:58</h><w>Ian Fernandez</w>Hi folks</z><z id="t1621972695" t="Ian Fernandez can I ask questions about compojure here?"><y>#</y><d>2021-05-25</d><h>19:58</h><w>Ian Fernandez</w>can I ask questions about compojure here?</z><z id="t1621973346" t="seancorfield Better just to post the actual question ‚Äî #beginners is fine."><y>#</y><d>2021-05-25</d><h>20:09</h><w>seancorfield</w>Better just to post the actual question ‚Äî #beginners is fine.</z><z id="t1622053696" t="tvaughan Has anyone been able to successfully proxy websockets in a ring app? I can proxy http/s just fine, but I don&apos;t know how to handle a websocket"><y>#</y><d>2021-05-26</d><h>18:28</h><w>tvaughan</w>Has anyone been able to successfully proxy websockets in a ring app? I can proxy http/s just fine, but I don&apos;t know how to handle a websocket</z><z id="t1622053824" t="NoahTheDuke i‚Äôve had mild success with https://github.com/stalefruits/gniazdo , tho i ddin‚Äôt put it in any tests, just a simple script"><y>#</y><d>2021-05-26</d><h>18:30</h><w>NoahTheDuke</w>i‚Äôve had mild success with <a href="https://github.com/stalefruits/gniazdo" target="_blank">https://github.com/stalefruits/gniazdo</a>, tho i ddin‚Äôt put it in any tests, just a simple script</z><z id="t1622054207" t="tvaughan Thanks! Looks like with this the proxy would have to re-create the websocket request. I&apos;ll need to maintain a connection pool in the proxy so connections are re-used too. Does that sound right?"><y>#</y><d>2021-05-26</d><h>18:36</h><r>tvaughan</r>Thanks! Looks like with this the proxy would have to re-create the websocket request. I&apos;ll need to maintain a connection pool in the proxy so connections are re-used too. Does that sound right?</z><z id="t1622054247" t="NoahTheDuke oh, proxy! heck, I don‚Äôt know much about that. I interpreted that as ‚Äúmock‚Äù or ‚Äústub‚Äù, lol"><y>#</y><d>2021-05-26</d><h>18:37</h><r>NoahTheDuke</r>oh, proxy! heck, I don‚Äôt know much about that. I interpreted that as ‚Äúmock‚Äù or ‚Äústub‚Äù, lol</z><z id="t1622054264" t="NoahTheDuke ie ‚Äúhow do I make fake websocket requests?‚Äù"><y>#</y><d>2021-05-26</d><h>18:37</h><r>NoahTheDuke</r>ie ‚Äúhow do I make fake websocket requests?‚Äù</z><z id="t1622054456" t="tvaughan Haha ah ok! Sorry I wasn&apos;t clear"><y>#</y><d>2021-05-26</d><h>18:40</h><r>tvaughan</r>Haha ah ok! Sorry I wasn&apos;t clear</z><z id="t1622054766" t="NoahTheDuke nah, it‚Äôs my b for jumping to an answer without understanding the question. head empty no thoughts"><y>#</y><d>2021-05-26</d><h>18:46</h><r>NoahTheDuke</r>nah, it‚Äôs my b for jumping to an answer without understanding the question. head empty no thoughts</z><z id="t1622054805" t="NoahTheDuke that library is very nice tho. works seamlessly with sente, which is our primary websockets library."><y>#</y><d>2021-05-26</d><h>18:46</h><r>NoahTheDuke</r>that library is very nice tho. works seamlessly with sente, which is our primary websockets library.</z><z id="t1622059838" t="tvaughan I may be able to use the middleware wrapper in https://github.com/jarohen/chord#clojure ..."><y>#</y><d>2021-05-26</d><h>20:10</h><r>tvaughan</r>I may be able to use the middleware wrapper in <a href="https://github.com/jarohen/chord#clojure" target="_blank">https://github.com/jarohen/chord#clojure</a> ...</z><z id="t1622856473" t="km Hey guys, Anyone have an easy way to send multipart/form-data requests with ring-mock? I&apos;m having a heck of a time trying to post a file."><y>#</y><d>2021-06-05</d><h>01:27</h><w>km</w>Hey guys,
Anyone have an easy way to send multipart/form-data requests with ring-mock? I&apos;m having a heck of a time trying to post a file.</z><z id="t1622906013" t="Johnny My ring handler returns this response {:status 400, :headers {}, :body &quot;Bad request.&quot;} (after middleware), however my browser receives a 404 with no body when I send a request. What might the reason for that be? I have no routing installed, and no part in my code creates a 404 response. (defn wrap-log [handler] (fn [req] (println &quot;-----REQUEST-----&quot;) (pprint req) (println &quot;-----RESPONSE-----&quot;) (pprint (handler req)))) (def app (-&gt; handler wrap-json-response wrap-clean-json wrap-json-body (wrap-authenticate (:public-key config)) wrap-log)) (defn -main [&amp; args] (mount/start) (http-server/run-server app)) This is an excerpt from my main namespace. I got the information about the response from the wrap-log middleware. The server is http-kit."><y>#</y><d>2021-06-05</d><h>15:13</h><w>Johnny</w>My ring handler returns this response <code>{:status 400, :headers {}, :body &quot;Bad request.&quot;}</code> (after middleware), however my browser receives a 404 with no body when I send a request.
What might the reason for that be? I have no routing installed, and no  part in my code creates a 404 response.

<pre>(defn wrap-log [handler]
  (fn [req]
    (println &quot;-----REQUEST-----&quot;)
    (pprint req)
    (println &quot;-----RESPONSE-----&quot;)
    (pprint (handler req))))

(def app
  (-&gt; handler
      wrap-json-response
      wrap-clean-json
      wrap-json-body
      (wrap-authenticate (:public-key config))
      wrap-log))

(defn -main [&amp; args]
  (mount/start)
  (http-server/run-server app))</pre>
This is an excerpt from my main namespace. I got the information about the response from the wrap-log middleware. The server is http-kit.</z><z id="t1622906479" t="hiredman pprint is returning nil"><y>#</y><d>2021-06-05</d><h>15:21</h><w>hiredman</w>pprint is returning nil</z><z id="t1622906504" t="hiredman wrap-log needs to actually return the result of the call to handler"><y>#</y><d>2021-06-05</d><h>15:21</h><w>hiredman</w>wrap-log needs to actually return the result of the call to handler</z><z id="t1622906705" t="Johnny Yep, I just found it too... Sometimes such obvious errors manage to escape your sight"><y>#</y><d>2021-06-05</d><h>15:25</h><w>Johnny</w>Yep, I just found it too... Sometimes such obvious errors manage to escape your sight</z></g><g id="s8"><z id="t1622906708" t="Johnny Thank you"><y>#</y><d>2021-06-05</d><h>15:25</h><w>Johnny</w>Thank you</z><z id="t1623849211" t="Endre Bakken Stovner If I want to communicate with my web-server by sending JSON from the command line using curl POST requests, how would I get the correct CSRF-token?"><y>#</y><d>2021-06-16</d><h>13:13</h><w>Endre Bakken Stovner</w>If I want to communicate with my web-server by sending JSON from the command line using curl POST requests, how would I get the correct CSRF-token?</z><z id="t1623849297" t="Endre Bakken Stovner I have this home-routes definition: (defn home-routes [] [&quot;&quot; {:middleware [middleware/wrap-csrf middleware/wrap-formats]} [&quot;/&quot; {:get home-page}] [&quot;/json&quot; {:post #(constantly &quot;json&quot;)}] I can only know the CSRF token from webpages served to me, right? Then how could I automatically get it from my server?"><y>#</y><d>2021-06-16</d><h>13:14</h><w>Endre Bakken Stovner</w>I have this <code>home-routes</code> definition:

<pre>(defn home-routes []
  [&quot;&quot;
   {:middleware [middleware/wrap-csrf
                 middleware/wrap-formats]}
   [&quot;/&quot; {:get home-page}]
   [&quot;/json&quot; {:post #(constantly &quot;json&quot;)}]</pre>
I can only know the CSRF token from webpages served to me, right? Then how could I automatically get it from my server?</z><z id="t1623921893" t="kirill.salykin hey, morning! It seems to be possible to send input-stream as a body, right? (based on https://github.com/ring-clojure/ring/blob/master/ring-core/src/ring/core/protocols.clj#L19 ) the question is - will input-stream be auto closed once consumed? if not - how (when) i ccan close it? --- UPDATED: found, it does close it]"><y>#</y><d>2021-06-17</d><h>09:24</h><w>kirill.salykin</w>hey, morning!

It seems to be possible to send <code>input-stream</code> as a body, right? (based on <a href="https://github.com/ring-clojure/ring/blob/master/ring-core/src/ring/core/protocols.clj#L19" target="_blank">https://github.com/ring-clojure/ring/blob/master/ring-core/src/ring/core/protocols.clj#L19</a>)
the question is - will input-stream be auto closed once consumed? if not - how (when) i ccan close it?

---

UPDATED: found, it does close it]</z><z id="t1624462262" t="Viktor Has anyone managed to limit the number of concurrent connections in ring-jetty-adapter? Seems that :max-threads only configures jettys threadpool, where things can be used for all sorts of things"><y>#</y><d>2021-06-23</d><h>15:31</h><w>Viktor</w>Has anyone managed to limit the number of concurrent connections in ring-jetty-adapter? Seems that :max-threads only configures jettys threadpool, where things can be used for all sorts of things</z><z id="t1624462268" t="Viktor https://stackoverflow.com/questions/68036239/ring-jetty-adapter-limit-concurrent-requests/68037738?noredirect=1#comment120258873_68037738"><y>#</y><d>2021-06-23</d><h>15:31</h><w>Viktor</w><a href="https://stackoverflow.com/questions/68036239/ring-jetty-adapter-limit-concurrent-requests/68037738?noredirect=1#comment120258873_68037738" target="_blank">https://stackoverflow.com/questions/68036239/ring-jetty-adapter-limit-concurrent-requests/68037738?noredirect=1#comment120258873_68037738</a></z><z id="t1624489316" t="emccue https://stackoverflow.com/questions/5737923/how-do-i-limit-the-number-of-connections-jetty-will-accept"><y>#</y><d>2021-06-23</d><h>23:01</h><w>emccue</w><a href="https://stackoverflow.com/questions/5737923/how-do-i-limit-the-number-of-connections-jetty-will-accept" target="_blank">https://stackoverflow.com/questions/5737923/how-do-i-limit-the-number-of-connections-jetty-will-accept</a></z><z id="t1624489322" t="emccue this seems relevant"><y>#</y><d>2021-06-23</d><h>23:02</h><w>emccue</w>this seems relevant</z><z id="t1624522371" t="Viktor hmm thanks [:attrs {:href &quot;/_/_/users/U3JH98J4R&quot;}] but seems that‚Äôs more about the server accepting many connections and queuing them - in this case I just want to limit the number of threads being worked on at the same time. (jetty apparently has acceptor, selector and worker threads, and I wanna limit the worker threads specifically)."><y>#</y><d>2021-06-24</d><h>08:12</h><w>Viktor</w>hmm thanks <a>@emccue</a> but seems that‚Äôs more about the server accepting many connections and queuing them - in this case I just want to limit the number of threads being worked on at the same time. (jetty apparently has acceptor, selector and worker threads, and I wanna limit the worker threads specifically).</z><z id="t1624522430" t="Viktor Really makes me happy to be coding in clojure when you try to figure out these java monsters with insane amounts of xml, inheritance and abstraction for everything"><y>#</y><d>2021-06-24</d><h>08:13</h><w>Viktor</w>Really makes me happy to be coding in clojure when you try to figure out these java monsters with insane amounts of xml, inheritance and abstraction for everything</z><z id="t1625234900" t="teodorlu Hi! When I POST to my endpoint, ring.adapter.jetty gives me a :body of type org.eclipse.jetty.server.HttpInputOverHTTP . How can I create an instance of HttpInputOverHTTP from a string? That would help me work from the REPL."><y>#</y><d>2021-07-02</d><h>14:08</h><w>teodorlu</w>Hi!

When I POST to my endpoint, ring.adapter.jetty gives me a :body of type <code>org.eclipse.jetty.server.HttpInputOverHTTP</code>. How can I create an instance of HttpInputOverHTTP from a string? That would help me work from the REPL.</z><z id="t1625234989" t="teodorlu Hmm, perhaps I can just create an input stream. The spec says that the body should be a java.io.InputStream . :body (Optional, java.io.InputStream) An InputStream for the request body, if present."><y>#</y><d>2021-07-02</d><h>14:09</h><r>teodorlu</r>Hmm, perhaps I can just create an input stream. The spec says that the body should be a <code>java.io.InputStream</code>.

<pre>:body
  (Optional, java.io.InputStream)
  An InputStream for the request body, if present.</pre></z><z id="t1625235104" t="teodorlu Looks like (io/input-stream (.getBytes &quot;{\&quot;my\&quot;:\&quot;json\&quot;&quot;)) might just be it. Don&apos;t mind me! duckie"><y>#</y><d>2021-07-02</d><h>14:11</h><r>teodorlu</r>Looks like <code>(io/input-stream (.getBytes &quot;{\&quot;my\&quot;:\&quot;json\&quot;&quot;))</code>  might just be it.

Don&apos;t mind me! <b>duckie</b></z><z id="t1627349568" t="Jacob Rosenzweig Can anyone tell me why this decoder function works but not the encoder function? (def instance (m/create (-&gt; m/default-options (update-in [:formats &quot;application/transit+json&quot; :decoder-opts] (partial merge time/time-deserialization-handlers)) (update-in [:formats &quot;application/transit+json&quot; :encoder-opts] (partial merge time/time-serialization-handlers)) (update-in [:formats &quot;application/json&quot; :encoder-opts] (partial merge {:encode-key-fn #(name (csk/-&gt;camelCase %))})) (update-in [:formats &quot;application/json&quot; :decoder-opts] (partial merge {:decode-key-fn #(keyword (csk/-&gt;kebab-case %))})))))"><y>#</y><d>2021-07-27</d><h>01:32</h><w>Jacob Rosenzweig</w>Can anyone tell me why this decoder function works but not the encoder function?

<pre>(def instance
  (m/create
    (-&gt; m/default-options
        (update-in
          [:formats &quot;application/transit+json&quot; :decoder-opts]
          (partial merge time/time-deserialization-handlers))
        (update-in
          [:formats &quot;application/transit+json&quot; :encoder-opts]
          (partial merge time/time-serialization-handlers))
        (update-in
          [:formats &quot;application/json&quot; :encoder-opts]
          (partial merge {:encode-key-fn #(name (csk/-&gt;camelCase %))}))
        (update-in
          [:formats &quot;application/json&quot; :decoder-opts]
          (partial merge {:decode-key-fn #(keyword (csk/-&gt;kebab-case %))})))))</pre></z><z id="t1627349584" t="Jacob Rosenzweig I still get camel case in my web responses."><y>#</y><d>2021-07-27</d><h>01:33</h><w>Jacob Rosenzweig</w>I still get camel case in my web responses.</z><z id="t1627350931" t="seancorfield [:attrs {:href &quot;/_/_/users/U02313K7TSL&quot;}] It would help if you explained what m and time were and how this instance is used."><y>#</y><d>2021-07-27</d><h>01:55</h><w>seancorfield</w><a>@rosenjcb</a> It would help if you explained what <code>m</code> and <code>time</code> were and how this <code>instance</code> is used.</z><z id="t1627351132" t="Jacob Rosenzweig So for context, this is what I get out of the luminus template. I honestly am not sure where this belongs, so I put it in the #ring channel as a muuntaja channel doesn&apos;t exist. As far as I can tell, it&apos;s used by the Muuntaja JSON middleware. One suggestion someone had was this: https://github.com/duct-framework/duct/issues/104 Which basically boils down to adding custom decoder and encoder functions to the format config. My encoder works, it&apos;s able to call the (csk/-&gt;kebab-case) function and convert any camelCase payloads into kebab-case maps. But for whatever reason, it doesn&apos;t want to work the other way around."><y>#</y><d>2021-07-27</d><h>01:58</h><w>Jacob Rosenzweig</w>So for context, this is what I get out of the luminus template. I honestly am not sure where this belongs, so I put it in the #ring channel as a muuntaja channel doesn&apos;t exist. As far as I can tell, it&apos;s used by the Muuntaja JSON middleware. One suggestion someone had was this:
<a href="https://github.com/duct-framework/duct/issues/104" target="_blank">https://github.com/duct-framework/duct/issues/104</a>

Which basically boils down to adding custom <code>decoder</code> and <code>encoder</code> functions to the format config. My encoder works, it&apos;s able to call the <code>(csk/-&gt;kebab-case)</code> function and convert any camelCase payloads into kebab-case maps. But for whatever reason, it doesn&apos;t want to work the other way around.</z><z id="t1627351141" t="Jacob Rosenzweig Maybe my function is wrong, maybe my approach is wrong. Not really sure."><y>#</y><d>2021-07-27</d><h>01:59</h><w>Jacob Rosenzweig</w>Maybe my function is wrong, maybe my approach is wrong. Not really sure.</z><z id="t1627351482" t="seancorfield This is why I don&apos;t recommend Luminus for beginners -- so many moving parts and so many libraries to understand... and so many opportunities for things to go wrong üòê"><y>#</y><d>2021-07-27</d><h>02:04</h><w>seancorfield</w>This is why I don&apos;t recommend Luminus for beginners -- so many moving parts and so many libraries to understand... and so many opportunities for things to go wrong <b>üòê</b></z><z id="t1627351640" t="seancorfield Auto-converting JSON to keywords is generally considered a bad idea (although it is less dangerous than it used to be: since keywords were interned &quot;forever&quot; you could DDoS Clojure servers by just sending them lots of random JSON and filling up their keyword storage -- but now I believe it uses weak references so they can be GC&apos;d?). Anyways, just something to be aware of."><y>#</y><d>2021-07-27</d><h>02:07</h><w>seancorfield</w>Auto-converting JSON to keywords is generally considered a bad idea (although it is less dangerous than it used to be: since keywords were interned &quot;forever&quot; you could DDoS Clojure servers by just sending them lots of random JSON and filling up their keyword storage -- but now I believe it uses weak references so they can be GC&apos;d?). Anyways, just something to be aware of.</z><z id="t1627351771" t="seancorfield I&apos;ve never used Muuntaja. That&apos;s a Metosin library? Are you also using Reitit? There&apos;s a #reitit channel so maybe you could ask in there. I thought there was a #metosin channel but apparently not. There is a #duct channel which might be worth a try (I&apos;ve never used Duct either)."><y>#</y><d>2021-07-27</d><h>02:09</h><w>seancorfield</w>I&apos;ve never used Muuntaja. That&apos;s a Metosin library? Are you also using Reitit? There&apos;s a #reitit channel so maybe you could ask in there. I thought there was a #metosin channel but apparently not. There is a #duct channel which might be worth a try (I&apos;ve never used Duct either).</z><z id="t1627351816" t="seancorfield Part of the &quot;problem&quot; with the Luminus template is that there are so many layers and you kind of have to understand them all in order to start customizing stuff..."><y>#</y><d>2021-07-27</d><h>02:10</h><w>seancorfield</w>Part of the &quot;problem&quot; with the Luminus template is that there are so many layers and you kind of have to understand them all in order to start customizing stuff...</z><z id="t1627351833" t="seancorfield There is a #luminus channel too..."><y>#</y><d>2021-07-27</d><h>02:10</h><w>seancorfield</w>There is a #luminus channel too...</z><z id="t1627351967" t="Jacob Rosenzweig Yeah let me try reposting in #reitit. Seems like there&apos;s some activity there."><y>#</y><d>2021-07-27</d><h>02:12</h><w>Jacob Rosenzweig</w>Yeah let me try reposting in #reitit. Seems like there&apos;s some activity there.</z><z id="t1627352023" t="Jacob Rosenzweig [:attrs {:href &quot;/_/_/users/U04V70XH6&quot;}] what do you recommend to beginners then? Everyone I saw recommended luminus."><y>#</y><d>2021-07-27</d><h>02:13</h><w>Jacob Rosenzweig</w><a>@seancorfield</a> what do you recommend to beginners then? Everyone I saw recommended luminus.</z><z id="t1627352987" t="seancorfield I usually recommend beginners start with Ring + ( Compojure | Reitit ) and understand that stuff first."><y>#</y><d>2021-07-27</d><h>02:29</h><w>seancorfield</w>I usually recommend beginners start with Ring + ( Compojure | Reitit ) and understand that stuff first.</z><z id="t1627833616" t="zackteo I am having cors issues with ring and even with the current setup ... after referencing https://stackoverflow.com/questions/58030830/clojure-cross-origin-error-totally-lost (wrap-cors :access-control-allow-origin [#&quot;.*&quot;] :access-control-allow-headers #{&quot;accept&quot; &quot;accept-encoding&quot; &quot;accept-language&quot; &quot;authorization&quot; &quot;content-type&quot; &quot;origin&quot;} :access-control-allow-methods [:get :put :post :delete]) but it still seems like there are issues? Not sure if I&apos;m doing something wrong here or is the frontend(?)"><y>#</y><d>2021-08-01</d><h>16:00</h><w>zackteo</w>I am having cors issues with ring and even with the current setup ... after referencing <a href="https://stackoverflow.com/questions/58030830/clojure-cross-origin-error-totally-lost" target="_blank">https://stackoverflow.com/questions/58030830/clojure-cross-origin-error-totally-lost</a>
<pre>(wrap-cors
       :access-control-allow-origin [#&quot;.*&quot;]
       :access-control-allow-headers #{&quot;accept&quot;
                                       &quot;accept-encoding&quot;
                                       &quot;accept-language&quot;
                                       &quot;authorization&quot;
                                       &quot;content-type&quot;
                                       &quot;origin&quot;}
       :access-control-allow-methods [:get :put :post :delete])</pre>
but it still seems like there are issues? Not sure if I&apos;m doing something wrong here or is the frontend(?)</z><z id="t1627841866" t="seancorfield [:attrs {:href &quot;/_/_/users/UUSQHP535&quot;}] It&apos;s usually just a matter of where in the middleware stack you put it. What other middleware are you using and how do you build your middleware stack and routes? The CORS stuff has to be pretty much the outermost layer."><y>#</y><d>2021-08-01</d><h>18:17</h><w>seancorfield</w><a>@zackteo</a> It&apos;s usually just a matter of where in the middleware stack you put it. What other middleware are you using and how do you build your middleware stack and routes? The CORS stuff has to be pretty much the outermost layer.</z><z id="t1627863452" t="AudA I have a simple server running and when I try to access a POST endpoint, it doesn‚Äôt return the add-record handler, instead goes the the not-found handler. On the network tab, it actually says that the request method is a GET . What am I missing here? Also if I curl -v http:/127.0.0.1:3000/foo , I get HTTP/1.1 404 Not Found The GET endpoint works fine. (ns practice.server (:require [compojure.core :refer [defroutes GET POST]] [org.httpkit.server :as server] [ring.middleware.defaults :refer [wrap-defaults site-defaults]] [compojure.route :as route])) (defn add-record [req] (println req)) (defn get-bar [req] {:status 200 :headers {&quot;Content-Type&quot; &quot;text/html&quot;} :body &quot;Hello World&quot;}) (defroutes app-routes (POST &quot;/foo&quot; [] add-record) (GET &quot;/bar&quot; [] get-bar) (route/not-found &quot;Error, page not found!&quot;)) (defn web-server [&amp; args] (let [port (Integer/parseInt (or (System/getenv &quot;PORT&quot;) &quot;3000&quot;))] ; Run the server with Ring.defaults middleware (server/run-server (wrap-defaults #&apos;app-routes site-defaults) {:port port}) (println (str &quot;Running webserver at http:/127.0.0.1:&quot; port &quot;/&quot;))))"><y>#</y><d>2021-08-02</d><h>00:17</h><w>AudA</w>I have a simple server running and when I try to access a <code>POST</code> endpoint, it doesn‚Äôt return the <code>add-record</code> handler, instead goes the the <code>not-found</code> handler. On the network tab, it actually says that the request method is a <code>GET</code>. What am I missing here?

Also if I <code>curl -v http:/127.0.0.1:3000/foo</code> , I get <code>HTTP/1.1 404 Not Found</code>

The <code>GET</code> endpoint works fine.

<pre>(ns practice.server
  (:require
     [compojure.core :refer [defroutes GET POST]]
     [org.httpkit.server :as server]
     [ring.middleware.defaults :refer [wrap-defaults site-defaults]]
     [compojure.route :as route]))

(defn add-record 
  [req]
  (println req))

(defn get-bar 
  [req]
  {:status 200
   :headers {&quot;Content-Type&quot; &quot;text/html&quot;}
   :body &quot;Hello World&quot;})

(defroutes app-routes
  (POST &quot;/foo&quot; [] add-record)
  (GET &quot;/bar&quot; [] get-bar)
  (route/not-found &quot;Error, page not found!&quot;))

(defn web-server
  [&amp; args]
  (let [port (Integer/parseInt (or (System/getenv &quot;PORT&quot;) &quot;3000&quot;))]
    ; Run the server with Ring.defaults middleware
    (server/run-server (wrap-defaults #&apos;app-routes site-defaults) {:port port})
    (println (str &quot;Running webserver at http:/127.0.0.1:&quot; port &quot;/&quot;))))</pre></z><z id="t1627864132" t="seancorfield [:attrs {:href &quot;/_/_/users/UPFES57NE&quot;}] That is because your handler returns nil (from the println call) and Compojure treats a nil handler response as &quot;doesn&apos;t match&quot; and moves on to the next possible route match, which will be not-found in this case."><y>#</y><d>2021-08-02</d><h>00:28</h><w>seancorfield</w><a>@audyarandela</a> That is because your handler returns <code>nil</code> (from the <code>println</code> call) and Compojure treats a <code>nil</code> handler response as &quot;doesn&apos;t match&quot; and moves on to the next possible route match, which will be <code>not-found</code> in this case.</z><z id="t1627864150" t="seancorfield As soon as you make add-record return a response, it will work as you expect."><y>#</y><d>2021-08-02</d><h>00:29</h><w>seancorfield</w>As soon as you make <code>add-record</code> return a response, it will work as you expect.</z><z id="t1627864469" t="AudA Thanks for your response! I just tried adding a simple response, same as get-bar and still was getting the same 404 error."><y>#</y><d>2021-08-02</d><h>00:34</h><w>AudA</w>Thanks for your response! I just tried adding a simple response, same as <code>get-bar</code> and still was getting the same <code>404</code> error.</z><z id="t1627864622" t="AudA Oddly enough, when I change the POST route to ANY it works. But thats not REST-y and the request method on the network tab shows GET still"><y>#</y><d>2021-08-02</d><h>00:37</h><w>AudA</w>Oddly enough, when I change the <code>POST</code> route to <code>ANY</code> it works. But thats not REST-y and the request method on the network tab shows <code>GET</code> still</z><z id="t1627864842" t="seancorfield Are you sure you&apos;re sending a POST request with curl ? I thought you needed -d to POST data..."><y>#</y><d>2021-08-02</d><h>00:40</h><w>seancorfield</w>Are you sure you&apos;re sending a POST request with <code>curl</code>? I thought you needed <code>-d</code> to POST data...</z><z id="t1627864993" t="AudA Yes you‚Äôre correct, -d is needed for POST. getting a different error now, &lt;h1&gt;Invalid anti-forgery token&lt;/h1&gt;"><y>#</y><d>2021-08-02</d><h>00:43</h><w>AudA</w>Yes you‚Äôre correct, <code>-d</code> is needed for POST. getting a different error now, <code>&lt;h1&gt;Invalid anti-forgery token&lt;/h1&gt;</code></z><z id="t1627865054" t="AudA When trying to access it via web browser, all I was getting was that 404 error and seeing that the request method was GET , time to google some more with the new error lol"><y>#</y><d>2021-08-02</d><h>00:44</h><w>AudA</w>When trying to access it via web browser, all I was getting was that <code>404</code> error and seeing that the request method was <code>GET</code>, time to google some more with the new error lol</z><z id="t1627865261" t="AudA Thanks [:attrs {:href &quot;/_/_/users/U04V70XH6&quot;}] , I disabled the :security and :anti-forgery in site-defaults and was able to curl through. (its only a practice app to understand the tech)"><y>#</y><d>2021-08-02</d><h>00:47</h><w>AudA</w>Thanks <a>@seancorfield</a>, I disabled the <code>:security</code> and <code>:anti-forgery</code> in <code>site-defaults</code> and was able to curl through. (its only a practice app to understand the tech)</z><z id="t1627865631" t="seancorfield Yeah, to use curl when you have CSRF in place you need to GET the form first, copy the anti-forgery token in it, then POST the form fields and the anti-forgery token."><y>#</y><d>2021-08-02</d><h>00:53</h><w>seancorfield</w>Yeah, to use <code>curl</code> when you have CSRF in place you need to GET the form first, copy the anti-forgery token in it, then POST the form fields and the anti-forgery token.</z><z id="t1627865725" t="seancorfield The idea behind CSRF is that you can&apos;t just randomly POST stuff to an app -- you have to actually fill in the form fields and then submit the form. That&apos;s the security aspect of it üôÇ"><y>#</y><d>2021-08-02</d><h>00:55</h><w>seancorfield</w>The idea behind CSRF is that you can&apos;t just randomly POST stuff to an app -- you have to actually fill in the form fields and then submit the form. That&apos;s the security aspect of it <b>üôÇ</b></z><z id="t1627865769" t="AudA Yea that makes sense now lol. Probably also why the web browser showing an error because it doesn‚Äôt have the right credentials"><y>#</y><d>2021-08-02</d><h>00:56</h><w>AudA</w>Yea that makes sense now lol. Probably also why the web browser showing an error because it doesn‚Äôt have the right credentials</z><z id="t1627867068" t="seancorfield I think you have to actually add stuff to the form so that the CSRF token is available as a hidden field... I&apos;ve never used it myself (I mostly do REST APIs which use the API defaults, not the site default)."><y>#</y><d>2021-08-02</d><h>01:17</h><w>seancorfield</w>I think you have to actually add stuff to the form so that the CSRF token is available as a hidden field... I&apos;ve never used it myself (I mostly do REST APIs which use the API defaults, not the site default).</z><z id="t1627867112" t="seancorfield ring-defaults is good for that -- there&apos;s API, secure API, web site, and secure web site I think as four base profiles."><y>#</y><d>2021-08-02</d><h>01:18</h><w>seancorfield</w><code>ring-defaults</code> is good for that -- there&apos;s API, secure API, web site, and secure web site I think as four base profiles.</z><z id="t1629895507" t="Santiago üëã I‚Äôm building a fullstack webapp in clojure for the first time, without much prior experience doing this at all. I‚Äôm using http://htmx.org to avoid writing frontend JS (if you‚Äôre unfamiliar, it‚Äôs just rendering everything server-side and swapping only certain divs instead of fullpage refresh). For some use-cases I need to know what the user is seeing e.g. ‚Äúpress button to go to next item‚Äù -&gt; I need to know where the user is and what‚Äôs next. I think this is usually done with sessions, but I‚Äôm not sure in practice how to keep track of this and more complicated things like cacheing full hiccup objects. My understanding is that it‚Äôs possible to use the ring cookie from the session middleware and then reply to the client with the information I want to keep track. This sounds ok for some data points, but full page status is too much no? I also read about using redis to keep the session, but don‚Äôt I still have to send the whole state to the client every time? I felt the ring-sessions docs is a bit thin for beginners like me üò¨"><y>#</y><d>2021-08-25</d><h>12:45</h><w>Santiago</w><b>üëã</b> I‚Äôm building a fullstack webapp in clojure for the first time, without much prior experience doing this at all. I‚Äôm using <a href="http://htmx.org" target="_blank">http://htmx.org</a> to avoid writing frontend JS (if you‚Äôre unfamiliar, it‚Äôs just rendering everything server-side and swapping only certain divs instead of fullpage refresh).

For some use-cases I need to know what the user is seeing e.g. ‚Äúpress button to go to next item‚Äù -&gt; I need to know where the user is and what‚Äôs next. I think this is usually done with sessions, but I‚Äôm not sure in practice how to keep track of this and more complicated things like cacheing full hiccup objects. My understanding is that it‚Äôs possible to use the ring cookie from the session middleware and then reply to the client with the information I want to keep track. This sounds ok for some data points, but full page status is too much no? I also read about using redis to keep the session, but don‚Äôt I still have to send the whole state to the client every time? I felt the ring-sessions docs is a bit thin for beginners like me <b>üò¨</b></z><z id="t1629899015" t="tvaughan I may have misunderstood but it seems to me that where the user is and what‚Äôs next could be represented by the url, no? "><y>#</y><d>2021-08-25</d><h>13:43</h><r>tvaughan</r>I may have misunderstood but it seems to me that where the user is and what‚Äôs next could be represented by the url, no? </z><z id="t1629903669" t="Santiago where the user is yes, but I‚Äôm not seeing how to do what‚Äôs next in the url. For context there‚Äôs the possibility that ‚Äúwhat‚Äôs next‚Äù is composed of 100+ uuids. Isn‚Äôt that too much? I think I have found a good solution totally bypassing sessions though üôÇ using htmx I can just create a button with the url pointing at the next/previous item to the current one, because the server always knows what is available. A bit hard to explain in pure english. Nonetheless, I‚Äôm still interested in answering this question about sending data to the client with every request"><y>#</y><d>2021-08-25</d><h>15:01</h><r>Santiago</r>where the user is yes, but I‚Äôm not seeing how to do what‚Äôs next in the url. For context there‚Äôs the possibility that ‚Äúwhat‚Äôs next‚Äù is composed of 100+ uuids. Isn‚Äôt that too much?

I think I have found a good solution totally bypassing sessions though <b>üôÇ</b> using htmx I can just create a button with the url pointing at the next/previous item to the current one, because the server always knows what is available. A bit hard to explain in pure english. Nonetheless, I‚Äôm still interested in answering this question about sending data to the client with every request</z><z id="t1629909136" t="tvaughan Would something like /friends?cursor=some-uuid&amp;count=100 work?"><y>#</y><d>2021-08-25</d><h>16:32</h><r>tvaughan</r>Would something like /friends?cursor=some-uuid&amp;count=100 work?</z><z id="t1630594630" t="Douglas Ramos Hey everyone! I&apos;ve been working with pedestal for some time and now I want to learn a bit about ring and its middleware model. One thing in my research that I always find is that this model, early in the days, made it difficult to ring to work with async. Could someone explain why? I know that middleware is about function composition but I simply don&apos;t see why this is a problem in comparison to the interceptor model"><y>#</y><d>2021-09-02</d><h>14:57</h><w>Douglas Ramos</w>Hey everyone! I&apos;ve been working with pedestal for some time and now I want to learn a bit about ring and its middleware model. One thing in my research that I always find is that this model, early in the days, made it difficult to ring to work with async. Could someone explain why? I know that middleware is about function composition but I simply don&apos;t see why this is a problem in comparison to the interceptor model</z><z id="t1630598373" t="seancorfield Ring uses different arities for sync and async so middleware has to also have both arities implemented (and a lot of middleware out there does not)."><y>#</y><d>2021-09-02</d><h>15:59</h><w>seancorfield</w>Ring uses different arities for sync and async so middleware has to also have both arities implemented (and a lot of middleware out there does not).</z><z id="t1630662489" t="Ben Sless Something which stumped me regarding non blocking ring mws is calling async functions in the middleware. The handler must be invoked on the async function&apos;s callback This has the unpleasant consequence of getting off the thread pool the handler was invoked in. Only solution I&apos;ve been able to find is giving everyone the same executor service. Is that even a good idea?"><y>#</y><d>2021-09-03</d><h>09:48</h><r>Ben Sless</r>Something which stumped me regarding non blocking ring mws is calling async functions in the middleware. The handler must be invoked on the async function&apos;s callback
This has the unpleasant consequence of getting off the thread pool the handler was invoked in.
Only solution I&apos;ve been able to find is giving everyone the same executor service. Is that even a good idea?</z><z id="t1630686619" t="seancorfield No idea. I&apos;ve never even tried to use the async stuff in Ring."><y>#</y><d>2021-09-03</d><h>16:30</h><r>seancorfield</r>No idea. I&apos;ve never even tried to use the async stuff in Ring.</z><z id="t1633306203" t="mister_m just getting started with ring; this lein plugin enabling hot reloading of handlers I&apos;m messing around with is pretty neat."><y>#</y><d>2021-10-04</d><h>00:10</h><w>mister_m</w>just getting started with ring; this lein plugin enabling hot reloading of handlers I&apos;m messing around with is pretty neat.</z><z id="t1633306258" t="seancorfield [:attrs {:href &quot;/_/_/users/U01188CHUFL&quot;}] If you take a bit of care to write REPL-friendly code, you don&apos;t need any of that code reloading stuff."><y>#</y><d>2021-10-04</d><h>00:10</h><w>seancorfield</w><a>@radicalmatt</a> If you take a bit of care to write REPL-friendly code, you don&apos;t need any of that code reloading stuff.</z><z id="t1633306284" t="seancorfield https://clojure.org/guides/repl/enhancing_your_repl_workflow#writing-repl-friendly-programs for example"><y>#</y><d>2021-10-04</d><h>00:11</h><w>seancorfield</w><a href="https://clojure.org/guides/repl/enhancing_your_repl_workflow#writing-repl-friendly-programs" target="_blank">https://clojure.org/guides/repl/enhancing_your_repl_workflow#writing-repl-friendly-programs</a> for example</z><z id="t1633306380" t="seancorfield At work, we develop against a running REPL and don&apos;t use any plugins or middleware for reloading. We evaluate every change as we make it, we write &quot;REPL-friendly&quot; code using #&apos;some-var references (instead of plain some-var ) where we need the extra indirection, usually around Ring middleware stacks, and then we don&apos;t need to reload or restart anything: the web app is always running the latest code."><y>#</y><d>2021-10-04</d><h>00:13</h><w>seancorfield</w>At work, we develop against a running REPL and don&apos;t use any plugins or middleware for reloading. We evaluate every change as we make it, we write &quot;REPL-friendly&quot; code using <code>#&apos;some-var</code> references (instead of plain <code>some-var</code>) where we need the extra indirection, usually around Ring middleware stacks, and then we don&apos;t need to reload or restart anything: the web app is always running the latest code.</z><z id="t1633306530" t="mister_m This is what I am referring to https://github.com/ring-clojure/ring/wiki/Setup-for-development#setup-using-the-lein-ring-plugin - is this not necessary if I were to pass a handler reference to jetty/run-jetty ?"><y>#</y><d>2021-10-04</d><h>00:15</h><w>mister_m</w>This is what I am referring to <a href="https://github.com/ring-clojure/ring/wiki/Setup-for-development#setup-using-the-lein-ring-plugin" target="_blank">https://github.com/ring-clojure/ring/wiki/Setup-for-development#setup-using-the-lein-ring-plugin</a> - is this not necessary if I were to pass a handler reference to <code>jetty/run-jetty</code> ?</z><z id="t1633306870" t="seancorfield Correct. And just start the server yourself from your REPL."><y>#</y><d>2021-10-04</d><h>00:21</h><w>seancorfield</w>Correct. And just start the server yourself from your REPL.</z><z id="t1633306883" t="seancorfield That ring plugin is just a bad idea in my opinion."><y>#</y><d>2021-10-04</d><h>00:21</h><w>seancorfield</w>That ring plugin is just a bad idea in my opinion.</z><z id="t1633306916" t="seancorfield Take a look at this little example https://github.com/seancorfield/usermanager-example"><y>#</y><d>2021-10-04</d><h>00:21</h><w>seancorfield</w>Take a look at this little example <a href="https://github.com/seancorfield/usermanager-example" target="_blank">https://github.com/seancorfield/usermanager-example</a></z><z id="t1633306928" t="seancorfield It&apos;s REPL-friendly and avoids any plugins."><y>#</y><d>2021-10-04</d><h>00:22</h><w>seancorfield</w>It&apos;s REPL-friendly and avoids any plugins.</z><z id="t1633306957" t="mister_m I&apos;ll have a look Sean, thanks"><y>#</y><d>2021-10-04</d><h>00:22</h><w>mister_m</w>I&apos;ll have a look Sean, thanks</z><z id="t1633379989" t="mister_m For anyone interested, I found some supplementary material on Component used in Sean&apos;s example: https://www.youtube.com/watch?v=13cmHf_kt-Q (The author discussing the design and rationale behind Component)"><y>#</y><d>2021-10-04</d><h>20:39</h><w>mister_m</w>For anyone interested, I found some supplementary material on Component used in Sean&apos;s example: <a href="https://www.youtube.com/watch?v=13cmHf_kt-Q" target="_blank">https://www.youtube.com/watch?v=13cmHf_kt-Q</a> (The author discussing the design and rationale behind Component)</z><z id="t1634222709" t="Santiago I would like to store some information about a logged in user in the session. I tried doing it via a middleware, but every time I visit a new page/route, the middleware that collects user info runs again because the info from the previous session is gone. Do I need to explicitly assoc response :session session in all of my routes to keep these values around from page to page? (defn wrap-user-info [handler] (fn [request] (if (contains? (:session request) :okta-user-info) (handler request) (let [okta-user-info-res (okta-user-info request)] (info &quot;Adding user info to session&quot;) (handler (-&gt; request (assoc-in [:session :okta-user-info] okta-user-info-res)))))))"><y>#</y><d>2021-10-14</d><h>14:45</h><w>Santiago</w>I would like to store some information about a logged in user in the session. I tried doing it via a middleware, but every time I visit a new page/route, the middleware that collects user info runs again because the info from the previous session is gone. Do I need to explicitly <code>assoc response :session session</code> in all of my routes to keep these values around from page to page?
<pre>(defn wrap-user-info
  [handler]
  (fn [request]
    (if (contains? (:session request) :okta-user-info)
      (handler request)
      (let [okta-user-info-res (okta-user-info request)]
        (info &quot;Adding user info to session&quot;)
        (handler (-&gt; request
                     (assoc-in [:session :okta-user-info] okta-user-info-res)))))))</pre></z><z id="t1634228687" t="seancorfield If you have middleware in your stack to handle sessions, it should &quot;just work&quot; I think."><y>#</y><d>2021-10-14</d><h>16:24</h><w>seancorfield</w>If you have middleware in your stack to handle sessions, it should &quot;just work&quot; I think.</z><z id="t1634228766" t="seancorfield I do recall running into some issues at one point because I had middleware in the wrong order and sessions were being lost if my handler used response to generate the result. That&apos;s why ring-defaults is such a useful library: it makes sure you have (almost) everything in place in the right order."><y>#</y><d>2021-10-14</d><h>16:26</h><w>seancorfield</w>I do recall running into some issues at one point because I had middleware in the wrong order and sessions were being lost if my handler used <code>response</code> to generate the result. That&apos;s why <code>ring-defaults</code> is such a useful library: it makes sure you have (almost) everything in place in the right order.</z><z id="t1634289509" t="Santiago I do use wrap-defaults already (super nice lib indeed!) (http/run-server (-&gt; (routes lagosta-routes) wrap-user-info ; gets user info (see post above) (wrap-oauth2 okta-attrs) ; gets tokens wrap-auth ; checks if there are okta tokens in session, redirects to /login otherwise (wrap-defaults (-&gt; site-defaults (assoc-in [:session :cookie-attrs :same-site] :lax)))) {:port 3434}))) wrap-user-info is adding the info to the session, but it‚Äôs gone if I switch to another page. This works if the ‚Äúlanding page‚Äù where the user is redirected after completing oauth2 responds with (-&gt; response (assoc-in [:session] session-with-user)) -&gt; then the wrap-user-info middleware just lets the request through without adding anything. Maybe my order is indeed wrong?"><y>#</y><d>2021-10-15</d><h>09:18</h><w>Santiago</w>I do use <code>wrap-defaults</code> already (super nice lib indeed!)
<pre>(http/run-server
            (-&gt; (routes lagosta-routes)
                wrap-user-info ; gets user info (see post above)
                (wrap-oauth2 okta-attrs) ; gets tokens
                wrap-auth ; checks if there are okta tokens in session, redirects to /login otherwise
                (wrap-defaults (-&gt; site-defaults
                                   (assoc-in [:session :cookie-attrs :same-site] :lax))))
            {:port 3434})))</pre>
<code>wrap-user-info</code> is adding the info to the session, but it‚Äôs gone if I switch to another page. This works if the ‚Äúlanding page‚Äù where the user is redirected after completing oauth2 responds with
<code>(-&gt; response (assoc-in [:session] session-with-user))</code>  -&gt; then the <code>wrap-user-info</code> middleware just lets the request through without adding anything. Maybe my order is indeed wrong?</z><z id="t1635063779" t="kah0ona Hi folks, is there a reason why a lib like ring-oauth2 depends on clojure 1.7? Is it so that it‚Äôs more backwards compatible and usable in lower clojure versions? Thing is, my CIDER doesn‚Äôt like it: WARNING: Clojure version (1.7.0) is not supported (minimum 1.8.0). CIDER will not work. (More information) WARNING: CIDER requires cider-nrepl to be fully functional. Some features will not be available without it! (More information)"><y>#</y><d>2021-10-24</d><h>08:22</h><w>kah0ona</w>Hi folks, is there a reason why a lib like <code>ring-oauth2</code> depends on clojure 1.7? Is it so that it‚Äôs more backwards compatible and usable in lower clojure versions?

Thing is, my CIDER doesn‚Äôt like it:
 <code>WARNING: Clojure version (1.7.0) is not supported (minimum 1.8.0). CIDER will not work. (More information) WARNING: CIDER requires cider-nrepl to be fully functional. Some features will not be available without it! (More information)</code></z><z id="t1635685471" t="weavejester Yes, it‚Äôs so it‚Äôs compatible. By depending on an older version, we ensure that we‚Äôre not accidentally relying on features introduced in a later version."><y>#</y><d>2021-10-31</d><h>13:04</h><r>weavejester</r>Yes, it‚Äôs so it‚Äôs compatible. By depending on an older version, we ensure that we‚Äôre not accidentally relying on features introduced in a later version.</z><z id="t1635066349" t="kah0ona Other than that, I created a https://github.com/weavejester/ring-oauth2/pull/45 üôÇ"><y>#</y><d>2021-10-24</d><h>09:05</h><w>kah0ona</w>Other than that, I created a <a href="https://github.com/weavejester/ring-oauth2/pull/45" target="_blank">https://github.com/weavejester/ring-oauth2/pull/45</a>  <b>üôÇ</b></z><z id="t1635854536" t="wombawomba I&apos;m rewriting an app with synchronous handlers to be async, and I don&apos;t want to have to rewrite all my endpoint handlers to be async. Is there an async-&gt;sync middleware somewhere that I can put at the top of my middleware stack to handle this?"><y>#</y><d>2021-11-02</d><h>12:02</h><w>wombawomba</w>I&apos;m rewriting an app with synchronous handlers to be async, and I don&apos;t want to have to rewrite all my endpoint handlers to be async. Is there an async-&gt;sync middleware somewhere that I can put at the top of my middleware stack to handle this?</z><z id="t1636002696" t="Ben Sless It&apos;s a bit difficult to know which happen before and which happen after the handler without some analysis. If you do know then you can write a &quot;translator&quot;"><y>#</y><d>2021-11-04</d><h>05:11</h><r>Ben Sless</r>It&apos;s a bit difficult to know which happen before and which happen after the handler without some analysis. If you do know then you can write a &quot;translator&quot;</z><z id="t1636154064" t="emccue [:attrs {:href &quot;/_/_/users/U15RYEQPJ&quot;}] maybe a silly question - but why are you rewriting your app to be async"><y>#</y><d>2021-11-05</d><h>23:14</h><r>emccue</r><a>@U15RYEQPJ</a> maybe a silly question - but why are you rewriting your app to be async</z><z id="t1636225302" t="emccue And then the follow up is - the model that lets you work with async code the same as sync code is the interceptor model"><y>#</y><d>2021-11-06</d><h>19:01</h><r>emccue</r>And then the follow up is - the model that lets you work with async code the same as sync code is the interceptor model</z><z id="t1636225350" t="emccue Pedestal does this, there might be some library that implements it separately, but that is the way"><y>#</y><d>2021-11-06</d><h>19:02</h><r>emccue</r>Pedestal does this, there might be some library that implements it separately, but that is the way</z><z id="t1636225459" t="emccue The other is to try a loom EAP and then see if that does enough for you"><y>#</y><d>2021-11-06</d><h>19:04</h><r>emccue</r>The other is to try a loom EAP and then see if that does enough for you</z><z id="t1636225510" t="emccue Then hope/cope"><y>#</y><d>2021-11-06</d><h>19:05</h><r>emccue</r>Then hope/cope</z><z id="t1636225572" t="emccue Because making an async-&gt;sync middleware would probably negate whatever benefit you hoped to get from being async otherwise"><y>#</y><d>2021-11-06</d><h>19:06</h><r>emccue</r>Because making an async-&gt;sync middleware would probably negate whatever benefit you hoped to get from being async otherwise</z><z id="t1636986985" t="wombawomba oh whoops, missed this"><y>#</y><d>2021-11-15</d><h>14:36</h><r>wombawomba</r>oh whoops, missed this</z><z id="t1636987001" t="wombawomba I went ahead and wrote an async-&gt;sync middleware, which worked"><y>#</y><d>2021-11-15</d><h>14:36</h><r>wombawomba</r>I went ahead and wrote an async-&gt;sync middleware, which worked</z><z id="t1636987022" t="wombawomba anyway, the idea is to eventually get rid of it and make everything async"><y>#</y><d>2021-11-15</d><h>14:37</h><r>wombawomba</r>anyway, the idea is to eventually get rid of it and make everything async</z><z id="t1636987114" t="wombawomba the main point in making things async would be to prevent requests from hogging threads"><y>#</y><d>2021-11-15</d><h>14:38</h><r>wombawomba</r>the main point in making things async would be to prevent requests from hogging threads</z><z id="t1637072457" t="emccue [:attrs {:href &quot;/_/_/users/U15RYEQPJ&quot;}] https://openjdk.java.net/jeps/8277131"><y>#</y><d>2021-11-16</d><h>14:20</h><r>emccue</r><a>@U15RYEQPJ</a> <a href="https://openjdk.java.net/jeps/8277131" target="_blank">https://openjdk.java.net/jeps/8277131</a></z><z id="t1637072511" t="wombawomba oh, cool"><y>#</y><d>2021-11-16</d><h>14:21</h><r>wombawomba</r>oh, cool</z><z id="t1637072568" t="wombawomba not sure when that feature will land though?"><y>#</y><d>2021-11-16</d><h>14:22</h><r>wombawomba</r>not sure when that feature will land though?</z><z id="t1637072580" t="wombawomba also, it seems like I&apos;d have to wait for my webserver (Jetty) to support it"><y>#</y><d>2021-11-16</d><h>14:23</h><r>wombawomba</r>also, it seems like I&apos;d have to wait for my webserver (Jetty) to support it</z><z id="t1637072604" t="emccue It will preview in 18 or 19. Thats March or September."><y>#</y><d>2021-11-16</d><h>14:23</h><r>emccue</r>It will preview in 18 or 19. Thats March or September.</z><z id="t1637072611" t="emccue &gt; A preview feature is a new feature whose design, specification, and implementation are complete, but which is not permanent, which means that the feature may exist in a different form or not at all in future JDK release"><y>#</y><d>2021-11-16</d><h>14:23</h><r>emccue</r>&gt; A preview feature is a new feature whose design, specification, and implementation are complete, but which is not permanent, which means that the feature may exist in a different form or not at all in future JDK release</z><z id="t1637072676" t="emccue and you can already use it with jetty"><y>#</y><d>2021-11-16</d><h>14:24</h><r>emccue</r>and you can already use it with jetty</z><z id="t1637072731" t="emccue https://webtide.com/do-looms-claims-stack-up-part-2/ https://github.com/eclipse/jetty.project/issues/5078"><y>#</y><d>2021-11-16</d><h>14:25</h><r>emccue</r><a href="https://webtide.com/do-looms-claims-stack-up-part-2/" target="_blank">https://webtide.com/do-looms-claims-stack-up-part-2/</a>
<a href="https://github.com/eclipse/jetty.project/issues/5078" target="_blank">https://github.com/eclipse/jetty.project/issues/5078</a></z><z id="t1637085469" t="wombawomba oh, neat"><y>#</y><d>2021-11-16</d><h>17:57</h><r>wombawomba</r>oh, neat</z><z id="t1635968997" t="hiredman https://github.com/pedestal/pedestal/tree/master/interceptor might be useful to look at, there might be such a function actually in there somewhere, but it also might just be useful for inspiration, because it is about structuring a sort of async request processing pipeline while supporting ring style hanlders"><y>#</y><d>2021-11-03</d><h>19:49</h><w>hiredman</w><a href="https://github.com/pedestal/pedestal/tree/master/interceptor" target="_blank">https://github.com/pedestal/pedestal/tree/master/interceptor</a> might be useful to look at, there might be such a function actually in there somewhere, but it also might just be useful for inspiration, because it is about structuring a sort of async request processing pipeline while supporting ring style hanlders</z><z id="t1636109761" t="Christian Pekeler Hi, what do you use for asset pipeline these days? Is stefon still the standard choice?"><y>#</y><d>2021-11-05</d><h>10:56</h><w>Christian Pekeler</w>Hi, what do you use for asset pipeline these days? Is stefon still the standard choice?</z><z id="t1636114833" t="Viktor Haven‚Äôt used that one, but at https://medino.com we use https://github.com/magnars/optimus which works pretty well!"><y>#</y><d>2021-11-05</d><h>12:20</h><r>Viktor</r>Haven‚Äôt used that one, but at <a href="https://medino.com" target="_blank">https://medino.com</a> we use <a href="https://github.com/magnars/optimus" target="_blank">https://github.com/magnars/optimus</a> which works pretty well!</z><z id="t1636117893" t="Viktor downside is that it doesn‚Äôt support ES6 and I haven‚Äôt figured out how to make it do that"><y>#</y><d>2021-11-05</d><h>13:11</h><r>Viktor</r>downside is that it doesn‚Äôt support ES6 and I haven‚Äôt figured out how to make it do that</z><z id="t1637210369" t="pip hey, i‚Äôm trying to figure out why the csrf token that‚Äôs returned in the header of a request in my app stopped matching the one in [:session :ring.middleware.anti-forgery/anti-forgery-token]. it‚Äôs my understanding that ring-anti-forgery checks against the session map with the token embedded in the html and returned to server in a request (using the luminus template). any idea why it would be different? using buddy for sessions"><y>#</y><d>2021-11-18</d><h>04:39</h><w>pip</w>hey, i‚Äôm trying to figure out why the csrf token that‚Äôs returned in the header of a request in my app stopped matching the one in  [:session :ring.middleware.anti-forgery/anti-forgery-token]. it‚Äôs my understanding that ring-anti-forgery checks against the session map with the token embedded in the html and returned to server in a request (using the luminus template). any idea why it would be different? using buddy for sessions</z><z id="t1638774529" t="Akiz Maybe some middleware is interfering?"><y>#</y><d>2021-12-06</d><h>07:08</h><r>Akiz</r>Maybe some middleware is interfering?</z><z id="t1637940551" t="popeye Team, Why do we want to wrap-gzip https://github.com/bertrandk/ring-gzip ?"><y>#</y><d>2021-11-26</d><h>15:29</h><w>popeye</w>Team, Why do we want to <code>wrap-gzip</code> <a href="https://github.com/bertrandk/ring-gzip" target="_blank">https://github.com/bertrandk/ring-gzip</a> ?</z><z id="t1637942619" t="Ben Sless Smaller payloads"><y>#</y><d>2021-11-26</d><h>16:03</h><r>Ben Sless</r>Smaller payloads</z><z id="t1637942664" t="Ben Sless Could be beneficial when you&apos;re sending big responses or where paying for network traffic begins to impact your bottom line"><y>#</y><d>2021-11-26</d><h>16:04</h><r>Ben Sless</r>Could be beneficial when you&apos;re sending big responses or where paying for network traffic begins to impact your bottom line</z><z id="t1637944903" t="popeye Does that unzip somewhere?"><y>#</y><d>2021-11-26</d><h>16:41</h><r>popeye</r>Does that unzip somewhere?</z><z id="t1637944912" t="popeye I&apos;m later stage? Or does that need to be unzip?"><y>#</y><d>2021-11-26</d><h>16:41</h><r>popeye</r>I&apos;m later stage? Or does that need to be unzip?</z><z id="t1637947789" t="Ben Sless The receiver needs to unzip the response"><y>#</y><d>2021-11-26</d><h>17:29</h><r>Ben Sless</r>The receiver needs to unzip the response</z><z id="t1637947795" t="Ben Sless If they request it zipped, they can get it zipped"><y>#</y><d>2021-11-26</d><h>17:29</h><r>Ben Sless</r>If they request it zipped, they can get it zipped</z><z id="t1637947987" t="popeye i am just understanding my project and this was used in the (mount/defstate :start (wrap-gzip....)) , what happens if we use it in defstate? any idea?"><y>#</y><d>2021-11-26</d><h>17:33</h><r>popeye</r>i am just understanding my project and this was used in the <code>(mount/defstate :start  (wrap-gzip....))</code> , what happens if we use it in defstate? any idea?</z><z id="t1637948075" t="Ben Sless Clients will get a gzipped response"><y>#</y><d>2021-11-26</d><h>17:34</h><r>Ben Sless</r>Clients will get a gzipped response</z><z id="t1637948396" t="popeye what is the function to unzip it?"><y>#</y><d>2021-11-26</d><h>17:39</h><r>popeye</r>what is the function to unzip it?</z><z id="t1637961760" t="Ben Sless You&apos;ll need to deflate the gzip stream on the client side"><y>#</y><d>2021-11-26</d><h>21:22</h><r>Ben Sless</r>You&apos;ll need to deflate the gzip stream on the client side</z><z id="t1639728845" t="Franklin any word on how the log4j vulnerability is being handled?"><y>#</y><d>2021-12-17</d><h>08:14</h><w>Franklin</w>any word on how the log4j vulnerability is being handled?</z><z id="t1639728882" t="Franklin https://jfrog.com/blog/log4shell-0-day-vulnerability-all-you-need-to-know/"><y>#</y><d>2021-12-17</d><h>08:14</h><r>Franklin</r><a href="https://jfrog.com/blog/log4shell-0-day-vulnerability-all-you-need-to-know/" target="_blank">https://jfrog.com/blog/log4shell-0-day-vulnerability-all-you-need-to-know/</a></z><z id="t1639740197" t="magnars Does Ring depend on log4j?"><y>#</y><d>2021-12-17</d><h>11:23</h><r>magnars</r>Does Ring depend on log4j?</z><z id="t1639743014" t="Franklin [:attrs {:href &quot;/_/_/users/U07FCNURX&quot;}] I&apos;m not certain, but ring depends on Jetty and jetty depends on log4j"><y>#</y><d>2021-12-17</d><h>12:10</h><r>Franklin</r><a>@U07FCNURX</a> I&apos;m not certain, but ring depends on Jetty and jetty depends on log4j</z><z id="t1639743114" t="Franklin whenever I start my ring server I get these warnings, which have led me to think it depends on log4j log4j:WARN No appenders could be found for logger (org.eclipse.jetty.util.log). log4j:WARN Please initialize the log4j system properly. log4j:WARN See for more in"><y>#</y><d>2021-12-17</d><h>12:11</h><r>Franklin</r>whenever I start my ring server I get these warnings, which have led me to think it depends on log4j
<pre>log4j:WARN No appenders could be found for logger (org.eclipse.jetty.util.log).
log4j:WARN Please initialize the log4j system properly.
log4j:WARN See  for more in</pre></z><z id="t1639743312" t="magnars Running lein deps :tree on my project, it does not list log4j under jetty. From what I can understand, jetty uses slf4j."><y>#</y><d>2021-12-17</d><h>12:15</h><r>magnars</r>Running <code>lein deps :tree</code> on my project, it does not list log4j under jetty. From what I can understand, jetty uses slf4j.</z><z id="t1639746154" t="Franklin thanks... lein deps :tree helped me identify who&apos;s bringing in log4j"><y>#</y><d>2021-12-17</d><h>13:02</h><r>Franklin</r>thanks... <code>lein deps :tree</code> helped me identify who&apos;s bringing in log4j</z><z id="t1639746320" t="magnars Excellent üôÇ glad to help!"><y>#</y><d>2021-12-17</d><h>13:05</h><r>magnars</r>Excellent <b>üôÇ</b> glad to help!</z><z id="t1639753547" t="Franklin [:attrs {:href &quot;/_/_/users/U07FCNURX&quot;}] I also noticed that s https://github.com/qos-ch/slf4j/blob/master/slf4j-log4j12/pom.xml , could that be a problem?"><y>#</y><d>2021-12-17</d><h>15:05</h><r>Franklin</r><a>@U07FCNURX</a> I also noticed that s<a href="https://github.com/qos-ch/slf4j/blob/master/slf4j-log4j12/pom.xml" target="_blank">https://github.com/qos-ch/slf4j/blob/master/slf4j-log4j12/pom.xml</a>, could that be a problem?</z><z id="t1639759461" t="emccue slf4j doesnt, sl4fj-log4j does"><y>#</y><d>2021-12-17</d><h>16:44</h><r>emccue</r>slf4j doesnt, sl4fj-log4j does</z><z id="t1639802324" t="Franklin how do I install slf4j without a dependency on log4j?"><y>#</y><d>2021-12-18</d><h>04:38</h><r>Franklin</r>how do I install slf4j without a dependency on log4j?</z><z id="t1639802341" t="Franklin can&apos;t seem to find one that does not use log4j"><y>#</y><d>2021-12-18</d><h>04:39</h><r>Franklin</r>can&apos;t seem to find one that does not use log4j</z><z id="t1639803113" t="weavejester slf4j-jdk14 uses Java‚Äôs logging system"><y>#</y><d>2021-12-18</d><h>04:51</h><r>weavejester</r>slf4j-jdk14 uses Java‚Äôs logging system</z><z id="t1639803281" t="weavejester You could also use log4j 2.16 which (may?) be safe now."><y>#</y><d>2021-12-18</d><h>04:54</h><r>weavejester</r>You could also use log4j 2.16 which (may?) be safe now.</z><z id="t1639803377" t="weavejester But as mentioned, Ring has no dependency on Log4J."><y>#</y><d>2021-12-18</d><h>04:56</h><r>weavejester</r>But as mentioned, Ring has no dependency on Log4J.</z><z id="t1639804001" t="Franklin [:attrs {:href &quot;/_/_/users/U0BKWMG5B&quot;}] is there any recommended middleware for logging?"><y>#</y><d>2021-12-18</d><h>05:06</h><r>Franklin</r><a>@U0BKWMG5B</a> is there any recommended middleware for logging?</z><z id="t1639804027" t="Franklin one which logs requests in their final state? with response status codes"><y>#</y><d>2021-12-18</d><h>05:07</h><r>Franklin</r>one which logs requests in their final state? with response status codes</z><z id="t1641764621" t="thumbnail Hey! I&apos;m looking into sessions with ring, and can&apos;t get the cookie and session middleware to play nice together. Especially when using a custom cookie encoder/decoder. The session middleware will set the :cookies -key preventing the cookie middleware from decoding the cookies. If I switch the session / cookies middleware around the cookies are decoded properly, but the session cookie won&apos;t be read using the correct encoder/decoder. I believe this is because the session-middleware calls the cookies/cookies-request and cookies/cookies-response functions instead of relying on the stack to do these calls. Should I change my approach? If so; how should I do it ?"><y>#</y><d>2022-01-09</d><h>21:43</h><w>thumbnail</w>Hey! I&apos;m looking into sessions with ring, and can&apos;t get the cookie and session middleware to play nice together. Especially when using a custom cookie encoder/decoder.

The session middleware will set the <code>:cookies</code>-key preventing the cookie middleware from decoding the cookies. If I switch the session / cookies middleware around the cookies are decoded properly, but the session cookie won&apos;t be read using the correct encoder/decoder.

I believe this is because the session-middleware calls the <code>cookies/cookies-request</code> and <code>cookies/cookies-response</code> functions instead of relying on the stack to do these calls.

Should I change my approach? If so; how should I do it ?</z><z id="t1641765421" t="thumbnail Removing the direct calls to the cookies -middleware in the sessions-middleware results in the intented behaviour; Which is both the session and the &apos;other&apos; cookies being encoded and decoded using the setup encoder and decoder."><y>#</y><d>2022-01-09</d><h>21:57</h><r>thumbnail</r>Removing the direct calls to the <code>cookies</code>-middleware in the sessions-middleware results in the intented behaviour;

Which is both the session and the &apos;other&apos; cookies being encoded and decoded using the setup encoder and decoder.</z><z id="t1642006046" t="weavejester Can you open an issue for this? It looks like an interaction that wasn‚Äôt considered."><y>#</y><d>2022-01-12</d><h>16:47</h><r>weavejester</r>Can you open an issue for this? It looks like an interaction that wasn‚Äôt considered.</z><z id="t1642498540" t="thumbnail Sorry for the delay, but the issue has been filed üôÇ https://github.com/ring-clojure/ring/issues/456 including a repro"><y>#</y><d>2022-01-18</d><h>09:35</h><r>thumbnail</r>Sorry for the delay, but the issue has been filed <b>üôÇ</b> <a href="https://github.com/ring-clojure/ring/issues/456" target="_blank">https://github.com/ring-clojure/ring/issues/456</a> including a repro</z><z id="t1642447934" t="R.A. Porter ~I&apos;m seeing an error when upgrading to ~ üßµ Edit: it&apos;s custom library code. Ignore me."><y>#</y><d>2022-01-17</d><h>19:32</h><w>R.A. Porter</w>~I&apos;m seeing an error when upgrading to ~ <b>üßµ</b>
Edit: it&apos;s custom library code. Ignore me.</z><z id="t1642448025" t="R.A. Porter I can update all of my app&apos;s ring dependencies from 1.9.4 -&gt; 1.9.5 except for ring/core . The exception I&apos;m seeing is... java.lang.Thread.run Thread.java: 829 org.eclipse.jetty.util.thread.QueuedThreadPool$Runner.run QueuedThreadPool.java: 1034 org.eclipse.jetty.util.thread.QueuedThreadPool.runJob QueuedThreadPool.java: 883 org.eclipse.jetty.io.ChannelEndPoint$1.run ChannelEndPoint.java: 104 org.eclipse.jetty.io.FillInterest.fillable FillInterest.java: 105 org.eclipse.jetty.io.AbstractConnection$ReadCallback.succeeded AbstractConnection.java: 311 org.eclipse.jetty.server.HttpConnection.onFillable HttpConnection.java: 277 org.eclipse.jetty.server.HttpChannel.handle HttpChannel.java: 392 org.eclipse.jetty.server.HttpChannel.dispatch HttpChannel.java: 645 org.eclipse.jetty.server.HttpChannel.lambda$handle$1 HttpChannel.java: 400 org.eclipse.jetty.server.Server.handle Server.java: 516 org.eclipse.jetty.server.handler.HandlerWrapper.handle HandlerWrapper.java: 127 ring.adapter.jetty.proxy$org.eclipse.jetty.server.handler.AbstractHandler$ff19274a.handle ring.adapter.jetty/proxy-handler/fn jetty.clj: 28 ring.util.servlet/update-servlet-response servlet.clj: 98 ring.util.servlet/update-servlet-response servlet.clj: 109 ring.core.protocols/eval4577/fn/G protocols.clj: 8 clojure.core/-cache-protocol-fn core_deftype.clj: 583 java.lang.IllegalArgumentException: No implementation of method: :write-body-to-stream of protocol: #&apos;ring.core.protocols/StreamableResponseBody found for class: clj_elastic_apm.support$deferred_transaction_body$reify__8493"><y>#</y><d>2022-01-17</d><h>19:33</h><r>R.A. Porter</r>I can update all of my app&apos;s ring dependencies from <code>1.9.4</code> -&gt; <code>1.9.5</code> except for <code>ring/core</code>. The exception I&apos;m seeing is...

<pre>java.lang.Thread.run              Thread.java:  829
                                org.eclipse.jetty.util.thread.QueuedThreadPool$Runner.run    QueuedThreadPool.java: 1034
                                    org.eclipse.jetty.util.thread.QueuedThreadPool.runJob    QueuedThreadPool.java:  883
                                               org.eclipse.jetty.io.ChannelEndPoint$1.run     ChannelEndPoint.java:  104
                                               org.eclipse.jetty.io.FillInterest.fillable        FillInterest.java:  105
                           org.eclipse.jetty.io.AbstractConnection$ReadCallback.succeeded  AbstractConnection.java:  311
                                       org.eclipse.jetty.server.HttpConnection.onFillable      HttpConnection.java:  277
                                              org.eclipse.jetty.server.HttpChannel.handle         HttpChannel.java:  392
                                            org.eclipse.jetty.server.HttpChannel.dispatch         HttpChannel.java:  645
                                     org.eclipse.jetty.server.HttpChannel.lambda$handle$1         HttpChannel.java:  400
                                                   org.eclipse.jetty.server.Server.handle              Server.java:  516
                                   org.eclipse.jetty.server.handler.HandlerWrapper.handle      HandlerWrapper.java:  127
ring.adapter.jetty.proxy$org.eclipse.jetty.server.handler.AbstractHandler$ff19274a.handle
                                                      ring.adapter.jetty/proxy-handler/fn                jetty.clj:   28
                                                ring.util.servlet/update-servlet-response              servlet.clj:   98
                                                ring.util.servlet/update-servlet-response              servlet.clj:  109
                                                        ring.core.protocols/eval4577/fn/G            protocols.clj:    8
                                                          clojure.core/-cache-protocol-fn         core_deftype.clj:  583
java.lang.IllegalArgumentException: No implementation of method: :write-body-to-stream of protocol: #&apos;ring.core.protocols/StreamableResponseBody found for class: clj_elastic_apm.support$deferred_transaction_body$reify__8493</pre></z><z id="t1642448059" t="R.A. Porter As I said, other than determining that it is just the ring/core dependency that&apos;s giving me the issue, I haven&apos;t tracked down the problem yet."><y>#</y><d>2022-01-17</d><h>19:34</h><r>R.A. Porter</r>As I said, other than determining that it is just the <code>ring/core</code> dependency that&apos;s giving me the issue, I haven&apos;t tracked down the problem yet.</z><z id="t1642449303" t="R.A. Porter I&apos;m starting to think it&apos;s a problem with one of my team&apos;s custom libraries. Looking a bit more."><y>#</y><d>2022-01-17</d><h>19:55</h><r>R.A. Porter</r>I&apos;m starting to think it&apos;s a problem with one of my team&apos;s custom libraries. Looking a bit more.</z><z id="t1642510139" t="Mutasem Hidmi Hi guys. Is it possible to add websocket support to a ring webserver?"><y>#</y><d>2022-01-18</d><h>12:48</h><w>Mutasem Hidmi</w>Hi guys. Is it possible to add websocket support to a ring webserver?</z><z id="t1642510476" t="magnars Might be, but I&apos;ve usually switched to http-kit when needing websockets or server sent events. It is pretty much a drop-in replacement."><y>#</y><d>2022-01-18</d><h>12:54</h><r>magnars</r>Might be, but I&apos;ve usually switched to http-kit when needing websockets or server sent events. It is pretty much a drop-in replacement.</z><z id="t1642510862" t="dharrigan Yes, it&apos;s very possible."><y>#</y><d>2022-01-18</d><h>13:01</h><r>dharrigan</r>Yes, it&apos;s very possible.</z><z id="t1642510873" t="dharrigan Have a look at sente as a possible library to consider"><y>#</y><d>2022-01-18</d><h>13:01</h><r>dharrigan</r>Have a look at <code>sente</code> as a possible library to consider</z><z id="t1642510884" t="dharrigan Or, yes, http-kit will work too üôÇ"><y>#</y><d>2022-01-18</d><h>13:01</h><r>dharrigan</r>Or, yes, http-kit will work too <b>üôÇ</b></z><z id="t1642510928" t="dharrigan I put up an example of using sente with reitit (that uses ring underneath) here: "><y>#</y><d>2022-01-18</d><h>13:02</h><r>dharrigan</r>I put up an example of using sente with reitit (that uses ring underneath) here: <code></code></z><z id="t1642510942" t="dharrigan along with using a plain-old-javascript websockets invocation here: "><y>#</y><d>2022-01-18</d><h>13:02</h><r>dharrigan</r>along with using a plain-old-javascript <code>websockets</code> invocation here: <code></code></z><z id="t1642511051" t="Mutasem Hidmi Thanks. I will take a look now."><y>#</y><d>2022-01-18</d><h>13:04</h><r>Mutasem Hidmi</r>Thanks. I will take a look now.</z><z id="t1643682559" t="bherrmann Is there any handy way to suppress this Jetty output (Logging initialized) ? $ cat deps.edn {:deps { ring/ring-core {:mvn/version &quot;1.8.2&quot;} ring/ring-jetty-adapter {:mvn/version &quot;1.8.2&quot;}} } $ cat src/holy.clj (ns holy (:require [ring.adapter.jetty])) (defn -main [ &amp; args ] (println &quot;I dont do much&quot;) ) $ clj -M -m holy 2022-01-31 21:27:15.648:INFO::main: Logging initialized @1064ms to org.eclipse.jetty.util.log.StdErrLog I dont do much"><y>#</y><d>2022-02-01</d><h>02:29</h><w>bherrmann</w>Is there any handy way to suppress this Jetty output (Logging initialized) ?
<pre>$ cat deps.edn 
{:deps {
  ring/ring-core {:mvn/version &quot;1.8.2&quot;}
  ring/ring-jetty-adapter {:mvn/version &quot;1.8.2&quot;}}
}
$ cat src/holy.clj
(ns holy
  (:require [ring.adapter.jetty]))

(defn -main [ &amp; args ]
  (println &quot;I dont do much&quot;)
  )
$ clj -M -m holy
2022-01-31 21:27:15.648:INFO::main: Logging initialized @1064ms to org.eclipse.jetty.util.log.StdErrLog
I dont do much</pre></z><z id="t1643684562" t="salam have you tried this? https://stackoverflow.com/questions/51978990/how-to-suppress-logging-output-to-stdout-when-using-jetty-websocket-client#51979135"><y>#</y><d>2022-02-01</d><h>03:02</h><r>salam</r>have you tried this? <a href="https://stackoverflow.com/questions/51978990/how-to-suppress-logging-output-to-stdout-when-using-jetty-websocket-client#51979135" target="_blank">https://stackoverflow.com/questions/51978990/how-to-suppress-logging-output-to-stdout-when-using-jetty-websocket-client#51979135</a></z><z id="t1643684832" t="seancorfield [:attrs {:href &quot;/_/_/users/UDCGPTV9R&quot;}] ‚Äôs suggestion looks good [:attrs {:href &quot;/_/_/users/U0502D2GL&quot;}] : {:tag :a, :attrs {:href &quot;/cdn-cgi/l/email-protection&quot;, :class &quot;__cf_email__&quot;, :data-cfemail &quot;66150307080526350307084b110f084b57574b0a0716120916&quot;}, :content (&quot;[email¬†protected]&quot;)}"><y>#</y><d>2022-02-01</d><h>03:07</h><r>seancorfield</r><a>@abdusalam</a>‚Äôs suggestion looks good <a>@bherrmann</a>:
<pre>{:tag :a, :attrs {:href &quot;/cdn-cgi/l/email-protection&quot;, :class &quot;__cf_email__&quot;, :data-cfemail &quot;66150307080526350307084b110f084b57574b0a0716120916&quot;}, :content (&quot;[email¬†protected]&quot;)}</pre></z><z id="t1643683418" t="bherrmann I tried this, but it seemed to have no effect, $ cat src/jetty-logging.properties org.eclipse.jetty.util.log.class=org.eclipse.jetty.util.log.StdErrLog org.eclipse.jetty.LEVEL=WARN"><y>#</y><d>2022-02-01</d><h>02:43</h><w>bherrmann</w>I tried this, but it seemed to have no effect,
<pre>$ cat src/jetty-logging.properties 
org.eclipse.jetty.util.log.class=org.eclipse.jetty.util.log.StdErrLog
org.eclipse.jetty.LEVEL=WARN</pre></z><z id="t1643683812" t="bherrmann I also tried, $ clj -J-Dorg.eclipse.jetty.http.LEVEL=OFF -M -m holy 2022-01-31 21:49:52.199:INFO::main: Logging initialized @1078ms to org.eclipse.jetty.util.log.StdErrLog I dont do much"><y>#</y><d>2022-02-01</d><h>02:50</h><w>bherrmann</w>I also tried,
<pre>$ clj -J-Dorg.eclipse.jetty.http.LEVEL=OFF -M -m holy
2022-01-31 21:49:52.199:INFO::main: Logging initialized @1078ms to org.eclipse.jetty.util.log.StdErrLog
I dont do much</pre></z><z id="t1643684832" t="seancorfield [:attrs {:href &quot;/_/_/users/UDCGPTV9R&quot;}] ‚Äôs suggestion looks good [:attrs {:href &quot;/_/_/users/U0502D2GL&quot;}] : {:tag :a, :attrs {:href &quot;/cdn-cgi/l/email-protection&quot;, :class &quot;__cf_email__&quot;, :data-cfemail &quot;becddbdfd0ddfeeddbdfd093c9d7d0938f8f93d2dfcecad1ce&quot;}, :content (&quot;[email¬†protected]&quot;)}"><y>#</y><d>2022-02-01</d><h>03:07</h><w>seancorfield</w><a>@abdusalam</a>‚Äôs suggestion looks good <a>@bherrmann</a>:
<pre>{:tag :a, :attrs {:href &quot;/cdn-cgi/l/email-protection&quot;, :class &quot;__cf_email__&quot;, :data-cfemail &quot;becddbdfd0ddfeeddbdfd093c9d7d0938f8f93d2dfcecad1ce&quot;}, :content (&quot;[email¬†protected]&quot;)}</pre></z><z id="t1643718651" t="bherrmann [:attrs {:href &quot;/_/_/users/U04V70XH6&quot;}] [:attrs {:href &quot;/_/_/users/UDCGPTV9R&quot;}] Thanks!!! I appreciate it! My program only sometimes starts a web server, so having it always log this message was irritating. I burned at least an hour on this."><y>#</y><d>2022-02-01</d><h>12:30</h><w>bherrmann</w><a>@seancorfield</a> <a>@abdusalam</a> Thanks!!!  I appreciate it!  My program only sometimes starts a web server, so having it always log this message was irritating.  I burned at least an hour on this.</z><z id="t1643898941" t="Franklin Hello üëã I&apos;m trying to get jetty to be a little more silent on logging"><y>#</y><d>2022-02-03</d><h>14:35</h><w>Franklin</w>Hello <b>üëã</b>
I&apos;m trying to get jetty to be a little more silent on logging</z><z id="t1643898953" t="Franklin currently logs look like this 2022-02-03T14:34:43.808Z apiyo-ThinkPad-T14s-Gen-1 DEBUG [org.eclipse.jetty.io.ManagedSelector:558] - updateable 0 2022-02-03T14:34:43.808Z apiyo-ThinkPad-T14s-Gen-1 DEBUG [org.eclipse.jetty.io.ManagedSelector:558] - updateable 0 2022-02-03T14:34:43.808Z apiyo-ThinkPad-T14s-Gen-1 DEBUG [org.eclipse.jetty.io.ManagedSelector:587] - updates 1 2022-02-03T14:34:43.808Z apiyo-ThinkPad-T14s-Gen-1 DEBUG [org.eclipse.jetty.io.ManagedSelector:587] - updates 1 2022-02-03T14:34:43.808Z apiyo-ThinkPad-T14s-Gen-1 DEBUG [org.eclipse.jetty.io.ManagedSelector:592] - wakeup on updates "><y>#</y><d>2022-02-03</d><h>14:35</h><r>Franklin</r>currently logs look like this
<pre>2022-02-03T14:34:43.808Z apiyo-ThinkPad-T14s-Gen-1 DEBUG [org.eclipse.jetty.io.ManagedSelector:558] - updateable 0
2022-02-03T14:34:43.808Z apiyo-ThinkPad-T14s-Gen-1 DEBUG [org.eclipse.jetty.io.ManagedSelector:558] - updateable 0
2022-02-03T14:34:43.808Z apiyo-ThinkPad-T14s-Gen-1 DEBUG [org.eclipse.jetty.io.ManagedSelector:587] - updates 1
2022-02-03T14:34:43.808Z apiyo-ThinkPad-T14s-Gen-1 DEBUG [org.eclipse.jetty.io.ManagedSelector:587] - updates 1
2022-02-03T14:34:43.808Z apiyo-ThinkPad-T14s-Gen-1 DEBUG [org.eclipse.jetty.io.ManagedSelector:592] - wakeup on updates </pre></z><z id="t1643898957" t="Franklin lots of debug"><y>#</y><d>2022-02-03</d><h>14:35</h><r>Franklin</r>lots of debug</z><z id="t1643898984" t="Franklin I have tried changing the * resources/jetty-logging.properties`* file to look as follows"><y>#</y><d>2022-02-03</d><h>14:36</h><w>Franklin</w>I have tried changing the <code>*</code>resources/jetty-logging.properties`*  file to look as follows</z><z id="t1643898995" t="Franklin org.eclipse.jetty.util.log.announce=false org.eclipse.jetty.LEVEL=INFO org.eclipse.jetty.websocket.LEVEL=INFO"><y>#</y><d>2022-02-03</d><h>14:36</h><r>Franklin</r><pre>org.eclipse.jetty.util.log.announce=false
org.eclipse.jetty.LEVEL=INFO
org.eclipse.jetty.websocket.LEVEL=INFO</pre></z><z id="t1643899013" t="Franklin I&apos;ve also added this to my project.clj :jvm-opts ^:replace [&quot;-Xmx1g&quot; &quot;-Djava.awt.headless=true&quot; &quot;-Dorg.eclipse.jetty.util.log.announce=false&quot; &quot;-Dorg.eclipse.jetty.LEVEL=INFO&quot;]"><y>#</y><d>2022-02-03</d><h>14:36</h><r>Franklin</r>I&apos;ve also added this to my <code>project.clj</code>
<pre>:jvm-opts ^:replace [&quot;-Xmx1g&quot; &quot;-Djava.awt.headless=true&quot;
                       &quot;-Dorg.eclipse.jetty.util.log.announce=false&quot;
                       &quot;-Dorg.eclipse.jetty.LEVEL=INFO&quot;]</pre></z><z id="t1643899025" t="Franklin not certain why neither works"><y>#</y><d>2022-02-03</d><h>14:37</h><r>Franklin</r>not certain why neither works</z><z id="t1643899041" t="Franklin I&apos;ve seen that&apos;s what the documentation recommends here https://docs.huihoo.com/jetty/the-definitive-reference/configuring-logging.html"><y>#</y><d>2022-02-03</d><h>14:37</h><r>Franklin</r>I&apos;ve seen that&apos;s what the documentation recommends here <a href="https://docs.huihoo.com/jetty/the-definitive-reference/configuring-logging.html" target="_blank">https://docs.huihoo.com/jetty/the-definitive-reference/configuring-logging.html</a></z><z id="t1643899071" t="Franklin I&apos;ll appreciate any pointers on where to look, thanks"><y>#</y><d>2022-02-03</d><h>14:37</h><w>Franklin</w>I&apos;ll appreciate any pointers on where to look, thanks</z><z id="t1644278190" t="bherrmann I was trying to supress just the announce message, and I found this worked for me clojure -J-Dorg.eclipse.jetty.util.log.announce=false -M -m explainer"><y>#</y><d>2022-02-07</d><h>23:56</h><w>bherrmann</w>I was trying to supress just the announce message, and I found this worked for me
<pre>clojure -J-Dorg.eclipse.jetty.util.log.announce=false -M -m explainer</pre></z><z id="t1645622572" t="fadrian I&apos;ve set up a primitive ring server with the following routes: (defn translate [json] &quot;Translated JSON&quot;) (defn process-translate [req] (println req) (if-let [body (:body req)] {:status 200 :headers {&quot;Content-Type&quot; &quot;application/text&quot; &quot;Character-Encoding&quot; &quot;utf8&quot;} :body (translate body)} (default-malformed-response))) (defroutes mercator-server (GET &quot;/&quot; [] &quot;mercator-server version 0.0.1&quot;) (POST &quot;/translate&quot; req (process-translate req)) (POST &quot;/translate/&quot; req (process-translate req))) When I pass in a well-formed JSON body, the request returns 200 and the expected body text. However, when I pass in a malformed JSON body, rather than returning the expected 400 status, I keep getting a 404 from the server. I&apos;m using the wrap-json-body middleware, so a malformed json body should return a nil from (:body req), but somehow, ring seems to bounce the request back with a 404 before it even gets to the process-translate call. How do I get the handler to return a 400 status?"><y>#</y><d>2022-02-23</d><h>13:22</h><w>fadrian</w>I&apos;ve set up a primitive ring server with the following routes:
<pre>(defn translate
  [json]
  &quot;Translated JSON&quot;)

(defn process-translate
  [req]
  (println req)
  (if-let [body (:body req)]
    {:status 200 :headers {&quot;Content-Type&quot; &quot;application/text&quot; &quot;Character-Encoding&quot; &quot;utf8&quot;} :body (translate body)}
    (default-malformed-response)))

(defroutes mercator-server
  (GET &quot;/&quot; [] &quot;mercator-server version 0.0.1&quot;)
  (POST &quot;/translate&quot; req (process-translate req))
  (POST &quot;/translate/&quot; req (process-translate req)))</pre>
When I pass in a well-formed JSON body, the request returns 200 and the expected body text. However, when I pass in a malformed JSON body, rather than returning the expected 400 status, I keep getting a 404 from the server. I&apos;m using the wrap-json-body middleware, so a malformed json body should return a nil from (:body req), but somehow, ring seems to bounce the request back with a 404 before it even gets to the process-translate call. How do I get the handler to return a 400 status?</z><z id="t1645627112" t="jumar If you return nil from a route handler it gets translated into 404 status"><y>#</y><d>2022-02-23</d><h>14:38</h><r>jumar</r>If you return <code>nil</code> from a route handler it gets translated into 404 status</z><z id="t1645627991" t="fadrian Thanks for that, good to know. I&apos;ve now also added the :malformed-response option to my wrap-json-body middleware and made sure the handler is NOT returning nil for a bad string: (defn wrap-json-body [handler] (fn [request] (handler (json-body-request request {:keywords? true :malformed-response default-malformed-response})))) (defn translate [json] &quot;Translated JSON&quot;) (defn process-translate [req] (println &quot;In process-translate:&quot; req) (if-let [body (:body req)] {:status 200 :headers {&quot;Content-Type&quot; &quot;application/text&quot; &quot;Character-Encoding&quot; &quot;utf8&quot;} :body (translate body)} &quot;Bad body&quot;)) (defroutes mercator-server (GET &quot;/&quot; [] &quot;mercator-server version 0.0.1&quot;) (POST &quot;/translate&quot; req (process-translate req)) (POST &quot;/translate/&quot; req (process-translate req))) However, the middleware still seems to be returning a 404 status before even getting to the process-translate function."><y>#</y><d>2022-02-23</d><h>14:53</h><r>fadrian</r>Thanks for that, good to know. I&apos;ve now also added the :malformed-response option to my wrap-json-body middleware and made sure the handler is NOT returning nil for a bad string:
<pre>(defn wrap-json-body [handler]
  (fn [request]
    (handler (json-body-request request {:keywords? true :malformed-response default-malformed-response}))))

(defn translate
  [json]
  &quot;Translated JSON&quot;)

(defn process-translate
  [req]
  (println &quot;In process-translate:&quot; req)
  (if-let [body (:body req)]
    {:status 200 :headers {&quot;Content-Type&quot; &quot;application/text&quot; &quot;Character-Encoding&quot; &quot;utf8&quot;} :body (translate body)}
    &quot;Bad body&quot;))

(defroutes mercator-server
  (GET &quot;/&quot; [] &quot;mercator-server version 0.0.1&quot;)
  (POST &quot;/translate&quot; req (process-translate req))
  (POST &quot;/translate/&quot; req (process-translate req)))</pre>
However, the middleware still seems to be returning a 404 status before even getting to the process-translate function.</z><z id="t1645629052" t="fadrian I&apos;ve also read the code of wrap-json-body, and I shouldn&apos;t even have to add the :malformed-response default-malformed-response option, because the code supposedly defaults to returning that. But for some reason, it&apos;s returning a 404."><y>#</y><d>2022-02-23</d><h>15:10</h><r>fadrian</r>I&apos;ve also read the code of wrap-json-body, and I shouldn&apos;t even have to add the :malformed-response default-malformed-response option, because the code supposedly defaults to returning that. But for some reason, it&apos;s returning a 404.</z><z id="t1645629613" t="jumar [:attrs {:href &quot;/_/_/users/U0DTU8J83&quot;}] I&apos;m not sure what is this wrap-json-body in your code. We are using this standard middleware like this: https://github.com/jumarko/clojure-experiments/blob/master/src/clojure_experiments/ring/server.clj#L9-L12 (defn wrap [handler] (-&gt; handler wrap-json-response (wrap-json-body {:keywords? true}))) When you try to run this code it should work as expected: curl -i -H &apos;Content-Type: application/json&apos; -d &apos;{a}&apos; HTTP/1.1 400 Bad Request Date: Wed, 23 Feb 2022 15:16:58 GMT Content-Type: text/plain Transfer-Encoding: chunked Server: Jetty(9.4.36.v20210114) Malformed JSON in request body.% curl -i -H &apos;Content-Type: application/json&apos; -d &apos;{}&apos; HTTP/1.1 200 OK Date: Wed, 23 Feb 2022 15:18:31 GMT Content-Type: application/text Character-Encoding: utf8 Transfer-Encoding: chunked Server: Jetty(9.4.36.v20210114) Translated JSON% "><y>#</y><d>2022-02-23</d><h>15:20</h><r>jumar</r><a>@U0DTU8J83</a> I&apos;m not sure what is this <code>wrap-json-body</code> in your code.
We are using this standard middleware like this: <a href="https://github.com/jumarko/clojure-experiments/blob/master/src/clojure_experiments/ring/server.clj#L9-L12" target="_blank">https://github.com/jumarko/clojure-experiments/blob/master/src/clojure_experiments/ring/server.clj#L9-L12</a>
<pre>(defn wrap [handler]
  (-&gt; handler
      wrap-json-response
      (wrap-json-body {:keywords? true})))</pre>
When you try to run this code it should work as expected:
<pre>curl -i -H &apos;Content-Type: application/json&apos; -d &apos;{a}&apos; 

HTTP/1.1 400 Bad Request
Date: Wed, 23 Feb 2022 15:16:58 GMT
Content-Type: text/plain
Transfer-Encoding: chunked
Server: Jetty(9.4.36.v20210114)

Malformed JSON in request body.%                                                                                                                                                                                                             


curl -i -H &apos;Content-Type: application/json&apos; -d &apos;{}&apos; 

HTTP/1.1 200 OK
Date: Wed, 23 Feb 2022 15:18:31 GMT
Content-Type: application/text
Character-Encoding: utf8
Transfer-Encoding: chunked
Server: Jetty(9.4.36.v20210114)

Translated JSON% </pre>
</z><z id="t1645630132" t="fadrian Doing it that way works. I have no idea why it works when the other code didn&apos;t, but thank you for that suggestion."><y>#</y><d>2022-02-23</d><h>15:28</h><r>fadrian</r>Doing it that way works. I have no idea why it works when the other code didn&apos;t, but thank you for that suggestion.</z><z id="t1645657672" t="sova-soars-the-sora Hi I want to use ring&apos;s mock request to test a program/service/api So far it&apos;s coming along pretty well but I have a strange issue. I expect the result of the body to be a string, but"><y>#</y><d>2022-02-23</d><h>23:07</h><w>sova-soars-the-sora</w>Hi I want to use ring&apos;s mock request to test a program/service/api
So far it&apos;s coming along pretty well but I have a strange issue.
I expect the result of the body to be a string, but</z><z id="t1645657717" t="sova-soars-the-sora I end up getting {:body #object[java.io.ByteArrayInputStream 0xhex... &quot;"><y>#</y><d>2022-02-23</d><h>23:08</h><w>sova-soars-the-sora</w>I end up getting
<pre>{:body #object[java.io.ByteArrayInputStream 0xhex... &quot;</pre></z><z id="t1645657844" t="sova-soars-the-sora Worth noting this is on Luminus with #muuntaja so I was thinking m/decode-whatever would work but it could not decode the ByteArrayInputStream. Am thinking Content-Type? But then it&apos;s application/edn on the request. So ... what to do."><y>#</y><d>2022-02-23</d><h>23:10</h><w>sova-soars-the-sora</w>Worth noting this is on Luminus with #muuntaja so I was thinking m/decode-whatever would work but it could not decode the ByteArrayInputStream.  Am thinking Content-Type?  But then it&apos;s application/edn on the request.  So ... what to do.</z><z id="t1645659755" t="hiredman decoding wouldn&apos;t turn the body into a string"><y>#</y><d>2022-02-23</d><h>23:42</h><w>hiredman</w>decoding wouldn&apos;t turn the body into a string</z><z id="t1645660053" t="hiredman depending on exactly what the middleware does the body might be replaced with the decode datastructure, or (less often, but maybe arguably more correct according to the ring SPEC) the read inpustream will be left in place, and new data added elsewhere"><y>#</y><d>2022-02-23</d><h>23:47</h><w>hiredman</w>depending on exactly what the middleware does the body might be replaced with the decode datastructure, or (less often, but maybe arguably more correct according to the ring SPEC) the read inpustream will be left in place, and new data added elsewhere</z><z id="t1645662629" t="sova-soars-the-sora Hmmm"><y>#</y><d>2022-02-24</d><h>00:30</h><w>sova-soars-the-sora</w>Hmmm</z><z id="t1645662668" t="sova-soars-the-sora Yeah I think this is somewhere to do with metosin-http-response but not certain yet"><y>#</y><d>2022-02-24</d><h>00:31</h><w>sova-soars-the-sora</w>Yeah I think this is somewhere to do with metosin-http-response but not certain yet</z><z id="t1645662701" t="sova-soars-the-sora What would yield an Object java.io.ByteArrayInputStream? I guess I&apos;m not clear on wtf that is"><y>#</y><d>2022-02-24</d><h>00:31</h><w>sova-soars-the-sora</w>What would yield an Object java.io.ByteArrayInputStream?  I guess I&apos;m not clear on wtf that is</z><z id="t1645664879" t="sova-soars-the-sora Oh I think it&apos;s middleware üòÑ"><y>#</y><d>2022-02-24</d><h>01:07</h><w>sova-soars-the-sora</w>Oh I think it&apos;s middleware <b>üòÑ</b></z><z id="t1645664887" t="sova-soars-the-sora using reitit coercion"><y>#</y><d>2022-02-24</d><h>01:08</h><w>sova-soars-the-sora</w>using <code>reitit coercion</code></z><z id="t1645664969" t="sova-soars-the-sora Hmm... still investigating"><y>#</y><d>2022-02-24</d><h>01:09</h><w>sova-soars-the-sora</w>Hmm... still investigating</z><z id="t1646107894" t="sova-soars-the-sora [:attrs {:href &quot;/_/_/users/U0NCTKEV8&quot;}] dude I figured it out! üòÑ it took a while but I finally found an invocation of jsonista in the metosin coercion_test"><y>#</y><d>2022-03-01</d><h>04:11</h><w>sova-soars-the-sora</w><a>@hiredman</a> dude I figured it out! <b>üòÑ</b> it took a while but I finally found an invocation of <code>jsonista</code> in the <code>metosin</code> <code>coercion_test</code></z><z id="t1646107936" t="sova-soars-the-sora if the encoding for the messages is json , the body requires (slurp) (j/ ... (j/object-mapper....))) something like that"><y>#</y><d>2022-03-01</d><h>04:12</h><w>sova-soars-the-sora</w>if the encoding for the messages is <code>json</code> , the body requires <code>(slurp) (j/ ... (j/object-mapper....)))</code> something like that</z><z id="t1646107976" t="sova-soars-the-sora i&apos;m a little fuzzy on the details but that&apos;s the general idea, it was encoded as a ByteArrayInputStream and it needs to be decoded, I just had no idea how. Or where it was even happening. Now I have it figured out and I am able to test my ring app"><y>#</y><d>2022-03-01</d><h>04:12</h><w>sova-soars-the-sora</w>i&apos;m a little fuzzy on the details but that&apos;s the general idea, it was encoded as a ByteArrayInputStream and it needs to be decoded, I just had no idea how.  Or where it was even happening.  Now I have it figured out and I am able to test my ring app</z><z id="t1646107982" t="sova-soars-the-sora with test files üòé"><y>#</y><d>2022-03-01</d><h>04:13</h><w>sova-soars-the-sora</w>with test files <b>üòé</b></z><z id="t1646248589" t="zendevil.eth hi, for some reason none of my post requests are working. Is there a middleware that I need to install?: (defn home-routes [] [ &quot;&quot; {:middleware [middleware/wrap-csrf middleware/wrap-formats coercion/coerce-request-middleware ]} [&quot;/&quot; {:get home-page}] [&quot;/about&quot; {:get about-page}] [&quot;/api/login&quot; {:coercion spec/coercion :post login-handler ;;:parameters {:query ::login-params} }]]) when I change the :post to get the request works but not when I have post"><y>#</y><d>2022-03-02</d><h>19:16</h><w>zendevil.eth</w>hi, for some reason none of my post requests are working. Is there a middleware that I need to install?:

<pre>(defn home-routes []
  [ &quot;&quot;
   {:middleware [middleware/wrap-csrf
                 middleware/wrap-formats
                 coercion/coerce-request-middleware
                 ]}
   [&quot;/&quot; {:get home-page}]
   [&quot;/about&quot; {:get about-page}]
   [&quot;/api/login&quot; {:coercion spec/coercion
                  :post login-handler
                  ;;:parameters {:query ::login-params}
                  }]])</pre>
when I change the :post to get the request works but not when I have post</z><z id="t1646254990" t="hiredman what do you mean not working?"><y>#</y><d>2022-03-02</d><h>21:03</h><w>hiredman</w>what do you mean not working?</z><z id="t1646255101" t="hiredman whatever you are see there is not strictly speaking ring, but whatever routing library you are using (I can&apos;t tell from just that snippet, I&apos;ve haven&apos;t seen middleware attached like that before)"><y>#</y><d>2022-03-02</d><h>21:05</h><w>hiredman</w>whatever you are see there is not strictly speaking ring, but whatever routing library you are using (I can&apos;t tell from just that snippet, I&apos;ve haven&apos;t seen middleware attached like that before)</z><z id="t1646255301" t="hiredman I guess it is reitit? the middleware thing just threw me"><y>#</y><d>2022-03-02</d><h>21:08</h><w>hiredman</w>I guess it is reitit? the middleware thing just threw me</z><z id="t1646280421" t="jumar There was another discussion about this. OP should have mentioned that https://clojurians.slack.com/archives/C8860D6BS/p1646233044822329"><y>#</y><d>2022-03-03</d><h>04:07</h><w>jumar</w>There was another discussion about this.
OP should have mentioned that 
<a href="https://clojurians.slack.com/archives/C8860D6BS/p1646233044822329" target="_blank">https://clojurians.slack.com/archives/C8860D6BS/p1646233044822329</a></z><z id="t1646280482" t="jumar And also https://clojurians.slack.com/archives/C077KDE3A/p1646252574749819"><y>#</y><d>2022-03-03</d><h>04:08</h><w>jumar</w>And also <a href="https://clojurians.slack.com/archives/C077KDE3A/p1646252574749819" target="_blank">https://clojurians.slack.com/archives/C077KDE3A/p1646252574749819</a></z><z id="t1646333414" t="zendevil.eth is there a ring middleware that converts a req like so: (-&gt; session (request &quot;/api/reset-password&quot; :content-type &quot;application/json&quot; :request-method :post :body (cc/generate-string {:email email :newPassword newPassword :resetToken token} ))) to have body-params in the server?"><y>#</y><d>2022-03-03</d><h>18:50</h><w>zendevil.eth</w>is there a ring middleware that converts a req like so:
<pre>(-&gt; session
      (request &quot;/api/reset-password&quot;
               :content-type &quot;application/json&quot;
               :request-method :post
               :body (cc/generate-string
                      {:email email
                       :newPassword newPassword
                       :resetToken token}
                      )))</pre>
to have body-params in the server?</z><z id="t1646432386" t="sova-soars-the-sora are you building a ring server from scratch? would highly recommend taking a working one and then modifying it to fit your needs."><y>#</y><d>2022-03-04</d><h>22:19</h><r>sova-soars-the-sora</r>are you building a ring server from scratch?
would highly recommend taking a working one and then modifying it to fit your needs.</z><z id="t1648057523" t="Santiago is there some middleware to normalize query/body parameter names e.g. someParam -&gt; some_param ?"><y>#</y><d>2022-03-23</d><h>17:45</h><w>Santiago</w>is there some middleware to normalize query/body parameter names e.g. <code>someParam -&gt; some_param</code> ?</z><z id="t1648058174" t="dharrigan which router are you using? If you&apos;re using reitit I have a solution for that"><y>#</y><d>2022-03-23</d><h>17:56</h><w>dharrigan</w>which router are you using? If you&apos;re using reitit I have a solution for that</z><z id="t1648061088" t="Santiago Compojure at the moment, but I‚Äôm actually thinking about switching to reitit so you‚Äôre solution is potentially useful üôÇ"><y>#</y><d>2022-03-23</d><h>18:44</h><w>Santiago</w>Compojure at the moment, but I‚Äôm actually thinking about switching to reitit so you‚Äôre solution is potentially useful <b>üôÇ</b></z><z id="t1648065903" t="dharrigan This is what I do:"><y>#</y><d>2022-03-23</d><h>20:05</h><w>dharrigan</w>This is what I do:</z><z id="t1648065974" t="dharrigan (def ^:private custom-serialization (m/create (-&gt; m/default-options (assoc-in [:formats &quot;application/json&quot; :encoder-opts] {:encode-key-fn (comp csk/-&gt;snake_case name)}) ;; clojure -&gt; json (assoc-in [:formats &quot;application/json&quot; :decoder-opts] {:decode-key-fn (comp keyword csk/-&gt;kebab-case)})))) ;; json -&gt; clojure"><y>#</y><d>2022-03-23</d><h>20:06</h><w>dharrigan</w><pre>(def ^:private custom-serialization
  (m/create
   (-&gt; m/default-options
       (assoc-in [:formats &quot;application/json&quot; :encoder-opts] {:encode-key-fn (comp csk/-&gt;snake_case name)}) ;; clojure -&gt; json
       (assoc-in [:formats &quot;application/json&quot; :decoder-opts] {:decode-key-fn (comp keyword csk/-&gt;kebab-case)})))) ;; json -&gt; clojure</pre></z><z id="t1648065990" t="dharrigan Then in the configuration/data of reitit:"><y>#</y><d>2022-03-23</d><h>20:06</h><w>dharrigan</w>Then in the configuration/data of reitit:</z><z id="t1648065995" t="dharrigan :muuntaja custom-serialization"><y>#</y><d>2022-03-23</d><h>20:06</h><w>dharrigan</w><code>:muuntaja custom-serialization</code></z><z id="t1648066012" t="dharrigan works a treat"><y>#</y><d>2022-03-23</d><h>20:06</h><w>dharrigan</w>works a treat</z><z id="t1648066019" t="dharrigan you can swap out the csk to whatever you need"><y>#</y><d>2022-03-23</d><h>20:06</h><w>dharrigan</w>you can swap out the csk to whatever you need</z><z id="t1648066339" t="Ferdinand Beyer I also prefer reitit, but your example does not use anything reitit-specific, right? Muuntaja is a standalone library that you can also use as a ring middleware. https://github.com/metosin/muuntaja/blob/master/doc/With-Ring.md"><y>#</y><d>2022-03-23</d><h>20:12</h><w>Ferdinand Beyer</w>I also prefer reitit, but your example does not use anything reitit-specific, right? Muuntaja is a standalone library that you can also use as a ring middleware. <a href="https://github.com/metosin/muuntaja/blob/master/doc/With-Ring.md" target="_blank">https://github.com/metosin/muuntaja/blob/master/doc/With-Ring.md</a></z><z id="t1648066377" t="dharrigan Very true üôÇ"><y>#</y><d>2022-03-23</d><h>20:12</h><w>dharrigan</w>Very true <b>üôÇ</b></z><z id="t1648066412" t="dharrigan But, if he&apos;s switching maybe to reitit, at least he knows what I do üôÇ"><y>#</y><d>2022-03-23</d><h>20:13</h><w>dharrigan</w>But, if he&apos;s switching maybe to reitit, at least he knows what I do <b>üôÇ</b></z><z id="t1648066496" t="Ferdinand Beyer We should probably also point [:attrs {:href &quot;/_/_/users/UFPEDL1LY&quot;}] to https://github.com/clj-commons/camel-snake-kebab ‚Äî the csk namespace in your example is just that üôÇ"><y>#</y><d>2022-03-23</d><h>20:14</h><w>Ferdinand Beyer</w>We should probably also point <a>@slack.jcpsantiago</a> to <a href="https://github.com/clj-commons/camel-snake-kebab" target="_blank">https://github.com/clj-commons/camel-snake-kebab</a> ‚Äî the <code>csk</code> namespace in your example is just that <b>üôÇ</b></z><z id="t1648066510" t="dharrigan oh yes, good shout. Tis a great library."><y>#</y><d>2022-03-23</d><h>20:15</h><w>dharrigan</w>oh yes, good shout. Tis a great library.</z><z id="t1648068690" t="Santiago [:attrs {:href &quot;/_/_/users/U031CHTGX1T&quot;}] [:attrs {:href &quot;/_/_/users/U11EL3P9U&quot;}] thank you both! yeah csk gets me super far already actually, but like I said I‚Äôll move to reitit so [:attrs {:href &quot;/_/_/users/U11EL3P9U&quot;}] ‚Äôs solution is great"><y>#</y><d>2022-03-23</d><h>20:51</h><w>Santiago</w><a>@ferdinand</a> <a>@dharrigan</a> thank you both! yeah <code>csk</code> gets me super far already actually, but like I said I‚Äôll move to reitit so <a>@dharrigan</a>‚Äôs solution is great</z><z id="t1648069337" t="dharrigan np, glad to help üôÇ"><y>#</y><d>2022-03-23</d><h>21:02</h><w>dharrigan</w>np, glad to help <b>üôÇ</b></z><z id="t1648296180" t="fadrian I&apos;m wrapping my handler with wrap-json-body and wrap-json-response. However, I&apos;m still getting an input-stream instead of a json body in my request. Any ideas why?"><y>#</y><d>2022-03-26</d><h>12:03</h><w>fadrian</w>I&apos;m wrapping my handler with wrap-json-body and wrap-json-response. However, I&apos;m still getting an input-stream instead of a json body in my request. Any ideas why?</z><z id="t1648452640" t="Ferdinand Beyer Maybe your request does not set a JSON content-type? wrap-json-body will only parse the body if the Content-Type header contains something like application/json ."><y>#</y><d>2022-03-28</d><h>07:30</h><r>Ferdinand Beyer</r>Maybe your request does not set a JSON content-type?

<code>wrap-json-body</code> will only parse the body if the <code>Content-Type</code> header contains something like <code>application/json</code>.</z><z id="t1649269774" t="Hukka I&apos;m trying to think what the session middleware https://github.com/ring-clojure/ring/blob/1.9.0/ring-core/src/ring/middleware/session.clj would do in a case where two different clients had the same session key. If client A tries to log out and B tries to keep changing the session all the time, would it go possibly like this: 1. request from A gets the session added 2. request from B gets the session added 3. response to A deletes the session from the store 4. response to B re-adds the session, and write-session does not care that it didn&apos;t actually exist anymore Or similarly for when the session keys are not the same, but A tries to log out all sessions for the user."><y>#</y><d>2022-04-06</d><h>18:29</h><w>Hukka</w>I&apos;m trying to think what the session middleware <a href="https://github.com/ring-clojure/ring/blob/1.9.0/ring-core/src/ring/middleware/session.clj" target="_blank">https://github.com/ring-clojure/ring/blob/1.9.0/ring-core/src/ring/middleware/session.clj</a> would do in a case where two different clients had the same session key. If client A tries to log out and B tries to keep changing the session all the time, would it go possibly like this:
1. request from A gets the session added
2. request from B gets the session added
3. response to A deletes the session from the store
4. response to B re-adds the session, and write-session does not care that it didn&apos;t actually exist anymore
Or similarly for when the session keys are not the same, but A tries to log out all sessions for the user.</z><z id="t1649332843" t="kwrooijen Hey, does Ring have public functions to convert raw HTTP requests (bytes or string) to ring request maps? Same question for response maps"><y>#</y><d>2022-04-07</d><h>12:00</h><w>kwrooijen</w>Hey, does Ring have public functions to convert raw HTTP requests (bytes or string) to ring request maps? Same question for response maps</z><z id="t1649355073" t="seancorfield [:attrs {:href &quot;/_/_/users/UG9U7TPDZ&quot;}] Take a look at https://github.com/ring-clojure/ring/blob/master/ring-servlet/src/ring/util/servlet.clj -- I think that&apos;s where the request -&gt; hash map -&gt; response stuff is."><y>#</y><d>2022-04-07</d><h>18:11</h><w>seancorfield</w><a>@kevin.van.rooijen</a> Take a look at <a href="https://github.com/ring-clojure/ring/blob/master/ring-servlet/src/ring/util/servlet.clj" target="_blank">https://github.com/ring-clojure/ring/blob/master/ring-servlet/src/ring/util/servlet.clj</a> -- I think that&apos;s where the request -&gt; hash map -&gt; response stuff is.</z><z id="t1649355504" t="kwrooijen Awesome, thanks üëç"><y>#</y><d>2022-04-07</d><h>18:18</h><w>kwrooijen</w>Awesome, thanks <b>üëç</b></z><z id="t1649455338" t="stephenmhopper Hi, I have a ring + reitit app. One of the endpoints downloads a file from S3 and sends it to the user. I‚Äôm using ring-io/piped-input-stream . In my function, I call S3 to get an InputStream on the resource. And then I do something like this: (with-open [input-stream (:input-stream response)] (io/copy input-stream output-stream)) 1. Is there a better way to implement all of this? 2. It seems like the entire input-stream is being downloaded to the server before anything is sent to the client. Is there a way around that?"><y>#</y><d>2022-04-08</d><h>22:02</h><w>stephenmhopper</w>Hi, I have a ring + reitit app. One of the endpoints downloads a file from S3 and sends it to the user. I‚Äôm using <code>ring-io/piped-input-stream</code> . In my function, I call S3 to get an <code>InputStream</code> on the resource. And then I do something like this:
<pre>(with-open [input-stream (:input-stream response)]
  (io/copy input-stream output-stream))</pre>
1. Is there a better way to implement all of this?
2. It seems like the entire <code>input-stream</code> is being downloaded to the server before anything is sent to the client. Is there a way around that?</z><z id="t1649458731" t="stephenmhopper &gt; If you aren‚Äôt doing any processing on the file, can the user just retrieve it directly from S3 via URL, without you having to shuttle the data through your app? [:attrs {:href &quot;/_/_/users/UTFAPNRPT&quot;}] I explored that path, but I can‚Äôt make the files in the bucket publicly available so that unfortunately won‚Äôt work."><y>#</y><d>2022-04-08</d><h>22:58</h><r>stephenmhopper</r>&gt; If you aren‚Äôt doing any processing on the file, can the user just retrieve it directly from S3 via URL, without you having to shuttle the data through your app?
<a>@UTFAPNRPT</a> I explored that path, but I can‚Äôt make the files in the bucket publicly available so that unfortunately won‚Äôt work.</z><z id="t1649463301" t="wevrem I&apos;m going to be needing something similar, and I was going to use the ‚Äúauthenticated‚Äù URL‚Äôs from S3 (not sure if that is the correct term) that give access to non-public buckets for a short duration. Haven&apos;t implemented it yet. "><y>#</y><d>2022-04-09</d><h>00:15</h><r>wevrem</r>I&apos;m going to be needing something similar, and I was going to use the ‚Äúauthenticated‚Äù URL‚Äôs from S3 (not sure if that is the correct term) that give access to non-public buckets for a short duration. Haven&apos;t implemented it yet. </z><z id="t1649466211" t="stephenmhopper Oh, that would fit my use case. I‚Äôll have to look into that."><y>#</y><d>2022-04-09</d><h>01:03</h><r>stephenmhopper</r>Oh, that would fit my use case. I‚Äôll have to look into that.</z><z id="t1649466275" t="stephenmhopper As far is Ring is concerned though. Suppose I have an arbitrary InputStream , what‚Äôs the best way to pipe that to the client?"><y>#</y><d>2022-04-09</d><h>01:04</h><r>stephenmhopper</r>As far is Ring is concerned though. Suppose I have an arbitrary <code>InputStream</code>, what‚Äôs the best way to pipe that to the client?</z><z id="t1649477109" t="hiredman to some degree this is a limitation of http, you must set a content-length and a stream doesn&apos;t come with a content-length"><y>#</y><d>2022-04-09</d><h>04:05</h><r>hiredman</r>to some degree this is a limitation of http, you must set a content-length and a stream doesn&apos;t come with a content-length</z><z id="t1649477370" t="hiredman it is also a limitation of some aws libraries, if I recall cognitect&apos;s aws-api for example will download the entire content in memory and wrap it in an inputstream"><y>#</y><d>2022-04-09</d><h>04:09</h><r>hiredman</r>it is also a limitation of some aws libraries, if I recall cognitect&apos;s aws-api for example will download the entire content in memory and wrap it in an inputstream</z><z id="t1649477441" t="hiredman https://github.com/cognitect-labs/aws-api/issues/14"><y>#</y><d>2022-04-09</d><h>04:10</h><r>hiredman</r><a href="https://github.com/cognitect-labs/aws-api/issues/14" target="_blank">https://github.com/cognitect-labs/aws-api/issues/14</a></z><z id="t1649477461" t="hiredman so the data being resident in memory may not be a result of ring stuff at all"><y>#</y><d>2022-04-09</d><h>04:11</h><r>hiredman</r>so the data being resident in memory may not be a result of ring stuff at all</z><z id="t1649508975" t="stephenmhopper That‚Äôs good to know. Previously, I was working on a project where I needed to stream files stored in Postgres down to a client. The backend was written in Scala+Play+Slick. So I https://github.com/tminglei/slick-pg/pull/295 to allow for reactive streaming of data from the Postgres LargeObject API to anything that wanted to consume that Source. (The DB isn‚Äôt super important here, I‚Äôm more interested in creating reactive, consumable streams of bytes) That was six years ago. Is there not some equivalent to this in Clojure? If not, I might consider rolling something that other folks can re-use in the future. I just want to avoid re-inventing the wheel. 1. Does Ring support chunked requests? I couldn‚Äôt find official documentation on this, but it https://github.com/ring-clojure/ring/blob/4292f995a25895d0822f1fd040a1fbf89a17eeb1/ring-jetty-adapter/test/ring/adapter/test/jetty.clj . 2. For the whole ‚Äúcopying from InputStream to OutputStream reactively‚Äù part, should I just set up a core.async channel between the two streams that copies bytes in batches? That sounds slow to me. Is there a better way to go?"><y>#</y><d>2022-04-09</d><h>12:56</h><r>stephenmhopper</r>That‚Äôs good to know.

Previously, I was working on a project where I needed to stream files stored in Postgres down to a client. The backend was written in Scala+Play+Slick. So I <a href="https://github.com/tminglei/slick-pg/pull/295" target="_blank">https://github.com/tminglei/slick-pg/pull/295</a> to allow for reactive streaming of data from the Postgres LargeObject API to anything that wanted to consume that Source.

(The DB isn‚Äôt super important here, I‚Äôm more interested in creating reactive, consumable streams of bytes)

That was six years ago. Is there not some equivalent to this in Clojure? If not, I might consider rolling something that other folks can re-use in the future. I just want to avoid re-inventing the wheel.

1. Does Ring support chunked requests? I couldn‚Äôt find official documentation on this, but it <a href="https://github.com/ring-clojure/ring/blob/4292f995a25895d0822f1fd040a1fbf89a17eeb1/ring-jetty-adapter/test/ring/adapter/test/jetty.clj" target="_blank">https://github.com/ring-clojure/ring/blob/4292f995a25895d0822f1fd040a1fbf89a17eeb1/ring-jetty-adapter/test/ring/adapter/test/jetty.clj</a>.
2. For the whole ‚Äúcopying from InputStream to OutputStream reactively‚Äù part, should I just set up a core.async channel between the two streams that copies bytes in batches? That sounds slow to me. Is there a better way to go?</z><z id="t1649532860" t="wevrem I think an InputStream is acceptable as the :body of a response. "><y>#</y><d>2022-04-09</d><h>19:34</h><r>wevrem</r>I think an InputStream is acceptable as the :body of a response. </z><z id="t1649456961" t="wevrem If you aren‚Äôt doing any processing on the file, can the user just retrieve it directly from S3 via URL, without you having to shuttle the data through your app?"><y>#</y><d>2022-04-08</d><h>22:29</h><w>wevrem</w>If you aren‚Äôt doing any processing on the file, can the user just retrieve it directly from S3 via URL, without you having to shuttle the data through your app?</z><z id="t1650524416" t="jumar [:attrs {:href &quot;/_/_/users/U0BKWMG5B&quot;}] would you mind changing the default for :absolute-redirects to false for both site-defaults and api-defaults ? The original HTTP spec that mandated this has been replaced by a newer version about 8 years ago. See https://github.com/clj-commons/friend/issues/4 and https://github.com/clj-commons/friend/pull/5"><y>#</y><d>2022-04-21</d><h>07:00</h><w>jumar</w><a>@weavejester</a> would you mind changing the default for <code>:absolute-redirects</code> to <code>false</code> for both <code>site-defaults</code> and <code>api-defaults</code> ?
The original HTTP spec that mandated this has been replaced by a newer version about 8 years ago.
See <a href="https://github.com/clj-commons/friend/issues/4" target="_blank">https://github.com/clj-commons/friend/issues/4</a> and <a href="https://github.com/clj-commons/friend/pull/5" target="_blank">https://github.com/clj-commons/friend/pull/5</a></z><z id="t1650524905" t="jumar relevant section from ring-defaults readme: https://github.com/ring-clojure/ring-defaults#customizing &gt; ‚Ä¢ :absolute-redirects - Any redirects to relative URLs will be turned into redirects to absolute URLs, to better conform to the HTTP spec. And the code: https://github.com/ring-clojure/ring-defaults/blob/master/src/ring/middleware/defaults.clj#L52 ... :responses {:not-modified-responses true :absolute-redirects true ... "><y>#</y><d>2022-04-21</d><h>07:08</h><r>jumar</r>relevant section from ring-defaults readme: <a href="https://github.com/ring-clojure/ring-defaults#customizing" target="_blank">https://github.com/ring-clojure/ring-defaults#customizing</a>
&gt; ‚Ä¢  <code>:absolute-redirects</code> - Any redirects to relative URLs will be turned into redirects to absolute URLs, to better conform to the HTTP spec.
And the code: <a href="https://github.com/ring-clojure/ring-defaults/blob/master/src/ring/middleware/defaults.clj#L52" target="_blank">https://github.com/ring-clojure/ring-defaults/blob/master/src/ring/middleware/defaults.clj#L52</a>
<pre>...
   :responses {:not-modified-responses true
               :absolute-redirects     true
...</pre>
</z><z id="t1650562112" t="seancorfield FWIW, at work, our default middleware stack turns this off because we&apos;re behind a load balancer where it is HTTPS to the LB and HTTP between the LB and our app servers. :absolute-redirects true breaks that."><y>#</y><d>2022-04-21</d><h>17:28</h><r>seancorfield</r>FWIW, at work, our default middleware stack turns this off because we&apos;re behind a load balancer where it is HTTPS to the LB and HTTP between the LB and our app servers. <code>:absolute-redirects true</code> breaks that.</z><z id="t1650562489" t="jumar Exactly. And I don&apos;t see the reason for keeping the current default since HTTP spec was updated 8 years ago"><y>#</y><d>2022-04-21</d><h>17:34</h><r>jumar</r>Exactly. And I don&apos;t see the reason for keeping the current default since HTTP spec was updated 8 years ago</z><z id="t1650533212" t="Serafeim Papastefanos hey friends! I&apos;m trying to use the wrap-reload middleware. I&apos;ve defined my app in a variable and try to run it like (wrap-reload app) however it ain&apos;t working. I need to pass it like (wrap-reload #&apos;app) can somebody explain to me why i need to do this? is this needed in other middleware also ?"><y>#</y><d>2022-04-21</d><h>09:26</h><w>Serafeim Papastefanos</w>hey friends! I&apos;m trying to use the <code>wrap-reload</code> middleware. I&apos;ve defined my <code>app</code> in a variable and try to run it like <code>(wrap-reload app)</code>  however it ain&apos;t working. I need to pass it like <code>(wrap-reload #&apos;app)</code>  can somebody explain to me why i need to do this? is this needed in other middleware also ?</z><z id="t1650533456" t="Hukka Have you read https://clojure.org/guides/repl/enhancing_your_repl_workflow#writing-repl-friendly-programs ?"><y>#</y><d>2022-04-21</d><h>09:30</h><r>Hukka</r>Have you read <a href="https://clojure.org/guides/repl/enhancing_your_repl_workflow#writing-repl-friendly-programs" target="_blank">https://clojure.org/guides/repl/enhancing_your_repl_workflow#writing-repl-friendly-programs</a>?</z><z id="t1650533566" t="Hukka Sounds like the problem is that while the wrap-reload will reload the namespaces, it cannot actually change it&apos;s own handle to the handler. So if your changes are in other namespaces, or perhaps just outside the handler in the same namespace (that is, your handler is calling other functions), those references will get updated. But the actual handler will not."><y>#</y><d>2022-04-21</d><h>09:32</h><r>Hukka</r>Sounds like the problem is that while the wrap-reload will reload the namespaces, it cannot actually change it&apos;s own handle to the handler. So if your changes are in other namespaces, or perhaps just outside the handler in the same namespace (that is, your handler is calling other functions), those references will get updated. But the actual handler will not.</z><z id="t1650533602" t="Hukka And in contrast, if you use #&apos;app you probably don&apos;t even need the reload middleware (that depends a bit on how the namespaces have been constructed)"><y>#</y><d>2022-04-21</d><h>09:33</h><r>Hukka</r>And in contrast, if you use #&apos;app you probably don&apos;t even need the reload middleware (that depends a bit on how the namespaces have been constructed)</z><z id="t1650533687" t="Hukka Phrasing differently, writing (wrap-reload app) means &quot;Take the current version of app, and use that. Forever.&quot; while (wrap-reload #&apos;app) means &quot;Whenever you actually call app, check what is the current definition&quot;"><y>#</y><d>2022-04-21</d><h>09:34</h><r>Hukka</r>Phrasing differently, writing <code>(wrap-reload app)</code> means &quot;Take the current version of app, and use that. Forever.&quot; while <code>(wrap-reload #&apos;app)</code> means &quot;Whenever you actually call app, check what is the current definition&quot;</z><z id="t1650533790" t="Hukka We use jetty/ring so that we simply re-evaluate whatever we are editing (function, file), without using that middleware, tools.namespace, or restarting the jetty"><y>#</y><d>2022-04-21</d><h>09:36</h><r>Hukka</r>We use jetty/ring so that we simply re-evaluate whatever we are editing (function, file), without using that middleware, tools.namespace, or restarting the jetty</z><z id="t1650533855" t="Serafeim Papastefanos you mean you start the server from the repl and re-evaluate it fromt he repl ?"><y>#</y><d>2022-04-21</d><h>09:37</h><r>Serafeim Papastefanos</r>you mean you start the server from the repl and re-evaluate it fromt he repl ?</z><z id="t1650533888" t="Hukka We don&apos;t re-evaluate the server, just whatever function in some namespace that we are changing"><y>#</y><d>2022-04-21</d><h>09:38</h><r>Hukka</r>We don&apos;t re-evaluate the server, just whatever function in some namespace that we are changing</z><z id="t1650533909" t="Hukka Or rarely the actual main app, if we are changing routing (adding a new endpoint or something)"><y>#</y><d>2022-04-21</d><h>09:38</h><r>Hukka</r>Or rarely the actual main app, if we are changing routing (adding a new endpoint or something)</z><z id="t1650533931" t="Serafeim Papastefanos yes yes that&apos;s what i mentioned..."><y>#</y><d>2022-04-21</d><h>09:38</h><r>Serafeim Papastefanos</r>yes yes that&apos;s what i mentioned...</z><z id="t1650533934" t="Serafeim Papastefanos yes that makes sense"><y>#</y><d>2022-04-21</d><h>09:38</h><r>Serafeim Papastefanos</r>yes that makes sense</z><z id="t1650533951" t="Serafeim Papastefanos however i also want to be able to do it if i run the server from the command line"><y>#</y><d>2022-04-21</d><h>09:39</h><r>Serafeim Papastefanos</r>however i also want to be able to do it if i run the server from the command line</z><z id="t1650533967" t="Serafeim Papastefanos without using the repl at all; just by changing directly some files"><y>#</y><d>2022-04-21</d><h>09:39</h><r>Serafeim Papastefanos</r>without using the repl at all; just by changing directly some files</z><z id="t1650534085" t="Hukka Well, yes. This assumes that you need a repl, though one is included in clojure by default (the socket repl). If you want to edit simply any file with something that is not aware of clojure, then you need some other tooling. But even then, if you actually modify app, not just something app calls, you need the explicit var syntax since the server isn&apos;t re-evaluated"><y>#</y><d>2022-04-21</d><h>09:41</h><r>Hukka</r>Well, yes. This assumes that you need a repl, though one is included in clojure by default (the socket repl). If you want to edit simply any file with something that is not aware of clojure, then you need some other tooling.

But even then, if you actually modify app, not just something app calls, you need the explicit var syntax since the server isn&apos;t re-evaluated</z><z id="t1650534115" t="Hukka Other option would be to have something that closes the running server and defines and starts a new one. That is very common too, using integrant, mount etc"><y>#</y><d>2022-04-21</d><h>09:41</h><r>Hukka</r>Other option would be to have something that closes the running server and defines and starts a new one. That is very common too, using integrant, mount etc</z><z id="t1650534115" t="Serafeim Papastefanos yes yes i understand thank you"><y>#</y><d>2022-04-21</d><h>09:41</h><r>Serafeim Papastefanos</r>yes yes i understand thank you</z><z id="t1650534130" t="Serafeim Papastefanos no using the wrap-reload seems to be fine for now"><y>#</y><d>2022-04-21</d><h>09:42</h><r>Serafeim Papastefanos</r>no using the wrap-reload seems to be fine for now</z><z id="t1650534265" t="Hukka I&apos;m not sure if ns-tracker (what the middleware uses) unloads the old versions of the namespaces, though"><y>#</y><d>2022-04-21</d><h>09:44</h><r>Hukka</r>I&apos;m not sure if ns-tracker (what the middleware uses) unloads the old versions of the namespaces, though</z><z id="t1650534304" t="Serafeim Papastefanos will this bea problem ?"><y>#</y><d>2022-04-21</d><h>09:45</h><r>Serafeim Papastefanos</r>will this bea problem ?</z><z id="t1650534315" t="Hukka In practice this means that if you delete a helper function, your server will keep working since the old definition is still there, but will break upon a cold restart. tools.namespace in contrast unloads the old version before loading the new, so such bugs are caught"><y>#</y><d>2022-04-21</d><h>09:45</h><r>Hukka</r>In practice this means that if you delete a helper function, your server will keep working since the old definition is still there, but will break upon a cold restart. tools.namespace in contrast unloads the old version before loading the new, so such bugs are caught</z><z id="t1650535192" t="Serafeim Papastefanos ah yes i unerstand"><y>#</y><d>2022-04-21</d><h>09:59</h><r>Serafeim Papastefanos</r>ah yes i unerstand</z><z id="t1650535194" t="Serafeim Papastefanos thank you"><y>#</y><d>2022-04-21</d><h>09:59</h><r>Serafeim Papastefanos</r>thank you</z><z id="t1650536333" t="Hukka You&apos;re welcome"><y>#</y><d>2022-04-21</d><h>10:18</h><r>Hukka</r>You&apos;re welcome</z><z id="t1652779709" t="Thierry Hi everyone! I have a quick question. Is it possible to access the contents of ring.middleware.session.memory/memory-store without passing a predefined atom? I know I can access the data if I define an atom and pass that as argument to memory-store. If I don&apos;t then the function creates an unnamed atom, how do I access the unnamed atom? It only returns the following without me being able to access it. #object [ring.middleware.session.memory.MemoryStore 0x1295a8d0 &quot;"><y>#</y><d>2022-05-17</d><h>09:28</h><w>Thierry</w>Hi everyone! I have a quick question.
Is it possible to access the contents of <code>ring.middleware.session.memory/memory-store</code> without passing a predefined atom?
I know I can access the data if I define an atom and pass that as argument to memory-store. If I don&apos;t then the function creates an unnamed atom, how do I access the unnamed atom?
It only returns the following without me being able to access it.
<code>#object</code>
 <code>[ring.middleware.session.memory.MemoryStore 0x1295a8d0</code>
  <code>&quot;</code></z><z id="t1652781056" t="jumar do you want that for debugging or what do you want to do with that?"><y>#</y><d>2022-05-17</d><h>09:50</h><r>jumar</r>do you want that for debugging or what do you want to do with that?</z><z id="t1652781099" t="Thierry What I want to do in the end is get the ips that are logged in and the session count per ip."><y>#</y><d>2022-05-17</d><h>09:51</h><r>Thierry</r>What I want to do in the end is get the ips that are logged in and the session count per ip.</z><z id="t1652781362" t="jumar Is that information going to be available in your session? I feel like you should use a separate mechanism for getting these stats. But you could use something like this as a workaround: (comment (def ms (memory-store)) (.write-session ms &quot;k&quot; &quot;val&quot;) (.read-session ms &quot;k&quot;) (.write-session ms &quot;k2&quot; &quot;val2&quot;) (.session_map ms) ;; =&gt; #atom[{&quot;k&quot; &quot;val&quot;, &quot;k2&quot; &quot;val2&quot;} 0x7f51bf9] .)"><y>#</y><d>2022-05-17</d><h>09:56</h><r>jumar</r>Is that information going to be available in your session?
I feel like you should use a separate mechanism for getting these stats.

But you could use something like this as a workaround:
<pre>(comment
  (def ms (memory-store))
  (.write-session ms &quot;k&quot; &quot;val&quot;)
  (.read-session ms &quot;k&quot;)
  (.write-session ms &quot;k2&quot; &quot;val2&quot;)

  (.session_map ms)
  ;; =&gt; #atom[{&quot;k&quot; &quot;val&quot;, &quot;k2&quot; &quot;val2&quot;} 0x7f51bf9]

  .)</pre></z><z id="t1652781423" t="Thierry Thanks! the (.session_map X) was exactly what I was looking for"><y>#</y><d>2022-05-17</d><h>09:57</h><r>Thierry</r>Thanks! the (.session_map X) was exactly what I was looking for</z><z id="t1652781433" t="Thierry no idea why i couldnt find that with google"><y>#</y><d>2022-05-17</d><h>09:57</h><r>Thierry</r>no idea why i couldnt find that with google</z><z id="t1652781454" t="jumar Of course, this relies on an implementation detail üôÇ I just used cider-inspect in emacs to look at the contents of ms var."><y>#</y><d>2022-05-17</d><h>09:57</h><r>jumar</r>Of course, this relies on an implementation detail <b>üôÇ</b>

I just used <code>cider-inspect</code> in emacs to look at the contents of <code>ms</code> var.</z><z id="t1652781595" t="Thierry I use Calva in VSCode, no clue how to do cider-inspect there"><y>#</y><d>2022-05-17</d><h>09:59</h><r>Thierry</r>I use Calva in VSCode, no clue how to do cider-inspect there</z><z id="t1652781826" t="jumar Maybe it&apos;s not as easy. This one is less convenient but I used to use it a while ago: (-&gt;&gt; (clojure.reflect/reflect ms) :members (sort-by :name) (clojure.pprint/print-table [:name :flags :parameter-types :return-type]))"><y>#</y><d>2022-05-17</d><h>10:03</h><r>jumar</r>Maybe it&apos;s not as easy.
This one is less convenient but I used to use it a while ago:
<pre>(-&gt;&gt; (clojure.reflect/reflect ms) :members (sort-by :name) (clojure.pprint/print-table [:name :flags :parameter-types :return-type]))</pre></z><z id="t1652781965" t="Thierry That works, thanks! Looking at the output I was close, but not close enough haha"><y>#</y><d>2022-05-17</d><h>10:06</h><r>Thierry</r>That works, thanks! Looking at the output I was close, but not close enough haha</z><z id="t1652782004" t="Thierry (vec (.getMethods (.getClass session-store))) found some of them, but didnt include session_map"><y>#</y><d>2022-05-17</d><h>10:06</h><r>Thierry</r><code>(vec (.getMethods (.getClass session-store)))</code> found some of them, but didnt include session_map</z><z id="t1652879752" t="wombawomba I&apos;m trying to figure out how to mount a Java servlet ( https://download.eclipse.org/jgit/site/6.1.0.202203080745-r/apidocs/org/eclipse/jgit/http/server/GitServlet.html ) at a specific path (using Reitit) in a Ring handler. Is this possible? If so, any pointers as to how?"><y>#</y><d>2022-05-18</d><h>13:15</h><w>wombawomba</w>I&apos;m trying to figure out how to mount a Java servlet (<a href="https://download.eclipse.org/jgit/site/6.1.0.202203080745-r/apidocs/org/eclipse/jgit/http/server/GitServlet.html" target="_blank">https://download.eclipse.org/jgit/site/6.1.0.202203080745-r/apidocs/org/eclipse/jgit/http/server/GitServlet.html</a>) at a specific path (using Reitit) in a Ring handler.

Is this possible? If so, any pointers as to how?</z><z id="t1653053212" t="emccue Depends on your server"><y>#</y><d>2022-05-20</d><h>13:26</h><r>emccue</r>Depends on your server</z><z id="t1653053247" t="wombawomba The server is Jetty (embedded)"><y>#</y><d>2022-05-20</d><h>13:27</h><r>wombawomba</r>The server is Jetty (embedded)</z><z id="t1653053272" t="emccue similar question asked in beginners earlier - but basically you need to do it at the server level"><y>#</y><d>2022-05-20</d><h>13:27</h><r>emccue</r>similar question asked in beginners earlier - but basically you need to do it at the server level</z><z id="t1653053278" t="wombawomba ah okay"><y>#</y><d>2022-05-20</d><h>13:27</h><r>wombawomba</r>ah okay</z><z id="t1653053285" t="wombawomba that&apos;s the way I have it set up now"><y>#</y><d>2022-05-20</d><h>13:28</h><r>wombawomba</r>that&apos;s the way I have it set up now</z><z id="t1653053289" t="emccue when you start up the thing use :configurator"><y>#</y><d>2022-05-20</d><h>13:28</h><r>emccue</r>when you start up the thing use <code>:configurator</code></z><z id="t1653053297" t="wombawomba it&apos;s a bit annoying because I can&apos;t use my middleware with it"><y>#</y><d>2022-05-20</d><h>13:28</h><r>wombawomba</r>it&apos;s a bit annoying because I can&apos;t use my middleware with it</z><z id="t1653053309" t="wombawomba (i.e. I have to replicate it for the servlet)"><y>#</y><d>2022-05-20</d><h>13:28</h><r>wombawomba</r>(i.e. I have to replicate it for the servlet)</z><z id="t1653053325" t="emccue there might be another way - let me figure out what a servlet is exactly real quick"><y>#</y><d>2022-05-20</d><h>13:28</h><r>emccue</r>there might be another way - let me figure out what a servlet is exactly real quick</z><z id="t1653053415" t="wombawomba there&apos;s this, which can translate servlet requests to a Ring requests, and a Ring responses to servlet responses: https://github.com/ring-clojure/ring/blob/master/ring-servlet/src/ring/util/servlet.clj"><y>#</y><d>2022-05-20</d><h>13:30</h><r>wombawomba</r>there&apos;s this, which can translate servlet requests to a Ring requests, and a Ring responses to servlet responses: <a href="https://github.com/ring-clojure/ring/blob/master/ring-servlet/src/ring/util/servlet.clj" target="_blank">https://github.com/ring-clojure/ring/blob/master/ring-servlet/src/ring/util/servlet.clj</a></z><z id="t1653053426" t="wombawomba ...but I&apos;d want to translate in the other direction, so to speak"><y>#</y><d>2022-05-20</d><h>13:30</h><r>wombawomba</r>...but I&apos;d want to translate in the other direction, so to speak</z><z id="t1653053451" t="emccue what is the middleware you want to put in the middle exactly?"><y>#</y><d>2022-05-20</d><h>13:30</h><r>emccue</r>what is the middleware you want to put in the middle exactly?</z><z id="t1653053532" t="emccue maybe we can proxy a &quot;delegating servlet&quot; and make use of the stuff in the middle"><y>#</y><d>2022-05-20</d><h>13:32</h><r>emccue</r>maybe we can proxy a &quot;delegating servlet&quot; and make use of the stuff in the middle</z><z id="t1653053646" t="emccue or maybe https://dotnettutorials.net/lesson/servlet-chaining-in-java/"><y>#</y><d>2022-05-20</d><h>13:34</h><r>emccue</r>or maybe <a href="https://dotnettutorials.net/lesson/servlet-chaining-in-java/" target="_blank">https://dotnettutorials.net/lesson/servlet-chaining-in-java/</a></z><z id="t1653053658" t="emccue something like this?"><y>#</y><d>2022-05-20</d><h>13:34</h><r>emccue</r>something like this?</z><z id="t1653053729" t="wombawomba I have a bunch of middleware, but the most relevant here would be my custom middleware for auth and logging"><y>#</y><d>2022-05-20</d><h>13:35</h><r>wombawomba</r>I have a bunch of middleware, but the most relevant here would be my custom middleware for auth and logging</z><z id="t1653060887" t="wombawomba ...and yeah, something like that works, but I was hoping I&apos;d be able to just find a way to stick some Ring middleware inbetween instead of extra servlets."><y>#</y><d>2022-05-20</d><h>15:34</h><r>wombawomba</r>...and yeah, something like that works, but I was hoping I&apos;d be able to just find a way to stick some Ring middleware inbetween instead of extra servlets.</z><z id="t1655749233" t="James Amberger Hi, I‚Äôm using deps.edn. I managed to use tonsky‚Äôs uberdeps to generate an executable uberjar, next step is how to generate a WAR for use in weblogic/tomcat. All instructions look lein-based but I was hoping not to involve lein."><y>#</y><d>2022-06-20</d><h>18:20</h><w>James Amberger</w>Hi, I‚Äôm using deps.edn. I managed to use tonsky‚Äôs <code>uberdeps</code> to generate an executable uberjar, next step is how to generate a WAR for use in weblogic/tomcat. All instructions look lein-based but I was hoping not to involve lein.</z><z id="t1655750326" t="seancorfield Are you specifically tied to creating and deploying a WAR to an existing web application server? Most folks build a self-contained JAR and deploy that in production."><y>#</y><d>2022-06-20</d><h>18:38</h><r>seancorfield</r>Are you specifically tied to creating and deploying a WAR to an existing web application server? Most folks build a self-contained JAR and deploy that in production.</z><z id="t1655750368" t="seancorfield We build uberjars that include the standard Ring Jetty adapter and use that in production."><y>#</y><d>2022-06-20</d><h>18:39</h><r>seancorfield</r>We build uberjars that include the standard Ring Jetty adapter and use that in production.</z><z id="t1655750382" t="James Amberger I am"><y>#</y><d>2022-06-20</d><h>18:39</h><r>James Amberger</r>I am</z><z id="t1655750386" t="seancorfield We were really glad to get away from Tomcat and WAR deployment..."><y>#</y><d>2022-06-20</d><h>18:39</h><r>seancorfield</r>We were really glad to get away from Tomcat and WAR deployment...</z><z id="t1655750432" t="seancorfield I&apos;m not aware of any WAR-building tools that work with deps.edn I&apos;m afraid..."><y>#</y><d>2022-06-20</d><h>18:40</h><r>seancorfield</r>I&apos;m not aware of any WAR-building tools that work with <code>deps.edn</code> I&apos;m afraid...</z><z id="t1655750447" t="James Amberger Tell me about it. I am at a public agency and the whole place is Oracle and Microsoft. They use lines and lines of Spring Boot just to route to the api and serve the JS for a front-end app."><y>#</y><d>2022-06-20</d><h>18:40</h><r>James Amberger</r>Tell me about it. I am at a public agency and the whole place is Oracle and Microsoft. They use lines and lines of Spring Boot just to route to the api and serve the JS for a front-end app.</z><z id="t1655750485" t="James Amberger Believe me, I‚Äôd rather do the devops etc myself"><y>#</y><d>2022-06-20</d><h>18:41</h><r>James Amberger</r>Believe me, I‚Äôd rather do the devops etc myself</z><z id="t1655751969" t="seancorfield Oh, yikes... you have my sympathy..."><y>#</y><d>2022-06-20</d><h>19:06</h><r>seancorfield</r>Oh, yikes... you have my sympathy...</z><z id="t1655752073" t="seancorfield I looked at https://github.com/clojure/tools.deps.alpha/wiki/Tools and it links to https://github.com/EwenG/badigeon which seems to build WAR files so maybe you could try that?"><y>#</y><d>2022-06-20</d><h>19:07</h><r>seancorfield</r>I looked at <a href="https://github.com/clojure/tools.deps.alpha/wiki/Tools" target="_blank">https://github.com/clojure/tools.deps.alpha/wiki/Tools</a> and it links to <a href="https://github.com/EwenG/badigeon" target="_blank">https://github.com/EwenG/badigeon</a> which seems to build WAR files so maybe you could try that?</z><z id="t1655753496" t="James Amberger Looks promising [:attrs {:href &quot;/_/_/users/U04V70XH6&quot;}] , thanks!"><y>#</y><d>2022-06-20</d><h>19:31</h><r>James Amberger</r>Looks promising <a>@U04V70XH6</a>, thanks!</z><z id="t1656351858" t="John Conti Any scuttlebutt on ring 2.0.0-alpha and the path to 2.0?"><y>#</y><d>2022-06-27</d><h>17:44</h><w>John Conti</w>Any scuttlebutt on ring 2.0.0-alpha and the path to 2.0?</z><z id="t1657242049" t="deep-symmetry Hello, everyone! I am seeing some strange behavior with jdbc-ring-session (using the ring-undertow-adapter and I am wondering if anyone might be able to help me explain and fix it, since I was up way past my bedtime to no avail last night. I have my cookies set to expire far in the future, and my browser is sending them just fine, and the session works great as long as my Clojure application stays up. I can see the row in the database, and I can see my browser sending the cookie. So far so good. (edited) But if I shut down the REPL/JVM, or run stop followed by start , the database entry for my session remains fine, but upon the next HTTP request from my browser (which still includes the right cookie), the session shrinks in the database (I assume it‚Äôs replaced by an empty session map) and I am confronted with the login page. Once I log in again, the session in the database grows back to the size it had before I bounced the server, and I regain access to the pages requiring authentication until I next bounce the server. Most peculiar! Where might I find the code that is clearing out sessions when receiving a new request after a server restart? I don‚Äôt want this, I want my sessions to last effectively forever. In case it helps, the code is at https://github.com/brunchboy/shade , and it is an application that will let me control my automated blinds from anywhere without paying the monthly highway robbery subscription the manufacturer wants for that capability, as well as letting guests control them in appropriate rooms, and will grow to have really cool visual features where you can set them by clicking on a photo of the room, and I will composite photos I took of the blinds in different configurations to show you the current state of the room."><y>#</y><d>2022-07-08</d><h>01:00</h><w>deep-symmetry</w>Hello, everyone! I am seeing some strange behavior with <code>jdbc-ring-session</code> (using the <code>ring-undertow-adapter</code> and I am wondering if anyone might be able to help me explain and fix it, since I was up way past my bedtime to no avail last night. I have my cookies set to expire far in the future, and my browser is sending them just fine, and the session works great as long as my Clojure application stays up. I can see the row in the database, and I can see my browser sending the cookie. So far so good. (edited)

But if I shut down the REPL/JVM, or run <code>stop</code> followed by <code>start</code>, the database entry for my session remains fine, but upon the next HTTP request from my browser (which still includes the right cookie), the session shrinks in the database (I assume it‚Äôs replaced by an empty session map) and I am confronted with the login page. Once I log in again, the session in the database grows back to the size it had before I bounced the server, and I regain access to the pages requiring authentication until I next bounce the server.

Most peculiar! Where might I find the code that is clearing out sessions when receiving a new request after a server restart? I don‚Äôt want this, I want my sessions to last effectively forever.

In case it helps, the code is at <a href="https://github.com/brunchboy/shade" target="_blank">https://github.com/brunchboy/shade</a>, and it is an application that will let me control my automated blinds from anywhere without paying the monthly highway robbery subscription the manufacturer wants for that capability, as well as letting guests control them in appropriate rooms, and will grow to have really cool visual features where you can set them by clicking on a photo of the room, and I will composite photos I took of the blinds in different configurations to show you the current state of the room.</z><z id="t1657247651" t="wevrem Are you expecting the session to persist after a server restart and it&apos;s not? What do you mean by ‚Äúthe session shrinks‚Äù? Is the session after the login the ‚Äúsame‚Äù as before? Or is it an entirely new session? Instead of a server restart can you test manually deleting the database entry and see if it is restored from the cookie on the next request? I don&apos;t really have an answer, I&apos;m just giving you the same questions I would ask myself to get started debugging. "><y>#</y><d>2022-07-08</d><h>02:34</h><r>wevrem</r>Are you expecting the session to persist after a server restart and it&apos;s not? What do you mean by ‚Äúthe session shrinks‚Äù? Is the session after the login the ‚Äúsame‚Äù as before? Or is it an entirely new session? Instead of a server restart can you test manually deleting the database entry and see if it is restored from the cookie on the next request?

I don&apos;t really have an answer, I&apos;m just giving you the same questions I would ask myself to get started debugging. </z><z id="t1657253935" t="deep-symmetry Your questions make perfect sense to me! üôÇ What I mean by ‚Äúthe session shrinks‚Äù is that the byte size of the opaque binary value in Postgres drops; I would not expect it to change at all from just trying to load the page I was on. I am not certain of the actual contents, because I don‚Äôt know how to mentally parse a binary nippy column. I expect that if I delete it from the database I will end up in a similar state, let me try. My cookie stores only the session id, not any of its contents."><y>#</y><d>2022-07-08</d><h>04:18</h><r>deep-symmetry</r>Your questions make perfect sense to me! <b>üôÇ</b> What I mean by ‚Äúthe session shrinks‚Äù is that the byte size of the opaque binary value in Postgres drops; I would not expect it to change at all from just trying to load the page I was on. I am not certain of the actual contents, because I don‚Äôt know how to mentally parse a binary nippy column. I expect that if I delete it from the database I will end up in a similar state, let me try. My cookie stores only the session id, not any of its contents.</z><z id="t1657253961" t="deep-symmetry OK, that is strange. When I delete the session from the database and reload the page, I am still logged in. So the session middleware is not hitting the database again."><y>#</y><d>2022-07-08</d><h>04:19</h><r>deep-symmetry</r>OK, that is strange. When I delete the session from the database and reload the page, I am still logged in. So the session middleware is not hitting the database again.</z><z id="t1657253977" t="deep-symmetry This is starting to look to me as though the middleware is only writing to the database, and never reading values from it."><y>#</y><d>2022-07-08</d><h>04:19</h><r>deep-symmetry</r>This is starting to look to me as though the middleware is only writing to the database, and never reading values from it.</z><z id="t1657255047" t="deep-symmetry And I can confirm that even though the database row stays there when I stop and restart the server, my session is nil after a server restart."><y>#</y><d>2022-07-08</d><h>04:37</h><r>deep-symmetry</r>And I can confirm that even though the database row stays there when I stop and restart the server, my <code>session</code> is <code>nil</code> after a server restart.</z><z id="t1657285239" t="wevrem Something else to consider is how often do you expect this to happen? Are you going to be restarting the server that often, and is it seldom enough that requiring re-login is okay?"><y>#</y><d>2022-07-08</d><h>13:00</h><r>wevrem</r>Something else to consider is how often do you expect this to happen? Are you going to be restarting the server that often, and is it seldom enough that requiring re-login is okay?</z><z id="t1657298707" t="deep-symmetry I don‚Äôt see why that is something to consider at all, [:attrs {:href &quot;/_/_/users/UTFAPNRPT&quot;}] ? The entire point of having installed and configured the JDBC session adapter is so that sessions are in the database and survive past a server restart. If I did not want that, I could just use in-memory sessions and be done with it. I am asking how to make database-backed sessions work at all. If they don‚Äôt work, there is no value to that project‚Äôs existence. There must be a way to make them work."><y>#</y><d>2022-07-08</d><h>16:45</h><r>deep-symmetry</r>I don‚Äôt see why that is something to consider at all, <a>@UTFAPNRPT</a>? The entire point of having installed and configured the JDBC session adapter is so that sessions are in the database and survive past a server restart. If I did not want that, I could just use in-memory sessions and be done with it. I am asking how to make database-backed sessions work at all. If they don‚Äôt work, there is no value to that project‚Äôs existence. There must be a way to make them work.</z><z id="t1657300341" t="wevrem Well, one reason to use a database (and it seems to be the main one for you) is to persist sessions through a restart, yes. But it‚Äôs not the only one. There are others: performance, multiple servers, custom session logic. And some might want to use a database for those benefits but still want sessions not to persist, because then restarting the server is a simple way to invalidate existing sessions. I don‚Äôt use sessions that way (I go with JWT instead), so I can‚Äôt help you further, but I wish you luck."><y>#</y><d>2022-07-08</d><h>17:12</h><r>wevrem</r>Well, one reason to use a database (and it seems to be the main one for you) is to persist sessions through a restart, yes. But it‚Äôs not the only one. There are others: performance, multiple servers, custom session logic. And some might want to use a database for those benefits but still want sessions not to persist, because then restarting the server is a simple way to invalidate existing sessions.

I don‚Äôt use sessions that way (I go with JWT instead), so I can‚Äôt help you further, but I wish you luck.</z><z id="t1657306073" t="deep-symmetry Right, in my case performance isn‚Äôt an issue, nor will there be multiple servers; this is a home project, for us and our friends/guests/pet sitters. My only goal in using a database is to have sessions survive server restarts. Anyone have any ideas who might know how to make that happen with this JDBC session implementation?"><y>#</y><d>2022-07-08</d><h>18:47</h><r>deep-symmetry</r>Right, in my case performance isn‚Äôt an issue, nor will there be multiple servers; this is a home project, for us and our friends/guests/pet sitters. My only goal in using a database is to have sessions survive server restarts. Anyone have any ideas who might know how to make that happen with this JDBC session implementation?</z><z id="t1657393860" t="deep-symmetry I opened an issue on the jdbc-ring-session repository and yogthos was kind enough to identify the problem. Somehow in following the sample code I had ended up with two session wrappers that were battling each other. Getting rid of the extra one made things work the way I had intended. Here are the details if anyone is struggling with something similar: https://github.com/luminus-framework/jdbc-ring-session/issues/19"><y>#</y><d>2022-07-09</d><h>19:11</h><r>deep-symmetry</r>I opened an issue on the <code>jdbc-ring-session</code> repository and yogthos was kind enough to identify the problem. Somehow in following the sample code I had ended up with two session wrappers that were battling each other. Getting rid of the extra one made things work the way I had intended. Here are the details if anyone is struggling with something similar: <a href="https://github.com/luminus-framework/jdbc-ring-session/issues/19" target="_blank">https://github.com/luminus-framework/jdbc-ring-session/issues/19</a></z><z id="t1657538134" t="ozzymcduff Hi! For those of us that write Web API. How are you doing API versioning? In Java the simple way is to provide different types that are returned from a Web API that get serialised into the appropriate JSON (using standard reflection based serialisation such as Jackson). How do you write API versions with different data formats?"><y>#</y><d>2022-07-11</d><h>11:15</h><w>ozzymcduff</w>Hi! For those of us that write Web API. How are you doing API versioning? In Java the simple way is to provide different types that are returned from a Web API that get serialised into the appropriate JSON (using standard reflection based serialisation such as Jackson). How do you write API versions with different data formats?</z><z id="t1657598440" t="Ben Sless You can use a multi schema which dispatches on the version"><y>#</y><d>2022-07-12</d><h>04:00</h><r>Ben Sless</r>You can use a multi schema which dispatches on the version</z></g><g id="s9"><z id="t1657619258" t="ozzymcduff Thanks, I‚Äôll look into it üôÇ"><y>#</y><d>2022-07-12</d><h>09:47</h><r>ozzymcduff</r>Thanks, I‚Äôll look into it <b>üôÇ</b></z><z id="t1657924589" t="colinkahn Hi, I&apos;m using a StreamingResponseBody to stream a CSV from a ring handler. There&apos;s a failure case where the client could terminate the connection, and I&apos;m wondering how to detect that. My reason is that I would like to potentially use core.async in the StreamingResponseBody write-body-to-stream method, buffering some data and writing it at an interval and I&apos;d like to know if the connection is terminated so I can close the async chan / stop any go-loops."><y>#</y><d>2022-07-15</d><h>22:36</h><w>colinkahn</w>Hi, I&apos;m using a <code>StreamingResponseBody</code> to stream a CSV from a ring handler. There&apos;s a failure case where the client could terminate the connection, and I&apos;m wondering how to detect that. My reason is that I would like to potentially use core.async in the <code>StreamingResponseBody</code> <code>write-body-to-stream</code> method, buffering some data and writing it at an interval and I&apos;d like to know if the connection is terminated so I can close the async chan /  stop any go-loops.</z><z id="t1658353769" t="timothypratley Hi üôÇ Is there a way to ask ring to serve static files named like page.html from url /page ? (i.e.: drop the &quot;.html&quot; from filenames it finds in resources/public)"><y>#</y><d>2022-07-20</d><h>21:49</h><w>timothypratley</w>Hi <b>üôÇ</b> Is there a way to ask ring to serve static files named like <code>page.html</code> from url <code>/page</code> ? (i.e.: drop the &quot;.html&quot; from filenames it finds in resources/public)</z><z id="t1658814894" t="Jacob Rosenzweig Anyway to get :multipart-form coercion in Ring?"><y>#</y><d>2022-07-26</d><h>05:54</h><w>Jacob Rosenzweig</w>Anyway to get :multipart-form coercion in Ring?</z><z id="t1659260249" t="ossoso Hello, could someone share an example of using the configurator entry in run-jetty &apos;s options. For context: I&apos;m trying to reduce logging during load testing."><y>#</y><d>2022-07-31</d><h>09:37</h><w>ossoso</w>Hello, could someone share an example of using the <code>configurator</code> entry in <code>run-jetty</code> &apos;s options. For context: I&apos;m trying to reduce logging during load testing.</z><z id="t1659262554" t="ossoso ring-jetty-adapter 1.7.1 using jetty 9 it seems."><y>#</y><d>2022-07-31</d><h>10:15</h><r>ossoso</r>ring-jetty-adapter 1.7.1 using jetty 9 it seems.</z><z id="t1659272467" t="ossoso Added the following in my deps.edn definitions: :jvm-opts [&quot;-Dorg.eclipse.jetty.util.log.class=org.eclipse.jetty.util.log.Slf4jLog&quot; &quot;-Dorg.eclipse.jetty.LEVEL=OFF&quot;] "><y>#</y><d>2022-07-31</d><h>13:01</h><r>ossoso</r>Added the following in my deps.edn definitions:
<pre>:jvm-opts [&quot;-Dorg.eclipse.jetty.util.log.class=org.eclipse.jetty.util.log.Slf4jLog&quot;
           &quot;-Dorg.eclipse.jetty.LEVEL=OFF&quot;]</pre>
</z><z id="t1660744837" t="J√©r√©mie Salvucci Hi, I&apos;m using http-kit with ring and reitit to make an api and I&apos;d like to test my main handler. I&apos;ve seen that clojure.test + ring-mock was a thing to do unit testing. Is there anything else to perform this?"><y>#</y><d>2022-08-17</d><h>14:00</h><w>J√©r√©mie Salvucci</w>Hi, I&apos;m using http-kit with ring and reitit to make an api and I&apos;d like to test my main handler. I&apos;ve seen that clojure.test + ring-mock was a thing to do unit testing. Is there anything else to perform this?</z><z id="t1660827220" t="Ferdinand Beyer Why are you looking for something else? It is hard to answer. There are alternatives to clojure.test such as midje, but it is not clear what exactly you want to know? In theory a ring handler is just an ordinary function, so you don‚Äôt need special tooling to test it. ring-mock definitely helps as it is a bit tedious to generate request maps your self."><y>#</y><d>2022-08-18</d><h>12:53</h><r>Ferdinand Beyer</r>Why are you looking for something else?

It is hard to answer. There are alternatives to clojure.test such as midje, but it is not clear what exactly you want to know?

In theory a ring handler is just an ordinary function, so you don‚Äôt need special tooling to test it. <code>ring-mock</code> definitely helps as it is a bit tedious to generate request maps your self.</z><z id="t1660903018" t="J√©r√©mie Salvucci Oh, I just wanted to know if the following way of doing things was reasonable given the current state of the Clojure ecosystem (ring and http-kit related)"><y>#</y><d>2022-08-19</d><h>09:56</h><r>J√©r√©mie Salvucci</r>Oh, I just wanted to know if the following way of doing things was reasonable given the current state of the Clojure ecosystem (ring and http-kit related)</z><z id="t1660903099" t="J√©r√©mie Salvucci Yes, generating requests is a bit tedious, so this ring-mock is useful, but maybe there is some other nice tools I&apos;m not aware of related to handler testing, etc."><y>#</y><d>2022-08-19</d><h>09:58</h><r>J√©r√©mie Salvucci</r>Yes, generating requests is a bit tedious, so this ring-mock is useful, but maybe there is some other nice tools I&apos;m not aware of related to handler testing, etc.</z><z id="t1662628076" t="Eugen hi, any ideas how far away is ring2 ? is there a way to get ring-2 releases out for testing - as snapshots or alpha ?"><y>#</y><d>2022-09-08</d><h>09:07</h><w>Eugen</w>hi, any ideas how far away is ring2 ?
 is there a way to get ring-2 releases out for testing - as snapshots or alpha ?</z><z id="t1662637729" t="mpenet not sure, it seems somewhat stalled: https://github.com/ring-clojure/ring/issues/393"><y>#</y><d>2022-09-08</d><h>11:48</h><w>mpenet</w>not sure, it seems somewhat stalled: <a href="https://github.com/ring-clojure/ring/issues/393" target="_blank">https://github.com/ring-clojure/ring/issues/393</a></z><z id="t1662638746" t="Eugen thanks [:attrs {:href &quot;/_/_/users/U050SC7SV&quot;}] . Anyone know anything about James and / or the project ?"><y>#</y><d>2022-09-08</d><h>12:05</h><w>Eugen</w>thanks <a>@mpenet</a>.

Anyone know anything about James and / or the project ?</z><z id="t1662746392" t="weavejester Unfortunately I haven‚Äôt had much time for Clojure open source development so far this year."><y>#</y><d>2022-09-09</d><h>17:59</h><r>weavejester</r>Unfortunately I haven‚Äôt had much time for Clojure open source development so far this year.</z><z id="t1662746507" t="Eugen hi, I hope all is good."><y>#</y><d>2022-09-09</d><h>18:01</h><r>Eugen</r>hi, I hope all is good.</z><z id="t1662746598" t="Eugen I don&apos;t know about who is involved in the project but. Is there Someone else to take it on when you are not available?"><y>#</y><d>2022-09-09</d><h>18:03</h><r>Eugen</r>I don&apos;t know about who is involved in the project but. Is there Someone else to take it on when you are not available?</z><z id="t1662746708" t="weavejester No-one has volunteered."><y>#</y><d>2022-09-09</d><h>18:05</h><r>weavejester</r>No-one has volunteered.</z><z id="t1662746773" t="Eugen hmm, large shoes to fit maybe (I hope I got the saying good). do they know they can step in ?"><y>#</y><d>2022-09-09</d><h>18:06</h><r>Eugen</r>hmm, large shoes to fit maybe (I hope I got the saying good).

do they know they can step in ?</z><z id="t1662746834" t="weavejester It‚Äôs an open source project, and I get pull requests, so I assume so."><y>#</y><d>2022-09-09</d><h>18:07</h><r>weavejester</r>It‚Äôs an open source project, and I get pull requests, so I assume so.</z><z id="t1662746870" t="Eugen yeah ...."><y>#</y><d>2022-09-09</d><h>18:07</h><r>Eugen</r>yeah ....</z><z id="t1662746898" t="weavejester I‚Äôm hoping to have more time later in the year. It‚Äôs been a combination of real-world renovations and burnout that has kept me from doing more than merging and reviewing PRs."><y>#</y><d>2022-09-09</d><h>18:08</h><r>weavejester</r>I‚Äôm hoping to have more time later in the year. It‚Äôs been a combination of real-world renovations and burnout that has kept me from doing more than merging and reviewing PRs.</z><z id="t1662746923" t="Eugen yeah, take care of yourself."><y>#</y><d>2022-09-09</d><h>18:08</h><r>Eugen</r>yeah, take care of yourself.</z><z id="t1662746934" t="weavejester Thanks üôÇ - you too."><y>#</y><d>2022-09-09</d><h>18:08</h><r>weavejester</r>Thanks <b>üôÇ</b> - you too.</z><z id="t1662746952" t="Eugen maybe it will help to let people know that they take a shot at this"><y>#</y><d>2022-09-09</d><h>18:09</h><r>Eugen</r>maybe it will help to let people know that they take a shot at this</z><z id="t1662746997" t="Eugen as people, we sometimes lean on others to do the work, esp. if they are doing a great job"><y>#</y><d>2022-09-09</d><h>18:09</h><r>Eugen</r>as people, we sometimes lean on others to do the work, esp. if they are doing a great job</z><z id="t1662747004" t="weavejester A shot at what? Development of 2.0?"><y>#</y><d>2022-09-09</d><h>18:10</h><r>weavejester</r>A shot at what? Development of 2.0?</z><z id="t1662747010" t="Eugen and you seem to have a great track reckord üôÇ"><y>#</y><d>2022-09-09</d><h>18:10</h><r>Eugen</r>and you seem to have a great track reckord <b>üôÇ</b></z><z id="t1662747017" t="Eugen yeah, 2.0"><y>#</y><d>2022-09-09</d><h>18:10</h><r>Eugen</r>yeah, 2.0</z><z id="t1662747111" t="Eugen I would like to contribute jetty adapter for jetty-10 and 11 if possible"><y>#</y><d>2022-09-09</d><h>18:11</h><r>Eugen</r>I would like to contribute jetty adapter for jetty-10 and 11 if possible</z><z id="t1662747165" t="weavejester Realistically, 2.0 development would require collaboration with me anyway. It would be a lot of discussions in order to nail down the final design."><y>#</y><d>2022-09-09</d><h>18:12</h><r>weavejester</r>Realistically, 2.0 development would require collaboration with me anyway. It would be a lot of discussions in order to nail down the final design.</z><z id="t1662747219" t="weavejester There‚Äôs already a project for a Ring adapter for Jetty 10. And if you want to make one for Jetty 11, that‚Äôs fine by me, too."><y>#</y><d>2022-09-09</d><h>18:13</h><r>weavejester</r>There‚Äôs already a project for a Ring adapter for Jetty 10. And if you want to make one for Jetty 11, that‚Äôs fine by me, too.</z><z id="t1662747231" t="Eugen I kind of had that impression - the spec is really well designed IMO - seems like a lot of thought went into it"><y>#</y><d>2022-09-09</d><h>18:13</h><r>Eugen</r>I kind of had that impression - the spec is really well designed IMO - seems like a lot of thought went into it</z><z id="t1662747328" t="Eugen hmmm, I missed the jetty-10 adapter"><y>#</y><d>2022-09-09</d><h>18:15</h><r>Eugen</r>hmmm, I missed the jetty-10 adapter</z><z id="t1662747344" t="weavejester Confusingly, it‚Äôs called the Jetty 9 adapter."><y>#</y><d>2022-09-09</d><h>18:15</h><r>weavejester</r>Confusingly, it‚Äôs called the Jetty 9 adapter.</z><z id="t1662747643" t="Eugen üôÇ ok. I think I found it https://github.com/sunng87/ring-jetty9-adapter ."><y>#</y><d>2022-09-09</d><h>18:20</h><r>Eugen</r><b>üôÇ</b> ok. I think I found it <a href="https://github.com/sunng87/ring-jetty9-adapter" target="_blank">https://github.com/sunng87/ring-jetty9-adapter</a> .</z><z id="t1662747683" t="Eugen thanks, take care and hope we see you back when you decide it&apos;s time üôÇ"><y>#</y><d>2022-09-09</d><h>18:21</h><r>Eugen</r>thanks, take care and hope we see you back when you decide it&apos;s time <b>üôÇ</b></z><z id="t1662789533" t="mpenet I would gladly help move 2 fwd (I am sure I am not the only one willing). In any case it&apos;s mostly about defining a new spec, supporting it on adapters is secondary and relatively easy (I did it for jetty 11+ on a personal project). Working on a final spec for something as important as ring should probably be done by a group of people and pass a very high bar of confidence before it&apos;s considered final."><y>#</y><d>2022-09-10</d><h>05:58</h><r>mpenet</r>I would gladly help move 2 fwd (I am sure I am not the only one willing). In any case it&apos;s mostly about defining a new spec, supporting it on adapters is secondary and relatively easy (I did it for jetty 11+ on a personal project).
Working on a final spec for something as important as ring should probably be done by a group of people and pass a very high bar of confidence before it&apos;s considered final.</z><z id="t1663137607" t="Ben Sless Adding on the last point, do you think there&apos;s place to create an official ring work group?"><y>#</y><d>2022-09-14</d><h>06:40</h><r>Ben Sless</r>Adding on the last point, do you think there&apos;s place to create an official ring work group?</z><z id="t1663138342" t="mpenet It would make sense"><y>#</y><d>2022-09-14</d><h>06:52</h><r>mpenet</r>It would make sense</z><z id="t1663138439" t="Eugen I&apos;m interested in this as well, willing to help out as I can"><y>#</y><d>2022-09-14</d><h>06:53</h><r>Eugen</r>I&apos;m interested in this as well, willing to help out as I can</z><z id="t1663146871" t="Ben Sless Cc [:attrs {:href &quot;/_/_/users/U055NJ5CC&quot;}]"><y>#</y><d>2022-09-14</d><h>09:14</h><r>Ben Sless</r>Cc <a>@U055NJ5CC</a></z><z id="t1663512227" t="ikitommi &gt; ‚Ä¶ and burnout that has kept me from doing more than merging and reviewing PRs. sorry to hear that, take care. renovations üëç"><y>#</y><d>2022-09-18</d><h>14:43</h><r>ikitommi</r>&gt; ‚Ä¶ and burnout that has kept me from doing more than merging and reviewing PRs.
sorry to hear that, take care. renovations <b>üëç</b></z><z id="t1663512443" t="ikitommi not sure how much time I would have on work group, but definitely curious. I‚Äôm really happy with current non-namespaced ring (1) model, so not eagerly waiting for 2.0. But as it seems everyone else is excited and we have a lot of os-libs on top of ring, I‚Äôm all ears and happy to contribute if possible."><y>#</y><d>2022-09-18</d><h>14:47</h><r>ikitommi</r>not sure how much time I would have on work group, but definitely curious. I‚Äôm really happy with current non-namespaced ring (1) model, so not eagerly waiting for 2.0. But as it seems everyone else is excited and we have a lot of os-libs on top of ring, I‚Äôm all ears and happy to contribute if possible.</z><z id="t1663132790" t="OknoLombarda Hi, I have a problem setting a cookie with &quot;expires&quot; attribute (assoc (response/ok) :cookies {&quot;hehe&quot; {:expires &quot;2022-10-14T03:26:52.000Z&quot; :value &quot;eheheeheh&quot;}}) Using this code, the cookie gets set, but the &quot;expires&quot; attribute is just ignored. Why does this happen? How can I debug it? I use default ring middleware"><y>#</y><d>2022-09-14</d><h>05:19</h><w>OknoLombarda</w>Hi, I have a problem setting a cookie with &quot;expires&quot; attribute
<pre>(assoc (response/ok)
       :cookies {&quot;hehe&quot; {:expires &quot;2022-10-14T03:26:52.000Z&quot;
                         :value &quot;eheheeheh&quot;}})</pre>
Using this code, the cookie gets set, but the &quot;expires&quot; attribute is just ignored. Why does this happen? How can I debug it? I use default ring middleware</z><z id="t1663133835" t="hiredman Browser is likely ignoring the date because it is not the right format for cookies"><y>#</y><d>2022-09-14</d><h>05:37</h><r>hiredman</r>Browser is likely ignoring the date because it is not the right format for cookies</z><z id="t1663133906" t="hiredman https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Set-Cookie has a section on expires with a link to a place that talks about how those dates are formatted"><y>#</y><d>2022-09-14</d><h>05:38</h><r>hiredman</r><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Set-Cookie" target="_blank">https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Set-Cookie</a> has a section on expires with a link to a place that talks about how those dates are formatted</z><z id="t1663133996" t="hiredman If joda time is available, ring also supports passing a joda datetime instead of a string, and you can see how it formats those https://github.com/ring-clojure/ring/blob/master/ring-core/src/ring/middleware/cookies.clj#L84"><y>#</y><d>2022-09-14</d><h>05:39</h><r>hiredman</r>If joda time is available, ring also supports passing a joda datetime instead of a string, and you can see how it formats those <a href="https://github.com/ring-clojure/ring/blob/master/ring-core/src/ring/middleware/cookies.clj#L84" target="_blank">https://github.com/ring-clojure/ring/blob/master/ring-core/src/ring/middleware/cookies.clj#L84</a></z><z id="t1663134074" t="hiredman Oh, it supports a java.time zoneddatetime, so just use one of those https://github.com/ring-clojure/ring/blob/master/ring-core/src/ring/middleware/cookies.clj#L101"><y>#</y><d>2022-09-14</d><h>05:41</h><r>hiredman</r>Oh, it supports a java.time zoneddatetime, so just use one of those <a href="https://github.com/ring-clojure/ring/blob/master/ring-core/src/ring/middleware/cookies.clj#L101" target="_blank">https://github.com/ring-clojure/ring/blob/master/ring-core/src/ring/middleware/cookies.clj#L101</a></z><z id="t1663134487" t="OknoLombarda yeah, ZonedDateTime worked. Thank you, I&apos;ve spent a few hours trying different things, going through source code before asking (‚ïØ Õ°¬∞ Õú ñ Õ°¬∞Ôºâ‚ïØÔ∏µ ‚îª‚îÅ‚îª"><y>#</y><d>2022-09-14</d><h>05:48</h><r>OknoLombarda</r>yeah, ZonedDateTime worked. Thank you, I&apos;ve spent a few hours trying different things, going through source code before asking <code>(‚ïØ Õ°¬∞ Õú ñ Õ°¬∞Ôºâ‚ïØÔ∏µ ‚îª‚îÅ‚îª</code></z><z id="t1665557672" t="aaron51 Using Ring 1.9.6 &amp; Jetty, what‚Äôs the easiest way to emit server-sent events? Ideally without a new dependency https://developer.mozilla.org/en-US/docs/Web/API/Server-sent_events/Using_server-sent_events"><y>#</y><d>2022-10-12</d><h>06:54</h><w>aaron51</w>Using Ring 1.9.6 &amp; Jetty, what‚Äôs the easiest way to emit server-sent events? Ideally without a new dependency

<a href="https://developer.mozilla.org/en-US/docs/Web/API/Server-sent_events/Using_server-sent_events" target="_blank">https://developer.mozilla.org/en-US/docs/Web/API/Server-sent_events/Using_server-sent_events</a></z><z id="t1665558066" t="aaron51 Maybe the easiest way is to switch to http-kit? https://http-kit.github.io/server.html#async"><y>#</y><d>2022-10-12</d><h>07:01</h><r>aaron51</r>Maybe the easiest way is to switch to http-kit? <a href="https://http-kit.github.io/server.html#async" target="_blank">https://http-kit.github.io/server.html#async</a></z><z id="t1665558066" t="aaron51 Maybe the easiest way is to switch to http-kit? https://http-kit.github.io/server.html#async"><y>#</y><d>2022-10-12</d><h>07:01</h><w>aaron51</w>Maybe the easiest way is to switch to http-kit? <a href="https://http-kit.github.io/server.html#async" target="_blank">https://http-kit.github.io/server.html#async</a></z><z id="t1666629403" t="John Conti Does anyone use async ring defined in 2.0? https://clojurians.slack.com/archives/C0A5GSC6T/p1656351858486039"><y>#</y><d>2022-10-24</d><h>16:36</h><w>John Conti</w>Does anyone use async ring defined in 2.0? <a href="https://clojurians.slack.com/archives/C0A5GSC6T/p1656351858486039" target="_blank">https://clojurians.slack.com/archives/C0A5GSC6T/p1656351858486039</a></z><z id="t1666849548" t="hifumi123 How would I wrap a handler&apos;s response body with a delay ? I want to be able to use the wrap-head middleware without paying the full cost of responding to a GET request. Searching online, I found out that one way to do this was to wrap the response body in a delay, but I don&apos;t see how this helps,"><y>#</y><d>2022-10-27</d><h>05:45</h><w>hifumi123</w>How would I wrap a handler&apos;s response body with a <code>delay</code> ? I want to be able to use the <code>wrap-head</code> middleware without paying the full cost of responding to a GET request. Searching online, I found out that one way to do this was to wrap the response body in a delay, but I don&apos;t see how this helps,</z><z id="t1667009863" t="weavejester You can wrap the body in a delay, and then extend the StreamableResponseBody protocol to resolve it."><y>#</y><d>2022-10-29</d><h>02:17</h><r>weavejester</r>You can wrap the body in a delay, and then extend the <code>StreamableResponseBody</code> protocol to resolve it.</z><z id="t1667250573" t="hifumi123 Huh. I was trying to do exactly this but I kept getting &quot;Body class not supported&quot;. Turns out my Ring adapter does not conform to the spec, but extending its own RespondBody protocol did the trick. Thanks for the help!"><y>#</y><d>2022-10-31</d><h>21:09</h><r>hifumi123</r>Huh. I was trying to do exactly this but I kept getting &quot;Body class not supported&quot;. Turns out my Ring adapter does not conform to the spec, but extending its own <code>RespondBody</code> protocol did the trick. Thanks for the help!</z><z id="t1667551718" t="weavejester Which Ring adapter are you using, out of interest?"><y>#</y><d>2022-11-04</d><h>08:48</h><r>weavejester</r>Which Ring adapter are you using, out of interest?</z><z id="t1667573923" t="hifumi123 [luminus/ring-undertow-adapter &quot;1.2.8&quot;] I do not use the luminus framework; but I do make use of this ring adapter"><y>#</y><d>2022-11-04</d><h>14:58</h><r>hifumi123</r><code>[luminus/ring-undertow-adapter &quot;1.2.8&quot;]</code>
I do not use the luminus framework; but I do make use of this ring adapter</z><z id="t1667247300" t="aaron51 I‚Äôm trying to get the content-type of a string part of a multipart request. ring.middleware.multipart-params seems to discard this for strings. Guess I will have to parse the original request body separately to get the content-type ? (I hope the request :body can be read more than once‚Ä¶?) (`curl -F &quot;paramName=paramValue;type=text/plain&quot; url`)"><y>#</y><d>2022-10-31</d><h>20:15</h><w>aaron51</w>I‚Äôm trying to get the <code>content-type</code> of a string part of a multipart request. <code>ring.middleware.multipart-params</code> seems to discard this for strings.

Guess I will have to parse the original request body separately to get the <code>content-type</code>? (I hope the request <code>:body</code> can be read more than once‚Ä¶?)

(`curl -F &quot;paramName=paramValue;type=text/plain&quot; url`)</z><z id="t1667341338" t="weavejester I&apos;m not sure what you mean by &quot;seems to discard this for strings&quot;. The content type is passed to the store under the :content-type key."><y>#</y><d>2022-11-01</d><h>22:22</h><r>weavejester</r>I&apos;m not sure what you mean by &quot;seems to discard this for strings&quot;. The content type is passed to the store under the <code>:content-type</code> key.</z><z id="t1667341591" t="weavejester Ah, re-reading it I think I know what you mean. Yes, currently non-stream values don&apos;t keep the content type. I&apos;d accept a PR to provide an additional option to change that (disabled by default so as to maintain compatibility)."><y>#</y><d>2022-11-01</d><h>22:26</h><r>weavejester</r>Ah, re-reading it I think I know what you mean. Yes, currently non-stream values don&apos;t keep the content type. I&apos;d accept a PR to provide an additional option to change that (disabled by default so as to maintain compatibility).</z><z id="t1667356116" t="aaron51 Thank you [:attrs {:href &quot;/_/_/users/U0BKWMG5B&quot;}] ! What do you think about this‚Ä¶ ‚Ä¢ Adding :content-type to the map on https://github.com/ring-clojure/ring/blob/8af4ab93190dfe5b4827c14b416a4cb92e18cdaf/ring-core/src/ring/middleware/multipart_params.clj#L82 ‚Ä¢ Skipping decode-string-values when (= :bytes (:encoding options)) So if encoding is :bytes, fields wouldn‚Äôt be decoded, instead returned as maps with byte arrays and the content-type. If this sounds OK I can send a PR."><y>#</y><d>2022-11-02</d><h>02:28</h><r>aaron51</r>Thank you <a>@U0BKWMG5B</a>!

What do you think about this‚Ä¶

‚Ä¢ Adding <code>:content-type</code> to the map on <a href="https://github.com/ring-clojure/ring/blob/8af4ab93190dfe5b4827c14b416a4cb92e18cdaf/ring-core/src/ring/middleware/multipart_params.clj#L82" target="_blank">https://github.com/ring-clojure/ring/blob/8af4ab93190dfe5b4827c14b416a4cb92e18cdaf/ring-core/src/ring/middleware/multipart_params.clj#L82</a>
‚Ä¢ Skipping <code>decode-string-values</code> when <code>(= :bytes (:encoding options))</code>
So if encoding is :bytes, fields wouldn‚Äôt be decoded, instead returned as maps with byte arrays and the content-type.

If this sounds OK I can send a PR.</z><z id="t1667408270" t="aaron51 On second thought, maybe I should just use org.apache.commons.fileupload directly and not use this middleware, since this may not be a common requirement"><y>#</y><d>2022-11-02</d><h>16:57</h><r>aaron51</r>On second thought, maybe I should just use <code>org.apache.commons.fileupload</code> directly and not use this middleware, since this may not be a common requirement</z><z id="t1667527539" t="aaron51 On third thought, org.synchronoss.cloud/nio-multipart-parser looks like just the thing"><y>#</y><d>2022-11-04</d><h>02:05</h><r>aaron51</r>On third thought, <code>org.synchronoss.cloud/nio-multipart-parser</code> looks like just the thing</z><z id="t1668878128" t="seancorfield Based on comments in https://github.com/ring-clojure/ring/issues/439 I get the impression that the built-in Jetty 9 adapter is considered stable but deprecated (it&apos;s out of community support, since June, and there doesn&apos;t seem to be the will/bandwidth to update the built-in adapter to Jetty 10 or 11)? At work we&apos;ve switched to https://github.com/sunng87/ring-jetty9-adapter (with Jetty 11, and we&apos;re leveraging the -- very nice -- WebSocket support in that adapter). We&apos;ve also used http-kit (but switched back to Jetty due to poor support in New Relic for http-kit). What are folks generally doing these days as far as an HTTP server to use with Ring? Are people still comfortable with the built-in Jetty 9 adapter? In the sunng adapter considered the de factor Jetty standard now?"><y>#</y><d>2022-11-19</d><h>17:15</h><w>seancorfield</w>Based on comments in <a href="https://github.com/ring-clojure/ring/issues/439" target="_blank">https://github.com/ring-clojure/ring/issues/439</a> I get the impression that the built-in Jetty 9 adapter is considered stable but deprecated (it&apos;s out of community support, since June, and there doesn&apos;t seem to be the will/bandwidth to update the built-in adapter to Jetty 10 or 11)?

At work we&apos;ve switched to <a href="https://github.com/sunng87/ring-jetty9-adapter" target="_blank">https://github.com/sunng87/ring-jetty9-adapter</a> (with Jetty 11, and we&apos;re leveraging the -- very nice -- WebSocket support in that adapter). We&apos;ve also used http-kit (but switched back to Jetty due to poor support in New Relic for http-kit).

What are folks generally doing these days as far as an HTTP server to use with Ring? Are people still comfortable with the built-in Jetty 9 adapter? In the sunng adapter considered the de factor Jetty standard now?</z><z id="t1668878679" t="Apple kit-clj defaults to undertow"><y>#</y><d>2022-11-19</d><h>17:24</h><r>Apple</r>kit-clj defaults to undertow</z><z id="t1668879229" t="seancorfield Ah, I&apos;d completely forgotten there was a standalone Undertow adapter -- when Immutant (the Clojure/JBoss setup) went idle about five years ago, I sort of assumed everyone had stopped using Undertow. Probably because I&apos;ve paid zero attention to Luminus (or Kit)."><y>#</y><d>2022-11-19</d><h>17:33</h><r>seancorfield</r>Ah, I&apos;d completely forgotten there was a standalone Undertow adapter -- when Immutant (the Clojure/JBoss setup) went idle about five years ago, I sort of assumed everyone had stopped using Undertow. Probably because I&apos;ve paid zero attention to Luminus (or Kit).</z><z id="t1668915163" t="hifumi123 I&apos;ve been using ring-undertow-adapter (although it&apos;s from luminus, I do not use luminus framework at all). I&apos;ve given up on using the default jetty 9 adapter because I&apos;m not constrained by java 8 whatsoever, and the undertow adapter gives me exactly the functionality and performance I want."><y>#</y><d>2022-11-20</d><h>03:32</h><r>hifumi123</r>I&apos;ve been using ring-undertow-adapter (although it&apos;s from luminus, I do not use luminus framework at all). I&apos;ve given up on using the default jetty 9 adapter because I&apos;m not constrained by java 8 whatsoever, and the undertow adapter gives me exactly the functionality and performance I want.</z><z id="t1669112896" t="dergutemoritz Aleph here - since it&apos;s been revived by clj-commons it&apos;s a pretty good choice again IMHO"><y>#</y><d>2022-11-22</d><h>10:28</h><r>dergutemoritz</r>Aleph here - since it&apos;s been revived by <code>clj-commons</code> it&apos;s a pretty good choice again IMHO</z><z id="t1669138492" t="Eugen we are looking at Jetty 10/11 - since there are servlet web apps we would like to use"><y>#</y><d>2022-11-22</d><h>17:34</h><r>Eugen</r>we are looking at Jetty 10/11 - since there are servlet web apps we would like to use</z><z id="t1669138512" t="Eugen pedestal is also receiving some TLC, they released a maintenance version for jetty 9.x and planning to do a release with Jetty 10/11"><y>#</y><d>2022-11-22</d><h>17:35</h><r>Eugen</r>pedestal is also receiving some TLC, they released a maintenance version for jetty 9.x and planning to do a release with Jetty 10/11</z><z id="t1670197761" t="Eugen hi, what is an up to date libary for auth that works with MS Azure AD Apps (Open ID connect) ?"><y>#</y><d>2022-12-04</d><h>23:49</h><w>Eugen</w>hi, what is an up to date libary for auth that works with MS Azure AD Apps (Open ID connect)  ?</z><z id="t1670367245" t="Eugen I ended up deploying traefik with oauth2-proxy. another option would be to use the MSAL java library to handle it in the app"><y>#</y><d>2022-12-06</d><h>22:54</h><r>Eugen</r>I ended up deploying traefik with oauth2-proxy.  another option would be to use the MSAL java library to handle it in the app</z><z id="t1670396392" t="Hukka Not sure what parts of the Azure AD you want to do, but you cannot do implicit flow with MSAL, since it doesn&apos;t seem to have any functions for verifying JWTs. You have to let it do some server-to-server communications, or it won&apos;t help you"><y>#</y><d>2022-12-07</d><h>06:59</h><r>Hukka</r>Not sure what parts of the Azure AD you want to do, but you cannot do implicit flow with MSAL, since it doesn&apos;t seem to have any functions for verifying JWTs. You have to let it do some server-to-server communications, or it won&apos;t help you</z><z id="t1670397885" t="Eugen I needed authentication and I got what I needed. I did not find ready made, native clojure options that I could use ootb."><y>#</y><d>2022-12-07</d><h>07:24</h><r>Eugen</r>I needed authentication and I got what I needed. I did not find ready made, native clojure options that I could use ootb.</z><z id="t1671468173" t="robert-stuttaford what could cause ring cookies to produce a new session cookie-store encrypted value on each request? when i watch the cookie in Chrome, the value changes every refresh. the actual behaviour is fine - my session is working and my app does what i want. just seems odd that it keeps making a new value each time"><y>#</y><d>2022-12-19</d><h>16:42</h><w>robert-stuttaford</w>what could cause ring cookies to produce a new session cookie-store encrypted value on each request? when i watch the cookie in Chrome, the value changes every refresh.

the actual behaviour is fine - my session is working and my app does what i want. just seems odd that it keeps making a new value each time</z><z id="t1671475115" t="Hukka https://github.com/ring-clojure/ring/blob/1.9.0/ring-core/src/ring/middleware/session.clj#L61 hm, the logic is there. But hard to say what could be changing the :session-cookie-attrs, or put the :recreate key in the response"><y>#</y><d>2022-12-19</d><h>18:38</h><r>Hukka</r><a href="https://github.com/ring-clojure/ring/blob/1.9.0/ring-core/src/ring/middleware/session.clj#L61" target="_blank">https://github.com/ring-clojure/ring/blob/1.9.0/ring-core/src/ring/middleware/session.clj#L61</a> hm, the logic is there. But hard to say what could be changing the :session-cookie-attrs, or put the :recreate key in the response</z><z id="t1671475147" t="Hukka Could something be setting the session age, for example, all the time?"><y>#</y><d>2022-12-19</d><h>18:39</h><r>Hukka</r>Could something be setting the session age, for example, all the time?</z><z id="t1671475214" t="Hukka I don&apos;t think core ring has anything that sets those, so it should be in other parts"><y>#</y><d>2022-12-19</d><h>18:40</h><r>Hukka</r>I don&apos;t think core ring has anything that sets those, so it should be in other parts</z><z id="t1671475282" t="Hukka You could start by printing the relevant parts of the response right before the session middleware checks it, so you know which path it goes down to"><y>#</y><d>2022-12-19</d><h>18:41</h><r>Hukka</r>You could start by printing the relevant parts of the response right before the session middleware checks it, so you know which path it goes down to</z><z id="t1671475307" t="Hukka Then move your debug middleware up layer by layer, so you catch where it happens"><y>#</y><d>2022-12-19</d><h>18:41</h><r>Hukka</r>Then move your debug middleware up layer by layer, so you catch where it happens</z><z id="t1671475321" t="Hukka (or if the stack is deep, binary search üòâ"><y>#</y><d>2022-12-19</d><h>18:42</h><r>Hukka</r>(or if the stack is deep, binary search <b>üòâ</b></z><z id="t1671477677" t="robert-stuttaford thanks Hukka!"><y>#</y><d>2022-12-19</d><h>19:21</h><r>robert-stuttaford</r>thanks Hukka!</z><z id="t1671541578" t="dharrigan Are you using reitit?"><y>#</y><d>2022-12-20</d><h>13:06</h><r>dharrigan</r>Are  you using reitit?</z><z id="t1671542779" t="robert-stuttaford yep"><y>#</y><d>2022-12-20</d><h>13:26</h><r>robert-stuttaford</r>yep</z><z id="t1671542842" t="robert-stuttaford we also have a lib-noir server (from years ago) that we&apos;re still using and its cookie value is stable from page to page, so i lost half a day trying to figure out why, until i recognised that the session was still working as i wanted it to"><y>#</y><d>2022-12-20</d><h>13:27</h><r>robert-stuttaford</r>we also have a lib-noir server (from years ago) that we&apos;re still using and its cookie value is stable from page to page, so i lost half a day trying to figure out why, until i recognised that the session was still working as i wanted it to</z><z id="t1671543329" t="dharrigan you may be hitting this bug? https://github.com/metosin/reitit/issues/205"><y>#</y><d>2022-12-20</d><h>13:35</h><r>dharrigan</r>you may be hitting this bug? <a href="https://github.com/metosin/reitit/issues/205" target="_blank">https://github.com/metosin/reitit/issues/205</a></z><z id="t1671543381" t="dharrigan What I had to do was to have a global store, and not put the wrap-session in the route middleware."><y>#</y><d>2022-12-20</d><h>13:36</h><r>dharrigan</r>What I had to do was to have a global store, and not put the wrap-session in the route middleware.</z><z id="t1671545698" t="robert-stuttaford oh interesting, going to give that a close read"><y>#</y><d>2022-12-20</d><h>14:14</h><r>robert-stuttaford</r>oh interesting, going to give that a close read</z><z id="t1671545723" t="robert-stuttaford also i should read Issue logs üòÖ"><y>#</y><d>2022-12-20</d><h>14:15</h><r>robert-stuttaford</r>also i should read Issue logs <b>üòÖ</b></z><z id="t1671550864" t="robert-stuttaford thanks for this, i don&apos;t have this specific issue; i implemented my own interceptor instead of using their middleware"><y>#</y><d>2022-12-20</d><h>15:41</h><r>robert-stuttaford</r>thanks for this, i don&apos;t have this specific issue; i implemented my own interceptor instead of using their middleware</z><z id="t1671560084" t="dharrigan np, glad you sorted it out üôÇ"><y>#</y><d>2022-12-20</d><h>18:14</h><r>dharrigan</r>np, glad you sorted it out <b>üôÇ</b></z><z id="t1671728290" t="serioga New ring implementation library if someone interested https://github.com/strojure/ring-undertow"><y>#</y><d>2022-12-22</d><h>16:58</h><w>serioga</w>New ring implementation library if someone interested
<a href="https://github.com/strojure/ring-undertow" target="_blank">https://github.com/strojure/ring-undertow</a></z><z id="t1672754769" t="Santiago I was having issues with reitit parameter parsing so I reverted to compojure for some sanity checks and the same thing is happening: (http/run-server (routes (-&gt; router/routes ;; compojure (defroutes ...) (wrap-defaults (-&gt; site-defaults (assoc-in [:session :cookie-attrs :same-site] :lax) (assoc-in [:security :anti-forgery] false))))) {:port port :join? false})))) the resulting :form-params are not keywordized, even though the site-defaults have it as true . Adding an explicit (assoc-in [:params :keywordize] true) did not change this output. Since this is happening with both reitit and compojure on my machine, could it be a ring issue? Maybe some other lib? I have no other middleware at all"><y>#</y><d>2023-01-03</d><h>14:06</h><w>Santiago</w>I was having issues with reitit parameter parsing so I reverted to compojure for some sanity checks and the same thing is happening:
<pre>(http/run-server
             (routes
              (-&gt; router/routes ;; compojure (defroutes ...)
                  (wrap-defaults (-&gt; site-defaults
                                     (assoc-in [:session :cookie-attrs :same-site] :lax)
                                     (assoc-in [:security :anti-forgery] false)))))
             {:port port :join? false}))))</pre>
the resulting <code>:form-params</code> are not keywordized, even though the <code>site-defaults</code> have it as <code>true</code> . Adding an explicit <code>(assoc-in [:params :keywordize] true)</code>  did not change this output.

Since this is happening with both reitit and compojure on my machine, could it be a ring issue? Maybe some other lib? I have no other middleware at all</z><z id="t1672835809" t="jumar From the wrap-keyword-params docstring: https://github.com/ring-clojure/ring/blob/master/ring-core/src/ring/middleware/keyword_params.clj#L37-L42 (defn wrap-keyword-params &quot;Middleware that converts the any string keys in the :params map to keywords. Only keys that can be turned into valid keywords are converted. This middleware does not alter the maps under :*-params keys. These are left as strings. "><y>#</y><d>2023-01-04</d><h>12:36</h><r>jumar</r>From the <code>wrap-keyword-params</code> docstring: <a href="https://github.com/ring-clojure/ring/blob/master/ring-core/src/ring/middleware/keyword_params.clj#L37-L42" target="_blank">https://github.com/ring-clojure/ring/blob/master/ring-core/src/ring/middleware/keyword_params.clj#L37-L42</a>
<pre>(defn wrap-keyword-params
  &quot;Middleware that converts the any string keys in the :params map to keywords.
  Only keys that can be turned into valid keywords are converted.

  This middleware does not alter the maps under :*-params keys. These are left
  as strings.</pre>
</z><z id="t1676383862" t="James Amberger I have a very small ring app and I want to be able to enter it via the repl. I use vim-fireplace, which lead me to Cider, which lead me to include (nrepl-server/start-server :port 7888 :handler cider-nrepl-handler) in my -main . Is this the correct approach? Initially I thought it would involve just putting some stuff in my deps.edn."><y>#</y><d>2023-02-14</d><h>14:11</h><w>James Amberger</w>I have a very small ring app and I want to be able to enter it via the repl. I use vim-fireplace, which lead me to Cider, which lead me to include <code>(nrepl-server/start-server :port 7888 :handler cider-nrepl-handler)</code> in my <code>-main</code>. Is this the correct approach? Initially I thought it would involve just putting some stuff in my deps.edn.</z><z id="t1676387154" t="weavejester Might be something to ask in the vim-fireplace channel. I know Cider handles it automatically."><y>#</y><d>2023-02-14</d><h>15:05</h><r>weavejester</r>Might be something to ask in the vim-fireplace channel. I know Cider handles it automatically.</z><z id="t1676388774" t="James Amberger on reflection I suppose this question has nothing to do with ring specifically."><y>#</y><d>2023-02-14</d><h>15:32</h><r>James Amberger</r>on reflection I suppose this question has nothing to do with ring specifically.</z><z id="t1676389144" t="James Amberger If I start a server from a terminal repl, how do I shut it down without losing my repl (as happens if I hit ctrl-c)?"><y>#</y><d>2023-02-14</d><h>15:39</h><w>James Amberger</w>If I start a server from a terminal repl, how do I shut it down without losing my repl (as happens if I hit ctrl-c)?</z><z id="t1677691108" t="Ben Lieberman Hi, I&apos;m struggling to get the wrap-oauth2 middleware to work correctly. I can get the auth code and state to appear in the query string and can post to the access token endpoint successfully (using curl), but when the browser hits my redirect URI it just returns a response of &quot;No authorization code&quot; and stop the flow. But I can see the code parameter in the address bar. Any help is appreciated."><y>#</y><d>2023-03-01</d><h>17:18</h><w>Ben Lieberman</w>Hi, I&apos;m struggling to get the <code>wrap-oauth2</code> middleware to work correctly. I can get the auth code and state to appear in the query string and can post to the access token endpoint successfully (using curl), but when the browser hits my redirect URI it just returns a response of &quot;No authorization code&quot; and stop the flow. But I can see the code parameter in the address bar. Any help is appreciated.</z><z id="t1680902330" t="RAJKUMAR Hi I&apos;m trying out basic ring http application but not working as expected"><y>#</y><d>2023-04-07</d><h>21:18</h><w>RAJKUMAR</w>Hi I&apos;m trying out basic <code>ring</code> http application but not working as expected</z><z id="t1680902340" t="RAJKUMAR My project.clj is -"><y>#</y><d>2023-04-07</d><h>21:19</h><w>RAJKUMAR</w>My project.clj is -</z><z id="t1680902346" t="RAJKUMAR (defproject ring-app &quot;0.1.0-SNAPSHOT&quot; :description &quot;FIXME: write description&quot; :url &quot;&quot; :license {:name &quot;EPL-2.0 OR GPL-2.0-or-later WITH Classpath-exception-2.0&quot; :url &quot;&quot;} :dependencies [[org.clojure/clojure &quot;1.11.1&quot;] [ring &quot;1.10.0&quot;]] :repl-options {:init-ns ring-app.core} :main ring-app.core)"><y>#</y><d>2023-04-07</d><h>21:19</h><w>RAJKUMAR</w><pre>(defproject ring-app &quot;0.1.0-SNAPSHOT&quot;
  :description &quot;FIXME: write description&quot;
  :url &quot;&quot;
  :license {:name &quot;EPL-2.0 OR GPL-2.0-or-later WITH Classpath-exception-2.0&quot;
            :url &quot;&quot;}
  :dependencies [[org.clojure/clojure &quot;1.11.1&quot;]
                 [ring &quot;1.10.0&quot;]]
  :repl-options {:init-ns ring-app.core}
  :main ring-app.core)</pre></z><z id="t1680902353" t="RAJKUMAR My handler is -"><y>#</y><d>2023-04-07</d><h>21:19</h><w>RAJKUMAR</w>My handler is -</z><z id="t1680902380" t="RAJKUMAR (ns ring-app.core (:require [ring.adapter.jetty :as jetty])) (defn handler [request-map] (println &quot;got a request to process ...&quot;) {:status 200 :headers {&quot;Content-Type&quot; &quot;text/html&quot;}} :body (str &quot;&lt;html&gt;&lt;body&gt; Your IP is : &quot; (:remote-addr request-map) &quot;&lt;/body&gt;&lt;/html&gt;&quot;)) (defn -main [] (println &quot;starting handler...&quot;) (jetty/run-jetty handler {:port 3000 :join? false}))"><y>#</y><d>2023-04-07</d><h>21:19</h><w>RAJKUMAR</w><pre>(ns ring-app.core
  (:require [ring.adapter.jetty :as jetty]))

(defn handler [request-map]
  (println &quot;got a request to process ...&quot;)
  {:status 200
   :headers {&quot;Content-Type&quot; &quot;text/html&quot;}}
   :body (str &quot;&lt;html&gt;&lt;body&gt; Your IP is : &quot; (:remote-addr request-map) &quot;&lt;/body&gt;&lt;/html&gt;&quot;))


(defn -main []
  (println &quot;starting handler...&quot;)
  (jetty/run-jetty handler  {:port 3000 :join? false}))</pre></z><z id="t1680903128" t="seancorfield If you have :join? false then -main is going to exit pretty much straight away and your web app will stop running. Try removing that and see if you get the behavior you expect."><y>#</y><d>2023-04-07</d><h>21:32</h><r>seancorfield</r>If you have <code>:join? false</code> then <code>-main</code> is going to exit pretty much straight away and your web app will stop running.

Try removing that and see if you get the behavior you expect.</z><z id="t1680903394" t="seancorfield Hmm, no, I can repro your issue without removing that..."><y>#</y><d>2023-04-07</d><h>21:36</h><r>seancorfield</r>Hmm, no, I can repro your issue without removing that...</z><z id="t1680903629" t="seancorfield Ah, you have a typo in your handler function: (defn handler [request-map] (println &quot;got a request to process ...&quot;) {:status 200 :headers {&quot;Content-Type&quot; &quot;text/html&quot;}} :body (str &quot;&lt;html&gt;&lt;body&gt; Your IP is : &quot; (:remote-addr request-map) &quot;&lt;/body&gt;&lt;/html&gt;&quot;)) should be (defn handler [request-map] (println &quot;got a request to process ...&quot;) {:status 200 :headers {&quot;Content-Type&quot; &quot;text/html&quot;} :body (str &quot;&lt;html&gt;&lt;body&gt; Your IP is : &quot; (:remote-addr request-map) &quot;&lt;/body&gt;&lt;/html&gt;&quot;)}) I noticed when I let my editor format your code -- and it became clear that the :body key and its value were outside the hash map."><y>#</y><d>2023-04-07</d><h>21:40</h><r>seancorfield</r>Ah, you have a typo in your <code>handler</code> function:
<pre>(defn handler [request-map]
  (println &quot;got a request to process ...&quot;)
  {:status 200
   :headers {&quot;Content-Type&quot; &quot;text/html&quot;}}
  :body (str &quot;&lt;html&gt;&lt;body&gt; Your IP is : &quot; (:remote-addr request-map) &quot;&lt;/body&gt;&lt;/html&gt;&quot;))</pre>
should be
<pre>(defn handler [request-map]
  (println &quot;got a request to process ...&quot;)
  {:status 200
   :headers {&quot;Content-Type&quot; &quot;text/html&quot;}
   :body (str &quot;&lt;html&gt;&lt;body&gt; Your IP is : &quot; (:remote-addr request-map) &quot;&lt;/body&gt;&lt;/html&gt;&quot;)})</pre>
I noticed when I let my editor format your code -- and it became clear that the <code>:body</code> key and its value were outside the hash map.</z><z id="t1680903656" t="seancorfield So your handler function was just returning a string, not a hash map."><y>#</y><d>2023-04-07</d><h>21:40</h><r>seancorfield</r>So your handler function was just returning a string, not a hash map.</z><z id="t1680902397" t="RAJKUMAR When I do curl I get 200 response but not body and headers as set in my handler"><y>#</y><d>2023-04-07</d><h>21:19</h><w>RAJKUMAR</w>When I do curl I get 200 response but not body and headers as set in my handler</z><z id="t1680902406" t="RAJKUMAR curl -v * Trying 127.0.0.1:3000... * Connected to localhost (127.0.0.1) port 3000 (#0) &gt; GET / HTTP/1.1 &gt; Host: localhost:3000 &gt; User-Agent: curl/7.85.0 &gt; Accept: */* &gt; * Mark bundle as not supporting multiuse &lt; HTTP/1.1 200 OK &lt; Date: Fri, 07 Apr 2023 21:10:29 GMT &lt; Content-Length: 0 &lt; Server: Jetty(9.4.51.v20230217) &lt; * Connection #0 to host localhost left intact"><y>#</y><d>2023-04-07</d><h>21:20</h><w>RAJKUMAR</w><pre>curl -v 
*   Trying 127.0.0.1:3000...
* Connected to localhost (127.0.0.1) port 3000 (#0)
&gt; GET / HTTP/1.1
&gt; Host: localhost:3000
&gt; User-Agent: curl/7.85.0
&gt; Accept: */*
&gt;
* Mark bundle as not supporting multiuse
&lt; HTTP/1.1 200 OK
&lt; Date: Fri, 07 Apr 2023 21:10:29 GMT
&lt; Content-Length: 0
&lt; Server: Jetty(9.4.51.v20230217)
&lt;
* Connection #0 to host localhost left intact</pre></z><z id="t1680902416" t="RAJKUMAR My serverlog is printing the (println &quot;got a request to process...&quot;) but not the response I&apos;m expecting."><y>#</y><d>2023-04-07</d><h>21:20</h><w>RAJKUMAR</w>My serverlog is printing the <code>(println &quot;got a request to process...&quot;)</code> but not the response I&apos;m expecting.</z><z id="t1680902437" t="RAJKUMAR"><y>#</y><d>2023-04-07</d><h>21:20</h><w>RAJKUMAR</w></z><z id="t1680902444" t="RAJKUMAR Any idea why I&apos;m not getting body and response?"><y>#</y><d>2023-04-07</d><h>21:20</h><w>RAJKUMAR</w>Any idea why I&apos;m not getting body and response?</z><z id="t1680902452" t="RAJKUMAR The project is on github https://github.com/rajcspsg/clj-web-dev/tree/main/c02/ring-app"><y>#</y><d>2023-04-07</d><h>21:20</h><w>RAJKUMAR</w>The project is on github <a href="https://github.com/rajcspsg/clj-web-dev/tree/main/c02/ring-app" target="_blank">https://github.com/rajcspsg/clj-web-dev/tree/main/c02/ring-app</a></z><z id="t1680902467" t="RAJKUMAR asked the question in stackoverflow as well https://stackoverflow.com/questions/75961994/clojure-ring-http-is-not-giving-expected-response"><y>#</y><d>2023-04-07</d><h>21:21</h><w>RAJKUMAR</w>asked the question in stackoverflow as well <a href="https://stackoverflow.com/questions/75961994/clojure-ring-http-is-not-giving-expected-response" target="_blank">https://stackoverflow.com/questions/75961994/clojure-ring-http-is-not-giving-expected-response</a></z><z id="t1680904000" t="seancorfield I answered this question on SO as well..."><y>#</y><d>2023-04-07</d><h>21:46</h><r>seancorfield</r>I answered this question on SO as well...</z><z id="t1680979286" t="RAJKUMAR Thanks [:attrs {:href &quot;/_/_/users/U04V70XH6&quot;}]"><y>#</y><d>2023-04-08</d><h>18:41</h><r>RAJKUMAR</r>Thanks <a>@U04V70XH6</a></z><z id="t1680979295" t="RAJKUMAR it worked üëç"><y>#</y><d>2023-04-08</d><h>18:41</h><r>RAJKUMAR</r>it worked <b>üëç</b></z><z id="t1680903656" t="seancorfield So your handler function was just returning a string, not a hash map."><y>#</y><d>2023-04-07</d><h>21:40</h><w>seancorfield</w>So your handler function was just returning a string, not a hash map.</z><z id="t1684937920" t="Ning Sun Just released a newer version of my jetty 11 ring adapter: https://github.com/sunng87/ring-jetty9-adapter The new release updated ring to latest 1.10, and added a few configuration items for http/2 and http/3 connector"><y>#</y><d>2023-05-24</d><h>14:18</h><w>Ning Sun</w>Just released a newer version of my jetty 11 ring adapter: <a href="https://github.com/sunng87/ring-jetty9-adapter" target="_blank">https://github.com/sunng87/ring-jetty9-adapter</a>

The new release updated ring to latest 1.10, and added a few configuration items for http/2 and http/3 connector</z><z id="t1686062643" t="conan I&apos;m having trouble with Jetty logging using ring-jetty-adapter, I can&apos;t figure out how to change it. My application uses timbre and slf4j, but configuring timbre doesn&apos;t affect jetty logging at all, despite jetty announcing that it&apos;s using slf4j on startup. I&apos;d really like to change the colour so INFO messages don&apos;t log in red, to change the format to match my other log messages, and possibly even raise the jetty log level to WARN I&apos;ve tried everything in the jetty docs including adding a jetty-logging.properties to my classpath, but that also didn&apos;t do anything. Anyone know how to configure jetty logging in a ring application? (I also have the same problem with migratus)"><y>#</y><d>2023-06-06</d><h>14:44</h><w>conan</w>I&apos;m having trouble with Jetty logging using ring-jetty-adapter, I can&apos;t figure out how to change it.

My application uses timbre and slf4j, but configuring timbre doesn&apos;t affect jetty logging at all, despite jetty announcing that it&apos;s using slf4j on startup. I&apos;d really like to change the colour so <code>INFO</code> messages don&apos;t log in red, to change the format to match my other log messages, and possibly even raise the jetty log level to <code>WARN</code>

I&apos;ve tried everything in the jetty docs including adding a <code>jetty-logging.properties</code> to my classpath, but that also didn&apos;t do anything.

Anyone know how to configure jetty logging in a ring application?  (I also have the same problem with migratus)</z><z id="t1686471189" t="Eugen I think you should be aware about logging in Web apps. I think logging implememtation is loaded by servlet containers and Web apps should just use the API."><y>#</y><d>2023-06-11</d><h>08:13</h><r>Eugen</r>I think you should be aware about logging in Web apps. I think logging implememtation is loaded by servlet containers and Web apps should just use the API.</z><z id="t1686471213" t="Eugen Webb apps in java are done with some class path magic"><y>#</y><d>2023-06-11</d><h>08:13</h><r>Eugen</r>Webb apps in java are done with some class path magic</z><z id="t1686471273" t="Eugen not sure how it translates to ring -since that I not q web qpp qctually"><y>#</y><d>2023-06-11</d><h>08:14</h><r>Eugen</r>not sure how it translates to ring -since that I not q web qpp qctually</z><z id="t1686471604" t="Eugen WAR"><y>#</y><d>2023-06-11</d><h>08:20</h><r>Eugen</r>WAR</z><z id="t1686471650" t="Eugen timbre is also a logging implementation not a logging facade"><y>#</y><d>2023-06-11</d><h>08:20</h><r>Eugen</r>timbre is also a logging implementation  not a logging facade</z><z id="t1686471692" t="Eugen so you might have 2 logging implementations there"><y>#</y><d>2023-06-11</d><h>08:21</h><r>Eugen</r>so you might have 2 logging implementations there</z><z id="t1686471847" t="Eugen it should work if you use clojure tools logging . that should pick-up slf4j implementation from jetty and you cand then configure it via jetty properties"><y>#</y><d>2023-06-11</d><h>08:24</h><r>Eugen</r>it should work if you use clojure tools logging . that should pick-up slf4j implementation from jetty and you cand then configure it via jetty properties</z><z id="t1686472085" t="Eugen we stopped using timbre because of this issue. we use libraries with different implementations. timbre, to my knowledge is also an implementation qnd you can&apos;t quite mix and match. we tried https://github.com/fzakaria/slf4j-timbre but it has a bug or two and we decided to use tools logging facade with slf4j implementation (amperity/dialog)"><y>#</y><d>2023-06-11</d><h>08:28</h><r>Eugen</r>we stopped using timbre because of this issue. we use libraries with different implementations.  timbre, to my knowledge is also an implementation qnd you can&apos;t quite mix and match. we tried <a href="https://github.com/fzakaria/slf4j-timbre" target="_blank">https://github.com/fzakaria/slf4j-timbre</a> but it has a bug or two and we decided to use tools logging facade with slf4j implementation (amperity/dialog)</z><z id="t1686821960" t="conan Thanks! Timbre is excellent for our code, but you&apos;re right - it doesn&apos;t play very well with the java ecosystem that inevitably creeps in!"><y>#</y><d>2023-06-15</d><h>09:39</h><r>conan</r>Thanks!  Timbre is excellent for our code, but you&apos;re right - it doesn&apos;t play very well with the java ecosystem that inevitably creeps in!</z><z id="t1689272217" t="Patrick Winter I am trying to handle multipart file uploads in my compojure app. As far as I understand it I have to wrap my server with wrap-multipart-params [1]. But I can&apos;t even refer to this function in the ring.middleware.multipart-params namespace. I am using ring/ring-devel {:mvn/version &quot;1.9.6&quot;} for my ring version. Any ideas what I am doing wrong? [1] - https://ring-clojure.github.io/ring/ring.middleware.multipart-params.html#var-wrap-multipart-params"><y>#</y><d>2023-07-13</d><h>18:16</h><w>Patrick Winter</w>I am trying to handle multipart file uploads in my compojure app. As far as I understand it I have to wrap my server with <code>wrap-multipart-params</code> [1]. But I can&apos;t even refer to this function in the <code>ring.middleware.multipart-params</code> namespace.

I am using <code>ring/ring-devel {:mvn/version &quot;1.9.6&quot;}</code> for my ring version. Any ideas what I am doing wrong?

[1] - <a href="https://ring-clojure.github.io/ring/ring.middleware.multipart-params.html#var-wrap-multipart-params" target="_blank">https://ring-clojure.github.io/ring/ring.middleware.multipart-params.html#var-wrap-multipart-params</a></z><z id="t1689272730" t="serioga you need to use ring/ring-core for multipart-params"><y>#</y><d>2023-07-13</d><h>18:25</h><r>serioga</r>you need to use <code>ring/ring-core</code> for multipart-params</z><z id="t1689272749" t="Patrick Winter üëç , thanks"><y>#</y><d>2023-07-13</d><h>18:25</h><r>Patrick Winter</r><b>üëç</b> , thanks</z><z id="t1693952867" t="James Amberger I‚Äôm not sure I am taking full advantage of the repl when developing my ring app. If I modify a function in my editor and eval the definition, I then have to (future-cancel) the server and start a new one. What should I be doing?"><y>#</y><d>2023-09-05</d><h>22:27</h><w>James Amberger</w>I‚Äôm not sure I am taking full advantage of the repl when developing my ring app. If I modify a function in my editor and eval the definition, I then have to <code>(future-cancel)</code> the server and start a new one. What should I be doing?</z><z id="t1693954352" t="seancorfield Are you following the advice here? https://clojure.org/guides/repl/enhancing_your_repl_workflow#writing-repl-friendly-programs"><y>#</y><d>2023-09-05</d><h>22:52</h><r>seancorfield</r>Are you following the advice here? <a href="https://clojure.org/guides/repl/enhancing_your_repl_workflow#writing-repl-friendly-programs" target="_blank">https://clojure.org/guides/repl/enhancing_your_repl_workflow#writing-repl-friendly-programs</a></z><z id="t1693954392" t="seancorfield Specifically, using #&apos;handler instead of handler when starting your server and wrapping your handler with middleware. (hard to be more specific without seeing your code)"><y>#</y><d>2023-09-05</d><h>22:53</h><r>seancorfield</r>Specifically, using <code>#&apos;handler</code> instead of <code>handler</code> when starting your server and wrapping your handler with middleware. (hard to be more specific without seeing your code)</z><z id="t1693956944" t="James Amberger Yes, using #&apos; seems to be what I‚Äôm missing. Thanks [:attrs {:href &quot;/_/_/users/U04V70XH6&quot;}]"><y>#</y><d>2023-09-05</d><h>23:35</h><r>James Amberger</r>Yes, using <code>#&apos;</code> seems to be what I‚Äôm missing. Thanks <a>@U04V70XH6</a></z><z id="t1693976845" t="Ben Sless If you care about performance very much, another option is to eta expand the function: (fn ([request] (handler request)) ([request s f] (handler request s f)))"><y>#</y><d>2023-09-06</d><h>05:07</h><r>Ben Sless</r>If you care about performance very much, another option is to eta expand the function:
<pre>(fn ([request] (handler request))
    ([request s f] (handler request s f)))</pre></z><z id="t1693976867" t="Ben Sless You can call it a compiler trick"><y>#</y><d>2023-09-06</d><h>05:07</h><r>Ben Sless</r>You can call it a compiler trick</z><z id="t1693976919" t="Ben Sless But what I like doing in the repl is to not bring up a server, but have a function that returns my handler then call it and apply the handler to a request built with ring.mock"><y>#</y><d>2023-09-06</d><h>05:08</h><r>Ben Sless</r>But what I like doing in the repl is to not bring up a server, but have a function that returns my handler then call it and apply the handler to a request built with ring.mock</z><z id="t1694298529" t="weavejester I&apos;ve written a draft specification for the experimental Ring websocket protocols that are in testing in 1.11.0-alpha1. I&apos;d appreciate any feedback people want to give. https://github.com/ring-clojure/ring/blob/master/SPEC-alpha.md"><y>#</y><d>2023-09-09</d><h>22:28</h><w>weavejester</w>I&apos;ve written a draft specification for the experimental Ring websocket protocols that are in testing in 1.11.0-alpha1. I&apos;d appreciate any feedback people want to give. <a href="https://github.com/ring-clojure/ring/blob/master/SPEC-alpha.md" target="_blank">https://github.com/ring-clojure/ring/blob/master/SPEC-alpha.md</a></z><z id="t1694302839" t="seancorfield At work we already went down the WebSocket path with the sunng adapter (because we wanted to be on Jetty 11). I&apos;ll take a look on Monday and see how far that is away from your new spec. One big difference that jumps out at me: your listener is a protocol with fewer handler endpoints, compared to a hash map with more keys to functions for the handlers."><y>#</y><d>2023-09-09</d><h>23:40</h><r>seancorfield</r>At work we already went down the WebSocket path with the sunng adapter (because we wanted to be on Jetty 11). I&apos;ll take a look on Monday and see how far that is away from your new spec. One big difference that jumps out at me: your listener is a protocol with fewer handler endpoints, compared to a hash map with more keys to functions for the handlers.</z><z id="t1694302894" t="weavejester You mean like instead of send-text and send-binary, there&apos;s just a single send?"><y>#</y><d>2023-09-09</d><h>23:41</h><r>weavejester</r>You mean like instead of send-text and send-binary, there&apos;s just a single send?</z><z id="t1694302933" t="seancorfield Yeah, and sunng has both ping and pong..."><y>#</y><d>2023-09-09</d><h>23:42</h><r>seancorfield</r>Yeah, and sunng has both ping and pong...</z><z id="t1694302952" t="seancorfield On my phone so typing is limited:grin:"><y>#</y><d>2023-09-09</d><h>23:42</h><r>seancorfield</r>On my phone so typing is limited:grin:</z><z id="t1694303152" t="weavejester No problem! I didn&apos;t include on-ping because the Jakarta websocket library doesn&apos;t include that. Also because on-ping would require calling ping on the socket, so the server should already know when its sending a ping."><y>#</y><d>2023-09-09</d><h>23:45</h><r>weavejester</r>No problem! I didn&apos;t include <code>on-ping</code> because the Jakarta websocket library doesn&apos;t include that. Also because <code>on-ping</code> would require calling <code>ping</code> on the socket, so the server should already know when its sending a ping.</z><z id="t1694303253" t="weavejester I decided on a polymorphic send rather than separate send-text and send-binary functions as it allows for higher-level data structures to potentially be sent, and a binary or text representation chosen as appropriate."><y>#</y><d>2023-09-09</d><h>23:47</h><r>weavejester</r>I decided on a polymorphic <code>send</code> rather than separate <code>send-text</code> and <code>send-binary</code> functions as it allows for higher-level data structures to potentially be sent, and a binary or text representation chosen as appropriate.</z><z id="t1694303306" t="weavejester It&apos;s also worth mentioning that I implement the Listener protocol for maps, so you can use a map of functions."><y>#</y><d>2023-09-09</d><h>23:48</h><r>weavejester</r>It&apos;s also worth mentioning that I implement the Listener protocol for maps, so you can use a map of functions.</z><z id="t1694303394" t="weavejester I also very much appreciate you taking a look."><y>#</y><d>2023-09-09</d><h>23:49</h><r>weavejester</r>I also very much appreciate you taking a look.</z><z id="t1694303654" t="seancorfield I didn&apos;t look at the implementation yet (coz phone) but good to know a map can be a listener, nice."><y>#</y><d>2023-09-09</d><h>23:54</h><r>seancorfield</r>I didn&apos;t look at the implementation yet (coz phone) but good to know a map can be a listener, nice.</z><z id="t1694630523" t="weavejester Apologies for the late response. Currently you can check headers on the upgrade request, but can&apos;t add headers to the response, so extensions and subprotocols aren&apos;t supported as of 1.11.0-alpha2"><y>#</y><d>2023-09-13</d><h>18:42</h><r>weavejester</r>Apologies for the late response. Currently you can check headers on the upgrade request, but can&apos;t add headers to the response, so extensions and subprotocols aren&apos;t supported as of 1.11.0-alpha2</z><z id="t1694633212" t="seancorfield FWIW, we&apos;re in the process of updating to sunng 0.30.0 and Jetty 12.0.1 but I will keep an eye on the O.G. Ring adapter since you generally take a much more conservative approach to updates, and we&apos;ve run into a few edge case breakages from time to time with the sunng adapter."><y>#</y><d>2023-09-13</d><h>19:26</h><r>seancorfield</r>FWIW, we&apos;re in the process of updating to sunng 0.30.0 and Jetty 12.0.1 but I will keep an eye on the O.G. Ring adapter since you generally take a much more conservative approach to updates, and we&apos;ve run into a few edge case breakages from time to time with the sunng adapter.</z><z id="t1694633365" t="weavejester Once the websocket spec for Ring is finalised, my plan is to submit patches to other adapters, including the &quot;jetty9&quot; adapter to see if they&apos;ll support the format. My hope is to get a standard interface for websockets."><y>#</y><d>2023-09-13</d><h>19:29</h><r>weavejester</r>Once the websocket spec for Ring is finalised, my plan is to submit patches to other adapters, including the &quot;jetty9&quot; adapter to see if they&apos;ll support the format. My hope is to get a standard interface for websockets.</z><z id="t1694633504" t="Anders Corlin I have successfully got multipart working, at least as long as the submitter uses content type multipart/form-data . Now I have another client that sends data as multipart/mixed . I can see that ring.middleware.multipart-params/multipart-params-request only parses if content type is multipart/form-data , and I can&apos;t find any Clojure example of other multipart types such as mixed. Anybody has a clue how to parse multipart/mixed would be wonderful!"><y>#</y><d>2023-09-13</d><h>19:31</h><w>Anders Corlin</w>I have successfully got multipart working, at least as long as the submitter uses content type <code>multipart/form-data</code>. Now I have another client that sends data as <code>multipart/mixed</code>. I can see that <code>ring.middleware.multipart-params/multipart-params-request</code> only parses if content type is <code>multipart/form-data</code>, and I can&apos;t find any Clojure example of other multipart types such as mixed.

Anybody has a clue how to parse <code>multipart/mixed</code> would be wonderful!</z><z id="t1694643262" t="weavejester Can you open an issue for this on the Ring repository? It sounds like the sort of thing we&apos;d need to patch."><y>#</y><d>2023-09-13</d><h>22:14</h><r>weavejester</r>Can you open an issue for this on the Ring repository? It sounds like the sort of thing we&apos;d need to patch.</z><z id="t1694647230" t="weavejester Looking into this further, it looks like multipart/mixed data doesn&apos;t necessarily have anything that keys the multipart data, and it looks like the Commons FileUpload library used by Ring for its multipart parsing only supports formdata (unless we use some of the lower-level classes instead), as far as I can tell. If you want multipart/mixed , you&apos;ll probably need to grab a Java multipart library and write some middleware to parse it yourself."><y>#</y><d>2023-09-13</d><h>23:20</h><r>weavejester</r>Looking into this further, it looks like <code>multipart/mixed</code> data doesn&apos;t necessarily have anything that keys the multipart data, and it looks like the Commons FileUpload library used by Ring for its multipart parsing only supports formdata (unless we use some of the lower-level classes instead), as far as I can tell. If you want <code>multipart/mixed</code>, you&apos;ll probably need to grab a Java multipart library and write some middleware to parse it yourself.</z><z id="t1694733634" t="Anders Corlin Thanks [:attrs {:href &quot;/_/_/users/U0BKWMG5B&quot;}] ! Can&apos;t almost find any information about multipart/mixed , but it seems I can convince the sender to encode the data as multipart/form-data instead, so we can use the standard libraries on the backend."><y>#</y><d>2023-09-14</d><h>23:20</h><r>Anders Corlin</r>Thanks <a>@U0BKWMG5B</a>! Can&apos;t almost find any information about <code>multipart/mixed</code>, but it seems I can convince the sender to encode the data as <code>multipart/form-data</code> instead, so we can use the standard libraries on the backend.</z><z id="t1695215208" t="Anders Corlin Had a look and found that the header contains a boundary that separates the parts: Content-Type: multipart/mixed; boundary=3d3edb89-ba76-4ed5-b199-eb3f6f278646 Hence I wrote this middleware to parse it:"><y>#</y><d>2023-09-20</d><h>13:06</h><r>Anders Corlin</r>Had a look and found that the header contains a boundary that separates the parts:
<pre>Content-Type: multipart/mixed; boundary=3d3edb89-ba76-4ed5-b199-eb3f6f278646</pre>
Hence I wrote this middleware to parse it:</z><z id="t1695215230" t="Anders Corlin (ns xxxx.multipart-mixed (:require [cheshire.core :as cheshire] [cuerdas.core :as str]) (:import ( InputStream) (java.util Arrays) ( IOUtils))) (defn array-find &quot;Search a byte array for a pattern, return the offset found&quot; [^bytes data ^bytes pattern &amp; [start-offset]] (let [pattern-length (alength pattern) length (- (alength data) pattern-length)] (if (pos? length) (loop [i (or start-offset 0)] (when (&lt;= i length) (if (Arrays/equals pattern (Arrays/copyOfRange data i (+ i pattern-length))) i (recur (inc i)))))))) (defn array-split &quot;Split an array on the pattern&quot; [^bytes data ^bytes pattern] (let [pattern (if (string? pattern) (.getBytes pattern) pattern) pattern-length (alength pattern)] (loop [data data start-offset 0 acc []] (if-let [offset (array-find data pattern start-offset)] (let [acc (if (= start-offset offset) acc (conj acc (Arrays/copyOfRange data start-offset offset)))] (recur data (+ offset pattern-length) acc)) acc)))) (defn parse-header [s separator] (into {} (keep #(let [parts (str/split % separator)] (if (= 2 (count parts)) [(keyword (str/lower (str/trim (first parts)))) (str/trim (second parts) &quot;\n\t\f\r \&quot;&quot;)])) s))) (defn get-content-type-info [content-type] (let [parts (str/split content-type &quot;;&quot;)] (assoc (parse-header parts &quot;=&quot;) :content-type (first parts)))) (defn wrap-multipart-mixed [handler] (fn [{{content-type &quot;content-type&quot;} :headers :as request}] (let [content-type-info (get-content-type-info content-type)] (if (= (:content-type content-type-info) &quot;multipart/mixed&quot;) (let [content-type-info (get-content-type-info content-type) boundary (str &quot;--&quot; (:boundary content-type-info)) body (IOUtils/toByteArray ^InputStream (:body request)) multiparts (array-split body boundary)] (handler (reduce (fn [request multipart] (let [multipart-rows (array-split multipart &quot;\r\n&quot;) multipart-info (parse-header (map #(String. %) multipart-rows) &quot;:&quot;) content-type-info (get-content-type-info (:content-type multipart-info)) content-type (:content-type content-type-info)] (case content-type &quot;application/json&quot; (update-in request [:parameters :body] merge (cheshire/parse-string (String. (last multipart-rows)) true)) &quot;image/jpeg&quot; (let [content-disposition-info (get-content-type-info (:content-disposition multipart-info)) k (keyword (:name content-disposition-info))] (assoc-in request [:parameters :body k] {:content-type content-type :filename (:filename content-disposition-info) :bytes (last multipart-rows)})) request))) request multiparts)))))))"><y>#</y><d>2023-09-20</d><h>13:07</h><r>Anders Corlin</r><pre>(ns xxxx.multipart-mixed
  (:require [cheshire.core :as cheshire]
            [cuerdas.core :as str])
  (:import ( InputStream)
           (java.util Arrays)
           ( IOUtils)))

(defn array-find
  &quot;Search a byte array for a pattern, return the offset found&quot;
  [^bytes data ^bytes pattern &amp; [start-offset]]
  (let [pattern-length (alength pattern)
        length (- (alength data) pattern-length)]
    (if (pos? length)
      (loop [i (or start-offset 0)]
        (when (&lt;= i length)
          (if (Arrays/equals pattern (Arrays/copyOfRange data i (+ i pattern-length)))
            i
            (recur (inc i))))))))

(defn array-split
  &quot;Split an array on the pattern&quot;
  [^bytes data ^bytes pattern]
  (let [pattern (if (string? pattern)
                  (.getBytes pattern)
                  pattern)
        pattern-length (alength pattern)]
    (loop [data data
           start-offset 0
           acc []]
      (if-let [offset (array-find data pattern start-offset)]
        (let [acc (if (= start-offset offset)
                    acc
                    (conj
                      acc
                      (Arrays/copyOfRange data start-offset offset)))]
          (recur data (+ offset pattern-length) acc))
        acc))))

(defn parse-header
  [s separator]
  (into
    {}
    (keep
      #(let [parts (str/split % separator)]
         (if (= 2 (count parts))
           [(keyword (str/lower (str/trim (first parts))))
            (str/trim (second parts) &quot;\n\t\f\r \&quot;&quot;)]))
      s)))

(defn get-content-type-info
  [content-type]
  (let [parts (str/split content-type &quot;;&quot;)]
    (assoc
      (parse-header parts &quot;=&quot;)
      :content-type (first parts))))

(defn wrap-multipart-mixed
  [handler]
  (fn [{{content-type &quot;content-type&quot;} :headers
        :as                           request}]
    (let [content-type-info (get-content-type-info content-type)]
      (if (= (:content-type content-type-info) &quot;multipart/mixed&quot;)
        (let [content-type-info (get-content-type-info content-type)
              boundary (str &quot;--&quot; (:boundary content-type-info))
              body (IOUtils/toByteArray ^InputStream (:body request))
              multiparts (array-split body boundary)]
          (handler
            (reduce
              (fn [request multipart]
                (let [multipart-rows (array-split multipart &quot;\r\n&quot;)
                      multipart-info (parse-header (map #(String. %) multipart-rows) &quot;:&quot;)
                      content-type-info (get-content-type-info (:content-type multipart-info))
                      content-type (:content-type content-type-info)]
                  (case content-type
                    &quot;application/json&quot; (update-in
                                         request
                                         [:parameters :body]
                                         merge
                                         (cheshire/parse-string (String. (last multipart-rows)) true))
                    &quot;image/jpeg&quot; (let [content-disposition-info (get-content-type-info (:content-disposition multipart-info))
                                       k (keyword (:name content-disposition-info))]
                                   (assoc-in
                                     request
                                     [:parameters :body k]
                                     {:content-type content-type
                                      :filename (:filename content-disposition-info)
                                      :bytes (last multipart-rows)}))
                    request)))
              request
              multiparts)))))))</pre></z><z id="t1695215279" t="Anders Corlin I have tested it with this data in the body: --3d3edb89-ba76-4ed5-b199-eb3f6f278646 Content-Type: application/json; charset=utf-8 Content-Length: 27 {&quot;name&quot;:&quot;Andreas&quot;} --3d3edb89-ba76-4ed5-b199-eb3f6f278646 Content-Disposition: form-data; name=&quot;image&quot;; filename=&quot;image.jpg&quot; Content-Type: image/jpeg Content-Length: 1814 &lt;binary data for the image&gt; --3d3edb89-ba76-4ed5-b199-eb3f6f278646--"><y>#</y><d>2023-09-20</d><h>13:07</h><r>Anders Corlin</r>I have tested it with this data in the body:
<pre>--3d3edb89-ba76-4ed5-b199-eb3f6f278646
Content-Type: application/json; charset=utf-8
Content-Length: 27

{&quot;name&quot;:&quot;Andreas&quot;}
--3d3edb89-ba76-4ed5-b199-eb3f6f278646
Content-Disposition: form-data; name=&quot;image&quot;; filename=&quot;image.jpg&quot;
Content-Type: image/jpeg
Content-Length: 1814

&lt;binary data for the image&gt;
--3d3edb89-ba76-4ed5-b199-eb3f6f278646--</pre></z><z id="t1695215325" t="Anders Corlin Don&apos;t think it&apos;s generic enough to be in any library yet, but somebody searching for multipart/mixed is welcome to capture inspiration from the code."><y>#</y><d>2023-09-20</d><h>13:08</h><r>Anders Corlin</r>Don&apos;t think it&apos;s generic enough to be in any library yet, but somebody searching for <code>multipart/mixed</code> is welcome to capture inspiration from the code.</z><z id="t1695225064" t="Anders Corlin Now I get confused, happened to see the raw input of a multipart/form request that Ring already so nicely parses, and found the content very similar with boundary separators. And reading the header of org.apache.commons.fileupload which ring.middleware.multipart-params uses for it&apos;s parsing, it says: &gt; This class handles multiple files per single HTML widget, sent using So maybe most of my code isn&apos;t necessary at all? Gonna see what happens if I just change the content type from multipart/mixed to multipart/form-data a bit later on."><y>#</y><d>2023-09-20</d><h>15:51</h><r>Anders Corlin</r>Now I get confused, happened to see the raw input of a <code>multipart/form</code> request that Ring already so nicely parses, and found the content very similar with boundary separators.

And reading the header of <code>org.apache.commons.fileupload</code> which <code>ring.middleware.multipart-params</code> uses for it&apos;s parsing, it says:

&gt;  This class handles multiple files per single HTML widget, sent using 
So maybe most of my code isn&apos;t necessary at all? Gonna see what happens if I just change the content type from <code>multipart/mixed</code> to <code>multipart/form-data</code> a bit later on.</z><z id="t1695245242" t="Anders Corlin Yes! So actually if I just bypass the check in ring.middleware.multipart-params/multipart-form? with another middleware before that changes content type from multipart/mixed to multipart/form-data Ring parses out the image as well. Feels like I&apos;ve been going around in circles, [:attrs {:href &quot;/_/_/users/U0BKWMG5B&quot;}] what is you&apos;re understanding about the differences about the two formats? And as far as I can read in the header of commons.FileUpload it supports multipart/mixed ; where did you read that it doesn&apos;t?"><y>#</y><d>2023-09-20</d><h>21:27</h><r>Anders Corlin</r>Yes! So actually if I just bypass the check in <code>ring.middleware.multipart-params/multipart-form?</code> with another middleware before that changes content type from <code>multipart/mixed</code> to <code>multipart/form-data</code> Ring parses out the image as well.

Feels like I&apos;ve been going around in circles, <a>@U0BKWMG5B</a> what is you&apos;re understanding about the differences about the two formats? And as far as I can read in the header of <code>commons.FileUpload</code> it supports <code>multipart/mixed</code>; where did you read that it doesn&apos;t?</z><z id="t1695304725" t="weavejester My understanding is that the sole difference is that multipart/form-data must set a name attribute in the Content-Disposition header, while multipart/mixed has no such restriction. This means that form data can be loaded into a map of parameters, while mixed data cannot, as it doesn&apos;t have a guaranteed key for each multipart section. Mixed data is more generally used for things like email attachments. The FileItem interface in FileUpload requires a name attribute to be constructed, however now that I look at the actual parsing code, I see that this name attribute may actually be null. So I believe I was wrong before, and that it&apos;s possible to use FileUpload to parse multipart/mixed directly, without dropping down to the lower level API of the library. You&apos;ll get an iterator of FileItem instances where getFieldName may return null. Of course, this isn&apos;t compatible with Ring because it expects each multipart section to be named, so it has keys for the map it produces."><y>#</y><d>2023-09-21</d><h>13:58</h><r>weavejester</r>My understanding is that the sole difference is that <code>multipart/form-data</code> must set a <code>name</code> attribute in the Content-Disposition header, while <code>multipart/mixed</code>  has no such restriction. This means that form data can be loaded into a map of parameters, while mixed data cannot, as it doesn&apos;t have a guaranteed key for each multipart section. Mixed data is more generally used for things like email attachments.

The <code>FileItem</code> interface in FileUpload requires a name attribute to be constructed, however now that I look at the actual parsing code, I see that this name attribute may actually be null. So I believe I was wrong before, and that it&apos;s possible to use FileUpload to parse <code>multipart/mixed</code> directly, without dropping down to the lower level API of the library. You&apos;ll get an iterator of <code>FileItem</code> instances where <code>getFieldName</code> may return null.

Of course, this isn&apos;t compatible with Ring because it expects each multipart section to be named, so it has keys for the map it produces.</z><z id="t1695378039" t="Anders Corlin üôè"><y>#</y><d>2023-09-22</d><h>10:20</h><r>Anders Corlin</r><b>üôè</b></z><z id="t1695758156" t="Saket Patel When I return a (bad-request! {:message &quot;Something is wrong with the request&quot;}) I get 500 Internal error on the client. How to get 400 Bad request instead ?"><y>#</y><d>2023-09-26</d><h>19:55</h><w>Saket Patel</w>When I return a <code>(bad-request! {:message &quot;Something is wrong with the request&quot;})</code>
I get <code>500 Internal</code> error on the client.
How to get <code>400 Bad request</code> instead ?</z><z id="t1695759325" t="seancorfield What is bad-request! -- you&apos;ll need to show a bit more code. In addition, if you&apos;re getting a 500 Internal Server Error, you should see exceptions somewhere (depending on how you&apos;re starting the app)."><y>#</y><d>2023-09-26</d><h>20:15</h><r>seancorfield</r>What is <code>bad-request!</code> -- you&apos;ll need to show a bit more code.

In addition, if you&apos;re getting a 500 Internal Server Error, you should see exceptions somewhere (depending on how you&apos;re starting the app).</z><z id="t1695848241" t="DrLj√≥tsson I believe bad-request! throws so you need to catch that exception . Try using bad-request instead (without ! )"><y>#</y><d>2023-09-27</d><h>20:57</h><r>DrLj√≥tsson</r>I believe <code>bad-request!</code> throws so you need to catch that exception . Try using <code>bad-request</code> instead (without <code>!</code>)</z><z id="t1695877946" t="Saket Patel Hey, sorry for the late response. [:attrs {:href &quot;/_/_/users/U04V70XH6&quot;}] , bad-request! is the standard ring.util.response/bad-request! It is supposed to throw an error, which it does. But that exception gets translated into 500 Internal for the client. It should ideally be converted to 400 Bad request error, like it does in other language&apos;s frameworks."><y>#</y><d>2023-09-28</d><h>05:12</h><r>Saket Patel</r>Hey, sorry for the late response.

<a>@U04V70XH6</a>, <code>bad-request!</code> is the standard <code>ring.util.response/bad-request!</code>

It is supposed to throw an error, which it does. But that exception gets translated into 500 Internal for the client. It should ideally be converted to 400 Bad request error, like it does in other language&apos;s frameworks.</z><z id="t1695878014" t="Saket Patel [:attrs {:href &quot;/_/_/users/UGDTSFM4M&quot;}] , bad-request just returns 200 OK with error info in the response body."><y>#</y><d>2023-09-28</d><h>05:13</h><r>Saket Patel</r><a>@UGDTSFM4M</a>, <code>bad-request</code> just returns 200 OK with error info in the response body.</z><z id="t1695878039" t="seancorfield It shouldn&apos;t be 400 Bad Request. That&apos;s not the semantically correct HTTP status code."><y>#</y><d>2023-09-28</d><h>05:13</h><r>seancorfield</r>It shouldn&apos;t be 400 Bad Request. That&apos;s not the semantically correct HTTP status code.</z><z id="t1695878077" t="seancorfield See https://developer.mozilla.org/en-US/docs/Web/HTTP/Status#server_error_responses for example. 5xx is the correct status for a server error."><y>#</y><d>2023-09-28</d><h>05:14</h><r>seancorfield</r>See <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Status#server_error_responses" target="_blank">https://developer.mozilla.org/en-US/docs/Web/HTTP/Status#server_error_responses</a> for example. 5xx is the correct status for a server error.</z><z id="t1695878115" t="seancorfield 4xx are client errors -- indicating that the client needs to do something different."><y>#</y><d>2023-09-28</d><h>05:15</h><r>seancorfield</r>4xx are client errors -- indicating that the client needs to do something different.</z><z id="t1695878146" t="seancorfield I don&apos;t know of any language framework that returns a 4xx error for an unhandled error on the server -- that&apos;s just semantically wrong."><y>#</y><d>2023-09-28</d><h>05:15</h><r>seancorfield</r>I don&apos;t know of any language framework that returns a 4xx error for an unhandled error on the server -- that&apos;s just semantically wrong.</z><z id="t1695878303" t="Saket Patel According to MDN: The server has encountered a situation it does not know how to handle. But, I would say that the server handled the situation and returned the bad-request so that the client gets 400. Am I missing a middleware here? I used django and spring boot in the past and noticed the behaviour that I was expecting. Let me double check if I missed a middleware somewhere that translates responses and throws corresponding http error"><y>#</y><d>2023-09-28</d><h>05:18</h><r>Saket Patel</r>According to MDN:
<code>The server has encountered a situation it does not know how to handle.</code>

But, I would say that the server handled the situation and returned the bad-request so that the client gets 400.

Am I missing a middleware here?

I used django and spring boot in the past and noticed the behaviour that I was expecting. Let me double check if I missed a middleware somewhere that translates responses and throws corresponding http error</z><z id="t1695878309" t="seancorfield ring.util.response/bad-request is for returning a 400: &gt; clj -Sdeps &apos;{:deps {ring/ring {:mvn/version &quot;RELEASE&quot;}}}&apos; Clojure 1.12.0-alpha4 user=&gt; (require &apos;[ring.util.response :as resp]) nil user=&gt; (resp/bad-request {:error &quot;failed!&quot;}) {:status 400, :headers {}, :body {:error &quot;failed!&quot;}} user=&gt;"><y>#</y><d>2023-09-28</d><h>05:18</h><r>seancorfield</r><code>ring.util.response/bad-request</code> is for returning a 400:
<pre>&gt; clj -Sdeps &apos;{:deps {ring/ring {:mvn/version &quot;RELEASE&quot;}}}&apos;
Clojure 1.12.0-alpha4
user=&gt; (require &apos;[ring.util.response :as resp])
nil
user=&gt; (resp/bad-request {:error &quot;failed!&quot;})
{:status 400, :headers {}, :body {:error &quot;failed!&quot;}}
user=&gt;</pre></z><z id="t1695878386" t="seancorfield If you are using bad-request and don&apos;t get a 400 status like I showed, then maybe you have middleware that is messing with the response?"><y>#</y><d>2023-09-28</d><h>05:19</h><r>seancorfield</r>If you are using <code>bad-request</code> and don&apos;t get a 400 status like I showed, then maybe you have middleware that is messing with the response?</z><z id="t1695878469" t="seancorfield [:attrs {:href &quot;/_/_/users/UGDTSFM4M&quot;}] There&apos;s no bad-request! in https://ring-clojure.github.io/ring/ring.util.response.html What is that bad-request! call [:attrs {:href &quot;/_/_/users/U05AJ7KNDGE&quot;}] ?"><y>#</y><d>2023-09-28</d><h>05:21</h><r>seancorfield</r><a>@UGDTSFM4M</a> There&apos;s no <code>bad-request!</code> in <a href="https://ring-clojure.github.io/ring/ring.util.response.html" target="_blank">https://ring-clojure.github.io/ring/ring.util.response.html</a>

What is that <code>bad-request!</code> call <a>@U05AJ7KNDGE</a>?</z><z id="t1695878554" t="Saket Patel I do get a response just like the one you shared. But the client gets the http response 200 and this map in the response body. Now, if I have to handle this on client I have to write extra code that checks for this response for any possible error (as the server said: well, it worked and here is an error in the response body) If it threw the exception I could wrap the client request in a try/catch block and be done with it."><y>#</y><d>2023-09-28</d><h>05:22</h><r>Saket Patel</r>I do get a response just like the one you shared. But the client gets the http response 200 and this map in the response body.

Now, if I have to handle this on client I have to write extra code that checks for this response for any possible error (as the server said: well, it worked and here is an error in the response body)
If it threw the exception I could wrap the client request in a try/catch block and be done with it.</z><z id="t1695878580" t="seancorfield bad-request returns a 400 status, not a 200 status."><y>#</y><d>2023-09-28</d><h>05:23</h><r>seancorfield</r><code>bad-request</code> returns a 400 status, not a 200 status.</z><z id="t1695878591" t="seancorfield You must have something else messing with the response."><y>#</y><d>2023-09-28</d><h>05:23</h><r>seancorfield</r>You must have something else messing with the response.</z><z id="t1695878646" t="seancorfield (I know this works -- we return 4xx status a lot in our app at work)"><y>#</y><d>2023-09-28</d><h>05:24</h><r>seancorfield</r>(I know this works -- we return 4xx status a lot in our app at work)</z><z id="t1695878752" t="Saket Patel I believe we are talking about two different places when we talk about status. You&apos;re talking about the return value of (bad-request ...) I am talking about when it translates finally for a client that sent the http request. It translates to HTTP 200 and the response body has: {:status 400 ...}"><y>#</y><d>2023-09-28</d><h>05:25</h><r>Saket Patel</r>I believe we are talking about two different places when we talk about status.

You&apos;re talking about the return value of <code>(bad-request ...)</code>

I am talking about when it translates finally for a client that sent the http request. It translates to HTTP 200 and the response body has:
<pre>{:status 400
 ...}</pre></z><z id="t1695878793" t="seancorfield Then you have SOMETHING ELSE MESSING WITH THE RESPONSE. I&apos;m telling you that does not happen by default."><y>#</y><d>2023-09-28</d><h>05:26</h><r>seancorfield</r>Then you have SOMETHING ELSE MESSING WITH THE RESPONSE.

I&apos;m telling you that does not happen by default.</z><z id="t1695878793" t="Saket Patel Oh let me check again, maybe I missed something here. I&apos;ll update here if I find anything."><y>#</y><d>2023-09-28</d><h>05:26</h><r>Saket Patel</r>Oh let me check again, maybe I missed something here. I&apos;ll update here if I find anything.</z><z id="t1695878815" t="seancorfield If you shared some code, that might help."><y>#</y><d>2023-09-28</d><h>05:26</h><r>seancorfield</r>If you shared some code, that might help.</z><z id="t1695878849" t="seancorfield But, right now, I&apos;m pretty sure you&apos;re just doing something &quot;wrong&quot; with the Ring response somewhere in your stack."><y>#</y><d>2023-09-28</d><h>05:27</h><r>seancorfield</r>But, right now, I&apos;m pretty sure you&apos;re just doing something &quot;wrong&quot; with the Ring response somewhere in your stack.</z><z id="t1695878897" t="seancorfield Perhaps you&apos;re doing the equivalent of this? user=&gt; (resp/response (resp/bad-request {:error &quot;failed!&quot;})) {:status 200, :headers {}, :body {:status 400, :headers {}, :body {:error &quot;failed!&quot;}}}"><y>#</y><d>2023-09-28</d><h>05:28</h><r>seancorfield</r>Perhaps you&apos;re doing the equivalent of this?
<pre>user=&gt; (resp/response (resp/bad-request {:error &quot;failed!&quot;}))
{:status 200, :headers {}, :body {:status 400, :headers {}, :body {:error &quot;failed!&quot;}}}</pre></z><z id="t1695878920" t="Saket Patel Got it. I&apos;ll share a snippet when I get back to the project."><y>#</y><d>2023-09-28</d><h>05:28</h><r>Saket Patel</r>Got it. I&apos;ll share a snippet when I get back to the project.</z><z id="t1695878976" t="seancorfield Somewhere in your code, you probably need logic like this: user=&gt; (let [r (resp/bad-request {:error &quot;failed!&quot;})] (if (resp/response? r) r (resp/response r))) {:status 400, :headers {}, :body {:error &quot;failed!&quot;}}"><y>#</y><d>2023-09-28</d><h>05:29</h><r>seancorfield</r>Somewhere in your code, you probably need logic like this:
<pre>user=&gt; (let [r (resp/bad-request {:error &quot;failed!&quot;})]
         (if (resp/response? r)
           r
           (resp/response r)))
{:status 400, :headers {}, :body {:error &quot;failed!&quot;}}</pre></z><z id="t1695879014" t="seancorfield i.e., in your middleware, you might need to see if you already have a Ring response before just wrapping the result in a response."><y>#</y><d>2023-09-28</d><h>05:30</h><r>seancorfield</r>i.e., in your middleware, you might need to see if you already have a Ring response before just wrapping the result in a response.</z><z id="t1695879102" t="seancorfield And a regular (non-error) flow would be: user=&gt; (let [r {:success true :message &quot;Yay!&quot;}] (if (resp/response? r) r (resp/response r))) {:status 200, :headers {}, :body {:success true, :message &quot;Yay!&quot;}}"><y>#</y><d>2023-09-28</d><h>05:31</h><r>seancorfield</r>And a regular (non-error) flow would be:
<pre>user=&gt; (let [r {:success true :message &quot;Yay!&quot;}]
         (if (resp/response? r)
           r
           (resp/response r)))
{:status 200, :headers {}, :body {:success true, :message &quot;Yay!&quot;}}</pre></z><z id="t1695879192" t="seancorfield (your avatar might trigger coulrophobia üôÇ üôÇ üôÇ )"><y>#</y><d>2023-09-28</d><h>05:33</h><r>seancorfield</r>(your avatar might trigger coulrophobia <b>üôÇ</b> <b>üôÇ</b> <b>üôÇ</b> )</z><z id="t1695880898" t="Saket Patel Sean, you are right. There&apos;s no middleware issue, just my dumb ass wrapped the response in ok at the top level. Sorry for wasting your time. These ok, bad-request! are a part of metosin/ring-http-response lib."><y>#</y><d>2023-09-28</d><h>06:01</h><r>Saket Patel</r>Sean, you are right. There&apos;s no middleware issue, just my dumb ass wrapped the response in <code>ok</code> at the top level. Sorry for wasting your time.

These <code>ok, bad-request!</code> are a part of <code>metosin/ring-http-response</code> lib.</z><z id="t1695881026" t="Saket Patel Updated the profile picture."><y>#</y><d>2023-09-28</d><h>06:03</h><r>Saket Patel</r>Updated the profile picture.</z><z id="t1696877398" t="hlship We&apos;re planning out Pedestal 0.7, and it&apos;s currently gated on Ring 1.11; do you have a rough idea of when Ring 1.11 will be available?"><y>#</y><d>2023-10-09</d><h>18:49</h><w>hlship</w>We&apos;re planning out Pedestal 0.7, and it&apos;s currently gated on Ring 1.11; do you have a rough idea of when Ring 1.11 will be available?</z><z id="t1697056637" t="weavejester My plan is to release before the end of the year. Likely November or early December. I&apos;m currently submitting PRs to third party Ring adapters in order to support the websocket API. This gives an opportunity for feedback, and allows me to see how the API works in practice with a variety of different libraries. I was also planning on checking in with you folks about Pedestal. I&apos;m unsure if the websocket API is relevant or not to Pedestal, but if it is I&apos;d like to get some feedback."><y>#</y><d>2023-10-11</d><h>20:37</h><r>weavejester</r>My plan is to release before the end of the year. Likely November or early December. I&apos;m currently submitting PRs to third party Ring adapters in order to support the websocket API. This gives an opportunity for feedback, and allows me to see how the API works in practice with a variety of different libraries. I was also planning on checking in with you folks about Pedestal. I&apos;m unsure if the websocket API is relevant or not to Pedestal, but if it is I&apos;d like to get some feedback.</z><z id="t1697209228" t="hlship Oh, it&apos;s relevant! Previously, it was supported only for Jetty, but we&apos;re moving the definition of websockets up a level so that it&apos;s something other containers can be expected to support, and I&apos;m working on proper documentation (I&apos;m actually reworking all the Pedestal documentation, and moving it to Antora)."><y>#</y><d>2023-10-13</d><h>15:00</h><r>hlship</r>Oh, it&apos;s relevant!  Previously, it was supported only for Jetty, but we&apos;re moving the definition of websockets up a level so that it&apos;s something other containers can be expected to support, and I&apos;m working on proper documentation (I&apos;m actually reworking all the Pedestal documentation, and moving it to Antora).</z><z id="t1697209294" t="hlship So we may end up relying on a beta version when that&apos;s available since we&apos;re hoping for a faster release cadence, and we&apos;re eager to get to Jetty 11 (for NuBank, and for the larger community) as Jetty 9 is near EOL."><y>#</y><d>2023-10-13</d><h>15:01</h><r>hlship</r>So we may end up relying on a beta version when that&apos;s available since we&apos;re hoping for a faster release cadence, and we&apos;re eager to get to Jetty 11 (for NuBank, and for the larger community) as Jetty 9 is near EOL.</z><z id="t1697504818" t="fabrao Hello all, we had update some lib, but we are having this problem: Exception in thread &quot;main&quot; Syntax error compiling . at (ring/middleware/multipart_params.clj:29:5). when update info.sunng/ring-jetty9-adapter 0.22.1 to info.sunng/ring-jetty9-adapter 0.30.0"><y>#</y><d>2023-10-17</d><h>01:06</h><w>fabrao</w>Hello all, we had update some lib, but we are having this problem:
<code>Exception in thread &quot;main&quot; Syntax error compiling . at (ring/middleware/multipart_params.clj:29:5).</code>
when update <code>info.sunng/ring-jetty9-adapter 0.22.1</code> to  <code>info.sunng/ring-jetty9-adapter 0.30.0</code></z><z id="t1697505628" t="weavejester What version of Ring are you using? Can you show the stacktrace of the error?"><y>#</y><d>2023-10-17</d><h>01:20</h><r>weavejester</r>What version of Ring are you using? Can you show the stacktrace of the error?</z><z id="t1697505657" t="weavejester This might be due to a missing servlet dependency that the FileUpload library needs to function."><y>#</y><d>2023-10-17</d><h>01:20</h><r>weavejester</r>This might be due to a missing servlet dependency that the FileUpload library needs to function.</z><z id="t1697507073" t="fabrao [:attrs {:href &quot;/_/_/users/U0BKWMG5B&quot;}] You right, I could find the problem into another lib dependency. Thank you"><y>#</y><d>2023-10-17</d><h>01:44</h><r>fabrao</r><a>@U0BKWMG5B</a> You right, I could find the problem into another lib dependency. Thank you</z><z id="t1697787025" t="henrik Wut: Do you want to upgrade ring/ring-core &apos;1.11.0-beta2&apos; to &apos;2.0.0-alpha1&apos; in deps.edn (y/n)"><y>#</y><d>2023-10-20</d><h>07:30</h><w>henrik</w>Wut: <code>Do you want to upgrade ring/ring-core &apos;1.11.0-beta2&apos; to &apos;2.0.0-alpha1&apos; in deps.edn (y/n)</code></z><z id="t1697899341" t="weavejester I&apos;d rather not remove a tag if I can help it. Presumably this issue will go away when 1.11.0 is released, as it will favour full releases over alpha ones."><y>#</y><d>2023-10-21</d><h>14:42</h><r>weavejester</r>I&apos;d rather not remove a tag if I can help it. Presumably this issue will go away when 1.11.0 is released, as it will favour full releases over alpha ones.</z><z id="t1698058696" t="Ernesto Garcia Hi all. Why does ring.util.request/body-string just slurp the body, disregarding the char encoding? Can&apos;t this cause decoding issues?"><y>#</y><d>2023-10-23</d><h>10:58</h><w>Ernesto Garcia</w>Hi all. Why does <code>ring.util.request/body-string</code> just slurp the body, disregarding the char encoding? Can&apos;t this cause decoding issues?</z><z id="t1698074200" t="weavejester That&apos;s likely an oversight. It should decode based on the charset (if one exists)."><y>#</y><d>2023-10-23</d><h>15:16</h><r>weavejester</r>That&apos;s likely an oversight. It should decode based on the charset (if one exists).</z><z id="t1698082690" t="Ernesto Garcia Should it be fixed?"><y>#</y><d>2023-10-23</d><h>17:38</h><r>Ernesto Garcia</r>Should it be fixed?</z><z id="t1698168757" t="weavejester Yes. Or deprecated, as it looks like body-string is an old function and may not be relevant in modern code."><y>#</y><d>2023-10-24</d><h>17:32</h><r>weavejester</r>Yes. Or deprecated, as it looks like <code>body-string</code> is an old function and may not be relevant in modern code.</z><z id="t1699227472" t="kwladyka Is https://github.com/xeqi/peridot still most common library for testing request -&gt; response? I see it it wasn‚Äôt update for a long time. Any new tool or it is so good it doesn‚Äôt need changes? üòâ"><y>#</y><d>2023-11-05</d><h>23:37</h><w>kwladyka</w>Is <a href="https://github.com/xeqi/peridot" target="_blank">https://github.com/xeqi/peridot</a> still most common library for testing request -&gt; response? I see it it wasn‚Äôt update for a long time. Any new tool or it is so good it doesn‚Äôt need changes? <b>üòâ</b></z><z id="t1699231521" t="hifumi123 i&apos;ve always relied on ring-mock. i&apos;m not sure how different this tool is from ring-mock, but they both seem to share the same idea of constructing request maps and sending them directly to a ring handler"><y>#</y><d>2023-11-06</d><h>00:45</h><r>hifumi123</r>i&apos;ve always relied on ring-mock. i&apos;m not sure how different this tool is from ring-mock, but they both seem to share the same idea of constructing request maps and sending them directly to a ring handler</z><z id="t1699259418" t="kwladyka ring-mock last code change is even older"><y>#</y><d>2023-11-06</d><h>08:30</h><r>kwladyka</r>ring-mock last code change is even older</z><z id="t1699276448" t="weavejester There&apos;s usually no reason not to use older libraries in Clojure, unless they are explicitly deprecated. I still use Peridot (and ring-mock)."><y>#</y><d>2023-11-06</d><h>13:14</h><r>weavejester</r>There&apos;s usually no reason not to use older libraries in Clojure, unless they are explicitly deprecated. I still use Peridot (and ring-mock).</z><z id="t1699276505" t="kwladyka with this 2 I can agree, but I wouldn‚Äôt name it as a rule of the thumb"><y>#</y><d>2023-11-06</d><h>13:15</h><r>kwladyka</r>with this 2 I can agree, but I wouldn‚Äôt name it as a rule of the thumb</z><z id="t1699632426" t="John I&apos;ve searched the web and Slack and failed to figure out how to serve a standard Servlet from a Java library under a router/server started by Ring. It seems this question comes up every now and again, but as a newbie I couldn&apos;t assimilate any partial answers into a final one"><y>#</y><d>2023-11-10</d><h>16:07</h><w>John</w>I&apos;ve searched the web and Slack and failed to figure out how to serve a standard Servlet from a Java library under a router/server started by Ring. It seems this question comes up every now and again, but as a newbie I couldn&apos;t assimilate any partial answers into a final one</z><z id="t1699632456" t="John I know the other way around is made easy via the servlet util functions in Ring"><y>#</y><d>2023-11-10</d><h>16:07</h><r>John</r>I know the other way around is made easy via the servlet util functions in Ring</z><z id="t1699632540" t="John maybe I just make an annotated WebServlet class and Jetty will find it ?!"><y>#</y><d>2023-11-10</d><h>16:09</h><r>John</r>maybe I just make an annotated WebServlet class and Jetty will find it ?!</z><z id="t1699635254" t="John ring&apos;s jetty adapter does produce a standard contexthandler which I think has a mount-like thing after it started think_beret"><y>#</y><d>2023-11-10</d><h>16:54</h><r>John</r>ring&apos;s jetty adapter does produce a standard contexthandler which I think has a mount-like thing after it started <b>think_beret</b></z><z id="t1699636256" t="weavejester It depends on the adapter being used. If you use the default Jetty adapter, you get back a Jetty Server object. Once you&apos;ve got that, I believe you can use insertHandler to wrap Ring&apos;s Jetty handler class in a HandlerWrapper , and then you can use setHandler on that wrapper to add a ServletHandler , and then finally to use addServletWithMapping ."><y>#</y><d>2023-11-10</d><h>17:10</h><r>weavejester</r>It depends on the adapter being used. If you use the default Jetty adapter, you get back a Jetty Server object. Once you&apos;ve got that, I believe you can use <code>insertHandler</code> to wrap Ring&apos;s Jetty handler class in a <code>HandlerWrapper</code> , and then you can use <code>setHandler</code> on that wrapper to add a <code>ServletHandler</code>, and then finally to use <code>addServletWithMapping</code>.</z><z id="t1699671150" t="John So, got the Servlet -classed object, made a org.eclipse.jetty.servlet.ServletHandler and a org.eclipse.jetty.servlet.ServletHolder , added the servlet to it, stopped the server, .setHandler on it and restarted. The insertHandler I imagine will both make it ergonomic to keep the original handler and not have to restart but I didn&apos;t experiment that far yet, just saw that the above was working"><y>#</y><d>2023-11-11</d><h>02:52</h><r>John</r>So, got the <code>Servlet</code> -classed object, made a <code>org.eclipse.jetty.servlet.ServletHandler</code> and a <code>org.eclipse.jetty.servlet.ServletHolder</code> , added the servlet to it, stopped the server, <code>.setHandler</code> on it and restarted. The <code>insertHandler</code> I imagine will both make it ergonomic to keep the original handler and not have to restart but I didn&apos;t experiment that far yet, just saw that the above was working</z><z id="t1699671192" t="John oh and yeah, addServletWithMapping"><y>#</y><d>2023-11-11</d><h>02:53</h><r>John</r>oh and yeah, <code>addServletWithMapping</code></z><z id="t1699657722" t="RAJKUMAR Hi, I&apos;ve question related ring and the related libraries"><y>#</y><d>2023-11-10</d><h>23:08</h><w>RAJKUMAR</w>Hi, I&apos;ve question related ring and the related libraries</z><z id="t1699657763" t="RAJKUMAR Any reason the library Ring JSON/0.5.1 is not updated with ring-core currently used version is 1.9.2 ring-headers/0.3.0 is not updated with ring-core currently used version is 1.6.0"><y>#</y><d>2023-11-10</d><h>23:09</h><r>RAJKUMAR</r>Any reason the library Ring JSON/0.5.1 is not updated with ring-core currently  used version is 1.9.2
ring-headers/0.3.0 is not updated with ring-core currently  used version is 1.6.0</z><z id="t1699676742" t="weavejester They just haven&apos;t been updated yet."><y>#</y><d>2023-11-11</d><h>04:25</h><r>weavejester</r>They just haven&apos;t been updated yet.</z><z id="t1699682875" t="RAJKUMAR do you have any plans to release it in near future?"><y>#</y><d>2023-11-11</d><h>06:07</h><r>RAJKUMAR</r>do you have any plans to release it in near future?</z><z id="t1699776272" t="RAJKUMAR [:attrs {:href &quot;/_/_/users/U0BKWMG5B&quot;}] ?"><y>#</y><d>2023-11-12</d><h>08:04</h><r>RAJKUMAR</r><a>@U0BKWMG5B</a>?</z><z id="t1699972054" t="weavejester I guess once Ring 1.11 has been released I can go through and update them. But why does it matter? If you&apos;re using those libraries presumably you also have a Ring dependency in your project anyway, and that will override the older dependencies in those libraries."><y>#</y><d>2023-11-14</d><h>14:27</h><r>weavejester</r>I guess once Ring 1.11 has been released I can go through and update them. But why does it matter? If you&apos;re using those libraries presumably you also have a Ring dependency in your project anyway, and that will override the older dependencies in those libraries.</z><z id="t1699825704" t="DrLj√≥tsson I‚Äôm trying to understand how the :context key for a ring request is handled by compojure. I can see that it‚Äôs read here https://github.com/weavejester/compojure/blob/1f921964801ef4ba45b7e694bc9c6a27394c1300/src/compojure/core.clj#L258 and passed on here https://github.com/weavejester/compojure/blob/1f921964801ef4ba45b7e694bc9c6a27394c1300/src/compojure/core.clj#L264 , but I can‚Äôt really see where its value is used. The reason why I‚Äôm asking is that I have set the :context myself for another purpose, which completely broke my app. Now I‚Äôm trying to figure out where the breaking happens. "><y>#</y><d>2023-11-12</d><h>21:48</h><w>DrLj√≥tsson</w>I‚Äôm trying to understand how the <code>:context</code> key for a ring request is handled by compojure. I can see that it‚Äôs read here <a href="https://github.com/weavejester/compojure/blob/1f921964801ef4ba45b7e694bc9c6a27394c1300/src/compojure/core.clj#L258" target="_blank">https://github.com/weavejester/compojure/blob/1f921964801ef4ba45b7e694bc9c6a27394c1300/src/compojure/core.clj#L258</a> and passed on here <a href="https://github.com/weavejester/compojure/blob/1f921964801ef4ba45b7e694bc9c6a27394c1300/src/compojure/core.clj#L264" target="_blank">https://github.com/weavejester/compojure/blob/1f921964801ef4ba45b7e694bc9c6a27394c1300/src/compojure/core.clj#L264</a>, but I can‚Äôt really see where its value is used. The reason why I‚Äôm asking is that I have set the <code>:context</code> myself for another purpose, which completely broke my app. Now I‚Äôm trying to figure out where the breaking happens. </z><z id="t1699972378" t="weavejester The context macro in Compojure, and the set-context function in Ring, split the :uri of a request map into a :context and :path-info parts."><y>#</y><d>2023-11-14</d><h>14:32</h><r>weavejester</r>The <code>context</code> macro in Compojure, and the <code>set-context</code> function in Ring, split the <code>:uri</code> of a request map into a <code>:context</code> and <code>:path-info</code> parts.</z><z id="t1699972437" t="weavejester So for example: (compojure/context &quot;/foo&quot; (compojure/GET &quot;/bar&quot; [] &quot;This will match /foo/bar. The context is /foo, and the path-info is /bar&quot;))"><y>#</y><d>2023-11-14</d><h>14:33</h><r>weavejester</r>So for example:
<pre>(compojure/context &quot;/foo&quot;
  (compojure/GET &quot;/bar&quot; []
    &quot;This will match /foo/bar. The context is /foo, and the path-info is /bar&quot;))</pre></z><z id="t1699972593" t="DrLj√≥tsson Thanks! I was able to figure out that setting :context myself broke metosin&apos;s ring-swagger library. But I managed to solve it. üôÇ"><y>#</y><d>2023-11-14</d><h>14:36</h><r>DrLj√≥tsson</r>Thanks! I was able to figure out that setting <code>:context</code> myself broke metosin&apos;s ring-swagger library. But I managed to solve it. <b>üôÇ</b></z><z id="t1699972630" t="DrLj√≥tsson Also, if I read the source right, the context let-binding is never used? https://github.com/weavejester/compojure/blob/1f921964801ef4ba45b7e694bc9c6a27394c1300/src/compojure/core.clj#L258"><y>#</y><d>2023-11-14</d><h>14:37</h><r>DrLj√≥tsson</r>Also, if I read the source right, the <code>context</code> let-binding is never used? <a href="https://github.com/weavejester/compojure/blob/1f921964801ef4ba45b7e694bc9c6a27394c1300/src/compojure/core.clj#L258" target="_blank">https://github.com/weavejester/compojure/blob/1f921964801ef4ba45b7e694bc9c6a27394c1300/src/compojure/core.clj#L258</a></z><z id="t1699972983" t="weavejester Yeah, that looks like a line that can be removed."><y>#</y><d>2023-11-14</d><h>14:43</h><r>weavejester</r>Yeah, that looks like a line that can be removed.</z><z id="t1699870808" t="niwinz Hello, I&apos;m looking to integrate the new websockets protocols into an adapter that we maintain, and I have several questions: ‚Ä¢ Why are -send and -send-async separate methods? Couldn&apos;t they be a single multi-arity method? In case an adapter does not support it, you can always throw a &quot;not implemented&quot; exception. ‚Ä¢ Why is there -send-async and not -ping-async and -pong-async? In our case we have the possibility of knowing the termination of those options and in fact we use it but with ring protocols, we lose that option. Thanks :D"><y>#</y><d>2023-11-13</d><h>10:20</h><w>niwinz</w>Hello,

I&apos;m looking to integrate the new websockets protocols into an adapter that we maintain, and I have several questions:
‚Ä¢ Why are -send and -send-async separate methods? Couldn&apos;t they be a single multi-arity method? In case an adapter does not support it, you can always throw a &quot;not implemented&quot; exception.
‚Ä¢ Why is there -send-async and not -ping-async and -pong-async? In our case we have the possibility of knowing the termination of those options and in fact we use it but with ring protocols, we lose that option.
Thanks :D</z><z id="t1699972807" t="weavejester -send and -send-async are separate methods so they can be in separate protocols. This allows you to check using satisfies? whether or not a socket supports async behaviour, without relying on catching an exception. There is not a -ping-async and -pong-async because this wasn&apos;t supported by the Jakarta Servlet websocket implementation. So we can&apos;t assume that if an underlying websocket library supports async messages, that it also supports async ping/pong. However, I could add a new AsyncPingPongSocket protocol to support it."><y>#</y><d>2023-11-14</d><h>14:40</h><r>weavejester</r><code>-send</code> and <code>-send-async</code> are separate methods so they can be in separate protocols. This allows you to check using <code>satisfies?</code> whether or not a socket supports async behaviour, without relying on catching an exception.

There is not a <code>-ping-async</code> and <code>-pong-async</code> because this wasn&apos;t supported by the Jakarta Servlet websocket implementation. So we can&apos;t assume that if an underlying websocket library supports async messages, that it also supports async ping/pong. However, I could add a new <code>AsyncPingPongSocket</code> protocol to support it.</z><z id="t1699972850" t="niwinz nice, thanks for the reply"><y>#</y><d>2023-11-14</d><h>14:40</h><r>niwinz</r>nice, thanks for the reply</z><z id="t1699973008" t="niwinz other question, do you have plans to continue working on ring-2.0? I mean, we are already using ring-2.0 based protocols for some time now..."><y>#</y><d>2023-11-14</d><h>14:43</h><r>niwinz</r>other question, do you have plans to continue working on ring-2.0?
I mean, we are already using ring-2.0 based protocols for some time now...</z><z id="t1699973182" t="weavejester Ring 2.0 proved to be too much at once, but a lot of the ideas of Ring 2.0 are still sound. The approach I&apos;m taking now is to implement the functionality of Ring 2.0 in a more piecemeal fashion."><y>#</y><d>2023-11-14</d><h>14:46</h><r>weavejester</r>Ring 2.0 proved to be too much at once, but a lot of the ideas of Ring 2.0 are still sound. The approach I&apos;m taking now is to implement the functionality of Ring 2.0 in a more piecemeal fashion.</z><z id="t1699973199" t="weavejester So for example websockets will come in Ring 1.11."><y>#</y><d>2023-11-14</d><h>14:46</h><r>weavejester</r>So for example websockets will come in Ring 1.11.</z><z id="t1699973224" t="weavejester When you say &quot;Ring 2.0 protocols&quot;, do you mean the protocols for request/response maps?"><y>#</y><d>2023-11-14</d><h>14:47</h><r>weavejester</r>When you say &quot;Ring 2.0 protocols&quot;, do you mean the protocols for request/response maps?</z><z id="t1699973231" t="niwinz yep"><y>#</y><d>2023-11-14</d><h>14:47</h><r>niwinz</r>yep</z><z id="t1699973275" t="weavejester That could be a good next step for Ring 1.12 or 1.13."><y>#</y><d>2023-11-14</d><h>14:47</h><r>weavejester</r>That could be a good next step for Ring 1.12 or 1.13.</z><z id="t1699973317" t="niwinz FYI, we are using our internal adapter using undertow, that is right now ring2.0 based, but I&apos;m working right now on integrate the new websocket ring protocol (instead to have our own) and we have a plan to parametrice the adapter to work with ring1 or ring2 based requests/responses"><y>#</y><d>2023-11-14</d><h>14:48</h><r>niwinz</r>FYI, we are using our internal adapter using undertow, that is right now ring2.0 based, but I&apos;m working right now on integrate the new websocket ring protocol (instead to have our own) and we have a plan to parametrice the adapter to work with ring1 or ring2 based requests/responses</z><z id="t1699973358" t="niwinz for now the approach for ring2, I have copied/impoted the ring.request and ring.response from ring 2.0 branch to our repo"><y>#</y><d>2023-11-14</d><h>14:49</h><r>niwinz</r>for now the approach for ring2, I have copied/impoted the ring.request and ring.response from ring 2.0 branch to our repo</z><z id="t1699973404" t="niwinz until that namespaces are fully available on stable ring release"><y>#</y><d>2023-11-14</d><h>14:50</h><r>niwinz</r>until that namespaces are fully available on stable ring release</z><z id="t1699973500" t="weavejester One of the difficulties I ran into with Ring2 was the need to support both Ring1 and Ring2 request/response maps. That is, not necessarily the protocols, but the different keys (like :status vs :ring.request/status ). In retrospect, I&apos;m unsure if this was a good idea."><y>#</y><d>2023-11-14</d><h>14:51</h><r>weavejester</r>One of the difficulties I ran into with Ring2 was the need to support both Ring1 and Ring2 request/response maps. That is, not necessarily the protocols, but the different keys (like <code>:status</code> vs <code>:ring.request/status</code>). In retrospect, I&apos;m unsure if this was a good idea.</z><z id="t1699973708" t="niwinz Indeed, It is a breaking change, of course, But from my point of view is a good fresh view, and allows develop more efficient adapters, that perform less operations if final user does not uses some stuff from request..."><y>#</y><d>2023-11-14</d><h>14:55</h><r>niwinz</r>Indeed, It is a breaking change, of course,
But from my point of view is a good fresh view, and allows develop more efficient adapters, that perform less operations if final user does not uses some stuff from request...</z><z id="t1699973726" t="niwinz the obvious problem is backward compatibility..."><y>#</y><d>2023-11-14</d><h>14:55</h><r>niwinz</r>the obvious problem is backward compatibility...</z><z id="t1699973743" t="weavejester Well, the idea was that it wouldn&apos;t be a breaking change."><y>#</y><d>2023-11-14</d><h>14:55</h><r>weavejester</r>Well, the idea was that it wouldn&apos;t be a breaking change.</z><z id="t1699973754" t="weavejester And therein was the difficulty."><y>#</y><d>2023-11-14</d><h>14:55</h><r>weavejester</r>And therein was the difficulty.</z><z id="t1699973755" t="niwinz and supporting middlewares that should work in both modes"><y>#</y><d>2023-11-14</d><h>14:55</h><r>niwinz</r>and supporting middlewares that should work in both modes</z><z id="t1699973836" t="niwinz From my own experience, developing the adaprter thatwe are already using in production for some time, making an adapter that works in both modes is not difficult task"><y>#</y><d>2023-11-14</d><h>14:57</h><r>niwinz</r>From my own experience, developing the adaprter  thatwe are already using in production for some time, making an adapter that works in both modes is not difficult task</z><z id="t1699973863" t="weavejester Yes, it was more the infrastructure around it that I found to be difficult."><y>#</y><d>2023-11-14</d><h>14:57</h><r>weavejester</r>Yes, it was more the infrastructure around it that I found to be difficult.</z><z id="t1699973865" t="niwinz the difficult task is have the middleware work correctly"><y>#</y><d>2023-11-14</d><h>14:57</h><r>niwinz</r>the difficult task is have the middleware work correctly</z><z id="t1699973870" t="weavejester Right"><y>#</y><d>2023-11-14</d><h>14:57</h><r>weavejester</r>Right</z><z id="t1699973921" t="niwinz but in this case, I think it is not bad approach on the library developers and builitin middlewares is to detect which kind of request or response is coming"><y>#</y><d>2023-11-14</d><h>14:58</h><r>niwinz</r>but in this case, I think it is not bad approach on the library developers and builitin middlewares is to detect which kind of request or response is coming</z><z id="t1699974092" t="weavejester I don&apos;t think I&apos;ll attempt tackling the new keys immediately, at least not in 1.12 or 1.13. However, I don&apos;t believe there would be a problem with adding protocols for potentially faster access of request/response data. The adapter would still need to return something that Clojure recognizes as a map for compatibility, but using the protocols could be faster than using keyword lookup."><y>#</y><d>2023-11-14</d><h>15:01</h><r>weavejester</r>I don&apos;t think I&apos;ll attempt tackling the new keys immediately, at least not in 1.12 or 1.13. However, I don&apos;t believe there would be a problem with adding protocols for potentially faster access of request/response data. The adapter would still need to return something that Clojure recognizes as a map for compatibility, but using the protocols could be faster than using keyword lookup.</z><z id="t1699974199" t="niwinz that makes sense for me"><y>#</y><d>2023-11-14</d><h>15:03</h><r>niwinz</r>that makes sense for me</z></g></div></body>