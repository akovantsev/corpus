<!DOCTYPE html>
<head><title>clara</title><meta charset="UTF-8" /><style type="text/css">body {
    font-family: Monaco, Menlo, Consolas, "Courier New", sans-serif;
    font-size: 12px;
    margin: 15px;
}
h2 {text-align: center}
pre,
code {
    font-family: Monaco, Menlo, Consolas, "Courier New", monospace;
    color: #333;
}
code {
    /*line-height: 1.2;*/
    white-space: normal;
    color: #c25;
    background-color: #f7f7f9;
    border: 1px solid #e1e1e8;
}
pre {
    margin: .5rem 0 .2rem;
    font-size: .75rem;
    /*line-height: 1.15rem;*/
    background: #fbfaf8;
    padding: .5rem;
    word-break: normal;
    display: block;
    border: 1px solid rgba(0, 0, 0, .15);
    white-space: pre-wrap;
    word-wrap: break-word;
    border-radius: 4px;
}
span {
    white-space: pre-wrap;
}
span.u {
    margin-top: 3px;
    /*margin-left: 10px;*/
    margin-right: 10px;
    background-color: lavender;
}
span.t:hover {
    text-decoration: underline;
    color: blue;
    cursor: pointer
}
div[t]:target > span.u {
    background-color: aquamarine
}

#filters-container {
    position: fixed;
    left: 50px;
    z-index: 1;
}
#filters-container > input {
    /*column:*/
    display: block;
    outline-color: aquamarine;
}

div[t] > a:first-child {
    text-decoration: none;
    color: blue;
    position: absolute;
    left: 3px;
}

div[t] > a:first-child:hover {
    text-decoration: underline;
    color: aquamarine;
}


</style></head><body><style id="css-text-filter"></style><style id="css-date-filter"></style><style id="css-filter-override"></style><p id="filters-container"><input id="text-filter" onkeyup="debtextfilter(this.value)" placeholder="filter text" type="string" /><button hidden="hidden" id="date-filter" onclick="cleardatefilter()"></button></p><h2>#clara</h2><pre><i>generated UTC: 2020-11-20 18:23:29</i><i>
latest data: <a href="https://clojurians-log.clojureverse.org/clara/2020-11-17">https://clojurians-log.clojureverse.org/clara/2020-11-17</a></i>
pro tips:
* Double click on text to filter by it. (doubleclick + cmd-f for extra points).
* Click on date to keep day visible regardless of filter.
* Click on time to keep hour visible regardless of filter.</pre><script>const textFilterInput = document.getElementById("text-filter");
const dateFilterInput = document.getElementById("date-filter");
const filterTextStyle = document.getElementById("css-text-filter");
const filterDateStyle = document.getElementById("css-date-filter");
const filterStyleOverride = document.getElementById("css-filter-override");

function textFilter(text) {
    var style = '';
    if (text.trim() !== '') {
        text.split(' ').forEach(function (t) {
            if (t !== '') {
                style = style + "div[t]:not([t*='" + t + "' i]) {display: none; opacity: 0.6}";
            }
        });
    }
    filterTextStyle.innerHTML = style;
}


function filterSelection (e) {
    let sel = document.getSelection();
    let txt = sel.toString();
    textFilterInput.value = (txt || "");
    textFilter(txt);
}
function debounce1(callback, delay) {
    let timeout;
    return function(arg) {
        clearTimeout(timeout);
        timeout = setTimeout(callback, delay, arg);
    }
}

function keyUp (e) {
    if (e.code === "KeyF" && e.ctrlKey) {
        let txt = document.getSelection().toString();
        if (txt.length > 0) {
            textFilterInput.value = (txt || "");
            textFilter(txt);
        }
    }
}


function showDateTimes (el, datestr) {
    dateFilterInput.innerText = "clear: " + datestr;
    dateFilterInput.hidden = false;
    let ids = [];
    const clicked = el.parentElement.parentElement;  // el = div#id/span.u/span.t
    ids.push(clicked.id);
    // var idbefore, idafter;
    let cursor = clicked;
    function nextCursor (cursor) {
        const id = (cursor && cursor.id);
        const t = (cursor && cursor.getAttribute("t"))
        if (id) {
            ids.push(id); //includes 1st next-id not matching date.
        } else {
            cursor = null;
        }
        if (t && t.startsWith(datestr)) {
        } else {
            cursor = null;
        }
        return cursor;
    }
    while (cursor) {
        cursor = nextCursor(cursor.previousElementSibling);
    }

    cursor = clicked;

    while (cursor) {
        cursor = nextCursor(cursor.nextElementSibling);
    }


    var style1 = '';
    var style2 = '';
    var content;
    if (datestr.includes(" ")) { //hour
        content = "*";
    } else {
        content = "**";
    }
    ids.forEach(function (id) {
        if (id) {
            style1 = style1 + ", #" + id;
            style2 = style2 + ", #" + id + " span.t:nth-child(2):after";
        }
    })
    if (style1) {
        style1 = style1.substring(1) + " {display: block !important}";
    }
    if (style2) {
        style2 = style2.substring(1) + " {content: \"" + content + "\"; position: absolute}"
    }
    filterDateStyle.innerHTML = style1 + "\n" + style2;
}

function filterDay (el) {
    showDateTimes(el, el.textContent);
    el.scrollIntoView({behavior: "smooth", block: "center", inline: "start"});
}

function filterHours (el) {
    showDateTimes(el,el.previousElementSibling.textContent + " " + el.textContent.substring(0, 2));
    el.scrollIntoView({behavior: "smooth", block: "center", inline: "start"});
}

function forceShowSelected (el) {
    var id = el.parentElement.id
    if (id) {
        filterStyleOverride.innerHTML = ""
            + "#" + id
            + " {display: block !important;}"
            + "#" + id + " span.t:nth-child(2):after"
            + " {content: \"*\"; position: absolute}"

    } else {
        filterStyleOverride.innerHTML = "";
    }
}


function cleardatefilter () {
    dateFilterInput.hidden = true;
    dateFilterInput.innerText = "";
    filterDateStyle.innerHTML = "";
}

const D = filterDay;
const H = filterHours;
const S = forceShowSelected;
const debtextfilter = debounce1(textFilter, 200);

function doubleClick (e) {
    if (e.target.tagName !== "INPUT") {
        filterSelection();
        e.target.scrollIntoView({behavior: "auto", block: "center", inline: "start"});
    }
}

document.ondblclick = doubleClick;
document.onkeyup = keyUp;
textFilterInput.focus();
</script><div><div id="t1441309803000003" t="2015-09-03 19:50:03 devn Howdy folks"><a href="#t1441309803000003" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-09-03</span> <span class="t" onclick="H(this)">19:50:03</span>                    devn </span><span>Howdy folks</span></div><div id="t1441309808000004" t="2015-09-03 19:50:08 devn I am embarking on a Clara journey"><a href="#t1441309808000004" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-09-03</span> <span class="t" onclick="H(this)">19:50:08</span>                    devn </span><span>I am embarking on a Clara journey</span></div><div id="t1441309826000005" t="2015-09-03 19:50:26 devn I am curious if anyone has any recommended reading"><a href="#t1441309826000005" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-09-03</span> <span class="t" onclick="H(this)">19:50:26</span>                    devn </span><span>I am curious if anyone has any recommended reading</span></div><div id="t1441735926000002" t="2015-09-08 18:12:06 devn I found some..."><a href="#t1441735926000002" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-09-08</span> <span class="t" onclick="H(this)">18:12:06</span>                    devn </span><span>I found some...</span></div><div id="t1441736141000003" t="2015-09-08 18:15:41 devn http://reports-archive.adm.cs.cmu.edu/anon/1995/CMU-CS-95-113.pdf"><a href="#t1441736141000003" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-09-08</span> <span class="t" onclick="H(this)">18:15:41</span>                    devn </span><a href="http://reports-archive.adm.cs.cmu.edu/anon/1995/CMU-CS-95-113.pdf" target="_blank">http://reports-archive.adm.cs.cmu.edu/anon/1995/CMU-CS-95-113.pdf</a></div><div id="t1441736149000004" t="2015-09-08 18:15:49 devn https://www.amazon.com/Expert-Systems-Principles-Programming-Edition/dp/0534384471"><a href="#t1441736149000004" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-09-08</span> <span class="t" onclick="H(this)">18:15:49</span>                    devn </span><a href="https://www.amazon.com/Expert-Systems-Principles-Programming-Edition/dp/0534384471" target="_blank">https://www.amazon.com/Expert-Systems-Principles-Programming-Edition/dp/0534384471</a></div><div id="t1441736196000009" t="2015-09-08 18:16:36 devn via @fogus ... via @alandipert"><a href="#t1441736196000009" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-09-08</span> <span class="t" onclick="H(this)">18:16:36</span>                    devn </span><span>via @fogus ... via @alandipert</span></div><div id="t1441736223000010" t="2015-09-08 18:17:03 devn I suppose this channel could also be #zeder"><a href="#t1441736223000010" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-09-08</span> <span class="t" onclick="H(this)">18:17:03</span>                    devn </span><span>I suppose this channel could also be #zeder</span></div><div id="t1441736236000011" t="2015-09-08 18:17:16 devn I&apos;ll quit talking to myself, for now..."><a href="#t1441736236000011" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-09-08</span> <span class="t" onclick="H(this)">18:17:16</span>                    devn </span><span>I&apos;ll quit talking to myself, for now...</span></div><div id="t1441755680000012" t="2015-09-08 23:41:20 cedric.hurst hey @devn"><a href="#t1441755680000012" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-09-08</span> <span class="t" onclick="H(this)">23:41:20</span>            cedric.hurst </span><span>hey @devn</span></div><div id="t1441755722000013" t="2015-09-08 23:42:02 cedric.hurst the drools project has some fairly decent generic documentation on the rete algorithm as well:  http://docs.jboss.org/drools/release/6.2.0.Final/drools-docs/html/ch05.html#ReteOO"><a href="#t1441755722000013" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-09-08</span> <span class="t" onclick="H(this)">23:42:02</span>            cedric.hurst </span><span>the drools project has some fairly decent generic documentation on the rete algorithm as well: </span><a href="http://docs.jboss.org/drools/release/6.2.0.Final/drools-docs/html/ch05.html#ReteOO" target="_blank">http://docs.jboss.org/drools/release/6.2.0.Final/drools-docs/html/ch05.html#ReteOO</a></div><div id="t1441829925000014" t="2015-09-09 20:18:45 devn Thanks @cedric.hurst"><a href="#t1441829925000014" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-09-09</span> <span class="t" onclick="H(this)">20:18:45</span>                    devn </span><span>Thanks @cedric.hurst</span></div><div id="t1445878252000005" t="2015-10-26 16:50:52 noprompt does anyone know if it&apos;s possible to destructure facts in queries?"><a href="#t1445878252000005" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-10-26</span> <span class="t" onclick="H(this)">16:50:52</span>                noprompt </span><span>does anyone know if it&apos;s possible to destructure facts in queries?</span></div><div id="t1445878304000006" t="2015-10-26 16:51:44 noprompt following the railroad diagram doesn&apos;t appear to result in a valid query."><a href="#t1445878304000006" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-10-26</span> <span class="t" onclick="H(this)">16:51:44</span>                noprompt </span><span>following the railroad diagram doesn&apos;t appear to result in a valid query.</span></div><div id="t1445878714000007" t="2015-10-26 16:58:34 noprompt nm, we figured it out. we had a stale session.  😿"><a href="#t1445878714000007" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-10-26</span> <span class="t" onclick="H(this)">16:58:34</span>                noprompt </span><span>nm, we figured it out. we had a stale session. </span><b>😿</b></div><div id="t1446161146000010" t="2015-10-29 23:25:46 noprompt @ryanbrush is here!  🎊"><a href="#t1446161146000010" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-10-29</span> <span class="t" onclick="H(this)">23:25:46</span>                noprompt </span><span>@ryanbrush is here! </span><b>🎊</b></div><div id="t1446161765000011" t="2015-10-29 23:36:05 ryanbrush Howdy! I&apos;m something of a slack newbie but thought I would check it out."><a href="#t1446161765000011" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-10-29</span> <span class="t" onclick="H(this)">23:36:05</span>               ryanbrush </span><span>Howdy! I&apos;m something of a slack newbie but thought I would check it out.</span></div><div id="t1446166140000012" t="2015-10-30 00:49:00 ryanbrush So while I&apos;m here, I thought it would be worth mentioning that Clara 0.9 is out. We&apos;re finally on Clojure 1.7 with reader conditionals!  https://groups.google.com/forum/#!topic/clara-rules/6Y2zHx9OQwA"><a href="#t1446166140000012" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-10-30</span> <span class="t" onclick="H(this)">00:49:00</span>               ryanbrush </span><span>So while I&apos;m here, I thought it would be worth mentioning that Clara 0.9 is out. We&apos;re finally on Clojure 1.7 with reader conditionals! </span><a href="https://groups.google.com/forum/#!topic/clara-rules/6Y2zHx9OQwA" target="_blank">https://groups.google.com/forum/#!topic/clara-rules/6Y2zHx9OQwA</a></div><div id="t1446217698000013" t="2015-10-30 15:08:18 enn :+1:  thanks, much nicer to work with than cljx"><a href="#t1446217698000013" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-10-30</span> <span class="t" onclick="H(this)">15:08:18</span>                     enn </span><b>:+1:</b><span> thanks, much nicer to work with than cljx</span></div><div id="t1446217786000015" t="2015-10-30 15:09:46 devn @ryanbrush: huzzah! nice release."><a href="#t1446217786000015" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-10-30</span> <span class="t" onclick="H(this)">15:09:46</span>                    devn </span><span>@ryanbrush: huzzah! nice release.</span></div><div id="t1446233400000017" t="2015-10-30 19:30:00 devn @ryanbrush: sorry to be a bother, and I could and will certainly do it myself if it&apos;s a pain or you&apos;d rather not, but any chance of getting a clara-tools release in light of the clara 0.9.0 release?"><a href="#t1446233400000017" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-10-30</span> <span class="t" onclick="H(this)">19:30:00</span>                    devn </span><span>@ryanbrush: sorry to be a bother, and I could and will certainly do it myself if it&apos;s a pain or you&apos;d rather not, but any chance of getting a clara-tools release in light of the clara 0.9.0 release?</span></div><div id="t1446233432000019" t="2015-10-30 19:30:32 devn Also, welcome @thomas  simple_smile"><a href="#t1446233432000019" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-10-30</span> <span class="t" onclick="H(this)">19:30:32</span>                    devn </span><span>Also, welcome @thomas </span><b>simple_smile</b></div><div id="t1446233939000020" t="2015-10-30 19:38:59 thomas Thank you"><a href="#t1446233939000020" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-10-30</span> <span class="t" onclick="H(this)">19:38:59</span>                  thomas </span><span>Thank you</span></div><div id="t1446235418000021" t="2015-10-30 20:03:38 devn @thomas: you using clara?"><a href="#t1446235418000021" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-10-30</span> <span class="t" onclick="H(this)">20:03:38</span>                    devn </span><span>@thomas: you using clara?</span></div><div id="t1446237614000022" t="2015-10-30 20:40:14 thomas No, but I am working on a product with a rule engine at the moment... Hence my interest in clara"><a href="#t1446237614000022" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-10-30</span> <span class="t" onclick="H(this)">20:40:14</span>                  thomas </span><span>No, but I am working on a product with a rule engine at the moment... Hence my interest in clara</span></div><div id="t1446237696000023" t="2015-10-30 20:41:36 devn @thomas: cool. i&apos;m on a team that&apos;s pretty new to rules engines, myself included. we&apos;re building a new product using clara at the moment and so far it&apos;s been really great."><a href="#t1446237696000023" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-10-30</span> <span class="t" onclick="H(this)">20:41:36</span>                    devn </span><span>@thomas: cool. i&apos;m on a team that&apos;s pretty new to rules engines, myself included. we&apos;re building a new product using clara at the moment and so far it&apos;s been really great.</span></div><div id="t1446237784000024" t="2015-10-30 20:43:04 devn @thomas: I&apos;d also like to add that @ryanbrush has done a really great job of maintaining, and is using it for real work in production. Super responsive on questions, issues, PRs, etc. So, recommended.  simple_smile"><a href="#t1446237784000024" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-10-30</span> <span class="t" onclick="H(this)">20:43:04</span>                    devn </span><span>@thomas: I&apos;d also like to add that @ryanbrush has done a really great job of maintaining, and is using it for real work in production. Super responsive on questions, issues, PRs, etc. So, recommended. </span><b>simple_smile</b></div><div id="t1446237801000025" t="2015-10-30 20:43:21 thomas Sounds good. I haven&apos;t had a good look at clara yet.  "><a href="#t1446237801000025" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-10-30</span> <span class="t" onclick="H(this)">20:43:21</span>                  thomas </span><span>Sounds good. I haven&apos;t had a good look at clara yet.  </span></div><div id="t1446238394000027" t="2015-10-30 20:53:14 ryanbrush Yes, we&apos;re using it heavily in production now, and I know of a couple others who are as well (although I&apos;m not sure if they&apos;re okay with it being publicly revealed). I did see a post that AppsFlyer is using it ( https://www.appsflyer.com/blog/how-we-solved-authentication-and-authorization-in-our-microservices-architecture/ ) as well."><a href="#t1446238394000027" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-10-30</span> <span class="t" onclick="H(this)">20:53:14</span>               ryanbrush </span><span>Yes, we&apos;re using it heavily in production now, and I know of a couple others who are as well (although I&apos;m not sure if they&apos;re okay with it being publicly revealed). I did see a post that AppsFlyer is using it (</span><a href="https://www.appsflyer.com/blog/how-we-solved-authentication-and-authorization-in-our-microservices-architecture/" target="_blank">https://www.appsflyer.com/blog/how-we-solved-authentication-and-authorization-in-our-microservices-architecture/</a><span>) as well.</span></div><div id="t1446238577000029" t="2015-10-30 20:56:17 ryanbrush @devn As for a clara-tools release, I should be able to push out 0.1.0 tomorrow based on the accum_updates branch, assuming everything is working well for you with that and Clara 0.9.0."><a href="#t1446238577000029" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-10-30</span> <span class="t" onclick="H(this)">20:56:17</span>               ryanbrush </span><span>@devn As for a clara-tools release, I should be able to push out 0.1.0 tomorrow based on the accum_updates branch, assuming everything is working well for you with that and Clara 0.9.0.</span></div><div id="t1446238902000030" t="2015-10-30 21:01:42 devn @ryanbrush: It&apos;s certainly better to see a graph containing the accumulator instead of no graph at all. I guess I would be surprised if 0.9.0 broke the changes you pushed on the  accum_updates  branch, but I will give it a look and verify now."><a href="#t1446238902000030" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-10-30</span> <span class="t" onclick="H(this)">21:01:42</span>                    devn </span><span>@ryanbrush: It&apos;s certainly better to see a graph containing the accumulator instead of no graph at all. I guess I would be surprised if 0.9.0 broke the changes you pushed on the </span><code>accum_updates</code><span> branch, but I will give it a look and verify now.</span></div><div id="t1446246739000032" t="2015-10-30 23:12:19 devn @mdp: hola  simple_smile"><a href="#t1446246739000032" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-10-30</span> <span class="t" onclick="H(this)">23:12:19</span>                    devn </span><span>@mdp: hola </span><b>simple_smile</b></div><div id="t1446248134000033" t="2015-10-30 23:35:34 mdp @devn: hey  simple_smile"><a href="#t1446248134000033" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-10-30</span> <span class="t" onclick="H(this)">23:35:34</span>                     mdp </span><span>@devn: hey </span><b>simple_smile</b></div><div id="t1446297362000036" t="2015-10-31 13:16:02 ryanbrush @devn clara-tools-0.1.1 is up on Clojars. I took it for a spin with Clara 0.9 and everything seems to be working well."><a href="#t1446297362000036" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-10-31</span> <span class="t" onclick="H(this)">13:16:02</span>               ryanbrush </span><span>@devn clara-tools-0.1.1 is up on Clojars. I took it for a spin with Clara 0.9 and everything seems to be working well.</span></div><div id="t1446297459000037" t="2015-10-31 13:17:39 ryanbrush For anyone else who is curious, clara-tools is an experimental UI to visualize rule logic and sessions. (It&apos;s what I used in the Strangeloop 2014 talk.) It&apos;s not as battle hardened as clara-rules itself but has drawn some interest."><a href="#t1446297459000037" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-10-31</span> <span class="t" onclick="H(this)">13:17:39</span>               ryanbrush </span><span>For anyone else who is curious, clara-tools is an experimental UI to visualize rule logic and sessions. (It&apos;s what I used in the Strangeloop 2014 talk.) It&apos;s not as battle hardened as clara-rules itself but has drawn some interest.</span></div><div id="t1446334267000038" t="2015-10-31 23:31:07 devn @ryanbrush: you rule. thanks!"><a href="#t1446334267000038" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-10-31</span> <span class="t" onclick="H(this)">23:31:07</span>                    devn </span><span>@ryanbrush: you rule. thanks!</span></div><div id="t1446334361000039" t="2015-10-31 23:32:41 devn @ryanbrush: i guess I&apos;m a little surprised there hasn&apos;t been more interest in it. Is the situation you have at Cerner one in which clinical staff help to write rules, or evaluate the results of the engine?"><a href="#t1446334361000039" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-10-31</span> <span class="t" onclick="H(this)">23:32:41</span>                    devn </span><span>@ryanbrush: i guess I&apos;m a little surprised there hasn&apos;t been more interest in it. Is the situation you have at Cerner one in which clinical staff help to write rules, or evaluate the results of the engine?</span></div><div id="t1446334465000040" t="2015-10-31 23:34:25 devn i&apos;ve always thought that the explanation piece of a rules engine was one of the biggest driving factors behind choosing to use one on a project, so I guess I&apos;m surprised there aren&apos;t fancier explanations or more interest in graphing"><a href="#t1446334465000040" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-10-31</span> <span class="t" onclick="H(this)">23:34:25</span>                    devn </span><span>i&apos;ve always thought that the explanation piece of a rules engine was one of the biggest driving factors behind choosing to use one on a project, so I guess I&apos;m surprised there aren&apos;t fancier explanations or more interest in graphing</span></div><div id="t1446396591000041" t="2015-11-01 16:49:51 ryanbrush @devn Our internal code has its own facilities for doing explanation that are specific to the domain, and unfortunately not something I can get into publicly. I do think clara-tools has a bright future, it just hasn&apos;t quite made it to being a big priority yet."><a href="#t1446396591000041" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-11-01</span> <span class="t" onclick="H(this)">16:49:51</span>               ryanbrush </span><span>@devn Our internal code has its own facilities for doing explanation that are specific to the domain, and unfortunately not something I can get into publicly. I do think clara-tools has a bright future, it just hasn&apos;t quite made it to being a big priority yet.</span></div><div id="t1446409378000042" t="2015-11-01 20:22:58 devn @ryanbrush: Yeah, no surprise to me that there&apos;s some special sauce for domain-specific explanation. We&apos;re already there ourselves."><a href="#t1446409378000042" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-11-01</span> <span class="t" onclick="H(this)">20:22:58</span>                    devn </span><span>@ryanbrush: Yeah, no surprise to me that there&apos;s some special sauce for domain-specific explanation. We&apos;re already there ourselves.</span></div><div id="t1446409459000043" t="2015-11-01 20:24:19 devn I guess I&apos;m wondering aloud a little bit about whether or not it&apos;s the concern of Clara to provide hooks into extending/providing the built-in explanation facilities."><a href="#t1446409459000043" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-11-01</span> <span class="t" onclick="H(this)">20:24:19</span>                    devn </span><span>I guess I&apos;m wondering aloud a little bit about whether or not it&apos;s the concern of Clara to provide hooks into extending/providing the built-in explanation facilities.</span></div><div id="t1446409570000045" t="2015-11-01 20:26:10 devn Or if it&apos;s more along the lines of: &quot;clara gives you plenty of data to build your own explanations. use it.&quot;"><a href="#t1446409570000045" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-11-01</span> <span class="t" onclick="H(this)">20:26:10</span>                    devn </span><span>Or if it&apos;s more along the lines of: &quot;clara gives you plenty of data to build your own explanations. use it.&quot;</span></div><div id="t1446409636000046" t="2015-11-01 20:27:16 devn I think there&apos;s a delicate balance there, but I don&apos;t have a strong opinion at the moment."><a href="#t1446409636000046" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-11-01</span> <span class="t" onclick="H(this)">20:27:16</span>                    devn </span><span>I think there&apos;s a delicate balance there, but I don&apos;t have a strong opinion at the moment.</span></div><div id="t1446420628000047" t="2015-11-01 23:30:28 devn Heya @ryanbrush -- Is there a reason why there isn&apos;t a  group-by -esque built-in accumulator?"><a href="#t1446420628000047" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-11-01</span> <span class="t" onclick="H(this)">23:30:28</span>                    devn </span><span>Heya @ryanbrush -- Is there a reason why there isn&apos;t a </span><code>group-by</code><span>-esque built-in accumulator?</span></div><div id="t1446421956000048" t="2015-11-01 23:52:36 ryanbrush @devn No reason besides the fact that we just hadn&apos;t needed it yet. I think it makes sense and would be happy to include it if someone wants to take a stab at it."><a href="#t1446421956000048" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-11-01</span> <span class="t" onclick="H(this)">23:52:36</span>               ryanbrush </span><span>@devn No reason besides the fact that we just hadn&apos;t needed it yet. I think it makes sense and would be happy to include it if someone wants to take a stab at it.</span></div><div id="t1446422073000049" t="2015-11-01 23:54:33 devn @ryanbrush: cool, was seeing max/sum/all/min/average and such, which made me wonder if group-by would somehow be problematic for automatic retraction"><a href="#t1446422073000049" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-11-01</span> <span class="t" onclick="H(this)">23:54:33</span>                    devn </span><span>@ryanbrush: cool, was seeing max/sum/all/min/average and such, which made me wonder if group-by would somehow be problematic for automatic retraction</span></div><div id="t1446422541000050" t="2015-11-02 00:02:21 ryanbrush Retraction presents some edge cases that aren&apos;t trivial but it&apos;s solvable in group-by similar to how we do it in other accumulators. Notice the all accumulator takes care to only remove what is retracted, for instance. Group-by is more complicated but I think a suitable approach would work."><a href="#t1446422541000050" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-11-02</span> <span class="t" onclick="H(this)">00:02:21</span>               ryanbrush </span><span>Retraction presents some edge cases that aren&apos;t trivial but it&apos;s solvable in group-by similar to how we do it in other accumulators. Notice the all accumulator takes care to only remove what is retracted, for instance. Group-by is more complicated but I think a suitable approach would work.</span></div><div id="t1446422580000051" t="2015-11-02 00:03:00 devn Gotcha. Thanks."><a href="#t1446422580000051" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-11-02</span> <span class="t" onclick="H(this)">00:03:00</span>                    devn </span><span>Gotcha. Thanks.</span></div><div id="t1446422649000052" t="2015-11-02 00:04:09 devn @ryanbrush: as long as I&apos;ve got you here: something that&apos;s been on my mind that I think I remember reading something on the ML about is: How much can I rely on storing rules in a database, what about sessions? We&apos;ve been toying with the idea of exposing some level of rule authorship at some point in the future, but either way, we are going to have differing sets of rules, some of which will be generated based on configuration data."><a href="#t1446422649000052" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-11-02</span> <span class="t" onclick="H(this)">00:04:09</span>                    devn </span><span>@ryanbrush: as long as I&apos;ve got you here: something that&apos;s been on my mind that I think I remember reading something on the ML about is: How much can I rely on storing rules in a database, what about sessions? We&apos;ve been toying with the idea of exposing some level of rule authorship at some point in the future, but either way, we are going to have differing sets of rules, some of which will be generated based on configuration data.</span></div><div id="t1446423060000053" t="2015-11-02 00:11:00 devn Other random things on my mind:

1.) I&apos;ve been reading about Jess and Drools, and they have a  collect  or  collectBy  IIRC. Since  map  can be written in terms of  reduce , is it reasonable to say that Clara has  collect  by way of its  accumulate ? Is  all  basically  collect ?

2.) Do you have any suggested reading? I am occasionally flop-sweating a bit over whether or not I should reach for an accumulator, for instance. This is my first time working with a rules engine, and so I am still sort of in the hunting and pecking phase. Not entirely confident."><a href="#t1446423060000053" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-11-02</span> <span class="t" onclick="H(this)">00:11:00</span>                    devn </span><span>Other random things on my mind:

1.) I&apos;ve been reading about Jess and Drools, and they have a </span><code>collect</code><span> or </span><code>collectBy</code><span> IIRC. Since </span><code>map</code><span> can be written in terms of </span><code>reduce</code><span>, is it reasonable to say that Clara has </span><code>collect</code><span> by way of its </span><code>accumulate</code><span>? Is </span><code>all</code><span> basically </span><code>collect</code><span>?

2.) Do you have any suggested reading? I am occasionally flop-sweating a bit over whether or not I should reach for an accumulator, for instance. This is my first time working with a rules engine, and so I am still sort of in the hunting and pecking phase. Not entirely confident.</span></div><div id="t1446423321000056" t="2015-11-02 00:15:21 ryanbrush I don&apos;t see any problem with storing rules or externally or generating them, and mixing those rules with hand-written rules. mk-session supports multiple inputs that can pull rules in from multiple heterogenous sources. Note that to load new rules you need to create a new session...you can&apos;t add or update rules to a session that has already been created."><a href="#t1446423321000056" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-11-02</span> <span class="t" onclick="H(this)">00:15:21</span>               ryanbrush </span><span>I don&apos;t see any problem with storing rules or externally or generating them, and mixing those rules with hand-written rules. mk-session supports multiple inputs that can pull rules in from multiple heterogenous sources. Note that to load new rules you need to create a new session...you can&apos;t add or update rules to a session that has already been created.</span></div><div id="t1446423390000057" t="2015-11-02 00:16:30 ryanbrush As for collect and collectBy, it&apos;s been a while since I&apos;ve used Drools but I believe they are basically just the all accumulator (or some other special accumulator case)."><a href="#t1446423390000057" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-11-02</span> <span class="t" onclick="H(this)">00:16:30</span>               ryanbrush </span><span>As for collect and collectBy, it&apos;s been a while since I&apos;ve used Drools but I believe they are basically just the all accumulator (or some other special accumulator case).</span></div><div id="t1446423532000058" t="2015-11-02 00:18:52 ryanbrush As for recommended reading, most of what I&apos;ve found lately subscribes to the approach of rules-for-business-users rather than directed at engineers, so there&apos;s not much out there. I think designing rules just follows the best practices for designing code: take the simplest, most clear, and least surprising approach possible...and iterate to improve it."><a href="#t1446423532000058" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-11-02</span> <span class="t" onclick="H(this)">00:18:52</span>               ryanbrush </span><span>As for recommended reading, most of what I&apos;ve found lately subscribes to the approach of rules-for-business-users rather than directed at engineers, so there&apos;s not much out there. I think designing rules just follows the best practices for designing code: take the simplest, most clear, and least surprising approach possible...and iterate to improve it.</span></div><div id="t1446423535000059" t="2015-11-02 00:18:55 devn @ryanbrush: yeah, we&apos;re pulling from multiple sources right now. I guess the big question was: as of right now, do you foresee any future compatibility issues with storing the value of a  defrule . Like, if 1.0 changed to having  :lhs {:different [] :stuff []}"><a href="#t1446423535000059" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-11-02</span> <span class="t" onclick="H(this)">00:18:55</span>                    devn </span><span>@ryanbrush: yeah, we&apos;re pulling from multiple sources right now. I guess the big question was: as of right now, do you foresee any future compatibility issues with storing the value of a </span><code>defrule</code><span>. Like, if 1.0 changed to having </span><code>:lhs {:different [] :stuff []}</code></div><div id="t1446423617000060" t="2015-11-02 00:20:17 ryanbrush No, I think the schema for the defrule and defquery value is pretty much locked down."><a href="#t1446423617000060" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-11-02</span> <span class="t" onclick="H(this)">00:20:17</span>               ryanbrush </span><span>No, I think the schema for the defrule and defquery value is pretty much locked down.</span></div><div id="t1446423660000061" t="2015-11-02 00:21:00 ryanbrush Any changes there would be non-breaking (like we might add properties for activation groups or things like that). But that basic structure of a rule is pretty fundamental to the system, so I don&apos;t see it changing."><a href="#t1446423660000061" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-11-02</span> <span class="t" onclick="H(this)">00:21:00</span>               ryanbrush </span><span>Any changes there would be non-breaking (like we might add properties for activation groups or things like that). But that basic structure of a rule is pretty fundamental to the system, so I don&apos;t see it changing.</span></div><div id="t1446423663000062" t="2015-11-02 00:21:03 devn @ryanbrush: good common sense advice. i would hope we&apos;re meeting our obligation to keep things clean, but in some cases I question whether I&apos;m taking the &quot;easy&quot; route over the &quot;simple&quot; route, simply because I don&apos;t know what I don&apos;t know."><a href="#t1446423663000062" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-11-02</span> <span class="t" onclick="H(this)">00:21:03</span>                    devn </span><span>@ryanbrush: good common sense advice. i would hope we&apos;re meeting our obligation to keep things clean, but in some cases I question whether I&apos;m taking the &quot;easy&quot; route over the &quot;simple&quot; route, simply because I don&apos;t know what I don&apos;t know.</span></div><div id="t1446423684000065" t="2015-11-02 00:21:24 ryanbrush @devn Haha, I feel that way every day I wrote code!"><a href="#t1446423684000065" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-11-02</span> <span class="t" onclick="H(this)">00:21:24</span>               ryanbrush </span><span>@devn Haha, I feel that way every day I wrote code!</span></div><div id="t1446423736000066" t="2015-11-02 00:22:16 devn heh, yeah, kind of a universal problem  simple_smile"><a href="#t1446423736000066" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-11-02</span> <span class="t" onclick="H(this)">00:22:16</span>                    devn </span><span>heh, yeah, kind of a universal problem </span><b>simple_smile</b></div><div id="t1446423743000067" t="2015-11-02 00:22:23 devn btw @ryanbrush -- i dropped you a PM"><a href="#t1446423743000067" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-11-02</span> <span class="t" onclick="H(this)">00:22:23</span>                    devn </span><span>btw @ryanbrush -- i dropped you a PM</span></div><div id="t1446423786000068" t="2015-11-02 00:23:06 ryanbrush @devn By the way, what do you think about changing the URL for this group to  http://www.clara-rules.org/  ? It&apos;s a bit cleaner and more accessible front door to Clara than the GitHub page."><a href="#t1446423786000068" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-11-02</span> <span class="t" onclick="H(this)">00:23:06</span>               ryanbrush </span><span>@devn By the way, what do you think about changing the URL for this group to </span><a href="http://www.clara-rules.org/" target="_blank">http://www.clara-rules.org/</a><span> ? It&apos;s a bit cleaner and more accessible front door to Clara than the GitHub page.</span></div><div id="t1446423797000070" t="2015-11-02 00:23:17 devn Of course!"><a href="#t1446423797000070" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-11-02</span> <span class="t" onclick="H(this)">00:23:17</span>                    devn </span><span>Of course!</span></div><div id="t1446423807000071" t="2015-11-02 00:23:27 devn This is really your channel.  simple_smile"><a href="#t1446423807000071" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-11-02</span> <span class="t" onclick="H(this)">00:23:27</span>                    devn </span><span>This is really your channel. </span><b>simple_smile</b></div><div id="t1447448695000003" t="2015-11-13 21:04:55 noprompt @ryanbrush: this appears to be invalid is there a way to express this?:"><a href="#t1447448695000003" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-11-13</span> <span class="t" onclick="H(this)">21:04:55</span>                noprompt </span><span>@ryanbrush: this appears to be invalid is there a way to express this?:</span></div><div id="t1447448697000004" t="2015-11-13 21:04:57 noprompt [?it &lt;- accumulator
   [:or
    [X1 (= ?v x)]
    [X2 (= ?v x)]
    [X3 (= ?v x)]]]"><a href="#t1447448697000004" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-11-13</span> <span class="t" onclick="H(this)">21:04:57</span>                noprompt </span><pre>[?it &lt;- accumulator
   [:or
    [X1 (= ?v x)]
    [X2 (= ?v x)]
    [X3 (= ?v x)]]]</pre></div><div id="t1447448846000005" t="2015-11-13 21:07:26 noprompt the error we receive  {:type java.lang.IllegalArgumentException
   :message &quot;Only one argument can be passed to a condition.&quot;
   :at [clara.rules.dsl$construct_condition invoke &quot;dsl.clj&quot; 53]}"><a href="#t1447448846000005" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-11-13</span> <span class="t" onclick="H(this)">21:07:26</span>                noprompt </span><span>the error we receive </span><pre>{:type java.lang.IllegalArgumentException
   :message &quot;Only one argument can be passed to a condition.&quot;
   :at [clara.rules.dsl$construct_condition invoke &quot;dsl.clj&quot; 53]}</pre></div><div id="t1447448928000006" t="2015-11-13 21:08:48 noprompt maybe it&apos;s worth a PR but i think it&apos;d be helpful to use  ex-info  here providing the offending form. we had to do a bit of binary chop to find the problem."><a href="#t1447448928000006" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-11-13</span> <span class="t" onclick="H(this)">21:08:48</span>                noprompt </span><span>maybe it&apos;s worth a PR but i think it&apos;d be helpful to use </span><code>ex-info</code><span> here providing the offending form. we had to do a bit of binary chop to find the problem.</span></div><div id="t1447449342000007" t="2015-11-13 21:15:42 ryanbrush @noprompt:  Yeah, that error message is pretty bad; we need to share something better there. As for the problem itself, accumulators can only accumulate over simple fact-based expressions rather than everything in a complex expression. So rather than having the [:or ] &quot;inside&quot; the accumulator, you&apos;d need to accumulate over each of X1, X2, and X3 independently."><a href="#t1447449342000007" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-11-13</span> <span class="t" onclick="H(this)">21:15:42</span>               ryanbrush </span><span>@noprompt:  Yeah, that error message is pretty bad; we need to share something better there. As for the problem itself, accumulators can only accumulate over simple fact-based expressions rather than everything in a complex expression. So rather than having the [:or ] &quot;inside&quot; the accumulator, you&apos;d need to accumulate over each of X1, X2, and X3 independently.</span></div><div id="t1447449631000008" t="2015-11-13 21:20:31 ryanbrush There might be other ways to break down the problem depending on what you&apos;re trying to accomplish. For instance, if X1, X2, and X3 are children of a super type, you can match on the super type.  Clara just uses Clojure&apos;s type system by default, which also works with Java&apos;s type hierarchy and obeys clojure.core/derive if you want to use that to logically derive new types."><a href="#t1447449631000008" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-11-13</span> <span class="t" onclick="H(this)">21:20:31</span>               ryanbrush </span><span>There might be other ways to break down the problem depending on what you&apos;re trying to accomplish. For instance, if X1, X2, and X3 are children of a super type, you can match on the super type.  Clara just uses Clojure&apos;s type system by default, which also works with Java&apos;s type hierarchy and obeys clojure.core/derive if you want to use that to logically derive new types.</span></div><div id="t1447449935000009" t="2015-11-13 21:25:35 noprompt here&apos;s what we came up with:"><a href="#t1447449935000009" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-11-13</span> <span class="t" onclick="H(this)">21:25:35</span>                noprompt </span><span>here&apos;s what we came up with:</span></div><div id="t1447449936000010" t="2015-11-13 21:25:36 noprompt [?it &lt;-
 [:or
  [?x1 &lt;- accumulator :from
   [X1 (= ?v x)]]

  [?x2 &lt;- accumulator :from
   [X2 (= ?v x)]]

  [?x3 &lt;- accumulator :from
   [X3 (= ?v x)]]]]"><a href="#t1447449936000010" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-11-13</span> <span class="t" onclick="H(this)">21:25:36</span>                noprompt </span><pre>[?it &lt;-
 [:or
  [?x1 &lt;- accumulator :from
   [X1 (= ?v x)]]

  [?x2 &lt;- accumulator :from
   [X2 (= ?v x)]]

  [?x3 &lt;- accumulator :from
   [X3 (= ?v x)]]]]</pre></div><div id="t1447449987000012" t="2015-11-13 21:26:27 noprompt @ryanbrush: you mentioned  derive  can you explain how that would work? afaik it only works with namespaced keywords."><a href="#t1447449987000012" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-11-13</span> <span class="t" onclick="H(this)">21:26:27</span>                noprompt </span><span>@ryanbrush: you mentioned </span><code>derive</code><span> can you explain how that would work? afaik it only works with namespaced keywords.</span></div><div id="t1447450213000013" t="2015-11-13 21:30:13 ryanbrush Sure. Some users are just using Clojure maps as their fact types and tagging type metadata to them in the form of namespaced keywords, where derive will work."><a href="#t1447450213000013" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-11-13</span> <span class="t" onclick="H(this)">21:30:13</span>               ryanbrush </span><span>Sure. Some users are just using Clojure maps as their fact types and tagging type metadata to them in the form of namespaced keywords, where derive will work.</span></div><div id="t1447450296000014" t="2015-11-13 21:31:36 ryanbrush I think the child in derive can also be an arbitrary record type...it&apos;s the parent that needs to be a namespaced keyword. This might be an abuse of the intent of derive, though."><a href="#t1447450296000014" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-11-13</span> <span class="t" onclick="H(this)">21:31:36</span>               ryanbrush </span><span>I think the child in derive can also be an arbitrary record type...it&apos;s the parent that needs to be a namespaced keyword. This might be an abuse of the intent of derive, though.</span></div><div id="t1447450370000015" t="2015-11-13 21:32:50 ryanbrush As for the model you came up with: I&apos;m actually not sure that will work...or at least I don&apos;t have a test covering binding to the result of an :or expression and that isn&apos;t something we&apos;ve done in production."><a href="#t1447450370000015" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-11-13</span> <span class="t" onclick="H(this)">21:32:50</span>               ryanbrush </span><span>As for the model you came up with: I&apos;m actually not sure that will work...or at least I don&apos;t have a test covering binding to the result of an :or expression and that isn&apos;t something we&apos;ve done in production.</span></div><div id="t1447450413000016" t="2015-11-13 21:33:33 noprompt right. we&apos;re using records and unfortunately that does not work with  derive  (e.g.  (derive Square Shape) )."><a href="#t1447450413000016" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-11-13</span> <span class="t" onclick="H(this)">21:33:33</span>                noprompt </span><span>right. we&apos;re using records and unfortunately that does not work with </span><code>derive</code><span> (e.g. </span><code>(derive Square Shape)</code><span>).</span></div><div id="t1447450418000017" t="2015-11-13 21:33:38 ryanbrush Another approach would be to break up the accumulators into separate rules, each of which insert some &quot;GroupOfX&quot; type that can be joined to in another rule that combines them all."><a href="#t1447450418000017" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-11-13</span> <span class="t" onclick="H(this)">21:33:38</span>               ryanbrush </span><span>Another approach would be to break up the accumulators into separate rules, each of which insert some &quot;GroupOfX&quot; type that can be joined to in another rule that combines them all.</span></div><div id="t1447450456000018" t="2015-11-13 21:34:16 noprompt oh i see what you&apos;re saying wrt  derive ."><a href="#t1447450456000018" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-11-13</span> <span class="t" onclick="H(this)">21:34:16</span>                noprompt </span><span>oh i see what you&apos;re saying wrt </span><code>derive</code><span>.</span></div><div id="t1447450494000019" t="2015-11-13 21:34:54 noprompt re: your uncertainty. well we&apos;ll kick the tires for you and let you know if it does work.  😄"><a href="#t1447450494000019" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-11-13</span> <span class="t" onclick="H(this)">21:34:54</span>                noprompt </span><span>re: your uncertainty. well we&apos;ll kick the tires for you and let you know if it does work. </span><b>😄</b></div><div id="t1447450682000021" t="2015-11-13 21:38:02 ryanbrush I know the above approach will work."><a href="#t1447450682000021" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-11-13</span> <span class="t" onclick="H(this)">21:38:02</span>               ryanbrush </span><span>I know the above approach will work.</span></div><div id="t1447450735000022" t="2015-11-13 21:38:55 noprompt okay, we&apos;ll do that if this turns up dry."><a href="#t1447450735000022" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-11-13</span> <span class="t" onclick="H(this)">21:38:55</span>                noprompt </span><span>okay, we&apos;ll do that if this turns up dry.</span></div><div id="t1447450863000023" t="2015-11-13 21:41:03 ryanbrush I&apos;m almost certain that you won&apos;t be able to bind the result of an &quot;:or&quot;, so I think the post above is your best bet. The Rete algorithm splits up the or&apos;s into separate rule invocations, and there aren&apos;t well-defined semantics for binding the result of other boolean operators in general.  But merging the results of separate accumulators will work and is something we do frequently."><a href="#t1447450863000023" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-11-13</span> <span class="t" onclick="H(this)">21:41:03</span>               ryanbrush </span><span>I&apos;m almost certain that you won&apos;t be able to bind the result of an &quot;:or&quot;, so I think the post above is your best bet. The Rete algorithm splits up the or&apos;s into separate rule invocations, and there aren&apos;t well-defined semantics for binding the result of other boolean operators in general.  But merging the results of separate accumulators will work and is something we do frequently.</span></div><div id="t1447451005000024" t="2015-11-13 21:43:25 ryanbrush By the way, please do report bad or misleading error messages, here or on the github project. I think this is a weak point in Clara right now, especially for new users, so we want to make that better."><a href="#t1447451005000024" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-11-13</span> <span class="t" onclick="H(this)">21:43:25</span>               ryanbrush </span><span>By the way, please do report bad or misleading error messages, here or on the github project. I think this is a weak point in Clara right now, especially for new users, so we want to make that better.</span></div><div id="t1447454136000025" t="2015-11-13 22:35:36 noprompt @ryanbrush: re: error messages, we&apos;re investing in clara so hopefully you can expect more than just an experience report.  simple_smile"><a href="#t1447454136000025" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-11-13</span> <span class="t" onclick="H(this)">22:35:36</span>                noprompt </span><span>@ryanbrush: re: error messages, we&apos;re investing in clara so hopefully you can expect more than just an experience report. </span><b>simple_smile</b></div><div id="t1447454194000026" t="2015-11-13 22:36:34 noprompt we focus a lot on producing good error messages at work and use  ex-info  to not only provide a description but, where possible, provide a prescription to solve the problem."><a href="#t1447454194000026" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-11-13</span> <span class="t" onclick="H(this)">22:36:34</span>                noprompt </span><span>we focus a lot on producing good error messages at work and use </span><code>ex-info</code><span> to not only provide a description but, where possible, provide a prescription to solve the problem.</span></div><div id="t1447455042000027" t="2015-11-13 22:50:42 ryanbrush Sounds great! And I definitely agree with the idea of good, prescriptive error messages. This can be challenging when dealing with the kind of deep macros, like what Clara does when building the Rete network, but is an important step forward."><a href="#t1447455042000027" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-11-13</span> <span class="t" onclick="H(this)">22:50:42</span>               ryanbrush </span><span>Sounds great! And I definitely agree with the idea of good, prescriptive error messages. This can be challenging when dealing with the kind of deep macros, like what Clara does when building the Rete network, but is an important step forward.</span></div><div id="t1447455200000028" t="2015-11-13 22:53:20 ryanbrush By the way, I&apos;m planning on moving Clara to its own GitHub project organization and add at least one more committer soon, a colleague who has made some nice pull requests. It shouldn&apos;t be too disruptive, but I&apos;ll be sure to share here when that happens."><a href="#t1447455200000028" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-11-13</span> <span class="t" onclick="H(this)">22:53:20</span>               ryanbrush </span><span>By the way, I&apos;m planning on moving Clara to its own GitHub project organization and add at least one more committer soon, a colleague who has made some nice pull requests. It shouldn&apos;t be too disruptive, but I&apos;ll be sure to share here when that happens.</span></div><div id="t1447520728000029" t="2015-11-14 17:05:28 ryanbrush I had some fun playing with Instaparse and Clara recently, so I blogged about it:  http://www.toomuchcode.org/blog/2015/11/14/insta-declarative-dsls/"><a href="#t1447520728000029" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-11-14</span> <span class="t" onclick="H(this)">17:05:28</span>               ryanbrush </span><span>I had some fun playing with Instaparse and Clara recently, so I blogged about it: </span><a href="http://www.toomuchcode.org/blog/2015/11/14/insta-declarative-dsls/" target="_blank">http://www.toomuchcode.org/blog/2015/11/14/insta-declarative-dsls/</a></div><div id="t1447615053000031" t="2015-11-15 19:17:33 devn What do y&apos;all think about meeting up on Monday night after dinner?"><a href="#t1447615053000031" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-11-15</span> <span class="t" onclick="H(this)">19:17:33</span>                    devn </span><span>What do y&apos;all think about meeting up on Monday night after dinner?</span></div><div id="t1447615063000032" t="2015-11-15 19:17:43 devn @ryanbrush: very cool"><a href="#t1447615063000032" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-11-15</span> <span class="t" onclick="H(this)">19:17:43</span>                    devn </span><span>@ryanbrush: very cool</span></div><div id="t1447674030000033" t="2015-11-16 11:40:30 thomas @ryanbrush:  read your blog post. really good. thank you."><a href="#t1447674030000033" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-11-16</span> <span class="t" onclick="H(this)">11:40:30</span>                  thomas </span><span>@ryanbrush:  read your blog post. really good. thank you.</span></div><div id="t1447683531000034" t="2015-11-16 14:18:51 ryanbrush @thomas Thanks! It was a lot of fun to write. I appreciate the kind words!"><a href="#t1447683531000034" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-11-16</span> <span class="t" onclick="H(this)">14:18:51</span>               ryanbrush </span><span>@thomas Thanks! It was a lot of fun to write. I appreciate the kind words!</span></div><div id="t1448372023000040" t="2015-11-24 13:33:43 ragge hello"><a href="#t1448372023000040" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-11-24</span> <span class="t" onclick="H(this)">13:33:43</span>                   ragge </span><span>hello</span></div><div id="t1448372068000041" t="2015-11-24 13:34:28 ragge @ryanbrush: are there any guidelines/limits for the number of facts?"><a href="#t1448372068000041" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-11-24</span> <span class="t" onclick="H(this)">13:34:28</span>                   ragge </span><span>@ryanbrush: are there any guidelines/limits for the number of facts?</span></div><div id="t1448376008000042" t="2015-11-24 14:40:08 ryanbrush @ragge Not really, besides the limits of the JVM. We frequently have 100,000+ facts in our sessions, and I&apos;ve tested into the millions (although for a limited scenario). Most of the work is done in Clojure group-by and reducer functions, which scale well."><a href="#t1448376008000042" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-11-24</span> <span class="t" onclick="H(this)">14:40:08</span>               ryanbrush </span><span>@ragge Not really, besides the limits of the JVM. We frequently have 100,000+ facts in our sessions, and I&apos;ve tested into the millions (although for a limited scenario). Most of the work is done in Clojure group-by and reducer functions, which scale well.</span></div><div id="t1448376186000043" t="2015-11-24 14:43:06 ryanbrush @ragge The only thing to keep in mind is doing a non-equality cartesian join over lots of facts. Rule constraints that join on equals use hash-based joins, which scale well.  This constraint applies pretty commonly to rule engines."><a href="#t1448376186000043" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-11-24</span> <span class="t" onclick="H(this)">14:43:06</span>               ryanbrush </span><span>@ragge The only thing to keep in mind is doing a non-equality cartesian join over lots of facts. Rule constraints that join on equals use hash-based joins, which scale well.  This constraint applies pretty commonly to rule engines.</span></div><div id="t1448382083000044" t="2015-11-24 16:21:23 ragge @ryanbrush: thanks for your reply, will definitely give it a go for our use case (which is currently around 50k facts)"><a href="#t1448382083000044" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-11-24</span> <span class="t" onclick="H(this)">16:21:23</span>                   ragge </span><span>@ryanbrush: thanks for your reply, will definitely give it a go for our use case (which is currently around 50k facts)</span></div><div id="t1448383955000045" t="2015-11-24 16:52:35 ryanbrush @ragge Sounds good. Clara&apos;s performance should at least be competitive with other JVM-based rule engines and is working well with a large number of facts for us. If you do run into a workload that isn&apos;t doing well, please let me know."><a href="#t1448383955000045" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-11-24</span> <span class="t" onclick="H(this)">16:52:35</span>               ryanbrush </span><span>@ragge Sounds good. Clara&apos;s performance should at least be competitive with other JVM-based rule engines and is working well with a large number of facts for us. If you do run into a workload that isn&apos;t doing well, please let me know.</span></div><div id="t1448385817000046" t="2015-11-24 17:23:37 albaker is there a performance measurement of Clara?"><a href="#t1448385817000046" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-11-24</span> <span class="t" onclick="H(this)">17:23:37</span>                 albaker </span><span>is there a performance measurement of Clara?</span></div><div id="t1448385849000047" t="2015-11-24 17:24:09 albaker or guidelines, like how much memory you should budget for number of facts/rules?"><a href="#t1448385849000047" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-11-24</span> <span class="t" onclick="H(this)">17:24:09</span>                 albaker </span><span>or guidelines, like how much memory you should budget for number of facts/rules?</span></div><div id="t1448399753000048" t="2015-11-24 21:15:53 ryanbrush @albaker I use Criterium ( https://github.com/hugoduncan/criterium ) against a function that loads and exercises our Clara rulesets to measure performance.  I did post the program I wrote some time ago to benchmark Clara itself at  https://github.com/rbrush/clara-benchmark , but generally its easier just to write your own test function and use Criterium to measure."><a href="#t1448399753000048" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-11-24</span> <span class="t" onclick="H(this)">21:15:53</span>               ryanbrush </span><span>@albaker I use Criterium (</span><a href="https://github.com/hugoduncan/criterium" target="_blank">https://github.com/hugoduncan/criterium</a><span>) against a function that loads and exercises our Clara rulesets to measure performance.  I did post the program I wrote some time ago to benchmark Clara itself at </span><a href="https://github.com/rbrush/clara-benchmark" target="_blank">https://github.com/rbrush/clara-benchmark</a><span>, but generally its easier just to write your own test function and use Criterium to measure.</span></div><div id="t1448399901000050" t="2015-11-24 21:18:21 ryanbrush @albaker Some considerations for a memory budget: each condition on a rule will compile into its own function, and identical conditions between rules are reused, reducing the overall size. The facts are mostly just stored in Clojure sequences, or maps grouped by fact type. In general, the memory footprint will be dominated by the size of the facts you have."><a href="#t1448399901000050" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-11-24</span> <span class="t" onclick="H(this)">21:18:21</span>               ryanbrush </span><span>@albaker Some considerations for a memory budget: each condition on a rule will compile into its own function, and identical conditions between rules are reused, reducing the overall size. The facts are mostly just stored in Clojure sequences, or maps grouped by fact type. In general, the memory footprint will be dominated by the size of the facts you have.</span></div><div id="t1448400007000051" t="2015-11-24 21:20:07 ryanbrush I think the best way to think of it as you&apos;re just writing Clojure functions and creating Clojure structures. Clara will wire things together, but the footprint is generally a function of the size of your data."><a href="#t1448400007000051" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-11-24</span> <span class="t" onclick="H(this)">21:20:07</span>               ryanbrush </span><span>I think the best way to think of it as you&apos;re just writing Clojure functions and creating Clojure structures. Clara will wire things together, but the footprint is generally a function of the size of your data.</span></div><div id="t1448407713000052" t="2015-11-24 23:28:33 albaker Cool, thanks! "><a href="#t1448407713000052" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-11-24</span> <span class="t" onclick="H(this)">23:28:33</span>                 albaker </span><span>Cool, thanks! </span></div><div id="t1448467875000053" t="2015-11-25 16:11:15 ryanbrush FYI, I just pushed Clara 0.9.1 to Clojars. It&apos;s a fix release for a specific scenario, but worth the upgrade.  https://groups.google.com/forum/#!topic/clara-rules/dWLm9veo-dA"><a href="#t1448467875000053" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-11-25</span> <span class="t" onclick="H(this)">16:11:15</span>               ryanbrush </span><span>FYI, I just pushed Clara 0.9.1 to Clojars. It&apos;s a fix release for a specific scenario, but worth the upgrade. </span><a href="https://groups.google.com/forum/#!topic/clara-rules/dWLm9veo-dA" target="_blank">https://groups.google.com/forum/#!topic/clara-rules/dWLm9veo-dA</a></div><div id="t1448906113000054" t="2015-11-30 17:55:13 devn @ryanbrush: Is it possible to use  [:or [?foo &lt;- my/accumulator [X (= a 1)]] [?bar &lt;- my/accumulator [Y (= b 2)]]]"><a href="#t1448906113000054" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-11-30</span> <span class="t" onclick="H(this)">17:55:13</span>                    devn </span><span>@ryanbrush: Is it possible to use </span><code>[:or [?foo &lt;- my/accumulator [X (= a 1)]] [?bar &lt;- my/accumulator [Y (= b 2)]]]</code></div><div id="t1448906655000055" t="2015-11-30 18:04:15 devn @ryanbrush: here&apos;s a sketch of what we imagine:
 (defrule thing-a
  [?foo &lt;- [:or
            [my/accumulator [Foo (= a 1)]]
            [:not [Foo (= a 1)]]]]
  =&gt;
  (when-not (nil? ?foo)
    (insert! (map-&gt;Bar ?foo))))
"><a href="#t1448906655000055" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-11-30</span> <span class="t" onclick="H(this)">18:04:15</span>                    devn </span><span>@ryanbrush: here&apos;s a sketch of what we imagine:
</span><pre>(defrule thing-a
  [?foo &lt;- [:or
            [my/accumulator [Foo (= a 1)]]
            [:not [Foo (= a 1)]]]]
  =&gt;
  (when-not (nil? ?foo)
    (insert! (map-&gt;Bar ?foo))))
</pre></div><div id="t1448906690000056" t="2015-11-30 18:04:50 devn We want Foo to be optional, but when it exists, we&apos;d like to accumulate over matching Foo facts."><a href="#t1448906690000056" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-11-30</span> <span class="t" onclick="H(this)">18:04:50</span>                    devn </span><span>We want Foo to be optional, but when it exists, we&apos;d like to accumulate over matching Foo facts.</span></div><div id="t1448906816000057" t="2015-11-30 18:06:56 ryanbrush The best way to solve this problem is to have my/accumulator provide a default value. That way if there are no Foo records, the default value will be returned from the accumulator and propagate down."><a href="#t1448906816000057" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-11-30</span> <span class="t" onclick="H(this)">18:06:56</span>               ryanbrush </span><span>The best way to solve this problem is to have my/accumulator provide a default value. That way if there are no Foo records, the default value will be returned from the accumulator and propagate down.</span></div><div id="t1448906845000058" t="2015-11-30 18:07:25 ryanbrush For instance, the provided sum accumulator will return a sum of zero if there are no items to sum."><a href="#t1448906845000058" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-11-30</span> <span class="t" onclick="H(this)">18:07:25</span>               ryanbrush </span><span>For instance, the provided sum accumulator will return a sum of zero if there are no items to sum.</span></div><div id="t1448906877000059" t="2015-11-30 18:07:57 devn Funnily enough, we talked about that a bit."><a href="#t1448906877000059" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-11-30</span> <span class="t" onclick="H(this)">18:07:57</span>                    devn </span><span>Funnily enough, we talked about that a bit.</span></div><div id="t1448906948000060" t="2015-11-30 18:09:08 ryanbrush As a side note, you can&apos;t quite think of [:or]&apos;s in rules quite like you&apos;d think of or expressions in Clojure. [:or ..] doesn&apos;t &quot;return&quot; a value that can be bound to. (In fact, in the Rete algorithm [:or] actually causes two separate rules to be generated for each branch.)"><a href="#t1448906948000060" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-11-30</span> <span class="t" onclick="H(this)">18:09:08</span>               ryanbrush </span><span>As a side note, you can&apos;t quite think of [:or]&apos;s in rules quite like you&apos;d think of or expressions in Clojure. [:or ..] doesn&apos;t &quot;return&quot; a value that can be bound to. (In fact, in the Rete algorithm [:or] actually causes two separate rules to be generated for each branch.)</span></div><div id="t1448907066000061" t="2015-11-30 18:11:06 devn @ryanbrush: thanks!"><a href="#t1448907066000061" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-11-30</span> <span class="t" onclick="H(this)">18:11:06</span>                    devn </span><span>@ryanbrush: thanks!</span></div><div id="t1448907338000062" t="2015-11-30 18:15:38 ryanbrush @devn By the way, when fiddling with this I noticed Clara isn&apos;t reporting an error if a user attempts to bind a variable in an unsupported location. This is a bug, so I logged it here  https://github.com/rbrush/clara-rules/issues/144"><a href="#t1448907338000062" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-11-30</span> <span class="t" onclick="H(this)">18:15:38</span>               ryanbrush </span><span>@devn By the way, when fiddling with this I noticed Clara isn&apos;t reporting an error if a user attempts to bind a variable in an unsupported location. This is a bug, so I logged it here </span><a href="https://github.com/rbrush/clara-rules/issues/144" target="_blank">https://github.com/rbrush/clara-rules/issues/144</a></div><div id="t1448911763000064" t="2015-11-30 19:29:23 devn @ryanbrush: that is good to know, indeed"><a href="#t1448911763000064" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-11-30</span> <span class="t" onclick="H(this)">19:29:23</span>                    devn </span><span>@ryanbrush: that is good to know, indeed</span></div><div id="t1448911819000065" t="2015-11-30 19:30:19 devn @ryanbrush: trying to be respectful of your time here, but another question: with accumulators, can I make a function which produces an accumulator and use that in the LHS?"><a href="#t1448911819000065" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-11-30</span> <span class="t" onclick="H(this)">19:30:19</span>                    devn </span><span>@ryanbrush: trying to be respectful of your time here, but another question: with accumulators, can I make a function which produces an accumulator and use that in the LHS?</span></div><div id="t1448911939000066" t="2015-11-30 19:32:19 devn like
 [Bar (= ?x x)]
[?foo &lt;- (make-accumulator ?x) :from [Foo (= ?y y]]
"><a href="#t1448911939000066" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-11-30</span> <span class="t" onclick="H(this)">19:32:19</span>                    devn </span><span>like
</span><pre>[Bar (= ?x x)]
[?foo &lt;- (make-accumulator ?x) :from [Foo (= ?y y]]
</pre></div><div id="t1448911970000067" t="2015-11-30 19:32:50 devn this basically comes down to wanting to tweak the initial value to the accumulator"><a href="#t1448911970000067" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-11-30</span> <span class="t" onclick="H(this)">19:32:50</span>                    devn </span><span>this basically comes down to wanting to tweak the initial value to the accumulator</span></div><div id="t1448912248000068" t="2015-11-30 19:37:28 ryanbrush @devn Definitely! The accumulators in clara.rules.accumulators are all just functions that return accumulators and should be a good reference. They use constants for the initial value but you can easily pass it as a param."><a href="#t1448912248000068" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-11-30</span> <span class="t" onclick="H(this)">19:37:28</span>               ryanbrush </span><span>@devn Definitely! The accumulators in clara.rules.accumulators are all just functions that return accumulators and should be a good reference. They use constants for the initial value but you can easily pass it as a param.</span></div><div id="t1448912250000069" t="2015-11-30 19:37:30 devn asking because all of the examples i&apos;ve seen are def&apos;d and only took the field to compare on"><a href="#t1448912250000069" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-11-30</span> <span class="t" onclick="H(this)">19:37:30</span>                    devn </span><span>asking because all of the examples i&apos;ve seen are def&apos;d and only took the field to compare on</span></div><div id="t1448912285000070" t="2015-11-30 19:38:05 devn cool, guess I could have tried it, but didn&apos;t know calling a function in place of a def&apos;d accumulator had any edges i needed to be aware of"><a href="#t1448912285000070" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-11-30</span> <span class="t" onclick="H(this)">19:38:05</span>                    devn </span><span>cool, guess I could have tried it, but didn&apos;t know calling a function in place of a def&apos;d accumulator had any edges i needed to be aware of</span></div><div id="t1448912318000071" t="2015-11-30 19:38:38 ryanbrush Any function that returns an accumulator will work. The provided ones just happen to use fields."><a href="#t1448912318000071" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-11-30</span> <span class="t" onclick="H(this)">19:38:38</span>               ryanbrush </span><span>Any function that returns an accumulator will work. The provided ones just happen to use fields.</span></div><div id="t1448912832000072" t="2015-11-30 19:47:12 devn @ryanbrush: a couple other small bits

- Any reason that things like min/max couldn&apos;t optionally take a function to coerce the value of a field to be comparable? For instance, dates.
- Using  reduce-to-accum  seems to imply  :supports-retract  given that  min ,  max  etc. call  comparison-based , which in turn calls  reduce-to-accum  with an initial value of  nil . Is that true? I remember reading the pull request a couple of times, but are there any good rules of thumb to use when building accumulators to know that you&apos;ve supported retraction? Now that I write that out, my other question is: When  retract  is mentioned, is it talking about automatic retraction, explicit retraction, or both?"><a href="#t1448912832000072" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-11-30</span> <span class="t" onclick="H(this)">19:47:12</span>                    devn </span><span>@ryanbrush: a couple other small bits

- Any reason that things like min/max couldn&apos;t optionally take a function to coerce the value of a field to be comparable? For instance, dates.
- Using </span><code>reduce-to-accum</code><span> seems to imply </span><code>:supports-retract</code><span> given that </span><code>min</code><span>, </span><code>max</code><span> etc. call </span><code>comparison-based</code><span>, which in turn calls </span><code>reduce-to-accum</code><span> with an initial value of </span><code>nil</code><span>. Is that true? I remember reading the pull request a couple of times, but are there any good rules of thumb to use when building accumulators to know that you&apos;ve supported retraction? Now that I write that out, my other question is: When </span><code>retract</code><span> is mentioned, is it talking about automatic retraction, explicit retraction, or both?</span></div><div id="t1448913301000075" t="2015-11-30 19:55:01 ryanbrush As long as your accumulator has a retract-fn, it supports retraction. reduce-to-accum is a convenience function that makes it easier to turn general reduce functions into accumulators by (by default) creating a retract-fn that removes the retracted item from the accumulator and re-runs the reduce. In some cases you can create more efficient retract-fn implementations. See, for instance, sum...to retract a value from a sum you can just subtract the value, which is of course more efficient than re-running the entire sum with the value removed."><a href="#t1448913301000075" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-11-30</span> <span class="t" onclick="H(this)">19:55:01</span>               ryanbrush </span><span>As long as your accumulator has a retract-fn, it supports retraction. reduce-to-accum is a convenience function that makes it easier to turn general reduce functions into accumulators by (by default) creating a retract-fn that removes the retracted item from the accumulator and re-runs the reduce. In some cases you can create more efficient retract-fn implementations. See, for instance, sum...to retract a value from a sum you can just subtract the value, which is of course more efficient than re-running the entire sum with the value removed.</span></div><div id="t1448913317000076" t="2015-11-30 19:55:17 ryanbrush This applies to both automatic and explicit retraction."><a href="#t1448913317000076" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-11-30</span> <span class="t" onclick="H(this)">19:55:17</span>               ryanbrush </span><span>This applies to both automatic and explicit retraction.</span></div><div id="t1448913462000077" t="2015-11-30 19:57:42 ryanbrush Really the retract-fn is just to &quot;undo&quot; the presence of an item in the accumulated value, like subtraction undoes the value in a sum. the reduce-to-accum just offers a &quot;brute force&quot; way to do this for all reduce functions by re-running them. In some very performance-sensitive cases where you don&apos;t care about retraction you can skip supporting it, but I wouldn&apos;t do so unless you have a special need."><a href="#t1448913462000077" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-11-30</span> <span class="t" onclick="H(this)">19:57:42</span>               ryanbrush </span><span>Really the retract-fn is just to &quot;undo&quot; the presence of an item in the accumulated value, like subtraction undoes the value in a sum. the reduce-to-accum just offers a &quot;brute force&quot; way to do this for all reduce functions by re-running them. In some very performance-sensitive cases where you don&apos;t care about retraction you can skip supporting it, but I wouldn&apos;t do so unless you have a special need.</span></div><div id="t1448913599000078" t="2015-11-30 19:59:59 ryanbrush FWIW, Clara accumulators work pretty much exactly like the same concept in Jess and Drools. You just write the functions in Clojure.  😉"><a href="#t1448913599000078" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-11-30</span> <span class="t" onclick="H(this)">19:59:59</span>               ryanbrush </span><span>FWIW, Clara accumulators work pretty much exactly like the same concept in Jess and Drools. You just write the functions in Clojure. </span><b>😉</b></div><div id="t1448913616000079" t="2015-11-30 20:00:16 ryanbrush (Also, I need to drop offline for a bit but will be back on later today.)"><a href="#t1448913616000079" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-11-30</span> <span class="t" onclick="H(this)">20:00:16</span>               ryanbrush </span><span>(Also, I need to drop offline for a bit but will be back on later today.)</span></div><div id="t1448914185000080" t="2015-11-30 20:09:45 devn @ryanbrush: that&apos;s a lovely explanation, thank you!"><a href="#t1448914185000080" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-11-30</span> <span class="t" onclick="H(this)">20:09:45</span>                    devn </span><span>@ryanbrush: that&apos;s a lovely explanation, thank you!</span></div><div id="t1448914191000081" t="2015-11-30 20:09:51 devn @logbot"><a href="#t1448914191000081" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-11-30</span> <span class="t" onclick="H(this)">20:09:51</span>                    devn </span><span>@logbot</span></div><div id="t1448914247000082" t="2015-11-30 20:10:47 devn (mentioned the @logbot so there&apos;s actually a log of some of this stuff, it scans every 2 hours, so it should join shortly.)"><a href="#t1448914247000082" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-11-30</span> <span class="t" onclick="H(this)">20:10:47</span>                    devn </span><span>(mentioned the @logbot so there&apos;s actually a log of some of this stuff, it scans every 2 hours, so it should join shortly.)</span></div><div id="t1448944861000087" t="2015-12-01 04:41:01 ryanbrush Working on some updates that should make clara-tools more useful. (I think at least @devn will be interested in this.) Details here:   https://groups.google.com/forum/#!topic/clara-rules/w1GDmxLE_Vo"><a href="#t1448944861000087" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-12-01</span> <span class="t" onclick="H(this)">04:41:01</span>               ryanbrush </span><span>Working on some updates that should make clara-tools more useful. (I think at least @devn will be interested in this.) Details here:  </span><a href="https://groups.google.com/forum/#!topic/clara-rules/w1GDmxLE_Vo" target="_blank">https://groups.google.com/forum/#!topic/clara-rules/w1GDmxLE_Vo</a></div><div id="t1448990304000090" t="2015-12-01 17:18:24 devn @ryanbrush: That&apos;s awesome!"><a href="#t1448990304000090" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-12-01</span> <span class="t" onclick="H(this)">17:18:24</span>                    devn </span><span>@ryanbrush: That&apos;s awesome!</span></div><div id="t1448990607000091" t="2015-12-01 17:23:27 devn @ryanbrush: It would be neat to be able to &quot;step&quot; through a session. I&apos;m not really sure how doable that would be, or if it&apos;d be crazy for large sets of facts, but since you mentioned Bret Victor -- I imagined the Braid example. Being able to step through time and &quot;see&quot; rules fire would be cool."><a href="#t1448990607000091" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-12-01</span> <span class="t" onclick="H(this)">17:23:27</span>                    devn </span><span>@ryanbrush: It would be neat to be able to &quot;step&quot; through a session. I&apos;m not really sure how doable that would be, or if it&apos;d be crazy for large sets of facts, but since you mentioned Bret Victor -- I imagined the Braid example. Being able to step through time and &quot;see&quot; rules fire would be cool.</span></div><div id="t1448990795000093" t="2015-12-01 17:26:35 devn I&apos;m imagining something like the current  show-session  tool, but with some sort of temporally inspectable aspect to it."><a href="#t1448990795000093" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-12-01</span> <span class="t" onclick="H(this)">17:26:35</span>                    devn </span><span>I&apos;m imagining something like the current </span><code>show-session</code><span> tool, but with some sort of temporally inspectable aspect to it.</span></div><div id="t1448990829000094" t="2015-12-01 17:27:09 devn Whether that&apos;s a slider, or a split pane that shows what matches and when."><a href="#t1448990829000094" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-12-01</span> <span class="t" onclick="H(this)">17:27:09</span>                    devn </span><span>Whether that&apos;s a slider, or a split pane that shows what matches and when.</span></div><div id="t1448990850000095" t="2015-12-01 17:27:30 devn Anyway, looking forward to giving it a look later today or tomorrow. Thanks for all of the awesome work!"><a href="#t1448990850000095" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-12-01</span> <span class="t" onclick="H(this)">17:27:30</span>                    devn </span><span>Anyway, looking forward to giving it a look later today or tomorrow. Thanks for all of the awesome work!</span></div><div id="t1448995004000096" t="2015-12-01 18:36:44 ryanbrush @devn Interesting idea. Should be doable by plugging into listeners for state changes. Might be something to experiment with."><a href="#t1448995004000096" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-12-01</span> <span class="t" onclick="H(this)">18:36:44</span>               ryanbrush </span><span>@devn Interesting idea. Should be doable by plugging into listeners for state changes. Might be something to experiment with.</span></div><div id="t1449022019000097" t="2015-12-02 02:06:59 devn @ryanbrush: trying to check out clara-tools 0.1.2-SNAPSHOT from lein checkouts, but:
 1. Caused by java.io.FileNotFoundException
   Could not locate org/httpkit/server__init.class or
   org/httpkit/server.clj on classpath.
"><a href="#t1449022019000097" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-12-02</span> <span class="t" onclick="H(this)">02:06:59</span>                    devn </span><span>@ryanbrush: trying to check out clara-tools 0.1.2-SNAPSHOT from lein checkouts, but:
</span><pre>1. Caused by java.io.FileNotFoundException
   Could not locate org/httpkit/server__init.class or
   org/httpkit/server.clj on classpath.
</pre></div><div id="t1449022253000098" t="2015-12-02 02:10:53 devn @ryanbrush: looks like there&apos;s just a missing require in  clara.tools.impl.server  =&gt;  clojure.edn"><a href="#t1449022253000098" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-12-02</span> <span class="t" onclick="H(this)">02:10:53</span>                    devn </span><span>@ryanbrush: looks like there&apos;s just a missing require in </span><code>clara.tools.impl.server</code><span> =&gt; </span><code>clojure.edn</code></div><div id="t1449022932000099" t="2015-12-02 02:22:12 devn PR submitted"><a href="#t1449022932000099" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-12-02</span> <span class="t" onclick="H(this)">02:22:12</span>                    devn </span><span>PR submitted</span></div><div id="t1449023908000100" t="2015-12-02 02:38:28 ryanbrush @devn Ah, thanks for the PR. I&apos;ll be able to take a look and merge tomorrow."><a href="#t1449023908000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-12-02</span> <span class="t" onclick="H(this)">02:38:28</span>               ryanbrush </span><span>@devn Ah, thanks for the PR. I&apos;ll be able to take a look and merge tomorrow.</span></div><div id="t1449023926000101" t="2015-12-02 02:38:46 devn @ryanbrush:  👍"><a href="#t1449023926000101" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-12-02</span> <span class="t" onclick="H(this)">02:38:46</span>                    devn </span><span>@ryanbrush: </span><b>👍</b></div><div id="t1449705757000104" t="2015-12-10 00:02:37 devn @ryanbrush: potentially stupid question -- but what&apos;s the best way to try out changes to clara-tools on the dev branch in my project?"><a href="#t1449705757000104" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-12-10</span> <span class="t" onclick="H(this)">00:02:37</span>                    devn </span><span>@ryanbrush: potentially stupid question -- but what&apos;s the best way to try out changes to clara-tools on the dev branch in my project?</span></div><div id="t1449705798000105" t="2015-12-10 00:03:18 devn i was trying to use lein  checkouts , but it is yelling at me for not having cljsbuild/compiler__init.class or cljsbuild/compiler.clj on the classpath"><a href="#t1449705798000105" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-12-10</span> <span class="t" onclick="H(this)">00:03:18</span>                    devn </span><span>i was trying to use lein </span><code>checkouts</code><span>, but it is yelling at me for not having cljsbuild/compiler__init.class or cljsbuild/compiler.clj on the classpath</span></div><div id="t1449706203000106" t="2015-12-10 00:10:03 ryanbrush @devn I just run lein install in the clara-tools 0.2-Dev branch and point my consuming project at the snapshot version."><a href="#t1449706203000106" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-12-10</span> <span class="t" onclick="H(this)">00:10:03</span>               ryanbrush </span><span>@devn I just run lein install in the clara-tools 0.2-Dev branch and point my consuming project at the snapshot version.</span></div><div id="t1449706433000107" t="2015-12-10 00:13:53 devn @ryanbrush: well, that worked. thanks. i think that&apos;s what i wound up doing last time i had it working."><a href="#t1449706433000107" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-12-10</span> <span class="t" onclick="H(this)">00:13:53</span>                    devn </span><span>@ryanbrush: well, that worked. thanks. i think that&apos;s what i wound up doing last time i had it working.</span></div><div id="t1449706437000108" t="2015-12-10 00:13:57 devn this is looking really great!"><a href="#t1449706437000108" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-12-10</span> <span class="t" onclick="H(this)">00:13:57</span>                    devn </span><span>this is looking really great!</span></div><div id="t1449706472000109" t="2015-12-10 00:14:32 devn looks like you&apos;re tinkering with the logic graph at the moment, or im calling it wrong, not sure which  simple_smile"><a href="#t1449706472000109" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-12-10</span> <span class="t" onclick="H(this)">00:14:32</span>                    devn </span><span>looks like you&apos;re tinkering with the logic graph at the moment, or im calling it wrong, not sure which </span><b>simple_smile</b></div><div id="t1449706529000110" t="2015-12-10 00:15:29 ryanbrush @devn cool! It&apos;s still really rough, and the logic graph definitely needs work. I&apos;m going to start using it against some real data soon so it should improve."><a href="#t1449706529000110" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-12-10</span> <span class="t" onclick="H(this)">00:15:29</span>               ryanbrush </span><span>@devn cool! It&apos;s still really rough, and the logic graph definitely needs work. I&apos;m going to start using it against some real data soon so it should improve.</span></div><div id="t1449706559000111" t="2015-12-10 00:15:59 devn im getting a bunch of &quot;No reader function for tag object&quot; from readTagged(LispReader.java)"><a href="#t1449706559000111" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-12-10</span> <span class="t" onclick="H(this)">00:15:59</span>                    devn </span><span>im getting a bunch of &quot;No reader function for tag object&quot; from readTagged(LispReader.java)</span></div><div id="t1449706563000112" t="2015-12-10 00:16:03 ryanbrush @devn I am also a terrible web developer who is learning Reagent as I go. ;)"><a href="#t1449706563000112" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-12-10</span> <span class="t" onclick="H(this)">00:16:03</span>               ryanbrush </span><span>@devn I am also a terrible web developer who is learning Reagent as I go. ;)</span></div><div id="t1449706575000113" t="2015-12-10 00:16:15 ryanbrush Hmm, haven&apos;t sent that one."><a href="#t1449706575000113" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-12-10</span> <span class="t" onclick="H(this)">00:16:15</span>               ryanbrush </span><span>Hmm, haven&apos;t sent that one.</span></div><div id="t1449706594000114" t="2015-12-10 00:16:34 ryanbrush Feel free to log issues if you have something reproducible"><a href="#t1449706594000114" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-12-10</span> <span class="t" onclick="H(this)">00:16:34</span>               ryanbrush </span><span>Feel free to log issues if you have something reproducible</span></div><div id="t1449706739000115" t="2015-12-10 00:18:59 devn @ryanbrush: looks like i&apos;m getting it for queries that return nothing and when clicking on facts that aren&apos;t actually within the session?"><a href="#t1449706739000115" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-12-10</span> <span class="t" onclick="H(this)">00:18:59</span>                    devn </span><span>@ryanbrush: looks like i&apos;m getting it for queries that return nothing and when clicking on facts that aren&apos;t actually within the session?</span></div><div id="t1449706763000116" t="2015-12-10 00:19:23 devn just some first blush debugging, not sure if that&apos;s the case, just guessing"><a href="#t1449706763000116" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-12-10</span> <span class="t" onclick="H(this)">00:19:23</span>                    devn </span><span>just some first blush debugging, not sure if that&apos;s the case, just guessing</span></div><div id="t1449706870000117" t="2015-12-10 00:21:10 devn I&apos;m probably not calling it the way you&apos;d expect... I just call  (watch/browse!)  after all rules have fired"><a href="#t1449706870000117" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-12-10</span> <span class="t" onclick="H(this)">00:21:10</span>                    devn </span><span>I&apos;m probably not calling it the way you&apos;d expect... I just call </span><code>(watch/browse!)</code><span> after all rules have fired</span></div><div id="t1449706961000118" t="2015-12-10 00:22:41 devn (-&gt; (watch/mk-watched-session &quot;FOO&quot; rules :cache false)
    (insert-all facts)
    (fire-rules))

(watch/browse!)
"><a href="#t1449706961000118" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-12-10</span> <span class="t" onclick="H(this)">00:22:41</span>                    devn </span><pre>(-&gt; (watch/mk-watched-session &quot;FOO&quot; rules :cache false)
    (insert-all facts)
    (fire-rules))

(watch/browse!)
</pre></div><div id="t1449744173000119" t="2015-12-10 10:42:53 thomas Hi, just a quick question... are rules written in Clara Clojure functions? just a thought that crossed my mind."><a href="#t1449744173000119" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-12-10</span> <span class="t" onclick="H(this)">10:42:53</span>                  thomas </span><span>Hi, just a quick question... are rules written in Clara Clojure functions? just a thought that crossed my mind.</span></div><div id="t1449798265000120" t="2015-12-11 01:44:25 ryanbrush @thomas Sort of. To elaborate a bit: The rules are forms, and the rule constraints and actions are just Clojure expressions. All of these get compiled down into Clojure functions in the end, which are executed as part of a Rete-style rule network. I have no idea if that&apos;s what you&apos;re looking for or not.  😉"><a href="#t1449798265000120" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-12-11</span> <span class="t" onclick="H(this)">01:44:25</span>               ryanbrush </span><span>@thomas Sort of. To elaborate a bit: The rules are forms, and the rule constraints and actions are just Clojure expressions. All of these get compiled down into Clojure functions in the end, which are executed as part of a Rete-style rule network. I have no idea if that&apos;s what you&apos;re looking for or not. </span><b>😉</b></div><div id="t1449798380000121" t="2015-12-11 01:46:20 ryanbrush @devn Not sure why that use wouldn&apos;t work. Facts that aren&apos;t in the session should be seen in the UI. I almost certainly have a bug in there somewhere. clara-tools will harden over the next few weeks but the current draft is very much use at your own risk (although bug reports and patches are of course welcome.)"><a href="#t1449798380000121" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-12-11</span> <span class="t" onclick="H(this)">01:46:20</span>               ryanbrush </span><span>@devn Not sure why that use wouldn&apos;t work. Facts that aren&apos;t in the session should be seen in the UI. I almost certainly have a bug in there somewhere. clara-tools will harden over the next few weeks but the current draft is very much use at your own risk (although bug reports and patches are of course welcome.)</span></div><div id="t1449798456000122" t="2015-12-11 01:47:36 ryanbrush By the way: Clara 0.9.2 is out:  https://groups.google.com/forum/#!topic/clara-rules/kuy-XPUKzLU .  It fixes an ugly edge case of truth maintenance and hopefully does a better job reporting errors in a number of scenarios."><a href="#t1449798456000122" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-12-11</span> <span class="t" onclick="H(this)">01:47:36</span>               ryanbrush </span><span>By the way: Clara 0.9.2 is out: </span><a href="https://groups.google.com/forum/#!topic/clara-rules/kuy-XPUKzLU" target="_blank">https://groups.google.com/forum/#!topic/clara-rules/kuy-XPUKzLU</a><span>.  It fixes an ugly edge case of truth maintenance and hopefully does a better job reporting errors in a number of scenarios.</span></div><div id="t1449823721000123" t="2015-12-11 08:48:41 thomas @ryanbrush:  reason for me asking is that I was wondering if Clara could be combined with Onyx and make it some sort of Rule/Event processing engine."><a href="#t1449823721000123" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-12-11</span> <span class="t" onclick="H(this)">08:48:41</span>                  thomas </span><span>@ryanbrush:  reason for me asking is that I was wondering if Clara could be combined with Onyx and make it some sort of Rule/Event processing engine.</span></div><div id="t1449846404000124" t="2015-12-11 15:06:44 ryanbrush @thomas I don&apos;t know much about Onyx, but I&apos;m sure you could invoke Clara rules and queries from with in a function running within Onyx. The rule engine working memory would be local to that node, which in many cases is fine."><a href="#t1449846404000124" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-12-11</span> <span class="t" onclick="H(this)">15:06:44</span>               ryanbrush </span><span>@thomas I don&apos;t know much about Onyx, but I&apos;m sure you could invoke Clara rules and queries from with in a function running within Onyx. The rule engine working memory would be local to that node, which in many cases is fine.</span></div><div id="t1449846513000125" t="2015-12-11 15:08:33 ryanbrush @thomas Ultimately I&apos;d like to have an implementation of Clara&apos;s working memory that is distributed across a processing cluster, so you could just write rules to deal with input and emit outcomes. This is significantly more challenging. I had an experimental extension of Clara where the memory was distributed across a Storm cluster, but this effort was dropped due to other needs. The big challenge is fault tolerance of a distributed working memory. If a node becomes unavailable, how do we recover its part of the Rete network? I&apos;ve been toying with some solutions to this by mapping Clara&apos;s working memory onto existing fault tolerant processing patterns but this is little more than an idea right now."><a href="#t1449846513000125" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-12-11</span> <span class="t" onclick="H(this)">15:08:33</span>               ryanbrush </span><span>@thomas Ultimately I&apos;d like to have an implementation of Clara&apos;s working memory that is distributed across a processing cluster, so you could just write rules to deal with input and emit outcomes. This is significantly more challenging. I had an experimental extension of Clara where the memory was distributed across a Storm cluster, but this effort was dropped due to other needs. The big challenge is fault tolerance of a distributed working memory. If a node becomes unavailable, how do we recover its part of the Rete network? I&apos;ve been toying with some solutions to this by mapping Clara&apos;s working memory onto existing fault tolerant processing patterns but this is little more than an idea right now.</span></div><div id="t1449846536000126" t="2015-12-11 15:08:56 thomas @ryanbrush:  ok thank you, this is something I would like to look into at some stage"><a href="#t1449846536000126" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-12-11</span> <span class="t" onclick="H(this)">15:08:56</span>                  thomas </span><span>@ryanbrush:  ok thank you, this is something I would like to look into at some stage</span></div><div id="t1449846540000127" t="2015-12-11 15:09:00 thomas ie. read one day"><a href="#t1449846540000127" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-12-11</span> <span class="t" onclick="H(this)">15:09:00</span>                  thomas </span><span>ie. read one day</span></div><div id="t1449846768000128" t="2015-12-11 15:12:48 ryanbrush @thomas Yes, me too!"><a href="#t1449846768000128" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-12-11</span> <span class="t" onclick="H(this)">15:12:48</span>               ryanbrush </span><span>@thomas Yes, me too!</span></div><div id="t1449846838000129" t="2015-12-11 15:13:58 ryanbrush @thomas Poking around Onyx a bit I think you could use Clara as a stateful aggregator of previously grouped data pretty easily, using Onyx&apos;s state management/windowing capabilities. So you could have a stream of data, inserting updates into a Clara working memory, and computing results like that. Could be useful to solve a number of problems."><a href="#t1449846838000129" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-12-11</span> <span class="t" onclick="H(this)">15:13:58</span>               ryanbrush </span><span>@thomas Poking around Onyx a bit I think you could use Clara as a stateful aggregator of previously grouped data pretty easily, using Onyx&apos;s state management/windowing capabilities. So you could have a stream of data, inserting updates into a Clara working memory, and computing results like that. Could be useful to solve a number of problems.</span></div><div id="t1449846883000130" t="2015-12-11 15:14:43 thomas I was wondering if something like that could be done... would be very cool."><a href="#t1449846883000130" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-12-11</span> <span class="t" onclick="H(this)">15:14:43</span>                  thomas </span><span>I was wondering if something like that could be done... would be very cool.</span></div><div id="t1449847115000131" t="2015-12-11 15:18:35 ryanbrush @thomas Yeah, I haven&apos;t used Onyx but it seems doable from what I can see."><a href="#t1449847115000131" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-12-11</span> <span class="t" onclick="H(this)">15:18:35</span>               ryanbrush </span><span>@thomas Yeah, I haven&apos;t used Onyx but it seems doable from what I can see.</span></div><div id="t1450058702000132" t="2015-12-14 02:05:02 devn @ryanbrush: so, i suspect this might be considered out of scope for clara, but all the same: any thoughts on rule persistence/versioning? for instance, i might receive rules over the wire."><a href="#t1450058702000132" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-12-14</span> <span class="t" onclick="H(this)">02:05:02</span>                    devn </span><span>@ryanbrush: so, i suspect this might be considered out of scope for clara, but all the same: any thoughts on rule persistence/versioning? for instance, i might receive rules over the wire.</span></div><div id="t1450058741000133" t="2015-12-14 02:05:41 devn if this is the case, I may need to for instance, make a function registry so functions within the LHS or RHS are resolvable when I read them in"><a href="#t1450058741000133" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-12-14</span> <span class="t" onclick="H(this)">02:05:41</span>                    devn </span><span>if this is the case, I may need to for instance, make a function registry so functions within the LHS or RHS are resolvable when I read them in</span></div><div id="t1450058827000134" t="2015-12-14 02:07:07 devn is this something you or anyone else following along has dealt with? what&apos;d you choose as a method of versioning and mapping rule logic?"><a href="#t1450058827000134" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-12-14</span> <span class="t" onclick="H(this)">02:07:07</span>                    devn </span><span>is this something you or anyone else following along has dealt with? what&apos;d you choose as a method of versioning and mapping rule logic?</span></div><div id="t1450106088000135" t="2015-12-14 15:14:48 ryanbrush @devn We just keep rules in source control and it let it handle versioning. I&apos;d imagine a variety of content management systems would be up to the task. As for a function registry, I just use fully-qualified function names from a library, and just have rules depend on a specific library version to use those functions. So not so much as a &quot;function registry&quot; as just using a versioned dependency JAR and qualified function names."><a href="#t1450106088000135" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-12-14</span> <span class="t" onclick="H(this)">15:14:48</span>               ryanbrush </span><span>@devn We just keep rules in source control and it let it handle versioning. I&apos;d imagine a variety of content management systems would be up to the task. As for a function registry, I just use fully-qualified function names from a library, and just have rules depend on a specific library version to use those functions. So not so much as a &quot;function registry&quot; as just using a versioned dependency JAR and qualified function names.</span></div><div id="t1450106132000136" t="2015-12-14 15:15:32 ryanbrush @devn Of course, a more sophisticated solution could be built, but I&apos;ve found just using source control and dependency management sufficient for our needs. And, as you know, Clara rules are just data structures that could be stored wherever convenient."><a href="#t1450106132000136" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-12-14</span> <span class="t" onclick="H(this)">15:15:32</span>               ryanbrush </span><span>@devn Of course, a more sophisticated solution could be built, but I&apos;ve found just using source control and dependency management sufficient for our needs. And, as you know, Clara rules are just data structures that could be stored wherever convenient.</span></div><div id="t1450125440000137" t="2015-12-14 20:37:20 xandrews any recommended reading on the subject of rules systems design?"><a href="#t1450125440000137" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-12-14</span> <span class="t" onclick="H(this)">20:37:20</span>                xandrews </span><span>any recommended reading on the subject of rules systems design?</span></div><div id="t1450133009000138" t="2015-12-14 22:43:29 devn @xandrews: I&apos;m going old school in my reading list"><a href="#t1450133009000138" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-12-14</span> <span class="t" onclick="H(this)">22:43:29</span>                    devn </span><span>@xandrews: I&apos;m going old school in my reading list</span></div><div id="t1450133069000139" t="2015-12-14 22:44:29 devn I picked up Expert Systems - Design and Development by John Durkin"><a href="#t1450133069000139" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-12-14</span> <span class="t" onclick="H(this)">22:44:29</span>                    devn </span><span>I picked up Expert Systems - Design and Development by John Durkin</span></div><div id="t1450133083000140" t="2015-12-14 22:44:43 devn Rule-based programming with OPS5, Programming Expert Systems in OPS5"><a href="#t1450133083000140" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-12-14</span> <span class="t" onclick="H(this)">22:44:43</span>                    devn </span><span>Rule-based programming with OPS5, Programming Expert Systems in OPS5</span></div><div id="t1450133143000141" t="2015-12-14 22:45:43 devn As someone who&apos;s still quite the newb, I&apos;ve been learning from the simpler systems of the past like CLIPS and OPS5"><a href="#t1450133143000141" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-12-14</span> <span class="t" onclick="H(this)">22:45:43</span>                    devn </span><span>As someone who&apos;s still quite the newb, I&apos;ve been learning from the simpler systems of the past like CLIPS and OPS5</span></div><div id="t1450133319000142" t="2015-12-14 22:48:39 devn There&apos;s another much more official looking book that I have not picked up"><a href="#t1450133319000142" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-12-14</span> <span class="t" onclick="H(this)">22:48:39</span>                    devn </span><span>There&apos;s another much more official looking book that I have not picked up</span></div><div id="t1450133496000143" t="2015-12-14 22:51:36 devn Also:  http://reports-archive.adm.cs.cmu.edu/anon/1995/CMU-CS-95-113.pdf"><a href="#t1450133496000143" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-12-14</span> <span class="t" onclick="H(this)">22:51:36</span>                    devn </span><span>Also: </span><a href="http://reports-archive.adm.cs.cmu.edu/anon/1995/CMU-CS-95-113.pdf" target="_blank">http://reports-archive.adm.cs.cmu.edu/anon/1995/CMU-CS-95-113.pdf</a></div><div id="t1450133504000144" t="2015-12-14 22:51:44 devn and  https://www.amazon.com/Expert-Systems-Principles-Programming-Edition/dp/0534384471"><a href="#t1450133504000144" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-12-14</span> <span class="t" onclick="H(this)">22:51:44</span>                    devn </span><span>and </span><a href="https://www.amazon.com/Expert-Systems-Principles-Programming-Edition/dp/0534384471" target="_blank">https://www.amazon.com/Expert-Systems-Principles-Programming-Edition/dp/0534384471</a></div><div id="t1450140291000146" t="2015-12-15 00:44:51 devn @ryanbrush: Is there any way to reference elements of the rule itself, within the rule?"><a href="#t1450140291000146" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-12-15</span> <span class="t" onclick="H(this)">00:44:51</span>                    devn </span><span>@ryanbrush: Is there any way to reference elements of the rule itself, within the rule?</span></div><div id="t1450140332000147" t="2015-12-15 00:45:32 devn @ryanbrush: for instance, it would be cool if I could bind $?name $?docstring or $?lhs"><a href="#t1450140332000147" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-12-15</span> <span class="t" onclick="H(this)">00:45:32</span>                    devn </span><span>@ryanbrush: for instance, it would be cool if I could bind $?name $?docstring or $?lhs</span></div><div id="t1450140391000148" t="2015-12-15 00:46:31 devn So I could push forward some additional metadata about the rule which inserted a fact, for instance"><a href="#t1450140391000148" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-12-15</span> <span class="t" onclick="H(this)">00:46:31</span>                    devn </span><span>So I could push forward some additional metadata about the rule which inserted a fact, for instance</span></div><div id="t1450141897000149" t="2015-12-15 01:11:37 ryanbrush @devn It&apos;s not in the public API, but the clara.rules.engine/rule-context dynamic var is populated when a rule is firing. So you could do something like (get-in clara.rules.engine/rule-context [:node :production]) , which would have :name and :doc properties."><a href="#t1450141897000149" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-12-15</span> <span class="t" onclick="H(this)">01:11:37</span>               ryanbrush </span><span>@devn It&apos;s not in the public API, but the clara.rules.engine/rule-context dynamic var is populated when a rule is firing. So you could do something like (get-in clara.rules.engine/rule-context [:node :production]) , which would have :name and :doc properties.</span></div><div id="t1450141915000150" t="2015-12-15 01:11:55 devn @ryanbrush: ah perfect"><a href="#t1450141915000150" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-12-15</span> <span class="t" onclick="H(this)">01:11:55</span>                    devn </span><span>@ryanbrush: ah perfect</span></div><div id="t1450141944000151" t="2015-12-15 01:12:24 ryanbrush @devn It would be simple to add a (current-rule) function that just returns that to the public namespace as well. I can see how it would be useful."><a href="#t1450141944000151" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-12-15</span> <span class="t" onclick="H(this)">01:12:24</span>               ryanbrush </span><span>@devn It would be simple to add a (current-rule) function that just returns that to the public namespace as well. I can see how it would be useful.</span></div><div id="t1450141975000152" t="2015-12-15 01:12:55 devn Do defrules and queries allow meta on them when defining them?"><a href="#t1450141975000152" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-12-15</span> <span class="t" onclick="H(this)">01:12:55</span>                    devn </span><span>Do defrules and queries allow meta on them when defining them?</span></div><div id="t1450141990000153" t="2015-12-15 01:13:10 devn like  (defrule ^{:cool true} &quot;foo&quot; ... =&gt; ...)"><a href="#t1450141990000153" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-12-15</span> <span class="t" onclick="H(this)">01:13:10</span>                    devn </span><span>like </span><code>(defrule ^{:cool true} &quot;foo&quot; ... =&gt; ...)</code></div><div id="t1450142005000154" t="2015-12-15 01:13:25 devn err forgot the name there"><a href="#t1450142005000154" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-12-15</span> <span class="t" onclick="H(this)">01:13:25</span>                    devn </span><span>err forgot the name there</span></div><div id="t1450142008000155" t="2015-12-15 01:13:28 devn but you catch my drift"><a href="#t1450142008000155" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-12-15</span> <span class="t" onclick="H(this)">01:13:28</span>                    devn </span><span>but you catch my drift</span></div><div id="t1450142106000156" t="2015-12-15 01:15:06 ryanbrush It doesn&apos;t use meta (but that would be add-able). This might be a good case for rule properties. You could do (defrule my-rule {:cool true} &quot;doc here&quot; ... =&gt; ...) This is how rule salience is set but you can put arbitrary properties there."><a href="#t1450142106000156" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-12-15</span> <span class="t" onclick="H(this)">01:15:06</span>               ryanbrush </span><span>It doesn&apos;t use meta (but that would be add-able). This might be a good case for rule properties. You could do (defrule my-rule {:cool true} &quot;doc here&quot; ... =&gt; ...) This is how rule salience is set but you can put arbitrary properties there.</span></div><div id="t1450142123000157" t="2015-12-15 01:15:23 ryanbrush See the salience example for the structure:  http://www.clara-rules.org/docs/conflictsalience/"><a href="#t1450142123000157" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-12-15</span> <span class="t" onclick="H(this)">01:15:23</span>               ryanbrush </span><span>See the salience example for the structure: </span><a href="http://www.clara-rules.org/docs/conflictsalience/" target="_blank">http://www.clara-rules.org/docs/conflictsalience/</a></div><div id="t1450142135000159" t="2015-12-15 01:15:35 devn ah, just discovered that while reading the source"><a href="#t1450142135000159" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-12-15</span> <span class="t" onclick="H(this)">01:15:35</span>                    devn </span><span>ah, just discovered that while reading the source</span></div><div id="t1450142140000160" t="2015-12-15 01:15:40 devn please excuse my laziness"><a href="#t1450142140000160" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-12-15</span> <span class="t" onclick="H(this)">01:15:40</span>                    devn </span><span>please excuse my laziness</span></div><div id="t1450142154000161" t="2015-12-15 01:15:54 ryanbrush No worries."><a href="#t1450142154000161" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-12-15</span> <span class="t" onclick="H(this)">01:15:54</span>               ryanbrush </span><span>No worries.</span></div><div id="t1450142207000162" t="2015-12-15 01:16:47 devn I ran into a situation with salience and accumulators. I don&apos;t have a simple repro as it was a month ago or so now"><a href="#t1450142207000162" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-12-15</span> <span class="t" onclick="H(this)">01:16:47</span>                    devn </span><span>I ran into a situation with salience and accumulators. I don&apos;t have a simple repro as it was a month ago or so now</span></div><div id="t1450142284000163" t="2015-12-15 01:18:04 devn it was a custom accumulator, so probably a good chance it was my fault"><a href="#t1450142284000163" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-12-15</span> <span class="t" onclick="H(this)">01:18:04</span>                    devn </span><span>it was a custom accumulator, so probably a good chance it was my fault</span></div><div id="t1450142301000164" t="2015-12-15 01:18:21 devn but i was curious if you were generally aware of any problem that might exist when accumulating and using salience"><a href="#t1450142301000164" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-12-15</span> <span class="t" onclick="H(this)">01:18:21</span>                    devn </span><span>but i was curious if you were generally aware of any problem that might exist when accumulating and using salience</span></div><div id="t1450142357000165" t="2015-12-15 01:19:17 ryanbrush @devn I&apos;m not aware of any issues with salience and accumulators, although we&apos;ve used both pretty extensively. If you are able to reproduce something we&apos;d definitely want to track it down."><a href="#t1450142357000165" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-12-15</span> <span class="t" onclick="H(this)">01:19:17</span>               ryanbrush </span><span>@devn I&apos;m not aware of any issues with salience and accumulators, although we&apos;ve used both pretty extensively. If you are able to reproduce something we&apos;d definitely want to track it down.</span></div><div id="t1451016189000169" t="2015-12-25 04:03:09 devn Is it possible to do something like this in Clara?

 Cheese( $chedddar : name == &quot;cheddar&quot; ) 

I find myself doing a lot of:
 [Foo (= ?x x) (= x &quot;bar&quot;)]
 

Am I missing something, or is there a way to do both binding and equality in one go?"><a href="#t1451016189000169" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-12-25</span> <span class="t" onclick="H(this)">04:03:09</span>                    devn </span><span>Is it possible to do something like this in Clara?

</span><code>Cheese( $chedddar : name == &quot;cheddar&quot; )</code><span>

I find myself doing a lot of:
</span><pre>[Foo (= ?x x) (= x &quot;bar&quot;)]
</pre><span>

Am I missing something, or is there a way to do both binding and equality in one go?</span></div><div id="t1451016315000170" t="2015-12-25 04:05:15 devn In general, I think a blurb about this would be a good documentation addition.  [Foo (= 2 ?bar bar)]  is different from  [Foo (= ?bar bar 2)]"><a href="#t1451016315000170" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-12-25</span> <span class="t" onclick="H(this)">04:05:15</span>                    devn </span><span>In general, I think a blurb about this would be a good documentation addition. </span><code>[Foo (= 2 ?bar bar)]</code><span> is different from </span><code>[Foo (= ?bar bar 2)]</code></div><div id="t1451016340000171" t="2015-12-25 04:05:40 devn And, the wiki documentation still references  ==  in some places."><a href="#t1451016340000171" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-12-25</span> <span class="t" onclick="H(this)">04:05:40</span>                    devn </span><span>And, the wiki documentation still references </span><code>==</code><span> in some places.</span></div><div id="t1451016415000172" t="2015-12-25 04:06:55 devn ./cc @ryanbrush -- also, happy holidays  simple_smile"><a href="#t1451016415000172" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2015-12-25</span> <span class="t" onclick="H(this)">04:06:55</span>                    devn </span><span>./cc @ryanbrush -- also, happy holidays </span><b>simple_smile</b></div><div id="t1451416252000173" t="2016-12-29 19:10:52 ryanbrush @devn Not a way to do that directly today, but it seems like a worthwhile change. Feel free to log something and I&apos;ll take a closer look when I get back from holiday travels."><a href="#t1451416252000173" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-29</span> <span class="t" onclick="H(this)">19:10:52</span>               ryanbrush </span><span>@devn Not a way to do that directly today, but it seems like a worthwhile change. Feel free to log something and I&apos;ll take a closer look when I get back from holiday travels.</span></div><div id="t1451515995000174" t="2016-12-30 22:53:15 devn @ryanbrush: question for you -- we have rules which are generated dynamically, and we were noticing that our runs with caching turned on were missing the cache. Turns out it was due to ordering."><a href="#t1451515995000174" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-30</span> <span class="t" onclick="H(this)">22:53:15</span>                    devn </span><span>@ryanbrush: question for you -- we have rules which are generated dynamically, and we were noticing that our runs with caching turned on were missing the cache. Turns out it was due to ordering.</span></div><div id="t1451516048000175" t="2016-12-30 22:54:08 devn What do you think about using sets to check for cache hits?"><a href="#t1451516048000175" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-30</span> <span class="t" onclick="H(this)">22:54:08</span>                    devn </span><span>What do you think about using sets to check for cache hits?</span></div><div id="t1451516512000176" t="2016-12-30 23:01:52 devn Honestly, this might be an instance of &quot;not clara&apos;s responsibility&quot; -- I think we&apos;re going to wind up managing our own cache using an LRU or TTL cache"><a href="#t1451516512000176" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-30</span> <span class="t" onclick="H(this)">23:01:52</span>                    devn </span><span>Honestly, this might be an instance of &quot;not clara&apos;s responsibility&quot; -- I think we&apos;re going to wind up managing our own cache using an LRU or TTL cache</span></div><div id="t1451516526000177" t="2016-12-30 23:02:06 devn just curious what you thought -- took a bit of tinkering to figure it out"><a href="#t1451516526000177" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-30</span> <span class="t" onclick="H(this)">23:02:06</span>                    devn </span><span>just curious what you thought -- took a bit of tinkering to figure it out</span></div><div id="t1451516533000178" t="2016-12-30 23:02:13 devn and I guess I don&apos;t see why it couldn&apos;t be a set"><a href="#t1451516533000178" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-30</span> <span class="t" onclick="H(this)">23:02:13</span>                    devn </span><span>and I guess I don&apos;t see why it couldn&apos;t be a set</span></div><div id="t1451516540000179" t="2016-12-30 23:02:20 devn or coerced into one"><a href="#t1451516540000179" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-30</span> <span class="t" onclick="H(this)">23:02:20</span>                    devn </span><span>or coerced into one</span></div><div id="t1451516556000180" t="2016-12-30 23:02:36 devn the generated source rules, i mean"><a href="#t1451516556000180" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-30</span> <span class="t" onclick="H(this)">23:02:36</span>                    devn </span><span>the generated source rules, i mean</span></div><div id="t1451516729000181" t="2016-12-30 23:05:29 ryanbrush @devn I&apos;m open to the idea of using a set to improve cache hits. Come to think of it, if the code that generates rules produces a set (rather than a list) that is passed to mk-session, then that might actually trigger a cache hit by itself.  We should be able to think of mk-session as a memoized function. If passing a set of rules into mk-session doesn&apos;t hit the cache then we could probably change that."><a href="#t1451516729000181" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-30</span> <span class="t" onclick="H(this)">23:05:29</span>               ryanbrush </span><span>@devn I&apos;m open to the idea of using a set to improve cache hits. Come to think of it, if the code that generates rules produces a set (rather than a list) that is passed to mk-session, then that might actually trigger a cache hit by itself.  We should be able to think of mk-session as a memoized function. If passing a set of rules into mk-session doesn&apos;t hit the cache then we could probably change that.</span></div><div id="t1451516781000182" t="2016-12-30 23:06:21 devn yes, making it a set makes it a cache hit"><a href="#t1451516781000182" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-30</span> <span class="t" onclick="H(this)">23:06:21</span>                    devn </span><span>yes, making it a set makes it a cache hit</span></div><div id="t1451516798000183" t="2016-12-30 23:06:38 ryanbrush @devn However, managing your own cache might be a better idea, anyway, since putting all rules into a set (or doing a deep comparison in a sequence) could get expensive for a lot of rules. You could probably do something more efficient in user code if you know that things changed or didn&apos;t."><a href="#t1451516798000183" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-30</span> <span class="t" onclick="H(this)">23:06:38</span>               ryanbrush </span><span>@devn However, managing your own cache might be a better idea, anyway, since putting all rules into a set (or doing a deep comparison in a sequence) could get expensive for a lot of rules. You could probably do something more efficient in user code if you know that things changed or didn&apos;t.</span></div><div id="t1451516910000184" t="2016-12-30 23:08:30 devn i guess my thinking was that it was a little subtle why at first. i opened up yourkit to figure out what was slow, found myself in mk-session, beta and alpha creation, yadda yadda, noticed a lot of DynamicClassLoader business, saw a bunch of eval&apos;s which i believe are the generate LHS and RHS fns"><a href="#t1451516910000184" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-30</span> <span class="t" onclick="H(this)">23:08:30</span>                    devn </span><span>i guess my thinking was that it was a little subtle why at first. i opened up yourkit to figure out what was slow, found myself in mk-session, beta and alpha creation, yadda yadda, noticed a lot of DynamicClassLoader business, saw a bunch of eval&apos;s which i believe are the generate LHS and RHS fns</span></div><div id="t1451516962000185" t="2016-12-30 23:09:22 devn finally noticed we were just getting cache misses, diff&apos;d the generated rules, noticed the order issue, yadda yadda"><a href="#t1451516962000185" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-30</span> <span class="t" onclick="H(this)">23:09:22</span>                    devn </span><span>finally noticed we were just getting cache misses, diff&apos;d the generated rules, noticed the order issue, yadda yadda</span></div><div id="t1451517033000186" t="2016-12-30 23:10:33 devn i couldn&apos;t really think of a good reason why clara couldn&apos;t just make the decision to take whatever collection is passed to mk-session and make it a set, or if someone really wanted duplicates,  (sort-by hash [...])  or something"><a href="#t1451517033000186" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-30</span> <span class="t" onclick="H(this)">23:10:33</span>                    devn </span><span>i couldn&apos;t really think of a good reason why clara couldn&apos;t just make the decision to take whatever collection is passed to mk-session and make it a set, or if someone really wanted duplicates, </span><code>(sort-by hash [...])</code><span> or something</span></div><div id="t1451517163000187" t="2016-12-30 23:12:43 ryanbrush Yeah, that&apos;s fair. Just want to understand any performance implications there might be but I think we can do that."><a href="#t1451517163000187" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-30</span> <span class="t" onclick="H(this)">23:12:43</span>               ryanbrush </span><span>Yeah, that&apos;s fair. Just want to understand any performance implications there might be but I think we can do that.</span></div><div id="t1451517180000188" t="2016-12-30 23:13:00 devn for really large numbers of rules, for instance?"><a href="#t1451517180000188" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-30</span> <span class="t" onclick="H(this)">23:13:00</span>                    devn </span><span>for really large numbers of rules, for instance?</span></div><div id="t1451517544000189" t="2016-12-30 23:19:04 devn @ryanbrush: One More Thing™ -- Do you have any thoughts on analyzing/visualizing the time-complexity of build-network provided a set of rules?"><a href="#t1451517544000189" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-30</span> <span class="t" onclick="H(this)">23:19:04</span>                    devn </span><span>@ryanbrush: One More Thing™ -- Do you have any thoughts on analyzing/visualizing the time-complexity of build-network provided a set of rules?</span></div><div id="t1451517690000190" t="2016-12-30 23:21:30 devn General question is: How much does the design of the rules being added to a session effect the performance of build-network? For instance, a really shallow logic graph vs one with a lot of depth."><a href="#t1451517690000190" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-30</span> <span class="t" onclick="H(this)">23:21:30</span>                    devn </span><span>General question is: How much does the design of the rules being added to a session effect the performance of build-network? For instance, a really shallow logic graph vs one with a lot of depth.</span></div><div id="t1451517841000191" t="2016-12-30 23:24:01 devn Wondering aloud if there&apos;s any potentially actionable information about the complexity of the network that would be useful to someone building an expert system."><a href="#t1451517841000191" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-30</span> <span class="t" onclick="H(this)">23:24:01</span>                    devn </span><span>Wondering aloud if there&apos;s any potentially actionable information about the complexity of the network that would be useful to someone building an expert system.</span></div><div id="t1451517896000192" t="2016-12-30 23:24:56 devn &quot;your logic graph is really shallow, which means build-network is going to be slower&quot;"><a href="#t1451517896000192" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-30</span> <span class="t" onclick="H(this)">23:24:56</span>                    devn </span><span>&quot;your logic graph is really shallow, which means build-network is going to be slower&quot;</span></div><div id="t1451518194000193" t="2016-12-30 23:29:54 ryanbrush @devn good question, but probably not one that I can answer on my mobile right now. ;) I&apos;ll post something more thoughtful when I get the chance."><a href="#t1451518194000193" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-30</span> <span class="t" onclick="H(this)">23:29:54</span>               ryanbrush </span><span>@devn good question, but probably not one that I can answer on my mobile right now. ;) I&apos;ll post something more thoughtful when I get the chance.</span></div><div id="t1451518279000194" t="2016-12-30 23:31:19 devn @ryanbrush: ha, no worries! @enn and I were working together today and I popped open Slack and realized I asked you a question about Clara at 10PM on Christmas Eve. You owe me nothing, and I&apos;m very grateful for all of your help."><a href="#t1451518279000194" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-30</span> <span class="t" onclick="H(this)">23:31:19</span>                    devn </span><span>@ryanbrush: ha, no worries! @enn and I were working together today and I popped open Slack and realized I asked you a question about Clara at 10PM on Christmas Eve. You owe me nothing, and I&apos;m very grateful for all of your help.</span></div><div id="t1452475398000197" t="2016-01-11 01:23:18 datajohnny hello"><a href="#t1452475398000197" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-01-11</span> <span class="t" onclick="H(this)">01:23:18</span>              datajohnny </span><span>hello</span></div><div id="t1452475437000198" t="2016-01-11 01:23:57 datajohnny how can I make this just return the string to the caller?  https://gist.github.com/datajohnny/a927c54a56f00035676e"><a href="#t1452475437000198" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-01-11</span> <span class="t" onclick="H(this)">01:23:57</span>              datajohnny </span><span>how can I make this just return the string to the caller? </span><a href="https://gist.github.com/datajohnny/a927c54a56f00035676e" target="_blank">https://gist.github.com/datajohnny/a927c54a56f00035676e</a></div><div id="t1452516839000199" t="2016-01-11 12:53:59 jthomson @datajohnny: my understanding is that the RHS of a clara rule should be side-effecting.  Sometimes, the side effect will be updating the Clara session itself, via  insert!  and  retract! . A common pattern for what you are trying to do would be to  insert!  a new fact on the RHS of your rule, then  query  the session for those facts after  fire-rules ."><a href="#t1452516839000199" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-01-11</span> <span class="t" onclick="H(this)">12:53:59</span>                jthomson </span><span>@datajohnny: my understanding is that the RHS of a clara rule should be side-effecting.  Sometimes, the side effect will be updating the Clara session itself, via </span><code>insert!</code><span> and </span><code>retract!</code><span>. A common pattern for what you are trying to do would be to </span><code>insert!</code><span> a new fact on the RHS of your rule, then </span><code>query</code><span> the session for those facts after </span><code>fire-rules</code><span>.</span></div><div id="t1452516861000200" t="2016-01-11 12:54:21 jthomson you could follow one of the examples in the  clara-examples  project"><a href="#t1452516861000200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-01-11</span> <span class="t" onclick="H(this)">12:54:21</span>                jthomson </span><span>you could follow one of the examples in the </span><code>clara-examples</code><span> project</span></div><div id="t1452516865000201" t="2016-01-11 12:54:25 jthomson https://github.com/rbrush/clara-examples/blob/master/src/main/clojure/clara/examples/shopping.clj"><a href="#t1452516865000201" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-01-11</span> <span class="t" onclick="H(this)">12:54:25</span>                jthomson </span><a href="https://github.com/rbrush/clara-examples/blob/master/src/main/clojure/clara/examples/shopping.clj" target="_blank">https://github.com/rbrush/clara-examples/blob/master/src/main/clojure/clara/examples/shopping.clj</a></div><div id="t1452697352000204" t="2016-01-13 15:02:32 datajohnny hello, I been fiddling around and im stuck at this right now:  https://gist.github.com/datajohnny/3b82660ba27fd80f448c"><a href="#t1452697352000204" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-01-13</span> <span class="t" onclick="H(this)">15:02:32</span>              datajohnny </span><span>hello, I been fiddling around and im stuck at this right now: </span><a href="https://gist.github.com/datajohnny/3b82660ba27fd80f448c" target="_blank">https://gist.github.com/datajohnny/3b82660ba27fd80f448c</a></div><div id="t1452698040000205" t="2016-01-13 15:14:00 ragge (insert! (-&gt;Person)))"><a href="#t1452698040000205" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-01-13</span> <span class="t" onclick="H(this)">15:14:00</span>                   ragge </span><code>(insert! (-&gt;Person)))</code></div><div id="t1452698050000206" t="2016-01-13 15:14:10 ragge you&apos;re calling the positional constructor for  Person"><a href="#t1452698050000206" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-01-13</span> <span class="t" onclick="H(this)">15:14:10</span>                   ragge </span><span>you&apos;re calling the positional constructor for </span><code>Person</code></div><div id="t1452698060000207" t="2016-01-13 15:14:20 ragge it requires two arguments, name and age"><a href="#t1452698060000207" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-01-13</span> <span class="t" onclick="H(this)">15:14:20</span>                   ragge </span><span>it requires two arguments, name and age</span></div><div id="t1452698065000208" t="2016-01-13 15:14:25 ragge you&apos;re only giving one"><a href="#t1452698065000208" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-01-13</span> <span class="t" onclick="H(this)">15:14:25</span>                   ragge </span><span>you&apos;re only giving one</span></div><div id="t1452698074000209" t="2016-01-13 15:14:34 ragge https://gist.github.com/datajohnny/3b82660ba27fd80f448c#file-gistfile1-txt-L29"><a href="#t1452698074000209" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-01-13</span> <span class="t" onclick="H(this)">15:14:34</span>                   ragge </span><a href="https://gist.github.com/datajohnny/3b82660ba27fd80f448c#file-gistfile1-txt-L29" target="_blank">https://gist.github.com/datajohnny/3b82660ba27fd80f448c#file-gistfile1-txt-L29</a></div><div id="t1452698082000210" t="2016-01-13 15:14:42 ragge Caused by: clojure.lang.ArityException: Wrong number of args (0) passed to: core/eval6101/-&gt;Person--6116"><a href="#t1452698082000210" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-01-13</span> <span class="t" onclick="H(this)">15:14:42</span>                   ragge </span><code>Caused by: clojure.lang.ArityException: Wrong number of args (0) passed to: core/eval6101/-&gt;Person--6116</code></div><div id="t1452698151000211" t="2016-01-13 15:15:51 datajohnny @ragge: what I want is to add that record when the rule is true"><a href="#t1452698151000211" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-01-13</span> <span class="t" onclick="H(this)">15:15:51</span>              datajohnny </span><span>@ragge: what I want is to add that record when the rule is true</span></div><div id="t1452698168000212" t="2016-01-13 15:16:08 datajohnny I thought I was accomplishing that in that manner"><a href="#t1452698168000212" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-01-13</span> <span class="t" onclick="H(this)">15:16:08</span>              datajohnny </span><span>I thought I was accomplishing that in that manner</span></div><div id="t1452698183000213" t="2016-01-13 15:16:23 datajohnny do I need to pass the params in?"><a href="#t1452698183000213" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-01-13</span> <span class="t" onclick="H(this)">15:16:23</span>              datajohnny </span><span>do I need to pass the params in?</span></div><div id="t1452698237000214" t="2016-01-13 15:17:17 datajohnny another thing is that for some reason age the  (&gt;= 21 age)  is not working if I set the age on the session to 21"><a href="#t1452698237000214" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-01-13</span> <span class="t" onclick="H(this)">15:17:17</span>              datajohnny </span><span>another thing is that for some reason age the </span><code>(&gt;= 21 age)</code><span> is not working if I set the age on the session to 21</span></div><div id="t1452700848000215" t="2016-01-13 16:00:48 ryanbrush @datajohnny That test rule matches a person when the age is &gt;= 21, so it is only true if such a person has already been inserted.  The right-hand side of the rule is just a Clojure s-expression that can insert additional facts derived from what matched. So typically you would insert the person (as that example does), match on age &gt;=21, and insert a new fact if that&apos;s the case (like a PersonIsAdult fact)."><a href="#t1452700848000215" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-01-13</span> <span class="t" onclick="H(this)">16:00:48</span>               ryanbrush </span><span>@datajohnny That test rule matches a person when the age is &gt;= 21, so it is only true if such a person has already been inserted.  The right-hand side of the rule is just a Clojure s-expression that can insert additional facts derived from what matched. So typically you would insert the person (as that example does), match on age &gt;=21, and insert a new fact if that&apos;s the case (like a PersonIsAdult fact).</span></div><div id="t1452700867000216" t="2016-01-13 16:01:07 ryanbrush @datajohnny: If you want to get an idea of general usage patterns, I&apos;d check out the examples at  https://github.com/rbrush/clara-examples/tree/master/src/main/clojure/clara/examples"><a href="#t1452700867000216" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-01-13</span> <span class="t" onclick="H(this)">16:01:07</span>               ryanbrush </span><span>@datajohnny: If you want to get an idea of general usage patterns, I&apos;d check out the examples at </span><a href="https://github.com/rbrush/clara-examples/tree/master/src/main/clojure/clara/examples" target="_blank">https://github.com/rbrush/clara-examples/tree/master/src/main/clojure/clara/examples</a></div><div id="t1452701056000218" t="2016-01-13 16:04:16 datajohnny @ryanbrush: thanks"><a href="#t1452701056000218" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-01-13</span> <span class="t" onclick="H(this)">16:04:16</span>              datajohnny </span><span>@ryanbrush: thanks</span></div><div id="t1452701207000219" t="2016-01-13 16:06:47 ryanbrush @datajohnny: You bet!"><a href="#t1452701207000219" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-01-13</span> <span class="t" onclick="H(this)">16:06:47</span>               ryanbrush </span><span>@datajohnny: You bet!</span></div><div id="t1452703766000220" t="2016-01-13 16:49:26 datajohnny @ryanbrush: can the rules work with just maps instead of records, I am trying to build kinda like the same thing you had in your latest blog post but instead of grammar I am getting a json payload"><a href="#t1452703766000220" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-01-13</span> <span class="t" onclick="H(this)">16:49:26</span>              datajohnny </span><span>@ryanbrush: can the rules work with just maps instead of records, I am trying to build kinda like the same thing you had in your latest blog post but instead of grammar I am getting a json payload</span></div><div id="t1452704200000221" t="2016-01-13 16:56:40 ryanbrush @datajohnny:  It can use records. You&apos;ll need to provide a function that returns a &quot;type&quot; for map you use, which will match the type of the rule. See the fact-type-fn at   http://www.clara-rules.org/docs/expressions/#fact-expressions . There&apos;s also a unit test that shows some usage of it at  https://github.com/rbrush/clara-rules/blob/master/src/test/clojure/clara/test_rules.clj#L1977 . The test generates rules in place but you can see a provided fact-type-fn that just reads a field from a record in action."><a href="#t1452704200000221" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-01-13</span> <span class="t" onclick="H(this)">16:56:40</span>               ryanbrush </span><span>@datajohnny:  It can use records. You&apos;ll need to provide a function that returns a &quot;type&quot; for map you use, which will match the type of the rule. See the fact-type-fn at  </span><a href="http://www.clara-rules.org/docs/expressions/#fact-expressions" target="_blank">http://www.clara-rules.org/docs/expressions/#fact-expressions</a><span>. There&apos;s also a unit test that shows some usage of it at </span><a href="https://github.com/rbrush/clara-rules/blob/master/src/test/clojure/clara/test_rules.clj#L1977" target="_blank">https://github.com/rbrush/clara-rules/blob/master/src/test/clojure/clara/test_rules.clj#L1977</a><span>. The test generates rules in place but you can see a provided fact-type-fn that just reads a field from a record in action.</span></div><div id="t1453403705000226" t="2016-01-21 19:15:05 pguillebert Hello"><a href="#t1453403705000226" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-01-21</span> <span class="t" onclick="H(this)">19:15:05</span>             pguillebert </span><span>Hello</span></div><div id="t1453403784000227" t="2016-01-21 19:16:24 pguillebert I’m new to clara-rules and trying to model a rule with a “must not” condition"><a href="#t1453403784000227" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-01-21</span> <span class="t" onclick="H(this)">19:16:24</span>             pguillebert </span><span>I’m new to clara-rules and trying to model a rule with a “must not” condition</span></div><div id="t1453403805000228" t="2016-01-21 19:16:45 pguillebert like “do not trigger if there is this object present&quot;"><a href="#t1453403805000228" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-01-21</span> <span class="t" onclick="H(this)">19:16:45</span>             pguillebert </span><span>like “do not trigger if there is this object present&quot;</span></div><div id="t1453403811000229" t="2016-01-21 19:16:51 pguillebert is it doable ?"><a href="#t1453403811000229" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-01-21</span> <span class="t" onclick="H(this)">19:16:51</span>             pguillebert </span><span>is it doable ?</span></div><div id="t1453411076000230" t="2016-01-21 21:17:56 devn @pguillebert: sure, totally doable."><a href="#t1453411076000230" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-01-21</span> <span class="t" onclick="H(this)">21:17:56</span>                    devn </span><span>@pguillebert: sure, totally doable.</span></div><div id="t1453411481000231" t="2016-01-21 21:24:41 devn @pguillebert: 

 (defrecord Foo [a])
(defrecord Bar [b])
(defrecord Baz [b])

(defrule foo
  [:not [Foo]]
  [Bar (= ?b b 3)]
  =&gt;
  (insert! (-&gt;Baz ?b)))

(defquery q:baz []
  [?baz &lt;- Baz])

(-&gt; (mk-session [foo q:baz])
    (insert-all [;; (-&gt;Foo 1)
                  (-&gt;Bar 3)])
    (fire-rules)
    (query q:baz))

;; =&gt; ({:?baz #crede.rules.examples.Baz{:b 3}})
"><a href="#t1453411481000231" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-01-21</span> <span class="t" onclick="H(this)">21:24:41</span>                    devn </span><span>@pguillebert: 

</span><pre>(defrecord Foo [a])
(defrecord Bar [b])
(defrecord Baz [b])

(defrule foo
  [:not [Foo]]
  [Bar (= ?b b 3)]
  =&gt;
  (insert! (-&gt;Baz ?b)))

(defquery q:baz []
  [?baz &lt;- Baz])

(-&gt; (mk-session [foo q:baz])
    (insert-all [;; (-&gt;Foo 1)
                  (-&gt;Bar 3)])
    (fire-rules)
    (query q:baz))

;; =&gt; ({:?baz #crede.rules.examples.Baz{:b 3}})
</pre></div><div id="t1453411515000232" t="2016-01-21 21:25:15 devn With the same setup, but including a  Foo :
 (-&gt; (mk-session [foo q:baz])
    (insert-all [(-&gt;Foo 1)
                 (-&gt;Bar 3)])
    (fire-rules)
    (query q:baz))

;; =&gt; ()
"><a href="#t1453411515000232" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-01-21</span> <span class="t" onclick="H(this)">21:25:15</span>                    devn </span><span>With the same setup, but including a </span><code>Foo</code><span>:
</span><pre>(-&gt; (mk-session [foo q:baz])
    (insert-all [(-&gt;Foo 1)
                 (-&gt;Bar 3)])
    (fire-rules)
    (query q:baz))

;; =&gt; ()
</pre></div><div id="t1453411657000233" t="2016-01-21 21:27:37 devn There is also  [:exists [Foo]] , but I am not sure I understand the nuance there, though:"><a href="#t1453411657000233" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-01-21</span> <span class="t" onclick="H(this)">21:27:37</span>                    devn </span><span>There is also </span><code>[:exists [Foo]]</code><span>, but I am not sure I understand the nuance there, though:</span></div><div id="t1453411672000234" t="2016-01-21 21:27:52 pguillebert ok, with  :not"><a href="#t1453411672000234" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-01-21</span> <span class="t" onclick="H(this)">21:27:52</span>             pguillebert </span><span>ok, with </span><code>:not</code></div><div id="t1453411682000235" t="2016-01-21 21:28:02 devn (defrule foo
  [:exists [Foo]]
  [Bar (= ?b b 3)]
  =&gt;
  (insert! (-&gt;Baz ?b)))

(defquery q:baz []
  [?baz &lt;- Baz])

(-&gt; (mk-session [foo q:baz])
    (insert-all [(-&gt;Foo 1)
                 (-&gt;Bar 3)])
    (fire-rules)
    (query q:baz))

;; =&gt; ({:?baz #crede.rules.examples.Baz{:b 3}})
"><a href="#t1453411682000235" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-01-21</span> <span class="t" onclick="H(this)">21:28:02</span>                    devn </span><pre>(defrule foo
  [:exists [Foo]]
  [Bar (= ?b b 3)]
  =&gt;
  (insert! (-&gt;Baz ?b)))

(defquery q:baz []
  [?baz &lt;- Baz])

(-&gt; (mk-session [foo q:baz])
    (insert-all [(-&gt;Foo 1)
                 (-&gt;Bar 3)])
    (fire-rules)
    (query q:baz))

;; =&gt; ({:?baz #crede.rules.examples.Baz{:b 3}})
</pre></div><div id="t1453411683000236" t="2016-01-21 21:28:03 pguillebert I just have to trust the magic"><a href="#t1453411683000236" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-01-21</span> <span class="t" onclick="H(this)">21:28:03</span>             pguillebert </span><span>I just have to trust the magic</span></div><div id="t1453411706000237" t="2016-01-21 21:28:26 devn @pguillebert: it&apos;s definitely taken me some getting used to"><a href="#t1453411706000237" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-01-21</span> <span class="t" onclick="H(this)">21:28:26</span>                    devn </span><span>@pguillebert: it&apos;s definitely taken me some getting used to</span></div><div id="t1453411755000238" t="2016-01-21 21:29:15 devn it&apos;s happened more than once now where we wrote some rules, had some initial facts, and then a week or two later realize: &quot;oh, this could be simplified a whole lot&quot;"><a href="#t1453411755000238" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-01-21</span> <span class="t" onclick="H(this)">21:29:15</span>                    devn </span><span>it&apos;s happened more than once now where we wrote some rules, had some initial facts, and then a week or two later realize: &quot;oh, this could be simplified a whole lot&quot;</span></div><div id="t1453411795000239" t="2016-01-21 21:29:55 devn or &quot;hmm, this record type is too general, we should fan out to multiple types of records in this rule&quot;"><a href="#t1453411795000239" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-01-21</span> <span class="t" onclick="H(this)">21:29:55</span>                    devn </span><span>or &quot;hmm, this record type is too general, we should fan out to multiple types of records in this rule&quot;</span></div><div id="t1453412426000240" t="2016-01-21 21:40:26 pguillebert ok thanks"><a href="#t1453412426000240" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-01-21</span> <span class="t" onclick="H(this)">21:40:26</span>             pguillebert </span><span>ok thanks</span></div><div id="t1453412453000241" t="2016-01-21 21:40:53 devn @pguillebert: it really helps to keep an up-to-date graph of the logic, how rules are connected"><a href="#t1453412453000241" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-01-21</span> <span class="t" onclick="H(this)">21:40:53</span>                    devn </span><span>@pguillebert: it really helps to keep an up-to-date graph of the logic, how rules are connected</span></div><div id="t1453412463000242" t="2016-01-21 21:41:03 pguillebert this is really a different way of expressing what I want"><a href="#t1453412463000242" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-01-21</span> <span class="t" onclick="H(this)">21:41:03</span>             pguillebert </span><span>this is really a different way of expressing what I want</span></div><div id="t1453412466000243" t="2016-01-21 21:41:06 pguillebert yeah ok"><a href="#t1453412466000243" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-01-21</span> <span class="t" onclick="H(this)">21:41:06</span>             pguillebert </span><span>yeah ok</span></div><div id="t1453412561000244" t="2016-01-21 21:42:41 devn @ryanbrush: do you have any thoughts on the following:
 (defn group
  &quot;Return a generic grouping accumulator. It behaves like
  clojure.core/group-by with the exception of specifying the grouping
  step.

  Parameters:

  value-fn - unary function which returns the grouping key.
  grouping-fn - binary function which recieves the current key
    value the current reduce value and returns a new key value.
  combine-fn - function for clara.rules/accumulator :combine-fn.
  convert-return-fn - function for clara.rules/accumulator :convert-return-fn.&quot;
  [{:keys [value-fn grouping-fn combine-fn convert-return-fn]
    :or {value-fn identity
         combine-fn merge
         convert-return-fn identity}}]
  {:pre [(ifn? grouping-fn)]}
  (clara.acc/accum
   {:initial-value {}
    :reduce-fn
    (fn [m x]
      (let [v (value-fn x)]
        (update m v grouping-fn x)))
    :combine-fn combine-fn
    :retract-fn #(throw (RuntimeException. &quot;group retract-fn triggered&quot;))
    :convert-return-fn convert-return-fn}))

(defn group-by
  &quot;Return an accumulator which behaves like clojure.core/group-by.&quot;
  [f]
  (group
   {:value-fn f
    :grouping-fn (fnil conj [])
    :combine-fn (fn [a b]
                  (merge-with (comp vec into) a b))}))
"><a href="#t1453412561000244" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-01-21</span> <span class="t" onclick="H(this)">21:42:41</span>                    devn </span><span>@ryanbrush: do you have any thoughts on the following:
</span><pre>(defn group
  &quot;Return a generic grouping accumulator. It behaves like
  clojure.core/group-by with the exception of specifying the grouping
  step.

  Parameters:

  value-fn - unary function which returns the grouping key.
  grouping-fn - binary function which recieves the current key
    value the current reduce value and returns a new key value.
  combine-fn - function for clara.rules/accumulator :combine-fn.
  convert-return-fn - function for clara.rules/accumulator :convert-return-fn.&quot;
  [{:keys [value-fn grouping-fn combine-fn convert-return-fn]
    :or {value-fn identity
         combine-fn merge
         convert-return-fn identity}}]
  {:pre [(ifn? grouping-fn)]}
  (clara.acc/accum
   {:initial-value {}
    :reduce-fn
    (fn [m x]
      (let [v (value-fn x)]
        (update m v grouping-fn x)))
    :combine-fn combine-fn
    :retract-fn #(throw (RuntimeException. &quot;group retract-fn triggered&quot;))
    :convert-return-fn convert-return-fn}))

(defn group-by
  &quot;Return an accumulator which behaves like clojure.core/group-by.&quot;
  [f]
  (group
   {:value-fn f
    :grouping-fn (fnil conj [])
    :combine-fn (fn [a b]
                  (merge-with (comp vec into) a b))}))
</pre></div><div id="t1453412572000245" t="2016-01-21 21:42:52 devn What should  retract-fn  be here? /me puzzles"><a href="#t1453412572000245" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-01-21</span> <span class="t" onclick="H(this)">21:42:52</span>                    devn </span><span>What should </span><code>retract-fn</code><span> be here? /me puzzles</span></div><div id="t1453412685000246" t="2016-01-21 21:44:45 devn perhaps I should be using  reduce-to-accum  here instead"><a href="#t1453412685000246" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-01-21</span> <span class="t" onclick="H(this)">21:44:45</span>                    devn </span><span>perhaps I should be using </span><code>reduce-to-accum</code><span> here instead</span></div><div id="t1453413644000247" t="2016-01-21 22:00:44 devn (defn group-by
  [f]
  (clara.acc/reduce-to-accum
   (fn [m x]
     (let [v (f x)]
       (update m v (fnil conj []) x)))
   {}
   identity
   (fn [a b]
     (merge-with (comp vec into) a b))))
"><a href="#t1453413644000247" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-01-21</span> <span class="t" onclick="H(this)">22:00:44</span>                    devn </span><pre>(defn group-by
  [f]
  (clara.acc/reduce-to-accum
   (fn [m x]
     (let [v (f x)]
       (update m v (fnil conj []) x)))
   {}
   identity
   (fn [a b]
     (merge-with (comp vec into) a b))))
</pre></div><div id="t1453413988000249" t="2016-01-21 22:06:28 ryanbrush @devn retract-fn should &quot;undo&quot; the effect of adding an element to the accumulated result. In this case, I think it&apos;s the opposite of a group-by step for a single value...which presumably would be finding that value in its underlying group and removing it. Probably not trivial to implement but seems doable."><a href="#t1453413988000249" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-01-21</span> <span class="t" onclick="H(this)">22:06:28</span>               ryanbrush </span><span>@devn retract-fn should &quot;undo&quot; the effect of adding an element to the accumulated result. In this case, I think it&apos;s the opposite of a group-by step for a single value...which presumably would be finding that value in its underlying group and removing it. Probably not trivial to implement but seems doable.</span></div><div id="t1453414071000250" t="2016-01-21 22:07:51 devn @ryanbrush: the behavior of group-by with reduce-to-accum seems to be doing what i&apos;m looking for by default. am i crazy?"><a href="#t1453414071000250" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-01-21</span> <span class="t" onclick="H(this)">22:07:51</span>                    devn </span><span>@ryanbrush: the behavior of group-by with reduce-to-accum seems to be doing what i&apos;m looking for by default. am i crazy?</span></div><div id="t1453414141000251" t="2016-01-21 22:09:01 devn (defrule foo
  [?foo &lt;- (my-group-by :a)
   :from [Foo]]
  [Bar (= ?b b 3)]
  [:test (do (println ?foo)
             ?foo)]
  =&gt;
  (println ?foo)
  (insert! (-&gt;Baz ?foo)))

(defquery q:baz []
  [?Qux &lt;- Baz])

(let [f (-&gt;Foo 3)]
  (-&gt; (mk-session [foo q:baz])
      (insert-all [(-&gt;Foo 1)
                   (-&gt;Foo 1)
                   (-&gt;Foo 2)
                   f
                   (-&gt;Bar 3)])
      (retract f)
      (fire-rules)
      (query q:baz)))
"><a href="#t1453414141000251" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-01-21</span> <span class="t" onclick="H(this)">22:09:01</span>                    devn </span><pre>(defrule foo
  [?foo &lt;- (my-group-by :a)
   :from [Foo]]
  [Bar (= ?b b 3)]
  [:test (do (println ?foo)
             ?foo)]
  =&gt;
  (println ?foo)
  (insert! (-&gt;Baz ?foo)))

(defquery q:baz []
  [?Qux &lt;- Baz])

(let [f (-&gt;Foo 3)]
  (-&gt; (mk-session [foo q:baz])
      (insert-all [(-&gt;Foo 1)
                   (-&gt;Foo 1)
                   (-&gt;Foo 2)
                   f
                   (-&gt;Bar 3)])
      (retract f)
      (fire-rules)
      (query q:baz)))
</pre></div><div id="t1453414167000252" t="2016-01-21 22:09:27 devn prints:
 {1 [#myproject.rules.examples.Foo{:a 1} #myproject.rules.examples.Foo{:a 1}], 2 [#myproject.rules.examples.Foo{:a 2}], 3 [#myproject.rules.examples.Foo{:a 3}]}
{1 [#myproject.rules.examples.Foo{:a 1} #myproject.rules.examples.Foo{:a 1}], 2 [#myproject.rules.examples.Foo{:a 2}]}
{1 [#myproject.rules.examples.Foo{:a 1} #myproject.rules.examples.Foo{:a 1}], 2 [#myproject.rules.examples.Foo{:a 2}]}
"><a href="#t1453414167000252" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-01-21</span> <span class="t" onclick="H(this)">22:09:27</span>                    devn </span><span>prints:
</span><pre>{1 [#myproject.rules.examples.Foo{:a 1} #myproject.rules.examples.Foo{:a 1}], 2 [#myproject.rules.examples.Foo{:a 2}], 3 [#myproject.rules.examples.Foo{:a 3}]}
{1 [#myproject.rules.examples.Foo{:a 1} #myproject.rules.examples.Foo{:a 1}], 2 [#myproject.rules.examples.Foo{:a 2}]}
{1 [#myproject.rules.examples.Foo{:a 1} #myproject.rules.examples.Foo{:a 1}], 2 [#myproject.rules.examples.Foo{:a 2}]}
</pre></div><div id="t1453414202000253" t="2016-01-21 22:10:02 ryanbrush @devn, no that makes sense. It&apos;s probably not the most efficient implementation if you have lots of retracts since it will redo the entire computation. The retract optimization could do something more efficient by removing a single value rather than re-reducing."><a href="#t1453414202000253" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-01-21</span> <span class="t" onclick="H(this)">22:10:02</span>               ryanbrush </span><span>@devn, no that makes sense. It&apos;s probably not the most efficient implementation if you have lots of retracts since it will redo the entire computation. The retract optimization could do something more efficient by removing a single value rather than re-reducing.</span></div><div id="t1453414221000254" t="2016-01-21 22:10:21 devn ahhh, i see what you&apos;re getting at"><a href="#t1453414221000254" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-01-21</span> <span class="t" onclick="H(this)">22:10:21</span>                    devn </span><span>ahhh, i see what you&apos;re getting at</span></div><div id="t1453414230000255" t="2016-01-21 22:10:30 devn the number of retracts here will be really small, so no worries"><a href="#t1453414230000255" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-01-21</span> <span class="t" onclick="H(this)">22:10:30</span>                    devn </span><span>the number of retracts here will be really small, so no worries</span></div><div id="t1453414278000256" t="2016-01-21 22:11:18 ryanbrush Yeah, I wouldn&apos;t worry about it unless you have lots of retracts and data, and you can always optimize it later without changing visible behavior."><a href="#t1453414278000256" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-01-21</span> <span class="t" onclick="H(this)">22:11:18</span>               ryanbrush </span><span>Yeah, I wouldn&apos;t worry about it unless you have lots of retracts and data, and you can always optimize it later without changing visible behavior.</span></div><div id="t1453414304000257" t="2016-01-21 22:11:44 ryanbrush Cool use of accumulator, by the way."><a href="#t1453414304000257" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-01-21</span> <span class="t" onclick="H(this)">22:11:44</span>               ryanbrush </span><span>Cool use of accumulator, by the way.</span></div><div id="t1453414326000258" t="2016-01-21 22:12:06 devn I think we talked about this awhile back, but any interest in pulling something like this into clara&apos;s accumulators?"><a href="#t1453414326000258" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-01-21</span> <span class="t" onclick="H(this)">22:12:06</span>                    devn </span><span>I think we talked about this awhile back, but any interest in pulling something like this into clara&apos;s accumulators?</span></div><div id="t1453414350000259" t="2016-01-21 22:12:30 devn I suppose you&apos;d be looking for the more efficient impl that undoes a single step"><a href="#t1453414350000259" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-01-21</span> <span class="t" onclick="H(this)">22:12:30</span>                    devn </span><span>I suppose you&apos;d be looking for the more efficient impl that undoes a single step</span></div><div id="t1453414386000260" t="2016-01-21 22:13:06 ryanbrush I&apos;d bring that one in if you want to put together a pull req and a simple test. "><a href="#t1453414386000260" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-01-21</span> <span class="t" onclick="H(this)">22:13:06</span>               ryanbrush </span><span>I&apos;d bring that one in if you want to put together a pull req and a simple test. </span></div><div id="t1453414394000261" t="2016-01-21 22:13:14 devn and honestly, I&apos;m not sure if I&apos;ll spend the time there... really, this group-by is just a tad more complicated"><a href="#t1453414394000261" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-01-21</span> <span class="t" onclick="H(this)">22:13:14</span>                    devn </span><span>and honestly, I&apos;m not sure if I&apos;ll spend the time there... really, this group-by is just a tad more complicated</span></div><div id="t1453414416000262" t="2016-01-21 22:13:36 devn it&apos;s nice to group-by over a set of facts, and then call a function on the resulting set to bind to ?x"><a href="#t1453414416000262" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-01-21</span> <span class="t" onclick="H(this)">22:13:36</span>                    devn </span><span>it&apos;s nice to group-by over a set of facts, and then call a function on the resulting set to bind to ?x</span></div><div id="t1453414422000263" t="2016-01-21 22:13:42 devn like you might group by date, and then find the minimum date"><a href="#t1453414422000263" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-01-21</span> <span class="t" onclick="H(this)">22:13:42</span>                    devn </span><span>like you might group by date, and then find the minimum date</span></div><div id="t1453414428000264" t="2016-01-21 22:13:48 devn and bind that"><a href="#t1453414428000264" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-01-21</span> <span class="t" onclick="H(this)">22:13:48</span>                    devn </span><span>and bind that</span></div><div id="t1453414558000265" t="2016-01-21 22:15:58 ryanbrush Interesting. It&apos;s not a flow we&apos;ve used directly but makes sense to me. I might actually think about doing so in our own rules."><a href="#t1453414558000265" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-01-21</span> <span class="t" onclick="H(this)">22:15:58</span>               ryanbrush </span><span>Interesting. It&apos;s not a flow we&apos;ve used directly but makes sense to me. I might actually think about doing so in our own rules.</span></div><div id="t1453414651000266" t="2016-01-21 22:17:31 devn @ryanbrush: either way i&apos;ll send a PR your way with a simple test and we can talk more there"><a href="#t1453414651000266" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-01-21</span> <span class="t" onclick="H(this)">22:17:31</span>                    devn </span><span>@ryanbrush: either way i&apos;ll send a PR your way with a simple test and we can talk more there</span></div><div id="t1453414653000267" t="2016-01-21 22:17:33 devn thanks!"><a href="#t1453414653000267" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-01-21</span> <span class="t" onclick="H(this)">22:17:33</span>                    devn </span><span>thanks!</span></div><div id="t1453414732000268" t="2016-01-21 22:18:52 ryanbrush @devn Sounds good!"><a href="#t1453414732000268" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-01-21</span> <span class="t" onclick="H(this)">22:18:52</span>               ryanbrush </span><span>@devn Sounds good!</span></div><div id="t1453415267000269" t="2016-01-21 22:27:47 pguillebert mmmh. apparently this is not working :"><a href="#t1453415267000269" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-01-21</span> <span class="t" onclick="H(this)">22:27:47</span>             pguillebert </span><span>mmmh. apparently this is not working :</span></div><div id="t1453415271000270" t="2016-01-21 22:27:51 pguillebert   [:not [:test (and (= ?ndate ?sdate) (= ?ndes ?sdes))]]"><a href="#t1453415271000270" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-01-21</span> <span class="t" onclick="H(this)">22:27:51</span>             pguillebert </span><code>  [:not [:test (and (= ?ndate ?sdate) (= ?ndes ?sdes))]]</code></div><div id="t1453415301000271" t="2016-01-21 22:28:21 pguillebert can I negate tests on variables ?"><a href="#t1453415301000271" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-01-21</span> <span class="t" onclick="H(this)">22:28:21</span>             pguillebert </span><span>can I negate tests on variables ?</span></div><div id="t1453416002000272" t="2016-01-21 22:40:02 pguillebert same test applied in a  when  in the RHS does what I want (prevent rule firing based on :test)"><a href="#t1453416002000272" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-01-21</span> <span class="t" onclick="H(this)">22:40:02</span>             pguillebert </span><span>same test applied in a </span><code>when</code><span> in the RHS does what I want (prevent rule firing based on :test)</span></div><div id="t1453416027000273" t="2016-01-21 22:40:27 pguillebert I mean, a  when-not"><a href="#t1453416027000273" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-01-21</span> <span class="t" onclick="H(this)">22:40:27</span>             pguillebert </span><span>I mean, a </span><code>when-not</code></div><div id="t1453416053000274" t="2016-01-21 22:40:53 pguillebert is this a limitation or am I missing something ?"><a href="#t1453416053000274" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-01-21</span> <span class="t" onclick="H(this)">22:40:53</span>             pguillebert </span><span>is this a limitation or am I missing something ?</span></div><div id="t1453417324000275" t="2016-01-21 23:02:04 devn @ryanbrush:  https://github.com/rbrush/clara-rules/pull/164/files"><a href="#t1453417324000275" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-01-21</span> <span class="t" onclick="H(this)">23:02:04</span>                    devn </span><span>@ryanbrush: </span><a href="https://github.com/rbrush/clara-rules/pull/164/files" target="_blank">https://github.com/rbrush/clara-rules/pull/164/files</a></div><div id="t1453417400000277" t="2016-01-21 23:03:20 devn @pguillebert: does it work if you just  (not (and ...))  in a  [:test ...]  without the wrapping   [:not ...] ?"><a href="#t1453417400000277" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-01-21</span> <span class="t" onclick="H(this)">23:03:20</span>                    devn </span><span>@pguillebert: does it work if you just </span><code>(not (and ...))</code><span> in a </span><code>[:test ...]</code><span> without the wrapping  </span><code>[:not ...]</code><span>?</span></div><div id="t1453417746000278" t="2016-01-21 23:09:06 pguillebert I just killed my emacs  simple_smile"><a href="#t1453417746000278" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-01-21</span> <span class="t" onclick="H(this)">23:09:06</span>             pguillebert </span><span>I just killed my emacs </span><b>simple_smile</b></div><div id="t1453417765000279" t="2016-01-21 23:09:25 pguillebert I didn’t try, will test tomorrow"><a href="#t1453417765000279" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-01-21</span> <span class="t" onclick="H(this)">23:09:25</span>             pguillebert </span><span>I didn’t try, will test tomorrow</span></div><div id="t1453419098000280" t="2016-01-21 23:31:38 devn @pguillebert: my guess is you had an infinite loop"><a href="#t1453419098000280" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-01-21</span> <span class="t" onclick="H(this)">23:31:38</span>                    devn </span><span>@pguillebert: my guess is you had an infinite loop</span></div><div id="t1453419118000281" t="2016-01-21 23:31:58 devn @pguillebert: feel free to gist code in here if you&apos;d like another set of eyes"><a href="#t1453419118000281" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-01-21</span> <span class="t" onclick="H(this)">23:31:58</span>                    devn </span><span>@pguillebert: feel free to gist code in here if you&apos;d like another set of eyes</span></div><div id="t1453493271000286" t="2016-01-22 20:07:51 ryanbrush @pguillebert: Ugh, I think you came across a bug here. Issue logged:  https://github.com/rbrush/clara-rules/issues/165"><a href="#t1453493271000286" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-01-22</span> <span class="t" onclick="H(this)">20:07:51</span>               ryanbrush </span><span>@pguillebert: Ugh, I think you came across a bug here. Issue logged: </span><a href="https://github.com/rbrush/clara-rules/issues/165" target="_blank">https://github.com/rbrush/clara-rules/issues/165</a></div><div id="t1453493381000288" t="2016-01-22 20:09:41 ryanbrush @pguillebert It looks like it&apos;s specific to the case of having a test within a negation, which somehow we haven&apos;t covered. Thanks for reporting it here."><a href="#t1453493381000288" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-01-22</span> <span class="t" onclick="H(this)">20:09:41</span>               ryanbrush </span><span>@pguillebert It looks like it&apos;s specific to the case of having a test within a negation, which somehow we haven&apos;t covered. Thanks for reporting it here.</span></div><div id="t1453493737000289" t="2016-01-22 20:15:37 pguillebert you’re welcone"><a href="#t1453493737000289" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-01-22</span> <span class="t" onclick="H(this)">20:15:37</span>             pguillebert </span><span>you’re welcone</span></div><div id="t1453493760000290" t="2016-01-22 20:16:00 pguillebert usually when I report something I am the bug  simple_smile"><a href="#t1453493760000290" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-01-22</span> <span class="t" onclick="H(this)">20:16:00</span>             pguillebert </span><span>usually when I report something I am the bug </span><b>simple_smile</b></div><div id="t1453496236000291" t="2016-01-22 20:57:16 ryanbrush @pguillebert Haha, I know that feeling very well. I got a simple fix for this bug committed on the issue linked above. The fix is a bit ugly and depends on some other refactoring, but I expect to get this into master next week and released soon afterwards. If you do need this sooner then you can build against the issue-165 branch I created."><a href="#t1453496236000291" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-01-22</span> <span class="t" onclick="H(this)">20:57:16</span>               ryanbrush </span><span>@pguillebert Haha, I know that feeling very well. I got a simple fix for this bug committed on the issue linked above. The fix is a bit ugly and depends on some other refactoring, but I expect to get this into master next week and released soon afterwards. If you do need this sooner then you can build against the issue-165 branch I created.</span></div><div id="t1453496729000294" t="2016-01-22 21:05:29 pguillebert well thanks but the simple workaround of negating the condition works well for me"><a href="#t1453496729000294" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-01-22</span> <span class="t" onclick="H(this)">21:05:29</span>             pguillebert </span><span>well thanks but the simple workaround of negating the condition works well for me</span></div><div id="t1453496735000295" t="2016-01-22 21:05:35 pguillebert so no rush"><a href="#t1453496735000295" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-01-22</span> <span class="t" onclick="H(this)">21:05:35</span>             pguillebert </span><span>so no rush</span></div><div id="t1453496971000296" t="2016-01-22 21:09:31 ryanbrush Good to know. I mostly just didn&apos;t want that mistake hanging around out here any longer than it already has.  😉"><a href="#t1453496971000296" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-01-22</span> <span class="t" onclick="H(this)">21:09:31</span>               ryanbrush </span><span>Good to know. I mostly just didn&apos;t want that mistake hanging around out here any longer than it already has. </span><b>😉</b></div><div id="t1453504376000297" t="2016-01-22 23:12:56 pguillebert Mmmh what is the preferred way to configure rules ?"><a href="#t1453504376000297" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-01-22</span> <span class="t" onclick="H(this)">23:12:56</span>             pguillebert </span><span>Mmmh what is the preferred way to configure rules ?</span></div><div id="t1453504469000298" t="2016-01-22 23:14:29 pguillebert like, should I add a configuration record to my facts or is there a better facility ?"><a href="#t1453504469000298" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-01-22</span> <span class="t" onclick="H(this)">23:14:29</span>             pguillebert </span><span>like, should I add a configuration record to my facts or is there a better facility ?</span></div><div id="t1453522206000299" t="2016-01-23 04:10:06 devn @pguillebert: that&apos;s a very good question  simple_smile  we haven&apos;t come to a strong conclusion on that front"><a href="#t1453522206000299" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-01-23</span> <span class="t" onclick="H(this)">04:10:06</span>                    devn </span><span>@pguillebert: that&apos;s a very good question </span><b>simple_smile</b><span> we haven&apos;t come to a strong conclusion on that front</span></div><div id="t1453522328000300" t="2016-01-23 04:12:08 devn right now, we are grabbing tables from postgres (configuration), importing them and using datascript to &quot;enrich&quot; our base set of facts"><a href="#t1453522328000300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-01-23</span> <span class="t" onclick="H(this)">04:12:08</span>                    devn </span><span>right now, we are grabbing tables from postgres (configuration), importing them and using datascript to &quot;enrich&quot; our base set of facts</span></div><div id="t1453522406000301" t="2016-01-23 04:13:26 devn so we might have some basic idea of what  IsClean  means, but we&apos;ll enrich that fact with  :cleanliness-threshold :low  based on the information from the external configuration DB"><a href="#t1453522406000301" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-01-23</span> <span class="t" onclick="H(this)">04:13:26</span>                    devn </span><span>so we might have some basic idea of what </span><code>IsClean</code><span> means, but we&apos;ll enrich that fact with </span><code>:cleanliness-threshold :low</code><span> based on the information from the external configuration DB</span></div><div id="t1453522517000302" t="2016-01-23 04:15:17 devn not sure if that&apos;s what you&apos;re looking for or not..."><a href="#t1453522517000302" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-01-23</span> <span class="t" onclick="H(this)">04:15:17</span>                    devn </span><span>not sure if that&apos;s what you&apos;re looking for or not...</span></div><div id="t1453522563000303" t="2016-01-23 04:16:03 devn obviously we&apos;ve punted on guaranteeing we aren&apos;t affected by upstream schema changes for the moment"><a href="#t1453522563000303" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-01-23</span> <span class="t" onclick="H(this)">04:16:03</span>                    devn </span><span>obviously we&apos;ve punted on guaranteeing we aren&apos;t affected by upstream schema changes for the moment</span></div><div id="t1453522948000304" t="2016-01-23 04:22:28 devn i&apos;d like to talk about the configuration problem in general. we&apos;re going to need to have versioned rules per customer, likely with some kind of function registry, which may be as stupid as associating a set of versioned rules with a pointer to a git SHA where a particular file at that SHA is the mapping of our application&apos;s private functions, to the &quot;public&quot; functions that rules authors indirectly tap into when building rules"><a href="#t1453522948000304" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-01-23</span> <span class="t" onclick="H(this)">04:22:28</span>                    devn </span><span>i&apos;d like to talk about the configuration problem in general. we&apos;re going to need to have versioned rules per customer, likely with some kind of function registry, which may be as stupid as associating a set of versioned rules with a pointer to a git SHA where a particular file at that SHA is the mapping of our application&apos;s private functions, to the &quot;public&quot; functions that rules authors indirectly tap into when building rules</span></div><div id="t1453523084000306" t="2016-01-23 04:24:44 devn im also curious about persisting durable sessions. that would be interesting for auditing, capturing configuration at a point in time, etc."><a href="#t1453523084000306" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-01-23</span> <span class="t" onclick="H(this)">04:24:44</span>                    devn </span><span>im also curious about persisting durable sessions. that would be interesting for auditing, capturing configuration at a point in time, etc.</span></div><div id="t1453523103000307" t="2016-01-23 04:25:03 devn would also provide a way to do replays"><a href="#t1453523103000307" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-01-23</span> <span class="t" onclick="H(this)">04:25:03</span>                    devn </span><span>would also provide a way to do replays</span></div><div id="t1453761345000003" t="2016-01-25 22:35:45 pguillebert Hey"><a href="#t1453761345000003" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-01-25</span> <span class="t" onclick="H(this)">22:35:45</span>             pguillebert </span><span>Hey</span></div><div id="t1453761362000004" t="2016-01-25 22:36:02 pguillebert I think I found a bug/unexpected limit in Clara"><a href="#t1453761362000004" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-01-25</span> <span class="t" onclick="H(this)">22:36:02</span>             pguillebert </span><span>I think I found a bug/unexpected limit in Clara</span></div><div id="t1453761558000006" t="2016-01-25 22:39:18 pguillebert this changes the rule’s behaviour"><a href="#t1453761558000006" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-01-25</span> <span class="t" onclick="H(this)">22:39:18</span>             pguillebert </span><span>this changes the rule’s behaviour</span></div><div id="t1453761568000007" t="2016-01-25 22:39:28 pguillebert without warning"><a href="#t1453761568000007" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-01-25</span> <span class="t" onclick="H(this)">22:39:28</span>             pguillebert </span><span>without warning</span></div><div id="t1453761654000008" t="2016-01-25 22:40:54 pguillebert so I think either I’m very tired, or this looks like a bug"><a href="#t1453761654000008" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-01-25</span> <span class="t" onclick="H(this)">22:40:54</span>             pguillebert </span><span>so I think either I’m very tired, or this looks like a bug</span></div><div id="t1453815058000009" t="2016-01-26 13:30:58 pguillebert opened issue  #166"><a href="#t1453815058000009" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-01-26</span> <span class="t" onclick="H(this)">13:30:58</span>             pguillebert </span><span>opened issue  #166</span></div><div id="t1453911683000010" t="2016-01-27 16:21:23 ryanbrush Alright, back on Slack.  😉  For reference, the issue that @pguillebert logged is here and should be fixed. We&apos;re planning on doing a release of 0.10 as soon as we get some unrelated optimizations to accumulators finished which includes this and a number of other improvements.   https://github.com/rbrush/clara-rules/issues/166"><a href="#t1453911683000010" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-01-27</span> <span class="t" onclick="H(this)">16:21:23</span>               ryanbrush </span><span>Alright, back on Slack. </span><b>😉</b><span> For reference, the issue that @pguillebert logged is here and should be fixed. We&apos;re planning on doing a release of 0.10 as soon as we get some unrelated optimizations to accumulators finished which includes this and a number of other improvements.  </span><a href="https://github.com/rbrush/clara-rules/issues/166" target="_blank">https://github.com/rbrush/clara-rules/issues/166</a></div><div id="t1453911756000011" t="2016-01-27 16:22:36 ryanbrush Here&apos;s what is targeted at 0.10, if you&apos;re curious:  https://github.com/rbrush/clara-rules/issues?q=milestone%3A0.10.0"><a href="#t1453911756000011" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-01-27</span> <span class="t" onclick="H(this)">16:22:36</span>               ryanbrush </span><span>Here&apos;s what is targeted at 0.10, if you&apos;re curious: </span><a href="https://github.com/rbrush/clara-rules/issues?q=milestone%3A0.10.0" target="_blank">https://github.com/rbrush/clara-rules/issues?q=milestone%3A0.10.0</a></div><div id="t1453913742000013" t="2016-01-27 16:55:42 pguillebert ryanbrush: I’ll try to build the issue-166 branch when I get the time"><a href="#t1453913742000013" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-01-27</span> <span class="t" onclick="H(this)">16:55:42</span>             pguillebert </span><span>ryanbrush: I’ll try to build the issue-166 branch when I get the time</span></div><div id="t1453913987000014" t="2016-01-27 16:59:47 ryanbrush @pguillebert: Sounds good! I&apos;m pretty sure that addresses what you saw but verification is always a good thing. I do appreciate the bug report and reproducible example."><a href="#t1453913987000014" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-01-27</span> <span class="t" onclick="H(this)">16:59:47</span>               ryanbrush </span><span>@pguillebert: Sounds good! I&apos;m pretty sure that addresses what you saw but verification is always a good thing. I do appreciate the bug report and reproducible example.</span></div><div id="t1454347752000016" t="2016-02-01 17:29:12 pguillebert is there a planned date for the release of 0.10 ?"><a href="#t1454347752000016" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-02-01</span> <span class="t" onclick="H(this)">17:29:12</span>             pguillebert </span><span>is there a planned date for the release of 0.10 ?</span></div><div id="t1454348741000017" t="2016-02-01 17:45:41 ryanbrush @pguillebert: I&apos;ll release 0.10 by the end of the week. There are a couple more improvements I wanted to include, but they can be delayed if necessary. 0.10 in its current form is a big enough step forward that it makes sense to get out there."><a href="#t1454348741000017" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-02-01</span> <span class="t" onclick="H(this)">17:45:41</span>               ryanbrush </span><span>@pguillebert: I&apos;ll release 0.10 by the end of the week. There are a couple more improvements I wanted to include, but they can be delayed if necessary. 0.10 in its current form is a big enough step forward that it makes sense to get out there.</span></div><div id="t1454348861000018" t="2016-02-01 17:47:41 pguillebert ok great"><a href="#t1454348861000018" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-02-01</span> <span class="t" onclick="H(this)">17:47:41</span>             pguillebert </span><span>ok great</span></div><div id="t1454684581000019" t="2016-02-05 15:03:01 ryanbrush Aaaand Clara 0.10.0 is up on Clojars! A couple small features, a number of bug fixes, and significantly improved performance for some workloads. Release notes here:  https://github.com/rbrush/clara-rules/blob/master/CHANGELOG.md#0100"><a href="#t1454684581000019" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-02-05</span> <span class="t" onclick="H(this)">15:03:01</span>               ryanbrush </span><span>Aaaand Clara 0.10.0 is up on Clojars! A couple small features, a number of bug fixes, and significantly improved performance for some workloads. Release notes here: </span><a href="https://github.com/rbrush/clara-rules/blob/master/CHANGELOG.md#0100" target="_blank">https://github.com/rbrush/clara-rules/blob/master/CHANGELOG.md#0100</a></div><div id="t1455828099000002" t="2016-02-18 20:41:39 devn Heya @ryanbrush -- dumb question for you"><a href="#t1455828099000002" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-02-18</span> <span class="t" onclick="H(this)">20:41:39</span>                    devn </span><span>Heya @ryanbrush -- dumb question for you</span></div><div id="t1455828142000003" t="2016-02-18 20:42:22 devn Say I create a session, and insert 3 (-&gt;Temperature 100 &quot;ABC&quot;) facts, and then retract (-&gt;Temperature 100 &quot;ABC&quot;) once on that session"><a href="#t1455828142000003" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-02-18</span> <span class="t" onclick="H(this)">20:42:22</span>                    devn </span><span>Say I create a session, and insert 3 (-&gt;Temperature 100 &quot;ABC&quot;) facts, and then retract (-&gt;Temperature 100 &quot;ABC&quot;) once on that session</span></div><div id="t1455828184000005" t="2016-02-18 20:43:04 devn Should there be 0 (-&gt;Temperature 100 &quot;ABC&quot;) facts?"><a href="#t1455828184000005" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-02-18</span> <span class="t" onclick="H(this)">20:43:04</span>                    devn </span><span>Should there be 0 (-&gt;Temperature 100 &quot;ABC&quot;) facts?</span></div><div id="t1455829175000007" t="2016-02-18 20:59:35 wparker Are these top-level insert calls i.e. (clara.rules/insert session fact) or logical insertions and retractions? @devn"><a href="#t1455829175000007" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-02-18</span> <span class="t" onclick="H(this)">20:59:35</span>                 wparker </span><span>Are these top-level insert calls i.e. (clara.rules/insert session fact) or logical insertions and retractions? @devn</span></div><div id="t1455829189000008" t="2016-02-18 20:59:49 devn top-level"><a href="#t1455829189000008" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-02-18</span> <span class="t" onclick="H(this)">20:59:49</span>                    devn </span><span>top-level</span></div><div id="t1455829210000009" t="2016-02-18 21:00:10 wparker A quick trial suggests that top-level retracts one at a time"><a href="#t1455829210000009" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-02-18</span> <span class="t" onclick="H(this)">21:00:10</span>                 wparker </span><span>A quick trial suggests that top-level retracts one at a time</span></div><div id="t1455829239000010" t="2016-02-18 21:00:39 wparker Logical retractions of equal facts from the same production currently have a truth maintenance bug; see  https://github.com/rbrush/clara-rules/issues/171"><a href="#t1455829239000010" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-02-18</span> <span class="t" onclick="H(this)">21:00:39</span>                 wparker </span><span>Logical retractions of equal facts from the same production currently have a truth maintenance bug; see </span><a href="https://github.com/rbrush/clara-rules/issues/171" target="_blank">https://github.com/rbrush/clara-rules/issues/171</a></div><div id="t1455829240000011" t="2016-02-18 21:00:40 devn session (-&gt; (mk-session [grouping-query
                                 grouping-convert-query])
                    (insert-all [(-&gt;Temperature 30 &quot;MCI&quot;)
                                 (-&gt;Temperature 10 &quot;MCI&quot;)
                                 (-&gt;Temperature 80 &quot;MCI&quot;)
                                 (-&gt;Temperature 80 &quot;MCI&quot;)]))

        retracted-session (-&gt; session
                              (retract (-&gt;Temperature 80 &quot;MCI&quot;)
                                       (-&gt;Temperature 80 &quot;MCI&quot;)))
"><a href="#t1455829240000011" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-02-18</span> <span class="t" onclick="H(this)">21:00:40</span>                    devn </span><pre>session (-&gt; (mk-session [grouping-query
                                 grouping-convert-query])
                    (insert-all [(-&gt;Temperature 30 &quot;MCI&quot;)
                                 (-&gt;Temperature 10 &quot;MCI&quot;)
                                 (-&gt;Temperature 80 &quot;MCI&quot;)
                                 (-&gt;Temperature 80 &quot;MCI&quot;)]))

        retracted-session (-&gt; session
                              (retract (-&gt;Temperature 80 &quot;MCI&quot;)
                                       (-&gt;Temperature 80 &quot;MCI&quot;)))
</pre></div><div id="t1455829267000013" t="2016-02-18 21:01:07 devn @wparker: oof, good catch."><a href="#t1455829267000013" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-02-18</span> <span class="t" onclick="H(this)">21:01:07</span>                    devn </span><span>@wparker: oof, good catch.</span></div><div id="t1455829307000014" t="2016-02-18 21:01:47 devn @wparker: I guess my question is, after running the same trial myself is: should it?"><a href="#t1455829307000014" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-02-18</span> <span class="t" onclick="H(this)">21:01:47</span>                    devn </span><span>@wparker: I guess my question is, after running the same trial myself is: should it?</span></div><div id="t1455829333000015" t="2016-02-18 21:02:13 wparker I’d expect that to have temperatures of 30 and 10"><a href="#t1455829333000015" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-02-18</span> <span class="t" onclick="H(this)">21:02:13</span>                 wparker </span><span>I’d expect that to have temperatures of 30 and 10</span></div><div id="t1455829337000016" t="2016-02-18 21:02:17 wparker Does it not?"><a href="#t1455829337000016" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-02-18</span> <span class="t" onclick="H(this)">21:02:17</span>                 wparker </span><span>Does it not?</span></div><div id="t1455829347000017" t="2016-02-18 21:02:27 devn It does."><a href="#t1455829347000017" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-02-18</span> <span class="t" onclick="H(this)">21:02:27</span>                    devn </span><span>It does.</span></div><div id="t1455829377000018" t="2016-02-18 21:02:57 wparker So you insert 2 temperatures of 80 and then retract 2 of them; I’d expect there to be none left"><a href="#t1455829377000018" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-02-18</span> <span class="t" onclick="H(this)">21:02:57</span>                 wparker </span><span>So you insert 2 temperatures of 80 and then retract 2 of them; I’d expect there to be none left</span></div><div id="t1455829387000019" t="2016-02-18 21:03:07 devn I guess I halfway expected that, for instance, some deeper identity of a fact beyond just its equality with a corresponding fact in the session would have some bearing."><a href="#t1455829387000019" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-02-18</span> <span class="t" onclick="H(this)">21:03:07</span>                    devn </span><span>I guess I halfway expected that, for instance, some deeper identity of a fact beyond just its equality with a corresponding fact in the session would have some bearing.</span></div><div id="t1455829428000020" t="2016-02-18 21:03:48 devn So if I bound  (-&gt;Temperature 80 &quot;MCI&quot;)  to  high-temp , and then used  high-temp  twice in the  insert-all"><a href="#t1455829428000020" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-02-18</span> <span class="t" onclick="H(this)">21:03:48</span>                    devn </span><span>So if I bound </span><code>(-&gt;Temperature 80 &quot;MCI&quot;)</code><span> to </span><code>high-temp</code><span>, and then used </span><code>high-temp</code><span> twice in the </span><code>insert-all</code></div><div id="t1455829478000021" t="2016-02-18 21:04:38 devn When I do a  (retract session high-termp) , it would actually retract both facts"><a href="#t1455829478000021" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-02-18</span> <span class="t" onclick="H(this)">21:04:38</span>                    devn </span><span>When I do a </span><code>(retract session high-termp)</code><span>, it would actually retract both facts</span></div><div id="t1455829539000022" t="2016-02-18 21:05:39 devn I was surprised, but I guess after thinking about it, it doesn&apos;t really matter which of the facts is retracted."><a href="#t1455829539000022" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-02-18</span> <span class="t" onclick="H(this)">21:05:39</span>                    devn </span><span>I was surprised, but I guess after thinking about it, it doesn&apos;t really matter which of the facts is retracted.</span></div><div id="t1455829542000023" t="2016-02-18 21:05:42 wparker Oh, I think I see"><a href="#t1455829542000023" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-02-18</span> <span class="t" onclick="H(this)">21:05:42</span>                 wparker </span><span>Oh, I think I see</span></div><div id="t1455829563000024" t="2016-02-18 21:06:03 wparker Yeah, at least for now I think the memory just uses equality and retracts one each time"><a href="#t1455829563000024" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-02-18</span> <span class="t" onclick="H(this)">21:06:03</span>                 wparker </span><span>Yeah, at least for now I think the memory just uses equality and retracts one each time</span></div><div id="t1455829586000025" t="2016-02-18 21:06:26 wparker The key bit of code is the remove-first-of-each calls in the memory"><a href="#t1455829586000025" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-02-18</span> <span class="t" onclick="H(this)">21:06:26</span>                 wparker </span><span>The key bit of code is the remove-first-of-each calls in the memory</span></div><div id="t1455829590000026" t="2016-02-18 21:06:30 wparker https://github.com/rbrush/clara-rules/blob/master/src/main/clojure/clara/rules/memory.cljc"><a href="#t1455829590000026" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-02-18</span> <span class="t" onclick="H(this)">21:06:30</span>                 wparker </span><a href="https://github.com/rbrush/clara-rules/blob/master/src/main/clojure/clara/rules/memory.cljc" target="_blank">https://github.com/rbrush/clara-rules/blob/master/src/main/clojure/clara/rules/memory.cljc</a></div><div id="t1455829608000028" t="2016-02-18 21:06:48 devn I was thinking that you know, under the covers, an instance of  (-&gt; Foo 1)  would have an object ID or something taken into account underneath"><a href="#t1455829608000028" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-02-18</span> <span class="t" onclick="H(this)">21:06:48</span>                    devn </span><span>I was thinking that you know, under the covers, an instance of </span><code>(-&gt; Foo 1)</code><span> would have an object ID or something taken into account underneath</span></div><div id="t1455829618000029" t="2016-02-18 21:06:58 devn but it makes sense that it doesn&apos;t"><a href="#t1455829618000029" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-02-18</span> <span class="t" onclick="H(this)">21:06:58</span>                    devn </span><span>but it makes sense that it doesn&apos;t</span></div><div id="t1455829642000030" t="2016-02-18 21:07:22 wparker Yes, it just uses Clojure equality"><a href="#t1455829642000030" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-02-18</span> <span class="t" onclick="H(this)">21:07:22</span>                 wparker </span><span>Yes, it just uses Clojure equality</span></div><div id="t1455829652000031" t="2016-02-18 21:07:32 devn So, @wparker here&apos;s one more question for you  simple_smile"><a href="#t1455829652000031" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-02-18</span> <span class="t" onclick="H(this)">21:07:32</span>                    devn </span><span>So, @wparker here&apos;s one more question for you </span><b>simple_smile</b></div><div id="t1455829680000032" t="2016-02-18 21:08:00 devn https://github.com/rbrush/clara-rules/pull/164/files#diff-d16f31f970a20e4115932869c9aa825dR310"><a href="#t1455829680000032" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-02-18</span> <span class="t" onclick="H(this)">21:08:00</span>                    devn </span><a href="https://github.com/rbrush/clara-rules/pull/164/files#diff-d16f31f970a20e4115932869c9aa825dR310" target="_blank">https://github.com/rbrush/clara-rules/pull/164/files#diff-d16f31f970a20e4115932869c9aa825dR310</a></div><div id="t1455829690000033" t="2016-02-18 21:08:10 devn Is this actually a good test of truth maintenance in action for a grouping accumulator?"><a href="#t1455829690000033" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-02-18</span> <span class="t" onclick="H(this)">21:08:10</span>                    devn </span><span>Is this actually a good test of truth maintenance in action for a grouping accumulator?</span></div><div id="t1455829707000034" t="2016-02-18 21:08:27 devn Or is it merely testing that top-level  retract  does what it&apos;s supposed to?"><a href="#t1455829707000034" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-02-18</span> <span class="t" onclick="H(this)">21:08:27</span>                    devn </span><span>Or is it merely testing that top-level </span><code>retract</code><span> does what it&apos;s supposed to?</span></div><div id="t1455829965000036" t="2016-02-18 21:12:45 devn @wparker: reading through the issue you filed, and thinking &quot;boy, generative tests in this case would make a lot of sense.&quot;"><a href="#t1455829965000036" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-02-18</span> <span class="t" onclick="H(this)">21:12:45</span>                    devn </span><span>@wparker: reading through the issue you filed, and thinking &quot;boy, generative tests in this case would make a lot of sense.&quot;</span></div><div id="t1455830408000037" t="2016-02-18 21:20:08 wparker I’m not super familiar with how accumulators work in the engine, but one thing to keep in mind there is that reduce-to-accum creates a retraction function"><a href="#t1455830408000037" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-02-18</span> <span class="t" onclick="H(this)">21:20:08</span>                 wparker </span><span>I’m not super familiar with how accumulators work in the engine, but one thing to keep in mind there is that reduce-to-accum creates a retraction function</span></div><div id="t1455830410000038" t="2016-02-18 21:20:10 wparker https://github.com/rbrush/clara-rules/blob/master/src/main/clojure/clara/rules/accumulators.cljc#L91"><a href="#t1455830410000038" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-02-18</span> <span class="t" onclick="H(this)">21:20:10</span>                 wparker </span><a href="https://github.com/rbrush/clara-rules/blob/master/src/main/clojure/clara/rules/accumulators.cljc#L91" target="_blank">https://github.com/rbrush/clara-rules/blob/master/src/main/clojure/clara/rules/accumulators.cljc#L91</a></div><div id="t1455830646000040" t="2016-02-18 21:24:06 wparker Regarding generative tests: that could be helpful, but I haven’t come up with any good ideas on how to make them (I haven’t thought about it that deeply though)."><a href="#t1455830646000040" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-02-18</span> <span class="t" onclick="H(this)">21:24:06</span>                 wparker </span><span>Regarding generative tests: that could be helpful, but I haven’t come up with any good ideas on how to make them (I haven’t thought about it that deeply though).</span></div><div id="t1455834858000041" t="2016-02-18 22:34:18 ryanbrush @wparker @devn A good suite of generative tests would be great, and may have found a number of issues in logical edge cases. This would require generating rules with different criteria and ensuring consistency to really do well, and how to do so doesn&apos;t seem obvious. But I like the thought if anyone wants to play with it."><a href="#t1455834858000041" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-02-18</span> <span class="t" onclick="H(this)">22:34:18</span>               ryanbrush </span><span>@wparker @devn A good suite of generative tests would be great, and may have found a number of issues in logical edge cases. This would require generating rules with different criteria and ensuring consistency to really do well, and how to do so doesn&apos;t seem obvious. But I like the thought if anyone wants to play with it.</span></div><div id="t1455834966000042" t="2016-02-18 22:36:06 ryanbrush As for retraction, Clara used Clojure equality semantics by design. This seems like the least surprising behavior to treat facts as values....just like the number 1 is 1 no matter what its &quot;identity&quot;. Seems like the Clojure way to me, and is analogous to removing an item from a map or set."><a href="#t1455834966000042" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-02-18</span> <span class="t" onclick="H(this)">22:36:06</span>               ryanbrush </span><span>As for retraction, Clara used Clojure equality semantics by design. This seems like the least surprising behavior to treat facts as values....just like the number 1 is 1 no matter what its &quot;identity&quot;. Seems like the Clojure way to me, and is analogous to removing an item from a map or set.</span></div><div id="t1457111106000045" t="2016-03-04 17:05:06 enn I’m running into some behavior that I don’t understand. I have a fact type of which I only ever expect 1 or 0 instances. If the session has 0 instances, I’d like to make a rule which inserts an instance with some reasonable default values. Right now I have this rule:

 (defrule default-event-date
  &quot;If there is no EventDate, create one far in the future.&quot;
  [:not [EventDate]]
  =&gt;
  (clara.rules/insert!
   (r/map-&gt;EventDate {:date (time.coerce/to-date-time &quot;30000&quot;)})))
 

This correctly does not fire if I start the session with an EventDate fact. If I don’t, however,  run-rules  never returns. It seems to just keep firing. I would expect it to fire once."><a href="#t1457111106000045" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-03-04</span> <span class="t" onclick="H(this)">17:05:06</span>                     enn </span><span>I’m running into some behavior that I don’t understand. I have a fact type of which I only ever expect 1 or 0 instances. If the session has 0 instances, I’d like to make a rule which inserts an instance with some reasonable default values. Right now I have this rule:

</span><pre>(defrule default-event-date
  &quot;If there is no EventDate, create one far in the future.&quot;
  [:not [EventDate]]
  =&gt;
  (clara.rules/insert!
   (r/map-&gt;EventDate {:date (time.coerce/to-date-time &quot;30000&quot;)})))
</pre><span>

This correctly does not fire if I start the session with an EventDate fact. If I don’t, however, </span><code>run-rules</code><span> never returns. It seems to just keep firing. I would expect it to fire once.</span></div><div id="t1457111270000046" t="2016-03-04 17:07:50 enn Ah, just found the mailing list thread about this. I guess that the fact gets retracted when the LHS stops being true, which causes it to get re-inserted, which causes the LHS to stop being true, which causes it to get retracted, etc. ad infinitum"><a href="#t1457111270000046" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-03-04</span> <span class="t" onclick="H(this)">17:07:50</span>                     enn </span><span>Ah, just found the mailing list thread about this. I guess that the fact gets retracted when the LHS stops being true, which causes it to get re-inserted, which causes the LHS to stop being true, which causes it to get retracted, etc. ad infinitum</span></div><div id="t1457111869000047" t="2016-03-04 17:17:49 enn The suggestion is to use  insert-unconditional! , but that seems to never fire, even when there are no facts"><a href="#t1457111869000047" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-03-04</span> <span class="t" onclick="H(this)">17:17:49</span>                     enn </span><span>The suggestion is to use </span><code>insert-unconditional!</code><span>, but that seems to never fire, even when there are no facts</span></div><div id="t1457112227000048" t="2016-03-04 17:23:47 ryanbrush @enn Hmm, insert-unconditional! should fire in example above if no EventDate facts are in the working memory when fire-rules is called. It might be worth restarting the REPL in case fact types got reloaded (and rules are looking at a different type). If things are still failing and can be narrowed down to a reproducible test I can take a look."><a href="#t1457112227000048" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-03-04</span> <span class="t" onclick="H(this)">17:23:47</span>               ryanbrush </span><span>@enn Hmm, insert-unconditional! should fire in example above if no EventDate facts are in the working memory when fire-rules is called. It might be worth restarting the REPL in case fact types got reloaded (and rules are looking at a different type). If things are still failing and can be narrowed down to a reproducible test I can take a look.</span></div><div id="t1457112275000049" t="2016-03-04 17:24:35 enn @ryanbrush I was mistaken—it does fire, it just doesn’t show up in  explain-activations . Is that expected?"><a href="#t1457112275000049" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-03-04</span> <span class="t" onclick="H(this)">17:24:35</span>                     enn </span><span>@ryanbrush I was mistaken—it does fire, it just doesn’t show up in </span><code>explain-activations</code><span>. Is that expected?</span></div><div id="t1457112773000051" t="2016-03-04 17:32:53 ryanbrush @enn So explain-activations uses the truth maintenance facility to figure out what is supporting the fact, which wouldn&apos;t be used in an unconditional insert. I think one could argue the fact that unconditional inserts aren&apos;t seen here is a bug, but there are tradeoffs there. Another use case for unconditional insert is for performance-critical edge cases where users don&apos;t want to pay the accounting cost of tracking truth and activation explanation...which we couldn&apos;t offer if we tracked truth maintenance/explain-activations for unconditional inserts."><a href="#t1457112773000051" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-03-04</span> <span class="t" onclick="H(this)">17:32:53</span>               ryanbrush </span><span>@enn So explain-activations uses the truth maintenance facility to figure out what is supporting the fact, which wouldn&apos;t be used in an unconditional insert. I think one could argue the fact that unconditional inserts aren&apos;t seen here is a bug, but there are tradeoffs there. Another use case for unconditional insert is for performance-critical edge cases where users don&apos;t want to pay the accounting cost of tracking truth and activation explanation...which we couldn&apos;t offer if we tracked truth maintenance/explain-activations for unconditional inserts.</span></div><div id="t1457112854000052" t="2016-03-04 17:34:14 ryanbrush @enn In short, I&apos;d be open to adding unconditional activations to explain-activations, but I&apos;d want to consider the tradeoffs and make sure our performance-critical use cases (some inserting more then 100,000 facts) have a path forward as well."><a href="#t1457112854000052" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-03-04</span> <span class="t" onclick="H(this)">17:34:14</span>               ryanbrush </span><span>@enn In short, I&apos;d be open to adding unconditional activations to explain-activations, but I&apos;d want to consider the tradeoffs and make sure our performance-critical use cases (some inserting more then 100,000 facts) have a path forward as well.</span></div><div id="t1457112989000053" t="2016-03-04 17:36:29 ryanbrush @enn As for the original problem of an infinite looping rule, this comes up enough that I think we need a better way to expose and explain it to the user. I&apos;ve seen other engines limit the number of recursive activations to a few thousand and throw an exception with context to explain where the failure is coming from. Tempted to add that to Clara as well."><a href="#t1457112989000053" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-03-04</span> <span class="t" onclick="H(this)">17:36:29</span>               ryanbrush </span><span>@enn As for the original problem of an infinite looping rule, this comes up enough that I think we need a better way to expose and explain it to the user. I&apos;ve seen other engines limit the number of recursive activations to a few thousand and throw an exception with context to explain where the failure is coming from. Tempted to add that to Clara as well.</span></div><div id="t1457113364000054" t="2016-03-04 17:42:44 enn @ryanbrush: thanks for the explanation. That makes sense. I was just using explain-activations as a debugging tool, so now that I know it has that limitation, it’s not a problem that it’s not showing up."><a href="#t1457113364000054" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-03-04</span> <span class="t" onclick="H(this)">17:42:44</span>                     enn </span><span>@ryanbrush: thanks for the explanation. That makes sense. I was just using explain-activations as a debugging tool, so now that I know it has that limitation, it’s not a problem that it’s not showing up.</span></div><div id="t1457113684000055" t="2016-03-04 17:48:04 ryanbrush @enn Fair enough. I mostly want to extinguish any sort of surprising behavior, even if it is for debugging purposes. I&apos;ll think about it some more but won&apos;t make any immediate changes here."><a href="#t1457113684000055" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-03-04</span> <span class="t" onclick="H(this)">17:48:04</span>               ryanbrush </span><span>@enn Fair enough. I mostly want to extinguish any sort of surprising behavior, even if it is for debugging purposes. I&apos;ll think about it some more but won&apos;t make any immediate changes here.</span></div><div id="t1457471243000056" t="2016-03-08 21:07:23 devn Howdy @ryanbrush -- 2 selfish questions for you:
1) Any guess on when 0.11 might make it out into the wild?
2) Any chance of the new work you began on clara-tools continuing?"><a href="#t1457471243000056" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-03-08</span> <span class="t" onclick="H(this)">21:07:23</span>                    devn </span><span>Howdy @ryanbrush -- 2 selfish questions for you:
1) Any guess on when 0.11 might make it out into the wild?
2) Any chance of the new work you began on clara-tools continuing?</span></div><div id="t1457498470000057" t="2016-03-09 04:41:10 ryanbrush Hey @devn, there is one more fix I wanted to get into 0.11, but I can see it dropping next week. As for clara-tools, I&apos;m not sure when I&apos;ll get back to it. We found a simpler way to solve some of the internal problems I had been enhancing clara-tools for and other demands are taking most of my time. I&apos;d be happy to collaborate with anyone interested in moving it forward and hope to work more on it starting in mid April, but can&apos;t promise much more than that."><a href="#t1457498470000057" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-03-09</span> <span class="t" onclick="H(this)">04:41:10</span>               ryanbrush </span><span>Hey @devn, there is one more fix I wanted to get into 0.11, but I can see it dropping next week. As for clara-tools, I&apos;m not sure when I&apos;ll get back to it. We found a simpler way to solve some of the internal problems I had been enhancing clara-tools for and other demands are taking most of my time. I&apos;d be happy to collaborate with anyone interested in moving it forward and hope to work more on it starting in mid April, but can&apos;t promise much more than that.</span></div><div id="t1457980319000002" t="2016-03-14 18:31:59 kahunamoore @ryanbrush: @devn I’ve started building an IDE-like environment (called Clarity) for clara and have been studying clara-tools. However, I’m looking to take a different approach. Two requirements I would like to meet are integration with Cursive/Intelli-J and as a plugin for other editors"><a href="#t1457980319000002" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-03-14</span> <span class="t" onclick="H(this)">18:31:59</span>             kahunamoore </span><span>@ryanbrush: @devn I’ve started building an IDE-like environment (called Clarity) for clara and have been studying clara-tools. However, I’m looking to take a different approach. Two requirements I would like to meet are integration with Cursive/Intelli-J and as a plugin for other editors</span></div><div id="t1457980439000003" t="2016-03-14 18:33:59 kahunamoore opps… hit return before I was done editing. I started it as a plugin for lighttable but abandoned that when the project team abandoned LT. I might revisit it at some point but right now I’m working on the Cursive approach first. The other approach is based on a standalone Electron/Atom editor."><a href="#t1457980439000003" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-03-14</span> <span class="t" onclick="H(this)">18:33:59</span>             kahunamoore </span><span>opps… hit return before I was done editing. I started it as a plugin for lighttable but abandoned that when the project team abandoned LT. I might revisit it at some point but right now I’m working on the Cursive approach first. The other approach is based on a standalone Electron/Atom editor.</span></div><div id="t1457980624000004" t="2016-03-14 18:37:04 kahunamoore A lot of code from clara-tools can be used to inform these other platforms. I’m not sure using an HTTP server will be the approach I settle on. I’m trying to leverage the existing JDI infrastructure. While it is much more difficult, long term I think it will provide much better integration… TBD."><a href="#t1457980624000004" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-03-14</span> <span class="t" onclick="H(this)">18:37:04</span>             kahunamoore </span><span>A lot of code from clara-tools can be used to inform these other platforms. I’m not sure using an HTTP server will be the approach I settle on. I’m trying to leverage the existing JDI infrastructure. While it is much more difficult, long term I think it will provide much better integration… TBD.</span></div><div id="t1458008052000005" t="2016-03-15 02:14:12 ryanbrush @kahunamoore: sounds cool! IDE integration would be awesome. There might be some code that could be reused or refactored out of clara-tools for this, although I agree having an HTTP server in the middle makes less sense for what you describe."><a href="#t1458008052000005" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-03-15</span> <span class="t" onclick="H(this)">02:14:12</span>               ryanbrush </span><span>@kahunamoore: sounds cool! IDE integration would be awesome. There might be some code that could be reused or refactored out of clara-tools for this, although I agree having an HTTP server in the middle makes less sense for what you describe.</span></div><div id="t1458008567000006" t="2016-03-15 02:22:47 kahunamoore I really like what you did with clara-tools -  very compact and clean code. The HTTP server was clearly the right call given the requirements (I’m guessing a problem at work and needing visibility…)  I’m hoping to write as little code as possible but still integrate with what people are already doing (e.g. IntelliJ debugger, repl). I want to create some visualizations for the debugger, some utilities for the repl, etc. The logic -&gt; graph and session -&gt; graph functions are very helpful."><a href="#t1458008567000006" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-03-15</span> <span class="t" onclick="H(this)">02:22:47</span>             kahunamoore </span><span>I really like what you did with clara-tools -  very compact and clean code. The HTTP server was clearly the right call given the requirements (I’m guessing a problem at work and needing visibility…)  I’m hoping to write as little code as possible but still integrate with what people are already doing (e.g. IntelliJ debugger, repl). I want to create some visualizations for the debugger, some utilities for the repl, etc. The logic -&gt; graph and session -&gt; graph functions are very helpful.</span></div><div id="t1458312558000008" t="2016-03-18 14:49:18 ryanbrush Clara 0.11.0 is up on Clojars. It&apos;s a smaller release than 0.10, but has a couple bug fixes that are worth picking up if nothing else. Release notes here:  https://github.com/rbrush/clara-rules/blob/master/CHANGELOG.md#0110"><a href="#t1458312558000008" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-03-18</span> <span class="t" onclick="H(this)">14:49:18</span>               ryanbrush </span><span>Clara 0.11.0 is up on Clojars. It&apos;s a smaller release than 0.10, but has a couple bug fixes that are worth picking up if nothing else. Release notes here: </span><a href="https://github.com/rbrush/clara-rules/blob/master/CHANGELOG.md#0110" target="_blank">https://github.com/rbrush/clara-rules/blob/master/CHANGELOG.md#0110</a></div><div id="t1458593590000010" t="2016-03-21 20:53:10 devn We may have been experiencing one of those bugs and calling our behavior good"><a href="#t1458593590000010" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-03-21</span> <span class="t" onclick="H(this)">20:53:10</span>                    devn </span><span>We may have been experiencing one of those bugs and calling our behavior good</span></div><div id="t1458593632000011" t="2016-03-21 20:53:52 devn I suppose it&apos;s also possible there&apos;s a regression, but we&apos;re looking into it now. Will let you know what we find"><a href="#t1458593632000011" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-03-21</span> <span class="t" onclick="H(this)">20:53:52</span>                    devn </span><span>I suppose it&apos;s also possible there&apos;s a regression, but we&apos;re looking into it now. Will let you know what we find</span></div><div id="t1458593645000012" t="2016-03-21 20:54:05 devn @ryanbrush: ^"><a href="#t1458593645000012" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-03-21</span> <span class="t" onclick="H(this)">20:54:05</span>                    devn </span><span>@ryanbrush: ^</span></div><div id="t1458593741000013" t="2016-03-21 20:55:41 devn We do not use insert unconditional or salience "><a href="#t1458593741000013" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-03-21</span> <span class="t" onclick="H(this)">20:55:41</span>                    devn </span><span>We do not use insert unconditional or salience </span></div><div id="t1458593761000014" t="2016-03-21 20:56:01 devn We are using the deprecated accumulator function though."><a href="#t1458593761000014" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-03-21</span> <span class="t" onclick="H(this)">20:56:01</span>                    devn </span><span>We are using the deprecated accumulator function though.</span></div><div id="t1458598510000015" t="2016-03-21 22:15:10 devn Looks like #171 is what broke us."><a href="#t1458598510000015" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-03-21</span> <span class="t" onclick="H(this)">22:15:10</span>                    devn </span><span>Looks like #171 is what broke us.</span></div><div id="t1458598552000016" t="2016-03-21 22:15:52 devn We have a couple instances of the RHS using both a retract!, and an insert!"><a href="#t1458598552000016" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-03-21</span> <span class="t" onclick="H(this)">22:15:52</span>                    devn </span><span>We have a couple instances of the RHS using both a retract!, and an insert!</span></div><div id="t1458600442000017" t="2016-03-21 22:47:22 ryanbrush @devn Traveling right now so can&apos;t look in depth, but using retract with truth maintenance can create difficult to reason about situations in any rule engine. If there is some test case that does not behave as one would expect I&apos;ll take a look at it."><a href="#t1458600442000017" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-03-21</span> <span class="t" onclick="H(this)">22:47:22</span>               ryanbrush </span><span>@devn Traveling right now so can&apos;t look in depth, but using retract with truth maintenance can create difficult to reason about situations in any rule engine. If there is some test case that does not behave as one would expect I&apos;ll take a look at it.</span></div><div id="t1458601382000018" t="2016-03-21 23:03:02 devn after thinking about it for a little bit, i see why this is broken."><a href="#t1458601382000018" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-03-21</span> <span class="t" onclick="H(this)">23:03:02</span>                    devn </span><span>after thinking about it for a little bit, i see why this is broken.</span></div><div id="t1458601388000019" t="2016-03-21 23:03:08 devn clara is doing it&apos;s job correctly."><a href="#t1458601388000019" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-03-21</span> <span class="t" onclick="H(this)">23:03:08</span>                    devn </span><span>clara is doing it&apos;s job correctly.</span></div><div id="t1458606099000020" t="2016-03-22 00:21:39 devn I guess I&apos;m still interested in understanding exactly what&apos;s going on here"><a href="#t1458606099000020" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-03-22</span> <span class="t" onclick="H(this)">00:21:39</span>                    devn </span><span>I guess I&apos;m still interested in understanding exactly what&apos;s going on here</span></div><div id="t1458658494000021" t="2016-03-22 14:54:54 mikerod devn: did you have an example of what broke somewhere?"><a href="#t1458658494000021" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-03-22</span> <span class="t" onclick="H(this)">14:54:54</span>                 mikerod </span><span>devn: did you have an example of what broke somewhere?</span></div><div id="t1458658501000022" t="2016-03-22 14:55:01 mikerod is it the same as  https://groups.google.com/forum/#!topic/clara-rules/F-8vcsZC2i4  ?"><a href="#t1458658501000022" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-03-22</span> <span class="t" onclick="H(this)">14:55:01</span>                 mikerod </span><span>is it the same as </span><a href="https://groups.google.com/forum/#!topic/clara-rules/F-8vcsZC2i4" target="_blank">https://groups.google.com/forum/#!topic/clara-rules/F-8vcsZC2i4</a><span> ?</span></div><div id="t1458666165000023" t="2016-03-22 17:02:45 devn @mikerod: yes"><a href="#t1458666165000023" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-03-22</span> <span class="t" onclick="H(this)">17:02:45</span>                    devn </span><span>@mikerod: yes</span></div><div id="t1458666180000024" t="2016-03-22 17:03:00 devn That&apos;s the situation, which I guess makes good sense to me."><a href="#t1458666180000024" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-03-22</span> <span class="t" onclick="H(this)">17:03:00</span>                    devn </span><span>That&apos;s the situation, which I guess makes good sense to me.</span></div><div id="t1458666219000025" t="2016-03-22 17:03:39 devn We don&apos;t need to retract here. I pushed back against the use of it, but it worked, until we bumped to 0.11.0 of course  simple_smile"><a href="#t1458666219000025" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-03-22</span> <span class="t" onclick="H(this)">17:03:39</span>                    devn </span><span>We don&apos;t need to retract here. I pushed back against the use of it, but it worked, until we bumped to 0.11.0 of course </span><b>simple_smile</b></div><div id="t1458678087000026" t="2016-03-22 20:21:27 mikerod devn: yeah, in that particular scenario the previous behavior was questionable"><a href="#t1458678087000026" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-03-22</span> <span class="t" onclick="H(this)">20:21:27</span>                 mikerod </span><span>devn: yeah, in that particular scenario the previous behavior was questionable</span></div><div id="t1458678119000027" t="2016-03-22 20:21:59 mikerod The RHS is retracting the facts that are supporting the truth of the rule in general"><a href="#t1458678119000027" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-03-22</span> <span class="t" onclick="H(this)">20:21:59</span>                 mikerod </span><span>The RHS is retracting the facts that are supporting the truth of the rule in general</span></div><div id="t1458678168000028" t="2016-03-22 20:22:48 mikerod This goes against the concept of logical truth maintenance of inserted facts.  Retracts will often lead you into bad situations when it comes to truth maintenance.  In this particular scenario, the rule shouldn&apos;t insert anything because anything it inserts loses its logical support immediately, due to the retract of all the recommendations."><a href="#t1458678168000028" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-03-22</span> <span class="t" onclick="H(this)">20:22:48</span>                 mikerod </span><span>This goes against the concept of logical truth maintenance of inserted facts.  Retracts will often lead you into bad situations when it comes to truth maintenance.  In this particular scenario, the rule shouldn&apos;t insert anything because anything it inserts loses its logical support immediately, due to the retract of all the recommendations.</span></div><div id="t1458678192000029" t="2016-03-22 20:23:12 mikerod Looks like Will put more details on the Google groups though."><a href="#t1458678192000029" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-03-22</span> <span class="t" onclick="H(this)">20:23:12</span>                 mikerod </span><span>Looks like Will put more details on the Google groups though.</span></div><div id="t1458678257000030" t="2016-03-22 20:24:17 mikerod In our use-cases, we avoid retracts pretty much completely.  We like to rely on the logical truth maintenance of inserts to do any &quot;retracts&quot; for us.  It does involve adding new fact types occasionally, which Clara&apos;s default is via :type metadata or the Java class hierarchy (on Java side) or JS hierarchy (on JS side)"><a href="#t1458678257000030" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-03-22</span> <span class="t" onclick="H(this)">20:24:17</span>                 mikerod </span><span>In our use-cases, we avoid retracts pretty much completely.  We like to rely on the logical truth maintenance of inserts to do any &quot;retracts&quot; for us.  It does involve adding new fact types occasionally, which Clara&apos;s default is via :type metadata or the Java class hierarchy (on Java side) or JS hierarchy (on JS side)</span></div><div id="t1458741699000032" t="2016-03-23 14:01:39 ryanbrush Hey all, still out of town but I think @mikerod&apos;s answer here and @wparker&apos;s answer in the forum are on target. I kind of regret adding retract! at all since it&apos;s such an easy way to shoot oneself in the foot. (This isn&apos;t the first time it has caused confusion.) I&apos;m tempted to deprecate it, or move it into a specialized package to make it clear. I don&apos;t think there is a great way to &quot;fix&quot; retract! when interacting with truth maintenance, since it&apos;s semantics conflict with what the engine does. Looking back on it, it feels like it&apos;s the equivalent of a GOTO statement for expert systems."><a href="#t1458741699000032" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-03-23</span> <span class="t" onclick="H(this)">14:01:39</span>               ryanbrush </span><span>Hey all, still out of town but I think @mikerod&apos;s answer here and @wparker&apos;s answer in the forum are on target. I kind of regret adding retract! at all since it&apos;s such an easy way to shoot oneself in the foot. (This isn&apos;t the first time it has caused confusion.) I&apos;m tempted to deprecate it, or move it into a specialized package to make it clear. I don&apos;t think there is a great way to &quot;fix&quot; retract! when interacting with truth maintenance, since it&apos;s semantics conflict with what the engine does. Looking back on it, it feels like it&apos;s the equivalent of a GOTO statement for expert systems.</span></div><div id="t1458747698000033" t="2016-03-23 15:41:38 devn 👍"><a href="#t1458747698000033" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-03-23</span> <span class="t" onclick="H(this)">15:41:38</span>                    devn </span><b>👍</b></div><div id="t1458762891000034" t="2016-03-23 19:54:51 mikerod so it is &quot;retract! considered harmful&quot;"><a href="#t1458762891000034" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-03-23</span> <span class="t" onclick="H(this)">19:54:51</span>                 mikerod </span><span>so it is &quot;retract! considered harmful&quot;</span></div><div id="t1458762907000035" t="2016-03-23 19:55:07 mikerod maybe just a part of Clara docs that gives that big warning"><a href="#t1458762907000035" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-03-23</span> <span class="t" onclick="H(this)">19:55:07</span>                 mikerod </span><span>maybe just a part of Clara docs that gives that big warning</span></div><div id="t1460145526000040" t="2016-04-08 19:58:46 devn @mikerod I am behind on the ML discussion, but I think there was some discussion of removing it altogether. Frankly, I&apos;m really happy to hear that."><a href="#t1460145526000040" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-04-08</span> <span class="t" onclick="H(this)">19:58:46</span>                    devn </span><span>@mikerod I am behind on the ML discussion, but I think there was some discussion of removing it altogether. Frankly, I&apos;m really happy to hear that.</span></div><div id="t1460152736000041" t="2016-04-08 21:58:56 mikerod @devn perhaps.  I think there may be valid usages, but they need to be constrained and perhaps we could see about reporting errors on the cases that have vague or ambiguous semantics"><a href="#t1460152736000041" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-04-08</span> <span class="t" onclick="H(this)">21:58:56</span>                 mikerod </span><span>@devn perhaps.  I think there may be valid usages, but they need to be constrained and perhaps we could see about reporting errors on the cases that have vague or ambiguous semantics</span></div><div id="t1460645810000043" t="2016-04-14 14:56:50 saicheong I have just started learning clara. In clara-examples, the facts that are inserted into working memory are typically record type."><a href="#t1460645810000043" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-04-14</span> <span class="t" onclick="H(this)">14:56:50</span>               saicheong </span><span>I have just started learning clara. In clara-examples, the facts that are inserted into working memory are typically record type.</span></div><div id="t1460645851000044" t="2016-04-14 14:57:31 saicheong I wonder if &apos;primitive&apos; data can also be inserted - like Strings or Keywords."><a href="#t1460645851000044" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-04-14</span> <span class="t" onclick="H(this)">14:57:31</span>               saicheong </span><span>I wonder if &apos;primitive&apos; data can also be inserted - like Strings or Keywords.</span></div><div id="t1460646054000045" t="2016-04-14 15:00:54 saicheong How do we write the condition expression to match a keyword or a string?"><a href="#t1460646054000045" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-04-14</span> <span class="t" onclick="H(this)">15:00:54</span>               saicheong </span><span>How do we write the condition expression to match a keyword or a string?</span></div><div id="t1460649895000046" t="2016-04-14 16:04:55 devn @saicheong:  https://github.com/rbrush/clara-rules/wiki/Guide#fact-types"><a href="#t1460649895000046" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-04-14</span> <span class="t" onclick="H(this)">16:04:55</span>                    devn </span><span>@saicheong: </span><a href="https://github.com/rbrush/clara-rules/wiki/Guide#fact-types" target="_blank">https://github.com/rbrush/clara-rules/wiki/Guide#fact-types</a></div><div id="t1460658917000048" t="2016-04-14 18:35:17 ryanbrush @saicheong: By default you can any type known to Clojure&apos;s type function, which includes the Java class hierarchy (including Strings, or clojure.lang.Keyword, but that&apos;s not something I&apos;ve done.) If you need something more sophisticated, the link @devn posted is a good reference."><a href="#t1460658917000048" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-04-14</span> <span class="t" onclick="H(this)">18:35:17</span>               ryanbrush </span><span>@saicheong: By default you can any type known to Clojure&apos;s type function, which includes the Java class hierarchy (including Strings, or clojure.lang.Keyword, but that&apos;s not something I&apos;ve done.) If you need something more sophisticated, the link @devn posted is a good reference.</span></div><div id="t1460676294000051" t="2016-04-14 23:24:54 saicheong Say I have a rule that inserts a keyword :exceed-cap. Now I need to this keyword to match other rules. Will this expression in a rule match the keyword?:
[clojure.lang.Keyword (= :exceed-cap)]"><a href="#t1460676294000051" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-04-14</span> <span class="t" onclick="H(this)">23:24:54</span>               saicheong </span><span>Say I have a rule that inserts a keyword :exceed-cap. Now I need to this keyword to match other rules. Will this expression in a rule match the keyword?:
[clojure.lang.Keyword (= :exceed-cap)]</span></div><div id="t1460680717000052" t="2016-04-15 00:38:37 devn @saicheong: I haven&apos;t done what you&apos;re describing. You could try it but something tells me that won&apos;t work."><a href="#t1460680717000052" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-04-15</span> <span class="t" onclick="H(this)">00:38:37</span>                    devn </span><span>@saicheong: I haven&apos;t done what you&apos;re describing. You could try it but something tells me that won&apos;t work.</span></div><div id="t1460680747000053" t="2016-04-15 00:39:07 devn I am heading out otherwise I&apos;d help you out."><a href="#t1460680747000053" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-04-15</span> <span class="t" onclick="H(this)">00:39:07</span>                    devn </span><span>I am heading out otherwise I&apos;d help you out.</span></div><div id="t1460688693000054" t="2016-04-15 02:51:33 wparker @saicheong: I believe the problem with the constraint you have there is that you’re calling = with one argument, which always returns false.  The symbol “this” in rule constraints is bound to the fact under consideration; I believe you need to test that “this” is equal to :exceed-cap.  Example gist:  https://gist.github.com/WilliamParker/9cafbe73b2c3b99153fd3fcfc8daa4c3"><a href="#t1460688693000054" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-04-15</span> <span class="t" onclick="H(this)">02:51:33</span>                 wparker </span><span>@saicheong: I believe the problem with the constraint you have there is that you’re calling = with one argument, which always returns false.  The symbol “this” in rule constraints is bound to the fact under consideration; I believe you need to test that “this” is equal to :exceed-cap.  Example gist: </span><a href="https://gist.github.com/WilliamParker/9cafbe73b2c3b99153fd3fcfc8daa4c3" target="_blank">https://gist.github.com/WilliamParker/9cafbe73b2c3b99153fd3fcfc8daa4c3</a></div><div id="t1460689230000055" t="2016-04-15 03:00:30 wparker One thing to keep in mind (without knowing anything about your use-case of course) is that one of the major optimizations of Clara (and the Rete algorithm it is based on more generally) is only testing facts against conditions that their type allows them to match.  That is, if you inserted something that isn’t a Keyword into the example in the gist above, that equality check wouldn’t ever be tried.  Checking equality against a keyword should be very, very fast though, just something to be aware of more generally.  Of course, if your use case is small enough even thinking about that could be premature optimization."><a href="#t1460689230000055" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-04-15</span> <span class="t" onclick="H(this)">03:00:30</span>                 wparker </span><span>One thing to keep in mind (without knowing anything about your use-case of course) is that one of the major optimizations of Clara (and the Rete algorithm it is based on more generally) is only testing facts against conditions that their type allows them to match.  That is, if you inserted something that isn’t a Keyword into the example in the gist above, that equality check wouldn’t ever be tried.  Checking equality against a keyword should be very, very fast though, just something to be aware of more generally.  Of course, if your use case is small enough even thinking about that could be premature optimization.</span></div><div id="t1460689246000056" t="2016-04-15 03:00:46 saicheong @devn: Thanks. I&apos;ll try it out when I get some time. "><a href="#t1460689246000056" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-04-15</span> <span class="t" onclick="H(this)">03:00:46</span>               saicheong </span><span>@devn: Thanks. I&apos;ll try it out when I get some time. </span></div><div id="t1460689618000057" t="2016-04-15 03:06:58 saicheong @wparker: thanks for the tip on using &apos;this&apos; in the expression. I&apos;ll try that out too. "><a href="#t1460689618000057" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-04-15</span> <span class="t" onclick="H(this)">03:06:58</span>               saicheong </span><span>@wparker: thanks for the tip on using &apos;this&apos; in the expression. I&apos;ll try that out too. </span></div><div id="t1461598992000003" t="2016-04-25 15:43:12 ryanbrush clara-rules 0.11.1 is up on Clojars. It&apos;s a fix release with some nice performance optimizations from @mikerod. Details in the change log:  https://github.com/rbrush/clara-rules/blob/master/CHANGELOG.md#0111"><a href="#t1461598992000003" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-04-25</span> <span class="t" onclick="H(this)">15:43:12</span>               ryanbrush </span><span>clara-rules 0.11.1 is up on Clojars. It&apos;s a fix release with some nice performance optimizations from @mikerod. Details in the change log: </span><a href="https://github.com/rbrush/clara-rules/blob/master/CHANGELOG.md#0111" target="_blank">https://github.com/rbrush/clara-rules/blob/master/CHANGELOG.md#0111</a></div><div id="t1461778412000005" t="2016-04-27 17:33:32 devn Huzzah"><a href="#t1461778412000005" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-04-27</span> <span class="t" onclick="H(this)">17:33:32</span>                    devn </span><span>Huzzah</span></div><div id="t1461787141000006" t="2016-04-27 19:59:01 mikerod devn: Is that a delayed celebration of the 0.11.1 release?"><a href="#t1461787141000006" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-04-27</span> <span class="t" onclick="H(this)">19:59:01</span>                 mikerod </span><span>devn: Is that a delayed celebration of the 0.11.1 release?</span></div><div id="t1461787143000007" t="2016-04-27 19:59:03 mikerod 😛"><a href="#t1461787143000007" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-04-27</span> <span class="t" onclick="H(this)">19:59:03</span>                 mikerod </span><b>😛</b></div><div id="t1461787156000008" t="2016-04-27 19:59:16 devn @mikerod: yes  simple_smile"><a href="#t1461787156000008" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-04-27</span> <span class="t" onclick="H(this)">19:59:16</span>                    devn </span><span>@mikerod: yes </span><b>simple_smile</b></div><div id="t1461787188000009" t="2016-04-27 19:59:48 mikerod Yeah, try it out.  Report if you notice anything - good or bad."><a href="#t1461787188000009" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-04-27</span> <span class="t" onclick="H(this)">19:59:48</span>                 mikerod </span><span>Yeah, try it out.  Report if you notice anything - good or bad.</span></div><div id="t1461787206000010" t="2016-04-27 20:00:06 mikerod In our case, it actually had a few fairly subtle changes that did help our performance"><a href="#t1461787206000010" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-04-27</span> <span class="t" onclick="H(this)">20:00:06</span>                 mikerod </span><span>In our case, it actually had a few fairly subtle changes that did help our performance</span></div><div id="t1461787209000011" t="2016-04-27 20:00:09 devn will do, we&apos;re picking up development on the rules engine side of things in a week or so"><a href="#t1461787209000011" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-04-27</span> <span class="t" onclick="H(this)">20:00:09</span>                    devn </span><span>will do, we&apos;re picking up development on the rules engine side of things in a week or so</span></div><div id="t1461787217000012" t="2016-04-27 20:00:17 devn but i can at least bump the version and run tests"><a href="#t1461787217000012" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-04-27</span> <span class="t" onclick="H(this)">20:00:17</span>                    devn </span><span>but i can at least bump the version and run tests</span></div><div id="t1461787220000013" t="2016-04-27 20:00:20 devn and see how things shake out"><a href="#t1461787220000013" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-04-27</span> <span class="t" onclick="H(this)">20:00:20</span>                    devn </span><span>and see how things shake out</span></div><div id="t1461787228000014" t="2016-04-27 20:00:28 mikerod Cool"><a href="#t1461787228000014" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-04-27</span> <span class="t" onclick="H(this)">20:00:28</span>                 mikerod </span><span>Cool</span></div><div id="t1461787241000015" t="2016-04-27 20:00:41 devn thanks for all of your work"><a href="#t1461787241000015" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-04-27</span> <span class="t" onclick="H(this)">20:00:41</span>                    devn </span><span>thanks for all of your work</span></div><div id="t1461787266000016" t="2016-04-27 20:01:06 mikerod No big deal.  We are getting a lot of good use out of Clara so far and it is fun to work on."><a href="#t1461787266000016" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-04-27</span> <span class="t" onclick="H(this)">20:01:06</span>                 mikerod </span><span>No big deal.  We are getting a lot of good use out of Clara so far and it is fun to work on.</span></div><div id="t1461787367000017" t="2016-04-27 20:02:47 mikerod Thanks for your feedback and contributions to it too!"><a href="#t1461787367000017" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-04-27</span> <span class="t" onclick="H(this)">20:02:47</span>                 mikerod </span><span>Thanks for your feedback and contributions to it too!</span></div><div id="t1465231096000002" t="2016-06-06 16:38:16 devn Hello friends"><a href="#t1465231096000002" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-06</span> <span class="t" onclick="H(this)">16:38:16</span>                    devn </span><span>Hello friends</span></div><div id="t1465231211000003" t="2016-06-06 16:40:11 devn Question for you...

Provided:
 (defrecord DatedFact [date whatever])
(defrecord LatestFact [date whatever])

(def latest
  &quot;Accumulator for finding the maximum value of a :date field.&quot;
  (clara.acc/max (comp time.coerce/to-long :date)
                 :returns-fact true))

(clara/defrule simple-latest-rule
  [?result &lt;- latest :from [DatedFact (= ?date date)]]
  =&gt;
  (clara.rules/insert! (map-&gt;LatestFact ?result)))

(clara/defquery query-latest [] [?latest &lt;- LatestFact])
"><a href="#t1465231211000003" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-06</span> <span class="t" onclick="H(this)">16:40:11</span>                    devn </span><span>Question for you...

Provided:
</span><pre>(defrecord DatedFact [date whatever])
(defrecord LatestFact [date whatever])

(def latest
  &quot;Accumulator for finding the maximum value of a :date field.&quot;
  (clara.acc/max (comp time.coerce/to-long :date)
                 :returns-fact true))

(clara/defrule simple-latest-rule
  [?result &lt;- latest :from [DatedFact (= ?date date)]]
  =&gt;
  (clara.rules/insert! (map-&gt;LatestFact ?result)))

(clara/defquery query-latest [] [?latest &lt;- LatestFact])
</pre></div><div id="t1465231255000004" t="2016-06-06 16:40:55 devn This will  insert!  for all  DatedFacts ."><a href="#t1465231255000004" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-06</span> <span class="t" onclick="H(this)">16:40:55</span>                    devn </span><span>This will </span><code>insert!</code><span> for all </span><code>DatedFacts</code><span>.</span></div><div id="t1465231348000006" t="2016-06-06 16:42:28 devn Without the constraint on  (= ?date date) , it will fire only once."><a href="#t1465231348000006" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-06</span> <span class="t" onclick="H(this)">16:42:28</span>                    devn </span><span>Without the constraint on </span><code>(= ?date date)</code><span>, it will fire only once.</span></div><div id="t1465231437000008" t="2016-06-06 16:43:57 devn I understand why this is so, but I guess I&apos;m interested to know what you think about how you&apos;d prevent this sort of thing from happening by rule authors."><a href="#t1465231437000008" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-06</span> <span class="t" onclick="H(this)">16:43:57</span>                    devn </span><span>I understand why this is so, but I guess I&apos;m interested to know what you think about how you&apos;d prevent this sort of thing from happening by rule authors.</span></div><div id="t1465232713000009" t="2016-06-06 17:05:13 devn On second thought, I could use a good plain english explanation of why this is the case."><a href="#t1465232713000009" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-06</span> <span class="t" onclick="H(this)">17:05:13</span>                    devn </span><span>On second thought, I could use a good plain english explanation of why this is the case.</span></div><div id="t1465319844000010" t="2016-06-07 17:17:24 ryanbrush Hey @devn, a good rule of thumb is that Clara will have one activation for each unique combination of bound variables. So when you remove the ?date binding in that accumulator, it just grabs the latest for all records and fires once. If you add a binding in an accumulator, it accumulates separately for each binding (?date in this case) and fires once per unique binding."><a href="#t1465319844000010" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-07</span> <span class="t" onclick="H(this)">17:17:24</span>               ryanbrush </span><span>Hey @devn, a good rule of thumb is that Clara will have one activation for each unique combination of bound variables. So when you remove the ?date binding in that accumulator, it just grabs the latest for all records and fires once. If you add a binding in an accumulator, it accumulates separately for each binding (?date in this case) and fires once per unique binding.</span></div><div id="t1465320045000011" t="2016-06-07 17:20:45 devn Thanks for that explanation. I was thinking about the binding on ?date being a sort of bucketing/grouping operation, so for each bucket of unique ?date values, capture the greatest date."><a href="#t1465320045000011" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-07</span> <span class="t" onclick="H(this)">17:20:45</span>                    devn </span><span>Thanks for that explanation. I was thinking about the binding on ?date being a sort of bucketing/grouping operation, so for each bucket of unique ?date values, capture the greatest date.</span></div><div id="t1465320122000012" t="2016-06-07 17:22:02 devn using ?date there doesn&apos;t make much sense from a practical standpoint, since the accumulator pulls :date anyhow"><a href="#t1465320122000012" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-07</span> <span class="t" onclick="H(this)">17:22:02</span>                    devn </span><span>using ?date there doesn&apos;t make much sense from a practical standpoint, since the accumulator pulls :date anyhow</span></div><div id="t1465320128000013" t="2016-06-07 17:22:08 ryanbrush Yeah, that&apos;s he idea."><a href="#t1465320128000013" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-07</span> <span class="t" onclick="H(this)">17:22:08</span>               ryanbrush </span><span>Yeah, that&apos;s he idea.</span></div><div id="t1465320200000014" t="2016-06-07 17:23:20 devn @ryanbrush: a loaded question: any thoughts on multiple sessions vs a single, shared session?"><a href="#t1465320200000014" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-07</span> <span class="t" onclick="H(this)">17:23:20</span>                    devn </span><span>@ryanbrush: a loaded question: any thoughts on multiple sessions vs a single, shared session?</span></div><div id="t1465320215000015" t="2016-06-07 17:23:35 ryanbrush If you need richer semantics, you can always access any fields in the resulting accumulated value in the RHS, or even use a custom accumulator. But that depends on the use case"><a href="#t1465320215000015" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-07</span> <span class="t" onclick="H(this)">17:23:35</span>               ryanbrush </span><span>If you need richer semantics, you can always access any fields in the resulting accumulated value in the RHS, or even use a custom accumulator. But that depends on the use case</span></div><div id="t1465320231000016" t="2016-06-07 17:23:51 devn my question is sort of intentionally vague"><a href="#t1465320231000016" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-07</span> <span class="t" onclick="H(this)">17:23:51</span>                    devn </span><span>my question is sort of intentionally vague</span></div><div id="t1465320284000017" t="2016-06-07 17:24:44 devn the big question is: are there common triggers in your mind for when to split out a new session using the results of queries on another session?"><a href="#t1465320284000017" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-07</span> <span class="t" onclick="H(this)">17:24:44</span>                    devn </span><span>the big question is: are there common triggers in your mind for when to split out a new session using the results of queries on another session?</span></div><div id="t1465320313000018" t="2016-06-07 17:25:13 ryanbrush As for a single vs multiple sessions, just depends on what&apos;s easier to work with. We tend to use multiple sessions since there is very little overlap between them so it makes sense to keep separate. But YMMV."><a href="#t1465320313000018" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-07</span> <span class="t" onclick="H(this)">17:25:13</span>               ryanbrush </span><span>As for a single vs multiple sessions, just depends on what&apos;s easier to work with. We tend to use multiple sessions since there is very little overlap between them so it makes sense to keep separate. But YMMV.</span></div><div id="t1465320388000019" t="2016-06-07 17:26:28 ryanbrush But big sessions should perform pretty well, so whatever is simpler seems like a good starting point. We have sessions with 100k records and thousands of rules  easily."><a href="#t1465320388000019" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-07</span> <span class="t" onclick="H(this)">17:26:28</span>               ryanbrush </span><span>But big sessions should perform pretty well, so whatever is simpler seems like a good starting point. We have sessions with 100k records and thousands of rules  easily.</span></div><div id="t1465320436000020" t="2016-06-07 17:27:16 devn thinking out loud: i guess it&apos;s like namespacing or anything else, it&apos;s just that there is a pretty pipeline-ish feel to what we&apos;ve built, and with the number of facts that are inserted for specific rule firings, it seems like there might be some valuable in splitting things out a bit more to make inspection easier"><a href="#t1465320436000020" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-07</span> <span class="t" onclick="H(this)">17:27:16</span>                    devn </span><span>thinking out loud: i guess it&apos;s like namespacing or anything else, it&apos;s just that there is a pretty pipeline-ish feel to what we&apos;ve built, and with the number of facts that are inserted for specific rule firings, it seems like there might be some valuable in splitting things out a bit more to make inspection easier</span></div><div id="t1465320464000021" t="2016-06-07 17:27:44 devn then again, from the standpoint of providing explanations, there&apos;s some overhead associated with passing those facts through to another session"><a href="#t1465320464000021" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-07</span> <span class="t" onclick="H(this)">17:27:44</span>                    devn </span><span>then again, from the standpoint of providing explanations, there&apos;s some overhead associated with passing those facts through to another session</span></div><div id="t1465320518000022" t="2016-06-07 17:28:38 devn since, for the purposes of a UI for instance, you need to capture the explanations from different sessions and cobble them together"><a href="#t1465320518000022" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-07</span> <span class="t" onclick="H(this)">17:28:38</span>                    devn </span><span>since, for the purposes of a UI for instance, you need to capture the explanations from different sessions and cobble them together</span></div><div id="t1465320531000023" t="2016-06-07 17:28:51 devn not hard, really"><a href="#t1465320531000023" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-07</span> <span class="t" onclick="H(this)">17:28:51</span>                    devn </span><span>not hard, really</span></div><div id="t1465320538000024" t="2016-06-07 17:28:58 devn just easier to have the single session"><a href="#t1465320538000024" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-07</span> <span class="t" onclick="H(this)">17:28:58</span>                    devn </span><span>just easier to have the single session</span></div><div id="t1465320554000025" t="2016-06-07 17:29:14 ryanbrush Yeah. The old loose coupling/high cohesion design trade offs never really go away."><a href="#t1465320554000025" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-07</span> <span class="t" onclick="H(this)">17:29:14</span>               ryanbrush </span><span>Yeah. The old loose coupling/high cohesion design trade offs never really go away.</span></div><div id="t1465320566000026" t="2016-06-07 17:29:26 devn Speaking of UIs...  😉"><a href="#t1465320566000026" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-07</span> <span class="t" onclick="H(this)">17:29:26</span>                    devn </span><span>Speaking of UIs... </span><b>😉</b></div><div id="t1465320610000027" t="2016-06-07 17:30:10 devn IIRC I think you said the tools.ui work is on hold/not gonna happen"><a href="#t1465320610000027" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-07</span> <span class="t" onclick="H(this)">17:30:10</span>                    devn </span><span>IIRC I think you said the tools.ui work is on hold/not gonna happen</span></div><div id="t1465320693000028" t="2016-06-07 17:31:33 ryanbrush Yeah, not much is going on in that space now. It hasn&apos;t been a big need for us, so other demands have moved up. Happy to work with others that might be interested though."><a href="#t1465320693000028" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-07</span> <span class="t" onclick="H(this)">17:31:33</span>               ryanbrush </span><span>Yeah, not much is going on in that space now. It hasn&apos;t been a big need for us, so other demands have moved up. Happy to work with others that might be interested though.</span></div><div id="t1465320733000029" t="2016-06-07 17:32:13 ryanbrush (Oops....Need to drop offline for a bit here, but will be back on later in the day.)"><a href="#t1465320733000029" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-07</span> <span class="t" onclick="H(this)">17:32:13</span>               ryanbrush </span><span>(Oops....Need to drop offline for a bit here, but will be back on later in the day.)</span></div><div id="t1465320842000030" t="2016-06-07 17:34:02 devn It hasn&apos;t been a big need for us either, but generally speaking, onboarding people who haven&apos;t worked with a rules engine could be easier. I&apos;ve been thinking about whether it&apos;s a UI that I want, or if it&apos;s just better editor tooling to bring &quot;focus&quot; to specific rules, or parts of rules."><a href="#t1465320842000030" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-07</span> <span class="t" onclick="H(this)">17:34:02</span>                    devn </span><span>It hasn&apos;t been a big need for us either, but generally speaking, onboarding people who haven&apos;t worked with a rules engine could be easier. I&apos;ve been thinking about whether it&apos;s a UI that I want, or if it&apos;s just better editor tooling to bring &quot;focus&quot; to specific rules, or parts of rules.</span></div><div id="t1465321356000031" t="2016-06-07 17:42:36 devn clara provides an opportunity to deliver good explanations. so, i wonder about a sort of meta-explain that could provide a more readable version of why a rule fired. I imagine in the above case seeing something like: For each DatedFact (of which there were 10), retrieve the  latest  fact for each unique  ?foo  value grouping. There were 3 unique ?foo values (`&quot;A&quot;, &quot;B&quot;, &quot;C&quot;`). As a result, 3  LatestFact  facts were inserted into the session. Since you&apos;ve requested I focus my attention on the  date  field of  LatestFact  in my summaries, these are the  date  values on  LatestFact  which were inserted:  2016-05-10 , ..."><a href="#t1465321356000031" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-07</span> <span class="t" onclick="H(this)">17:42:36</span>                    devn </span><span>clara provides an opportunity to deliver good explanations. so, i wonder about a sort of meta-explain that could provide a more readable version of why a rule fired. I imagine in the above case seeing something like: For each DatedFact (of which there were 10), retrieve the </span><code>latest</code><span> fact for each unique </span><code>?foo</code><span> value grouping. There were 3 unique ?foo values (`&quot;A&quot;, &quot;B&quot;, &quot;C&quot;`). As a result, 3 </span><code>LatestFact</code><span> facts were inserted into the session. Since you&apos;ve requested I focus my attention on the </span><code>date</code><span> field of </span><code>LatestFact</code><span> in my summaries, these are the </span><code>date</code><span> values on </span><code>LatestFact</code><span> which were inserted: </span><code>2016-05-10</code><span>, ...</span></div><div id="t1465321669000033" t="2016-06-07 17:47:49 devn I would of course settle for: &quot;Me take  DatedFact , put unique  ?foo  in many bucket, put  LatestFact  with  date  of  2016-05-10 .&quot;  🙂"><a href="#t1465321669000033" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-07</span> <span class="t" onclick="H(this)">17:47:49</span>                    devn </span><span>I would of course settle for: &quot;Me take </span><code>DatedFact</code><span>, put unique </span><code>?foo</code><span> in many bucket, put </span><code>LatestFact</code><span> with </span><code>date</code><span> of </span><code>2016-05-10</code><span>.&quot; </span><b>🙂</b></div><div id="t1465321741000035" t="2016-06-07 17:49:01 devn BTW, @mikerod &amp;&amp; @ryanbrush -- Excited to see the work and thought going into session durability. Thank you."><a href="#t1465321741000035" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-07</span> <span class="t" onclick="H(this)">17:49:01</span>                    devn </span><span>BTW, @mikerod &amp;&amp; @ryanbrush -- Excited to see the work and thought going into session durability. Thank you.</span></div><div id="t1465323001000036" t="2016-06-07 18:10:01 mikerod devn: I&apos;d echo sort of what Ryan said that smaller sessions can work alright.  If you have heavy-weight logic in rules though, it is good to share that if it applies to many other sessions.  One idea would be to just derive facts for the common logic in one session, and then insert those facts into another new session later.  That isn&apos;t too expensive if the hard-work is in the rules that make those derived facts."><a href="#t1465323001000036" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-07</span> <span class="t" onclick="H(this)">18:10:01</span>                 mikerod </span><span>devn: I&apos;d echo sort of what Ryan said that smaller sessions can work alright.  If you have heavy-weight logic in rules though, it is good to share that if it applies to many other sessions.  One idea would be to just derive facts for the common logic in one session, and then insert those facts into another new session later.  That isn&apos;t too expensive if the hard-work is in the rules that make those derived facts.</span></div><div id="t1465323066000037" t="2016-06-07 18:11:06 mikerod devn: And yes, the durability stuff will be coming along hopefully in a timely manner.  I&apos;m working on a prototype for it still currently and will keep design thoughts and discussions posted on the  https://github.com/rbrush/clara-rules/issues/198  issue"><a href="#t1465323066000037" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-07</span> <span class="t" onclick="H(this)">18:11:06</span>                 mikerod </span><span>devn: And yes, the durability stuff will be coming along hopefully in a timely manner.  I&apos;m working on a prototype for it still currently and will keep design thoughts and discussions posted on the </span><a href="https://github.com/rbrush/clara-rules/issues/198" target="_blank">https://github.com/rbrush/clara-rules/issues/198</a><span> issue</span></div><div id="t1465323161000039" t="2016-06-07 18:12:41 mikerod If you have any input there on how you&apos;d want it to work, I&apos;d be interested to hear that too.  I have a use-case in mind, but it is good to know if there are any differing needs.  I had a really rough demo of some thoughts @  https://github.com/mrrodriguez/clara-durability-demo  but that would not be the expected way everyone would need to interface.  I was just toying with an idea of being able to use an extension point like clojure.core/print-dup to give hooks for serialization."><a href="#t1465323161000039" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-07</span> <span class="t" onclick="H(this)">18:12:41</span>                 mikerod </span><span>If you have any input there on how you&apos;d want it to work, I&apos;d be interested to hear that too.  I have a use-case in mind, but it is good to know if there are any differing needs.  I had a really rough demo of some thoughts @ </span><a href="https://github.com/mrrodriguez/clara-durability-demo" target="_blank">https://github.com/mrrodriguez/clara-durability-demo</a><span> but that would not be the expected way everyone would need to interface.  I was just toying with an idea of being able to use an extension point like clojure.core/print-dup to give hooks for serialization.</span></div><div id="t1465323186000041" t="2016-06-07 18:13:06 mikerod In our case, our working memory of the rules session will actually have different types of objects in them, like Java Serializable, Avro, Clojure records"><a href="#t1465323186000041" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-07</span> <span class="t" onclick="H(this)">18:13:06</span>                 mikerod </span><span>In our case, our working memory of the rules session will actually have different types of objects in them, like Java Serializable, Avro, Clojure records</span></div><div id="t1465323226000042" t="2016-06-07 18:13:46 mikerod So I am messing around with ideas on how to efficiently provide capabilities to serialize this data when the serialization formats of groups of the data points actually, likely needs to vary.."><a href="#t1465323226000042" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-07</span> <span class="t" onclick="H(this)">18:13:46</span>                 mikerod </span><span>So I am messing around with ideas on how to efficiently provide capabilities to serialize this data when the serialization formats of groups of the data points actually, likely needs to vary..</span></div><div id="t1465428085000043" t="2016-06-08 23:21:25 devn @mikerod: interesting to hear that you can even do that (have serializable, avro, clojure recs floating around in the session)"><a href="#t1465428085000043" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-08</span> <span class="t" onclick="H(this)">23:21:25</span>                    devn </span><span>@mikerod: interesting to hear that you can even do that (have serializable, avro, clojure recs floating around in the session)</span></div><div id="t1465428694000044" t="2016-06-08 23:31:34 devn @mikerod: what does that look like in practice? Like, where do you use avro in a session?"><a href="#t1465428694000044" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-08</span> <span class="t" onclick="H(this)">23:31:34</span>                    devn </span><span>@mikerod: what does that look like in practice? Like, where do you use avro in a session?</span></div><div id="t1465605520000046" t="2016-06-11 00:38:40 wparker @devn: There isn’t any barrier to having non-Clojure types in a session.  For fields, Clara will just fall back to using JavaBean properties if it can.  https://github.com/rbrush/clara-rules/blob/0.11.1/src/main/clojure/clara/rules/compiler.clj#L165   You might get into trouble using things like Java primitives or maybe a falsey value, but I’d expect normal Java objects to work.  As far as why, I work with @mikerod so I can speak to that; the short answer without saying too much is that while our group"><a href="#t1465605520000046" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-11</span> <span class="t" onclick="H(this)">00:38:40</span>                 wparker </span><span>@devn: There isn’t any barrier to having non-Clojure types in a session.  For fields, Clara will just fall back to using JavaBean properties if it can. </span><a href="https://github.com/rbrush/clara-rules/blob/0.11.1/src/main/clojure/clara/rules/compiler.clj#L165" target="_blank">https://github.com/rbrush/clara-rules/blob/0.11.1/src/main/clojure/clara/rules/compiler.clj#L165</a><span>  You might get into trouble using things like Java primitives or maybe a falsey value, but I’d expect normal Java objects to work.  As far as why, I work with @mikerod so I can speak to that; the short answer without saying too much is that while our group</span></div><div id="t1465605577000048" t="2016-06-11 00:39:37 wparker group’s code is mostly in Clojure, we’re part of a larger Java system, and our external interaction points involve Avro records."><a href="#t1465605577000048" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-11</span> <span class="t" onclick="H(this)">00:39:37</span>                 wparker </span><span>group’s code is mostly in Clojure, we’re part of a larger Java system, and our external interaction points involve Avro records.</span></div><div id="t1465605883000049" t="2016-06-11 00:44:43 wparker Oh, btw even though random Java objects are fine mutating them Java-style underneath the rules engine after inserting them isn’t, at least if you want predictable results  🙂"><a href="#t1465605883000049" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-11</span> <span class="t" onclick="H(this)">00:44:43</span>                 wparker </span><span>Oh, btw even though random Java objects are fine mutating them Java-style underneath the rules engine after inserting them isn’t, at least if you want predictable results </span><b>🙂</b></div><div id="t1465606783000050" t="2016-06-11 00:59:43 devn @wparker: ah, so the avro records you deal with are beans?"><a href="#t1465606783000050" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-11</span> <span class="t" onclick="H(this)">00:59:43</span>                    devn </span><span>@wparker: ah, so the avro records you deal with are beans?</span></div><div id="t1465612692000051" t="2016-06-11 02:38:12 wparker @devn correct.  Not that facts have to be beans, it is just convenient for field access.  You can always just use whatever functions/interop you want on the fact instead."><a href="#t1465612692000051" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-11</span> <span class="t" onclick="H(this)">02:38:12</span>                 wparker </span><span>@devn correct.  Not that facts have to be beans, it is just convenient for field access.  You can always just use whatever functions/interop you want on the fact instead.</span></div><div id="t1465612733000052" t="2016-06-11 02:38:53 devn @wparker: i feel pretty daft asking, but again, im curious what an example of this looks like in clara&apos;s DSL"><a href="#t1465612733000052" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-11</span> <span class="t" onclick="H(this)">02:38:53</span>                    devn </span><span>@wparker: i feel pretty daft asking, but again, im curious what an example of this looks like in clara&apos;s DSL</span></div><div id="t1465612757000053" t="2016-06-11 02:39:17 devn Are you talking about  :fact-type-fn ?"><a href="#t1465612757000053" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-11</span> <span class="t" onclick="H(this)">02:39:17</span>                    devn </span><span>Are you talking about </span><code>:fact-type-fn</code><span>?</span></div><div id="t1465612792000054" t="2016-06-11 02:39:52 devn Either way, I&apos;m curious to see (even a hackish, half-working) sample of this"><a href="#t1465612792000054" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-11</span> <span class="t" onclick="H(this)">02:39:52</span>                    devn </span><span>Either way, I&apos;m curious to see (even a hackish, half-working) sample of this</span></div><div id="t1465612808000055" t="2016-06-11 02:40:08 devn We&apos;re talking about Avro a bit lately"><a href="#t1465612808000055" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-11</span> <span class="t" onclick="H(this)">02:40:08</span>                    devn </span><span>We&apos;re talking about Avro a bit lately</span></div><div id="t1465612890000056" t="2016-06-11 02:41:30 devn i&apos;ve been musing about rules existing at other layers of our platform, which may select an existing avro schema, or produce a new one, for instance"><a href="#t1465612890000056" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-11</span> <span class="t" onclick="H(this)">02:41:30</span>                    devn </span><span>i&apos;ve been musing about rules existing at other layers of our platform, which may select an existing avro schema, or produce a new one, for instance</span></div><div id="t1465613043000057" t="2016-06-11 02:44:03 devn @wparker: also, regarding #157 -- i honestly don&apos;t recall when we made that change, only that we observed cache misses due to ordering concerns"><a href="#t1465613043000057" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-11</span> <span class="t" onclick="H(this)">02:44:03</span>                    devn </span><span>@wparker: also, regarding #157 -- i honestly don&apos;t recall when we made that change, only that we observed cache misses due to ordering concerns</span></div><div id="t1465613087000058" t="2016-06-11 02:44:47 wparker It would just look like anything else, say"><a href="#t1465613087000058" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-11</span> <span class="t" onclick="H(this)">02:44:47</span>                 wparker </span><span>It would just look like anything else, say</span></div><div id="t1465613175000059" t="2016-06-11 02:46:15 wparker (defrule rule-using-bean [?fact &lt;- AvroFact (meets-some-condition? field-on-AvroFact)] =&gt; whatever-RHS-you-want)"><a href="#t1465613175000059" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-11</span> <span class="t" onclick="H(this)">02:46:15</span>                 wparker </span><span>(defrule rule-using-bean [?fact &lt;- AvroFact (meets-some-condition? field-on-AvroFact)] =&gt; whatever-RHS-you-want)</span></div><div id="t1465613213000060" t="2016-06-11 02:46:53 wparker I suppose you could do interesting things with the fact-type-fn and Avro schemas, but that wasn’t what I was referring to"><a href="#t1465613213000060" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-11</span> <span class="t" onclick="H(this)">02:46:53</span>                 wparker </span><span>I suppose you could do interesting things with the fact-type-fn and Avro schemas, but that wasn’t what I was referring to</span></div><div id="t1465613247000061" t="2016-06-11 02:47:27 wparker Say a fact-type-fn that used an Avro schema to determine the type."><a href="#t1465613247000061" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-11</span> <span class="t" onclick="H(this)">02:47:27</span>                 wparker </span><span>Say a fact-type-fn that used an Avro schema to determine the type.</span></div><div id="t1465613270000062" t="2016-06-11 02:47:50 wparker But a generated Avro class can just be used like any other class"><a href="#t1465613270000062" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-11</span> <span class="t" onclick="H(this)">02:47:50</span>                 wparker </span><span>But a generated Avro class can just be used like any other class</span></div><div id="t1465613338000063" t="2016-06-11 02:48:58 devn huh, i assumed there must be magic to make that work, but i must confess that my journey in programming has omitted serious java work, so while i understand chunks of the clojure compiler and such, i am often missing context w/r/t things like java beans"><a href="#t1465613338000063" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-11</span> <span class="t" onclick="H(this)">02:48:58</span>                    devn </span><span>huh, i assumed there must be magic to make that work, but i must confess that my journey in programming has omitted serious java work, so while i understand chunks of the clojure compiler and such, i am often missing context w/r/t things like java beans</span></div><div id="t1465613368000064" t="2016-06-11 02:49:28 devn @wparker: thanks much for the explanation"><a href="#t1465613368000064" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-11</span> <span class="t" onclick="H(this)">02:49:28</span>                    devn </span><span>@wparker: thanks much for the explanation</span></div><div id="t1465613379000065" t="2016-06-11 02:49:39 wparker Well, I haven’t personally created those Avro models, so I can’t exclude magic completely  🙂"><a href="#t1465613379000065" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-11</span> <span class="t" onclick="H(this)">02:49:39</span>                 wparker </span><span>Well, I haven’t personally created those Avro models, so I can’t exclude magic completely </span><b>🙂</b></div><div id="t1465613388000066" t="2016-06-11 02:49:48 wparker But once you have classes, they are just that"><a href="#t1465613388000066" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-11</span> <span class="t" onclick="H(this)">02:49:48</span>                 wparker </span><span>But once you have classes, they are just that</span></div><div id="t1465613455000067" t="2016-06-11 02:50:55 wparker You’re welcome"><a href="#t1465613455000067" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-11</span> <span class="t" onclick="H(this)">02:50:55</span>                 wparker </span><span>You’re welcome</span></div><div id="t1465613480000068" t="2016-06-11 02:51:20 devn @wparker: also regarding 199 and your question about clojure equality, I don&apos;t think we&apos;ve ever done anything with activation groups"><a href="#t1465613480000068" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-11</span> <span class="t" onclick="H(this)">02:51:20</span>                    devn </span><span>@wparker: also regarding 199 and your question about clojure equality, I don&apos;t think we&apos;ve ever done anything with activation groups</span></div><div id="t1465613551000070" t="2016-06-11 02:52:31 wparker Well, it wouldn’t have to be activation groups in particular, I was just choosing that as an example of one of the options to mk-session"><a href="#t1465613551000070" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-11</span> <span class="t" onclick="H(this)">02:52:31</span>                 wparker </span><span>Well, it wouldn’t have to be activation groups in particular, I was just choosing that as an example of one of the options to mk-session</span></div><div id="t1465613582000071" t="2016-06-11 02:53:02 devn Date:   Wed Dec 30 16:46:15 2015 -0600"><a href="#t1465613582000071" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-11</span> <span class="t" onclick="H(this)">02:53:02</span>                    devn </span><code>Date:   Wed Dec 30 16:46:15 2015 -0600</code></div><div id="t1465613595000072" t="2016-06-11 02:53:15 wparker Caching is on rules + options, which makes sense since the options impact the session semantics"><a href="#t1465613595000072" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-11</span> <span class="t" onclick="H(this)">02:53:15</span>                 wparker </span><span>Caching is on rules + options, which makes sense since the options impact the session semantics</span></div><div id="t1465613648000073" t="2016-06-11 02:54:08 devn so, #157 was Jan 12"><a href="#t1465613648000073" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-11</span> <span class="t" onclick="H(this)">02:54:08</span>                    devn </span><span>so, #157 was Jan 12</span></div><div id="t1465613651000074" t="2016-06-11 02:54:11 devn 😄"><a href="#t1465613651000074" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-11</span> <span class="t" onclick="H(this)">02:54:11</span>                    devn </span><b>😄</b></div><div id="t1465613663000075" t="2016-06-11 02:54:23 devn err, but closed Feb 4"><a href="#t1465613663000075" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-11</span> <span class="t" onclick="H(this)">02:54:23</span>                    devn </span><span>err, but closed Feb 4</span></div><div id="t1465613673000076" t="2016-06-11 02:54:33 devn but, yeah, makes sense."><a href="#t1465613673000076" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-11</span> <span class="t" onclick="H(this)">02:54:33</span>                    devn </span><span>but, yeah, makes sense.</span></div><div id="t1465613777000077" t="2016-06-11 02:56:17 devn Now I&apos;m curious to see if removing that call to  (set)  changes behavior"><a href="#t1465613777000077" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-11</span> <span class="t" onclick="H(this)">02:56:17</span>                    devn </span><span>Now I&apos;m curious to see if removing that call to </span><code>(set)</code><span> changes behavior</span></div><div id="t1465613863000078" t="2016-06-11 02:57:43 wparker Do you mean trying with it removed on your code on the case that had a cache miss?"><a href="#t1465613863000078" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-11</span> <span class="t" onclick="H(this)">02:57:43</span>                 wparker </span><span>Do you mean trying with it removed on your code on the case that had a cache miss?</span></div><div id="t1465613873000080" t="2016-06-11 02:57:53 devn yes"><a href="#t1465613873000080" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-11</span> <span class="t" onclick="H(this)">02:57:53</span>                    devn </span><span>yes</span></div><div id="t1465679148000002" t="2016-06-11 21:05:48 devn @mikerod:  http://dev.clojure.org/jira/browse/CLJ-1733"><a href="#t1465679148000002" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-11</span> <span class="t" onclick="H(this)">21:05:48</span>                    devn </span><span>@mikerod: </span><a href="http://dev.clojure.org/jira/browse/CLJ-1733" target="_blank">http://dev.clojure.org/jira/browse/CLJ-1733</a></div><div id="t1465679190000003" t="2016-06-11 21:06:30 devn Was just walking through open clojure issues and wanted to drop it here since I saw you wrapping with  #="><a href="#t1465679190000003" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-11</span> <span class="t" onclick="H(this)">21:06:30</span>                    devn </span><span>Was just walking through open clojure issues and wanted to drop it here since I saw you wrapping with </span><code>#=</code></div><div id="t1465784367000004" t="2016-06-13 02:19:27 mikerod devn: thanks for the heads up.  Yeah, my original demo is likely to not be all that close to what I end up going with.  However, it is good to know where the hiccups are right now with the default impl&apos;s of  print-dup  and I forgot about this existing issue there."><a href="#t1465784367000004" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">02:19:27</span>                 mikerod </span><span>devn: thanks for the heads up.  Yeah, my original demo is likely to not be all that close to what I end up going with.  However, it is good to know where the hiccups are right now with the default impl&apos;s of </span><code>print-dup</code><span> and I forgot about this existing issue there.</span></div><div id="t1465784432000005" t="2016-06-13 02:20:32 devn @mikerod: it actually prompted me to do a general jira survey for &quot;dup&quot; issues. I was unable to figure out how to get JIRA to search for #= despite several attempts at various quoting and escaping schemes"><a href="#t1465784432000005" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">02:20:32</span>                    devn </span><span>@mikerod: it actually prompted me to do a general jira survey for &quot;dup&quot; issues. I was unable to figure out how to get JIRA to search for #= despite several attempts at various quoting and escaping schemes</span></div><div id="t1465784517000006" t="2016-06-13 02:21:57 devn actually, i wound up doing a walk over most of JIRA yesterday. I don&apos;t know that it was &quot;enjoyable&quot;, but focusing on the critical and high priority issues and reading them through was worth the time I think"><a href="#t1465784517000006" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">02:21:57</span>                    devn </span><span>actually, i wound up doing a walk over most of JIRA yesterday. I don&apos;t know that it was &quot;enjoyable&quot;, but focusing on the critical and high priority issues and reading them through was worth the time I think</span></div><div id="t1465785485000007" t="2016-06-13 02:38:05 mikerod devn: I think that is often a good idea&apos;"><a href="#t1465785485000007" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">02:38:05</span>                 mikerod </span><span>devn: I think that is often a good idea&apos;</span></div><div id="t1465785500000008" t="2016-06-13 02:38:20 mikerod I try to keep up with it somewhat, but it&apos;d be good to get a refresher over the bigger existing issues"><a href="#t1465785500000008" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">02:38:20</span>                 mikerod </span><span>I try to keep up with it somewhat, but it&apos;d be good to get a refresher over the bigger existing issues</span></div><div id="t1465785514000009" t="2016-06-13 02:38:34 mikerod I agree that searching for print-dup stuff is certainly a non-trivial one  🙂"><a href="#t1465785514000009" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">02:38:34</span>                 mikerod </span><span>I agree that searching for print-dup stuff is certainly a non-trivial one </span><b>🙂</b></div><div id="t1465785524000010" t="2016-06-13 02:38:44 devn it moves slow enough that if you give it a good look post-release, you&apos;ll know what&apos;s up for awhile"><a href="#t1465785524000010" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">02:38:44</span>                    devn </span><span>it moves slow enough that if you give it a good look post-release, you&apos;ll know what&apos;s up for awhile</span></div><div id="t1465785545000011" t="2016-06-13 02:39:05 mikerod I&apos;ve done a reasonable amount with  print-dup  before, but it is a lesser documented area and as you&apos;ve shown here, there are caveats"><a href="#t1465785545000011" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">02:39:05</span>                 mikerod </span><span>I&apos;ve done a reasonable amount with </span><code>print-dup</code><span> before, but it is a lesser documented area and as you&apos;ve shown here, there are caveats</span></div><div id="t1465785555000012" t="2016-06-13 02:39:15 mikerod yeah, I&apos;d think so"><a href="#t1465785555000012" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">02:39:15</span>                 mikerod </span><span>yeah, I&apos;d think so</span></div><div id="t1465785591000013" t="2016-06-13 02:39:51 devn heh, speaking of print-dup: I wrote a thing awhile back that took all of the sexps from the #C03S1KBA2 IRC channel going back to 2009"><a href="#t1465785591000013" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">02:39:51</span>                    devn </span><span>heh, speaking of print-dup: I wrote a thing awhile back that took all of the sexps from the #C03S1KBA2 IRC channel going back to 2009</span></div><div id="t1465785605000014" t="2016-06-13 02:40:05 devn and ran them in a sandbox, capturing output (if any), and value"><a href="#t1465785605000014" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">02:40:05</span>                    devn </span><span>and ran them in a sandbox, capturing output (if any), and value</span></div><div id="t1465785679000015" t="2016-06-13 02:41:19 devn I used print-dup to serialize the entire collection of results out to a file at some point, and i remember finding some tricky bits, but i don&apos;t remember details anymore"><a href="#t1465785679000015" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">02:41:19</span>                    devn </span><span>I used print-dup to serialize the entire collection of results out to a file at some point, and i remember finding some tricky bits, but i don&apos;t remember details anymore</span></div><div id="t1465785745000016" t="2016-06-13 02:42:25 devn despite the &quot;first rule of hash equals club is don&apos;t talk about hash equals&quot;, i remember it being quite solid back in 1.2, 1.3"><a href="#t1465785745000016" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">02:42:25</span>                    devn </span><span>despite the &quot;first rule of hash equals club is don&apos;t talk about hash equals&quot;, i remember it being quite solid back in 1.2, 1.3</span></div><div id="t1465785793000017" t="2016-06-13 02:43:13 devn there were at least 30k random examples serialized to a file, and read successfully, including Swing and all sorts of other nonsense"><a href="#t1465785793000017" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">02:43:13</span>                    devn </span><span>there were at least 30k random examples serialized to a file, and read successfully, including Swing and all sorts of other nonsense</span></div><div id="t1465785884000018" t="2016-06-13 02:44:44 devn though it&apos;s one of those things that Rich and Co. have basically said: use at your own risk, i have a hard time imagining it going away"><a href="#t1465785884000018" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">02:44:44</span>                    devn </span><span>though it&apos;s one of those things that Rich and Co. have basically said: use at your own risk, i have a hard time imagining it going away</span></div><div id="t1465785967000019" t="2016-06-13 02:46:07 devn Anyway, as long as I mentioned that project:  http://getclojure.org/"><a href="#t1465785967000019" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">02:46:07</span>                    devn </span><span>Anyway, as long as I mentioned that project: </span><a href="http://getclojure.org/" target="_blank">http://getclojure.org/</a></div><div id="t1465786023000020" t="2016-06-13 02:47:03 devn It&apos;s nothing to write home about, and since it was all sandboxed, there are plenty of things which didn&apos;t pass the sniff test and were subsequently not run in the sandbox, but there&apos;s some interesting stuff in there, usually further into a search. A search for  comp  has results for the first few pages that are like  (comp comp comp comp)  for example, which is not very interesting."><a href="#t1465786023000020" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">02:47:03</span>                    devn </span><span>It&apos;s nothing to write home about, and since it was all sandboxed, there are plenty of things which didn&apos;t pass the sniff test and were subsequently not run in the sandbox, but there&apos;s some interesting stuff in there, usually further into a search. A search for </span><code>comp</code><span> has results for the first few pages that are like </span><code>(comp comp comp comp)</code><span> for example, which is not very interesting.</span></div><div id="t1465786221000021" t="2016-06-13 02:50:21 mikerod devn: sounds interesting"><a href="#t1465786221000021" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">02:50:21</span>                 mikerod </span><span>devn: sounds interesting</span></div><div id="t1465786223000022" t="2016-06-13 02:50:23 mikerod I&apos;ll ahve to look at that"><a href="#t1465786223000022" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">02:50:23</span>                 mikerod </span><span>I&apos;ll ahve to look at that</span></div><div id="t1465786232000023" t="2016-06-13 02:50:32 devn it&apos;s not really, i assure you  🙂"><a href="#t1465786232000023" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">02:50:32</span>                    devn </span><span>it&apos;s not really, i assure you </span><b>🙂</b></div><div id="t1465786267000024" t="2016-06-13 02:51:07 mikerod yeah,  print-dup  is weird.  It seems to be, in some ways, a recommended approach to serialization of Clojure structures, but it is still not really fully &quot;official&quot;"><a href="#t1465786267000024" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">02:51:07</span>                 mikerod </span><span>yeah, </span><code>print-dup</code><span> is weird.  It seems to be, in some ways, a recommended approach to serialization of Clojure structures, but it is still not really fully &quot;official&quot;</span></div><div id="t1465786268000025" t="2016-06-13 02:51:08 devn i had dreams of building a sort of hoogle for clojure. codeq + clojure.tools.analyze + query over sexps, something like that"><a href="#t1465786268000025" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">02:51:08</span>                    devn </span><span>i had dreams of building a sort of hoogle for clojure. codeq + clojure.tools.analyze + query over sexps, something like that</span></div><div id="t1465786280000026" t="2016-06-13 02:51:20 mikerod it is primitive though.  to use it successfully, you have to implement your own back references etc."><a href="#t1465786280000026" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">02:51:20</span>                 mikerod </span><span>it is primitive though.  to use it successfully, you have to implement your own back references etc.</span></div><div id="t1465786294000028" t="2016-06-13 02:51:34 mikerod if you have a lot of pointers to the same objects in memory or something like that."><a href="#t1465786294000028" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">02:51:34</span>                 mikerod </span><span>if you have a lot of pointers to the same objects in memory or something like that.</span></div><div id="t1465786317000029" t="2016-06-13 02:51:57 devn @mikerod: do you work with ryan, out of curiosity?"><a href="#t1465786317000029" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">02:51:57</span>                    devn </span><span>@mikerod: do you work with ryan, out of curiosity?</span></div><div id="t1465786353000030" t="2016-06-13 02:52:33 mikerod this website is interesting GetClojure"><a href="#t1465786353000030" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">02:52:33</span>                 mikerod </span><span>this website is interesting GetClojure</span></div><div id="t1465786360000031" t="2016-06-13 02:52:40 mikerod I think I remember looking at this a long while back perhaps?"><a href="#t1465786360000031" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">02:52:40</span>                 mikerod </span><span>I think I remember looking at this a long while back perhaps?</span></div><div id="t1465786366000032" t="2016-06-13 02:52:46 mikerod maybe you posted it somewhere before and I was curious"><a href="#t1465786366000032" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">02:52:46</span>                 mikerod </span><span>maybe you posted it somewhere before and I was curious</span></div><div id="t1465786368000033" t="2016-06-13 02:52:48 devn yeah, it&apos;s my first clojure project from the olden days"><a href="#t1465786368000033" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">02:52:48</span>                    devn </span><span>yeah, it&apos;s my first clojure project from the olden days</span></div><div id="t1465786372000034" t="2016-06-13 02:52:52 mikerod ah I see"><a href="#t1465786372000034" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">02:52:52</span>                 mikerod </span><span>ah I see</span></div><div id="t1465786386000035" t="2016-06-13 02:53:06 mikerod Yeah I work at the same company as Ryan.  Also Will on here"><a href="#t1465786386000035" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">02:53:06</span>                 mikerod </span><span>Yeah I work at the same company as Ryan.  Also Will on here</span></div><div id="t1465786398000036" t="2016-06-13 02:53:18 mikerod w parker"><a href="#t1465786398000036" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">02:53:18</span>                 mikerod </span><span>w parker</span></div><div id="t1465786437000037" t="2016-06-13 02:53:57 devn i&apos;d like to understand clara internals better, but i think i need to start smaller and implement a dumb version of rete before I&apos;ll be of much use"><a href="#t1465786437000037" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">02:53:57</span>                    devn </span><span>i&apos;d like to understand clara internals better, but i think i need to start smaller and implement a dumb version of rete before I&apos;ll be of much use</span></div><div id="t1465786450000038" t="2016-06-13 02:54:10 devn (mostly for the purposes of contributing)"><a href="#t1465786450000038" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">02:54:10</span>                    devn </span><span>(mostly for the purposes of contributing)</span></div><div id="t1465786457000039" t="2016-06-13 02:54:17 mikerod devn: yeah, I actually find the codebase to be approachable, but it is good to have some background"><a href="#t1465786457000039" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">02:54:17</span>                 mikerod </span><span>devn: yeah, I actually find the codebase to be approachable, but it is good to have some background</span></div><div id="t1465786486000040" t="2016-06-13 02:54:46 mikerod clara.rules.engine is almost something you could look at stand-alone to reason about the way the Rete network propagates data around"><a href="#t1465786486000040" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">02:54:46</span>                 mikerod </span><span>clara.rules.engine is almost something you could look at stand-alone to reason about the way the Rete network propagates data around</span></div><div id="t1465786497000041" t="2016-06-13 02:54:57 mikerod clara.rules.compiler is more compilation complexity"><a href="#t1465786497000041" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">02:54:57</span>                 mikerod </span><span>clara.rules.compiler is more compilation complexity</span></div><div id="t1465786520000042" t="2016-06-13 02:55:20 mikerod builds the rete graph etc, but I think you can sort of gloss over that and just look at clara.rules.engine to get a good feel for how data moves around"><a href="#t1465786520000042" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">02:55:20</span>                 mikerod </span><span>builds the rete graph etc, but I think you can sort of gloss over that and just look at clara.rules.engine to get a good feel for how data moves around</span></div><div id="t1465786537000043" t="2016-06-13 02:55:37 devn is it crazy to think about building some instrumented visualization of the graph construction?"><a href="#t1465786537000043" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">02:55:37</span>                    devn </span><span>is it crazy to think about building some instrumented visualization of the graph construction?</span></div><div id="t1465786538000044" t="2016-06-13 02:55:38 mikerod writing a toy version of your own could be a good learning experience though I&apos;d imagine"><a href="#t1465786538000044" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">02:55:38</span>                 mikerod </span><span>writing a toy version of your own could be a good learning experience though I&apos;d imagine</span></div><div id="t1465786549000045" t="2016-06-13 02:55:49 mikerod I think that could be a cool and useful thing"><a href="#t1465786549000045" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">02:55:49</span>                 mikerod </span><span>I think that could be a cool and useful thing</span></div><div id="t1465786551000046" t="2016-06-13 02:55:51 devn sort of a stepping debugger or something"><a href="#t1465786551000046" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">02:55:51</span>                    devn </span><span>sort of a stepping debugger or something</span></div><div id="t1465786561000047" t="2016-06-13 02:56:01 mikerod I know that Ryan played some with some visualizations here and there"><a href="#t1465786561000047" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">02:56:01</span>                 mikerod </span><span>I know that Ryan played some with some visualizations here and there</span></div><div id="t1465786595000048" t="2016-06-13 02:56:35 mikerod however, nothing too serious yet.  just demo&apos;s or trials of things I think"><a href="#t1465786595000048" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">02:56:35</span>                 mikerod </span><span>however, nothing too serious yet.  just demo&apos;s or trials of things I think</span></div><div id="t1465786601000049" t="2016-06-13 02:56:41 mikerod https://github.com/rbrush/clara-tools"><a href="#t1465786601000049" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">02:56:41</span>                 mikerod </span><a href="https://github.com/rbrush/clara-tools" target="_blank">https://github.com/rbrush/clara-tools</a></div><div id="t1465786623000051" t="2016-06-13 02:57:03 mikerod and also, it may not visualize the graph like you are saying.   Visualization has different sort of levels you may be interested in."><a href="#t1465786623000051" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">02:57:03</span>                 mikerod </span><span>and also, it may not visualize the graph like you are saying.   Visualization has different sort of levels you may be interested in.</span></div><div id="t1465786637000052" t="2016-06-13 02:57:17 devn yes, exactly"><a href="#t1465786637000052" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">02:57:17</span>                    devn </span><span>yes, exactly</span></div><div id="t1465786653000053" t="2016-06-13 02:57:33 devn there are layers to the explanation/visualization"><a href="#t1465786653000053" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">02:57:33</span>                    devn </span><span>there are layers to the explanation/visualization</span></div><div id="t1465786673000054" t="2016-06-13 02:57:53 mikerod There is an older paper referred to in the Clara wiki too"><a href="#t1465786673000054" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">02:57:53</span>                 mikerod </span><span>There is an older paper referred to in the Clara wiki too</span></div><div id="t1465786673000055" t="2016-06-13 02:57:53 mikerod https://github.com/rbrush/clara-rules/wiki/Introduction#the-rules-engine"><a href="#t1465786673000055" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">02:57:53</span>                 mikerod </span><a href="https://github.com/rbrush/clara-rules/wiki/Introduction#the-rules-engine" target="_blank">https://github.com/rbrush/clara-rules/wiki/Introduction#the-rules-engine</a></div><div id="t1465786674000056" t="2016-06-13 02:57:54 devn some of them useful at a domain level so people using our stuff can understand why a decision was rendered"><a href="#t1465786674000056" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">02:57:54</span>                    devn </span><span>some of them useful at a domain level so people using our stuff can understand why a decision was rendered</span></div><div id="t1465786680000058" t="2016-06-13 02:58:00 mikerod http://reports-archive.adm.cs.cmu.edu/anon/1995/CMU-CS-95-113.pdf  this paper"><a href="#t1465786680000058" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">02:58:00</span>                 mikerod </span><a href="http://reports-archive.adm.cs.cmu.edu/anon/1995/CMU-CS-95-113.pdf" target="_blank">http://reports-archive.adm.cs.cmu.edu/anon/1995/CMU-CS-95-113.pdf</a><span> this paper</span></div><div id="t1465786706000059" t="2016-06-13 02:58:26 devn and then there&apos;s the &quot;i&apos;m a programmer, show me the hairier view, with data&quot;"><a href="#t1465786706000059" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">02:58:26</span>                    devn </span><span>and then there&apos;s the &quot;i&apos;m a programmer, show me the hairier view, with data&quot;</span></div><div id="t1465786710000060" t="2016-06-13 02:58:30 mikerod I found it to have a really good overview of Rete.  It is certainly dated and lacking many of the optimizations and extensions to Rete present in Clara, but it is a good base."><a href="#t1465786710000060" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">02:58:30</span>                 mikerod </span><span>I found it to have a really good overview of Rete.  It is certainly dated and lacking many of the optimizations and extensions to Rete present in Clara, but it is a good base.</span></div><div id="t1465786717000061" t="2016-06-13 02:58:37 devn and then there&apos;s the &quot;i know kung fu, show me the internals&quot;"><a href="#t1465786717000061" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">02:58:37</span>                    devn </span><span>and then there&apos;s the &quot;i know kung fu, show me the internals&quot;</span></div><div id="t1465786737000062" t="2016-06-13 02:58:57 mikerod Yes.  Visualization does seem to be a complex subject."><a href="#t1465786737000062" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">02:58:57</span>                 mikerod </span><span>Yes.  Visualization does seem to be a complex subject.</span></div><div id="t1465786751000063" t="2016-06-13 02:59:11 devn @mikerod: this is the paper clara is based off of yes?"><a href="#t1465786751000063" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">02:59:11</span>                    devn </span><span>@mikerod: this is the paper clara is based off of yes?</span></div><div id="t1465786776000064" t="2016-06-13 02:59:36 mikerod Yeah, I&apos;d say so.  However, it is really just an overview of Rete more than anything."><a href="#t1465786776000064" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">02:59:36</span>                 mikerod </span><span>Yeah, I&apos;d say so.  However, it is really just an overview of Rete more than anything.</span></div><div id="t1465786778000065" t="2016-06-13 02:59:38 devn the question i had was: is it better start simpler, with rete - optimizations?"><a href="#t1465786778000065" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">02:59:38</span>                    devn </span><span>the question i had was: is it better start simpler, with rete - optimizations?</span></div><div id="t1465786810000066" t="2016-06-13 03:00:10 mikerod there are a few key chapters to it.  it is long, but some of it isn&apos;t really all that relevant unless you are curious about the test system they were writing back in the 90s or whenever it was.   😛"><a href="#t1465786810000066" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:00:10</span>                 mikerod </span><span>there are a few key chapters to it.  it is long, but some of it isn&apos;t really all that relevant unless you are curious about the test system they were writing back in the 90s or whenever it was.  </span><b>😛</b></div><div id="t1465786811000067" t="2016-06-13 03:00:11 devn i have some books i picked up on CLIPS and OPS5. Some interesting stuff!"><a href="#t1465786811000067" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:00:11</span>                    devn </span><span>i have some books i picked up on CLIPS and OPS5. Some interesting stuff!</span></div><div id="t1465786826000068" t="2016-06-13 03:00:26 mikerod yeah, clips has good material"><a href="#t1465786826000068" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:00:26</span>                 mikerod </span><span>yeah, clips has good material</span></div><div id="t1465786840000069" t="2016-06-13 03:00:40 devn i mean, it&apos;s cool to see something lispy"><a href="#t1465786840000069" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:00:40</span>                    devn </span><span>i mean, it&apos;s cool to see something lispy</span></div><div id="t1465786840000070" t="2016-06-13 03:00:40 mikerod and OPS5.  I&apos;ve read at least most of the Forgy paper"><a href="#t1465786840000070" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:00:40</span>                 mikerod </span><span>and OPS5.  I&apos;ve read at least most of the Forgy paper</span></div><div id="t1465786851000071" t="2016-06-13 03:00:51 devn even if the material is quite dated"><a href="#t1465786851000071" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:00:51</span>                    devn </span><span>even if the material is quite dated</span></div><div id="t1465786864000072" t="2016-06-13 03:01:04 mikerod I won&apos;t speak completely for Ryan, but I think he had some inspiration from  http://herzberg.ca.sandia.gov/"><a href="#t1465786864000072" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:01:04</span>                 mikerod </span><span>I won&apos;t speak completely for Ryan, but I think he had some inspiration from </span><a href="http://herzberg.ca.sandia.gov/" target="_blank">http://herzberg.ca.sandia.gov/</a></div><div id="t1465786866000073" t="2016-06-13 03:01:06 mikerod as well"><a href="#t1465786866000073" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:01:06</span>                 mikerod </span><span>as well</span></div><div id="t1465786868000074" t="2016-06-13 03:01:08 mikerod Jess"><a href="#t1465786868000074" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:01:08</span>                 mikerod </span><span>Jess</span></div><div id="t1465786879000075" t="2016-06-13 03:01:19 mikerod At least in the fact that it used a Lisp DSL, ran on the JVM"><a href="#t1465786879000075" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:01:19</span>                 mikerod </span><span>At least in the fact that it used a Lisp DSL, ran on the JVM</span></div><div id="t1465786887000076" t="2016-06-13 03:01:27 devn oh, nice! this is great! thanks!"><a href="#t1465786887000076" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:01:27</span>                    devn </span><span>oh, nice! this is great! thanks!</span></div><div id="t1465786891000077" t="2016-06-13 03:01:31 mikerod Clojure is just here now, and makes it more awesome (in my opinion)"><a href="#t1465786891000077" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:01:31</span>                 mikerod </span><span>Clojure is just here now, and makes it more awesome (in my opinion)</span></div><div id="t1465786910000078" t="2016-06-13 03:01:50 mikerod Jess has good documentation here though.  Including on some Rete extensions like accumulators."><a href="#t1465786910000078" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:01:50</span>                 mikerod </span><span>Jess has good documentation here though.  Including on some Rete extensions like accumulators.</span></div><div id="t1465786926000079" t="2016-06-13 03:02:06 mikerod I&apos;ve read most, if not all, of the Jess wiki docs accessible via this link."><a href="#t1465786926000079" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:02:06</span>                 mikerod </span><span>I&apos;ve read most, if not all, of the Jess wiki docs accessible via this link.</span></div><div id="t1465786961000080" t="2016-06-13 03:02:41 devn i keep tinkering with the idea (yet another project that is on hold due to the amount of time i have) of a datomic-driven rules engine"><a href="#t1465786961000080" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:02:41</span>                    devn </span><span>i keep tinkering with the idea (yet another project that is on hold due to the amount of time i have) of a datomic-driven rules engine</span></div><div id="t1465786996000081" t="2016-06-13 03:03:16 mikerod Yeah, that has seemed like an interesting idea to me before as well"><a href="#t1465786996000081" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:03:16</span>                 mikerod </span><span>Yeah, that has seemed like an interesting idea to me before as well</span></div><div id="t1465787018000082" t="2016-06-13 03:03:38 devn reified transactions a la Tim Ewald (sagas) here:  http://www.datomic.com/videos.html"><a href="#t1465787018000082" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:03:38</span>                    devn </span><span>reified transactions a la Tim Ewald (sagas) here: </span><a href="http://www.datomic.com/videos.html" target="_blank">http://www.datomic.com/videos.html</a></div><div id="t1465787020000084" t="2016-06-13 03:03:40 mikerod I haven&apos;t done much with Datomic other than listen to a bunch about it and read up on it.  I&apos;ve liked a lot of the ideas etc there and hope to work with it at some point"><a href="#t1465787020000084" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:03:40</span>                 mikerod </span><span>I haven&apos;t done much with Datomic other than listen to a bunch about it and read up on it.  I&apos;ve liked a lot of the ideas etc there and hope to work with it at some point</span></div><div id="t1465787058000085" t="2016-06-13 03:04:18 mikerod I don&apos;t think I&apos;ve watched these ones yet.  I will.  Looks like a good set of videos"><a href="#t1465787058000085" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:04:18</span>                 mikerod </span><span>I don&apos;t think I&apos;ve watched these ones yet.  I will.  Looks like a good set of videos</span></div><div id="t1465787069000086" t="2016-06-13 03:04:29 devn i know that there have been at least two rules engines built on datomic which are not open source (sad face)"><a href="#t1465787069000086" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:04:29</span>                    devn </span><span>i know that there have been at least two rules engines built on datomic which are not open source (sad face)</span></div><div id="t1465787088000087" t="2016-06-13 03:04:48 devn one of them, as i understand it, had all the fixins (truth maintenance, etc.)"><a href="#t1465787088000087" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:04:48</span>                    devn </span><span>one of them, as i understand it, had all the fixins (truth maintenance, etc.)</span></div><div id="t1465787094000088" t="2016-06-13 03:04:54 mikerod Oh, also on Rete.  I follow Drools stuff a fair amount too.  Drools has pushed the bar with optimizations and has a lot of good extensions and documentation as well."><a href="#t1465787094000088" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:04:54</span>                 mikerod </span><span>Oh, also on Rete.  I follow Drools stuff a fair amount too.  Drools has pushed the bar with optimizations and has a lot of good extensions and documentation as well.</span></div><div id="t1465787118000089" t="2016-06-13 03:05:18 mikerod Oh.  Unfortunate neither is open source then"><a href="#t1465787118000089" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:05:18</span>                 mikerod </span><span>Oh.  Unfortunate neither is open source then</span></div><div id="t1465787148000090" t="2016-06-13 03:05:48 devn yeah, though it just makes my curiosity a bit more intense"><a href="#t1465787148000090" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:05:48</span>                    devn </span><span>yeah, though it just makes my curiosity a bit more intense</span></div><div id="t1465787186000091" t="2016-06-13 03:06:26 devn query in datomic is basically the LHS."><a href="#t1465787186000091" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:06:26</span>                    devn </span><span>query in datomic is basically the LHS.</span></div><div id="t1465787253000092" t="2016-06-13 03:07:33 devn the datomic thing is most interesting to me i think because most rules engines (as far as i understand it) do not address temporal concerns"><a href="#t1465787253000092" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:07:33</span>                    devn </span><span>the datomic thing is most interesting to me i think because most rules engines (as far as i understand it) do not address temporal concerns</span></div><div id="t1465787292000093" t="2016-06-13 03:08:12 devn this is partly why durability is interesting to me: &quot;show me what would have happened as of a point in time&quot;, or &quot;show me what it would look like if the rule base contained this rule, without committing it&quot;"><a href="#t1465787292000093" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:08:12</span>                    devn </span><span>this is partly why durability is interesting to me: &quot;show me what would have happened as of a point in time&quot;, or &quot;show me what it would look like if the rule base contained this rule, without committing it&quot;</span></div><div id="t1465787310000094" t="2016-06-13 03:08:30 mikerod devn: yeah, temporal concerns can be a wrench"><a href="#t1465787310000094" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:08:30</span>                 mikerod </span><span>devn: yeah, temporal concerns can be a wrench</span></div><div id="t1465787313000095" t="2016-06-13 03:08:33 mikerod in things*"><a href="#t1465787313000095" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:08:33</span>                 mikerod </span><span>in things*</span></div><div id="t1465787320000096" t="2016-06-13 03:08:40 mikerod I think Drools has tried to work with temporal concerns some"><a href="#t1465787320000096" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:08:40</span>                 mikerod </span><span>I think Drools has tried to work with temporal concerns some</span></div><div id="t1465787324000097" t="2016-06-13 03:08:44 mikerod I haven&apos;t read up on it much at this point"><a href="#t1465787324000097" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:08:44</span>                 mikerod </span><span>I haven&apos;t read up on it much at this point</span></div><div id="t1465787328000098" t="2016-06-13 03:08:48 mikerod &quot;events&quot; i think they ccall it"><a href="#t1465787328000098" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:08:48</span>                 mikerod </span><span>&quot;events&quot; i think they ccall it</span></div><div id="t1465787340000099" t="2016-06-13 03:09:00 devn interesting, googles"><a href="#t1465787340000099" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:09:00</span>                    devn </span><span>interesting, googles</span></div><div id="t1465787375000100" t="2016-06-13 03:09:35 devn so, i&apos;ve only read a couple of sentences while skimming the docs, but very interesting"><a href="#t1465787375000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:09:35</span>                    devn </span><span>so, i&apos;ve only read a couple of sentences while skimming the docs, but very interesting</span></div><div id="t1465787387000101" t="2016-06-13 03:09:47 mikerod http://docs.jboss.org/drools/release/6.4.0.Final/drools-docs/html_single/#DroolsComplexEventProcessingChapter"><a href="#t1465787387000101" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:09:47</span>                 mikerod </span><a href="http://docs.jboss.org/drools/release/6.4.0.Final/drools-docs/html_single/#DroolsComplexEventProcessingChapter" target="_blank">http://docs.jboss.org/drools/release/6.4.0.Final/drools-docs/html_single/#DroolsComplexEventProcessingChapter</a></div><div id="t1465787388000102" t="2016-06-13 03:09:48 devn &quot;Complex Event Processing, or CEP, is primarily an event processing concept that deals with the task of processing multiple events with the goal of identifying the meaningful events within the event cloud. CEP employs techniques such as detection of complex patterns of many events, event correlation and abstraction, event hierarchies, and relationships between events such as causality, membership, and timing, and event-driven processes.&quot;
"><a href="#t1465787388000102" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:09:48</span>                    devn </span><pre>&quot;Complex Event Processing, or CEP, is primarily an event processing concept that deals with the task of processing multiple events with the goal of identifying the meaningful events within the event cloud. CEP employs techniques such as detection of complex patterns of many events, event correlation and abstraction, event hierarchies, and relationships between events such as causality, membership, and timing, and event-driven processes.&quot;
</pre></div><div id="t1465787417000103" t="2016-06-13 03:10:17 mikerod yeah, that may be the sort of thought you&apos;re thinking about"><a href="#t1465787417000103" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:10:17</span>                 mikerod </span><span>yeah, that may be the sort of thought you&apos;re thinking about</span></div><div id="t1465787439000104" t="2016-06-13 03:10:39 mikerod I know Ryan has said a little on the topic of dealing with temporal &quot;events&quot; as well, but I&apos;m not sure how much its been thought out yet"><a href="#t1465787439000104" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:10:39</span>                 mikerod </span><span>I know Ryan has said a little on the topic of dealing with temporal &quot;events&quot; as well, but I&apos;m not sure how much its been thought out yet</span></div><div id="t1465787481000105" t="2016-06-13 03:11:21 mikerod Clara durability of session state (working memory) is going to be important to the work I&apos;m doing right now, so that should keep progressing.  We haven&apos;t needed anything more complex as of yet."><a href="#t1465787481000105" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:11:21</span>                 mikerod </span><span>Clara durability of session state (working memory) is going to be important to the work I&apos;m doing right now, so that should keep progressing.  We haven&apos;t needed anything more complex as of yet.</span></div><div id="t1465787499000106" t="2016-06-13 03:11:39 mikerod To us, we&apos;ve just thought of retracted facts if things change in the future"><a href="#t1465787499000106" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:11:39</span>                 mikerod </span><span>To us, we&apos;ve just thought of retracted facts if things change in the future</span></div><div id="t1465787518000107" t="2016-06-13 03:11:58 mikerod and inserted a new fact if there was a &quot;change&quot;"><a href="#t1465787518000107" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:11:58</span>                 mikerod </span><span>and inserted a new fact if there was a &quot;change&quot;</span></div><div id="t1465787527000108" t="2016-06-13 03:12:07 mikerod I&apos;m sure this can be limiting if you have more complex use-cases"><a href="#t1465787527000108" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:12:07</span>                 mikerod </span><span>I&apos;m sure this can be limiting if you have more complex use-cases</span></div><div id="t1465787529000109" t="2016-06-13 03:12:09 devn we deal with a lot of sparse data, and so a fair amount of work is done to validate concepts, those concepts are then turned into facts. i&apos;d sort of like to extend rules to the problem of validation and creation of concepts"><a href="#t1465787529000109" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:12:09</span>                    devn </span><span>we deal with a lot of sparse data, and so a fair amount of work is done to validate concepts, those concepts are then turned into facts. i&apos;d sort of like to extend rules to the problem of validation and creation of concepts</span></div><div id="t1465787580000110" t="2016-06-13 03:13:00 mikerod interesting"><a href="#t1465787580000110" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:13:00</span>                 mikerod </span><span>interesting</span></div><div id="t1465787631000111" t="2016-06-13 03:13:51 devn we of course build up concepts inside the engine, too"><a href="#t1465787631000111" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:13:51</span>                    devn </span><span>we of course build up concepts inside the engine, too</span></div><div id="t1465787681000112" t="2016-06-13 03:14:41 devn but there&apos;s a sort of ETL-like process that varies a lot. i imagine a sort of rule-based ETL"><a href="#t1465787681000112" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:14:41</span>                    devn </span><span>but there&apos;s a sort of ETL-like process that varies a lot. i imagine a sort of rule-based ETL</span></div><div id="t1465787693000113" t="2016-06-13 03:14:53 mikerod sounds doable"><a href="#t1465787693000113" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:14:53</span>                 mikerod </span><span>sounds doable</span></div><div id="t1465787738000114" t="2016-06-13 03:15:38 devn yeah, certainly, just haven&apos;t had the stomach for it, because i think there&apos;s tooling i&apos;d want to build to manage this process and have decent visibility into it"><a href="#t1465787738000114" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:15:38</span>                    devn </span><span>yeah, certainly, just haven&apos;t had the stomach for it, because i think there&apos;s tooling i&apos;d want to build to manage this process and have decent visibility into it</span></div><div id="t1465787803000115" t="2016-06-13 03:16:43 mikerod well if you come up with good tooling ideas that&apos;d help on the Clara end, I&apos;m sure we&apos;d all be happy to hear about them"><a href="#t1465787803000115" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:16:43</span>                 mikerod </span><span>well if you come up with good tooling ideas that&apos;d help on the Clara end, I&apos;m sure we&apos;d all be happy to hear about them</span></div><div id="t1465787825000116" t="2016-06-13 03:17:05 devn I mean, I&apos;m as much interested in providing ideas as I am hearing about them."><a href="#t1465787825000116" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:17:05</span>                    devn </span><span>I mean, I&apos;m as much interested in providing ideas as I am hearing about them.</span></div><div id="t1465787849000117" t="2016-06-13 03:17:29 mikerod haha"><a href="#t1465787849000117" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:17:29</span>                 mikerod </span><span>haha</span></div><div id="t1465787864000118" t="2016-06-13 03:17:44 mikerod yeah, visibility is something we should strive for"><a href="#t1465787864000118" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:17:44</span>                 mikerod </span><span>yeah, visibility is something we should strive for</span></div><div id="t1465787887000119" t="2016-06-13 03:18:07 mikerod our current push this release round is probably going to center on performance and then this durability thing"><a href="#t1465787887000119" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:18:07</span>                 mikerod </span><span>our current push this release round is probably going to center on performance and then this durability thing</span></div><div id="t1465787919000120" t="2016-06-13 03:18:39 devn As I said, I don&apos;t feel like I have a good enough handle on internals to say: &quot;here&apos;s a great idea!&quot; because I worry that the performance overhead will be insane, or that i&apos;ll be unable to capture some key piece of information necessary to the idea without reworking some significant piece of Clara"><a href="#t1465787919000120" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:18:39</span>                    devn </span><span>As I said, I don&apos;t feel like I have a good enough handle on internals to say: &quot;here&apos;s a great idea!&quot; because I worry that the performance overhead will be insane, or that i&apos;ll be unable to capture some key piece of information necessary to the idea without reworking some significant piece of Clara</span></div><div id="t1465787935000121" t="2016-06-13 03:18:55 mikerod but thinking more on what can be done for visualization, &quot;explainability&quot;, etc should stay imoprtant"><a href="#t1465787935000121" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:18:55</span>                 mikerod </span><span>but thinking more on what can be done for visualization, &quot;explainability&quot;, etc should stay imoprtant</span></div><div id="t1465787962000122" t="2016-06-13 03:19:22 devn the explanation piece is one of many reasons why we chose a rules engine"><a href="#t1465787962000122" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:19:22</span>                    devn </span><span>the explanation piece is one of many reasons why we chose a rules engine</span></div><div id="t1465787966000123" t="2016-06-13 03:19:26 devn but it&apos;s a really, really big one"><a href="#t1465787966000123" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:19:26</span>                    devn </span><span>but it&apos;s a really, really big one</span></div><div id="t1465787985000124" t="2016-06-13 03:19:45 mikerod https://github.com/rbrush/clara-rules/blob/master/src/main/clojure/clara/rules/listener.cljc"><a href="#t1465787985000124" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:19:45</span>                 mikerod </span><a href="https://github.com/rbrush/clara-rules/blob/master/src/main/clojure/clara/rules/listener.cljc" target="_blank">https://github.com/rbrush/clara-rules/blob/master/src/main/clojure/clara/rules/listener.cljc</a></div><div id="t1465787997000126" t="2016-06-13 03:19:57 mikerod the listener stuff here has some leverage"><a href="#t1465787997000126" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:19:57</span>                 mikerod </span><span>the listener stuff here has some leverage</span></div><div id="t1465788006000127" t="2016-06-13 03:20:06 devn it&apos;s extremely important for us to say: &quot;We recommend these actions based on the following information related to the patient, provider, etc.&quot;"><a href="#t1465788006000127" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:20:06</span>                    devn </span><span>it&apos;s extremely important for us to say: &quot;We recommend these actions based on the following information related to the patient, provider, etc.&quot;</span></div><div id="t1465788022000128" t="2016-06-13 03:20:22 mikerod mostly just keeping tracing sort of information in data structures that can be hooked on by whatever tooling"><a href="#t1465788022000128" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:20:22</span>                 mikerod </span><span>mostly just keeping tracing sort of information in data structures that can be hooked on by whatever tooling</span></div><div id="t1465788022000129" t="2016-06-13 03:20:22 devn with a sort of decision tree that people with a clinical background can use to validate those recommendations"><a href="#t1465788022000129" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:20:22</span>                    devn </span><span>with a sort of decision tree that people with a clinical background can use to validate those recommendations</span></div><div id="t1465788039000130" t="2016-06-13 03:20:39 mikerod devn: yeah, we&apos;ve had similar sort of use-cases with rules"><a href="#t1465788039000130" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:20:39</span>                 mikerod </span><span>devn: yeah, we&apos;ve had similar sort of use-cases with rules</span></div><div id="t1465788058000131" t="2016-06-13 03:20:58 mikerod so far, what we&apos;ve mostly done - which has been sufficient - was to just show the support &quot;chain&quot;"><a href="#t1465788058000131" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:20:58</span>                 mikerod </span><span>so far, what we&apos;ve mostly done - which has been sufficient - was to just show the support &quot;chain&quot;</span></div><div id="t1465788070000132" t="2016-06-13 03:21:10 mikerod we either manually write rules to do so, or we built some automatic helpers around insert&apos;s"><a href="#t1465788070000132" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:21:10</span>                 mikerod </span><span>we either manually write rules to do so, or we built some automatic helpers around insert&apos;s</span></div><div id="t1465788119000133" t="2016-06-13 03:21:59 mikerod (defrule my-rule [?s &lt;- SomeFact] =&gt; (insert! (map-&gt;AnotherFact {:something blah :support [?s]})))"><a href="#t1465788119000133" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:21:59</span>                 mikerod </span><code>(defrule my-rule [?s &lt;- SomeFact] =&gt; (insert! (map-&gt;AnotherFact {:something blah :support [?s]})))</code></div><div id="t1465788121000134" t="2016-06-13 03:22:01 devn I committed some code as part of an early spike on clara which added a  :contributing-factors {}  k/v in the RHS"><a href="#t1465788121000134" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:22:01</span>                    devn </span><span>I committed some code as part of an early spike on clara which added a </span><code>:contributing-factors {}</code><span> k/v in the RHS</span></div><div id="t1465788126000135" t="2016-06-13 03:22:06 devn ha! so i&apos;m not crazy!"><a href="#t1465788126000135" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:22:06</span>                    devn </span><span>ha! so i&apos;m not crazy!</span></div><div id="t1465788143000136" t="2016-06-13 03:22:23 mikerod yes, we have implemented some ideas around this.  not in Clara directly, just in our own projects"><a href="#t1465788143000136" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:22:23</span>                 mikerod </span><span>yes, we have implemented some ideas around this.  not in Clara directly, just in our own projects</span></div><div id="t1465788146000137" t="2016-06-13 03:22:26 devn i&apos;ve been looking at that sideways and thinking: hmmm, this feels weird to me"><a href="#t1465788146000137" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:22:26</span>                    devn </span><span>i&apos;ve been looking at that sideways and thinking: hmmm, this feels weird to me</span></div><div id="t1465788167000138" t="2016-06-13 03:22:47 devn particularly because over the course of the &quot;chain&quot;, things can get a little sticky"><a href="#t1465788167000138" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:22:47</span>                    devn </span><span>particularly because over the course of the &quot;chain&quot;, things can get a little sticky</span></div><div id="t1465788168000139" t="2016-06-13 03:22:48 mikerod we&apos;ve defined protocols or something as well that can sort of walk the &quot;contributing facts&quot; chain"><a href="#t1465788168000139" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:22:48</span>                 mikerod </span><span>we&apos;ve defined protocols or something as well that can sort of walk the &quot;contributing facts&quot; chain</span></div><div id="t1465788184000140" t="2016-06-13 03:23:04 devn you might need to merge multiple :contributing-factors across the results of queries in order to get the real picture"><a href="#t1465788184000140" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:23:04</span>                    devn </span><span>you might need to merge multiple :contributing-factors across the results of queries in order to get the real picture</span></div><div id="t1465788190000141" t="2016-06-13 03:23:10 mikerod yeah"><a href="#t1465788190000141" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:23:10</span>                 mikerod </span><span>yeah</span></div><div id="t1465788192000142" t="2016-06-13 03:23:12 devn and then you have to wrestle with order"><a href="#t1465788192000142" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:23:12</span>                    devn </span><span>and then you have to wrestle with order</span></div><div id="t1465788199000143" t="2016-06-13 03:23:19 mikerod visualizing it int he end can get interesting"><a href="#t1465788199000143" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:23:19</span>                 mikerod </span><span>visualizing it int he end can get interesting</span></div><div id="t1465788208000144" t="2016-06-13 03:23:28 devn or overwhelming  😄"><a href="#t1465788208000144" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:23:28</span>                    devn </span><span>or overwhelming </span><b>😄</b></div><div id="t1465788216000145" t="2016-06-13 03:23:36 mikerod yeah"><a href="#t1465788216000145" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:23:36</span>                 mikerod </span><span>yeah</span></div><div id="t1465788236000146" t="2016-06-13 03:23:56 mikerod we&apos;ve sort of just &quot;flattened&quot; the chain up to certain points where there is a meaningful user-defined name"><a href="#t1465788236000146" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:23:56</span>                 mikerod </span><span>we&apos;ve sort of just &quot;flattened&quot; the chain up to certain points where there is a meaningful user-defined name</span></div><div id="t1465788239000147" t="2016-06-13 03:23:59 devn or at least, the visualizations ive come up with are like: oh god, no nurse is ever going to look at this"><a href="#t1465788239000147" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:23:59</span>                    devn </span><span>or at least, the visualizations ive come up with are like: oh god, no nurse is ever going to look at this</span></div><div id="t1465788267000148" t="2016-06-13 03:24:27 mikerod so it&apos;s sort of hierarchical, but flattened out just to where we have some sort of meaningful name to show end-users"><a href="#t1465788267000148" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:24:27</span>                 mikerod </span><span>so it&apos;s sort of hierarchical, but flattened out just to where we have some sort of meaningful name to show end-users</span></div><div id="t1465788270000149" t="2016-06-13 03:24:30 devn @mikerod: yeah, i think i was close, but the user-defined name is important"><a href="#t1465788270000149" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:24:30</span>                    devn </span><span>@mikerod: yeah, i think i was close, but the user-defined name is important</span></div><div id="t1465788299000150" t="2016-06-13 03:24:59 devn InternalRecordThatExposesImplementationDetails {?x 1, ...}  =&gt; no bueno"><a href="#t1465788299000150" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:24:59</span>                    devn </span><code>InternalRecordThatExposesImplementationDetails {?x 1, ...}</code><span> =&gt; no bueno</span></div><div id="t1465788307000151" t="2016-06-13 03:25:07 mikerod yeah, definitely don&apos;t want that"><a href="#t1465788307000151" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:25:07</span>                 mikerod </span><span>yeah, definitely don&apos;t want that</span></div><div id="t1465788333000152" t="2016-06-13 03:25:33 devn the bindings which wind up being worth a damn, again due to sparse data, can be troublesome also"><a href="#t1465788333000152" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:25:33</span>                    devn </span><span>the bindings which wind up being worth a damn, again due to sparse data, can be troublesome also</span></div><div id="t1465788344000153" t="2016-06-13 03:25:44 mikerod yep"><a href="#t1465788344000153" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:25:44</span>                 mikerod </span><span>yep</span></div><div id="t1465788346000154" t="2016-06-13 03:25:46 devn you don&apos;t want to expose bindings which didn&apos;t matter at a particular conceptual level"><a href="#t1465788346000154" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:25:46</span>                    devn </span><span>you don&apos;t want to expose bindings which didn&apos;t matter at a particular conceptual level</span></div><div id="t1465788353000155" t="2016-06-13 03:25:53 devn but then, they turn out to be valuable in some future rule"><a href="#t1465788353000155" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:25:53</span>                    devn </span><span>but then, they turn out to be valuable in some future rule</span></div><div id="t1465788358000156" t="2016-06-13 03:25:58 mikerod yeah, so it is hard to automate and just assume &quot;all bindings&quot;"><a href="#t1465788358000156" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:25:58</span>                 mikerod </span><span>yeah, so it is hard to automate and just assume &quot;all bindings&quot;</span></div><div id="t1465788382000157" t="2016-06-13 03:26:22 mikerod you could mark fact types in some way or another htat are &quot;internal details&quot; vs meaningful though"><a href="#t1465788382000157" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:26:22</span>                 mikerod </span><span>you could mark fact types in some way or another htat are &quot;internal details&quot; vs meaningful though</span></div><div id="t1465788427000158" t="2016-06-13 03:27:07 mikerod (defrule [?f &lt;- ImplDetailThing] [?f2 &lt;- Meaningful] =&gt; (insert! (map-&gt;Fact {:val something :support [?f ?f2]})))"><a href="#t1465788427000158" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:27:07</span>                 mikerod </span><code>(defrule [?f &lt;- ImplDetailThing] [?f2 &lt;- Meaningful] =&gt; (insert! (map-&gt;Fact {:val something :support [?f ?f2]})))</code></div><div id="t1465788429000159" t="2016-06-13 03:27:09 devn I&apos;m now generating records (using eval, don&apos;t hate me) that pull from a big old map of domain concepts =&gt; data definitions"><a href="#t1465788429000159" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:27:09</span>                    devn </span><span>I&apos;m now generating records (using eval, don&apos;t hate me) that pull from a big old map of domain concepts =&gt; data definitions</span></div><div id="t1465788434000160" t="2016-06-13 03:27:14 mikerod so just like automate attaching all bindings as support"><a href="#t1465788434000160" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:27:14</span>                 mikerod </span><span>so just like automate attaching all bindings as support</span></div><div id="t1465788448000161" t="2016-06-13 03:27:28 mikerod but then when walking the chain later, dropping out stuff in the chain/tree that isn&apos;t useful"><a href="#t1465788448000161" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:27:28</span>                 mikerod </span><span>but then when walking the chain later, dropping out stuff in the chain/tree that isn&apos;t useful</span></div><div id="t1465788449000162" t="2016-06-13 03:27:29 devn @mikerod: ah, that&apos;s a good idea."><a href="#t1465788449000162" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:27:29</span>                    devn </span><span>@mikerod: ah, that&apos;s a good idea.</span></div><div id="t1465788469000163" t="2016-06-13 03:27:49 devn haven&apos;t played with a specific fact type"><a href="#t1465788469000163" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:27:49</span>                    devn </span><span>haven&apos;t played with a specific fact type</span></div><div id="t1465788475000164" t="2016-06-13 03:27:55 devn (for capturing the meaningful bits)"><a href="#t1465788475000164" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:27:55</span>                    devn </span><span>(for capturing the meaningful bits)</span></div><div id="t1465788500000165" t="2016-06-13 03:28:20 mikerod yeah, could think of a protocol like ISupported (depending on how you like to name things)"><a href="#t1465788500000165" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:28:20</span>                 mikerod </span><span>yeah, could think of a protocol like ISupported (depending on how you like to name things)</span></div><div id="t1465788501000166" t="2016-06-13 03:28:21 devn i wonder: any ideas on a query that pulls &quot;ordered&quot; Meaningful facts?"><a href="#t1465788501000166" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:28:21</span>                    devn </span><span>i wonder: any ideas on a query that pulls &quot;ordered&quot; Meaningful facts?</span></div><div id="t1465788520000167" t="2016-06-13 03:28:40 mikerod yeah, not sure on ordered, unless you had somehting to order by"><a href="#t1465788520000167" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:28:40</span>                 mikerod </span><span>yeah, not sure on ordered, unless you had somehting to order by</span></div><div id="t1465788535000168" t="2016-06-13 03:28:55 mikerod generating records with eval sounds fun  😛"><a href="#t1465788535000168" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:28:55</span>                 mikerod </span><span>generating records with eval sounds fun </span><b>😛</b></div><div id="t1465788537000169" t="2016-06-13 03:28:57 devn right, but i mean, i am willing to throw some of my pride away"><a href="#t1465788537000169" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:28:57</span>                    devn </span><span>right, but i mean, i am willing to throw some of my pride away</span></div><div id="t1465788552000170" t="2016-06-13 03:29:12 mikerod it may make sense if you are syaing you are trying to make data types dynamically driven off of config"><a href="#t1465788552000170" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:29:12</span>                 mikerod </span><span>it may make sense if you are syaing you are trying to make data types dynamically driven off of config</span></div><div id="t1465788555000171" t="2016-06-13 03:29:15 devn so an atom per session that increments using the RHS of rules could work, maybe"><a href="#t1465788555000171" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:29:15</span>                    devn </span><span>so an atom per session that increments using the RHS of rules could work, maybe</span></div><div id="t1465788569000172" t="2016-06-13 03:29:29 mikerod yeah, maybe something like a counter"><a href="#t1465788569000172" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:29:29</span>                 mikerod </span><span>yeah, maybe something like a counter</span></div><div id="t1465788583000173" t="2016-06-13 03:29:43 mikerod just be aware the the rules engine has some liberties it can take as far as when it fires rules"><a href="#t1465788583000173" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:29:43</span>                 mikerod </span><span>just be aware the the rules engine has some liberties it can take as far as when it fires rules</span></div><div id="t1465788601000174" t="2016-06-13 03:30:01 mikerod rules may fire in different orders due to non-determinism (we&apos;d like to minimize), optimizations, etc"><a href="#t1465788601000174" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:30:01</span>                 mikerod </span><span>rules may fire in different orders due to non-determinism (we&apos;d like to minimize), optimizations, etc</span></div><div id="t1465788625000175" t="2016-06-13 03:30:25 devn yeah, i desperately avoid order where i can"><a href="#t1465788625000175" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:30:25</span>                    devn </span><span>yeah, i desperately avoid order where i can</span></div><div id="t1465788644000176" t="2016-06-13 03:30:44 mikerod just never get too reliant on rule order unless you have logical rule order that with eventually be consistent due to truth maintanence"><a href="#t1465788644000176" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:30:44</span>                 mikerod </span><span>just never get too reliant on rule order unless you have logical rule order that with eventually be consistent due to truth maintanence</span></div><div id="t1465788662000177" t="2016-06-13 03:31:02 devn i&apos;d rather not ever pay the cost of needing to think about that"><a href="#t1465788662000177" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:31:02</span>                    devn </span><span>i&apos;d rather not ever pay the cost of needing to think about that</span></div><div id="t1465788664000178" t="2016-06-13 03:31:04 mikerod and  :salience  when desperate"><a href="#t1465788664000178" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:31:04</span>                 mikerod </span><span>and </span><code>:salience</code><span> when desperate</span></div><div id="t1465788670000179" t="2016-06-13 03:31:10 mikerod yeah, it is complexity"><a href="#t1465788670000179" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:31:10</span>                 mikerod </span><span>yeah, it is complexity</span></div><div id="t1465788680000180" t="2016-06-13 03:31:20 mikerod and ruins the declarative nature of the rules"><a href="#t1465788680000180" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:31:20</span>                 mikerod </span><span>and ruins the declarative nature of the rules</span></div><div id="t1465788695000181" t="2016-06-13 03:31:35 mikerod and eventually becomes brittle when you get many rules involved etc"><a href="#t1465788695000181" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:31:35</span>                 mikerod </span><span>and eventually becomes brittle when you get many rules involved etc</span></div><div id="t1465788713000182" t="2016-06-13 03:31:53 mikerod we certainly often see rules with logical dependencies between each other though"><a href="#t1465788713000182" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:31:53</span>                 mikerod </span><span>we certainly often see rules with logical dependencies between each other though</span></div><div id="t1465788754000183" t="2016-06-13 03:32:34 mikerod (defrule rule-1 [MyFact] =&gt; (insert! (-&gt;AnotherFact )))  (defrule rule-2 [:not [AnotherFact]] =&gt; (insert! (-&gt;AlternativeFact)))` etc"><a href="#t1465788754000183" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:32:34</span>                 mikerod </span><code>(defrule rule-1 [MyFact] =&gt; (insert! (-&gt;AnotherFact )))</code><span> (defrule rule-2 [:not [AnotherFact]] =&gt; (insert! (-&gt;AlternativeFact)))` etc</span></div><div id="t1465788761000184" t="2016-06-13 03:32:41 mikerod but I think that is obvous usages"><a href="#t1465788761000184" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:32:41</span>                 mikerod </span><span>but I think that is obvous usages</span></div><div id="t1465788765000185" t="2016-06-13 03:32:45 devn yes, that&apos;s really what we deal with, but i do worry a bit that if that&apos;s not the case in the future, we&apos;re going to be sad pandas"><a href="#t1465788765000185" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:32:45</span>                    devn </span><span>yes, that&apos;s really what we deal with, but i do worry a bit that if that&apos;s not the case in the future, we&apos;re going to be sad pandas</span></div><div id="t1465788776000186" t="2016-06-13 03:32:56 devn 99% of our stuff is a DAG"><a href="#t1465788776000186" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:32:56</span>                    devn </span><span>99% of our stuff is a DAG</span></div><div id="t1465788791000187" t="2016-06-13 03:33:11 mikerod yep"><a href="#t1465788791000187" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:33:11</span>                 mikerod </span><span>yep</span></div><div id="t1465788793000188" t="2016-06-13 03:33:13 devn err let&apos;s go with 90%"><a href="#t1465788793000188" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:33:13</span>                    devn </span><span>err let&apos;s go with 90%</span></div><div id="t1465788795000189" t="2016-06-13 03:33:15 devn 😉"><a href="#t1465788795000189" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:33:15</span>                    devn </span><b>😉</b></div><div id="t1465788797000190" t="2016-06-13 03:33:17 mikerod hah"><a href="#t1465788797000190" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:33:17</span>                 mikerod </span><span>hah</span></div><div id="t1465788804000191" t="2016-06-13 03:33:24 mikerod well, I&apos;m logging off for the night though."><a href="#t1465788804000191" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:33:24</span>                 mikerod </span><span>well, I&apos;m logging off for the night though.</span></div><div id="t1465788808000192" t="2016-06-13 03:33:28 devn yeah, same here"><a href="#t1465788808000192" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:33:28</span>                    devn </span><span>yeah, same here</span></div><div id="t1465788816000193" t="2016-06-13 03:33:36 mikerod good talking with you.  It&apos;s nice to hear of others use-cases etc."><a href="#t1465788816000193" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:33:36</span>                 mikerod </span><span>good talking with you.  It&apos;s nice to hear of others use-cases etc.</span></div><div id="t1465788836000194" t="2016-06-13 03:33:56 mikerod Have a good night!"><a href="#t1465788836000194" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:33:56</span>                 mikerod </span><span>Have a good night!</span></div><div id="t1465788841000195" t="2016-06-13 03:34:01 devn appreciate the conversation, and am pleased to hear that i&apos;m not the only one who&apos;s doing this whole :support thing. people on our team just started using it"><a href="#t1465788841000195" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:34:01</span>                    devn </span><span>appreciate the conversation, and am pleased to hear that i&apos;m not the only one who&apos;s doing this whole :support thing. people on our team just started using it</span></div><div id="t1465788848000196" t="2016-06-13 03:34:08 devn and i was like: oh god, did i just open pandora&apos;s box?"><a href="#t1465788848000196" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:34:08</span>                    devn </span><span>and i was like: oh god, did i just open pandora&apos;s box?</span></div><div id="t1465788854000197" t="2016-06-13 03:34:14 mikerod 😛"><a href="#t1465788854000197" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:34:14</span>                 mikerod </span><b>😛</b></div><div id="t1465788856000198" t="2016-06-13 03:34:16 devn but it&apos;s been doing the job, so ¯\(ツ)/¯"><a href="#t1465788856000198" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:34:16</span>                    devn </span><span>but it&apos;s been doing the job, so ¯\(ツ)/¯</span></div><div id="t1465788862000199" t="2016-06-13 03:34:22 devn anyway, have a good night, see you around  🙂"><a href="#t1465788862000199" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:34:22</span>                    devn </span><span>anyway, have a good night, see you around </span><b>🙂</b></div><div id="t1465788864000200" t="2016-06-13 03:34:24 devn 👋"><a href="#t1465788864000200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">03:34:24</span>                    devn </span><b>👋</b></div><div id="t1465855157000201" t="2016-06-13 21:59:17 wparker @devn: FWIW, I agree with Mike that the engine and (I’ll add) the memory are probably the best places to start.  When I was first getting familiar with the internals of Clara I found it useful, and still do if I’m unsure of what some rule will look like in the network, to just create a session from that rule and look at the rulebase generated.  That is, something like (-&gt; (mk-session [rule-in-question] :cache false) .rulebase :alpha-roots) and just poke around the rules network generated."><a href="#t1465855157000201" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">21:59:17</span>                 wparker </span><span>@devn: FWIW, I agree with Mike that the engine and (I’ll add) the memory are probably the best places to start.  When I was first getting familiar with the internals of Clara I found it useful, and still do if I’m unsure of what some rule will look like in the network, to just create a session from that rule and look at the rulebase generated.  That is, something like (-&gt; (mk-session [rule-in-question] :cache false) .rulebase :alpha-roots) and just poke around the rules network generated.</span></div><div id="t1465855252000202" t="2016-06-13 22:00:52 wparker I’ve found that if I’m not dealing with the compiler, it is very possible to just deal with the rules network and forget where it came from.  The memory is even more isolated in some ways in that it mostly is just a composite data structure, albeit one very much tailored to the needs of the engine."><a href="#t1465855252000202" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">22:00:52</span>                 wparker </span><span>I’ve found that if I’m not dealing with the compiler, it is very possible to just deal with the rules network and forget where it came from.  The memory is even more isolated in some ways in that it mostly is just a composite data structure, albeit one very much tailored to the needs of the engine.</span></div><div id="t1465855333000203" t="2016-06-13 22:02:13 wparker The reason I put the :alpha-roots in the call above is that facts inserted start there and propagate downward to the children of those alpha-roots"><a href="#t1465855333000203" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-06-13</span> <span class="t" onclick="H(this)">22:02:13</span>                 wparker </span><span>The reason I put the :alpha-roots in the call above is that facts inserted start there and propagate downward to the children of those alpha-roots</span></div><div id="t1467878277000206" t="2016-07-07 07:57:57 raymcdermott anyone using the durability feature? want to try it out on heroku with redis as a backend, wondering if there are any experience reports out there"><a href="#t1467878277000206" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-07-07</span> <span class="t" onclick="H(this)">07:57:57</span>            raymcdermott </span><span>anyone using the durability feature? want to try it out on heroku with redis as a backend, wondering if there are any experience reports out there</span></div><div id="t1467878305000207" t="2016-07-07 07:58:25 raymcdermott also @ryanbrush I note that the durability feature is experimental"><a href="#t1467878305000207" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-07-07</span> <span class="t" onclick="H(this)">07:58:25</span>            raymcdermott </span><span>also @ryanbrush I note that the durability feature is experimental</span></div><div id="t1467878357000208" t="2016-07-07 07:59:17 raymcdermott what is your thinking about what extra work needs doing there to conclude the experiment?"><a href="#t1467878357000208" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-07-07</span> <span class="t" onclick="H(this)">07:59:17</span>            raymcdermott </span><span>what is your thinking about what extra work needs doing there to conclude the experiment?</span></div><div id="t1467911329000210" t="2016-07-07 17:08:49 wparker @raymcdermott: The current durability implementation has some significant problems that are described at  https://github.com/rbrush/clara-rules/issues/198  .  Please feel free to ask questions here or there if anything is unclear.  @mikerod is working on a more robust durability implementation that will be targeted at speed of rule execution after deserialization; I’ll let him speak to the current state of that.  Do you mind elaborating a bit on your use-case for durability?  For less taxing use cases performance-wise just re-executing the rules from your serialized facts might well be a good approach."><a href="#t1467911329000210" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-07-07</span> <span class="t" onclick="H(this)">17:08:49</span>                 wparker </span><span>@raymcdermott: The current durability implementation has some significant problems that are described at </span><a href="https://github.com/rbrush/clara-rules/issues/198" target="_blank">https://github.com/rbrush/clara-rules/issues/198</a><span> .  Please feel free to ask questions here or there if anything is unclear.  @mikerod is working on a more robust durability implementation that will be targeted at speed of rule execution after deserialization; I’ll let him speak to the current state of that.  Do you mind elaborating a bit on your use-case for durability?  For less taxing use cases performance-wise just re-executing the rules from your serialized facts might well be a good approach.</span></div><div id="t1467914051000212" t="2016-07-07 17:54:11 mikerod raymcdermott: I’d definitely say to suspect the durability of Clara to get a full overhaul. What is there right now hasn’t really been maintained and probably will fail or produce incorrect results for modern-day Clara sessions."><a href="#t1467914051000212" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-07-07</span> <span class="t" onclick="H(this)">17:54:11</span>                 mikerod </span><span>raymcdermott: I’d definitely say to suspect the durability of Clara to get a full overhaul. What is there right now hasn’t really been maintained and probably will fail or produce incorrect results for modern-day Clara sessions.</span></div><div id="t1467914071000213" t="2016-07-07 17:54:31 mikerod I’d definitely recommend reading through  https://github.com/rbrush/clara-rules/issues/198  and I’d really like to know if these goals align with what you’d want out of it"><a href="#t1467914071000213" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-07-07</span> <span class="t" onclick="H(this)">17:54:31</span>                 mikerod </span><span>I’d definitely recommend reading through </span><a href="https://github.com/rbrush/clara-rules/issues/198" target="_blank">https://github.com/rbrush/clara-rules/issues/198</a><span> and I’d really like to know if these goals align with what you’d want out of it</span></div><div id="t1467914079000214" t="2016-07-07 17:54:39 mikerod (ass Will said above)"><a href="#t1467914079000214" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-07-07</span> <span class="t" onclick="H(this)">17:54:39</span>                 mikerod </span><span>(ass Will said above)</span></div><div id="t1467914083000215" t="2016-07-07 17:54:43 mikerod as*  😛"><a href="#t1467914083000215" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-07-07</span> <span class="t" onclick="H(this)">17:54:43</span>                 mikerod </span><span>as* </span><b>😛</b></div><div id="t1467921300000216" t="2016-07-07 19:55:00 raymcdermott k thanks - will take a look and give some feedback"><a href="#t1467921300000216" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-07-07</span> <span class="t" onclick="H(this)">19:55:00</span>            raymcdermott </span><span>k thanks - will take a look and give some feedback</span></div><div id="t1467921946000217" t="2016-07-07 20:05:46 raymcdermott Serialising facts using transit out to REDIS would be enough in my case. I can imagine that vast rulesets would benefits but its not the case for my first set of use cases."><a href="#t1467921946000217" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-07-07</span> <span class="t" onclick="H(this)">20:05:46</span>            raymcdermott </span><span>Serialising facts using transit out to REDIS would be enough in my case. I can imagine that vast rulesets would benefits but its not the case for my first set of use cases.</span></div><div id="t1467922046000218" t="2016-07-07 20:07:26 raymcdermott I want to make a simple way to check a web user&apos;s disposition based on a small number of rules"><a href="#t1467922046000218" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-07-07</span> <span class="t" onclick="H(this)">20:07:26</span>            raymcdermott </span><span>I want to make a simple way to check a web user&apos;s disposition based on a small number of rules</span></div><div id="t1467922120000219" t="2016-07-07 20:08:40 raymcdermott with Heroku any dyno should be able to answer any query and obtaining the facts from the back-end should be kept to a minimum, hence REDIS"><a href="#t1467922120000219" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-07-07</span> <span class="t" onclick="H(this)">20:08:40</span>            raymcdermott </span><span>with Heroku any dyno should be able to answer any query and obtaining the facts from the back-end should be kept to a minimum, hence REDIS</span></div><div id="t1467922335000220" t="2016-07-07 20:12:15 raymcdermott was also thinking that I could keep the data in a memoized set since I’m not talking about a huge number of user sessions and I can limit the size of the set with the help of core.memoize"><a href="#t1467922335000220" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-07-07</span> <span class="t" onclick="H(this)">20:12:15</span>            raymcdermott </span><span>was also thinking that I could keep the data in a memoized set since I’m not talking about a huge number of user sessions and I can limit the size of the set with the help of core.memoize</span></div><div id="t1467922377000221" t="2016-07-07 20:12:57 raymcdermott so it’s good to understand where the work is happening  🙂"><a href="#t1467922377000221" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-07-07</span> <span class="t" onclick="H(this)">20:12:57</span>            raymcdermott </span><span>so it’s good to understand where the work is happening </span><b>🙂</b></div><div id="t1467930692000222" t="2016-07-07 22:31:32 wparker Yeah, if you’re OK with just running everything again to retrieve your state performance-wise that would probably be easiest.  You’d want to just use your top-level input of course or account for the use of generated facts in your rules of course; inserting logically generated facts by Clara back into a session that then generates facts not in the original session is a problem with the current durability implementation as Mike mentions in that issue.  Regarding the number of user sessions, just in case you don’t know, Clara sessions are immutable so you can just have a single base session without user-session-specific facts that you then add things into."><a href="#t1467930692000222" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-07-07</span> <span class="t" onclick="H(this)">22:31:32</span>                 wparker </span><span>Yeah, if you’re OK with just running everything again to retrieve your state performance-wise that would probably be easiest.  You’d want to just use your top-level input of course or account for the use of generated facts in your rules of course; inserting logically generated facts by Clara back into a session that then generates facts not in the original session is a problem with the current durability implementation as Mike mentions in that issue.  Regarding the number of user sessions, just in case you don’t know, Clara sessions are immutable so you can just have a single base session without user-session-specific facts that you then add things into.</span></div><div id="t1467960551000223" t="2016-07-08 06:49:11 raymcdermott To play that back my understanding is that I create an empty session (as in  (def empty-session (mk-session)) ) and insert facts on a per customer basis and fire the rules per customer - I hope that’s what you mean. If not, I would like to understand more!"><a href="#t1467960551000223" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-07-08</span> <span class="t" onclick="H(this)">06:49:11</span>            raymcdermott </span><span>To play that back my understanding is that I create an empty session (as in </span><code>(def empty-session (mk-session))</code><span>) and insert facts on a per customer basis and fire the rules per customer - I hope that’s what you mean. If not, I would like to understand more!</span></div><div id="t1467960713000224" t="2016-07-08 06:51:53 raymcdermott the issue seems to revolve around cases where side effects or where establishing truth is expensive in complex sessions but I don’t have that issue - my case is very much operating like a pure function where Clara is simply used to improve expressivity"><a href="#t1467960713000224" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-07-08</span> <span class="t" onclick="H(this)">06:51:53</span>            raymcdermott </span><span>the issue seems to revolve around cases where side effects or where establishing truth is expensive in complex sessions but I don’t have that issue - my case is very much operating like a pure function where Clara is simply used to improve expressivity</span></div><div id="t1467961957000225" t="2016-07-08 07:12:37 raymcdermott dumb question - are the facts from previous sessions GCd? If not, must I retract them? It would be simpler to take the hit on running mksession every time and TBH I have not profiled that so maybe it’s also not such a biggie!"><a href="#t1467961957000225" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-07-08</span> <span class="t" onclick="H(this)">07:12:37</span>            raymcdermott </span><span>dumb question - are the facts from previous sessions GCd? If not, must I retract them? It would be simpler to take the hit on running mksession every time and TBH I have not profiled that so maybe it’s also not such a biggie!</span></div><div id="t1467987489000226" t="2016-07-08 14:18:09 wparker @raymcdermott:  Clara sessions are intended to be data structures that obey Clojure idioms, that is, they are value-based and immutable.  When you insert a fact into a session, a new session is returned that is independent of the previous session.  So, for example, if you create an empty session and insert a fact into it, the original empty session still exists and can be reused.   I created a quick demo of this at  https://gist.github.com/WilliamParker/c6be14cb249d55b6d2e3ff42500a9334"><a href="#t1467987489000226" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-07-08</span> <span class="t" onclick="H(this)">14:18:09</span>                 wparker </span><span>@raymcdermott:  Clara sessions are intended to be data structures that obey Clojure idioms, that is, they are value-based and immutable.  When you insert a fact into a session, a new session is returned that is independent of the previous session.  So, for example, if you create an empty session and insert a fact into it, the original empty session still exists and can be reused.   I created a quick demo of this at </span><a href="https://gist.github.com/WilliamParker/c6be14cb249d55b6d2e3ff42500a9334" target="_blank">https://gist.github.com/WilliamParker/c6be14cb249d55b6d2e3ff42500a9334</a></div><div id="t1467987659000227" t="2016-07-08 14:20:59 wparker The “com/clear-session-cache!” clears a cache of created sessions that Clara automatically creates unless it is explicitly turned off.  The sessions without facts are cached by Clara on the set of rules, queries, and session options to save compilation time.  However, this cache should never contain sessions with facts.  The relevant code for that cache is at  https://github.com/rbrush/clara-rules/blob/0.11.1/src/main/clojure/clara/rules/compiler.clj#L1530"><a href="#t1467987659000227" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-07-08</span> <span class="t" onclick="H(this)">14:20:59</span>                 wparker </span><span>The “com/clear-session-cache!” clears a cache of created sessions that Clara automatically creates unless it is explicitly turned off.  The sessions without facts are cached by Clara on the set of rules, queries, and session options to save compilation time.  However, this cache should never contain sessions with facts.  The relevant code for that cache is at </span><a href="https://github.com/rbrush/clara-rules/blob/0.11.1/src/main/clojure/clara/rules/compiler.clj#L1530" target="_blank">https://github.com/rbrush/clara-rules/blob/0.11.1/src/main/clojure/clara/rules/compiler.clj#L1530</a></div><div id="t1467987710000229" t="2016-07-08 14:21:50 wparker Clara should only maintain references to facts through sessions.  Once all sessions containing a given fact are GC’able then that fact itself should be GC’able as far as Clara is concerned."><a href="#t1467987710000229" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-07-08</span> <span class="t" onclick="H(this)">14:21:50</span>                 wparker </span><span>Clara should only maintain references to facts through sessions.  Once all sessions containing a given fact are GC’able then that fact itself should be GC’able as far as Clara is concerned.</span></div><div id="t1467987809000230" t="2016-07-08 14:23:29 wparker To clarify too, Clara doesn’t copy the facts between sessions that contain them; if you have a session that contains FactA and then you insert FactB in it you’ll have two sessions that both contain a reference to the same FactA object.  Clara expects that facts won’t be mutated after insertion."><a href="#t1467987809000230" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-07-08</span> <span class="t" onclick="H(this)">14:23:29</span>                 wparker </span><span>To clarify too, Clara doesn’t copy the facts between sessions that contain them; if you have a session that contains FactA and then you insert FactB in it you’ll have two sessions that both contain a reference to the same FactA object.  Clara expects that facts won’t be mutated after insertion.</span></div><div id="t1468001117000231" t="2016-07-08 18:05:17 raymcdermott thanks - I appreciate the effort put into your answer"><a href="#t1468001117000231" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-07-08</span> <span class="t" onclick="H(this)">18:05:17</span>            raymcdermott </span><span>thanks - I appreciate the effort put into your answer</span></div><div id="t1468001150000232" t="2016-07-08 18:05:50 raymcdermott it’s also nice to see answers from two people that are not @ryanbrush  😉"><a href="#t1468001150000232" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-07-08</span> <span class="t" onclick="H(this)">18:05:50</span>            raymcdermott </span><span>it’s also nice to see answers from two people that are not @ryanbrush </span><b>😉</b></div><div id="t1468001186000233" t="2016-07-08 18:06:26 raymcdermott seriously, I&apos;m a fan and it’s good to see the community growing"><a href="#t1468001186000233" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-07-08</span> <span class="t" onclick="H(this)">18:06:26</span>            raymcdermott </span><span>seriously, I&apos;m a fan and it’s good to see the community growing</span></div><div id="t1468084797000234" t="2016-07-09 17:19:57 devn Anyone going to strangeloop this year?"><a href="#t1468084797000234" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-07-09</span> <span class="t" onclick="H(this)">17:19:57</span>                    devn </span><span>Anyone going to strangeloop this year?</span></div><div id="t1468538448000238" t="2016-07-14 23:20:48 devn Anyone have thoughts on clojure.spec and clara? Also, I was wondering: If I I decided to move to using :fact-type-fn on plain old maps to determine type, would it be possible to automatically bind the syms the same way they&apos;re bound for Java beans and Clojure Records?"><a href="#t1468538448000238" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-07-14</span> <span class="t" onclick="H(this)">23:20:48</span>                    devn </span><span>Anyone have thoughts on clojure.spec and clara? Also, I was wondering: If I I decided to move to using :fact-type-fn on plain old maps to determine type, would it be possible to automatically bind the syms the same way they&apos;re bound for Java beans and Clojure Records?</span></div><div id="t1468538670000239" t="2016-07-14 23:24:30 devn Mainly, I&apos;m interested in preserving provenance of the data that is being used to create the records. Given what&apos;s showing up in alpha10:  user&gt; #:person{:age 42, :name &quot;Fred&quot;}  =&gt;  {:person/age 42 :person/age &quot;Fred&quot;} , and the fact that destructuring is going to work with namespaced keys, I wondered what y&apos;all would think about automatically binding from namespaced keys in maps."><a href="#t1468538670000239" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-07-14</span> <span class="t" onclick="H(this)">23:24:30</span>                    devn </span><span>Mainly, I&apos;m interested in preserving provenance of the data that is being used to create the records. Given what&apos;s showing up in alpha10: </span><code>user&gt; #:person{:age 42, :name &quot;Fred&quot;}</code><span> =&gt; </span><code>{:person/age 42 :person/age &quot;Fred&quot;}</code><span>, and the fact that destructuring is going to work with namespaced keys, I wondered what y&apos;all would think about automatically binding from namespaced keys in maps.</span></div><div id="t1468850780000002" t="2016-07-18 14:06:20 wparker Regarding using the fact-type-fn, the automatic field lookup is determined by the type; see  https://github.com/rbrush/clara-rules/blob/0.11.1/src/main/clojure/clara/rules/compiler.clj#L152   So right now the auto field access will just be by the record or bean properties.  I could conceivably see this is an extension point if there were use-cases for it.  However, I don’t see any reason why you can’t use hash bindings for other types.  So, for example, something like"><a href="#t1468850780000002" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-07-18</span> <span class="t" onclick="H(this)">14:06:20</span>                 wparker </span><span>Regarding using the fact-type-fn, the automatic field lookup is determined by the type; see </span><a href="https://github.com/rbrush/clara-rules/blob/0.11.1/src/main/clojure/clara/rules/compiler.clj#L152" target="_blank">https://github.com/rbrush/clara-rules/blob/0.11.1/src/main/clojure/clara/rules/compiler.clj#L152</a><span>  So right now the auto field access will just be by the record or bean properties.  I could conceivably see this is an extension point if there were use-cases for it.  However, I don’t see any reason why you can’t use hash bindings for other types.  So, for example, something like</span></div><div id="t1468850802000004" t="2016-07-18 14:06:42 wparker [FactClass (= ?fieldA (.someNonBeanAccessorMethod this))]"><a href="#t1468850802000004" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-07-18</span> <span class="t" onclick="H(this)">14:06:42</span>                 wparker </span><span>[FactClass (= ?fieldA (.someNonBeanAccessorMethod this))]</span></div><div id="t1468850819000005" t="2016-07-18 14:06:59 wparker @devn:"><a href="#t1468850819000005" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-07-18</span> <span class="t" onclick="H(this)">14:06:59</span>                 wparker </span><span>@devn:</span></div><div id="t1468854609000006" t="2016-07-18 15:10:09 mattdarling I&apos;m actually interested in achieving something similar, is there any kind of field access aside from &quot;auto field access&quot;?"><a href="#t1468854609000006" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-07-18</span> <span class="t" onclick="H(this)">15:10:09</span>             mattdarling </span><span>I&apos;m actually interested in achieving something similar, is there any kind of field access aside from &quot;auto field access&quot;?</span></div><div id="t1468863313000007" t="2016-07-18 17:35:13 wparker @mattdarling: The fact itself is bound to “this” in the constraints on the RHS (right-hand side) so you can do arbitrary things with it there.  So"><a href="#t1468863313000007" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-07-18</span> <span class="t" onclick="H(this)">17:35:13</span>                 wparker </span><span>@mattdarling: The fact itself is bound to “this” in the constraints on the RHS (right-hand side) so you can do arbitrary things with it there.  So</span></div><div id="t1468863319000008" t="2016-07-18 17:35:19 wparker (defrule some-rule"><a href="#t1468863319000008" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-07-18</span> <span class="t" onclick="H(this)">17:35:19</span>                 wparker </span><span>(defrule some-rule</span></div><div id="t1468863339000009" t="2016-07-18 17:35:39 wparker [FactClass (= ?fieldA (some-arbitrary-operation this))]"><a href="#t1468863339000009" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-07-18</span> <span class="t" onclick="H(this)">17:35:39</span>                 wparker </span><span>[FactClass (= ?fieldA (some-arbitrary-operation this))]</span></div><div id="t1468863360000010" t="2016-07-18 17:36:00 wparker =&gt; ;; whatever RHS"><a href="#t1468863360000010" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-07-18</span> <span class="t" onclick="H(this)">17:36:00</span>                 wparker </span><span>=&gt; ;; whatever RHS</span></div><div id="t1468863371000011" t="2016-07-18 17:36:11 wparker Note: I meant constraints on the LHS above, not RHS  😛"><a href="#t1468863371000011" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-07-18</span> <span class="t" onclick="H(this)">17:36:11</span>                 wparker </span><span>Note: I meant constraints on the LHS above, not RHS </span><b>😛</b></div><div id="t1468863376000012" t="2016-07-18 17:36:16 wparker so left-hand-side"><a href="#t1468863376000012" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-07-18</span> <span class="t" onclick="H(this)">17:36:16</span>                 wparker </span><span>so left-hand-side</span></div><div id="t1468863413000013" t="2016-07-18 17:36:53 wparker So the lack of automatic field access shouldn’t prevent you from doing anything functionality, it is purely a bit of syntax sugar"><a href="#t1468863413000013" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-07-18</span> <span class="t" onclick="H(this)">17:36:53</span>                 wparker </span><span>So the lack of automatic field access shouldn’t prevent you from doing anything functionality, it is purely a bit of syntax sugar</span></div><div id="t1468863418000014" t="2016-07-18 17:36:58 wparker *functionally"><a href="#t1468863418000014" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-07-18</span> <span class="t" onclick="H(this)">17:36:58</span>                 wparker </span><span>*functionally</span></div><div id="t1468863774000015" t="2016-07-18 17:42:54 wparker That said, no, I don’t believe anything other than records or beans is supported for that syntax sugar now.  I don’t think it would be terribly difficult to change the compiler to make that an extension point, perhaps making clara.rules.compiler/get-fields a multifunction ( http://clojuredocs.org/clojure.core/defmulti ) if someone was interested in doing so and Ryan agreed (I haven’t thought deeply on the issue though, it is possible there would be a complication I’m not seeing immediately)."><a href="#t1468863774000015" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-07-18</span> <span class="t" onclick="H(this)">17:42:54</span>                 wparker </span><span>That said, no, I don’t believe anything other than records or beans is supported for that syntax sugar now.  I don’t think it would be terribly difficult to change the compiler to make that an extension point, perhaps making clara.rules.compiler/get-fields a multifunction (</span><a href="http://clojuredocs.org/clojure.core/defmulti" target="_blank">http://clojuredocs.org/clojure.core/defmulti</a><span>) if someone was interested in doing so and Ryan agreed (I haven’t thought deeply on the issue though, it is possible there would be a complication I’m not seeing immediately).</span></div><div id="t1468865861000016" t="2016-07-18 18:17:41 mattdarling Got it working as I wanted with &quot;this&quot;, thank you! I thought that was just example syntax, not an existing feature"><a href="#t1468865861000016" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-07-18</span> <span class="t" onclick="H(this)">18:17:41</span>             mattdarling </span><span>Got it working as I wanted with &quot;this&quot;, thank you! I thought that was just example syntax, not an existing feature</span></div><div id="t1468867646000017" t="2016-07-18 18:47:26 wparker Ah no, the “this” binding and field bindings for Clojure records and JavaBeans exist already and have for some time; they aren’t an experimental feature or anything like that"><a href="#t1468867646000017" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-07-18</span> <span class="t" onclick="H(this)">18:47:26</span>                 wparker </span><span>Ah no, the “this” binding and field bindings for Clojure records and JavaBeans exist already and have for some time; they aren’t an experimental feature or anything like that</span></div><div id="t1468868109000018" t="2016-07-18 18:55:09 mattdarling I had used the bindings for Clojure records initially, but wanted to introduce a bit of polymorphism, so I switched to maps with a key to indicate their type + made that the fact-type-fn"><a href="#t1468868109000018" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-07-18</span> <span class="t" onclick="H(this)">18:55:09</span>             mattdarling </span><span>I had used the bindings for Clojure records initially, but wanted to introduce a bit of polymorphism, so I switched to maps with a key to indicate their type + made that the fact-type-fn</span></div><div id="t1469186263000019" t="2016-07-22 11:17:43 mikerod mattdarling in case you like the “syntax sugar” of it you can also use destructuring in rule conditions the same way you’d use it in the arglist of a fn"><a href="#t1469186263000019" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-07-22</span> <span class="t" onclick="H(this)">11:17:43</span>                 mikerod </span><span>mattdarling in case you like the “syntax sugar” of it you can also use destructuring in rule conditions the same way you’d use it in the arglist of a fn</span></div><div id="t1469186291000020" t="2016-07-22 11:18:11 mikerod [:my-type-thing [{:keys [x y z]}] (&lt; x 10) (= ?y y)]"><a href="#t1469186291000020" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-07-22</span> <span class="t" onclick="H(this)">11:18:11</span>                 mikerod </span><code>[:my-type-thing [{:keys [x y z]}] (&lt; x 10) (= ?y y)]</code></div><div id="t1469186315000021" t="2016-07-22 11:18:35 mikerod so that just destructures the map as normal in clj and then you have “direct access” to “fields”  x   y   z"><a href="#t1469186315000021" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-07-22</span> <span class="t" onclick="H(this)">11:18:35</span>                 mikerod </span><span>so that just destructures the map as normal in clj and then you have “direct access” to “fields” </span><code>x</code><span> </span><code>y</code><span> </span><code>z</code></div><div id="t1469186335000022" t="2016-07-22 11:18:55 mikerod it’s just syntax sugar though really.  performs the same as destructuring"><a href="#t1469186335000022" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-07-22</span> <span class="t" onclick="H(this)">11:18:55</span>                 mikerod </span><span>it’s just syntax sugar though really.  performs the same as destructuring</span></div><div id="t1470722833000025" t="2016-08-09 06:07:13 ramkumarkb Hi, I am new to Clara and trying it in one the projects. Has anyone tried to use Clara with Hazelcast as its working memory? In general, any tips on the WorkingMemory management for an enterprise app with many domain objects (50 types, each about 100k objects) would be really helpful."><a href="#t1470722833000025" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-08-09</span> <span class="t" onclick="H(this)">06:07:13</span>              ramkumarkb </span><span>Hi, I am new to Clara and trying it in one the projects. Has anyone tried to use Clara with Hazelcast as its working memory? In general, any tips on the WorkingMemory management for an enterprise app with many domain objects (50 types, each about 100k objects) would be really helpful.</span></div><div id="t1470722882000026" t="2016-08-09 06:08:02 ramkumarkb Btw, I hope this is the right forum to ask Clara related questions."><a href="#t1470722882000026" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-08-09</span> <span class="t" onclick="H(this)">06:08:02</span>              ramkumarkb </span><span>Btw, I hope this is the right forum to ask Clara related questions.</span></div><div id="t1470730170000027" t="2016-08-09 08:09:30 wparker @ramkumarkb: This is indeed the correct place to ask questions about Clara.  🙂   We’ve used Clara in some heavy-hitting scenarios, although perhaps not quite as many as 5 million total objects, at least intentionally.  In general, my instinct is that bad scenarios would probably be a combination of both the number of facts, the rules, and the data scenarios, rather than just the number of facts though.  That’s generally what we’ve seen, except in some cases where we’ve had bad rules create a number of facts that was a problem for the heap.  I’m not sure what you mean by using Hazelcast as the memory - are you implementing your own memory as a replacement for the Clara defaults, considering using it in combination with the persistence stuff @mikerod is working on with  https://github.com/rbrush/clara-rules/issues/198 , or something else?  I’m not an expert on Hazelcast, this is the first time I’ve heard of it.  It would certainly be interesting to me to hear about other perf-intensive use-cases."><a href="#t1470730170000027" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-08-09</span> <span class="t" onclick="H(this)">08:09:30</span>                 wparker </span><span>@ramkumarkb: This is indeed the correct place to ask questions about Clara. </span><b>🙂</b><span>  We’ve used Clara in some heavy-hitting scenarios, although perhaps not quite as many as 5 million total objects, at least intentionally.  In general, my instinct is that bad scenarios would probably be a combination of both the number of facts, the rules, and the data scenarios, rather than just the number of facts though.  That’s generally what we’ve seen, except in some cases where we’ve had bad rules create a number of facts that was a problem for the heap.  I’m not sure what you mean by using Hazelcast as the memory - are you implementing your own memory as a replacement for the Clara defaults, considering using it in combination with the persistence stuff @mikerod is working on with </span><a href="https://github.com/rbrush/clara-rules/issues/198" target="_blank">https://github.com/rbrush/clara-rules/issues/198</a><span>, or something else?  I’m not an expert on Hazelcast, this is the first time I’ve heard of it.  It would certainly be interesting to me to hear about other perf-intensive use-cases.</span></div><div id="t1471485660000030" t="2016-08-18 02:01:00 flavio Hello,  I&apos;m new to Clara and Clojure  and stumbled upon a case, which is expected behaviour but I am not sure what to do with it,  so maybe you can enlighten me: I have a rule with an or condition on two boolean member variables of a Java object passed into the Clojure namespace. The rule is if either of the booleans is true, then fire. Now I have a case where both variables are true and it seems that the same rule fires twice, which seems expected behaviour. I do not understand how to proceed as I do not need it to fire twice...  Thanks for any input."><a href="#t1471485660000030" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-08-18</span> <span class="t" onclick="H(this)">02:01:00</span>                  flavio </span><span>Hello,  I&apos;m new to Clara and Clojure  and stumbled upon a case, which is expected behaviour but I am not sure what to do with it,  so maybe you can enlighten me: I have a rule with an or condition on two boolean member variables of a Java object passed into the Clojure namespace. The rule is if either of the booleans is true, then fire. Now I have a case where both variables are true and it seems that the same rule fires twice, which seems expected behaviour. I do not understand how to proceed as I do not need it to fire twice...  Thanks for any input.</span></div><div id="t1471491294000031" t="2016-08-18 03:34:54 ramkumarkb @wparker: Thank you for the reply and suggestions. Will get back after we run some tests and see if we indeed have trouble fitting into a single JVM. "><a href="#t1471491294000031" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-08-18</span> <span class="t" onclick="H(this)">03:34:54</span>              ramkumarkb </span><span>@wparker: Thank you for the reply and suggestions. Will get back after we run some tests and see if we indeed have trouble fitting into a single JVM. </span></div><div id="t1471594369000032" t="2016-08-19 08:12:49 wparker @flavio : So the or is on two different conditions on the same fact?  It sounds like this need not fire twice.  Or conditions in the constraints on a single fact condition don’t produce multiple firings, that is only for :or conditions that are actually part of the Rete network.  I think of something like [:or B C] as firing for all elements of the union of B and C, to put it differently, whereas conditions like [B (or pred1 pred2)] are still one set that just calls clojure.core/or to determine what facts of type B should be members of that set.  A concrete example might help;  https://github.com/rbrush/clara-examples/blob/master/src/main/clojure/clara/examples/booleans.clj#L41  will fire once per matching Order, while  https://github.com/rbrush/clara-examples/blob/master/src/main/clojure/clara/examples/booleans.clj#L19  will fire once per matching NewCustomer or ValuedCustomer.  If you have a single fact that you’re trying to test it sounds like you want something more like new-or-valued-customer-basic-coupons in that examples page; the :or condition functionality is really just shorthand for writing multiple rules in a single defrule in the code.  Does this help?  It is a bit confusing because we’re using the same word “or” to mean fundamentally different things."><a href="#t1471594369000032" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-08-19</span> <span class="t" onclick="H(this)">08:12:49</span>                 wparker </span><span>@flavio : So the or is on two different conditions on the same fact?  It sounds like this need not fire twice.  Or conditions in the constraints on a single fact condition don’t produce multiple firings, that is only for :or conditions that are actually part of the Rete network.  I think of something like [:or B C] as firing for all elements of the union of B and C, to put it differently, whereas conditions like [B (or pred1 pred2)] are still one set that just calls clojure.core/or to determine what facts of type B should be members of that set.  A concrete example might help; </span><a href="https://github.com/rbrush/clara-examples/blob/master/src/main/clojure/clara/examples/booleans.clj#L41" target="_blank">https://github.com/rbrush/clara-examples/blob/master/src/main/clojure/clara/examples/booleans.clj#L41</a><span> will fire once per matching Order, while </span><a href="https://github.com/rbrush/clara-examples/blob/master/src/main/clojure/clara/examples/booleans.clj#L19" target="_blank">https://github.com/rbrush/clara-examples/blob/master/src/main/clojure/clara/examples/booleans.clj#L19</a><span> will fire once per matching NewCustomer or ValuedCustomer.  If you have a single fact that you’re trying to test it sounds like you want something more like new-or-valued-customer-basic-coupons in that examples page; the :or condition functionality is really just shorthand for writing multiple rules in a single defrule in the code.  Does this help?  It is a bit confusing because we’re using the same word “or” to mean fundamentally different things.</span></div><div id="t1471594486000034" t="2016-08-19 08:14:46 wparker Also, you may have seen  http://www.clara-rules.org/docs/booleans , but if you haven’t that could be helpful.  The key point though is that that only addresses booleans created like  https://github.com/rbrush/clara-examples/blob/master/src/main/clojure/clara/examples/booleans.clj#L19  ; the way to distinguish the cases visibly is what is a clojure keyword (:or :and) versus a normal Clojure function call like (or… or  (and..."><a href="#t1471594486000034" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-08-19</span> <span class="t" onclick="H(this)">08:14:46</span>                 wparker </span><span>Also, you may have seen </span><a href="http://www.clara-rules.org/docs/booleans" target="_blank">http://www.clara-rules.org/docs/booleans</a><span>, but if you haven’t that could be helpful.  The key point though is that that only addresses booleans created like </span><a href="https://github.com/rbrush/clara-examples/blob/master/src/main/clojure/clara/examples/booleans.clj#L19" target="_blank">https://github.com/rbrush/clara-examples/blob/master/src/main/clojure/clara/examples/booleans.clj#L19</a><span> ; the way to distinguish the cases visibly is what is a clojure keyword (:or :and) versus a normal Clojure function call like (or… or  (and...</span></div><div id="t1471783201000036" t="2016-08-21 12:40:01 flavio @wparker: thanks for your explanation. It is as you say: [:or B C ] is firing as an union, whereas what I am looking for is [B (or pred1 pred2)]"><a href="#t1471783201000036" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-08-21</span> <span class="t" onclick="H(this)">12:40:01</span>                  flavio </span><span>@wparker: thanks for your explanation. It is as you say: [:or B C ] is firing as an union, whereas what I am looking for is [B (or pred1 pred2)]</span></div><div id="t1471872408000039" t="2016-08-22 13:26:48 ramji013 Hi All, I have posted my query in different group instead Clara.

Anyone in the group please help to look into this. 

regarding 2nd question, we have found the answer. response type of queryString() from QueryResult is Object type, that can be typecasted to respective object.

  https://clojurians.slack.com/archives/clojurescript/p1471836222005217"><a href="#t1471872408000039" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-08-22</span> <span class="t" onclick="H(this)">13:26:48</span>                ramji013 </span><span>Hi All, I have posted my query in different group instead Clara.

Anyone in the group please help to look into this. 

regarding 2nd question, we have found the answer. response type of queryString() from QueryResult is Object type, that can be typecasted to respective object.

 </span><a href="https://clojurians.slack.com/archives/clojurescript/p1471836222005217" target="_blank">https://clojurians.slack.com/archives/clojurescript/p1471836222005217</a></div><div id="t1471879230000042" t="2016-08-22 15:20:30 ryanbrush Hi @ramji013, if you&apos;re having a specific issue the best way to troubleshoot is to post a minimal runnable example that shows the problem you&apos;re having, possibly as a gist or issue on github. def&apos;d variables should be visible from within rules; we do it frequently. If you&apos;re doing something in ClojureScript I&apos;m less sure, since I haven&apos;t used that in earnest."><a href="#t1471879230000042" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-08-22</span> <span class="t" onclick="H(this)">15:20:30</span>               ryanbrush </span><span>Hi @ramji013, if you&apos;re having a specific issue the best way to troubleshoot is to post a minimal runnable example that shows the problem you&apos;re having, possibly as a gist or issue on github. def&apos;d variables should be visible from within rules; we do it frequently. If you&apos;re doing something in ClojureScript I&apos;m less sure, since I haven&apos;t used that in earnest.</span></div><div id="t1471879272000043" t="2016-08-22 15:21:12 ryanbrush As for getting to nested fields, you can use Clojure&apos;s destructuring to get to the top-level field (or fact itself), and then access nested fields just using Clojure expressions as part of the rule left-hand side. Some details on restructuring are here:  http://www.clara-rules.org/docs/expressions/"><a href="#t1471879272000043" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-08-22</span> <span class="t" onclick="H(this)">15:21:12</span>               ryanbrush </span><span>As for getting to nested fields, you can use Clojure&apos;s destructuring to get to the top-level field (or fact itself), and then access nested fields just using Clojure expressions as part of the rule left-hand side. Some details on restructuring are here: </span><a href="http://www.clara-rules.org/docs/expressions/" target="_blank">http://www.clara-rules.org/docs/expressions/</a></div><div id="t1471879647000045" t="2016-08-22 15:27:27 ryanbrush An announcement: Clara 0.12.0 has been released! There have been a bunch of performance enhancements from @wparker and @mikerod, and a handful of bug fixes as well. Details are in the change log:  https://github.com/rbrush/clara-rules/blob/master/CHANGELOG.md#0120"><a href="#t1471879647000045" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-08-22</span> <span class="t" onclick="H(this)">15:27:27</span>               ryanbrush </span><span>An announcement: Clara 0.12.0 has been released! There have been a bunch of performance enhancements from @wparker and @mikerod, and a handful of bug fixes as well. Details are in the change log: </span><a href="https://github.com/rbrush/clara-rules/blob/master/CHANGELOG.md#0120" target="_blank">https://github.com/rbrush/clara-rules/blob/master/CHANGELOG.md#0120</a></div><div id="t1472485117000002" t="2016-08-29 15:38:37 ramji013 Hi All, I am new to Clara rules. One of my usecase I supposed to iterate list of object and perform validations in clojure. Anyone could you please suggest an approach, how it can be done? "><a href="#t1472485117000002" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-08-29</span> <span class="t" onclick="H(this)">15:38:37</span>                ramji013 </span><span>Hi All, I am new to Clara rules. One of my usecase I supposed to iterate list of object and perform validations in clojure. Anyone could you please suggest an approach, how it can be done? </span></div><div id="t1472546999000003" t="2016-08-30 08:49:59 wparker @ramji013 : It seems like something like (filter valid-object? object) if you just want the collection of invalid objects or something like (when (some invalid-object? objects) (throw code-to-create-exception-here)) if you want to fail on an invalid object would work if you have a simple predicate.  From your comment I’m not sure why Clara would be helpful. Perhaps there is some other complication to your use-case though."><a href="#t1472546999000003" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-08-30</span> <span class="t" onclick="H(this)">08:49:59</span>                 wparker </span><span>@ramji013 : It seems like something like (filter valid-object? object) if you just want the collection of invalid objects or something like (when (some invalid-object? objects) (throw code-to-create-exception-here)) if you want to fail on an invalid object would work if you have a simple predicate.  From your comment I’m not sure why Clara would be helpful. Perhaps there is some other complication to your use-case though.</span></div><div id="t1472649439000004" t="2016-08-31 13:17:19 mikerod ramji013 without a little more context, it is hard to assist much, as wparker pointed out.  I will also add that if you have large collections of objects though, it is often better to insert them all into the Clara session separately or “extract” them in a rule and perform the inserts in the RHS (right-hand side) of the rule.  From there you can assert the validity of objects in a object-at-a-time sort of pattern matching.  This can be helpful if you wish to then perform joins to/assertions with  types of objects in the session’s working memory with these objects that you have decided were “valid&quot;."><a href="#t1472649439000004" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-08-31</span> <span class="t" onclick="H(this)">13:17:19</span>                 mikerod </span><span>ramji013 without a little more context, it is hard to assist much, as wparker pointed out.  I will also add that if you have large collections of objects though, it is often better to insert them all into the Clara session separately or “extract” them in a rule and perform the inserts in the RHS (right-hand side) of the rule.  From there you can assert the validity of objects in a object-at-a-time sort of pattern matching.  This can be helpful if you wish to then perform joins to/assertions with  types of objects in the session’s working memory with these objects that you have decided were “valid&quot;.</span></div><div id="t1472889599000002" t="2016-09-03 07:59:59 flavio hello all, I am experimenting with accumulators and face following problem where I would need your expertise. I have following rule: 

(def oldest-person (acc/max :age :returns-fact true))

(defrule get-oldest-person
         [?senile-person &lt;- oldest-person :from [Person (= ?name name)]]
         =&gt;
         (println (str  &quot;The oldest person is aged &quot; (.getAge ?senile-person)  &quot;. The person&apos;s name is &quot; ?name))
         )
The Person fact is a java bean. The accumulator doesn&apos;t seem to do anything with the :age variable, as the output is not accumulated:

The oldest person is aged 50. The person&apos;s name is Person 3
The oldest person is aged 150. The person&apos;s name is Person 4
The oldest person is aged 200. The person&apos;s name is Person 1
The oldest person is aged 100. The person&apos;s name is Person 2

I suspect I am not passing the right variable binding to the accumulator, but I am not sure what to change. (.getAge) instead of :age throws an exception when compiling.

Thanks for any pointers."><a href="#t1472889599000002" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-09-03</span> <span class="t" onclick="H(this)">07:59:59</span>                  flavio </span><span>hello all, I am experimenting with accumulators and face following problem where I would need your expertise. I have following rule: 

(def oldest-person (acc/max :age :returns-fact true))

(defrule get-oldest-person
         [?senile-person &lt;- oldest-person :from [Person (= ?name name)]]
         =&gt;
         (println (str  &quot;The oldest person is aged &quot; (.getAge ?senile-person)  &quot;. The person&apos;s name is &quot; ?name))
         )
The Person fact is a java bean. The accumulator doesn&apos;t seem to do anything with the :age variable, as the output is not accumulated:

The oldest person is aged 50. The person&apos;s name is Person 3
The oldest person is aged 150. The person&apos;s name is Person 4
The oldest person is aged 200. The person&apos;s name is Person 1
The oldest person is aged 100. The person&apos;s name is Person 2

I suspect I am not passing the right variable binding to the accumulator, but I am not sure what to change. (.getAge) instead of :age throws an exception when compiling.

Thanks for any pointers.</span></div><div id="t1472950472000007" t="2016-09-04 00:54:32 wparker @flavio Do you mean that you were trying to do something like  (def oldest-person (acc/max (.getAge) :returns-fact true))  ?  (.getAge) isn’t a valid Clojure expression; an interop form needs a target to invoke on.   http://clojure.org/reference/java_interop  might be helpful if you’re unfamiliar.  Introducing the ?name binding in the accumulator will cause you to accumulate once per name, which doesn’t seem like what you would want in this example case.  As chance would have it, I have a PR open to clara-site that discusses the subject.  https://github.com/rbrush/clara-site/pull/8"><a href="#t1472950472000007" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-09-04</span> <span class="t" onclick="H(this)">00:54:32</span>                 wparker </span><span>@flavio Do you mean that you were trying to do something like  (def oldest-person (acc/max (.getAge) :returns-fact true))  ?  (.getAge) isn’t a valid Clojure expression; an interop form needs a target to invoke on.  </span><a href="http://clojure.org/reference/java_interop" target="_blank">http://clojure.org/reference/java_interop</a><span> might be helpful if you’re unfamiliar.  Introducing the ?name binding in the accumulator will cause you to accumulate once per name, which doesn’t seem like what you would want in this example case.  As chance would have it, I have a PR open to clara-site that discusses the subject. </span><a href="https://github.com/rbrush/clara-site/pull/8" target="_blank">https://github.com/rbrush/clara-site/pull/8</a></div><div id="t1472950628000009" t="2016-09-04 00:57:08 wparker That grouping behavior isn’t new to 0.12, but there were some bugs around it before that were fixed in 0.12"><a href="#t1472950628000009" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-09-04</span> <span class="t" onclick="H(this)">00:57:08</span>                 wparker </span><span>That grouping behavior isn’t new to 0.12, but there were some bugs around it before that were fixed in 0.12</span></div><div id="t1473003039000010" t="2016-09-04 15:30:39 flavio @wparker , thanks for the updated documentation on the accumulators. This explains the constraint part of the accumulator. I have now successfully run following example: 
(defrule get-old-person-count
         [?old-person-count &lt;- (acc/count) :from [Person]]
         =&gt;
         (println (str &quot;The number of elderly persons is &quot; ?old-person-count))
         )
Which returns the number of Person facts as expected. 
However, I am still struggling with accumulators expecting a field to work with:

(defrule get-old-person-max-age
         [?oldest-age &lt;- (acc/max :age ) :from [Person]]
         =&gt;
         (println (str &quot;The oldest person is aged: &quot; ?oldest-age))
         )

Above rule throws a null pointer exception as it doesn&apos;t know what :age is. My question is how can I pass a field name to an accumulator where the field name comes from a Java Bean. I went through the Interop documentation multiple times but I can&apos;t seem to get it right. 
Thanks"><a href="#t1473003039000010" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-09-04</span> <span class="t" onclick="H(this)">15:30:39</span>                  flavio </span><span>@wparker , thanks for the updated documentation on the accumulators. This explains the constraint part of the accumulator. I have now successfully run following example: 
(defrule get-old-person-count
         [?old-person-count &lt;- (acc/count) :from [Person]]
         =&gt;
         (println (str &quot;The number of elderly persons is &quot; ?old-person-count))
         )
Which returns the number of Person facts as expected. 
However, I am still struggling with accumulators expecting a field to work with:

(defrule get-old-person-max-age
         [?oldest-age &lt;- (acc/max :age ) :from [Person]]
         =&gt;
         (println (str &quot;The oldest person is aged: &quot; ?oldest-age))
         )

Above rule throws a null pointer exception as it doesn&apos;t know what :age is. My question is how can I pass a field name to an accumulator where the field name comes from a Java Bean. I went through the Interop documentation multiple times but I can&apos;t seem to get it right. 
Thanks</span></div><div id="t1473064680000013" t="2016-09-05 08:38:00 wparker I’d surmise that you’re doing numeric comparisons on nil, though I can’t be sure without a stack trace.  You probably need something like (def oldest-person (acc/max #(.getAge %) :returns-fact true)).  In your original you use :age as a function, but when you look a keyword up on something that is not a Clojure map you just get nil.  You can refer to fields by name in Clara rules and queries due to some special handling by Clara’s compiler, but that isn’t the case when you define accumulators, which are really just maps of keywords to Clojure functions if you take a look at what the value of oldest-person ends up being in a REPL."><a href="#t1473064680000013" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-09-05</span> <span class="t" onclick="H(this)">08:38:00</span>                 wparker </span><span>I’d surmise that you’re doing numeric comparisons on nil, though I can’t be sure without a stack trace.  You probably need something like (def oldest-person (acc/max #(.getAge %) :returns-fact true)).  In your original you use :age as a function, but when you look a keyword up on something that is not a Clojure map you just get nil.  You can refer to fields by name in Clara rules and queries due to some special handling by Clara’s compiler, but that isn’t the case when you define accumulators, which are really just maps of keywords to Clojure functions if you take a look at what the value of oldest-person ends up being in a REPL.</span></div><div id="t1473064688000014" t="2016-09-05 08:38:08 wparker @flavio"><a href="#t1473064688000014" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-09-05</span> <span class="t" onclick="H(this)">08:38:08</span>                 wparker </span><span>@flavio</span></div><div id="t1473065819000015" t="2016-09-05 08:56:59 flavio @wparker: thanks a lot for the response,  this was the syntax I was looking for. I couldn&apos;t find it on the Java interop page. "><a href="#t1473065819000015" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-09-05</span> <span class="t" onclick="H(this)">08:56:59</span>                  flavio </span><span>@wparker: thanks a lot for the response,  this was the syntax I was looking for. I couldn&apos;t find it on the Java interop page. </span></div><div id="t1473257573000016" t="2016-09-07 14:12:53 mikerod flavio is you want to avoid reflection, you’ll have to type-hint the  .getAge  call too"><a href="#t1473257573000016" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-09-07</span> <span class="t" onclick="H(this)">14:12:53</span>                 mikerod </span><span>flavio is you want to avoid reflection, you’ll have to type-hint the </span><code>.getAge</code><span> call too</span></div><div id="t1473257584000017" t="2016-09-07 14:13:04 mikerod Same as any other Clojure expression and Java interop"><a href="#t1473257584000017" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-09-07</span> <span class="t" onclick="H(this)">14:13:04</span>                 mikerod </span><span>Same as any other Clojure expression and Java interop</span></div><div id="t1473337910000018" t="2016-09-08 12:31:50 flavio @mikerod, is it generally good practise to type-hint for perfomance reasons? Are you guys recommending it?
or, why should I not do it?"><a href="#t1473337910000018" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-09-08</span> <span class="t" onclick="H(this)">12:31:50</span>                  flavio </span><span>@mikerod, is it generally good practise to type-hint for perfomance reasons? Are you guys recommending it?
or, why should I not do it?</span></div><div id="t1473368383000020" t="2016-09-08 20:59:43 wparker I suggest reading  https://kotka.de/blog/2012/06/Did_you_know_IX.html  .  A very short explanation is that the JVM can compile something like (.someMethod x) to run faster if the type of x is known at compile time.  In absolute terms, though, even without type hints the calls are still fast.  In our codebase we make a point of avoiding reflection since 1. We work at a very large scale that makes such bottlenecks matter. 2. It is easier to avoid reflection entirely than to have to release our code again when it turns out there is a major perf problem.  What you should do depends on your use-case and the attendant tradeoffs; some people don’t (and shouldn’t for their use-cases) care about reflection"><a href="#t1473368383000020" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-09-08</span> <span class="t" onclick="H(this)">20:59:43</span>                 wparker </span><span>I suggest reading </span><a href="https://kotka.de/blog/2012/06/Did_you_know_IX.html" target="_blank">https://kotka.de/blog/2012/06/Did_you_know_IX.html</a><span> .  A very short explanation is that the JVM can compile something like (.someMethod x) to run faster if the type of x is known at compile time.  In absolute terms, though, even without type hints the calls are still fast.  In our codebase we make a point of avoiding reflection since 1. We work at a very large scale that makes such bottlenecks matter. 2. It is easier to avoid reflection entirely than to have to release our code again when it turns out there is a major perf problem.  What you should do depends on your use-case and the attendant tradeoffs; some people don’t (and shouldn’t for their use-cases) care about reflection</span></div><div id="t1473868654000021" t="2016-09-14 15:57:34 mikerod @flavio yeah, I would say that reflection does have a significant performance penalty, but all of what Will had to say about it is probably the standard advice there."><a href="#t1473868654000021" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-09-14</span> <span class="t" onclick="H(this)">15:57:34</span>                 mikerod </span><span>@flavio yeah, I would say that reflection does have a significant performance penalty, but all of what Will had to say about it is probably the standard advice there.</span></div><div id="t1473868709000022" t="2016-09-14 15:58:29 mikerod Also, see the official Clojure stance  http://clojure.org/reference/java_interop#typehints  which I believe is written by Rich himself"><a href="#t1473868709000022" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-09-14</span> <span class="t" onclick="H(this)">15:58:29</span>                 mikerod </span><span>Also, see the official Clojure stance </span><a href="http://clojure.org/reference/java_interop#typehints" target="_blank">http://clojure.org/reference/java_interop#typehints</a><span> which I believe is written by Rich himself</span></div><div id="t1473868781000023" t="2016-09-14 15:59:41 mikerod In our applications, we don’t want to risk/spend the performance penalty though, so we aggressively eliminate reflection warnings.  The Clara compiler does give some effort in ensuring type hints are automatically added where the Clara compiler can effectively infer the types.  However, that only goes so far."><a href="#t1473868781000023" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-09-14</span> <span class="t" onclick="H(this)">15:59:41</span>                 mikerod </span><span>In our applications, we don’t want to risk/spend the performance penalty though, so we aggressively eliminate reflection warnings.  The Clara compiler does give some effort in ensuring type hints are automatically added where the Clara compiler can effectively infer the types.  However, that only goes so far.</span></div><div id="t1474094160000025" t="2016-09-17 06:36:00 flavio Thanks for the advice. Will definitely try to avoid reflection. "><a href="#t1474094160000025" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-09-17</span> <span class="t" onclick="H(this)">06:36:00</span>                  flavio </span><span>Thanks for the advice. Will definitely try to avoid reflection. </span></div><div id="t1474296828000027" t="2016-09-19 14:53:48 ramkumarkb Hello, I am trying to use Clara in a project and was wondering if there is any way to insert facts both from Java &amp; Clojure, before firing the rules. The idea is that one could transition from Java for existing facts but use Clojure for inserting new facts, before firing all the rules (which is in Clara DSL).

I was trying to read the docs here :  http://www.clara-rules.org/docs/java/   But could not find any example where facts are inserted both from Java &amp; Clojure. Any pointers would be immensely helpful.

Thank you!"><a href="#t1474296828000027" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-09-19</span> <span class="t" onclick="H(this)">14:53:48</span>              ramkumarkb </span><span>Hello, I am trying to use Clara in a project and was wondering if there is any way to insert facts both from Java &amp; Clojure, before firing the rules. The idea is that one could transition from Java for existing facts but use Clojure for inserting new facts, before firing all the rules (which is in Clara DSL).

I was trying to read the docs here : </span><a href="http://www.clara-rules.org/docs/java/" target="_blank">http://www.clara-rules.org/docs/java/</a><span>  But could not find any example where facts are inserted both from Java &amp; Clojure. Any pointers would be immensely helpful.

Thank you!</span></div><div id="t1474313731000031" t="2016-09-19 19:35:31 devn Thoughts on generating a graph based on rule firings?"><a href="#t1474313731000031" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-09-19</span> <span class="t" onclick="H(this)">19:35:31</span>                    devn </span><span>Thoughts on generating a graph based on rule firings?</span></div><div id="t1474362198000032" t="2016-09-20 09:03:18 wparker @ramkumarkb : If you mean that the facts are Java objects, I don’t see any barrier to that; JavaBeans are a very normal Clara fact.  If you mean working in Clojure with a Java session of the sort in the docs you linked, you can interact with it via Clojure’s Java interop; see  https://github.com/rbrush/clara-rules/blob/master/src/test/clojure/clara/test_java.clj#L42  for an example"><a href="#t1474362198000032" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-09-20</span> <span class="t" onclick="H(this)">09:03:18</span>                 wparker </span><span>@ramkumarkb : If you mean that the facts are Java objects, I don’t see any barrier to that; JavaBeans are a very normal Clara fact.  If you mean working in Clojure with a Java session of the sort in the docs you linked, you can interact with it via Clojure’s Java interop; see </span><a href="https://github.com/rbrush/clara-rules/blob/master/src/test/clojure/clara/test_java.clj#L42" target="_blank">https://github.com/rbrush/clara-rules/blob/master/src/test/clojure/clara/test_java.clj#L42</a><span> for an example</span></div><div id="t1474387531000034" t="2016-09-20 16:05:31 wparker @devn I think  https://github.com/rbrush/clara-rules/blob/master/src/main/clojure/clara/tools/inspect.clj#L67  has the info you’d need for truth maintenance governed facts anyway, clara-tools builds on this  https://github.com/rbrush/clara-tools/blob/master/src/main/clojure/clara/tools/impl/facts.clj"><a href="#t1474387531000034" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-09-20</span> <span class="t" onclick="H(this)">16:05:31</span>                 wparker </span><span>@devn I think </span><a href="https://github.com/rbrush/clara-rules/blob/master/src/main/clojure/clara/tools/inspect.clj#L67" target="_blank">https://github.com/rbrush/clara-rules/blob/master/src/main/clojure/clara/tools/inspect.clj#L67</a><span> has the info you’d need for truth maintenance governed facts anyway, clara-tools builds on this </span><a href="https://github.com/rbrush/clara-tools/blob/master/src/main/clojure/clara/tools/impl/facts.clj" target="_blank">https://github.com/rbrush/clara-tools/blob/master/src/main/clojure/clara/tools/impl/facts.clj</a></div><div id="t1474387566000036" t="2016-09-20 16:06:06 wparker My understanding is that this ultimately works because Clara stores logical insertions in the activation-memory"><a href="#t1474387566000036" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-09-20</span> <span class="t" onclick="H(this)">16:06:06</span>                 wparker </span><span>My understanding is that this ultimately works because Clara stores logical insertions in the activation-memory</span></div><div id="t1474387641000037" t="2016-09-20 16:07:21 wparker I’m curious - do you have a particular sort of case in mind?"><a href="#t1474387641000037" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-09-20</span> <span class="t" onclick="H(this)">16:07:21</span>                 wparker </span><span>I’m curious - do you have a particular sort of case in mind?</span></div><div id="t1474387685000038" t="2016-09-20 16:08:05 wparker The graphs in clara-tools seem to work OK, though when I last poked around at them there seemed to be some oddities around accumulators, but I haven’t looked at it much yet"><a href="#t1474387685000038" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-09-20</span> <span class="t" onclick="H(this)">16:08:05</span>                 wparker </span><span>The graphs in clara-tools seem to work OK, though when I last poked around at them there seemed to be some oddities around accumulators, but I haven’t looked at it much yet</span></div><div id="t1474387705000039" t="2016-09-20 16:08:25 devn @wparker Our rules are pretty DAG-y, and continue to grow in number"><a href="#t1474387705000039" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-09-20</span> <span class="t" onclick="H(this)">16:08:25</span>                    devn </span><span>@wparker Our rules are pretty DAG-y, and continue to grow in number</span></div><div id="t1474387741000040" t="2016-09-20 16:09:01 devn for the sake of development, understanding the flow, it&apos;d be nice to output the rules as a graph for a particular run"><a href="#t1474387741000040" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-09-20</span> <span class="t" onclick="H(this)">16:09:01</span>                    devn </span><span>for the sake of development, understanding the flow, it&apos;d be nice to output the rules as a graph for a particular run</span></div><div id="t1474387773000041" t="2016-09-20 16:09:33 wparker Ah, so more of a static thing than as a web app like clara-tools perhaps"><a href="#t1474387773000041" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-09-20</span> <span class="t" onclick="H(this)">16:09:33</span>                 wparker </span><span>Ah, so more of a static thing than as a web app like clara-tools perhaps</span></div><div id="t1474387786000043" t="2016-09-20 16:09:46 devn I want to show someone who works directly with a customer the decision tree"><a href="#t1474387786000043" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-09-20</span> <span class="t" onclick="H(this)">16:09:46</span>                    devn </span><span>I want to show someone who works directly with a customer the decision tree</span></div><div id="t1474387849000044" t="2016-09-20 16:10:49 devn though, as time goes on, a more interactive tool could be nice, to simulate what might happen if a rule were added to do X"><a href="#t1474387849000044" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-09-20</span> <span class="t" onclick="H(this)">16:10:49</span>                    devn </span><span>though, as time goes on, a more interactive tool could be nice, to simulate what might happen if a rule were added to do X</span></div><div id="t1474387890000045" t="2016-09-20 16:11:30 wparker yeah, something like a static doc visualization to hand someone could be useful"><a href="#t1474387890000045" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-09-20</span> <span class="t" onclick="H(this)">16:11:30</span>                 wparker </span><span>yeah, something like a static doc visualization to hand someone could be useful</span></div><div id="t1474661302000047" t="2016-09-23 20:08:22 devn I&apos;m havin&apos; a lot of thoughts..."><a href="#t1474661302000047" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-09-23</span> <span class="t" onclick="H(this)">20:08:22</span>                    devn </span><span>I&apos;m havin&apos; a lot of thoughts...</span></div><div id="t1474661331000048" t="2016-09-23 20:08:51 devn @wparker you specifically said in the above &quot;the info you&apos;d need for truth maintenance governed facts&quot;"><a href="#t1474661331000048" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-09-23</span> <span class="t" onclick="H(this)">20:08:51</span>                    devn </span><span>@wparker you specifically said in the above &quot;the info you&apos;d need for truth maintenance governed facts&quot;</span></div><div id="t1474661364000049" t="2016-09-23 20:09:24 devn it got me wondering about some of our logic. there are places in our rules where im thinking unconditional insertion would improve our ability to reason about the rules"><a href="#t1474661364000049" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-09-23</span> <span class="t" onclick="H(this)">20:09:24</span>                    devn </span><span>it got me wondering about some of our logic. there are places in our rules where im thinking unconditional insertion would improve our ability to reason about the rules</span></div><div id="t1474661386000050" t="2016-09-23 20:09:46 devn it&apos;s kind of a place to hang your hat: &quot;You can always rely on me being there. Nothing can undo this.&quot;"><a href="#t1474661386000050" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-09-23</span> <span class="t" onclick="H(this)">20:09:46</span>                    devn </span><span>it&apos;s kind of a place to hang your hat: &quot;You can always rely on me being there. Nothing can undo this.&quot;</span></div><div id="t1474661434000051" t="2016-09-23 20:10:34 devn It strikes me a bit like the convention of using  do---  on functions which have side effects"><a href="#t1474661434000051" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-09-23</span> <span class="t" onclick="H(this)">20:10:34</span>                    devn </span><span>It strikes me a bit like the convention of using </span><code>do---</code><span> on functions which have side effects</span></div><div id="t1474661480000052" t="2016-09-23 20:11:20 devn in the same way, im thinking about unconditional insertion to mark the territory of where branching will never happen, or ought to be expected not to happen"><a href="#t1474661480000052" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-09-23</span> <span class="t" onclick="H(this)">20:11:20</span>                    devn </span><span>in the same way, im thinking about unconditional insertion to mark the territory of where branching will never happen, or ought to be expected not to happen</span></div><div id="t1474973114000053" t="2016-09-27 10:45:14 wparker @devn the reason for truth maintenance governed facts to have more information available is that when facts are inserted using truth maintenance, the memory stores information to the effective of “this fact was inserted from this rule based on X other facts”.  The code in the memory is at  https://github.com/rbrush/clara-rules/blob/0.12.0/src/main/clojure/clara/rules/memory.cljc#L685   This is only called if truth maintenance is used; if you use unconditional insertions it won’t be.  You can see the conditional on that at  https://github.com/rbrush/clara-rules/blob/0.12.0/src/main/clojure/clara/rules/engine.cljc#L228   It is a little confusing because the ProductionNode will add “activations” in any case, but Clara batches insertions from them in the activation-memory as a sort of queue, then pops them off when you call fire-rules  https://github.com/rbrush/clara-rules/blob/0.12.0/src/main/clojure/clara/rules/engine.cljc#L1483   As far as the reasoning behind this, truth maintenance does have some performance cost.  If you do want to keep track of unconditional assertions, I suspect a way to do it with listeners could be found."><a href="#t1474973114000053" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-09-27</span> <span class="t" onclick="H(this)">10:45:14</span>                 wparker </span><span>@devn the reason for truth maintenance governed facts to have more information available is that when facts are inserted using truth maintenance, the memory stores information to the effective of “this fact was inserted from this rule based on X other facts”.  The code in the memory is at </span><a href="https://github.com/rbrush/clara-rules/blob/0.12.0/src/main/clojure/clara/rules/memory.cljc#L685" target="_blank">https://github.com/rbrush/clara-rules/blob/0.12.0/src/main/clojure/clara/rules/memory.cljc#L685</a><span>  This is only called if truth maintenance is used; if you use unconditional insertions it won’t be.  You can see the conditional on that at </span><a href="https://github.com/rbrush/clara-rules/blob/0.12.0/src/main/clojure/clara/rules/engine.cljc#L228" target="_blank">https://github.com/rbrush/clara-rules/blob/0.12.0/src/main/clojure/clara/rules/engine.cljc#L228</a><span>  It is a little confusing because the ProductionNode will add “activations” in any case, but Clara batches insertions from them in the activation-memory as a sort of queue, then pops them off when you call fire-rules </span><a href="https://github.com/rbrush/clara-rules/blob/0.12.0/src/main/clojure/clara/rules/engine.cljc#L1483" target="_blank">https://github.com/rbrush/clara-rules/blob/0.12.0/src/main/clojure/clara/rules/engine.cljc#L1483</a><span>  As far as the reasoning behind this, truth maintenance does have some performance cost.  If you do want to keep track of unconditional assertions, I suspect a way to do it with listeners could be found.</span></div><div id="t1474973530000055" t="2016-09-27 10:52:10 wparker As far as simplicity, I’d suggest keeping in mind that rules can fire based on intermediate state in the rules engine that won’t be reflected in the final state after the fire-rules loop finishes, and unconditional insertions can thus reflect such intermediate state.  In our case, we have a mostly stark dividing line between “types of facts that can be inserted from outside the session” and “facts that can be created by rules”; our unconditional insertions tend to be from rules whose LHS looks for things of the former types.  Thinking through how the intermediate state of the rules engine will play out can get pretty tricky and may be non-guaranteed behavior depending on the use case.  There are certainly many legitimate use cases for unconditional insertions though."><a href="#t1474973530000055" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-09-27</span> <span class="t" onclick="H(this)">10:52:10</span>                 wparker </span><span>As far as simplicity, I’d suggest keeping in mind that rules can fire based on intermediate state in the rules engine that won’t be reflected in the final state after the fire-rules loop finishes, and unconditional insertions can thus reflect such intermediate state.  In our case, we have a mostly stark dividing line between “types of facts that can be inserted from outside the session” and “facts that can be created by rules”; our unconditional insertions tend to be from rules whose LHS looks for things of the former types.  Thinking through how the intermediate state of the rules engine will play out can get pretty tricky and may be non-guaranteed behavior depending on the use case.  There are certainly many legitimate use cases for unconditional insertions though.</span></div><div id="t1476795606000057" t="2016-10-18 13:00:06 tbrooke I started playing with the protege IDE associated with Rete4frames  https://github.com/rururu/rete4frames  and wondered about using protege with Clara -I am not sure how it is integrated but it might be a nice way to build up an ontology for use in a Clara rules system"><a href="#t1476795606000057" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-10-18</span> <span class="t" onclick="H(this)">13:00:06</span>                 tbrooke </span><span>I started playing with the protege IDE associated with Rete4frames </span><a href="https://github.com/rururu/rete4frames" target="_blank">https://github.com/rururu/rete4frames</a><span> and wondered about using protege with Clara -I am not sure how it is integrated but it might be a nice way to build up an ontology for use in a Clara rules system</span></div><div id="t1476891636000059" t="2016-10-19 15:40:36 ryanbrush @tbrooke I haven&apos;t used Protege, so it&apos;s not obvious to me how this would plug in. Clara&apos;s core Rete implementation could be invoked by external tools that generate rules. Most of our usage of Clara is based around rules working with arbitrary Clojure records rather than specialized templates or RDF-style tuples, so we typically use a more conventional development environment."><a href="#t1476891636000059" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-10-19</span> <span class="t" onclick="H(this)">15:40:36</span>               ryanbrush </span><span>@tbrooke I haven&apos;t used Protege, so it&apos;s not obvious to me how this would plug in. Clara&apos;s core Rete implementation could be invoked by external tools that generate rules. Most of our usage of Clara is based around rules working with arbitrary Clojure records rather than specialized templates or RDF-style tuples, so we typically use a more conventional development environment.</span></div><div id="t1476891755000060" t="2016-10-19 15:42:35 ryanbrush That said, a template-style approach could certainly use Clara&apos;s rete implementation. To illustrate this, rules could be generated from an external structure like how I describe here:  http://www.toomuchcode.org/blog/2015/11/14/insta-declarative-dsls/  So some front end tool could produce the rule structure that is then converted to Clara rules using a pattern similar to that post."><a href="#t1476891755000060" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-10-19</span> <span class="t" onclick="H(this)">15:42:35</span>               ryanbrush </span><span>That said, a template-style approach could certainly use Clara&apos;s rete implementation. To illustrate this, rules could be generated from an external structure like how I describe here: </span><a href="http://www.toomuchcode.org/blog/2015/11/14/insta-declarative-dsls/" target="_blank">http://www.toomuchcode.org/blog/2015/11/14/insta-declarative-dsls/</a><span> So some front end tool could produce the rule structure that is then converted to Clara rules using a pattern similar to that post.</span></div><div id="t1477189640000062" t="2016-10-23 02:27:20 alex-dixon Anyone made a clara app with reagent yet?  😄"><a href="#t1477189640000062" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-10-23</span> <span class="t" onclick="H(this)">02:27:20</span>              alex-dixon </span><span>Anyone made a clara app with reagent yet? </span><b>😄</b></div><div id="t1477383521000063" t="2016-10-25 08:18:41 wparker The (experimental) clara-tools project uses Reagent  https://github.com/rbrush/clara-tools , but it is focused on displaying the logic from a JVM rules session, not using rules in cljs to drive an application.  I’d be curious too if there is any such usage."><a href="#t1477383521000063" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-10-25</span> <span class="t" onclick="H(this)">08:18:41</span>                 wparker </span><span>The (experimental) clara-tools project uses Reagent </span><a href="https://github.com/rbrush/clara-tools" target="_blank">https://github.com/rbrush/clara-tools</a><span>, but it is focused on displaying the logic from a JVM rules session, not using rules in cljs to drive an application.  I’d be curious too if there is any such usage.</span></div><div id="t1477624363000066" t="2016-10-28 03:12:43 ramkumarkb @wparker: Hi William, 

With reference to your discussion thread on conditional activation:
 https://groups.google.com/forum/#!searchin/clara-rules/conditional$20activation%7Csort:relevance/clara-rules/w_Iq7zom2bU/OFcbeFZlCwAJ  

We have a similar requirement when we want to fire rule-3, when either rule-1 or rule-2 does not fire for a fact of TypeA

We find that the [:not [Logicamarker ]] approach is not working as it appears that RETE engine fires the rule bcos before the rule-1 or rule-2 creates the LogicalMarker, rule-3 LHS seems to be satisfied.

Any tips would be really helpful.

(defrecord LogicalMarker [marker prop1 prop2]
(defrule rule-1
    [?a &lt;- TypeA (= ?prop1 prop1) (= ?prop2 prop2)]
    [?x &lt;- TypeX]
    =&gt;
   (insert! (map-&gt;LogicalMarker {:marker &quot;1&quot; :prop1 ?prop1 :prop2 ?prop2}))
   
(defrule rule-2
    [?a &lt;- TypeA (= ?prop1 prop1) (= ?prop2 prop2)]
    [?y &lt;- TypeY]
    =&gt;
    (insert! (map-&gt;LogicalMarker {:marker &quot;2&quot; :prop1 ?prop1 :prop2 ?prop2}))
    
(defrule rule-3
    [?a &lt;- TypeA (= ?prop1 prop1) (= ?prop2 prop2)]
    [:not [LogicalMarker (= ?prop1 :prop1) (= ?prop2 :prop2)]]
    =&gt;
   (println &quot;Conditional Rule executed successfully!&quot;)"><a href="#t1477624363000066" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-10-28</span> <span class="t" onclick="H(this)">03:12:43</span>              ramkumarkb </span><span>@wparker: Hi William, 

With reference to your discussion thread on conditional activation:
</span><a href="https://groups.google.com/forum/#!searchin/clara-rules/conditional$20activation%7Csort:relevance/clara-rules/w_Iq7zom2bU/OFcbeFZlCwAJ" target="_blank">https://groups.google.com/forum/#!searchin/clara-rules/conditional$20activation%7Csort:relevance/clara-rules/w_Iq7zom2bU/OFcbeFZlCwAJ</a><span> 

We have a similar requirement when we want to fire rule-3, when either rule-1 or rule-2 does not fire for a fact of TypeA

We find that the [:not [Logicamarker ]] approach is not working as it appears that RETE engine fires the rule bcos before the rule-1 or rule-2 creates the LogicalMarker, rule-3 LHS seems to be satisfied.

Any tips would be really helpful.

(defrecord LogicalMarker [marker prop1 prop2]
(defrule rule-1
    [?a &lt;- TypeA (= ?prop1 prop1) (= ?prop2 prop2)]
    [?x &lt;- TypeX]
    =&gt;
   (insert! (map-&gt;LogicalMarker {:marker &quot;1&quot; :prop1 ?prop1 :prop2 ?prop2}))
   
(defrule rule-2
    [?a &lt;- TypeA (= ?prop1 prop1) (= ?prop2 prop2)]
    [?y &lt;- TypeY]
    =&gt;
    (insert! (map-&gt;LogicalMarker {:marker &quot;2&quot; :prop1 ?prop1 :prop2 ?prop2}))
    
(defrule rule-3
    [?a &lt;- TypeA (= ?prop1 prop1) (= ?prop2 prop2)]
    [:not [LogicalMarker (= ?prop1 :prop1) (= ?prop2 :prop2)]]
    =&gt;
   (println &quot;Conditional Rule executed successfully!&quot;)</span></div><div id="t1477681176000067" t="2016-10-28 18:59:36 ryanbrush Hey @ramkumarkb, I posted a response on the Google Group thread. Hopefully that helps."><a href="#t1477681176000067" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-10-28</span> <span class="t" onclick="H(this)">18:59:36</span>               ryanbrush </span><span>Hey @ramkumarkb, I posted a response on the Google Group thread. Hopefully that helps.</span></div><div id="t1478875632000069" t="2016-11-11 14:47:12 ryanbrush Hey everyone, a quick announcement regarding Clara: we&apos;ve been using it heavily in production at Cerner for some time, so we&apos;re making it official an open source project sponsored by Cerner."><a href="#t1478875632000069" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-11-11</span> <span class="t" onclick="H(this)">14:47:12</span>               ryanbrush </span><span>Hey everyone, a quick announcement regarding Clara: we&apos;ve been using it heavily in production at Cerner for some time, so we&apos;re making it official an open source project sponsored by Cerner.</span></div><div id="t1478875683000070" t="2016-11-11 14:48:03 ryanbrush You can see the announcement here:  http://engineering.cerner.com/blog/clara-rules-joins-cerner-open-source/"><a href="#t1478875683000070" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-11-11</span> <span class="t" onclick="H(this)">14:48:03</span>               ryanbrush </span><span>You can see the announcement here: </span><a href="http://engineering.cerner.com/blog/clara-rules-joins-cerner-open-source/" target="_blank">http://engineering.cerner.com/blog/clara-rules-joins-cerner-open-source/</a></div><div id="t1478875797000071" t="2016-11-11 14:49:57 ryanbrush This is a good thing for Clara. It reflects its importance to our production systems, and shows this project will be maintained far into the future. Otherwise, not much else will change from the users&apos; perspective; it&apos;s the same code in a new location, with all future releases in the com.cerner group on Clojars."><a href="#t1478875797000071" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-11-11</span> <span class="t" onclick="H(this)">14:49:57</span>               ryanbrush </span><span>This is a good thing for Clara. It reflects its importance to our production systems, and shows this project will be maintained far into the future. Otherwise, not much else will change from the users&apos; perspective; it&apos;s the same code in a new location, with all future releases in the com.cerner group on Clojars.</span></div><div id="t1479334901000073" t="2016-11-16 22:21:41 surreal.analysis I think I’m missing something with accumulators - I’d like to have some sort of collection of reasons that something failed"><a href="#t1479334901000073" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-11-16</span> <span class="t" onclick="H(this)">22:21:41</span>        surreal.analysis </span><span>I think I’m missing something with accumulators - I’d like to have some sort of collection of reasons that something failed</span></div><div id="t1479334911000074" t="2016-11-16 22:21:51 surreal.analysis Originally I thought the best way to do that would be to have rules for each mode of failure"><a href="#t1479334911000074" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-11-16</span> <span class="t" onclick="H(this)">22:21:51</span>        surreal.analysis </span><span>Originally I thought the best way to do that would be to have rules for each mode of failure</span></div><div id="t1479334919000075" t="2016-11-16 22:21:59 surreal.analysis And those rules would add a fact with a reason"><a href="#t1479334919000075" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-11-16</span> <span class="t" onclick="H(this)">22:21:59</span>        surreal.analysis </span><span>And those rules would add a fact with a reason</span></div><div id="t1479334933000076" t="2016-11-16 22:22:13 surreal.analysis Test code here:

 (defrecord DomainObject [name1 name2])
(defrecord Invalid [reason])

(defrule name1-not-test
  [DomainObject (not= name1 &quot;test&quot;)]
  =&gt;
  (insert! (-&gt;Invalid &quot;test&quot;)))

(defrule name2-is-test
  [DomainObject (= name2 &quot;test&quot;)]
  =&gt;
  (insert! (-&gt;Invalid &quot;name2 test&quot;)))

(defrule collect-invalids
  [?reasons &lt;- (acc/all) :from [Invalid]]
  =&gt;
  (prn &quot;Invalid for: &quot; (map :reason ?reasons)))
"><a href="#t1479334933000076" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-11-16</span> <span class="t" onclick="H(this)">22:22:13</span>        surreal.analysis </span><span>Test code here:

</span><pre>(defrecord DomainObject [name1 name2])
(defrecord Invalid [reason])

(defrule name1-not-test
  [DomainObject (not= name1 &quot;test&quot;)]
  =&gt;
  (insert! (-&gt;Invalid &quot;test&quot;)))

(defrule name2-is-test
  [DomainObject (= name2 &quot;test&quot;)]
  =&gt;
  (insert! (-&gt;Invalid &quot;name2 test&quot;)))

(defrule collect-invalids
  [?reasons &lt;- (acc/all) :from [Invalid]]
  =&gt;
  (prn &quot;Invalid for: &quot; (map :reason ?reasons)))
</pre></div><div id="t1479334947000077" t="2016-11-16 22:22:27 surreal.analysis When run with:
 (-&gt; (mk-session &apos;clara-playground.core)
                           (insert (-&gt;DomainObject &quot;nottest&quot; &quot;test&quot;))
                           (fire-rules))"><a href="#t1479334947000077" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-11-16</span> <span class="t" onclick="H(this)">22:22:27</span>        surreal.analysis </span><span>When run with:
</span><pre>(-&gt; (mk-session &apos;clara-playground.core)
                           (insert (-&gt;DomainObject &quot;nottest&quot; &quot;test&quot;))
                           (fire-rules))</pre></div><div id="t1479334954000078" t="2016-11-16 22:22:34 surreal.analysis The output is  &quot;Invalid for: &quot; ()
&quot;Invalid for: &quot; (&quot;test&quot; &quot;name2 test&quot;)
"><a href="#t1479334954000078" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-11-16</span> <span class="t" onclick="H(this)">22:22:34</span>        surreal.analysis </span><span>The output is </span><pre>&quot;Invalid for: &quot; ()
&quot;Invalid for: &quot; (&quot;test&quot; &quot;name2 test&quot;)
</pre></div><div id="t1479334966000079" t="2016-11-16 22:22:46 surreal.analysis After reading more on the accumulator side, I added a restriction"><a href="#t1479334966000079" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-11-16</span> <span class="t" onclick="H(this)">22:22:46</span>        surreal.analysis </span><span>After reading more on the accumulator side, I added a restriction</span></div><div id="t1479334979000080" t="2016-11-16 22:22:59 surreal.analysis And rewrote  collect-invalids  as  (defrule collect-invalids
  [?reasons &lt;- (acc/all) :from [Invalid (= ?reason reason)]]
  =&gt;
  (prn &quot;Invalid for: &quot; (map :reason ?reasons)))
"><a href="#t1479334979000080" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-11-16</span> <span class="t" onclick="H(this)">22:22:59</span>        surreal.analysis </span><span>And rewrote </span><code>collect-invalids</code><span> as </span><pre>(defrule collect-invalids
  [?reasons &lt;- (acc/all) :from [Invalid (= ?reason reason)]]
  =&gt;
  (prn &quot;Invalid for: &quot; (map :reason ?reasons)))
</pre></div><div id="t1479334989000081" t="2016-11-16 22:23:09 surreal.analysis But that output is  &quot;Invalid for: &quot; (&quot;test&quot;)
&quot;Invalid for: &quot; (&quot;name2 test&quot;)
"><a href="#t1479334989000081" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-11-16</span> <span class="t" onclick="H(this)">22:23:09</span>        surreal.analysis </span><span>But that output is </span><pre>&quot;Invalid for: &quot; (&quot;test&quot;)
&quot;Invalid for: &quot; (&quot;name2 test&quot;)
</pre></div><div id="t1479334993000082" t="2016-11-16 22:23:13 surreal.analysis Any suggestions on what I’m missing?"><a href="#t1479334993000082" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-11-16</span> <span class="t" onclick="H(this)">22:23:13</span>        surreal.analysis </span><span>Any suggestions on what I’m missing?</span></div><div id="t1479335095000083" t="2016-11-16 22:24:55 surreal.analysis If it’s unclear, I want  collect-invalids  to fire a single time, with all the reasons"><a href="#t1479335095000083" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-11-16</span> <span class="t" onclick="H(this)">22:24:55</span>        surreal.analysis </span><span>If it’s unclear, I want </span><code>collect-invalids</code><span> to fire a single time, with all the reasons</span></div><div id="t1479335346000084" t="2016-11-16 22:29:06 surreal.analysis Or is this something that’s better left to queries?"><a href="#t1479335346000084" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-11-16</span> <span class="t" onclick="H(this)">22:29:06</span>        surreal.analysis </span><span>Or is this something that’s better left to queries?</span></div><div id="t1479375098000085" t="2016-11-17 09:31:38 wparker @surreal.analysis I think this is expected behavior.  The contract from Clara is that the state after all rules finish firing will be consistent with the rules, but the steps Clara takes to get there inside fire-rules are undefined except if you provide salience.  Your print statements are reflecting intermediate state in the rules engine that is eliminated before fire-rules returns.  So in your first example, collect-invalids fired with no Invalid facts because none had been created yet; once Invalid facts were created it fired with them.  If collect-invalids had inserted other fact(s) the facts inserted by the firing with no Invalid facts yet would be removed before fire-rules returned to the caller.  For something like this I’d suggest using queries or inserting another fact using insert! since these will be adjusted by the truth maintenance system when Invalid facts are added to the session."><a href="#t1479375098000085" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-11-17</span> <span class="t" onclick="H(this)">09:31:38</span>                 wparker </span><span>@surreal.analysis I think this is expected behavior.  The contract from Clara is that the state after all rules finish firing will be consistent with the rules, but the steps Clara takes to get there inside fire-rules are undefined except if you provide salience.  Your print statements are reflecting intermediate state in the rules engine that is eliminated before fire-rules returns.  So in your first example, collect-invalids fired with no Invalid facts because none had been created yet; once Invalid facts were created it fired with them.  If collect-invalids had inserted other fact(s) the facts inserted by the firing with no Invalid facts yet would be removed before fire-rules returned to the caller.  For something like this I’d suggest using queries or inserting another fact using insert! since these will be adjusted by the truth maintenance system when Invalid facts are added to the session.</span></div><div id="t1479375137000086" t="2016-11-17 09:32:17 wparker So something like  (defquery invalid-query “query for Invalid” [Invalid (= reason ?reason)])"><a href="#t1479375137000086" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-11-17</span> <span class="t" onclick="H(this)">09:32:17</span>                 wparker </span><span>So something like  (defquery invalid-query “query for Invalid” [Invalid (= reason ?reason)])</span></div><div id="t1479375162000087" t="2016-11-17 09:32:42 wparker Or (defrecord CollectedInvalid [all-invalid-reasons])"><a href="#t1479375162000087" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-11-17</span> <span class="t" onclick="H(this)">09:32:42</span>                 wparker </span><span>Or (defrecord CollectedInvalid [all-invalid-reasons])</span></div><div id="t1479375204000088" t="2016-11-17 09:33:24 wparker (defrule get-all-invalid [?invalids &lt;- (acc/all) :from [Invalid]] =&gt; ;; for exame"><a href="#t1479375204000088" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-11-17</span> <span class="t" onclick="H(this)">09:33:24</span>                 wparker </span><span>(defrule get-all-invalid [?invalids &lt;- (acc/all) :from [Invalid]] =&gt; ;; for exame</span></div><div id="t1479375211000089" t="2016-11-17 09:33:31 wparker  ``"><a href="#t1479375211000089" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-11-17</span> <span class="t" onclick="H(this)">09:33:31</span>                 wparker </span><code></code><span>``</span></div><div id="t1479375216000090" t="2016-11-17 09:33:36 wparker (defrule get-all-invalid [?invalids &lt;- (acc/all) :from [Invalid]] =&gt;"><a href="#t1479375216000090" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-11-17</span> <span class="t" onclick="H(this)">09:33:36</span>                 wparker </span><span>(defrule get-all-invalid [?invalids &lt;- (acc/all) :from [Invalid]] =&gt;</span></div><div id="t1479375241000091" t="2016-11-17 09:34:01 wparker =&gt; ;; do something here that doesn’t depend on intermediate state"><a href="#t1479375241000091" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-11-17</span> <span class="t" onclick="H(this)">09:34:01</span>                 wparker </span><span>=&gt; ;; do something here that doesn’t depend on intermediate state</span></div><div id="t1479375286000092" t="2016-11-17 09:34:46 wparker Ignore &quot;(defrule get-all-invalid [?invalids &lt;- (acc/all) :from [Invalid]] =&gt; ;; for exame

[9:33]  
  ``” please, I was trying to set up a code block but apparently don’t know how to do so in Slack  😛"><a href="#t1479375286000092" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-11-17</span> <span class="t" onclick="H(this)">09:34:46</span>                 wparker </span><span>Ignore &quot;(defrule get-all-invalid [?invalids &lt;- (acc/all) :from [Invalid]] =&gt; ;; for exame

[9:33]  
</span><code></code><span>``” please, I was trying to set up a code block but apparently don’t know how to do so in Slack </span><b>😛</b></div><div id="t1479375302000093" t="2016-11-17 09:35:02 wparker When you did"><a href="#t1479375302000093" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-11-17</span> <span class="t" onclick="H(this)">09:35:02</span>                 wparker </span><span>When you did</span></div><div id="t1479375304000094" t="2016-11-17 09:35:04 wparker (defrule collect-invalids
  [?reasons &lt;- (acc/all) :from [Invalid (= ?reason reason)]]
  =&gt;
  (prn &quot;Invalid for: &quot; (map :reason ?reasons)))"><a href="#t1479375304000094" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-11-17</span> <span class="t" onclick="H(this)">09:35:04</span>                 wparker </span><span>(defrule collect-invalids
  [?reasons &lt;- (acc/all) :from [Invalid (= ?reason reason)]]
  =&gt;
  (prn &quot;Invalid for: &quot; (map :reason ?reasons)))</span></div><div id="t1479375450000095" t="2016-11-17 09:37:30 wparker You don’t fire when there are no Invalid facts since ?reason is not bound elsewhere (this is the behavior as of 0.12.0 at least, we fixed some bugs around accumulators that release).  However, the effect of adding the ?reason binding in the accumulator condition is that you collect all Invalid facts for each reason and fire once per distinct reason."><a href="#t1479375450000095" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-11-17</span> <span class="t" onclick="H(this)">09:37:30</span>                 wparker </span><span>You don’t fire when there are no Invalid facts since ?reason is not bound elsewhere (this is the behavior as of 0.12.0 at least, we fixed some bugs around accumulators that release).  However, the effect of adding the ?reason binding in the accumulator condition is that you collect all Invalid facts for each reason and fire once per distinct reason.</span></div><div id="t1479375500000096" t="2016-11-17 09:38:20 wparker So something like (defrule get-windspeeds-at-location
  [?wind &lt;- (acc/all) :from [WindSpeed (= ?location location)]]
  =&gt;
  ;; do something
)"><a href="#t1479375500000096" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-11-17</span> <span class="t" onclick="H(this)">09:38:20</span>                 wparker </span><span>So something like (defrule get-windspeeds-at-location
  [?wind &lt;- (acc/all) :from [WindSpeed (= ?location location)]]
  =&gt;
  ;; do something
)</span></div><div id="t1479375589000097" t="2016-11-17 09:39:49 wparker given four windspeeds, where two come from LocationA and two come from LocationB, would fire twice, once with ?wind bound to the WindSpeed from LocationA and once with ?wind bound to the WindSpeed facts from LocationB"><a href="#t1479375589000097" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-11-17</span> <span class="t" onclick="H(this)">09:39:49</span>                 wparker </span><span>given four windspeeds, where two come from LocationA and two come from LocationB, would fire twice, once with ?wind bound to the WindSpeed from LocationA and once with ?wind bound to the WindSpeed facts from LocationB</span></div><div id="t1479375676000098" t="2016-11-17 09:41:16 wparker Hopefully this clears things up, please ask if it doesn’t and if anyone has thoughts on things at  http://www.clara-rules.org/docs/accumulators/  that could be cleared up to reduce confusion I’d be interested"><a href="#t1479375676000098" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-11-17</span> <span class="t" onclick="H(this)">09:41:16</span>                 wparker </span><span>Hopefully this clears things up, please ask if it doesn’t and if anyone has thoughts on things at </span><a href="http://www.clara-rules.org/docs/accumulators/" target="_blank">http://www.clara-rules.org/docs/accumulators/</a><span> that could be cleared up to reduce confusion I’d be interested</span></div><div id="t1479937266000101" t="2016-11-23 21:41:06 devn Query on queries: I’d like to find all the facts in the session of type MyFact, where myfact looks like this:  #MyFact{:stuff #{{:a 1} {:b #AnotherFact{:c true}}}"><a href="#t1479937266000101" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-11-23</span> <span class="t" onclick="H(this)">21:41:06</span>                    devn </span><span>Query on queries: I’d like to find all the facts in the session of type MyFact, where myfact looks like this: </span><code>#MyFact{:stuff #{{:a 1} {:b #AnotherFact{:c true}}}</code></div><div id="t1479937335000102" t="2016-11-23 21:42:15 devn I’d only like to find  MyFact  where  #AnotherFact{:c true}"><a href="#t1479937335000102" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-11-23</span> <span class="t" onclick="H(this)">21:42:15</span>                    devn </span><span>I’d only like to find </span><code>MyFact</code><span> where </span><code>#AnotherFact{:c true}</code></div><div id="t1479939624000103" t="2016-11-23 22:20:24 devn It’s unclear to me how parameterization of queries works.

I have an arg :?foo to the query which is a keyword, but it does not correspond to a field on the fact."><a href="#t1479939624000103" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-11-23</span> <span class="t" onclick="H(this)">22:20:24</span>                    devn </span><span>It’s unclear to me how parameterization of queries works.

I have an arg :?foo to the query which is a keyword, but it does not correspond to a field on the fact.</span></div><div id="t1479940255000104" t="2016-11-23 22:30:55 ryanbrush Query parameters just check for equality on a bound variable. So to query on a value in a nested structure, you&apos;ll need to bind that value itself to a variable. You can do this by just having an expression on the left-hand side that gets the nested field, e.g. (= ?foo (some-expr-to-get-a-value this)."><a href="#t1479940255000104" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-11-23</span> <span class="t" onclick="H(this)">22:30:55</span>               ryanbrush </span><span>Query parameters just check for equality on a bound variable. So to query on a value in a nested structure, you&apos;ll need to bind that value itself to a variable. You can do this by just having an expression on the left-hand side that gets the nested field, e.g. (= ?foo (some-expr-to-get-a-value this).</span></div><div id="t1479940635000105" t="2016-11-23 22:37:15 devn @ryanbrush ok that makes sense, but what if I need the parameter as an argument to the expr that retrieves a value?"><a href="#t1479940635000105" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-11-23</span> <span class="t" onclick="H(this)">22:37:15</span>                    devn </span><span>@ryanbrush ok that makes sense, but what if I need the parameter as an argument to the expr that retrieves a value?</span></div><div id="t1479940652000106" t="2016-11-23 22:37:32 devn (= ?foo (get-in [:a ?foo :b] some-declared-field-on-the-toplevel-record))"><a href="#t1479940652000106" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-11-23</span> <span class="t" onclick="H(this)">22:37:32</span>                    devn </span><code>(= ?foo (get-in [:a ?foo :b] some-declared-field-on-the-toplevel-record))</code></div><div id="t1479940705000107" t="2016-11-23 22:38:25 devn where  ?foo  is the parameter  (defquery myquery [:?foo] …)"><a href="#t1479940705000107" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-11-23</span> <span class="t" onclick="H(this)">22:38:25</span>                    devn </span><span>where </span><code>?foo</code><span> is the parameter </span><code>(defquery myquery [:?foo] …)</code></div><div id="t1479940910000109" t="2016-11-23 22:41:50 ryanbrush Yeah, queries only do equality checks on bound variables. You could either bind all combinations of the nested path if it&apos;s small enough, or have your query return more than you need and filter it out afterwards, or consider other ways to model the data. Not sure what would work best for your model."><a href="#t1479940910000109" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-11-23</span> <span class="t" onclick="H(this)">22:41:50</span>               ryanbrush </span><span>Yeah, queries only do equality checks on bound variables. You could either bind all combinations of the nested path if it&apos;s small enough, or have your query return more than you need and filter it out afterwards, or consider other ways to model the data. Not sure what would work best for your model.</span></div><div id="t1479941004000110" t="2016-11-23 22:43:24 devn @ryanbrush ok, that’s kind of where i guessed we were heading. though i dont totally grok the binding of all combinations of the nested path."><a href="#t1479941004000110" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-11-23</span> <span class="t" onclick="H(this)">22:43:24</span>                    devn </span><span>@ryanbrush ok, that’s kind of where i guessed we were heading. though i dont totally grok the binding of all combinations of the nested path.</span></div><div id="t1479941193000111" t="2016-11-23 22:46:33 devn the use case is that there’s a blob of  :contributing-facts  that gets populated by a big collection of prior rules firing, and i want to write a query that finds all of the facts where the thing that contributed is  :x . short of writing a ton of queries, or generating them dynamically, i’m not sure that changing the model will help much. this is the typical “let’s have one place where we can dump a grab bag of metadata”"><a href="#t1479941193000111" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-11-23</span> <span class="t" onclick="H(this)">22:46:33</span>                    devn </span><span>the use case is that there’s a blob of </span><code>:contributing-facts</code><span> that gets populated by a big collection of prior rules firing, and i want to write a query that finds all of the facts where the thing that contributed is </span><code>:x</code><span>. short of writing a ton of queries, or generating them dynamically, i’m not sure that changing the model will help much. this is the typical “let’s have one place where we can dump a grab bag of metadata”</span></div><div id="t1479941829000112" t="2016-11-23 22:57:09 ryanbrush Yeah, I suspect having a function that scans query results, or finding another way to bind your additional criteria, would be your best bet."><a href="#t1479941829000112" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-11-23</span> <span class="t" onclick="H(this)">22:57:09</span>               ryanbrush </span><span>Yeah, I suspect having a function that scans query results, or finding another way to bind your additional criteria, would be your best bet.</span></div><div id="t1479941880000113" t="2016-11-23 22:58:00 devn @ryanbrush thanks for the help"><a href="#t1479941880000113" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-11-23</span> <span class="t" onclick="H(this)">22:58:00</span>                    devn </span><span>@ryanbrush thanks for the help</span></div><div id="t1479941897000114" t="2016-11-23 22:58:17 ryanbrush Sure thing!"><a href="#t1479941897000114" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-11-23</span> <span class="t" onclick="H(this)">22:58:17</span>               ryanbrush </span><span>Sure thing!</span></div><div id="t1480034393000115" t="2016-11-25 00:39:53 nlessa Hi, is there any way to set an observable to a clara session to get any new insertion/rectraction fo facts? (I am wondering if it would be possible to use a clara session as a source of a stream of facts)."><a href="#t1480034393000115" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-11-25</span> <span class="t" onclick="H(this)">00:39:53</span>                  nlessa </span><span>Hi, is there any way to set an observable to a clara session to get any new insertion/rectraction fo facts? (I am wondering if it would be possible to use a clara session as a source of a stream of facts).</span></div><div id="t1480075085000116" t="2016-11-25 11:58:05 wparker @nlessa Clara only returns new sessions in response to external calls to insert, retract, fire-rules etc. so if you’re looking to listen for changes in response to those actions I’d suggest just querying the session after those calls.  It is also possible to add arbitrary listeners to a session - you can see the protocol at  https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/rules/listener.cljc  and an example that simply records all operations listened upon at  https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/tools/tracing.clj  - but keep in mind that listeners often take you into internal implementation details that could change.  Also Clara sessions are immutable, in keeping with typical Clojure data structure semantics.  Inserting/retracting facts and firing rules returns a new session with the relevant operation applied but leaves the original unchanged.  It might be possible to give a better answer if we had a better idea what you’re trying to accomplish."><a href="#t1480075085000116" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-11-25</span> <span class="t" onclick="H(this)">11:58:05</span>                 wparker </span><span>@nlessa Clara only returns new sessions in response to external calls to insert, retract, fire-rules etc. so if you’re looking to listen for changes in response to those actions I’d suggest just querying the session after those calls.  It is also possible to add arbitrary listeners to a session - you can see the protocol at </span><a href="https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/rules/listener.cljc" target="_blank">https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/rules/listener.cljc</a><span> and an example that simply records all operations listened upon at </span><a href="https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/tools/tracing.clj" target="_blank">https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/tools/tracing.clj</a><span> - but keep in mind that listeners often take you into internal implementation details that could change.  Also Clara sessions are immutable, in keeping with typical Clojure data structure semantics.  Inserting/retracting facts and firing rules returns a new session with the relevant operation applied but leaves the original unchanged.  It might be possible to give a better answer if we had a better idea what you’re trying to accomplish.</span></div><div id="t1480449928000119" t="2016-11-29 20:05:28 nlessa Hi @wparker, thanks for your explanation. What I had thought was to try to treat a session as a source of streaming data. As soon as a new fact is inserted/retracted another job would examine it and take another necessary actions. I see that I can easily obtain a similar effect composing the insert! with sending the fact to a Kafka cluster (for example) but not sure how to deal with the retracts that happens automatically in a clara session."><a href="#t1480449928000119" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-11-29</span> <span class="t" onclick="H(this)">20:05:28</span>                  nlessa </span><span>Hi @wparker, thanks for your explanation. What I had thought was to try to treat a session as a source of streaming data. As soon as a new fact is inserted/retracted another job would examine it and take another necessary actions. I see that I can easily obtain a similar effect composing the insert! with sending the fact to a Kafka cluster (for example) but not sure how to deal with the retracts that happens automatically in a clara session.</span></div><div id="t1480513288000121" t="2016-11-30 13:41:28 wparker I think comparing the result of queries, which will reflect the state of the session before and after you fire rules, is what you’re looking for.  So if you have something like"><a href="#t1480513288000121" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-11-30</span> <span class="t" onclick="H(this)">13:41:28</span>                 wparker </span><span>I think comparing the result of queries, which will reflect the state of the session before and after you fire rules, is what you’re looking for.  So if you have something like</span></div><div id="t1480513324000122" t="2016-11-30 13:42:04 wparker (defrule lousy-weather-rule [?c &lt;- Cold] =&gt; (insert! (-&gt;LousyWeather)))"><a href="#t1480513324000122" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-11-30</span> <span class="t" onclick="H(this)">13:42:04</span>                 wparker </span><span>(defrule lousy-weather-rule [?c &lt;- Cold] =&gt; (insert! (-&gt;LousyWeather)))</span></div><div id="t1480513351000123" t="2016-11-30 13:42:31 wparker (defquery lousy-weather-query “” [] [LousyWeather])"><a href="#t1480513351000123" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-11-30</span> <span class="t" onclick="H(this)">13:42:31</span>                 wparker </span><span>(defquery lousy-weather-query “” [] [LousyWeather])</span></div><div id="t1480513374000124" t="2016-11-30 13:42:54 wparker Then (def empty-session (mk-session [lousy-weather-rule lousy-weather-query]))"><a href="#t1480513374000124" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-11-30</span> <span class="t" onclick="H(this)">13:42:54</span>                 wparker </span><span>Then (def empty-session (mk-session [lousy-weather-rule lousy-weather-query]))</span></div><div id="t1480513388000125" t="2016-11-30 13:43:08 wparker (query empty-session lousy-weather-query) will return nothing"><a href="#t1480513388000125" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-11-30</span> <span class="t" onclick="H(this)">13:43:08</span>                 wparker </span><span>(query empty-session lousy-weather-query) will return nothing</span></div><div id="t1480513413000126" t="2016-11-30 13:43:33 wparker However, (def not-empty-session (-&gt; empty-session (insert (-&gt;Cold)) fire-rules))"><a href="#t1480513413000126" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-11-30</span> <span class="t" onclick="H(this)">13:43:33</span>                 wparker </span><span>However, (def not-empty-session (-&gt; empty-session (insert (-&gt;Cold)) fire-rules))</span></div><div id="t1480513437000127" t="2016-11-30 13:43:57 wparker (query not-empty-session lousy-weather-query) would find a LousyWeather fact"><a href="#t1480513437000127" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-11-30</span> <span class="t" onclick="H(this)">13:43:57</span>                 wparker </span><span>(query not-empty-session lousy-weather-query) would find a LousyWeather fact</span></div><div id="t1480513475000128" t="2016-11-30 13:44:35 wparker You could query both before and after inserting/retracting + firing rules afterward and see what changed, then dispatch on that"><a href="#t1480513475000128" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-11-30</span> <span class="t" onclick="H(this)">13:44:35</span>                 wparker </span><span>You could query both before and after inserting/retracting + firing rules afterward and see what changed, then dispatch on that</span></div><div id="t1480513739000129" t="2016-11-30 13:48:59 wparker One perhaps non-obvious part of this is when you query the session, you’re not actually performing much work since Clara basically computes the results for queries after fire-rules.  When you run a query you’re really basically retrieving the results already computed with a little data manipulation to get just the bindings you use in your query.  You can see that implementation at  https://github.com/cerner/clara-rules/blob/0.13.0-RC4/src/main/clojure/clara/rules/engine.cljc#L1605"><a href="#t1480513739000129" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-11-30</span> <span class="t" onclick="H(this)">13:48:59</span>                 wparker </span><span>One perhaps non-obvious part of this is when you query the session, you’re not actually performing much work since Clara basically computes the results for queries after fire-rules.  When you run a query you’re really basically retrieving the results already computed with a little data manipulation to get just the bindings you use in your query.  You can see that implementation at </span><a href="https://github.com/cerner/clara-rules/blob/0.13.0-RC4/src/main/clojure/clara/rules/engine.cljc#L1605" target="_blank">https://github.com/cerner/clara-rules/blob/0.13.0-RC4/src/main/clojure/clara/rules/engine.cljc#L1605</a></div><div id="t1480513808000131" t="2016-11-30 13:50:08 wparker Basically a query and a rule look the same to the rules engine mostly when you look at determine what facts match, a rule just does more things (i.e. it is activated and can insert more facts) once you find matches"><a href="#t1480513808000131" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-11-30</span> <span class="t" onclick="H(this)">13:50:08</span>                 wparker </span><span>Basically a query and a rule look the same to the rules engine mostly when you look at determine what facts match, a rule just does more things (i.e. it is activated and can insert more facts) once you find matches</span></div><div id="t1480514062000132" t="2016-11-30 13:54:22 wparker You can think of it as large trees of the different node types in engine.cljc where ProductionNode corresponds to rules, QueryNode corresponds to queries, facts are given to the root nodes of these trees and passed down to the leaf nodes, which are ProductionNodes and QueryNodes"><a href="#t1480514062000132" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-11-30</span> <span class="t" onclick="H(this)">13:54:22</span>                 wparker </span><span>You can think of it as large trees of the different node types in engine.cljc where ProductionNode corresponds to rules, QueryNode corresponds to queries, facts are given to the root nodes of these trees and passed down to the leaf nodes, which are ProductionNodes and QueryNodes</span></div><div id="t1480514271000133" t="2016-11-30 13:57:51 wparker Just comparing the results before and after for the queries would work, albeit somewhat inefficiently since you’d be performing work even when nothing at all changed.  I think there are ways Clara could return changes in queries more efficiently than that if you were interested in contributing an enhancement like that though."><a href="#t1480514271000133" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-11-30</span> <span class="t" onclick="H(this)">13:57:51</span>                 wparker </span><span>Just comparing the results before and after for the queries would work, albeit somewhat inefficiently since you’d be performing work even when nothing at all changed.  I think there are ways Clara could return changes in queries more efficiently than that if you were interested in contributing an enhancement like that though.</span></div><div id="t1480514277000134" t="2016-11-30 13:57:57 wparker @nlessa"><a href="#t1480514277000134" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-11-30</span> <span class="t" onclick="H(this)">13:57:57</span>                 wparker </span><span>@nlessa</span></div><div id="t1480516226000135" t="2016-11-30 14:30:26 nlessa Thank you very much @wparker. Based in your answer I will try some approaches and let you know what I got."><a href="#t1480516226000135" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-11-30</span> <span class="t" onclick="H(this)">14:30:26</span>                  nlessa </span><span>Thank you very much @wparker. Based in your answer I will try some approaches and let you know what I got.</span></div><div id="t1480767536000002" t="2016-12-03 12:18:56 svenhuster I&apos;m looking to build an appointment scheduling system and am contemplating if clara would be useful in this context. I&apos;ve got multiple constraints around field engineer work schedules, travel time matrices for a currently small number of locations we have, expected duration etc. 
I need to gather a number of appointment options that fulfill the constraint to the select one through user input. 
Is this at a high-level a suitable problem to approach with clara?"><a href="#t1480767536000002" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-03</span> <span class="t" onclick="H(this)">12:18:56</span>              svenhuster </span><span>I&apos;m looking to build an appointment scheduling system and am contemplating if clara would be useful in this context. I&apos;ve got multiple constraints around field engineer work schedules, travel time matrices for a currently small number of locations we have, expected duration etc. 
I need to gather a number of appointment options that fulfill the constraint to the select one through user input. 
Is this at a high-level a suitable problem to approach with clara?</span></div><div id="t1480974668000004" t="2016-12-05 21:51:08 devn @svenhuster we do some scheduling logic, but not the actual creation of events. My advice would be to spike on it and see where you get. Pick a nontrivial subset of your logic, and see whether it gives you what you’re looking for"><a href="#t1480974668000004" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-05</span> <span class="t" onclick="H(this)">21:51:08</span>                    devn </span><span>@svenhuster we do some scheduling logic, but not the actual creation of events. My advice would be to spike on it and see where you get. Pick a nontrivial subset of your logic, and see whether it gives you what you’re looking for</span></div><div id="t1480974710000005" t="2016-12-05 21:51:50 devn @mikerod Thanks again for the talk, and for the chat afterwards. It was awfully cathartic to talk to folks with similar problems in healthcare, and the rules engine space in particular."><a href="#t1480974710000005" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-05</span> <span class="t" onclick="H(this)">21:51:50</span>                    devn </span><span>@mikerod Thanks again for the talk, and for the chat afterwards. It was awfully cathartic to talk to folks with similar problems in healthcare, and the rules engine space in particular.</span></div><div id="t1480975577000006" t="2016-12-05 22:06:17 mikerod svenhuster I agree with devn that one of the best things you can do is try to reason about your problem through some examples actually trying to use Clara rules and a rule-driven approach"><a href="#t1480975577000006" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-05</span> <span class="t" onclick="H(this)">22:06:17</span>                 mikerod </span><span>svenhuster I agree with devn that one of the best things you can do is try to reason about your problem through some examples actually trying to use Clara rules and a rule-driven approach</span></div><div id="t1480975588000007" t="2016-12-05 22:06:28 mikerod see if it is naturally working or if you are hitting major barriers"><a href="#t1480975588000007" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-05</span> <span class="t" onclick="H(this)">22:06:28</span>                 mikerod </span><span>see if it is naturally working or if you are hitting major barriers</span></div><div id="t1480975668000008" t="2016-12-05 22:07:48 mikerod I often thing that  http://www.jessrules.com/guidelines.shtml"><a href="#t1480975668000008" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-05</span> <span class="t" onclick="H(this)">22:07:48</span>                 mikerod </span><span>I often thing that </span><a href="http://www.jessrules.com/guidelines.shtml" target="_blank">http://www.jessrules.com/guidelines.shtml</a></div><div id="t1480975691000009" t="2016-12-05 22:08:11 mikerod Jess (an older rules engine written in Java, with a Lisp-like DSL) has some reasonable guidelines"><a href="#t1480975691000009" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-05</span> <span class="t" onclick="H(this)">22:08:11</span>                 mikerod </span><span>Jess (an older rules engine written in Java, with a Lisp-like DSL) has some reasonable guidelines</span></div><div id="t1480975701000010" t="2016-12-05 22:08:21 mikerod I think we could do better to get some guidelines on this up on Clara rules"><a href="#t1480975701000010" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-05</span> <span class="t" onclick="H(this)">22:08:21</span>                 mikerod </span><span>I think we could do better to get some guidelines on this up on Clara rules</span></div><div id="t1480975726000011" t="2016-12-05 22:08:46 mikerod However, the most powerful I’d say is to try demo’ing out solving one of your problems (even if simplified) by using rules and see if it can make any sense."><a href="#t1480975726000011" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-05</span> <span class="t" onclick="H(this)">22:08:46</span>                 mikerod </span><span>However, the most powerful I’d say is to try demo’ing out solving one of your problems (even if simplified) by using rules and see if it can make any sense.</span></div><div id="t1480975752000012" t="2016-12-05 22:09:12 mikerod devn It was good to talk with you.  It was nice to hear your perspective and things you’ve been working through."><a href="#t1480975752000012" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-05</span> <span class="t" onclick="H(this)">22:09:12</span>                 mikerod </span><span>devn It was good to talk with you.  It was nice to hear your perspective and things you’ve been working through.</span></div><div id="t1480990131000013" t="2016-12-06 02:08:51 devn @mikerod william byrd is a friend of mine"><a href="#t1480990131000013" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-06</span> <span class="t" onclick="H(this)">02:08:51</span>                    devn </span><span>@mikerod william byrd is a friend of mine</span></div><div id="t1480990157000014" t="2016-12-06 02:09:17 devn what if Barliman (his code synthesis project) could synthesize rules"><a href="#t1480990157000014" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-06</span> <span class="t" onclick="H(this)">02:09:17</span>                    devn </span><span>what if Barliman (his code synthesis project) could synthesize rules</span></div><div id="t1480990230000015" t="2016-12-06 02:10:30 devn i’ve found there’s a sort of typical “well i know i need to join X and Y on field :q&quot;"><a href="#t1480990230000015" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-06</span> <span class="t" onclick="H(this)">02:10:30</span>                    devn </span><span>i’ve found there’s a sort of typical “well i know i need to join X and Y on field :q&quot;</span></div><div id="t1480990256000016" t="2016-12-06 02:10:56 devn “and i expect a Z to be inserted&quot;"><a href="#t1480990256000016" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-06</span> <span class="t" onclick="H(this)">02:10:56</span>                    devn </span><span>“and i expect a Z to be inserted&quot;</span></div><div id="t1480990359000017" t="2016-12-06 02:12:39 devn this is a kind of partial description of both arity and return value"><a href="#t1480990359000017" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-06</span> <span class="t" onclick="H(this)">02:12:39</span>                    devn </span><span>this is a kind of partial description of both arity and return value</span></div><div id="t1480990374000018" t="2016-12-06 02:12:54 devn you may have a function  cool?  in the same namespace"><a href="#t1480990374000018" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-06</span> <span class="t" onclick="H(this)">02:12:54</span>                    devn </span><span>you may have a function </span><code>cool?</code><span> in the same namespace</span></div><div id="t1480990549000019" t="2016-12-06 02:15:49 devn he showed an example of: provided a definition of reduce-right, you can define concat"><a href="#t1480990549000019" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-06</span> <span class="t" onclick="H(this)">02:15:49</span>                    devn </span><span>he showed an example of: provided a definition of reduce-right, you can define concat</span></div><div id="t1480990556000020" t="2016-12-06 02:15:56 devn imagine a smallish rulebase in a namespace under test"><a href="#t1480990556000020" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-06</span> <span class="t" onclick="H(this)">02:15:56</span>                    devn </span><span>imagine a smallish rulebase in a namespace under test</span></div><div id="t1480990681000021" t="2016-12-06 02:18:01 devn i’m talking a bit of gibberish i suppose, but will was talking about synthesizing the “last 10%” of your program"><a href="#t1480990681000021" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-06</span> <span class="t" onclick="H(this)">02:18:01</span>                    devn </span><span>i’m talking a bit of gibberish i suppose, but will was talking about synthesizing the “last 10%” of your program</span></div><div id="t1480990709000022" t="2016-12-06 02:18:29 devn i wonder if generating the “last rule” in a smallish rulebase would be an interesting place to try that out"><a href="#t1480990709000022" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-06</span> <span class="t" onclick="H(this)">02:18:29</span>                    devn </span><span>i wonder if generating the “last rule” in a smallish rulebase would be an interesting place to try that out</span></div><div id="t1480991332000023" t="2016-12-06 02:28:52 jonsmock For me, the writing the rules is the &quot;easy part&quot; but knowing if my rules cover what I think they do is the hard part"><a href="#t1480991332000023" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-06</span> <span class="t" onclick="H(this)">02:28:52</span>                jonsmock </span><span>For me, the writing the rules is the &quot;easy part&quot; but knowing if my rules cover what I think they do is the hard part</span></div><div id="t1480991361000024" t="2016-12-06 02:29:21 jonsmock (I&apos;m saying this as someone who is completely entranced by Barliman. I love that stuff, and I cloned the repo for the flight home)"><a href="#t1480991361000024" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-06</span> <span class="t" onclick="H(this)">02:29:21</span>                jonsmock </span><span>(I&apos;m saying this as someone who is completely entranced by Barliman. I love that stuff, and I cloned the repo for the flight home)</span></div><div id="t1480991424000025" t="2016-12-06 02:30:24 jonsmock But at least at work (we use clara-rules), I want tooling around the rules I have"><a href="#t1480991424000025" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-06</span> <span class="t" onclick="H(this)">02:30:24</span>                jonsmock </span><span>But at least at work (we use clara-rules), I want tooling around the rules I have</span></div><div id="t1480991436000026" t="2016-12-06 02:30:36 jonsmock Could just be me, not trying to dismiss what you&apos;re saying"><a href="#t1480991436000026" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-06</span> <span class="t" onclick="H(this)">02:30:36</span>                jonsmock </span><span>Could just be me, not trying to dismiss what you&apos;re saying</span></div><div id="t1480991475000027" t="2016-12-06 02:31:15 jonsmock i.e. here&apos;s a ns of rules, did I cover all cases"><a href="#t1480991475000027" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-06</span> <span class="t" onclick="H(this)">02:31:15</span>                jonsmock </span><span>i.e. here&apos;s a ns of rules, did I cover all cases</span></div><div id="t1480991503000028" t="2016-12-06 02:31:43 jonsmock Or our actual situation:  here&apos;s a ns of rules, is it possible more than one can fire?"><a href="#t1480991503000028" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-06</span> <span class="t" onclick="H(this)">02:31:43</span>                jonsmock </span><span>Or our actual situation:  here&apos;s a ns of rules, is it possible more than one can fire?</span></div><div id="t1480991536000029" t="2016-12-06 02:32:16 jonsmock Again might be unique to the way I use clara-rules, but I have a hierarchy that looks like:"><a href="#t1480991536000029" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-06</span> <span class="t" onclick="H(this)">02:32:16</span>                jonsmock </span><span>Again might be unique to the way I use clara-rules, but I have a hierarchy that looks like:</span></div><div id="t1480991555000030" t="2016-12-06 02:32:35 jonsmock basic fact rules -&gt; intermediate level deduction rules -&gt; final action rules"><a href="#t1480991555000030" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-06</span> <span class="t" onclick="H(this)">02:32:35</span>                jonsmock </span><span>basic fact rules -&gt; intermediate level deduction rules -&gt; final action rules</span></div><div id="t1480991605000031" t="2016-12-06 02:33:25 jonsmock And I want just one final action rule to fire (this doesn&apos;t actually do a side effect. Something else uses the output of the rule engine to take an action)"><a href="#t1480991605000031" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-06</span> <span class="t" onclick="H(this)">02:33:25</span>                jonsmock </span><span>And I want just one final action rule to fire (this doesn&apos;t actually do a side effect. Something else uses the output of the rule engine to take an action)</span></div><div id="t1480991647000032" t="2016-12-06 02:34:07 jonsmock But yeah, Barliman looks sick. I seriously eat that stuff up"><a href="#t1480991647000032" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-06</span> <span class="t" onclick="H(this)">02:34:07</span>                jonsmock </span><span>But yeah, Barliman looks sick. I seriously eat that stuff up</span></div><div id="t1481010205000033" t="2016-12-06 07:43:25 svenhuster @devn @mikerod thanks a lot. I shall have a go. "><a href="#t1481010205000033" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-06</span> <span class="t" onclick="H(this)">07:43:25</span>              svenhuster </span><span>@devn @mikerod thanks a lot. I shall have a go. </span></div><div id="t1481037902000035" t="2016-12-06 15:25:02 mikerod devn if nothing else, I think it’d be an interesting experiment"><a href="#t1481037902000035" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-06</span> <span class="t" onclick="H(this)">15:25:02</span>                 mikerod </span><span>devn if nothing else, I think it’d be an interesting experiment</span></div><div id="t1481037917000036" t="2016-12-06 15:25:17 mikerod That was an interesting talk."><a href="#t1481037917000036" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-06</span> <span class="t" onclick="H(this)">15:25:17</span>                 mikerod </span><span>That was an interesting talk.</span></div><div id="t1481037971000037" t="2016-12-06 15:26:11 mikerod jonsmock I agree that more tooling would be a big win and is one of the harder parts."><a href="#t1481037971000037" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-06</span> <span class="t" onclick="H(this)">15:26:11</span>                 mikerod </span><span>jonsmock I agree that more tooling would be a big win and is one of the harder parts.</span></div><div id="t1481037982000038" t="2016-12-06 15:26:22 mikerod I’ll repeat since I missed the tags:"><a href="#t1481037982000038" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-06</span> <span class="t" onclick="H(this)">15:26:22</span>                 mikerod </span><span>I’ll repeat since I missed the tags:</span></div><div id="t1481037992000039" t="2016-12-06 15:26:32 jonsmock Yeah, sorry, I was thinking more about devn&apos;s thing"><a href="#t1481037992000039" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-06</span> <span class="t" onclick="H(this)">15:26:32</span>                jonsmock </span><span>Yeah, sorry, I was thinking more about devn&apos;s thing</span></div><div id="t1481037996000040" t="2016-12-06 15:26:36 mikerod @devn if nothing else, I think it’d be an interesting experiment"><a href="#t1481037996000040" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-06</span> <span class="t" onclick="H(this)">15:26:36</span>                 mikerod </span><span>@devn if nothing else, I think it’d be an interesting experiment</span></div><div id="t1481037999000041" t="2016-12-06 15:26:39 jonsmock Sounds cool, and I shouldn&apos;t poopoo it"><a href="#t1481037999000041" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-06</span> <span class="t" onclick="H(this)">15:26:39</span>                jonsmock </span><span>Sounds cool, and I shouldn&apos;t poopoo it</span></div><div id="t1481038009000042" t="2016-12-06 15:26:49 jonsmock (Not that I was trying to, but I think I sounded negative)"><a href="#t1481038009000042" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-06</span> <span class="t" onclick="H(this)">15:26:49</span>                jonsmock </span><span>(Not that I was trying to, but I think I sounded negative)</span></div><div id="t1481038036000043" t="2016-12-06 15:27:16 jonsmock btw @mikerod I&apos;m about half-way through your talk now - nice work!"><a href="#t1481038036000043" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-06</span> <span class="t" onclick="H(this)">15:27:16</span>                jonsmock </span><span>btw @mikerod I&apos;m about half-way through your talk now - nice work!</span></div><div id="t1481038057000044" t="2016-12-06 15:27:37 mikerod thanks.  it’s a bit basic I’m sure given how much you are already entrenched in the details of working with rules."><a href="#t1481038057000044" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-06</span> <span class="t" onclick="H(this)">15:27:37</span>                 mikerod </span><span>thanks.  it’s a bit basic I’m sure given how much you are already entrenched in the details of working with rules.</span></div><div id="t1481038154000045" t="2016-12-06 15:29:14 mikerod @jonsmock Maybe a SAT solver can be used in some sort of tooling around rule analysis  🙂"><a href="#t1481038154000045" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-06</span> <span class="t" onclick="H(this)">15:29:14</span>                 mikerod </span><span>@jonsmock Maybe a SAT solver can be used in some sort of tooling around rule analysis </span><b>🙂</b></div><div id="t1481038511000046" t="2016-12-06 15:35:11 devn @jonsmock: agreed on tooling, and I didn&apos;t read it as negative "><a href="#t1481038511000046" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-06</span> <span class="t" onclick="H(this)">15:35:11</span>                    devn </span><span>@jonsmock: agreed on tooling, and I didn&apos;t read it as negative </span></div><div id="t1481038579000047" t="2016-12-06 15:36:19 devn Some of the tooling stuff you describe is I think pretty straightforward "><a href="#t1481038579000047" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-06</span> <span class="t" onclick="H(this)">15:36:19</span>                    devn </span><span>Some of the tooling stuff you describe is I think pretty straightforward </span></div><div id="t1481038611000048" t="2016-12-06 15:36:51 devn I would really like to know coverage of my rules under test "><a href="#t1481038611000048" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-06</span> <span class="t" onclick="H(this)">15:36:51</span>                    devn </span><span>I would really like to know coverage of my rules under test </span></div><div id="t1481038655000049" t="2016-12-06 15:37:35 devn The inspect session output I believe can answer that, but it would require carrying around some state between tests"><a href="#t1481038655000049" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-06</span> <span class="t" onclick="H(this)">15:37:35</span>                    devn </span><span>The inspect session output I believe can answer that, but it would require carrying around some state between tests</span></div><div id="t1481038929000052" t="2016-12-06 15:42:09 jonsmock I think I&apos;ve played around with property tests and rules, but I don&apos;t know if we have any at the moment"><a href="#t1481038929000052" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-06</span> <span class="t" onclick="H(this)">15:42:09</span>                jonsmock </span><span>I think I&apos;ve played around with property tests and rules, but I don&apos;t know if we have any at the moment</span></div><div id="t1481038971000053" t="2016-12-06 15:42:51 jonsmock With a large rule system, it seems harder to synthesize the right data"><a href="#t1481038971000053" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-06</span> <span class="t" onclick="H(this)">15:42:51</span>                jonsmock </span><span>With a large rule system, it seems harder to synthesize the right data</span></div><div id="t1481038990000054" t="2016-12-06 15:43:10 devn @jonsmock: indeed"><a href="#t1481038990000054" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-06</span> <span class="t" onclick="H(this)">15:43:10</span>                    devn </span><span>@jonsmock: indeed</span></div><div id="t1481039067000055" t="2016-12-06 15:44:27 jonsmock I should think about it more though hmm"><a href="#t1481039067000055" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-06</span> <span class="t" onclick="H(this)">15:44:27</span>                jonsmock </span><span>I should think about it more though hmm</span></div><div id="t1481039080000056" t="2016-12-06 15:44:40 devn Our tests are easy to write in the small "><a href="#t1481039080000056" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-06</span> <span class="t" onclick="H(this)">15:44:40</span>                    devn </span><span>Our tests are easy to write in the small </span></div><div id="t1481039106000057" t="2016-12-06 15:45:06 devn But terribly difficult to do integration tests "><a href="#t1481039106000057" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-06</span> <span class="t" onclick="H(this)">15:45:06</span>                    devn </span><span>But terribly difficult to do integration tests </span></div><div id="t1481039113000058" t="2016-12-06 15:45:13 devn Because there is a truckload of data"><a href="#t1481039113000058" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-06</span> <span class="t" onclick="H(this)">15:45:13</span>                    devn </span><span>Because there is a truckload of data</span></div><div id="t1481039122000059" t="2016-12-06 15:45:22 devn Not Clara&apos;s fault"><a href="#t1481039122000059" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-06</span> <span class="t" onclick="H(this)">15:45:22</span>                    devn </span><span>Not Clara&apos;s fault</span></div><div id="t1481039132000060" t="2016-12-06 15:45:32 devn Just a function of the domain"><a href="#t1481039132000060" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-06</span> <span class="t" onclick="H(this)">15:45:32</span>                    devn </span><span>Just a function of the domain</span></div><div id="t1481039150000061" t="2016-12-06 15:45:50 jonsmock Yeah that&apos;s basically what we have at the moment"><a href="#t1481039150000061" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-06</span> <span class="t" onclick="H(this)">15:45:50</span>                jonsmock </span><span>Yeah that&apos;s basically what we have at the moment</span></div><div id="t1481039161000062" t="2016-12-06 15:46:01 jonsmock A handful of integration tests and some unit tests on specific namespaces"><a href="#t1481039161000062" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-06</span> <span class="t" onclick="H(this)">15:46:01</span>                jonsmock </span><span>A handful of integration tests and some unit tests on specific namespaces</span></div><div id="t1481039179000063" t="2016-12-06 15:46:19 devn We&apos;ve talked about doing test generators that compose across a couple/few namespaces "><a href="#t1481039179000063" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-06</span> <span class="t" onclick="H(this)">15:46:19</span>                    devn </span><span>We&apos;ve talked about doing test generators that compose across a couple/few namespaces </span></div><div id="t1481039202000064" t="2016-12-06 15:46:42 devn So we can improve coverage without doing massive integration tests"><a href="#t1481039202000064" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-06</span> <span class="t" onclick="H(this)">15:46:42</span>                    devn </span><span>So we can improve coverage without doing massive integration tests</span></div><div id="t1481039234000065" t="2016-12-06 15:47:14 jonsmock I&apos;m curious if you have the same organization to your rules. We basically have 3 tiers ... oh I guess I said this above"><a href="#t1481039234000065" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-06</span> <span class="t" onclick="H(this)">15:47:14</span>                jonsmock </span><span>I&apos;m curious if you have the same organization to your rules. We basically have 3 tiers ... oh I guess I said this above</span></div><div id="t1481039237000066" t="2016-12-06 15:47:17 jonsmock basic fact rules -&gt; intermediate level deduction rules -&gt; final action rules"><a href="#t1481039237000066" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-06</span> <span class="t" onclick="H(this)">15:47:17</span>                jonsmock </span><span>basic fact rules -&gt; intermediate level deduction rules -&gt; final action rules</span></div><div id="t1481039255000067" t="2016-12-06 15:47:35 jonsmock the basic fact rules are basically digging out important stuff from giant maps from other systems"><a href="#t1481039255000067" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-06</span> <span class="t" onclick="H(this)">15:47:35</span>                jonsmock </span><span>the basic fact rules are basically digging out important stuff from giant maps from other systems</span></div><div id="t1481039270000068" t="2016-12-06 15:47:50 jonsmock So I probably could write generators after that level"><a href="#t1481039270000068" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-06</span> <span class="t" onclick="H(this)">15:47:50</span>                jonsmock </span><span>So I probably could write generators after that level</span></div><div id="t1481039279000069" t="2016-12-06 15:47:59 jonsmock And property test the intermediate and action rules together"><a href="#t1481039279000069" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-06</span> <span class="t" onclick="H(this)">15:47:59</span>                jonsmock </span><span>And property test the intermediate and action rules together</span></div><div id="t1481039289000070" t="2016-12-06 15:48:09 devn we built a library that builds facts, and their variants (intermediate facts) using a bit of macro sugar"><a href="#t1481039289000070" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-06</span> <span class="t" onclick="H(this)">15:48:09</span>                    devn </span><span>we built a library that builds facts, and their variants (intermediate facts) using a bit of macro sugar</span></div><div id="t1481039295000071" t="2016-12-06 15:48:15 devn so that’s your step 1"><a href="#t1481039295000071" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-06</span> <span class="t" onclick="H(this)">15:48:15</span>                    devn </span><span>so that’s your step 1</span></div><div id="t1481039387000072" t="2016-12-06 15:49:47 devn (deffact FooFact
  “Blah blah&quot;
  (alias foo-fact

  (field some_id :spec string? :doc “blah blah”)

  (variant InterestingFooFact
    (field additional_field :spec number? :doc “…”)))
"><a href="#t1481039387000072" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-06</span> <span class="t" onclick="H(this)">15:49:47</span>                    devn </span><pre>(deffact FooFact
  “Blah blah&quot;
  (alias foo-fact

  (field some_id :spec string? :doc “blah blah”)

  (variant InterestingFooFact
    (field additional_field :spec number? :doc “…”)))
</pre></div><div id="t1481039401000073" t="2016-12-06 15:50:01 jonsmock Oh neat"><a href="#t1481039401000073" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-06</span> <span class="t" onclick="H(this)">15:50:01</span>                jonsmock </span><span>Oh neat</span></div><div id="t1481039405000074" t="2016-12-06 15:50:05 devn err sorry, i guess that’s not your step 1, but it’s kind of interesting"><a href="#t1481039405000074" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-06</span> <span class="t" onclick="H(this)">15:50:05</span>                    devn </span><span>err sorry, i guess that’s not your step 1, but it’s kind of interesting</span></div><div id="t1481039411000075" t="2016-12-06 15:50:11 jonsmock Yeah that&apos;s really neat"><a href="#t1481039411000075" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-06</span> <span class="t" onclick="H(this)">15:50:11</span>                jonsmock </span><span>Yeah that&apos;s really neat</span></div><div id="t1481039430000076" t="2016-12-06 15:50:30 jonsmock It would be cool to put more relational info int hat"><a href="#t1481039430000076" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-06</span> <span class="t" onclick="H(this)">15:50:30</span>                jonsmock </span><span>It would be cool to put more relational info int hat</span></div><div id="t1481039431000077" t="2016-12-06 15:50:31 devn then we can use it to validate our facts conform"><a href="#t1481039431000077" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-06</span> <span class="t" onclick="H(this)">15:50:31</span>                    devn </span><span>then we can use it to validate our facts conform</span></div><div id="t1481039434000078" t="2016-12-06 15:50:34 devn yeah absolutely"><a href="#t1481039434000078" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-06</span> <span class="t" onclick="H(this)">15:50:34</span>                    devn </span><span>yeah absolutely</span></div><div id="t1481039464000079" t="2016-12-06 15:51:04 jonsmock For us, it&apos;s all about what the insurance has paid, etc"><a href="#t1481039464000079" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-06</span> <span class="t" onclick="H(this)">15:51:04</span>                jonsmock </span><span>For us, it&apos;s all about what the insurance has paid, etc</span></div><div id="t1481039468000080" t="2016-12-06 15:51:08 devn we also introduced a trace_id on all fact types, which is carried around, so you can track the lineage of a fact a bit easier"><a href="#t1481039468000080" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-06</span> <span class="t" onclick="H(this)">15:51:08</span>                    devn </span><span>we also introduced a trace_id on all fact types, which is carried around, so you can track the lineage of a fact a bit easier</span></div><div id="t1481039517000081" t="2016-12-06 15:51:57 jonsmock So I&apos;m thinking like (deffact TotalCharges ...) and having other facts declaratively say that they are less than TotalCharges"><a href="#t1481039517000081" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-06</span> <span class="t" onclick="H(this)">15:51:57</span>                jonsmock </span><span>So I&apos;m thinking like (deffact TotalCharges ...) and having other facts declaratively say that they are less than TotalCharges</span></div><div id="t1481039521000082" t="2016-12-06 15:52:01 devn and, we have a :contributing_factors field on many (not all) facts, which captures interesting “why” information"><a href="#t1481039521000082" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-06</span> <span class="t" onclick="H(this)">15:52:01</span>                    devn </span><span>and, we have a :contributing_factors field on many (not all) facts, which captures interesting “why” information</span></div><div id="t1481039531000083" t="2016-12-06 15:52:11 jonsmock Ah cool"><a href="#t1481039531000083" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-06</span> <span class="t" onclick="H(this)">15:52:11</span>                jonsmock </span><span>Ah cool</span></div><div id="t1481039539000084" t="2016-12-06 15:52:19 devn but some assembly required"><a href="#t1481039539000084" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-06</span> <span class="t" onclick="H(this)">15:52:19</span>                    devn </span><span>but some assembly required</span></div><div id="t1481039563000085" t="2016-12-06 15:52:43 devn @jonsmock yeah, this fact library was a first pass"><a href="#t1481039563000085" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-06</span> <span class="t" onclick="H(this)">15:52:43</span>                    devn </span><span>@jonsmock yeah, this fact library was a first pass</span></div><div id="t1481039576000086" t="2016-12-06 15:52:56 devn there’s more that could be done there for sure"><a href="#t1481039576000086" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-06</span> <span class="t" onclick="H(this)">15:52:56</span>                    devn </span><span>there’s more that could be done there for sure</span></div><div id="t1481039673000087" t="2016-12-06 15:54:33 devn @jonsmock we also have (optional-field …), and a way of specifying an explanation for each fact, so if you call (explain the-fact), it’ll give you the view you’re looking for"><a href="#t1481039673000087" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-06</span> <span class="t" onclick="H(this)">15:54:33</span>                    devn </span><span>@jonsmock we also have (optional-field …), and a way of specifying an explanation for each fact, so if you call (explain the-fact), it’ll give you the view you’re looking for</span></div><div id="t1481039726000089" t="2016-12-06 15:55:26 devn to date we haven’t actually used explain, which is just a function of the history of this project"><a href="#t1481039726000089" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-06</span> <span class="t" onclick="H(this)">15:55:26</span>                    devn </span><span>to date we haven’t actually used explain, which is just a function of the history of this project</span></div><div id="t1481039733000090" t="2016-12-06 15:55:33 devn we should have done it earlier, but there were bigger fish to fry"><a href="#t1481039733000090" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-06</span> <span class="t" onclick="H(this)">15:55:33</span>                    devn </span><span>we should have done it earlier, but there were bigger fish to fry</span></div><div id="t1481039742000091" t="2016-12-06 15:55:42 devn now we’re overdue for adding better explanations"><a href="#t1481039742000091" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-06</span> <span class="t" onclick="H(this)">15:55:42</span>                    devn </span><span>now we’re overdue for adding better explanations</span></div><div id="t1481039808000092" t="2016-12-06 15:56:48 devn “why did we make an InterestingRecommendation?” =&gt; “Patient is over 50 and has a recent encounter (&lt; 45 days) where X happened…&quot;"><a href="#t1481039808000092" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-06</span> <span class="t" onclick="H(this)">15:56:48</span>                    devn </span><span>“why did we make an InterestingRecommendation?” =&gt; “Patient is over 50 and has a recent encounter (&lt; 45 days) where X happened…&quot;</span></div><div id="t1481039848000093" t="2016-12-06 15:57:28 devn Speaking more on the topic of tooling"><a href="#t1481039848000093" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-06</span> <span class="t" onclick="H(this)">15:57:28</span>                    devn </span><span>Speaking more on the topic of tooling</span></div><div id="t1481039891000094" t="2016-12-06 15:58:11 devn We built a graph you can traverse by clicking from nodes to rules and such, but textual explanation seems to be more fundamentally valuable"><a href="#t1481039891000094" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-06</span> <span class="t" onclick="H(this)">15:58:11</span>                    devn </span><span>We built a graph you can traverse by clicking from nodes to rules and such, but textual explanation seems to be more fundamentally valuable</span></div><div id="t1481039984000095" t="2016-12-06 15:59:44 devn Ryan’s clara.tools project is on the right-ish track, but the sheer volume of information for a graph of any decent size can quickly turn into wading in a swamp of facts which aren’t all that interesting"><a href="#t1481039984000095" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-06</span> <span class="t" onclick="H(this)">15:59:44</span>                    devn </span><span>Ryan’s clara.tools project is on the right-ish track, but the sheer volume of information for a graph of any decent size can quickly turn into wading in a swamp of facts which aren’t all that interesting</span></div><div id="t1481040006000096" t="2016-12-06 16:00:06 devn it’s not an easy problem. views need to be tailored to your domain, and to your audience"><a href="#t1481040006000096" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-06</span> <span class="t" onclick="H(this)">16:00:06</span>                    devn </span><span>it’s not an easy problem. views need to be tailored to your domain, and to your audience</span></div><div id="t1481040019000097" t="2016-12-06 16:00:19 devn but perhaps there’s some meta way of specifying views that could be shared"><a href="#t1481040019000097" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-06</span> <span class="t" onclick="H(this)">16:00:19</span>                    devn </span><span>but perhaps there’s some meta way of specifying views that could be shared</span></div><div id="t1481042606000098" t="2016-12-06 16:43:26 jonsmock @mikerod That was a solid talk"><a href="#t1481042606000098" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-06</span> <span class="t" onclick="H(this)">16:43:26</span>                jonsmock </span><span>@mikerod That was a solid talk</span></div><div id="t1481049003000100" t="2016-12-06 18:30:03 mikerod @jonsmock thanks!"><a href="#t1481049003000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-06</span> <span class="t" onclick="H(this)">18:30:03</span>                 mikerod </span><span>@jonsmock thanks!</span></div><div id="t1482238041000106" t="2016-12-20 12:47:21 fabrao Hello all"><a href="#t1482238041000106" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2016-12-20</span> <span class="t" onclick="H(this)">12:47:21</span>                  fabrao </span><span>Hello all</span></div><div id="t1484400792000125" t="2017-01-14 13:33:12 skuro hi *"><a href="#t1484400792000125" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-01-14</span> <span class="t" onclick="H(this)">13:33:12</span>                   skuro </span><span>hi *</span></div><div id="t1484400846000126" t="2017-01-14 13:34:06 skuro I’m just exploring clara these days, and I had a question"><a href="#t1484400846000126" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-01-14</span> <span class="t" onclick="H(this)">13:34:06</span>                   skuro </span><span>I’m just exploring clara these days, and I had a question</span></div><div id="t1484400883000127" t="2017-01-14 13:34:43 skuro in my model, some of the facts have a timestamp property, which can be used to let facts expire when they become too old"><a href="#t1484400883000127" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-01-14</span> <span class="t" onclick="H(this)">13:34:43</span>                   skuro </span><span>in my model, some of the facts have a timestamp property, which can be used to let facts expire when they become too old</span></div><div id="t1484401075000128" t="2017-01-14 13:37:55 skuro so far I have this in my little experiment:  (defrecord Fact [timestamp ...])

(defn too-old [t]
  (&lt; max-age (- (now) t)))

(defrule ignore-old-facts
  [?fact &lt;- Fact (too-old timestamp)]
  =&gt;
  (retract! ?fact))"><a href="#t1484401075000128" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-01-14</span> <span class="t" onclick="H(this)">13:37:55</span>                   skuro </span><span>so far I have this in my little experiment: </span><pre>(defrecord Fact [timestamp ...])

(defn too-old [t]
  (&lt; max-age (- (now) t)))

(defrule ignore-old-facts
  [?fact &lt;- Fact (too-old timestamp)]
  =&gt;
  (retract! ?fact))</pre></div><div id="t1484401141000129" t="2017-01-14 13:39:01 skuro is it the right strategy? I guess facts won’t be re-evaluated over time in a given session, so if I go for this I would have to recreate it periodically"><a href="#t1484401141000129" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-01-14</span> <span class="t" onclick="H(this)">13:39:01</span>                   skuro </span><span>is it the right strategy? I guess facts won’t be re-evaluated over time in a given session, so if I go for this I would have to recreate it periodically</span></div><div id="t1484401155000130" t="2017-01-14 13:39:15 skuro but maybe I’m not understanding clara yet  🙂"><a href="#t1484401155000130" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-01-14</span> <span class="t" onclick="H(this)">13:39:15</span>                   skuro </span><span>but maybe I’m not understanding clara yet </span><b>🙂</b></div><div id="t1484578896000131" t="2017-01-16 15:01:36 wparker @skuro You’re correct that facts won’t be re-evaluated in this case.  My suggestion would be to write something like"><a href="#t1484578896000131" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-01-16</span> <span class="t" onclick="H(this)">15:01:36</span>                 wparker </span><span>@skuro You’re correct that facts won’t be re-evaluated in this case.  My suggestion would be to write something like</span></div><div id="t1484578962000132" t="2017-01-16 15:02:42 wparker (defrule ignore-old-facts [TimeFact (= ?time time)] [?fact &lt;- Fact (too-old timestamp ?time)] =&gt; (retract! ?fact))"><a href="#t1484578962000132" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-01-16</span> <span class="t" onclick="H(this)">15:02:42</span>                 wparker </span><span>(defrule ignore-old-facts [TimeFact (= ?time time)] [?fact &lt;- Fact (too-old timestamp ?time)] =&gt; (retract! ?fact))</span></div><div id="t1484578994000133" t="2017-01-16 15:03:14 wparker If you retract an old TimeFact and then insert with a newer TimeFact this will force re-evaluation of the join"><a href="#t1484578994000133" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-01-16</span> <span class="t" onclick="H(this)">15:03:14</span>                 wparker </span><span>If you retract an old TimeFact and then insert with a newer TimeFact this will force re-evaluation of the join</span></div><div id="t1484579113000134" t="2017-01-16 15:05:13 wparker There’s been some discussion on the mailing list of providing support for this sort of use case (events that expire with reference to them in Clara removed) but at this time there isn’t anything in Clara to directly support it."><a href="#t1484579113000134" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-01-16</span> <span class="t" onclick="H(this)">15:05:13</span>                 wparker </span><span>There’s been some discussion on the mailing list of providing support for this sort of use case (events that expire with reference to them in Clara removed) but at this time there isn’t anything in Clara to directly support it.</span></div><div id="t1484582818000135" t="2017-01-16 16:06:58 skuro ok, thanks"><a href="#t1484582818000135" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-01-16</span> <span class="t" onclick="H(this)">16:06:58</span>                   skuro </span><span>ok, thanks</span></div><div id="t1484586192000136" t="2017-01-16 17:03:12 wparker you’re welcome"><a href="#t1484586192000136" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-01-16</span> <span class="t" onclick="H(this)">17:03:12</span>                 wparker </span><span>you’re welcome</span></div><div id="t1484834458000139" t="2017-01-19 14:00:58 dm3 do I understand correctly that a rule like the one in  https://github.com/cerner/clara-examples/blob/master/src/main/clojure/clara/examples/sensors.clj#L48 :
 (defrule get-current-temperature
  &quot;Get the current temperature at a location by simply looking at the newest reading.&quot;
  [?current-temp &lt;- newest-temp :from [TemperatureReading (= ?location location)]]
  =&gt;
  (insert! (-&gt;CurrentTemperature (:value ?current-temp) ?location)))
 
will accumulate  CurrentTemperature  facts, never retracting them?"><a href="#t1484834458000139" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-01-19</span> <span class="t" onclick="H(this)">14:00:58</span>                     dm3 </span><span>do I understand correctly that a rule like the one in </span><a href="https://github.com/cerner/clara-examples/blob/master/src/main/clojure/clara/examples/sensors.clj#L48" target="_blank">https://github.com/cerner/clara-examples/blob/master/src/main/clojure/clara/examples/sensors.clj#L48</a><span>:
</span><pre>(defrule get-current-temperature
  &quot;Get the current temperature at a location by simply looking at the newest reading.&quot;
  [?current-temp &lt;- newest-temp :from [TemperatureReading (= ?location location)]]
  =&gt;
  (insert! (-&gt;CurrentTemperature (:value ?current-temp) ?location)))
</pre><span>
will accumulate </span><code>CurrentTemperature</code><span> facts, never retracting them?</span></div><div id="t1484844768000141" t="2017-01-19 16:52:48 dm3 seems the above is retracted on every new  TemperatureReading . Is my intuition right in this case - the retraction happens because when the new  TemperatureReading  (t+1) arrives, the condition under which the previous  CurrentTemperature  became true (t+0) is now false?"><a href="#t1484844768000141" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-01-19</span> <span class="t" onclick="H(this)">16:52:48</span>                     dm3 </span><span>seems the above is retracted on every new </span><code>TemperatureReading</code><span>. Is my intuition right in this case - the retraction happens because when the new </span><code>TemperatureReading</code><span> (t+1) arrives, the condition under which the previous </span><code>CurrentTemperature</code><span> became true (t+0) is now false?</span></div><div id="t1484847400000142" t="2017-01-19 17:36:40 wparker @dm3 that is correct"><a href="#t1484847400000142" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-01-19</span> <span class="t" onclick="H(this)">17:36:40</span>                 wparker </span><span>@dm3 that is correct</span></div><div id="t1484847441000143" t="2017-01-19 17:37:21 wparker When the conditions that caused a logical fact insertion to occur Clara will adjust the session to reflect the new status of those conditions"><a href="#t1484847441000143" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-01-19</span> <span class="t" onclick="H(this)">17:37:21</span>                 wparker </span><span>When the conditions that caused a logical fact insertion to occur Clara will adjust the session to reflect the new status of those conditions</span></div><div id="t1484847451000144" t="2017-01-19 17:37:31 wparker Logical insertions are those done with insert!"><a href="#t1484847451000144" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-01-19</span> <span class="t" onclick="H(this)">17:37:31</span>                 wparker </span><span>Logical insertions are those done with insert!</span></div><div id="t1484847509000145" t="2017-01-19 17:38:29 wparker If you used insert-unconditional! you’d end up with multiple CurrentTemperature facts potentially depending on your rules firing pattern"><a href="#t1484847509000145" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-01-19</span> <span class="t" onclick="H(this)">17:38:29</span>                 wparker </span><span>If you used insert-unconditional! you’d end up with multiple CurrentTemperature facts potentially depending on your rules firing pattern</span></div><div id="t1484847573000146" t="2017-01-19 17:39:33 wparker But as long as you stay away from uncondition insertions and manual fact retractions inside rules you can just think of the rules as pure logical relationships that “if as session has these things in it it will also have these other things in it&quot;"><a href="#t1484847573000146" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-01-19</span> <span class="t" onclick="H(this)">17:39:33</span>                 wparker </span><span>But as long as you stay away from uncondition insertions and manual fact retractions inside rules you can just think of the rules as pure logical relationships that “if as session has these things in it it will also have these other things in it&quot;</span></div><div id="t1484847589000147" t="2017-01-19 17:39:49 wparker “a session” not “as session&quot;"><a href="#t1484847589000147" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-01-19</span> <span class="t" onclick="H(this)">17:39:49</span>                 wparker </span><span>“a session” not “as session&quot;</span></div><div id="t1484847728000148" t="2017-01-19 17:42:08 wparker After you call fire-rules at least, i.e. (-&gt; your-session (insert your-facts-here) ;;no-contract-about-status-now fire-rules ;; now-there-is-a-contract-about-the-status)"><a href="#t1484847728000148" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-01-19</span> <span class="t" onclick="H(this)">17:42:08</span>                 wparker </span><span>After you call fire-rules at least, i.e. (-&gt; your-session (insert your-facts-here) ;;no-contract-about-status-now fire-rules ;; now-there-is-a-contract-about-the-status)</span></div><div id="t1484847755000149" t="2017-01-19 17:42:35 wparker Also note that you’ll group on the location of the TemperatureReading in the above"><a href="#t1484847755000149" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-01-19</span> <span class="t" onclick="H(this)">17:42:35</span>                 wparker </span><span>Also note that you’ll group on the location of the TemperatureReading in the above</span></div><div id="t1484847792000150" t="2017-01-19 17:43:12 wparker So if you have TemperatureReading facts with different locations you can have a CurrentTemperature fact for each distinct location"><a href="#t1484847792000150" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-01-19</span> <span class="t" onclick="H(this)">17:43:12</span>                 wparker </span><span>So if you have TemperatureReading facts with different locations you can have a CurrentTemperature fact for each distinct location</span></div><div id="t1484847796000151" t="2017-01-19 17:43:16 wparker Does that make sense?"><a href="#t1484847796000151" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-01-19</span> <span class="t" onclick="H(this)">17:43:16</span>                 wparker </span><span>Does that make sense?</span></div><div id="t1484848082000152" t="2017-01-19 17:48:02 dm3 yeah"><a href="#t1484848082000152" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-01-19</span> <span class="t" onclick="H(this)">17:48:02</span>                     dm3 </span><span>yeah</span></div><div id="t1484848087000153" t="2017-01-19 17:48:07 dm3 running into some other issues now"><a href="#t1484848087000153" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-01-19</span> <span class="t" onclick="H(this)">17:48:07</span>                     dm3 </span><span>running into some other issues now</span></div><div id="t1484848210000154" t="2017-01-19 17:50:10 dm3 what if I have facts that change with time and do an  insert CurrentTimestamp -&gt; fire-rules -&gt; retract CurrentTimestamp  periodically? Are there any obvious issues I&apos;ll run into?"><a href="#t1484848210000154" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-01-19</span> <span class="t" onclick="H(this)">17:50:10</span>                     dm3 </span><span>what if I have facts that change with time and do an </span><code>insert CurrentTimestamp -&gt; fire-rules -&gt; retract CurrentTimestamp</code><span> periodically? Are there any obvious issues I&apos;ll run into?</span></div><div id="t1484851484000155" t="2017-01-19 18:44:44 wparker @dm3 As long as you use truth maintenance Clara will resolve all transitive impacts on rules"><a href="#t1484851484000155" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-01-19</span> <span class="t" onclick="H(this)">18:44:44</span>                 wparker </span><span>@dm3 As long as you use truth maintenance Clara will resolve all transitive impacts on rules</span></div><div id="t1484851518000156" t="2017-01-19 18:45:18 wparker i.e. if you insert Fact1 which causes RuleA to insert fact2, and fact2 causes ruleB to insert fact3"><a href="#t1484851518000156" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-01-19</span> <span class="t" onclick="H(this)">18:45:18</span>                 wparker </span><span>i.e. if you insert Fact1 which causes RuleA to insert fact2, and fact2 causes ruleB to insert fact3</span></div><div id="t1484851558000157" t="2017-01-19 18:45:58 wparker a retraction of fact1 will cause fact3 to be removed from the session if appropriate based on the rules"><a href="#t1484851558000157" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-01-19</span> <span class="t" onclick="H(this)">18:45:58</span>                 wparker </span><span>a retraction of fact1 will cause fact3 to be removed from the session if appropriate based on the rules</span></div><div id="t1484851655000158" t="2017-01-19 18:47:35 wparker Regarding “facts that change with time”:"><a href="#t1484851655000158" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-01-19</span> <span class="t" onclick="H(this)">18:47:35</span>                 wparker </span><span>Regarding “facts that change with time”:</span></div><div id="t1484851667000159" t="2017-01-19 18:47:47 wparker Clara assumes that facts are immutable"><a href="#t1484851667000159" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-01-19</span> <span class="t" onclick="H(this)">18:47:47</span>                 wparker </span><span>Clara assumes that facts are immutable</span></div><div id="t1484851719000160" t="2017-01-19 18:48:39 wparker If you do something like (insert JavaBeanFact) fire-rules (.setSomeFieldUsedInRules JavaBeanFact newValue)"><a href="#t1484851719000160" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-01-19</span> <span class="t" onclick="H(this)">18:48:39</span>                 wparker </span><span>If you do something like (insert JavaBeanFact) fire-rules (.setSomeFieldUsedInRules JavaBeanFact newValue)</span></div><div id="t1484851729000161" t="2017-01-19 18:48:49 wparker the behavior will be undefined"><a href="#t1484851729000161" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-01-19</span> <span class="t" onclick="H(this)">18:48:49</span>                 wparker </span><span>the behavior will be undefined</span></div><div id="t1484851748000162" t="2017-01-19 18:49:08 wparker if you want to change fields you’ll need to retract the fact and then insert a new one with the modifications you want"><a href="#t1484851748000162" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-01-19</span> <span class="t" onclick="H(this)">18:49:08</span>                 wparker </span><span>if you want to change fields you’ll need to retract the fact and then insert a new one with the modifications you want</span></div><div id="t1484851828000163" t="2017-01-19 18:50:28 wparker Actually I’d consider mutation of facts after insertion to result in undefined behavior in general, apart from whether the field is used"><a href="#t1484851828000163" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-01-19</span> <span class="t" onclick="H(this)">18:50:28</span>                 wparker </span><span>Actually I’d consider mutation of facts after insertion to result in undefined behavior in general, apart from whether the field is used</span></div><div id="t1484851904000164" t="2017-01-19 18:51:44 wparker Mutating fields after insertion used in rules would definitely cause problems with the current implementation, would need to think about mutations not impacting rule bindings but either way the behavior isn’t guaranteed and I wouldn’t advise doing it"><a href="#t1484851904000164" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-01-19</span> <span class="t" onclick="H(this)">18:51:44</span>                 wparker </span><span>Mutating fields after insertion used in rules would definitely cause problems with the current implementation, would need to think about mutations not impacting rule bindings but either way the behavior isn’t guaranteed and I wouldn’t advise doing it</span></div><div id="t1484851941000165" t="2017-01-19 18:52:21 dm3 thx"><a href="#t1484851941000165" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-01-19</span> <span class="t" onclick="H(this)">18:52:21</span>                     dm3 </span><span>thx</span></div><div id="t1484851945000166" t="2017-01-19 18:52:25 dm3 I wasn&apos;t considering mutations"><a href="#t1484851945000166" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-01-19</span> <span class="t" onclick="H(this)">18:52:25</span>                     dm3 </span><span>I wasn&apos;t considering mutations</span></div><div id="t1484851954000167" t="2017-01-19 18:52:34 wparker :+1:"><a href="#t1484851954000167" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-01-19</span> <span class="t" onclick="H(this)">18:52:34</span>                 wparker </span><b>:+1:</b></div><div id="t1484852017000168" t="2017-01-19 18:53:37 dm3 I&apos;m thinking of batching the input stream of events and reducing the batch with  (fn [sess batch] (-&gt; (insert sess timestamp) (insert-all batch) (fire-rules) (retract timestamp)))"><a href="#t1484852017000168" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-01-19</span> <span class="t" onclick="H(this)">18:53:37</span>                     dm3 </span><span>I&apos;m thinking of batching the input stream of events and reducing the batch with </span><code>(fn [sess batch] (-&gt; (insert sess timestamp) (insert-all batch) (fire-rules) (retract timestamp)))</code></div><div id="t1484852092000169" t="2017-01-19 18:54:52 wparker yeah obviously the existence of problems depends on the specific use-case but I don’t see problems in general with inserting and then retracting a timestamp fact that would have downstream impact through various rules"><a href="#t1484852092000169" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-01-19</span> <span class="t" onclick="H(this)">18:54:52</span>                 wparker </span><span>yeah obviously the existence of problems depends on the specific use-case but I don’t see problems in general with inserting and then retracting a timestamp fact that would have downstream impact through various rules</span></div><div id="t1484852123000170" t="2017-01-19 18:55:23 wparker truth maintenance will sort out all the impacts to downstream rules"><a href="#t1484852123000170" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-01-19</span> <span class="t" onclick="H(this)">18:55:23</span>                 wparker </span><span>truth maintenance will sort out all the impacts to downstream rules</span></div><div id="t1484852168000171" t="2017-01-19 18:56:08 wparker also remember Clara sessions are immutable"><a href="#t1484852168000171" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-01-19</span> <span class="t" onclick="H(this)">18:56:08</span>                 wparker </span><span>also remember Clara sessions are immutable</span></div><div id="t1484852174000172" t="2017-01-19 18:56:14 wparker so you could do something like this as well"><a href="#t1484852174000172" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-01-19</span> <span class="t" onclick="H(this)">18:56:14</span>                 wparker </span><span>so you could do something like this as well</span></div><div id="t1484852192000173" t="2017-01-19 18:56:32 wparker (def session-with-facts-no-timestamp)"><a href="#t1484852192000173" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-01-19</span> <span class="t" onclick="H(this)">18:56:32</span>                 wparker </span><span>(def session-with-facts-no-timestamp)</span></div><div id="t1484852248000174" t="2017-01-19 18:57:28 wparker (def time1-session (-&gt; session-with-facts-no-timestamp (insert time1) fire-rules))"><a href="#t1484852248000174" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-01-19</span> <span class="t" onclick="H(this)">18:57:28</span>                 wparker </span><span>(def time1-session (-&gt; session-with-facts-no-timestamp (insert time1) fire-rules))</span></div><div id="t1484852264000175" t="2017-01-19 18:57:44 wparker (def time2-session (-&gt; session-with-facts-no-timestamp (insert time2) fire-rules))"><a href="#t1484852264000175" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-01-19</span> <span class="t" onclick="H(this)">18:57:44</span>                 wparker </span><span>(def time2-session (-&gt; session-with-facts-no-timestamp (insert time2) fire-rules))</span></div><div id="t1484853681000176" t="2017-01-19 19:21:21 dm3 I&apos;m now trying to do the following:
 (ns rulebot.test
  (:require [clara.rules :as clara]
            [clara.rules.accumulators :as acc]
            [clara.tools.tracing :as tt]))

(defrecord Value [value instant])
(defrecord Step [step instant])
(defrecord CurrentValue [value])
(defrecord CurrentStep [step])
(defrecord CurrentTimestamp [instant])

(clara/defrule current-value
  [?e &lt;- (acc/max :instant :returns-fact true) :from [Value]]
  =&gt;
  (clara/insert! (-&gt;CurrentValue (:value ?e))))

(clara/defrule current-step
  [?e &lt;- (acc/max :instant :returns-fact true) :from [Step]]
  =&gt;
  (clara/insert! (-&gt;CurrentStep (:step ?e))))

(clara/defrule step
  [CurrentValue (= ?value value)]
  [CurrentStep (= ?prev-step step)
               (= ?curr-step (int (/ ?value 10)))]
  [CurrentTimestamp (= ?instant instant)]
  [:test (&gt; ?curr-step ?prev-step)]
  =&gt;
  (clara/insert! (-&gt;Step ?curr-step ?instant)))

(defn go []
  (let [session (-&gt; (clara/mk-session &apos;rulebot.test)
                    (tt/with-tracing))]
    (-&gt; session
        (clara/insert (-&gt;CurrentTimestamp 0))
        (clara/insert (-&gt;Value 1 0))
        (clara/insert (-&gt;Step 0 0))
        (clara/fire-rules)
        (clara/retract (-&gt;CurrentTimestamp 0))

        (clara/insert (-&gt;CurrentTimestamp 1))
        (clara/insert (-&gt;Value 11 1))
        (clara/fire-rules)
        (tt/get-trace))))
 
which fails on the  step  rule because  ?prev-step  gets bound to an  {:ns-name .., :lhs ..., :rhs ...}  map for some reason..."><a href="#t1484853681000176" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-01-19</span> <span class="t" onclick="H(this)">19:21:21</span>                     dm3 </span><span>I&apos;m now trying to do the following:
</span><pre>(ns rulebot.test
  (:require [clara.rules :as clara]
            [clara.rules.accumulators :as acc]
            [clara.tools.tracing :as tt]))

(defrecord Value [value instant])
(defrecord Step [step instant])
(defrecord CurrentValue [value])
(defrecord CurrentStep [step])
(defrecord CurrentTimestamp [instant])

(clara/defrule current-value
  [?e &lt;- (acc/max :instant :returns-fact true) :from [Value]]
  =&gt;
  (clara/insert! (-&gt;CurrentValue (:value ?e))))

(clara/defrule current-step
  [?e &lt;- (acc/max :instant :returns-fact true) :from [Step]]
  =&gt;
  (clara/insert! (-&gt;CurrentStep (:step ?e))))

(clara/defrule step
  [CurrentValue (= ?value value)]
  [CurrentStep (= ?prev-step step)
               (= ?curr-step (int (/ ?value 10)))]
  [CurrentTimestamp (= ?instant instant)]
  [:test (&gt; ?curr-step ?prev-step)]
  =&gt;
  (clara/insert! (-&gt;Step ?curr-step ?instant)))

(defn go []
  (let [session (-&gt; (clara/mk-session &apos;rulebot.test)
                    (tt/with-tracing))]
    (-&gt; session
        (clara/insert (-&gt;CurrentTimestamp 0))
        (clara/insert (-&gt;Value 1 0))
        (clara/insert (-&gt;Step 0 0))
        (clara/fire-rules)
        (clara/retract (-&gt;CurrentTimestamp 0))

        (clara/insert (-&gt;CurrentTimestamp 1))
        (clara/insert (-&gt;Value 11 1))
        (clara/fire-rules)
        (tt/get-trace))))
</pre><span>
which fails on the </span><code>step</code><span> rule because </span><code>?prev-step</code><span> gets bound to an </span><code>{:ns-name .., :lhs ..., :rhs ...}</code><span> map for some reason...</span></div><div id="t1484854296000180" t="2017-01-19 19:31:36 dm3 @wparker can you see anything obviously wrong with that?"><a href="#t1484854296000180" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-01-19</span> <span class="t" onclick="H(this)">19:31:36</span>                     dm3 </span><span>@wparker can you see anything obviously wrong with that?</span></div><div id="t1484858419000181" t="2017-01-19 20:40:19 wparker {:ns-name .., :lhs ..., :rhs …} is what the internal representation of a rule looks like; its the map structure that defrule stores in a var"><a href="#t1484858419000181" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-01-19</span> <span class="t" onclick="H(this)">20:40:19</span>                 wparker </span><span>{:ns-name .., :lhs ..., :rhs …} is what the internal representation of a rule looks like; its the map structure that defrule stores in a var</span></div><div id="t1484858463000182" t="2017-01-19 20:41:03 wparker I don’t have time to look into it in detail at the moment but I’d guess that the “step” field is being resolved to the “step” var instead"><a href="#t1484858463000182" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-01-19</span> <span class="t" onclick="H(this)">20:41:03</span>                 wparker </span><span>I don’t have time to look into it in detail at the moment but I’d guess that the “step” field is being resolved to the “step” var instead</span></div><div id="t1484858475000183" t="2017-01-19 20:41:15 wparker If you type “step” in a REPL in that namespace you should see the same value"><a href="#t1484858475000183" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-01-19</span> <span class="t" onclick="H(this)">20:41:15</span>                 wparker </span><span>If you type “step” in a REPL in that namespace you should see the same value</span></div><div id="t1484858596000184" t="2017-01-19 20:43:16 wparker I’d say this edge case merits a GitHub issue to determine what to do with it but for the moment I think you can resolve this by naming your rule something that isn’t the name of one of your fact fields"><a href="#t1484858596000184" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-01-19</span> <span class="t" onclick="H(this)">20:43:16</span>                 wparker </span><span>I’d say this edge case merits a GitHub issue to determine what to do with it but for the moment I think you can resolve this by naming your rule something that isn’t the name of one of your fact fields</span></div><div id="t1484858605000185" t="2017-01-19 20:43:25 wparker @dm3"><a href="#t1484858605000185" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-01-19</span> <span class="t" onclick="H(this)">20:43:25</span>                 wparker </span><span>@dm3</span></div><div id="t1484860664000186" t="2017-01-19 21:17:44 dm3 you&apos;re right. Once that&apos;s fixed, the example goes into infinite loop"><a href="#t1484860664000186" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-01-19</span> <span class="t" onclick="H(this)">21:17:44</span>                     dm3 </span><span>you&apos;re right. Once that&apos;s fixed, the example goes into infinite loop</span></div><div id="t1484860679000187" t="2017-01-19 21:17:59 dm3 so your help will still be appreciated!  🙂"><a href="#t1484860679000187" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-01-19</span> <span class="t" onclick="H(this)">21:17:59</span>                     dm3 </span><span>so your help will still be appreciated! </span><b>🙂</b></div><div id="t1484866146000188" t="2017-01-19 22:49:06 wparker I see you’re inserting Step in one of your rules that looks for facts that are inserted due to Step"><a href="#t1484866146000188" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-01-19</span> <span class="t" onclick="H(this)">22:49:06</span>                 wparker </span><span>I see you’re inserting Step in one of your rules that looks for facts that are inserted due to Step</span></div><div id="t1484866218000189" t="2017-01-19 22:50:18 wparker At first glance I’d say you’re likely doing something where you’re inserting a Step that then causes itself to be retracted and entering an infinite loop that way"><a href="#t1484866218000189" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-01-19</span> <span class="t" onclick="H(this)">22:50:18</span>                 wparker </span><span>At first glance I’d say you’re likely doing something where you’re inserting a Step that then causes itself to be retracted and entering an infinite loop that way</span></div><div id="t1484866246000190" t="2017-01-19 22:50:46 wparker I’d need to take a closer look at it to work out exactly what"><a href="#t1484866246000190" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-01-19</span> <span class="t" onclick="H(this)">22:50:46</span>                 wparker </span><span>I’d need to take a closer look at it to work out exactly what</span></div><div id="t1484866333000191" t="2017-01-19 22:52:13 dm3 hmm"><a href="#t1484866333000191" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-01-19</span> <span class="t" onclick="H(this)">22:52:13</span>                     dm3 </span><span>hmm</span></div><div id="t1484866390000192" t="2017-01-19 22:53:10 dm3 the  step  rule does insert a new  Step , which should then retract the old  CurrentStep  and insert a new one, unless I&apos;m misunderstanding something"><a href="#t1484866390000192" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-01-19</span> <span class="t" onclick="H(this)">22:53:10</span>                     dm3 </span><span>the </span><code>step</code><span> rule does insert a new </span><code>Step</code><span>, which should then retract the old </span><code>CurrentStep</code><span> and insert a new one, unless I&apos;m misunderstanding something</span></div><div id="t1484866568000193" t="2017-01-19 22:56:08 dm3 however, after the  step  rule runs, the  current-step  rule is still executed with the previous  Step  fact"><a href="#t1484866568000193" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-01-19</span> <span class="t" onclick="H(this)">22:56:08</span>                     dm3 </span><span>however, after the </span><code>step</code><span> rule runs, the </span><code>current-step</code><span> rule is still executed with the previous </span><code>Step</code><span> fact</span></div><div id="t1484866821000194" t="2017-01-19 23:00:21 dm3 it&apos;s probably the truth maintenance screwing with me -  Step (t0)  is inserted outside the rules,  Step (t1)  is inserted by the  next-step  rule with  CurrentStep (t0) . After  Step (t1)  triggers  current-step  to retract the  CurrentStep (t0) , the  Step (t1)  also gets retracted which again triggers  next-step  with  CurrentStep (t0)"><a href="#t1484866821000194" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-01-19</span> <span class="t" onclick="H(this)">23:00:21</span>                     dm3 </span><span>it&apos;s probably the truth maintenance screwing with me - </span><code>Step (t0)</code><span> is inserted outside the rules, </span><code>Step (t1)</code><span> is inserted by the </span><code>next-step</code><span> rule with </span><code>CurrentStep (t0)</code><span>. After </span><code>Step (t1)</code><span> triggers </span><code>current-step</code><span> to retract the </span><code>CurrentStep (t0)</code><span>, the </span><code>Step (t1)</code><span> also gets retracted which again triggers </span><code>next-step</code><span> with </span><code>CurrentStep (t0)</code></div><div id="t1484866958000198" t="2017-01-19 23:02:38 dm3 what should I do in order to accumulate the  Step  facts (more like events in this case) instead of having the above happening?"><a href="#t1484866958000198" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-01-19</span> <span class="t" onclick="H(this)">23:02:38</span>                     dm3 </span><span>what should I do in order to accumulate the </span><code>Step</code><span> facts (more like events in this case) instead of having the above happening?</span></div><div id="t1484867635000199" t="2017-01-19 23:13:55 wparker to be honest I’m not sure what sort of logic you’re trying to represent with the recursion there so an alternative isn’t obvious to me"><a href="#t1484867635000199" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-01-19</span> <span class="t" onclick="H(this)">23:13:55</span>                 wparker </span><span>to be honest I’m not sure what sort of logic you’re trying to represent with the recursion there so an alternative isn’t obvious to me</span></div><div id="t1484868893000200" t="2017-01-19 23:34:53 dm3 I&apos;m trying to capture increases in  Value  as  Step s. There&apos;s a stream of  Value s coming in, which I batch and  fire  with a new  CurrentTimestamp  every N ms. Some of the batches might trigger a new  Step , which I&apos;ve imagined would appear as a new fact in the session. I guess the culprit of my troubles is the recursive relation between the  CurrentStep  and  Step ."><a href="#t1484868893000200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-01-19</span> <span class="t" onclick="H(this)">23:34:53</span>                     dm3 </span><span>I&apos;m trying to capture increases in </span><code>Value</code><span> as </span><code>Step</code><span>s. There&apos;s a stream of </span><code>Value</code><span>s coming in, which I batch and </span><code>fire</code><span> with a new </span><code>CurrentTimestamp</code><span> every N ms. Some of the batches might trigger a new </span><code>Step</code><span>, which I&apos;ve imagined would appear as a new fact in the session. I guess the culprit of my troubles is the recursive relation between the </span><code>CurrentStep</code><span> and </span><code>Step</code><span>.</span></div><div id="t1484869076000201" t="2017-01-19 23:37:56 dm3 tried reformulating the  next-step  rule as follows (becuase the CurrentStep is just the MAX of all steps):
 (clara/defrule next-step
  [CurrentValue (= ?value value)]
  [?s &lt;- (acc/max :step :returns-fact true) :from [Step (= ?prev-step step)]]
  [CurrentTimestamp (= ?instant instant)]
  [:test (&gt; (int (/ ?value 10)) ?prev-step)]
  =&gt;
  (clara/insert! (-&gt;Step (int (/ ?value 10)) ?instant)))
"><a href="#t1484869076000201" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-01-19</span> <span class="t" onclick="H(this)">23:37:56</span>                     dm3 </span><span>tried reformulating the </span><code>next-step</code><span> rule as follows (becuase the CurrentStep is just the MAX of all steps):
</span><pre>(clara/defrule next-step
  [CurrentValue (= ?value value)]
  [?s &lt;- (acc/max :step :returns-fact true) :from [Step (= ?prev-step step)]]
  [CurrentTimestamp (= ?instant instant)]
  [:test (&gt; (int (/ ?value 10)) ?prev-step)]
  =&gt;
  (clara/insert! (-&gt;Step (int (/ ?value 10)) ?instant)))
</pre></div><div id="t1484869112000202" t="2017-01-19 23:38:32 dm3 the above works, except I couldn&apos;t figure out how to bind the  ?curr-step = (int (/ ?value 10))  inside the condition"><a href="#t1484869112000202" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-01-19</span> <span class="t" onclick="H(this)">23:38:32</span>                     dm3 </span><span>the above works, except I couldn&apos;t figure out how to bind the </span><code>?curr-step = (int (/ ?value 10))</code><span> inside the condition</span></div><div id="t1484907274000203" t="2017-01-20 10:14:34 dm3 seems I need something like a merged RETE/ECA engine (e.g. as described  http://ceur-ws.org/Vol-412/paper3.pdf ) as I first need to distill events into state"><a href="#t1484907274000203" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-01-20</span> <span class="t" onclick="H(this)">10:14:34</span>                     dm3 </span><span>seems I need something like a merged RETE/ECA engine (e.g. as described </span><a href="http://ceur-ws.org/Vol-412/paper3.pdf" target="_blank">http://ceur-ws.org/Vol-412/paper3.pdf</a><span>) as I first need to distill events into state</span></div><div id="t1484933331000204" t="2017-01-20 17:28:51 wparker Thanks for the link, now I’m curious and will have to read that paper  🙂"><a href="#t1484933331000204" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-01-20</span> <span class="t" onclick="H(this)">17:28:51</span>                 wparker </span><span>Thanks for the link, now I’m curious and will have to read that paper </span><b>🙂</b></div><div id="t1485047586000205" t="2017-01-22 01:13:06 wparker FYI @dm3 I logged an issue for the issue you were having with the field symbol resolving to the rule var discussed here above.   https://github.com/cerner/clara-rules/issues/259"><a href="#t1485047586000205" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-01-22</span> <span class="t" onclick="H(this)">01:13:06</span>                 wparker </span><span>FYI @dm3 I logged an issue for the issue you were having with the field symbol resolving to the rule var discussed here above.  </span><a href="https://github.com/cerner/clara-rules/issues/259" target="_blank">https://github.com/cerner/clara-rules/issues/259</a></div><div id="t1485079131000207" t="2017-01-22 09:58:51 dm3 thx"><a href="#t1485079131000207" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-01-22</span> <span class="t" onclick="H(this)">09:58:51</span>                     dm3 </span><span>thx</span></div><div id="t1485448571000211" t="2017-01-26 16:36:11 mike_ananev hi, there! Question about types. Does it necessary to use defrecord in order to declare fact? Can I use ordinary clojure maps to derive a fact and validate them by clojre.spec?"><a href="#t1485448571000211" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-01-26</span> <span class="t" onclick="H(this)">16:36:11</span>             mike_ananev </span><span>hi, there! Question about types. Does it necessary to use defrecord in order to declare fact? Can I use ordinary clojure maps to derive a fact and validate them by clojre.spec?</span></div><div id="t1485452375000214" t="2017-01-26 17:39:35 wparker @mike1452 Clara will use the fact-type-fn to determine what type a fact is for matching against conditions.  The docs/examples can probably be improved in this regard but it is alluded to in the generated API docs at  http://www.clara-rules.org/apidocs/0.13.0-RC4/clojure/clara.rules.html#var-mk-session"><a href="#t1485452375000214" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-01-26</span> <span class="t" onclick="H(this)">17:39:35</span>                 wparker </span><span>@mike1452 Clara will use the fact-type-fn to determine what type a fact is for matching against conditions.  The docs/examples can probably be improved in this regard but it is alluded to in the generated API docs at </span><a href="http://www.clara-rules.org/apidocs/0.13.0-RC4/clojure/clara.rules.html#var-mk-session" target="_blank">http://www.clara-rules.org/apidocs/0.13.0-RC4/clojure/clara.rules.html#var-mk-session</a></div><div id="t1485452409000215" t="2017-01-26 17:40:09 wparker Defrecord is just convenient for some people’s use-cases because it creates a type to match against out of the box"><a href="#t1485452409000215" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-01-26</span> <span class="t" onclick="H(this)">17:40:09</span>                 wparker </span><span>Defrecord is just convenient for some people’s use-cases because it creates a type to match against out of the box</span></div><div id="t1485452433000216" t="2017-01-26 17:40:33 wparker when you use clojure’s type function as the fact-type-fn (which is the default)"><a href="#t1485452433000216" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-01-26</span> <span class="t" onclick="H(this)">17:40:33</span>                 wparker </span><span>when you use clojure’s type function as the fact-type-fn (which is the default)</span></div><div id="t1485452773000217" t="2017-01-26 17:46:13 wparker also because it allows you to use field names in a rule condition directly i.e."><a href="#t1485452773000217" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-01-26</span> <span class="t" onclick="H(this)">17:46:13</span>                 wparker </span><span>also because it allows you to use field names in a rule condition directly i.e.</span></div><div id="t1485452780000218" t="2017-01-26 17:46:20 wparker (defrecord Cold [temperature])"><a href="#t1485452780000218" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-01-26</span> <span class="t" onclick="H(this)">17:46:20</span>                 wparker </span><span>(defrecord Cold [temperature])</span></div><div id="t1485452789000219" t="2017-01-26 17:46:29 wparker (&lt; temperature 0)"><a href="#t1485452789000219" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-01-26</span> <span class="t" onclick="H(this)">17:46:29</span>                 wparker </span><span>(&lt; temperature 0)</span></div><div id="t1485452800000220" t="2017-01-26 17:46:40 wparker rather than (&lt; (:temperature this) 0))"><a href="#t1485452800000220" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-01-26</span> <span class="t" onclick="H(this)">17:46:40</span>                 wparker </span><span>rather than (&lt; (:temperature this) 0))</span></div><div id="t1485455090000221" t="2017-01-26 18:24:50 mike_ananev @wparker thanks! awesome rule engine!"><a href="#t1485455090000221" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-01-26</span> <span class="t" onclick="H(this)">18:24:50</span>             mike_ananev </span><span>@wparker thanks! awesome rule engine!</span></div><div id="t1485457005000222" t="2017-01-26 18:56:45 wparker @mike1452 this has come up several times.  Ideally we’d have an explanation of the option at  http://clara-rules.org  at some point when someone gets time to write one but in the meantime I added a quick example at  https://github.com/cerner/clara-examples/blob/master/src/main/clojure/clara/examples/fact_type_options.clj"><a href="#t1485457005000222" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-01-26</span> <span class="t" onclick="H(this)">18:56:45</span>                 wparker </span><span>@mike1452 this has come up several times.  Ideally we’d have an explanation of the option at </span><a href="http://clara-rules.org" target="_blank">http://clara-rules.org</a><span> at some point when someone gets time to write one but in the meantime I added a quick example at </span><a href="https://github.com/cerner/clara-examples/blob/master/src/main/clojure/clara/examples/fact_type_options.clj" target="_blank">https://github.com/cerner/clara-examples/blob/master/src/main/clojure/clara/examples/fact_type_options.clj</a></div><div id="t1485458229000224" t="2017-01-26 19:17:09 mike_ananev @wparker cool! thanx!"><a href="#t1485458229000224" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-01-26</span> <span class="t" onclick="H(this)">19:17:09</span>             mike_ananev </span><span>@wparker cool! thanx!</span></div><div id="t1485458283000225" t="2017-01-26 19:18:03 mike_ananev @wparker btw, is it possible to use Clara rules with Apache Flink? We are building online anti-fraud system and evaluating several engines."><a href="#t1485458283000225" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-01-26</span> <span class="t" onclick="H(this)">19:18:03</span>             mike_ananev </span><span>@wparker btw, is it possible to use Clara rules with Apache Flink? We are building online anti-fraud system and evaluating several engines.</span></div><div id="t1485462233000226" t="2017-01-26 20:23:53 wparker Clara currently always runs in a single JVM, although it can be used in a distributed environment if it itself isn’t distributed, and we actually do so.  Clara’s architecture would likely facilitate an enhancement to distribute it and if someone were interested in driving that it could be discussed."><a href="#t1485462233000226" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-01-26</span> <span class="t" onclick="H(this)">20:23:53</span>                 wparker </span><span>Clara currently always runs in a single JVM, although it can be used in a distributed environment if it itself isn’t distributed, and we actually do so.  Clara’s architecture would likely facilitate an enhancement to distribute it and if someone were interested in driving that it could be discussed.</span></div><div id="t1485892652000228" t="2017-01-31 19:57:32 apbleonard Looking for options for debugging rules. Would have saved some time discovering typos etc today if I could have switched on debug logging evaluating every condition of a given rule say. Or even had &quot;explain-non-activations&quot;. Any tips?"><a href="#t1485892652000228" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-01-31</span> <span class="t" onclick="H(this)">19:57:32</span>              apbleonard </span><span>Looking for options for debugging rules. Would have saved some time discovering typos etc today if I could have switched on debug logging evaluating every condition of a given rule say. Or even had &quot;explain-non-activations&quot;. Any tips?</span></div><div id="t1485899389000230" t="2017-01-31 21:49:49 apbleonard Ok. So it looks like inspect would have helped me. Will also try tracing tomorrow..."><a href="#t1485899389000230" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-01-31</span> <span class="t" onclick="H(this)">21:49:49</span>                   apbleonard </span><span>Ok. So it looks like inspect would have helped me. Will also try tracing tomorrow...</span></div><div id="t1485899684000232" t="2017-01-31 21:54:44 wparker Inspect might be more helpful if you’re looking at ordinary sorts of errors like a bad rule etc.  Tracing can be useful too but definitely gets into implementation details"><a href="#t1485899684000232" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-01-31</span> <span class="t" onclick="H(this)">21:54:44</span>                      wparker </span><span>Inspect might be more helpful if you’re looking at ordinary sorts of errors like a bad rule etc.  Tracing can be useful too but definitely gets into implementation details</span></div><div id="t1485899735000234" t="2017-01-31 21:55:35 wparker If it concerns exceptions running against the branch that is out and in progress for  https://github.com/cerner/clara-rules/issues/255  could be helpful too"><a href="#t1485899735000234" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-01-31</span> <span class="t" onclick="H(this)">21:55:35</span>                      wparker </span><span>If it concerns exceptions running against the branch that is out and in progress for </span><a href="https://github.com/cerner/clara-rules/issues/255" target="_blank">https://github.com/cerner/clara-rules/issues/255</a><span> could be helpful too</span></div><div id="t1485905975000237" t="2017-01-31 23:39:35 apbleonard Thanks :) Was more about straightforward debugging. Just getting started with Clara! "><a href="#t1485905975000237" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-01-31</span> <span class="t" onclick="H(this)">23:39:35</span>                   apbleonard </span><span>Thanks :) Was more about straightforward debugging. Just getting started with Clara! </span></div><div id="t1485906326000239" t="2017-01-31 23:45:26 apbleonard Also - looking at source of load-rules in clara/rules.cljc you can just supply a list of symbols resolving to individual rules, not just namespaces - is that correct? Would love an example of this. Flexibility around how rules are assembled would be great."><a href="#t1485906326000239" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-01-31</span> <span class="t" onclick="H(this)">23:45:26</span>              apbleonard </span><span>Also - looking at source of load-rules in clara/rules.cljc you can just supply a list of symbols resolving to individual rules, not just namespaces - is that correct? Would love an example of this. Flexibility around how rules are assembled would be great.</span></div><div id="t1485907148000240" t="2017-01-31 23:59:08 wparker I think a call to mk-session like the one at  https://github.com/cerner/clara-examples/blob/master/src/main/clojure/clara/examples/fact_type_options.clj#L20  is what you’re talking about, ignoring the :fact-type-fn and :ancestors-fn options"><a href="#t1485907148000240" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-01-31</span> <span class="t" onclick="H(this)">23:59:08</span>                 wparker </span><span>I think a call to mk-session like the one at </span><a href="https://github.com/cerner/clara-examples/blob/master/src/main/clojure/clara/examples/fact_type_options.clj#L20" target="_blank">https://github.com/cerner/clara-examples/blob/master/src/main/clojure/clara/examples/fact_type_options.clj#L20</a><span> is what you’re talking about, ignoring the :fact-type-fn and :ancestors-fn options</span></div><div id="t1485962178000242" t="2017-02-01 15:16:18 mikerod @apbleonard Think of it as  clara.rules/mk-session  accepts any number of “rule sources”.  This can be anything that implements the  clara.rules.compiler/IRuleSource  protocol or just a collection of rule/query structures."><a href="#t1485962178000242" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-02-01</span> <span class="t" onclick="H(this)">15:16:18</span>                 mikerod </span><span>@apbleonard Think of it as </span><code>clara.rules/mk-session</code><span> accepts any number of “rule sources”.  This can be anything that implements the </span><code>clara.rules.compiler/IRuleSource</code><span> protocol or just a collection of rule/query structures.</span></div><div id="t1485962255000243" t="2017-02-01 15:17:35 mikerod Clojure’s Symbol implements the  clara.rules.compiler/IRuleSource  protocol.  The function to implement is  clara.rules.compiler/load-rules  which must return a collection of rule/query structures."><a href="#t1485962255000243" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-02-01</span> <span class="t" onclick="H(this)">15:17:35</span>                 mikerod </span><span>Clojure’s Symbol implements the </span><code>clara.rules.compiler/IRuleSource</code><span> protocol.  The function to implement is </span><code>clara.rules.compiler/load-rules</code><span> which must return a collection of rule/query structures.</span></div><div id="t1485962292000244" t="2017-02-01 15:18:12 mikerod However, Will had a good example if all you want to do is something simple like pass rules in"><a href="#t1485962292000244" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-02-01</span> <span class="t" onclick="H(this)">15:18:12</span>                 mikerod </span><span>However, Will had a good example if all you want to do is something simple like pass rules in</span></div><div id="t1485962339000245" t="2017-02-01 15:18:59 mikerod (defrule one-rule &lt;etc&gt;)
(defrule another-rule &lt;etc&gt;)
(defquery some-query &lt;etc&gt;)

;;;; Make session
(mk-session [one-rule another-rule some-query])
"><a href="#t1485962339000245" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-02-01</span> <span class="t" onclick="H(this)">15:18:59</span>                 mikerod </span><pre>(defrule one-rule &lt;etc&gt;)
(defrule another-rule &lt;etc&gt;)
(defquery some-query &lt;etc&gt;)

;;;; Make session
(mk-session [one-rule another-rule some-query])
</pre></div><div id="t1485962381000246" t="2017-02-01 15:19:41 mikerod you can also mix and match.   Symbol  implements  IRuleSource  by expecting the symbol to resolve to a namespace name.  It scans the whole namespace and finds all rules/queries in vars of that namespace."><a href="#t1485962381000246" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-02-01</span> <span class="t" onclick="H(this)">15:19:41</span>                 mikerod </span><span>you can also mix and match.  </span><code>Symbol</code><span> implements </span><code>IRuleSource</code><span> by expecting the symbol to resolve to a namespace name.  It scans the whole namespace and finds all rules/queries in vars of that namespace.</span></div><div id="t1485962439000247" t="2017-02-01 15:20:39 mikerod (mk-session [one-rule another-rule some-query] &apos;some.ns.with.rules)"><a href="#t1485962439000247" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-02-01</span> <span class="t" onclick="H(this)">15:20:39</span>                 mikerod </span><code>(mk-session [one-rule another-rule some-query] &apos;some.ns.with.rules)</code></div><div id="t1485962599000248" t="2017-02-01 15:23:19 mikerod @mike1452 Will mentioned that records allow you to refer to record fields directly in the rule.  For non-records, you can use destructuring though.  Just so you kmow
 (defrule my-rule [:my-type-thing [{:keys [x y]}] (= x “hello”)] 
&lt;etc&gt;)
"><a href="#t1485962599000248" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-02-01</span> <span class="t" onclick="H(this)">15:23:19</span>                 mikerod </span><span>@mike1452 Will mentioned that records allow you to refer to record fields directly in the rule.  For non-records, you can use destructuring though.  Just so you kmow
</span><pre>(defrule my-rule [:my-type-thing [{:keys [x y]}] (= x “hello”)] 
&lt;etc&gt;)
</pre></div><div id="t1485962623000249" t="2017-02-01 15:23:43 mikerod There should probably be documented examples of that sort of destructuring."><a href="#t1485962623000249" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-02-01</span> <span class="t" onclick="H(this)">15:23:43</span>                 mikerod </span><span>There should probably be documented examples of that sort of destructuring.</span></div><div id="t1485962821000250" t="2017-02-01 15:27:01 mike_ananev thanks"><a href="#t1485962821000250" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-02-01</span> <span class="t" onclick="H(this)">15:27:01</span>             mike_ananev </span><span>thanks</span></div><div id="t1486072834000252" t="2017-02-02 22:00:34 apbleonard @wparker @mikerod Thanks so much - that&apos;s exactly the examples I was looking for. Assembling rules dynamically will help us handle our mostly similar (but slightly different) rule-sets for different products. Btw destructuring maps also good to know, as records are not often used in our Clojure codebase."><a href="#t1486072834000252" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-02-02</span> <span class="t" onclick="H(this)">22:00:34</span>              apbleonard </span><span>@wparker @mikerod Thanks so much - that&apos;s exactly the examples I was looking for. Assembling rules dynamically will help us handle our mostly similar (but slightly different) rule-sets for different products. Btw destructuring maps also good to know, as records are not often used in our Clojure codebase.</span></div><div id="t1486072971000253" t="2017-02-02 22:02:51 mikerod It’s probably good to be aware that if you can order rules in a meaningful order of precedence, Clara will attempt to use that as a heuristic during conflict resolution (picking which rule to fire first, when multiple are eligible)."><a href="#t1486072971000253" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-02-02</span> <span class="t" onclick="H(this)">22:02:51</span>                 mikerod </span><span>It’s probably good to be aware that if you can order rules in a meaningful order of precedence, Clara will attempt to use that as a heuristic during conflict resolution (picking which rule to fire first, when multiple are eligible).</span></div><div id="t1486073017000254" t="2017-02-02 22:03:37 mikerod So if you have rules or sets of rules that naturally depend on other rules/sets of rules, you want to put the dependents after the dependencies.  This may not matter to you and may not be worth worrying about until you have a concrete performance concern."><a href="#t1486073017000254" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-02-02</span> <span class="t" onclick="H(this)">22:03:37</span>                 mikerod </span><span>So if you have rules or sets of rules that naturally depend on other rules/sets of rules, you want to put the dependents after the dependencies.  This may not matter to you and may not be worth worrying about until you have a concrete performance concern.</span></div><div id="t1486073175000255" t="2017-02-02 22:06:15 apbleonard We have relatively low numbers of rules (no more than 100s depending on how granular we make them), but enough for Clara to really help sort out the complexity.  🙂  "><a href="#t1486073175000255" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-02-02</span> <span class="t" onclick="H(this)">22:06:15</span>              apbleonard </span><span>We have relatively low numbers of rules (no more than 100s depending on how granular we make them), but enough for Clara to really help sort out the complexity. </span><b>🙂</b><span> </span></div><div id="t1486073218000256" t="2017-02-02 22:06:58 mikerod If I had rules like:
 (defrule a [(acc/all) :from [A]] =&gt; (insert! (-&gt;B)))
(defrule b [(acc/all) :from [B]] =&gt; (insert! (-&gt;C)))
(defrule c [(acc/all) :from [C]] =&gt; (insert! (-&gt;D)))
 
All three rules would be “eligible” to be fired immediately, since the  acc/all  accumulator is always considered “true”.  It will just fire with an empty collection if it has no matches, yet.

If I  mk-session  like
 (mk-session [c b a])
 
This would cause Clara to choose to fire the rules in the opposite order that you would want.  The Truth Maintenance System will be sure that your rules logically are correct after firing the rules, however, it will waste cycles firing rules too soon and having to retract and re-fire them later as their dependencies in their LHS change.

So you want  mk-session  like
 (mk-session [a b c])
"><a href="#t1486073218000256" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-02-02</span> <span class="t" onclick="H(this)">22:06:58</span>                 mikerod </span><span>If I had rules like:
</span><pre>(defrule a [(acc/all) :from [A]] =&gt; (insert! (-&gt;B)))
(defrule b [(acc/all) :from [B]] =&gt; (insert! (-&gt;C)))
(defrule c [(acc/all) :from [C]] =&gt; (insert! (-&gt;D)))
</pre><span>
All three rules would be “eligible” to be fired immediately, since the </span><code>acc/all</code><span> accumulator is always considered “true”.  It will just fire with an empty collection if it has no matches, yet.

If I </span><code>mk-session</code><span> like
</span><pre>(mk-session [c b a])
</pre><span>
This would cause Clara to choose to fire the rules in the opposite order that you would want.  The Truth Maintenance System will be sure that your rules logically are correct after firing the rules, however, it will waste cycles firing rules too soon and having to retract and re-fire them later as their dependencies in their LHS change.

So you want </span><code>mk-session</code><span> like
</span><pre>(mk-session [a b c])
</pre></div><div id="t1486073273000257" t="2017-02-02 22:07:53 mikerod @apbleonard Yeah, it likely isn’t something to concern yourself with now.  I’m just brining it to your attention since when you start to consider generating rules, etc, it may be something to consider later on if performance becomes and sort of concern."><a href="#t1486073273000257" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-02-02</span> <span class="t" onclick="H(this)">22:07:53</span>                 mikerod </span><span>@apbleonard Yeah, it likely isn’t something to concern yourself with now.  I’m just brining it to your attention since when you start to consider generating rules, etc, it may be something to consider later on if performance becomes and sort of concern.</span></div><div id="t1486676182000261" t="2017-02-09 21:36:22 gamecubate Hello. Clojurescript doesn’t seem to be supported at this time. Bummer. Was just what I needed for a project at work."><a href="#t1486676182000261" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-02-09</span> <span class="t" onclick="H(this)">21:36:22</span>              gamecubate </span><span>Hello. Clojurescript doesn’t seem to be supported at this time. Bummer. Was just what I needed for a project at work.</span></div><div id="t1486679844000264" t="2017-02-09 22:37:24 wparker @gamecubate ClojureScript is definitely intended to be supported, although it isn’t used as much as the Clojure version as far as I can tell and not at all at Cerner."><a href="#t1486679844000264" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-02-09</span> <span class="t" onclick="H(this)">22:37:24</span>                 wparker </span><span>@gamecubate ClojureScript is definitely intended to be supported, although it isn’t used as much as the Clojure version as far as I can tell and not at all at Cerner.</span></div><div id="t1486679865000265" t="2017-02-09 22:37:45 wparker Those don’t look like fatal warnings to me, did you run into further problems?"><a href="#t1486679865000265" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-02-09</span> <span class="t" onclick="H(this)">22:37:45</span>                 wparker </span><span>Those don’t look like fatal warnings to me, did you run into further problems?</span></div><div id="t1486698618000266" t="2017-02-10 03:50:18 gamecubate @wparker I didn’t want to spend too much time digging into this. So, I’ve switched over to core.logic but I have to say progress is glacial (this said less than 2 hours after the switch). Clara’s eloquent DSL I miss already."><a href="#t1486698618000266" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-02-10</span> <span class="t" onclick="H(this)">03:50:18</span>              gamecubate </span><span>@wparker I didn’t want to spend too much time digging into this. So, I’ve switched over to core.logic but I have to say progress is glacial (this said less than 2 hours after the switch). Clara’s eloquent DSL I miss already.</span></div><div id="t1486740037000267" t="2017-02-10 15:20:37 wparker To elaborate a bit, those are basically linter warnings that seem related to the rebinding, in a particular namespace, of core Clojure library definitions to new values.  You can look at the source in both cases for whatever version of ClojureScript and Plumatic Schema you’re using to see those redefinitions happening. Whether that is good style in any particular case is a matter of opinion, but I don’t think the linter warnings are actually errors.  Obviously your choice to use Clara in any project or not, but nothing I see here makes me think there is a bug with Clara’s ClojureScript support.  That said, Clara’s ClojureScript certainly isn’t as hardened as the JVM version and bug reports are welcome."><a href="#t1486740037000267" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-02-10</span> <span class="t" onclick="H(this)">15:20:37</span>                 wparker </span><span>To elaborate a bit, those are basically linter warnings that seem related to the rebinding, in a particular namespace, of core Clojure library definitions to new values.  You can look at the source in both cases for whatever version of ClojureScript and Plumatic Schema you’re using to see those redefinitions happening. Whether that is good style in any particular case is a matter of opinion, but I don’t think the linter warnings are actually errors.  Obviously your choice to use Clara in any project or not, but nothing I see here makes me think there is a bug with Clara’s ClojureScript support.  That said, Clara’s ClojureScript certainly isn’t as hardened as the JVM version and bug reports are welcome.</span></div><div id="t1486740073000268" t="2017-02-10 15:21:13 wparker Against master:  https://github.com/plumatic/schema/blob/master/src/cljx/schema/core.cljx#L402  and  https://github.com/clojure/clojurescript/blob/master/src/main/cljs/clojure/reflect.cljs#L33"><a href="#t1486740073000268" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-02-10</span> <span class="t" onclick="H(this)">15:21:13</span>                 wparker </span><span>Against master: </span><a href="https://github.com/plumatic/schema/blob/master/src/cljx/schema/core.cljx#L402" target="_blank">https://github.com/plumatic/schema/blob/master/src/cljx/schema/core.cljx#L402</a><span> and </span><a href="https://github.com/clojure/clojurescript/blob/master/src/main/cljs/clojure/reflect.cljs#L33" target="_blank">https://github.com/clojure/clojurescript/blob/master/src/main/cljs/clojure/reflect.cljs#L33</a></div><div id="t1486742644000270" t="2017-02-10 16:04:04 gamecubate @wparker End of day when I wrote this. I wasn’t thinking. Of course they were warnings! I gave up there and then instead of doing what I normally do (which is to ignore warnings) and proceed. Will resume Clara tests. Thanks for the nudge.  🙂"><a href="#t1486742644000270" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-02-10</span> <span class="t" onclick="H(this)">16:04:04</span>              gamecubate </span><span>@wparker End of day when I wrote this. I wasn’t thinking. Of course they were warnings! I gave up there and then instead of doing what I normally do (which is to ignore warnings) and proceed. Will resume Clara tests. Thanks for the nudge. </span><b>🙂</b></div><div id="t1486745353000274" t="2017-02-10 16:49:13 gamecubate Macros… Checking Clara docs, I see mk-session is a macro indeed. I need to probably add a  (:require-macros [???])  directive. Will try..."><a href="#t1486745353000274" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-02-10</span> <span class="t" onclick="H(this)">16:49:13</span>              gamecubate </span><span>Macros… Checking Clara docs, I see mk-session is a macro indeed. I need to probably add a </span><pre>(:require-macros [???])</pre><span> directive. Will try...</span></div><div id="t1486745484000275" t="2017-02-10 16:51:24 ryanbrush @gamecubate I&apos;d check out the ClojureScript examples, like the one at  https://github.com/cerner/clara-examples/blob/master/src/main/clojurescript/clara/examples/shopping.cljs ."><a href="#t1486745484000275" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-02-10</span> <span class="t" onclick="H(this)">16:51:24</span>               ryanbrush </span><span>@gamecubate I&apos;d check out the ClojureScript examples, like the one at </span><a href="https://github.com/cerner/clara-examples/blob/master/src/main/clojurescript/clara/examples/shopping.cljs" target="_blank">https://github.com/cerner/clara-examples/blob/master/src/main/clojurescript/clara/examples/shopping.cljs</a><span>.</span></div><div id="t1486745550000277" t="2017-02-10 16:52:30 ryanbrush Note that mk-session doesn&apos;t exist and isn&apos;t support in ClojureScript, since it dynamically compiles rules. You&apos;ll need to use defsession (which compiles them upfront), as seen in that example. In fact, starting with that example, running it, and experimenting with changes to it is probably a pretty good way to get started with the ClojureScript flow."><a href="#t1486745550000277" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-02-10</span> <span class="t" onclick="H(this)">16:52:30</span>               ryanbrush </span><span>Note that mk-session doesn&apos;t exist and isn&apos;t support in ClojureScript, since it dynamically compiles rules. You&apos;ll need to use defsession (which compiles them upfront), as seen in that example. In fact, starting with that example, running it, and experimenting with changes to it is probably a pretty good way to get started with the ClojureScript flow.</span></div><div id="t1486745593000278" t="2017-02-10 16:53:13 gamecubate @ryanbrush Thanks. Going through the example now."><a href="#t1486745593000278" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-02-10</span> <span class="t" onclick="H(this)">16:53:13</span>              gamecubate </span><span>@ryanbrush Thanks. Going through the example now.</span></div><div id="t1486745701000279" t="2017-02-10 16:55:01 ryanbrush @gamecubate Sure thing! If you find problems, please log bugs or let us know. Just to warn you, we&apos;ve used only the Clojure version in production and therefore haven&apos;t deeply optimized the CLJS flow so you might run into more issues there. But bug reports, and especially help tuning or optimizing the CLJS flow against real workloads, would be welcome."><a href="#t1486745701000279" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-02-10</span> <span class="t" onclick="H(this)">16:55:01</span>               ryanbrush </span><span>@gamecubate Sure thing! If you find problems, please log bugs or let us know. Just to warn you, we&apos;ve used only the Clojure version in production and therefore haven&apos;t deeply optimized the CLJS flow so you might run into more issues there. But bug reports, and especially help tuning or optimizing the CLJS flow against real workloads, would be welcome.</span></div><div id="t1486745759000280" t="2017-02-10 16:55:59 ryanbrush @gamecubate I think we&apos;re also behind on the version of ClojureScript we&apos;ve tested against, so validating against newer versions is welcome as well."><a href="#t1486745759000280" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-02-10</span> <span class="t" onclick="H(this)">16:55:59</span>               ryanbrush </span><span>@gamecubate I think we&apos;re also behind on the version of ClojureScript we&apos;ve tested against, so validating against newer versions is welcome as well.</span></div><div id="t1486745775000281" t="2017-02-10 16:56:15 gamecubate @ryanbrush  :+1:"><a href="#t1486745775000281" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-02-10</span> <span class="t" onclick="H(this)">16:56:15</span>              gamecubate </span><span>@ryanbrush </span><b>:+1:</b></div><div id="t1486746008000284" t="2017-02-10 17:00:08 gamecubate @ryanbrush Would you recommend I run my code against 0.13.0-RC4 (as per README.md) or, per your example, 0.13.0-RC7?"><a href="#t1486746008000284" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-02-10</span> <span class="t" onclick="H(this)">17:00:08</span>              gamecubate </span><span>@ryanbrush Would you recommend I run my code against 0.13.0-RC4 (as per README.md) or, per your example, 0.13.0-RC7?</span></div><div id="t1486746073000285" t="2017-02-10 17:01:13 ryanbrush @gamecubate Probably doesn&apos;t matter for your needs, but the readme is just out of date. 0.13.0-RC7 will be good. (We&apos;re overdue in just releasing 0.13.0 itself, so expect that in a release soon.)"><a href="#t1486746073000285" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-02-10</span> <span class="t" onclick="H(this)">17:01:13</span>               ryanbrush </span><span>@gamecubate Probably doesn&apos;t matter for your needs, but the readme is just out of date. 0.13.0-RC7 will be good. (We&apos;re overdue in just releasing 0.13.0 itself, so expect that in a release soon.)</span></div><div id="t1486746084000286" t="2017-02-10 17:01:24 gamecubate got it"><a href="#t1486746084000286" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-02-10</span> <span class="t" onclick="H(this)">17:01:24</span>              gamecubate </span><span>got it</span></div><div id="t1486746358000287" t="2017-02-10 17:05:58 gamecubate Wow. This is one great example."><a href="#t1486746358000287" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-02-10</span> <span class="t" onclick="H(this)">17:05:58</span>              gamecubate </span><span>Wow. This is one great example.</span></div><div id="t1486746387000288" t="2017-02-10 17:06:27 gamecubate Just need to replace dommy with (my chosen) Reagent code."><a href="#t1486746387000288" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-02-10</span> <span class="t" onclick="H(this)">17:06:27</span>              gamecubate </span><span>Just need to replace dommy with (my chosen) Reagent code.</span></div><div id="t1486746725000289" t="2017-02-10 17:12:05 ryanbrush Yeah, we probably should update the example to use a more modern approach.  🙂"><a href="#t1486746725000289" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-02-10</span> <span class="t" onclick="H(this)">17:12:05</span>               ryanbrush </span><span>Yeah, we probably should update the example to use a more modern approach. </span><b>🙂</b></div><div id="t1486747081000290" t="2017-02-10 17:18:01 gamecubate It works nicely, though."><a href="#t1486747081000290" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-02-10</span> <span class="t" onclick="H(this)">17:18:01</span>              gamecubate </span><span>It works nicely, though.</span></div><div id="t1486747126000291" t="2017-02-10 17:18:46 gamecubate fire-rules  successful. Am plugging in reactive (test) UI right now."><a href="#t1486747126000291" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-02-10</span> <span class="t" onclick="H(this)">17:18:46</span>              gamecubate </span><pre>fire-rules</pre><span> successful. Am plugging in reactive (test) UI right now.</span></div><div id="t1486747190000292" t="2017-02-10 17:19:50 gamecubate My first instinct (as with all Reagent app data) would be to wrap the session in a (reagent) atom, but defsession being a macro and all, not sure this is even feasible, nor desirable, nor useful."><a href="#t1486747190000292" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-02-10</span> <span class="t" onclick="H(this)">17:19:50</span>              gamecubate </span><span>My first instinct (as with all Reagent app data) would be to wrap the session in a (reagent) atom, but defsession being a macro and all, not sure this is even feasible, nor desirable, nor useful.</span></div><div id="t1486750436000293" t="2017-02-10 18:13:56 gamecubate Done. Works nicely. Will now try and compile with advanced-optimizations."><a href="#t1486750436000293" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-02-10</span> <span class="t" onclick="H(this)">18:13:56</span>              gamecubate </span><span>Done. Works nicely. Will now try and compile with advanced-optimizations.</span></div><div id="t1486750608000294" t="2017-02-10 18:16:48 gamecubate Works!"><a href="#t1486750608000294" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-02-10</span> <span class="t" onclick="H(this)">18:16:48</span>              gamecubate </span><span>Works!</span></div><div id="t1486750646000295" t="2017-02-10 18:17:26 gamecubate Clara it is, then.  🙂"><a href="#t1486750646000295" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-02-10</span> <span class="t" onclick="H(this)">18:17:26</span>              gamecubate </span><span>Clara it is, then. </span><b>🙂</b></div><div id="t1486752963000296" t="2017-02-10 18:56:03 ryanbrush @gamecubate Glad it works! Note that defsession will create the initial, empty session as a static var, but that can be referenced and manipulated like any other Clojure data structure. I haven&apos;t thought a ton of good design patterns with Reagent...but just thinking of the session as any other complex, immutable structure is probably a good start."><a href="#t1486752963000296" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-02-10</span> <span class="t" onclick="H(this)">18:56:03</span>               ryanbrush </span><span>@gamecubate Glad it works! Note that defsession will create the initial, empty session as a static var, but that can be referenced and manipulated like any other Clojure data structure. I haven&apos;t thought a ton of good design patterns with Reagent...but just thinking of the session as any other complex, immutable structure is probably a good start.</span></div><div id="t1486753034000297" t="2017-02-10 18:57:14 ryanbrush @gamecubate if you do come up with good patterns for using this with Reagent and are interested in sharing examples of doing so, we could look at including them in the examples project (possibly replacing the dommy example that exists today)."><a href="#t1486753034000297" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-02-10</span> <span class="t" onclick="H(this)">18:57:14</span>               ryanbrush </span><span>@gamecubate if you do come up with good patterns for using this with Reagent and are interested in sharing examples of doing so, we could look at including them in the examples project (possibly replacing the dommy example that exists today).</span></div><div id="t1486753413000298" t="2017-02-10 19:03:33 gamecubate So far still exploring. What I have done thus far is for my event handlers (someone enters data in a field and clicks on add button -&gt; triggers handler) to insert new session data:  (-&gt; my-session (insert (-&gt;Customer “Alex”)) (fire-rules)) . Now am trying to figure out what to do for my reagent components to show the changes. Normally, without Clara, the event handler would simply update the atom that my components are watching. But now, with Clara, inserted data is held in the session and I need to find a way for my components to track that instead."><a href="#t1486753413000298" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-02-10</span> <span class="t" onclick="H(this)">19:03:33</span>              gamecubate </span><span>So far still exploring. What I have done thus far is for my event handlers (someone enters data in a field and clicks on add button -&gt; triggers handler) to insert new session data: </span><pre>(-&gt; my-session (insert (-&gt;Customer “Alex”)) (fire-rules))</pre><span>. Now am trying to figure out what to do for my reagent components to show the changes. Normally, without Clara, the event handler would simply update the atom that my components are watching. But now, with Clara, inserted data is held in the session and I need to find a way for my components to track that instead.</span></div><div id="t1486753987000301" t="2017-02-10 19:13:07 gamecubate Now, with rules, the handler changes to:"><a href="#t1486753987000301" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-02-10</span> <span class="t" onclick="H(this)">19:13:07</span>              gamecubate </span><span>Now, with rules, the handler changes to:</span></div><div id="t1486754096000303" t="2017-02-10 19:14:56 gamecubate My customer-list component should change as well, and that’s where I am not sure how to proceed to get session data I need."><a href="#t1486754096000303" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-02-10</span> <span class="t" onclick="H(this)">19:14:56</span>              gamecubate </span><span>My customer-list component should change as well, and that’s where I am not sure how to proceed to get session data I need.</span></div><div id="t1486754465000305" t="2017-02-10 19:21:05 ryanbrush Not a Reagent expert, but I think it should be possible to keep a Clara session in a Reagent atom, and swap it out every time you update facts or fire rules."><a href="#t1486754465000305" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-02-10</span> <span class="t" onclick="H(this)">19:21:05</span>               ryanbrush </span><span>Not a Reagent expert, but I think it should be possible to keep a Clara session in a Reagent atom, and swap it out every time you update facts or fire rules.</span></div><div id="t1486754514000306" t="2017-02-10 19:21:54 gamecubate How do I access records of a certain type, say ClientRepresentative?"><a href="#t1486754514000306" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-02-10</span> <span class="t" onclick="H(this)">19:21:54</span>              gamecubate </span><span>How do I access records of a certain type, say ClientRepresentative?</span></div><div id="t1486754542000307" t="2017-02-10 19:22:22 gamecubate (def session-db (reagent/atom my-session))"><a href="#t1486754542000307" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-02-10</span> <span class="t" onclick="H(this)">19:22:22</span>              gamecubate </span><pre>(def session-db (reagent/atom my-session))</pre></div><div id="t1486754553000308" t="2017-02-10 19:22:33 gamecubate Not sure."><a href="#t1486754553000308" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-02-10</span> <span class="t" onclick="H(this)">19:22:33</span>              gamecubate </span><span>Not sure.</span></div><div id="t1486754575000309" t="2017-02-10 19:22:55 ryanbrush All access goes through queries.  http://www.clara-rules.org/docs/queries/"><a href="#t1486754575000309" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-02-10</span> <span class="t" onclick="H(this)">19:22:55</span>               ryanbrush </span><span>All access goes through queries. </span><a href="http://www.clara-rules.org/docs/queries/" target="_blank">http://www.clara-rules.org/docs/queries/</a></div><div id="t1486754797000311" t="2017-02-10 19:26:37 gamecubate How does one write a query that retrieves all records of a certain type? Something like  (defquery get-clients “” [] [???])"><a href="#t1486754797000311" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-02-10</span> <span class="t" onclick="H(this)">19:26:37</span>              gamecubate </span><span>How does one write a query that retrieves all records of a certain type? Something like </span><pre>(defquery get-clients “” [] [???])</pre></div><div id="t1486754852000312" t="2017-02-10 19:27:32 gamecubate with that type defined as  (defrecord Client [name]) ."><a href="#t1486754852000312" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-02-10</span> <span class="t" onclick="H(this)">19:27:32</span>              gamecubate </span><span>with that type defined as </span><pre>(defrecord Client [name])</pre><span>.</span></div><div id="t1486754992000313" t="2017-02-10 19:29:52 gamecubate I might need an example for using accumulators/all. That looks like the one I need."><a href="#t1486754992000313" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-02-10</span> <span class="t" onclick="H(this)">19:29:52</span>              gamecubate </span><span>I might need an example for using accumulators/all. That looks like the one I need.</span></div><div id="t1486755303000314" t="2017-02-10 19:35:03 gamecubate Oh I see. might be  [?client &lt;- Client]"><a href="#t1486755303000314" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-02-10</span> <span class="t" onclick="H(this)">19:35:03</span>              gamecubate </span><span>Oh I see. might be </span><pre>[?client &lt;- Client]</pre></div><div id="t1486759765000315" t="2017-02-10 20:49:25 gamecubate Got it. Just need to set a rule that updates the (reagent atom) db whenever a new session insert takes place."><a href="#t1486759765000315" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-02-10</span> <span class="t" onclick="H(this)">20:49:25</span>              gamecubate </span><span>Got it. Just need to set a rule that updates the (reagent atom) db whenever a new session insert takes place.</span></div><div id="t1486761281000326" t="2017-02-10 21:14:41 gamecubate So, this works. I am not sure however that this should be added to examples because it only serves to demonstrate that using Clara and Reagent together requires (in my solution at least) an extra level of indirection (view -&gt; event handler -&gt; clara insert -&gt; reagent atom db update -&gt; view …). The business logic that Clara offers a DSL for is too simple in this case. I’ll try and think of something more convoluted before submitting said example."><a href="#t1486761281000326" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-02-10</span> <span class="t" onclick="H(this)">21:14:41</span>              gamecubate </span><span>So, this works. I am not sure however that this should be added to examples because it only serves to demonstrate that using Clara and Reagent together requires (in my solution at least) an extra level of indirection (view -&gt; event handler -&gt; clara insert -&gt; reagent atom db update -&gt; view …). The business logic that Clara offers a DSL for is too simple in this case. I’ll try and think of something more convoluted before submitting said example.</span></div><div id="t1486763517000328" t="2017-02-10 21:51:57 ryanbrush Cool, glad it&apos;s working. No rush in adding something to the examples...it&apos;s just nice to see a pattern that works with Reagent."><a href="#t1486763517000328" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-02-10</span> <span class="t" onclick="H(this)">21:51:57</span>               ryanbrush </span><span>Cool, glad it&apos;s working. No rush in adding something to the examples...it&apos;s just nice to see a pattern that works with Reagent.</span></div><div id="t1486763617000329" t="2017-02-10 21:53:37 ryanbrush One thing to note: the session itself is immutable, so you&apos;ll probably want to keep it in atom itself and swap out when you make changes. The rules you have above will work because they are just appending state, but you&apos;re actually resetting back to an old session state every time."><a href="#t1486763617000329" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-02-10</span> <span class="t" onclick="H(this)">21:53:37</span>               ryanbrush </span><span>One thing to note: the session itself is immutable, so you&apos;ll probably want to keep it in atom itself and swap out when you make changes. The rules you have above will work because they are just appending state, but you&apos;re actually resetting back to an old session state every time.</span></div><div id="t1486764208000330" t="2017-02-10 22:03:28 ryanbrush There are probably other interesting variations on this. For instance, we could have reactions that fire on a swap of an atom containing the session, and those reactions would query the session and update other state. This could be a little closer to the purely &quot;reactive&quot; ideals of Reagent, rather than having rules that actively update state."><a href="#t1486764208000330" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-02-10</span> <span class="t" onclick="H(this)">22:03:28</span>               ryanbrush </span><span>There are probably other interesting variations on this. For instance, we could have reactions that fire on a swap of an atom containing the session, and those reactions would query the session and update other state. This could be a little closer to the purely &quot;reactive&quot; ideals of Reagent, rather than having rules that actively update state.</span></div><div id="t1486764480000331" t="2017-02-10 22:08:00 gamecubate I see. Changes needed then; will think about it to see where and how. Thanks! Gotta go pick up kid @ daycare (immutable task for me :). Cheers."><a href="#t1486764480000331" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-02-10</span> <span class="t" onclick="H(this)">22:08:00</span>              gamecubate </span><span>I see. Changes needed then; will think about it to see where and how. Thanks! Gotta go pick up kid @ daycare (immutable task for me :). Cheers.</span></div><div id="t1486924958000332" t="2017-02-12 18:42:38 mike_ananev Hi! Can Clara detect a rule collisions? If rule C contradicts to rule A ?"><a href="#t1486924958000332" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-02-12</span> <span class="t" onclick="H(this)">18:42:38</span>             mike_ananev </span><span>Hi! Can Clara detect a rule collisions? If rule C contradicts to rule A ?</span></div><div id="t1486933197000333" t="2017-02-12 20:59:57 apbleonard Fairly new to Clara but ... it probably depends slightly what you mean. If you have a rules like &quot;if A then B = 1&quot; and &quot;if A then B = 2&quot;, then when you query the session for values of B (assuming A is true) you&apos;ll find two values in the lazy sequence returned by the query function."><a href="#t1486933197000333" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-02-12</span> <span class="t" onclick="H(this)">20:59:57</span>              apbleonard </span><span>Fairly new to Clara but ... it probably depends slightly what you mean. If you have a rules like &quot;if A then B = 1&quot; and &quot;if A then B = 2&quot;, then when you query the session for values of B (assuming A is true) you&apos;ll find two values in the lazy sequence returned by the query function.</span></div><div id="t1486933307000334" t="2017-02-12 21:01:47 apbleonard If you have rules like &quot;if A then B&quot; and &quot;if B then retract A&quot; ... well, I haven&apos;t got that far yet!"><a href="#t1486933307000334" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-02-12</span> <span class="t" onclick="H(this)">21:01:47</span>              apbleonard </span><span>If you have rules like &quot;if A then B&quot; and &quot;if B then retract A&quot; ... well, I haven&apos;t got that far yet!</span></div><div id="t1486937843000335" t="2017-02-12 22:17:23 mike_ananev @apbleonard yeah, first variant with two answers is correct, i think. second variant is not,  cause &quot;if A then B&quot; will insert fact B, but if retract A then B will be retracted automatically. my question about contradiction was about case if some big organization issues new policy about smth, i want to check that rules in new policy are not contradict to older policies. so i want to find collisions before new policy is issued."><a href="#t1486937843000335" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-02-12</span> <span class="t" onclick="H(this)">22:17:23</span>             mike_ananev </span><span>@apbleonard yeah, first variant with two answers is correct, i think. second variant is not,  cause &quot;if A then B&quot; will insert fact B, but if retract A then B will be retracted automatically. my question about contradiction was about case if some big organization issues new policy about smth, i want to check that rules in new policy are not contradict to older policies. so i want to find collisions before new policy is issued.</span></div><div id="t1487020958000336" t="2017-02-13 21:22:38 mikerod @mike1452 @apbleonard the 2nd variant could actually cause an infinite loop since Clara’s  insert!  will do some automatic truth-maintenance which can hang indefinitely if you have a “logical loop&quot;"><a href="#t1487020958000336" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-02-13</span> <span class="t" onclick="H(this)">21:22:38</span>                 mikerod </span><span>@mike1452 @apbleonard the 2nd variant could actually cause an infinite loop since Clara’s </span><code>insert!</code><span> will do some automatic truth-maintenance which can hang indefinitely if you have a “logical loop&quot;</span></div><div id="t1487021069000337" t="2017-02-13 21:24:29 mikerod However, the 1st variant sounds to be more of what you were asking.  You have to deal with duplicated inserts yourself.  You could have rules all insert some fact like B there, then have some “final”/”outcome&quot; rule(s) or query(s) that use an accumulator that you can make decide which facts are the most relevant or correct when you get into a situation of “contradictions&quot;"><a href="#t1487021069000337" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-02-13</span> <span class="t" onclick="H(this)">21:24:29</span>                 mikerod </span><span>However, the 1st variant sounds to be more of what you were asking.  You have to deal with duplicated inserts yourself.  You could have rules all insert some fact like B there, then have some “final”/”outcome&quot; rule(s) or query(s) that use an accumulator that you can make decide which facts are the most relevant or correct when you get into a situation of “contradictions&quot;</span></div><div id="t1487021236000338" t="2017-02-13 21:27:16 mikerod However, I think you were also wanting the engine to tell you about these rules so you could remove them perhaps?  That would be something you’d probably have to workout yourself.  Sounds domain-specific."><a href="#t1487021236000338" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-02-13</span> <span class="t" onclick="H(this)">21:27:16</span>                 mikerod </span><span>However, I think you were also wanting the engine to tell you about these rules so you could remove them perhaps?  That would be something you’d probably have to workout yourself.  Sounds domain-specific.</span></div><div id="t1487021270000339" t="2017-02-13 21:27:50 mikerod It isn’t really clear what a “contradicting” rule means from the rules engine’s perspective.  With the exception of logical contradictions, but those also aren’t even clear in the engine right now since the RHS can insert basically anthing"><a href="#t1487021270000339" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-02-13</span> <span class="t" onclick="H(this)">21:27:50</span>                 mikerod </span><span>It isn’t really clear what a “contradicting” rule means from the rules engine’s perspective.  With the exception of logical contradictions, but those also aren’t even clear in the engine right now since the RHS can insert basically anthing</span></div><div id="t1487021297000340" t="2017-02-13 21:28:17 mikerod and the LHS can test constraints that aren’t simple to statically analyze."><a href="#t1487021297000340" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-02-13</span> <span class="t" onclick="H(this)">21:28:17</span>                 mikerod </span><span>and the LHS can test constraints that aren’t simple to statically analyze.</span></div><div id="t1487089804000341" t="2017-02-14 16:30:04 wparker @mike1452 @apbleonard If you use manual retractions in the RHS you become responsible for ensuring that the rule execution order works out so that you get your desired results.  It is basically the same idea as with logical vs unconditional insertions discussed at  http://www.clara-rules.org/docs/truthmaint/   This can be done with salience and/or strategic structuring of your rules, but in my experience adds significant complication and room for error"><a href="#t1487089804000341" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-02-14</span> <span class="t" onclick="H(this)">16:30:04</span>                 wparker </span><span>@mike1452 @apbleonard If you use manual retractions in the RHS you become responsible for ensuring that the rule execution order works out so that you get your desired results.  It is basically the same idea as with logical vs unconditional insertions discussed at </span><a href="http://www.clara-rules.org/docs/truthmaint/" target="_blank">http://www.clara-rules.org/docs/truthmaint/</a><span>  This can be done with salience and/or strategic structuring of your rules, but in my experience adds significant complication and room for error</span></div><div id="t1487089887000343" t="2017-02-14 16:31:27 wparker My suggestion would be to use accumulators or negation conditions as Mike alluded to above.  If you have a priority order of different logical states it wouldn’t be too hard to get the state with the highest priority in an accumulator and use that state in a rule RHS.  Alternatively, you can write rules like"><a href="#t1487089887000343" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-02-14</span> <span class="t" onclick="H(this)">16:31:27</span>                 wparker </span><span>My suggestion would be to use accumulators or negation conditions as Mike alluded to above.  If you have a priority order of different logical states it wouldn’t be too hard to get the state with the highest priority in an accumulator and use that state in a rule RHS.  Alternatively, you can write rules like</span></div><div id="t1487090045000344" t="2017-02-14 16:34:05 wparker (defrule negation-rule-1 [?a &lt;- A (some-predicate-here)] [:not [B (other-predicate-here)]] =&gt; (insert something))"><a href="#t1487090045000344" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-02-14</span> <span class="t" onclick="H(this)">16:34:05</span>                 wparker </span><span>(defrule negation-rule-1 [?a &lt;- A (some-predicate-here)] [:not [B (other-predicate-here)]] =&gt; (insert something))</span></div><div id="t1487090262000345" t="2017-02-14 16:37:42 wparker manual RHS retractions can be useful for getting things out of memory or for performance, in general wouldn’t be my first resort though"><a href="#t1487090262000345" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-02-14</span> <span class="t" onclick="H(this)">16:37:42</span>                 wparker </span><span>manual RHS retractions can be useful for getting things out of memory or for performance, in general wouldn’t be my first resort though</span></div><div id="t1487090820000346" t="2017-02-14 16:47:00 mike_ananev @wparker thanks for suggestions! btw, what is most biggest rules database  you&apos;ve ever seen in production memory that Clara worked with? 10,100, 500?"><a href="#t1487090820000346" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-02-14</span> <span class="t" onclick="H(this)">16:47:00</span>             mike_ananev </span><span>@wparker thanks for suggestions! btw, what is most biggest rules database  you&apos;ve ever seen in production memory that Clara worked with? 10,100, 500?</span></div><div id="t1487090838000347" t="2017-02-14 16:47:18 wparker do you mean the number of rules?"><a href="#t1487090838000347" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-02-14</span> <span class="t" onclick="H(this)">16:47:18</span>                 wparker </span><span>do you mean the number of rules?</span></div><div id="t1487090849000348" t="2017-02-14 16:47:29 mike_ananev yeah"><a href="#t1487090849000348" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-02-14</span> <span class="t" onclick="H(this)">16:47:29</span>             mike_ananev </span><span>yeah</span></div><div id="t1487091319000349" t="2017-02-14 16:55:19 wparker I think we have some rulesets with at least 10K rules now, can’t say exactly off the top of my head since we autogenerate a lot of rules with some internal framework code"><a href="#t1487091319000349" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-02-14</span> <span class="t" onclick="H(this)">16:55:19</span>                 wparker </span><span>I think we have some rulesets with at least 10K rules now, can’t say exactly off the top of my head since we autogenerate a lot of rules with some internal framework code</span></div><div id="t1487091493000350" t="2017-02-14 16:58:13 wparker there’s a reason we’ve spent a lot of effort optimizing performance  😛"><a href="#t1487091493000350" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-02-14</span> <span class="t" onclick="H(this)">16:58:13</span>                 wparker </span><span>there’s a reason we’ve spent a lot of effort optimizing performance </span><b>😛</b></div><div id="t1487095459000351" t="2017-02-14 18:04:19 mike_ananev wow, cool!"><a href="#t1487095459000351" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-02-14</span> <span class="t" onclick="H(this)">18:04:19</span>             mike_ananev </span><span>wow, cool!</span></div><div id="t1487099946000352" t="2017-02-14 19:19:06 apbleonard @mike1452 FWIW I have exactly the same challenges. We handle complex government policies introduced atop of older policies, and half the battle is understanding pathways through the logic, and the total space of inputs and the variety of resulting outputs. I&apos;d love to implement the rules trivially enough to give fast feedback to policy makers on what their new policy just did to the complexity of the problem. I feel like clojure&apos;s core.logic should be able to help with this...? If that makes sense, anyone know of people using core.logic with Clara?"><a href="#t1487099946000352" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-02-14</span> <span class="t" onclick="H(this)">19:19:06</span>              apbleonard </span><span>@mike1452 FWIW I have exactly the same challenges. We handle complex government policies introduced atop of older policies, and half the battle is understanding pathways through the logic, and the total space of inputs and the variety of resulting outputs. I&apos;d love to implement the rules trivially enough to give fast feedback to policy makers on what their new policy just did to the complexity of the problem. I feel like clojure&apos;s core.logic should be able to help with this...? If that makes sense, anyone know of people using core.logic with Clara?</span></div><div id="t1487105346000353" t="2017-02-14 20:49:06 ryanbrush @apbleonard I&apos;m a fan of core.logic, but am unaware of anyone using it tightly with Clara. I think core.logic works great for problems that can be described as a set of constraints, and core.logic will search that constraint space for a solution. Clara is more centered around encoding business rules or domain expertise. It&apos;s not always obvious which tool is best for a given job, so I always think it&apos;s a good idea to experiment with both in your problem space before choosing a direction."><a href="#t1487105346000353" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-02-14</span> <span class="t" onclick="H(this)">20:49:06</span>               ryanbrush </span><span>@apbleonard I&apos;m a fan of core.logic, but am unaware of anyone using it tightly with Clara. I think core.logic works great for problems that can be described as a set of constraints, and core.logic will search that constraint space for a solution. Clara is more centered around encoding business rules or domain expertise. It&apos;s not always obvious which tool is best for a given job, so I always think it&apos;s a good idea to experiment with both in your problem space before choosing a direction.</span></div><div id="t1487106625000354" t="2017-02-14 21:10:25 wparker Clara-rules 0.13.0 is released.  - The replacement of the previous durability API with a more robust and performant one. This is discussed at issue 198.  Note that this is experimental and is subject to further change; that said we&apos;re successfully using it in production at Cerner.
- Improvements in error reporting in rule and query conditions, discussed at issue 255. Thanks to Carlos Phillips for this one.
- Various performance improvements and bug fixes discussed on the changelog."><a href="#t1487106625000354" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-02-14</span> <span class="t" onclick="H(this)">21:10:25</span>                 wparker </span><span>Clara-rules 0.13.0 is released.  - The replacement of the previous durability API with a more robust and performant one. This is discussed at issue 198.  Note that this is experimental and is subject to further change; that said we&apos;re successfully using it in production at Cerner.
- Improvements in error reporting in rule and query conditions, discussed at issue 255. Thanks to Carlos Phillips for this one.
- Various performance improvements and bug fixes discussed on the changelog.</span></div><div id="t1487106664000355" t="2017-02-14 21:11:04 wparker I meant to say “highlights include” before my bullets.. I fail at Slack formatting  😛"><a href="#t1487106664000355" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-02-14</span> <span class="t" onclick="H(this)">21:11:04</span>                 wparker </span><span>I meant to say “highlights include” before my bullets.. I fail at Slack formatting </span><b>😛</b></div><div id="t1487106679000356" t="2017-02-14 21:11:19 wparker Anyway, basically a cross-post from  https://groups.google.com/forum/#!topic/clara-rules/Q2p7l-Vmcr0"><a href="#t1487106679000356" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-02-14</span> <span class="t" onclick="H(this)">21:11:19</span>                 wparker </span><span>Anyway, basically a cross-post from </span><a href="https://groups.google.com/forum/#!topic/clara-rules/Q2p7l-Vmcr0" target="_blank">https://groups.google.com/forum/#!topic/clara-rules/Q2p7l-Vmcr0</a></div><div id="t1487281932000362" t="2017-02-16 21:52:12 jarrodctaylor Could anyone be so kind as to help me understand how variable definition works? This is the most concise example I have to illustrate my confusion.
 (require &apos;[clara.rules :as rule])

(rule/defrule wat
  [1 (= ?a &quot;a&quot;)]
  [1 (= ?b &quot;b&quot;)
   (nil? (println ?a))    ;; =&gt; &quot;a&quot;
   (nil? (println ?b))    ;; =&gt; &quot;b&quot;
   (nil? (println ?a ?b)) ;; =&gt; &quot;a nil&quot;
   ] =&gt; nil)

(-&gt; (rule/mk-session [wat] :fact-type-fn (constantly 1))
    (rule/insert 1)
    (rule/fire-rules))
"><a href="#t1487281932000362" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-02-16</span> <span class="t" onclick="H(this)">21:52:12</span>           jarrodctaylor </span><span>Could anyone be so kind as to help me understand how variable definition works? This is the most concise example I have to illustrate my confusion.
</span><pre>(require &apos;[clara.rules :as rule])

(rule/defrule wat
  [1 (= ?a &quot;a&quot;)]
  [1 (= ?b &quot;b&quot;)
   (nil? (println ?a))    ;; =&gt; &quot;a&quot;
   (nil? (println ?b))    ;; =&gt; &quot;b&quot;
   (nil? (println ?a ?b)) ;; =&gt; &quot;a nil&quot;
   ] =&gt; nil)

(-&gt; (rule/mk-session [wat] :fact-type-fn (constantly 1))
    (rule/insert 1)
    (rule/fire-rules))
</pre></div><div id="t1487281994000364" t="2017-02-16 21:53:14 jarrodctaylor Why does  ?b  disappear when printed together with  ?a ?"><a href="#t1487281994000364" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-02-16</span> <span class="t" onclick="H(this)">21:53:14</span>           jarrodctaylor </span><span>Why does </span><code>?b</code><span> disappear when printed together with </span><code>?a</code><span>?</span></div><div id="t1487284893000367" t="2017-02-16 22:41:33 wparker I wouldn’t expect that to happen, but I can see the behavior you describe when I drop your example in a REPL"><a href="#t1487284893000367" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-02-16</span> <span class="t" onclick="H(this)">22:41:33</span>                 wparker </span><span>I wouldn’t expect that to happen, but I can see the behavior you describe when I drop your example in a REPL</span></div><div id="t1487285046000368" t="2017-02-16 22:44:06 wparker It is a weird case in that you’d normally expect the bindings to come off the actual fact in some way, but it still seems like incorrect behavior at first glance, probably merits a GitHub issue"><a href="#t1487285046000368" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-02-16</span> <span class="t" onclick="H(this)">22:44:06</span>                 wparker </span><span>It is a weird case in that you’d normally expect the bindings to come off the actual fact in some way, but it still seems like incorrect behavior at first glance, probably merits a GitHub issue</span></div><div id="t1487285104000369" t="2017-02-16 22:45:04 wparker @jarrodctaylor"><a href="#t1487285104000369" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-02-16</span> <span class="t" onclick="H(this)">22:45:04</span>                 wparker </span><span>@jarrodctaylor</span></div><div id="t1487285553000370" t="2017-02-16 22:52:33 jarrodctaylor I was experiencing the behavior with a more traditional rule in my application. This above was as too the point of an example to demonstrate it as possible. I will open a issue on GitHub. "><a href="#t1487285553000370" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-02-16</span> <span class="t" onclick="H(this)">22:52:33</span>           jarrodctaylor </span><span>I was experiencing the behavior with a more traditional rule in my application. This above was as too the point of an example to demonstrate it as possible. I will open a issue on GitHub. </span></div><div id="t1487285567000371" t="2017-02-16 22:52:47 zylox i know ive had issues when i try to refer to a binding in the same condition (might be the wrong term) where it was bound."><a href="#t1487285567000371" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-02-16</span> <span class="t" onclick="H(this)">22:52:47</span>                   zylox </span><span>i know ive had issues when i try to refer to a binding in the same condition (might be the wrong term) where it was bound.</span></div><div id="t1487285584000372" t="2017-02-16 22:53:04 zylox but if i used the raw field version it worked fine"><a href="#t1487285584000372" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-02-16</span> <span class="t" onclick="H(this)">22:53:04</span>                   zylox </span><span>but if i used the raw field version it worked fine</span></div><div id="t1487286633000373" t="2017-02-16 23:10:33 wparker I suspect that the reason adding ?a causes ?b to be different is that if you have ?a in the constraint it will become a join with the previous fact, and if it is absent it is a condition on a single fact"><a href="#t1487286633000373" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-02-16</span> <span class="t" onclick="H(this)">23:10:33</span>                 wparker </span><span>I suspect that the reason adding ?a causes ?b to be different is that if you have ?a in the constraint it will become a join with the previous fact, and if it is absent it is a condition on a single fact</span></div><div id="t1487286656000374" t="2017-02-16 23:10:56 wparker Those are different paths in the compiler so one could have a bug the other doesn&apos;t"><a href="#t1487286656000374" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-02-16</span> <span class="t" onclick="H(this)">23:10:56</span>                 wparker </span><span>Those are different paths in the compiler so one could have a bug the other doesn&apos;t</span></div><div id="t1487286697000375" t="2017-02-16 23:11:37 wparker Doing a quick test like"><a href="#t1487286697000375" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-02-16</span> <span class="t" onclick="H(this)">23:11:37</span>                 wparker </span><span>Doing a quick test like</span></div><div id="t1487286702000376" t="2017-02-16 23:11:42 wparker ` (rule/defrule wat
  [1 (= ?a &quot;a&quot;)]
  [1 (= ?b &quot;b&quot;)
   (and (nil? (println ?a))
         (nil? (println ?b))) 
   ] =&gt; nil)  `"><a href="#t1487286702000376" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-02-16</span> <span class="t" onclick="H(this)">23:11:42</span>                 wparker </span><pre>` (rule/defrule wat
  [1 (= ?a &quot;a&quot;)]
  [1 (= ?b &quot;b&quot;)
   (and (nil? (println ?a))
         (nil? (println ?b))) 
   ] =&gt; nil) </pre><span>`</span></div><div id="t1487286719000377" t="2017-02-16 23:11:59 wparker makes b be nil as well"><a href="#t1487286719000377" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-02-16</span> <span class="t" onclick="H(this)">23:11:59</span>                 wparker </span><span>makes b be nil as well</span></div><div id="t1487286738000378" t="2017-02-16 23:12:18 wparker with ?a and ?b in the same constraint"><a href="#t1487286738000378" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-02-16</span> <span class="t" onclick="H(this)">23:12:18</span>                 wparker </span><span>with ?a and ?b in the same constraint</span></div><div id="t1487286774000379" t="2017-02-16 23:12:54 wparker @zylox : a “condition” contains constraints, that is you can have a condition like [FactType constraint1 constraint2]"><a href="#t1487286774000379" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-02-16</span> <span class="t" onclick="H(this)">23:12:54</span>                 wparker </span><span>@zylox : a “condition” contains constraints, that is you can have a condition like [FactType constraint1 constraint2]</span></div><div id="t1488079310000382" t="2017-02-26 03:21:50 mikerod https://leanpub.com/readevalprintlove004/read 
I don&apos;t recall if this was shared in this channel yet. It is an interesting read on rules engines by Fogus.
 I particularly like the simplified implementation of a (naive and simplistic) rules system. The &quot;fruit fly&quot; system. Hah. It does shed some light on some ideas at a high level. There is a little mention of Clara in the end &quot;credits&quot; too. So there is that.  😜  "><a href="#t1488079310000382" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-02-26</span> <span class="t" onclick="H(this)">03:21:50</span>                 mikerod </span><a href="https://leanpub.com/readevalprintlove004/read" target="_blank">https://leanpub.com/readevalprintlove004/read</a><span>
I don&apos;t recall if this was shared in this channel yet. It is an interesting read on rules engines by Fogus.
 I particularly like the simplified implementation of a (naive and simplistic) rules system. The &quot;fruit fly&quot; system. Hah. It does shed some light on some ideas at a high level. There is a little mention of Clara in the end &quot;credits&quot; too. So there is that. </span><b>😜</b><span> </span></div><div id="t1488452228000389" t="2017-03-02 10:57:08 newres I have a question about using guards on rules in Clara. I am aiming to create rules that can never insert a fact that already exist. The guard statement works fine if I am manually inserting the fact that the guard stops, but if the rule itself is creating this statement the guard does not stop the rule from triggering again and I get an infinite loop."><a href="#t1488452228000389" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-03-02</span> <span class="t" onclick="H(this)">10:57:08</span>                  newres </span><span>I have a question about using guards on rules in Clara. I am aiming to create rules that can never insert a fact that already exist. The guard statement works fine if I am manually inserting the fact that the guard stops, but if the rule itself is creating this statement the guard does not stop the rule from triggering again and I get an infinite loop.</span></div><div id="t1488470706000390" t="2017-03-02 16:05:06 zylox ya thats a tricky one ive dealt with too. i&apos;m not sure what the solution is either."><a href="#t1488470706000390" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-03-02</span> <span class="t" onclick="H(this)">16:05:06</span>                   zylox </span><span>ya thats a tricky one ive dealt with too. i&apos;m not sure what the solution is either.</span></div><div id="t1488471566000391" t="2017-03-02 16:19:26 newres with a naive implementation of rules where each rule is checked separately I can see this not being an issue as after each insertion the guard would be checked and with the new fact that guard would be passed. Could this be a bug in the implementation, where somehow not the full condition of the rule is checked for it to fire again?"><a href="#t1488471566000391" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-03-02</span> <span class="t" onclick="H(this)">16:19:26</span>                  newres </span><span>with a naive implementation of rules where each rule is checked separately I can see this not being an issue as after each insertion the guard would be checked and with the new fact that guard would be passed. Could this be a bug in the implementation, where somehow not the full condition of the rule is checked for it to fire again?</span></div><div id="t1488472461000392" t="2017-03-02 16:34:21 zylox maybe i didnt understand what you meant by gaurds, but if a rule inserts something that that same rule looks at, its pretty much always going to cause another firing"><a href="#t1488472461000392" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-03-02</span> <span class="t" onclick="H(this)">16:34:21</span>                   zylox </span><span>maybe i didnt understand what you meant by gaurds, but if a rule inserts something that that same rule looks at, its pretty much always going to cause another firing</span></div><div id="t1488472473000393" t="2017-03-02 16:34:33 zylox is my understanding"><a href="#t1488472473000393" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-03-02</span> <span class="t" onclick="H(this)">16:34:33</span>                   zylox </span><span>is my understanding</span></div><div id="t1488474988000394" t="2017-03-02 17:16:28 newres I think i figured out the roof of the problem"><a href="#t1488474988000394" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-03-02</span> <span class="t" onclick="H(this)">17:16:28</span>                  newres </span><span>I think i figured out the roof of the problem</span></div><div id="t1488475006000395" t="2017-03-02 17:16:46 newres I compeltely glanced over the fact that clara does truth maintenance"><a href="#t1488475006000395" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-03-02</span> <span class="t" onclick="H(this)">17:16:46</span>                  newres </span><span>I compeltely glanced over the fact that clara does truth maintenance</span></div><div id="t1488475085000396" t="2017-03-02 17:18:05 newres this means if the result of the rule puts in the guard of the rule the fact loses support gets retracted and the rule fires again"><a href="#t1488475085000396" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-03-02</span> <span class="t" onclick="H(this)">17:18:05</span>                  newres </span><span>this means if the result of the rule puts in the guard of the rule the fact loses support gets retracted and the rule fires again</span></div><div id="t1488475134000397" t="2017-03-02 17:18:54 wparker Sounds correct, looking through  https://github.com/cerner/clara-examples/blob/master/src/main/clojure/clara/examples/truth_maintenance.clj  and  http://www.clara-rules.org/docs/truthmaint/  might be helpful  🙂"><a href="#t1488475134000397" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-03-02</span> <span class="t" onclick="H(this)">17:18:54</span>                 wparker </span><span>Sounds correct, looking through </span><a href="https://github.com/cerner/clara-examples/blob/master/src/main/clojure/clara/examples/truth_maintenance.clj" target="_blank">https://github.com/cerner/clara-examples/blob/master/src/main/clojure/clara/examples/truth_maintenance.clj</a><span> and </span><a href="http://www.clara-rules.org/docs/truthmaint/" target="_blank">http://www.clara-rules.org/docs/truthmaint/</a><span> might be helpful </span><b>🙂</b></div><div id="t1488475137000399" t="2017-03-02 17:18:57 zylox truestory"><a href="#t1488475137000399" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-03-02</span> <span class="t" onclick="H(this)">17:18:57</span>                   zylox </span><b>truestory</b></div><div id="t1488475158000400" t="2017-03-02 17:19:18 newres I feel very dense about this"><a href="#t1488475158000400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-03-02</span> <span class="t" onclick="H(this)">17:19:18</span>                  newres </span><span>I feel very dense about this</span></div><div id="t1488475205000401" t="2017-03-02 17:20:05 wparker You can use unconditional insertions that won’t use truth maintenance if necessary.  In our use cases we strongly prefer truth maintenance and find that it makes the code simpler to reason about, but obviously use-cases differ"><a href="#t1488475205000401" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-03-02</span> <span class="t" onclick="H(this)">17:20:05</span>                 wparker </span><span>You can use unconditional insertions that won’t use truth maintenance if necessary.  In our use cases we strongly prefer truth maintenance and find that it makes the code simpler to reason about, but obviously use-cases differ</span></div><div id="t1488475220000402" t="2017-03-02 17:20:20 newres i was staring at this like a whole evening thinking what the problem  could be, whoops."><a href="#t1488475220000402" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-03-02</span> <span class="t" onclick="H(this)">17:20:20</span>                  newres </span><span>i was staring at this like a whole evening thinking what the problem  could be, whoops.</span></div><div id="t1488475223000403" t="2017-03-02 17:20:23 wparker It is a common point of confusion  🙂"><a href="#t1488475223000403" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-03-02</span> <span class="t" onclick="H(this)">17:20:23</span>                 wparker </span><span>It is a common point of confusion </span><b>🙂</b></div><div id="t1488475264000405" t="2017-03-02 17:21:04 newres It kind of solves pretty much every problem I had with clara though, so that is a relief"><a href="#t1488475264000405" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-03-02</span> <span class="t" onclick="H(this)">17:21:04</span>                  newres </span><span>It kind of solves pretty much every problem I had with clara though, so that is a relief</span></div><div id="t1488475327000406" t="2017-03-02 17:22:07 zylox so you are saying you were stuck in an infinite loop about the infinite loop and the truth about truth maintenence resolved it"><a href="#t1488475327000406" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-03-02</span> <span class="t" onclick="H(this)">17:22:07</span>                   zylox </span><span>so you are saying you were stuck in an infinite loop about the infinite loop and the truth about truth maintenence resolved it</span></div><div id="t1488475451000407" t="2017-03-02 17:24:11 newres yeah basically using a guard with truth maintenance, where the result of the rule (or another) triggers the guard can start an infinite loop"><a href="#t1488475451000407" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-03-02</span> <span class="t" onclick="H(this)">17:24:11</span>                  newres </span><span>yeah basically using a guard with truth maintenance, where the result of the rule (or another) triggers the guard can start an infinite loop</span></div><div id="t1488475485000408" t="2017-03-02 17:24:45 newres especially in the case where it is just a single rule that triggers the guard"><a href="#t1488475485000408" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-03-02</span> <span class="t" onclick="H(this)">17:24:45</span>                  newres </span><span>especially in the case where it is just a single rule that triggers the guard</span></div><div id="t1488475512000409" t="2017-03-02 17:25:12 zylox (i was just making a light hearted joke about how your proccess of realizing how it was working was similar to a rules network) though your understanding sounds correct to me"><a href="#t1488475512000409" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-03-02</span> <span class="t" onclick="H(this)">17:25:12</span>                   zylox </span><span>(i was just making a light hearted joke about how your proccess of realizing how it was working was similar to a rules network) though your understanding sounds correct to me</span></div><div id="t1488475528000410" t="2017-03-02 17:25:28 newres ah LOL"><a href="#t1488475528000410" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-03-02</span> <span class="t" onclick="H(this)">17:25:28</span>                  newres </span><span>ah LOL</span></div><div id="t1488475541000411" t="2017-03-02 17:25:41 newres well like I said I feel dense today"><a href="#t1488475541000411" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-03-02</span> <span class="t" onclick="H(this)">17:25:41</span>                  newres </span><span>well like I said I feel dense today</span></div><div id="t1488484367000412" t="2017-03-02 19:52:47 nrayapati http://www.metasimple.org/2017/02/28/clarifying-rules-engines.html"><a href="#t1488484367000412" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-03-02</span> <span class="t" onclick="H(this)">19:52:47</span>               nrayapati </span><a href="http://www.metasimple.org/2017/02/28/clarifying-rules-engines.html" target="_blank">http://www.metasimple.org/2017/02/28/clarifying-rules-engines.html</a></div><div id="t1488484444000414" t="2017-03-02 19:54:04 nrayapati Overview of the talk @mikerod  gave at the Clojure/conj 2016 conference."><a href="#t1488484444000414" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-03-02</span> <span class="t" onclick="H(this)">19:54:04</span>               nrayapati </span><span>Overview of the talk @mikerod  gave at the Clojure/conj 2016 conference.</span></div><div id="t1488486677000416" t="2017-03-02 20:31:17 mikerod Oh yes. Still cleaning up that site some. Going to change the theme since it sucks on mobile. However the content is there. "><a href="#t1488486677000416" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-03-02</span> <span class="t" onclick="H(this)">20:31:17</span>                 mikerod </span><span>Oh yes. Still cleaning up that site some. Going to change the theme since it sucks on mobile. However the content is there. </span></div><div id="t1488486789000417" t="2017-03-02 20:33:09 zylox nope this is permanent now"><a href="#t1488486789000417" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-03-02</span> <span class="t" onclick="H(this)">20:33:09</span>                   zylox </span><span>nope this is permanent now</span></div><div id="t1488486803000418" t="2017-03-02 20:33:23 zylox weve seen everything"><a href="#t1488486803000418" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-03-02</span> <span class="t" onclick="H(this)">20:33:23</span>                   zylox </span><span>weve seen everything</span></div><div id="t1488490861000419" t="2017-03-02 21:41:01 ryanbrush @mikerod Okay, I&apos;ll resist the urge to tweet about it until you have the finishing touches in place.  😄"><a href="#t1488490861000419" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-03-02</span> <span class="t" onclick="H(this)">21:41:01</span>               ryanbrush </span><span>@mikerod Okay, I&apos;ll resist the urge to tweet about it until you have the finishing touches in place. </span><b>😄</b></div><div id="t1488490957000420" t="2017-03-02 21:42:37 mikerod Haha. Thanks. I&apos;ll fix it within a day or so. Out of town so I&apos;m a bit slow. "><a href="#t1488490957000420" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-03-02</span> <span class="t" onclick="H(this)">21:42:37</span>                 mikerod </span><span>Haha. Thanks. I&apos;ll fix it within a day or so. Out of town so I&apos;m a bit slow. </span></div><div id="t1488571240000423" t="2017-03-03 20:00:40 mikerod @ryanbrush FYI I changed the visual theme to something that is reasonable on mobile and desktop. So I&apos;d consider the Clara blog good to go at this point. "><a href="#t1488571240000423" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-03-03</span> <span class="t" onclick="H(this)">20:00:40</span>                 mikerod </span><span>@ryanbrush FYI I changed the visual theme to something that is reasonable on mobile and desktop. So I&apos;d consider the Clara blog good to go at this point. </span></div><div id="t1488572235000424" t="2017-03-03 20:17:15 ryanbrush @mikerod Looks great, and nice post!"><a href="#t1488572235000424" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-03-03</span> <span class="t" onclick="H(this)">20:17:15</span>               ryanbrush </span><span>@mikerod Looks great, and nice post!</span></div><div id="t1488573625000425" t="2017-03-03 20:40:25 mikerod Thanks!"><a href="#t1488573625000425" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-03-03</span> <span class="t" onclick="H(this)">20:40:25</span>                 mikerod </span><span>Thanks!</span></div><div id="t1490201675400212" t="2017-03-22 16:54:35 wparker Version 0.14.0 of clara-rules is released.  I posted at  https://groups.google.com/forum/#!topic/clara-rules/UscQQgDtN-Y  with a description of the changes relative to 0.13.0 (the previous version)."><a href="#t1490201675400212" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-03-22</span> <span class="t" onclick="H(this)">16:54:35</span>                 wparker </span><span>Version 0.14.0 of clara-rules is released.  I posted at </span><a href="https://groups.google.com/forum/#!topic/clara-rules/UscQQgDtN-Y" target="_blank">https://groups.google.com/forum/#!topic/clara-rules/UscQQgDtN-Y</a><span> with a description of the changes relative to 0.13.0 (the previous version).</span></div><div id="t1492037426168960" t="2017-04-12 22:50:26 souenzzo Hi. How to make an &quot;or&quot; in &quot;match&quot; part of rule.
Example:
 ;; There is 2 types: groups and items
;; Example:
;; :group [1 false 2]
;; :group [1 false 3]
;; :item [2 true]
;; :item [3 false]
;; :group [4 true 5]
;; :item [5 false]
;; Group &apos;1&apos; contains items &apos;2&apos; and &apos;3&apos;
;; Group &apos;4&apos; contains item &apos;5&apos;
;; My `select` query shoud find [[4][1]]
;; because they are groups and they are selected
;; or contains a selected item
(defrule selected-groups
         ;; Or this
         [:group [[id selected _]] (= ?id group) (= selected true)]

         ;; Or this
         [:group [[id _ item-id]] (= ?id id) (= item-id ?item-id)]
         [:item [[item-id selected]] (= ?item-id item-id) (= selected true)]
         =&gt;
         (insert! ^{:type :select} [?id]))
 
(sorry for big example)
(yes, I know how to do it with 2 rules.)
(I dont care with duplicate entries)"><a href="#t1492037426168960" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-04-12</span> <span class="t" onclick="H(this)">22:50:26</span>                souenzzo </span><span>Hi. How to make an &quot;or&quot; in &quot;match&quot; part of rule.
Example:
</span><pre>;; There is 2 types: groups and items
;; Example:
;; :group [1 false 2]
;; :group [1 false 3]
;; :item [2 true]
;; :item [3 false]
;; :group [4 true 5]
;; :item [5 false]
;; Group &apos;1&apos; contains items &apos;2&apos; and &apos;3&apos;
;; Group &apos;4&apos; contains item &apos;5&apos;
;; My `select` query shoud find [[4][1]]
;; because they are groups and they are selected
;; or contains a selected item
(defrule selected-groups
         ;; Or this
         [:group [[id selected _]] (= ?id group) (= selected true)]

         ;; Or this
         [:group [[id _ item-id]] (= ?id id) (= item-id ?item-id)]
         [:item [[item-id selected]] (= ?item-id item-id) (= selected true)]
         =&gt;
         (insert! ^{:type :select} [?id]))
</pre><span>
(sorry for big example)
(yes, I know how to do it with 2 rules.)
(I dont care with duplicate entries)</span></div><div id="t1492122559657482" t="2017-04-13 22:29:19 wparker @souenzzo Would something like [:or [:group …] [:and {:group ..] [:item]] meet your needs?  There are some docs at  http://www.clara-rules.org/docs/booleans"><a href="#t1492122559657482" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-04-13</span> <span class="t" onclick="H(this)">22:29:19</span>                 wparker </span><span>@souenzzo Would something like [:or [:group …] [:and {:group ..] [:item]] meet your needs?  There are some docs at </span><a href="http://www.clara-rules.org/docs/booleans" target="_blank">http://www.clara-rules.org/docs/booleans</a></div><div id="t1492651690426654" t="2017-04-20 01:28:10 devn @wparker thanks for session-&gt;fact-graph"><a href="#t1492651690426654" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-04-20</span> <span class="t" onclick="H(this)">01:28:10</span>                    devn </span><span>@wparker thanks for session-&gt;fact-graph</span></div><div id="t1492651703428374" t="2017-04-20 01:28:23 devn i&apos;m pretty excited about that change"><a href="#t1492651703428374" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-04-20</span> <span class="t" onclick="H(this)">01:28:23</span>                    devn </span><span>i&apos;m pretty excited about that change</span></div><div id="t1492697945931464" t="2017-04-20 14:19:05 zylox same"><a href="#t1492697945931464" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-04-20</span> <span class="t" onclick="H(this)">14:19:05</span>                   zylox </span><span>same</span></div><div id="t1492701546396461" t="2017-04-20 15:19:06 alex-dixon Haven&apos;t made time to try it yet  😕"><a href="#t1492701546396461" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-04-20</span> <span class="t" onclick="H(this)">15:19:06</span>              alex-dixon </span><span>Haven&apos;t made time to try it yet </span><b>😕</b></div><div id="t1492702786908674" t="2017-04-20 15:39:46 mac @devn I musty be missing something, which commit contains  session-&gt;fact-graph  ?"><a href="#t1492702786908674" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-04-20</span> <span class="t" onclick="H(this)">15:39:46</span>                     mac </span><span>@devn I musty be missing something, which commit contains </span><pre>session-&gt;fact-graph</pre><span> ?</span></div><div id="t1492705377920078" t="2017-04-20 16:22:57 wparker @mac it isn’t in master yet.  https://github.com/cerner/clara-rules/pull/283"><a href="#t1492705377920078" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-04-20</span> <span class="t" onclick="H(this)">16:22:57</span>                 wparker </span><span>@mac it isn’t in master yet. </span><a href="https://github.com/cerner/clara-rules/pull/283" target="_blank">https://github.com/cerner/clara-rules/pull/283</a></div><div id="t1492705418934996" t="2017-04-20 16:23:38 mac @wparker Ah, got it. Thanks."><a href="#t1492705418934996" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-04-20</span> <span class="t" onclick="H(this)">16:23:38</span>                     mac </span><span>@wparker Ah, got it. Thanks.</span></div><div id="t1492705582993997" t="2017-04-20 16:26:22 wparker glad to hear it could be useful for others as well.  I’d be interested to hear about experiences with it or any tools, visualizations, etc. anyone comes up with and wants to share"><a href="#t1492705582993997" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-04-20</span> <span class="t" onclick="H(this)">16:26:22</span>                 wparker </span><span>glad to hear it could be useful for others as well.  I’d be interested to hear about experiences with it or any tools, visualizations, etc. anyone comes up with and wants to share</span></div><div id="t1492705730048922" t="2017-04-20 16:28:50 wparker for the use-case I had in mind I’ll probably be looking at ways to show particular parts of the graph since the session is so large that showing the entire graph would be an information overload"><a href="#t1492705730048922" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-04-20</span> <span class="t" onclick="H(this)">16:28:50</span>                 wparker </span><span>for the use-case I had in mind I’ll probably be looking at ways to show particular parts of the graph since the session is so large that showing the entire graph would be an information overload</span></div><div id="t1492804555406206" t="2017-04-21 19:55:55 devn @wparker we built something hackish to build graphviz, and for the entire session the graph was way too big to be useful"><a href="#t1492804555406206" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-04-21</span> <span class="t" onclick="H(this)">19:55:55</span>                    devn </span><span>@wparker we built something hackish to build graphviz, and for the entire session the graph was way too big to be useful</span></div><div id="t1492804580412950" t="2017-04-21 19:56:20 devn then there was an attempt at using cytoscape.js to make it traversable"><a href="#t1492804580412950" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-04-21</span> <span class="t" onclick="H(this)">19:56:20</span>                    devn </span><span>then there was an attempt at using cytoscape.js to make it traversable</span></div><div id="t1492804586414862" t="2017-04-21 19:56:26 devn so you could see a few nodes away from YOU ARE HERE"><a href="#t1492804586414862" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-04-21</span> <span class="t" onclick="H(this)">19:56:26</span>                    devn </span><span>so you could see a few nodes away from YOU ARE HERE</span></div><div id="t1492804658435427" t="2017-04-21 19:57:38 devn what i found myself wanting was a way to define views over the graph, like, i may not care about all the edges and nodes between Node A and Node B, so I&apos;d like to define a view that shows me Node A -&gt; Node B without all of the intermediate steps"><a href="#t1492804658435427" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-04-21</span> <span class="t" onclick="H(this)">19:57:38</span>                    devn </span><span>what i found myself wanting was a way to define views over the graph, like, i may not care about all the edges and nodes between Node A and Node B, so I&apos;d like to define a view that shows me Node A -&gt; Node B without all of the intermediate steps</span></div><div id="t1492804813480866" t="2017-04-21 20:00:13 devn I imagine having something like:

 (def views {:everything [FactA FactB ...], :simple [FactA FactC FactF]})"><a href="#t1492804813480866" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-04-21</span> <span class="t" onclick="H(this)">20:00:13</span>                    devn </span><span>I imagine having something like:

</span><code>(def views {:everything [FactA FactB ...], :simple [FactA FactC FactF]})</code></div><div id="t1492804874499666" t="2017-04-21 20:01:14 devn :simple  automatically collapses nodes and edges along the path of A-&gt;C-&gt;F"><a href="#t1492804874499666" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-04-21</span> <span class="t" onclick="H(this)">20:01:14</span>                    devn </span><code>:simple</code><span> automatically collapses nodes and edges along the path of A-&gt;C-&gt;F</span></div><div id="t1492804958525590" t="2017-04-21 20:02:38 devn @wparker another thing that I think would be nice would be to generate a static graph"><a href="#t1492804958525590" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-04-21</span> <span class="t" onclick="H(this)">20:02:38</span>                    devn </span><span>@wparker another thing that I think would be nice would be to generate a static graph</span></div><div id="t1492805013541401" t="2017-04-21 20:03:33 devn of all the facts in the project, regardless of whether they are ever used"><a href="#t1492805013541401" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-04-21</span> <span class="t" onclick="H(this)">20:03:33</span>                    devn </span><span>of all the facts in the project, regardless of whether they are ever used</span></div><div id="t1492805054552652" t="2017-04-21 20:04:14 devn but maybe your PR achieves this?"><a href="#t1492805054552652" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-04-21</span> <span class="t" onclick="H(this)">20:04:14</span>                    devn </span><span>but maybe your PR achieves this?</span></div><div id="t1492805111569034" t="2017-04-21 20:05:11 devn what we built relied on the data returned from inspect, which IIRC required us to fire-rules"><a href="#t1492805111569034" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-04-21</span> <span class="t" onclick="H(this)">20:05:11</span>                    devn </span><span>what we built relied on the data returned from inspect, which IIRC required us to fire-rules</span></div><div id="t1492805167585402" t="2017-04-21 20:06:07 devn im interested in building the graph of all the relationships, not just the relationships that survive after running the rules"><a href="#t1492805167585402" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-04-21</span> <span class="t" onclick="H(this)">20:06:07</span>                    devn </span><span>im interested in building the graph of all the relationships, not just the relationships that survive after running the rules</span></div><div id="t1492805273614810" t="2017-04-21 20:07:53 wparker The graph would include all logical insertions regardless of whether they were used for anything, but unconditional/external insertions wouldn’t be if they weren’t used for anything"><a href="#t1492805273614810" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-04-21</span> <span class="t" onclick="H(this)">20:07:53</span>                 wparker </span><span>The graph would include all logical insertions regardless of whether they were used for anything, but unconditional/external insertions wouldn’t be if they weren’t used for anything</span></div><div id="t1492805295620480" t="2017-04-21 20:08:15 wparker Since Clara allows them to be garbage-collected if they aren’t used"><a href="#t1492805295620480" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-04-21</span> <span class="t" onclick="H(this)">20:08:15</span>                 wparker </span><span>Since Clara allows them to be garbage-collected if they aren’t used</span></div><div id="t1492805400649392" t="2017-04-21 20:10:00 wparker My general line of thinking here was to build a graph, and then"><a href="#t1492805400649392" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-04-21</span> <span class="t" onclick="H(this)">20:10:00</span>                 wparker </span><span>My general line of thinking here was to build a graph, and then</span></div><div id="t1492805443661344" t="2017-04-21 20:10:43 wparker provide functions to retrieve particular subsets of the graph, potentially modify it, etc."><a href="#t1492805443661344" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-04-21</span> <span class="t" onclick="H(this)">20:10:43</span>                 wparker </span><span>provide functions to retrieve particular subsets of the graph, potentially modify it, etc.</span></div><div id="t1492805503677564" t="2017-04-21 20:11:43 wparker and then look at how to display those views.  Basically have a data-oriented approach to the problem that different views could layer on top of"><a href="#t1492805503677564" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-04-21</span> <span class="t" onclick="H(this)">20:11:43</span>                 wparker </span><span>and then look at how to display those views.  Basically have a data-oriented approach to the problem that different views could layer on top of</span></div><div id="t1492805509679157" t="2017-04-21 20:11:49 zylox you can always reduce the data in a graph, thats the wonder of them"><a href="#t1492805509679157" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-04-21</span> <span class="t" onclick="H(this)">20:11:49</span>                   zylox </span><span>you can always reduce the data in a graph, thats the wonder of them</span></div><div id="t1492805549690414" t="2017-04-21 20:12:29 wparker In particular, in our case we’d probably want to combine fact graphs with some other indicators that our specific to our internal frameworks"><a href="#t1492805549690414" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-04-21</span> <span class="t" onclick="H(this)">20:12:29</span>                 wparker </span><span>In particular, in our case we’d probably want to combine fact graphs with some other indicators that our specific to our internal frameworks</span></div><div id="t1492805570696145" t="2017-04-21 20:12:50 wparker so I’m looking for composability"><a href="#t1492805570696145" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-04-21</span> <span class="t" onclick="H(this)">20:12:50</span>                 wparker </span><span>so I’m looking for composability</span></div><div id="t1492805635713273" t="2017-04-21 20:13:55 wparker I’m not clear on what :simple would be - do you mean that if you had A -&gt; B -&gt; C you’d have a direct edge of A -&gt; C?"><a href="#t1492805635713273" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-04-21</span> <span class="t" onclick="H(this)">20:13:55</span>                 wparker </span><span>I’m not clear on what :simple would be - do you mean that if you had A -&gt; B -&gt; C you’d have a direct edge of A -&gt; C?</span></div><div id="t1492805756747200" t="2017-04-21 20:15:56 wparker Also, @devn I’d be curious about why cytoscape.js versus any other graph visualization options you tried or considered - the visualization layer isn’t something I know much about yet"><a href="#t1492805756747200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-04-21</span> <span class="t" onclick="H(this)">20:15:56</span>                 wparker </span><span>Also, @devn I’d be curious about why cytoscape.js versus any other graph visualization options you tried or considered - the visualization layer isn’t something I know much about yet</span></div><div id="t1492808765562869" t="2017-04-21 21:06:05 devn @wparker I did not directly participate in the decision to use cytoscape, but as I recall it was chosen partly for performance, and partly because it made the traversal of subgraphs relatively easy."><a href="#t1492808765562869" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-04-21</span> <span class="t" onclick="H(this)">21:06:05</span>                    devn </span><span>@wparker I did not directly participate in the decision to use cytoscape, but as I recall it was chosen partly for performance, and partly because it made the traversal of subgraphs relatively easy.</span></div><div id="t1492808792569659" t="2017-04-21 21:06:32 devn @wparker RE: direct edge on A-&gt;C, yes, that was what I was thinking"><a href="#t1492808792569659" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-04-21</span> <span class="t" onclick="H(this)">21:06:32</span>                    devn </span><span>@wparker RE: direct edge on A-&gt;C, yes, that was what I was thinking</span></div><div id="t1492808847583551" t="2017-04-21 21:07:27 devn or perhaps you have A-&gt;[summary collection of intermediate nodes]-&gt;C"><a href="#t1492808847583551" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-04-21</span> <span class="t" onclick="H(this)">21:07:27</span>                    devn </span><span>or perhaps you have A-&gt;[summary collection of intermediate nodes]-&gt;C</span></div><div id="t1492808934604736" t="2017-04-21 21:08:54 devn basically anything to make it easy to skip the display of 382910 nodes and edges that don&apos;t actually tell you much that you care to know about getting from A to C"><a href="#t1492808934604736" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-04-21</span> <span class="t" onclick="H(this)">21:08:54</span>                    devn </span><span>basically anything to make it easy to skip the display of 382910 nodes and edges that don&apos;t actually tell you much that you care to know about getting from A to C</span></div><div id="t1492808977615147" t="2017-04-21 21:09:37 devn i think it&apos;s often the case that the fact that you got to C suggests everything you&apos;d need to understand about B"><a href="#t1492808977615147" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-04-21</span> <span class="t" onclick="H(this)">21:09:37</span>                    devn </span><span>i think it&apos;s often the case that the fact that you got to C suggests everything you&apos;d need to understand about B</span></div><div id="t1492809274685939" t="2017-04-21 21:14:34 devn for instance, there is a big fan out and fan in between A and C, like A-&gt;[B1, B2, B3, B4, B5, BN]-&gt;C

If C is a specific fact like: MoreThanThreeBs, then who really cares what those Bs were? all I really care about is that by virtue of A, I have the possibility of many Bs, and all I care to know is if I get to state C from A"><a href="#t1492809274685939" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-04-21</span> <span class="t" onclick="H(this)">21:14:34</span>                    devn </span><span>for instance, there is a big fan out and fan in between A and C, like A-&gt;[B1, B2, B3, B4, B5, BN]-&gt;C

If C is a specific fact like: MoreThanThreeBs, then who really cares what those Bs were? all I really care about is that by virtue of A, I have the possibility of many Bs, and all I care to know is if I get to state C from A</span></div><div id="t1492809715788008" t="2017-04-21 21:21:55 devn We have a lot of scenarios where we need to look at hundreds of thousands of facts on our way to a state, but in the end all we really care about is that given a Lab, we determine whether it is normal or abnormal according to a massive set of facts, and then produce an AbnormalLabResult or NormalLabResult. Labl-&gt;AbnormalLab/NormalLab is how I&apos;d prefer to view it in a UI rather than render the 500k+ nodes and corresponding edges in between"><a href="#t1492809715788008" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-04-21</span> <span class="t" onclick="H(this)">21:21:55</span>                    devn </span><span>We have a lot of scenarios where we need to look at hundreds of thousands of facts on our way to a state, but in the end all we really care about is that given a Lab, we determine whether it is normal or abnormal according to a massive set of facts, and then produce an AbnormalLabResult or NormalLabResult. Labl-&gt;AbnormalLab/NormalLab is how I&apos;d prefer to view it in a UI rather than render the 500k+ nodes and corresponding edges in between</span></div><div id="t1492809879824695" t="2017-04-21 21:24:39 devn being able to express something like: &quot;Provided #{A}, render direct edges to #{C, D} through nodes of type #{B}&quot; would be nice"><a href="#t1492809879824695" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-04-21</span> <span class="t" onclick="H(this)">21:24:39</span>                    devn </span><span>being able to express something like: &quot;Provided #{A}, render direct edges to #{C, D} through nodes of type #{B}&quot; would be nice</span></div><div id="t1492810063864953" t="2017-04-21 21:27:43 devn Stop me if what I&apos;m saying doesn&apos;t make any sense"><a href="#t1492810063864953" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-04-21</span> <span class="t" onclick="H(this)">21:27:43</span>                    devn </span><span>Stop me if what I&apos;m saying doesn&apos;t make any sense</span></div><div id="t1492810160886416" t="2017-04-21 21:29:20 devn I suppose I imagine that for any collection of rules and facts, there are layers to the view. For instance, I don&apos;t care about seeing the source of a rule by default, that&apos;s another layer. Similarly, I don&apos;t care which specific constraints in that rule were met, unless I do."><a href="#t1492810160886416" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-04-21</span> <span class="t" onclick="H(this)">21:29:20</span>                    devn </span><span>I suppose I imagine that for any collection of rules and facts, there are layers to the view. For instance, I don&apos;t care about seeing the source of a rule by default, that&apos;s another layer. Similarly, I don&apos;t care which specific constraints in that rule were met, unless I do.</span></div><div id="t1492810212897765" t="2017-04-21 21:30:12 wparker I can see where that would be useful for some rules patterns, yes.  I’m thinking that it probably wouldn’t be too hard to transform the graph down to that level though?"><a href="#t1492810212897765" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-04-21</span> <span class="t" onclick="H(this)">21:30:12</span>                 wparker </span><span>I can see where that would be useful for some rules patterns, yes.  I’m thinking that it probably wouldn’t be too hard to transform the graph down to that level though?</span></div><div id="t1492810229901814" t="2017-04-21 21:30:29 devn @wparker no, sure, that&apos;s doable"><a href="#t1492810229901814" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-04-21</span> <span class="t" onclick="H(this)">21:30:29</span>                    devn </span><span>@wparker no, sure, that&apos;s doable</span></div><div id="t1492810251906682" t="2017-04-21 21:30:51 devn I&apos;m just listing stuff that I don&apos;t think would be totally out of bounds for clara.tools.*"><a href="#t1492810251906682" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-04-21</span> <span class="t" onclick="H(this)">21:30:51</span>                    devn </span><span>I&apos;m just listing stuff that I don&apos;t think would be totally out of bounds for clara.tools.*</span></div><div id="t1492810261908826" t="2017-04-21 21:31:01 wparker Ah, I see"><a href="#t1492810261908826" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-04-21</span> <span class="t" onclick="H(this)">21:31:01</span>                 wparker </span><span>Ah, I see</span></div><div id="t1492810314920405" t="2017-04-21 21:31:54 wparker By the way, I think having transformation functions in the fact-graph namespace could be useful, I just haven’t gotten to that point yet"><a href="#t1492810314920405" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-04-21</span> <span class="t" onclick="H(this)">21:31:54</span>                 wparker </span><span>By the way, I think having transformation functions in the fact-graph namespace could be useful, I just haven’t gotten to that point yet</span></div><div id="t1492810335925058" t="2017-04-21 21:32:15 devn I totally understand for instance, that if you have the raw data, you can do whatever you please, but it would be really nice to not leave that as an exercise for the reader, and instead have a couple of basic built-in tools for specifying what you want to look at"><a href="#t1492810335925058" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-04-21</span> <span class="t" onclick="H(this)">21:32:15</span>                    devn </span><span>I totally understand for instance, that if you have the raw data, you can do whatever you please, but it would be really nice to not leave that as an exercise for the reader, and instead have a couple of basic built-in tools for specifying what you want to look at</span></div><div id="t1492810344927150" t="2017-04-21 21:32:24 wparker or other namespace as appropriate as you say “clara.tools.*”"><a href="#t1492810344927150" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-04-21</span> <span class="t" onclick="H(this)">21:32:24</span>                 wparker </span><span>or other namespace as appropriate as you say “clara.tools.*”</span></div><div id="t1492810411942110" t="2017-04-21 21:33:31 devn Like, a function which dumps graphviz, even if there is no dependency within clara to actually render it, seems like it might be useful"><a href="#t1492810411942110" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-04-21</span> <span class="t" onclick="H(this)">21:33:31</span>                    devn </span><span>Like, a function which dumps graphviz, even if there is no dependency within clara to actually render it, seems like it might be useful</span></div><div id="t1492810482957199" t="2017-04-21 21:34:42 devn and then adding on to that: Dumps graphviz where you specify the starting node (the type of fact), and how many hops should be rendered"><a href="#t1492810482957199" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-04-21</span> <span class="t" onclick="H(this)">21:34:42</span>                    devn </span><span>and then adding on to that: Dumps graphviz where you specify the starting node (the type of fact), and how many hops should be rendered</span></div><div id="t1492810522965515" t="2017-04-21 21:35:22 devn or: Dumps graphviz, and lets you set the color for nodes based on their fact type"><a href="#t1492810522965515" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-04-21</span> <span class="t" onclick="H(this)">21:35:22</span>                    devn </span><span>or: Dumps graphviz, and lets you set the color for nodes based on their fact type</span></div><div id="t1492810524966057" t="2017-04-21 21:35:24 devn etc."><a href="#t1492810524966057" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-04-21</span> <span class="t" onclick="H(this)">21:35:24</span>                    devn </span><span>etc.</span></div><div id="t1492810536968643" t="2017-04-21 21:35:36 wparker For that, I’m thinking you’d do something like (-&gt; original-graph remove-intermediate-steps render-to-graphviz)"><a href="#t1492810536968643" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-04-21</span> <span class="t" onclick="H(this)">21:35:36</span>                 wparker </span><span>For that, I’m thinking you’d do something like (-&gt; original-graph remove-intermediate-steps render-to-graphviz)</span></div><div id="t1492810572975974" t="2017-04-21 21:36:12 devn sure, yeah"><a href="#t1492810572975974" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-04-21</span> <span class="t" onclick="H(this)">21:36:12</span>                    devn </span><span>sure, yeah</span></div><div id="t1492810688000242" t="2017-04-21 21:38:08 devn It would be interesting to generate some anonymized graphs for all of our projects just to get a sense for what transformation functions would be generally useful"><a href="#t1492810688000242" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-04-21</span> <span class="t" onclick="H(this)">21:38:08</span>                    devn </span><span>It would be interesting to generate some anonymized graphs for all of our projects just to get a sense for what transformation functions would be generally useful</span></div><div id="t1492810808025647" t="2017-04-21 21:40:08 devn I know there are Reasons™ to not include the transformation kitchen sink or unnecessary deps, but I feel like a simple toolkit for rules engine graph generation would be super helpful to have, maybe even as part of core"><a href="#t1492810808025647" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-04-21</span> <span class="t" onclick="H(this)">21:40:08</span>                    devn </span><span>I know there are Reasons™ to not include the transformation kitchen sink or unnecessary deps, but I feel like a simple toolkit for rules engine graph generation would be super helpful to have, maybe even as part of core</span></div><div id="t1492810860036711" t="2017-04-21 21:41:00 devn as opposed to an external lib"><a href="#t1492810860036711" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-04-21</span> <span class="t" onclick="H(this)">21:41:00</span>                    devn </span><span>as opposed to an external lib</span></div><div id="t1492811566178907" t="2017-04-21 21:52:46 wparker Yeah, there is often a tradeoff of not tying things together too much versus not providing enough functionality especially if you get into needing other libraries as dependencies.  Adding generic data transforms doesn’t seem like it adds too much burden though since it is very easily ignorable if you don’t need them"><a href="#t1492811566178907" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-04-21</span> <span class="t" onclick="H(this)">21:52:46</span>                 wparker </span><span>Yeah, there is often a tradeoff of not tying things together too much versus not providing enough functionality especially if you get into needing other libraries as dependencies.  Adding generic data transforms doesn’t seem like it adds too much burden though since it is very easily ignorable if you don’t need them</span></div><div id="t1492811740212703" t="2017-04-21 21:55:40 wparker I’m guessing the types of transforms needed will depend heavily on the domain.  For example, in our case, I think a lot of it would revolve around taking a given fact and showing everything either upstream or downstream from that fact, and potentially “backtracking” a bit from some joins on that path, but not the rest of the rules session"><a href="#t1492811740212703" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-04-21</span> <span class="t" onclick="H(this)">21:55:40</span>                 wparker </span><span>I’m guessing the types of transforms needed will depend heavily on the domain.  For example, in our case, I think a lot of it would revolve around taking a given fact and showing everything either upstream or downstream from that fact, and potentially “backtracking” a bit from some joins on that path, but not the rest of the rules session</span></div><div id="t1492811821228564" t="2017-04-21 21:57:01 wparker If you have a fact A that flows through rules B-&gt;C-&gt;D-&gt;E-&gt;F and you don’t get the expected F it would be nice to be able to easily see where it “stopped”"><a href="#t1492811821228564" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-04-21</span> <span class="t" onclick="H(this)">21:57:01</span>                 wparker </span><span>If you have a fact A that flows through rules B-&gt;C-&gt;D-&gt;E-&gt;F and you don’t get the expected F it would be nice to be able to easily see where it “stopped”</span></div><div id="t1492811862236886" t="2017-04-21 21:57:42 wparker or in the case of accumulation how it interacted with other facts in that chain"><a href="#t1492811862236886" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-04-21</span> <span class="t" onclick="H(this)">21:57:42</span>                 wparker </span><span>or in the case of accumulation how it interacted with other facts in that chain</span></div><div id="t1492812180299073" t="2017-04-21 22:03:00 wparker The first step is to make the full data set available for manipulation though"><a href="#t1492812180299073" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-04-21</span> <span class="t" onclick="H(this)">22:03:00</span>                 wparker </span><span>The first step is to make the full data set available for manipulation though</span></div><div id="t1492812205303751" t="2017-04-21 22:03:25 wparker You could get most of it from inspect already but not when you go through accumulators"><a href="#t1492812205303751" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-04-21</span> <span class="t" onclick="H(this)">22:03:25</span>                 wparker </span><span>You could get most of it from inspect already but not when you go through accumulators</span></div><div id="t1492812217305809" t="2017-04-21 22:03:37 wparker which we use a lot of"><a href="#t1492812217305809" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-04-21</span> <span class="t" onclick="H(this)">22:03:37</span>                 wparker </span><span>which we use a lot of</span></div><div id="t1493368597644444" t="2017-04-28 08:36:37 puzzler How does the performance of Clara queries compare to something like Datascript?"><a href="#t1493368597644444" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-04-28</span> <span class="t" onclick="H(this)">08:36:37</span>                 puzzler </span><span>How does the performance of Clara queries compare to something like Datascript?</span></div><div id="t1493652784680755" t="2017-05-01 15:33:04 enn Can anyone suggest how I might instrument my rules to figure out which one is throwing an NPE?

The NPE is during  &gt;  during an accumulator’s reduction which makes me assume it’s the  max  accumulator, which I use in only a handful of rules. I’d like to narrow down which specifically is throwing the exception, but I’m not sure how I’d go about putting logging in the LHS of a rule. (The RHS is too late as the accumulators are used only in LHSs.)"><a href="#t1493652784680755" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-05-01</span> <span class="t" onclick="H(this)">15:33:04</span>                     enn </span><span>Can anyone suggest how I might instrument my rules to figure out which one is throwing an NPE?

The NPE is during </span><code>&gt;</code><span> during an accumulator’s reduction which makes me assume it’s the </span><code>max</code><span> accumulator, which I use in only a handful of rules. I’d like to narrow down which specifically is throwing the exception, but I’m not sure how I’d go about putting logging in the LHS of a rule. (The RHS is too late as the accumulators are used only in LHSs.)</span></div><div id="t1493655187363575" t="2017-05-01 16:13:07 zylox do you have an example stack trace?"><a href="#t1493655187363575" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-05-01</span> <span class="t" onclick="H(this)">16:13:07</span>                   zylox </span><span>do you have an example stack trace?</span></div><div id="t1493655433431449" t="2017-05-01 16:17:13 enn yes:"><a href="#t1493655433431449" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-05-01</span> <span class="t" onclick="H(this)">16:17:13</span>                     enn </span><span>yes:</span></div><div id="t1493655545461092" t="2017-05-01 16:19:05 enn @zylox  http://paste.lisp.org/display/345606"><a href="#t1493655545461092" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-05-01</span> <span class="t" onclick="H(this)">16:19:05</span>                     enn </span><span>@zylox </span><a href="http://paste.lisp.org/display/345606" target="_blank">http://paste.lisp.org/display/345606</a></div><div id="t1493657224928723" t="2017-05-01 16:47:04 zylox ya i got nothing unfortunately.  https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/tools/tracing.clj  might be of some help"><a href="#t1493657224928723" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-05-01</span> <span class="t" onclick="H(this)">16:47:04</span>                   zylox </span><span>ya i got nothing unfortunately. </span><a href="https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/tools/tracing.clj" target="_blank">https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/tools/tracing.clj</a><span> might be of some help</span></div><div id="t1493659734669994" t="2017-05-01 17:28:54 wparker @enn unfortunately errors during accumulation aren’t handled as well as errors in non-accumulator conditions;  https://github.com/cerner/clara-rules/issues/265  is logged to improve that (non-accumulator conditions were improved in  https://github.com/cerner/clara-rules/issues/255  )"><a href="#t1493659734669994" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-05-01</span> <span class="t" onclick="H(this)">17:28:54</span>                 wparker </span><span>@enn unfortunately errors during accumulation aren’t handled as well as errors in non-accumulator conditions; </span><a href="https://github.com/cerner/clara-rules/issues/265" target="_blank">https://github.com/cerner/clara-rules/issues/265</a><span> is logged to improve that (non-accumulator conditions were improved in </span><a href="https://github.com/cerner/clara-rules/issues/255" target="_blank">https://github.com/cerner/clara-rules/issues/255</a><span> )</span></div><div id="t1493659788686924" t="2017-05-01 17:29:48 wparker In the meantime your best option is probably to wrap the accumulator in question in a way that indicates what rules you’re in when it throw an exception"><a href="#t1493659788686924" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-05-01</span> <span class="t" onclick="H(this)">17:29:48</span>                 wparker </span><span>In the meantime your best option is probably to wrap the accumulator in question in a way that indicates what rules you’re in when it throw an exception</span></div><div id="t1493659845704991" t="2017-05-01 17:30:45 wparker Clara accumulators are just maps containing functions, and the accumulator can be modified by adding a new value onto one of the keys"><a href="#t1493659845704991" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-05-01</span> <span class="t" onclick="H(this)">17:30:45</span>                 wparker </span><span>Clara accumulators are just maps containing functions, and the accumulator can be modified by adding a new value onto one of the keys</span></div><div id="t1493659863710823" t="2017-05-01 17:31:03 wparker Your stacktrace tells me you’re throwing in the reduce-fn"><a href="#t1493659863710823" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-05-01</span> <span class="t" onclick="H(this)">17:31:03</span>                 wparker </span><span>Your stacktrace tells me you’re throwing in the reduce-fn</span></div><div id="t1493659988749348" t="2017-05-01 17:33:08 wparker So you could do something like (defn -&gt;wrapped-reduce-fn [original-reduce-fn rule-name] (fn [&amp; args] (try (apply original-reduce-fn args) (catch Exception e (throw (ex-info (str “Threw exception in accumulation in ” rule-name) {} e))))"><a href="#t1493659988749348" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-05-01</span> <span class="t" onclick="H(this)">17:33:08</span>                 wparker </span><span>So you could do something like (defn -&gt;wrapped-reduce-fn [original-reduce-fn rule-name] (fn [&amp; args] (try (apply original-reduce-fn args) (catch Exception e (throw (ex-info (str “Threw exception in accumulation in ” rule-name) {} e))))</span></div><div id="t1493660074775418" t="2017-05-01 17:34:34 wparker and (defrule [?result-binding &lt;- (update (acc/min :field) :reduce-fn -&gt;wrapped-reduce-fn rule-name) …"><a href="#t1493660074775418" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-05-01</span> <span class="t" onclick="H(this)">17:34:34</span>                 wparker </span><span>and (defrule [?result-binding &lt;- (update (acc/min :field) :reduce-fn -&gt;wrapped-reduce-fn rule-name) …</span></div><div id="t1493660127791507" t="2017-05-01 17:35:27 wparker actually to work with the update you’d need to reverse the args order of -&gt;wrapped-reduce-fn, but that is the basic idea"><a href="#t1493660127791507" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-05-01</span> <span class="t" onclick="H(this)">17:35:27</span>                 wparker </span><span>actually to work with the update you’d need to reverse the args order of -&gt;wrapped-reduce-fn, but that is the basic idea</span></div><div id="t1493660232823280" t="2017-05-01 17:37:12 wparker The problem with tracing is that when you throw an exception and exit the rules firing loop you’ll lose the transient listener that has the info you want"><a href="#t1493660232823280" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-05-01</span> <span class="t" onclick="H(this)">17:37:12</span>                 wparker </span><span>The problem with tracing is that when you throw an exception and exit the rules firing loop you’ll lose the transient listener that has the info you want</span></div><div id="t1493660261831540" t="2017-05-01 17:37:41 wparker When a RHS exception is thrown we call to-persistent on the listeners but that won’t happen in an exception during accumulation  https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/rules/engine.cljc#L1787"><a href="#t1493660261831540" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-05-01</span> <span class="t" onclick="H(this)">17:37:41</span>                 wparker </span><span>When a RHS exception is thrown we call to-persistent on the listeners but that won’t happen in an exception during accumulation </span><a href="https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/rules/engine.cljc#L1787" target="_blank">https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/rules/engine.cljc#L1787</a></div><div id="t1493660297843044" t="2017-05-01 17:38:17 wparker You could write your own listener that had global side effects or some such to get around that if you wanted though"><a href="#t1493660297843044" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-05-01</span> <span class="t" onclick="H(this)">17:38:17</span>                 wparker </span><span>You could write your own listener that had global side effects or some such to get around that if you wanted though</span></div><div id="t1493660496904501" t="2017-05-01 17:41:36 wparker There are some docs on what the different accum function fields do at  http://www.clara-rules.org/docs/accumulators/ , you can also look at the structures created at  https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/rules/accumulators.cljc"><a href="#t1493660496904501" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-05-01</span> <span class="t" onclick="H(this)">17:41:36</span>                 wparker </span><span>There are some docs on what the different accum function fields do at </span><a href="http://www.clara-rules.org/docs/accumulators/" target="_blank">http://www.clara-rules.org/docs/accumulators/</a><span>, you can also look at the structures created at </span><a href="https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/rules/accumulators.cljc" target="_blank">https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/rules/accumulators.cljc</a></div><div id="t1493661017068622" t="2017-05-01 17:50:17 enn Thank you, the wrapping idea makes sense"><a href="#t1493661017068622" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-05-01</span> <span class="t" onclick="H(this)">17:50:17</span>                     enn </span><span>Thank you, the wrapping idea makes sense</span></div><div id="t1493661129104985" t="2017-05-01 17:52:09 enn though a little clunky as we are not specifying the reduce-fn directly (it’s created via  acc/max  and  comparison-based )"><a href="#t1493661129104985" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-05-01</span> <span class="t" onclick="H(this)">17:52:09</span>                     enn </span><span>though a little clunky as we are not specifying the reduce-fn directly (it’s created via </span><code>acc/max</code><span> and </span><code>comparison-based</code><span>)</span></div><div id="t1493661796326021" t="2017-05-01 18:03:16 wparker Yeah, it is clunky, but hopefully if you have just a handful of rules and a particular exception it won’t be too bad.  Obviously not as nice as having built-in error handling i.e. issue 265 but hopefully solves your immediate need"><a href="#t1493661796326021" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-05-01</span> <span class="t" onclick="H(this)">18:03:16</span>                 wparker </span><span>Yeah, it is clunky, but hopefully if you have just a handful of rules and a particular exception it won’t be too bad.  Obviously not as nice as having built-in error handling i.e. issue 265 but hopefully solves your immediate need</span></div><div id="t1495136549516189" t="2017-05-18 19:42:29 wparker Clara-rules 0.15.0 is released and available on Clojars.  Highlights include a variety of improvements to session inspection, including functionality to create a graph data structure of facts to facts they caused to be logically inserted, and a fix to a memory leak that caused the memory to retain references to bindings from retracted facts in some cases."><a href="#t1495136549516189" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-05-18</span> <span class="t" onclick="H(this)">19:42:29</span>                 wparker </span><span>Clara-rules 0.15.0 is released and available on Clojars.  Highlights include a variety of improvements to session inspection, including functionality to create a graph data structure of facts to facts they caused to be logically inserted, and a fix to a memory leak that caused the memory to retain references to bindings from retracted facts in some cases.</span></div><div id="t1495136585526693" t="2017-05-18 19:43:05 zylox 🎊"><a href="#t1495136585526693" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-05-18</span> <span class="t" onclick="H(this)">19:43:05</span>                   zylox </span><b>🎊</b></div><div id="t1495136811601833" t="2017-05-18 19:46:51 wparker The changelog has further details on the changes:  https://github.com/cerner/clara-rules/blob/master/CHANGELOG.md"><a href="#t1495136811601833" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-05-18</span> <span class="t" onclick="H(this)">19:46:51</span>                 wparker </span><span>The changelog has further details on the changes: </span><a href="https://github.com/cerner/clara-rules/blob/master/CHANGELOG.md" target="_blank">https://github.com/cerner/clara-rules/blob/master/CHANGELOG.md</a></div><div id="t1495137532842240" t="2017-05-18 19:58:52 ryanbrush Awesome, Will!"><a href="#t1495137532842240" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-05-18</span> <span class="t" onclick="H(this)">19:58:52</span>               ryanbrush </span><span>Awesome, Will!</span></div><div id="t1495512297552482" t="2017-05-23 04:04:57 devn @wparker thank you for all of your work."><a href="#t1495512297552482" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-05-23</span> <span class="t" onclick="H(this)">04:04:57</span>                    devn </span><span>@wparker thank you for all of your work.</span></div><div id="t1495512305553439" t="2017-05-23 04:05:05 devn You&apos;ve made my job easier."><a href="#t1495512305553439" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-05-23</span> <span class="t" onclick="H(this)">04:05:05</span>                    devn </span><span>You&apos;ve made my job easier.</span></div><div id="t1495621962164393" t="2017-05-24 10:32:42 nkabrich can anyone recommend a good tool/library to visualize the output of  clara.tools.fact-graph/session-&gt;fact-graph ?"><a href="#t1495621962164393" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-05-24</span> <span class="t" onclick="H(this)">10:32:42</span>                nkabrich </span><span>can anyone recommend a good tool/library to visualize the output of </span><code>clara.tools.fact-graph/session-&gt;fact-graph</code><span>?</span></div><div id="t1495630053905265" t="2017-05-24 12:47:33 skuro rhizome?"><a href="#t1495630053905265" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-05-24</span> <span class="t" onclick="H(this)">12:47:33</span>                   skuro </span><span>rhizome?</span></div><div id="t1495630082912824" t="2017-05-24 12:48:02 skuro https://github.com/ztellman/rhizome"><a href="#t1495630082912824" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-05-24</span> <span class="t" onclick="H(this)">12:48:02</span>                   skuro </span><a href="https://github.com/ztellman/rhizome" target="_blank">https://github.com/ztellman/rhizome</a></div><div id="t1495790307695996" t="2017-05-26 09:18:27 puzzler Can someone point me to documentation about how to construct clara rules dynamically?"><a href="#t1495790307695996" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-05-26</span> <span class="t" onclick="H(this)">09:18:27</span>                 puzzler </span><span>Can someone point me to documentation about how to construct clara rules dynamically?</span></div><div id="t1495796525880947" t="2017-05-26 11:02:05 nkabrich AFAIK  defrule  just generates a data structure so you can either build that by hand dynamically or check out  clara.rules.dsl/parse-rule"><a href="#t1495796525880947" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-05-26</span> <span class="t" onclick="H(this)">11:02:05</span>                nkabrich </span><span>AFAIK </span><code>defrule</code><span> just generates a data structure so you can either build that by hand dynamically or check out </span><code>clara.rules.dsl/parse-rule</code></div><div id="t1495807985499776" t="2017-05-26 14:13:05 wparker @puzzler There are a number of examples of dynamic rule creation in  https://github.com/cerner/clara-rules/blob/master/src/test/clojure/clara/test_rules.clj   You can also just build the rule data structures yourself if that is more convenient for your use-case; see the schema at  https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/rules/schema.clj#L62"><a href="#t1495807985499776" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-05-26</span> <span class="t" onclick="H(this)">14:13:05</span>                 wparker </span><span>@puzzler There are a number of examples of dynamic rule creation in </span><a href="https://github.com/cerner/clara-rules/blob/master/src/test/clojure/clara/test_rules.clj" target="_blank">https://github.com/cerner/clara-rules/blob/master/src/test/clojure/clara/test_rules.clj</a><span>  You can also just build the rule data structures yourself if that is more convenient for your use-case; see the schema at </span><a href="https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/rules/schema.clj#L62" target="_blank">https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/rules/schema.clj#L62</a></div><div id="t1495808194568288" t="2017-05-26 14:16:34 wparker You’ll need to fully qualify reference in your LHS (left-hand side) code if you use that approach, although in the RHS code it will evaluated in the ns you give if you give one as noted in the comment on the schema; that would be good to do in the LHS too, it just hasn’t been implemented yet"><a href="#t1495808194568288" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-05-26</span> <span class="t" onclick="H(this)">14:16:34</span>                 wparker </span><span>You’ll need to fully qualify reference in your LHS (left-hand side) code if you use that approach, although in the RHS code it will evaluated in the ns you give if you give one as noted in the comment on the schema; that would be good to do in the LHS too, it just hasn’t been implemented yet</span></div><div id="t1495809613053548" t="2017-05-26 14:40:13 ryanbrush There is also an example of generating rules from an external DSL on this blog post. Towards the bottom you&apos;ll see the Clojure data structure that defines the rules themselves.  http://www.toomuchcode.org/blog/2015/11/14/insta-declarative-dsls/"><a href="#t1495809613053548" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-05-26</span> <span class="t" onclick="H(this)">14:40:13</span>               ryanbrush </span><span>There is also an example of generating rules from an external DSL on this blog post. Towards the bottom you&apos;ll see the Clojure data structure that defines the rules themselves. </span><a href="http://www.toomuchcode.org/blog/2015/11/14/insta-declarative-dsls/" target="_blank">http://www.toomuchcode.org/blog/2015/11/14/insta-declarative-dsls/</a></div><div id="t1495809669072974" t="2017-05-26 14:41:09 ryanbrush But often just writing defrule for your rules, then looking at the data structure it creates can give you a good idea of what you need, as @nkabrich suggests."><a href="#t1495809669072974" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-05-26</span> <span class="t" onclick="H(this)">14:41:09</span>               ryanbrush </span><span>But often just writing defrule for your rules, then looking at the data structure it creates can give you a good idea of what you need, as @nkabrich suggests.</span></div><div id="t1495911342805072" t="2017-05-27 18:55:42 newres oh wow I was just about to ask about dynamic rule creation"><a href="#t1495911342805072" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-05-27</span> <span class="t" onclick="H(this)">18:55:42</span>                  newres </span><span>oh wow I was just about to ask about dynamic rule creation</span></div><div id="t1495911422809526" t="2017-05-27 18:57:02 newres The issue I have would be that the list of conditions in the lhs (and some part of the rhs) would be based on the elements of a list that is bound with a condition"><a href="#t1495911422809526" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-05-27</span> <span class="t" onclick="H(this)">18:57:02</span>                  newres </span><span>The issue I have would be that the list of conditions in the lhs (and some part of the rhs) would be based on the elements of a list that is bound with a condition</span></div><div id="t1495911513814492" t="2017-05-27 18:58:33 newres The problem is I can not seem to express it right with defrule nor the underlying code datastructure"><a href="#t1495911513814492" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-05-27</span> <span class="t" onclick="H(this)">18:58:33</span>                  newres </span><span>The problem is I can not seem to express it right with defrule nor the underlying code datastructure</span></div><div id="t1495911826834559" t="2017-05-27 19:03:46 newres I might be stepping too much over what the rete network does so it might be slow, but if nothing else there should be a way to look into the underying knowledge base for a set of checks the very least based on which I could bind a variable on the right hand side"><a href="#t1495911826834559" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-05-27</span> <span class="t" onclick="H(this)">19:03:46</span>                  newres </span><span>I might be stepping too much over what the rete network does so it might be slow, but if nothing else there should be a way to look into the underying knowledge base for a set of checks the very least based on which I could bind a variable on the right hand side</span></div><div id="t1495911890838314" t="2017-05-27 19:04:50 newres but this seems like internal stuff to clara the very least"><a href="#t1495911890838314" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-05-27</span> <span class="t" onclick="H(this)">19:04:50</span>                  newres </span><span>but this seems like internal stuff to clara the very least</span></div><div id="t1495913386922220" t="2017-05-27 19:29:46 newres was thinking maybe having a test expression that uses a functon and perhaps some internal way of peering into the current knowledge base, based on which it would return variables"><a href="#t1495913386922220" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-05-27</span> <span class="t" onclick="H(this)">19:29:46</span>                  newres </span><span>was thinking maybe having a test expression that uses a functon and perhaps some internal way of peering into the current knowledge base, based on which it would return variables</span></div><div id="t1495914239968707" t="2017-05-27 19:43:59 ryanbrush @newres I&apos;m not sure I entirely follow your use case, but it seems possible in principle with some of the rule generation patterns described above. However, I&apos;m not sure I&apos;d suggest that approach if you can avoid it. It might be better to, for example, put the needed data in some structure on the left-hand side, and bind the entire structure to a variable...and then de-structure that variable on the right-hand side to get the nested structure out."><a href="#t1495914239968707" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-05-27</span> <span class="t" onclick="H(this)">19:43:59</span>               ryanbrush </span><span>@newres I&apos;m not sure I entirely follow your use case, but it seems possible in principle with some of the rule generation patterns described above. However, I&apos;m not sure I&apos;d suggest that approach if you can avoid it. It might be better to, for example, put the needed data in some structure on the left-hand side, and bind the entire structure to a variable...and then de-structure that variable on the right-hand side to get the nested structure out.</span></div><div id="t1495914755998097" t="2017-05-27 19:52:35 newres @ryanbrush The problem I would have in binding everything and move it to the right hand side is that in the current implementation I need to use the conclusion in the guard."><a href="#t1495914755998097" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-05-27</span> <span class="t" onclick="H(this)">19:52:35</span>                  newres </span><span>@ryanbrush The problem I would have in binding everything and move it to the right hand side is that in the current implementation I need to use the conclusion in the guard.</span></div><div id="t1495915005011214" t="2017-05-27 19:56:45 newres @ryanbrush  is there a way on the lhs to reach into the current knowledge base with an expression, without resorting to unification and bindings? Basically with regular programming with some datastructure as a knowledge base the problem is pretty easily solvable, I would not mind skipping any optimizations clara provides just in a few cases."><a href="#t1495915005011214" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-05-27</span> <span class="t" onclick="H(this)">19:56:45</span>                  newres </span><span>@ryanbrush  is there a way on the lhs to reach into the current knowledge base with an expression, without resorting to unification and bindings? Basically with regular programming with some datastructure as a knowledge base the problem is pretty easily solvable, I would not mind skipping any optimizations clara provides just in a few cases.</span></div><div id="t1495915254025919" t="2017-05-27 20:00:54 newres @ryanbrush to describe the problem I have a bit better, suppose I have bound a list to the variable ?L. Based on this list I need to check x number of conditions where x is the length of that list and the conditions vary based the the list elements."><a href="#t1495915254025919" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-05-27</span> <span class="t" onclick="H(this)">20:00:54</span>                  newres </span><span>@ryanbrush to describe the problem I have a bit better, suppose I have bound a list to the variable ?L. Based on this list I need to check x number of conditions where x is the length of that list and the conditions vary based the the list elements.</span></div><div id="t1495915637048051" t="2017-05-27 20:07:17 ryanbrush The left hand side can only see the fact it is analyzing, and previously bound variables. Unfortunately there isn&apos;t a way to dynamically peek into the memory more than that...and there isn&apos;t a way to really make that visible that will be stable, either, since the order of evaluation of each rule constraint isn&apos;t defined, and we use a mutable structure underneath that can change at any time."><a href="#t1495915637048051" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-05-27</span> <span class="t" onclick="H(this)">20:07:17</span>               ryanbrush </span><span>The left hand side can only see the fact it is analyzing, and previously bound variables. Unfortunately there isn&apos;t a way to dynamically peek into the memory more than that...and there isn&apos;t a way to really make that visible that will be stable, either, since the order of evaluation of each rule constraint isn&apos;t defined, and we use a mutable structure underneath that can change at any time.</span></div><div id="t1495915712052175" t="2017-05-27 20:08:32 ryanbrush Generating rules ahead of creating the session can be done, but it&apos;s not clear whether that helps much. The visibility of the LHS to the fact its evaluating and previous, explicitly bound variables in earlier constraints on the LHS is a pretty firmly build in."><a href="#t1495915712052175" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-05-27</span> <span class="t" onclick="H(this)">20:08:32</span>               ryanbrush </span><span>Generating rules ahead of creating the session can be done, but it&apos;s not clear whether that helps much. The visibility of the LHS to the fact its evaluating and previous, explicitly bound variables in earlier constraints on the LHS is a pretty firmly build in.</span></div><div id="t1495915748054150" t="2017-05-27 20:09:08 ryanbrush But you can still bind a list or other structure in one LHS constraint, and then analyze it in a subsequent LHS constraint, if that helps."><a href="#t1495915748054150" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-05-27</span> <span class="t" onclick="H(this)">20:09:08</span>               ryanbrush </span><span>But you can still bind a list or other structure in one LHS constraint, and then analyze it in a subsequent LHS constraint, if that helps.</span></div><div id="t1495915763055029" t="2017-05-27 20:09:23 ryanbrush ...which includes test guards"><a href="#t1495915763055029" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-05-27</span> <span class="t" onclick="H(this)">20:09:23</span>               ryanbrush </span><span>...which includes test guards</span></div><div id="t1495916087073735" t="2017-05-27 20:14:47 newres The problem there is I do not know how I would express the fact that for all elements in that list I need a new slightly different constrained. For example suppose I have in the list 3 variables ?p1, ?p2, ?p3 I would need 3 conditions that check like [T (= ?a s) (= ?p1 p) (= b o)]  [T (= ?b s) (= ?p2 p) (= c o)] [T (= ?c s) (= ?p3 p) (= d o)]"><a href="#t1495916087073735" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-05-27</span> <span class="t" onclick="H(this)">20:14:47</span>                  newres </span><span>The problem there is I do not know how I would express the fact that for all elements in that list I need a new slightly different constrained. For example suppose I have in the list 3 variables ?p1, ?p2, ?p3 I would need 3 conditions that check like [T (= ?a s) (= ?p1 p) (= b o)]  [T (= ?b s) (= ?p2 p) (= c o)] [T (= ?c s) (= ?p3 p) (= d o)]</span></div><div id="t1495916188079006" t="2017-05-27 20:16:28 newres I can probably generate or write up such rules for the length of x manually if writing it for arbitary lengths is not possible"><a href="#t1495916188079006" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-05-27</span> <span class="t" onclick="H(this)">20:16:28</span>                  newres </span><span>I can probably generate or write up such rules for the length of x manually if writing it for arbitary lengths is not possible</span></div><div id="t1495916240081682" t="2017-05-27 20:17:20 ryanbrush Another simpler option (which may or may not work for your needs) is to use an accumulator to match a list of all items of type T, and then analyze that list in your guard."><a href="#t1495916240081682" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-05-27</span> <span class="t" onclick="H(this)">20:17:20</span>               ryanbrush </span><span>Another simpler option (which may or may not work for your needs) is to use an accumulator to match a list of all items of type T, and then analyze that list in your guard.</span></div><div id="t1495916299084566" t="2017-05-27 20:18:19 ryanbrush The accumulator might not bind anything but the result, so it just passes a list down, and you can call an arbitrarily sophisticated function in the guard to sort it out. Some documentation here:   http://www.clara-rules.org/docs/accumulators/"><a href="#t1495916299084566" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-05-27</span> <span class="t" onclick="H(this)">20:18:19</span>               ryanbrush </span><span>The accumulator might not bind anything but the result, so it just passes a list down, and you can call an arbitrarily sophisticated function in the guard to sort it out. Some documentation here:  </span><a href="http://www.clara-rules.org/docs/accumulators/" target="_blank">http://www.clara-rules.org/docs/accumulators/</a></div><div id="t1495916540097363" t="2017-05-27 20:22:20 newres so I could get all the values of T where the middle variable is a member of the list (In my implementation nearly everything is T, so I need to narrow some things down), than have test as a guard that pretty much checks what the conditions would do in a normal case"><a href="#t1495916540097363" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-05-27</span> <span class="t" onclick="H(this)">20:22:20</span>                  newres </span><span>so I could get all the values of T where the middle variable is a member of the list (In my implementation nearly everything is T, so I need to narrow some things down), than have test as a guard that pretty much checks what the conditions would do in a normal case</span></div><div id="t1495916568098677" t="2017-05-27 20:22:48 ryanbrush Yeah, that should work."><a href="#t1495916568098677" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-05-27</span> <span class="t" onclick="H(this)">20:22:48</span>               ryanbrush </span><span>Yeah, that should work.</span></div><div id="t1495916602100493" t="2017-05-27 20:23:22 ryanbrush It&apos;s probably not the most idiomatic way to structure rules, but we&apos;ve done things like this as well."><a href="#t1495916602100493" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-05-27</span> <span class="t" onclick="H(this)">20:23:22</span>               ryanbrush </span><span>It&apos;s probably not the most idiomatic way to structure rules, but we&apos;ve done things like this as well.</span></div><div id="t1495916646102664" t="2017-05-27 20:24:06 ryanbrush If you really want to get fancy you can write your own accumulator...but just grabbing everything (or just using simple filters if that works) can get you there."><a href="#t1495916646102664" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-05-27</span> <span class="t" onclick="H(this)">20:24:06</span>               ryanbrush </span><span>If you really want to get fancy you can write your own accumulator...but just grabbing everything (or just using simple filters if that works) can get you there.</span></div><div id="t1495916764108672" t="2017-05-27 20:26:04 newres is there a simple way to say that i want  [T (= ?b s) (= ?pl p) (= c o)] where ?pl is a member of a list l"><a href="#t1495916764108672" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-05-27</span> <span class="t" onclick="H(this)">20:26:04</span>                  newres </span><span>is there a simple way to say that i want  [T (= ?b s) (= ?pl p) (= c o)] where ?pl is a member of a list l</span></div><div id="t1495916811111107" t="2017-05-27 20:26:51 ryanbrush Yeah, you can pass ?pl to any function on the LHS after it is declared, including checks for inclusion in a list."><a href="#t1495916811111107" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-05-27</span> <span class="t" onclick="H(this)">20:26:51</span>               ryanbrush </span><span>Yeah, you can pass ?pl to any function on the LHS after it is declared, including checks for inclusion in a list.</span></div><div id="t1495916850113081" t="2017-05-27 20:27:30 newres aha yes that would work, not sure about the efficiency but right now getting it working would be a good step"><a href="#t1495916850113081" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-05-27</span> <span class="t" onclick="H(this)">20:27:30</span>                  newres </span><span>aha yes that would work, not sure about the efficiency but right now getting it working would be a good step</span></div><div id="t1495916925116648" t="2017-05-27 20:28:45 newres Thanks for the help! i am probably pushing clara in some really weird and unexpected ways but the docs really help"><a href="#t1495916925116648" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-05-27</span> <span class="t" onclick="H(this)">20:28:45</span>                  newres </span><span>Thanks for the help! i am probably pushing clara in some really weird and unexpected ways but the docs really help</span></div><div id="t1495916943117544" t="2017-05-27 20:29:03 ryanbrush Cool. Glad I could help and good luck with your system!"><a href="#t1495916943117544" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-05-27</span> <span class="t" onclick="H(this)">20:29:03</span>               ryanbrush </span><span>Cool. Glad I could help and good luck with your system!</span></div><div id="t1495916954118079" t="2017-05-27 20:29:14 newres and the board and the slack, thanks !"><a href="#t1495916954118079" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-05-27</span> <span class="t" onclick="H(this)">20:29:14</span>                  newres </span><span>and the board and the slack, thanks !</span></div><div id="t1496069097455930" t="2017-05-29 14:44:57 nkabrich Why is this rule creating an infinite loop? I&apos;m trying to insert a &quot;default fact&quot; if no other rule has yet inserted that fact. Or is there a better pattern for this?
 (defrule infinite-loop
  [:not [SomeFact]]
  =&gt;
  (rules/insert! (map-&gt;SomeFact {:a 1}))) 

Also if I add  {:salience -1}  to this rule, it seems to hang in the LHS? I&apos;m not exactly sure but in any case when I set the salience a (println &quot;looping&quot;) in the RHS fails to print and thread hangs."><a href="#t1496069097455930" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-05-29</span> <span class="t" onclick="H(this)">14:44:57</span>                nkabrich </span><span>Why is this rule creating an infinite loop? I&apos;m trying to insert a &quot;default fact&quot; if no other rule has yet inserted that fact. Or is there a better pattern for this?
</span><pre>(defrule infinite-loop
  [:not [SomeFact]]
  =&gt;
  (rules/insert! (map-&gt;SomeFact {:a 1})))</pre><span>

Also if I add </span><code>{:salience -1}</code><span> to this rule, it seems to hang in the LHS? I&apos;m not exactly sure but in any case when I set the salience a (println &quot;looping&quot;) in the RHS fails to print and thread hangs.</span></div><div id="t1496069328505325" t="2017-05-29 14:48:48 souenzzo not sure but, i think you can: first accumulate some fact, if it&apos;s equal zero, then insert the default."><a href="#t1496069328505325" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-05-29</span> <span class="t" onclick="H(this)">14:48:48</span>                souenzzo </span><span>not sure but, i think you can: first accumulate some fact, if it&apos;s equal zero, then insert the default.</span></div><div id="t1496071222889484" t="2017-05-29 15:20:22 alex-dixon @ryanbrush Would it be ok to add a Clara channel here?  https://discord.gg/v9QMy9D"><a href="#t1496071222889484" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-05-29</span> <span class="t" onclick="H(this)">15:20:22</span>              alex-dixon </span><span>@ryanbrush Would it be ok to add a Clara channel here? </span><a href="https://discord.gg/v9QMy9D" target="_blank">https://discord.gg/v9QMy9D</a></div><div id="t1496071397922953" t="2017-05-29 15:23:17 nkabrich @souenzzo hmm thanks, but I&apos;m still running into an infinite loop using an accumulator and  :test  to insert a default"><a href="#t1496071397922953" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-05-29</span> <span class="t" onclick="H(this)">15:23:17</span>                nkabrich </span><span>@souenzzo hmm thanks, but I&apos;m still running into an infinite loop using an accumulator and </span><code>:test</code><span> to insert a default</span></div><div id="t1496071910019205" t="2017-05-29 15:31:50 alex-dixon @nkabrich Are you using (acc/count)?"><a href="#t1496071910019205" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-05-29</span> <span class="t" onclick="H(this)">15:31:50</span>              alex-dixon </span><span>@nkabrich Are you using (acc/count)?</span></div><div id="t1496072014038139" t="2017-05-29 15:33:34 alex-dixon [?nfacts &lt;- (acc/count) :from SomeFact]
[:test (= 0 ?nfacts)]
"><a href="#t1496072014038139" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-05-29</span> <span class="t" onclick="H(this)">15:33:34</span>              alex-dixon </span><pre>[?nfacts &lt;- (acc/count) :from SomeFact]
[:test (= 0 ?nfacts)]
</pre></div><div id="t1496072015038374" t="2017-05-29 15:33:35 alex-dixon ?"><a href="#t1496072015038374" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-05-29</span> <span class="t" onclick="H(this)">15:33:35</span>              alex-dixon </span><span>?</span></div><div id="t1496072042043058" t="2017-05-29 15:34:02 nkabrich @alex-dixon nope, ill give that a whirl"><a href="#t1496072042043058" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-05-29</span> <span class="t" onclick="H(this)">15:34:02</span>                nkabrich </span><span>@alex-dixon nope, ill give that a whirl</span></div><div id="t1496072176067501" t="2017-05-29 15:36:16 ryanbrush If an insert on the RHS causes the LHS to become false, the insert is retracted since it is no longer supported...causing the LHS to become true again and an infinite loop occurs."><a href="#t1496072176067501" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-05-29</span> <span class="t" onclick="H(this)">15:36:16</span>               ryanbrush </span><span>If an insert on the RHS causes the LHS to become false, the insert is retracted since it is no longer supported...causing the LHS to become true again and an infinite loop occurs.</span></div><div id="t1496072229076706" t="2017-05-29 15:37:09 ryanbrush The key is for the RHS insert to not match the LHS. Like check in the LHS for not a default value that the RHS could insert, so it doesn&apos;t retract the RHS inserted fact."><a href="#t1496072229076706" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-05-29</span> <span class="t" onclick="H(this)">15:37:09</span>               ryanbrush </span><span>The key is for the RHS insert to not match the LHS. Like check in the LHS for not a default value that the RHS could insert, so it doesn&apos;t retract the RHS inserted fact.</span></div><div id="t1496072283086203" t="2017-05-29 15:38:03 ryanbrush You can also use insert-unconditional to avoid this truth maintenance loop outright, but that can cause other headaches that depend on the order of facts inserted."><a href="#t1496072283086203" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-05-29</span> <span class="t" onclick="H(this)">15:38:03</span>               ryanbrush </span><span>You can also use insert-unconditional to avoid this truth maintenance loop outright, but that can cause other headaches that depend on the order of facts inserted.</span></div><div id="t1496072301089335" t="2017-05-29 15:38:21 nkabrich ahh, makes total sense thanks for the explanation."><a href="#t1496072301089335" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-05-29</span> <span class="t" onclick="H(this)">15:38:21</span>                nkabrich </span><span>ahh, makes total sense thanks for the explanation.</span></div><div id="t1496072353098122" t="2017-05-29 15:39:13 ryanbrush Sure thing. It&apos;s probably the biggest pitfall of rules engines like this....but can be overcome with some care"><a href="#t1496072353098122" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-05-29</span> <span class="t" onclick="H(this)">15:39:13</span>               ryanbrush </span><span>Sure thing. It&apos;s probably the biggest pitfall of rules engines like this....but can be overcome with some care</span></div><div id="t1496072514125853" t="2017-05-29 15:41:54 ryanbrush @alex-dixon I&apos;m not familiar with that service. Let me take a look at it later today"><a href="#t1496072514125853" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-05-29</span> <span class="t" onclick="H(this)">15:41:54</span>               ryanbrush </span><span>@alex-dixon I&apos;m not familiar with that service. Let me take a look at it later today</span></div><div id="t1496072718161290" t="2017-05-29 15:45:18 alex-dixon @ryanbrush Thanks. There’s some discussion within the community to converting from Slack to it. Seems like we’re in a trial period right now. I know from the JS community that Slack’s message limit is a problem and Discord is generally looked to as the solution (they keep unlimited message history)  https://github.com/reactjs/redux  for example is a popular JS library that has moved to Discord"><a href="#t1496072718161290" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-05-29</span> <span class="t" onclick="H(this)">15:45:18</span>              alex-dixon </span><span>@ryanbrush Thanks. There’s some discussion within the community to converting from Slack to it. Seems like we’re in a trial period right now. I know from the JS community that Slack’s message limit is a problem and Discord is generally looked to as the solution (they keep unlimited message history) </span><a href="https://github.com/reactjs/redux" target="_blank">https://github.com/reactjs/redux</a><span> for example is a popular JS library that has moved to Discord</span></div><div id="t1496156575768348" t="2017-05-30 15:02:55 ryanbrush As for the Discord conversation, if the bulk of the Clojure community goes over there then we should go along. That said, I feel like I already have too many collaboration tools I use...so I&apos;ll probably only be active on the forums where most of Clojure is. I have no objections if users want to create a Clara channel there...I just won&apos;t promise to frequent  all of these."><a href="#t1496156575768348" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-05-30</span> <span class="t" onclick="H(this)">15:02:55</span>               ryanbrush </span><span>As for the Discord conversation, if the bulk of the Clojure community goes over there then we should go along. That said, I feel like I already have too many collaboration tools I use...so I&apos;ll probably only be active on the forums where most of Clojure is. I have no objections if users want to create a Clara channel there...I just won&apos;t promise to frequent  all of these.</span></div><div id="t1496928916776734" t="2017-06-08 13:35:16 jfntn I’m not familiar with clara but I’ve been wondering if it could be used to model a HFSM/Statechart by defining a hierarchy of rules?"><a href="#t1496928916776734" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-08</span> <span class="t" onclick="H(this)">13:35:16</span>                   jfntn </span><span>I’m not familiar with clara but I’ve been wondering if it could be used to model a HFSM/Statechart by defining a hierarchy of rules?</span></div><div id="t1496929336932837" t="2017-06-08 13:42:16 jfntn I.e. in  any given state, only a subset of the engines rules are loaded, and generally you’d want children states to activate their parent’s rules"><a href="#t1496929336932837" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-08</span> <span class="t" onclick="H(this)">13:42:16</span>                   jfntn </span><span>I.e. in  any given state, only a subset of the engines rules are loaded, and generally you’d want children states to activate their parent’s rules</span></div><div id="t1496929498995499" t="2017-06-08 13:44:58 jfntn The OOP like mechanics can easily be achieved with a custom hierarchy in clojure, but I’m wondering if scoping rules to their respective state in clara would involve instantiating different rulesets, or dynamically mutating a global rules registry"><a href="#t1496929498995499" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-08</span> <span class="t" onclick="H(this)">13:44:58</span>                   jfntn </span><span>The OOP like mechanics can easily be achieved with a custom hierarchy in clojure, but I’m wondering if scoping rules to their respective state in clara would involve instantiating different rulesets, or dynamically mutating a global rules registry</span></div><div id="t1497015354148841" t="2017-06-09 13:35:54 fabrao Well @jfntn , I used to classify I kind of link status to avoid chains of ifs, but my experience is that it was more complex than I thougth, so I changed to datascript to be more clear and simple"><a href="#t1497015354148841" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-09</span> <span class="t" onclick="H(this)">13:35:54</span>                  fabrao </span><span>Well @jfntn , I used to classify I kind of link status to avoid chains of ifs, but my experience is that it was more complex than I thougth, so I changed to datascript to be more clear and simple</span></div><div id="t1497015372154964" t="2017-06-09 13:36:12 fabrao here is an example what I did 
 (defn limite [chave]
  (read-string (chave (:referencia (:config sistema)))))

(defrecord IcmpLocalizacao [nome-link localidade jitter latencia perda])
(defrecord Problema [mensagem nome-link localidade])

(defrule ligacao-fragmentada
         [?local &lt;- IcmpLocalizacao (= ?nome-link nome-link) (= ?localidade localidade) (&gt; perda (limite :perda))]
         =&gt;
         (insert! (-&gt;Problema :fragmentada ?nome-link ?localidade)))

(defrule telefonia-degradada
         [?local &lt;- IcmpLocalizacao (= ?nome-link nome-link) (= ?localidade localidade) (&gt; jitter (limite :jitter)) (&gt; latencia (limite :latencia)) (&lt;= perda (limite :perda))]
         =&gt;
         (insert! (-&gt;Problema :degradada ?nome-link ?localidade)))

(defrule perda-qualidade
         [?local &lt;- IcmpLocalizacao (= ?nome-link nome-link) (= ?localidade localidade) (&gt; jitter (limite :jitter)) (&lt;= latencia (limite :latencia)) (&lt;= perda (limite :perda))]
         =&gt;
         (insert! (-&gt;Problema :qualidade ?nome-link ?localidade)))

(defrule atraso-telefonia
         [?local &lt;- IcmpLocalizacao (= ?nome-link nome-link) (= ?localidade localidade) (&lt;= jitter (limite :jitter)) (&gt; latencia (limite :latencia)) (&lt;= perda (limite :perda))]
         =&gt;
         (insert! (-&gt;Problema :atraso ?nome-link ?localidade)))

(defrule sem-comunicacao
         [?local &lt;- IcmpLocalizacao (= ?nome-link nome-link) (= ?localidade localidade) (= jitter -1) (= latencia -1) (= perda -1)]
         =&gt;
         (insert! (-&gt;Problema :comunicacao_locais ?nome-link ?localidade)))

(defquery problemas-comunicacao []
          [Problema (= ?mensagem mensagem) (= ?nome-link nome-link) (= ?localidade localidade)])

(defn gerar-fatos [fatos]
  (let [regras (atom #{})]
    (doseq [fato fatos]
    (let [link (first (first fato))
          valor (second (first fato))
          localidade (:localidade valor)
          icmp (:icmp valor)
          jitter (:jitter icmp)
          perda (:perda icmp)
          latencia (:latencia icmp)]
    (swap! regras conj (-&gt;IcmpLocalizacao link localidade jitter latencia perda))))
    @regras))

(defn compilar-regras [fatos]
  (into #{}
        (-&gt; (mk-session &apos;correlacao.item.regraslink)
            (insert-all (gerar-fatos fatos))
            (fire-rules)
            (query problemas-comunicacao))))
"><a href="#t1497015372154964" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-09</span> <span class="t" onclick="H(this)">13:36:12</span>                  fabrao </span><span>here is an example what I did 
</span><pre>(defn limite [chave]
  (read-string (chave (:referencia (:config sistema)))))

(defrecord IcmpLocalizacao [nome-link localidade jitter latencia perda])
(defrecord Problema [mensagem nome-link localidade])

(defrule ligacao-fragmentada
         [?local &lt;- IcmpLocalizacao (= ?nome-link nome-link) (= ?localidade localidade) (&gt; perda (limite :perda))]
         =&gt;
         (insert! (-&gt;Problema :fragmentada ?nome-link ?localidade)))

(defrule telefonia-degradada
         [?local &lt;- IcmpLocalizacao (= ?nome-link nome-link) (= ?localidade localidade) (&gt; jitter (limite :jitter)) (&gt; latencia (limite :latencia)) (&lt;= perda (limite :perda))]
         =&gt;
         (insert! (-&gt;Problema :degradada ?nome-link ?localidade)))

(defrule perda-qualidade
         [?local &lt;- IcmpLocalizacao (= ?nome-link nome-link) (= ?localidade localidade) (&gt; jitter (limite :jitter)) (&lt;= latencia (limite :latencia)) (&lt;= perda (limite :perda))]
         =&gt;
         (insert! (-&gt;Problema :qualidade ?nome-link ?localidade)))

(defrule atraso-telefonia
         [?local &lt;- IcmpLocalizacao (= ?nome-link nome-link) (= ?localidade localidade) (&lt;= jitter (limite :jitter)) (&gt; latencia (limite :latencia)) (&lt;= perda (limite :perda))]
         =&gt;
         (insert! (-&gt;Problema :atraso ?nome-link ?localidade)))

(defrule sem-comunicacao
         [?local &lt;- IcmpLocalizacao (= ?nome-link nome-link) (= ?localidade localidade) (= jitter -1) (= latencia -1) (= perda -1)]
         =&gt;
         (insert! (-&gt;Problema :comunicacao_locais ?nome-link ?localidade)))

(defquery problemas-comunicacao []
          [Problema (= ?mensagem mensagem) (= ?nome-link nome-link) (= ?localidade localidade)])

(defn gerar-fatos [fatos]
  (let [regras (atom #{})]
    (doseq [fato fatos]
    (let [link (first (first fato))
          valor (second (first fato))
          localidade (:localidade valor)
          icmp (:icmp valor)
          jitter (:jitter icmp)
          perda (:perda icmp)
          latencia (:latencia icmp)]
    (swap! regras conj (-&gt;IcmpLocalizacao link localidade jitter latencia perda))))
    @regras))

(defn compilar-regras [fatos]
  (into #{}
        (-&gt; (mk-session &apos;correlacao.item.regraslink)
            (insert-all (gerar-fatos fatos))
            (fire-rules)
            (query problemas-comunicacao))))
</pre></div><div id="t1497015487193562" t="2017-06-09 13:38:07 fabrao in datascript  (defn- classificar-elemento [conn tipo op-jitter op-perda op-latencia jitter perda latencia]
  (let [resultado (d/q &apos;[:find ?localidade ?link
                         :in $ ?op-jitter ?op-perda ?op-latencia ?ref-jitter ?ref-perda ?ref-latencia
                         :where 
                         [?e :link ?link]
                         [?e :localidade ?localidade]
                         [?e :jitter ?jitter]
                         [?e :perda ?perda]
                         [?e :latencia ?latencia]
                         [(?op-jitter ?jitter ?ref-jitter)]
                         [(?op-perda ?perda ?ref-perda)]
                         [(?op-latencia ?latencia ?ref-latencia)]
                         ]
                       conn op-jitter op-perda op-latencia jitter perda latencia)]
    (if (= #{} resultado)
      []
      (resultado-&gt;set resultado tipo)
      )))"><a href="#t1497015487193562" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-09</span> <span class="t" onclick="H(this)">13:38:07</span>                  fabrao </span><span>in datascript </span><pre>(defn- classificar-elemento [conn tipo op-jitter op-perda op-latencia jitter perda latencia]
  (let [resultado (d/q &apos;[:find ?localidade ?link
                         :in $ ?op-jitter ?op-perda ?op-latencia ?ref-jitter ?ref-perda ?ref-latencia
                         :where 
                         [?e :link ?link]
                         [?e :localidade ?localidade]
                         [?e :jitter ?jitter]
                         [?e :perda ?perda]
                         [?e :latencia ?latencia]
                         [(?op-jitter ?jitter ?ref-jitter)]
                         [(?op-perda ?perda ?ref-perda)]
                         [(?op-latencia ?latencia ?ref-latencia)]
                         ]
                       conn op-jitter op-perda op-latencia jitter perda latencia)]
    (if (= #{} resultado)
      []
      (resultado-&gt;set resultado tipo)
      )))</pre></div><div id="t1497015582225587" t="2017-06-09 13:39:42 fabrao (classificar-elemento @conn :fragmentada nevermind &gt; nevermind jitter perda latencia)"><a href="#t1497015582225587" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-09</span> <span class="t" onclick="H(this)">13:39:42</span>                  fabrao </span><code>(classificar-elemento @conn :fragmentada nevermind &gt; nevermind jitter perda latencia)</code></div><div id="t1497015811305138" t="2017-06-09 13:43:31 fabrao I see that datascript was more flexible, but you can use any other ways to define rules for your job, like in  https://github.com/threatgrid/naga  or even  clojure.logic"><a href="#t1497015811305138" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-09</span> <span class="t" onclick="H(this)">13:43:31</span>                  fabrao </span><span>I see that datascript was more flexible, but you can use any other ways to define rules for your job, like in </span><a href="https://github.com/threatgrid/naga" target="_blank">https://github.com/threatgrid/naga</a><span> or even </span><code>clojure.logic</code></div><div id="t1497031181024041" t="2017-06-09 17:59:41 mikerod @jfntn I guess I don’t fully grasp your problem statement"><a href="#t1497031181024041" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-09</span> <span class="t" onclick="H(this)">17:59:41</span>                 mikerod </span><span>@jfntn I guess I don’t fully grasp your problem statement</span></div><div id="t1497031207035176" t="2017-06-09 18:00:07 mikerod However, Clara has certainly been used in a way that creates logical “groups” and/or “hierarchies” of rules"><a href="#t1497031207035176" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-09</span> <span class="t" onclick="H(this)">18:00:07</span>                 mikerod </span><span>However, Clara has certainly been used in a way that creates logical “groups” and/or “hierarchies” of rules</span></div><div id="t1497031248051136" t="2017-06-09 18:00:48 mikerod You can have intermediary facts inserted that act as “blockers” for some rules, or have some rules not be able to be satisfied until certain facts are present"><a href="#t1497031248051136" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-09</span> <span class="t" onclick="H(this)">18:00:48</span>                 mikerod </span><span>You can have intermediary facts inserted that act as “blockers” for some rules, or have some rules not be able to be satisfied until certain facts are present</span></div><div id="t1497031278063062" t="2017-06-09 18:01:18 mikerod However, this isn’t done by “turning off” rules or by excluding rules from the rulebase/session created, instead it is done purely through logical relationships the rules express"><a href="#t1497031278063062" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-09</span> <span class="t" onclick="H(this)">18:01:18</span>                 mikerod </span><span>However, this isn’t done by “turning off” rules or by excluding rules from the rulebase/session created, instead it is done purely through logical relationships the rules express</span></div><div id="t1497031332082846" t="2017-06-09 18:02:12 mikerod Also, the “type” dispatch function used by Clara rules LHS conditions is pluggable. So you could do things with ad hoc hierarchies of Clojure"><a href="#t1497031332082846" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-09</span> <span class="t" onclick="H(this)">18:02:12</span>                 mikerod </span><span>Also, the “type” dispatch function used by Clara rules LHS conditions is pluggable. So you could do things with ad hoc hierarchies of Clojure</span></div><div id="t1497031368095809" t="2017-06-09 18:02:48 mikerod http://www.clara-rules.org/docs/fact_type_customization/"><a href="#t1497031368095809" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-09</span> <span class="t" onclick="H(this)">18:02:48</span>                 mikerod </span><a href="http://www.clara-rules.org/docs/fact_type_customization/" target="_blank">http://www.clara-rules.org/docs/fact_type_customization/</a></div><div id="t1497031384101883" t="2017-06-09 18:03:04 mikerod has some details on the custom “fact type” fn (and similarly the associated “ancestors” fn"><a href="#t1497031384101883" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-09</span> <span class="t" onclick="H(this)">18:03:04</span>                 mikerod </span><span>has some details on the custom “fact type” fn (and similarly the associated “ancestors” fn</span></div><div id="t1497031402108693" t="2017-06-09 18:03:22 mikerod I may be speaking way too vague to help answer your question though"><a href="#t1497031402108693" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-09</span> <span class="t" onclick="H(this)">18:03:22</span>                 mikerod </span><span>I may be speaking way too vague to help answer your question though</span></div><div id="t1497031437121764" t="2017-06-09 18:03:57 jfntn Ok interesting, I guess I was wondering if it was valid to consider an approach where the app dynamically loads/unoads a different session depending on some external state machine"><a href="#t1497031437121764" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-09</span> <span class="t" onclick="H(this)">18:03:57</span>                   jfntn </span><span>Ok interesting, I guess I was wondering if it was valid to consider an approach where the app dynamically loads/unoads a different session depending on some external state machine</span></div><div id="t1497031454127498" t="2017-06-09 18:04:14 mikerod I think @fabrao may have had some interesting points above too. There is a chance that forward-chaining rules aren’t the best approach to certain sorts of problems"><a href="#t1497031454127498" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-09</span> <span class="t" onclick="H(this)">18:04:14</span>                 mikerod </span><span>I think @fabrao may have had some interesting points above too. There is a chance that forward-chaining rules aren’t the best approach to certain sorts of problems</span></div><div id="t1497031506145689" t="2017-06-09 18:05:06 mikerod I would say it is not a good situation to have when your rules end up being of the form: A -&gt; B; B -&gt; C; C -&gt; D; D -&gt; E - when that chain starts to get really long and only one linear flow of logic"><a href="#t1497031506145689" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-09</span> <span class="t" onclick="H(this)">18:05:06</span>                 mikerod </span><span>I would say it is not a good situation to have when your rules end up being of the form: A -&gt; B; B -&gt; C; C -&gt; D; D -&gt; E - when that chain starts to get really long and only one linear flow of logic</span></div><div id="t1497031578171387" t="2017-06-09 18:06:18 mikerod @jfntn well consider one of the compelling strengths of a Rete-based forward chaining rules impl like Clara - it stores a bunch of state to avoid re-calculation of join and non-joining constraints done in previous states of  the  system"><a href="#t1497031578171387" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-09</span> <span class="t" onclick="H(this)">18:06:18</span>                 mikerod </span><span>@jfntn well consider one of the compelling strengths of a Rete-based forward chaining rules impl like Clara - it stores a bunch of state to avoid re-calculation of join and non-joining constraints done in previous states of  the  system</span></div><div id="t1497031601179468" t="2017-06-09 18:06:41 mikerod if you flip from session to session, they will not share any of this state with one another. there is a chance that that is suitable for your needs. I’m just calling it out."><a href="#t1497031601179468" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-09</span> <span class="t" onclick="H(this)">18:06:41</span>                 mikerod </span><span>if you flip from session to session, they will not share any of this state with one another. there is a chance that that is suitable for your needs. I’m just calling it out.</span></div><div id="t1497031702214483" t="2017-06-09 18:08:22 mikerod Also, the time to create a session is typically non-trivial if you have a fair number of rules involved. So often the pattern is to keep the sessions in memory. There will be limitations to how many rule sessions you can store in memory at a time. The size of them is mostly dependent on the number or rules and conditions involved"><a href="#t1497031702214483" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-09</span> <span class="t" onclick="H(this)">18:08:22</span>                 mikerod </span><span>Also, the time to create a session is typically non-trivial if you have a fair number of rules involved. So often the pattern is to keep the sessions in memory. There will be limitations to how many rule sessions you can store in memory at a time. The size of them is mostly dependent on the number or rules and conditions involved</span></div><div id="t1497031703215080" t="2017-06-09 18:08:23 fabrao https://github.com/hraberg/mimir"><a href="#t1497031703215080" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-09</span> <span class="t" onclick="H(this)">18:08:23</span>                  fabrao </span><a href="https://github.com/hraberg/mimir" target="_blank">https://github.com/hraberg/mimir</a></div><div id="t1497031774238158" t="2017-06-09 18:09:34 jfntn So I guess I was assuming you could somehow keep the facts but change the rules, not sure if that makes sense in practice"><a href="#t1497031774238158" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-09</span> <span class="t" onclick="H(this)">18:09:34</span>                   jfntn </span><span>So I guess I was assuming you could somehow keep the facts but change the rules, not sure if that makes sense in practice</span></div><div id="t1497031786243493" t="2017-06-09 18:09:46 jfntn http://blog.cognitect.com/blog/2017/5/22/restate-your-ui-using-state-machines-to-simplify-user-interface-development"><a href="#t1497031786243493" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-09</span> <span class="t" onclick="H(this)">18:09:46</span>                   jfntn </span><a href="http://blog.cognitect.com/blog/2017/5/22/restate-your-ui-using-state-machines-to-simplify-user-interface-development" target="_blank">http://blog.cognitect.com/blog/2017/5/22/restate-your-ui-using-state-machines-to-simplify-user-interface-development</a></div><div id="t1497031801248753" t="2017-06-09 18:10:01 mikerod @jfntn you could query the facts produced from a  fire-rules  execution of a session"><a href="#t1497031801248753" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-09</span> <span class="t" onclick="H(this)">18:10:01</span>                 mikerod </span><span>@jfntn you could query the facts produced from a </span><code>fire-rules</code><span> execution of a session</span></div><div id="t1497031810252088" t="2017-06-09 18:10:10 jfntn This article includes this definition for an fsm:"><a href="#t1497031810252088" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-09</span> <span class="t" onclick="H(this)">18:10:10</span>                   jfntn </span><span>This article includes this definition for an fsm:</span></div><div id="t1497031812252421" t="2017-06-09 18:10:12 mikerod and you could insert those facts into any other sessoin that uses them"><a href="#t1497031812252421" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-09</span> <span class="t" onclick="H(this)">18:10:12</span>                 mikerod </span><span>and you could insert those facts into any other sessoin that uses them</span></div><div id="t1497031824256894" t="2017-06-09 18:10:24 jfntn (def fsm {&apos;Start          {:init             &apos;Ready}
          &apos;Ready          {:missing-password &apos;Password-Error
                           :missing-email    &apos;Email-Error
                           :submit           &apos;Submitting}
          &apos;Password-Error {:change-password  &apos;Ready}
          &apos;Email-Error    {:change-email     &apos;Ready}
          &apos;Submitting     {:receive-success  &apos;Success}})
"><a href="#t1497031824256894" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-09</span> <span class="t" onclick="H(this)">18:10:24</span>                   jfntn </span><pre>(def fsm {&apos;Start          {:init             &apos;Ready}
          &apos;Ready          {:missing-password &apos;Password-Error
                           :missing-email    &apos;Email-Error
                           :submit           &apos;Submitting}
          &apos;Password-Error {:change-password  &apos;Ready}
          &apos;Email-Error    {:change-email     &apos;Ready}
          &apos;Submitting     {:receive-success  &apos;Success}})
</pre></div><div id="t1497031832259773" t="2017-06-09 18:10:32 mikerod I believe I just read this a few days ago"><a href="#t1497031832259773" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-09</span> <span class="t" onclick="H(this)">18:10:32</span>                 mikerod </span><span>I believe I just read this a few days ago</span></div><div id="t1497031840262598" t="2017-06-09 18:10:40 mikerod I hadn’t really thought much about it though."><a href="#t1497031840262598" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-09</span> <span class="t" onclick="H(this)">18:10:40</span>                 mikerod </span><span>I hadn’t really thought much about it though.</span></div><div id="t1497031878275674" t="2017-06-09 18:11:18 jfntn I was imagining something like rules as transitions instead of keywords, and a sort of recursive definition where the Symbols on the right-hand side could be whole FSMs"><a href="#t1497031878275674" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-09</span> <span class="t" onclick="H(this)">18:11:18</span>                   jfntn </span><span>I was imagining something like rules as transitions instead of keywords, and a sort of recursive definition where the Symbols on the right-hand side could be whole FSMs</span></div><div id="t1497031882277077" t="2017-06-09 18:11:22 mikerod Have you found that it is difficult to express the FSM sort of logic just using 1 session?"><a href="#t1497031882277077" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-09</span> <span class="t" onclick="H(this)">18:11:22</span>                 mikerod </span><span>Have you found that it is difficult to express the FSM sort of logic just using 1 session?</span></div><div id="t1497031992315255" t="2017-06-09 18:13:12 jfntn Wouldn’t you have to encode the transitions across many rules though? Maybe I just want something that will define a valid session from recursing over this tree"><a href="#t1497031992315255" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-09</span> <span class="t" onclick="H(this)">18:13:12</span>                   jfntn </span><span>Wouldn’t you have to encode the transitions across many rules though? Maybe I just want something that will define a valid session from recursing over this tree</span></div><div id="t1497032090349218" t="2017-06-09 18:14:50 mikerod It isn’t immediately clear to me how it would look"><a href="#t1497032090349218" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-09</span> <span class="t" onclick="H(this)">18:14:50</span>                 mikerod </span><span>It isn’t immediately clear to me how it would look</span></div><div id="t1497032103353749" t="2017-06-09 18:15:03 mikerod Perhaps this article is enough to go off to make a toy example in Clara with 1 session"><a href="#t1497032103353749" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-09</span> <span class="t" onclick="H(this)">18:15:03</span>                 mikerod </span><span>Perhaps this article is enough to go off to make a toy example in Clara with 1 session</span></div><div id="t1497032123360382" t="2017-06-09 18:15:23 mikerod But it may not be sophisticated enough to show anything useful - I don’t know"><a href="#t1497032123360382" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-09</span> <span class="t" onclick="H(this)">18:15:23</span>                 mikerod </span><span>But it may not be sophisticated enough to show anything useful - I don’t know</span></div><div id="t1497032166375402" t="2017-06-09 18:16:06 mikerod I’m just trying to find the simplest solution the the problem and I’d hope there would be a nice mapping of the idea to a single session. Just to avoid the details of bouncing around between them"><a href="#t1497032166375402" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-09</span> <span class="t" onclick="H(this)">18:16:06</span>                 mikerod </span><span>I’m just trying to find the simplest solution the the problem and I’d hope there would be a nice mapping of the idea to a single session. Just to avoid the details of bouncing around between them</span></div><div id="t1497032179380103" t="2017-06-09 18:16:19 mikerod You could certainly have a map of “session name key” -&gt; session"><a href="#t1497032179380103" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-09</span> <span class="t" onclick="H(this)">18:16:19</span>                 mikerod </span><span>You could certainly have a map of “session name key” -&gt; session</span></div><div id="t1497032198386893" t="2017-06-09 18:16:38 mikerod and have RHS’s produce a fact that says what is the “next session” to evaluate"><a href="#t1497032198386893" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-09</span> <span class="t" onclick="H(this)">18:16:38</span>                 mikerod </span><span>and have RHS’s produce a fact that says what is the “next session” to evaluate</span></div><div id="t1497032240401209" t="2017-06-09 18:17:20 mikerod Or to flip that and just have the RHS produce a fact that your outer FSM uses to transition to the next step - I think that is what you said above"><a href="#t1497032240401209" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-09</span> <span class="t" onclick="H(this)">18:17:20</span>                 mikerod </span><span>Or to flip that and just have the RHS produce a fact that your outer FSM uses to transition to the next step - I think that is what you said above</span></div><div id="t1497032329432521" t="2017-06-09 18:18:49 fabrao it seems like workflow engine"><a href="#t1497032329432521" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-09</span> <span class="t" onclick="H(this)">18:18:49</span>                  fabrao </span><span>it seems like workflow engine</span></div><div id="t1497032430467382" t="2017-06-09 18:20:30 mikerod Funny"><a href="#t1497032430467382" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-09</span> <span class="t" onclick="H(this)">18:20:30</span>                 mikerod </span><span>Funny</span></div><div id="t1497032437470080" t="2017-06-09 18:20:37 mikerod JBoss had jBPM I think"><a href="#t1497032437470080" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-09</span> <span class="t" onclick="H(this)">18:20:37</span>                 mikerod </span><span>JBoss had jBPM I think</span></div><div id="t1497032455476237" t="2017-06-09 18:20:55 mikerod which basically (I believe) is a FSM sort of system that triggers Drools rules at certain stages"><a href="#t1497032455476237" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-09</span> <span class="t" onclick="H(this)">18:20:55</span>                 mikerod </span><span>which basically (I believe) is a FSM sort of system that triggers Drools rules at certain stages</span></div><div id="t1497032458477283" t="2017-06-09 18:20:58 mikerod (among other things)"><a href="#t1497032458477283" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-09</span> <span class="t" onclick="H(this)">18:20:58</span>                 mikerod </span><span>(among other things)</span></div><div id="t1497032482485601" t="2017-06-09 18:21:22 mikerod So I guess the idea came up there as well. I’m still just curious about whether or not a single session can’t express an FSM in the sense of the web app article  though"><a href="#t1497032482485601" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-09</span> <span class="t" onclick="H(this)">18:21:22</span>                 mikerod </span><span>So I guess the idea came up there as well. I’m still just curious about whether or not a single session can’t express an FSM in the sense of the web app article  though</span></div><div id="t1497033126713406" t="2017-06-09 18:32:06 jfntn Seems like it should be possible, but the article is only trying to represent a single FSM, and to extend that definition to a Statechart you have to imagine that each state on the right is not final but can have recursive fsm definitions."><a href="#t1497033126713406" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-09</span> <span class="t" onclick="H(this)">18:32:06</span>                   jfntn </span><span>Seems like it should be possible, but the article is only trying to represent a single FSM, and to extend that definition to a Statechart you have to imagine that each state on the right is not final but can have recursive fsm definitions.</span></div><div id="t1497033149720300" t="2017-06-09 18:32:29 jfntn You’d be able to chart the whole app with something along those lines:"><a href="#t1497033149720300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-09</span> <span class="t" onclick="H(this)">18:32:29</span>                   jfntn </span><span>You’d be able to chart the whole app with something along those lines:</span></div><div id="t1497033153721619" t="2017-06-09 18:32:33 jfntn (def app-statechart
  {&apos;Visitor
   {:login
    {&apos;LoginForm
     {&apos;Start          {:init &apos;Ready}
      &apos;Ready          {:missing-password &apos;Password-Error
                       :missing-email    &apos;Email-Error
                       :submit           &apos;Submitting}
      &apos;Password-Error {:change-password &apos;Ready}
      &apos;Email-Error    {:change-email &apos;Ready}
      &apos;Submitting     {:receive-success &apos;Success}}}
    :signup {... }}
   &apos;User  {...}
   &apos;Admin {...}})
"><a href="#t1497033153721619" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-09</span> <span class="t" onclick="H(this)">18:32:33</span>                   jfntn </span><pre>(def app-statechart
  {&apos;Visitor
   {:login
    {&apos;LoginForm
     {&apos;Start          {:init &apos;Ready}
      &apos;Ready          {:missing-password &apos;Password-Error
                       :missing-email    &apos;Email-Error
                       :submit           &apos;Submitting}
      &apos;Password-Error {:change-password &apos;Ready}
      &apos;Email-Error    {:change-email &apos;Ready}
      &apos;Submitting     {:receive-success &apos;Success}}}
    :signup {... }}
   &apos;User  {...}
   &apos;Admin {...}})
</pre></div><div id="t1497033659897096" t="2017-06-09 18:40:59 jfntn The key distinction is that for a given node in the tree, valid transitions at that state are the union of its and its parents’ transitions (or rules in our case), so rules that are not in this set are illegal"><a href="#t1497033659897096" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-09</span> <span class="t" onclick="H(this)">18:40:59</span>                   jfntn </span><span>The key distinction is that for a given node in the tree, valid transitions at that state are the union of its and its parents’ transitions (or rules in our case), so rules that are not in this set are illegal</span></div><div id="t1497034261102235" t="2017-06-09 18:51:01 mikerod interesting"><a href="#t1497034261102235" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-09</span> <span class="t" onclick="H(this)">18:51:01</span>                 mikerod </span><span>interesting</span></div><div id="t1497035810619279" t="2017-06-09 19:16:50 fabrao Dont you think clara is too complex for that?"><a href="#t1497035810619279" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-09</span> <span class="t" onclick="H(this)">19:16:50</span>                  fabrao </span><span>Dont you think clara is too complex for that?</span></div><div id="t1497035973670649" t="2017-06-09 19:19:33 fabrao take a look here  https://github.com/vvvvalvalval/datalog-rules"><a href="#t1497035973670649" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-09</span> <span class="t" onclick="H(this)">19:19:33</span>                  fabrao </span><span>take a look here </span><a href="https://github.com/vvvvalvalval/datalog-rules" target="_blank">https://github.com/vvvvalvalval/datalog-rules</a></div><div id="t1497036051694861" t="2017-06-09 19:20:51 fabrao you can define many  ruleset  and apply it in your context, so you can dynamic it for your needs"><a href="#t1497036051694861" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-09</span> <span class="t" onclick="H(this)">19:20:51</span>                  fabrao </span><span>you can define many </span><code>ruleset</code><span> and apply it in your context, so you can dynamic it for your needs</span></div><div id="t1497039589762871" t="2017-06-09 20:19:49 mikerod There is no engine there, but I’m assuming you put it on top of something like datascript"><a href="#t1497039589762871" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-09</span> <span class="t" onclick="H(this)">20:19:49</span>                 mikerod </span><span>There is no engine there, but I’m assuming you put it on top of something like datascript</span></div><div id="t1497039598765491" t="2017-06-09 20:19:58 mikerod and I think you end up in a backwards-chaining situation there"><a href="#t1497039598765491" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-09</span> <span class="t" onclick="H(this)">20:19:58</span>                 mikerod </span><span>and I think you end up in a backwards-chaining situation there</span></div><div id="t1497039608768440" t="2017-06-09 20:20:08 mikerod which may be find and fit the need. I think it just comes down to what you want out of it."><a href="#t1497039608768440" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-09</span> <span class="t" onclick="H(this)">20:20:08</span>                 mikerod </span><span>which may be find and fit the need. I think it just comes down to what you want out of it.</span></div><div id="t1497039657782360" t="2017-06-09 20:20:57 mikerod also, you have to consider any performance concerns you may have, clj/cljs support (I think datalog-rules would be fine in either), etc"><a href="#t1497039657782360" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-09</span> <span class="t" onclick="H(this)">20:20:57</span>                 mikerod </span><span>also, you have to consider any performance concerns you may have, clj/cljs support (I think datalog-rules would be fine in either), etc</span></div><div id="t1497046055365498" t="2017-06-09 22:07:35 jfntn No I think conceptually we do want forward chaining and all the caching goodness from clara, just trying to wrap my head around what type of application-level integration we could have"><a href="#t1497046055365498" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-09</span> <span class="t" onclick="H(this)">22:07:35</span>                   jfntn </span><span>No I think conceptually we do want forward chaining and all the caching goodness from clara, just trying to wrap my head around what type of application-level integration we could have</span></div><div id="t1497053869406274" t="2017-06-10 00:17:49 mikegai @jfntn modeling a statechart should be no problem within a single session -- you just need to gate each rule controlling exit/enter with a &quot;gating condition&quot; that matches the current state."><a href="#t1497053869406274" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-10</span> <span class="t" onclick="H(this)">00:17:49</span>                 mikegai </span><span>@jfntn modeling a statechart should be no problem within a single session -- you just need to gate each rule controlling exit/enter with a &quot;gating condition&quot; that matches the current state.</span></div><div id="t1497053931411442" t="2017-06-10 00:18:51 mikegai The state chart syntax you supplied could be operated over and expanded to a set of rules, each of which begins with matching the state from which those entry/exits apply"><a href="#t1497053931411442" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-10</span> <span class="t" onclick="H(this)">00:18:51</span>                 mikegai </span><span>The state chart syntax you supplied could be operated over and expanded to a set of rules, each of which begins with matching the state from which those entry/exits apply</span></div><div id="t1497055725552508" t="2017-06-10 00:48:45 mikegai Maybe something like this (in tuple / #precept syntax instead of default Clara):
  (def-tuple-rule ready-exit-missing-password
  [[:app :state :login]]
  [[:login :state :ready]]
  [[_ :missing-email]]
  =&gt;
  (insert-unconditional! [[:login :state :password-error]]))"><a href="#t1497055725552508" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-10</span> <span class="t" onclick="H(this)">00:48:45</span>                 mikegai </span><span>Maybe something like this (in tuple / #precept syntax instead of default Clara):
 </span><pre>(def-tuple-rule ready-exit-missing-password
  [[:app :state :login]]
  [[:login :state :ready]]
  [[_ :missing-email]]
  =&gt;
  (insert-unconditional! [[:login :state :password-error]]))</pre></div><div id="t1497055782556648" t="2017-06-10 00:49:42 mikegai a macro would expand the concise statechart syntax to rules like that."><a href="#t1497055782556648" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-10</span> <span class="t" onclick="H(this)">00:49:42</span>                 mikegai </span><span>a macro would expand the concise statechart syntax to rules like that.</span></div><div id="t1497055820559460" t="2017-06-10 00:50:20 mikegai and then of course you could define/derive  :missing-email  elsewhere"><a href="#t1497055820559460" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-10</span> <span class="t" onclick="H(this)">00:50:20</span>                 mikegai </span><span>and then of course you could define/derive </span><code>:missing-email</code><span> elsewhere</span></div><div id="t1497055852561845" t="2017-06-10 00:50:52 mikegai @jfntn do I have what you&apos;re thinking right?"><a href="#t1497055852561845" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-10</span> <span class="t" onclick="H(this)">00:50:52</span>                 mikegai </span><span>@jfntn do I have what you&apos;re thinking right?</span></div><div id="t1498472399348657" t="2017-06-26 10:19:59 misha greetings!
Is using clara for sessions as small as single UI form – an overkill in context of mobile applications (e.g. React Native apps, where performance is more expensive than on desktop websites or backend)?"><a href="#t1498472399348657" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-26</span> <span class="t" onclick="H(this)">10:19:59</span>                   misha </span><span>greetings!
Is using clara for sessions as small as single UI form – an overkill in context of mobile applications (e.g. React Native apps, where performance is more expensive than on desktop websites or backend)?</span></div><div id="t1498487859530002" t="2017-06-26 14:37:39 mikerod @misha It could be. Even if not for performance, it may just be too complex of a tool for the job. What sort of reasons were you thinking that it may be helpful for a single form?"><a href="#t1498487859530002" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-26</span> <span class="t" onclick="H(this)">14:37:39</span>                 mikerod </span><span>@misha It could be. Even if not for performance, it may just be too complex of a tool for the job. What sort of reasons were you thinking that it may be helpful for a single form?</span></div><div id="t1498487870534274" t="2017-06-26 14:37:50 mikerod I guess I wouldn’t think a form would have enough complex control flow"><a href="#t1498487870534274" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-26</span> <span class="t" onclick="H(this)">14:37:50</span>                 mikerod </span><span>I guess I wouldn’t think a form would have enough complex control flow</span></div><div id="t1498488634844871" t="2017-06-26 14:50:34 misha by  form  I mean  registration/billing/etc.  form (just to clarify)"><a href="#t1498488634844871" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-26</span> <span class="t" onclick="H(this)">14:50:34</span>                   misha </span><span>by </span><code>form</code><span> I mean </span><code>registration/billing/etc.</code><span> form (just to clarify)</span></div><div id="t1498488719879664" t="2017-06-26 14:51:59 misha forms can get pretty complex, with all the fetching, autosuggesting, autocompleting, validation, etc."><a href="#t1498488719879664" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-26</span> <span class="t" onclick="H(this)">14:51:59</span>                   misha </span><span>forms can get pretty complex, with all the fetching, autosuggesting, autocompleting, validation, etc.</span></div><div id="t1498488919963819" t="2017-06-26 14:55:19 misha but what I am really after, is a way to manage lots of state, it can be as complex, as entire application state: think many dependent and independent widgets on the same screen, or  even many screens, but with routing implemented with rules too, instead of having it as a standalone thing with its own tools and approaches."><a href="#t1498488919963819" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-26</span> <span class="t" onclick="H(this)">14:55:19</span>                   misha </span><span>but what I am really after, is a way to manage lots of state, it can be as complex, as entire application state: think many dependent and independent widgets on the same screen, or  even many screens, but with routing implemented with rules too, instead of having it as a standalone thing with its own tools and approaches.</span></div><div id="t1498490626696835" t="2017-06-26 15:23:46 mikerod @misha yeah, that sounds interesting. I don’t know on the performance concerns. I’m not sure I’ve heard of someone using Clara on mobile applications to have anything to go off of."><a href="#t1498490626696835" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-26</span> <span class="t" onclick="H(this)">15:23:46</span>                 mikerod </span><span>@misha yeah, that sounds interesting. I don’t know on the performance concerns. I’m not sure I’ve heard of someone using Clara on mobile applications to have anything to go off of.</span></div><div id="t1498490652707293" t="2017-06-26 15:24:12 mikerod Also,  precept  seems to be using Clara in a somewhat similar way as you describe. However, I’m not sure it is handling routing."><a href="#t1498490652707293" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-26</span> <span class="t" onclick="H(this)">15:24:12</span>                 mikerod </span><span>Also, </span><code>precept</code><span> seems to be using Clara in a somewhat similar way as you describe. However, I’m not sure it is handling routing.</span></div><div id="t1498490663712191" t="2017-06-26 15:24:23 mikerod https://github.com/CoNarrative/precept"><a href="#t1498490663712191" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-26</span> <span class="t" onclick="H(this)">15:24:23</span>                 mikerod </span><a href="https://github.com/CoNarrative/precept" target="_blank">https://github.com/CoNarrative/precept</a></div><div id="t1498490706730691" t="2017-06-26 15:25:06 mikerod The space/time complexity of Clara is going to be reliant on the number of rules, complexity of the join conditions within the rules, and the size of facts in working memory."><a href="#t1498490706730691" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-26</span> <span class="t" onclick="H(this)">15:25:06</span>                 mikerod </span><span>The space/time complexity of Clara is going to be reliant on the number of rules, complexity of the join conditions within the rules, and the size of facts in working memory.</span></div><div id="t1498490722737327" t="2017-06-26 15:25:22 mikerod So you can get a pretty large range of performance characteristics depending on your use-case"><a href="#t1498490722737327" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-26</span> <span class="t" onclick="H(this)">15:25:22</span>                 mikerod </span><span>So you can get a pretty large range of performance characteristics depending on your use-case</span></div><div id="t1498490768757030" t="2017-06-26 15:26:08 mikerod The tendency of the rules network is to favor time over space. e.g. intermediate match state is saved to avoid recomputing values later. So a space vs time tradeoff."><a href="#t1498490768757030" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-26</span> <span class="t" onclick="H(this)">15:26:08</span>                 mikerod </span><span>The tendency of the rules network is to favor time over space. e.g. intermediate match state is saved to avoid recomputing values later. So a space vs time tradeoff.</span></div><div id="t1498490806773491" t="2017-06-26 15:26:46 mikerod If your working memory state isn’t prohibitively large though, the space may still be reasonable"><a href="#t1498490806773491" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-26</span> <span class="t" onclick="H(this)">15:26:46</span>                 mikerod </span><span>If your working memory state isn’t prohibitively large though, the space may still be reasonable</span></div><div id="t1498490808774002" t="2017-06-26 15:26:48 misha I am yet to read into precept, but guys do not hesitate to call it  framework , so I am being &quot;careful&quot; there :)"><a href="#t1498490808774002" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-26</span> <span class="t" onclick="H(this)">15:26:48</span>                   misha </span><span>I am yet to read into precept, but guys do not hesitate to call it </span><code>framework</code><span>, so I am being &quot;careful&quot; there :)</span></div><div id="t1498490981848788" t="2017-06-26 15:29:41 misha as far as mobile apps performance concerns go, I am worried about cpu speed at the moment, since I was forced to move datascript to a separate RN thread because of  pull  calls speed on a somewhat large db."><a href="#t1498490981848788" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-26</span> <span class="t" onclick="H(this)">15:29:41</span>                   misha </span><span>as far as mobile apps performance concerns go, I am worried about cpu speed at the moment, since I was forced to move datascript to a separate RN thread because of </span><code>pull</code><span> calls speed on a somewhat large db.</span></div><div id="t1498491073890480" t="2017-06-26 15:31:13 misha But I am looking at rule based systems™ from an application state management pov, which might be only few hundred kvs at most, I think"><a href="#t1498491073890480" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-26</span> <span class="t" onclick="H(this)">15:31:13</span>                   misha </span><span>But I am looking at rule based systems™ from an application state management pov, which might be only few hundred kvs at most, I think</span></div><div id="t1498496931183255" t="2017-06-26 17:08:51 zylox EDIT: i need to read better"><a href="#t1498496931183255" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-26</span> <span class="t" onclick="H(this)">17:08:51</span>                   zylox </span><span>EDIT: i need to read better</span></div><div id="t1498512716805979" t="2017-06-26 21:31:56 mikerod @misha well if cpu is your worry than at least Clara favors that over space usage"><a href="#t1498512716805979" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-26</span> <span class="t" onclick="H(this)">21:31:56</span>                 mikerod </span><span>@misha well if cpu is your worry than at least Clara favors that over space usage</span></div><div id="t1498512749815442" t="2017-06-26 21:32:29 mikerod It’d be cool if you could try it out and report back with how it performs in this mobile case"><a href="#t1498512749815442" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-26</span> <span class="t" onclick="H(this)">21:32:29</span>                 mikerod </span><span>It’d be cool if you could try it out and report back with how it performs in this mobile case</span></div><div id="t1498512771822019" t="2017-06-26 21:32:51 mikerod Nothing stands out to me as being too prohibitive"><a href="#t1498512771822019" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-26</span> <span class="t" onclick="H(this)">21:32:51</span>                 mikerod </span><span>Nothing stands out to me as being too prohibitive</span></div><div id="t1498514114178726" t="2017-06-26 21:55:14 misha @mikerod first, I need to start thinking in terms of rules, but as soon as will have something to show – I&apos;ll let you know."><a href="#t1498514114178726" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-26</span> <span class="t" onclick="H(this)">21:55:14</span>                   misha </span><span>@mikerod first, I need to start thinking in terms of rules, but as soon as will have something to show – I&apos;ll let you know.</span></div><div id="t1498514426258049" t="2017-06-26 22:00:26 mikerod sounds fun!"><a href="#t1498514426258049" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-26</span> <span class="t" onclick="H(this)">22:00:26</span>                 mikerod </span><span>sounds fun!</span></div><div id="t1498514477271277" t="2017-06-26 22:01:17 misha opieop"><a href="#t1498514477271277" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-26</span> <span class="t" onclick="H(this)">22:01:17</span>                   misha </span><b>opieop</b></div><div id="t1498583503232134" t="2017-06-27 17:11:43 devn howdy folks -- so, i have a base session which contains a bunch of configuration facts and what-not"><a href="#t1498583503232134" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-27</span> <span class="t" onclick="H(this)">17:11:43</span>                    devn </span><span>howdy folks -- so, i have a base session which contains a bunch of configuration facts and what-not</span></div><div id="t1498583575259622" t="2017-06-27 17:12:55 devn when the application receives a payload, we push those facts into the session and fire rules"><a href="#t1498583575259622" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-27</span> <span class="t" onclick="H(this)">17:12:55</span>                    devn </span><span>when the application receives a payload, we push those facts into the session and fire rules</span></div><div id="t1498583590265186" t="2017-06-27 17:13:10 devn but, if we have 10 concurrent requests  😬"><a href="#t1498583590265186" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-27</span> <span class="t" onclick="H(this)">17:13:10</span>                    devn </span><span>but, if we have 10 concurrent requests </span><b>😬</b></div><div id="t1498583612273652" t="2017-06-27 17:13:32 devn we had been doing these serially via a queue, but design is a-changin&apos; a bit"><a href="#t1498583612273652" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-27</span> <span class="t" onclick="H(this)">17:13:32</span>                    devn </span><span>we had been doing these serially via a queue, but design is a-changin&apos; a bit</span></div><div id="t1498699031507541" t="2017-06-29 01:17:11 cfleming Hi everyone - I develop Cursive, and I’ve been chatting to @zylox about the possibility of adding support for the Clara macros to Cursive."><a href="#t1498699031507541" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-29</span> <span class="t" onclick="H(this)">01:17:11</span>                cfleming </span><span>Hi everyone - I develop Cursive, and I’ve been chatting to @zylox about the possibility of adding support for the Clara macros to Cursive.</span></div><div id="t1498699074513550" t="2017-06-29 01:17:54 cfleming Since Cursive indexes source, it needs some support to understand macro forms - I’m planning to open an API for that, but that’s way off since it’s a large project."><a href="#t1498699074513550" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-29</span> <span class="t" onclick="H(this)">01:17:54</span>                cfleming </span><span>Since Cursive indexes source, it needs some support to understand macro forms - I’m planning to open an API for that, but that’s way off since it’s a large project.</span></div><div id="t1498699116519342" t="2017-06-29 01:18:36 cfleming One thing I’m interested in is being able to add support using grammars migrated from specs for macros, since I expect there will be more of them in the future."><a href="#t1498699116519342" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-29</span> <span class="t" onclick="H(this)">01:18:36</span>                cfleming </span><span>One thing I’m interested in is being able to add support using grammars migrated from specs for macros, since I expect there will be more of them in the future.</span></div><div id="t1498699160525390" t="2017-06-29 01:19:20 cfleming Has anyone investigated or thought about creating specs for the Clara macro forms? That would be a big help in adding support for them to Cursive."><a href="#t1498699160525390" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-29</span> <span class="t" onclick="H(this)">01:19:20</span>                cfleming </span><span>Has anyone investigated or thought about creating specs for the Clara macro forms? That would be a big help in adding support for them to Cursive.</span></div><div id="t1498699181528414" t="2017-06-29 01:19:41 cfleming As well as selfishly meaning that I can actually try to migrate some macro specs to Cursive - I haven’t seen any in the wild yet."><a href="#t1498699181528414" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-29</span> <span class="t" onclick="H(this)">01:19:41</span>                cfleming </span><span>As well as selfishly meaning that I can actually try to migrate some macro specs to Cursive - I haven’t seen any in the wild yet.</span></div><div id="t1498699229534859" t="2017-06-29 01:20:29 cfleming Since the macro forms also seem quite complex, it seems like having specs for them would also be generally useful to developers using Clara."><a href="#t1498699229534859" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-29</span> <span class="t" onclick="H(this)">01:20:29</span>                cfleming </span><span>Since the macro forms also seem quite complex, it seems like having specs for them would also be generally useful to developers using Clara.</span></div><div id="t1498702306961398" t="2017-06-29 02:11:46 ryanbrush @cfleming Hey, cool idea. I haven&apos;t really used specs for macros yet, but I think it would be straightforward to do so for Clara&apos;s macros. The structure is pretty well defined (the defrule and defquery macros already have a schema defining their return values) and has been stable for some time."><a href="#t1498702306961398" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-29</span> <span class="t" onclick="H(this)">02:11:46</span>               ryanbrush </span><span>@cfleming Hey, cool idea. I haven&apos;t really used specs for macros yet, but I think it would be straightforward to do so for Clara&apos;s macros. The structure is pretty well defined (the defrule and defquery macros already have a schema defining their return values) and has been stable for some time.</span></div><div id="t1498702350967335" t="2017-06-29 02:12:30 cfleming @ryanbrush Nice. So is there actually a grammar for the macros themselves anywhere? I see some railroad docs, but they seem incomplete."><a href="#t1498702350967335" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-29</span> <span class="t" onclick="H(this)">02:12:30</span>                cfleming </span><span>@ryanbrush Nice. So is there actually a grammar for the macros themselves anywhere? I see some railroad docs, but they seem incomplete.</span></div><div id="t1498702373970216" t="2017-06-29 02:12:53 cfleming The schema I guess is for the returned data, right? Not the actual macros?"><a href="#t1498702373970216" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-29</span> <span class="t" onclick="H(this)">02:12:53</span>                cfleming </span><span>The schema I guess is for the returned data, right? Not the actual macros?</span></div><div id="t1498702387971828" t="2017-06-29 02:13:07 ryanbrush We had written quite a bit of error handling code for malformed defrule macros to make it easier to debug, but we don&apos;t have a formal grammer besides the (incomplete) EBNF we used for the railroad docs.)"><a href="#t1498702387971828" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-29</span> <span class="t" onclick="H(this)">02:13:07</span>               ryanbrush </span><span>We had written quite a bit of error handling code for malformed defrule macros to make it easier to debug, but we don&apos;t have a formal grammer besides the (incomplete) EBNF we used for the railroad docs.)</span></div><div id="t1498702411974753" t="2017-06-29 02:13:31 ryanbrush Right, the schema is for the returned data."><a href="#t1498702411974753" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-29</span> <span class="t" onclick="H(this)">02:13:31</span>               ryanbrush </span><span>Right, the schema is for the returned data.</span></div><div id="t1498702432977410" t="2017-06-29 02:13:52 ryanbrush I agree this could be helpful for rule authors."><a href="#t1498702432977410" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-29</span> <span class="t" onclick="H(this)">02:13:52</span>               ryanbrush </span><span>I agree this could be helpful for rule authors.</span></div><div id="t1498702468981826" t="2017-06-29 02:14:28 cfleming Are there examples of Clara rules in any OSS projects? I don’t work with it myself so I’m not sure how a lot of the tricky cases (destructuring etc) work."><a href="#t1498702468981826" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-29</span> <span class="t" onclick="H(this)">02:14:28</span>                cfleming </span><span>Are there examples of Clara rules in any OSS projects? I don’t work with it myself so I’m not sure how a lot of the tricky cases (destructuring etc) work.</span></div><div id="t1498702619001494" t="2017-06-29 02:16:59 ryanbrush Sort of. The precent project ( https://github.com/CoNarrative/precept ) uses Clara, but is more of a wrapper so isn&apos;t the most common usage."><a href="#t1498702619001494" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-29</span> <span class="t" onclick="H(this)">02:16:59</span>               ryanbrush </span><span>Sort of. The precent project (</span><a href="https://github.com/CoNarrative/precept" target="_blank">https://github.com/CoNarrative/precept</a><span>) uses Clara, but is more of a wrapper so isn&apos;t the most common usage.</span></div><div id="t1498702629002728" t="2017-06-29 02:17:09 ryanbrush The best place for examples is probably the clara-examples project itself:  https://github.com/cerner/clara-examples/tree/master/src/main/clojure/clara/examples"><a href="#t1498702629002728" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-29</span> <span class="t" onclick="H(this)">02:17:09</span>               ryanbrush </span><span>The best place for examples is probably the clara-examples project itself: </span><a href="https://github.com/cerner/clara-examples/tree/master/src/main/clojure/clara/examples" target="_blank">https://github.com/cerner/clara-examples/tree/master/src/main/clojure/clara/examples</a></div><div id="t1498702706013009" t="2017-06-29 02:18:26 cfleming Thanks, I’ll take a look at those."><a href="#t1498702706013009" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-29</span> <span class="t" onclick="H(this)">02:18:26</span>                cfleming </span><span>Thanks, I’ll take a look at those.</span></div><div id="t1498729520511383" t="2017-06-29 09:45:20 flipmokid Hi, I&apos;d like to use Clara in my app which uses Component. I&apos;m currently scratching my head on how I can create a rule that when matched writes to a channel supplied by Component when the application starts. Would anyone be able to give me guidance on how I might do it?"><a href="#t1498729520511383" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-29</span> <span class="t" onclick="H(this)">09:45:20</span>               flipmokid </span><span>Hi, I&apos;d like to use Clara in my app which uses Component. I&apos;m currently scratching my head on how I can create a rule that when matched writes to a channel supplied by Component when the application starts. Would anyone be able to give me guidance on how I might do it?</span></div><div id="t1498752034015660" t="2017-06-29 16:00:34 flipmokid Okay silly me, I&apos;m adding the required components as facts and I can pull them out as needed in the rule for use in the right hand side."><a href="#t1498752034015660" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-29</span> <span class="t" onclick="H(this)">16:00:34</span>               flipmokid </span><span>Okay silly me, I&apos;m adding the required components as facts and I can pull them out as needed in the rule for use in the right hand side.</span></div><div id="t1498752556245561" t="2017-06-29 16:09:16 zylox i thought as much but i didnt know enough about Component to say anything haha"><a href="#t1498752556245561" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-29</span> <span class="t" onclick="H(this)">16:09:16</span>                   zylox </span><span>i thought as much but i didnt know enough about Component to say anything haha</span></div><div id="t1498772440688041" t="2017-06-29 21:40:40 devn @cfleming FWIW, I have a cursive license, we have 100s of hand-written rules, and would be happy to be a guinea pig"><a href="#t1498772440688041" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-29</span> <span class="t" onclick="H(this)">21:40:40</span>                    devn </span><span>@cfleming FWIW, I have a cursive license, we have 100s of hand-written rules, and would be happy to be a guinea pig</span></div><div id="t1498772548718310" t="2017-06-29 21:42:28 devn i could also share sanitized rules"><a href="#t1498772548718310" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-29</span> <span class="t" onclick="H(this)">21:42:28</span>                    devn </span><span>i could also share sanitized rules</span></div><div id="t1498817429227175" t="2017-06-30 10:10:29 flipmokid Hopefully a quick one, I&apos;m using clara with  :fact-type-fn (fn [[e a _]] a) . I&apos;m inserting a bunch of facts  e.g.

 (rules/insert-all session [[1 :event/eventTypeId 1]
                                          [1 :state/timeElapsed 19]
                                          [2 :event/eventTypeId 1]
                                          [2 :state/timeElapsed 23]])
 

to match with an example rule of

 (def football-over-20-mins-rule
  (clara-dsl/parse-rule
   [[:event/eventTypeId [[e a v]] (= 1 v) (= ?e e)]
    [:state/timeElapsed [[e a v]] (&gt; v 20) (= ?time v) (= ?e e)]]
   (println &quot;Event &quot; ?e &quot; has gone over 20 mins with &quot; ?time)))
 

At some point I want to retract all facts for a given &apos;e&apos;, as the event might have finished and I want to keep my facts lean. What is the best way of collecting all facts for matching &apos;e&apos; so that I can retract them all?"><a href="#t1498817429227175" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-30</span> <span class="t" onclick="H(this)">10:10:29</span>               flipmokid </span><span>Hopefully a quick one, I&apos;m using clara with </span><code>:fact-type-fn (fn [[e a _]] a)</code><span>. I&apos;m inserting a bunch of facts  e.g.

</span><pre>(rules/insert-all session [[1 :event/eventTypeId 1]
                                          [1 :state/timeElapsed 19]
                                          [2 :event/eventTypeId 1]
                                          [2 :state/timeElapsed 23]])
</pre><span>

to match with an example rule of

</span><pre>(def football-over-20-mins-rule
  (clara-dsl/parse-rule
   [[:event/eventTypeId [[e a v]] (= 1 v) (= ?e e)]
    [:state/timeElapsed [[e a v]] (&gt; v 20) (= ?time v) (= ?e e)]]
   (println &quot;Event &quot; ?e &quot; has gone over 20 mins with &quot; ?time)))
</pre><span>

At some point I want to retract all facts for a given &apos;e&apos;, as the event might have finished and I want to keep my facts lean. What is the best way of collecting all facts for matching &apos;e&apos; so that I can retract them all?</span></div><div id="t1498826538167293" t="2017-06-30 12:42:18 ryanbrush @flipmokid Your best bet is probably to write a query (via defquery) to get all facts for a given e, and then use retract to remove them. There isn&apos;t a retract-all (yet), but since it&apos;s a multi-arity function you can call it arbitrarily like (apply retract session [my-facts])"><a href="#t1498826538167293" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-30</span> <span class="t" onclick="H(this)">12:42:18</span>               ryanbrush </span><span>@flipmokid Your best bet is probably to write a query (via defquery) to get all facts for a given e, and then use retract to remove them. There isn&apos;t a retract-all (yet), but since it&apos;s a multi-arity function you can call it arbitrarily like (apply retract session [my-facts])</span></div><div id="t1498826770228509" t="2017-06-30 12:46:10 flipmokid Sorry, it&apos;s probably my bad understanding of rules but for my [e a v] fact type how would I get all e&apos;s out. As far as I understand the first part of a rule is the type (which is a) and so I&apos;m not sure how I would specify how to pull all entities of a particular number.

I&apos;m currently inserting a fact [e :event/retract true] and then trying to find these

[:event/retract [[e a v]] (= v true) (= ?e e)] but not sure how to get all matching facts that have the same e"><a href="#t1498826770228509" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-30</span> <span class="t" onclick="H(this)">12:46:10</span>               flipmokid </span><span>Sorry, it&apos;s probably my bad understanding of rules but for my [e a v] fact type how would I get all e&apos;s out. As far as I understand the first part of a rule is the type (which is a) and so I&apos;m not sure how I would specify how to pull all entities of a particular number.

I&apos;m currently inserting a fact [e :event/retract true] and then trying to find these

[:event/retract [[e a v]] (= v true) (= ?e e)] but not sure how to get all matching facts that have the same e</span></div><div id="t1498827539440917" t="2017-06-30 12:58:59 flipmokid I guess I just need someone to help me understand how to write a rule/query that can pull the e&apos;s (it&apos;s having to write the type at the start that is throwing me). I&apos;m not sure if I can check for the :event/retract fact and then have an accumulator to get all e&apos;s for it"><a href="#t1498827539440917" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-30</span> <span class="t" onclick="H(this)">12:58:59</span>               flipmokid </span><span>I guess I just need someone to help me understand how to write a rule/query that can pull the e&apos;s (it&apos;s having to write the type at the start that is throwing me). I&apos;m not sure if I can check for the :event/retract fact and then have an accumulator to get all e&apos;s for it</span></div><div id="t1498828102614147" t="2017-06-30 13:08:22 ryanbrush I think I see the sticking point here. You&apos;ll probably want to match a query on a special &quot;parent&quot; type of all (you can use clojure.core/derive to declare a parent type, which Clara will honor if it&apos;s done before the session is created.) Then the query can have a predicate to match on whatever subset you want."><a href="#t1498828102614147" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-30</span> <span class="t" onclick="H(this)">13:08:22</span>               ryanbrush </span><span>I think I see the sticking point here. You&apos;ll probably want to match a query on a special &quot;parent&quot; type of all (you can use clojure.core/derive to declare a parent type, which Clara will honor if it&apos;s done before the session is created.) Then the query can have a predicate to match on whatever subset you want.</span></div><div id="t1498828169634719" t="2017-06-30 13:09:29 ryanbrush ...or I suppose you could just have your fact match on java.lang.Object (assuming your running the Clojure rather than the ClojureScript version) and have your predicate check that."><a href="#t1498828169634719" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-30</span> <span class="t" onclick="H(this)">13:09:29</span>               ryanbrush </span><span>...or I suppose you could just have your fact match on java.lang.Object (assuming your running the Clojure rather than the ClojureScript version) and have your predicate check that.</span></div><div id="t1498829516075420" t="2017-06-30 13:31:56 flipmokid I&apos;m not sure derive will be of much help. For a fact  [e a v]   e  will always be a number (the id of the sporting event) which is not known in advance,  a  will be the attribute and  v  can be anything e.g. [1 :state/timeElapsed 19]

So do you think if I wanted to stick with my tuple-shaped facts it would be difficult to extract all  e s of the same value if my fact-type-fn is  (fn [[e a v]] a) ?

Out of interest do you know how Precept handles retractions of its tupled shaped facts?"><a href="#t1498829516075420" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-30</span> <span class="t" onclick="H(this)">13:31:56</span>               flipmokid </span><span>I&apos;m not sure derive will be of much help. For a fact </span><code>[e a v]</code><span> </span><code>e</code><span> will always be a number (the id of the sporting event) which is not known in advance, </span><code>a</code><span> will be the attribute and </span><code>v</code><span> can be anything e.g. [1 :state/timeElapsed 19]

So do you think if I wanted to stick with my tuple-shaped facts it would be difficult to extract all </span><code>e</code><span>s of the same value if my fact-type-fn is </span><code>(fn [[e a v]] a)</code><span>?

Out of interest do you know how Precept handles retractions of its tupled shaped facts?</span></div><div id="t1498829791171323" t="2017-06-30 13:36:31 ryanbrush If you know the values of a ahead of time then it derive could work, but might be painful to derive all of that. But a defquery approach might work like:"><a href="#t1498829791171323" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-30</span> <span class="t" onclick="H(this)">13:36:31</span>               ryanbrush </span><span>If you know the values of a ahead of time then it derive could work, but might be painful to derive all of that. But a defquery approach might work like:</span></div><div id="t1498829858194801" t="2017-06-30 13:37:38 ryanbrush  `(defquery [:e-to-remove] [Object [my-tuple] (= ?e-to-remove (first my-tuple))])"><a href="#t1498829858194801" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-30</span> <span class="t" onclick="H(this)">13:37:38</span>               ryanbrush </span><code></code><span>`(defquery [:e-to-remove] [Object [my-tuple] (= ?e-to-remove (first my-tuple))])</span></div><div id="t1498829879202177" t="2017-06-30 13:37:59 ryanbrush Haven&apos;t actually tried that, but it&apos;s an idea to try with. I&apos;m not familiar with how Precept handles this sort of thing."><a href="#t1498829879202177" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-30</span> <span class="t" onclick="H(this)">13:37:59</span>               ryanbrush </span><span>Haven&apos;t actually tried that, but it&apos;s an idea to try with. I&apos;m not familiar with how Precept handles this sort of thing.</span></div><div id="t1498829935221798" t="2017-06-30 13:38:55 flipmokid That looks interesting, let me give it a go"><a href="#t1498829935221798" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-30</span> <span class="t" onclick="H(this)">13:38:55</span>               flipmokid </span><span>That looks interesting, let me give it a go</span></div><div id="t1498830103283213" t="2017-06-30 13:41:43 ryanbrush Sounds good. There are some steps I left out...you&apos;ll want to return the full tuples from the query, for instance, so they can be retracted."><a href="#t1498830103283213" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-30</span> <span class="t" onclick="H(this)">13:41:43</span>               ryanbrush </span><span>Sounds good. There are some steps I left out...you&apos;ll want to return the full tuples from the query, for instance, so they can be retracted.</span></div><div id="t1498831116664196" t="2017-06-30 13:58:36 flipmokid Actually, I&apos;m not sure the Object part will match as I&apos;m not using the type function (please let me know if I&apos;m being stupid though, I often am!)

(defquery [:e-to-remove] [Object [my-tuple] (= ?e-to-remove (first my-tuple))])"><a href="#t1498831116664196" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-30</span> <span class="t" onclick="H(this)">13:58:36</span>               flipmokid </span><span>Actually, I&apos;m not sure the Object part will match as I&apos;m not using the type function (please let me know if I&apos;m being stupid though, I often am!)

(defquery [:e-to-remove] [Object [my-tuple] (= ?e-to-remove (first my-tuple))])</span></div><div id="t1498831802937401" t="2017-06-30 14:10:02 ryanbrush Ah, of course. You&apos;ll need a custom ancestors function to complement the custom type function. There is an example here:  http://www.clara-rules.org/docs/fact_type_customization/"><a href="#t1498831802937401" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-30</span> <span class="t" onclick="H(this)">14:10:02</span>               ryanbrush </span><span>Ah, of course. You&apos;ll need a custom ancestors function to complement the custom type function. There is an example here: </span><a href="http://www.clara-rules.org/docs/fact_type_customization/" target="_blank">http://www.clara-rules.org/docs/fact_type_customization/</a></div><div id="t1498831838951854" t="2017-06-30 14:10:38 ryanbrush So your custom ancestor could just return :all-facts if you wanted to match everything.  😉"><a href="#t1498831838951854" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-30</span> <span class="t" onclick="H(this)">14:10:38</span>               ryanbrush </span><span>So your custom ancestor could just return :all-facts if you wanted to match everything. </span><b>😉</b></div><div id="t1498831872964948" t="2017-06-30 14:11:12 ryanbrush (:all-facts is just an arbitrary keyword here that could be returned by the ancestors function.)"><a href="#t1498831872964948" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-30</span> <span class="t" onclick="H(this)">14:11:12</span>               ryanbrush </span><span>(:all-facts is just an arbitrary keyword here that could be returned by the ancestors function.)</span></div><div id="t1498834095057825" t="2017-06-30 14:48:15 flipmokid Ah okay. I&apos;ll try that. Thanks for your help so far, I really appreciate it"><a href="#t1498834095057825" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-30</span> <span class="t" onclick="H(this)">14:48:15</span>               flipmokid </span><span>Ah okay. I&apos;ll try that. Thanks for your help so far, I really appreciate it</span></div><div id="t1498836138916786" t="2017-06-30 15:22:18 flipmokid Brilliant that worked!

 (def retractions-rule
  (clara-dsl/parse-rule
   [[:event/retract [[e a v]] (= v true) (= e ?e)]
    [?elems &lt;- (acc/all) :from [::all [[e _ _]] (= e ?e)]]]
   (println &quot;RETRACTION MATCHED &quot; ?elems)))
 
Many thanks for your help"><a href="#t1498836138916786" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-30</span> <span class="t" onclick="H(this)">15:22:18</span>               flipmokid </span><span>Brilliant that worked!

</span><pre>(def retractions-rule
  (clara-dsl/parse-rule
   [[:event/retract [[e a v]] (= v true) (= e ?e)]
    [?elems &lt;- (acc/all) :from [::all [[e _ _]] (= e ?e)]]]
   (println &quot;RETRACTION MATCHED &quot; ?elems)))
</pre><span>
Many thanks for your help</span></div><div id="t1498836815192456" t="2017-06-30 15:33:35 ryanbrush Nice!"><a href="#t1498836815192456" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-06-30</span> <span class="t" onclick="H(this)">15:33:35</span>               ryanbrush </span><span>Nice!</span></div><div id="t1499000793919491" t="2017-07-02 13:06:33 ryanbrush Just released clara-rules 0.15.1! Details in the change log:  https://github.com/cerner/clara-rules/blob/master/CHANGELOG.md#0151"><a href="#t1499000793919491" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-07-02</span> <span class="t" onclick="H(this)">13:06:33</span>               ryanbrush </span><span>Just released clara-rules 0.15.1! Details in the change log: </span><a href="https://github.com/cerner/clara-rules/blob/master/CHANGELOG.md#0151" target="_blank">https://github.com/cerner/clara-rules/blob/master/CHANGELOG.md#0151</a></div><div id="t1499348270876070" t="2017-07-06 13:37:50 souenzzo Can I write a rule that check if  there is some other rule that match facts of type x"><a href="#t1499348270876070" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-07-06</span> <span class="t" onclick="H(this)">13:37:50</span>                souenzzo </span><span>Can I write a rule that check if </span><code>there is some other rule that match facts of type x</code></div><div id="t1499348273877551" t="2017-07-06 13:37:53 souenzzo ?"><a href="#t1499348273877551" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-07-06</span> <span class="t" onclick="H(this)">13:37:53</span>                souenzzo </span><span>?</span></div><div id="t1499349661698443" t="2017-07-06 14:01:01 zylox unless you fed rules into the session as facts, not that i know of"><a href="#t1499349661698443" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-07-06</span> <span class="t" onclick="H(this)">14:01:01</span>                   zylox </span><span>unless you fed rules into the session as facts, not that i know of</span></div><div id="t1499349718734682" t="2017-07-06 14:01:58 zylox if you had the rules stored somewhere your right hand side could execute some sort of static introspection i guess"><a href="#t1499349718734682" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-07-06</span> <span class="t" onclick="H(this)">14:01:58</span>                   zylox </span><span>if you had the rules stored somewhere your right hand side could execute some sort of static introspection i guess</span></div><div id="t1499475203628554" t="2017-07-08 00:53:23 dragoncube Withing REPL are newly defined rules are picking up? I create session with mk-session and :cache false"><a href="#t1499475203628554" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-07-08</span> <span class="t" onclick="H(this)">00:53:23</span>              dragoncube </span><span>Withing REPL are newly defined rules are picking up? I create session with mk-session and :cache false</span></div><div id="t1499477302835704" t="2017-07-08 01:28:22 ryanbrush mk-session should pick up new rules in the REPL. It will only look in the current namespace, though, unless you are explicitly passing namespaces."><a href="#t1499477302835704" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-07-08</span> <span class="t" onclick="H(this)">01:28:22</span>               ryanbrush </span><span>mk-session should pick up new rules in the REPL. It will only look in the current namespace, though, unless you are explicitly passing namespaces.</span></div><div id="t1499495667124166" t="2017-07-08 06:34:27 dragoncube @ryanbrush so I need to call mk-session again? if so, is there any way to transfer facts from one session to another? or maybe fire-rules would be enough?"><a href="#t1499495667124166" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-07-08</span> <span class="t" onclick="H(this)">06:34:27</span>              dragoncube </span><span>@ryanbrush so I need to call mk-session again? if so, is there any way to transfer facts from one session to another? or maybe fire-rules would be enough?</span></div><div id="t1499525700142665" t="2017-07-08 14:55:00 ryanbrush You&apos;ll need to pass in your facts into the new session again. Clara won&apos;t do this automatically, but I usually reload the facts or keep them in a list."><a href="#t1499525700142665" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-07-08</span> <span class="t" onclick="H(this)">14:55:00</span>               ryanbrush </span><span>You&apos;ll need to pass in your facts into the new session again. Clara won&apos;t do this automatically, but I usually reload the facts or keep them in a list.</span></div><div id="t1499547807116234" t="2017-07-08 21:03:27 dragoncube I see, so I need to write small wrapper for insert-fact, retract-fact which would store facts in separate collection. Then use this collection then I need to re-init session."><a href="#t1499547807116234" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-07-08</span> <span class="t" onclick="H(this)">21:03:27</span>              dragoncube </span><span>I see, so I need to write small wrapper for insert-fact, retract-fact which would store facts in separate collection. Then use this collection then I need to re-init session.</span></div><div id="t1499549248225562" t="2017-07-08 21:27:28 ryanbrush Yes, that would do it."><a href="#t1499549248225562" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-07-08</span> <span class="t" onclick="H(this)">21:27:28</span>               ryanbrush </span><span>Yes, that would do it.</span></div><div id="t1499550257299068" t="2017-07-08 21:44:17 dragoncube Thanks!"><a href="#t1499550257299068" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-07-08</span> <span class="t" onclick="H(this)">21:44:17</span>              dragoncube </span><span>Thanks!</span></div><div id="t1499966567470134" t="2017-07-13 17:22:47 fmjrey Hi, new to clara here, and having difficulties with query parameters, is there an example of query with parameters that I could look at somewhere?"><a href="#t1499966567470134" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-07-13</span> <span class="t" onclick="H(this)">17:22:47</span>                  fmjrey </span><span>Hi, new to clara here, and having difficulties with query parameters, is there an example of query with parameters that I could look at somewhere?</span></div><div id="t1499967120794597" t="2017-07-13 17:32:00 nickowsy hey @fmjrey, have you taken a look at  https://github.com/cerner/clara-examples ?"><a href="#t1499967120794597" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-07-13</span> <span class="t" onclick="H(this)">17:32:00</span>                nickowsy </span><span>hey @fmjrey, have you taken a look at </span><a href="https://github.com/cerner/clara-examples" target="_blank">https://github.com/cerner/clara-examples</a><span>?</span></div><div id="t1499967161819254" t="2017-07-13 17:32:41 fmjrey yes I did, unless I missed it I have only seen query without params"><a href="#t1499967161819254" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-07-13</span> <span class="t" onclick="H(this)">17:32:41</span>                  fmjrey </span><span>yes I did, unless I missed it I have only seen query without params</span></div><div id="t1499967305903004" t="2017-07-13 17:35:05 nickowsy ahh, that could be.  A very simple example  (defquery get-promotions
  &quot;Query to find promotions for the purchase.&quot;
  [:?type]
  [?promotion &lt;- Promotion (= ?type type)])"><a href="#t1499967305903004" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-07-13</span> <span class="t" onclick="H(this)">17:35:05</span>                nickowsy </span><span>ahh, that could be.  A very simple example </span><pre>(defquery get-promotions
  &quot;Query to find promotions for the purchase.&quot;
  [:?type]
  [?promotion &lt;- Promotion (= ?type type)])</pre></div><div id="t1499967316909165" t="2017-07-13 17:35:16 nickowsy (query session get-promotions :?type :lunch)"><a href="#t1499967316909165" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-07-13</span> <span class="t" onclick="H(this)">17:35:16</span>                nickowsy </span><pre>(query session get-promotions :?type :lunch)</pre></div><div id="t1499967349928401" t="2017-07-13 17:35:49 nickowsy that example is from the docs. Are you trying to do something more complicated?"><a href="#t1499967349928401" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-07-13</span> <span class="t" onclick="H(this)">17:35:49</span>                nickowsy </span><span>that example is from the docs. Are you trying to do something more complicated?</span></div><div id="t1499967384949041" t="2017-07-13 17:36:24 fmjrey yeah I saw that example, and now looking at this:
 https://github.com/cerner/clara-rules/blob/cbecbdf916625a46ee93e7c84ed411aab3f1dbc1/src/test/clojure/clara/test_java.clj#L51"><a href="#t1499967384949041" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-07-13</span> <span class="t" onclick="H(this)">17:36:24</span>                  fmjrey </span><span>yeah I saw that example, and now looking at this:
</span><a href="https://github.com/cerner/clara-rules/blob/cbecbdf916625a46ee93e7c84ed411aab3f1dbc1/src/test/clojure/clara/test_java.clj#L51" target="_blank">https://github.com/cerner/clara-rules/blob/cbecbdf916625a46ee93e7c84ed411aab3f1dbc1/src/test/clojure/clara/test_java.clj#L51</a></div><div id="t1499967428974844" t="2017-07-13 17:37:08 fmjrey this is a java based example, which looks like it uses strings as map keys, will try that now"><a href="#t1499967428974844" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-07-13</span> <span class="t" onclick="H(this)">17:37:08</span>                  fmjrey </span><span>this is a java based example, which looks like it uses strings as map keys, will try that now</span></div><div id="t1499972876179787" t="2017-07-13 19:07:56 fmjrey I think I found the issue, I use query variables in some nested part of the expression, as the long error message says."><a href="#t1499972876179787" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-07-13</span> <span class="t" onclick="H(this)">19:07:56</span>                  fmjrey </span><span>I think I found the issue, I use query variables in some nested part of the expression, as the long error message says.</span></div><div id="t1499972940213620" t="2017-07-13 19:09:00 fmjrey Basically this does not work:
 (defquery get-feature
  [:?type :?name :?data]
  [?feature &lt;- Feature (= descriptor [?type ?name ?data])])
"><a href="#t1499972940213620" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-07-13</span> <span class="t" onclick="H(this)">19:09:00</span>                  fmjrey </span><span>Basically this does not work:
</span><pre>(defquery get-feature
  [:?type :?name :?data]
  [?feature &lt;- Feature (= descriptor [?type ?name ?data])])
</pre></div><div id="t1499972987238507" t="2017-07-13 19:09:47 fmjrey But this does:
 (defquery get-feature
  [:?d]
  [?feature &lt;- Feature (= descriptor ?d)])
"><a href="#t1499972987238507" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-07-13</span> <span class="t" onclick="H(this)">19:09:47</span>                  fmjrey </span><span>But this does:
</span><pre>(defquery get-feature
  [:?d]
  [?feature &lt;- Feature (= descriptor ?d)])
</pre></div><div id="t1499973042267318" t="2017-07-13 19:10:42 fmjrey Thanks @nickowsy for trying  🙂"><a href="#t1499973042267318" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-07-13</span> <span class="t" onclick="H(this)">19:10:42</span>                  fmjrey </span><span>Thanks @nickowsy for trying </span><b>🙂</b></div><div id="t1499973236368632" t="2017-07-13 19:13:56 nickowsy :+1:"><a href="#t1499973236368632" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-07-13</span> <span class="t" onclick="H(this)">19:13:56</span>                nickowsy </span><b>:+1:</b></div><div id="t1499982815197746" t="2017-07-13 21:53:35 wparker @fmjrey the params have to be in the query conditions  (defquery get-feature
  [:?type :?name :?data]
  [?feature &lt;- Feature (= descriptor [?type ?name ?data])])   is trying to use bindings in the Feature condition without creating them"><a href="#t1499982815197746" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-07-13</span> <span class="t" onclick="H(this)">21:53:35</span>                 wparker </span><span>@fmjrey the params have to be in the query conditions </span><pre>(defquery get-feature
  [:?type :?name :?data]
  [?feature &lt;- Feature (= descriptor [?type ?name ?data])]) </pre><span> is trying to use bindings in the Feature condition without creating them</span></div><div id="t1499982828202879" t="2017-07-13 21:53:48 wparker the use in the params doesn’t create them, that is for indexing into the query results later"><a href="#t1499982828202879" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-07-13</span> <span class="t" onclick="H(this)">21:53:48</span>                 wparker </span><span>the use in the params doesn’t create them, that is for indexing into the query results later</span></div><div id="t1499982935243888" t="2017-07-13 21:55:35 wparker Basically the query params won’t make an otherwise-invalid query valid, they just control how you’ll view the data later when using the query results"><a href="#t1499982935243888" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-07-13</span> <span class="t" onclick="H(this)">21:55:35</span>                 wparker </span><span>Basically the query params won’t make an otherwise-invalid query valid, they just control how you’ll view the data later when using the query results</span></div><div id="t1499983039284009" t="2017-07-13 21:57:19 wparker So in the “promotion type” example in the doc, you’ll provide a type to query for, and you’ll only get results back of that type; without the param you’d get back other types as well"><a href="#t1499983039284009" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-07-13</span> <span class="t" onclick="H(this)">21:57:19</span>                 wparker </span><span>So in the “promotion type” example in the doc, you’ll provide a type to query for, and you’ll only get results back of that type; without the param you’d get back other types as well</span></div><div id="t1499983057290843" t="2017-07-13 21:57:37 wparker This is the key line of code:  https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/rules/engine.cljc#L1960"><a href="#t1499983057290843" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-07-13</span> <span class="t" onclick="H(this)">21:57:37</span>                 wparker </span><span>This is the key line of code: </span><a href="https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/rules/engine.cljc#L1960" target="_blank">https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/rules/engine.cljc#L1960</a></div><div id="t1499989225170834" t="2017-07-13 23:40:25 dadair Is there a way to react to retractions? I&apos;m using facts to generate tree manipulation functions (i.e., if FactA, AddChildToSomeTree), and want to be able to remove that tree node if the Fact is retracted"><a href="#t1499989225170834" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-07-13</span> <span class="t" onclick="H(this)">23:40:25</span>                  dadair </span><span>Is there a way to react to retractions? I&apos;m using facts to generate tree manipulation functions (i.e., if FactA, AddChildToSomeTree), and want to be able to remove that tree node if the Fact is retracted</span></div><div id="t1499993416108925" t="2017-07-14 00:50:16 dadair Sorry I should add that these are automatic retractions of derived/sourced facts"><a href="#t1499993416108925" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-07-14</span> <span class="t" onclick="H(this)">00:50:16</span>                  dadair </span><span>Sorry I should add that these are automatic retractions of derived/sourced facts</span></div><div id="t1500044094391412" t="2017-07-14 14:54:54 wparker @dadair it sounds like you’re describing truth maintenance so perhaps that will meet your needs  http://www.clara-rules.org/docs/truthmaint/"><a href="#t1500044094391412" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-07-14</span> <span class="t" onclick="H(this)">14:54:54</span>                 wparker </span><span>@dadair it sounds like you’re describing truth maintenance so perhaps that will meet your needs </span><a href="http://www.clara-rules.org/docs/truthmaint/" target="_blank">http://www.clara-rules.org/docs/truthmaint/</a></div><div id="t1500319890026048" t="2017-07-17 19:31:30 wparker clara-rules 0.15.2 is released and on Clojars.  This was a fix release for a bug in the distinct accumulator."><a href="#t1500319890026048" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-07-17</span> <span class="t" onclick="H(this)">19:31:30</span>                 wparker </span><span>clara-rules 0.15.2 is released and on Clojars.  This was a fix release for a bug in the distinct accumulator.</span></div><div id="t1500567004613661" t="2017-07-20 16:10:04 misha greetings! What can I read on combining event sourcing with rule engines? Or about any  rules&lt;-&gt; (finite) state machines  transitions."><a href="#t1500567004613661" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-07-20</span> <span class="t" onclick="H(this)">16:10:04</span>                   misha </span><span>greetings! What can I read on combining event sourcing with rule engines? Or about any </span><code>rules&lt;-&gt; (finite) state machines</code><span> transitions.</span></div><div id="t1500936948345390" t="2017-07-24 22:55:48 wparker @misha you might try the Google Groups mailing list as well, I know some people have considered using Clara for event processing before.  Regarding finite state machines, keep in mind that Clara supports arbitrary code, notably in the RHS (consequences) of rules, so the ability to introspect is limited if your application doesn’t add further restrictions."><a href="#t1500936948345390" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-07-24</span> <span class="t" onclick="H(this)">22:55:48</span>                 wparker </span><span>@misha you might try the Google Groups mailing list as well, I know some people have considered using Clara for event processing before.  Regarding finite state machines, keep in mind that Clara supports arbitrary code, notably in the RHS (consequences) of rules, so the ability to introspect is limited if your application doesn’t add further restrictions.</span></div><div id="t1500970596617619" t="2017-07-25 08:16:36 misha @wparker thanks, will check it out.
to have a real life value, FSMs need to support arbitrary code (i/o) execution as part (or as a consequence) of the state&apos;s transitions as well, so that comes down to a design decisions in both cases.
In the exercise app I am (re)writing now - html5 video/audio tags are basically i/o, as far as the rest of the buttons in UI are concerned, despite those tags being their own FSMs."><a href="#t1500970596617619" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-07-25</span> <span class="t" onclick="H(this)">08:16:36</span>                   misha </span><span>@wparker thanks, will check it out.
to have a real life value, FSMs need to support arbitrary code (i/o) execution as part (or as a consequence) of the state&apos;s transitions as well, so that comes down to a design decisions in both cases.
In the exercise app I am (re)writing now - html5 video/audio tags are basically i/o, as far as the rest of the buttons in UI are concerned, despite those tags being their own FSMs.</span></div><div id="t1501104444522141" t="2017-07-26 21:27:24 wparker @U051HUZLD I was thinking of mainly what types the rules could insert; given an arbitrary set of rules one can’t infer which other rules a given rule could trigger.  It is possible to add metadata of some kind specifying this or to parse it if you restrict the RHS code you write to something you can reliably parse.  This seemed possibly relevant if you were trying to translate rules to a FSM, specifically w.r.t. the allowed state transitions."><a href="#t1501104444522141" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-07-26</span> <span class="t" onclick="H(this)">21:27:24</span>                      wparker </span><span>@U051HUZLD I was thinking of mainly what types the rules could insert; given an arbitrary set of rules one can’t infer which other rules a given rule could trigger.  It is possible to add metadata of some kind specifying this or to parse it if you restrict the RHS code you write to something you can reliably parse.  This seemed possibly relevant if you were trying to translate rules to a FSM, specifically w.r.t. the allowed state transitions.</span></div><div id="t1500998915773029" t="2017-07-25 16:08:35 iku000888 Is it possible to use protocol methods in the left hand side of rules?"><a href="#t1500998915773029" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-07-25</span> <span class="t" onclick="H(this)">16:08:35</span>               iku000888 </span><span>Is it possible to use protocol methods in the left hand side of rules?</span></div><div id="t1500998950795420" t="2017-07-25 16:09:10 iku000888 I have a vague feeling it would violate clara&apos;s design but cannot articulate why  🙂"><a href="#t1500998950795420" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-07-25</span> <span class="t" onclick="H(this)">16:09:10</span>               iku000888 </span><span>I have a vague feeling it would violate clara&apos;s design but cannot articulate why </span><b>🙂</b></div><div id="t1500999160932944" t="2017-07-25 16:12:40 ryanbrush Yes, the LHS supports arbitrary Clojure expressions, including protocol methods."><a href="#t1500999160932944" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-07-25</span> <span class="t" onclick="H(this)">16:12:40</span>               ryanbrush </span><span>Yes, the LHS supports arbitrary Clojure expressions, including protocol methods.</span></div><div id="t1500999621223019" t="2017-07-25 16:20:21 iku000888 Would you be kind to give an example?"><a href="#t1500999621223019" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-07-25</span> <span class="t" onclick="H(this)">16:20:21</span>               iku000888 </span><span>Would you be kind to give an example?</span></div><div id="t1500999666250502" t="2017-07-25 16:21:06 iku000888 Having trouble wrapping my head around how to refer to the instance showing up in the LHS"><a href="#t1500999666250502" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-07-25</span> <span class="t" onclick="H(this)">16:21:06</span>               iku000888 </span><span>Having trouble wrapping my head around how to refer to the instance showing up in the LHS</span></div><div id="t1500999740297338" t="2017-07-25 16:22:20 iku000888 (defprotocol IFoo
  (test-foo [this]))

(defrule is-foo
  [IFoo (test-foo ?not sure how to express?)]
  =&gt;...)"><a href="#t1500999740297338" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-07-25</span> <span class="t" onclick="H(this)">16:22:20</span>               iku000888 </span><pre>(defprotocol IFoo
  (test-foo [this]))

(defrule is-foo
  [IFoo (test-foo ?not sure how to express?)]
  =&gt;...)</pre></div><div id="t1500999784324767" t="2017-07-25 16:23:04 iku000888 @ryanbrush Thanks for the help in advance  🙂"><a href="#t1500999784324767" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-07-25</span> <span class="t" onclick="H(this)">16:23:04</span>               iku000888 </span><span>@ryanbrush Thanks for the help in advance </span><b>🙂</b></div><div id="t1500999876381627" t="2017-07-25 16:24:36 ryanbrush @iku000888 Ahh, I thought you meant calling protocol-based methods on the LHS. The type the rules matches needs to be an actual type, either a Java type or a Clojure type via deftype."><a href="#t1500999876381627" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-07-25</span> <span class="t" onclick="H(this)">16:24:36</span>               ryanbrush </span><span>@iku000888 Ahh, I thought you meant calling protocol-based methods on the LHS. The type the rules matches needs to be an actual type, either a Java type or a Clojure type via deftype.</span></div><div id="t1500999913404868" t="2017-07-25 16:25:13 ryanbrush (The one exception is customized &quot;types&quot; discussed here, but this probably isn&apos;t applicable to your discussion:  http://www.clara-rules.org/docs/fact_type_customization/)"><a href="#t1500999913404868" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-07-25</span> <span class="t" onclick="H(this)">16:25:13</span>               ryanbrush </span><span>(The one exception is customized &quot;types&quot; discussed here, but this probably isn&apos;t applicable to your discussion: </span><a href="http://www.clara-rules.org/docs/fact_type_customization/)" target="_blank">http://www.clara-rules.org/docs/fact_type_customization/)</a></div><div id="t1500999964436506" t="2017-07-25 16:26:04 ryanbrush One correction: I meant clojure.core/derive rather than deftype above."><a href="#t1500999964436506" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-07-25</span> <span class="t" onclick="H(this)">16:26:04</span>               ryanbrush </span><span>One correction: I meant clojure.core/derive rather than deftype above.</span></div><div id="t1501000015468909" t="2017-07-25 16:26:55 iku000888 I think I understand"><a href="#t1501000015468909" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-07-25</span> <span class="t" onclick="H(this)">16:26:55</span>               iku000888 </span><span>I think I understand</span></div><div id="t1501000072503938" t="2017-07-25 16:27:52 iku000888 Just thought at first glance I could reify a bunch of stuff and passing it through rules would be a usecase"><a href="#t1501000072503938" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-07-25</span> <span class="t" onclick="H(this)">16:27:52</span>               iku000888 </span><span>Just thought at first glance I could reify a bunch of stuff and passing it through rules would be a usecase</span></div><div id="t1501000131540435" t="2017-07-25 16:28:51 iku000888 Thanks for clarifying! Much appreciate your time."><a href="#t1501000131540435" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-07-25</span> <span class="t" onclick="H(this)">16:28:51</span>               iku000888 </span><span>Thanks for clarifying! Much appreciate your time.</span></div><div id="t1501000138544419" t="2017-07-25 16:28:58 iku000888 🙇"><a href="#t1501000138544419" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-07-25</span> <span class="t" onclick="H(this)">16:28:58</span>               iku000888 </span><b>🙇</b></div><div id="t1501000397706730" t="2017-07-25 16:33:17 iku000888 (defprotocol IFoo
  (test-foo [this]))

(deftype Foo []
  IFoo
  (test-foo [this] true))

(defrule is-foo
  [Foo (test-foo ?not sure how to express?)]
  =&gt; (println &quot;is a foo&quot;))"><a href="#t1501000397706730" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-07-25</span> <span class="t" onclick="H(this)">16:33:17</span>               iku000888 </span><pre>(defprotocol IFoo
  (test-foo [this]))

(deftype Foo []
  IFoo
  (test-foo [this] true))

(defrule is-foo
  [Foo (test-foo ?not sure how to express?)]
  =&gt; (println &quot;is a foo&quot;))</pre></div><div id="t1501000432728706" t="2017-07-25 16:33:52 iku000888 Wait, so if it is an actual type I can invoke protocol methods?"><a href="#t1501000432728706" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-07-25</span> <span class="t" onclick="H(this)">16:33:52</span>               iku000888 </span><span>Wait, so if it is an actual type I can invoke protocol methods?</span></div><div id="t1501105196870531" t="2017-07-26 21:39:56 wparker Heads up about something potentially tricky: If you’re on the JVM when you create a protocol, behind the scenes Clojure creates a corresponding Java interface of the same name.  An interface is a type that you can write rules against, but it might not do what you expect.  Only types that Clojure knows satisfy the protocol at the time of their creation will implement the interface.  For example:"><a href="#t1501105196870531" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-07-26</span> <span class="t" onclick="H(this)">21:39:56</span>                      wparker </span><span>Heads up about something potentially tricky: If you’re on the JVM when you create a protocol, behind the scenes Clojure creates a corresponding Java interface of the same name.  An interface is a type that you can write rules against, but it might not do what you expect.  Only types that Clojure knows satisfy the protocol at the time of their creation will implement the interface.  For example:</span></div><div id="t1501105220881389" t="2017-07-26 21:40:20 wparker ` user=&gt; (defprotocol MyProtocol (proto-method [_]))
MyProtocol
user=&gt; (defrecord MyRecord1 [] MyProtocol (proto-method [_] &quot;Hello World&quot;))
user.MyRecord1
user=&gt; (defrecord MyRecord2 [])
user.MyRecord2
user=&gt; (extend-type MyRecord2 MyProtocol (proto-method [_] &quot;Hi World&quot;))
nil
user=&gt; (proto-method (-&gt;MyRecord1))
&quot;Hello World&quot;
user=&gt; (proto-method (-&gt;MyRecord2))
&quot;Hi World&quot;
user=&gt; (instance? user.MyProtocol (-&gt;MyRecord1))
true
user=&gt; (instance? user.MyProtocol (-&gt;MyRecord2))
false  `"><a href="#t1501105220881389" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-07-26</span> <span class="t" onclick="H(this)">21:40:20</span>                      wparker </span><pre>` user=&gt; (defprotocol MyProtocol (proto-method [_]))
MyProtocol
user=&gt; (defrecord MyRecord1 [] MyProtocol (proto-method [_] &quot;Hello World&quot;))
user.MyRecord1
user=&gt; (defrecord MyRecord2 [])
user.MyRecord2
user=&gt; (extend-type MyRecord2 MyProtocol (proto-method [_] &quot;Hi World&quot;))
nil
user=&gt; (proto-method (-&gt;MyRecord1))
&quot;Hello World&quot;
user=&gt; (proto-method (-&gt;MyRecord2))
&quot;Hi World&quot;
user=&gt; (instance? user.MyProtocol (-&gt;MyRecord1))
true
user=&gt; (instance? user.MyProtocol (-&gt;MyRecord2))
false </pre><span>`</span></div><div id="t1501105378952224" t="2017-07-26 21:42:58 wparker In another ns you could potentially import the interface rather than the protocol depending on how you set up your ns header i.e. import vs require on it"><a href="#t1501105378952224" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-07-26</span> <span class="t" onclick="H(this)">21:42:58</span>                      wparker </span><span>In another ns you could potentially import the interface rather than the protocol depending on how you set up your ns header i.e. import vs require on it</span></div><div id="t1501105421970419" t="2017-07-26 21:43:41 wparker @iku000888"><a href="#t1501105421970419" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-07-26</span> <span class="t" onclick="H(this)">21:43:41</span>                      wparker </span><span>@iku000888</span></div><div id="t1501121275280836" t="2017-07-27 02:07:55 iku000888 @wparker thanks! Did not know about that."><a href="#t1501121275280836" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-07-27</span> <span class="t" onclick="H(this)">02:07:55</span>                    iku000888 </span><span>@wparker thanks! Did not know about that.</span></div><div id="t1501000439733499" t="2017-07-25 16:33:59 iku000888 @ryanbrush"><a href="#t1501000439733499" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-07-25</span> <span class="t" onclick="H(this)">16:33:59</span>               iku000888 </span><span>@ryanbrush</span></div><div id="t1501000543797508" t="2017-07-25 16:35:43 ryanbrush Yes, if Foo is a type, you should be able to invoke the test-foo protocol method on it like you show."><a href="#t1501000543797508" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-07-25</span> <span class="t" onclick="H(this)">16:35:43</span>               ryanbrush </span><span>Yes, if Foo is a type, you should be able to invoke the test-foo protocol method on it like you show.</span></div><div id="t1501000558807039" t="2017-07-25 16:35:58 iku000888 (defrule is-foo
  [Foo (test-foo this)]
  =&gt; (println &quot;is a foo&quot;))"><a href="#t1501000558807039" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-07-25</span> <span class="t" onclick="H(this)">16:35:58</span>               iku000888 </span><span>(defrule is-foo
  [Foo (test-foo this)]
  =&gt; (println &quot;is a foo&quot;))</span></div><div id="t1501000574816346" t="2017-07-25 16:36:14 iku000888 Works!"><a href="#t1501000574816346" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-07-25</span> <span class="t" onclick="H(this)">16:36:14</span>               iku000888 </span><span>Works!</span></div><div id="t1501000643858314" t="2017-07-25 16:37:23 iku000888 Thanks again and sorry for the noob noise  🙇"><a href="#t1501000643858314" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-07-25</span> <span class="t" onclick="H(this)">16:37:23</span>               iku000888 </span><span>Thanks again and sorry for the noob noise </span><b>🙇</b></div><div id="t1501000662870104" t="2017-07-25 16:37:42 ryanbrush Sure thing! I&apos;m glad it works for you."><a href="#t1501000662870104" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-07-25</span> <span class="t" onclick="H(this)">16:37:42</span>               ryanbrush </span><span>Sure thing! I&apos;m glad it works for you.</span></div><div id="t1501000701893328" t="2017-07-25 16:38:21 ryanbrush Just be aware you might have to reload your rules if you redefine the types in a REPL, since the type will change when you do that.  😉"><a href="#t1501000701893328" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-07-25</span> <span class="t" onclick="H(this)">16:38:21</span>               ryanbrush </span><span>Just be aware you might have to reload your rules if you redefine the types in a REPL, since the type will change when you do that. </span><b>😉</b></div><div id="t1501000712899627" t="2017-07-25 16:38:32 iku000888 :+1:"><a href="#t1501000712899627" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-07-25</span> <span class="t" onclick="H(this)">16:38:32</span>               iku000888 </span><b>:+1:</b></div><div id="t1501002431940768" t="2017-07-25 17:07:11 iku000888 @ryanbrush blogged about my first glance of clara-rules (for people in Japan) and thanked you there. Hope that is okay."><a href="#t1501002431940768" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-07-25</span> <span class="t" onclick="H(this)">17:07:11</span>               iku000888 </span><span>@ryanbrush blogged about my first glance of clara-rules (for people in Japan) and thanked you there. Hope that is okay.</span></div><div id="t1501002433941944" t="2017-07-25 17:07:13 iku000888 http://qiita.com/iku000888/items/72525cd34cd3c0b44b31"><a href="#t1501002433941944" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-07-25</span> <span class="t" onclick="H(this)">17:07:13</span>               iku000888 </span><a href="http://qiita.com/iku000888/items/72525cd34cd3c0b44b31" target="_blank">http://qiita.com/iku000888/items/72525cd34cd3c0b44b31</a></div><div id="t1501006466421717" t="2017-07-25 18:14:26 ryanbrush @iku000888 Nice! Thanks for blogging about our little project.  😉"><a href="#t1501006466421717" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-07-25</span> <span class="t" onclick="H(this)">18:14:26</span>               ryanbrush </span><span>@iku000888 Nice! Thanks for blogging about our little project. </span><b>😉</b></div><div id="t1501087876094536" t="2017-07-26 16:51:16 iku000888 The first impression motivated me to learn more abt clara-rules and thus another blogpost with a personally cooked up example  http://qiita.com/iku000888/items/17ad5f7fa2f0da069997#_reference-37f1c943ec03175da6b6"><a href="#t1501087876094536" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-07-26</span> <span class="t" onclick="H(this)">16:51:16</span>               iku000888 </span><span>The first impression motivated me to learn more abt clara-rules and thus another blogpost with a personally cooked up example </span><a href="http://qiita.com/iku000888/items/17ad5f7fa2f0da069997#_reference-37f1c943ec03175da6b6" target="_blank">http://qiita.com/iku000888/items/17ad5f7fa2f0da069997#_reference-37f1c943ec03175da6b6</a></div><div id="t1501189679211698" t="2017-07-27 21:07:59 iku000888 Man one can write so many blogs out of clara-rules! (This one shows it can be used for cross entity join logic)  http://qiita.com/iku000888/items/7bb53bd3af51ea2e9e68"><a href="#t1501189679211698" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-07-27</span> <span class="t" onclick="H(this)">21:07:59</span>               iku000888 </span><span>Man one can write so many blogs out of clara-rules! (This one shows it can be used for cross entity join logic) </span><a href="http://qiita.com/iku000888/items/7bb53bd3af51ea2e9e68" target="_blank">http://qiita.com/iku000888/items/7bb53bd3af51ea2e9e68</a></div><div id="t1501189761251718" t="2017-07-27 21:09:21 iku000888 I am about to start this project with a gigantic hari-bally specification and feel like clara-rules is a great match. Going to explore more!"><a href="#t1501189761251718" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-07-27</span> <span class="t" onclick="H(this)">21:09:21</span>               iku000888 </span><span>I am about to start this project with a gigantic hari-bally specification and feel like clara-rules is a great match. Going to explore more!</span></div><div id="t1501267845718325" t="2017-07-28 18:50:45 nickowsy hi, I&apos;m new to clara and I&apos;m having a bit of trouble understanding  clara&apos;s durability.  I&apos;m serialize the data, storing the rule base separately. When I restore everything, insert new facts, and fire-rules...my rules are not running again. Rules fire great if I use the original session. i.e. not the one that was restored. I have been looking at  https://github.com/cerner/clara-rules/blob/master/src/test/clojure/clara/test_durability.clj   and my broken test is at  https://github.com/nfox2004/clara-durability/blob/master/test/clara_durability_help/core_test.clj .  Any suggestions would be awesome! thanks"><a href="#t1501267845718325" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-07-28</span> <span class="t" onclick="H(this)">18:50:45</span>                nickowsy </span><span>hi, I&apos;m new to clara and I&apos;m having a bit of trouble understanding  clara&apos;s durability.  I&apos;m serialize the data, storing the rule base separately. When I restore everything, insert new facts, and fire-rules...my rules are not running again. Rules fire great if I use the original session. i.e. not the one that was restored. I have been looking at </span><a href="https://github.com/cerner/clara-rules/blob/master/src/test/clojure/clara/test_durability.clj" target="_blank">https://github.com/cerner/clara-rules/blob/master/src/test/clojure/clara/test_durability.clj</a><span>  and my broken test is at </span><a href="https://github.com/nfox2004/clara-durability/blob/master/test/clara_durability_help/core_test.clj" target="_blank">https://github.com/nfox2004/clara-durability/blob/master/test/clara_durability_help/core_test.clj</a><span>.  Any suggestions would be awesome! thanks</span></div><div id="t1501270683091449" t="2017-07-28 19:38:03 wparker @nickowsy from a quick glance over your test I see your original session has a custom :fact-type-fn.   You’ll need to supply the same :fact-type-fn that the original function had when deserializing the rulebase.  See the 2-argument version of deserialize-rulebase:  https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/rules/durability.clj#L653"><a href="#t1501270683091449" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-07-28</span> <span class="t" onclick="H(this)">19:38:03</span>                 wparker </span><span>@nickowsy from a quick glance over your test I see your original session has a custom :fact-type-fn.   You’ll need to supply the same :fact-type-fn that the original function had when deserializing the rulebase.  See the 2-argument version of deserialize-rulebase: </span><a href="https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/rules/durability.clj#L653" target="_blank">https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/rules/durability.clj#L653</a></div><div id="t1501270713105385" t="2017-07-28 19:38:33 wparker So something like (deserialize-rulebase session-serializer {:fact-type-fn your-fact-type-function})"><a href="#t1501270713105385" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-07-28</span> <span class="t" onclick="H(this)">19:38:33</span>                 wparker </span><span>So something like (deserialize-rulebase session-serializer {:fact-type-fn your-fact-type-function})</span></div><div id="t1501270863174071" t="2017-07-28 19:41:03 wparker The reason it is that way is that arbitrary Clojure function objects aren’t serializable, so you have to either impose some kind of restriction on the functions used that gives you serializability or require the user to handle it; we went with the latter"><a href="#t1501270863174071" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-07-28</span> <span class="t" onclick="H(this)">19:41:03</span>                 wparker </span><span>The reason it is that way is that arbitrary Clojure function objects aren’t serializable, so you have to either impose some kind of restriction on the functions used that gives you serializability or require the user to handle it; we went with the latter</span></div><div id="t1501272701017051" t="2017-07-28 20:11:41 nickowsy @wparker thanks a ton! makes total sense  🙂"><a href="#t1501272701017051" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-07-28</span> <span class="t" onclick="H(this)">20:11:41</span>                nickowsy </span><span>@wparker thanks a ton! makes total sense </span><b>🙂</b></div><div id="t1501282888484138" t="2017-07-28 23:01:28 dadair Not sure if this question goes against the design of fact-based systems, but is there a way to &quot;update&quot; a fact? That is, say we insert  -&gt;Fact x , and then we insert  -&gt;Fact y , is it possible to only get a single  Fact  with updated value  y  in a query?"><a href="#t1501282888484138" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-07-28</span> <span class="t" onclick="H(this)">23:01:28</span>                  dadair </span><span>Not sure if this question goes against the design of fact-based systems, but is there a way to &quot;update&quot; a fact? That is, say we insert </span><code>-&gt;Fact x</code><span>, and then we insert </span><code>-&gt;Fact y</code><span>, is it possible to only get a single </span><code>Fact</code><span> with updated value </span><code>y</code><span> in a query?</span></div><div id="t1501283137536753" t="2017-07-28 23:05:37 dadair concrete example:
 (-&gt; (handle test-file test-action) (r/query fields-for :?formRef &quot;/forms/aae-form&quot;))
=&gt;
({:?formRef &quot;/forms/aae-form&quot;,
  :?fieldRef &quot;/forms/aae-form/data/order/reason&quot;,
  :?field #{#justice.rules.forms.FormField{:formRef &quot;/forms/aae-form&quot;,
                                           :fieldRef &quot;/forms/aae-form/data/order/reason&quot;,
                                           :descriptor {:type &quot;VALUE&quot;,
                                                        :valueType &quot;STRING&quot;,
                                                        :value &quot;foo&quot;,
                                                        :constraints {:minLength 1, :required true}}}
            #justice.rules.forms.FormField{:formRef &quot;/forms/aae-form&quot;,
                                           :fieldRef &quot;/forms/aae-form/data/order/reason&quot;,
                                           :descriptor {:type &quot;VALUE&quot;,
                                                        :valueType &quot;STRING&quot;,
                                                        :value &quot;&quot;,
                                                        :constraints {:minLength 1, :required true}}}}})
 

I&apos;d like the query to return all  FormField &apos;s with unique  :fieldRef ; so in the above example if I update the  :descriptor   :value  from &quot;&quot; to &quot;foo&quot;, I only want the single fact returned"><a href="#t1501283137536753" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-07-28</span> <span class="t" onclick="H(this)">23:05:37</span>                  dadair </span><span>concrete example:
</span><pre>(-&gt; (handle test-file test-action) (r/query fields-for :?formRef &quot;/forms/aae-form&quot;))
=&gt;
({:?formRef &quot;/forms/aae-form&quot;,
  :?fieldRef &quot;/forms/aae-form/data/order/reason&quot;,
  :?field #{#justice.rules.forms.FormField{:formRef &quot;/forms/aae-form&quot;,
                                           :fieldRef &quot;/forms/aae-form/data/order/reason&quot;,
                                           :descriptor {:type &quot;VALUE&quot;,
                                                        :valueType &quot;STRING&quot;,
                                                        :value &quot;foo&quot;,
                                                        :constraints {:minLength 1, :required true}}}
            #justice.rules.forms.FormField{:formRef &quot;/forms/aae-form&quot;,
                                           :fieldRef &quot;/forms/aae-form/data/order/reason&quot;,
                                           :descriptor {:type &quot;VALUE&quot;,
                                                        :valueType &quot;STRING&quot;,
                                                        :value &quot;&quot;,
                                                        :constraints {:minLength 1, :required true}}}}})
</pre><span>

I&apos;d like the query to return all </span><code>FormField</code><span>&apos;s with unique </span><code>:fieldRef</code><span>; so in the above example if I update the </span><code>:descriptor</code><span> </span><code>:value</code><span> from &quot;&quot; to &quot;foo&quot;, I only want the single fact returned</span></div><div id="t1501344551366229" t="2017-07-29 16:09:11 zylox Generational data is kind of tricky. I think you could do what you want though (assuming im understanding) if, externally, you have some way to track &quot;newest&quot;, having some sort of version field (whether this is datetime or incremented or whatever). Then, in the rules network, have an accumulator for the &quot;newest&quot; value of that field, and insert  -&gt;NewestFact  and then depend on that instead. Logical retractions should take care of the rest. @dadair"><a href="#t1501344551366229" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-07-29</span> <span class="t" onclick="H(this)">16:09:11</span>                   zylox </span><span>Generational data is kind of tricky. I think you could do what you want though (assuming im understanding) if, externally, you have some way to track &quot;newest&quot;, having some sort of version field (whether this is datetime or incremented or whatever). Then, in the rules network, have an accumulator for the &quot;newest&quot; value of that field, and insert </span><code>-&gt;NewestFact</code><span> and then depend on that instead. Logical retractions should take care of the rest. @dadair</span></div><div id="t1501344687378470" t="2017-07-29 16:11:27 zylox i just realized you probably meant internal insertions not external."><a href="#t1501344687378470" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-07-29</span> <span class="t" onclick="H(this)">16:11:27</span>                   zylox </span><span>i just realized you probably meant internal insertions not external.</span></div><div id="t1501344896397813" t="2017-07-29 16:14:56 zylox if its internal (so inserting on the rhs), thats trickier because in my experience execution order dependent rules get you in trouble real quick, and without that i&apos;m not sure how you would know what fact is &quot;newer&quot;. If your goal is actually whatever fact has the most fields populated, you could still do a check on that in the accumulator, or probably better with rules with checks on the fields you care about."><a href="#t1501344896397813" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-07-29</span> <span class="t" onclick="H(this)">16:14:56</span>                   zylox </span><span>if its internal (so inserting on the rhs), thats trickier because in my experience execution order dependent rules get you in trouble real quick, and without that i&apos;m not sure how you would know what fact is &quot;newer&quot;. If your goal is actually whatever fact has the most fields populated, you could still do a check on that in the accumulator, or probably better with rules with checks on the fields you care about.</span></div><div id="t1501892655427566" t="2017-08-05 00:24:15 mrchance Hi! Is it possible to cause side effects when a fact gets retracted by the truth maintenance mechanism? I am building something that builds a network of core.async pipes and am thinking about establishing and severing connections based on Clara facts."><a href="#t1501892655427566" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-05</span> <span class="t" onclick="H(this)">00:24:15</span>                mrchance </span><span>Hi! Is it possible to cause side effects when a fact gets retracted by the truth maintenance mechanism? I am building something that builds a network of core.async pipes and am thinking about establishing and severing connections based on Clara facts.</span></div><div id="t1501972131402743" t="2017-08-05 22:28:51 mikerod @mrchance could you just make a  :not  style “negation rule” to logically handle the condition you are going for?"><a href="#t1501972131402743" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-05</span> <span class="t" onclick="H(this)">22:28:51</span>                 mikerod </span><span>@mrchance could you just make a </span><code>:not</code><span> style “negation rule” to logically handle the condition you are going for?</span></div><div id="t1501972155404349" t="2017-08-05 22:29:15 mikerod Whatever you are wanting to monitor for being logically retracted via truth maintenance. It seems you should be able to make an explicit rule looking for that situation"><a href="#t1501972155404349" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-05</span> <span class="t" onclick="H(this)">22:29:15</span>                 mikerod </span><span>Whatever you are wanting to monitor for being logically retracted via truth maintenance. It seems you should be able to make an explicit rule looking for that situation</span></div><div id="t1501972523430107" t="2017-08-05 22:35:23 mikerod However, this side-effect of severing connections would certainly have to be resilient to any issues of being executed multiple times on the RHS. don’t rely on it only being “called once”"><a href="#t1501972523430107" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-05</span> <span class="t" onclick="H(this)">22:35:23</span>                 mikerod </span><span>However, this side-effect of severing connections would certainly have to be resilient to any issues of being executed multiple times on the RHS. don’t rely on it only being “called once”</span></div><div id="t1501979687892983" t="2017-08-06 00:34:47 mrchance @mikerod hm, ok. Idempotency shouldn&apos;t be an issue, good hint though. Gonna try that, although I am not 100% clear on how you mean that. In my use case, there would be rules that produce a [Linked a b] fact which would call something like core.async/pipe on a and b, only it returns something that can be called or closed when the respective Linked fact goes away in order to sever the connection again. How would I address that using :not rules?"><a href="#t1501979687892983" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-06</span> <span class="t" onclick="H(this)">00:34:47</span>                mrchance </span><span>@mikerod hm, ok. Idempotency shouldn&apos;t be an issue, good hint though. Gonna try that, although I am not 100% clear on how you mean that. In my use case, there would be rules that produce a [Linked a b] fact which would call something like core.async/pipe on a and b, only it returns something that can be called or closed when the respective Linked fact goes away in order to sever the connection again. How would I address that using :not rules?</span></div><div id="t1501979864903953" t="2017-08-06 00:37:44 mrchance Clara is awesome btw. ! Played with it a bit more in the meantime"><a href="#t1501979864903953" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-06</span> <span class="t" onclick="H(this)">00:37:44</span>                mrchance </span><span>Clara is awesome btw. ! Played with it a bit more in the meantime</span></div><div id="t1501980155922591" t="2017-08-06 00:42:35 mikerod @mrchance an alternative that comes to mind is to hook into Clara’s listeners to try to watch for the particular retraction you are interested in. However, I’d probably say it is best if that isn’t necessary."><a href="#t1501980155922591" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-06</span> <span class="t" onclick="H(this)">00:42:35</span>                 mikerod </span><span>@mrchance an alternative that comes to mind is to hook into Clara’s listeners to try to watch for the particular retraction you are interested in. However, I’d probably say it is best if that isn’t necessary.</span></div><div id="t1501980172923561" t="2017-08-06 00:42:52 mikerod I hate to suggest things like  insert-unconditional!  but I see an approach with that at least…"><a href="#t1501980172923561" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-06</span> <span class="t" onclick="H(this)">00:42:52</span>                 mikerod </span><span>I hate to suggest things like </span><code>insert-unconditional!</code><span> but I see an approach with that at least…</span></div><div id="t1501980181924101" t="2017-08-06 00:43:01 mikerod I’d like to think of something better though"><a href="#t1501980181924101" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-06</span> <span class="t" onclick="H(this)">00:43:01</span>                 mikerod </span><span>I’d like to think of something better though</span></div><div id="t1501980186924444" t="2017-08-06 00:43:06 mrchance Yeah, I saw the ns in the docs and thought about that"><a href="#t1501980186924444" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-06</span> <span class="t" onclick="H(this)">00:43:06</span>                mrchance </span><span>Yeah, I saw the ns in the docs and thought about that</span></div><div id="t1501980188924598" t="2017-08-06 00:43:08 mikerod demo:"><a href="#t1501980188924598" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-06</span> <span class="t" onclick="H(this)">00:43:08</span>                 mikerod </span><span>demo:</span></div><div id="t1501980317932890" t="2017-08-06 00:45:17 mikerod (defrule makes-chan
  [?a &lt;- A]
  [?b &lt;- B]
  =&gt;
  (let [chan (somehow-make it)]
    ;; Not sure what you do with `chan` here
    (r/insert! (-&gt;LogicalThing ?a ?b))
    (r/insert-unconditional! (-&gt;OpenedChan chan))))

(defrule closes-chan
  [:not [LogicalThing]]
  [?oc &lt;- OpenedChan (= ?chan chan)]
  =&gt;
  (r/retract! ?oc)
  (close-the ?chan))

"><a href="#t1501980317932890" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-06</span> <span class="t" onclick="H(this)">00:45:17</span>                 mikerod </span><pre>(defrule makes-chan
  [?a &lt;- A]
  [?b &lt;- B]
  =&gt;
  (let [chan (somehow-make it)]
    ;; Not sure what you do with `chan` here
    (r/insert! (-&gt;LogicalThing ?a ?b))
    (r/insert-unconditional! (-&gt;OpenedChan chan))))

(defrule closes-chan
  [:not [LogicalThing]]
  [?oc &lt;- OpenedChan (= ?chan chan)]
  =&gt;
  (r/retract! ?oc)
  (close-the ?chan))

</pre></div><div id="t1501980396938220" t="2017-08-06 00:46:36 mikerod I think it just gets sort of dirty when you are managing your own unconditional facts and retracts - typically a pattern to avoid"><a href="#t1501980396938220" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-06</span> <span class="t" onclick="H(this)">00:46:36</span>                 mikerod </span><span>I think it just gets sort of dirty when you are managing your own unconditional facts and retracts - typically a pattern to avoid</span></div><div id="t1501980426940291" t="2017-08-06 00:47:06 mikerod not sure how prevalent this would be for you though in terms of managing it. also, not positive my solution is really a solution to the issue at all"><a href="#t1501980426940291" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-06</span> <span class="t" onclick="H(this)">00:47:06</span>                 mikerod </span><span>not sure how prevalent this would be for you though in terms of managing it. also, not positive my solution is really a solution to the issue at all</span></div><div id="t1501980431940571" t="2017-08-06 00:47:11 mrchance Ok, I can see what you&apos;re getting at, but I agree it looks suboptimal"><a href="#t1501980431940571" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-06</span> <span class="t" onclick="H(this)">00:47:11</span>                mrchance </span><span>Ok, I can see what you&apos;re getting at, but I agree it looks suboptimal</span></div><div id="t1501980445941405" t="2017-08-06 00:47:25 mikerod Clara has a listener protocol you can attach onto"><a href="#t1501980445941405" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-06</span> <span class="t" onclick="H(this)">00:47:25</span>                 mikerod </span><span>Clara has a listener protocol you can attach onto</span></div><div id="t1501980453941905" t="2017-08-06 00:47:33 mikerod and I believe you can find the relevant retract events there"><a href="#t1501980453941905" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-06</span> <span class="t" onclick="H(this)">00:47:33</span>                 mikerod </span><span>and I believe you can find the relevant retract events there</span></div><div id="t1501980464942583" t="2017-08-06 00:47:44 mikerod not sure there have been docs posted up on that"><a href="#t1501980464942583" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-06</span> <span class="t" onclick="H(this)">00:47:44</span>                 mikerod </span><span>not sure there have been docs posted up on that</span></div><div id="t1501980504945065" t="2017-08-06 00:48:24 mrchance Not many, from what I browsed yet  😉"><a href="#t1501980504945065" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-06</span> <span class="t" onclick="H(this)">00:48:24</span>                mrchance </span><span>Not many, from what I browsed yet </span><b>😉</b></div><div id="t1501980505945098" t="2017-08-06 00:48:25 mikerod https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/rules/listener.cljc"><a href="#t1501980505945098" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-06</span> <span class="t" onclick="H(this)">00:48:25</span>                 mikerod </span><a href="https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/rules/listener.cljc" target="_blank">https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/rules/listener.cljc</a></div><div id="t1501980559948281" t="2017-08-06 00:49:19 mikerod The  ITransientEventListener"><a href="#t1501980559948281" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-06</span> <span class="t" onclick="H(this)">00:49:19</span>                 mikerod </span><span>The </span><code>ITransientEventListener</code></div><div id="t1501980601951024" t="2017-08-06 00:50:01 mikerod even when looking at this though, I think it is perhaps opaque which retraction you’d want to listen to"><a href="#t1501980601951024" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-06</span> <span class="t" onclick="H(this)">00:50:01</span>                 mikerod </span><span>even when looking at this though, I think it is perhaps opaque which retraction you’d want to listen to</span></div><div id="t1501980648954102" t="2017-08-06 00:50:48 mrchance Hm, maybe. I&apos;ll give it a try"><a href="#t1501980648954102" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-06</span> <span class="t" onclick="H(this)">00:50:48</span>                mrchance </span><span>Hm, maybe. I&apos;ll give it a try</span></div><div id="t1501980651954229" t="2017-08-06 00:50:51 mikerod I believe  (retract-facts! [listener facts])  &amp;  (retract-facts-logical! [listener node token facts])  would have the info"><a href="#t1501980651954229" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-06</span> <span class="t" onclick="H(this)">00:50:51</span>                 mikerod </span><span>I believe </span><code>(retract-facts! [listener facts])</code><span> &amp; </span><code>(retract-facts-logical! [listener node token facts])</code><span> would have the info</span></div><div id="t1501980675955790" t="2017-08-06 00:51:15 mikerod retract-facts!  I believe is retracts from the RHS and  retract-facts-logical!  is retracts from truth maintenance"><a href="#t1501980675955790" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-06</span> <span class="t" onclick="H(this)">00:51:15</span>                 mikerod </span><code>retract-facts!</code><span> I believe is retracts from the RHS and </span><code>retract-facts-logical!</code><span> is retracts from truth maintenance</span></div><div id="t1501980685956343" t="2017-08-06 00:51:25 mikerod other “retract” things I believe are more internal node-to-node activity"><a href="#t1501980685956343" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-06</span> <span class="t" onclick="H(this)">00:51:25</span>                 mikerod </span><span>other “retract” things I believe are more internal node-to-node activity</span></div><div id="t1501980689956574" t="2017-08-06 00:51:29 mrchance Ah,  ok"><a href="#t1501980689956574" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-06</span> <span class="t" onclick="H(this)">00:51:29</span>                mrchance </span><span>Ah,  ok</span></div><div id="t1501980723959642" t="2017-08-06 00:52:03 mrchance Thanks! I&apos;ll test it "><a href="#t1501980723959642" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-06</span> <span class="t" onclick="H(this)">00:52:03</span>                mrchance </span><span>Thanks! I&apos;ll test it </span></div><div id="t1501980797963573" t="2017-08-06 00:53:17 mikerod (mk-session rules :listeners [my-listener-impl])"><a href="#t1501980797963573" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-06</span> <span class="t" onclick="H(this)">00:53:17</span>                 mikerod </span><code>(mk-session rules :listeners [my-listener-impl])</code></div><div id="t1501980803963894" t="2017-08-06 00:53:23 mrchance I think there is some big potential here, like a completely reactive description of stateful systems, something that&apos;s always awful when it moves past what e.g. component can handle "><a href="#t1501980803963894" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-06</span> <span class="t" onclick="H(this)">00:53:23</span>                mrchance </span><span>I think there is some big potential here, like a completely reactive description of stateful systems, something that&apos;s always awful when it moves past what e.g. component can handle </span></div><div id="t1501980821964972" t="2017-08-06 00:53:41 mrchance That&apos;s simple enough  😉  "><a href="#t1501980821964972" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-06</span> <span class="t" onclick="H(this)">00:53:41</span>                mrchance </span><span>That&apos;s simple enough </span><b>😉</b><span> </span></div><div id="t1501980890968921" t="2017-08-06 00:54:50 mikerod yeah, it isn’t actually documented on  mk-session , not sure why. I don’t think those ns’s are really called “experimental” around this at this point"><a href="#t1501980890968921" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-06</span> <span class="t" onclick="H(this)">00:54:50</span>                 mikerod </span><span>yeah, it isn’t actually documented on </span><code>mk-session</code><span>, not sure why. I don’t think those ns’s are really called “experimental” around this at this point</span></div><div id="t1501980972973929" t="2017-08-06 00:56:12 mikerod the only thing I’m concerned about is if you do not impl all the functions of the protocol"><a href="#t1501980972973929" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-06</span> <span class="t" onclick="H(this)">00:56:12</span>                 mikerod </span><span>the only thing I’m concerned about is if you do not impl all the functions of the protocol</span></div><div id="t1501980979974337" t="2017-08-06 00:56:19 mikerod I can’t remember if you have to “pad” those with a no-op in some way"><a href="#t1501980979974337" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-06</span> <span class="t" onclick="H(this)">00:56:19</span>                 mikerod </span><span>I can’t remember if you have to “pad” those with a no-op in some way</span></div><div id="t1501980979974348" t="2017-08-06 00:56:19 mrchance Typical case of documentation not growing as fast as its software"><a href="#t1501980979974348" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-06</span> <span class="t" onclick="H(this)">00:56:19</span>                mrchance </span><span>Typical case of documentation not growing as fast as its software</span></div><div id="t1501981018976683" t="2017-08-06 00:56:58 mrchance Shouldn&apos;t be a problem, it&apos;s a one time thing so some boilerplate is no issue"><a href="#t1501981018976683" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-06</span> <span class="t" onclick="H(this)">00:56:58</span>                mrchance </span><span>Shouldn&apos;t be a problem, it&apos;s a one time thing so some boilerplate is no issue</span></div><div id="t1501981029977379" t="2017-08-06 00:57:09 mikerod there is the  clara.rules.listener/default-listener  though"><a href="#t1501981029977379" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-06</span> <span class="t" onclick="H(this)">00:57:09</span>                 mikerod </span><span>there is the </span><code>clara.rules.listener/default-listener</code><span> though</span></div><div id="t1501981035977730" t="2017-08-06 00:57:15 mikerod you could just delegate everything else through that"><a href="#t1501981035977730" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-06</span> <span class="t" onclick="H(this)">00:57:15</span>                 mikerod </span><span>you could just delegate everything else through that</span></div><div id="t1501981043978218" t="2017-08-06 00:57:23 mikerod but it’s just a no-op"><a href="#t1501981043978218" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-06</span> <span class="t" onclick="H(this)">00:57:23</span>                 mikerod </span><span>but it’s just a no-op</span></div><div id="t1501981068979568" t="2017-08-06 00:57:48 mikerod yeah, idk. I’ve done stuff with this before too. I just can’t remember"><a href="#t1501981068979568" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-06</span> <span class="t" onclick="H(this)">00:57:48</span>                 mikerod </span><span>yeah, idk. I’ve done stuff with this before too. I just can’t remember</span></div><div id="t1501981073979931" t="2017-08-06 00:57:53 mrchance Ok, then actually delegating is probably more work ;)"><a href="#t1501981073979931" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-06</span> <span class="t" onclick="H(this)">00:57:53</span>                mrchance </span><span>Ok, then actually delegating is probably more work ;)</span></div><div id="t1501981078980260" t="2017-08-06 00:57:58 mikerod hah yes"><a href="#t1501981078980260" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-06</span> <span class="t" onclick="H(this)">00:57:58</span>                 mikerod </span><span>hah yes</span></div><div id="t1501981086980806" t="2017-08-06 00:58:06 mikerod I could have swore there was a smoother way"><a href="#t1501981086980806" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-06</span> <span class="t" onclick="H(this)">00:58:06</span>                 mikerod </span><span>I could have swore there was a smoother way</span></div><div id="t1501981129983271" t="2017-08-06 00:58:49 mrchance I think this one is good enough, if it works"><a href="#t1501981129983271" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-06</span> <span class="t" onclick="H(this)">00:58:49</span>                mrchance </span><span>I think this one is good enough, if it works</span></div><div id="t1501981135983637" t="2017-08-06 00:58:55 mikerod &gt; I think there is some big potential here, like a completely reactive description of stateful systems, something that’s always awful when it moves past what e.g. component can handle
That is cool though"><a href="#t1501981135983637" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-06</span> <span class="t" onclick="H(this)">00:58:55</span>                 mikerod </span><span>&gt; I think there is some big potential here, like a completely reactive description of stateful systems, something that’s always awful when it moves past what e.g. component can handle
That is cool though</span></div><div id="t1501981151984477" t="2017-08-06 00:59:11 mrchance Yeah"><a href="#t1501981151984477" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-06</span> <span class="t" onclick="H(this)">00:59:11</span>                mrchance </span><span>Yeah</span></div><div id="t1501981152984538" t="2017-08-06 00:59:12 mikerod would be interesting to hear what success you have with that"><a href="#t1501981152984538" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-06</span> <span class="t" onclick="H(this)">00:59:12</span>                 mikerod </span><span>would be interesting to hear what success you have with that</span></div><div id="t1501981171985661" t="2017-08-06 00:59:31 mrchance Sure, I&apos;ll let you know"><a href="#t1501981171985661" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-06</span> <span class="t" onclick="H(this)">00:59:31</span>                mrchance </span><span>Sure, I&apos;ll let you know</span></div><div id="t1501981248991313" t="2017-08-06 01:00:48 mikerod btw, looks like  precept  uses Clara  :listeners  when I did a quick GitHub search"><a href="#t1501981248991313" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-06</span> <span class="t" onclick="H(this)">01:00:48</span>                 mikerod </span><span>btw, looks like </span><code>precept</code><span> uses Clara </span><code>:listeners</code><span> when I did a quick GitHub search</span></div><div id="t1501981249991360" t="2017-08-06 01:00:49 mikerod https://github.com/CoNarrative/precept/blob/6d919a91f846c9e5ca2d53384efe4da7981f1914/src/cljc/precept/listeners.cljc"><a href="#t1501981249991360" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-06</span> <span class="t" onclick="H(this)">01:00:49</span>                 mikerod </span><a href="https://github.com/CoNarrative/precept/blob/6d919a91f846c9e5ca2d53384efe4da7981f1914/src/cljc/precept/listeners.cljc" target="_blank">https://github.com/CoNarrative/precept/blob/6d919a91f846c9e5ca2d53384efe4da7981f1914/src/cljc/precept/listeners.cljc</a></div><div id="t1501981265992449" t="2017-08-06 01:01:05 mikerod I knew they were doing interesting things in using Clara for app state mgmt (may be saying that wrong)"><a href="#t1501981265992449" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-06</span> <span class="t" onclick="H(this)">01:01:05</span>                 mikerod </span><span>I knew they were doing interesting things in using Clara for app state mgmt (may be saying that wrong)</span></div><div id="t1501981272993033" t="2017-08-06 01:01:12 mrchance Right, I stumbled across that too "><a href="#t1501981272993033" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-06</span> <span class="t" onclick="H(this)">01:01:12</span>                mrchance </span><span>Right, I stumbled across that too </span></div><div id="t1501981296994864" t="2017-08-06 01:01:36 mikerod they impl’ed the protocols though and included the no-ops"><a href="#t1501981296994864" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-06</span> <span class="t" onclick="H(this)">01:01:36</span>                 mikerod </span><span>they impl’ed the protocols though and included the no-ops</span></div><div id="t1501981329997132" t="2017-08-06 01:02:09 mrchance Probably going to have a look into their code, I like the idea of precept as well"><a href="#t1501981329997132" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-06</span> <span class="t" onclick="H(this)">01:02:09</span>                mrchance </span><span>Probably going to have a look into their code, I like the idea of precept as well</span></div><div id="t1501981531010350" t="2017-08-06 01:05:31 mikerod yeah, I’ve wanted to look at that codebase sometime soon"><a href="#t1501981531010350" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-06</span> <span class="t" onclick="H(this)">01:05:31</span>                 mikerod </span><span>yeah, I’ve wanted to look at that codebase sometime soon</span></div><div id="t1501981537010693" t="2017-08-06 01:05:37 mikerod seems like some interesting stuff"><a href="#t1501981537010693" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-06</span> <span class="t" onclick="H(this)">01:05:37</span>                 mikerod </span><span>seems like some interesting stuff</span></div><div id="t1501996696873675" t="2017-08-06 05:18:16 wparker Several people have had use cases that sounded like what they were looking for was the ability to get the changes in query results relative to an earlier state, and it sounds like that sort of functionality might be what you’re looking for as well @mrchance .  That could be done with some wrappers in your code around the session along the lines of “Query the session, store the results, insert/retract facts, fire the rules, then query again and diff the results”.  It could be done as a Clara listener too by tracking on the listening calls in QueryNode:  https://github.com/cerner/clara-rules/blob/0.15.2/src/main/clojure/clara/rules/engine.cljc#L430"><a href="#t1501996696873675" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-06</span> <span class="t" onclick="H(this)">05:18:16</span>                 wparker </span><span>Several people have had use cases that sounded like what they were looking for was the ability to get the changes in query results relative to an earlier state, and it sounds like that sort of functionality might be what you’re looking for as well @mrchance .  That could be done with some wrappers in your code around the session along the lines of “Query the session, store the results, insert/retract facts, fire the rules, then query again and diff the results”.  It could be done as a Clara listener too by tracking on the listening calls in QueryNode: </span><a href="https://github.com/cerner/clara-rules/blob/0.15.2/src/main/clojure/clara/rules/engine.cljc#L430" target="_blank">https://github.com/cerner/clara-rules/blob/0.15.2/src/main/clojure/clara/rules/engine.cljc#L430</a></div><div id="t1501996937885927" t="2017-08-06 05:22:17 wparker It is functionality that I think would be useful for Clara itself to provide at some point, a listener to do that would probably get into Clara’s internal impl details somewhat e.g. “is this node a QueryNode?” logic.  Wouldn’t matter if it was part of Clara and tested there though."><a href="#t1501996937885927" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-06</span> <span class="t" onclick="H(this)">05:22:17</span>                 wparker </span><span>It is functionality that I think would be useful for Clara itself to provide at some point, a listener to do that would probably get into Clara’s internal impl details somewhat e.g. “is this node a QueryNode?” logic.  Wouldn’t matter if it was part of Clara and tested there though.</span></div><div id="t1502025000460842" t="2017-08-06 13:10:00 mrchance @wparker True, that&apos;s another way to look at it. This might work too. Your answer also makes me wonder if Datascript would be the better choice for this usecase though, since there you get the transaction logs anyway"><a href="#t1502025000460842" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-06</span> <span class="t" onclick="H(this)">13:10:00</span>                mrchance </span><span>@wparker True, that&apos;s another way to look at it. This might work too. Your answer also makes me wonder if Datascript would be the better choice for this usecase though, since there you get the transaction logs anyway</span></div><div id="t1502114632596343" t="2017-08-07 14:03:52 wparker I haven’t had occasion to use DataScript, but it also seems like something that could be useful for a use-case like what you describe @mrchance .  I suspect much depends on what the simplest way to model the logic you have in mind is and what performance characteristics you’re looking for."><a href="#t1502114632596343" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-07</span> <span class="t" onclick="H(this)">14:03:52</span>                      wparker </span><span>I haven’t had occasion to use DataScript, but it also seems like something that could be useful for a use-case like what you describe @mrchance .  I suspect much depends on what the simplest way to model the logic you have in mind is and what performance characteristics you’re looking for.</span></div><div id="t1502126437483724" t="2017-08-07 17:20:37 mrchance Yes, it all depends on the details. From the FactUi readme it looks like they took a bit from both worlds as well"><a href="#t1502126437483724" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-07</span> <span class="t" onclick="H(this)">17:20:37</span>                     mrchance </span><span>Yes, it all depends on the details. From the FactUi readme it looks like they took a bit from both worlds as well</span></div><div id="t1502071200653256" t="2017-08-07 02:00:00 mikerod   https://github.com/arachne-framework/factui 
Looks like more fun with rules (and Clara)"><a href="#t1502071200653256" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-07</span> <span class="t" onclick="H(this)">02:00:00</span>                 mikerod </span><span> </span><a href="https://github.com/arachne-framework/factui" target="_blank">https://github.com/arachne-framework/factui</a><span>
Looks like more fun with rules (and Clara)</span></div><div id="t1502619616702895" t="2017-08-13 10:20:16 olivergeorge I&apos;m interested in how Clara (or rule engines more generally) would work in an environment where a relational database is used as the repository of all information."><a href="#t1502619616702895" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-13</span> <span class="t" onclick="H(this)">10:20:16</span>            olivergeorge </span><span>I&apos;m interested in how Clara (or rule engines more generally) would work in an environment where a relational database is used as the repository of all information.</span></div><div id="t1502619632703970" t="2017-08-13 10:20:32 olivergeorge I&apos;m only learning about this stuff so I could be missing something obvious."><a href="#t1502619632703970" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-13</span> <span class="t" onclick="H(this)">10:20:32</span>            olivergeorge </span><span>I&apos;m only learning about this stuff so I could be missing something obvious.</span></div><div id="t1502619755710825" t="2017-08-13 10:22:35 olivergeorge Perhaps the key is not letting anyone directly write to the database which would bypassing the rule engine causing it to get out of sync with reality."><a href="#t1502619755710825" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-13</span> <span class="t" onclick="H(this)">10:22:35</span>            olivergeorge </span><span>Perhaps the key is not letting anyone directly write to the database which would bypassing the rule engine causing it to get out of sync with reality.</span></div><div id="t1502619795713066" t="2017-08-13 10:23:15 olivergeorge A simple &quot;typical architecture&quot; might answer my question."><a href="#t1502619795713066" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-13</span> <span class="t" onclick="H(this)">10:23:15</span>            olivergeorge </span><span>A simple &quot;typical architecture&quot; might answer my question.</span></div><div id="t1502653908356519" t="2017-08-13 19:51:48 hagmonk Can anyone explain why the following case doesn&apos;t do what I expect?"><a href="#t1502653908356519" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-13</span> <span class="t" onclick="H(this)">19:51:48</span>                 hagmonk </span><span>Can anyone explain why the following case doesn&apos;t do what I expect?</span></div><div id="t1502653920357589" t="2017-08-13 19:52:00 hagmonk (let [matched    (dsl/parse-rule
                   [[:eav
                     (= ?attribute (:attribute this))
                     (= ?attribute_value (:attribute_value this))
                     (= ?id (:id this))]]
                   (insert! {:type ?attribute :id ?id :value ?attribute_value}))

      unscreened (dsl/parse-rule
                   [[:state
                     (= (:value this) 2)
                     (= ?id (:id this))]
                    [:milestone
                     (= (:value this) -1)
                     (= ?id (:id this))]]
                   (insert! {:type :unscreened :id ?id}))

      type-query (dsl/parse-query [] [[?unscreened &lt;- :unscreened]])

      session    (mk-session [matched unscreened type-query] :fact-type-fn :type :cache false)]
  (time (-&gt; session
            (insert {:type :eav :attribute :state :attribute_value 2 :id 33695360})
            (insert {:type :eav :attribute :milestone :attribute_value -1 :id 33695360})
            fire-rules
            (insert {:type :eav :attribute :milestone :attribute_value 123456 :id 33695360})
            fire-rules
            (query type-query))))
"><a href="#t1502653920357589" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-13</span> <span class="t" onclick="H(this)">19:52:00</span>                 hagmonk </span><pre>(let [matched    (dsl/parse-rule
                   [[:eav
                     (= ?attribute (:attribute this))
                     (= ?attribute_value (:attribute_value this))
                     (= ?id (:id this))]]
                   (insert! {:type ?attribute :id ?id :value ?attribute_value}))

      unscreened (dsl/parse-rule
                   [[:state
                     (= (:value this) 2)
                     (= ?id (:id this))]
                    [:milestone
                     (= (:value this) -1)
                     (= ?id (:id this))]]
                   (insert! {:type :unscreened :id ?id}))

      type-query (dsl/parse-query [] [[?unscreened &lt;- :unscreened]])

      session    (mk-session [matched unscreened type-query] :fact-type-fn :type :cache false)]
  (time (-&gt; session
            (insert {:type :eav :attribute :state :attribute_value 2 :id 33695360})
            (insert {:type :eav :attribute :milestone :attribute_value -1 :id 33695360})
            fire-rules
            (insert {:type :eav :attribute :milestone :attribute_value 123456 :id 33695360})
            fire-rules
            (query type-query))))
</pre></div><div id="t1502653954360448" t="2017-08-13 19:52:34 hagmonk I insert two facts which cause a third fact of type :unscreened to be inserted"><a href="#t1502653954360448" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-13</span> <span class="t" onclick="H(this)">19:52:34</span>                 hagmonk </span><span>I insert two facts which cause a third fact of type :unscreened to be inserted</span></div><div id="t1502653996363852" t="2017-08-13 19:53:16 hagmonk I then fire the rules, and insert another fact which should negate the earlier fact"><a href="#t1502653996363852" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-13</span> <span class="t" onclick="H(this)">19:53:16</span>                 hagmonk </span><span>I then fire the rules, and insert another fact which should negate the earlier fact</span></div><div id="t1502654016365569" t="2017-08-13 19:53:36 hagmonk Instead, when I query the session for :unscreened, I see that fact still present"><a href="#t1502654016365569" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-13</span> <span class="t" onclick="H(this)">19:53:36</span>                 hagmonk </span><span>Instead, when I query the session for :unscreened, I see that fact still present</span></div><div id="t1502723918216239" t="2017-08-14 15:18:38 curtis.shaffer @olivergeorge authorization on the database is something that can be done; certain databases (Oracle is the one that comes to mind) support triggers which you could use to detect changes"><a href="#t1502723918216239" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-14</span> <span class="t" onclick="H(this)">15:18:38</span>          curtis.shaffer </span><span>@olivergeorge authorization on the database is something that can be done; certain databases (Oracle is the one that comes to mind) support triggers which you could use to detect changes</span></div><div id="t1502724132349966" t="2017-08-14 15:22:12 curtis.shaffer @hagmonk as far as I can tell, all three of those facts will still be in the session; the 3rd fact insertion does not negate the 2nd fact insertion. the :id field makes me think that you want it to be an update, which is not what is done"><a href="#t1502724132349966" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-14</span> <span class="t" onclick="H(this)">15:22:12</span>          curtis.shaffer </span><span>@hagmonk as far as I can tell, all three of those facts will still be in the session; the 3rd fact insertion does not negate the 2nd fact insertion. the :id field makes me think that you want it to be an update, which is not what is done</span></div><div id="t1502725136977442" t="2017-08-14 15:38:56 zylox @hagmonk What Curtis said. You could use an accumlator to grab the highest valued :milestone fact. or if you are looking for all non negative, you could add a :not constraint. Depends on what you are looking for."><a href="#t1502725136977442" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-14</span> <span class="t" onclick="H(this)">15:38:56</span>                   zylox </span><span>@hagmonk What Curtis said. You could use an accumlator to grab the highest valued :milestone fact. or if you are looking for all non negative, you could add a :not constraint. Depends on what you are looking for.</span></div><div id="t1502733033533975" t="2017-08-14 17:50:33 wparker @olivergeorge it might help if you can clarify your question.  From Clara’s point of view, it doesn’t matter what the ultimate source of the data it processes is.  Note though that if rules do things that depend on ordering you have to be careful since Clara can fire and then retract a rule; the contract when using truth maintenance is that the state of the rules engine works out before fire-rules returns.  But if you, say, performed operations on a database in a rule RHS you’d have to be careful about controlling rule ordering with salience etc.  Our workflows typically involve something retrieving data, providing the data to Clara, firing the rules, querying the resulting session, and then saving the query results - does that help?"><a href="#t1502733033533975" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-14</span> <span class="t" onclick="H(this)">17:50:33</span>                 wparker </span><span>@olivergeorge it might help if you can clarify your question.  From Clara’s point of view, it doesn’t matter what the ultimate source of the data it processes is.  Note though that if rules do things that depend on ordering you have to be careful since Clara can fire and then retract a rule; the contract when using truth maintenance is that the state of the rules engine works out before fire-rules returns.  But if you, say, performed operations on a database in a rule RHS you’d have to be careful about controlling rule ordering with salience etc.  Our workflows typically involve something retrieving data, providing the data to Clara, firing the rules, querying the resulting session, and then saving the query results - does that help?</span></div><div id="t1502771893000126" t="2017-08-15 04:38:13 olivergeorge Yes thanks. That makes sense. "><a href="#t1502771893000126" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-15</span> <span class="t" onclick="H(this)">04:38:13</span>            olivergeorge </span><span>Yes thanks. That makes sense. </span></div><div id="t1502804676000078" t="2017-08-15 13:44:36 souenzzo I can/I should run a query inside a rule? (query the &quot;self&quot;)"><a href="#t1502804676000078" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-15</span> <span class="t" onclick="H(this)">13:44:36</span>                souenzzo </span><span>I can/I should run a query inside a rule? (query the &quot;self&quot;)</span></div><div id="t1502809386000630" t="2017-08-15 15:03:06 mikerod @souenzzo it isn’t clear to me what you are trying to do"><a href="#t1502809386000630" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-15</span> <span class="t" onclick="H(this)">15:03:06</span>                 mikerod </span><span>@souenzzo it isn’t clear to me what you are trying to do</span></div><div id="t1502809397000155" t="2017-08-15 15:03:17 mikerod Currently you can’t run a query directly from within a rule"><a href="#t1502809397000155" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-15</span> <span class="t" onclick="H(this)">15:03:17</span>                 mikerod </span><span>Currently you can’t run a query directly from within a rule</span></div><div id="t1502809426000697" t="2017-08-15 15:03:46 mikerod but it’d probably be good to have some sort of example of what you are trying to accomplish or thinking about"><a href="#t1502809426000697" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-15</span> <span class="t" onclick="H(this)">15:03:46</span>                 mikerod </span><span>but it’d probably be good to have some sort of example of what you are trying to accomplish or thinking about</span></div><div id="t1502809578000706" t="2017-08-15 15:06:18 souenzzo I was trying to run a query on &quot;right side&quot; of a  defrule . But I already find another solution."><a href="#t1502809578000706" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-15</span> <span class="t" onclick="H(this)">15:06:18</span>                souenzzo </span><span>I was trying to run a query on &quot;right side&quot; of a </span><code>defrule</code><span>. But I already find another solution.</span></div><div id="t1503000442000001" t="2017-08-17 20:07:22 enn Can an accumulator accumulate across more than one fact type (joined on some field)? All of the examples show only a single fact type in the  :from  clause."><a href="#t1503000442000001" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-17</span> <span class="t" onclick="H(this)">20:07:22</span>                     enn </span><span>Can an accumulator accumulate across more than one fact type (joined on some field)? All of the examples show only a single fact type in the </span><code>:from</code><span> clause.</span></div><div id="t1503008432000163" t="2017-08-17 22:20:32 wparker @enn Strictly speaking no, but with a custom ancestors fn you can create a new type that is the parent of multiple types for whatever fact types you’re working with"><a href="#t1503008432000163" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-17</span> <span class="t" onclick="H(this)">22:20:32</span>                 wparker </span><span>@enn Strictly speaking no, but with a custom ancestors fn you can create a new type that is the parent of multiple types for whatever fact types you’re working with</span></div><div id="t1503008485000064" t="2017-08-17 22:21:25 wparker Same goes for other condition types as well"><a href="#t1503008485000064" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-17</span> <span class="t" onclick="H(this)">22:21:25</span>                 wparker </span><span>Same goes for other condition types as well</span></div><div id="t1503008506000153" t="2017-08-17 22:21:46 wparker e.g. if you have FactTypeA and FactTypeB, you can make FactTypeC a parent of both"><a href="#t1503008506000153" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-17</span> <span class="t" onclick="H(this)">22:21:46</span>                 wparker </span><span>e.g. if you have FactTypeA and FactTypeB, you can make FactTypeC a parent of both</span></div><div id="t1503008541000172" t="2017-08-17 22:22:21 wparker then [?facts &lt;- (acc/all) :from [FactTypeC (…)]] would accumulate on both FactTypeA and FactTypeC"><a href="#t1503008541000172" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-17</span> <span class="t" onclick="H(this)">22:22:21</span>                 wparker </span><span>then [?facts &lt;- (acc/all) :from [FactTypeC (…)]] would accumulate on both FactTypeA and FactTypeC</span></div><div id="t1503008578000215" t="2017-08-17 22:22:58 wparker see  http://www.clara-rules.org/docs/fact_type_customization/  for more info"><a href="#t1503008578000215" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-17</span> <span class="t" onclick="H(this)">22:22:58</span>                 wparker </span><span>see </span><a href="http://www.clara-rules.org/docs/fact_type_customization/" target="_blank">http://www.clara-rules.org/docs/fact_type_customization/</a><span> for more info</span></div><div id="t1503009920000366" t="2017-08-17 22:45:20 enn Interesting."><a href="#t1503009920000366" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-17</span> <span class="t" onclick="H(this)">22:45:20</span>                     enn </span><span>Interesting.</span></div><div id="t1503009924000216" t="2017-08-17 22:45:24 enn I hadn’t thought of that approach."><a href="#t1503009924000216" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-17</span> <span class="t" onclick="H(this)">22:45:24</span>                     enn </span><span>I hadn’t thought of that approach.</span></div><div id="t1503010029000072" t="2017-08-17 22:47:09 wparker Edit: “would accumulate on both FactTypeA and FactTypeB”"><a href="#t1503010029000072" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-17</span> <span class="t" onclick="H(this)">22:47:09</span>                 wparker </span><span>Edit: “would accumulate on both FactTypeA and FactTypeB”</span></div><div id="t1503031863000085" t="2017-08-18 04:51:03 iku000888 Has anyone tried using clara-rules via a self hosted cljs compiler?"><a href="#t1503031863000085" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-18</span> <span class="t" onclick="H(this)">04:51:03</span>               iku000888 </span><span>Has anyone tried using clara-rules via a self hosted cljs compiler?</span></div><div id="t1503031939000101" t="2017-08-18 04:52:19 iku000888 I run into errors like this"><a href="#t1503031939000101" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-18</span> <span class="t" onclick="H(this)">04:52:19</span>               iku000888 </span><span>I run into errors like this</span></div><div id="t1503031943000174" t="2017-08-18 04:52:23 iku000888 cljs.user=&gt; (require &apos;clara.rules)
            ⬆
WARNING: macroexpand already refers to: cljs.core/macroexpand being replaced by: clojure.reflect/macroexpand at line 33 clojure/reflect.cljs
                     ⬆
WARNING: Use of undeclared Var schema.utils$macros/class at line 25 schema/utils.clj
                     ⬆
WARNING: Use of undeclared Var schema.utils$macros/class at line 32 schema/utils.clj
                           ⬆
WARNING: Use of undeclared Var schema.utils$macros/format at line 36 schema/utils.clj
              ⬆
WARNING: No such namespace: clojure.lang.Compiler, could not locate clojure/lang/Compiler.cljs, clojure/lang/Compiler.cljc, or Closure namespace &quot;&quot; at line 49 schema/utils.clj
              ⬆
WARNING: Use of undeclared Var clojure.lang.Compiler/CHAR_MAP at line 49 schema/utils.clj
                                       ⬆
WARNING: Use of undeclared Var schema.utils$macros/class at line 64 schema/utils.clj
            ⬆
WARNING: Use of undeclared Var schema.utils$macros/print-method at line 95 schema/utils.clj
               ⬆
WARNING: Use of undeclared Var schema.utils$macros/print-method at line 96 schema/utils.clj
            ⬆
WARNING: Use of undeclared Var schema.utils$macros/print-method at line 116 schema/utils.clj
               ⬆
WARNING: Use of undeclared Var schema.utils$macros/print-method at line 117 schema/utils.clj
                                                   ⬆
WARNING: No such namespace: java.util.Collections, could not locate java/util/Collections.cljs, java/util/Collections.cljc, or Closure namespace &quot;&quot; at line 141 schema/utils.clj
                                                   ⬆
WARNING: Use of undeclared Var java.util.Collections/synchronizedMap at line 141 schema/utils.clj
                         ⬆
WARNING: Use of undeclared Var schema.utils$macros/class? at line 147 schema/utils.clj
                                                                                 ⬆
WARNING: Use of undeclared Var schema.utils$macros/class at line 148 schema/utils.clj
ERROR in file schema/utils.clj
	 (new)
	 Function.cljs.core.ex_info.cljs$core$IFn$_invoke$arity$3 (NO_SOURCE_FILE &lt;embedded&gt;:1935:200)
	 Function.cljs.analyzer.error.cljs$core$IFn$_invoke$arity$3 (NO_SOURCE_FILE &lt;embedded&gt;:2482:92)
	 (NO_SOURCE_FILE &lt;embedded&gt;:5947:100)
	 z (NO_SOURCE_FILE &lt;embedded&gt;:5948:13)
	 (NO_SOURCE_FILE &lt;embedded&gt;:5942:232)
	 (NO_SOURCE_FILE &lt;embedded&gt;:5862:482)
	 Object.cljs.js.load_macros (NO_SOURCE_FILE &lt;embedded&gt;:5838:464)
	 (NO_SOURCE_FILE &lt;embedded&gt;:5857:20)
	 Object.cljs.js.load_macros (NO_SOURCE_FILE &lt;embedded&gt;:5838:464)

No protocol method IMultiFn.-add-method defined for type undefined: 
	 Object.cljs.core.missing_protocol (NO_SOURCE_FILE &lt;embedded&gt;:179:229)
	 cljs.core._add_method (NO_SOURCE_FILE &lt;embedded&gt;:1841:468)
	 (evalmachine.&lt;anonymous&gt;:272:23)
	 ContextifyScript.Script.runInThisContext (vm.cljs:44:33)
	 Object.runInThisContext (vm.cljs:116:38)
	 (Object.lumoEval)
	 lumo.repl.caching_node_eval (NO_SOURCE_FILE &lt;embedded&gt;:6211:68)
	 (NO_SOURCE_FILE &lt;embedded&gt;:5947:29)
	 z (NO_SOURCE_FILE &lt;embedded&gt;:5948:13)
	 (NO_SOURCE_FILE &lt;embedded&gt;:5942:232)
"><a href="#t1503031943000174" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-18</span> <span class="t" onclick="H(this)">04:52:23</span>               iku000888 </span><pre>cljs.user=&gt; (require &apos;clara.rules)
            ⬆
WARNING: macroexpand already refers to: cljs.core/macroexpand being replaced by: clojure.reflect/macroexpand at line 33 clojure/reflect.cljs
                     ⬆
WARNING: Use of undeclared Var schema.utils$macros/class at line 25 schema/utils.clj
                     ⬆
WARNING: Use of undeclared Var schema.utils$macros/class at line 32 schema/utils.clj
                           ⬆
WARNING: Use of undeclared Var schema.utils$macros/format at line 36 schema/utils.clj
              ⬆
WARNING: No such namespace: clojure.lang.Compiler, could not locate clojure/lang/Compiler.cljs, clojure/lang/Compiler.cljc, or Closure namespace &quot;&quot; at line 49 schema/utils.clj
              ⬆
WARNING: Use of undeclared Var clojure.lang.Compiler/CHAR_MAP at line 49 schema/utils.clj
                                       ⬆
WARNING: Use of undeclared Var schema.utils$macros/class at line 64 schema/utils.clj
            ⬆
WARNING: Use of undeclared Var schema.utils$macros/print-method at line 95 schema/utils.clj
               ⬆
WARNING: Use of undeclared Var schema.utils$macros/print-method at line 96 schema/utils.clj
            ⬆
WARNING: Use of undeclared Var schema.utils$macros/print-method at line 116 schema/utils.clj
               ⬆
WARNING: Use of undeclared Var schema.utils$macros/print-method at line 117 schema/utils.clj
                                                   ⬆
WARNING: No such namespace: java.util.Collections, could not locate java/util/Collections.cljs, java/util/Collections.cljc, or Closure namespace &quot;&quot; at line 141 schema/utils.clj
                                                   ⬆
WARNING: Use of undeclared Var java.util.Collections/synchronizedMap at line 141 schema/utils.clj
                         ⬆
WARNING: Use of undeclared Var schema.utils$macros/class? at line 147 schema/utils.clj
                                                                                 ⬆
WARNING: Use of undeclared Var schema.utils$macros/class at line 148 schema/utils.clj
ERROR in file schema/utils.clj
	 (new)
	 Function.cljs.core.ex_info.cljs$core$IFn$_invoke$arity$3 (NO_SOURCE_FILE &lt;embedded&gt;:1935:200)
	 Function.cljs.analyzer.error.cljs$core$IFn$_invoke$arity$3 (NO_SOURCE_FILE &lt;embedded&gt;:2482:92)
	 (NO_SOURCE_FILE &lt;embedded&gt;:5947:100)
	 z (NO_SOURCE_FILE &lt;embedded&gt;:5948:13)
	 (NO_SOURCE_FILE &lt;embedded&gt;:5942:232)
	 (NO_SOURCE_FILE &lt;embedded&gt;:5862:482)
	 Object.cljs.js.load_macros (NO_SOURCE_FILE &lt;embedded&gt;:5838:464)
	 (NO_SOURCE_FILE &lt;embedded&gt;:5857:20)
	 Object.cljs.js.load_macros (NO_SOURCE_FILE &lt;embedded&gt;:5838:464)

No protocol method IMultiFn.-add-method defined for type undefined: 
	 Object.cljs.core.missing_protocol (NO_SOURCE_FILE &lt;embedded&gt;:179:229)
	 cljs.core._add_method (NO_SOURCE_FILE &lt;embedded&gt;:1841:468)
	 (evalmachine.&lt;anonymous&gt;:272:23)
	 ContextifyScript.Script.runInThisContext (vm.cljs:44:33)
	 Object.runInThisContext (vm.cljs:116:38)
	 (Object.lumoEval)
	 lumo.repl.caching_node_eval (NO_SOURCE_FILE &lt;embedded&gt;:6211:68)
	 (NO_SOURCE_FILE &lt;embedded&gt;:5947:29)
	 z (NO_SOURCE_FILE &lt;embedded&gt;:5948:13)
	 (NO_SOURCE_FILE &lt;embedded&gt;:5942:232)
</pre></div><div id="t1503031991000175" t="2017-08-18 04:53:11 iku000888 I was testing out calvin and have a pretty tiny repro, if there is interest."><a href="#t1503031991000175" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-18</span> <span class="t" onclick="H(this)">04:53:11</span>               iku000888 </span><span>I was testing out calvin and have a pretty tiny repro, if there is interest.</span></div><div id="t1503033101000019" t="2017-08-18 05:11:41 iku000888 https://github.com/iku000888/tiny-samples/tree/master/node-and-cljs"><a href="#t1503033101000019" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-18</span> <span class="t" onclick="H(this)">05:11:41</span>               iku000888 </span><a href="https://github.com/iku000888/tiny-samples/tree/master/node-and-cljs" target="_blank">https://github.com/iku000888/tiny-samples/tree/master/node-and-cljs</a></div><div id="t1503070100000040" t="2017-08-18 15:28:20 wparker @iku000888 supporting self-hosted ClojureScript in Clara isn’t something we’ve looked at to my knowledge, and I would anticipate that changes would need to be made to support it.   If anyone has gotten that to work it would be interesting to know though.  From the looks of your errors Schema has some problems with self-hosted ClojureScript as well, so there might need to be changes there as well for self-hosted CLJS Clara to work.  Feel free to log an issue to Clara and anyone who wants to look at what that would take is welcome to do so.  It would be nice to have, it just hasn’t been a priority.   I canof how Schema would approach any problems with self-hosted ClojureScript in their codebase,"><a href="#t1503070100000040" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-18</span> <span class="t" onclick="H(this)">15:28:20</span>                 wparker </span><span>@iku000888 supporting self-hosted ClojureScript in Clara isn’t something we’ve looked at to my knowledge, and I would anticipate that changes would need to be made to support it.   If anyone has gotten that to work it would be interesting to know though.  From the looks of your errors Schema has some problems with self-hosted ClojureScript as well, so there might need to be changes there as well for self-hosted CLJS Clara to work.  Feel free to log an issue to Clara and anyone who wants to look at what that would take is welcome to do so.  It would be nice to have, it just hasn’t been a priority.   I canof how Schema would approach any problems with self-hosted ClojureScript in their codebase,</span></div><div id="t1503070164000708" t="2017-08-18 15:29:24 wparker I can’t speak to how Schema would approach any problems with self-hosted ClojureScript in their codebase, and I don’t know if there have been any previous discussions on the subject, but in my observation they’ve been pretty open to PRs, issues, etc. in the past"><a href="#t1503070164000708" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-18</span> <span class="t" onclick="H(this)">15:29:24</span>                 wparker </span><span>I can’t speak to how Schema would approach any problems with self-hosted ClojureScript in their codebase, and I don’t know if there have been any previous discussions on the subject, but in my observation they’ve been pretty open to PRs, issues, etc. in the past</span></div><div id="t1503070227000667" t="2017-08-18 15:30:27 iku000888 @wparker thanks for the feedback!"><a href="#t1503070227000667" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-18</span> <span class="t" onclick="H(this)">15:30:27</span>               iku000888 </span><span>@wparker thanks for the feedback!</span></div><div id="t1503070294000452" t="2017-08-18 15:31:34 iku000888 Will log an issue on the clara repo and schema (after checking they have an issue on self host)"><a href="#t1503070294000452" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-18</span> <span class="t" onclick="H(this)">15:31:34</span>               iku000888 </span><span>Will log an issue on the clara repo and schema (after checking they have an issue on self host)</span></div><div id="t1503070348000208" t="2017-08-18 15:32:28 iku000888 Would be super cool if self host support lands though, just saying  🙂"><a href="#t1503070348000208" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-18</span> <span class="t" onclick="H(this)">15:32:28</span>               iku000888 </span><span>Would be super cool if self host support lands though, just saying </span><b>🙂</b></div><div id="t1503070934000143" t="2017-08-18 15:42:14 iku000888 https://github.com/cerner/clara-rules/issues/337"><a href="#t1503070934000143" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-18</span> <span class="t" onclick="H(this)">15:42:14</span>               iku000888 </span><a href="https://github.com/cerner/clara-rules/issues/337" target="_blank">https://github.com/cerner/clara-rules/issues/337</a></div><div id="t1503070970000548" t="2017-08-18 15:42:50 iku000888 @wparker Is there is anything else I can provide?"><a href="#t1503070970000548" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-18</span> <span class="t" onclick="H(this)">15:42:50</span>               iku000888 </span><span>@wparker Is there is anything else I can provide?</span></div><div id="t1503071382000310" t="2017-08-18 15:49:42 wparker that works thanks @iku000888"><a href="#t1503071382000310" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-18</span> <span class="t" onclick="H(this)">15:49:42</span>                 wparker </span><span>that works thanks @iku000888</span></div><div id="t1503071393000043" t="2017-08-18 15:49:53 iku000888 Thanks again!"><a href="#t1503071393000043" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-18</span> <span class="t" onclick="H(this)">15:49:53</span>               iku000888 </span><span>Thanks again!</span></div><div id="t1503071531000094" t="2017-08-18 15:52:11 wparker There would need to be some changes to Clara as well for this, not just Schema.  A quick one that jumps out is that clara.rules.compiler is a clj file and has a java.beans.PropertyDescriptor import"><a href="#t1503071531000094" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-18</span> <span class="t" onclick="H(this)">15:52:11</span>                 wparker </span><span>There would need to be some changes to Clara as well for this, not just Schema.  A quick one that jumps out is that clara.rules.compiler is a clj file and has a java.beans.PropertyDescriptor import</span></div><div id="t1503071540000504" t="2017-08-18 15:52:20 wparker https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/rules/compiler.clj#L1"><a href="#t1503071540000504" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-18</span> <span class="t" onclick="H(this)">15:52:20</span>                 wparker </span><a href="https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/rules/compiler.clj#L1" target="_blank">https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/rules/compiler.clj#L1</a></div><div id="t1503071575000145" t="2017-08-18 15:52:55 wparker That’s the compiler from rules/queries to an executable structure"><a href="#t1503071575000145" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-18</span> <span class="t" onclick="H(this)">15:52:55</span>                 wparker </span><span>That’s the compiler from rules/queries to an executable structure</span></div><div id="t1503089558000115" t="2017-08-18 20:52:38 mikerod @enn  I’ll add on more possibility to this:
&gt; Can an accumulator accumulate across more than one fact type (joined on some field)? All of the examples show only a single fact type in the  :from  clause.

You can also “wrap” multiple types of facts in a common fact type and accumulate instead on that."><a href="#t1503089558000115" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-18</span> <span class="t" onclick="H(this)">20:52:38</span>                 mikerod </span><span>@enn  I’ll add on more possibility to this:
&gt; Can an accumulator accumulate across more than one fact type (joined on some field)? All of the examples show only a single fact type in the </span><code>:from</code><span> clause.

You can also “wrap” multiple types of facts in a common fact type and accumulate instead on that.</span></div><div id="t1503089574000354" t="2017-08-18 20:52:54 mikerod without a need of actually creating a real ancestor, hierarchical change"><a href="#t1503089574000354" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-18</span> <span class="t" onclick="H(this)">20:52:54</span>                 mikerod </span><span>without a need of actually creating a real ancestor, hierarchical change</span></div><div id="t1503089728000312" t="2017-08-18 20:55:28 mikerod (defrecord CommonWrap [wrapped])

(r/defrule wrap-fact-a
[?a &lt;- FactA]
=&gt;
(r/insert! (-&gt;CommonWrap ?a)))

(r/defrule wrap-fact-b
[?b &lt;- FactB]
=&gt;
(r/insert! (-&gt;CommonWrap ?b)))


(r/defrule accum-them
[?acc &lt;- my-accumulator :from [CommonWrap]]
&lt;etc&gt;
=&gt;
&lt;rhs&gt;)
"><a href="#t1503089728000312" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-18</span> <span class="t" onclick="H(this)">20:55:28</span>                 mikerod </span><pre>(defrecord CommonWrap [wrapped])

(r/defrule wrap-fact-a
[?a &lt;- FactA]
=&gt;
(r/insert! (-&gt;CommonWrap ?a)))

(r/defrule wrap-fact-b
[?b &lt;- FactB]
=&gt;
(r/insert! (-&gt;CommonWrap ?b)))


(r/defrule accum-them
[?acc &lt;- my-accumulator :from [CommonWrap]]
&lt;etc&gt;
=&gt;
&lt;rhs&gt;)
</pre></div><div id="t1503089770000350" t="2017-08-18 20:56:10 mikerod the accumulator could just access the original, field “x”, like  (-&gt; w :wrapped :x)"><a href="#t1503089770000350" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-18</span> <span class="t" onclick="H(this)">20:56:10</span>                 mikerod </span><span>the accumulator could just access the original, field “x”, like </span><code>(-&gt; w :wrapped :x)</code></div><div id="t1503089789000236" t="2017-08-18 20:56:29 mikerod or you could make it have the same fields as the original even with
 (r/insert! (-&gt;CommonWrap ?a))
"><a href="#t1503089789000236" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-18</span> <span class="t" onclick="H(this)">20:56:29</span>                 mikerod </span><span>or you could make it have the same fields as the original even with
</span><pre>(r/insert! (-&gt;CommonWrap ?a))
</pre></div><div id="t1503089927000187" t="2017-08-18 20:58:47 mikerod &gt; There would need to be some changes to Clara as well for this, not just Schema.
Yeah, I think  clara.rules.compiler  would probably require the most work on self-hosting"><a href="#t1503089927000187" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-18</span> <span class="t" onclick="H(this)">20:58:47</span>                 mikerod </span><span>&gt; There would need to be some changes to Clara as well for this, not just Schema.
Yeah, I think </span><code>clara.rules.compiler</code><span> would probably require the most work on self-hosting</span></div><div id="t1503089937000017" t="2017-08-18 20:58:57 mikerod (aside from schema breaking clara anyways)"><a href="#t1503089937000017" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-18</span> <span class="t" onclick="H(this)">20:58:57</span>                 mikerod </span><span>(aside from schema breaking clara anyways)</span></div><div id="t1503089947000381" t="2017-08-18 20:59:07 mikerod unless there is a way to just not use the schema on the self-host side"><a href="#t1503089947000381" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-18</span> <span class="t" onclick="H(this)">20:59:07</span>                 mikerod </span><span>unless there is a way to just not use the schema on the self-host side</span></div><div id="t1503089967000126" t="2017-08-18 20:59:27 mikerod I think technically, the schema are just used for testing and documentation purposes"><a href="#t1503089967000126" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-18</span> <span class="t" onclick="H(this)">20:59:27</span>                 mikerod </span><span>I think technically, the schema are just used for testing and documentation purposes</span></div><div id="t1503089974000078" t="2017-08-18 20:59:34 mikerod but wouldn’t be too trivial I don’t think still"><a href="#t1503089974000078" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-18</span> <span class="t" onclick="H(this)">20:59:34</span>                 mikerod </span><span>but wouldn’t be too trivial I don’t think still</span></div><div id="t1503089987000080" t="2017-08-18 20:59:47 mikerod Also, the “durability” feature of Clara would likely have trouble"><a href="#t1503089987000080" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-18</span> <span class="t" onclick="H(this)">20:59:47</span>                 mikerod </span><span>Also, the “durability” feature of Clara would likely have trouble</span></div><div id="t1503090001000305" t="2017-08-18 21:00:01 mikerod but may not be needed anyways and probably could just be skipped for that sort of build"><a href="#t1503090001000305" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-18</span> <span class="t" onclick="H(this)">21:00:01</span>                 mikerod </span><span>but may not be needed anyways and probably could just be skipped for that sort of build</span></div><div id="t1503347865000379" t="2017-08-21 20:37:45 souenzzo How to test  [:test (is-it-possible? ?foo ?bar)] ??"><a href="#t1503347865000379" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-21</span> <span class="t" onclick="H(this)">20:37:45</span>                souenzzo </span><span>How to test </span><code>[:test (is-it-possible? ?foo ?bar)]</code><span>??</span></div><div id="t1503418299000675" t="2017-08-22 16:11:39 wparker I don’t understand your question - could you clarify?"><a href="#t1503418299000675" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-22</span> <span class="t" onclick="H(this)">16:11:39</span>                      wparker </span><span>I don’t understand your question - could you clarify?</span></div><div id="t1503427406000048" t="2017-08-22 18:43:26 souenzzo I find out that  (= ?foo ?bar)  isn&apos;t a function. For now I&apos;m using  [?res &lt;- (my-fn? ?foo ?bar)] [:test (= ?res true)]"><a href="#t1503427406000048" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-22</span> <span class="t" onclick="H(this)">18:43:26</span>                     souenzzo </span><span>I find out that </span><code>(= ?foo ?bar)</code><span> isn&apos;t a function. For now I&apos;m using </span><code>[?res &lt;- (my-fn? ?foo ?bar)] [:test (= ?res true)]</code></div><div id="t1503431491000455" t="2017-08-22 19:51:31 souenzzo I&apos;m having trouble with:
 lein test  - pass all my tests
 *on repl*  - I can test multiple times and get ok, but when I reload the rules namespace, all rules behavior change (my test fail)
How to debug?"><a href="#t1503431491000455" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-22</span> <span class="t" onclick="H(this)">19:51:31</span>                souenzzo </span><span>I&apos;m having trouble with:
</span><code>lein test</code><span> - pass all my tests
</span><code>*on repl*</code><span> - I can test multiple times and get ok, but when I reload the rules namespace, all rules behavior change (my test fail)
How to debug?</span></div><div id="t1503495522000415" t="2017-08-23 13:38:42 ryanbrush @souenzzo There are a couple pitfalls on the that can happen.  One is that the rule session is being cached, so you&apos;re re-running previous rules. This can be turned off by passing :cache false to mk-session as described at  http://www.clara-rules.org/apidocs/0.15.2/clojure/clara.rules.html#var-mk-session"><a href="#t1503495522000415" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-23</span> <span class="t" onclick="H(this)">13:38:42</span>               ryanbrush </span><span>@souenzzo There are a couple pitfalls on the that can happen.  One is that the rule session is being cached, so you&apos;re re-running previous rules. This can be turned off by passing :cache false to mk-session as described at </span><a href="http://www.clara-rules.org/apidocs/0.15.2/clojure/clara.rules.html#var-mk-session" target="_blank">http://www.clara-rules.org/apidocs/0.15.2/clojure/clara.rules.html#var-mk-session</a></div><div id="t1503495570000119" t="2017-08-23 13:39:30 ryanbrush The other pitfall that can happen is if you&apos;re reloading your fact types, the reloaded types may be a different class than what Clara was compiled against, so the facts won&apos;t match."><a href="#t1503495570000119" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-23</span> <span class="t" onclick="H(this)">13:39:30</span>               ryanbrush </span><span>The other pitfall that can happen is if you&apos;re reloading your fact types, the reloaded types may be a different class than what Clara was compiled against, so the facts won&apos;t match.</span></div><div id="t1503495598000439" t="2017-08-23 13:39:58 ryanbrush This can also be addressed by not caching the rules session as described above, or by placing the fact types in a namespace that isn&apos;t reloaded in your REPL."><a href="#t1503495598000439" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-23</span> <span class="t" onclick="H(this)">13:39:58</span>               ryanbrush </span><span>This can also be addressed by not caching the rules session as described above, or by placing the fact types in a namespace that isn&apos;t reloaded in your REPL.</span></div><div id="t1503495621000705" t="2017-08-23 13:40:21 ryanbrush Of course, this only applies if you&apos;re using the Java or Clojure type system for your facts (which is the default) rather than using a custom fact type."><a href="#t1503495621000705" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-23</span> <span class="t" onclick="H(this)">13:40:21</span>               ryanbrush </span><span>Of course, this only applies if you&apos;re using the Java or Clojure type system for your facts (which is the default) rather than using a custom fact type.</span></div><div id="t1503497539000035" t="2017-08-23 14:12:19 souenzzo Already tryied with  :cache false ,  :cache true ..."><a href="#t1503497539000035" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-23</span> <span class="t" onclick="H(this)">14:12:19</span>                souenzzo </span><span>Already tryied with </span><code>:cache false</code><span>, </span><code>:cache true</code><span>...</span></div><div id="t1503497562000302" t="2017-08-23 14:12:42 souenzzo I will try to move  defrecord  to another ns"><a href="#t1503497562000302" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-23</span> <span class="t" onclick="H(this)">14:12:42</span>                souenzzo </span><span>I will try to move </span><code>defrecord</code><span> to another ns</span></div><div id="t1503498598000757" t="2017-08-23 14:29:58 souenzzo Oh. I noticed that my problems started when I started importing records in different namespaces. (still moving to test if records in a &quot;standalone&quot; ns will solve)"><a href="#t1503498598000757" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-23</span> <span class="t" onclick="H(this)">14:29:58</span>                souenzzo </span><span>Oh. I noticed that my problems started when I started importing records in different namespaces. (still moving to test if records in a &quot;standalone&quot; ns will solve)</span></div><div id="t1503499587000726" t="2017-08-23 14:46:27 souenzzo fixed. @ryanbrush clara docs should contains this info."><a href="#t1503499587000726" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-23</span> <span class="t" onclick="H(this)">14:46:27</span>                souenzzo </span><span>fixed. @ryanbrush clara docs should contains this info.</span></div><div id="t1503516337000352" t="2017-08-23 19:25:37 mikerod @souenzzo Just to add to this conversation: 
This does sound like something that may be a good idea to point out in some sort of Clara docs, especially concerning development time.
However, records getting redefined I think is often at odds with a dynamic repl reloading workflow. I don’t think Clara is the only place affected."><a href="#t1503516337000352" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-23</span> <span class="t" onclick="H(this)">19:25:37</span>                 mikerod </span><span>@souenzzo Just to add to this conversation: 
This does sound like something that may be a good idea to point out in some sort of Clara docs, especially concerning development time.
However, records getting redefined I think is often at odds with a dynamic repl reloading workflow. I don’t think Clara is the only place affected.</span></div><div id="t1503516460000276" t="2017-08-23 19:27:40 mikerod Not to suggest to use this lib or not, just to point out I’ve seen the same concern addressed before  https://github.com/ztellman/potemkin/blob/0.4.4/src/potemkin/types.clj#L326"><a href="#t1503516460000276" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-23</span> <span class="t" onclick="H(this)">19:27:40</span>                 mikerod </span><span>Not to suggest to use this lib or not, just to point out I’ve seen the same concern addressed before </span><a href="https://github.com/ztellman/potemkin/blob/0.4.4/src/potemkin/types.clj#L326" target="_blank">https://github.com/ztellman/potemkin/blob/0.4.4/src/potemkin/types.clj#L326</a></div><div id="t1503516539000173" t="2017-08-23 19:28:59 mikerod At one point Plumatic (formerly prismatic) Schema actually defaulted to using  potemkin s  defrecord+  to avoid recreated classes with the same name,  that have no impl change, in a new dynamic classloader during (probably repl) reloads"><a href="#t1503516539000173" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-23</span> <span class="t" onclick="H(this)">19:28:59</span>                 mikerod </span><span>At one point Plumatic (formerly prismatic) Schema actually defaulted to using </span><code>potemkin</code><span>s </span><code>defrecord+</code><span> to avoid recreated classes with the same name,  that have no impl change, in a new dynamic classloader during (probably repl) reloads</span></div><div id="t1503516599000217" t="2017-08-23 19:29:59 mikerod (still exists in schema now, but as an “optional” dependency  https://github.com/plumatic/schema/blob/schema-1.1.6/src/clj/schema/potemkin.clj )"><a href="#t1503516599000217" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-23</span> <span class="t" onclick="H(this)">19:29:59</span>                 mikerod </span><span>(still exists in schema now, but as an “optional” dependency </span><a href="https://github.com/plumatic/schema/blob/schema-1.1.6/src/clj/schema/potemkin.clj" target="_blank">https://github.com/plumatic/schema/blob/schema-1.1.6/src/clj/schema/potemkin.clj</a><span>)</span></div><div id="t1503516633000292" t="2017-08-23 19:30:33 mikerod I’m just pointing this out because in the past I used this “non reloading” style of defrecord to avoid weird issues with a record class getting reloading, with references still around to the old version of the class"><a href="#t1503516633000292" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-23</span> <span class="t" onclick="H(this)">19:30:33</span>                 mikerod </span><span>I’m just pointing this out because in the past I used this “non reloading” style of defrecord to avoid weird issues with a record class getting reloading, with references still around to the old version of the class</span></div><div id="t1503516658000079" t="2017-08-23 19:30:58 mikerod you can get away with moving record definitions into some namespace you are careful to not  :reload  though"><a href="#t1503516658000079" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-23</span> <span class="t" onclick="H(this)">19:30:58</span>                 mikerod </span><span>you can get away with moving record definitions into some namespace you are careful to not </span><code>:reload</code><span> though</span></div><div id="t1503516670000437" t="2017-08-23 19:31:10 mikerod as long as you don’t want to do something like  :reload-all"><a href="#t1503516670000437" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-23</span> <span class="t" onclick="H(this)">19:31:10</span>                 mikerod </span><span>as long as you don’t want to do something like </span><code>:reload-all</code></div><div id="t1503516741000071" t="2017-08-23 19:32:21 souenzzo There is a document about repl development
 https://github.com/cerner/clara-rules/wiki/Using-Clara-from-the-REPL 
just add a mention/reference/tip about &quot;be warning on reload types/records across namespaces&quot;."><a href="#t1503516741000071" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-23</span> <span class="t" onclick="H(this)">19:32:21</span>                souenzzo </span><span>There is a document about repl development
</span><a href="https://github.com/cerner/clara-rules/wiki/Using-Clara-from-the-REPL" target="_blank">https://github.com/cerner/clara-rules/wiki/Using-Clara-from-the-REPL</a><span>
just add a mention/reference/tip about &quot;be warning on reload types/records across namespaces&quot;.</span></div><div id="t1503516822000213" t="2017-08-23 19:33:42 mikerod nice"><a href="#t1503516822000213" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-23</span> <span class="t" onclick="H(this)">19:33:42</span>                 mikerod </span><span>nice</span></div><div id="t1503520124000546" t="2017-08-23 20:28:44 dadair Is it possible to specify multiple namespaces for  mk-session ? I have rules organized across a couple namespaces (to guarantee zero collaboration between two distinct rule sets that use common facts), and want to share common queries in a  shared  namespace. I&apos;ve tried both  (mk-session &apos;ns.one &apos;ns.shared)  and  (mk-session [&apos;ns.one &apos;ns.shared])  and get a  query invalid or not in rule base  error for the shared queries"><a href="#t1503520124000546" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-23</span> <span class="t" onclick="H(this)">20:28:44</span>                  dadair </span><span>Is it possible to specify multiple namespaces for </span><code>mk-session</code><span>? I have rules organized across a couple namespaces (to guarantee zero collaboration between two distinct rule sets that use common facts), and want to share common queries in a </span><code>shared</code><span> namespace. I&apos;ve tried both </span><code>(mk-session &apos;ns.one &apos;ns.shared)</code><span> and </span><code>(mk-session [&apos;ns.one &apos;ns.shared])</code><span> and get a </span><code>query invalid or not in rule base</code><span> error for the shared queries</span></div><div id="t1503523466000291" t="2017-08-23 21:24:26 wparker Example of such usage:  https://github.com/cerner/clara-rules/blob/master/src/test/clojure/clara/test_rules.clj#L1144"><a href="#t1503523466000291" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-23</span> <span class="t" onclick="H(this)">21:24:26</span>                      wparker </span><span>Example of such usage: </span><a href="https://github.com/cerner/clara-rules/blob/master/src/test/clojure/clara/test_rules.clj#L1144" target="_blank">https://github.com/cerner/clara-rules/blob/master/src/test/clojure/clara/test_rules.clj#L1144</a></div><div id="t1503520366000283" t="2017-08-23 20:32:46 souenzzo (mk-session &apos;full-ns.name &apos;full-ns.name2)  works for me"><a href="#t1503520366000283" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-23</span> <span class="t" onclick="H(this)">20:32:46</span>                souenzzo </span><code>(mk-session &apos;full-ns.name &apos;full-ns.name2)</code><span> works for me</span></div><div id="t1503520699000220" t="2017-08-23 20:38:19 dadair seams to be working now  😕  shrug"><a href="#t1503520699000220" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-23</span> <span class="t" onclick="H(this)">20:38:19</span>                  dadair </span><span>seams to be working now </span><b>😕</b><span> shrug</span></div><div id="t1503520709000330" t="2017-08-23 20:38:29 dadair must have had some weird REPL state"><a href="#t1503520709000330" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-23</span> <span class="t" onclick="H(this)">20:38:29</span>                  dadair </span><span>must have had some weird REPL state</span></div><div id="t1503647666000049" t="2017-08-25 07:54:26 iku000888 Not sure how I can express this, but is there a way to express a left-join type of a rule?"><a href="#t1503647666000049" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-25</span> <span class="t" onclick="H(this)">07:54:26</span>               iku000888 </span><span>Not sure how I can express this, but is there a way to express a left-join type of a rule?</span></div><div id="t1503668643000177" t="2017-08-25 13:44:03 mikerod @iku000888 I’m thinking you’d probably write 2 rules in that case"><a href="#t1503668643000177" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-25</span> <span class="t" onclick="H(this)">13:44:03</span>                 mikerod </span><span>@iku000888 I’m thinking you’d probably write 2 rules in that case</span></div><div id="t1503668656000584" t="2017-08-25 13:44:16 mikerod or do some of the joining on the RHS - which I often hesitate to think is a good idea"><a href="#t1503668656000584" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-25</span> <span class="t" onclick="H(this)">13:44:16</span>                 mikerod </span><span>or do some of the joining on the RHS - which I often hesitate to think is a good idea</span></div><div id="t1503668720000418" t="2017-08-25 13:45:20 mikerod (r/defrule joins
  [A (= ?id id)]
  [B (= ?id id)]
  =&gt;
  (r/insert! (-&gt;C)))

(r/defrule nil-joins
  [A (= ?id id)]
  [:not [B (= ?id id)]]
  =&gt;
  (r/insert! (-&gt;C)))
"><a href="#t1503668720000418" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-25</span> <span class="t" onclick="H(this)">13:45:20</span>                 mikerod </span><pre>(r/defrule joins
  [A (= ?id id)]
  [B (= ?id id)]
  =&gt;
  (r/insert! (-&gt;C)))

(r/defrule nil-joins
  [A (= ?id id)]
  [:not [B (= ?id id)]]
  =&gt;
  (r/insert! (-&gt;C)))
</pre></div><div id="t1503668725000333" t="2017-08-25 13:45:25 mikerod is that the “left join” sort of thing?"><a href="#t1503668725000333" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-25</span> <span class="t" onclick="H(this)">13:45:25</span>                 mikerod </span><span>is that the “left join” sort of thing?</span></div><div id="t1503668782000476" t="2017-08-25 13:46:22 mikerod A  always produce a  C , just sometimes there is no  B  to go with an  A"><a href="#t1503668782000476" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-25</span> <span class="t" onclick="H(this)">13:46:22</span>                 mikerod </span><code>A</code><span> always produce a </span><code>C</code><span>, just sometimes there is no </span><code>B</code><span> to go with an </span><code>A</code></div><div id="t1503668795000283" t="2017-08-25 13:46:35 mikerod C  can hold whatever info you wanted out of the join"><a href="#t1503668795000283" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-25</span> <span class="t" onclick="H(this)">13:46:35</span>                 mikerod </span><code>C</code><span> can hold whatever info you wanted out of the join</span></div><div id="t1503879997000004" t="2017-08-28 00:26:37 iku000888 @mikerod Thanks! I was struggling because for this specific problem coming up it was not clear how to create facts that are  [:not [B (= ?id id)]]"><a href="#t1503879997000004" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-28</span> <span class="t" onclick="H(this)">00:26:37</span>               iku000888 </span><span>@mikerod Thanks! I was struggling because for this specific problem coming up it was not clear how to create facts that are </span><code>[:not [B (= ?id id)]]</code></div><div id="t1503880025000062" t="2017-08-28 00:27:05 iku000888 (I would only have facts that are    [B (= ?id id)] )"><a href="#t1503880025000062" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-28</span> <span class="t" onclick="H(this)">00:27:05</span>               iku000888 </span><span>(I would only have facts that are   </span><code>[B (= ?id id)]</code><span>)</span></div><div id="t1503880088000049" t="2017-08-28 00:28:08 iku000888 But over the weekend I thought of retracting A&apos;s that do have a matching B"><a href="#t1503880088000049" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-28</span> <span class="t" onclick="H(this)">00:28:08</span>               iku000888 </span><span>But over the weekend I thought of retracting A&apos;s that do have a matching B</span></div><div id="t1503880097000093" t="2017-08-28 00:28:17 iku000888 Seems it should do the job"><a href="#t1503880097000093" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-28</span> <span class="t" onclick="H(this)">00:28:17</span>               iku000888 </span><span>Seems it should do the job</span></div><div id="t1503880098000072" t="2017-08-28 00:28:18 iku000888 🙂"><a href="#t1503880098000072" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-28</span> <span class="t" onclick="H(this)">00:28:18</span>               iku000888 </span><b>🙂</b></div><div id="t1504027259000050" t="2017-08-29 17:20:59 dadair I have a shared entry point into a rule session where a namespace associated with specific rules/queries can be applied:
 (defn run-rules
  &quot;Runs a rule session given a rule namespace, a root state tree node, and a performed action.&quot;
  [ns root action]
  (let [session (-&gt; (r/mk-session &apos;justice.rules.shared ns)
                    (r/insert (-&gt;Tree (walk/prewalk tree/augment-if-node root))
                              (-&gt;Action action))
                    (r/fire-rules))]
  ...
 
However, I get a  No namespace  exception when I pass a namespace in  eg. (run-rules &apos;justice.rules.x ..) . I&apos;ve &quot;fixed&quot; the issue by adding  (require ns)  inside  run-rules , but is there a better way to accomplish this? I could for example just require the namespaces in the  ns  declaration, or I could have a whitelist of namespaces to require, but I&apos;d like to keep adding new namespaces to be as simple as creating a new namespace and passing it in to the generic shared entrypoint."><a href="#t1504027259000050" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-29</span> <span class="t" onclick="H(this)">17:20:59</span>                  dadair </span><span>I have a shared entry point into a rule session where a namespace associated with specific rules/queries can be applied:
</span><pre>(defn run-rules
  &quot;Runs a rule session given a rule namespace, a root state tree node, and a performed action.&quot;
  [ns root action]
  (let [session (-&gt; (r/mk-session &apos;justice.rules.shared ns)
                    (r/insert (-&gt;Tree (walk/prewalk tree/augment-if-node root))
                              (-&gt;Action action))
                    (r/fire-rules))]
  ...
</pre><span>
However, I get a </span><code>No namespace</code><span> exception when I pass a namespace in </span><code>eg. (run-rules &apos;justice.rules.x ..)</code><span>. I&apos;ve &quot;fixed&quot; the issue by adding </span><code>(require ns)</code><span> inside </span><code>run-rules</code><span>, but is there a better way to accomplish this? I could for example just require the namespaces in the </span><code>ns</code><span> declaration, or I could have a whitelist of namespaces to require, but I&apos;d like to keep adding new namespaces to be as simple as creating a new namespace and passing it in to the generic shared entrypoint.</span></div><div id="t1504034496000360" t="2017-08-29 19:21:36 mikerod &gt; Thanks! I was struggling because for this specific problem coming up it was not clear how to create facts that are  [:not [B (= ?id id)]] 
@iku000888 sorry for long delay, just saw your response. I’m not sure what you mean to create a fact to match a negation (ie condition with a  :not ). The negation condition is used in conjuction with the  [A (= ?id id)]  in my example. This together forms a “join” sort of query for all  A  that do not have a matching  B .  So back to that example, repeating for clarity:

 (r/defrule joins
  [A (= ?id id)]
  [B (= ?id id)]
  =&gt;
  (r/insert! (-&gt;C)))

(r/defrule nil-joins
  [A (= ?id id)]
  [:not [B (= ?id id)]]
  =&gt;
  (r/insert! (-&gt;C)))
 

The rule names may not be the best, but sticking with them: 
* The rule  joins  is for the typical “inner join”  matches - it matches  A  with  B s they go with
* The rule  nil-joins  is for the “outer left” part of the join - it keeps the  A  results that do not have any actual join with a  B 

This may not be the specific issue you had, but that was my interpretation of your “left-join” type of rule question.

Given that you have something with retraction working, I’m thinking this is a different problem you are wanting to solve."><a href="#t1504034496000360" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-29</span> <span class="t" onclick="H(this)">19:21:36</span>                 mikerod </span><span>&gt; Thanks! I was struggling because for this specific problem coming up it was not clear how to create facts that are </span><code>[:not [B (= ?id id)]]</code><span>
@iku000888 sorry for long delay, just saw your response. I’m not sure what you mean to create a fact to match a negation (ie condition with a </span><code>:not</code><span>). The negation condition is used in conjuction with the </span><code>[A (= ?id id)]</code><span> in my example. This together forms a “join” sort of query for all </span><code>A</code><span> that do not have a matching </span><code>B</code><span>.  So back to that example, repeating for clarity:

</span><pre>(r/defrule joins
  [A (= ?id id)]
  [B (= ?id id)]
  =&gt;
  (r/insert! (-&gt;C)))

(r/defrule nil-joins
  [A (= ?id id)]
  [:not [B (= ?id id)]]
  =&gt;
  (r/insert! (-&gt;C)))
</pre><span>

The rule names may not be the best, but sticking with them: 
* The rule </span><code>joins</code><span> is for the typical “inner join”  matches - it matches </span><code>A</code><span> with </span><code>B</code><span>s they go with
* The rule </span><code>nil-joins</code><span> is for the “outer left” part of the join - it keeps the </span><code>A</code><span> results that do not have any actual join with a </span><code>B</code><span>

This may not be the specific issue you had, but that was my interpretation of your “left-join” type of rule question.

Given that you have something with retraction working, I’m thinking this is a different problem you are wanting to solve.</span></div><div id="t1504034565000081" t="2017-08-29 19:22:45 mikerod @dadair  Clojure or ClojureScript?"><a href="#t1504034565000081" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-29</span> <span class="t" onclick="H(this)">19:22:45</span>                 mikerod </span><span>@dadair  Clojure or ClojureScript?</span></div><div id="t1504034700000284" t="2017-08-29 19:25:00 mikerod Either way though,  r/mk-session  doesn’t attempt to require namespace for you."><a href="#t1504034700000284" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-29</span> <span class="t" onclick="H(this)">19:25:00</span>                 mikerod </span><span>Either way though, </span><code>r/mk-session</code><span> doesn’t attempt to require namespace for you.</span></div><div id="t1504034739000218" t="2017-08-29 19:25:39 mikerod I’m not positive that would be a great idea either. Best practice in clj would be to be sure to appropriately declare the namespace you want to have compiled - most preferably in the  ns  header  :require s"><a href="#t1504034739000218" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-29</span> <span class="t" onclick="H(this)">19:25:39</span>                 mikerod </span><span>I’m not positive that would be a great idea either. Best practice in clj would be to be sure to appropriately declare the namespace you want to have compiled - most preferably in the </span><code>ns</code><span> header </span><code>:require</code><span>s</span></div><div id="t1504034776000101" t="2017-08-29 19:26:16 mikerod You could get away with a dynamic  require  call in your  run-rules  though. I’ve had use-cases doing that before to load rules from arbitrary namespaces"><a href="#t1504034776000101" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-29</span> <span class="t" onclick="H(this)">19:26:16</span>                 mikerod </span><span>You could get away with a dynamic </span><code>require</code><span> call in your </span><code>run-rules</code><span> though. I’ve had use-cases doing that before to load rules from arbitrary namespaces</span></div><div id="t1504034797000044" t="2017-08-29 19:26:37 mikerod I don’t think there is a “better way to accomplish it” though in terms of what Clara currently offers."><a href="#t1504034797000044" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-29</span> <span class="t" onclick="H(this)">19:26:37</span>                 mikerod </span><span>I don’t think there is a “better way to accomplish it” though in terms of what Clara currently offers.</span></div><div id="t1504034811000436" t="2017-08-29 19:26:51 mikerod It expects things to already be compiled"><a href="#t1504034811000436" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-29</span> <span class="t" onclick="H(this)">19:26:51</span>                 mikerod </span><span>It expects things to already be compiled</span></div><div id="t1504035658000063" t="2017-08-29 19:40:58 dadair @mikerod thanks, this would be regular clojure. I&apos;ve moved away from dynamic require, as it was adding unnecessary compilation overhead (in terms of performance). I&apos;m still using a ns-whitelist var though rather than using the  (ns .. (:require ..))  form as I&apos;ve had some formatters remove the references as they are &quot;unused&quot;."><a href="#t1504035658000063" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-29</span> <span class="t" onclick="H(this)">19:40:58</span>                  dadair </span><span>@mikerod thanks, this would be regular clojure. I&apos;ve moved away from dynamic require, as it was adding unnecessary compilation overhead (in terms of performance). I&apos;m still using a ns-whitelist var though rather than using the </span><code>(ns .. (:require ..))</code><span> form as I&apos;ve had some formatters remove the references as they are &quot;unused&quot;.</span></div><div id="t1504035707000184" t="2017-08-29 19:41:47 mikerod Yeah, if you wait to do a  require  in the fn, it could be a pretty big slowdown depending on the size of it"><a href="#t1504035707000184" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-29</span> <span class="t" onclick="H(this)">19:41:47</span>                 mikerod </span><span>Yeah, if you wait to do a </span><code>require</code><span> in the fn, it could be a pretty big slowdown depending on the size of it</span></div><div id="t1504035722000503" t="2017-08-29 19:42:02 mikerod and perhaps could be better suited at “compilation time” with whatever else you have to start up the app"><a href="#t1504035722000503" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-29</span> <span class="t" onclick="H(this)">19:42:02</span>                 mikerod </span><span>and perhaps could be better suited at “compilation time” with whatever else you have to start up the app</span></div><div id="t1504035761000439" t="2017-08-29 19:42:41 mikerod Not to get too lost in the weeds, but Clara does have a few other alternatives instead of loading whole ns’s of rules"><a href="#t1504035761000439" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-29</span> <span class="t" onclick="H(this)">19:42:41</span>                 mikerod </span><span>Not to get too lost in the weeds, but Clara does have a few other alternatives instead of loading whole ns’s of rules</span></div><div id="t1504035941000646" t="2017-08-29 19:45:41 mikerod For example, you can provide collections of rules to  r/mk-session 
 (defrule r1 &lt;etc&gt;)
(defrule r2 &lt;etc&gt;)
(defrule r3 &lt;etc&gt;)

(def rule-group1 [r1 r2 r3])

(defrule r4 &lt;etc&gt;)
(defrule r5 &lt;etc&gt;)
(defquery q1 &lt;etc&gt;)

(def rule-group2 [r4 r5 q1])

(defrule r6 &lt;etc&gt;)


&lt;....&gt;

(r/mk-session rule-group1 rule-group2 [r6])
"><a href="#t1504035941000646" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-29</span> <span class="t" onclick="H(this)">19:45:41</span>                 mikerod </span><span>For example, you can provide collections of rules to </span><code>r/mk-session</code><span>
</span><pre>(defrule r1 &lt;etc&gt;)
(defrule r2 &lt;etc&gt;)
(defrule r3 &lt;etc&gt;)

(def rule-group1 [r1 r2 r3])

(defrule r4 &lt;etc&gt;)
(defrule r5 &lt;etc&gt;)
(defquery q1 &lt;etc&gt;)

(def rule-group2 [r4 r5 q1])

(defrule r6 &lt;etc&gt;)


&lt;....&gt;

(r/mk-session rule-group1 rule-group2 [r6])
</pre></div><div id="t1504117488000105" t="2017-08-30 18:24:48 wparker @dadair Agreed with @mikerod ‘s previous comments.  I wanted to add that namespace compilation can have arbitrary effects in Clojure; one notable one is protocol extensions.    That is, a linter removing namespace whose vars you aren’t directly using from your requires could be dangerous to things other than Clara.  Also, note that require will short-circuits if the namespace already exists unless you specifically request reloading, so the performance question is really whether you pay the cost at initialization of your Clojure environment or the first time you build the relevant session."><a href="#t1504117488000105" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-30</span> <span class="t" onclick="H(this)">18:24:48</span>                      wparker </span><span>@dadair Agreed with @mikerod ‘s previous comments.  I wanted to add that namespace compilation can have arbitrary effects in Clojure; one notable one is protocol extensions.    That is, a linter removing namespace whose vars you aren’t directly using from your requires could be dangerous to things other than Clara.  Also, note that require will short-circuits if the namespace already exists unless you specifically request reloading, so the performance question is really whether you pay the cost at initialization of your Clojure environment or the first time you build the relevant session.</span></div><div id="t1504035961000433" t="2017-08-29 19:46:01 mikerod so you can pick in choose at different granularities is my point"><a href="#t1504035961000433" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-29</span> <span class="t" onclick="H(this)">19:46:01</span>                 mikerod </span><span>so you can pick in choose at different granularities is my point</span></div><div id="t1504114693000117" t="2017-08-30 17:38:13 mmer Hi I am a newbie who is looking to use clara to help understand large nested maps.  Is there an easy way to turn a large nested map into a series of facts?"><a href="#t1504114693000117" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-30</span> <span class="t" onclick="H(this)">17:38:13</span>                    mmer </span><span>Hi I am a newbie who is looking to use clara to help understand large nested maps.  Is there an easy way to turn a large nested map into a series of facts?</span></div><div id="t1504117659000375" t="2017-08-30 18:27:39 wparker @U4C3ZU6KX Not quite sure what your use-case is, but it seems like you could just use the normal map manipulation functions in clojure.core to create a “derived” sequence of facts to insert.  Perhaps just a recursive function that concatenates the facts at each nested level of the map/level of recursion?"><a href="#t1504117659000375" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-30</span> <span class="t" onclick="H(this)">18:27:39</span>                      wparker </span><span>@U4C3ZU6KX Not quite sure what your use-case is, but it seems like you could just use the normal map manipulation functions in clojure.core to create a “derived” sequence of facts to insert.  Perhaps just a recursive function that concatenates the facts at each nested level of the map/level of recursion?</span></div><div id="t1504196571000209" t="2017-08-31 16:22:51 dadair is it safe to call  insert!  from different threads? e.g., within a  future ? I have a way to not need this (e.g., gather data with the future and then insert! from the main thread), I&apos;m more just curious."><a href="#t1504196571000209" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-31</span> <span class="t" onclick="H(this)">16:22:51</span>                  dadair </span><span>is it safe to call </span><code>insert!</code><span> from different threads? e.g., within a </span><code>future</code><span>? I have a way to not need this (e.g., gather data with the future and then insert! from the main thread), I&apos;m more just curious.</span></div><div id="t1504201341000112" t="2017-08-31 17:42:21 mikerod @dadair I think that is a sort of tough question"><a href="#t1504201341000112" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-31</span> <span class="t" onclick="H(this)">17:42:21</span>                 mikerod </span><span>@dadair I think that is a sort of tough question</span></div><div id="t1504201352000649" t="2017-08-31 17:42:32 mikerod It seems dangerous to assume semantically"><a href="#t1504201352000649" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-31</span> <span class="t" onclick="H(this)">17:42:32</span>                 mikerod </span><span>It seems dangerous to assume semantically</span></div><div id="t1504201383000043" t="2017-08-31 17:43:03 mikerod I do think that implementation-wise, as long as every thread has fully completed their  r/insert!  prior to  r/fire-rules  it may work"><a href="#t1504201383000043" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-31</span> <span class="t" onclick="H(this)">17:43:03</span>                 mikerod </span><span>I do think that implementation-wise, as long as every thread has fully completed their </span><code>r/insert!</code><span> prior to </span><code>r/fire-rules</code><span> it may work</span></div><div id="t1504201392000571" t="2017-08-31 17:43:12 mikerod That isn’t to say I think it is a supported use-case"><a href="#t1504201392000571" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-31</span> <span class="t" onclick="H(this)">17:43:12</span>                 mikerod </span><span>That isn’t to say I think it is a supported use-case</span></div><div id="t1504201429000078" t="2017-08-31 17:43:49 mikerod So in general, during the “fire rules loop” cycle of the rules engine, the memory is in a mutable state"><a href="#t1504201429000078" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-31</span> <span class="t" onclick="H(this)">17:43:49</span>                 mikerod </span><span>So in general, during the “fire rules loop” cycle of the rules engine, the memory is in a mutable state</span></div><div id="t1504201472000435" t="2017-08-31 17:44:32 mikerod This is done primarily for performance. The caller perceives the working memory to be a persistent, immutable data structure that is returned after each call to  r/fire-rules  on a given sesion"><a href="#t1504201472000435" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-31</span> <span class="t" onclick="H(this)">17:44:32</span>                 mikerod </span><span>This is done primarily for performance. The caller perceives the working memory to be a persistent, immutable data structure that is returned after each call to </span><code>r/fire-rules</code><span> on a given sesion</span></div><div id="t1504201511000017" t="2017-08-31 17:45:11 mikerod However,  r/insert!  (and a few other similar ones) is called from rule RHS’s. That means it is sort of in that “fire rules loop” part of the lifecycle"><a href="#t1504201511000017" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-31</span> <span class="t" onclick="H(this)">17:45:11</span>                 mikerod </span><span>However, </span><code>r/insert!</code><span> (and a few other similar ones) is called from rule RHS’s. That means it is sort of in that “fire rules loop” part of the lifecycle</span></div><div id="t1504201834000444" t="2017-08-31 17:50:34 dadair yeah that makes sense, I thought as much"><a href="#t1504201834000444" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-31</span> <span class="t" onclick="H(this)">17:50:34</span>                  dadair </span><span>yeah that makes sense, I thought as much</span></div><div id="t1504213648000234" t="2017-08-31 21:07:28 souenzzo accumulators respect saliency?"><a href="#t1504213648000234" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-31</span> <span class="t" onclick="H(this)">21:07:28</span>                souenzzo </span><span>accumulators respect saliency?</span></div><div id="t1504220427000341" t="2017-08-31 23:00:27 wparker @souenzzo salience controls when a rule RHS (right-hand side, or consequence in other terms) fires; whether an accumulator is in the rule doesn’t impact it either way.  It won’t control the time you actually run the accumulator, though I’m not sure why you’d want to do that."><a href="#t1504220427000341" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-08-31</span> <span class="t" onclick="H(this)">23:00:27</span>                 wparker </span><span>@souenzzo salience controls when a rule RHS (right-hand side, or consequence in other terms) fires; whether an accumulator is in the rule doesn’t impact it either way.  It won’t control the time you actually run the accumulator, though I’m not sure why you’d want to do that.</span></div><div id="t1504276281000476" t="2017-09-01 14:31:21 mikerod Well, I know Drools (popular Java-based rules engine)(prior to v6) used to have a good amount of performance issues around accumulators."><a href="#t1504276281000476" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-01</span> <span class="t" onclick="H(this)">14:31:21</span>                 mikerod </span><span>Well, I know Drools (popular Java-based rules engine)(prior to v6) used to have a good amount of performance issues around accumulators.</span></div><div id="t1504276288000110" t="2017-09-01 14:31:28 mikerod Especially several in a rule"><a href="#t1504276288000110" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-01</span> <span class="t" onclick="H(this)">14:31:28</span>                 mikerod </span><span>Especially several in a rule</span></div><div id="t1504276316000174" t="2017-09-01 14:31:56 mikerod so people used to wish that salience would “delay” their evaluation"><a href="#t1504276316000174" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-01</span> <span class="t" onclick="H(this)">14:31:56</span>                 mikerod </span><span>so people used to wish that salience would “delay” their evaluation</span></div><div id="t1504276346000146" t="2017-09-01 14:32:26 mikerod Later on, a lot of laziness was added to Drools, but even more importantly (in my opinion) “batched” propagations of facts and it mostly solved the common issues around performance that came up."><a href="#t1504276346000146" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-01</span> <span class="t" onclick="H(this)">14:32:26</span>                 mikerod </span><span>Later on, a lot of laziness was added to Drools, but even more importantly (in my opinion) “batched” propagations of facts and it mostly solved the common issues around performance that came up.</span></div><div id="t1504276367000497" t="2017-09-01 14:32:47 mikerod Clara has “batched” propagation of facts, which seems to typically work out well. The engine basically “gathers” up collections of facts at a time that are matching conditions before propagating down the network. This results in typically less churn/rework as the data flows."><a href="#t1504276367000497" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-01</span> <span class="t" onclick="H(this)">14:32:47</span>                 mikerod </span><span>Clara has “batched” propagation of facts, which seems to typically work out well. The engine basically “gathers” up collections of facts at a time that are matching conditions before propagating down the network. This results in typically less churn/rework as the data flows.</span></div><div id="t1504276393000470" t="2017-09-01 14:33:13 mikerod Just pointing that out if the question of salience was more about performance than ordering semantics"><a href="#t1504276393000470" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-01</span> <span class="t" onclick="H(this)">14:33:13</span>                 mikerod </span><span>Just pointing that out if the question of salience was more about performance than ordering semantics</span></div><div id="t1504288881000270" t="2017-09-01 18:01:21 dadair I&apos;m not sure if this is directly tied to clara, but I am noticing a severe processing time drop the first time I run a rules session with a specific namespace. So for example,  (-&gt; (r/mk-session &apos;some.ns) (r/insert ..) .. (r/fire-rules))  takes 1000ms the first time it is called, but 50ms the second time. Is there some way I can reduce that first performance hit?"><a href="#t1504288881000270" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-01</span> <span class="t" onclick="H(this)">18:01:21</span>                  dadair </span><span>I&apos;m not sure if this is directly tied to clara, but I am noticing a severe processing time drop the first time I run a rules session with a specific namespace. So for example, </span><code>(-&gt; (r/mk-session &apos;some.ns) (r/insert ..) .. (r/fire-rules))</code><span> takes 1000ms the first time it is called, but 50ms the second time. Is there some way I can reduce that first performance hit?</span></div><div id="t1504288948000374" t="2017-09-01 18:02:28 dadair I know I need to profile the app to be sure what&apos;s going on, just darn jprofiler is too expensive &gt;.&lt;"><a href="#t1504288948000374" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-01</span> <span class="t" onclick="H(this)">18:02:28</span>                  dadair </span><span>I know I need to profile the app to be sure what&apos;s going on, just darn jprofiler is too expensive &gt;.&lt;</span></div><div id="t1504292423000587" t="2017-09-01 19:00:23 mikerod @dadair well, you can use  visualvm  for free"><a href="#t1504292423000587" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-01</span> <span class="t" onclick="H(this)">19:00:23</span>                 mikerod </span><span>@dadair well, you can use </span><code>visualvm</code><span> for free</span></div><div id="t1504292434000180" t="2017-09-01 19:00:34 mikerod which I’ve had enough luck with when profiling rules before"><a href="#t1504292434000180" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-01</span> <span class="t" onclick="H(this)">19:00:34</span>                 mikerod </span><span>which I’ve had enough luck with when profiling rules before</span></div><div id="t1504292483000211" t="2017-09-01 19:01:23 mikerod Oh,  r/mk-session  creates and then caches the rulebase (Rete graph)"><a href="#t1504292483000211" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-01</span> <span class="t" onclick="H(this)">19:01:23</span>                 mikerod </span><span>Oh, </span><code>r/mk-session</code><span> creates and then caches the rulebase (Rete graph)</span></div><div id="t1504292506000057" t="2017-09-01 19:01:46 mikerod Can you  (r/mk-session &apos;some.ns)  sometime earlier - like “startup”?"><a href="#t1504292506000057" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-01</span> <span class="t" onclick="H(this)">19:01:46</span>                 mikerod </span><span>Can you </span><code>(r/mk-session &apos;some.ns)</code><span> sometime earlier - like “startup”?</span></div><div id="t1504292545000148" t="2017-09-01 19:02:25 mikerod You’ll still take the hit though. Just maybe you could move the hit out of the processing where it is more painful."><a href="#t1504292545000148" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-01</span> <span class="t" onclick="H(this)">19:02:25</span>                 mikerod </span><span>You’ll still take the hit though. Just maybe you could move the hit out of the processing where it is more painful.</span></div><div id="t1504294447000283" t="2017-09-01 19:34:07 dadair awesome thank you, that will solve my issues (and thanks for the nudge at visualvm, looks good too!)"><a href="#t1504294447000283" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-01</span> <span class="t" onclick="H(this)">19:34:07</span>                  dadair </span><span>awesome thank you, that will solve my issues (and thanks for the nudge at visualvm, looks good too!)</span></div><div id="t1504294741000301" t="2017-09-01 19:39:01 dadair @mikerod if I different collections of ns (i.e.,  (r/mk-session &apos;ns.a &apos;ns.b &apos;ns.c)  vs  (r/mk-session &apos;ns.d &apos;ns.e &apos;ns.f)  can I pre-cache individual namespaces e.g.  (r/mk-session &apos;ns.a) ? Or would I have to pre-cache full collections  (r/mk-session &apos;ns.a &apos;ns.b &apos;ns.c) ? Basically, can I init each individually, if they are used in collections? Or will it only cache on the full collection."><a href="#t1504294741000301" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-01</span> <span class="t" onclick="H(this)">19:39:01</span>                  dadair </span><span>@mikerod if I different collections of ns (i.e., </span><code>(r/mk-session &apos;ns.a &apos;ns.b &apos;ns.c)</code><span> vs </span><code>(r/mk-session &apos;ns.d &apos;ns.e &apos;ns.f)</code><span> can I pre-cache individual namespaces e.g. </span><code>(r/mk-session &apos;ns.a)</code><span>? Or would I have to pre-cache full collections </span><code>(r/mk-session &apos;ns.a &apos;ns.b &apos;ns.c)</code><span>? Basically, can I init each individually, if they are used in collections? Or will it only cache on the full collection.</span></div><div id="t1504296319000173" t="2017-09-01 20:05:19 mikerod @dadair glad you can work with that. Building the rulebase graph can be a fairly expensive operation. It could perhaps be further optimized in Clara, but there are tricky aspects."><a href="#t1504296319000173" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-01</span> <span class="t" onclick="H(this)">20:05:19</span>                 mikerod </span><span>@dadair glad you can work with that. Building the rulebase graph can be a fairly expensive operation. It could perhaps be further optimized in Clara, but there are tricky aspects.</span></div><div id="t1504296342000045" t="2017-09-01 20:05:42 mikerod For one, there is some  eval  going on, which means it is running the clj compiler and I often see that time dominate for larger rulebase’s"><a href="#t1504296342000045" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-01</span> <span class="t" onclick="H(this)">20:05:42</span>                 mikerod </span><span>For one, there is some </span><code>eval</code><span> going on, which means it is running the clj compiler and I often see that time dominate for larger rulebase’s</span></div><div id="t1504296375000135" t="2017-09-01 20:06:15 mikerod (terminology things: the “rulebase” term just means the underlying “statess” Rete-based graph that is wired together with working memory within the “session”)"><a href="#t1504296375000135" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-01</span> <span class="t" onclick="H(this)">20:06:15</span>                 mikerod </span><span>(terminology things: the “rulebase” term just means the underlying “statess” Rete-based graph that is wired together with working memory within the “session”)</span></div><div id="t1504296396000027" t="2017-09-01 20:06:36 mikerod To answer your next question, you have to build the  r/mk-session  with all rules/queries involved at once"><a href="#t1504296396000027" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-01</span> <span class="t" onclick="H(this)">20:06:36</span>                 mikerod </span><span>To answer your next question, you have to build the </span><code>r/mk-session</code><span> with all rules/queries involved at once</span></div><div id="t1504296402000028" t="2017-09-01 20:06:42 mikerod Can’t build piece-by-piece"><a href="#t1504296402000028" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-01</span> <span class="t" onclick="H(this)">20:06:42</span>                 mikerod </span><span>Can’t build piece-by-piece</span></div><div id="t1504303001000144" t="2017-09-01 21:56:41 dadair ok great thank you @mikerod"><a href="#t1504303001000144" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-01</span> <span class="t" onclick="H(this)">21:56:41</span>                  dadair </span><span>ok great thank you @mikerod</span></div><div id="t1504728238000019" t="2017-09-06 20:03:58 mmer Hi there - very simple question - what is the best way to insert a list of records?  I am banging my head against a wall - hence the request for help"><a href="#t1504728238000019" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-06</span> <span class="t" onclick="H(this)">20:03:58</span>                    mmer </span><span>Hi there - very simple question - what is the best way to insert a list of records?  I am banging my head against a wall - hence the request for help</span></div><div id="t1504728506000541" t="2017-09-06 20:08:26 enn @mmer see  insert-all!"><a href="#t1504728506000541" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-06</span> <span class="t" onclick="H(this)">20:08:26</span>                     enn </span><span>@mmer see </span><code>insert-all!</code></div><div id="t1504728560000394" t="2017-09-06 20:09:20 mmer I tried that and when I look at the trace it is not inserting anything?"><a href="#t1504728560000394" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-06</span> <span class="t" onclick="H(this)">20:09:20</span>                    mmer </span><span>I tried that and when I look at the trace it is not inserting anything?</span></div><div id="t1504728768000388" t="2017-09-06 20:12:48 wparker @mmer are you doing this insertion from outside the session or in a rule right-hand side (consequence)?"><a href="#t1504728768000388" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-06</span> <span class="t" onclick="H(this)">20:12:48</span>                 wparker </span><span>@mmer are you doing this insertion from outside the session or in a rule right-hand side (consequence)?</span></div><div id="t1504728840000311" t="2017-09-06 20:14:00 mmer The problem is that I have a function returning a lazySeq and that is preventing it from being loaded!  Thanks -not a clara issue at all."><a href="#t1504728840000311" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-06</span> <span class="t" onclick="H(this)">20:14:00</span>                    mmer </span><span>The problem is that I have a function returning a lazySeq and that is preventing it from being loaded!  Thanks -not a clara issue at all.</span></div><div id="t1504729874000235" t="2017-09-06 20:31:14 wparker :+1:  just for completeness - the ! variants are to be used in rules, the variants without ! are to be used outside the session"><a href="#t1504729874000235" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-06</span> <span class="t" onclick="H(this)">20:31:14</span>                 wparker </span><b>:+1:</b><span> just for completeness - the ! variants are to be used in rules, the variants without ! are to be used outside the session</span></div><div id="t1504737573000058" t="2017-09-06 22:39:33 mmer Thanks - I got it working - highly nested maps caught me out along with laziness."><a href="#t1504737573000058" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-06</span> <span class="t" onclick="H(this)">22:39:33</span>                    mmer </span><span>Thanks - I got it working - highly nested maps caught me out along with laziness.</span></div><div id="t1504737612000291" t="2017-09-06 22:40:12 mmer I do have another question - in the [:test] block what expressions can be used.  For example is the following valid?"><a href="#t1504737612000291" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-06</span> <span class="t" onclick="H(this)">22:40:12</span>                    mmer </span><span>I do have another question - in the [:test] block what expressions can be used.  For example is the following valid?</span></div><div id="t1504737649000026" t="2017-09-06 22:40:49 mmer I seem to be getting a NullPointer error."><a href="#t1504737649000026" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-06</span> <span class="t" onclick="H(this)">22:40:49</span>                    mmer </span><span>I seem to be getting a NullPointer error.</span></div><div id="t1504738417000025" t="2017-09-06 22:53:37 mmer The reason for the NullPointer was that I was passing nil into :test."><a href="#t1504738417000025" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-06</span> <span class="t" onclick="H(this)">22:53:37</span>                    mmer </span><span>The reason for the NullPointer was that I was passing nil into :test.</span></div><div id="t1504760245000094" t="2017-09-07 04:57:25 dadair Is there any reason why a LHS such as  [A (= ?x x)] [B (= ?y y)]  where  x  and  y  definitely exist (non-nil), would not fire with the order  [A ..] [B ..]  but would fire with  [B ..] [A ..] ?"><a href="#t1504760245000094" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-07</span> <span class="t" onclick="H(this)">04:57:25</span>                  dadair </span><span>Is there any reason why a LHS such as </span><code>[A (= ?x x)] [B (= ?y y)]</code><span> where </span><code>x</code><span> and </span><code>y</code><span> definitely exist (non-nil), would not fire with the order </span><code>[A ..] [B ..]</code><span> but would fire with </span><code>[B ..] [A ..]</code><span>?</span></div><div id="t1504791761000255" t="2017-09-07 13:42:41 mikerod @dadair I don’t see how it should be different. Do you have a more complete rule example?"><a href="#t1504791761000255" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-07</span> <span class="t" onclick="H(this)">13:42:41</span>                 mikerod </span><span>@dadair I don’t see how it should be different. Do you have a more complete rule example?</span></div><div id="t1504791773000036" t="2017-09-07 13:42:53 mikerod Just to be sure you don’t have any extra constructs in play?"><a href="#t1504791773000036" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-07</span> <span class="t" onclick="H(this)">13:42:53</span>                 mikerod </span><span>Just to be sure you don’t have any extra constructs in play?</span></div><div id="t1504796028000276" t="2017-09-07 14:53:48 wparker @dadair @U0LK1552A I wouldn’t expect that kind of ordering to make a difference for non-accumulator rule conditions normally.  If you are using manual retractions in rule RHS’s (right-hand-sides) you might be able to get yourself into some odd situations with undefined behavior that could be impacted.  A more concrete reproducing example would be helpful to see if there’s a bug.  For accumulators, it isn’t the easiest edge case to hit, but  https://github.com/cerner/clara-rules/issues/218  is outstanding."><a href="#t1504796028000276" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-07</span> <span class="t" onclick="H(this)">14:53:48</span>                      wparker </span><span>@dadair @U0LK1552A I wouldn’t expect that kind of ordering to make a difference for non-accumulator rule conditions normally.  If you are using manual retractions in rule RHS’s (right-hand-sides) you might be able to get yourself into some odd situations with undefined behavior that could be impacted.  A more concrete reproducing example would be helpful to see if there’s a bug.  For accumulators, it isn’t the easiest edge case to hit, but </span><a href="https://github.com/cerner/clara-rules/issues/218" target="_blank">https://github.com/cerner/clara-rules/issues/218</a><span> is outstanding.</span></div><div id="t1504796093000146" t="2017-09-07 14:54:53 wparker Also, regarding your example  `[A (= ?x x)] [B (= ?y y)] ` I wouldn’t actually expect whether x or y is nil to impact whether the rule fires at least based on those conditions alone"><a href="#t1504796093000146" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-07</span> <span class="t" onclick="H(this)">14:54:53</span>                      wparker </span><span>Also, regarding your example </span><pre>`[A (= ?x x)] [B (= ?y y)]</pre><span>` I wouldn’t actually expect whether x or y is nil to impact whether the rule fires at least based on those conditions alone</span></div><div id="t1504796212000100" t="2017-09-07 14:56:52 wparker those aren’t result bindings, having a field value of a fact be nil (but the fact itself being nil) is a reasonable possibility and Clara will handle that"><a href="#t1504796212000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-07</span> <span class="t" onclick="H(this)">14:56:52</span>                      wparker </span><span>those aren’t result bindings, having a field value of a fact be nil (but the fact itself being nil) is a reasonable possibility and Clara will handle that</span></div><div id="t1504796591000133" t="2017-09-07 15:03:11 mikerod Yep, that’s the reason was asking for more details to be sure there aren’t things like accumulators in play. Things get more complicated then."><a href="#t1504796591000133" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-07</span> <span class="t" onclick="H(this)">15:03:11</span>                      mikerod </span><span>Yep, that’s the reason was asking for more details to be sure there aren’t things like accumulators in play. Things get more complicated then.</span></div><div id="t1504801244000183" t="2017-09-07 16:20:44 dadair There seemed to be an issue with using a pre-cached rule session. I was looping through some known mk-session configurations and swapping them into an atom so I could avoid the first performance hit. Then later I&apos;d pull the specific session out of the atom and would insert some facts and fire rules. For some reason this was causing really weird rule activation problems"><a href="#t1504801244000183" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-07</span> <span class="t" onclick="H(this)">16:20:44</span>                       dadair </span><span>There seemed to be an issue with using a pre-cached rule session. I was looping through some known mk-session configurations and swapping them into an atom so I could avoid the first performance hit. Then later I&apos;d pull the specific session out of the atom and would insert some facts and fire rules. For some reason this was causing really weird rule activation problems</span></div><div id="t1504801315000642" t="2017-09-07 16:21:55 dadair So for now I&apos;ve inlined the mk-session and am taking the performance hit until I can figure out what was going on"><a href="#t1504801315000642" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-07</span> <span class="t" onclick="H(this)">16:21:55</span>                       dadair </span><span>So for now I&apos;ve inlined the mk-session and am taking the performance hit until I can figure out what was going on</span></div><div id="t1504793002000004" t="2017-09-07 14:03:22 mmer Could someone please explain the rhs please - I have put a print and an insert! following on from each other on the rhs and the print always happens even if the rule fails?"><a href="#t1504793002000004" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-07</span> <span class="t" onclick="H(this)">14:03:22</span>                    mmer </span><span>Could someone please explain the rhs please - I have put a print and an insert! following on from each other on the rhs and the print always happens even if the rule fails?</span></div><div id="t1504793546000663" t="2017-09-07 14:12:26 mikerod @mmer The most typical way to structure rules is in a way that they logically express their constraints, but do not necessarily have a guaranteed order the RHS may fire in.  insert!  inserts facts that are subject to the “truth maintenance system” (aka the TMS) of the rules engine. If a rule fires at some point due to a, potentially transient, match of some facts, but later some of those facts are retracted, the engine will automatically retract the facts that relied on that match being present."><a href="#t1504793546000663" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-07</span> <span class="t" onclick="H(this)">14:12:26</span>                 mikerod </span><span>@mmer The most typical way to structure rules is in a way that they logically express their constraints, but do not necessarily have a guaranteed order the RHS may fire in. </span><code>insert!</code><span> inserts facts that are subject to the “truth maintenance system” (aka the TMS) of the rules engine. If a rule fires at some point due to a, potentially transient, match of some facts, but later some of those facts are retracted, the engine will automatically retract the facts that relied on that match being present.</span></div><div id="t1504793564000621" t="2017-09-07 14:12:44 mikerod When you do a side-effect like a  print , there is no way to “retract” the side effect"><a href="#t1504793564000621" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-07</span> <span class="t" onclick="H(this)">14:12:44</span>                 mikerod </span><span>When you do a side-effect like a </span><code>print</code><span>, there is no way to “retract” the side effect</span></div><div id="t1504793679000031" t="2017-09-07 14:14:39 mikerod There are ways to structure rules that would prevent them from being able to ever fire their RHS “early”. This can be done with setting up the rule to not be able to fire due to some “blocking” or “guarding” criteria in the LHS that you know will not change it’s truthiness later. Also, you can sometimes do some tricks with  :salience .

However, in many cases, the best idea may be to just avoid the side-effects in the RHS and perhaps do them outside of the rules based on the facts that are found via queries after performing a  fire-rules  cycle."><a href="#t1504793679000031" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-07</span> <span class="t" onclick="H(this)">14:14:39</span>                 mikerod </span><span>There are ways to structure rules that would prevent them from being able to ever fire their RHS “early”. This can be done with setting up the rule to not be able to fire due to some “blocking” or “guarding” criteria in the LHS that you know will not change it’s truthiness later. Also, you can sometimes do some tricks with </span><code>:salience</code><span>.

However, in many cases, the best idea may be to just avoid the side-effects in the RHS and perhaps do them outside of the rules based on the facts that are found via queries after performing a </span><code>fire-rules</code><span> cycle.</span></div><div id="t1504793722000683" t="2017-09-07 14:15:22 mikerod There is some documentation on the TMS @  http://www.clara-rules.org/docs/truthmaint/"><a href="#t1504793722000683" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-07</span> <span class="t" onclick="H(this)">14:15:22</span>                 mikerod </span><span>There is some documentation on the TMS @ </span><a href="http://www.clara-rules.org/docs/truthmaint/" target="_blank">http://www.clara-rules.org/docs/truthmaint/</a></div><div id="t1504794354000467" t="2017-09-07 14:25:54 mmer That helps.  I thought I was going mad!"><a href="#t1504794354000467" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-07</span> <span class="t" onclick="H(this)">14:25:54</span>                    mmer </span><span>That helps.  I thought I was going mad!</span></div><div id="t1504795008000738" t="2017-09-07 14:36:48 mikerod @mmer yeah, it can be a tricky detail"><a href="#t1504795008000738" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-07</span> <span class="t" onclick="H(this)">14:36:48</span>                 mikerod </span><span>@mmer yeah, it can be a tricky detail</span></div><div id="t1504795103000294" t="2017-09-07 14:38:23 mmer The docs say you can nest the boolean operators [:not, :or] etc.  I have tried to do something like [:not [:or [] []]  without much success.  Is this just plain wrong on my part?"><a href="#t1504795103000294" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-07</span> <span class="t" onclick="H(this)">14:38:23</span>                    mmer </span><span>The docs say you can nest the boolean operators [:not, :or] etc.  I have tried to do something like [:not [:or [] []]  without much success.  Is this just plain wrong on my part?</span></div><div id="t1504796204000013" t="2017-09-07 14:56:44 mikerod @mmer things can get a little tricky with that"><a href="#t1504796204000013" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-07</span> <span class="t" onclick="H(this)">14:56:44</span>                 mikerod </span><span>@mmer things can get a little tricky with that</span></div><div id="t1504796233000098" t="2017-09-07 14:57:13 mikerod So it is good to note that  :or  is sort of “syntactic sugar” in rules"><a href="#t1504796233000098" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-07</span> <span class="t" onclick="H(this)">14:57:13</span>                 mikerod </span><span>So it is good to note that </span><code>:or</code><span> is sort of “syntactic sugar” in rules</span></div><div id="t1504796256000483" t="2017-09-07 14:57:36 mikerod It can almost be thought of as just splitting the rule into 2 (or more depending on logic in use) rules"><a href="#t1504796256000483" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-07</span> <span class="t" onclick="H(this)">14:57:36</span>                 mikerod </span><span>It can almost be thought of as just splitting the rule into 2 (or more depending on logic in use) rules</span></div><div id="t1504796371000081" t="2017-09-07 14:59:31 mikerod e.g.
 (r/defrule with-or
  [A (= ?id id)]
  [:or
   [B (= ?id id)]
   [C (= ?id id)]]
  =&gt;
  (r/insert! (-&gt;D)))
 
Is similar to just writing
 (r/defrule side-one
  [A (= ?id id)]
  [B (= ?id id)]
  =&gt;
  (r/insert! (-&gt;D)))

(r/defrule side-two
  [A (= ?id id)]
  [C (= ?id id)]
  =&gt;
  (r/insert! (-&gt;D)))

"><a href="#t1504796371000081" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-07</span> <span class="t" onclick="H(this)">14:59:31</span>                 mikerod </span><span>e.g.
</span><pre>(r/defrule with-or
  [A (= ?id id)]
  [:or
   [B (= ?id id)]
   [C (= ?id id)]]
  =&gt;
  (r/insert! (-&gt;D)))
</pre><span>
Is similar to just writing
</span><pre>(r/defrule side-one
  [A (= ?id id)]
  [B (= ?id id)]
  =&gt;
  (r/insert! (-&gt;D)))

(r/defrule side-two
  [A (= ?id id)]
  [C (= ?id id)]
  =&gt;
  (r/insert! (-&gt;D)))

</pre></div><div id="t1504796382000121" t="2017-09-07 14:59:42 mikerod The point in that case is that there isn’t something like “short-circuiting”"><a href="#t1504796382000121" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-07</span> <span class="t" onclick="H(this)">14:59:42</span>                 mikerod </span><span>The point in that case is that there isn’t something like “short-circuiting”</span></div><div id="t1504796402000376" t="2017-09-07 15:00:02 mikerod and the  :or  has certain variable visibility issues due to how that works out"><a href="#t1504796402000376" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-07</span> <span class="t" onclick="H(this)">15:00:02</span>                 mikerod </span><span>and the </span><code>:or</code><span> has certain variable visibility issues due to how that works out</span></div><div id="t1504796425000586" t="2017-09-07 15:00:25 mikerod When it comes to  :not  +  :or  and/or nested  :and , it may also be good to note that the engine will convert to DNF (disjunctive normal form)"><a href="#t1504796425000586" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-07</span> <span class="t" onclick="H(this)">15:00:25</span>                 mikerod </span><span>When it comes to </span><code>:not</code><span> + </span><code>:or</code><span> and/or nested </span><code>:and</code><span>, it may also be good to note that the engine will convert to DNF (disjunctive normal form)</span></div><div id="t1504796457000457" t="2017-09-07 15:00:57 mikerod There may be some variable visibility issues in that transition in certain complex cases"><a href="#t1504796457000457" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-07</span> <span class="t" onclick="H(this)">15:00:57</span>                 mikerod </span><span>There may be some variable visibility issues in that transition in certain complex cases</span></div><div id="t1504797193000035" t="2017-09-07 15:13:13 mikerod @mmer but if you have an example that demonstrates an issue you are seeing, it’d be probably clearer to just look at that one and explain what is going on"><a href="#t1504797193000035" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-07</span> <span class="t" onclick="H(this)">15:13:13</span>                 mikerod </span><span>@mmer but if you have an example that demonstrates an issue you are seeing, it’d be probably clearer to just look at that one and explain what is going on</span></div><div id="t1504797276000088" t="2017-09-07 15:14:36 mmer I have eventually just split the rules in two so I do not need the not"><a href="#t1504797276000088" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-07</span> <span class="t" onclick="H(this)">15:14:36</span>                    mmer </span><span>I have eventually just split the rules in two so I do not need the not</span></div><div id="t1504797719000820" t="2017-09-07 15:21:59 mikerod sometimes it is clearer to split things up from an comprehension perspective anyways"><a href="#t1504797719000820" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-07</span> <span class="t" onclick="H(this)">15:21:59</span>                 mikerod </span><span>sometimes it is clearer to split things up from an comprehension perspective anyways</span></div><div id="t1504797887000294" t="2017-09-07 15:24:47 mikerod Probably the most details on this subject can be found in the lengthy old issue comments @  https://github.com/cerner/clara-rules/issues/149"><a href="#t1504797887000294" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-07</span> <span class="t" onclick="H(this)">15:24:47</span>                 mikerod </span><span>Probably the most details on this subject can be found in the lengthy old issue comments @ </span><a href="https://github.com/cerner/clara-rules/issues/149" target="_blank">https://github.com/cerner/clara-rules/issues/149</a></div><div id="t1504797896000043" t="2017-09-07 15:24:56 mikerod as far as some of the transformations that happen"><a href="#t1504797896000043" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-07</span> <span class="t" onclick="H(this)">15:24:56</span>                 mikerod </span><span>as far as some of the transformations that happen</span></div><div id="t1504797933000845" t="2017-09-07 15:25:33 mikerod Only if you were interesting in details though.  😛  Probably not super easy to read through."><a href="#t1504797933000845" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-07</span> <span class="t" onclick="H(this)">15:25:33</span>                 mikerod </span><span>Only if you were interesting in details though. </span><b>😛</b><span> Probably not super easy to read through.</span></div><div id="t1504799081000152" t="2017-09-07 15:44:41 mmer Thanks"><a href="#t1504799081000152" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-07</span> <span class="t" onclick="H(this)">15:44:41</span>                    mmer </span><span>Thanks</span></div><div id="t1504800282000056" t="2017-09-07 16:04:42 mmer To be more precise - when I load up the rules/queries into the session I get :"><a href="#t1504800282000056" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-07</span> <span class="t" onclick="H(this)">16:04:42</span>                    mmer </span><span>To be more precise - when I load up the rules/queries into the session I get :</span></div><div id="t1504800286000477" t="2017-09-07 16:04:46 mmer ExceptionInfo Value does not match schema: {:constraints [(not (&quot;s-expression&quot; ?composition)) (not (&quot;s-expression&quot; a-clojure.lang.Symbol))]}  schema.core/validator/fn--1296 (core.clj:155)"><a href="#t1504800286000477" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-07</span> <span class="t" onclick="H(this)">16:04:46</span>                    mmer </span><span>ExceptionInfo Value does not match schema: {:constraints [(not (&quot;s-expression&quot; ?composition)) (not (&quot;s-expression&quot; a-clojure.lang.Symbol))]}  schema.core/validator/fn--1296 (core.clj:155)</span></div><div id="t1504801335000406" t="2017-09-07 16:22:15 wparker @mmer that looks like a syntax error in a rule/query"><a href="#t1504801335000406" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-07</span> <span class="t" onclick="H(this)">16:22:15</span>                      wparker </span><span>@mmer that looks like a syntax error in a rule/query</span></div><div id="t1504800305000341" t="2017-09-07 16:05:05 mmer What sort of thing am I looking for in my rule etc?"><a href="#t1504800305000341" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-07</span> <span class="t" onclick="H(this)">16:05:05</span>                    mmer </span><span>What sort of thing am I looking for in my rule etc?</span></div><div id="t1504803500000123" t="2017-09-07 16:58:20 mikerod It’s hard to decipher without the actual rule DSL that was written (probably could be improved in Clara to try to capture that better)
There is probably some missing  [ ]  if not just having syntax out of order"><a href="#t1504803500000123" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-07</span> <span class="t" onclick="H(this)">16:58:20</span>                 mikerod </span><span>It’s hard to decipher without the actual rule DSL that was written (probably could be improved in Clara to try to capture that better)
There is probably some missing </span><code>[ ]</code><span> if not just having syntax out of order</span></div><div id="t1505225461000401" t="2017-09-12 14:11:01 dadair I have a singleton fact that I insert for referencing that contains a large map (hundreds of KB), and is a part of the LHS of most of my rules, so that the RHS can use the map when inserting more rules. Are there any performance issues to consider here? Or ways to exploit the fact that it is a singleton and will never need to be compared between multiple instances? I know with persistent structures it isn&apos;t inefficient to have the large map in multiple places, but was wondering last night if perhaps there was a better way to reference it. The LHS query for it is dead simple:  [Tree (= ?root root)]  in all cases"><a href="#t1505225461000401" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-12</span> <span class="t" onclick="H(this)">14:11:01</span>                  dadair </span><span>I have a singleton fact that I insert for referencing that contains a large map (hundreds of KB), and is a part of the LHS of most of my rules, so that the RHS can use the map when inserting more rules. Are there any performance issues to consider here? Or ways to exploit the fact that it is a singleton and will never need to be compared between multiple instances? I know with persistent structures it isn&apos;t inefficient to have the large map in multiple places, but was wondering last night if perhaps there was a better way to reference it. The LHS query for it is dead simple: </span><code>[Tree (= ?root root)]</code><span> in all cases</span></div><div id="t1505234994000108" t="2017-09-12 16:49:54 mikerod @dadair I don’t know of anything particularly harmful in the big fact like that"><a href="#t1505234994000108" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-12</span> <span class="t" onclick="H(this)">16:49:54</span>                 mikerod </span><span>@dadair I don’t know of anything particularly harmful in the big fact like that</span></div><div id="t1505235010000314" t="2017-09-12 16:50:10 mikerod It’s probably best to make sure it has a “type” that is distinct from anything else"><a href="#t1505235010000314" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-12</span> <span class="t" onclick="H(this)">16:50:10</span>                 mikerod </span><span>It’s probably best to make sure it has a “type” that is distinct from anything else</span></div><div id="t1505235054000319" t="2017-09-12 16:50:54 mikerod beyond that, assuming it is immutable (as facts should be), a cached hashcode may become important"><a href="#t1505235054000319" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-12</span> <span class="t" onclick="H(this)">16:50:54</span>                 mikerod </span><span>beyond that, assuming it is immutable (as facts should be), a cached hashcode may become important</span></div><div id="t1505235080000351" t="2017-09-12 16:51:20 mikerod Clojure persistent maps cache hashcode"><a href="#t1505235080000351" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-12</span> <span class="t" onclick="H(this)">16:51:20</span>                 mikerod </span><span>Clojure persistent maps cache hashcode</span></div><div id="t1505235127000392" t="2017-09-12 16:52:07 mikerod You could also consider wrapping the big map in a custom type that optimizes equality checking and hashing too if you had noticeable perf issues come up"><a href="#t1505235127000392" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-12</span> <span class="t" onclick="H(this)">16:52:07</span>                 mikerod </span><span>You could also consider wrapping the big map in a custom type that optimizes equality checking and hashing too if you had noticeable perf issues come up</span></div><div id="t1505235269000485" t="2017-09-12 16:54:29 mikerod You’re example does look like you have a type on it called  Tree  though, so I am not sure what implications that type has"><a href="#t1505235269000485" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-12</span> <span class="t" onclick="H(this)">16:54:29</span>                 mikerod </span><span>You’re example does look like you have a type on it called </span><code>Tree</code><span> though, so I am not sure what implications that type has</span></div><div id="t1505235410000476" t="2017-09-12 16:56:50 dadair Tree  is just a record wrapper around a map so it works with the default Fact type identification"><a href="#t1505235410000476" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-12</span> <span class="t" onclick="H(this)">16:56:50</span>                  dadair </span><code>Tree</code><span> is just a record wrapper around a map so it works with the default Fact type identification</span></div><div id="t1505235499000168" t="2017-09-12 16:58:19 mikerod For clarity: There are basically 2 situations that come to mind in this scenario:
1) How often is this big fact going to be compared to other different facts?
2) This big fact will be part of a token that is stored in memory. This token is sometimes used as a hash map sort of key. If this is hashed too often, the hash code may become  a bottleneck.

For (1)
If the fact has a unique type that no other facts have, it should only ever be compared to maybe itself. The equals check should be fast tehre since most equals impl’s will short-circuit on the  identical?  (or Java  ==  case)

For (2)
Clojure maps default to caching hash codes. Clojure records do not, prior to what looks like 1.9 (not yet fully released at least (see  https://dev.clojure.org/jira/browse/CLJ-1224 ))"><a href="#t1505235499000168" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-12</span> <span class="t" onclick="H(this)">16:58:19</span>                 mikerod </span><span>For clarity: There are basically 2 situations that come to mind in this scenario:
1) How often is this big fact going to be compared to other different facts?
2) This big fact will be part of a token that is stored in memory. This token is sometimes used as a hash map sort of key. If this is hashed too often, the hash code may become  a bottleneck.

For (1)
If the fact has a unique type that no other facts have, it should only ever be compared to maybe itself. The equals check should be fast tehre since most equals impl’s will short-circuit on the </span><code>identical?</code><span> (or Java </span><code>==</code><span> case)

For (2)
Clojure maps default to caching hash codes. Clojure records do not, prior to what looks like 1.9 (not yet fully released at least (see </span><a href="https://dev.clojure.org/jira/browse/CLJ-1224" target="_blank">https://dev.clojure.org/jira/browse/CLJ-1224</a><span>))</span></div><div id="t1505235547000773" t="2017-09-12 16:59:07 mikerod So if anything, if your  Tree  wrapper is made via  defrecord , you may be able to see some time spent recalculating the hash code when if this fact ends up being involved in a lot of rules LHS “tokens”"><a href="#t1505235547000773" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-12</span> <span class="t" onclick="H(this)">16:59:07</span>                 mikerod </span><span>So if anything, if your </span><code>Tree</code><span> wrapper is made via </span><code>defrecord</code><span>, you may be able to see some time spent recalculating the hash code when if this fact ends up being involved in a lot of rules LHS “tokens”</span></div><div id="t1505235570000241" t="2017-09-12 16:59:30 mikerod Tokens contain a sequence of all the facts that matched for a particular successful invocation of the rule"><a href="#t1505235570000241" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-12</span> <span class="t" onclick="H(this)">16:59:30</span>                 mikerod </span><span>Tokens contain a sequence of all the facts that matched for a particular successful invocation of the rule</span></div><div id="t1505235615000182" t="2017-09-12 17:00:15 mikerod Then again, I may not get worked up about this situation unless you can see measurable issues with perf"><a href="#t1505235615000182" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-12</span> <span class="t" onclick="H(this)">17:00:15</span>                 mikerod </span><span>Then again, I may not get worked up about this situation unless you can see measurable issues with perf</span></div><div id="t1505235778000301" t="2017-09-12 17:02:58 dadair Thanks for the advice, I&apos;m just trying to keep some performance considerations in my back pocket in case I need to improve performance. This  Tree  is somewhat like a database, so it will continue to grow over time. I&apos;m already seeing processing times approach &gt;= 100ms for the rule engine and I generally want things to be below ~50ms for some soft real-time constraints we have"><a href="#t1505235778000301" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-12</span> <span class="t" onclick="H(this)">17:02:58</span>                  dadair </span><span>Thanks for the advice, I&apos;m just trying to keep some performance considerations in my back pocket in case I need to improve performance. This </span><code>Tree</code><span> is somewhat like a database, so it will continue to grow over time. I&apos;m already seeing processing times approach &gt;= 100ms for the rule engine and I generally want things to be below ~50ms for some soft real-time constraints we have</span></div><div id="t1505235840000045" t="2017-09-12 17:04:00 mikerod hmm"><a href="#t1505235840000045" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-12</span> <span class="t" onclick="H(this)">17:04:00</span>                 mikerod </span><span>hmm</span></div><div id="t1505235868000212" t="2017-09-12 17:04:28 mikerod I typically use VisualVM"><a href="#t1505235868000212" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-12</span> <span class="t" onclick="H(this)">17:04:28</span>                 mikerod </span><span>I typically use VisualVM</span></div><div id="t1505235873000001" t="2017-09-12 17:04:33 mikerod start the “sampling CPU” profiler"><a href="#t1505235873000001" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-12</span> <span class="t" onclick="H(this)">17:04:33</span>                 mikerod </span><span>start the “sampling CPU” profiler</span></div><div id="t1505235877000240" t="2017-09-12 17:04:37 dadair to clarify: the tree does not change within a rule session, only between rule sessions"><a href="#t1505235877000240" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-12</span> <span class="t" onclick="H(this)">17:04:37</span>                  dadair </span><span>to clarify: the tree does not change within a rule session, only between rule sessions</span></div><div id="t1505235880000397" t="2017-09-12 17:04:40 mikerod then run whatever takes the tiem I’m interested in"><a href="#t1505235880000397" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-12</span> <span class="t" onclick="H(this)">17:04:40</span>                 mikerod </span><span>then run whatever takes the tiem I’m interested in</span></div><div id="t1505235900000064" t="2017-09-12 17:05:00 mikerod then you take a “snapshot”, view the snapshot by drilling down through a fairly large callstack"><a href="#t1505235900000064" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-12</span> <span class="t" onclick="H(this)">17:05:00</span>                 mikerod </span><span>then you take a “snapshot”, view the snapshot by drilling down through a fairly large callstack</span></div><div id="t1505235909000174" t="2017-09-12 17:05:09 mikerod it has visuals to show how much time is being spent where in the callstacks"><a href="#t1505235909000174" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-12</span> <span class="t" onclick="H(this)">17:05:09</span>                 mikerod </span><span>it has visuals to show how much time is being spent where in the callstacks</span></div><div id="t1505235960000584" t="2017-09-12 17:06:00 mikerod For this particular concern I had above, I’d just try to get to the “bottom” of the larger time callstacks and see if I can find references to, in this example, the  Tree  object getting  equiv  or  hash  sort of calls on it"><a href="#t1505235960000584" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-12</span> <span class="t" onclick="H(this)">17:06:00</span>                 mikerod </span><span>For this particular concern I had above, I’d just try to get to the “bottom” of the larger time callstacks and see if I can find references to, in this example, the </span><code>Tree</code><span> object getting </span><code>equiv</code><span> or </span><code>hash</code><span> sort of calls on it</span></div><div id="t1505236070000417" t="2017-09-12 17:07:50 dadair great I&apos;ll give that a try, thanks"><a href="#t1505236070000417" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-12</span> <span class="t" onclick="H(this)">17:07:50</span>                  dadair </span><span>great I&apos;ll give that a try, thanks</span></div><div id="t1505236220000475" t="2017-09-12 17:10:20 mikerod no problem. I’m always willing to take a look at a profiler snapshot, a portion of it, or just say “I see lots of time in Clara function X, any ideas?” too if you find those parts to be hard to sort through. I’m not sure how easy it may be to read profiler snapshots sometimes if not familiar with the codebase and/or the way clj compiles out java class names"><a href="#t1505236220000475" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-12</span> <span class="t" onclick="H(this)">17:10:20</span>                 mikerod </span><span>no problem. I’m always willing to take a look at a profiler snapshot, a portion of it, or just say “I see lots of time in Clara function X, any ideas?” too if you find those parts to be hard to sort through. I’m not sure how easy it may be to read profiler snapshots sometimes if not familiar with the codebase and/or the way clj compiles out java class names</span></div><div id="t1505261166000189" t="2017-09-13 00:06:06 olivergeorge I&apos;m experimenting to see if I can rewrite my webapp form logic using Clara rules."><a href="#t1505261166000189" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-13</span> <span class="t" onclick="H(this)">00:06:06</span>            olivergeorge </span><span>I&apos;m experimenting to see if I can rewrite my webapp form logic using Clara rules.</span></div><div id="t1505261317000191" t="2017-09-13 00:08:37 olivergeorge The existing code does multiple passes:
Field definitions and values used to generate cleaned field data and errors
Field data and errors used by logic which might (1) show/hide fields, (2) disable/enable fields, (3) change field values, (4) manage relationships between fields... (lots of stuff).
I borrowed the approach Django uses for form and field validation, they document it well here:  https://docs.djangoproject.com/en/1.11/ref/forms/validation/"><a href="#t1505261317000191" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-13</span> <span class="t" onclick="H(this)">00:08:37</span>            olivergeorge </span><span>The existing code does multiple passes:
Field definitions and values used to generate cleaned field data and errors
Field data and errors used by logic which might (1) show/hide fields, (2) disable/enable fields, (3) change field values, (4) manage relationships between fields... (lots of stuff).
I borrowed the approach Django uses for form and field validation, they document it well here: </span><a href="https://docs.djangoproject.com/en/1.11/ref/forms/validation/" target="_blank">https://docs.djangoproject.com/en/1.11/ref/forms/validation/</a></div><div id="t1505261338000152" t="2017-09-13 00:08:58 olivergeorge The current approach has functions which take the form (field definitions, values...) and return a modified version"><a href="#t1505261338000152" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-13</span> <span class="t" onclick="H(this)">00:08:58</span>            olivergeorge </span><span>The current approach has functions which take the form (field definitions, values...) and return a modified version</span></div><div id="t1505261352000087" t="2017-09-13 00:09:12 olivergeorge Iteratively manipulating the data"><a href="#t1505261352000087" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-13</span> <span class="t" onclick="H(this)">00:09:12</span>            olivergeorge </span><span>Iteratively manipulating the data</span></div><div id="t1505261364000050" t="2017-09-13 00:09:24 olivergeorge I don&apos;t think Clara would work in this way"><a href="#t1505261364000050" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-13</span> <span class="t" onclick="H(this)">00:09:24</span>            olivergeorge </span><span>I don&apos;t think Clara would work in this way</span></div><div id="t1505261469000238" t="2017-09-13 00:11:09 olivergeorge My guess is I need each phase to have it&apos;s own facts so that each phase of the form processing can use previous phase&apos;s facts as inputs."><a href="#t1505261469000238" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-13</span> <span class="t" onclick="H(this)">00:11:09</span>            olivergeorge </span><span>My guess is I need each phase to have it&apos;s own facts so that each phase of the form processing can use previous phase&apos;s facts as inputs.</span></div><div id="t1505261481000086" t="2017-09-13 00:11:21 olivergeorge Not sure if I&apos;m explaining that well"><a href="#t1505261481000086" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-13</span> <span class="t" onclick="H(this)">00:11:21</span>            olivergeorge </span><span>Not sure if I&apos;m explaining that well</span></div><div id="t1505261588000037" t="2017-09-13 00:13:08 olivergeorge Specific question: Am I correct that it&apos;s a bad idea to try and reproduce the &quot;modify data&quot; approach I&apos;m currently using."><a href="#t1505261588000037" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-13</span> <span class="t" onclick="H(this)">00:13:08</span>            olivergeorge </span><span>Specific question: Am I correct that it&apos;s a bad idea to try and reproduce the &quot;modify data&quot; approach I&apos;m currently using.</span></div><div id="t1505262342000015" t="2017-09-13 00:25:42 dadair @olivergeorge correct, mutating data in Clara is discouraged (though not impossible). I am doing something similar actually with form field- and form-level validation. I don&apos;t do multi-pass internally in the rule engine, but rather the rule engine is called multiple times from (essentially) a reduce, which collects the final modifications to perform at the end"><a href="#t1505262342000015" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-13</span> <span class="t" onclick="H(this)">00:25:42</span>                  dadair </span><span>@olivergeorge correct, mutating data in Clara is discouraged (though not impossible). I am doing something similar actually with form field- and form-level validation. I don&apos;t do multi-pass internally in the rule engine, but rather the rule engine is called multiple times from (essentially) a reduce, which collects the final modifications to perform at the end</span></div><div id="t1505262360000183" t="2017-09-13 00:26:00 dadair so the rule engine doesn&apos;t actually modify the forms, rather it returns what operations to perform in order to modify it"><a href="#t1505262360000183" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-13</span> <span class="t" onclick="H(this)">00:26:00</span>                  dadair </span><span>so the rule engine doesn&apos;t actually modify the forms, rather it returns what operations to perform in order to modify it</span></div><div id="t1505262382000030" t="2017-09-13 00:26:22 dadair then the reduce can take those, perform them, and send the modified form back to the rule engine, and it goes until it stabilizes"><a href="#t1505262382000030" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-13</span> <span class="t" onclick="H(this)">00:26:22</span>                  dadair </span><span>then the reduce can take those, perform them, and send the modified form back to the rule engine, and it goes until it stabilizes</span></div><div id="t1505263235000051" t="2017-09-13 00:40:35 olivergeorge Gotcha, thanks @dadair that makes sense"><a href="#t1505263235000051" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-13</span> <span class="t" onclick="H(this)">00:40:35</span>            olivergeorge </span><span>Gotcha, thanks @dadair that makes sense</span></div><div id="t1505266668000085" t="2017-09-13 01:37:48 olivergeorge @dadair how do you check for stability?  data comparison or does clara provide a &quot;no new facts&quot; test"><a href="#t1505266668000085" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-13</span> <span class="t" onclick="H(this)">01:37:48</span>            olivergeorge </span><span>@dadair how do you check for stability?  data comparison or does clara provide a &quot;no new facts&quot; test</span></div><div id="t1505266792000130" t="2017-09-13 01:39:52 dadair stability from the rules side of things would be it returning from  fire-rules , otherwise it wouldn keep going. &quot;stability&quot; in terms of your domain is different. For example, in that external reduce you would  query  the session for  operations , if the query returns nothing, you could know that &quot;the form is stable&quot;"><a href="#t1505266792000130" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-13</span> <span class="t" onclick="H(this)">01:39:52</span>                  dadair </span><span>stability from the rules side of things would be it returning from </span><code>fire-rules</code><span>, otherwise it wouldn keep going. &quot;stability&quot; in terms of your domain is different. For example, in that external reduce you would </span><code>query</code><span> the session for </span><code>operations</code><span>, if the query returns nothing, you could know that &quot;the form is stable&quot;</span></div><div id="t1505266809000057" t="2017-09-13 01:40:09 dadair it all depends on how you set up your system"><a href="#t1505266809000057" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-13</span> <span class="t" onclick="H(this)">01:40:09</span>                  dadair </span><span>it all depends on how you set up your system</span></div><div id="t1505266848000077" t="2017-09-13 01:40:48 olivergeorge Thanks again"><a href="#t1505266848000077" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-13</span> <span class="t" onclick="H(this)">01:40:48</span>            olivergeorge </span><span>Thanks again</span></div><div id="t1505266893000044" t="2017-09-13 01:41:33 dadair I am in no way an expert on rule systems though, I&apos;m just getting into it myself, that&apos;s just the approach I&apos;ve taken so far"><a href="#t1505266893000044" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-13</span> <span class="t" onclick="H(this)">01:41:33</span>                  dadair </span><span>I am in no way an expert on rule systems though, I&apos;m just getting into it myself, that&apos;s just the approach I&apos;ve taken so far</span></div><div id="t1505266958000050" t="2017-09-13 01:42:38 olivergeorge Right, interesting stuff.  I imagine there&apos;s typical examples we can learn from in other similar rule systems."><a href="#t1505266958000050" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-13</span> <span class="t" onclick="H(this)">01:42:38</span>            olivergeorge </span><span>Right, interesting stuff.  I imagine there&apos;s typical examples we can learn from in other similar rule systems.</span></div><div id="t1505272889000079" t="2017-09-13 03:21:29 dadair Anyone have any advice re: calming Cursive  x cannot be resolved  warnings when using Clara?"><a href="#t1505272889000079" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-13</span> <span class="t" onclick="H(this)">03:21:29</span>                  dadair </span><span>Anyone have any advice re: calming Cursive </span><code>x cannot be resolved</code><span> warnings when using Clara?</span></div><div id="t1505272951000089" t="2017-09-13 03:22:31 dadair eg ^"><a href="#t1505272951000089" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-13</span> <span class="t" onclick="H(this)">03:22:31</span>                  dadair </span><span>eg ^</span></div><div id="t1505272964000020" t="2017-09-13 03:22:44 dadair for all the LHS bindings"><a href="#t1505272964000020" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-13</span> <span class="t" onclick="H(this)">03:22:44</span>                  dadair </span><span>for all the LHS bindings</span></div><div id="t1505272988000118" t="2017-09-13 03:23:08 cfleming @dadair Unfortunately there isn’t a good solution for that yet. If the warnings bother you you can turn them off at Settings-&amp;gt;Languages &amp;amp; Frameworks-&amp;gt;Clojure-&amp;gt;Highlight unresolved symbols."><a href="#t1505272988000118" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-13</span> <span class="t" onclick="H(this)">03:23:08</span>                cfleming </span><span>@dadair Unfortunately there isn’t a good solution for that yet. If the warnings bother you you can turn them off at Settings-&amp;gt;Languages &amp;amp; Frameworks-&amp;gt;Clojure-&amp;gt;Highlight unresolved symbols.</span></div><div id="t1505273012000040" t="2017-09-13 03:23:32 cfleming The drawback to that is that you also won’t get symbols that really are undefined highlighted."><a href="#t1505273012000040" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-13</span> <span class="t" onclick="H(this)">03:23:32</span>                cfleming </span><span>The drawback to that is that you also won’t get symbols that really are undefined highlighted.</span></div><div id="t1505273040000081" t="2017-09-13 03:24:00 cfleming Sadly until Cursive understands Clara better (which I am hoping to get to soon-ish) that’s the best option."><a href="#t1505273040000081" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-13</span> <span class="t" onclick="H(this)">03:24:00</span>                cfleming </span><span>Sadly until Cursive understands Clara better (which I am hoping to get to soon-ish) that’s the best option.</span></div><div id="t1505273122000116" t="2017-09-13 03:25:22 dadair Is there a pluggable way for lib maintainers/etc to help with those endeavours?"><a href="#t1505273122000116" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-13</span> <span class="t" onclick="H(this)">03:25:22</span>                  dadair </span><span>Is there a pluggable way for lib maintainers/etc to help with those endeavours?</span></div><div id="t1505273178000141" t="2017-09-13 03:26:18 cfleming Not yet, but it’s planned."><a href="#t1505273178000141" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-13</span> <span class="t" onclick="H(this)">03:26:18</span>                cfleming </span><span>Not yet, but it’s planned.</span></div><div id="t1505273200000155" t="2017-09-13 03:26:40 cfleming If you were really keen, one thing that would help a lot would be to develop specs for the Clara macro forms."><a href="#t1505273200000155" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-13</span> <span class="t" onclick="H(this)">03:26:40</span>                cfleming </span><span>If you were really keen, one thing that would help a lot would be to develop specs for the Clara macro forms.</span></div><div id="t1505273235000038" t="2017-09-13 03:27:15 cfleming I’m hoping to be able to semi-automatically migrate those to Cursive, and I’m sure it would be a valuable contribution to Clara too."><a href="#t1505273235000038" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-13</span> <span class="t" onclick="H(this)">03:27:15</span>                cfleming </span><span>I’m hoping to be able to semi-automatically migrate those to Cursive, and I’m sure it would be a valuable contribution to Clara too.</span></div><div id="t1505273313000069" t="2017-09-13 03:28:33 cfleming We’ve discussed doing that in this channel previously, but AFAIK no-one has taken up the torch."><a href="#t1505273313000069" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-13</span> <span class="t" onclick="H(this)">03:28:33</span>                cfleming </span><span>We’ve discussed doing that in this channel previously, but AFAIK no-one has taken up the torch.</span></div><div id="t1505273320000094" t="2017-09-13 03:28:40 cfleming (me included)"><a href="#t1505273320000094" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-13</span> <span class="t" onclick="H(this)">03:28:40</span>                cfleming </span><span>(me included)</span></div><div id="t1505273545000037" t="2017-09-13 03:32:25 olivergeorge @cfleming what format would you prefer specs in?  (no promises but curious)"><a href="#t1505273545000037" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-13</span> <span class="t" onclick="H(this)">03:32:25</span>            olivergeorge </span><span>@cfleming what format would you prefer specs in?  (no promises but curious)</span></div><div id="t1505273580000077" t="2017-09-13 03:33:00 cfleming @olivergeorge Just the specs themselves, i.e. the specs defining the grammar of the macro forms."><a href="#t1505273580000077" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-13</span> <span class="t" onclick="H(this)">03:33:00</span>                cfleming </span><span>@olivergeorge Just the specs themselves, i.e. the specs defining the grammar of the macro forms.</span></div><div id="t1505273580000083" t="2017-09-13 03:33:00 dadair Maybe we can get specs done through group effort?"><a href="#t1505273580000083" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-13</span> <span class="t" onclick="H(this)">03:33:00</span>                  dadair </span><span>Maybe we can get specs done through group effort?</span></div><div id="t1505273598000017" t="2017-09-13 03:33:18 cfleming @dadair That would be awesome, and I’d like to help."><a href="#t1505273598000017" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-13</span> <span class="t" onclick="H(this)">03:33:18</span>                cfleming </span><span>@dadair That would be awesome, and I’d like to help.</span></div><div id="t1505273623000029" t="2017-09-13 03:33:43 dadair Clara is integral to my work so don&apos;t mind putting some time in if it gets better integrated into cursive"><a href="#t1505273623000029" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-13</span> <span class="t" onclick="H(this)">03:33:43</span>                  dadair </span><span>Clara is integral to my work so don&apos;t mind putting some time in if it gets better integrated into cursive</span></div><div id="t1505273661000187" t="2017-09-13 03:34:21 cfleming I don’t actually use Clara myself, but I’m keen to use it as an example of migrating a real-world spec to Cursive."><a href="#t1505273661000187" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-13</span> <span class="t" onclick="H(this)">03:34:21</span>                cfleming </span><span>I don’t actually use Clara myself, but I’m keen to use it as an example of migrating a real-world spec to Cursive.</span></div><div id="t1505273715000136" t="2017-09-13 03:35:15 cfleming @olivergeorge This sort of thing is what I have in mind:  https://github.com/clojure/core.specs.alpha/blob/master/src/main/clojure/clojure/core/specs/alpha.clj"><a href="#t1505273715000136" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-13</span> <span class="t" onclick="H(this)">03:35:15</span>                cfleming </span><span>@olivergeorge This sort of thing is what I have in mind: </span><a href="https://github.com/clojure/core.specs.alpha/blob/master/src/main/clojure/clojure/core/specs/alpha.clj" target="_blank">https://github.com/clojure/core.specs.alpha/blob/master/src/main/clojure/clojure/core/specs/alpha.clj</a></div><div id="t1505273731000022" t="2017-09-13 03:35:31 cfleming i.e. specs in a form that would be useful for Clara itself too."><a href="#t1505273731000022" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-13</span> <span class="t" onclick="H(this)">03:35:31</span>                cfleming </span><span>i.e. specs in a form that would be useful for Clara itself too.</span></div><div id="t1505273747000084" t="2017-09-13 03:35:47 olivergeorge Good stuff.  Wondered if that&apos;s what you meant."><a href="#t1505273747000084" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-13</span> <span class="t" onclick="H(this)">03:35:47</span>            olivergeorge </span><span>Good stuff.  Wondered if that&apos;s what you meant.</span></div><div id="t1505273784000005" t="2017-09-13 03:36:24 olivergeorge Shouldn&apos;t be too bad given they&apos;ve taken the time to document the syntax with railway tracks in the doco (is that the right term)"><a href="#t1505273784000005" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-13</span> <span class="t" onclick="H(this)">03:36:24</span>            olivergeorge </span><span>Shouldn&apos;t be too bad given they&apos;ve taken the time to document the syntax with railway tracks in the doco (is that the right term)</span></div><div id="t1505273797000061" t="2017-09-13 03:36:37 cfleming Railroad diagrams, yeah"><a href="#t1505273797000061" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-13</span> <span class="t" onclick="H(this)">03:36:37</span>                cfleming </span><span>Railroad diagrams, yeah</span></div><div id="t1505273808000005" t="2017-09-13 03:36:48 cfleming They’re not complete, but they should be a good start."><a href="#t1505273808000005" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-13</span> <span class="t" onclick="H(this)">03:36:48</span>                cfleming </span><span>They’re not complete, but they should be a good start.</span></div><div id="t1505273864000161" t="2017-09-13 03:37:44 cfleming I suspect there are lots of gnarly corners though, or at least that’s what I’m given to understand. But I think there’s a lot of code using Clara out there so hopefully if we can convince users to test it then we should get the edge cases out fairly quickly."><a href="#t1505273864000161" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-13</span> <span class="t" onclick="H(this)">03:37:44</span>                cfleming </span><span>I suspect there are lots of gnarly corners though, or at least that’s what I’m given to understand. But I think there’s a lot of code using Clara out there so hopefully if we can convince users to test it then we should get the edge cases out fairly quickly.</span></div><div id="t1505273884000154" t="2017-09-13 03:38:04 olivergeorge Sounds good"><a href="#t1505273884000154" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-13</span> <span class="t" onclick="H(this)">03:38:04</span>            olivergeorge </span><span>Sounds good</span></div><div id="t1505273955000023" t="2017-09-13 03:39:15 cfleming Having specs would also help non-Cursive users check the grammars too."><a href="#t1505273955000023" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-13</span> <span class="t" onclick="H(this)">03:39:15</span>                cfleming </span><span>Having specs would also help non-Cursive users check the grammars too.</span></div><div id="t1505274078000083" t="2017-09-13 03:41:18 cfleming Previous discussion:  https://clojurians-log.clojureverse.org/clara/2017-06-29.html"><a href="#t1505274078000083" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-13</span> <span class="t" onclick="H(this)">03:41:18</span>                cfleming </span><span>Previous discussion: </span><a href="https://clojurians-log.clojureverse.org/clara/2017-06-29.html" target="_blank">https://clojurians-log.clojureverse.org/clara/2017-06-29.html</a></div><div id="t1505274116000079" t="2017-09-13 03:41:56 cfleming One question would be whether the Clara specs would be best developed in Clara itself or in a separate project."><a href="#t1505274116000079" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-13</span> <span class="t" onclick="H(this)">03:41:56</span>                cfleming </span><span>One question would be whether the Clara specs would be best developed in Clara itself or in a separate project.</span></div><div id="t1505274157000033" t="2017-09-13 03:42:37 olivergeorge Yeah, I wondered that.  I guess it&apos;s less intrusive to start with a separate repo.  Taking lead from clojure..."><a href="#t1505274157000033" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-13</span> <span class="t" onclick="H(this)">03:42:37</span>            olivergeorge </span><span>Yeah, I wondered that.  I guess it&apos;s less intrusive to start with a separate repo.  Taking lead from clojure...</span></div><div id="t1505274164000019" t="2017-09-13 03:42:44 olivergeorge I have a meeting soon so signing off"><a href="#t1505274164000019" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-13</span> <span class="t" onclick="H(this)">03:42:44</span>            olivergeorge </span><span>I have a meeting soon so signing off</span></div><div id="t1505274179000089" t="2017-09-13 03:42:59 olivergeorge If anyone can tell me what I&apos;m doing wrong with acc/all here I&apos;d love to know:  https://gist.github.com/olivergeorge/e37ff239783e1de8f97804bf472047a4"><a href="#t1505274179000089" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-13</span> <span class="t" onclick="H(this)">03:42:59</span>            olivergeorge </span><span>If anyone can tell me what I&apos;m doing wrong with acc/all here I&apos;d love to know: </span><a href="https://gist.github.com/olivergeorge/e37ff239783e1de8f97804bf472047a4" target="_blank">https://gist.github.com/olivergeorge/e37ff239783e1de8f97804bf472047a4</a></div><div id="t1505286056000138" t="2017-09-13 07:00:56 olivergeorge Worked it out.  bidi required an earlier version of prismatic so I missed this fix  
 https://github.com/cerner/clara-rules/issues/306"><a href="#t1505286056000138" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-13</span> <span class="t" onclick="H(this)">07:00:56</span>                 olivergeorge </span><span>Worked it out.  bidi required an earlier version of prismatic so I missed this fix  
</span><a href="https://github.com/cerner/clara-rules/issues/306" target="_blank">https://github.com/cerner/clara-rules/issues/306</a></div><div id="t1505274186000086" t="2017-09-13 03:43:06 cfleming Ok, cool - I’d definitely like to pursue this."><a href="#t1505274186000086" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-13</span> <span class="t" onclick="H(this)">03:43:06</span>                cfleming </span><span>Ok, cool - I’d definitely like to pursue this.</span></div><div id="t1505274210000042" t="2017-09-13 03:43:30 olivergeorge I&apos;ll put up my hand to help on the spec front but not familar with clara so someone else would need to lead."><a href="#t1505274210000042" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-13</span> <span class="t" onclick="H(this)">03:43:30</span>            olivergeorge </span><span>I&apos;ll put up my hand to help on the spec front but not familar with clara so someone else would need to lead.</span></div><div id="t1505274297000006" t="2017-09-13 03:44:57 cfleming Ok. I can create a project to hold the WIP specs and have a go at it, hopefully later this week."><a href="#t1505274297000006" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-13</span> <span class="t" onclick="H(this)">03:44:57</span>                cfleming </span><span>Ok. I can create a project to hold the WIP specs and have a go at it, hopefully later this week.</span></div><div id="t1505276448000005" t="2017-09-13 04:20:48 dadair I&apos;ll help where I can if you post the repo"><a href="#t1505276448000005" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-13</span> <span class="t" onclick="H(this)">04:20:48</span>                  dadair </span><span>I&apos;ll help where I can if you post the repo</span></div><div id="t1505276640000090" t="2017-09-13 04:24:00 cfleming @dadair Great, thanks."><a href="#t1505276640000090" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-13</span> <span class="t" onclick="H(this)">04:24:00</span>                cfleming </span><span>@dadair Great, thanks.</span></div><div id="t1505323107000475" t="2017-09-13 17:18:27 dadair What&apos;s the best way for debugging rules? Cursive breakpoints aren&apos;t reachable it seems (not surprising since the rules aren&apos;t &quot;called&quot;, but rather exist within a session registry and are also macros). Currently I just add print statements and try to reason things out"><a href="#t1505323107000475" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-13</span> <span class="t" onclick="H(this)">17:18:27</span>                  dadair </span><span>What&apos;s the best way for debugging rules? Cursive breakpoints aren&apos;t reachable it seems (not surprising since the rules aren&apos;t &quot;called&quot;, but rather exist within a session registry and are also macros). Currently I just add print statements and try to reason things out</span></div><div id="t1505323832000352" t="2017-09-13 17:30:32 mikerod @dadair some of this may be helpful  http://www.clara-rules.org/docs/inspection/"><a href="#t1505323832000352" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-13</span> <span class="t" onclick="H(this)">17:30:32</span>                 mikerod </span><span>@dadair some of this may be helpful </span><a href="http://www.clara-rules.org/docs/inspection/" target="_blank">http://www.clara-rules.org/docs/inspection/</a></div><div id="t1505323910000031" t="2017-09-13 17:31:50 mikerod Sometimes I end up just mutating some testing atoms state from various points in rules though when I’m confused. The inspection may be a bit of a nicer approach."><a href="#t1505323910000031" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-13</span> <span class="t" onclick="H(this)">17:31:50</span>                 mikerod </span><span>Sometimes I end up just mutating some testing atoms state from various points in rules though when I’m confused. The inspection may be a bit of a nicer approach.</span></div><div id="t1505323950000334" t="2017-09-13 17:32:30 mikerod There is  clara.tools.inspect  and  clara.tools.trace  that could both potentially be useful. The tests for these features in  src/test  may be helpful to see some usages."><a href="#t1505323950000334" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-13</span> <span class="t" onclick="H(this)">17:32:30</span>                 mikerod </span><span>There is </span><code>clara.tools.inspect</code><span> and </span><code>clara.tools.trace</code><span> that could both potentially be useful. The tests for these features in </span><code>src/test</code><span> may be helpful to see some usages.</span></div><div id="t1505324243000124" t="2017-09-13 17:37:23 dadair great I&apos;ll take a look at that thanks"><a href="#t1505324243000124" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-13</span> <span class="t" onclick="H(this)">17:37:23</span>                  dadair </span><span>great I&apos;ll take a look at that thanks</span></div><div id="t1505325653000786" t="2017-09-13 18:00:53 mikerod @dadair Tests of the tracing like  https://github.com/cerner/clara-rules/blob/0.15.2/src/test/common/clara/tools/test_tracing.cljc#L67  may be useful"><a href="#t1505325653000786" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-13</span> <span class="t" onclick="H(this)">18:00:53</span>                 mikerod </span><span>@dadair Tests of the tracing like </span><a href="https://github.com/cerner/clara-rules/blob/0.15.2/src/test/common/clara/tools/test_tracing.cljc#L67" target="_blank">https://github.com/cerner/clara-rules/blob/0.15.2/src/test/common/clara/tools/test_tracing.cljc#L67</a><span> may be useful</span></div><div id="t1505325659000277" t="2017-09-13 18:00:59 mikerod inspection is more human-readable I think"><a href="#t1505325659000277" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-13</span> <span class="t" onclick="H(this)">18:00:59</span>                 mikerod </span><span>inspection is more human-readable I think</span></div><div id="t1505325676000454" t="2017-09-13 18:01:16 mikerod but the tracing sometimes has good data to work with, but can be a lot so have to pikc it apart some"><a href="#t1505325676000454" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-13</span> <span class="t" onclick="H(this)">18:01:16</span>                 mikerod </span><span>but the tracing sometimes has good data to work with, but can be a lot so have to pikc it apart some</span></div><div id="t1505331736000405" t="2017-09-13 19:42:16 wparker Clara-rules 0.16.0 is released and on Clojars.  Relative to 0.15.2 (the previous released version) this is a bugfix release for  https://github.com/cerner/clara-rules/issues/303"><a href="#t1505331736000405" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-13</span> <span class="t" onclick="H(this)">19:42:16</span>                 wparker </span><span>Clara-rules 0.16.0 is released and on Clojars.  Relative to 0.15.2 (the previous released version) this is a bugfix release for </span><a href="https://github.com/cerner/clara-rules/issues/303" target="_blank">https://github.com/cerner/clara-rules/issues/303</a></div><div id="t1505332802000309" t="2017-09-13 20:00:02 dadair Is there a benefit/drawback to doing:
 [A (false? x)]
 
instead of
 [A (= ?x x)]
[:test (false? ?x)]
"><a href="#t1505332802000309" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-13</span> <span class="t" onclick="H(this)">20:00:02</span>                  dadair </span><span>Is there a benefit/drawback to doing:
</span><pre>[A (false? x)]
</pre><span>
instead of
</span><pre>[A (= ?x x)]
[:test (false? ?x)]
</pre></div><div id="t1505333009000421" t="2017-09-13 20:03:29 wparker For constraints that can be determined to be true or false without any reference to other facts Clara will evaluate them upfront without trying to join them with anything and if they are false Clara won’t retain a reference to them"><a href="#t1505333009000421" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-13</span> <span class="t" onclick="H(this)">20:03:29</span>                      wparker </span><span>For constraints that can be determined to be true or false without any reference to other facts Clara will evaluate them upfront without trying to join them with anything and if they are false Clara won’t retain a reference to them</span></div><div id="t1505333039000231" t="2017-09-13 20:03:59 wparker So for example, in the latter case, I’d expect Clara to retain a hard reference to every A inserted"><a href="#t1505333039000231" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-13</span> <span class="t" onclick="H(this)">20:03:59</span>                      wparker </span><span>So for example, in the latter case, I’d expect Clara to retain a hard reference to every A inserted</span></div><div id="t1505333062000443" t="2017-09-13 20:04:22 wparker while in the former case, it wouldn’t retain a reference to an A without a value of false in field x"><a href="#t1505333062000443" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-13</span> <span class="t" onclick="H(this)">20:04:22</span>                      wparker </span><span>while in the former case, it wouldn’t retain a reference to an A without a value of false in field x</span></div><div id="t1505333157000455" t="2017-09-13 20:05:57 wparker In cases where you do joins it can also be more efficient to have Clara do as much filtering as it can on each fact in isolation - apart from evaluating your join criteria, there is some (highly optimized) overhead to keeping track of joins"><a href="#t1505333157000455" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-13</span> <span class="t" onclick="H(this)">20:05:57</span>                      wparker </span><span>In cases where you do joins it can also be more efficient to have Clara do as much filtering as it can on each fact in isolation - apart from evaluating your join criteria, there is some (highly optimized) overhead to keeping track of joins</span></div><div id="t1505333307000437" t="2017-09-13 20:08:27 dadair ok great thanks"><a href="#t1505333307000437" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-13</span> <span class="t" onclick="H(this)">20:08:27</span>                       dadair </span><span>ok great thanks</span></div><div id="t1505332821000026" t="2017-09-13 20:00:21 dadair other than if you want to use ?x later in the RHS"><a href="#t1505332821000026" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-13</span> <span class="t" onclick="H(this)">20:00:21</span>                  dadair </span><span>other than if you want to use ?x later in the RHS</span></div><div id="t1505337582000474" t="2017-09-13 21:19:42 mikerod @dadair I’d tend to just suggest to not use  :test  unless you have a use-case that it can’t be avoided"><a href="#t1505337582000474" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-13</span> <span class="t" onclick="H(this)">21:19:42</span>                 mikerod </span><span>@dadair I’d tend to just suggest to not use </span><code>:test</code><span> unless you have a use-case that it can’t be avoided</span></div><div id="t1505337595000369" t="2017-09-13 21:19:55 mikerod it just is more opaque to the engine and could mean you’re skipping out on optimizations"><a href="#t1505337595000369" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-13</span> <span class="t" onclick="H(this)">21:19:55</span>                 mikerod </span><span>it just is more opaque to the engine and could mean you’re skipping out on optimizations</span></div><div id="t1505337768000167" t="2017-09-13 21:22:48 dadair makes sense, thanks!"><a href="#t1505337768000167" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-13</span> <span class="t" onclick="H(this)">21:22:48</span>                  dadair </span><span>makes sense, thanks!</span></div><div id="t1505338402000057" t="2017-09-13 21:33:22 mikerod As far as the actual effects of the example you give here, I don’t know there is a big difference. There is definitely a “little” more overhead to adding the  :test  node, but I’m not sure you lose any particular optimizations in this particular case. I’d have to mess with it more to be sure though. However, still, I’d just go with my general rule here.  🙂"><a href="#t1505338402000057" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-13</span> <span class="t" onclick="H(this)">21:33:22</span>                 mikerod </span><span>As far as the actual effects of the example you give here, I don’t know there is a big difference. There is definitely a “little” more overhead to adding the </span><code>:test</code><span> node, but I’m not sure you lose any particular optimizations in this particular case. I’d have to mess with it more to be sure though. However, still, I’d just go with my general rule here. </span><b>🙂</b></div><div id="t1505338556000276" t="2017-09-13 21:35:56 dadair absolutely, thanks for the help!"><a href="#t1505338556000276" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-13</span> <span class="t" onclick="H(this)">21:35:56</span>                  dadair </span><span>absolutely, thanks for the help!</span></div><div id="t1505342904000057" t="2017-09-13 22:48:24 olivergeorge I&apos;m trying to encode some form logic which disables dependent fields (e.g. can&apos;t pick building if site isn&apos;t set, can&apos;t pick floor if building isn&apos;t set...)"><a href="#t1505342904000057" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-13</span> <span class="t" onclick="H(this)">22:48:24</span>            olivergeorge </span><span>I&apos;m trying to encode some form logic which disables dependent fields (e.g. can&apos;t pick building if site isn&apos;t set, can&apos;t pick floor if building isn&apos;t set...)</span></div><div id="t1505342938000273" t="2017-09-13 22:48:58 olivergeorge My rules don&apos;t terminate"><a href="#t1505342938000273" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-13</span> <span class="t" onclick="H(this)">22:48:58</span>            olivergeorge </span><span>My rules don&apos;t terminate</span></div><div id="t1505342958000211" t="2017-09-13 22:49:18 olivergeorge (ns spike-rules.core
  (:require [clara.rules :as rules :refer [insert! defrule defquery defsession]]
            [clara.rules.accumulators :as acc]))

(defrecord Field [field-key field-state])
(defrecord FieldState [field-key field-state])
(defrecord Operation [field-key field-state])

(defrule rule1
  &quot;Insert FieldState based on Field and Operations&quot;
  [?field &lt;- Field (= field-key ?field-key)]
  [?ops &lt;- (acc/all :field-state) :from [Operation (= field-key ?field-key)]]
  =&gt;
  (println :update-fieldstate ?field-key)
  (insert! (-&gt;FieldState ?field-key (reduce merge (:field-state ?field) ?ops))))

(defrule rule2
  &quot;Insert field disable operation if a field depends on a field which is not set&quot;
  [FieldState (= ?nil-field-key field-key) (= (nil? (:value field-state)))]
  [FieldState (= ?disable-field-key field-key) (contains? (:depends-on field-state) ?nil-field-key)]
  =&gt;
  (println :disable-dependent ?disable-field-key)
  (insert! (-&gt;Operation ?disable-field-key {:disabled true})))

(defsession form-session [rule1 rule2])

(-&gt; form-session
    (rules/insert
      (-&gt;Field :site {:value nil})
      (-&gt;Field :bl {:value nil :depends-on #{:site}})
      (-&gt;Field :fl {:value nil :depends-on #{:bl}}))
    (rules/fire-rules))"><a href="#t1505342958000211" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-13</span> <span class="t" onclick="H(this)">22:49:18</span>            olivergeorge </span><pre>(ns spike-rules.core
  (:require [clara.rules :as rules :refer [insert! defrule defquery defsession]]
            [clara.rules.accumulators :as acc]))

(defrecord Field [field-key field-state])
(defrecord FieldState [field-key field-state])
(defrecord Operation [field-key field-state])

(defrule rule1
  &quot;Insert FieldState based on Field and Operations&quot;
  [?field &lt;- Field (= field-key ?field-key)]
  [?ops &lt;- (acc/all :field-state) :from [Operation (= field-key ?field-key)]]
  =&gt;
  (println :update-fieldstate ?field-key)
  (insert! (-&gt;FieldState ?field-key (reduce merge (:field-state ?field) ?ops))))

(defrule rule2
  &quot;Insert field disable operation if a field depends on a field which is not set&quot;
  [FieldState (= ?nil-field-key field-key) (= (nil? (:value field-state)))]
  [FieldState (= ?disable-field-key field-key) (contains? (:depends-on field-state) ?nil-field-key)]
  =&gt;
  (println :disable-dependent ?disable-field-key)
  (insert! (-&gt;Operation ?disable-field-key {:disabled true})))

(defsession form-session [rule1 rule2])

(-&gt; form-session
    (rules/insert
      (-&gt;Field :site {:value nil})
      (-&gt;Field :bl {:value nil :depends-on #{:site}})
      (-&gt;Field :fl {:value nil :depends-on #{:bl}}))
    (rules/fire-rules))</pre></div><div id="t1505343014000307" t="2017-09-13 22:50:14 olivergeorge Perhaps rule1 is bad practice.  I&apos;m using it to combine the original field state with any operations which modify it.  (in this case adding a :disable flag)"><a href="#t1505343014000307" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-13</span> <span class="t" onclick="H(this)">22:50:14</span>            olivergeorge </span><span>Perhaps rule1 is bad practice.  I&apos;m using it to combine the original field state with any operations which modify it.  (in this case adding a :disable flag)</span></div><div id="t1505343096000372" t="2017-09-13 22:51:36 olivergeorge @dadair I was trying to avoid having to do the &quot;merge field with ops&quot; manually and refiring rules.  That&apos;s the approach you were describing, correct?"><a href="#t1505343096000372" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-13</span> <span class="t" onclick="H(this)">22:51:36</span>            olivergeorge </span><span>@dadair I was trying to avoid having to do the &quot;merge field with ops&quot; manually and refiring rules.  That&apos;s the approach you were describing, correct?</span></div><div id="t1505343488000054" t="2017-09-13 22:58:08 dadair We actually do it slightly differently. In our case, the rule engine inserts the current state of the form, and the operation the user is trying to perform. Then there are rules that check if that operation is valid given the current state of the form. If it&apos;s valid, it returns a transformation of the input action that can actually be performed/persisted by an external state management service.  If it&apos;s invalid, it transforms the input action to an action that will invalidate the field (or reject the action out-right), which is then again carried out by the external state management service"><a href="#t1505343488000054" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-13</span> <span class="t" onclick="H(this)">22:58:08</span>                  dadair </span><span>We actually do it slightly differently. In our case, the rule engine inserts the current state of the form, and the operation the user is trying to perform. Then there are rules that check if that operation is valid given the current state of the form. If it&apos;s valid, it returns a transformation of the input action that can actually be performed/persisted by an external state management service.  If it&apos;s invalid, it transforms the input action to an action that will invalidate the field (or reject the action out-right), which is then again carried out by the external state management service</span></div><div id="t1505343546000162" t="2017-09-13 22:59:06 defndaines Might add in a
 (println &quot;?ops &quot; ?ops)
  as part of  rule1 ."><a href="#t1505343546000162" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-13</span> <span class="t" onclick="H(this)">22:59:06</span>              defndaines </span><span>Might add in a
</span><pre>(println &quot;?ops &quot; ?ops)
</pre><span> as part of </span><code>rule1</code><span>.</span></div><div id="t1505344272000164" t="2017-09-13 23:11:12 olivergeorge @defndaines that shows that rule1 is firing repeatedly for the empty ops case.
 Loading src/spike_rules/round1.clj... 
:update-fieldstate :site []
:update-fieldstate :fl []
:update-fieldstate :bl []
:disable-dependent :fl
:disable-dependent :bl
:update-fieldstate :fl []
:update-fieldstate :bl []
:disable-dependent :bl
:disable-dependent :fl
:update-fieldstate :bl []
:update-fieldstate :fl [] 

Hmm, that makes me think it&apos;s not doing what I expect.   It should have an operation for disabling that field."><a href="#t1505344272000164" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-13</span> <span class="t" onclick="H(this)">23:11:12</span>            olivergeorge </span><span>@defndaines that shows that rule1 is firing repeatedly for the empty ops case.
</span><pre>Loading src/spike_rules/round1.clj... 
:update-fieldstate :site []
:update-fieldstate :fl []
:update-fieldstate :bl []
:disable-dependent :fl
:disable-dependent :bl
:update-fieldstate :fl []
:update-fieldstate :bl []
:disable-dependent :bl
:disable-dependent :fl
:update-fieldstate :bl []
:update-fieldstate :fl []</pre><span>

Hmm, that makes me think it&apos;s not doing what I expect.   It should have an operation for disabling that field.</span></div><div id="t1505344339000218" t="2017-09-13 23:12:19 olivergeorge @dadair thanks, as you say it&apos;s slightly different to what I&apos;m focused on but sounds interesting... I&apos;ll get to that I expect."><a href="#t1505344339000218" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-13</span> <span class="t" onclick="H(this)">23:12:19</span>            olivergeorge </span><span>@dadair thanks, as you say it&apos;s slightly different to what I&apos;m focused on but sounds interesting... I&apos;ll get to that I expect.</span></div><div id="t1505344769000244" t="2017-09-13 23:19:29 olivergeorge Looks like I&apos;m not best friends with acc/all yet"><a href="#t1505344769000244" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-13</span> <span class="t" onclick="H(this)">23:19:29</span>            olivergeorge </span><span>Looks like I&apos;m not best friends with acc/all yet</span></div><div id="t1505345075000119" t="2017-09-13 23:24:35 defndaines Maybe check with  some?"><a href="#t1505345075000119" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-13</span> <span class="t" onclick="H(this)">23:24:35</span>              defndaines </span><span>Maybe check with </span><code>some?</code></div><div id="t1505345205000198" t="2017-09-13 23:26:45 olivergeorge @defndaines I don&apos;t think that would work.  I want field -&gt; fieldstate even if ops is empty.  That way rule2 has a full list of field-state facts to consider."><a href="#t1505345205000198" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-13</span> <span class="t" onclick="H(this)">23:26:45</span>            olivergeorge </span><span>@defndaines I don&apos;t think that would work.  I want field -&gt; fieldstate even if ops is empty.  That way rule2 has a full list of field-state facts to consider.</span></div><div id="t1505345232000206" t="2017-09-13 23:27:12 olivergeorge Problem is that acc/all doesn&apos;t seem to ever return the inserted Operations facts"><a href="#t1505345232000206" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-13</span> <span class="t" onclick="H(this)">23:27:12</span>            olivergeorge </span><span>Problem is that acc/all doesn&apos;t seem to ever return the inserted Operations facts</span></div><div id="t1505345397000113" t="2017-09-13 23:29:57 olivergeorge There&apos;s a feedback loop which seems a possible problem:
* rule 1 inserts FieldState (before any Operations are inserted)
* rule 2 fires because it sees a FieldState which should be disabled
* rule 1 sees a new Operation and does truth maintenance to update the field&apos;s FieldState"><a href="#t1505345397000113" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-13</span> <span class="t" onclick="H(this)">23:29:57</span>            olivergeorge </span><span>There&apos;s a feedback loop which seems a possible problem:
* rule 1 inserts FieldState (before any Operations are inserted)
* rule 2 fires because it sees a FieldState which should be disabled
* rule 1 sees a new Operation and does truth maintenance to update the field&apos;s FieldState</span></div><div id="t1505345426000060" t="2017-09-13 23:30:26 olivergeorge Odd thing is that I don&apos;t ever see the Operation in Rule 1 via acc/all  (the third step described)"><a href="#t1505345426000060" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-13</span> <span class="t" onclick="H(this)">23:30:26</span>            olivergeorge </span><span>Odd thing is that I don&apos;t ever see the Operation in Rule 1 via acc/all  (the third step described)</span></div><div id="t1505345455000097" t="2017-09-13 23:30:55 olivergeorge I&apos;m new to this, likely user error or bad assumptions on how things should work"><a href="#t1505345455000097" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-13</span> <span class="t" onclick="H(this)">23:30:55</span>            olivergeorge </span><span>I&apos;m new to this, likely user error or bad assumptions on how things should work</span></div><div id="t1505346180000058" t="2017-09-13 23:43:00 mikerod @olivergeorge  acc/all  returns an empty collection when no matches."><a href="#t1505346180000058" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-13</span> <span class="t" onclick="H(this)">23:43:00</span>                 mikerod </span><span>@olivergeorge </span><code>acc/all</code><span> returns an empty collection when no matches.</span></div><div id="t1505346196000188" t="2017-09-13 23:43:16 mikerod I’m not sure that you’ve already realized that, so pointing it out"><a href="#t1505346196000188" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-13</span> <span class="t" onclick="H(this)">23:43:16</span>                 mikerod </span><span>I’m not sure that you’ve already realized that, so pointing it out</span></div><div id="t1505346254000337" t="2017-09-13 23:44:14 mikerod (r/defrule foo
 [?xs &lt;- (acc/all) :from [X]]
 [:test (seq ?xs)]
 =&gt;
 (prn :foo))
 
Something like that would ensure that the rule wasn’t activated with no matches"><a href="#t1505346254000337" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-13</span> <span class="t" onclick="H(this)">23:44:14</span>                 mikerod </span><pre>(r/defrule foo
 [?xs &lt;- (acc/all) :from [X]]
 [:test (seq ?xs)]
 =&gt;
 (prn :foo))
</pre><span>
Something like that would ensure that the rule wasn’t activated with no matches</span></div><div id="t1505346306000006" t="2017-09-13 23:45:06 mikerod Looks like the  acc/all  docs could be a bit clearer on that"><a href="#t1505346306000006" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-13</span> <span class="t" onclick="H(this)">23:45:06</span>                 mikerod </span><span>Looks like the </span><code>acc/all</code><span> docs could be a bit clearer on that</span></div><div id="t1505346350000132" t="2017-09-13 23:45:50 mikerod Believe it or not, it actually can be useful for it to match with the empty collection in other use-cases."><a href="#t1505346350000132" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-13</span> <span class="t" onclick="H(this)">23:45:50</span>                 mikerod </span><span>Believe it or not, it actually can be useful for it to match with the empty collection in other use-cases.</span></div><div id="t1505346550000139" t="2017-09-13 23:49:10 olivergeorge @mikerod Thanks Mike.  The curious thing is that an inserted Operation is never returned from (all).  I&apos;ll take a step back to understand truth maintenance better."><a href="#t1505346550000139" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-13</span> <span class="t" onclick="H(this)">23:49:10</span>            olivergeorge </span><span>@mikerod Thanks Mike.  The curious thing is that an inserted Operation is never returned from (all).  I&apos;ll take a step back to understand truth maintenance better.</span></div><div id="t1505346768000248" t="2017-09-13 23:52:48 olivergeorge Simpler example 
 (ns spike-rules.round1
  (:require [clara.rules :as rules :refer [insert! defrule defquery defsession]]
            [clara.rules.accumulators :as acc]))

(defrecord Field [field-key field-state])
(defrecord FieldState [field-key field-state])
(defrecord Operation [field-key field-state])

(defrule rule1
  &quot;Insert FieldState based on Field and Operations&quot;
  [?field &lt;- Field (= field-key ?field-key)]
  [?ops &lt;- (acc/all) :from [Operation (= field-key ?field-key)]]
  =&gt;
  (println :rule1.ops ?ops)
  (println :rule1.insert! `(-&gt;FieldState ~?field-key ~(reduce merge (:field-state ?field) ?ops)))
  (insert! (-&gt;FieldState ?field-key (reduce merge (:field-state ?field) ?ops))))

(defrule rule2
  &quot;disable if read-only&quot;
  [FieldState (= ?field-key field-key) (:read-only field-state)]
  =&gt;
  (println :rule2.insert! `(-&gt;Operation ~?field-key {:disabled true}))
  (insert! (-&gt;Operation ?field-key {:disabled true})))

(defsession form-session [rule1 rule2])

(-&gt; form-session
    (rules/insert
      (-&gt;Field :site {:value nil :read-only true}))
    (rules/fire-rules)) 

Returns

 Loading src/spike_rules/round1.clj... 
:rule1.ops []
:rule1.insert! (spike-rules.round1/-&gt;FieldState :site {:value nil, :read-only true})
:rule2.insert! (spike-rules.round1/-&gt;Operation :site {:disabled true})
:rule1.ops []
:rule1.insert! (spike-rules.round1/-&gt;FieldState :site {:value nil, :read-only true})
:rule2.insert! (spike-rules.round1/-&gt;Operation :site {:disabled true})
..."><a href="#t1505346768000248" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-13</span> <span class="t" onclick="H(this)">23:52:48</span>            olivergeorge </span><span>Simpler example 
</span><pre>(ns spike-rules.round1
  (:require [clara.rules :as rules :refer [insert! defrule defquery defsession]]
            [clara.rules.accumulators :as acc]))

(defrecord Field [field-key field-state])
(defrecord FieldState [field-key field-state])
(defrecord Operation [field-key field-state])

(defrule rule1
  &quot;Insert FieldState based on Field and Operations&quot;
  [?field &lt;- Field (= field-key ?field-key)]
  [?ops &lt;- (acc/all) :from [Operation (= field-key ?field-key)]]
  =&gt;
  (println :rule1.ops ?ops)
  (println :rule1.insert! `(-&gt;FieldState ~?field-key ~(reduce merge (:field-state ?field) ?ops)))
  (insert! (-&gt;FieldState ?field-key (reduce merge (:field-state ?field) ?ops))))

(defrule rule2
  &quot;disable if read-only&quot;
  [FieldState (= ?field-key field-key) (:read-only field-state)]
  =&gt;
  (println :rule2.insert! `(-&gt;Operation ~?field-key {:disabled true}))
  (insert! (-&gt;Operation ?field-key {:disabled true})))

(defsession form-session [rule1 rule2])

(-&gt; form-session
    (rules/insert
      (-&gt;Field :site {:value nil :read-only true}))
    (rules/fire-rules))</pre><span>

Returns

</span><pre>Loading src/spike_rules/round1.clj... 
:rule1.ops []
:rule1.insert! (spike-rules.round1/-&gt;FieldState :site {:value nil, :read-only true})
:rule2.insert! (spike-rules.round1/-&gt;Operation :site {:disabled true})
:rule1.ops []
:rule1.insert! (spike-rules.round1/-&gt;FieldState :site {:value nil, :read-only true})
:rule2.insert! (spike-rules.round1/-&gt;Operation :site {:disabled true})
...</pre></div><div id="t1505346769000099" t="2017-09-13 23:52:49 dadair You could write a query to return all operations, if that query returns anything, then your memory does have operations inserted and it&apos;s your LHS of rule 1 that is incorrect "><a href="#t1505346769000099" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-13</span> <span class="t" onclick="H(this)">23:52:49</span>                  dadair </span><span>You could write a query to return all operations, if that query returns anything, then your memory does have operations inserted and it&apos;s your LHS of rule 1 that is incorrect </span></div><div id="t1505346786000329" t="2017-09-13 23:53:06 olivergeorge Okay, thanks will do."><a href="#t1505346786000329" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-13</span> <span class="t" onclick="H(this)">23:53:06</span>            olivergeorge </span><span>Okay, thanks will do.</span></div><div id="t1505346902000218" t="2017-09-13 23:55:02 olivergeorge Actually, not sure how to do a query when it won&apos;t terminate."><a href="#t1505346902000218" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-13</span> <span class="t" onclick="H(this)">23:55:02</span>            olivergeorge </span><span>Actually, not sure how to do a query when it won&apos;t terminate.</span></div><div id="t1505346905000319" t="2017-09-13 23:55:05 olivergeorge I appreciate all the help"><a href="#t1505346905000319" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-13</span> <span class="t" onclick="H(this)">23:55:05</span>            olivergeorge </span><span>I appreciate all the help</span></div><div id="t1505346912000037" t="2017-09-13 23:55:12 olivergeorge I&apos;ll take some time to learn more and try again."><a href="#t1505346912000037" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-13</span> <span class="t" onclick="H(this)">23:55:12</span>            olivergeorge </span><span>I&apos;ll take some time to learn more and try again.</span></div><div id="t1505347340000046" t="2017-09-14 00:02:20 dadair oh right it isn&apos;t terminating"><a href="#t1505347340000046" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-14</span> <span class="t" onclick="H(this)">00:02:20</span>                  dadair </span><span>oh right it isn&apos;t terminating</span></div><div id="t1505347354000258" t="2017-09-14 00:02:34 dadair in that case I&apos;d write a rule that should match on ANY Operation, and have a println on the RHS"><a href="#t1505347354000258" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-14</span> <span class="t" onclick="H(this)">00:02:34</span>                  dadair </span><span>in that case I&apos;d write a rule that should match on ANY Operation, and have a println on the RHS</span></div><div id="t1505347364000011" t="2017-09-14 00:02:44 dadair that way it should activate if an Operation is ever inserted"><a href="#t1505347364000011" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-14</span> <span class="t" onclick="H(this)">00:02:44</span>                  dadair </span><span>that way it should activate if an Operation is ever inserted</span></div><div id="t1505347439000034" t="2017-09-14 00:03:59 mikerod @olivergeorge This is rough, but hopefully correct (thought about it quickly)
So I think the loop goes like this (only including relevant fields):

1) insert  Field{:field-key :site :read-only true} 

2) activate  rule1 

3) fire  rule1 
- insert  FieldState{:field-key :site :read-only true} 

4) activate  rule2 

5) fire  rule2 
- insert  Operation{:field-key :site} 

6) retract previous  rule1  results since  (acc/all)  changed
7) retract previous  rule2  results since  rule1  retracted the matching fact changed ;; due to (6)
8) retract previous  rule1  results since  (acc/all)  changed ;; due to (7) - no actual retraction needed here, just updates the accumulator again (6) already retracted

9) (re-)activate  rule1  ;; due to (8)

10) insert  Field{:field-key :site :read-only true}  ;; no Op1 anymore

11) repeat (4) and (5)
12) repeat (6) (7) ( 8 ) (9)

13) keep repeating (11) (12)"><a href="#t1505347439000034" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-14</span> <span class="t" onclick="H(this)">00:03:59</span>                 mikerod </span><span>@olivergeorge This is rough, but hopefully correct (thought about it quickly)
So I think the loop goes like this (only including relevant fields):

1) insert </span><code>Field{:field-key :site :read-only true}</code><span>

2) activate </span><code>rule1</code><span>

3) fire </span><code>rule1</code><span>
- insert </span><code>FieldState{:field-key :site :read-only true}</code><span>

4) activate </span><code>rule2</code><span>

5) fire </span><code>rule2</code><span>
- insert </span><code>Operation{:field-key :site}</code><span>

6) retract previous </span><code>rule1</code><span> results since </span><code>(acc/all)</code><span> changed
7) retract previous </span><code>rule2</code><span> results since </span><code>rule1</code><span> retracted the matching fact changed ;; due to (6)
8) retract previous </span><code>rule1</code><span> results since </span><code>(acc/all)</code><span> changed ;; due to (7) - no actual retraction needed here, just updates the accumulator again (6) already retracted

9) (re-)activate </span><code>rule1</code><span> ;; due to (8)

10) insert </span><code>Field{:field-key :site :read-only true}</code><span> ;; no Op1 anymore

11) repeat (4) and (5)
12) repeat (6) (7) ( 8 ) (9)

13) keep repeating (11) (12)</span></div><div id="t1505347570000096" t="2017-09-14 00:06:10 olivergeorge Ah! right.  That makes sense.  Thank you."><a href="#t1505347570000096" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-14</span> <span class="t" onclick="H(this)">00:06:10</span>            olivergeorge </span><span>Ah! right.  That makes sense.  Thank you.</span></div><div id="t1505347588000177" t="2017-09-14 00:06:28 olivergeorge I missed the op retraction."><a href="#t1505347588000177" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-14</span> <span class="t" onclick="H(this)">00:06:28</span>            olivergeorge </span><span>I missed the op retraction.</span></div><div id="t1505347593000191" t="2017-09-14 00:06:33 mikerod so you have to do something to avoid the cycle that starts there"><a href="#t1505347593000191" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-14</span> <span class="t" onclick="H(this)">00:06:33</span>                 mikerod </span><span>so you have to do something to avoid the cycle that starts there</span></div><div id="t1505347605000163" t="2017-09-14 00:06:45 mikerod perhaps checking some field that would stop the “feedback loop”"><a href="#t1505347605000163" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-14</span> <span class="t" onclick="H(this)">00:06:45</span>                 mikerod </span><span>perhaps checking some field that would stop the “feedback loop”</span></div><div id="t1505347618000036" t="2017-09-14 00:06:58 mikerod but it’d be domain dependent I think to know the answer in that particular case"><a href="#t1505347618000036" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-14</span> <span class="t" onclick="H(this)">00:06:58</span>                 mikerod </span><span>but it’d be domain dependent I think to know the answer in that particular case</span></div><div id="t1505347697000191" t="2017-09-14 00:08:17 olivergeorge I wondered about having a fire-rules loop and doing (field+ops =&gt; field-state) aggregation between iterations."><a href="#t1505347697000191" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-14</span> <span class="t" onclick="H(this)">00:08:17</span>            olivergeorge </span><span>I wondered about having a fire-rules loop and doing (field+ops =&gt; field-state) aggregation between iterations.</span></div><div id="t1505347743000119" t="2017-09-14 00:09:03 olivergeorge I can see other possibilities."><a href="#t1505347743000119" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-14</span> <span class="t" onclick="H(this)">00:09:03</span>            olivergeorge </span><span>I can see other possibilities.</span></div><div id="t1505347748000025" t="2017-09-14 00:09:08 olivergeorge Thanks for putting me on track"><a href="#t1505347748000025" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-14</span> <span class="t" onclick="H(this)">00:09:08</span>            olivergeorge </span><span>Thanks for putting me on track</span></div><div id="t1505347816000263" t="2017-09-14 00:10:16 dadair @mikerod do you know of any solid references for designing forward inference rule systems? Or some common design patterns, etc?"><a href="#t1505347816000263" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-14</span> <span class="t" onclick="H(this)">00:10:16</span>                  dadair </span><span>@mikerod do you know of any solid references for designing forward inference rule systems? Or some common design patterns, etc?</span></div><div id="t1505349541000302" t="2017-09-14 00:39:01 mikerod @dadair good question. I’m don’t really think I know a lot off the top of my head. Which is unfortunate"><a href="#t1505349541000302" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-14</span> <span class="t" onclick="H(this)">00:39:01</span>                 mikerod </span><span>@dadair good question. I’m don’t really think I know a lot off the top of my head. Which is unfortunate</span></div><div id="t1505349545000148" t="2017-09-14 00:39:05 mikerod I’ll have to think about that one"><a href="#t1505349545000148" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-14</span> <span class="t" onclick="H(this)">00:39:05</span>                 mikerod </span><span>I’ll have to think about that one</span></div><div id="t1505353976000204" t="2017-09-14 01:52:56 olivergeorge Is there a simple way to extract all facts from a session?"><a href="#t1505353976000204" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-14</span> <span class="t" onclick="H(this)">01:52:56</span>            olivergeorge </span><span>Is there a simple way to extract all facts from a session?</span></div><div id="t1505354001000172" t="2017-09-14 01:53:21 olivergeorge My best guess is query with an expression whose fact type is an ancestor of all records which seems to work just fine for records using  [?ret &lt;- Object] ."><a href="#t1505354001000172" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-14</span> <span class="t" onclick="H(this)">01:53:21</span>            olivergeorge </span><span>My best guess is query with an expression whose fact type is an ancestor of all records which seems to work just fine for records using </span><code>[?ret &lt;- Object]</code><span>.</span></div><div id="t1505356704000065" t="2017-09-14 02:38:24 olivergeorge @dadairI was going to suggest that perhaps the Doorenbos paper might be worth checking for references but it&apos;s 150 pages long."><a href="#t1505356704000065" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-14</span> <span class="t" onclick="H(this)">02:38:24</span>            olivergeorge </span><span>@dadairI was going to suggest that perhaps the Doorenbos paper might be worth checking for references but it&apos;s 150 pages long.</span></div><div id="t1505362374000128" t="2017-09-14 04:12:54 olivergeorge One technique which might have resolved my problem is using  insert-unconditional!  for Operations as that would ensure they aren&apos;t retracted (no feedback loop)."><a href="#t1505362374000128" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-14</span> <span class="t" onclick="H(this)">04:12:54</span>            olivergeorge </span><span>One technique which might have resolved my problem is using </span><code>insert-unconditional!</code><span> for Operations as that would ensure they aren&apos;t retracted (no feedback loop).</span></div><div id="t1505362399000039" t="2017-09-14 04:13:19 olivergeorge Not sure if using insert-unconditional! is considered a code smell / something to be avoided rather than common usage."><a href="#t1505362399000039" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-14</span> <span class="t" onclick="H(this)">04:13:19</span>            olivergeorge </span><span>Not sure if using insert-unconditional! is considered a code smell / something to be avoided rather than common usage.</span></div><div id="t1505363251000072" t="2017-09-14 04:27:31 olivergeorge (ns spike-rules.round1
  (:require [clara.rules :as rules :refer [insert! insert-unconditional! defrule defquery defsession]]
            [clara.rules.accumulators :as acc]))

(defrecord Field [field-key field-state])
(defrecord FieldState [field-key field-state])
(defrecord Disabled [field-key])

(defn exists
  ([]
   (acc/accum
     {:initial-value     false
      :reduce-fn         (constantly true)})))

(defrule rule1
  &quot;Insert FieldState based on Field and Operations&quot;
  [?field &lt;- Field (= field-key ?field-key)]
  [?disabled &lt;- (exists) :from [Disabled (= field-key ?field-key)]]
  =&gt;
  (insert!
    (cond-&gt; (-&gt;FieldState ?field-key (:field-state ?field))
      ?disabled (assoc :disabled true))))

(defrule rule2
  &quot;disable if read-only&quot;
  [FieldState (= ?field-key field-key) (:read-only field-state)]
  [:not [Disabled (= ?field-key field-key)]]
  =&gt;
  (insert-unconditional! (-&gt;Disabled ?field-key)))

(defquery export-facts [] [?ret &lt;- Object])

(defsession form-session [rule1 rule2 export-facts])

(-&gt; form-session
    (rules/insert
      (-&gt;Field :site {:value nil :read-only true}))
    (rules/fire-rules)
    (rules/query export-facts))"><a href="#t1505363251000072" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-14</span> <span class="t" onclick="H(this)">04:27:31</span>                 olivergeorge </span><pre>(ns spike-rules.round1
  (:require [clara.rules :as rules :refer [insert! insert-unconditional! defrule defquery defsession]]
            [clara.rules.accumulators :as acc]))

(defrecord Field [field-key field-state])
(defrecord FieldState [field-key field-state])
(defrecord Disabled [field-key])

(defn exists
  ([]
   (acc/accum
     {:initial-value     false
      :reduce-fn         (constantly true)})))

(defrule rule1
  &quot;Insert FieldState based on Field and Operations&quot;
  [?field &lt;- Field (= field-key ?field-key)]
  [?disabled &lt;- (exists) :from [Disabled (= field-key ?field-key)]]
  =&gt;
  (insert!
    (cond-&gt; (-&gt;FieldState ?field-key (:field-state ?field))
      ?disabled (assoc :disabled true))))

(defrule rule2
  &quot;disable if read-only&quot;
  [FieldState (= ?field-key field-key) (:read-only field-state)]
  [:not [Disabled (= ?field-key field-key)]]
  =&gt;
  (insert-unconditional! (-&gt;Disabled ?field-key)))

(defquery export-facts [] [?ret &lt;- Object])

(defsession form-session [rule1 rule2 export-facts])

(-&gt; form-session
    (rules/insert
      (-&gt;Field :site {:value nil :read-only true}))
    (rules/fire-rules)
    (rules/query export-facts))</pre></div><div id="t1505405364000548" t="2017-09-14 16:09:24 mikerod &gt; I was going to suggest that perhaps the Doorenbos paper might be worth checking for references but it’s 150 pages long.

@olivergeorge I do think that this paper is a great explanation of Rete (skipping some of the out-dated about some of the “testbed” system parts). I’m not sure it has a lot on “how to structure and design rules in practice” though."><a href="#t1505405364000548" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-14</span> <span class="t" onclick="H(this)">16:09:24</span>                 mikerod </span><span>&gt; I was going to suggest that perhaps the Doorenbos paper might be worth checking for references but it’s 150 pages long.

@olivergeorge I do think that this paper is a great explanation of Rete (skipping some of the out-dated about some of the “testbed” system parts). I’m not sure it has a lot on “how to structure and design rules in practice” though.</span></div><div id="t1505405487000380" t="2017-09-14 16:11:27 mikerod When looking for that sort of guidance I think I’ve sort of just hunted around the internet searching for like “rules engines best practices”"><a href="#t1505405487000380" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-14</span> <span class="t" onclick="H(this)">16:11:27</span>                 mikerod </span><span>When looking for that sort of guidance I think I’ve sort of just hunted around the internet searching for like “rules engines best practices”</span></div><div id="t1505405530000482" t="2017-09-14 16:12:10 mikerod I think Drools (popular Java/JVM based rules engine) had a fairly large amount of material with some general guidance on things. It’s still a search though. I wish I knew more direct sources though."><a href="#t1505405530000482" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-14</span> <span class="t" onclick="H(this)">16:12:10</span>                 mikerod </span><span>I think Drools (popular Java/JVM based rules engine) had a fairly large amount of material with some general guidance on things. It’s still a search though. I wish I knew more direct sources though.</span></div><div id="t1505405548000315" t="2017-09-14 16:12:28 mikerod @olivergeorge I’d be careful using  insert-unconditional!"><a href="#t1505405548000315" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-14</span> <span class="t" onclick="H(this)">16:12:28</span>                 mikerod </span><span>@olivergeorge I’d be careful using </span><code>insert-unconditional!</code></div><div id="t1505405561000258" t="2017-09-14 16:12:41 mikerod You start to get into an order dependent situation with your rules"><a href="#t1505405561000258" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-14</span> <span class="t" onclick="H(this)">16:12:41</span>                 mikerod </span><span>You start to get into an order dependent situation with your rules</span></div><div id="t1505405596000022" t="2017-09-14 16:13:16 mikerod if an “upstream” fact from a different rule is logically inserted and later retracted, but a downstream  insert-unconditional!  has already happened, it won’t be retracted and you’ll get into an inconsistent state"><a href="#t1505405596000022" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-14</span> <span class="t" onclick="H(this)">16:13:16</span>                 mikerod </span><span>if an “upstream” fact from a different rule is logically inserted and later retracted, but a downstream </span><code>insert-unconditional!</code><span> has already happened, it won’t be retracted and you’ll get into an inconsistent state</span></div><div id="t1505405623000518" t="2017-09-14 16:13:43 mikerod So then you end up having to do things like add  :salience  to try to force the rule to fire later than another and this ends up just becoming increasingly brittle"><a href="#t1505405623000518" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-14</span> <span class="t" onclick="H(this)">16:13:43</span>                 mikerod </span><span>So then you end up having to do things like add </span><code>:salience</code><span> to try to force the rule to fire later than another and this ends up just becoming increasingly brittle</span></div><div id="t1505405670000433" t="2017-09-14 16:14:30 mikerod Also, loses the “declarative” sort of property that you get with rules all being under control of the truth maintenance system"><a href="#t1505405670000433" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-14</span> <span class="t" onclick="H(this)">16:14:30</span>                 mikerod </span><span>Also, loses the “declarative” sort of property that you get with rules all being under control of the truth maintenance system</span></div><div id="t1505408357000562" t="2017-09-14 16:59:17 mmer Organizing rules sets - My rule set has become reasonably large within a short time.  I keep getting issues with Exceptions against the schema.  These are really difficult to resolve.  I wonder if this is because I am running in a repl rather than outside?  However,  I thought I would divide my project into 4 namespaces - rules (for those I know work) worker (for any functions that help with processing my data into the working memory) queries .  This then leave me with an issue about what to do with the record definitions that need to be available in all of these and in the core where I am creating the session.  I either get cyclical dependencies if I put the record defs in any of these files - so I move them out into another records namespace and each of the above and the core require and refer this namespace.  However when I run the mk-&gt;session if fails to find the record defs.  Any ideas?"><a href="#t1505408357000562" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-14</span> <span class="t" onclick="H(this)">16:59:17</span>                    mmer </span><span>Organizing rules sets - My rule set has become reasonably large within a short time.  I keep getting issues with Exceptions against the schema.  These are really difficult to resolve.  I wonder if this is because I am running in a repl rather than outside?  However,  I thought I would divide my project into 4 namespaces - rules (for those I know work) worker (for any functions that help with processing my data into the working memory) queries .  This then leave me with an issue about what to do with the record definitions that need to be available in all of these and in the core where I am creating the session.  I either get cyclical dependencies if I put the record defs in any of these files - so I move them out into another records namespace and each of the above and the core require and refer this namespace.  However when I run the mk-&gt;session if fails to find the record defs.  Any ideas?</span></div><div id="t1505413955000473" t="2017-09-14 18:32:35 wparker “However when I run the mk-&gt;session if fails to find the record defs. ” It sounds like the namespace defining the records wasn’t compiled then.  In case you don’t know, Clojure won’t actually compile a namespace until something requires it.  It can be weird in that if you have a fully qualified reference, it will resolve even if the namespace in question doesn’t require the namespace, but only if something required the namespace already.  I personally think of Clojure’s compiler as a “procedural” one that takes in code and alters the state of the runtime environment accordingly."><a href="#t1505413955000473" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-14</span> <span class="t" onclick="H(this)">18:32:35</span>                      wparker </span><span>“However when I run the mk-&gt;session if fails to find the record defs. ” It sounds like the namespace defining the records wasn’t compiled then.  In case you don’t know, Clojure won’t actually compile a namespace until something requires it.  It can be weird in that if you have a fully qualified reference, it will resolve even if the namespace in question doesn’t require the namespace, but only if something required the namespace already.  I personally think of Clojure’s compiler as a “procedural” one that takes in code and alters the state of the runtime environment accordingly.</span></div><div id="t1505408503000163" t="2017-09-14 17:01:43 dadair I have a shared namespace for shared records, then I build sessions like so:  (r/mk-session &apos;rules.shared &apos;rules.x &apos;rules.y)"><a href="#t1505408503000163" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-14</span> <span class="t" onclick="H(this)">17:01:43</span>                  dadair </span><span>I have a shared namespace for shared records, then I build sessions like so: </span><code>(r/mk-session &apos;rules.shared &apos;rules.x &apos;rules.y)</code></div><div id="t1505408541000453" t="2017-09-14 17:02:21 dadair you need to make sure you are requiring the namespace too before making the session, I&apos;ve run into that before"><a href="#t1505408541000453" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-14</span> <span class="t" onclick="H(this)">17:02:21</span>                  dadair </span><span>you need to make sure you are requiring the namespace too before making the session, I&apos;ve run into that before</span></div><div id="t1505408581000178" t="2017-09-14 17:03:01 dadair so either put  rules.shared  into the  (ns .. (:require ..))  or do an explicit  (require &apos;rules.shared)"><a href="#t1505408581000178" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-14</span> <span class="t" onclick="H(this)">17:03:01</span>                  dadair </span><span>so either put </span><code>rules.shared</code><span> into the </span><code>(ns .. (:require ..))</code><span> or do an explicit </span><code>(require &apos;rules.shared)</code></div><div id="t1505422946000339" t="2017-09-14 21:02:26 mmer Thanks - what if you have helper functions that need the shared?  Do you lead them into the session as well?  i.e. if a rule uses a function (private-ref? ?value) its namespace have to be made available to the session?"><a href="#t1505422946000339" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-14</span> <span class="t" onclick="H(this)">21:02:26</span>                    mmer </span><span>Thanks - what if you have helper functions that need the shared?  Do you lead them into the session as well?  i.e. if a rule uses a function (private-ref? ?value) its namespace have to be made available to the session?</span></div><div id="t1505422966000039" t="2017-09-14 21:02:46 mmer Thanks for the reply, BTW?"><a href="#t1505422966000039" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-14</span> <span class="t" onclick="H(this)">21:02:46</span>                    mmer </span><span>Thanks for the reply, BTW?</span></div><div id="t1505426424000033" t="2017-09-14 22:00:24 dadair shared functions can live in the shared namespace"><a href="#t1505426424000033" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-14</span> <span class="t" onclick="H(this)">22:00:24</span>                  dadair </span><span>shared functions can live in the shared namespace</span></div><div id="t1505426445000243" t="2017-09-14 22:00:45 dadair then in  rules.x  you can require  rules.shared  so you can use the functions"><a href="#t1505426445000243" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-14</span> <span class="t" onclick="H(this)">22:00:45</span>                  dadair </span><span>then in </span><code>rules.x</code><span> you can require </span><code>rules.shared</code><span> so you can use the functions</span></div><div id="t1505426471000316" t="2017-09-14 22:01:11 dadair I only call  (mk-session &apos;rules.shared &apos;rules.x ..)  in a &quot;core&quot; namespace"><a href="#t1505426471000316" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-14</span> <span class="t" onclick="H(this)">22:01:11</span>                  dadair </span><span>I only call </span><code>(mk-session &apos;rules.shared &apos;rules.x ..)</code><span> in a &quot;core&quot; namespace</span></div><div id="t1505426527000318" t="2017-09-14 22:02:07 dadair so for example,  rules.x ,  rules.y , and  rules.z  can require and use records/functions from  rules.shared , and then in some other namespace  rules.engine , you can require all the namespaces and call the mk-session function:  (r/mk-session &apos;rules.shared &apos;rules.x ..)"><a href="#t1505426527000318" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-14</span> <span class="t" onclick="H(this)">22:02:07</span>                  dadair </span><span>so for example, </span><code>rules.x</code><span>, </span><code>rules.y</code><span>, and </span><code>rules.z</code><span> can require and use records/functions from </span><code>rules.shared</code><span>, and then in some other namespace </span><code>rules.engine</code><span>, you can require all the namespaces and call the mk-session function: </span><code>(r/mk-session &apos;rules.shared &apos;rules.x ..)</code></div><div id="t1505426538000482" t="2017-09-14 22:02:18 dadair that&apos;s how I&apos;ve avoided circular dependencies"><a href="#t1505426538000482" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-14</span> <span class="t" onclick="H(this)">22:02:18</span>                  dadair </span><span>that&apos;s how I&apos;ve avoided circular dependencies</span></div><div id="t1505427040000036" t="2017-09-14 22:10:40 mmer Thanks - re-organised the project as you said. I am still getting the issue where the first record typr encountered by the rules engine in the session is saying that the Record type can&apos;t be found.  This namespace stuff is so hard to handle with the level of error messages from clojure"><a href="#t1505427040000036" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-14</span> <span class="t" onclick="H(this)">22:10:40</span>                    mmer </span><span>Thanks - re-organised the project as you said. I am still getting the issue where the first record typr encountered by the rules engine in the session is saying that the Record type can&apos;t be found.  This namespace stuff is so hard to handle with the level of error messages from clojure</span></div><div id="t1505428019000094" t="2017-09-14 22:26:59 olivergeorge Thanks for the tips @mikerod"><a href="#t1505428019000094" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-14</span> <span class="t" onclick="H(this)">22:26:59</span>            olivergeorge </span><span>Thanks for the tips @mikerod</span></div><div id="t1505429356000101" t="2017-09-14 22:49:16 dadair depends how you are using Operation"><a href="#t1505429356000101" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-14</span> <span class="t" onclick="H(this)">22:49:16</span>                  dadair </span><span>depends how you are using Operation</span></div><div id="t1505429361000372" t="2017-09-14 22:49:21 dadair can you post an example rule?"><a href="#t1505429361000372" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-14</span> <span class="t" onclick="H(this)">22:49:21</span>                  dadair </span><span>can you post an example rule?</span></div><div id="t1505429636000094" t="2017-09-14 22:53:56 dadair or the exact line of the error?"><a href="#t1505429636000094" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-14</span> <span class="t" onclick="H(this)">22:53:56</span>                  dadair </span><span>or the exact line of the error?</span></div><div id="t1505645530000039" t="2017-09-17 10:52:10 mmer More details:"><a href="#t1505645530000039" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-17</span> <span class="t" onclick="H(this)">10:52:10</span>                    mmer </span><span>More details:</span></div><div id="t1505645641000026" t="2017-09-17 10:54:01 mmer This must be something very simple about classpaths etc that I am not grasping.  The Operation is defined as:"><a href="#t1505645641000026" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-17</span> <span class="t" onclick="H(this)">10:54:01</span>                    mmer </span><span>This must be something very simple about classpaths etc that I am not grasping.  The Operation is defined as:</span></div><div id="t1505645643000027" t="2017-09-17 10:54:03 mmer (defrecord Operation [assemblyName name src])"><a href="#t1505645643000027" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-17</span> <span class="t" onclick="H(this)">10:54:03</span>                    mmer </span><span>(defrecord Operation [assemblyName name src])</span></div><div id="t1505675954000077" t="2017-09-17 19:19:14 mmer The erro I am getting is: ClassNotFoundException Thing  java.net.URLClassLoader.findClass (URLClassLoader.java:381)  - I am trying to isolate the issue into a simple set of files - hence the reference to Thing rather than Operation"><a href="#t1505675954000077" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-17</span> <span class="t" onclick="H(this)">19:19:14</span>                    mmer </span><span>The erro I am getting is: ClassNotFoundException Thing  java.net.URLClassLoader.findClass (URLClassLoader.java:381)  - I am trying to isolate the issue into a simple set of files - hence the reference to Thing rather than Operation</span></div><div id="t1505682130000016" t="2017-09-17 21:02:10 mikerod @mmer I don’t see enough information here to be able to see what the problem coulud be"><a href="#t1505682130000016" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-17</span> <span class="t" onclick="H(this)">21:02:10</span>                 mikerod </span><span>@mmer I don’t see enough information here to be able to see what the problem coulud be</span></div><div id="t1505682145000103" t="2017-09-17 21:02:25 mikerod the class not found’s name is  AssemblyOperation  which you don’t even refer to in the rule  debug-rules"><a href="#t1505682145000103" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-17</span> <span class="t" onclick="H(this)">21:02:25</span>                 mikerod </span><span>the class not found’s name is </span><code>AssemblyOperation</code><span> which you don’t even refer to in the rule </span><code>debug-rules</code></div><div id="t1505682153000023" t="2017-09-17 21:02:33 mikerod So I’m not sure how they are connected"><a href="#t1505682153000023" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-17</span> <span class="t" onclick="H(this)">21:02:33</span>                 mikerod </span><span>So I’m not sure how they are connected</span></div><div id="t1505682202000139" t="2017-09-17 21:03:22 mikerod However, if classes are missing, I’d make sure you are appropriately requiring all necessary namespaces, including those that define types via things like  defrecord"><a href="#t1505682202000139" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-17</span> <span class="t" onclick="H(this)">21:03:22</span>                 mikerod </span><span>However, if classes are missing, I’d make sure you are appropriately requiring all necessary namespaces, including those that define types via things like </span><code>defrecord</code></div><div id="t1505685966000047" t="2017-09-17 22:06:06 mmer Hi @mikerod - in trying to get a simple example out I have confused you all.  Sorry.  I now have a very simple project which is showing the issue."><a href="#t1505685966000047" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-17</span> <span class="t" onclick="H(this)">22:06:06</span>                    mmer </span><span>Hi @mikerod - in trying to get a simple example out I have confused you all.  Sorry.  I now have a very simple project which is showing the issue.</span></div><div id="t1505686153000028" t="2017-09-17 22:09:13 mmer (apply-rules &quot;name&quot; &quot;description&quot;) and I get the errors"><a href="#t1505686153000028" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-17</span> <span class="t" onclick="H(this)">22:09:13</span>                    mmer </span><span>(apply-rules &quot;name&quot; &quot;description&quot;) and I get the errors</span></div><div id="t1505686165000053" t="2017-09-17 22:09:25 mmer ClassNotFoundException Thing  java.net.URLClassLoader.findClass (URLClassLoader.java:381)"><a href="#t1505686165000053" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-17</span> <span class="t" onclick="H(this)">22:09:25</span>                    mmer </span><span>ClassNotFoundException Thing  java.net.URLClassLoader.findClass (URLClassLoader.java:381)</span></div><div id="t1505686242000008" t="2017-09-17 22:10:42 mmer Everything to my eyes looks OK and follows the scheme of project layout that avoids cyclical dependencies, yet I can&apos;t get the reference to the rule to see the record defined in the shared files."><a href="#t1505686242000008" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-17</span> <span class="t" onclick="H(this)">22:10:42</span>                    mmer </span><span>Everything to my eyes looks OK and follows the scheme of project layout that avoids cyclical dependencies, yet I can&apos;t get the reference to the rule to see the record defined in the shared files.</span></div><div id="t1505686590000097" t="2017-09-17 22:16:30 mikerod @mmer when defining types  via  defrecord  (and similarly,  deftype ), a  :refer  from a  :require  does not import the class name to be used shorthand. 
So you need to refer to the class either by it’s fully qualified name, or add something like
 (:import [rules.shared Thing])
 
to your rules namespaces using the class"><a href="#t1505686590000097" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-17</span> <span class="t" onclick="H(this)">22:16:30</span>                 mikerod </span><span>@mmer when defining types  via </span><code>defrecord</code><span> (and similarly, </span><code>deftype</code><span>), a </span><code>:refer</code><span> from a </span><code>:require</code><span> does not import the class name to be used shorthand. 
So you need to refer to the class either by it’s fully qualified name, or add something like
</span><pre>(:import [rules.shared Thing])
</pre><span>
to your rules namespaces using the class</span></div><div id="t1505747563000636" t="2017-09-18 15:12:43 wparker https://stackoverflow.com/questions/7143406/what-are-the-differences-among-require-import-and-use  has an (IMO) nice concise summary of the differences @mmer.  One other potential gotcha - if you define a record with hyphens in the namespace path, the Java class created will have underscores in the corresponding class name, and import needs the Java class name"><a href="#t1505747563000636" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-18</span> <span class="t" onclick="H(this)">15:12:43</span>                 wparker </span><a href="https://stackoverflow.com/questions/7143406/what-are-the-differences-among-require-import-and-use" target="_blank">https://stackoverflow.com/questions/7143406/what-are-the-differences-among-require-import-and-use</a><span> has an (IMO) nice concise summary of the differences @mmer.  One other potential gotcha - if you define a record with hyphens in the namespace path, the Java class created will have underscores in the corresponding class name, and import needs the Java class name</span></div><div id="t1505747768000519" t="2017-09-18 15:16:08 mmer Thanks - Just what I needed."><a href="#t1505747768000519" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-18</span> <span class="t" onclick="H(this)">15:16:08</span>                    mmer </span><span>Thanks - Just what I needed.</span></div><div id="t1505798850000109" t="2017-09-19 05:27:30 devn @mmer we built a lib such that you can require a single ns and have access to the records via an alias in addition to some other niceties like inheriting fields and specs on those fields from a parent fact"><a href="#t1505798850000109" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-19</span> <span class="t" onclick="H(this)">05:27:30</span>                    devn </span><span>@mmer we built a lib such that you can require a single ns and have access to the records via an alias in addition to some other niceties like inheriting fields and specs on those fields from a parent fact</span></div><div id="t1505799032000129" t="2017-09-19 05:30:32 devn fact/my-fact, (deffact abc (alias abc) :a integer? (variant qrs (alias qrs) :q ::some-spec)))"><a href="#t1505799032000129" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-19</span> <span class="t" onclick="H(this)">05:30:32</span>                    devn </span><span>fact/my-fact, (deffact abc (alias abc) :a integer? (variant qrs (alias qrs) :q ::some-spec)))</span></div><div id="t1505835697000722" t="2017-09-19 15:41:37 mmer Where is this library?"><a href="#t1505835697000722" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-19</span> <span class="t" onclick="H(this)">15:41:37</span>                    mmer </span><span>Where is this library?</span></div><div id="t1505843058000422" t="2017-09-19 17:44:18 devn @mmer closed source at the moment but will talk to folks about opening it up"><a href="#t1505843058000422" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-19</span> <span class="t" onclick="H(this)">17:44:18</span>                    devn </span><span>@mmer closed source at the moment but will talk to folks about opening it up</span></div><div id="t1505846925000030" t="2017-09-19 18:48:45 mmer ok"><a href="#t1505846925000030" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-19</span> <span class="t" onclick="H(this)">18:48:45</span>                    mmer </span><span>ok</span></div><div id="t1506041796000196" t="2017-09-22 00:56:36 dadair Do facts inserted by rules with accumulators in the LHS observe truth maintenance retractions if the accumulator changes? i.e., if I have a  max  accumulator, and 5 facts are inserted, will the RHS facts be retracted for the four facts that aren&apos;t the max?"><a href="#t1506041796000196" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-22</span> <span class="t" onclick="H(this)">00:56:36</span>                  dadair </span><span>Do facts inserted by rules with accumulators in the LHS observe truth maintenance retractions if the accumulator changes? i.e., if I have a </span><code>max</code><span> accumulator, and 5 facts are inserted, will the RHS facts be retracted for the four facts that aren&apos;t the max?</span></div><div id="t1506091208000236" t="2017-09-22 14:40:08 wparker @U0E2EQFME: Yes, accumulator conditions will adjust as necessary to respect truth maintenance.  This test is a concrete example:  https://github.com/cerner/clara-rules/blob/master/src/test/common/clara/test_accumulation.cljc#L1102"><a href="#t1506091208000236" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-22</span> <span class="t" onclick="H(this)">14:40:08</span>                      wparker </span><span>@U0E2EQFME: Yes, accumulator conditions will adjust as necessary to respect truth maintenance.  This test is a concrete example: </span><a href="https://github.com/cerner/clara-rules/blob/master/src/test/common/clara/test_accumulation.cljc#L1102" target="_blank">https://github.com/cerner/clara-rules/blob/master/src/test/common/clara/test_accumulation.cljc#L1102</a></div><div id="t1506100973000151" t="2017-09-22 17:22:53 dadair awesome thanks!"><a href="#t1506100973000151" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-22</span> <span class="t" onclick="H(this)">17:22:53</span>                       dadair </span><span>awesome thanks!</span></div><div id="t1506357926000393" t="2017-09-25 16:45:26 enn I have this clause in an LHS:

 [?last-performed-date &lt;- (acc/max :date)
   :from [fact/test-result
          (= ?test-id test-id)]]
 

Because the initial value of the max accumulator is nil, it never fires when there are no test-result facts. Am I missing some idiomatic way to have it fire in that case? Do I need to write my own accumulator with a different initial value? Can I do this with :or?"><a href="#t1506357926000393" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-25</span> <span class="t" onclick="H(this)">16:45:26</span>                     enn </span><span>I have this clause in an LHS:

</span><pre>[?last-performed-date &lt;- (acc/max :date)
   :from [fact/test-result
          (= ?test-id test-id)]]
</pre><span>

Because the initial value of the max accumulator is nil, it never fires when there are no test-result facts. Am I missing some idiomatic way to have it fire in that case? Do I need to write my own accumulator with a different initial value? Can I do this with :or?</span></div><div id="t1506369149000197" t="2017-09-25 19:52:29 mikerod @enn you should just structure the rules in a way to handle the missing case"><a href="#t1506369149000197" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-25</span> <span class="t" onclick="H(this)">19:52:29</span>                 mikerod </span><span>@enn you should just structure the rules in a way to handle the missing case</span></div><div id="t1506369165000524" t="2017-09-25 19:52:45 mikerod since  acc/max  doesn’t necessarily make sense for no facts - that may not always be the behavior that was desired"><a href="#t1506369165000524" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-25</span> <span class="t" onclick="H(this)">19:52:45</span>                 mikerod </span><span>since </span><code>acc/max</code><span> doesn’t necessarily make sense for no facts - that may not always be the behavior that was desired</span></div><div id="t1506369188000001" t="2017-09-25 19:53:08 mikerod You could give it an  :initial-value  if you wanted to I suppose though"><a href="#t1506369188000001" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-25</span> <span class="t" onclick="H(this)">19:53:08</span>                 mikerod </span><span>You could give it an </span><code>:initial-value</code><span> if you wanted to I suppose though</span></div><div id="t1506369225000421" t="2017-09-25 19:53:45 mikerod [?last-performed-date &lt;- (assoc (acc/max :date) :initial-value &lt;my-date&gt;)
   :from [fact/test-result
          (= ?test-id test-id)]]
 
not sure it will always be clear what happened though"><a href="#t1506369225000421" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-25</span> <span class="t" onclick="H(this)">19:53:45</span>                 mikerod </span><pre>[?last-performed-date &lt;- (assoc (acc/max :date) :initial-value &lt;my-date&gt;)
   :from [fact/test-result
          (= ?test-id test-id)]]
</pre><span>
not sure it will always be clear what happened though</span></div><div id="t1506369447000682" t="2017-09-25 19:57:27 enn @mikerod thanks--I ended up adding an  [:or ... [:not [fact/test-result (= ?test-id test-id)]]] 1"><a href="#t1506369447000682" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-25</span> <span class="t" onclick="H(this)">19:57:27</span>                     enn </span><span>@mikerod thanks--I ended up adding an </span><code>[:or ... [:not [fact/test-result (= ?test-id test-id)]]]</code><span>1</span></div><div id="t1506374208000192" t="2017-09-25 21:16:48 nickowsy Is there a way to use accumulate with multiple fact_contraints?  For example, if I have the facts 
 {:e 2, :a :type, :v :dog}
{:e 2, :a :age, :v  12}
{:e 3, :a :type, :v :cat}
{:e 3, :a :age, :v 2}
{:e 4, :a :type, :v :dog}
{:e 4, :a :age, :v 10}   I would like to acc/all :type facts, matching :type is :dog and :age &gt; 4. The  :fact-type-fn is :a."><a href="#t1506374208000192" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-25</span> <span class="t" onclick="H(this)">21:16:48</span>                nickowsy </span><span>Is there a way to use accumulate with multiple fact_contraints?  For example, if I have the facts 
</span><pre>{:e 2, :a :type, :v :dog}
{:e 2, :a :age, :v  12}
{:e 3, :a :type, :v :cat}
{:e 3, :a :age, :v 2}
{:e 4, :a :type, :v :dog}
{:e 4, :a :age, :v 10}</pre><span>  I would like to acc/all :type facts, matching :type is :dog and :age &gt; 4. The  :fact-type-fn is :a.</span></div><div id="t1506375191000421" t="2017-09-25 21:33:11 mikerod [:type
 (= (:v this) :dog)
 (= ?id (:e this))]

[?all &lt;- (acc/all)
 :from [:age
        (= ?id (:e this))
        (&gt; (:v this) 4)]
 
@nickowsy perhaps?"><a href="#t1506375191000421" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-25</span> <span class="t" onclick="H(this)">21:33:11</span>                 mikerod </span><pre>[:type
 (= (:v this) :dog)
 (= ?id (:e this))]

[?all &lt;- (acc/all)
 :from [:age
        (= ?id (:e this))
        (&gt; (:v this) 4)]
</pre><span>
@nickowsy perhaps?</span></div><div id="t1506375208000318" t="2017-09-25 21:33:28 mikerod So an accumulator that does a join with another fact"><a href="#t1506375208000318" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-25</span> <span class="t" onclick="H(this)">21:33:28</span>                 mikerod </span><span>So an accumulator that does a join with another fact</span></div><div id="t1506375649000284" t="2017-09-25 21:40:49 nickowsy @mikerod, cool thanks.  I had something similar but was seeing the rule run multiple times.  Once for each  [:type
 (= (:v this) :dog)
 (= ?id (:e this))]  match"><a href="#t1506375649000284" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-25</span> <span class="t" onclick="H(this)">21:40:49</span>                nickowsy </span><span>@mikerod, cool thanks.  I had something similar but was seeing the rule run multiple times.  Once for each </span><pre>[:type
 (= (:v this) :dog)
 (= ?id (:e this))]</pre><span> match</span></div><div id="t1506375771000277" t="2017-09-25 21:42:51 mikerod @nickowsy yes, it would"><a href="#t1506375771000277" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-25</span> <span class="t" onclick="H(this)">21:42:51</span>                 mikerod </span><span>@nickowsy yes, it would</span></div><div id="t1506635319000191" t="2017-09-28 21:48:39 souenzzo How to print/debug all fired rules?"><a href="#t1506635319000191" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-28</span> <span class="t" onclick="H(this)">21:48:39</span>                souenzzo </span><span>How to print/debug all fired rules?</span></div><div id="t1506641956000298" t="2017-09-28 23:39:16 dadair http://www.clara-rules.org/docs/inspection/"><a href="#t1506641956000298" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-28</span> <span class="t" onclick="H(this)">23:39:16</span>                  dadair </span><a href="http://www.clara-rules.org/docs/inspection/" target="_blank">http://www.clara-rules.org/docs/inspection/</a></div><div id="t1506641972000080" t="2017-09-28 23:39:32 dadair @souenzzo"><a href="#t1506641972000080" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-28</span> <span class="t" onclick="H(this)">23:39:32</span>                  dadair </span><span>@souenzzo</span></div><div id="t1506646408000025" t="2017-09-29 00:53:28 olivergeorge In my early experimentation with clara I ended up with infinite loops when firing rules.  They were non-terminating due to rules which are directly or indirectly affected by the facts they insert."><a href="#t1506646408000025" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-29</span> <span class="t" onclick="H(this)">00:53:28</span>            olivergeorge </span><span>In my early experimentation with clara I ended up with infinite loops when firing rules.  They were non-terminating due to rules which are directly or indirectly affected by the facts they insert.</span></div><div id="t1506646486000218" t="2017-09-29 00:54:46 olivergeorge I went looking for documentation around this.  I can&apos;t see anything apart from an issue about a :no-loop flag."><a href="#t1506646486000218" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-29</span> <span class="t" onclick="H(this)">00:54:46</span>            olivergeorge </span><span>I went looking for documentation around this.  I can&apos;t see anything apart from an issue about a :no-loop flag.</span></div><div id="t1506646538000140" t="2017-09-29 00:55:38 olivergeorge Direct question: is Clara smart enough to avoid infinite loops based on bad rules?"><a href="#t1506646538000140" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-29</span> <span class="t" onclick="H(this)">00:55:38</span>            olivergeorge </span><span>Direct question: is Clara smart enough to avoid infinite loops based on bad rules?</span></div><div id="t1506689996000281" t="2017-09-29 12:59:56 souenzzo @dadair not sure if I understand. But my rules was in a loop inside the fire-rules."><a href="#t1506689996000281" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-29</span> <span class="t" onclick="H(this)">12:59:56</span>                souenzzo </span><span>@dadair not sure if I understand. But my rules was in a loop inside the fire-rules.</span></div><div id="t1506697794000156" t="2017-09-29 15:09:54 mikerod @olivergeorge are you asking if Clara can solve the Halting problem?"><a href="#t1506697794000156" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-29</span> <span class="t" onclick="H(this)">15:09:54</span>                 mikerod </span><span>@olivergeorge are you asking if Clara can solve the Halting problem?</span></div><div id="t1506697797000114" t="2017-09-29 15:09:57 mikerod 😛"><a href="#t1506697797000114" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-29</span> <span class="t" onclick="H(this)">15:09:57</span>                 mikerod </span><b>😛</b></div><div id="t1506697817000107" t="2017-09-29 15:10:17 mikerod Joking aside: No Clara can’t really detect the loops"><a href="#t1506697817000107" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-29</span> <span class="t" onclick="H(this)">15:10:17</span>                 mikerod </span><span>Joking aside: No Clara can’t really detect the loops</span></div><div id="t1506697824000134" t="2017-09-29 15:10:24 mikerod The RHS can do arbitrary things"><a href="#t1506697824000134" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-29</span> <span class="t" onclick="H(this)">15:10:24</span>                 mikerod </span><span>The RHS can do arbitrary things</span></div><div id="t1506697839000573" t="2017-09-29 15:10:39 mikerod There is no way to know that something that “looks like a cycle” at runtime isn’t going to eventually stop cycling"><a href="#t1506697839000573" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-29</span> <span class="t" onclick="H(this)">15:10:39</span>                 mikerod </span><span>There is no way to know that something that “looks like a cycle” at runtime isn’t going to eventually stop cycling</span></div><div id="t1506697878000095" t="2017-09-29 15:11:18 mikerod Clara could assume if a cycle of rules was happening “too many times” that it should stop"><a href="#t1506697878000095" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-29</span> <span class="t" onclick="H(this)">15:11:18</span>                 mikerod </span><span>Clara could assume if a cycle of rules was happening “too many times” that it should stop</span></div><div id="t1506697972000246" t="2017-09-29 15:12:52 mikerod In Drools (popular Java-based rules engine that I often reference since it was used a lot in the industry) there was a “fire until halt” sort of method I believe it was called. This allowed to have a sort of “timeout” feature that the rules would stop if they reached a certain threshold of time, steps, # rule firings, etc. So something like that is feasible to implement, but not in Clara right now."><a href="#t1506697972000246" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-29</span> <span class="t" onclick="H(this)">15:12:52</span>                 mikerod </span><span>In Drools (popular Java-based rules engine that I often reference since it was used a lot in the industry) there was a “fire until halt” sort of method I believe it was called. This allowed to have a sort of “timeout” feature that the rules would stop if they reached a certain threshold of time, steps, # rule firings, etc. So something like that is feasible to implement, but not in Clara right now.</span></div><div id="t1506698025000326" t="2017-09-29 15:13:45 mikerod I do tend to try to avoid using something like  :no-loop  too and instead setup the rules in a way where they logically won’t loop.  :no-loop  starts to go against the logical truth maintenance in some cases."><a href="#t1506698025000326" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-29</span> <span class="t" onclick="H(this)">15:13:45</span>                 mikerod </span><span>I do tend to try to avoid using something like </span><code>:no-loop</code><span> too and instead setup the rules in a way where they logically won’t loop. </span><code>:no-loop</code><span> starts to go against the logical truth maintenance in some cases.</span></div><div id="t1506698063000114" t="2017-09-29 15:14:23 mikerod Understandably, there are cases where it is sort of hard to think about how you can make the rule logic you want not form a logical loop."><a href="#t1506698063000114" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-29</span> <span class="t" onclick="H(this)">15:14:23</span>                 mikerod </span><span>Understandably, there are cases where it is sort of hard to think about how you can make the rule logic you want not form a logical loop.</span></div><div id="t1506700753000159" t="2017-09-29 15:59:13 wparker There is work logged for Clara to assume by default that after a certain number of iterations of looping that the rules were written incorrectly and throw an exception:  https://github.com/cerner/clara-rules/issues/275"><a href="#t1506700753000159" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-29</span> <span class="t" onclick="H(this)">15:59:13</span>                 wparker </span><span>There is work logged for Clara to assume by default that after a certain number of iterations of looping that the rules were written incorrectly and throw an exception: </span><a href="https://github.com/cerner/clara-rules/issues/275" target="_blank">https://github.com/cerner/clara-rules/issues/275</a></div><div id="t1506700881000280" t="2017-09-29 16:01:21 wparker I agree with @mikerod ‘s comments - perhaps another way of thinking about it is that if you just write a normal infinitely recursive function, Clojure or any other programming language can throw a StackOverflowException but can’t automatically recover from it - the language would have to guess what the programmer actually wanted to do in order to accomplish that"><a href="#t1506700881000280" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-29</span> <span class="t" onclick="H(this)">16:01:21</span>                 wparker </span><span>I agree with @mikerod ‘s comments - perhaps another way of thinking about it is that if you just write a normal infinitely recursive function, Clojure or any other programming language can throw a StackOverflowException but can’t automatically recover from it - the language would have to guess what the programmer actually wanted to do in order to accomplish that</span></div><div id="t1506700946000468" t="2017-09-29 16:02:26 wparker I see Clara’s handling of infinitely looping rules as similar - there’s no way for Clara to guess what the user actually wanted to do"><a href="#t1506700946000468" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-29</span> <span class="t" onclick="H(this)">16:02:26</span>                 wparker </span><span>I see Clara’s handling of infinitely looping rules as similar - there’s no way for Clara to guess what the user actually wanted to do</span></div><div id="t1506701020000271" t="2017-09-29 16:03:40 mikerod Cool, forgot you logged that issue before"><a href="#t1506701020000271" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-29</span> <span class="t" onclick="H(this)">16:03:40</span>                 mikerod </span><span>Cool, forgot you logged that issue before</span></div><div id="t1506722310000065" t="2017-09-29 21:58:30 dadair Is there a way for someone to override what is printed when an exception is thrown? I have a fact with a very large map and when an exception is thrown it tries to print it as a binding and the REPL basically becomes unresponsive."><a href="#t1506722310000065" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-29</span> <span class="t" onclick="H(this)">21:58:30</span>                  dadair </span><span>Is there a way for someone to override what is printed when an exception is thrown? I have a fact with a very large map and when an exception is thrown it tries to print it as a binding and the REPL basically becomes unresponsive.</span></div><div id="t1506724646000125" t="2017-09-29 22:37:26 mikerod @dadair I’ve had similar issues before"><a href="#t1506724646000125" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-29</span> <span class="t" onclick="H(this)">22:37:26</span>                 mikerod </span><span>@dadair I’ve had similar issues before</span></div><div id="t1506724719000058" t="2017-09-29 22:38:39 mikerod Trying to think of a workaround"><a href="#t1506724719000058" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-29</span> <span class="t" onclick="H(this)">22:38:39</span>                 mikerod </span><span>Trying to think of a workaround</span></div><div id="t1506724765000095" t="2017-09-29 22:39:25 mikerod I think printing the bindings directly in the exception message can be a little ambitious since sometimes there are really large bindings. They can be really big due to things like  acc/all  too"><a href="#t1506724765000095" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-29</span> <span class="t" onclick="H(this)">22:39:25</span>                 mikerod </span><span>I think printing the bindings directly in the exception message can be a little ambitious since sometimes there are really large bindings. They can be really big due to things like </span><code>acc/all</code><span> too</span></div><div id="t1506724781000244" t="2017-09-29 22:39:41 mikerod From the REPL, you may be able to get by with  try  +  catch  around when you run the rules?"><a href="#t1506724781000244" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-29</span> <span class="t" onclick="H(this)">22:39:41</span>                 mikerod </span><span>From the REPL, you may be able to get by with </span><code>try</code><span> + </span><code>catch</code><span> around when you run the rules?</span></div><div id="t1506724795000079" t="2017-09-29 22:39:55 mikerod so  catch  the exception to not let it print its default dump"><a href="#t1506724795000079" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-29</span> <span class="t" onclick="H(this)">22:39:55</span>                 mikerod </span><span>so </span><code>catch</code><span> the exception to not let it print its default dump</span></div><div id="t1506724818000020" t="2017-09-29 22:40:18 mikerod if you are encountering the error using something like  clojure.test  it automatically catches and prints exceptions I think. You may be able to override that behavior as well"><a href="#t1506724818000020" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-29</span> <span class="t" onclick="H(this)">22:40:18</span>                 mikerod </span><span>if you are encountering the error using something like </span><code>clojure.test</code><span> it automatically catches and prints exceptions I think. You may be able to override that behavior as well</span></div><div id="t1506733206000166" t="2017-09-30 01:00:06 souenzzo Does &quot;query&quot; is a slow operation?
For lage sets, witch shoud be optimal?
- One big query with &quot;all&quot;(possible) facts, with some &quot;garbage&quot; and use just what I really need
- Many little query, with just  what I really need,"><a href="#t1506733206000166" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-09-30</span> <span class="t" onclick="H(this)">01:00:06</span>                souenzzo </span><span>Does &quot;query&quot; is a slow operation?
For lage sets, witch shoud be optimal?
- One big query with &quot;all&quot;(possible) facts, with some &quot;garbage&quot; and use just what I really need
- Many little query, with just  what I really need,</span></div><div id="t1506833656000024" t="2017-10-01 04:54:16 wparker Queries are really just rules without a RHS, at least in the current implementation. There are some optimizations that could be done on queries that aren’t valid for rules; for my part none of my use-cases have yet had enough of a problem to warrant spending the time implementing them.  Note that the results are calculated during fire-rules, and calling “query” is really just a map get operation.  Filters that can be expressed as values of bindings can end up being expressed as just map gets if the query parameters are set appropriately.  Otherwise, to be honest its hard to say much about perf without knowing more specifics.  My personal bias would be to express as much as possible in declarative logic e.g. “little queries” and then address any concrete perf problems that come up, but obviously the optimal strategy depends a lot on your use-case."><a href="#t1506833656000024" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-01</span> <span class="t" onclick="H(this)">04:54:16</span>                      wparker </span><span>Queries are really just rules without a RHS, at least in the current implementation. There are some optimizations that could be done on queries that aren’t valid for rules; for my part none of my use-cases have yet had enough of a problem to warrant spending the time implementing them.  Note that the results are calculated during fire-rules, and calling “query” is really just a map get operation.  Filters that can be expressed as values of bindings can end up being expressed as just map gets if the query parameters are set appropriately.  Otherwise, to be honest its hard to say much about perf without knowing more specifics.  My personal bias would be to express as much as possible in declarative logic e.g. “little queries” and then address any concrete perf problems that come up, but obviously the optimal strategy depends a lot on your use-case.</span></div><div id="t1506826579000049" t="2017-10-01 02:56:19 olivergeorge Thanks @mikerod &amp; @wparker.  No great surprise.  I did wonder if keeping track of inputs for truth maintenance provided a mechanism to detect a loop.  e.g. If one of my inputs is based on my output then raise exception."><a href="#t1506826579000049" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-01</span> <span class="t" onclick="H(this)">02:56:19</span>            olivergeorge </span><span>Thanks @mikerod &amp; @wparker.  No great surprise.  I did wonder if keeping track of inputs for truth maintenance provided a mechanism to detect a loop.  e.g. If one of my inputs is based on my output then raise exception.</span></div><div id="t1506829211000020" t="2017-10-01 03:40:11 mikerod Yeah I’m not sure. There may be some possibility for the truth maintenance to detect  a cycle in the automatic retraction stuff. Haven’t thought that one through before. "><a href="#t1506829211000020" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-01</span> <span class="t" onclick="H(this)">03:40:11</span>                 mikerod </span><span>Yeah I’m not sure. There may be some possibility for the truth maintenance to detect  a cycle in the automatic retraction stuff. Haven’t thought that one through before. </span></div><div id="t1507229529000603" t="2017-10-05 18:52:09 dg has anyone ever seen an exception from  (explain-activations session)  when the rules are all working well?
 UnsupportedOperationException nth not supported on this type: PersistentArrayMap  clojure.lang.RT.nthFrom (RT.java:947)
"><a href="#t1507229529000603" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-05</span> <span class="t" onclick="H(this)">18:52:09</span>                      dg </span><span>has anyone ever seen an exception from </span><code>(explain-activations session)</code><span> when the rules are all working well?
</span><pre>UnsupportedOperationException nth not supported on this type: PersistentArrayMap  clojure.lang.RT.nthFrom (RT.java:947)
</pre></div><div id="t1507230113000323" t="2017-10-05 19:01:53 dg it seems like explain-activations may just be broken.  it expects  (:matches explanation)  to be a vector of  [fact condition]  but it&apos;s actually a map of  {:fact .. :condition ... }"><a href="#t1507230113000323" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-05</span> <span class="t" onclick="H(this)">19:01:53</span>                      dg </span><span>it seems like explain-activations may just be broken.  it expects </span><code>(:matches explanation)</code><span> to be a vector of </span><code>[fact condition]</code><span> but it&apos;s actually a map of </span><code>{:fact .. :condition ... }</code></div><div id="t1507230208000058" t="2017-10-05 19:03:28 enn I have a clause like this:

 [:not
   [:and
    (x (= ?foo foo))
    (y (= ?foo bar))]]
 

When it fires, I get this error:

&gt; Using variable that is not previously bound…. Note that variables used in negations are not bound for subsequent rules since the negation can never match.

To my thinking, the  y  clause is not a subsequent rule since it’s part of the same  :and . I want the clause to match cases where this combination of  x  and  y  facts doesn’t exist, though an individual  x  or  y  fact may exist. How can I express this?"><a href="#t1507230208000058" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-05</span> <span class="t" onclick="H(this)">19:03:28</span>                     enn </span><span>I have a clause like this:

</span><pre>[:not
   [:and
    (x (= ?foo foo))
    (y (= ?foo bar))]]
</pre><span>

When it fires, I get this error:

&gt; Using variable that is not previously bound…. Note that variables used in negations are not bound for subsequent rules since the negation can never match.

To my thinking, the </span><code>y</code><span> clause is not a subsequent rule since it’s part of the same </span><code>:and</code><span>. I want the clause to match cases where this combination of </span><code>x</code><span> and </span><code>y</code><span> facts doesn’t exist, though an individual </span><code>x</code><span> or </span><code>y</code><span> fact may exist. How can I express this?</span></div><div id="t1507232877000414" t="2017-10-05 19:47:57 mikerod @dg looks like you took care of that with  https://github.com/cerner/clara-rules/pull/346  ?"><a href="#t1507232877000414" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-05</span> <span class="t" onclick="H(this)">19:47:57</span>                 mikerod </span><span>@dg looks like you took care of that with </span><a href="https://github.com/cerner/clara-rules/pull/346" target="_blank">https://github.com/cerner/clara-rules/pull/346</a><span> ?</span></div><div id="t1507232909000650" t="2017-10-05 19:48:29 dg yeah"><a href="#t1507232909000650" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-05</span> <span class="t" onclick="H(this)">19:48:29</span>                      dg </span><span>yeah</span></div><div id="t1507233183000241" t="2017-10-05 19:53:03 mikerod @enn So Clara (similar to some other rete-based engines) convert the logical structures to DNF (disjunctive normal form). This is typically done to simplify the Rete tree construction and data flow."><a href="#t1507233183000241" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-05</span> <span class="t" onclick="H(this)">19:53:03</span>                 mikerod </span><span>@enn So Clara (similar to some other rete-based engines) convert the logical structures to DNF (disjunctive normal form). This is typically done to simplify the Rete tree construction and data flow.</span></div><div id="t1507233208000085" t="2017-10-05 19:53:28 mikerod So in this case, it’d be  NOT (X AND Y)  converted to  NOT X OR NOT Y  and the OR divides the two clauses into distinct chunks. To deal with this, there is typical special handling for “negated conjunctions”."><a href="#t1507233208000085" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-05</span> <span class="t" onclick="H(this)">19:53:28</span>                 mikerod </span><span>So in this case, it’d be </span><code>NOT (X AND Y)</code><span> converted to </span><code>NOT X OR NOT Y</code><span> and the OR divides the two clauses into distinct chunks. To deal with this, there is typical special handling for “negated conjunctions”.</span></div><div id="t1507233226000474" t="2017-10-05 19:53:46 mikerod I wouldn’t expect this behavior since Clara has some special handling of a negated conjunction like this."><a href="#t1507233226000474" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-05</span> <span class="t" onclick="H(this)">19:53:46</span>                 mikerod </span><span>I wouldn’t expect this behavior since Clara has some special handling of a negated conjunction like this.</span></div><div id="t1507233234000124" t="2017-10-05 19:53:54 mikerod Is your rule more complex than just what you posted here?"><a href="#t1507233234000124" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-05</span> <span class="t" onclick="H(this)">19:53:54</span>                 mikerod </span><span>Is your rule more complex than just what you posted here?</span></div><div id="t1507233845000434" t="2017-10-05 20:04:05 enn @mikerod yes, a bit more complex--here’s a more accurate version of that clause, and there are also other clauses in the rule:

 [:not
   [:and
    (x
     (= ?foo foo))
    (y
     ((set (map :id ?foo)) foo_id)
     (= ?previously_bound_lvar other_id))]]
"><a href="#t1507233845000434" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-05</span> <span class="t" onclick="H(this)">20:04:05</span>                     enn </span><span>@mikerod yes, a bit more complex--here’s a more accurate version of that clause, and there are also other clauses in the rule:

</span><pre>[:not
   [:and
    (x
     (= ?foo foo))
    (y
     ((set (map :id ?foo)) foo_id)
     (= ?previously_bound_lvar other_id))]]
</pre></div><div id="t1507233854000047" t="2017-10-05 20:04:14 enn I wonder if the set membership check was messing things up?"><a href="#t1507233854000047" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-05</span> <span class="t" onclick="H(this)">20:04:14</span>                     enn </span><span>I wonder if the set membership check was messing things up?</span></div><div id="t1507233894000454" t="2017-10-05 20:04:54 enn I ended up working around it by getting all values of  x.foo  in an accumulator, then doing a  :not  clause checking those values (if any) against  y.foo_id"><a href="#t1507233894000454" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-05</span> <span class="t" onclick="H(this)">20:04:54</span>                     enn </span><span>I ended up working around it by getting all values of </span><code>x.foo</code><span> in an accumulator, then doing a </span><code>:not</code><span> clause checking those values (if any) against </span><code>y.foo_id</code></div><div id="t1507233906000323" t="2017-10-05 20:05:06 mikerod &gt; I wonder if the set membership check was messing things up?
I don’t think it should"><a href="#t1507233906000323" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-05</span> <span class="t" onclick="H(this)">20:05:06</span>                 mikerod </span><span>&gt; I wonder if the set membership check was messing things up?
I don’t think it should</span></div><div id="t1507233916000177" t="2017-10-05 20:05:16 mikerod So the  :not  clause is not nested within anything else though right?"><a href="#t1507233916000177" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-05</span> <span class="t" onclick="H(this)">20:05:16</span>                 mikerod </span><span>So the </span><code>:not</code><span> clause is not nested within anything else though right?</span></div><div id="t1507233926000058" t="2017-10-05 20:05:26 enn no"><a href="#t1507233926000058" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-05</span> <span class="t" onclick="H(this)">20:05:26</span>                     enn </span><span>no</span></div><div id="t1507234026000201" t="2017-10-05 20:07:06 mikerod I’d have to mess around with that one to see what may be teh issue"><a href="#t1507234026000201" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-05</span> <span class="t" onclick="H(this)">20:07:06</span>                 mikerod </span><span>I’d have to mess around with that one to see what may be teh issue</span></div><div id="t1507234045000118" t="2017-10-05 20:07:25 mikerod However,  https://github.com/cerner/clara-rules/pull/342  could also be related to that sort of logic. There was some edge cases to how it was handled."><a href="#t1507234045000118" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-05</span> <span class="t" onclick="H(this)">20:07:25</span>                 mikerod </span><span>However, </span><a href="https://github.com/cerner/clara-rules/pull/342" target="_blank">https://github.com/cerner/clara-rules/pull/342</a><span> could also be related to that sort of logic. There was some edge cases to how it was handled.</span></div><div id="t1507234058000255" t="2017-10-05 20:07:38 mikerod This isn’t the same as the binding not being present in the rule though"><a href="#t1507234058000255" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-05</span> <span class="t" onclick="H(this)">20:07:38</span>                 mikerod </span><span>This isn’t the same as the binding not being present in the rule though</span></div><div id="t1507234109000046" t="2017-10-05 20:08:29 enn It’s interesting to hear that it should work. I’ll see if I can come up with a minimal test case, and open a ticket if so."><a href="#t1507234109000046" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-05</span> <span class="t" onclick="H(this)">20:08:29</span>                     enn </span><span>It’s interesting to hear that it should work. I’ll see if I can come up with a minimal test case, and open a ticket if so.</span></div><div id="t1507234379000123" t="2017-10-05 20:12:59 mikerod that’d be good to see"><a href="#t1507234379000123" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-05</span> <span class="t" onclick="H(this)">20:12:59</span>                 mikerod </span><span>that’d be good to see</span></div><div id="t1507234646000163" t="2017-10-05 20:17:26 mikerod (r/mk-session
 [(dsl/parse-query []
                   [[:not
                     [:and
                      [:x (= ?z (:z this))]]]])])
"><a href="#t1507234646000163" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-05</span> <span class="t" onclick="H(this)">20:17:26</span>                 mikerod </span><pre>(r/mk-session
 [(dsl/parse-query []
                   [[:not
                     [:and
                      [:x (= ?z (:z this))]]]])])
</pre></div><div id="t1507234666000270" t="2017-10-05 20:17:46 mikerod ExceptionInfo Using variable that is not previously bound. This can happen when an expression uses a previously unbound variable, or if a variable is referenced in a nested part of a parent expression, such as (or (= ?my-expression my-field) ...). 
Note that variables used in negations are not bound for subsequent
                                    rules since the negation can never match.
Production: 
{:lhs [[:not [:and {:type :x, :constraints [(= ?z (:z this))]}]]], :params #{}}
Unbound variables: #{?z}  clojure.core/ex-info (core.clj:4593)
"><a href="#t1507234666000270" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-05</span> <span class="t" onclick="H(this)">20:17:46</span>                 mikerod </span><pre>ExceptionInfo Using variable that is not previously bound. This can happen when an expression uses a previously unbound variable, or if a variable is referenced in a nested part of a parent expression, such as (or (= ?my-expression my-field) ...). 
Note that variables used in negations are not bound for subsequent
                                    rules since the negation can never match.
Production: 
{:lhs [[:not [:and {:type :x, :constraints [(= ?z (:z this))]}]]], :params #{}}
Unbound variables: #{?z}  clojure.core/ex-info (core.clj:4593)
</pre></div><div id="t1507234705000420" t="2017-10-05 20:18:25 mikerod That is pretty minimal"><a href="#t1507234705000420" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-05</span> <span class="t" onclick="H(this)">20:18:25</span>                 mikerod </span><span>That is pretty minimal</span></div><div id="t1507235617000001" t="2017-10-05 20:33:37 mikerod @enn I think the issue is that Clara it not allowing a condition within a negation to introduce a new bound variable"><a href="#t1507235617000001" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-05</span> <span class="t" onclick="H(this)">20:33:37</span>                 mikerod </span><span>@enn I think the issue is that Clara it not allowing a condition within a negation to introduce a new bound variable</span></div><div id="t1507235714000508" t="2017-10-05 20:35:14 mikerod This gets even more minimal:
 (mk-session
 [(dsl/parse-query []
                   [[:not [:x (= ?z (:z this))]]])])
 

fails due to  Unbound variables: #{?z} 

yet this is ok:
 (mk-session
 [(dsl/parse-query []
                   [[:y ( = ?z (:z this))]
                    [:not [:x (= ?z (:z this))]]])])
"><a href="#t1507235714000508" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-05</span> <span class="t" onclick="H(this)">20:35:14</span>                 mikerod </span><span>This gets even more minimal:
</span><pre>(mk-session
 [(dsl/parse-query []
                   [[:not [:x (= ?z (:z this))]]])])
</pre><span>

fails due to </span><code>Unbound variables: #{?z}</code><span>

yet this is ok:
</span><pre>(mk-session
 [(dsl/parse-query []
                   [[:y ( = ?z (:z this))]
                    [:not [:x (= ?z (:z this))]]])])
</pre></div><div id="t1507235757000189" t="2017-10-05 20:35:57 mikerod The case  of a single condition making a bound variable within a negation doesn’t make sense. However, in negated conjunction like in your previous example it does. I think this may be an edge case that Clara isn’t appropriately handling."><a href="#t1507235757000189" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-05</span> <span class="t" onclick="H(this)">20:35:57</span>                 mikerod </span><span>The case  of a single condition making a bound variable within a negation doesn’t make sense. However, in negated conjunction like in your previous example it does. I think this may be an edge case that Clara isn’t appropriately handling.</span></div><div id="t1507235766000642" t="2017-10-05 20:36:06 mikerod I can log the issue"><a href="#t1507235766000642" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-05</span> <span class="t" onclick="H(this)">20:36:06</span>                 mikerod </span><span>I can log the issue</span></div><div id="t1507236313000058" t="2017-10-05 20:45:13 mikerod Logged  https://github.com/cerner/clara-rules/issues/347"><a href="#t1507236313000058" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-05</span> <span class="t" onclick="H(this)">20:45:13</span>                 mikerod </span><span>Logged </span><a href="https://github.com/cerner/clara-rules/issues/347" target="_blank">https://github.com/cerner/clara-rules/issues/347</a></div><div id="t1507238858000037" t="2017-10-05 21:27:38 enn Thank you!"><a href="#t1507238858000037" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-05</span> <span class="t" onclick="H(this)">21:27:38</span>                     enn </span><span>Thank you!</span></div><div id="t1507239217000063" t="2017-10-05 21:33:37 afurmanov Hi, I wonder if I have facts like  Shape ,  Rectangle ,  Square , what would be recommended way to query all shapes?"><a href="#t1507239217000063" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-05</span> <span class="t" onclick="H(this)">21:33:37</span>               afurmanov </span><span>Hi, I wonder if I have facts like </span><code>Shape</code><span>, </span><code>Rectangle</code><span>, </span><code>Square</code><span>, what would be recommended way to query all shapes?</span></div><div id="t1507240690000213" t="2017-10-05 21:58:10 afurmanov I am new to Clojure/Clara, and what I am trying to achieve is to make query  find-all-shapes  to return rectangles as well as squares:  (ns dsl.test
  (:require
    [clara.rules :refer :all]
    ))

(defrecord Shape [center])
(defrecord Rectangle [center width height])
(defrecord Square [center width])


(defquery find-all-shapes
  []
  [?result &lt;- Shape]
  )

(println (-&gt; (mk-session &apos;dsl.test)
           (insert
             (-&gt;Rectangle [1 1] 2 3)
             (-&gt;Square [3 3] 5))
           (fire-rules)
           (query find-all-shapes)))
"><a href="#t1507240690000213" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-05</span> <span class="t" onclick="H(this)">21:58:10</span>               afurmanov </span><span>I am new to Clojure/Clara, and what I am trying to achieve is to make query </span><code>find-all-shapes</code><span> to return rectangles as well as squares: </span><pre>(ns dsl.test
  (:require
    [clara.rules :refer :all]
    ))

(defrecord Shape [center])
(defrecord Rectangle [center width height])
(defrecord Square [center width])


(defquery find-all-shapes
  []
  [?result &lt;- Shape]
  )

(println (-&gt; (mk-session &apos;dsl.test)
           (insert
             (-&gt;Rectangle [1 1] 2 3)
             (-&gt;Square [3 3] 5))
           (fire-rules)
           (query find-all-shapes)))
</pre></div><div id="t1507240763000218" t="2017-10-05 21:59:23 afurmanov From clara documentation I guess I have to make  Shape  an ancestor of  Rectangle  and  Square , but not sure how to do this and wether it is right direction at all."><a href="#t1507240763000218" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-05</span> <span class="t" onclick="H(this)">21:59:23</span>               afurmanov </span><span>From clara documentation I guess I have to make </span><code>Shape</code><span> an ancestor of </span><code>Rectangle</code><span> and </span><code>Square</code><span>, but not sure how to do this and wether it is right direction at all.</span></div><div id="t1507240842000345" t="2017-10-05 22:00:42 mikerod @alex.furmanov Clara’s defaults are to use the  type  and  ancestors  fn’s from Clojure"><a href="#t1507240842000345" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-05</span> <span class="t" onclick="H(this)">22:00:42</span>                 mikerod </span><span>@alex.furmanov Clara’s defaults are to use the </span><code>type</code><span> and </span><code>ancestors</code><span> fn’s from Clojure</span></div><div id="t1507240867000157" t="2017-10-05 22:01:07 mikerod So you can work it into those in several different ways"><a href="#t1507240867000157" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-05</span> <span class="t" onclick="H(this)">22:01:07</span>                 mikerod </span><span>So you can work it into those in several different ways</span></div><div id="t1507240893000197" t="2017-10-05 22:01:33 mikerod I’m not sure if you are using clj or cljs"><a href="#t1507240893000197" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-05</span> <span class="t" onclick="H(this)">22:01:33</span>                 mikerod </span><span>I’m not sure if you are using clj or cljs</span></div><div id="t1507240902000048" t="2017-10-05 22:01:42 afurmanov clj"><a href="#t1507240902000048" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-05</span> <span class="t" onclick="H(this)">22:01:42</span>               afurmanov </span><span>clj</span></div><div id="t1507240963000001" t="2017-10-05 22:02:43 mikerod if you are using clj and like  defrecord  to define your types you could just make a marker interface and use the standard Java type hierarchy
 (definterface Shape)
(defrecord Rectangle [center width height] Shape)
&lt;etc&gt;
"><a href="#t1507240963000001" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-05</span> <span class="t" onclick="H(this)">22:02:43</span>                 mikerod </span><span>if you are using clj and like </span><code>defrecord</code><span> to define your types you could just make a marker interface and use the standard Java type hierarchy
</span><pre>(definterface Shape)
(defrecord Rectangle [center width height] Shape)
&lt;etc&gt;
</pre></div><div id="t1507240978000130" t="2017-10-05 22:02:58 mikerod You could also utilize Clojure’s  derive"><a href="#t1507240978000130" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-05</span> <span class="t" onclick="H(this)">22:02:58</span>                 mikerod </span><span>You could also utilize Clojure’s </span><code>derive</code></div><div id="t1507241010000102" t="2017-10-05 22:03:30 mikerod From your example it isn’t completely clear, but I don’t think you actually have facts that are actually the type  Shape  e.g.  (-&gt;Shape [1 1])  right?"><a href="#t1507241010000102" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-05</span> <span class="t" onclick="H(this)">22:03:30</span>                 mikerod </span><span>From your example it isn’t completely clear, but I don’t think you actually have facts that are actually the type </span><code>Shape</code><span> e.g. </span><code>(-&gt;Shape [1 1])</code><span> right?</span></div><div id="t1507241081000161" t="2017-10-05 22:04:41 afurmanov No, the real case is different: facts are indications of some sort of progress."><a href="#t1507241081000161" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-05</span> <span class="t" onclick="H(this)">22:04:41</span>               afurmanov </span><span>No, the real case is different: facts are indications of some sort of progress.</span></div><div id="t1507241165000256" t="2017-10-05 22:06:05 afurmanov Some  could be as simple as counter, others are pairs [invites, money], other type of progress possible"><a href="#t1507241165000256" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-05</span> <span class="t" onclick="H(this)">22:06:05</span>               afurmanov </span><span>Some  could be as simple as counter, others are pairs [invites, money], other type of progress possible</span></div><div id="t1507241252000390" t="2017-10-05 22:07:32 afurmanov Thanks, @mikerod! The  (definterface ...)  works!"><a href="#t1507241252000390" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-05</span> <span class="t" onclick="H(this)">22:07:32</span>               afurmanov </span><span>Thanks, @mikerod! The </span><code>(definterface ...)</code><span> works!</span></div><div id="t1507241495000264" t="2017-10-05 22:11:35 mikerod No problem. Technical note: for Clojure I would choose  definterface  as the way to mark the record hierarchy just because using  defprotocol  for it’s underlying generated interface is a bit of a gray area. You could get away with  defprotocol  as well though. It has edge cases though and it may be better to avoid."><a href="#t1507241495000264" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-05</span> <span class="t" onclick="H(this)">22:11:35</span>                 mikerod </span><span>No problem. Technical note: for Clojure I would choose </span><code>definterface</code><span> as the way to mark the record hierarchy just because using </span><code>defprotocol</code><span> for it’s underlying generated interface is a bit of a gray area. You could get away with </span><code>defprotocol</code><span> as well though. It has edge cases though and it may be better to avoid.</span></div><div id="t1507241652000003" t="2017-10-05 22:14:12 mikerod If you are still interested, what I mean is, e.g.
 (defprotocol Shape)

(extend-type String Shape)
 
Doesn’t mean that String’s are now considered to be Shape’s by the built-in Clojure type hierarchy. Also, the protocol will leave a var by the name of  Shape  that will clash with the classname produced in your ns and that is confusing as well."><a href="#t1507241652000003" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-05</span> <span class="t" onclick="H(this)">22:14:12</span>                 mikerod </span><span>If you are still interested, what I mean is, e.g.
</span><pre>(defprotocol Shape)

(extend-type String Shape)
</pre><span>
Doesn’t mean that String’s are now considered to be Shape’s by the built-in Clojure type hierarchy. Also, the protocol will leave a var by the name of </span><code>Shape</code><span> that will clash with the classname produced in your ns and that is confusing as well.</span></div><div id="t1507242332000306" t="2017-10-05 22:25:32 afurmanov I did not know that, thanks for explanations!"><a href="#t1507242332000306" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-05</span> <span class="t" onclick="H(this)">22:25:32</span>               afurmanov </span><span>I did not know that, thanks for explanations!</span></div><div id="t1507246888000087" t="2017-10-05 23:41:28 afurmanov How to call interface method in LHS constraint?  (definterface IProgress
  (^int counter [])
  (^int customer [])
  )

(defrecord SpecialIProgress [counter_ customer_ details] IProgress
  (counter [this] (+ counter_ 1))
  (customer [this] 1)
  )

(defquery find-all-i-progresses
  []
;;  [?result &lt;- IProgress (= 1 .customer)] ;; DOES NOT WORK
  [?result &lt;- IProgress]
  )

(println (-&gt; (mk-session &apos;dsl.test)
  (insert
    (-&gt;SpecialIProgress 2 1 &quot;2 out of 3&quot;))
  (fire-rules)
  (query find-all-i-progresses)))
"><a href="#t1507246888000087" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-05</span> <span class="t" onclick="H(this)">23:41:28</span>               afurmanov </span><span>How to call interface method in LHS constraint? </span><pre>(definterface IProgress
  (^int counter [])
  (^int customer [])
  )

(defrecord SpecialIProgress [counter_ customer_ details] IProgress
  (counter [this] (+ counter_ 1))
  (customer [this] 1)
  )

(defquery find-all-i-progresses
  []
;;  [?result &lt;- IProgress (= 1 .customer)] ;; DOES NOT WORK
  [?result &lt;- IProgress]
  )

(println (-&gt; (mk-session &apos;dsl.test)
  (insert
    (-&gt;SpecialIProgress 2 1 &quot;2 out of 3&quot;))
  (fire-rules)
  (query find-all-i-progresses)))
</pre></div><div id="t1507246976000071" t="2017-10-05 23:42:56 afurmanov If I uncomment  [?result &lt;- IProgress (= 1 .customer)]  line I am getting an error: &quot;Unable to resolve symbol: .customer in this context&quot;"><a href="#t1507246976000071" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-05</span> <span class="t" onclick="H(this)">23:42:56</span>               afurmanov </span><span>If I uncomment </span><code>[?result &lt;- IProgress (= 1 .customer)]</code><span> line I am getting an error: &quot;Unable to resolve symbol: .customer in this context&quot;</span></div><div id="t1507247065000223" t="2017-10-05 23:44:25 afurmanov Cannot use  customer  in constraint either, same type of error"><a href="#t1507247065000223" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-05</span> <span class="t" onclick="H(this)">23:44:25</span>               afurmanov </span><span>Cannot use </span><code>customer</code><span> in constraint either, same type of error</span></div><div id="t1507247256000166" t="2017-10-05 23:47:36 afurmanov This:  https://clojuredocs.org/clojure.core/definterface#example-5568aadfe4b03e2132e7d175  is saying that &quot;Using an interface, only the dot form of the method is available with defrecord&quot;"><a href="#t1507247256000166" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-05</span> <span class="t" onclick="H(this)">23:47:36</span>               afurmanov </span><span>This: </span><a href="https://clojuredocs.org/clojure.core/definterface#example-5568aadfe4b03e2132e7d175" target="_blank">https://clojuredocs.org/clojure.core/definterface#example-5568aadfe4b03e2132e7d175</a><span> is saying that &quot;Using an interface, only the dot form of the method is available with defrecord&quot;</span></div><div id="t1507295769000374" t="2017-10-06 13:16:09 zylox .customer  is a method isnt it?"><a href="#t1507295769000374" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">13:16:09</span>                   zylox </span><code>.customer</code><span> is a method isnt it?</span></div><div id="t1507295789000402" t="2017-10-06 13:16:29 zylox have you tried  (= 1 (.customer this))"><a href="#t1507295789000402" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">13:16:29</span>                   zylox </span><span>have you tried </span><code>(= 1 (.customer this))</code></div><div id="t1507295939000052" t="2017-10-06 13:18:59 zylox just tried it with your code and it worked for me"><a href="#t1507295939000052" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">13:18:59</span>                   zylox </span><span>just tried it with your code and it worked for me</span></div><div id="t1507295947000108" t="2017-10-06 13:19:07 zylox @alex.furmanov"><a href="#t1507295947000108" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">13:19:07</span>                   zylox </span><span>@alex.furmanov</span></div><div id="t1507297447000413" t="2017-10-06 13:44:07 huwigs I have a question about accumulators — is there a reason to do aggregation in a clara accumulator vs. in a RHS of something that uses  all  to get the values?"><a href="#t1507297447000413" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">13:44:07</span>                  huwigs </span><span>I have a question about accumulators — is there a reason to do aggregation in a clara accumulator vs. in a RHS of something that uses </span><code>all</code><span> to get the values?</span></div><div id="t1507297502000058" t="2017-10-06 13:45:02 huwigs use case is a value computed from each fact that is then averaged"><a href="#t1507297502000058" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">13:45:02</span>                  huwigs </span><span>use case is a value computed from each fact that is then averaged</span></div><div id="t1507299185000663" t="2017-10-06 14:13:05 afurmanov Thanks @zylox - that is indeed working!"><a href="#t1507299185000663" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">14:13:05</span>               afurmanov </span><span>Thanks @zylox - that is indeed working!</span></div><div id="t1507299286000192" t="2017-10-06 14:14:46 mikerod @steve313 Technically there may be performance advantages in that you are allowing the engine to have potential optimizations to avoid doing unnecessary work. However, some of that would relate to how performant the accumulator implementation is."><a href="#t1507299286000192" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">14:14:46</span>                 mikerod </span><span>@steve313 Technically there may be performance advantages in that you are allowing the engine to have potential optimizations to avoid doing unnecessary work. However, some of that would relate to how performant the accumulator implementation is.</span></div><div id="t1507299302000245" t="2017-10-06 14:15:02 huwigs thanks"><a href="#t1507299302000245" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">14:15:02</span>                  huwigs </span><span>thanks</span></div><div id="t1507299304000099" t="2017-10-06 14:15:04 mikerod Also, you keep things a bit more structured and declarative to pull as much out of the RHS as you can"><a href="#t1507299304000099" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">14:15:04</span>                 mikerod </span><span>Also, you keep things a bit more structured and declarative to pull as much out of the RHS as you can</span></div><div id="t1507299332000327" t="2017-10-06 14:15:32 mikerod However, there are times when the RHS may be justified just due to it being too complicated to try to fit into an accumulator. There is somewhat of a judgement call at times."><a href="#t1507299332000327" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">14:15:32</span>                 mikerod </span><span>However, there are times when the RHS may be justified just due to it being too complicated to try to fit into an accumulator. There is somewhat of a judgement call at times.</span></div><div id="t1507299356000090" t="2017-10-06 14:15:56 mikerod It’s a good question for sure. I’ve seen it come up fairly often."><a href="#t1507299356000090" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">14:15:56</span>                 mikerod </span><span>It’s a good question for sure. I’ve seen it come up fairly often.</span></div><div id="t1507299600000332" t="2017-10-06 14:20:00 huwigs I am still early in the learning curve; think I figured out how to do the LHS relatively simply"><a href="#t1507299600000332" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">14:20:00</span>                  huwigs </span><span>I am still early in the learning curve; think I figured out how to do the LHS relatively simply</span></div><div id="t1507299622000432" t="2017-10-06 14:20:22 mikerod that’s good"><a href="#t1507299622000432" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">14:20:22</span>                 mikerod </span><span>that’s good</span></div><div id="t1507299664000365" t="2017-10-06 14:21:04 mikerod One pattern that is easy to fall into, when new to trying to implement logic via rules, is to have a tendency to put a lot of code in the RHS"><a href="#t1507299664000365" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">14:21:04</span>                 mikerod </span><span>One pattern that is easy to fall into, when new to trying to implement logic via rules, is to have a tendency to put a lot of code in the RHS</span></div><div id="t1507299717000411" t="2017-10-06 14:21:57 mikerod which sort of defeats the purpose. Accumulators are a bit of a more complex case, but in general it is often beneficial to try to keep the RHS as minimal as possible. Typically just “insert some facts”"><a href="#t1507299717000411" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">14:21:57</span>                 mikerod </span><span>which sort of defeats the purpose. Accumulators are a bit of a more complex case, but in general it is often beneficial to try to keep the RHS as minimal as possible. Typically just “insert some facts”</span></div><div id="t1507302583000035" t="2017-10-06 15:09:43 huwigs I have pretty large tables of values… do people find that it’s often necessary to do some “fact” lookups outside of the engine?"><a href="#t1507302583000035" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">15:09:43</span>                  huwigs </span><span>I have pretty large tables of values… do people find that it’s often necessary to do some “fact” lookups outside of the engine?</span></div><div id="t1507305930000696" t="2017-10-06 16:05:30 zylox Not really no, but im not 100% sure what you mean."><a href="#t1507305930000696" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">16:05:30</span>                   zylox </span><span>Not really no, but im not 100% sure what you mean.</span></div><div id="t1507306748000171" t="2017-10-06 16:19:08 huwigs Well, there are facts related to combinations of values (i.e. if a person is female, 18, and single, the value of some new fact should be X, but if they are male, 29, and married, the value of some new fact should be Y) — seems like I could use unification and declare each one of those mappings to be facts (-&gt;MyValue :female 18 :single X), (-&gt;MyValue :male 29 :married Y)"><a href="#t1507306748000171" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">16:19:08</span>                  huwigs </span><span>Well, there are facts related to combinations of values (i.e. if a person is female, 18, and single, the value of some new fact should be X, but if they are male, 29, and married, the value of some new fact should be Y) — seems like I could use unification and declare each one of those mappings to be facts (-&gt;MyValue :female 18 :single X), (-&gt;MyValue :male 29 :married Y)</span></div><div id="t1507306777000420" t="2017-10-06 16:19:37 huwigs or i could just look up those values in an RHS that takes a Person fact"><a href="#t1507306777000420" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">16:19:37</span>                  huwigs </span><span>or i could just look up those values in an RHS that takes a Person fact</span></div><div id="t1507306799000017" t="2017-10-06 16:19:59 dadair Couldn&apos;t you use a DSL to parse your table into rules?"><a href="#t1507306799000017" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">16:19:59</span>                  dadair </span><span>Couldn&apos;t you use a DSL to parse your table into rules?</span></div><div id="t1507306845000440" t="2017-10-06 16:20:45 dadair Or you could have condition facts"><a href="#t1507306845000440" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">16:20:45</span>                  dadair </span><span>Or you could have condition facts</span></div><div id="t1507306846000324" t="2017-10-06 16:20:46 huwigs I’m sure I could generate rules from the table values but I’m not sure if that is a good approach"><a href="#t1507306846000324" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">16:20:46</span>                  huwigs </span><span>I’m sure I could generate rules from the table values but I’m not sure if that is a good approach</span></div><div id="t1507306857000459" t="2017-10-06 16:20:57 huwigs some tables have thousands or tens of thousands of rows"><a href="#t1507306857000459" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">16:20:57</span>                  huwigs </span><span>some tables have thousands or tens of thousands of rows</span></div><div id="t1507312053000102" t="2017-10-06 17:47:33 mikerod @steve313 I am trying to understand the situation still. It isn’t clear to me what a row of this table represents or what information it has"><a href="#t1507312053000102" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">17:47:33</span>                 mikerod </span><span>@steve313 I am trying to understand the situation still. It isn’t clear to me what a row of this table represents or what information it has</span></div><div id="t1507312057000081" t="2017-10-06 17:47:37 mikerod any dummy example?"><a href="#t1507312057000081" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">17:47:37</span>                 mikerod </span><span>any dummy example?</span></div><div id="t1507312161000224" t="2017-10-06 17:49:21 huwigs The table itself is structured like (k1, k2, k3, v1, v2, v3, v4, v5)… imagine something like that"><a href="#t1507312161000224" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">17:49:21</span>                  huwigs </span><span>The table itself is structured like (k1, k2, k3, v1, v2, v3, v4, v5)… imagine something like that</span></div><div id="t1507312167000348" t="2017-10-06 17:49:27 huwigs er, like this:"><a href="#t1507312167000348" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">17:49:27</span>                  huwigs </span><span>er, like this:</span></div><div id="t1507312170000473" t="2017-10-06 17:49:30 huwigs  `"><a href="#t1507312170000473" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">17:49:30</span>                  huwigs </span><code></code><span>`</span></div><div id="t1507312312000304" t="2017-10-06 17:51:52 huwigs For many many permutations of k1,k2,k3"><a href="#t1507312312000304" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">17:51:52</span>                  huwigs </span><span>For many many permutations of k1,k2,k3</span></div><div id="t1507312363000607" t="2017-10-06 17:52:43 huwigs not sure if that snippet came through? slack saying i ran out of space"><a href="#t1507312363000607" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">17:52:43</span>                  huwigs </span><span>not sure if that snippet came through? slack saying i ran out of space</span></div><div id="t1507312374000218" t="2017-10-06 17:52:54 huwigs k1  k2  k3  v1  v2  v3  v4  v5  v6  v7  v8
17  F   S   2.1647  3.8128  2.9743  1.4490  2.7630  0.3837  3.4900  1.1400  3.1700
18  F   S   2.8955  3.4350  1.4777  1.4490  2.4809  0.9656  2.9640  1.1058  2.6980
19  F   S   2.2341  2.7573  1.3664  1.4490  2.2500  0.8800  2.5947  1.1058  2.3622
20  F   S   1.8131  2.1821  1.9299  1.4490  1.7000  0.8900  2.2692  1.0944  2.0646
21  F   S   1.7448  2.0645  1.9294  1.4490  1.6500  0.8800  2.2176  1.1286  2.0196
"><a href="#t1507312374000218" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">17:52:54</span>                  huwigs </span><pre>k1  k2  k3  v1  v2  v3  v4  v5  v6  v7  v8
17  F   S   2.1647  3.8128  2.9743  1.4490  2.7630  0.3837  3.4900  1.1400  3.1700
18  F   S   2.8955  3.4350  1.4777  1.4490  2.4809  0.9656  2.9640  1.1058  2.6980
19  F   S   2.2341  2.7573  1.3664  1.4490  2.2500  0.8800  2.5947  1.1058  2.3622
20  F   S   1.8131  2.1821  1.9299  1.4490  1.7000  0.8900  2.2692  1.0944  2.0646
21  F   S   1.7448  2.0645  1.9294  1.4490  1.6500  0.8800  2.2176  1.1286  2.0196
</pre></div><div id="t1507312421000331" t="2017-10-06 17:53:41 huwigs now, in the rules engine we have facts that can provide (k1, k2, k3) values and want to know what a v1 value for that combination is"><a href="#t1507312421000331" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">17:53:41</span>                  huwigs </span><span>now, in the rules engine we have facts that can provide (k1, k2, k3) values and want to know what a v1 value for that combination is</span></div><div id="t1507312461000208" t="2017-10-06 17:54:21 huwigs right now i just looked it up in a map i read from the file in an rhs"><a href="#t1507312461000208" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">17:54:21</span>                  huwigs </span><span>right now i just looked it up in a map i read from the file in an rhs</span></div><div id="t1507312465000184" t="2017-10-06 17:54:25 mikerod ok, that does make the idea clearer to me to think about"><a href="#t1507312465000184" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">17:54:25</span>                 mikerod </span><span>ok, that does make the idea clearer to me to think about</span></div><div id="t1507312467000741" t="2017-10-06 17:54:27 huwigs but in theory those could all be facts"><a href="#t1507312467000741" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">17:54:27</span>                  huwigs </span><span>but in theory those could all be facts</span></div><div id="t1507312476000432" t="2017-10-06 17:54:36 mikerod You could put the table as a fact"><a href="#t1507312476000432" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">17:54:36</span>                 mikerod </span><span>You could put the table as a fact</span></div><div id="t1507312489000301" t="2017-10-06 17:54:49 mikerod It’s still a bit odd since the table would be big of course"><a href="#t1507312489000301" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">17:54:49</span>                 mikerod </span><span>It’s still a bit odd since the table would be big of course</span></div><div id="t1507312538000018" t="2017-10-06 17:55:38 mikerod However, I’m not too sure it would even be an issue to just put each row in as a fact"><a href="#t1507312538000018" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">17:55:38</span>                 mikerod </span><span>However, I’m not too sure it would even be an issue to just put each row in as a fact</span></div><div id="t1507312550000179" t="2017-10-06 17:55:50 mikerod and then do a join between Person to one of those rows based on the k-criteria"><a href="#t1507312550000179" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">17:55:50</span>                 mikerod </span><span>and then do a join between Person to one of those rows based on the k-criteria</span></div><div id="t1507312557000248" t="2017-10-06 17:55:57 mikerod From the looks of it, these would be  =  based joins"><a href="#t1507312557000248" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">17:55:57</span>                 mikerod </span><span>From the looks of it, these would be </span><code>=</code><span> based joins</span></div><div id="t1507312567000513" t="2017-10-06 17:56:07 mikerod Which are going to be the most efficient type in the engine too"><a href="#t1507312567000513" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">17:56:07</span>                 mikerod </span><span>Which are going to be the most efficient type in the engine too</span></div><div id="t1507312593000082" t="2017-10-06 17:56:33 huwigs Well, I am ignoring the &lt;lowest and &gt;highest for the first column"><a href="#t1507312593000082" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">17:56:33</span>                  huwigs </span><span>Well, I am ignoring the &lt;lowest and &gt;highest for the first column</span></div><div id="t1507312609000794" t="2017-10-06 17:56:49 mikerod Clara will automatically hash on binding keys and use that hash-based lookup for equal-based joins"><a href="#t1507312609000794" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">17:56:49</span>                 mikerod </span><span>Clara will automatically hash on binding keys and use that hash-based lookup for equal-based joins</span></div><div id="t1507312623000203" t="2017-10-06 17:57:03 huwigs there are values that aren’t strict equality based for that. I can probably hack it so the engine would only use equality based"><a href="#t1507312623000203" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">17:57:03</span>                  huwigs </span><span>there are values that aren’t strict equality based for that. I can probably hack it so the engine would only use equality based</span></div><div id="t1507312654000373" t="2017-10-06 17:57:34 mikerod So if the majority are equal based you may be fine still. Not completely sure though."><a href="#t1507312654000373" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">17:57:34</span>                 mikerod </span><span>So if the majority are equal based you may be fine still. Not completely sure though.</span></div><div id="t1507312666000383" t="2017-10-06 17:57:46 huwigs yeah the comparison ones are edge cases"><a href="#t1507312666000383" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">17:57:46</span>                  huwigs </span><span>yeah the comparison ones are edge cases</span></div><div id="t1507312666000415" t="2017-10-06 17:57:46 mikerod However, if it is like 10K sort of facts doing  &lt;  comparisons"><a href="#t1507312666000415" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">17:57:46</span>                 mikerod </span><span>However, if it is like 10K sort of facts doing </span><code>&lt;</code><span> comparisons</span></div><div id="t1507312675000136" t="2017-10-06 17:57:55 mikerod I’m not convinced you’d see much perf issues anwyasy"><a href="#t1507312675000136" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">17:57:55</span>                 mikerod </span><span>I’m not convinced you’d see much perf issues anwyasy</span></div><div id="t1507312712000473" t="2017-10-06 17:58:32 mikerod It may be a good idea to use a different fact type"><a href="#t1507312712000473" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">17:58:32</span>                 mikerod </span><span>It may be a good idea to use a different fact type</span></div><div id="t1507312717000377" t="2017-10-06 17:58:37 mikerod for the ones that aren’t equal based"><a href="#t1507312717000377" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">17:58:37</span>                 mikerod </span><span>for the ones that aren’t equal based</span></div><div id="t1507312725000064" t="2017-10-06 17:58:45 mikerod may help partition up the network"><a href="#t1507312725000064" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">17:58:45</span>                 mikerod </span><span>may help partition up the network</span></div><div id="t1507312752000393" t="2017-10-06 17:59:12 mikerod some of this is just high-level talk to. so may be too vague for you to go off of"><a href="#t1507312752000393" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">17:59:12</span>                 mikerod </span><span>some of this is just high-level talk to. so may be too vague for you to go off of</span></div><div id="t1507312806000416" t="2017-10-06 18:00:06 mikerod but at a really high level"><a href="#t1507312806000416" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">18:00:06</span>                 mikerod </span><span>but at a really high level</span></div><div id="t1507312814000116" t="2017-10-06 18:00:14 mikerod say you have 10K people - call that P"><a href="#t1507312814000116" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">18:00:14</span>                 mikerod </span><span>say you have 10K people - call that P</span></div><div id="t1507312826000697" t="2017-10-06 18:00:26 mikerod and 100K rows that are eq join capable - call that E"><a href="#t1507312826000697" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">18:00:26</span>                 mikerod </span><span>and 100K rows that are eq join capable - call that E</span></div><div id="t1507312844000310" t="2017-10-06 18:00:44 mikerod Then only 100 rows that are more expensive than eq - call it F"><a href="#t1507312844000310" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">18:00:44</span>                 mikerod </span><span>Then only 100 rows that are more expensive than eq - call it F</span></div><div id="t1507312871000115" t="2017-10-06 18:01:11 mikerod You’ll have the P joining to E part will all be done with hash-based lookups/joins"><a href="#t1507312871000115" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">18:01:11</span>                 mikerod </span><span>You’ll have the P joining to E part will all be done with hash-based lookups/joins</span></div><div id="t1507312886000160" t="2017-10-06 18:01:26 mikerod so you’ll just have P x F comparisons on the non-eq, “more expensive” join tests"><a href="#t1507312886000160" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">18:01:26</span>                 mikerod </span><span>so you’ll just have P x F comparisons on the non-eq, “more expensive” join tests</span></div><div id="t1507312898000637" t="2017-10-06 18:01:38 mikerod So the P, E factor is “constant”"><a href="#t1507312898000637" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">18:01:38</span>                 mikerod </span><span>So the P, E factor is “constant”</span></div><div id="t1507312926000266" t="2017-10-06 18:02:06 mikerod But the non-eq-based table rows I’d put under a differnet fact type since that would ensure partitioning into groups like this"><a href="#t1507312926000266" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">18:02:06</span>                 mikerod </span><span>But the non-eq-based table rows I’d put under a differnet fact type since that would ensure partitioning into groups like this</span></div><div id="t1507312978000177" t="2017-10-06 18:02:58 mikerod ignore my “more expensive” phrase"><a href="#t1507312978000177" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">18:02:58</span>                 mikerod </span><span>ignore my “more expensive” phrase</span></div><div id="t1507312983000026" t="2017-10-06 18:03:03 huwigs so if we have a fact type for the E and a fact type for the F cases"><a href="#t1507312983000026" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">18:03:03</span>                  huwigs </span><span>so if we have a fact type for the E and a fact type for the F cases</span></div><div id="t1507312986000198" t="2017-10-06 18:03:06 mikerod not that relevant, it’s more about the multiplier"><a href="#t1507312986000198" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">18:03:06</span>                 mikerod </span><span>not that relevant, it’s more about the multiplier</span></div><div id="t1507312999000259" t="2017-10-06 18:03:19 huwigs would there be two rules, one joining PxE and one joining PxF ?"><a href="#t1507312999000259" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">18:03:19</span>                  huwigs </span><span>would there be two rules, one joining PxE and one joining PxF ?</span></div><div id="t1507313012000001" t="2017-10-06 18:03:32 mikerod yeah"><a href="#t1507313012000001" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">18:03:32</span>                 mikerod </span><span>yeah</span></div><div id="t1507313012000475" t="2017-10-06 18:03:32 huwigs or use  :or  in one rule?"><a href="#t1507313012000475" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">18:03:32</span>                  huwigs </span><span>or use </span><code>:or</code><span> in one rule?</span></div><div id="t1507313018000474" t="2017-10-06 18:03:38 mikerod I’d probably do 2 rules"><a href="#t1507313018000474" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">18:03:38</span>                 mikerod </span><span>I’d probably do 2 rules</span></div><div id="t1507313034000189" t="2017-10-06 18:03:54 mikerod :or  may be able to get you equivalent, but it may just be less readable"><a href="#t1507313034000189" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">18:03:54</span>                 mikerod </span><code>:or</code><span> may be able to get you equivalent, but it may just be less readable</span></div><div id="t1507313040000345" t="2017-10-06 18:04:00 huwigs right"><a href="#t1507313040000345" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">18:04:00</span>                  huwigs </span><span>right</span></div><div id="t1507313041000459" t="2017-10-06 18:04:01 mikerod or more confusing"><a href="#t1507313041000459" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">18:04:01</span>                 mikerod </span><span>or more confusing</span></div><div id="t1507313049000608" t="2017-10-06 18:04:09 mikerod :or  is for the most part “syntax sugar”"><a href="#t1507313049000608" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">18:04:09</span>                 mikerod </span><code>:or</code><span> is for the most part “syntax sugar”</span></div><div id="t1507313057000362" t="2017-10-06 18:04:17 mikerod it isn’t short-circuiting"><a href="#t1507313057000362" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">18:04:17</span>                 mikerod </span><span>it isn’t short-circuiting</span></div><div id="t1507313063000537" t="2017-10-06 18:04:23 huwigs OK"><a href="#t1507313063000537" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">18:04:23</span>                  huwigs </span><span>OK</span></div><div id="t1507313068000120" t="2017-10-06 18:04:28 mikerod it splits at that point and all the data flow goes down both “branches” of logic"><a href="#t1507313068000120" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">18:04:28</span>                 mikerod </span><span>it splits at that point and all the data flow goes down both “branches” of logic</span></div><div id="t1507313109000620" t="2017-10-06 18:05:09 mikerod the only reason I’d use  :or  in a case like this is something like"><a href="#t1507313109000620" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">18:05:09</span>                 mikerod </span><span>the only reason I’d use </span><code>:or</code><span> in a case like this is something like</span></div><div id="t1507313188000666" t="2017-10-06 18:06:28 mikerod (r/defrule tester
  [A (= ?id id)]
  [B (= ?id id)]
  [:or
   &lt;your P,E and P,F joins here using the result from A,B above&gt;]
=&gt;
&lt;etc&gt;)
   
"><a href="#t1507313188000666" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">18:06:28</span>                 mikerod </span><pre>(r/defrule tester
  [A (= ?id id)]
  [B (= ?id id)]
  [:or
   &lt;your P,E and P,F joins here using the result from A,B above&gt;]
=&gt;
&lt;etc&gt;)
   
</pre></div><div id="t1507313199000193" t="2017-10-06 18:06:39 mikerod Meaning if you had some more conditions needed by both joins"><a href="#t1507313199000193" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">18:06:39</span>                 mikerod </span><span>Meaning if you had some more conditions needed by both joins</span></div><div id="t1507313226000150" t="2017-10-06 18:07:06 mikerod Using  :or  above makes it so the network will share the work done in the prior conditions in the rule before the  :or .  So “node sharing”, as it is called in Rete terminology."><a href="#t1507313226000150" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">18:07:06</span>                 mikerod </span><span>Using </span><code>:or</code><span> above makes it so the network will share the work done in the prior conditions in the rule before the </span><code>:or</code><span>.  So “node sharing”, as it is called in Rete terminology.</span></div><div id="t1507313255000210" t="2017-10-06 18:07:35 mikerod If you do it in separate rules, there still may be node sharing though. Clara tries to detect duplicate conditions."><a href="#t1507313255000210" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">18:07:35</span>                 mikerod </span><span>If you do it in separate rules, there still may be node sharing though. Clara tries to detect duplicate conditions.</span></div><div id="t1507313262000332" t="2017-10-06 18:07:42 huwigs OK"><a href="#t1507313262000332" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">18:07:42</span>                  huwigs </span><span>OK</span></div><div id="t1507313272000556" t="2017-10-06 18:07:52 huwigs It probably reads better as multiple rules almost always?"><a href="#t1507313272000556" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">18:07:52</span>                  huwigs </span><span>It probably reads better as multiple rules almost always?</span></div><div id="t1507313273000122" t="2017-10-06 18:07:53 mikerod Just pointing out times when  :or  may be nice. It also lets you not write stuff twice."><a href="#t1507313273000122" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">18:07:53</span>                 mikerod </span><span>Just pointing out times when </span><code>:or</code><span> may be nice. It also lets you not write stuff twice.</span></div><div id="t1507313286000502" t="2017-10-06 18:08:06 mikerod I tend to say avoid  :or  unless you have noticeable/annoying duplication"><a href="#t1507313286000502" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">18:08:06</span>                 mikerod </span><span>I tend to say avoid </span><code>:or</code><span> unless you have noticeable/annoying duplication</span></div><div id="t1507313305000222" t="2017-10-06 18:08:25 mikerod of previous conditions before the  :or  branching"><a href="#t1507313305000222" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">18:08:25</span>                 mikerod </span><span>of previous conditions before the </span><code>:or</code><span> branching</span></div><div id="t1507313362000360" t="2017-10-06 18:09:22 mikerod and back on your topic"><a href="#t1507313362000360" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">18:09:22</span>                 mikerod </span><span>and back on your topic</span></div><div id="t1507313372000024" t="2017-10-06 18:09:32 mikerod if you have 10-100K rows in a table, I may think inserting all these facts is fine"><a href="#t1507313372000024" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">18:09:32</span>                 mikerod </span><span>if you have 10-100K rows in a table, I may think inserting all these facts is fine</span></div><div id="t1507313386000159" t="2017-10-06 18:09:46 mikerod if it were like 1 million rows, then maybe be a bit more concerned"><a href="#t1507313386000159" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">18:09:46</span>                 mikerod </span><span>if it were like 1 million rows, then maybe be a bit more concerned</span></div><div id="t1507313426000598" t="2017-10-06 18:10:26 mikerod and I’d still probably try it and profile/ take note of the runtime degradation before trying a non-fact based approach"><a href="#t1507313426000598" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">18:10:26</span>                 mikerod </span><span>and I’d still probably try it and profile/ take note of the runtime degradation before trying a non-fact based approach</span></div><div id="t1507313520000707" t="2017-10-06 18:12:00 mikerod Also, it’s good to be aware of your “hot spots”. A rule like
 (r/defrule joining
  [P (= ?age age)]
  [F (&lt; ?age (:threshold this))]
=&gt;
&lt;etc&gt;)
 
Is going to evaluate  (&lt; ?age (:threshold this))    (number of P) X (number of F) times"><a href="#t1507313520000707" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">18:12:00</span>                 mikerod </span><span>Also, it’s good to be aware of your “hot spots”. A rule like
</span><pre>(r/defrule joining
  [P (= ?age age)]
  [F (&lt; ?age (:threshold this))]
=&gt;
&lt;etc&gt;)
</pre><span>
Is going to evaluate </span><code>(&lt; ?age (:threshold this))</code><span>   (number of P) X (number of F) times</span></div><div id="t1507313542000307" t="2017-10-06 18:12:22 mikerod so if that is a big number, then it becomes a hot spot and you may end up just being able to improve whatever test is done tehre"><a href="#t1507313542000307" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">18:12:22</span>                 mikerod </span><span>so if that is a big number, then it becomes a hot spot and you may end up just being able to improve whatever test is done tehre</span></div><div id="t1507313551000248" t="2017-10-06 18:12:31 huwigs OK. So if many of these facts would be reused from case to case, is the right thing to do to load the standard facts (from the tables above), keep around a binding to the initial session, and then for each subsequent set of queries, reuse the initial session?"><a href="#t1507313551000248" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">18:12:31</span>                  huwigs </span><span>OK. So if many of these facts would be reused from case to case, is the right thing to do to load the standard facts (from the tables above), keep around a binding to the initial session, and then for each subsequent set of queries, reuse the initial session?</span></div><div id="t1507313560000341" t="2017-10-06 18:12:40 mikerod Or eliminate  P  facts that you know won’t match  F  (because they match something else with eq already perhaps)."><a href="#t1507313560000341" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">18:12:40</span>                 mikerod </span><span>Or eliminate </span><code>P</code><span> facts that you know won’t match </span><code>F</code><span> (because they match something else with eq already perhaps).</span></div><div id="t1507313572000300" t="2017-10-06 18:12:52 huwigs assuming that works on account of persistent data structures etc., just don’t want to load stuff from files many times"><a href="#t1507313572000300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">18:12:52</span>                  huwigs </span><span>assuming that works on account of persistent data structures etc., just don’t want to load stuff from files many times</span></div><div id="t1507313590000321" t="2017-10-06 18:13:10 mikerod I think what you said makes sense"><a href="#t1507313590000321" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">18:13:10</span>                 mikerod </span><span>I think what you said makes sense</span></div><div id="t1507313595000083" t="2017-10-06 18:13:15 mikerod as long as your rules aren’t changing"><a href="#t1507313595000083" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">18:13:15</span>                 mikerod </span><span>as long as your rules aren’t changing</span></div><div id="t1507313599000764" t="2017-10-06 18:13:19 huwigs nope"><a href="#t1507313599000764" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">18:13:19</span>                  huwigs </span><span>nope</span></div><div id="t1507313616000459" t="2017-10-06 18:13:36 mikerod you can reuse an “initially loaded” working memory state for those rules for different runs of new facts"><a href="#t1507313616000459" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">18:13:36</span>                 mikerod </span><span>you can reuse an “initially loaded” working memory state for those rules for different runs of new facts</span></div><div id="t1507313634000285" t="2017-10-06 18:13:54 mikerod definitely a big win of Clara’s persistent, immutable working memory approach"><a href="#t1507313634000285" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">18:13:54</span>                 mikerod </span><span>definitely a big win of Clara’s persistent, immutable working memory approach</span></div><div id="t1507323404000043" t="2017-10-06 20:56:44 souenzzo There is some way to dedup on insert?
Example, if I insert  (insert! ^{:type :foo}{:foo 33})  and then  (insert! ^{:type :foo}{:foo 33}) , then querty all  :foo  get just one?"><a href="#t1507323404000043" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">20:56:44</span>                souenzzo </span><span>There is some way to dedup on insert?
Example, if I insert </span><code>(insert! ^{:type :foo}{:foo 33})</code><span> and then </span><code>(insert! ^{:type :foo}{:foo 33})</code><span>, then querty all </span><code>:foo</code><span> get just one?</span></div><div id="t1507323471000041" t="2017-10-06 20:57:51 souenzzo Yes, I know that  (= ^{:type :foo}{} ^{:type :bar}{}) ;=&gt; true"><a href="#t1507323471000041" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">20:57:51</span>                souenzzo </span><span>Yes, I know that </span><code>(= ^{:type :foo}{} ^{:type :bar}{}) ;=&gt; true</code></div><div id="t1507323660000050" t="2017-10-06 21:01:00 wparker @souenzzo if you’re using queries, you could put an accumulator or an :exists on your query conditions to remove duplication in your results"><a href="#t1507323660000050" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">21:01:00</span>                 wparker </span><span>@souenzzo if you’re using queries, you could put an accumulator or an :exists on your query conditions to remove duplication in your results</span></div><div id="t1507323996000487" t="2017-10-06 21:06:36 souenzzo It&apos;s not about query... It&apos;s about session
Duplicated facts are fire&apos;ing rules in a loop.."><a href="#t1507323996000487" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">21:06:36</span>                souenzzo </span><span>It&apos;s not about query... It&apos;s about session
Duplicated facts are fire&apos;ing rules in a loop..</span></div><div id="t1507324237000106" t="2017-10-06 21:10:37 mikerod @souenzzo one approach I’ve done"><a href="#t1507324237000106" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">21:10:37</span>                 mikerod </span><span>@souenzzo one approach I’ve done</span></div><div id="t1507324243000298" t="2017-10-06 21:10:43 mikerod introduce an “intermediate fact”"><a href="#t1507324243000298" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">21:10:43</span>                 mikerod </span><span>introduce an “intermediate fact”</span></div><div id="t1507324247000040" t="2017-10-06 21:10:47 mikerod that can be duplicated"><a href="#t1507324247000040" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">21:10:47</span>                 mikerod </span><span>that can be duplicated</span></div><div id="t1507324261000384" t="2017-10-06 21:11:01 mikerod then have a rule that uses an accumulator  acc/all  on those possible duplicates"><a href="#t1507324261000384" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">21:11:01</span>                 mikerod </span><span>then have a rule that uses an accumulator </span><code>acc/all</code><span> on those possible duplicates</span></div><div id="t1507324275000204" t="2017-10-06 21:11:15 mikerod and inserts only one in the presence of any number of them"><a href="#t1507324275000204" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">21:11:15</span>                 mikerod </span><span>and inserts only one in the presence of any number of them</span></div><div id="t1507324365000095" t="2017-10-06 21:12:45 souenzzo Got it. I will try;"><a href="#t1507324365000095" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">21:12:45</span>                souenzzo </span><span>Got it. I will try;</span></div><div id="t1507324429000029" t="2017-10-06 21:13:49 mikerod Assuming you want to go from  X  facts to  B  facts, but do not want duplicates of  B  “downstream”:

 (r/defrule a-rule
  [X (= ?v v)]
  =&gt;
  (r/insert! (-&gt;Intermediate ?v)))

(r/defrule aggregate-rule
  [?all &lt;- (acc/all) :from [Intermediate]]
  [:test (seq ?all)]
  =&gt;
  ;; Assume everything in `?all` is `=` otherwise do some merge, etc
  (r/insert! (map-&gt;B (first ?all))))

(r/defrule b-rule
  [B]
  =&gt;
  &lt;etc&gt;)
"><a href="#t1507324429000029" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">21:13:49</span>                 mikerod </span><span>Assuming you want to go from </span><code>X</code><span> facts to </span><code>B</code><span> facts, but do not want duplicates of </span><code>B</code><span> “downstream”:

</span><pre>(r/defrule a-rule
  [X (= ?v v)]
  =&gt;
  (r/insert! (-&gt;Intermediate ?v)))

(r/defrule aggregate-rule
  [?all &lt;- (acc/all) :from [Intermediate]]
  [:test (seq ?all)]
  =&gt;
  ;; Assume everything in `?all` is `=` otherwise do some merge, etc
  (r/insert! (map-&gt;B (first ?all))))

(r/defrule b-rule
  [B]
  =&gt;
  &lt;etc&gt;)
</pre></div><div id="t1507553984000109" t="2017-10-09 12:59:44 souenzzo This method is not working because I need  acc  both  Intermediate  and &apos;B`, to ensure that there are no repeated elements"><a href="#t1507553984000109" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-09</span> <span class="t" onclick="H(this)">12:59:44</span>                     souenzzo </span><span>This method is not working because I need </span><code>acc</code><span> both </span><code>Intermediate</code><span> and &apos;B`, to ensure that there are no repeated elements</span></div><div id="t1507324507000006" t="2017-10-06 21:15:07 mikerod I’d use better naming though  😛"><a href="#t1507324507000006" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-06</span> <span class="t" onclick="H(this)">21:15:07</span>                 mikerod </span><span>I’d use better naming though </span><b>😛</b></div><div id="t1507559700000221" t="2017-10-09 14:35:00 zylox why. no amount of intermediates can insert more than one B under this pattern. If you are saying you want to insert B only if there is only distinct Intermediates, you will need to use a smarter accumulator."><a href="#t1507559700000221" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-09</span> <span class="t" onclick="H(this)">14:35:00</span>                   zylox </span><span>why. no amount of intermediates can insert more than one B under this pattern. If you are saying you want to insert B only if there is only distinct Intermediates, you will need to use a smarter accumulator.</span></div><div id="t1507753272000278" t="2017-10-11 20:21:12 devn Who&apos;s gonna be at the conj?"><a href="#t1507753272000278" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-11</span> <span class="t" onclick="H(this)">20:21:12</span>                    devn </span><span>Who&apos;s gonna be at the conj?</span></div><div id="t1507753281000238" t="2017-10-11 20:21:21 devn Anyone?"><a href="#t1507753281000238" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-11</span> <span class="t" onclick="H(this)">20:21:21</span>                    devn </span><span>Anyone?</span></div><div id="t1507753461000143" t="2017-10-11 20:24:21 mikerod @devn not me this time around unfortunately"><a href="#t1507753461000143" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-11</span> <span class="t" onclick="H(this)">20:24:21</span>                 mikerod </span><span>@devn not me this time around unfortunately</span></div><div id="t1507753470000130" t="2017-10-11 20:24:30 devn ah, too bad"><a href="#t1507753470000130" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-11</span> <span class="t" onclick="H(this)">20:24:30</span>                    devn </span><span>ah, too bad</span></div><div id="t1507753471000345" t="2017-10-11 20:24:31 mikerod I’m jealous too. An anniversary"><a href="#t1507753471000345" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-11</span> <span class="t" onclick="H(this)">20:24:31</span>                 mikerod </span><span>I’m jealous too. An anniversary</span></div><div id="t1507753476000020" t="2017-10-11 20:24:36 mikerod and lots of good speakers"><a href="#t1507753476000020" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-11</span> <span class="t" onclick="H(this)">20:24:36</span>                 mikerod </span><span>and lots of good speakers</span></div><div id="t1507753478000200" t="2017-10-11 20:24:38 devn there wil be cake"><a href="#t1507753478000200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-11</span> <span class="t" onclick="H(this)">20:24:38</span>                    devn </span><span>there wil be cake</span></div><div id="t1507753480000547" t="2017-10-11 20:24:40 devn will*"><a href="#t1507753480000547" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-11</span> <span class="t" onclick="H(this)">20:24:40</span>                    devn </span><span>will*</span></div><div id="t1507753489000156" t="2017-10-11 20:24:49 mikerod I’ve never been on a cake one"><a href="#t1507753489000156" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-11</span> <span class="t" onclick="H(this)">20:24:49</span>                 mikerod </span><span>I’ve never been on a cake one</span></div><div id="t1507769970000267" t="2017-10-12 00:59:30 ryanbrush Unfortunately I&apos;m not able to make it, either. Too many things going on this fall."><a href="#t1507769970000267" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-12</span> <span class="t" onclick="H(this)">00:59:30</span>               ryanbrush </span><span>Unfortunately I&apos;m not able to make it, either. Too many things going on this fall.</span></div><div id="t1507885350000191" t="2017-10-13 09:02:30 mmer Is there a way to change facts that have been inserted - what I want to do is to change the Records to include more information as it becomes available."><a href="#t1507885350000191" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-13</span> <span class="t" onclick="H(this)">09:02:30</span>                    mmer </span><span>Is there a way to change facts that have been inserted - what I want to do is to change the Records to include more information as it becomes available.</span></div><div id="t1507898622000499" t="2017-10-13 12:43:42 mmer Another question - is it possible to reference the name of a rule in a rule?"><a href="#t1507898622000499" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-13</span> <span class="t" onclick="H(this)">12:43:42</span>                    mmer </span><span>Another question - is it possible to reference the name of a rule in a rule?</span></div><div id="t1507908231000225" t="2017-10-13 15:23:51 zylox as for the first question, you would want to retract the original and insert the newer one. This will require some logic outside of the rules network. Clara assumes immutability in its facts im pretty sure."><a href="#t1507908231000225" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-13</span> <span class="t" onclick="H(this)">15:23:51</span>                   zylox </span><span>as for the first question, you would want to retract the original and insert the newer one. This will require some logic outside of the rules network. Clara assumes immutability in its facts im pretty sure.</span></div><div id="t1507908343000121" t="2017-10-13 15:25:43 zylox second one: What are you wanting to do with a rule reference? You should be relying on the consequences of the right hand side of said rule on the state of the facts in the session to infer things. Maybe if you had a more specific case of what you are trying to do i can provide more specific advice there."><a href="#t1507908343000121" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-13</span> <span class="t" onclick="H(this)">15:25:43</span>                   zylox </span><span>second one: What are you wanting to do with a rule reference? You should be relying on the consequences of the right hand side of said rule on the state of the facts in the session to infer things. Maybe if you had a more specific case of what you are trying to do i can provide more specific advice there.</span></div><div id="t1507909861000513" t="2017-10-13 15:51:01 mikerod &gt; as for the first question, you would want to retract the original and insert the newer one. This will require some logic outside of the rules network. Clara assumes immutability in its facts im pretty sure.
Yeah, I think that is common. If you aren’t concerned with a constantly growing working memory, i.e. append-only, you can get by with doing it all in rules"><a href="#t1507909861000513" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-13</span> <span class="t" onclick="H(this)">15:51:01</span>                 mikerod </span><span>&gt; as for the first question, you would want to retract the original and insert the newer one. This will require some logic outside of the rules network. Clara assumes immutability in its facts im pretty sure.
Yeah, I think that is common. If you aren’t concerned with a constantly growing working memory, i.e. append-only, you can get by with doing it all in rules</span></div><div id="t1507909881000317" t="2017-10-13 15:51:21 mikerod It seems to me that Clara should offer something to better support the “update” pattern"><a href="#t1507909881000317" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-13</span> <span class="t" onclick="H(this)">15:51:21</span>                 mikerod </span><span>It seems to me that Clara should offer something to better support the “update” pattern</span></div><div id="t1507910005000089" t="2017-10-13 15:53:25 mikerod Something like:
 (r/defrule update-fact
  [?current &lt;- FactType (= ?id id)]
  [?update &lt;- (acc/max :timestamp) :from [UpdateFact (= ?id id)]]
  =&gt;
  (r/retract! ?current) ;; or if you wanted to remove updates altogether - with no accumulator on LHS `(apply r/retract! [?current ?update])`
  (r/insert! (do-update ?current ?update)))

 

To me seems like a pretty natural thing to do, but it violates truth maintenance since the supporting facts  ?current  and  ?update  are retracted that logically supported the  r/insert!"><a href="#t1507910005000089" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-13</span> <span class="t" onclick="H(this)">15:53:25</span>                 mikerod </span><span>Something like:
</span><pre>(r/defrule update-fact
  [?current &lt;- FactType (= ?id id)]
  [?update &lt;- (acc/max :timestamp) :from [UpdateFact (= ?id id)]]
  =&gt;
  (r/retract! ?current) ;; or if you wanted to remove updates altogether - with no accumulator on LHS `(apply r/retract! [?current ?update])`
  (r/insert! (do-update ?current ?update)))

</pre><span>

To me seems like a pretty natural thing to do, but it violates truth maintenance since the supporting facts </span><code>?current</code><span> and </span><code>?update</code><span> are retracted that logically supported the </span><code>r/insert!</code></div><div id="t1507910042000448" t="2017-10-13 15:54:02 mikerod However,  r/retract!  is a bit at odds with Truth maintenance since it is “order-dependent”"><a href="#t1507910042000448" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-13</span> <span class="t" onclick="H(this)">15:54:02</span>                 mikerod </span><span>However, </span><code>r/retract!</code><span> is a bit at odds with Truth maintenance since it is “order-dependent”</span></div><div id="t1507910075000096" t="2017-10-13 15:54:35 mikerod if you  r/retract!  something, but later the rule is found to be invalidated by some other retractions, you’d expect the  r/retract!  operation to be rolled back"><a href="#t1507910075000096" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-13</span> <span class="t" onclick="H(this)">15:54:35</span>                 mikerod </span><span>if you </span><code>r/retract!</code><span> something, but later the rule is found to be invalidated by some other retractions, you’d expect the </span><code>r/retract!</code><span> operation to be rolled back</span></div><div id="t1507910559000171" t="2017-10-13 16:02:39 mikerod if you do append-only style, I think something like this works though:
 (defrecord UpdateFact [id timestamp stuff])
(defrecord FactType [id timestamp x y])
(defrecord FactTypeSnapshot [id timestamp x y])

(r/defrule current-fact
  [?current &lt;- (acc/max :timestamp) :from [FactTypeSnapshot (= ?id id)]]
  =&gt;
  (r/insert! (map-&gt;FactType ?current)))

(r/defrule update-fact-type

  [?update &lt;- (acc/all) :from [UpdateFact (= ?id id) (= ?ts timestamp)]]
  [?current &lt;- FactType (= ?id id) (&lt; timestamp ?ts)]
  =&gt;

  ;; Inserts a `FactTypeSnapshot w/ updates applied and `:timestamp` = `?ts`
  (r/insert! (do-update ?current ?update ?ts)))

(r/defrule using-fact-type
  [FactType (= ?id id) (= ?x x) (= ?y y)]
  =&gt;
  (prn ?x))


"><a href="#t1507910559000171" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-13</span> <span class="t" onclick="H(this)">16:02:39</span>                 mikerod </span><span>if you do append-only style, I think something like this works though:
</span><pre>(defrecord UpdateFact [id timestamp stuff])
(defrecord FactType [id timestamp x y])
(defrecord FactTypeSnapshot [id timestamp x y])

(r/defrule current-fact
  [?current &lt;- (acc/max :timestamp) :from [FactTypeSnapshot (= ?id id)]]
  =&gt;
  (r/insert! (map-&gt;FactType ?current)))

(r/defrule update-fact-type

  [?update &lt;- (acc/all) :from [UpdateFact (= ?id id) (= ?ts timestamp)]]
  [?current &lt;- FactType (= ?id id) (&lt; timestamp ?ts)]
  =&gt;

  ;; Inserts a `FactTypeSnapshot w/ updates applied and `:timestamp` = `?ts`
  (r/insert! (do-update ?current ?update ?ts)))

(r/defrule using-fact-type
  [FactType (= ?id id) (= ?x x) (= ?y y)]
  =&gt;
  (prn ?x))


</pre></div><div id="t1507911074000635" t="2017-10-13 16:11:14 mikerod The key is to have way to represent snapshots of a fact over time - the  FactTypeSnapshot , a way to select the one you want to use in rules - the  FactType , a way to apply updates - via  UpdateFact  to those facts in a way that doesn’t cause a logical loop.
Didn’t test this specifically, but I believe the idea plays out alright (for append-only working memory).

Externally may tend to be smoother, as @zylox said, so often I’d go with that. I wonder if Clara could provide some sort of helpers for that though
 ;;; Add a query to your ruleset to fetch facts you want to update 
(r/defquery find-fact [find-id]
  [?fact &lt;- FactType (= id find-id)])

;;; Example external update fn
(defn do-update [session update]

  ;; Assumes :id uniquely identifies facts here
  (let [old (first (mapv :?fact (r/query sesssion find-fact :id (:id update))))]
    (-&gt; session
        (r/retract old)
        (r/insert (update-fact old update))
        r/fire-rules)))

"><a href="#t1507911074000635" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-13</span> <span class="t" onclick="H(this)">16:11:14</span>                 mikerod </span><span>The key is to have way to represent snapshots of a fact over time - the </span><code>FactTypeSnapshot</code><span>, a way to select the one you want to use in rules - the </span><code>FactType</code><span>, a way to apply updates - via </span><code>UpdateFact</code><span> to those facts in a way that doesn’t cause a logical loop.
Didn’t test this specifically, but I believe the idea plays out alright (for append-only working memory).

Externally may tend to be smoother, as @zylox said, so often I’d go with that. I wonder if Clara could provide some sort of helpers for that though
</span><pre>;;; Add a query to your ruleset to fetch facts you want to update 
(r/defquery find-fact [find-id]
  [?fact &lt;- FactType (= id find-id)])

;;; Example external update fn
(defn do-update [session update]

  ;; Assumes :id uniquely identifies facts here
  (let [old (first (mapv :?fact (r/query sesssion find-fact :id (:id update))))]
    (-&gt; session
        (r/retract old)
        (r/insert (update-fact old update))
        r/fire-rules)))

</pre></div><div id="t1507990927000060" t="2017-10-14 14:22:07 mmer @zylox Thanks for the reply."><a href="#t1507990927000060" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-14</span> <span class="t" onclick="H(this)">14:22:07</span>                    mmer </span><span>@zylox Thanks for the reply.</span></div><div id="t1507994427000031" t="2017-10-14 15:20:27 mmer Sorry another simple question - do all facts have to be records?"><a href="#t1507994427000031" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-14</span> <span class="t" onclick="H(this)">15:20:27</span>                    mmer </span><span>Sorry another simple question - do all facts have to be records?</span></div><div id="t1508005270000033" t="2017-10-14 18:21:10 mikerod @mmer no. Clara allows for you to provide your own  :fact-type-fn , for arbitrary “type dispatch”, as well as  :ancestors-fn  for setting up “type hierarchies”. This is all in much the same was as Clojure’s ad hoc hierarchies work via  derive  and  isa?  etc"><a href="#t1508005270000033" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-14</span> <span class="t" onclick="H(this)">18:21:10</span>                 mikerod </span><span>@mmer no. Clara allows for you to provide your own </span><code>:fact-type-fn</code><span>, for arbitrary “type dispatch”, as well as </span><code>:ancestors-fn</code><span> for setting up “type hierarchies”. This is all in much the same was as Clojure’s ad hoc hierarchies work via </span><code>derive</code><span> and </span><code>isa?</code><span> etc</span></div><div id="t1508005286000104" t="2017-10-14 18:21:26 mikerod By default, Clara uses  clojure.core/type  as to map a fact to type"><a href="#t1508005286000104" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-14</span> <span class="t" onclick="H(this)">18:21:26</span>                 mikerod </span><span>By default, Clara uses </span><code>clojure.core/type</code><span> as to map a fact to type</span></div><div id="t1508005302000089" t="2017-10-14 18:21:42 mikerod and  clojure.core/ancestors  to determine the  isa?  style relationships"><a href="#t1508005302000089" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-14</span> <span class="t" onclick="H(this)">18:21:42</span>                 mikerod </span><span>and </span><code>clojure.core/ancestors</code><span> to determine the </span><code>isa?</code><span> style relationships</span></div><div id="t1508005316000060" t="2017-10-14 18:21:56 mikerod So changing nothing, you can use plain maps with  :type  metadata"><a href="#t1508005316000060" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-14</span> <span class="t" onclick="H(this)">18:21:56</span>                 mikerod </span><span>So changing nothing, you can use plain maps with </span><code>:type</code><span> metadata</span></div><div id="t1508005411000011" t="2017-10-14 18:23:31 mikerod (r/defrule my-rule
 [:my-fact-type (= (:x this) ?x)]
 =&gt;
 (println &quot;hello&quot;))
 

 (-&gt; (r/mk-session [my-rule])
     (r/insert (with-meta {:x 10} {:type :my-fact-type}))
    r/fire-rules)
"><a href="#t1508005411000011" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-14</span> <span class="t" onclick="H(this)">18:23:31</span>                 mikerod </span><pre>(r/defrule my-rule
 [:my-fact-type (= (:x this) ?x)]
 =&gt;
 (println &quot;hello&quot;))
</pre><span>

</span><pre>(-&gt; (r/mk-session [my-rule])
     (r/insert (with-meta {:x 10} {:type :my-fact-type}))
    r/fire-rules)
</pre></div><div id="t1508005452000102" t="2017-10-14 18:24:12 mikerod Here are some docs on it  http://www.clara-rules.org/docs/fact_type_customization/"><a href="#t1508005452000102" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-14</span> <span class="t" onclick="H(this)">18:24:12</span>                 mikerod </span><span>Here are some docs on it </span><a href="http://www.clara-rules.org/docs/fact_type_customization/" target="_blank">http://www.clara-rules.org/docs/fact_type_customization/</a></div><div id="t1508074996000004" t="2017-10-15 13:43:16 mmer As usual thanks"><a href="#t1508074996000004" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-15</span> <span class="t" onclick="H(this)">13:43:16</span>                    mmer </span><span>As usual thanks</span></div><div id="t1508613854000059" t="2017-10-21 19:24:14 wadi.chemkhi Hello"><a href="#t1508613854000059" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-21</span> <span class="t" onclick="H(this)">19:24:14</span>            wadi.chemkhi </span><span>Hello</span></div><div id="t1508613950000045" t="2017-10-21 19:25:50 wadi.chemkhi i find my self having to restart the repl every time i change the rules in a different namespace"><a href="#t1508613950000045" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-21</span> <span class="t" onclick="H(this)">19:25:50</span>            wadi.chemkhi </span><span>i find my self having to restart the repl every time i change the rules in a different namespace</span></div><div id="t1508613959000091" t="2017-10-21 19:25:59 wadi.chemkhi i require it with :reload"><a href="#t1508613959000091" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-21</span> <span class="t" onclick="H(this)">19:25:59</span>            wadi.chemkhi </span><span>i require it with :reload</span></div><div id="t1508613968000011" t="2017-10-21 19:26:08 wadi.chemkhi but still changes are ignored"><a href="#t1508613968000011" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-21</span> <span class="t" onclick="H(this)">19:26:08</span>            wadi.chemkhi </span><span>but still changes are ignored</span></div><div id="t1508614051000054" t="2017-10-21 19:27:31 wadi.chemkhi i have a main namespace with (defsession my-session &apos;myapp.corerules &apos;myapp.module.morerules)"><a href="#t1508614051000054" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-21</span> <span class="t" onclick="H(this)">19:27:31</span>            wadi.chemkhi </span><span>i have a main namespace with (defsession my-session &apos;myapp.corerules &apos;myapp.module.morerules)</span></div><div id="t1508614932000015" t="2017-10-21 19:42:12 wadi.chemkhi i&apos;m new both to clojure and clara"><a href="#t1508614932000015" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-21</span> <span class="t" onclick="H(this)">19:42:12</span>            wadi.chemkhi </span><span>i&apos;m new both to clojure and clara</span></div><div id="t1508614943000047" t="2017-10-21 19:42:23 wadi.chemkhi is there a way to simplify the workflow"><a href="#t1508614943000047" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-21</span> <span class="t" onclick="H(this)">19:42:23</span>            wadi.chemkhi </span><span>is there a way to simplify the workflow</span></div><div id="t1508616733000040" t="2017-10-21 20:12:13 ryanbrush @wadi.chemkhi By default Clara caches rule sessions for efficiency, but this&apos; isn&apos;t great for a REPL-based workflow. I like to set :cache false when working from the REPL to avoid this. The page is a bit old, but there&apos;s an example here:  https://github.com/cerner/clara-rules/wiki/Using-Clara-from-the-REPL"><a href="#t1508616733000040" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-21</span> <span class="t" onclick="H(this)">20:12:13</span>               ryanbrush </span><span>@wadi.chemkhi By default Clara caches rule sessions for efficiency, but this&apos; isn&apos;t great for a REPL-based workflow. I like to set :cache false when working from the REPL to avoid this. The page is a bit old, but there&apos;s an example here: </span><a href="https://github.com/cerner/clara-rules/wiki/Using-Clara-from-the-REPL" target="_blank">https://github.com/cerner/clara-rules/wiki/Using-Clara-from-the-REPL</a></div><div id="t1508616826000011" t="2017-10-21 20:13:46 wadi.chemkhi thnx @ryanbrush  😄"><a href="#t1508616826000011" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-21</span> <span class="t" onclick="H(this)">20:13:46</span>            wadi.chemkhi </span><span>thnx @ryanbrush </span><b>😄</b></div><div id="t1508616962000040" t="2017-10-21 20:16:02 ryanbrush Sure thing!"><a href="#t1508616962000040" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-21</span> <span class="t" onclick="H(this)">20:16:02</span>               ryanbrush </span><span>Sure thing!</span></div><div id="t1508623221000002" t="2017-10-21 22:00:21 wadi.chemkhi with clojurescript is it possible to define facts in different namespaces and have defsession work properly and require everything ?"><a href="#t1508623221000002" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-21</span> <span class="t" onclick="H(this)">22:00:21</span>            wadi.chemkhi </span><span>with clojurescript is it possible to define facts in different namespaces and have defsession work properly and require everything ?</span></div><div id="t1508623248000026" t="2017-10-21 22:00:48 wadi.chemkhi or do i need to require all facts from each rules namespace"><a href="#t1508623248000026" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-21</span> <span class="t" onclick="H(this)">22:00:48</span>            wadi.chemkhi </span><span>or do i need to require all facts from each rules namespace</span></div><div id="t1508623250000042" t="2017-10-21 22:00:50 wadi.chemkhi ?"><a href="#t1508623250000042" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-21</span> <span class="t" onclick="H(this)">22:00:50</span>            wadi.chemkhi </span><span>?</span></div><div id="t1508623533000023" t="2017-10-21 22:05:33 ryanbrush I don&apos;t use the Clojurescript version much but it should be as long everything is properly required."><a href="#t1508623533000023" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-21</span> <span class="t" onclick="H(this)">22:05:33</span>               ryanbrush </span><span>I don&apos;t use the Clojurescript version much but it should be as long everything is properly required.</span></div><div id="t1508623840000002" t="2017-10-21 22:10:40 wadi.chemkhi I see, thnx again @ryanbrush"><a href="#t1508623840000002" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-21</span> <span class="t" onclick="H(this)">22:10:40</span>            wadi.chemkhi </span><span>I see, thnx again @ryanbrush</span></div><div id="t1508893128000237" t="2017-10-25 00:58:48 souenzzo {:salience java.lang.Long/MIN_VALUE}  is a bad idea?? It&apos;s a &quot;final&quot; accumulator."><a href="#t1508893128000237" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-25</span> <span class="t" onclick="H(this)">00:58:48</span>                souenzzo </span><code>{:salience java.lang.Long/MIN_VALUE}</code><span> is a bad idea?? It&apos;s a &quot;final&quot; accumulator.</span></div><div id="t1508905847000055" t="2017-10-25 04:30:47 devn @souenzzo in what sense do you mean?"><a href="#t1508905847000055" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-25</span> <span class="t" onclick="H(this)">04:30:47</span>                    devn </span><span>@souenzzo in what sense do you mean?</span></div><div id="t1508905997000040" t="2017-10-25 04:33:17 devn Why do you think it might be a bad idea?"><a href="#t1508905997000040" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-25</span> <span class="t" onclick="H(this)">04:33:17</span>                    devn </span><span>Why do you think it might be a bad idea?</span></div><div id="t1508933928000153" t="2017-10-25 12:18:48 souenzzo There is another way to tell &quot;this should be the last one&quot;?"><a href="#t1508933928000153" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-25</span> <span class="t" onclick="H(this)">12:18:48</span>                souenzzo </span><span>There is another way to tell &quot;this should be the last one&quot;?</span></div><div id="t1508941236000268" t="2017-10-25 14:20:36 wparker @souenzzo using MIN_VALUE would work, it just wouldn’t necessarily be the last thing if you accidentally added another rule with the same salience value.  If the rulesets are small and/or you’re the only one working on them that might not be a problem.  For our large rulesets with lots of people working on them we find it convenient to have salience with domain-specific categories defined in a single location.  If you do need other functionality the salience function is user-configurable, although it defaults to a simple numeric comparison."><a href="#t1508941236000268" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-10-25</span> <span class="t" onclick="H(this)">14:20:36</span>                 wparker </span><span>@souenzzo using MIN_VALUE would work, it just wouldn’t necessarily be the last thing if you accidentally added another rule with the same salience value.  If the rulesets are small and/or you’re the only one working on them that might not be a problem.  For our large rulesets with lots of people working on them we find it convenient to have salience with domain-specific categories defined in a single location.  If you do need other functionality the salience function is user-configurable, although it defaults to a simple numeric comparison.</span></div><div id="t1509569381000355" t="2017-11-01 20:49:41 wparker Clara-rules release 0.16.1 is now available on Clojars.  This contains several bugfixes and other minor improvements relative to 0.16.0. See the changelog for further details.   As always please log an issue if you encounter regressions or other problems.  https://github.com/cerner/clara-rules/blob/master/CHANGELOG.md"><a href="#t1509569381000355" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-11-01</span> <span class="t" onclick="H(this)">20:49:41</span>                 wparker </span><span>Clara-rules release 0.16.1 is now available on Clojars.  This contains several bugfixes and other minor improvements relative to 0.16.0. See the changelog for further details.   As always please log an issue if you encounter regressions or other problems. </span><a href="https://github.com/cerner/clara-rules/blob/master/CHANGELOG.md" target="_blank">https://github.com/cerner/clara-rules/blob/master/CHANGELOG.md</a></div><div id="t1509569635000125" t="2017-11-01 20:53:55 wparker Also, thanks to everyone who contributed to the release - @zylox @ethanc \@dgoeke"><a href="#t1509569635000125" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-11-01</span> <span class="t" onclick="H(this)">20:53:55</span>                 wparker </span><span>Also, thanks to everyone who contributed to the release - @zylox @ethanc \@dgoeke</span></div><div id="t1509988491000515" t="2017-11-06 17:14:51 souenzzo Can you put a  time  on each rule?
Or a route to view the profile/debug the rules?
There is something slow in my engine but I&apos;m not sure how to find what it is."><a href="#t1509988491000515" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-11-06</span> <span class="t" onclick="H(this)">17:14:51</span>                souenzzo </span><span>Can you put a </span><code>time</code><span> on each rule?
Or a route to view the profile/debug the rules?
There is something slow in my engine but I&apos;m not sure how to find what it is.</span></div><div id="t1509989343000100" t="2017-11-06 17:29:03 dadair maybe run your engine under a profiler like VisualVM? can see what methods may be using the most time and go from there?"><a href="#t1509989343000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-11-06</span> <span class="t" onclick="H(this)">17:29:03</span>                  dadair </span><span>maybe run your engine under a profiler like VisualVM? can see what methods may be using the most time and go from there?</span></div><div id="t1510000020000545" t="2017-11-06 20:27:00 wparker If the problem is a function in your rules (RHS, accumulator function, etc.) that’s taking a lot of time then something like VisualVM would likely be helpful.  That’s where I’d start.  If the problem is that the rules are firing in a bad/suboptimal way then Clara’s tracing could provide some info, but that is harder to use.  https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/tools/tracing.cljc , the discussion on  https://github.com/cerner/clara-rules/issues/344  around potential tracing enhancements could give some insight into how it works as well"><a href="#t1510000020000545" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-11-06</span> <span class="t" onclick="H(this)">20:27:00</span>                 wparker </span><span>If the problem is a function in your rules (RHS, accumulator function, etc.) that’s taking a lot of time then something like VisualVM would likely be helpful.  That’s where I’d start.  If the problem is that the rules are firing in a bad/suboptimal way then Clara’s tracing could provide some info, but that is harder to use. </span><a href="https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/tools/tracing.cljc" target="_blank">https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/tools/tracing.cljc</a><span>, the discussion on </span><a href="https://github.com/cerner/clara-rules/issues/344" target="_blank">https://github.com/cerner/clara-rules/issues/344</a><span> around potential tracing enhancements could give some insight into how it works as well</span></div><div id="t1510006570000482" t="2017-11-06 22:16:10 souenzzo @wparker I made a macro that wrap  rhs  inside a  time -like macro, that time RHS and store it&apos;s time on a global atom (just for use on repl).
It allow&apos;s me to see how many times each rule is fired, how many time each &quot;burn&quot; takes, avg, &quot;total time&quot; from each rule. Simple and usefull  😄"><a href="#t1510006570000482" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-11-06</span> <span class="t" onclick="H(this)">22:16:10</span>                souenzzo </span><span>@wparker I made a macro that wrap </span><code>rhs</code><span> inside a </span><code>time</code><span>-like macro, that time RHS and store it&apos;s time on a global atom (just for use on repl).
It allow&apos;s me to see how many times each rule is fired, how many time each &quot;burn&quot; takes, avg, &quot;total time&quot; from each rule. Simple and usefull </span><b>😄</b></div><div id="t1510006614000308" t="2017-11-06 22:16:54 souenzzo (now I&apos;m using  my-ns/defrule  in place of  clara.rules/defrule )"><a href="#t1510006614000308" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-11-06</span> <span class="t" onclick="H(this)">22:16:54</span>                souenzzo </span><span>(now I&apos;m using </span><code>my-ns/defrule</code><span> in place of </span><code>clara.rules/defrule</code><span>)</span></div><div id="t1510007871000220" t="2017-11-06 22:37:51 wparker Glad you’ve found a working solution @souenzzo FYI, there are some cases where Clara could repeatedly add a rule to the queue of things waiting to be fired, remove it, add it again, etc. without ever actually firing it (and thus avoiding that macro) but my guess is those cases are a small though nontrivial minority of perf problems"><a href="#t1510007871000220" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-11-06</span> <span class="t" onclick="H(this)">22:37:51</span>                 wparker </span><span>Glad you’ve found a working solution @souenzzo FYI, there are some cases where Clara could repeatedly add a rule to the queue of things waiting to be fired, remove it, add it again, etc. without ever actually firing it (and thus avoiding that macro) but my guess is those cases are a small though nontrivial minority of perf problems</span></div><div id="t1510008318000068" t="2017-11-06 22:45:18 souenzzo @wparker I&apos;m just trying to find any slow  rhs . Insert or not insert, use or not, not matters.
I find a single rule that takes 100x more time that any other.
I think that not matter if it will be used or not, in this case."><a href="#t1510008318000068" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-11-06</span> <span class="t" onclick="H(this)">22:45:18</span>                     souenzzo </span><span>@wparker I&apos;m just trying to find any slow </span><code>rhs</code><span>. Insert or not insert, use or not, not matters.
I find a single rule that takes 100x more time that any other.
I think that not matter if it will be used or not, in this case.</span></div><div id="t1510069760000056" t="2017-11-07 15:49:20 wparker Excellent, sounds like you’ve found your performance problem.  :+1:"><a href="#t1510069760000056" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-11-07</span> <span class="t" onclick="H(this)">15:49:20</span>                      wparker </span><span>Excellent, sounds like you’ve found your performance problem. </span><b>:+1:</b></div><div id="t1510007881000129" t="2017-11-06 22:38:01 wparker so that sounds like it would work most of the time"><a href="#t1510007881000129" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-11-06</span> <span class="t" onclick="H(this)">22:38:01</span>                 wparker </span><span>so that sounds like it would work most of the time</span></div><div id="t1510591411000332" t="2017-11-13 16:43:31 ggaillard Hi ! I have troubles understanding how destructuring works in clara. If I understand the documentation correctly, I would expect this rule to match any record of type  Foo  and bind the symbol  foo  to the record itself, so I can use it afterward.
 (defrule do-something-with-foo
  [Foo [foo]]
  =&gt;
  (do-something-with  foo))
 
I always get an  Unable to resolve symbol: foo in this context , where context is the RHS. 
Am I missing something ?"><a href="#t1510591411000332" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-11-13</span> <span class="t" onclick="H(this)">16:43:31</span>               ggaillard </span><span>Hi ! I have troubles understanding how destructuring works in clara. If I understand the documentation correctly, I would expect this rule to match any record of type </span><code>Foo</code><span> and bind the symbol </span><code>foo</code><span> to the record itself, so I can use it afterward.
</span><pre>(defrule do-something-with-foo
  [Foo [foo]]
  =&gt;
  (do-something-with  foo))
</pre><span>
I always get an </span><code>Unable to resolve symbol: foo in this context</code><span>, where context is the RHS. 
Am I missing something ?</span></div><div id="t1510592860000332" t="2017-11-13 17:07:40 mikerod @ggaillard the destructured bound symbols are scoped locally to the expressions of the single condition doing the destructuring bind"><a href="#t1510592860000332" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-11-13</span> <span class="t" onclick="H(this)">17:07:40</span>                 mikerod </span><span>@ggaillard the destructured bound symbols are scoped locally to the expressions of the single condition doing the destructuring bind</span></div><div id="t1510592885000272" t="2017-11-13 17:08:05 mikerod You have to bind a variable to use throughout other conditions or the rule and/or the RHS"><a href="#t1510592885000272" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-11-13</span> <span class="t" onclick="H(this)">17:08:05</span>                 mikerod </span><span>You have to bind a variable to use throughout other conditions or the rule and/or the RHS</span></div><div id="t1510592905000457" t="2017-11-13 17:08:25 mikerod (defrule do-something-with-foo
  [Foo [foo] (= ?foo foo)]
  =&gt;
  (do-something-with  ?foo))
"><a href="#t1510592905000457" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-11-13</span> <span class="t" onclick="H(this)">17:08:25</span>                 mikerod </span><pre>(defrule do-something-with-foo
  [Foo [foo] (= ?foo foo)]
  =&gt;
  (do-something-with  ?foo))
</pre></div><div id="t1510593064000172" t="2017-11-13 17:11:04 mikerod In this case, it isn’t too useful"><a href="#t1510593064000172" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-11-13</span> <span class="t" onclick="H(this)">17:11:04</span>                 mikerod </span><span>In this case, it isn’t too useful</span></div><div id="t1510593081000369" t="2017-11-13 17:11:21 mikerod This would make more sense
 (defrule do-something-with-foo
  [?foo &lt;- Foo]
  =&gt;
  (do-something-with  ?foo))
"><a href="#t1510593081000369" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-11-13</span> <span class="t" onclick="H(this)">17:11:21</span>                 mikerod </span><span>This would make more sense
</span><pre>(defrule do-something-with-foo
  [?foo &lt;- Foo]
  =&gt;
  (do-something-with  ?foo))
</pre></div><div id="t1510593120000286" t="2017-11-13 17:12:00 ggaillard Oh I get it ! Thank you !"><a href="#t1510593120000286" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-11-13</span> <span class="t" onclick="H(this)">17:12:00</span>               ggaillard </span><span>Oh I get it ! Thank you !</span></div><div id="t1510593148000512" t="2017-11-13 17:12:28 mikerod times like:
 (defrule do-something-with-foo
  [Foo [{:keys [x y]}] (&lt; 10 x) (= ?y y)]
  =&gt;
  (do-something-with  ?y))

 
are where it may be more useful"><a href="#t1510593148000512" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-11-13</span> <span class="t" onclick="H(this)">17:12:28</span>                 mikerod </span><span>times like:
</span><pre>(defrule do-something-with-foo
  [Foo [{:keys [x y]}] (&lt; 10 x) (= ?y y)]
  =&gt;
  (do-something-with  ?y))

</pre><span>
are where it may be more useful</span></div><div id="t1510593250000595" t="2017-11-13 17:14:10 mikerod Also note that when using Clojure records (i.e.  defrecord  classes) and/or, on the JVM side, Java POJOs adhering to the Java bean spec, Clara automatically makes the field names visible in the local scope of a condition’s experssions
 (defrecord Foo [x y])

(defrule do-something-with-foo
  [Foo (&lt; 10 x) (= ?y y)]
  =&gt;
  (do-something-with  ?y))
 
Would work without the explicit destructuring syntax"><a href="#t1510593250000595" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-11-13</span> <span class="t" onclick="H(this)">17:14:10</span>                 mikerod </span><span>Also note that when using Clojure records (i.e. </span><code>defrecord</code><span> classes) and/or, on the JVM side, Java POJOs adhering to the Java bean spec, Clara automatically makes the field names visible in the local scope of a condition’s experssions
</span><pre>(defrecord Foo [x y])

(defrule do-something-with-foo
  [Foo (&lt; 10 x) (= ?y y)]
  =&gt;
  (do-something-with  ?y))
</pre><span>
Would work without the explicit destructuring syntax</span></div><div id="t1510593868000463" t="2017-11-13 17:24:28 ggaillard I was using your last example until now to extract my records&apos; fields, and since I missed the  &lt;-  part of facts expressions it quickly became inconvenient when I needed to work with every fields … Thanks for this clarification  🙂"><a href="#t1510593868000463" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-11-13</span> <span class="t" onclick="H(this)">17:24:28</span>               ggaillard </span><span>I was using your last example until now to extract my records&apos; fields, and since I missed the </span><code>&lt;-</code><span> part of facts expressions it quickly became inconvenient when I needed to work with every fields … Thanks for this clarification </span><b>🙂</b></div><div id="t1510598804000737" t="2017-11-13 18:46:44 mikerod @dave.dixon that is surprising to me"><a href="#t1510598804000737" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-11-13</span> <span class="t" onclick="H(this)">18:46:44</span>                 mikerod </span><span>@dave.dixon that is surprising to me</span></div><div id="t1510598865000781" t="2017-11-13 18:47:45 mikerod I want to take a look"><a href="#t1510598865000781" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-11-13</span> <span class="t" onclick="H(this)">18:47:45</span>                 mikerod </span><span>I want to take a look</span></div><div id="t1510599628000010" t="2017-11-13 19:00:28 mikerod @dave.dixon I think there is some sort of compilation issue happening with that rule"><a href="#t1510599628000010" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-11-13</span> <span class="t" onclick="H(this)">19:00:28</span>                 mikerod </span><span>@dave.dixon I think there is some sort of compilation issue happening with that rule</span></div><div id="t1510599640000741" t="2017-11-13 19:00:40 mikerod (defrule lost-game
  [?ships &lt;- (acc/count) :from [Ship]]
  [?destroyed &lt;- (acc/count) :from [Destroyed]]
  [:test (do (= ?ships ?destroyed))]
  =&gt;
  (insert! (-&gt;Loser)))
"><a href="#t1510599640000741" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-11-13</span> <span class="t" onclick="H(this)">19:00:40</span>                 mikerod </span><pre>(defrule lost-game
  [?ships &lt;- (acc/count) :from [Ship]]
  [?destroyed &lt;- (acc/count) :from [Destroyed]]
  [:test (do (= ?ships ?destroyed))]
  =&gt;
  (insert! (-&gt;Loser)))
</pre></div><div id="t1510599643000188" t="2017-11-13 19:00:43 mikerod worksaround it"><a href="#t1510599643000188" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-11-13</span> <span class="t" onclick="H(this)">19:00:43</span>                 mikerod </span><span>worksaround it</span></div><div id="t1510599656000683" t="2017-11-13 19:00:56 mikerod I’m not sure the cause still"><a href="#t1510599656000683" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-11-13</span> <span class="t" onclick="H(this)">19:00:56</span>                 mikerod </span><span>I’m not sure the cause still</span></div><div id="t1510599749000135" t="2017-11-13 19:02:29 sparkofreason @mikerod Thanks. I had several puzzling cases like this, will try the work-around when I get home "><a href="#t1510599749000135" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-11-13</span> <span class="t" onclick="H(this)">19:02:29</span>           sparkofreason </span><span>@mikerod Thanks. I had several puzzling cases like this, will try the work-around when I get home </span></div><div id="t1510599750000436" t="2017-11-13 19:02:30 mikerod To me it is looking likely to be worthy of logging an issue to clara github though"><a href="#t1510599750000436" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-11-13</span> <span class="t" onclick="H(this)">19:02:30</span>                 mikerod </span><span>To me it is looking likely to be worthy of logging an issue to clara github though</span></div><div id="t1510599776000683" t="2017-11-13 19:02:56 mikerod if you have more examples of different shapes, that’d be interesting too"><a href="#t1510599776000683" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-11-13</span> <span class="t" onclick="H(this)">19:02:56</span>                 mikerod </span><span>if you have more examples of different shapes, that’d be interesting too</span></div><div id="t1510600038000672" t="2017-11-13 19:07:18 zylox Is the test node making a binding somehow instead?....thatd be weird"><a href="#t1510600038000672" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-11-13</span> <span class="t" onclick="H(this)">19:07:18</span>                   zylox </span><span>Is the test node making a binding somehow instead?....thatd be weird</span></div><div id="t1510600235000409" t="2017-11-13 19:10:35 mikerod @zylox I think it is misintepreting it somehow along those lines"><a href="#t1510600235000409" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-11-13</span> <span class="t" onclick="H(this)">19:10:35</span>                 mikerod </span><span>@zylox I think it is misintepreting it somehow along those lines</span></div><div id="t1510600236000651" t="2017-11-13 19:10:36 mikerod no good"><a href="#t1510600236000651" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-11-13</span> <span class="t" onclick="H(this)">19:10:36</span>                 mikerod </span><span>no good</span></div><div id="t1510600258000335" t="2017-11-13 19:10:58 mikerod I looked a a bit in  clara.rules.compiler  but I don’t see the issue yet"><a href="#t1510600258000335" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-11-13</span> <span class="t" onclick="H(this)">19:10:58</span>                 mikerod </span><span>I looked a a bit in </span><code>clara.rules.compiler</code><span> but I don’t see the issue yet</span></div><div id="t1510600302000136" t="2017-11-13 19:11:42 mikerod If you look at the  rulebase  for the network without the  do  (the problem case), the  TestNode  is a beta root with no parents"><a href="#t1510600302000136" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-11-13</span> <span class="t" onclick="H(this)">19:11:42</span>                 mikerod </span><span>If you look at the </span><code>rulebase</code><span> for the network without the </span><code>do</code><span> (the problem case), the </span><code>TestNode</code><span> is a beta root with no parents</span></div><div id="t1510600320000675" t="2017-11-13 19:12:00 mikerod And it’s children are the accumulate nodes"><a href="#t1510600320000675" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-11-13</span> <span class="t" onclick="H(this)">19:12:00</span>                 mikerod </span><span>And it’s children are the accumulate nodes</span></div><div id="t1510600354000462" t="2017-11-13 19:12:34 mikerod This made me suspicious of the function  clara.rules.compiler/sort-conditions  which does a topological type of sort of accumulators that rearranges some conditions"><a href="#t1510600354000462" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-11-13</span> <span class="t" onclick="H(this)">19:12:34</span>                 mikerod </span><span>This made me suspicious of the function </span><code>clara.rules.compiler/sort-conditions</code><span> which does a topological type of sort of accumulators that rearranges some conditions</span></div><div id="t1510600369000722" t="2017-11-13 19:12:49 mikerod The topo sort is supposed ensure that any used variable binding is pushed below it’s creation unification binding condition"><a href="#t1510600369000722" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-11-13</span> <span class="t" onclick="H(this)">19:12:49</span>                 mikerod </span><span>The topo sort is supposed ensure that any used variable binding is pushed below it’s creation unification binding condition</span></div><div id="t1510600546000309" t="2017-11-13 19:15:46 mikerod Adding the  do  in the  :test  node pushes it down as a child of the accumulate nodes in the network and then it works"><a href="#t1510600546000309" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-11-13</span> <span class="t" onclick="H(this)">19:15:46</span>                 mikerod </span><span>Adding the </span><code>do</code><span> in the </span><code>:test</code><span> node pushes it down as a child of the accumulate nodes in the network and then it works</span></div><div id="t1510600954000754" t="2017-11-13 19:22:34 mikerod It may be completely a problem with the sort, as the below demonstrates
 (ns test.ns
  (:require [clara.rules :as r]
            [clara.rules.accumulators :as acc]
            [clara.rules.compiler :as com]))

(defrecord Ship [])
(defrecord Destroyed [])
(defrecord Loser [])

(r/defrule lost-game-fixed
  [?ships &lt;- (acc/count) :from [Ship]]
  [?destroyed &lt;- (acc/count) :from [Destroyed]]
  [:test (do (= ?ships ?destroyed))]                           ;; Notice the `do` surrounding form is important for the sort
  =&gt;
  (r/insert! (-&gt;Loser)))

(r/defrule lost-game-broken
  [?ships &lt;- (acc/count) :from [Ship]]
  [?destroyed &lt;- (acc/count) :from [Destroyed]]
  [:test (= ?ships ?destroyed)]                                  ;; Condition with problem, doesn&apos;t work without surrounding form (`do` above)
  =&gt;
  (r/insert! (-&gt;Loser)))


(com/sort-conditions (-&gt; lost-game-fixed :lhs))
(comment
  ({:accumulator (clara.rules.accumulators/count), :from {:type test.ns.Ship, :constraints []}, :result-binding :?ships}
   {:accumulator (clara.rules.accumulators/count), :from {:type test.ns.Destroyed, :constraints []}, :result-binding :?destroyed}
   {:constraints [(do (= ?ships ?destroyed))]}))

(com/sort-conditions (-&gt; lost-game-broken :lhs))
(comment
  ({:constraints [(= ?ships ?destroyed)]}
   {:accumulator (clara.rules.accumulators/count), :from {:type test.ns.Ship, :constraints []}, :result-binding :?ships}
   {:accumulator (clara.rules.accumulators/count), :from {:type test.ns.Destroyed, :constraints []}, :result-binding :?destroyed}))


"><a href="#t1510600954000754" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-11-13</span> <span class="t" onclick="H(this)">19:22:34</span>                 mikerod </span><span>It may be completely a problem with the sort, as the below demonstrates
</span><pre>(ns test.ns
  (:require [clara.rules :as r]
            [clara.rules.accumulators :as acc]
            [clara.rules.compiler :as com]))

(defrecord Ship [])
(defrecord Destroyed [])
(defrecord Loser [])

(r/defrule lost-game-fixed
  [?ships &lt;- (acc/count) :from [Ship]]
  [?destroyed &lt;- (acc/count) :from [Destroyed]]
  [:test (do (= ?ships ?destroyed))]                           ;; Notice the `do` surrounding form is important for the sort
  =&gt;
  (r/insert! (-&gt;Loser)))

(r/defrule lost-game-broken
  [?ships &lt;- (acc/count) :from [Ship]]
  [?destroyed &lt;- (acc/count) :from [Destroyed]]
  [:test (= ?ships ?destroyed)]                                  ;; Condition with problem, doesn&apos;t work without surrounding form (`do` above)
  =&gt;
  (r/insert! (-&gt;Loser)))


(com/sort-conditions (-&gt; lost-game-fixed :lhs))
(comment
  ({:accumulator (clara.rules.accumulators/count), :from {:type test.ns.Ship, :constraints []}, :result-binding :?ships}
   {:accumulator (clara.rules.accumulators/count), :from {:type test.ns.Destroyed, :constraints []}, :result-binding :?destroyed}
   {:constraints [(do (= ?ships ?destroyed))]}))

(com/sort-conditions (-&gt; lost-game-broken :lhs))
(comment
  ({:constraints [(= ?ships ?destroyed)]}
   {:accumulator (clara.rules.accumulators/count), :from {:type test.ns.Ship, :constraints []}, :result-binding :?ships}
   {:accumulator (clara.rules.accumulators/count), :from {:type test.ns.Destroyed, :constraints []}, :result-binding :?destroyed}))


</pre></div><div id="t1510600962000270" t="2017-11-13 19:22:42 mikerod Unless I’m missing something else prior to this"><a href="#t1510600962000270" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-11-13</span> <span class="t" onclick="H(this)">19:22:42</span>                 mikerod </span><span>Unless I’m missing something else prior to this</span></div><div id="t1510601405000058" t="2017-11-13 19:30:05 zylox juxt"><a href="#t1510601405000058" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-11-13</span> <span class="t" onclick="H(this)">19:30:05</span>                   zylox </span><b>juxt</b></div><div id="t1510602510000443" t="2017-11-13 19:48:30 zylox seems to be that  classify-variables  considers it an  equality-expression? , resulting in them being considered &quot;bound&quot;, but &quot;unbound&quot; in the workaround case"><a href="#t1510602510000443" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-11-13</span> <span class="t" onclick="H(this)">19:48:30</span>                   zylox </span><span>seems to be that </span><code>classify-variables</code><span> considers it an </span><code>equality-expression?</code><span>, resulting in them being considered &quot;bound&quot;, but &quot;unbound&quot; in the workaround case</span></div><div id="t1510604256000077" t="2017-11-13 20:17:36 zylox and when they are bound, this fn  https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/rules/compiler.clj#L790  will consider it satisfied because  #{}  is a subset of  #{?ships ?destroyed} , meaning  newly-satisfied  will contain the test constraint ( https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/rules/compiler.clj#L797 ) and be put in the front of the order in the  into  at the end  https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/rules/compiler.clj#L828"><a href="#t1510604256000077" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-11-13</span> <span class="t" onclick="H(this)">20:17:36</span>                   zylox </span><span>and when they are bound, this fn </span><a href="https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/rules/compiler.clj#L790" target="_blank">https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/rules/compiler.clj#L790</a><span> will consider it satisfied because </span><code>#{}</code><span> is a subset of </span><code>#{?ships ?destroyed}</code><span>, meaning </span><code>newly-satisfied</code><span> will contain the test constraint (</span><a href="https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/rules/compiler.clj#L797" target="_blank">https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/rules/compiler.clj#L797</a><span>) and be put in the front of the order in the </span><code>into</code><span> at the end </span><a href="https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/rules/compiler.clj#L828" target="_blank">https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/rules/compiler.clj#L828</a></div><div id="t1510604350000339" t="2017-11-13 20:19:10 zylox im not sure of a good way to fix this. i can see why it thinks its a bound variable."><a href="#t1510604350000339" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-11-13</span> <span class="t" onclick="H(this)">20:19:10</span>                   zylox </span><span>im not sure of a good way to fix this. i can see why it thinks its a bound variable.</span></div><div id="t1510604911000044" t="2017-11-13 20:28:31 sparkofreason That fixed it, as well as the other cases, which were essentially the same, with an equality check inside of  [:test] ."><a href="#t1510604911000044" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-11-13</span> <span class="t" onclick="H(this)">20:28:31</span>           sparkofreason </span><span>That fixed it, as well as the other cases, which were essentially the same, with an equality check inside of </span><code>[:test]</code><span>.</span></div><div id="t1510605213000537" t="2017-11-13 20:33:33 wparker The compilation of this rule does seem to be wrong.  When I inspect the rule network the :test condition seems to completely not exist in the network.  Gist with the pretty-printed network:  https://gist.github.com/WilliamParker/a3adaa3db730229bc01586009bb7178a"><a href="#t1510605213000537" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-11-13</span> <span class="t" onclick="H(this)">20:33:33</span>                 wparker </span><span>The compilation of this rule does seem to be wrong.  When I inspect the rule network the :test condition seems to completely not exist in the network.  Gist with the pretty-printed network: </span><a href="https://gist.github.com/WilliamParker/a3adaa3db730229bc01586009bb7178a" target="_blank">https://gist.github.com/WilliamParker/a3adaa3db730229bc01586009bb7178a</a></div><div id="t1510605320000445" t="2017-11-13 20:35:20 wparker However, if I use join-filter-equals it is there:  https://gist.github.com/WilliamParker/347ba6ca3f7e0afc2c9f183e0731111e"><a href="#t1510605320000445" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-11-13</span> <span class="t" onclick="H(this)">20:35:20</span>                 wparker </span><span>However, if I use join-filter-equals it is there: </span><a href="https://gist.github.com/WilliamParker/347ba6ca3f7e0afc2c9f183e0731111e" target="_blank">https://gist.github.com/WilliamParker/347ba6ca3f7e0afc2c9f183e0731111e</a></div><div id="t1510605355000060" t="2017-11-13 20:35:55 wparker Join-filter-equals just dispatches to =:"><a href="#t1510605355000060" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-11-13</span> <span class="t" onclick="H(this)">20:35:55</span>                 wparker </span><span>Join-filter-equals just dispatches to =:</span></div><div id="t1510605370000365" t="2017-11-13 20:36:10 wparker (defn join-filter-equals
  &quot;Intended to be a test function that is the same as equals, but is not visible to Clara as such
  and thus forces usage of join filters instead of hash joins&quot;
  [&amp; args]
  (apply = args))   it is a helper function for Clara’s tests"><a href="#t1510605370000365" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-11-13</span> <span class="t" onclick="H(this)">20:36:10</span>                 wparker </span><pre>(defn join-filter-equals
  &quot;Intended to be a test function that is the same as equals, but is not visible to Clara as such
  and thus forces usage of join filters instead of hash joins&quot;
  [&amp; args]
  (apply = args)) </pre><span> it is a helper function for Clara’s tests</span></div><div id="t1510605386000367" t="2017-11-13 20:36:26 wparker Same idea really as wrapping in a do like @mikerod did"><a href="#t1510605386000367" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-11-13</span> <span class="t" onclick="H(this)">20:36:26</span>                 wparker </span><span>Same idea really as wrapping in a do like @mikerod did</span></div><div id="t1510605534000346" t="2017-11-13 20:38:54 wparker Clara has special cases around constraints having = as the first symbol in order to create variable bindings, but when the first symbol is something else if becomes a “normal” call to clojure.core/=.  @zylox is probably on the right track here with looking at different paths depending on whether equality-expression? returns true"><a href="#t1510605534000346" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-11-13</span> <span class="t" onclick="H(this)">20:38:54</span>                 wparker </span><span>Clara has special cases around constraints having = as the first symbol in order to create variable bindings, but when the first symbol is something else if becomes a “normal” call to clojure.core/=.  @zylox is probably on the right track here with looking at different paths depending on whether equality-expression? returns true</span></div><div id="t1510605620000188" t="2017-11-13 20:40:20 wparker I’ll need to look more closely at it to have an informed opinion on the exact cause and what to do about it but this does look like a bug to me @dave.dixon You should be able to avoid it for the moment with strategies that prevent = from being the first symbol in a :test constraint for the moment though"><a href="#t1510605620000188" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-11-13</span> <span class="t" onclick="H(this)">20:40:20</span>                 wparker </span><span>I’ll need to look more closely at it to have an informed opinion on the exact cause and what to do about it but this does look like a bug to me @dave.dixon You should be able to avoid it for the moment with strategies that prevent = from being the first symbol in a :test constraint for the moment though</span></div><div id="t1510611235000180" t="2017-11-13 22:13:55 wparker I logged  https://github.com/cerner/clara-rules/issues/357  for this @dave.dixon @zylox @mikerod"><a href="#t1510611235000180" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-11-13</span> <span class="t" onclick="H(this)">22:13:55</span>                 wparker </span><span>I logged </span><a href="https://github.com/cerner/clara-rules/issues/357" target="_blank">https://github.com/cerner/clara-rules/issues/357</a><span> for this @dave.dixon @zylox @mikerod</span></div><div id="t1510611319000355" t="2017-11-13 22:15:19 mikerod @wparker thanks for making it"><a href="#t1510611319000355" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-11-13</span> <span class="t" onclick="H(this)">22:15:19</span>                 mikerod </span><span>@wparker thanks for making it</span></div><div id="t1510611330000175" t="2017-11-13 22:15:30 mikerod the only thing maybe worth adding is my comment showing how the sort conditions comes out incorrect"><a href="#t1510611330000175" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-11-13</span> <span class="t" onclick="H(this)">22:15:30</span>                 mikerod </span><span>the only thing maybe worth adding is my comment showing how the sort conditions comes out incorrect</span></div><div id="t1510611344000584" t="2017-11-13 22:15:44 mikerod I can add as a comment though, or perhaps it isn’t necessary since everyone looking at it already knows anyways  😛"><a href="#t1510611344000584" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-11-13</span> <span class="t" onclick="H(this)">22:15:44</span>                 mikerod </span><span>I can add as a comment though, or perhaps it isn’t necessary since everyone looking at it already knows anyways </span><b>😛</b></div><div id="t1510611346000605" t="2017-11-13 22:15:46 wparker Feel free to comment on it with thoughts anyone  🙂"><a href="#t1510611346000605" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-11-13</span> <span class="t" onclick="H(this)">22:15:46</span>                 wparker </span><span>Feel free to comment on it with thoughts anyone </span><b>🙂</b></div><div id="t1510611378000373" t="2017-11-13 22:16:18 wparker I haven’t dug too deeply into it yet"><a href="#t1510611378000373" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-11-13</span> <span class="t" onclick="H(this)">22:16:18</span>                 wparker </span><span>I haven’t dug too deeply into it yet</span></div><div id="t1510611917000169" t="2017-11-13 22:25:17 mikerod same"><a href="#t1510611917000169" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-11-13</span> <span class="t" onclick="H(this)">22:25:17</span>                 mikerod </span><span>same</span></div><div id="t1510683671000531" t="2017-11-14 18:21:11 zylox when are you getting that exception"><a href="#t1510683671000531" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-11-14</span> <span class="t" onclick="H(this)">18:21:11</span>                   zylox </span><span>when are you getting that exception</span></div><div id="t1510683819000605" t="2017-11-14 18:23:39 zylox session creation time it would appear"><a href="#t1510683819000605" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-11-14</span> <span class="t" onclick="H(this)">18:23:39</span>                   zylox </span><span>session creation time it would appear</span></div><div id="t1510684393000157" t="2017-11-14 18:33:13 sparkofreason Yes, it&apos;s at session creation."><a href="#t1510684393000157" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-11-14</span> <span class="t" onclick="H(this)">18:33:13</span>           sparkofreason </span><span>Yes, it&apos;s at session creation.</span></div><div id="t1510684591000118" t="2017-11-14 18:36:31 zylox ya  sort-conditions  specifically it would appear. im not as versed on queries though"><a href="#t1510684591000118" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-11-14</span> <span class="t" onclick="H(this)">18:36:31</span>                   zylox </span><span>ya </span><code>sort-conditions</code><span> specifically it would appear. im not as versed on queries though</span></div><div id="t1510684641000303" t="2017-11-14 18:37:21 zylox i cant get parameters to work unless they are used in a binding though. that doesnt seem right."><a href="#t1510684641000303" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-11-14</span> <span class="t" onclick="H(this)">18:37:21</span>                   zylox </span><span>i cant get parameters to work unless they are used in a binding though. that doesnt seem right.</span></div><div id="t1510685119000095" t="2017-11-14 18:45:19 zylox (clara.rules/defquery ship-destroyed-at?
          [:?point]
          [?destroyed &lt;- Destroyed (= ?ship ship)]
          [?placement &lt;- ValidPlacement 
           (= ?ship ship)
           ((spaces this) ?point)])  for the record this doesnt seem to work either so its not the test node"><a href="#t1510685119000095" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-11-14</span> <span class="t" onclick="H(this)">18:45:19</span>                   zylox </span><pre>(clara.rules/defquery ship-destroyed-at?
          [:?point]
          [?destroyed &lt;- Destroyed (= ?ship ship)]
          [?placement &lt;- ValidPlacement 
           (= ?ship ship)
           ((spaces this) ?point)])</pre><span> for the record this doesnt seem to work either so its not the test node</span></div><div id="t1510685144000179" t="2017-11-14 18:45:44 mikerod Yeah, my first recommendation was going to be to not use a  :test  node when it isn’t necessary (although I’d still expect that to work)"><a href="#t1510685144000179" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-11-14</span> <span class="t" onclick="H(this)">18:45:44</span>                 mikerod </span><span>Yeah, my first recommendation was going to be to not use a </span><code>:test</code><span> node when it isn’t necessary (although I’d still expect that to work)</span></div><div id="t1510685156000448" t="2017-11-14 18:45:56 mikerod However, @zylox has found that that is still a problem"><a href="#t1510685156000448" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-11-14</span> <span class="t" onclick="H(this)">18:45:56</span>                 mikerod </span><span>However, @zylox has found that that is still a problem</span></div><div id="t1510685254000574" t="2017-11-14 18:47:34 zylox if i had to guess, the check this exception uses is too special cased and doesnt consider parameters."><a href="#t1510685254000574" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-11-14</span> <span class="t" onclick="H(this)">18:47:34</span>                   zylox </span><span>if i had to guess, the check this exception uses is too special cased and doesnt consider parameters.</span></div><div id="t1510685278000377" t="2017-11-14 18:47:58 zylox its the whole unbound vs bound thing again"><a href="#t1510685278000377" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-11-14</span> <span class="t" onclick="H(this)">18:47:58</span>                   zylox </span><span>its the whole unbound vs bound thing again</span></div><div id="t1510685289000415" t="2017-11-14 18:48:09 zylox so its at least partially related to the thing from yesterday"><a href="#t1510685289000415" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-11-14</span> <span class="t" onclick="H(this)">18:48:09</span>                   zylox </span><span>so its at least partially related to the thing from yesterday</span></div><div id="t1510685519000397" t="2017-11-14 18:51:59 ryanbrush The above queries won&apos;t work because ?point is not bound, although we could be more clear in our error messaging here."><a href="#t1510685519000397" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-11-14</span> <span class="t" onclick="H(this)">18:51:59</span>               ryanbrush </span><span>The above queries won&apos;t work because ?point is not bound, although we could be more clear in our error messaging here.</span></div><div id="t1510685558000080" t="2017-11-14 18:52:38 ryanbrush The :?point is a query parameter, which just does a lookup. A query parameter is not &quot;bound&quot; when the rule engine is processing...it is simple used to look up bound values."><a href="#t1510685558000080" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-11-14</span> <span class="t" onclick="H(this)">18:52:38</span>               ryanbrush </span><span>The :?point is a query parameter, which just does a lookup. A query parameter is not &quot;bound&quot; when the rule engine is processing...it is simple used to look up bound values.</span></div><div id="t1510685575000652" t="2017-11-14 18:52:55 ryanbrush Since ?point is never bound in the query itself, we get that error message."><a href="#t1510685575000652" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-11-14</span> <span class="t" onclick="H(this)">18:52:55</span>               ryanbrush </span><span>Since ?point is never bound in the query itself, we get that error message.</span></div><div id="t1510685655000323" t="2017-11-14 18:54:15 ryanbrush These semantics are a bit confusing in this case because we&apos;re conflating query parameters (which do not bind a variable) with variables that must be bound with an (= ?my-variable ...) or similar expression."><a href="#t1510685655000323" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-11-14</span> <span class="t" onclick="H(this)">18:54:15</span>               ryanbrush </span><span>These semantics are a bit confusing in this case because we&apos;re conflating query parameters (which do not bind a variable) with variables that must be bound with an (= ?my-variable ...) or similar expression.</span></div><div id="t1510685938000695" t="2017-11-14 18:58:58 mikerod Woops, that makes sense to me. I blanked about how they were supposed to work here."><a href="#t1510685938000695" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-11-14</span> <span class="t" onclick="H(this)">18:58:58</span>                 mikerod </span><span>Woops, that makes sense to me. I blanked about how they were supposed to work here.</span></div><div id="t1510686024000237" t="2017-11-14 19:00:24 sparkofreason So presumably the way to attack this is to make a new fact using those conditions, rather than trying to just query?"><a href="#t1510686024000237" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-11-14</span> <span class="t" onclick="H(this)">19:00:24</span>           sparkofreason </span><span>So presumably the way to attack this is to make a new fact using those conditions, rather than trying to just query?</span></div><div id="t1510686367000388" t="2017-11-14 19:06:07 zylox Clearly I need to brush up on queries"><a href="#t1510686367000388" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-11-14</span> <span class="t" onclick="H(this)">19:06:07</span>                   zylox </span><span>Clearly I need to brush up on queries</span></div><div id="t1510686374000235" t="2017-11-14 19:06:14 zylox ...pun not intended"><a href="#t1510686374000235" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-11-14</span> <span class="t" onclick="H(this)">19:06:14</span>                   zylox </span><span>...pun not intended</span></div><div id="t1510688310000255" t="2017-11-14 19:38:30 ryanbrush @dave.dixon Separating this out into another fact makes sense. I&apos;m not quite sure what your objective for these rules is, but any approach that explicitly binds ?point in the query logic (not just the parameter) should work."><a href="#t1510688310000255" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-11-14</span> <span class="t" onclick="H(this)">19:38:30</span>               ryanbrush </span><span>@dave.dixon Separating this out into another fact makes sense. I&apos;m not quite sure what your objective for these rules is, but any approach that explicitly binds ?point in the query logic (not just the parameter) should work.</span></div><div id="t1510700611000327" t="2017-11-14 23:03:31 sparkofreason That worked great, thanks."><a href="#t1510700611000327" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-11-14</span> <span class="t" onclick="H(this)">23:03:31</span>           sparkofreason </span><span>That worked great, thanks.</span></div><div id="t1511130583000122" t="2017-11-19 22:29:43 sparkofreason Sorry if this is documented somewhere, but I didn&apos;t catch it. Is there some best practice around handling fact identity for updates? For example, if have  (defrecord Person [name address]) , and I want to update the address, or perhaps even insert the same  Person  (by value) twice. Is there some way to tell clara to use  name  to identify the Person and change the replace the existing fact, or do I have to explicitly retract the existing instance? Or am I totally missing something for modeling this situation?"><a href="#t1511130583000122" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-11-19</span> <span class="t" onclick="H(this)">22:29:43</span>           sparkofreason </span><span>Sorry if this is documented somewhere, but I didn&apos;t catch it. Is there some best practice around handling fact identity for updates? For example, if have </span><code>(defrecord Person [name address])</code><span>, and I want to update the address, or perhaps even insert the same </span><code>Person</code><span> (by value) twice. Is there some way to tell clara to use </span><code>name</code><span> to identify the Person and change the replace the existing fact, or do I have to explicitly retract the existing instance? Or am I totally missing something for modeling this situation?</span></div><div id="t1511134251000023" t="2017-11-19 23:30:51 mikerod &gt; do I have to explicitly retract the existing instance?
Yes, the idea is to do this sort of change explicitly"><a href="#t1511134251000023" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-11-19</span> <span class="t" onclick="H(this)">23:30:51</span>                 mikerod </span><span>&gt; do I have to explicitly retract the existing instance?
Yes, the idea is to do this sort of change explicitly</span></div><div id="t1511134260000016" t="2017-11-19 23:31:00 mikerod and there is no concept of mutating a fact “in place”"><a href="#t1511134260000016" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-11-19</span> <span class="t" onclick="H(this)">23:31:00</span>                 mikerod </span><span>and there is no concept of mutating a fact “in place”</span></div><div id="t1511134276000121" t="2017-11-19 23:31:16 mikerod There are several ways to approach the problem"><a href="#t1511134276000121" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-11-19</span> <span class="t" onclick="H(this)">23:31:16</span>                 mikerod </span><span>There are several ways to approach the problem</span></div><div id="t1511134460000088" t="2017-11-19 23:34:20 mikerod @dave.dixon one idea is if you don’t actually care about deleting old data (perhaps you want to have it for historical rules etc), you could put an intermediary between external “person data at a point in time” vs the “current person” being processed:
 (r/defrule current-person
  [?latest &lt;- latest-person-acc :from [PersonSnapshot (= ?name name)]]
  =&gt;
  (r/insert! (-&gt;Person ?latest)))
"><a href="#t1511134460000088" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-11-19</span> <span class="t" onclick="H(this)">23:34:20</span>                 mikerod </span><span>@dave.dixon one idea is if you don’t actually care about deleting old data (perhaps you want to have it for historical rules etc), you could put an intermediary between external “person data at a point in time” vs the “current person” being processed:
</span><pre>(r/defrule current-person
  [?latest &lt;- latest-person-acc :from [PersonSnapshot (= ?name name)]]
  =&gt;
  (r/insert! (-&gt;Person ?latest)))
</pre></div><div id="t1511134483000134" t="2017-11-19 23:34:43 mikerod This is if you made some sort of  latest-person-acc  that chose the latest by some criteria of yours (like a  PersonSnapshot  timestamp)"><a href="#t1511134483000134" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-11-19</span> <span class="t" onclick="H(this)">23:34:43</span>                 mikerod </span><span>This is if you made some sort of </span><code>latest-person-acc</code><span> that chose the latest by some criteria of yours (like a </span><code>PersonSnapshot</code><span> timestamp)</span></div><div id="t1511134496000016" t="2017-11-19 23:34:56 mikerod You could use the  clara.rules.accumulators/max  for this"><a href="#t1511134496000016" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-11-19</span> <span class="t" onclick="H(this)">23:34:56</span>                 mikerod </span><span>You could use the </span><code>clara.rules.accumulators/max</code><span> for this</span></div><div id="t1511134516000105" t="2017-11-19 23:35:16 mikerod (r/defrule current-person
  [?latest &lt;- (acc/max :timestamp) :from [PersonSnapshot (= ?name name)]]
  =&gt;
  (r/insert! (-&gt;Person ?latest)))
"><a href="#t1511134516000105" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-11-19</span> <span class="t" onclick="H(this)">23:35:16</span>                 mikerod </span><pre>(r/defrule current-person
  [?latest &lt;- (acc/max :timestamp) :from [PersonSnapshot (= ?name name)]]
  =&gt;
  (r/insert! (-&gt;Person ?latest)))
</pre></div><div id="t1511134580000018" t="2017-11-19 23:36:20 mikerod You may not want to leave facts in though due to a concern, like memory use or something. Then a common way to deal with the update is somewhat external to the rules processing themselves"><a href="#t1511134580000018" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-11-19</span> <span class="t" onclick="H(this)">23:36:20</span>                 mikerod </span><span>You may not want to leave facts in though due to a concern, like memory use or something. Then a common way to deal with the update is somewhat external to the rules processing themselves</span></div><div id="t1511135317000013" t="2017-11-19 23:48:37 mikerod (defrecord Person [name x])

(r/defquery person-with-name [:?name]
  [?p &lt;- Person (= ?name name)])

(def init
  (-&gt; (r/mk-session [person-with-name])
      (r/insert (-&gt;Person &quot;joe&quot; 10)
                (-&gt;Person &quot;mary&quot; 20))
      r/fire-rules))

(defn find-person-by-name [session pname]
  ;; Assumes name is unique (you could do something different)
  (-&gt; session
      (r/query person-with-name :?name pname)
      first
      :?p))

(defn update-person [session new-person]
  (let [existing (find-person-by-name session (:name new-person))]
    (-&gt; session
        (r/retract existing)
        (r/insert new-person)
        r/fire-rules)))

(def updated
  (update-person init (-&gt;Person &quot;joe&quot; 50)))



;; Then try:

(find-person-by-name init &quot;joe&quot;)
(find-person-by-name updated &quot;joe&quot;)
"><a href="#t1511135317000013" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-11-19</span> <span class="t" onclick="H(this)">23:48:37</span>                 mikerod </span><pre>(defrecord Person [name x])

(r/defquery person-with-name [:?name]
  [?p &lt;- Person (= ?name name)])

(def init
  (-&gt; (r/mk-session [person-with-name])
      (r/insert (-&gt;Person &quot;joe&quot; 10)
                (-&gt;Person &quot;mary&quot; 20))
      r/fire-rules))

(defn find-person-by-name [session pname]
  ;; Assumes name is unique (you could do something different)
  (-&gt; session
      (r/query person-with-name :?name pname)
      first
      :?p))

(defn update-person [session new-person]
  (let [existing (find-person-by-name session (:name new-person))]
    (-&gt; session
        (r/retract existing)
        (r/insert new-person)
        r/fire-rules)))

(def updated
  (update-person init (-&gt;Person &quot;joe&quot; 50)))



;; Then try:

(find-person-by-name init &quot;joe&quot;)
(find-person-by-name updated &quot;joe&quot;)
</pre></div><div id="t1511135344000058" t="2017-11-19 23:49:04 mikerod That sort of pattern would allow you take rm and old version of the person and insert an update"><a href="#t1511135344000058" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-11-19</span> <span class="t" onclick="H(this)">23:49:04</span>                 mikerod </span><span>That sort of pattern would allow you take rm and old version of the person and insert an update</span></div><div id="t1511135377000018" t="2017-11-19 23:49:37 mikerod and it avoids getting into situations within the engine where you have to deal with logical loops in the truth maintenance system and/or unconditional inserts, RHS retracts, etc"><a href="#t1511135377000018" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-11-19</span> <span class="t" onclick="H(this)">23:49:37</span>                 mikerod </span><span>and it avoids getting into situations within the engine where you have to deal with logical loops in the truth maintenance system and/or unconditional inserts, RHS retracts, etc</span></div><div id="t1511135405000123" t="2017-11-19 23:50:05 mikerod You could impl the  update-person  differently where you just make a change to the  existing  fact to get some data structural sharing too though instead of a brand new fact like I had"><a href="#t1511135405000123" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-11-19</span> <span class="t" onclick="H(this)">23:50:05</span>                 mikerod </span><span>You could impl the </span><code>update-person</code><span> differently where you just make a change to the </span><code>existing</code><span> fact to get some data structural sharing too though instead of a brand new fact like I had</span></div><div id="t1511135561000038" t="2017-11-19 23:52:41 mikerod e.g.
 (defn update-person [session new-person-data]
  (let [existing (find-person-by-name session (:name new-person-data))
        up (merge existing new-person-data)]
    (-&gt; session
        (r/retract existing)
        (r/insert up)
        r/fire-rules)))

;; e.g.
(update-person init {:name &quot;joe&quot; :x 50})

"><a href="#t1511135561000038" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-11-19</span> <span class="t" onclick="H(this)">23:52:41</span>                 mikerod </span><span>e.g.
</span><pre>(defn update-person [session new-person-data]
  (let [existing (find-person-by-name session (:name new-person-data))
        up (merge existing new-person-data)]
    (-&gt; session
        (r/retract existing)
        (r/insert up)
        r/fire-rules)))

;; e.g.
(update-person init {:name &quot;joe&quot; :x 50})

</pre></div><div id="t1511137909000026" t="2017-11-20 00:31:49 sparkofreason @mikerod Thanks for the excellent and detailed answer!"><a href="#t1511137909000026" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-11-20</span> <span class="t" onclick="H(this)">00:31:49</span>           sparkofreason </span><span>@mikerod Thanks for the excellent and detailed answer!</span></div><div id="t1511458386000173" t="2017-11-23 17:33:06 sparkofreason I think I found the problem. The call to  resolve-vars  at  https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/macros.clj#L183  only binds the Clojure namespace. At this point in compilation, the CLJS namespace is not correct. Adding this to the binding fixes the issue:  cljs.analyzer/*cljs-ns* (:ns-name production)"><a href="#t1511458386000173" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-11-23</span> <span class="t" onclick="H(this)">17:33:06</span>           sparkofreason </span><span>I think I found the problem. The call to </span><code>resolve-vars</code><span> at </span><a href="https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/macros.clj#L183" target="_blank">https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/macros.clj#L183</a><span> only binds the Clojure namespace. At this point in compilation, the CLJS namespace is not correct. Adding this to the binding fixes the issue: </span><code>cljs.analyzer/*cljs-ns* (:ns-name production)</code></div><div id="t1512222685000087" t="2017-12-02 13:51:25 mikerod It’s on Twitter, but I thought it was cool enough to share here too:
 Clara on the ThoughtWorks Technology Radar
 https://www.thoughtworks.com/es/radar/languages-and-frameworks/clara-rules"><a href="#t1512222685000087" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-02</span> <span class="t" onclick="H(this)">13:51:25</span>                 mikerod </span><span>It’s on Twitter, but I thought it was cool enough to share here too:
 Clara on the ThoughtWorks Technology Radar
</span><a href="https://www.thoughtworks.com/es/radar/languages-and-frameworks/clara-rules" target="_blank">https://www.thoughtworks.com/es/radar/languages-and-frameworks/clara-rules</a></div><div id="t1512259163000059" t="2017-12-02 23:59:23 alex-dixon Just came to say congratulations!"><a href="#t1512259163000059" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-02</span> <span class="t" onclick="H(this)">23:59:23</span>              alex-dixon </span><span>Just came to say congratulations!</span></div><div id="t1513195889000463" t="2017-12-13 20:11:29 dadair Is there any way to get  cloverage  coverage statistics for clara defrules?"><a href="#t1513195889000463" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-13</span> <span class="t" onclick="H(this)">20:11:29</span>                  dadair </span><span>Is there any way to get </span><code>cloverage</code><span> coverage statistics for clara defrules?</span></div><div id="t1513205257000130" t="2017-12-13 22:47:37 wparker I suspect that Clara does enough code generation and evaluation behind the scenes to confuse tooling like Cloverage, at least without some modification to specifically support Clara, but it isn’t something I’ve looked into.  I don’t think the rules network could be effectively statically analyzed but perhaps something could be created that looked at what rules were interacted with; that information is available via Clara’s tracing"><a href="#t1513205257000130" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-13</span> <span class="t" onclick="H(this)">22:47:37</span>                      wparker </span><span>I suspect that Clara does enough code generation and evaluation behind the scenes to confuse tooling like Cloverage, at least without some modification to specifically support Clara, but it isn’t something I’ve looked into.  I don’t think the rules network could be effectively statically analyzed but perhaps something could be created that looked at what rules were interacted with; that information is available via Clara’s tracing</span></div><div id="t1513216619000082" t="2017-12-14 01:56:59 mikerod I’m not even sure how Cloverage performs its analysis. Is it via  tools.analyzer  ?"><a href="#t1513216619000082" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-14</span> <span class="t" onclick="H(this)">01:56:59</span>                      mikerod </span><span>I’m not even sure how Cloverage performs its analysis. Is it via </span><code>tools.analyzer</code><span> ?</span></div><div id="t1513275373000124" t="2017-12-14 18:16:13 dadair I&apos;m not exactly sure how it works; but a search in the repo for  tools.analyzer  returns empty"><a href="#t1513275373000124" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-14</span> <span class="t" onclick="H(this)">18:16:13</span>                       dadair </span><span>I&apos;m not exactly sure how it works; but a search in the repo for </span><code>tools.analyzer</code><span> returns empty</span></div><div id="t1513275421000058" t="2017-12-14 18:17:01 dadair I&apos;m mostly just interested in seeing what rules are firing during tests, to make sure I have sufficient tests."><a href="#t1513275421000058" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-14</span> <span class="t" onclick="H(this)">18:17:01</span>                       dadair </span><span>I&apos;m mostly just interested in seeing what rules are firing during tests, to make sure I have sufficient tests.</span></div><div id="t1513282221000391" t="2017-12-14 20:10:21 devn @U0E2EQFME you could do some reading of the inspected session "><a href="#t1513282221000391" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-14</span> <span class="t" onclick="H(this)">20:10:21</span>                         devn </span><span>@U0E2EQFME you could do some reading of the inspected session </span></div><div id="t1513282235000182" t="2017-12-14 20:10:35 devn Or maybe attach a tracing listener to track the rules fired "><a href="#t1513282235000182" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-14</span> <span class="t" onclick="H(this)">20:10:35</span>                         devn </span><span>Or maybe attach a tracing listener to track the rules fired </span></div><div id="t1513282249000350" t="2017-12-14 20:10:49 devn That information should be available via either method "><a href="#t1513282249000350" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-14</span> <span class="t" onclick="H(this)">20:10:49</span>                         devn </span><span>That information should be available via either method </span></div><div id="t1513282818000020" t="2017-12-14 20:20:18 mikerod Yeah, I think I looked at it before and it didn’t use analyzer. Not sure how it can check coverage. Especially via macros."><a href="#t1513282818000020" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-14</span> <span class="t" onclick="H(this)">20:20:18</span>                      mikerod </span><span>Yeah, I think I looked at it before and it didn’t use analyzer. Not sure how it can check coverage. Especially via macros.</span></div><div id="t1513282823000138" t="2017-12-14 20:20:23 mikerod perhaps magic"><a href="#t1513282823000138" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-14</span> <span class="t" onclick="H(this)">20:20:23</span>                      mikerod </span><span>perhaps magic</span></div><div id="t1513713887000030" t="2017-12-19 20:04:47 mikerod @amarjeet you cut it off I think"><a href="#t1513713887000030" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-19</span> <span class="t" onclick="H(this)">20:04:47</span>                 mikerod </span><span>@amarjeet you cut it off I think</span></div><div id="t1513714044000174" t="2017-12-19 20:07:24 mikerod It only shows about 5 lines"><a href="#t1513714044000174" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-19</span> <span class="t" onclick="H(this)">20:07:24</span>                 mikerod </span><span>It only shows about 5 lines</span></div><div id="t1513718856000458" t="2017-12-19 21:27:36 wparker @mikerod I can see a larger snippet after I expand it in my OS X Slack client.  @amarjeet I’d have to see lines creating sessions and inserting facts to fully understand what you’re doing, but it sounds like you may believe that a fact {:some :value} will match a condition like [{:some :value}].  This is not the case; Clara uses the fact type, not the fact itself, to match on conditions.  So for example {:some :value} would match [java.util.Map] by default, though you can customize the function used for this dispatch.  This is documented at  http://clara-rules.org ; I can’t hit the site right now but the page’s markdown source is  https://github.com/cerner/clara-site/blob/gh-pages/_docs/fact_type_customization.md"><a href="#t1513718856000458" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-19</span> <span class="t" onclick="H(this)">21:27:36</span>                 wparker </span><span>@mikerod I can see a larger snippet after I expand it in my OS X Slack client.  @amarjeet I’d have to see lines creating sessions and inserting facts to fully understand what you’re doing, but it sounds like you may believe that a fact {:some :value} will match a condition like [{:some :value}].  This is not the case; Clara uses the fact type, not the fact itself, to match on conditions.  So for example {:some :value} would match [java.util.Map] by default, though you can customize the function used for this dispatch.  This is documented at </span><a href="http://clara-rules.org" target="_blank">http://clara-rules.org</a><span>; I can’t hit the site right now but the page’s markdown source is </span><a href="https://github.com/cerner/clara-site/blob/gh-pages/_docs/fact_type_customization.md" target="_blank">https://github.com/cerner/clara-site/blob/gh-pages/_docs/fact_type_customization.md</a></div><div id="t1513718926000357" t="2017-12-19 21:28:46 mikerod @wparker I can see it on the side bar (same client as you), not sure why it won’t expand otherwise. Anyways, irrelevant than woops."><a href="#t1513718926000357" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-19</span> <span class="t" onclick="H(this)">21:28:46</span>                 mikerod </span><span>@wparker I can see it on the side bar (same client as you), not sure why it won’t expand otherwise. Anyways, irrelevant than woops.</span></div><div id="t1513749033000052" t="2017-12-20 05:50:33 amarjeet @wparker"><a href="#t1513749033000052" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-20</span> <span class="t" onclick="H(this)">05:50:33</span>                amarjeet </span><span>@wparker</span></div><div id="t1513781437000067" t="2017-12-20 14:50:37 mikerod @amarjeet thatnks for sharing more there"><a href="#t1513781437000067" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-20</span> <span class="t" onclick="H(this)">14:50:37</span>                 mikerod </span><span>@amarjeet thatnks for sharing more there</span></div><div id="t1513781453000055" t="2017-12-20 14:50:53 mikerod So the first level of discrimination in the rules network is going always “fact type”"><a href="#t1513781453000055" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-20</span> <span class="t" onclick="H(this)">14:50:53</span>                 mikerod </span><span>So the first level of discrimination in the rules network is going always “fact type”</span></div><div id="t1513781468000609" t="2017-12-20 14:51:08 mikerod However, the combination of  :fact-type-fn  and  :ancestors-fn  give you flexibility into what that means"><a href="#t1513781468000609" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-20</span> <span class="t" onclick="H(this)">14:51:08</span>                 mikerod </span><span>However, the combination of </span><code>:fact-type-fn</code><span> and </span><code>:ancestors-fn</code><span> give you flexibility into what that means</span></div><div id="t1513781539000139" t="2017-12-20 14:52:19 mikerod The default  :fact-type-fn  is Clojure’s  clojure.core/type , which is just  (or (get (meta x) :type) (class x))"><a href="#t1513781539000139" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-20</span> <span class="t" onclick="H(this)">14:52:19</span>                 mikerod </span><span>The default </span><code>:fact-type-fn</code><span> is Clojure’s </span><code>clojure.core/type</code><span>, which is just </span><code>(or (get (meta x) :type) (class x))</code></div><div id="t1513781560000314" t="2017-12-20 14:52:40 mikerod The default  :ancestors-fn  is  clojure.core/ancestors  which respects the “global hierarchy” in Clj which can be altered via things like  derive"><a href="#t1513781560000314" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-20</span> <span class="t" onclick="H(this)">14:52:40</span>                 mikerod </span><span>The default </span><code>:ancestors-fn</code><span> is </span><code>clojure.core/ancestors</code><span> which respects the “global hierarchy” in Clj which can be altered via things like </span><code>derive</code></div><div id="t1513781585000089" t="2017-12-20 14:53:05 mikerod :ancestors-fn  is just for making the supertype subtype relationships that factor into the fact type dispatch"><a href="#t1513781585000089" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-20</span> <span class="t" onclick="H(this)">14:53:05</span>                 mikerod </span><code>:ancestors-fn</code><span> is just for making the supertype subtype relationships that factor into the fact type dispatch</span></div><div id="t1513781615000035" t="2017-12-20 14:53:35 mikerod You don’t necessarily have to have a “fact type” if you really don’t want, or you can make it something that is based on the data of the map entities you have"><a href="#t1513781615000035" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-20</span> <span class="t" onclick="H(this)">14:53:35</span>                 mikerod </span><span>You don’t necessarily have to have a “fact type” if you really don’t want, or you can make it something that is based on the data of the map entities you have</span></div><div id="t1513781693000040" t="2017-12-20 14:54:53 mikerod (def session-one (mk-session &apos;modelxt.absmodel :fact-type :name)) 
for example, although that isn’t very suitable for the rule  add-entity  that you have"><a href="#t1513781693000040" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-20</span> <span class="t" onclick="H(this)">14:54:53</span>                 mikerod </span><code>(def session-one (mk-session &apos;modelxt.absmodel :fact-type :name))</code><span>
for example, although that isn’t very suitable for the rule </span><code>add-entity</code><span> that you have</span></div><div id="t1513785800000667" t="2017-12-20 16:03:20 amarjeet hmm, understood"><a href="#t1513785800000667" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-20</span> <span class="t" onclick="H(this)">16:03:20</span>                amarjeet </span><span>hmm, understood</span></div><div id="t1513785897000870" t="2017-12-20 16:04:57 amarjeet Will re-look at the fact-type-fn/ancestors-fn"><a href="#t1513785897000870" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-20</span> <span class="t" onclick="H(this)">16:04:57</span>                amarjeet </span><span>Will re-look at the fact-type-fn/ancestors-fn</span></div><div id="t1513785906000473" t="2017-12-20 16:05:06 amarjeet thanks @mikerod"><a href="#t1513785906000473" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-20</span> <span class="t" onclick="H(this)">16:05:06</span>                amarjeet </span><span>thanks @mikerod</span></div><div id="t1513786135000262" t="2017-12-20 16:08:55 mikerod No problem"><a href="#t1513786135000262" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-20</span> <span class="t" onclick="H(this)">16:08:55</span>                 mikerod </span><span>No problem</span></div><div id="t1513908170000138" t="2017-12-22 02:02:50 cfleming Is Clara’s fact destructuring as described here:  http://www.clara-rules.org/docs/expressions/  the same as Clojure’s destructuring?"><a href="#t1513908170000138" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-22</span> <span class="t" onclick="H(this)">02:02:50</span>                cfleming </span><span>Is Clara’s fact destructuring as described here: </span><a href="http://www.clara-rules.org/docs/expressions/" target="_blank">http://www.clara-rules.org/docs/expressions/</a><span> the same as Clojure’s destructuring?</span></div><div id="t1513909055000115" t="2017-12-22 02:17:35 mikerod @cfleming the part of the syntax shown there uses Clojure destructuring. It basically ends up being a clojure function arglist that takes a single object. "><a href="#t1513909055000115" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-22</span> <span class="t" onclick="H(this)">02:17:35</span>                 mikerod </span><span>@cfleming the part of the syntax shown there uses Clojure destructuring. It basically ends up being a clojure function arglist that takes a single object. </span></div><div id="t1513909080000068" t="2017-12-22 02:18:00 mikerod But yes. It just “flows through” to standard destructuring. "><a href="#t1513909080000068" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-22</span> <span class="t" onclick="H(this)">02:18:00</span>                 mikerod </span><span>But yes. It just “flows through” to standard destructuring. </span></div><div id="t1513909084000011" t="2017-12-22 02:18:04 cfleming Ok, great, thanks."><a href="#t1513909084000011" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-22</span> <span class="t" onclick="H(this)">02:18:04</span>                cfleming </span><span>Ok, great, thanks.</span></div><div id="t1513909120000127" t="2017-12-22 02:18:40 mikerod No problem. "><a href="#t1513909120000127" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-22</span> <span class="t" onclick="H(this)">02:18:40</span>                 mikerod </span><span>No problem. </span></div><div id="t1513909459000080" t="2017-12-22 02:24:19 cfleming @mikerod One more question while I have you - in the doc, is  FACT_CONSTRAINT  always a Fact Expression as defined in the doc, or is it any condition?"><a href="#t1513909459000080" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-22</span> <span class="t" onclick="H(this)">02:24:19</span>                cfleming </span><span>@mikerod One more question while I have you - in the doc, is </span><code>FACT_CONSTRAINT</code><span> always a Fact Expression as defined in the doc, or is it any condition?</span></div><div id="t1513909505000172" t="2017-12-22 02:25:05 cfleming (I’m working on specs for the Clara macros right now)"><a href="#t1513909505000172" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-22</span> <span class="t" onclick="H(this)">02:25:05</span>                cfleming </span><span>(I’m working on specs for the Clara macros right now)</span></div><div id="t1513909645000032" t="2017-12-22 02:27:25 mikerod taking a look"><a href="#t1513909645000032" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-22</span> <span class="t" onclick="H(this)">02:27:25</span>                 mikerod </span><span>taking a look</span></div><div id="t1513909720000124" t="2017-12-22 02:28:40 mikerod I don’t see a  FACT_CONSTRAINT  referenced in  http://www.clara-rules.org/docs/expressions/  ?"><a href="#t1513909720000124" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-22</span> <span class="t" onclick="H(this)">02:28:40</span>                 mikerod </span><span>I don’t see a </span><code>FACT_CONSTRAINT</code><span> referenced in </span><a href="http://www.clara-rules.org/docs/expressions/" target="_blank">http://www.clara-rules.org/docs/expressions/</a><span> ?</span></div><div id="t1513909731000116" t="2017-12-22 02:28:51 mikerod nevermind see it"><a href="#t1513909731000116" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-22</span> <span class="t" onclick="H(this)">02:28:51</span>                 mikerod </span><span>nevermind see it</span></div><div id="t1513909752000005" t="2017-12-22 02:29:12 cfleming It’s in Boolean Expressions and also Accumulators"><a href="#t1513909752000005" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-22</span> <span class="t" onclick="H(this)">02:29:12</span>                cfleming </span><span>It’s in Boolean Expressions and also Accumulators</span></div><div id="t1513909843000072" t="2017-12-22 02:30:43 mikerod Ok, it is a fact expression as referred to above"><a href="#t1513909843000072" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-22</span> <span class="t" onclick="H(this)">02:30:43</span>                 mikerod </span><span>Ok, it is a fact expression as referred to above</span></div><div id="t1513909860000016" t="2017-12-22 02:31:00 cfleming Great, thanks."><a href="#t1513909860000016" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-22</span> <span class="t" onclick="H(this)">02:31:00</span>                cfleming </span><span>Great, thanks.</span></div><div id="t1513909889000224" t="2017-12-22 02:31:29 cfleming Hopefully I’ll have something basic working soon, I’ll push it for comments - there are still a bunch of TODOs in there."><a href="#t1513909889000224" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-22</span> <span class="t" onclick="H(this)">02:31:29</span>                cfleming </span><span>Hopefully I’ll have something basic working soon, I’ll push it for comments - there are still a bunch of TODOs in there.</span></div><div id="t1513909912000091" t="2017-12-22 02:31:52 mikerod There may be times when it is odd to do something like bind a fact to a variable, but I think the syntax typically allows these cases - even if they don’t end up being useful."><a href="#t1513909912000091" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-22</span> <span class="t" onclick="H(this)">02:31:52</span>                 mikerod </span><span>There may be times when it is odd to do something like bind a fact to a variable, but I think the syntax typically allows these cases - even if they don’t end up being useful.</span></div><div id="t1513909918000008" t="2017-12-22 02:31:58 mikerod That is cool. Sounds interesting"><a href="#t1513909918000008" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-22</span> <span class="t" onclick="H(this)">02:31:58</span>                 mikerod </span><span>That is cool. Sounds interesting</span></div><div id="t1513909935000058" t="2017-12-22 02:32:15 mikerod I’ll try to give a look at it too once you have it out there."><a href="#t1513909935000058" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-22</span> <span class="t" onclick="H(this)">02:32:15</span>                 mikerod </span><span>I’ll try to give a look at it too once you have it out there.</span></div><div id="t1513909942000148" t="2017-12-22 02:32:22 cfleming Great, thanks - this is re:  https://github.com/cerner/clara-rules/issues/367"><a href="#t1513909942000148" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-22</span> <span class="t" onclick="H(this)">02:32:22</span>                cfleming </span><span>Great, thanks - this is re: </span><a href="https://github.com/cerner/clara-rules/issues/367" target="_blank">https://github.com/cerner/clara-rules/issues/367</a></div><div id="t1513909943000008" t="2017-12-22 02:32:23 mikerod I’m still catching up on the GitHub conversation from earlier"><a href="#t1513909943000008" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-22</span> <span class="t" onclick="H(this)">02:32:23</span>                 mikerod </span><span>I’m still catching up on the GitHub conversation from earlier</span></div><div id="t1513909957000158" t="2017-12-22 02:32:37 cfleming Cool, no rush."><a href="#t1513909957000158" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-22</span> <span class="t" onclick="H(this)">02:32:37</span>                cfleming </span><span>Cool, no rush.</span></div><div id="t1513912179000106" t="2017-12-22 03:09:39 cfleming I’ve pushed  https://github.com/cursive-ide/clara-specs"><a href="#t1513912179000106" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-22</span> <span class="t" onclick="H(this)">03:09:39</span>                cfleming </span><span>I’ve pushed </span><a href="https://github.com/cursive-ide/clara-specs" target="_blank">https://github.com/cursive-ide/clara-specs</a></div><div id="t1513912222000151" t="2017-12-22 03:10:22 cfleming It contains a first cut at specs to match the macros in the Clara DSL - they match all the examples from the documentation correctly as far as I can tell."><a href="#t1513912222000151" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-22</span> <span class="t" onclick="H(this)">03:10:22</span>                cfleming </span><span>It contains a first cut at specs to match the macros in the Clara DSL - they match all the examples from the documentation correctly as far as I can tell.</span></div><div id="t1513912245000062" t="2017-12-22 03:10:45 cfleming There are still some TODOs in there which weren’t clear to me from the doc, mostly stubbed out with  any?"><a href="#t1513912245000062" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-22</span> <span class="t" onclick="H(this)">03:10:45</span>                cfleming </span><span>There are still some TODOs in there which weren’t clear to me from the doc, mostly stubbed out with </span><code>any?</code></div><div id="t1513912271000176" t="2017-12-22 03:11:11 cfleming My next task is to try it on the clara-examples repo and make sure it works for the examples there too."><a href="#t1513912271000176" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-22</span> <span class="t" onclick="H(this)">03:11:11</span>                cfleming </span><span>My next task is to try it on the clara-examples repo and make sure it works for the examples there too.</span></div><div id="t1513912324000061" t="2017-12-22 03:12:04 cfleming @alex-dixon @mikerod ^^ FYI"><a href="#t1513912324000061" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-22</span> <span class="t" onclick="H(this)">03:12:04</span>                cfleming </span><span>@alex-dixon @mikerod ^^ FYI</span></div><div id="t1513912745000078" t="2017-12-22 03:19:05 mikerod @cfleming nice. This is looking pretty good. I have looked over it fairly quick. I see a few things to tweak but mostly it is looking pretty close to what I’d think is right"><a href="#t1513912745000078" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-22</span> <span class="t" onclick="H(this)">03:19:05</span>                 mikerod </span><span>@cfleming nice. This is looking pretty good. I have looked over it fairly quick. I see a few things to tweak but mostly it is looking pretty close to what I’d think is right</span></div><div id="t1513912793000204" t="2017-12-22 03:19:53 cfleming Great, thanks - feel free to file an issue or just let me know what to change and I’ll update it."><a href="#t1513912793000204" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-22</span> <span class="t" onclick="H(this)">03:19:53</span>                cfleming </span><span>Great, thanks - feel free to file an issue or just let me know what to change and I’ll update it.</span></div><div id="t1513912871000075" t="2017-12-22 03:21:11 cfleming I’ll have to figure out how the symbol resolution should work for unification variables too."><a href="#t1513912871000075" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-22</span> <span class="t" onclick="H(this)">03:21:11</span>                cfleming </span><span>I’ll have to figure out how the symbol resolution should work for unification variables too.</span></div><div id="t1513912883000147" t="2017-12-22 03:21:23 cfleming (in Cursive, that is, not required for the specs)."><a href="#t1513912883000147" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-22</span> <span class="t" onclick="H(this)">03:21:23</span>                cfleming </span><span>(in Cursive, that is, not required for the specs).</span></div><div id="t1513912917000092" t="2017-12-22 03:21:57 mikerod Tomorrow I can give some better notes. A GitHub issue there perhaps to hold them. "><a href="#t1513912917000092" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-22</span> <span class="t" onclick="H(this)">03:21:57</span>                 mikerod </span><span>Tomorrow I can give some better notes. A GitHub issue there perhaps to hold them. </span></div><div id="t1513912940000041" t="2017-12-22 03:22:20 mikerod Easier things: the LHS can have 0 conditions. "><a href="#t1513912940000041" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-22</span> <span class="t" onclick="H(this)">03:22:20</span>                 mikerod </span><span>Easier things: the LHS can have 0 conditions. </span></div><div id="t1513912951000023" t="2017-12-22 03:22:31 cfleming Great, thanks. I’m going to be in and out over the holiday period but I’ll try to get it fixed up when I get a moment."><a href="#t1513912951000023" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-22</span> <span class="t" onclick="H(this)">03:22:31</span>                cfleming </span><span>Great, thanks. I’m going to be in and out over the holiday period but I’ll try to get it fixed up when I get a moment.</span></div><div id="t1513912952000200" t="2017-12-22 03:22:32 mikerod The RHS can have multiple forms now I believe. "><a href="#t1513912952000200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-22</span> <span class="t" onclick="H(this)">03:22:32</span>                 mikerod </span><span>The RHS can have multiple forms now I believe. </span></div><div id="t1513912966000163" t="2017-12-22 03:22:46 cfleming Ok, so the RHS is like a body?"><a href="#t1513912966000163" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-22</span> <span class="t" onclick="H(this)">03:22:46</span>                cfleming </span><span>Ok, so the RHS is like a body?</span></div><div id="t1513912991000097" t="2017-12-22 03:23:11 mikerod Fact type really can be like anything. So that’s a harder one I think. "><a href="#t1513912991000097" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-22</span> <span class="t" onclick="H(this)">03:23:11</span>                 mikerod </span><span>Fact type really can be like anything. So that’s a harder one I think. </span></div><div id="t1513913012000138" t="2017-12-22 03:23:32 mikerod Yeah RHS is just like an implicit  do"><a href="#t1513913012000138" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-22</span> <span class="t" onclick="H(this)">03:23:32</span>                 mikerod </span><span>Yeah RHS is just like an implicit </span><code>do</code></div><div id="t1513913015000049" t="2017-12-22 03:23:35 mikerod Block"><a href="#t1513913015000049" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-22</span> <span class="t" onclick="H(this)">03:23:35</span>                 mikerod </span><span>Block</span></div><div id="t1513913019000087" t="2017-12-22 03:23:39 cfleming Ok."><a href="#t1513913019000087" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-22</span> <span class="t" onclick="H(this)">03:23:39</span>                cfleming </span><span>Ok.</span></div><div id="t1513913056000031" t="2017-12-22 03:24:16 cfleming But I guess it should always have at least one form?"><a href="#t1513913056000031" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-22</span> <span class="t" onclick="H(this)">03:24:16</span>                cfleming </span><span>But I guess it should always have at least one form?</span></div><div id="t1513913079000131" t="2017-12-22 03:24:39 mikerod Yeah I believe the RHS needs at least one form. "><a href="#t1513913079000131" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-22</span> <span class="t" onclick="H(this)">03:24:39</span>                 mikerod </span><span>Yeah I believe the RHS needs at least one form. </span></div><div id="t1513913100000102" t="2017-12-22 03:25:00 mikerod If it didn’t it wouldn’t be a useful rule at least. Hah"><a href="#t1513913100000102" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-22</span> <span class="t" onclick="H(this)">03:25:00</span>                 mikerod </span><span>If it didn’t it wouldn’t be a useful rule at least. Hah</span></div><div id="t1513913140000139" t="2017-12-22 03:25:40 cfleming Hehe"><a href="#t1513913140000139" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-22</span> <span class="t" onclick="H(this)">03:25:40</span>                cfleming </span><span>Hehe</span></div><div id="t1513913154000106" t="2017-12-22 03:25:54 mikerod Thanks for trying this out!"><a href="#t1513913154000106" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-22</span> <span class="t" onclick="H(this)">03:25:54</span>                 mikerod </span><span>Thanks for trying this out!</span></div><div id="t1513913173000003" t="2017-12-22 03:26:13 cfleming Also, in the defquery doc it shows  CONDITION  repeated inside  []"><a href="#t1513913173000003" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-22</span> <span class="t" onclick="H(this)">03:26:13</span>                cfleming </span><span>Also, in the defquery doc it shows </span><code>CONDITION</code><span> repeated inside </span><code>[]</code></div><div id="t1513970057000377" t="2017-12-22 19:14:17 mikerod This is just a mistake in the docs. it should be the same as a rule in this part of a query"><a href="#t1513970057000377" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-22</span> <span class="t" onclick="H(this)">19:14:17</span>                      mikerod </span><span>This is just a mistake in the docs. it should be the same as a rule in this part of a query</span></div><div id="t1513970200000274" t="2017-12-22 19:16:40 mikerod what you have @  https://github.com/cursive-ide/clara-specs/commit/fa9f7aca57b7a4735d356f54e22399efc4534f72#diff-21ed98cbfbc6578b6ba48146b1f5b9aaR44  looks right"><a href="#t1513970200000274" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-22</span> <span class="t" onclick="H(this)">19:16:40</span>                      mikerod </span><span>what you have @ </span><a href="https://github.com/cursive-ide/clara-specs/commit/fa9f7aca57b7a4735d356f54e22399efc4534f72#diff-21ed98cbfbc6578b6ba48146b1f5b9aaR44" target="_blank">https://github.com/cursive-ide/clara-specs/commit/fa9f7aca57b7a4735d356f54e22399efc4534f72#diff-21ed98cbfbc6578b6ba48146b1f5b9aaR44</a><span> looks right</span></div><div id="t1513994893000063" t="2017-12-23 02:08:13 cfleming Great, thanks Mike"><a href="#t1513994893000063" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-23</span> <span class="t" onclick="H(this)">02:08:13</span>                     cfleming </span><span>Great, thanks Mike</span></div><div id="t1513994948000072" t="2017-12-23 02:09:08 cfleming Looks like these are pretty close to correct then. Thanks for the great doc, a few ambiguities and mistakes like the above aside, it was great and really helpful in making these."><a href="#t1513994948000072" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-23</span> <span class="t" onclick="H(this)">02:09:08</span>                     cfleming </span><span>Looks like these are pretty close to correct then. Thanks for the great doc, a few ambiguities and mistakes like the above aside, it was great and really helpful in making these.</span></div><div id="t1513994970000083" t="2017-12-23 02:09:30 cfleming Once these are done perhaps the doc could be created from them in the future."><a href="#t1513994970000083" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-23</span> <span class="t" onclick="H(this)">02:09:30</span>                     cfleming </span><span>Once these are done perhaps the doc could be created from them in the future.</span></div><div id="t1513995836000085" t="2017-12-23 02:23:56 mikerod Yeah t is looking good. I agree too that it would be nice to align the docs to it potentially could help ensure they stay correct too. "><a href="#t1513995836000085" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-23</span> <span class="t" onclick="H(this)">02:23:56</span>                      mikerod </span><span>Yeah t is looking good. I agree too that it would be nice to align the docs to it potentially could help ensure they stay correct too. </span></div><div id="t1513995920000103" t="2017-12-23 02:25:20 mikerod So I guess we need to figure out how to go about getting the specs in the repo. I think it’d be good to hear some feedback from at least @U0KRSVDHR on it too. He is on vacation and traveling a bit I believe (common for many right now in US). That’s probably why he hasn’t said much on the subject yet. "><a href="#t1513995920000103" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-23</span> <span class="t" onclick="H(this)">02:25:20</span>                      mikerod </span><span>So I guess we need to figure out how to go about getting the specs in the repo. I think it’d be good to hear some feedback from at least @U0KRSVDHR on it too. He is on vacation and traveling a bit I believe (common for many right now in US). That’s probably why he hasn’t said much on the subject yet. </span></div><div id="t1513995971000014" t="2017-12-23 02:26:11 cfleming Ok, no problem. They could be provided as a separate clara-specs artifact, too, if getting them in the main repo were undesirable."><a href="#t1513995971000014" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-23</span> <span class="t" onclick="H(this)">02:26:11</span>                     cfleming </span><span>Ok, no problem. They could be provided as a separate clara-specs artifact, too, if getting them in the main repo were undesirable.</span></div><div id="t1513996050000166" t="2017-12-23 02:27:30 mikerod Yeah a separate artifact is easy enough. I am thinking the main repo may be a good place too though. I just wanted to hear a bit of feedback from others there. It looks like it could be like an optional require sort of thing too so it wouldn’t mean that Clara couldn’t still support older clj for those not using it yet. "><a href="#t1513996050000166" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-23</span> <span class="t" onclick="H(this)">02:27:30</span>                      mikerod </span><span>Yeah a separate artifact is easy enough. I am thinking the main repo may be a good place too though. I just wanted to hear a bit of feedback from others there. It looks like it could be like an optional require sort of thing too so it wouldn’t mean that Clara couldn’t still support older clj for those not using it yet. </span></div><div id="t1513996083000026" t="2017-12-23 02:28:03 cfleming Right, as long as users on &lt;=1.8 don’t require that ns, they won’t have a problem."><a href="#t1513996083000026" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-23</span> <span class="t" onclick="H(this)">02:28:03</span>                     cfleming </span><span>Right, as long as users on &lt;=1.8 don’t require that ns, they won’t have a problem.</span></div><div id="t1513996094000056" t="2017-12-23 02:28:14 mikerod Clara already has an “optional” sort of dependency on Fressian (for a default durability layer impl). So it wouldn’t be the first of that sort. "><a href="#t1513996094000056" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-23</span> <span class="t" onclick="H(this)">02:28:14</span>                      mikerod </span><span>Clara already has an “optional” sort of dependency on Fressian (for a default durability layer impl). So it wouldn’t be the first of that sort. </span></div><div id="t1513996136000059" t="2017-12-23 02:28:56 mikerod We should reference your repo in the github issue on Clara related to this spec’ing too to be sure everyone sees it"><a href="#t1513996136000059" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-23</span> <span class="t" onclick="H(this)">02:28:56</span>                      mikerod </span><span>We should reference your repo in the github issue on Clara related to this spec’ing too to be sure everyone sees it</span></div><div id="t1513996273000065" t="2017-12-23 02:31:13 mikerod I’m sure people will like to get some cursive support from this too. That seems like it could be really useful"><a href="#t1513996273000065" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-23</span> <span class="t" onclick="H(this)">02:31:13</span>                      mikerod </span><span>I’m sure people will like to get some cursive support from this too. That seems like it could be really useful</span></div><div id="t1513996313000067" t="2017-12-23 02:31:53 cfleming Yeah, Cerner are big Cursive users so it will help a lot of people there (and elsewhere) I think."><a href="#t1513996313000067" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-23</span> <span class="t" onclick="H(this)">02:31:53</span>                     cfleming </span><span>Yeah, Cerner are big Cursive users so it will help a lot of people there (and elsewhere) I think.</span></div><div id="t1513996352000049" t="2017-12-23 02:32:32 cfleming I’ll probably have some questions about how the symbol resolution in conditions works too, once I get that far."><a href="#t1513996352000049" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-23</span> <span class="t" onclick="H(this)">02:32:32</span>                     cfleming </span><span>I’ll probably have some questions about how the symbol resolution in conditions works too, once I get that far.</span></div><div id="t1513996365000096" t="2017-12-23 02:32:45 cfleming That looks a little tricky."><a href="#t1513996365000096" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-23</span> <span class="t" onclick="H(this)">02:32:45</span>                     cfleming </span><span>That looks a little tricky.</span></div><div id="t1513996400000029" t="2017-12-23 02:33:20 mikerod Yeah it sounds like there is a good audience for it. It is a good way to get the cursive functionality some good exposure and perhaps testing too. "><a href="#t1513996400000029" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-23</span> <span class="t" onclick="H(this)">02:33:20</span>                      mikerod </span><span>Yeah it sounds like there is a good audience for it. It is a good way to get the cursive functionality some good exposure and perhaps testing too. </span></div><div id="t1513996450000094" t="2017-12-23 02:34:10 mikerod Yeah. Let me know if you have any questions about Clara concerning that. I can try to assist with what I can in terms of Clara semantics or whatever. "><a href="#t1513996450000094" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-23</span> <span class="t" onclick="H(this)">02:34:10</span>                      mikerod </span><span>Yeah. Let me know if you have any questions about Clara concerning that. I can try to assist with what I can in terms of Clara semantics or whatever. </span></div><div id="t1513996513000081" t="2017-12-23 02:35:13 cfleming Great, thanks. I’m unlikely to get much done until the beginning of Jan now, but I might tinker a bit over the holidays."><a href="#t1513996513000081" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-23</span> <span class="t" onclick="H(this)">02:35:13</span>                     cfleming </span><span>Great, thanks. I’m unlikely to get much done until the beginning of Jan now, but I might tinker a bit over the holidays.</span></div><div id="t1513996573000048" t="2017-12-23 02:36:13 mikerod Sounds good"><a href="#t1513996573000048" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-23</span> <span class="t" onclick="H(this)">02:36:13</span>                      mikerod </span><span>Sounds good</span></div><div id="t1513996624000032" t="2017-12-23 02:37:04 cfleming Thanks for all the help, and happy holidays!"><a href="#t1513996624000032" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-23</span> <span class="t" onclick="H(this)">02:37:04</span>                     cfleming </span><span>Thanks for all the help, and happy holidays!</span></div><div id="t1513996635000068" t="2017-12-23 02:37:15 mikerod Thanks. You too!"><a href="#t1513996635000068" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-23</span> <span class="t" onclick="H(this)">02:37:15</span>                      mikerod </span><span>Thanks. You too!</span></div><div id="t1513913202000194" t="2017-12-22 03:26:42 cfleming I’m not sure what that’s supposed to look like, the examples don’t have repeated vectors inside that."><a href="#t1513913202000194" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-22</span> <span class="t" onclick="H(this)">03:26:42</span>                cfleming </span><span>I’m not sure what that’s supposed to look like, the examples don’t have repeated vectors inside that.</span></div><div id="t1513913216000025" t="2017-12-22 03:26:56 mikerod I’ll have to check that one out. "><a href="#t1513913216000025" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-22</span> <span class="t" onclick="H(this)">03:26:56</span>                 mikerod </span><span>I’ll have to check that one out. </span></div><div id="t1513913222000102" t="2017-12-22 03:27:02 cfleming Ok, thanks."><a href="#t1513913222000102" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-22</span> <span class="t" onclick="H(this)">03:27:02</span>                cfleming </span><span>Ok, thanks.</span></div><div id="t1513913272000091" t="2017-12-22 03:27:52 cfleming Ok, I’ve got to step out now, thanks for the feedback! It’s already Friday afternoon here so if you can file an issue or something with any further feedback I’ll get to it when I can."><a href="#t1513913272000091" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-22</span> <span class="t" onclick="H(this)">03:27:52</span>                cfleming </span><span>Ok, I’ve got to step out now, thanks for the feedback! It’s already Friday afternoon here so if you can file an issue or something with any further feedback I’ll get to it when I can.</span></div><div id="t1513913334000047" t="2017-12-22 03:28:54 mikerod Sounds good. Thursday night here. Hah. I’ll see what else I can point on there likely tomorrow morning. "><a href="#t1513913334000047" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-22</span> <span class="t" onclick="H(this)">03:28:54</span>                 mikerod </span><span>Sounds good. Thursday night here. Hah. I’ll see what else I can point on there likely tomorrow morning. </span></div><div id="t1513913345000043" t="2017-12-22 03:29:05 cfleming Perfect, thanks Mike!"><a href="#t1513913345000043" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-22</span> <span class="t" onclick="H(this)">03:29:05</span>                cfleming </span><span>Perfect, thanks Mike!</span></div><div id="t1513945865000132" t="2017-12-22 12:31:05 amarjeet @mikerod I experimented after your notes. Have better understanding now. Your note helped  🙂"><a href="#t1513945865000132" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-22</span> <span class="t" onclick="H(this)">12:31:05</span>                amarjeet </span><span>@mikerod I experimented after your notes. Have better understanding now. Your note helped </span><b>🙂</b></div><div id="t1513949518000282" t="2017-12-22 13:31:58 souenzzo There is docs about  props ?
 http://www.clara-rules.org/docs/rules/ 
 :salience  is the unique &quot;relevant&quot; value inside this map?"><a href="#t1513949518000282" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-22</span> <span class="t" onclick="H(this)">13:31:58</span>                souenzzo </span><span>There is docs about </span><code>props</code><span>?
</span><a href="http://www.clara-rules.org/docs/rules/" target="_blank">http://www.clara-rules.org/docs/rules/</a><span>
</span><code>:salience</code><span> is the unique &quot;relevant&quot; value inside this map?</span></div><div id="t1513952156000322" t="2017-12-22 14:15:56 mikerod @souenzzo I’m not sure if there are docs about all  props"><a href="#t1513952156000322" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-22</span> <span class="t" onclick="H(this)">14:15:56</span>                 mikerod </span><span>@souenzzo I’m not sure if there are docs about all </span><code>props</code></div><div id="t1513952177000306" t="2017-12-22 14:16:17 mikerod It is a map of keyword to anything.  :salience  is one supported one. The only other I can think of is  :no-loop"><a href="#t1513952177000306" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-22</span> <span class="t" onclick="H(this)">14:16:17</span>                 mikerod </span><span>It is a map of keyword to anything. </span><code>:salience</code><span> is one supported one. The only other I can think of is </span><code>:no-loop</code></div><div id="t1513952280000212" t="2017-12-22 14:18:00 mikerod and usually you shouldn’t need to worry about  :no-loop"><a href="#t1513952280000212" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-22</span> <span class="t" onclick="H(this)">14:18:00</span>                 mikerod </span><span>and usually you shouldn’t need to worry about </span><code>:no-loop</code></div><div id="t1513952753000490" t="2017-12-22 14:25:53 souenzzo I&apos;m annotating some data to use on inspect. outside a name conflict, should not be a problem, right?"><a href="#t1513952753000490" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-22</span> <span class="t" onclick="H(this)">14:25:53</span>                souenzzo </span><span>I&apos;m annotating some data to use on inspect. outside a name conflict, should not be a problem, right?</span></div><div id="t1513952812000495" t="2017-12-22 14:26:52 mikerod You want to put additional information in the  props  map for your own purposes you mean?"><a href="#t1513952812000495" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-22</span> <span class="t" onclick="H(this)">14:26:52</span>                 mikerod </span><span>You want to put additional information in the </span><code>props</code><span> map for your own purposes you mean?</span></div><div id="t1513952820000181" t="2017-12-22 14:27:00 souenzzo Yep"><a href="#t1513952820000181" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-22</span> <span class="t" onclick="H(this)">14:27:00</span>                souenzzo </span><span>Yep</span></div><div id="t1513952832000622" t="2017-12-22 14:27:12 mikerod I think that should be ok. You probably want to do something like use namespaced keywords though as keys"><a href="#t1513952832000622" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-22</span> <span class="t" onclick="H(this)">14:27:12</span>                 mikerod </span><span>I think that should be ok. You probably want to do something like use namespaced keywords though as keys</span></div><div id="t1513966465000074" t="2017-12-22 18:14:25 alex-dixon @mikerod Could no loop could be used as a modify? Like if I wanted to increment each match at most once per fire rules?"><a href="#t1513966465000074" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-22</span> <span class="t" onclick="H(this)">18:14:25</span>              alex-dixon </span><span>@mikerod Could no loop could be used as a modify? Like if I wanted to increment each match at most once per fire rules?</span></div><div id="t1513967756000376" t="2017-12-22 18:35:56 mikerod @alex-dixon like:"><a href="#t1513967756000376" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-22</span> <span class="t" onclick="H(this)">18:35:56</span>                 mikerod </span><span>@alex-dixon like:</span></div><div id="t1513967761000012" t="2017-12-22 18:36:01 mikerod (r/defrule demo
  {:no-loop true}
  [?a &lt;- A]
  =&gt;
  (r/insert! (update ?a :some-val inc)))
"><a href="#t1513967761000012" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-22</span> <span class="t" onclick="H(this)">18:36:01</span>                 mikerod </span><pre>(r/defrule demo
  {:no-loop true}
  [?a &lt;- A]
  =&gt;
  (r/insert! (update ?a :some-val inc)))
</pre></div><div id="t1513967762000450" t="2017-12-22 18:36:02 mikerod ?"><a href="#t1513967762000450" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-22</span> <span class="t" onclick="H(this)">18:36:02</span>                 mikerod </span><span>?</span></div><div id="t1513967796000448" t="2017-12-22 18:36:36 mikerod and perhaps with a RHS  (r/retract! ?a)  before - actually not sure on this part - it is a secondary part of the question"><a href="#t1513967796000448" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-22</span> <span class="t" onclick="H(this)">18:36:36</span>                 mikerod </span><span>and perhaps with a RHS </span><code>(r/retract! ?a)</code><span> before - actually not sure on this part - it is a secondary part of the question</span></div><div id="t1513968048000119" t="2017-12-22 18:40:48 alex-dixon With retract yeah. To simulate mutation "><a href="#t1513968048000119" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-22</span> <span class="t" onclick="H(this)">18:40:48</span>              alex-dixon </span><span>With retract yeah. To simulate mutation </span></div><div id="t1513968600000373" t="2017-12-22 18:50:00 mikerod It may be feasible, something you’d want to be careful for proliferating everywhere"><a href="#t1513968600000373" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-22</span> <span class="t" onclick="H(this)">18:50:00</span>                 mikerod </span><span>It may be feasible, something you’d want to be careful for proliferating everywhere</span></div><div id="t1513968617000101" t="2017-12-22 18:50:17 mikerod with  r/retract!  I actually dont’ know"><a href="#t1513968617000101" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-22</span> <span class="t" onclick="H(this)">18:50:17</span>                 mikerod </span><span>with </span><code>r/retract!</code><span> I actually dont’ know</span></div><div id="t1513968636000381" t="2017-12-22 18:50:36 mikerod I can’t remember if  :no-loop  will stop a truth maintenance retraction sort of loop - perhaps you’ve tried?"><a href="#t1513968636000381" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-22</span> <span class="t" onclick="H(this)">18:50:36</span>                 mikerod </span><span>I can’t remember if </span><code>:no-loop</code><span> will stop a truth maintenance retraction sort of loop - perhaps you’ve tried?</span></div><div id="t1513968714000033" t="2017-12-22 18:51:54 mikerod I’ve mentioned on here before as well, if you don’t have a big concern with an always growing set of facts in working memory, you don’t need to retract. You can just “modify” and only base downstream logic on the “latest”"><a href="#t1513968714000033" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-22</span> <span class="t" onclick="H(this)">18:51:54</span>                 mikerod </span><span>I’ve mentioned on here before as well, if you don’t have a big concern with an always growing set of facts in working memory, you don’t need to retract. You can just “modify” and only base downstream logic on the “latest”</span></div><div id="t1513968758000176" t="2017-12-22 18:52:38 mikerod however, for something long running or with many of these changes, memory use would get too high"><a href="#t1513968758000176" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-22</span> <span class="t" onclick="H(this)">18:52:38</span>                 mikerod </span><span>however, for something long running or with many of these changes, memory use would get too high</span></div><div id="t1513981202000074" t="2017-12-22 22:20:02 alex-dixon @mikerod This is the first I’ve heard of no loop! I’m excited by it. Here’s an issue you raised a few years ago, looks like it led to truth maintenance being brought under the “no loop” umbrella as well:  https://github.com/cerner/clara-rules/issues/99"><a href="#t1513981202000074" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-22</span> <span class="t" onclick="H(this)">22:20:02</span>              alex-dixon </span><span>@mikerod This is the first I’ve heard of no loop! I’m excited by it. Here’s an issue you raised a few years ago, looks like it led to truth maintenance being brought under the “no loop” umbrella as well: </span><a href="https://github.com/cerner/clara-rules/issues/99" target="_blank">https://github.com/cerner/clara-rules/issues/99</a></div><div id="t1513983882000143" t="2017-12-22 23:04:42 mikerod @alex-dixon oh nice. The memory has returned to me now (after reading that issue and comments again) hah"><a href="#t1513983882000143" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-22</span> <span class="t" onclick="H(this)">23:04:42</span>                 mikerod </span><span>@alex-dixon oh nice. The memory has returned to me now (after reading that issue and comments again) hah</span></div><div id="t1513983936000025" t="2017-12-22 23:05:36 mikerod It’d be interesting to see how doing something like you said would go then"><a href="#t1513983936000025" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-22</span> <span class="t" onclick="H(this)">23:05:36</span>                 mikerod </span><span>It’d be interesting to see how doing something like you said would go then</span></div><div id="t1513983943000058" t="2017-12-22 23:05:43 mikerod if you retract the fact and insert the updated version of it"><a href="#t1513983943000058" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-22</span> <span class="t" onclick="H(this)">23:05:43</span>                 mikerod </span><span>if you retract the fact and insert the updated version of it</span></div><div id="t1513983986000151" t="2017-12-22 23:06:26 mikerod then all other rules that were based (or transitively based) only that removed fact would be retracted. However, the new updated version of the fact would then be available to rebuild those downstream results"><a href="#t1513983986000151" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-22</span> <span class="t" onclick="H(this)">23:06:26</span>                 mikerod </span><span>then all other rules that were based (or transitively based) only that removed fact would be retracted. However, the new updated version of the fact would then be available to rebuild those downstream results</span></div><div id="t1513983991000058" t="2017-12-22 23:06:31 mikerod That ma work out alright."><a href="#t1513983991000058" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-22</span> <span class="t" onclick="H(this)">23:06:31</span>                 mikerod </span><span>That ma work out alright.</span></div><div id="t1513984238000013" t="2017-12-22 23:10:38 mikerod @alex-dixon but be aware there are some edge cases to RHS retracts still."><a href="#t1513984238000013" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-22</span> <span class="t" onclick="H(this)">23:10:38</span>                 mikerod </span><span>@alex-dixon but be aware there are some edge cases to RHS retracts still.</span></div><div id="t1513984250000094" t="2017-12-22 23:10:50 mikerod https://github.com/cerner/clara-rules/issues/229 
 https://github.com/cerner/clara-rules/issues/321 
 are 2 I can immediately find"><a href="#t1513984250000094" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-22</span> <span class="t" onclick="H(this)">23:10:50</span>                 mikerod </span><a href="https://github.com/cerner/clara-rules/issues/229" target="_blank">https://github.com/cerner/clara-rules/issues/229</a><span>
</span><a href="https://github.com/cerner/clara-rules/issues/321" target="_blank">https://github.com/cerner/clara-rules/issues/321</a><span>
 are 2 I can immediately find</span></div><div id="t1513984722000020" t="2017-12-22 23:18:42 alex-dixon I’m trying to understand the difference with that behavior and insert logical vs insert unconditional with an explicit retraction….kind of a head spinner. It seems a lot of the landmines and complexity are tied up with insert logical. Would you agree?"><a href="#t1513984722000020" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-22</span> <span class="t" onclick="H(this)">23:18:42</span>              alex-dixon </span><span>I’m trying to understand the difference with that behavior and insert logical vs insert unconditional with an explicit retraction….kind of a head spinner. It seems a lot of the landmines and complexity are tied up with insert logical. Would you agree?</span></div><div id="t1513985737000171" t="2017-12-22 23:35:37 mikerod @alex-dixon Hmm. I think sticking to all logical insert is a reduction of complexity"><a href="#t1513985737000171" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-22</span> <span class="t" onclick="H(this)">23:35:37</span>                 mikerod </span><span>@alex-dixon Hmm. I think sticking to all logical insert is a reduction of complexity</span></div><div id="t1513985767000030" t="2017-12-22 23:36:07 mikerod There are just cases when it is difficult to express what you want with only the built-in logical truth maintenance."><a href="#t1513985767000030" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-22</span> <span class="t" onclick="H(this)">23:36:07</span>                 mikerod </span><span>There are just cases when it is difficult to express what you want with only the built-in logical truth maintenance.</span></div><div id="t1513985804000010" t="2017-12-22 23:36:44 mikerod Doing things like unconditional insert and RHS retracts are subversions to the truth maintenance system (aka TMS). With that comes difficulty"><a href="#t1513985804000010" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-22</span> <span class="t" onclick="H(this)">23:36:44</span>                 mikerod </span><span>Doing things like unconditional insert and RHS retracts are subversions to the truth maintenance system (aka TMS). With that comes difficulty</span></div><div id="t1513985847000001" t="2017-12-22 23:37:27 mikerod The reason TMS and logical insertion are so useful is that they allow for a much larger degree of rule order evaluation independence."><a href="#t1513985847000001" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-22</span> <span class="t" onclick="H(this)">23:37:27</span>                 mikerod </span><span>The reason TMS and logical insertion are so useful is that they allow for a much larger degree of rule order evaluation independence.</span></div><div id="t1513985871000178" t="2017-12-22 23:37:51 mikerod I think what Clara may be lacking most is a way to explicitly “update” a fact."><a href="#t1513985871000178" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-22</span> <span class="t" onclick="H(this)">23:37:51</span>                 mikerod </span><span>I think what Clara may be lacking most is a way to explicitly “update” a fact.</span></div><div id="t1513985905000029" t="2017-12-22 23:38:25 mikerod The more I think of it coming up, the more it seems like it’d be a nice first-class thing that ensured that it had well defined semantics with how it interacted with TMS."><a href="#t1513985905000029" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-22</span> <span class="t" onclick="H(this)">23:38:25</span>                 mikerod </span><span>The more I think of it coming up, the more it seems like it’d be a nice first-class thing that ensured that it had well defined semantics with how it interacted with TMS.</span></div><div id="t1513985965000168" t="2017-12-22 23:39:25 mikerod However, I have mentioned before, that you can also make an external process that handles “updates” or retractions - leaving the rules part all logical insert + TMS."><a href="#t1513985965000168" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-22</span> <span class="t" onclick="H(this)">23:39:25</span>                 mikerod </span><span>However, I have mentioned before, that you can also make an external process that handles “updates” or retractions - leaving the rules part all logical insert + TMS.</span></div><div id="t1513985988000030" t="2017-12-22 23:39:48 mikerod However, that is still a manual thing right now. I’ve posted on here a few times what that sort of thing looks like though."><a href="#t1513985988000030" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-22</span> <span class="t" onclick="H(this)">23:39:48</span>                 mikerod </span><span>However, that is still a manual thing right now. I’ve posted on here a few times what that sort of thing looks like though.</span></div><div id="t1513989970000097" t="2017-12-23 00:46:10 alex-dixon Interesting. And yeah seems we’re talking about the same with update/modify. I’m only slightly familiar with it from Drools."><a href="#t1513989970000097" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-23</span> <span class="t" onclick="H(this)">00:46:10</span>              alex-dixon </span><span>Interesting. And yeah seems we’re talking about the same with update/modify. I’m only slightly familiar with it from Drools.</span></div><div id="t1513990080000069" t="2017-12-23 00:48:00 alex-dixon I searched the slack history at clojureverse and wasn’t able to find your explanation  😞 . Sounds very intriguing. I’ll keep looking and thinking about this over the holiday. Thanks so much for your responses they give me a lot to think about  🙂"><a href="#t1513990080000069" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-23</span> <span class="t" onclick="H(this)">00:48:00</span>              alex-dixon </span><span>I searched the slack history at clojureverse and wasn’t able to find your explanation </span><b>😞</b><span>. Sounds very intriguing. I’ll keep looking and thinking about this over the holiday. Thanks so much for your responses they give me a lot to think about </span><b>🙂</b></div><div id="t1513990119000081" t="2017-12-23 00:48:39 mikerod I think I’ll just make a blog post on the external update thing"><a href="#t1513990119000081" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-23</span> <span class="t" onclick="H(this)">00:48:39</span>                 mikerod </span><span>I think I’ll just make a blog post on the external update thing</span></div><div id="t1513990198000086" t="2017-12-23 00:49:58 mikerod Yeah, Drools had an update mechanism. I think they had some interesting optimizations done with it. Even more so in 6+ of it when they had a large overhaul to how the fact propagation of the rule network worked I think."><a href="#t1513990198000086" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-23</span> <span class="t" onclick="H(this)">00:49:58</span>                 mikerod </span><span>Yeah, Drools had an update mechanism. I think they had some interesting optimizations done with it. Even more so in 6+ of it when they had a large overhaul to how the fact propagation of the rule network worked I think.</span></div><div id="t1513990224000033" t="2017-12-23 00:50:24 mikerod I used to spend quite a bit of time trying to parse through the Drools codebase. It’s pretty “intense” though  😛"><a href="#t1513990224000033" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-23</span> <span class="t" onclick="H(this)">00:50:24</span>                 mikerod </span><span>I used to spend quite a bit of time trying to parse through the Drools codebase. It’s pretty “intense” though </span><b>😛</b></div><div id="t1514046280000037" t="2017-12-23 16:24:40 alex-dixon Have you read Clara’s source?  😄"><a href="#t1514046280000037" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-23</span> <span class="t" onclick="H(this)">16:24:40</span>                   alex-dixon </span><span>Have you read Clara’s source? </span><b>😄</b></div><div id="t1514046327000040" t="2017-12-23 16:25:27 mikerod Haha. Oh yes. I’m all caught up on that one. "><a href="#t1514046327000040" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-23</span> <span class="t" onclick="H(this)">16:25:27</span>                      mikerod </span><span>Haha. Oh yes. I’m all caught up on that one. </span></div><div id="t1514046179000103" t="2017-12-23 16:22:59 alex-dixon Is 6+ with the Phreak algorithm instead of Rete?"><a href="#t1514046179000103" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-23</span> <span class="t" onclick="H(this)">16:22:59</span>              alex-dixon </span><span>Is 6+ with the Phreak algorithm instead of Rete?</span></div><div id="t1514046204000083" t="2017-12-23 16:23:24 alex-dixon Sorry…I should just google that….:)"><a href="#t1514046204000083" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-23</span> <span class="t" onclick="H(this)">16:23:24</span>              alex-dixon </span><span>Sorry…I should just google that….:)</span></div><div id="t1514046353000003" t="2017-12-23 16:25:53 mikerod Yep"><a href="#t1514046353000003" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-23</span> <span class="t" onclick="H(this)">16:25:53</span>                 mikerod </span><span>Yep</span></div><div id="t1514046407000050" t="2017-12-23 16:26:47 mikerod I don’t know that I fully consider it separate. But they do. It does have a lot of modifications over rete. However all modern rete impl’s do. "><a href="#t1514046407000050" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-23</span> <span class="t" onclick="H(this)">16:26:47</span>                 mikerod </span><span>I don’t know that I fully consider it separate. But they do. It does have a lot of modifications over rete. However all modern rete impl’s do. </span></div><div id="t1514046469000057" t="2017-12-23 16:27:49 mikerod There are some good ideas there though. I think Clara is competitive with the optimization it has though in many cases. "><a href="#t1514046469000057" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-23</span> <span class="t" onclick="H(this)">16:27:49</span>                 mikerod </span><span>There are some good ideas there though. I think Clara is competitive with the optimization it has though in many cases. </span></div><div id="t1514046554000050" t="2017-12-23 16:29:14 mikerod Drools 5 vs 6 added a lot of things at once. It makes it hard to know which ones are paying off the most. At least from what is public. I think the most important optimization was just the batched fact propagation across the network. That is done in Drools 6 phreak via a “lazy” sort of evaluation of rules. "><a href="#t1514046554000050" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-23</span> <span class="t" onclick="H(this)">16:29:14</span>                 mikerod </span><span>Drools 5 vs 6 added a lot of things at once. It makes it hard to know which ones are paying off the most. At least from what is public. I think the most important optimization was just the batched fact propagation across the network. That is done in Drools 6 phreak via a “lazy” sort of evaluation of rules. </span></div><div id="t1514046622000037" t="2017-12-23 16:30:22 mikerod Clara could potentially do a bit better with lazy propagation.  However just having the batched propagation seems to work pretty well already. "><a href="#t1514046622000037" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-23</span> <span class="t" onclick="H(this)">16:30:22</span>                 mikerod </span><span>Clara could potentially do a bit better with lazy propagation.  However just having the batched propagation seems to work pretty well already. </span></div><div id="t1514046710000021" t="2017-12-23 16:31:50 alex-dixon I thought Phreak was more eager"><a href="#t1514046710000021" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-23</span> <span class="t" onclick="H(this)">16:31:50</span>              alex-dixon </span><span>I thought Phreak was more eager</span></div><div id="t1514046793000032" t="2017-12-23 16:33:13 alex-dixon Overall I’m under the impression Clara was written with distributed computing in mind…I don’t know if other rule engines compete with that, and to me it seems like a ridiculously powerful feature"><a href="#t1514046793000032" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-23</span> <span class="t" onclick="H(this)">16:33:13</span>              alex-dixon </span><span>Overall I’m under the impression Clara was written with distributed computing in mind…I don’t know if other rule engines compete with that, and to me it seems like a ridiculously powerful feature</span></div><div id="t1514047230000077" t="2017-12-23 16:40:30 mikerod Hmm. It should be more lazy. Hah. There are lots of blogs on it by Drools people. Good blogs really. They put out some good content that is helpful more generally"><a href="#t1514047230000077" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-23</span> <span class="t" onclick="H(this)">16:40:30</span>                 mikerod </span><span>Hmm. It should be more lazy. Hah. There are lots of blogs on it by Drools people. Good blogs really. They put out some good content that is helpful more generally</span></div><div id="t1514047269000065" t="2017-12-23 16:41:09 mikerod But yes Clara does a good job in terms of its flexibility to be used in different ways. "><a href="#t1514047269000065" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-23</span> <span class="t" onclick="H(this)">16:41:09</span>                 mikerod </span><span>But yes Clara does a good job in terms of its flexibility to be used in different ways. </span></div><div id="t1514047290000066" t="2017-12-23 16:41:30 mikerod Some good abstractions in place. "><a href="#t1514047290000066" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-23</span> <span class="t" onclick="H(this)">16:41:30</span>                 mikerod </span><span>Some good abstractions in place. </span></div><div id="t1514047583000063" t="2017-12-23 16:46:23 alex-dixon Have you used clara-storm or have any desire to run Clara across multiple instances?"><a href="#t1514047583000063" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-23</span> <span class="t" onclick="H(this)">16:46:23</span>              alex-dixon </span><span>Have you used clara-storm or have any desire to run Clara across multiple instances?</span></div><div id="t1514048236000036" t="2017-12-23 16:57:16 mikerod That was Something Ryan put together early on with Clara. I believe he said it was mostly an experiment or demonstration of how it might be done. Not a production worthy product. "><a href="#t1514048236000036" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-23</span> <span class="t" onclick="H(this)">16:57:16</span>                 mikerod </span><span>That was Something Ryan put together early on with Clara. I believe he said it was mostly an experiment or demonstration of how it might be done. Not a production worthy product. </span></div><div id="t1514048324000111" t="2017-12-23 16:58:44 mikerod And early on I think he had some thoughts about where to apply it but went in a different direction instead. I haven’t had the need but I’ve spent a little time thinking about it. I think it’d be cool to see Clara used across Something like distributed processes"><a href="#t1514048324000111" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-23</span> <span class="t" onclick="H(this)">16:58:44</span>                 mikerod </span><span>And early on I think he had some thoughts about where to apply it but went in a different direction instead. I haven’t had the need but I’ve spent a little time thinking about it. I think it’d be cool to see Clara used across Something like distributed processes</span></div><div id="t1514052465000016" t="2017-12-23 18:07:45 ryanbrush Yeah, Storm support was just an experiment for a need that never really materialized so we didn&apos;t pursue it further. The internals of Clara were designed to support a distributed working memory, so it could be something we pick up at some point."><a href="#t1514052465000016" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-23</span> <span class="t" onclick="H(this)">18:07:45</span>               ryanbrush </span><span>Yeah, Storm support was just an experiment for a need that never really materialized so we didn&apos;t pursue it further. The internals of Clara were designed to support a distributed working memory, so it could be something we pick up at some point.</span></div><div id="t1514053177000048" t="2017-12-23 18:19:37 alex-dixon All tests are passing last I checked  🙂"><a href="#t1514053177000048" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-23</span> <span class="t" onclick="H(this)">18:19:37</span>              alex-dixon </span><span>All tests are passing last I checked </span><b>🙂</b></div><div id="t1514053332000085" t="2017-12-23 18:22:12 alex-dixon I’ve been interested in two applications related to it. Mainly stream processing with Kafka but also web workers in the browser"><a href="#t1514053332000085" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-23</span> <span class="t" onclick="H(this)">18:22:12</span>              alex-dixon </span><span>I’ve been interested in two applications related to it. Mainly stream processing with Kafka but also web workers in the browser</span></div><div id="t1514060204000034" t="2017-12-23 20:16:44 ryanbrush The test coverage in that project is pretty weak, though. We&apos;re using Clara in Spark now,  but are keeping working memory local to each worker...basically our workload lets us do groupby operations to group needed facts into a common process and then using Clara there."><a href="#t1514060204000034" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-23</span> <span class="t" onclick="H(this)">20:16:44</span>               ryanbrush </span><span>The test coverage in that project is pretty weak, though. We&apos;re using Clara in Spark now,  but are keeping working memory local to each worker...basically our workload lets us do groupby operations to group needed facts into a common process and then using Clara there.</span></div><div id="t1514076258000006" t="2017-12-24 00:44:18 mikerod @alex-dixon I made a blog post on the topic of “fact updates” in Clara @  http://www.metasimple.org/2017/12/23/clara-updating-facts.html 
Perhaps something like it could be added to Clara docs later."><a href="#t1514076258000006" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-24</span> <span class="t" onclick="H(this)">00:44:18</span>                 mikerod </span><span>@alex-dixon I made a blog post on the topic of “fact updates” in Clara @ </span><a href="http://www.metasimple.org/2017/12/23/clara-updating-facts.html" target="_blank">http://www.metasimple.org/2017/12/23/clara-updating-facts.html</a><span>
Perhaps something like it could be added to Clara docs later.</span></div><div id="t1514076285000018" t="2017-12-24 00:44:45 mikerod It is basically just reiterating things I’ve discussed before in this Slack channel on the topic. We discussed this a little a day or so ago."><a href="#t1514076285000018" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-24</span> <span class="t" onclick="H(this)">00:44:45</span>                 mikerod </span><span>It is basically just reiterating things I’ve discussed before in this Slack channel on the topic. We discussed this a little a day or so ago.</span></div><div id="t1514076330000036" t="2017-12-24 00:45:30 alex-dixon Awesome. Thanks. Will read and share"><a href="#t1514076330000036" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-24</span> <span class="t" onclick="H(this)">00:45:30</span>              alex-dixon </span><span>Awesome. Thanks. Will read and share</span></div><div id="t1514076368000005" t="2017-12-24 00:46:08 mikerod cool. feel free to let me know if you see problems with it or anything too"><a href="#t1514076368000005" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-24</span> <span class="t" onclick="H(this)">00:46:08</span>                 mikerod </span><span>cool. feel free to let me know if you see problems with it or anything too</span></div><div id="t1514132290000035" t="2017-12-24 16:18:10 alex-dixon Very well written. Really impressed at how quickly you were able to produce that…  🙂"><a href="#t1514132290000035" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-24</span> <span class="t" onclick="H(this)">16:18:10</span>                   alex-dixon </span><span>Very well written. Really impressed at how quickly you were able to produce that… </span><b>🙂</b></div><div id="t1514132668000059" t="2017-12-24 16:24:28 mikerod Thanks!"><a href="#t1514132668000059" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-24</span> <span class="t" onclick="H(this)">16:24:28</span>                      mikerod </span><span>Thanks!</span></div><div id="t1514133072000012" t="2017-12-24 16:31:12 alex-dixon I haven’t figured out a good solution for “default values” of facts. E.g. I have some rules I’m working on now for precept-devtools where I’m trying to allow the user to view history for a rule. When the user first selects “show history”, I want to provide a default (e.g. the first rule firing). After that I want the user to be able to switch through the selected history. I’d like to have one “selected history” fact. If it doesn’t exist because the user hasn’t set it, it should be derived from other facts. If the user sets it though, then “selected history” should be whatever the user says."><a href="#t1514133072000012" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-24</span> <span class="t" onclick="H(this)">16:31:12</span>                   alex-dixon </span><span>I haven’t figured out a good solution for “default values” of facts. E.g. I have some rules I’m working on now for precept-devtools where I’m trying to allow the user to view history for a rule. When the user first selects “show history”, I want to provide a default (e.g. the first rule firing). After that I want the user to be able to switch through the selected history. I’d like to have one “selected history” fact. If it doesn’t exist because the user hasn’t set it, it should be derived from other facts. If the user sets it though, then “selected history” should be whatever the user says.</span></div><div id="t1514133185000107" t="2017-12-24 16:33:05 mikerod That sounds like you could encode that as 2 separate rules that both insert the selected history fact"><a href="#t1514133185000107" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-24</span> <span class="t" onclick="H(this)">16:33:05</span>                      mikerod </span><span>That sounds like you could encode that as 2 separate rules that both insert the selected history fact</span></div><div id="t1514133196000002" t="2017-12-24 16:33:16 alex-dixon To get a default I’m writing something like “[:not {SelectedHistory} =&gt; (insert-unconditional! [SelectedHistory 0])”"><a href="#t1514133196000002" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-24</span> <span class="t" onclick="H(this)">16:33:16</span>                   alex-dixon </span><span>To get a default I’m writing something like “[:not {SelectedHistory} =&gt; (insert-unconditional! [SelectedHistory 0])”</span></div><div id="t1514133204000045" t="2017-12-24 16:33:24 mikerod One rule would only fire if some user provided fact is not present. "><a href="#t1514133204000045" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-24</span> <span class="t" onclick="H(this)">16:33:24</span>                      mikerod </span><span>One rule would only fire if some user provided fact is not present. </span></div><div id="t1514133223000045" t="2017-12-24 16:33:43 mikerod Yeah. Use a different fact type as the “trigger”"><a href="#t1514133223000045" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-24</span> <span class="t" onclick="H(this)">16:33:43</span>                      mikerod </span><span>Yeah. Use a different fact type as the “trigger”</span></div><div id="t1514133251000095" t="2017-12-24 16:34:11 mikerod And no need for unconditional "><a href="#t1514133251000095" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-24</span> <span class="t" onclick="H(this)">16:34:11</span>                      mikerod </span><span>And no need for unconditional </span></div><div id="t1514133381000057" t="2017-12-24 16:36:21 mikerod [:not [SelectHistoryEvent]]
=&gt;
(insert! (-&gt;SelectedHistory 0))
"><a href="#t1514133381000057" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-24</span> <span class="t" onclick="H(this)">16:36:21</span>                      mikerod </span><pre>[:not [SelectHistoryEvent]]
=&gt;
(insert! (-&gt;SelectedHistory 0))
</pre></div><div id="t1514133435000062" t="2017-12-24 16:37:15 mikerod The other rule would be the same, but would use the event to build the SelectedHistory with the provided value"><a href="#t1514133435000062" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-24</span> <span class="t" onclick="H(this)">16:37:15</span>                      mikerod </span><span>The other rule would be the same, but would use the event to build the SelectedHistory with the provided value</span></div><div id="t1514133469000015" t="2017-12-24 16:37:49 mikerod And if you want the ability to retract/toggle do some sort of external retract like I described in blog perhaps."><a href="#t1514133469000015" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-24</span> <span class="t" onclick="H(this)">16:37:49</span>                      mikerod </span><span>And if you want the ability to retract/toggle do some sort of external retract like I described in blog perhaps.</span></div><div id="t1514133515000025" t="2017-12-24 16:38:35 alex-dixon Ok. I’ll try that. Thanks"><a href="#t1514133515000025" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-24</span> <span class="t" onclick="H(this)">16:38:35</span>                   alex-dixon </span><span>Ok. I’ll try that. Thanks</span></div><div id="t1514137516000076" t="2017-12-24 17:45:16 mikerod Time to write a “defaulting facts” blog!  😛"><a href="#t1514137516000076" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-24</span> <span class="t" onclick="H(this)">17:45:16</span>                      mikerod </span><span>Time to write a “defaulting facts” blog! </span><b>😛</b></div><div id="t1514142119000053" t="2017-12-24 19:01:59 alex-dixon Sorry….don’t mean to create work for you. I’m still figuring out patterns. I think UI might be different from the way Clara is normally used? Maybe not but there are facts coming from the outside virtually all the time and I’ve often wondered if that’s significantly different from the use case at Cerner"><a href="#t1514142119000053" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-24</span> <span class="t" onclick="H(this)">19:01:59</span>                   alex-dixon </span><span>Sorry….don’t mean to create work for you. I’m still figuring out patterns. I think UI might be different from the way Clara is normally used? Maybe not but there are facts coming from the outside virtually all the time and I’ve often wondered if that’s significantly different from the use case at Cerner</span></div><div id="t1514143490000034" t="2017-12-24 19:24:50 mikerod Oh no not a problem. I want to do things like write more blogs anyways. Hah. But yeah I think the UI usage of Clara pushes new things up to the forefront. But that is a good thing"><a href="#t1514143490000034" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-24</span> <span class="t" onclick="H(this)">19:24:50</span>                      mikerod </span><span>Oh no not a problem. I want to do things like write more blogs anyways. Hah. But yeah I think the UI usage of Clara pushes new things up to the forefront. But that is a good thing</span></div><div id="t1514143524000086" t="2017-12-24 19:25:24 mikerod I’m doing quite a bit of UI things recently and I think some stuff you’ve been doing seems really interesting. I really want to look at it a bit more soon. "><a href="#t1514143524000086" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-24</span> <span class="t" onclick="H(this)">19:25:24</span>                      mikerod </span><span>I’m doing quite a bit of UI things recently and I think some stuff you’ve been doing seems really interesting. I really want to look at it a bit more soon. </span></div><div id="t1514387698000124" t="2017-12-27 15:14:58 alex-dixon Thanks! That means a lot coming from you  🙂 . If it’d make things easier or faster maybe we could screenshare or just chat and go over example UI rules. Your feedback on some of the patterns we’ve used in Precept so far would be invaluable"><a href="#t1514387698000124" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-27</span> <span class="t" onclick="H(this)">15:14:58</span>                   alex-dixon </span><span>Thanks! That means a lot coming from you </span><b>🙂</b><span>. If it’d make things easier or faster maybe we could screenshare or just chat and go over example UI rules. Your feedback on some of the patterns we’ve used in Precept so far would be invaluable</span></div><div id="t1514395207000178" t="2017-12-27 17:20:07 mikerod Yeah, that could work. I’ll try to find some time available soon for something like that. I want to do a little bit of a read through of  precept  to have some insight too. I like to read open-source libs doing interesting things anyways."><a href="#t1514395207000178" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-27</span> <span class="t" onclick="H(this)">17:20:07</span>                      mikerod </span><span>Yeah, that could work. I’ll try to find some time available soon for something like that. I want to do a little bit of a read through of </span><code>precept</code><span> to have some insight too. I like to read open-source libs doing interesting things anyways.</span></div><div id="t1514082463000012" t="2017-12-24 02:27:43 sparkofreason Brain bubble: clara and onyx might be a great match for distributed processing. "><a href="#t1514082463000012" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-24</span> <span class="t" onclick="H(this)">02:27:43</span>           sparkofreason </span><span>Brain bubble: clara and onyx might be a great match for distributed processing. </span></div><div id="t1514154765000018" t="2017-12-24 22:32:45 sparkofreason After reading this ( https://clojurians-log.clojureverse.org/clara/2015-12-11.html ) and @mikerod&apos;s article ( http://www.metasimple.org/2017/02/28/clarifying-rules-engines.html ), I think there may be something there. It&apos;s all sky pie at this point, but it certainly seems like the network should be translatable to an onyx job. Onyx has fault tolerance for stateful tasks, and has taken a pretty good beating from jepsen."><a href="#t1514154765000018" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-24</span> <span class="t" onclick="H(this)">22:32:45</span>           sparkofreason </span><span>After reading this (</span><a href="https://clojurians-log.clojureverse.org/clara/2015-12-11.html" target="_blank">https://clojurians-log.clojureverse.org/clara/2015-12-11.html</a><span>) and @mikerod&apos;s article (</span><a href="http://www.metasimple.org/2017/02/28/clarifying-rules-engines.html" target="_blank">http://www.metasimple.org/2017/02/28/clarifying-rules-engines.html</a><span>), I think there may be something there. It&apos;s all sky pie at this point, but it certainly seems like the network should be translatable to an onyx job. Onyx has fault tolerance for stateful tasks, and has taken a pretty good beating from jepsen.</span></div><div id="t1514236500000011" t="2017-12-25 21:15:00 alex-dixon Thanks for the links. Read both and very helpful. This was the inspiration for me:  https://www.confluent.io/blog/turning-the-database-inside-out-with-apache-samza/"><a href="#t1514236500000011" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-25</span> <span class="t" onclick="H(this)">21:15:00</span>              alex-dixon </span><span>Thanks for the links. Read both and very helpful. This was the inspiration for me: </span><a href="https://www.confluent.io/blog/turning-the-database-inside-out-with-apache-samza/" target="_blank">https://www.confluent.io/blog/turning-the-database-inside-out-with-apache-samza/</a></div><div id="t1514236714000040" t="2017-12-25 21:18:34 alex-dixon I’ve only worked with Kafka a bit, but I like it a lot. Its weakness right now seems to be “materialized views” and stream processing in general. There’s ksql and kafka-streams to deal with joins between topics, but neither seem as good a solution as a rules engine"><a href="#t1514236714000040" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-25</span> <span class="t" onclick="H(this)">21:18:34</span>                   alex-dixon </span><span>I’ve only worked with Kafka a bit, but I like it a lot. Its weakness right now seems to be “materialized views” and stream processing in general. There’s ksql and kafka-streams to deal with joins between topics, but neither seem as good a solution as a rules engine</span></div><div id="t1514593600000053" t="2017-12-30 00:26:40 sparkofreason Agreed. I think Kafka is suitable as a source of facts, but the rules engine gives you both logic and materialized views for &quot;complex event processing&quot;. If we could implement the distributed working menu in Onyx and feed the whole thing with Kafka, it seems pretty cool."><a href="#t1514593600000053" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-30</span> <span class="t" onclick="H(this)">00:26:40</span>                sparkofreason </span><span>Agreed. I think Kafka is suitable as a source of facts, but the rules engine gives you both logic and materialized views for &quot;complex event processing&quot;. If we could implement the distributed working menu in Onyx and feed the whole thing with Kafka, it seems pretty cool.</span></div><div id="t1514372355000014" t="2017-12-27 10:59:15 amarjeet When i inspect a session, the value of :fact-&gt;explanations key is always nil, despite facts being inserted into the session. My goal is to check what all facts are in the session. Help? CC: @mikerod"><a href="#t1514372355000014" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-27</span> <span class="t" onclick="H(this)">10:59:15</span>                amarjeet </span><span>When i inspect a session, the value of :fact-&gt;explanations key is always nil, despite facts being inserted into the session. My goal is to check what all facts are in the session. Help? CC: @mikerod</span></div><div id="t1514372596000204" t="2017-12-27 11:03:16 amarjeet The session-&gt;fact-graph too returns nil: {:forward-edges {}, :backward-edges {}}"><a href="#t1514372596000204" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-27</span> <span class="t" onclick="H(this)">11:03:16</span>                amarjeet </span><span>The session-&gt;fact-graph too returns nil: {:forward-edges {}, :backward-edges {}}</span></div><div id="t1514386765000376" t="2017-12-27 14:59:25 mikerod @amarjeet I think I’d need more of an example to see what you mean"><a href="#t1514386765000376" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-27</span> <span class="t" onclick="H(this)">14:59:25</span>                 mikerod </span><span>@amarjeet I think I’d need more of an example to see what you mean</span></div><div id="t1514386805000152" t="2017-12-27 15:00:05 mikerod However, if you are just doing this for some sort of debugging, you could also add a query that matched any fact and use that to see what is in the session. This query could be a performance issue in a production usage though,."><a href="#t1514386805000152" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-27</span> <span class="t" onclick="H(this)">15:00:05</span>                 mikerod </span><span>However, if you are just doing this for some sort of debugging, you could also add a query that matched any fact and use that to see what is in the session. This query could be a performance issue in a production usage though,.</span></div><div id="t1514387114000313" t="2017-12-27 15:05:14 amarjeet I was debugging basically, so with queries I can test things"><a href="#t1514387114000313" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-27</span> <span class="t" onclick="H(this)">15:05:14</span>                amarjeet </span><span>I was debugging basically, so with queries I can test things</span></div><div id="t1514387152000381" t="2017-12-27 15:05:52 amarjeet in the process of debugging, I tried inspect and fact-graph...thats when I came across nil values"><a href="#t1514387152000381" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-27</span> <span class="t" onclick="H(this)">15:05:52</span>                amarjeet </span><span>in the process of debugging, I tried inspect and fact-graph...thats when I came across nil values</span></div><div id="t1514387218000191" t="2017-12-27 15:06:58 amarjeet But, queries clearly shows that facts are there. So, now just wondering if :fact-explanation or fact-graph should be looked at or not?"><a href="#t1514387218000191" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-27</span> <span class="t" onclick="H(this)">15:06:58</span>                amarjeet </span><span>But, queries clearly shows that facts are there. So, now just wondering if :fact-explanation or fact-graph should be looked at or not?</span></div><div id="t1514388493000334" t="2017-12-27 15:28:13 mikerod @amarjeet your code snipet looks wrong. Perhaps just a typo? You have  (insert-all facts base-session)  when it should be  (insert-all base-session facts)   -  base-session  is first arg"><a href="#t1514388493000334" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-27</span> <span class="t" onclick="H(this)">15:28:13</span>                 mikerod </span><span>@amarjeet your code snipet looks wrong. Perhaps just a typo? You have </span><code>(insert-all facts base-session)</code><span> when it should be </span><code>(insert-all base-session facts)</code><span>  - </span><code>base-session</code><span> is first arg</span></div><div id="t1514388730000016" t="2017-12-27 15:32:10 mikerod Also, I only see 2  def  in your example. One for  base-session  and one for  mysession . I don’t see what you called to try inspecting and looking at the inspection results. That’d be useful too. Pending the above comment I had was just a typo"><a href="#t1514388730000016" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-27</span> <span class="t" onclick="H(this)">15:32:10</span>                 mikerod </span><span>Also, I only see 2 </span><code>def</code><span> in your example. One for </span><code>base-session</code><span> and one for </span><code>mysession</code><span>. I don’t see what you called to try inspecting and looking at the inspection results. That’d be useful too. Pending the above comment I had was just a typo</span></div><div id="t1514390583000287" t="2017-12-27 16:03:03 mikerod @amarjeet did you call  fire-rules  on the  mysession ?"><a href="#t1514390583000287" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-27</span> <span class="t" onclick="H(this)">16:03:03</span>                 mikerod </span><span>@amarjeet did you call </span><code>fire-rules</code><span> on the </span><code>mysession</code><span>?</span></div><div id="t1514390670000226" t="2017-12-27 16:04:30 amarjeet no actually"><a href="#t1514390670000226" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-27</span> <span class="t" onclick="H(this)">16:04:30</span>                amarjeet </span><span>no actually</span></div><div id="t1514390699000376" t="2017-12-27 16:04:59 amarjeet I see thats the problem? Because, I just tried with fire-rules, and I see the facts"><a href="#t1514390699000376" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-27</span> <span class="t" onclick="H(this)">16:04:59</span>                amarjeet </span><span>I see thats the problem? Because, I just tried with fire-rules, and I see the facts</span></div><div id="t1514390763000152" t="2017-12-27 16:06:03 amarjeet But, without firing the rules, the insertion is happening"><a href="#t1514390763000152" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-27</span> <span class="t" onclick="H(this)">16:06:03</span>                amarjeet </span><span>But, without firing the rules, the insertion is happening</span></div><div id="t1514390823000290" t="2017-12-27 16:07:03 amarjeet with fire-rules, only matched facts are being returned under the fact-&gt;explanation"><a href="#t1514390823000290" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-27</span> <span class="t" onclick="H(this)">16:07:03</span>                amarjeet </span><span>with fire-rules, only matched facts are being returned under the fact-&gt;explanation</span></div><div id="t1514390851000398" t="2017-12-27 16:07:31 amarjeet I thought, with inspect, I could see all inserted facts, not just the matched ones"><a href="#t1514390851000398" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-27</span> <span class="t" onclick="H(this)">16:07:31</span>                amarjeet </span><span>I thought, with inspect, I could see all inserted facts, not just the matched ones</span></div><div id="t1514391053000302" t="2017-12-27 16:10:53 mikerod @amarjeet I think in general you shouldn’t assume much about the state of working memory prior to  fire-rules"><a href="#t1514391053000302" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-27</span> <span class="t" onclick="H(this)">16:10:53</span>                 mikerod </span><span>@amarjeet I think in general you shouldn’t assume much about the state of working memory prior to </span><code>fire-rules</code></div><div id="t1514391070000280" t="2017-12-27 16:11:10 mikerod Take that as a general principle. Things are done sometimes “lazily” in some respects"><a href="#t1514391070000280" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-27</span> <span class="t" onclick="H(this)">16:11:10</span>                 mikerod </span><span>Take that as a general principle. Things are done sometimes “lazily” in some respects</span></div><div id="t1514391096000014" t="2017-12-27 16:11:36 mikerod That doesn’t answer the 2nd part of your question as to what is missing post-rule firing though"><a href="#t1514391096000014" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-27</span> <span class="t" onclick="H(this)">16:11:36</span>                 mikerod </span><span>That doesn’t answer the 2nd part of your question as to what is missing post-rule firing though</span></div><div id="t1514391278000164" t="2017-12-27 16:14:38 amarjeet hmm, understood the issue now regarding &apos;before fire-rule&apos; part."><a href="#t1514391278000164" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-27</span> <span class="t" onclick="H(this)">16:14:38</span>                amarjeet </span><span>hmm, understood the issue now regarding &apos;before fire-rule&apos; part.</span></div><div id="t1514391659000358" t="2017-12-27 16:20:59 amarjeet I re-checked, post fire-rules, I can see only matched facts, not all inserted ones (in that session)"><a href="#t1514391659000358" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-27</span> <span class="t" onclick="H(this)">16:20:59</span>                amarjeet </span><span>I re-checked, post fire-rules, I can see only matched facts, not all inserted ones (in that session)</span></div><div id="t1514392348000141" t="2017-12-27 16:32:28 mikerod I’ll have to take a look at things a bit to have a better answer on that"><a href="#t1514392348000141" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-27</span> <span class="t" onclick="H(this)">16:32:28</span>                 mikerod </span><span>I’ll have to take a look at things a bit to have a better answer on that</span></div><div id="t1514392422000260" t="2017-12-27 16:33:42 amarjeet cool cool, thanks much"><a href="#t1514392422000260" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-27</span> <span class="t" onclick="H(this)">16:33:42</span>                amarjeet </span><span>cool cool, thanks much</span></div><div id="t1514394614000039" t="2017-12-27 17:10:14 mikerod @amarjeet it seems the purpose of the key  :fact-&gt;explanations  is to explain derived facts within working memory"><a href="#t1514394614000039" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-27</span> <span class="t" onclick="H(this)">17:10:14</span>                 mikerod </span><span>@amarjeet it seems the purpose of the key </span><code>:fact-&gt;explanations</code><span> is to explain derived facts within working memory</span></div><div id="t1514394625000017" t="2017-12-27 17:10:25 mikerod not facts explicitly given via an external  insert  or  insert-all"><a href="#t1514394625000017" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-27</span> <span class="t" onclick="H(this)">17:10:25</span>                 mikerod </span><span>not facts explicitly given via an external </span><code>insert</code><span> or </span><code>insert-all</code></div><div id="t1514394657000168" t="2017-12-27 17:10:57 amarjeet okay, that makes sense then"><a href="#t1514394657000168" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-27</span> <span class="t" onclick="H(this)">17:10:57</span>                amarjeet </span><span>okay, that makes sense then</span></div><div id="t1514394660000069" t="2017-12-27 17:11:00 mikerod You can dig out that info in some sense"><a href="#t1514394660000069" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-27</span> <span class="t" onclick="H(this)">17:11:00</span>                 mikerod </span><span>You can dig out that info in some sense</span></div><div id="t1514394673000214" t="2017-12-27 17:11:13 amarjeet yeah"><a href="#t1514394673000214" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-27</span> <span class="t" onclick="H(this)">17:11:13</span>                amarjeet </span><span>yeah</span></div><div id="t1514394688000148" t="2017-12-27 17:11:28 mikerod Take for example:
 :fact-&gt;explanations
{#clara.test_rules.B{}
[{:rule {:ns-name clara.test-rules, :lhs [{:type clara.test_rules.A, :constraints []}], :rhs (do (insert! (-&gt;B))), :name &quot;clara.test-rules/test-a&quot;},
:explanation #clara.tools.inspect.Explanation{:matches ({:fact #clara.test_rules.A{}, :condition {:type clara.test_rules.A, :constraints []}}), :bindings {}}}]}
"><a href="#t1514394688000148" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-27</span> <span class="t" onclick="H(this)">17:11:28</span>                 mikerod </span><span>Take for example:
</span><pre>:fact-&gt;explanations
{#clara.test_rules.B{}
[{:rule {:ns-name clara.test-rules, :lhs [{:type clara.test_rules.A, :constraints []}], :rhs (do (insert! (-&gt;B))), :name &quot;clara.test-rules/test-a&quot;},
:explanation #clara.tools.inspect.Explanation{:matches ({:fact #clara.test_rules.A{}, :condition {:type clara.test_rules.A, :constraints []}}), :bindings {}}}]}
</pre></div><div id="t1514394713000024" t="2017-12-27 17:11:53 mikerod clara.test_rules.B  is the derived fact"><a href="#t1514394713000024" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-27</span> <span class="t" onclick="H(this)">17:11:53</span>                 mikerod </span><code>clara.test_rules.B</code><span> is the derived fact</span></div><div id="t1514394744000232" t="2017-12-27 17:12:24 mikerod the value under it is a list of rules deriving it. There’d be more than one if multiple of these facts were  =  in working memory."><a href="#t1514394744000232" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-27</span> <span class="t" onclick="H(this)">17:12:24</span>                 mikerod </span><span>the value under it is a list of rules deriving it. There’d be more than one if multiple of these facts were </span><code>=</code><span> in working memory.</span></div><div id="t1514394821000161" t="2017-12-27 17:13:41 amarjeet yes, I did got that when I checked with fire-rules"><a href="#t1514394821000161" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-27</span> <span class="t" onclick="H(this)">17:13:41</span>                amarjeet </span><span>yes, I did got that when I checked with fire-rules</span></div><div id="t1514394834000029" t="2017-12-27 17:13:54 amarjeet understood it now"><a href="#t1514394834000029" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-27</span> <span class="t" onclick="H(this)">17:13:54</span>                amarjeet </span><span>understood it now</span></div><div id="t1514394886000136" t="2017-12-27 17:14:46 mikerod (into []
      (comp cat
            (map :explanation)
            (mapcat :matches)
            (map :fact))
      (vals (:fact-&gt;explanations inspect-results)))
 
combined with  (keys (:fact-&gt;explanations inspect-results))  sort of gets you there"><a href="#t1514394886000136" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-27</span> <span class="t" onclick="H(this)">17:14:46</span>                 mikerod </span><pre>(into []
      (comp cat
            (map :explanation)
            (mapcat :matches)
            (map :fact))
      (vals (:fact-&gt;explanations inspect-results)))
</pre><span>
combined with </span><code>(keys (:fact-&gt;explanations inspect-results))</code><span> sort of gets you there</span></div><div id="t1514394914000299" t="2017-12-27 17:15:14 mikerod Also, an important consideration is that Clara doesn’t hold references to any inserted facts that cannot contribute to any rule"><a href="#t1514394914000299" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-27</span> <span class="t" onclick="H(this)">17:15:14</span>                 mikerod </span><span>Also, an important consideration is that Clara doesn’t hold references to any inserted facts that cannot contribute to any rule</span></div><div id="t1514394926000218" t="2017-12-27 17:15:26 mikerod So those effectively are not in working memory at all anymore"><a href="#t1514394926000218" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-27</span> <span class="t" onclick="H(this)">17:15:26</span>                 mikerod </span><span>So those effectively are not in working memory at all anymore</span></div><div id="t1514394957000448" t="2017-12-27 17:15:57 amarjeet hmm, yeah, got it"><a href="#t1514394957000448" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-27</span> <span class="t" onclick="H(this)">17:15:57</span>                amarjeet </span><span>hmm, yeah, got it</span></div><div id="t1514394974000140" t="2017-12-27 17:16:14 amarjeet makes sense now"><a href="#t1514394974000140" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-27</span> <span class="t" onclick="H(this)">17:16:14</span>                amarjeet </span><span>makes sense now</span></div><div id="t1514394978000056" t="2017-12-27 17:16:18 mikerod (defrecord A [])

(defrule not-using-a
  [:not-a]
  =&gt;
  (insert! {:not-a true}))

(-&gt; (mk-session [not-using-a])
    (insert (-&gt;A))
    fire-rules)
"><a href="#t1514394978000056" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-27</span> <span class="t" onclick="H(this)">17:16:18</span>                 mikerod </span><pre>(defrecord A [])

(defrule not-using-a
  [:not-a]
  =&gt;
  (insert! {:not-a true}))

(-&gt; (mk-session [not-using-a])
    (insert (-&gt;A))
    fire-rules)
</pre></div><div id="t1514394989000362" t="2017-12-27 17:16:29 mikerod you’d find no references to  A  fact instance in working memory at all"><a href="#t1514394989000362" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-27</span> <span class="t" onclick="H(this)">17:16:29</span>                 mikerod </span><span>you’d find no references to </span><code>A</code><span> fact instance in working memory at all</span></div><div id="t1514395015000046" t="2017-12-27 17:16:55 mikerod @alex-dixon has done some more interesting things with session inspection I believe. He may have thoughts on this though."><a href="#t1514395015000046" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-27</span> <span class="t" onclick="H(this)">17:16:55</span>                 mikerod </span><span>@alex-dixon has done some more interesting things with session inspection I believe. He may have thoughts on this though.</span></div><div id="t1514395069000145" t="2017-12-27 17:17:49 mikerod On the topic of analyzing all facts inserted or that sort of thing. Then again, for dev only, if you are using the typical type hierarchy you could just do 
 (defquery find-any-fact []
   [?f &lt;- Object])
"><a href="#t1514395069000145" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-27</span> <span class="t" onclick="H(this)">17:17:49</span>                 mikerod </span><span>On the topic of analyzing all facts inserted or that sort of thing. Then again, for dev only, if you are using the typical type hierarchy you could just do 
</span><pre>(defquery find-any-fact []
   [?f &lt;- Object])
</pre></div><div id="t1514395212000212" t="2017-12-27 17:20:12 amarjeet yeah, this testing trick works, I tried testing with different types of queries."><a href="#t1514395212000212" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-27</span> <span class="t" onclick="H(this)">17:20:12</span>                amarjeet </span><span>yeah, this testing trick works, I tried testing with different types of queries.</span></div><div id="t1514395407000163" t="2017-12-27 17:23:27 alex-dixon https://github.com/CoNarrative/precept/blob/master/src/cljc/precept/listeners.cljc"><a href="#t1514395407000163" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-27</span> <span class="t" onclick="H(this)">17:23:27</span>              alex-dixon </span><a href="https://github.com/CoNarrative/precept/blob/master/src/cljc/precept/listeners.cljc" target="_blank">https://github.com/CoNarrative/precept/blob/master/src/cljc/precept/listeners.cljc</a></div><div id="t1514395443000135" t="2017-12-27 17:24:03 alex-dixon Example of abusing clara.listeners  😊"><a href="#t1514395443000135" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-27</span> <span class="t" onclick="H(this)">17:24:03</span>              alex-dixon </span><span>Example of abusing clara.listeners </span><b>😊</b></div><div id="t1514395782000364" t="2017-12-27 17:29:42 alex-dixon It’s a tremendously well designed interface. This is just one implementation. We set up a core async pipeline to process insertions from outside the session (see in precept.core if interested). Each time there’s an insert we add and remove a listener and divide the listener ops into additions and removals"><a href="#t1514395782000364" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-27</span> <span class="t" onclick="H(this)">17:29:42</span>              alex-dixon </span><span>It’s a tremendously well designed interface. This is just one implementation. We set up a core async pipeline to process insertions from outside the session (see in precept.core if interested). Each time there’s an insert we add and remove a listener and divide the listener ops into additions and removals</span></div><div id="t1514395880000293" t="2017-12-27 17:31:20 alex-dixon From there we apply the ops to an atom that represents “current state”"><a href="#t1514395880000293" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-27</span> <span class="t" onclick="H(this)">17:31:20</span>              alex-dixon </span><span>From there we apply the ops to an atom that represents “current state”</span></div><div id="t1514396044000352" t="2017-12-27 17:34:04 alex-dixon Part of motivation over a query is that queries become part of the rete network so having one that matches on everything wasn’t performant"><a href="#t1514396044000352" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-27</span> <span class="t" onclick="H(this)">17:34:04</span>              alex-dixon </span><span>Part of motivation over a query is that queries become part of the rete network so having one that matches on everything wasn’t performant</span></div><div id="t1514399255000173" t="2017-12-27 18:27:35 alex-dixon @amarjeet Just making sure you saw this in case it might be helpful"><a href="#t1514399255000173" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-27</span> <span class="t" onclick="H(this)">18:27:35</span>              alex-dixon </span><span>@amarjeet Just making sure you saw this in case it might be helpful</span></div><div id="t1514399331000239" t="2017-12-27 18:28:51 amarjeet oh, just saw, gonna look at it"><a href="#t1514399331000239" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-27</span> <span class="t" onclick="H(this)">18:28:51</span>                amarjeet </span><span>oh, just saw, gonna look at it</span></div><div id="t1514399342000165" t="2017-12-27 18:29:02 amarjeet thanks  🙂"><a href="#t1514399342000165" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-27</span> <span class="t" onclick="H(this)">18:29:02</span>                amarjeet </span><span>thanks </span><b>🙂</b></div><div id="t1514566214000134" t="2017-12-29 16:50:14 amarjeet @alex-dixon In general, the approach behind precept is interesting. I m gonna dig into it a bit. A few months ago I was thinking about logic-based UIs, using core.logic, before I had explored Clara. I think, understanding precept will help."><a href="#t1514566214000134" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-29</span> <span class="t" onclick="H(this)">16:50:14</span>                amarjeet </span><span>@alex-dixon In general, the approach behind precept is interesting. I m gonna dig into it a bit. A few months ago I was thinking about logic-based UIs, using core.logic, before I had explored Clara. I think, understanding precept will help.</span></div><div id="t1514566306000085" t="2017-12-29 16:51:46 alex-dixon @amarjeet Awesome. Don’t hesitate to ask any questions you may have I’m happy to answer as best I can. You can DM me or there’s also a #precept channel if you like  🙂"><a href="#t1514566306000085" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-29</span> <span class="t" onclick="H(this)">16:51:46</span>              alex-dixon </span><span>@amarjeet Awesome. Don’t hesitate to ask any questions you may have I’m happy to answer as best I can. You can DM me or there’s also a #precept channel if you like </span><b>🙂</b></div><div id="t1514566331000309" t="2017-12-29 16:52:11 amarjeet oh, great, will join the precept channel as well"><a href="#t1514566331000309" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2017-12-29</span> <span class="t" onclick="H(this)">16:52:11</span>                amarjeet </span><span>oh, great, will join the precept channel as well</span></div><div id="t1514921874000561" t="2018-01-02 19:37:54 wparker @mikerod @alex-dixon I see that there was some discussion of patterns for updating facts; just a heads up/reminder of the “cancelling” functionality added in  https://github.com/cerner/clara-rules/issues/249  and documented at  https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/rules.cljc#L38  It doesn’t really solve the hassles of updates though, more of a perf optimization.  Also, we haven’t ended using it at Cerner yet due to the work involved in testing, so there could well be problems I missed."><a href="#t1514921874000561" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-02</span> <span class="t" onclick="H(this)">19:37:54</span>                 wparker </span><span>@mikerod @alex-dixon I see that there was some discussion of patterns for updating facts; just a heads up/reminder of the “cancelling” functionality added in </span><a href="https://github.com/cerner/clara-rules/issues/249" target="_blank">https://github.com/cerner/clara-rules/issues/249</a><span> and documented at </span><a href="https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/rules.cljc#L38" target="_blank">https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/rules.cljc#L38</a><span> It doesn’t really solve the hassles of updates though, more of a perf optimization.  Also, we haven’t ended using it at Cerner yet due to the work involved in testing, so there could well be problems I missed.</span></div><div id="t1514922460000364" t="2018-01-02 19:47:40 alex-dixon Thanks for bringing this up again. This is really exciting. I only skimmed 249 but will review it more later. If I’m understanding correctly the modify would increase performance because it would basically be “mutable data structures”. I really, really at the same time don’t like the sounds of that …but if it allows us to easily trade immutability for performance in certain situations then it seems like a great feature"><a href="#t1514922460000364" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-02</span> <span class="t" onclick="H(this)">19:47:40</span>                   alex-dixon </span><span>Thanks for bringing this up again. This is really exciting. I only skimmed 249 but will review it more later. If I’m understanding correctly the modify would increase performance because it would basically be “mutable data structures”. I really, really at the same time don’t like the sounds of that …but if it allows us to easily trade immutability for performance in certain situations then it seems like a great feature</span></div><div id="t1514922589000178" t="2018-01-02 19:49:49 wparker The mutability is purely internal to Clara, not user-facing.  Or at least if it is user-facing that would be a bug.  🙂"><a href="#t1514922589000178" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-02</span> <span class="t" onclick="H(this)">19:49:49</span>                      wparker </span><span>The mutability is purely internal to Clara, not user-facing.  Or at least if it is user-facing that would be a bug. </span><b>🙂</b></div><div id="t1514922627000133" t="2018-01-02 19:50:27 wparker Similar to the way the memory is mutable internally, but that isn’t shown to the user"><a href="#t1514922627000133" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-02</span> <span class="t" onclick="H(this)">19:50:27</span>                      wparker </span><span>Similar to the way the memory is mutable internally, but that isn’t shown to the user</span></div><div id="t1514922695000028" t="2018-01-02 19:51:35 alex-dixon Ah! Ok. I was thinking about a  (modify!)  which I think was discussed if only briefly"><a href="#t1514922695000028" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-02</span> <span class="t" onclick="H(this)">19:51:35</span>                   alex-dixon </span><span>Ah! Ok. I was thinking about a </span><code>(modify!)</code><span> which I think was discussed if only briefly</span></div><div id="t1514928260000357" t="2018-01-02 21:24:20 mikerod @wparker yes, this thing you wrote came to mind and then I realized you actually had parts of it already merged to master. I forgot you didn’t just have it on a branch."><a href="#t1514928260000357" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-02</span> <span class="t" onclick="H(this)">21:24:20</span>                      mikerod </span><span>@wparker yes, this thing you wrote came to mind and then I realized you actually had parts of it already merged to master. I forgot you didn’t just have it on a branch.</span></div><div id="t1514928276000389" t="2018-01-02 21:24:36 mikerod However, it is not the same thing as the  update!  or  modify!  proposal I was considering."><a href="#t1514928276000389" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-02</span> <span class="t" onclick="H(this)">21:24:36</span>                      mikerod </span><span>However, it is not the same thing as the </span><code>update!</code><span> or </span><code>modify!</code><span> proposal I was considering.</span></div><div id="t1514928309000315" t="2018-01-02 21:25:09 mikerod I think there is likely some value for the engine to explicitly “understand” the idea of doing a RHS retract + insert of an entity that logically represents the “same fact”."><a href="#t1514928309000315" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-02</span> <span class="t" onclick="H(this)">21:25:09</span>                      mikerod </span><span>I think there is likely some value for the engine to explicitly “understand” the idea of doing a RHS retract + insert of an entity that logically represents the “same fact”.</span></div><div id="t1514928357000198" t="2018-01-02 21:25:57 mikerod Reasoning is:
1) RHS retract is clunky right now and even worse has some fairly broken behavior with truth maintenance/batched logical insertion etc.
2) Optimizations similar to your “update facts” optimizations posted above here may also be applicable."><a href="#t1514928357000198" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-02</span> <span class="t" onclick="H(this)">21:25:57</span>                      mikerod </span><span>Reasoning is:
1) RHS retract is clunky right now and even worse has some fairly broken behavior with truth maintenance/batched logical insertion etc.
2) Optimizations similar to your “update facts” optimizations posted above here may also be applicable.</span></div><div id="t1514928397000388" t="2018-01-02 21:26:37 mikerod Drools does have some optimization to the path of modifying a fact in place - via some of the property reactive hooks. I think Drools also has an explicit “modify” sort of statement that gives it awareness of a fact in working memory that needs to change."><a href="#t1514928397000388" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-02</span> <span class="t" onclick="H(this)">21:26:37</span>                      mikerod </span><span>Drools does have some optimization to the path of modifying a fact in place - via some of the property reactive hooks. I think Drools also has an explicit “modify” sort of statement that gives it awareness of a fact in working memory that needs to change.</span></div><div id="t1514928452000312" t="2018-01-02 21:27:32 mikerod In our case, we’d not do any in-place mutation of course (structural sharing is good though). I think something like a  modify!  or, I prefer,  update!  could be done in a way that was sure to have well defined behavior with the truth maintenance as well as batching behavior of logical inserts etc"><a href="#t1514928452000312" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-02</span> <span class="t" onclick="H(this)">21:27:32</span>                      mikerod </span><span>In our case, we’d not do any in-place mutation of course (structural sharing is good though). I think something like a </span><code>modify!</code><span> or, I prefer, </span><code>update!</code><span> could be done in a way that was sure to have well defined behavior with the truth maintenance as well as batching behavior of logical inserts etc</span></div><div id="t1514928520000071" t="2018-01-02 21:28:40 mikerod I think the  update!  scenario is one of prominent use-cases for  retract!  on the RHS.
Although I think there are other reasons to retract, such as “no longer relevant event” scenarios perhaps, so  retract!  isn’t completely useless still (and needs to get fixed to behave sanely with batched inserts and truth maintenance)."><a href="#t1514928520000071" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-02</span> <span class="t" onclick="H(this)">21:28:40</span>                      mikerod </span><span>I think the </span><code>update!</code><span> scenario is one of prominent use-cases for </span><code>retract!</code><span> on the RHS.
Although I think there are other reasons to retract, such as “no longer relevant event” scenarios perhaps, so </span><code>retract!</code><span> isn’t completely useless still (and needs to get fixed to behave sanely with batched inserts and truth maintenance).</span></div><div id="t1514929063000148" t="2018-01-02 21:37:43 wparker Yeah, I realize there’s some other stuff being discussed.  I’ll have to read up on those features in Drools.  Re updates and truth maintenance - it isn’t clear to me what sorts of semantics would make sense to manually mess with a logically inserted fact.  My intuition there is that manual modification to something that is logically derived doesn’t make sense, since if A implies B, then A should continue to imply B until/unless A changes."><a href="#t1514929063000148" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-02</span> <span class="t" onclick="H(this)">21:37:43</span>                      wparker </span><span>Yeah, I realize there’s some other stuff being discussed.  I’ll have to read up on those features in Drools.  Re updates and truth maintenance - it isn’t clear to me what sorts of semantics would make sense to manually mess with a logically inserted fact.  My intuition there is that manual modification to something that is logically derived doesn’t make sense, since if A implies B, then A should continue to imply B until/unless A changes.</span></div><div id="t1514929135000013" t="2018-01-02 21:38:55 wparker I realize that isn’t the current implementation though - I’ve toyed with changing things so that a RHS retract of a logically inserted fact simply wouldn’t happen in the same way that an external retract of a fact not in the session doesn’t do anything.  The fact that it does do something now always seemed like a leaky impl detail/bug to me actually"><a href="#t1514929135000013" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-02</span> <span class="t" onclick="H(this)">21:38:55</span>                      wparker </span><span>I realize that isn’t the current implementation though - I’ve toyed with changing things so that a RHS retract of a logically inserted fact simply wouldn’t happen in the same way that an external retract of a fact not in the session doesn’t do anything.  The fact that it does do something now always seemed like a leaky impl detail/bug to me actually</span></div><div id="t1514929452000170" t="2018-01-02 21:44:12 mikerod I think there is a lot of value to be had in the ability to “update a fact”"><a href="#t1514929452000170" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-02</span> <span class="t" onclick="H(this)">21:44:12</span>                      mikerod </span><span>I think there is a lot of value to be had in the ability to “update a fact”</span></div><div id="t1514929484000321" t="2018-01-02 21:44:44 mikerod Which would require something like a retract/insert at some level conceptually to the rest of the network - something may not be affected by the thing that changed though"><a href="#t1514929484000321" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-02</span> <span class="t" onclick="H(this)">21:44:44</span>                      mikerod </span><span>Which would require something like a retract/insert at some level conceptually to the rest of the network - something may not be affected by the thing that changed though</span></div><div id="t1514929523000207" t="2018-01-02 21:45:23 mikerod and with truth maintenance and all logical inserts (something I think is very valuable), it gets near impossible to actually retract something because you immediately invalidate it against the truth maintenance"><a href="#t1514929523000207" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-02</span> <span class="t" onclick="H(this)">21:45:23</span>                      mikerod </span><span>and with truth maintenance and all logical inserts (something I think is very valuable), it gets near impossible to actually retract something because you immediately invalidate it against the truth maintenance</span></div><div id="t1514929583000079" t="2018-01-02 21:46:23 mikerod I think something liek this:
 (defrule update-it
  [?a &lt;- A]
  =&gt;
  (update! ?a #(update % :value inc)))

"><a href="#t1514929583000079" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-02</span> <span class="t" onclick="H(this)">21:46:23</span>                      mikerod </span><span>I think something liek this:
</span><pre>(defrule update-it
  [?a &lt;- A]
  =&gt;
  (update! ?a #(update % :value inc)))

</pre></div><div id="t1514929618000064" t="2018-01-02 21:46:58 mikerod The truth maintenance should not have an issue with this. and it should propagate and participate in the truth maintenance downstream as expected"><a href="#t1514929618000064" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-02</span> <span class="t" onclick="H(this)">21:46:58</span>                      mikerod </span><span>The truth maintenance should not have an issue with this. and it should propagate and participate in the truth maintenance downstream as expected</span></div><div id="t1514929624000256" t="2018-01-02 21:47:04 mikerod more interesting even"><a href="#t1514929624000256" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-02</span> <span class="t" onclick="H(this)">21:47:04</span>                      mikerod </span><span>more interesting even</span></div><div id="t1514929650000076" t="2018-01-02 21:47:30 mikerod (defrule update-it
  [?a &lt;- A (= value 10)]
  =&gt;
  (update! ?a #(update % :value inc)))
 
Here the  update!  actually contradicts the LHS condition - I still think that should be ok"><a href="#t1514929650000076" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-02</span> <span class="t" onclick="H(this)">21:47:30</span>                      mikerod </span><pre>(defrule update-it
  [?a &lt;- A (= value 10)]
  =&gt;
  (update! ?a #(update % :value inc)))
</pre><span>
Here the </span><code>update!</code><span> actually contradicts the LHS condition - I still think that should be ok</span></div><div id="t1514929677000137" t="2018-01-02 21:47:57 mikerod It should participate in a well-defined way with the truth maintenance is the point."><a href="#t1514929677000137" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-02</span> <span class="t" onclick="H(this)">21:47:57</span>                      mikerod </span><span>It should participate in a well-defined way with the truth maintenance is the point.</span></div><div id="t1514929716000252" t="2018-01-02 21:48:36 mikerod Then there would have to be considertaion of something like:
 (defrule update-it
  [?a &lt;- A (= value 10)]
  =&gt;
  (update! ?a #(update % :value inc))
  (insert! (-&gt;B)))
"><a href="#t1514929716000252" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-02</span> <span class="t" onclick="H(this)">21:48:36</span>                      mikerod </span><span>Then there would have to be considertaion of something like:
</span><pre>(defrule update-it
  [?a &lt;- A (= value 10)]
  =&gt;
  (update! ?a #(update % :value inc))
  (insert! (-&gt;B)))
</pre></div><div id="t1514929758000524" t="2018-01-02 21:49:18 mikerod Here you have a new fact that relies on truth maintenance and this rule as it’s “logical support”. It’s a tougher case to consider due to the LHS no longer being true. I’m thinking the token should be constructed in a way taht makes the updated  ?a  support the new  B"><a href="#t1514929758000524" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-02</span> <span class="t" onclick="H(this)">21:49:18</span>                      mikerod </span><span>Here you have a new fact that relies on truth maintenance and this rule as it’s “logical support”. It’s a tougher case to consider due to the LHS no longer being true. I’m thinking the token should be constructed in a way taht makes the updated </span><code>?a</code><span> support the new </span><code>B</code></div><div id="t1514929920000332" t="2018-01-02 21:52:00 mikerod I might agree that retraction of a logically derived fact doesn’t make sense. You could always just retract the “root facts” that caused it. I do think that would make sense to be able to be done in the RHS and behave as expected with respect to the batched insertions of other rules in the same activation group though"><a href="#t1514929920000332" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-02</span> <span class="t" onclick="H(this)">21:52:00</span>                      mikerod </span><span>I might agree that retraction of a logically derived fact doesn’t make sense. You could always just retract the “root facts” that caused it. I do think that would make sense to be able to be done in the RHS and behave as expected with respect to the batched insertions of other rules in the same activation group though</span></div><div id="t1514931603000081" t="2018-01-02 22:20:03 wparker By “batched insertions” do you mean the stuff in  https://github.com/cerner/clara-rules/issues/229  ?"><a href="#t1514931603000081" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-02</span> <span class="t" onclick="H(this)">22:20:03</span>                      wparker </span><span>By “batched insertions” do you mean the stuff in </span><a href="https://github.com/cerner/clara-rules/issues/229" target="_blank">https://github.com/cerner/clara-rules/issues/229</a><span> ?</span></div><div id="t1514932101000013" t="2018-01-02 22:28:21 mikerod yep"><a href="#t1514932101000013" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-02</span> <span class="t" onclick="H(this)">22:28:21</span>                      mikerod </span><span>yep</span></div><div id="t1514922533000041" t="2018-01-02 19:48:53 alex-dixon @wparker Also over the break @mikerod and I discussed short circuiting the evaluation of LHS along with Drools’ “property reactive”"><a href="#t1514922533000041" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-02</span> <span class="t" onclick="H(this)">19:48:53</span>              alex-dixon </span><span>@wparker Also over the break @mikerod and I discussed short circuiting the evaluation of LHS along with Drools’ “property reactive”</span></div><div id="t1514929966000290" t="2018-01-02 21:52:46 mikerod This one is unrelated a bit to our other thread concerning  update! ."><a href="#t1514929966000290" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-02</span> <span class="t" onclick="H(this)">21:52:46</span>                      mikerod </span><span>This one is unrelated a bit to our other thread concerning </span><code>update!</code><span>.</span></div><div id="t1514930003000101" t="2018-01-02 21:53:23 mikerod It shouldn’t be too difficult to have Clara do something like “unlinking” conditions from evaluation when required prior conditions haven’t been satisfied yet."><a href="#t1514930003000101" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-02</span> <span class="t" onclick="H(this)">21:53:23</span>                      mikerod </span><span>It shouldn’t be too difficult to have Clara do something like “unlinking” conditions from evaluation when required prior conditions haven’t been satisfied yet.</span></div><div id="t1514930094000200" t="2018-01-02 21:54:54 mikerod A good example of the problem is something like:

 (defrule do-things
  [A (= ?id id)]
  [B (= ?id id) (expensive-constraint x)]
  =&gt;
  (insert! (-&gt;C)))

 
Clara will currently do the   (expensive-constraint x)  when  B s are inserted, with no  A  in working memory at all, even if this condition is only used in this rule"><a href="#t1514930094000200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-02</span> <span class="t" onclick="H(this)">21:54:54</span>                      mikerod </span><span>A good example of the problem is something like:

</span><pre>(defrule do-things
  [A (= ?id id)]
  [B (= ?id id) (expensive-constraint x)]
  =&gt;
  (insert! (-&gt;C)))

</pre><span>
Clara will currently do the </span><code> (expensive-constraint x)</code><span> when </span><code>B</code><span>s are inserted, with no </span><code>A</code><span> in working memory at all, even if this condition is only used in this rule</span></div><div id="t1514930167000105" t="2018-01-02 21:56:07 mikerod You can write rules to avoid it like:
 (defrule find-things
  [A (= ?id id)]
  [?b &lt;- B (= ?id id)]
  =&gt;
  (insert! (-&gt;ReadyB ?b)))

(defrule do-things
  [ReadyB (expensive-constraint x)]
  =&gt;
  (insert! (-&gt;C)))
"><a href="#t1514930167000105" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-02</span> <span class="t" onclick="H(this)">21:56:07</span>                      mikerod </span><span>You can write rules to avoid it like:
</span><pre>(defrule find-things
  [A (= ?id id)]
  [?b &lt;- B (= ?id id)]
  =&gt;
  (insert! (-&gt;ReadyB ?b)))

(defrule do-things
  [ReadyB (expensive-constraint x)]
  =&gt;
  (insert! (-&gt;C)))
</pre></div><div id="t1514930187000587" t="2018-01-02 21:56:27 mikerod However, that is not super obvious and also may not always be so straightforward to correctly split"><a href="#t1514930187000587" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-02</span> <span class="t" onclick="H(this)">21:56:27</span>                      mikerod </span><span>However, that is not super obvious and also may not always be so straightforward to correctly split</span></div><div id="t1514931778000143" t="2018-01-02 22:22:58 wparker If you have ideas on how to implement that in a simple way I’d be interested.  🙂   It seems like it could get complicated though."><a href="#t1514931778000143" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-02</span> <span class="t" onclick="H(this)">22:22:58</span>                      wparker </span><span>If you have ideas on how to implement that in a simple way I’d be interested. </span><b>🙂</b><span>  It seems like it could get complicated though.</span></div><div id="t1514931855000177" t="2018-01-02 22:24:15 wparker On a possibly similar note, I’ve toyed with changing the structure where a rule only has one parent before - if there are independent conditions, they don’t inherently need to propagate through each other.  That would be a lot of work to change though"><a href="#t1514931855000177" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-02</span> <span class="t" onclick="H(this)">22:24:15</span>                      wparker </span><span>On a possibly similar note, I’ve toyed with changing the structure where a rule only has one parent before - if there are independent conditions, they don’t inherently need to propagate through each other.  That would be a lot of work to change though</span></div><div id="t1514932192000023" t="2018-01-02 22:29:52 mikerod I think the case you are describing is interesting. I’m not sure how great it is to have a rule with unrelated conditions, but I know that idea comes up for doing things like aggregations onto a larger “aggregated fact”"><a href="#t1514932192000023" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-02</span> <span class="t" onclick="H(this)">22:29:52</span>                      mikerod </span><span>I think the case you are describing is interesting. I’m not sure how great it is to have a rule with unrelated conditions, but I know that idea comes up for doing things like aggregations onto a larger “aggregated fact”</span></div><div id="t1514932204000083" t="2018-01-02 22:30:04 mikerod In terms of what I mentioned above, I’m not sure it’d be that difficult"><a href="#t1514932204000083" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-02</span> <span class="t" onclick="H(this)">22:30:04</span>                      mikerod </span><span>In terms of what I mentioned above, I’m not sure it’d be that difficult</span></div><div id="t1514932219000484" t="2018-01-02 22:30:19 mikerod I am at least thinking about it like:"><a href="#t1514932219000484" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-02</span> <span class="t" onclick="H(this)">22:30:19</span>                      mikerod </span><span>I am at least thinking about it like:</span></div><div id="t1514932233000182" t="2018-01-02 22:30:33 mikerod 1) during compilation, track if rule conditions rely on others"><a href="#t1514932233000182" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-02</span> <span class="t" onclick="H(this)">22:30:33</span>                      mikerod </span><span>1) during compilation, track if rule conditions rely on others</span></div><div id="t1514932272000041" t="2018-01-02 22:31:12 mikerod 2) during rule evaluation, avoid testing conditions if their upstream dependencies haven’t yet had any matches. Just batch the facts to test “later”"><a href="#t1514932272000041" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-02</span> <span class="t" onclick="H(this)">22:31:12</span>                      mikerod </span><span>2) during rule evaluation, avoid testing conditions if their upstream dependencies haven’t yet had any matches. Just batch the facts to test “later”</span></div><div id="t1514932293000290" t="2018-01-02 22:31:33 mikerod 3) the batch is “flushed” when the condition is reached via the left activation"><a href="#t1514932293000290" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-02</span> <span class="t" onclick="H(this)">22:31:33</span>                      mikerod </span><span>3) the batch is “flushed” when the condition is reached via the left activation</span></div><div id="t1514932311000482" t="2018-01-02 22:31:51 mikerod Negation nodes sort of work by batching fact evaluation already"><a href="#t1514932311000482" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-02</span> <span class="t" onclick="H(this)">22:31:51</span>                      mikerod </span><span>Negation nodes sort of work by batching fact evaluation already</span></div><div id="t1514932331000215" t="2018-01-02 22:32:11 mikerod I think it may not be too terribly difficult at least. Of course I haven’t tried at all yet  😛"><a href="#t1514932331000215" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-02</span> <span class="t" onclick="H(this)">22:32:11</span>                      mikerod </span><span>I think it may not be too terribly difficult at least. Of course I haven’t tried at all yet </span><b>😛</b></div><div id="t1514932235000210" t="2018-01-02 22:30:35 tcarls Hmm -- the railroad diagram link in  https://github.com/cerner/clara-rules/wiki/guide  appears to be broken."><a href="#t1514932235000210" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-02</span> <span class="t" onclick="H(this)">22:30:35</span>                  tcarls </span><span>Hmm -- the railroad diagram link in </span><a href="https://github.com/cerner/clara-rules/wiki/guide" target="_blank">https://github.com/cerner/clara-rules/wiki/guide</a><span> appears to be broken.</span></div><div id="t1514932894000423" t="2018-01-02 22:41:34 ryanbrush @tcarls Thanks. All of that content now lives over on the web site at  http://www.clara-rules.org/docs/rules/ , so we need to delete/redirect those wiki pages."><a href="#t1514932894000423" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-02</span> <span class="t" onclick="H(this)">22:41:34</span>               ryanbrush </span><span>@tcarls Thanks. All of that content now lives over on the web site at </span><a href="http://www.clara-rules.org/docs/rules/" target="_blank">http://www.clara-rules.org/docs/rules/</a><span>, so we need to delete/redirect those wiki pages.</span></div><div id="t1515032765000260" t="2018-01-04 02:26:05 cfleming I have some questions about the fact-expr grammar over here:  https://github.com/cursive-ide/clara-specs/issues/4"><a href="#t1515032765000260" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-04</span> <span class="t" onclick="H(this)">02:26:05</span>                cfleming </span><span>I have some questions about the fact-expr grammar over here: </span><a href="https://github.com/cursive-ide/clara-specs/issues/4" target="_blank">https://github.com/cursive-ide/clara-specs/issues/4</a></div><div id="t1515032889000130" t="2018-01-04 02:28:09 cfleming Actually, looking at the schema I see that  FactCondition :type  is  s/Any , bummer."><a href="#t1515032889000130" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-04</span> <span class="t" onclick="H(this)">02:28:09</span>                cfleming </span><span>Actually, looking at the schema I see that </span><code>FactCondition :type</code><span> is </span><code>s/Any</code><span>, bummer.</span></div><div id="t1515070487000047" t="2018-01-04 12:54:47 mikerod @cfleming Yeah, I can see where that is difficult and yes the “fact type” being anything makes things complicated"><a href="#t1515070487000047" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-04</span> <span class="t" onclick="H(this)">12:54:47</span>                 mikerod </span><span>@cfleming Yeah, I can see where that is difficult and yes the “fact type” being anything makes things complicated</span></div><div id="t1515070546000387" t="2018-01-04 12:55:46 mikerod I’m pretty sure you can break Clara parsing if you try to use a fact type that seems too much like something else."><a href="#t1515070546000387" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-04</span> <span class="t" onclick="H(this)">12:55:46</span>                 mikerod </span><span>I’m pretty sure you can break Clara parsing if you try to use a fact type that seems too much like something else.</span></div><div id="t1515070574000476" t="2018-01-04 12:56:14 mikerod One thing that is interesting and probably should be part of the spec (I don’t believe it is now), is that variable bindings should always start with “?”"><a href="#t1515070574000476" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-04</span> <span class="t" onclick="H(this)">12:56:14</span>                 mikerod </span><span>One thing that is interesting and probably should be part of the spec (I don’t believe it is now), is that variable bindings should always start with “?”</span></div><div id="t1515070594000399" t="2018-01-04 12:56:34 mikerod So in the case of the fact binding, it is the  ::variable-binding  from that PR"><a href="#t1515070594000399" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-04</span> <span class="t" onclick="H(this)">12:56:34</span>                 mikerod </span><span>So in the case of the fact binding, it is the </span><code>::variable-binding</code><span> from that PR</span></div><div id="t1515070634000229" t="2018-01-04 12:57:14 mikerod And perhaps we should just list a few things that a fact type should not be, like it shouldn’t be a symbol that starts with a “?”"><a href="#t1515070634000229" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-04</span> <span class="t" onclick="H(this)">12:57:14</span>                 mikerod </span><span>And perhaps we should just list a few things that a fact type should not be, like it shouldn’t be a symbol that starts with a “?”</span></div><div id="t1515070664000210" t="2018-01-04 12:57:44 mikerod I think it may not be ok for it to be a vector either. I seem to recall a bad parse example from long back where a fact type as a vector would mess up things."><a href="#t1515070664000210" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-04</span> <span class="t" onclick="H(this)">12:57:44</span>                 mikerod </span><span>I think it may not be ok for it to be a vector either. I seem to recall a bad parse example from long back where a fact type as a vector would mess up things.</span></div><div id="t1515072354000015" t="2018-01-04 13:25:54 tcarls Are there suggested patterns for rules that can require potentially-expensive lookups? If I have a rule that depends on content that could be retrieved from an API call / database hit / etc., is there a way to trigger that retrieval (and insert any facts it results in) only when the rule&apos;s other conditions are satisfied?"><a href="#t1515072354000015" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-04</span> <span class="t" onclick="H(this)">13:25:54</span>                  tcarls </span><span>Are there suggested patterns for rules that can require potentially-expensive lookups? If I have a rule that depends on content that could be retrieved from an API call / database hit / etc., is there a way to trigger that retrieval (and insert any facts it results in) only when the rule&apos;s other conditions are satisfied?</span></div><div id="t1515072722000324" t="2018-01-04 13:32:02 mikerod @tcarls that’s funny you bring that up since this topic came up fairly recently here"><a href="#t1515072722000324" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-04</span> <span class="t" onclick="H(this)">13:32:02</span>                 mikerod </span><span>@tcarls that’s funny you bring that up since this topic came up fairly recently here</span></div><div id="t1515072748000133" t="2018-01-04 13:32:28 mikerod In short: I think in the future Clara could do better to avoid doing work when required previous conditions aren’t yet satisfied."><a href="#t1515072748000133" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-04</span> <span class="t" onclick="H(this)">13:32:28</span>                 mikerod </span><span>In short: I think in the future Clara could do better to avoid doing work when required previous conditions aren’t yet satisfied.</span></div><div id="t1515072753000254" t="2018-01-04 13:32:33 mikerod However, there is a workaround pattern:"><a href="#t1515072753000254" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-04</span> <span class="t" onclick="H(this)">13:32:33</span>                 mikerod </span><span>However, there is a workaround pattern:</span></div><div id="t1515072880000374" t="2018-01-04 13:34:40 mikerod ;; Say you have this:
(defrule original
  [A (= ?id id)]
  [B (= ?id id) (do-expensive-thing x)]
  =&gt;
  (insert (-&gt;C)))


It can be transformed to this:
(defrule part-1
  [A (= ?id id)]
  [?b &lt;- B (= ?id id)]
  =&gt;
  (insert (-&gt;MatchedB ?b)))

(defrule part-2
  [MatchedB (do-expensive-thing x)]
  =&gt;
  (insert (-&gt;C)))
"><a href="#t1515072880000374" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-04</span> <span class="t" onclick="H(this)">13:34:40</span>                 mikerod </span><pre>;; Say you have this:
(defrule original
  [A (= ?id id)]
  [B (= ?id id) (do-expensive-thing x)]
  =&gt;
  (insert (-&gt;C)))


It can be transformed to this:
(defrule part-1
  [A (= ?id id)]
  [?b &lt;- B (= ?id id)]
  =&gt;
  (insert (-&gt;MatchedB ?b)))

(defrule part-2
  [MatchedB (do-expensive-thing x)]
  =&gt;
  (insert (-&gt;C)))
</pre></div><div id="t1515073104000208" t="2018-01-04 13:38:24 mikerod If you are in a situation where there may be some thrash of insert/retracts of  A  and  B  (from example) due to the truth maintenance of the network, then you can also consider adding either  :salience  or setup “activation groups” for rules like  part-2 . However, I’d only do that if there is actually a situation where it could be an issue."><a href="#t1515073104000208" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-04</span> <span class="t" onclick="H(this)">13:38:24</span>                 mikerod </span><span>If you are in a situation where there may be some thrash of insert/retracts of </span><code>A</code><span> and </span><code>B</code><span> (from example) due to the truth maintenance of the network, then you can also consider adding either </span><code>:salience</code><span> or setup “activation groups” for rules like </span><code>part-2</code><span>. However, I’d only do that if there is actually a situation where it could be an issue.</span></div><div id="t1515073808000470" t="2018-01-04 13:50:08 tcarls Thank you -- that&apos;s useful advice."><a href="#t1515073808000470" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-04</span> <span class="t" onclick="H(this)">13:50:08</span>                  tcarls </span><span>Thank you -- that&apos;s useful advice.</span></div><div id="t1515074111000010" t="2018-01-04 13:55:11 mikerod Some details on salience and activations groups is written here:  http://www.clara-rules.org/docs/conflictsalience/  
If you end up needing it. However, like I said, avoid it if unnecessary. It is additional complexity to deal with."><a href="#t1515074111000010" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-04</span> <span class="t" onclick="H(this)">13:55:11</span>                 mikerod </span><span>Some details on salience and activations groups is written here: </span><a href="http://www.clara-rules.org/docs/conflictsalience/" target="_blank">http://www.clara-rules.org/docs/conflictsalience/</a><span> 
If you end up needing it. However, like I said, avoid it if unnecessary. It is additional complexity to deal with.</span></div><div id="t1515104549000192" t="2018-01-04 22:22:29 sparkofreason Is there a way to establish a conditional relationship between facts outside of a rule RHS? The case I&apos;m thinking of is something like an article app, where articles have comments. Selecting an article makes it &quot;active&quot;, and also triggers a request to fetch comments from the server. When the async request completes, comments will be inserted. It would be slick if retracting the active article fact also automagically retracted the inserted comments, but since the response handler for the comments request executes outside of a rule context, I don&apos;t see an obvious way to enforce that logical connection."><a href="#t1515104549000192" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-04</span> <span class="t" onclick="H(this)">22:22:29</span>           sparkofreason </span><span>Is there a way to establish a conditional relationship between facts outside of a rule RHS? The case I&apos;m thinking of is something like an article app, where articles have comments. Selecting an article makes it &quot;active&quot;, and also triggers a request to fetch comments from the server. When the async request completes, comments will be inserted. It would be slick if retracting the active article fact also automagically retracted the inserted comments, but since the response handler for the comments request executes outside of a rule context, I don&apos;t see an obvious way to enforce that logical connection.</span></div><div id="t1515106103000441" t="2018-01-04 22:48:23 zylox You could write something fairly easily to &quot;deactivate&quot; them (by joining the comment fact to the article and inserting an ActiveComment or something) but that wouldnt retract the base comment fact which could lead to build up over time. I don&apos;t know of any way to do what you are talking about without an external handler atm"><a href="#t1515106103000441" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-04</span> <span class="t" onclick="H(this)">22:48:23</span>                   zylox </span><span>You could write something fairly easily to &quot;deactivate&quot; them (by joining the comment fact to the article and inserting an ActiveComment or something) but that wouldnt retract the base comment fact which could lead to build up over time. I don&apos;t know of any way to do what you are talking about without an external handler atm</span></div><div id="t1515106238000106" t="2018-01-04 22:50:38 zylox they would have to come in on the same data object into the session which doesnt match the timeline you describe"><a href="#t1515106238000106" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-04</span> <span class="t" onclick="H(this)">22:50:38</span>                   zylox </span><span>they would have to come in on the same data object into the session which doesnt match the timeline you describe</span></div><div id="t1515164253000437" t="2018-01-05 14:57:33 mikerod @dave.dixon I think that works. The only caveat is just that there are a few outstanding issues with RHS  retract! .  There are some edge cases with how they may work with logical insertions. I think it doesn’t typically come up.
 https://github.com/cerner/clara-rules/issues/229 
 https://github.com/cerner/clara-rules/issues/321 

I mention both in  http://www.metasimple.org/2017/12/23/clara-updating-facts.html"><a href="#t1515164253000437" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-05</span> <span class="t" onclick="H(this)">14:57:33</span>                 mikerod </span><span>@dave.dixon I think that works. The only caveat is just that there are a few outstanding issues with RHS </span><code>retract!</code><span>.  There are some edge cases with how they may work with logical insertions. I think it doesn’t typically come up.
</span><a href="https://github.com/cerner/clara-rules/issues/229" target="_blank">https://github.com/cerner/clara-rules/issues/229</a><span>
</span><a href="https://github.com/cerner/clara-rules/issues/321" target="_blank">https://github.com/cerner/clara-rules/issues/321</a><span>

I mention both in </span><a href="http://www.metasimple.org/2017/12/23/clara-updating-facts.html" target="_blank">http://www.metasimple.org/2017/12/23/clara-updating-facts.html</a></div><div id="t1515164484000279" t="2018-01-05 15:01:24 mikerod Other than that though, the rules above seem reasonable. That is something I’d expect should work. To the point @zylox made: It looks like you do have some sort of external retract that is removing the  ActiveArticle  in your example."><a href="#t1515164484000279" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-05</span> <span class="t" onclick="H(this)">15:01:24</span>                 mikerod </span><span>Other than that though, the rules above seem reasonable. That is something I’d expect should work. To the point @zylox made: It looks like you do have some sort of external retract that is removing the </span><code>ActiveArticle</code><span> in your example.</span></div><div id="t1515164628000064" t="2018-01-05 15:03:48 zylox Ya, i was approaching it from the perspective of using truth maintenance for it because of the &quot;outside of a rule RHS?&quot;. glad you found something that works for you."><a href="#t1515164628000064" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-05</span> <span class="t" onclick="H(this)">15:03:48</span>                   zylox </span><span>Ya, i was approaching it from the perspective of using truth maintenance for it because of the &quot;outside of a rule RHS?&quot;. glad you found something that works for you.</span></div><div id="t1515164725000520" t="2018-01-05 15:05:25 sparkofreason Yes,  ActiveArticle  is removed externally. It does work nicely."><a href="#t1515164725000520" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-05</span> <span class="t" onclick="H(this)">15:05:25</span>           sparkofreason </span><span>Yes, </span><code>ActiveArticle</code><span> is removed externally. It does work nicely.</span></div><div id="t1515165331000504" t="2018-01-05 15:15:31 sparkofreason ::handle-cancelled-response  is arguably just &quot;nice to have&quot;, catches the case of  ActiveArticle  changing before the response to the comments request is received. If one ran into the edge-cases around  retract!  I think you could just have some sort of periodic clean-up of dangling  CommentsResponse  facts."><a href="#t1515165331000504" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-05</span> <span class="t" onclick="H(this)">15:15:31</span>           sparkofreason </span><code>::handle-cancelled-response</code><span> is arguably just &quot;nice to have&quot;, catches the case of </span><code>ActiveArticle</code><span> changing before the response to the comments request is received. If one ran into the edge-cases around </span><code>retract!</code><span> I think you could just have some sort of periodic clean-up of dangling </span><code>CommentsResponse</code><span> facts.</span></div><div id="t1515165564000761" t="2018-01-05 15:19:24 mikerod I like it overall. I really would like to try to get the edge cases of  retract!  removed. The issue it has is mostly how it interacts with the truth maintenance of other rules that are firing in the same “cycle”"><a href="#t1515165564000761" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-05</span> <span class="t" onclick="H(this)">15:19:24</span>                 mikerod </span><span>I like it overall. I really would like to try to get the edge cases of </span><code>retract!</code><span> removed. The issue it has is mostly how it interacts with the truth maintenance of other rules that are firing in the same “cycle”</span></div><div id="t1515165619000461" t="2018-01-05 15:20:19 mikerod The removal of the  CommentsResponse  cleans up all the  Comment  due to truth maintenance, which is nice."><a href="#t1515165619000461" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-05</span> <span class="t" onclick="H(this)">15:20:19</span>                 mikerod </span><span>The removal of the </span><code>CommentsResponse</code><span> cleans up all the </span><code>Comment</code><span> due to truth maintenance, which is nice.</span></div><div id="t1515165643000418" t="2018-01-05 15:20:43 mikerod Oh, I guess the  ActiveArticle  does too - woops. But either way, it is nice to be able to cleanup old facts liek that"><a href="#t1515165643000418" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-05</span> <span class="t" onclick="H(this)">15:20:43</span>                 mikerod </span><span>Oh, I guess the </span><code>ActiveArticle</code><span> does too - woops. But either way, it is nice to be able to cleanup old facts liek that</span></div><div id="t1515253446000028" t="2018-01-06 15:44:06 alex-dixon May not have had enough coffee yet but….how do I do something like this without getting an unbound variable error? 
 [SomeFact (= a ?a) (= b ?b)]
[:not [:and [Fact1 (= e ?e) (= a ?a)]
                   [Fact2 (= e ?e) (= b ?b]]] 
"><a href="#t1515253446000028" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-06</span> <span class="t" onclick="H(this)">15:44:06</span>              alex-dixon </span><span>May not have had enough coffee yet but….how do I do something like this without getting an unbound variable error? 
</span><pre>[SomeFact (= a ?a) (= b ?b)]
[:not [:and [Fact1 (= e ?e) (= a ?a)]
                   [Fact2 (= e ?e) (= b ?b]]] 
</pre></div><div id="t1515258407000128" t="2018-01-06 17:06:47 mikerod @alex-dixon I am not sure if @wparker has an issue logged on this subject but odd things can happen sometime in rule compilation due to how Clara compiler converts these Boolean conditions to disjunctive normal form. DNF"><a href="#t1515258407000128" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-06</span> <span class="t" onclick="H(this)">17:06:47</span>                 mikerod </span><span>@alex-dixon I am not sure if @wparker has an issue logged on this subject but odd things can happen sometime in rule compilation due to how Clara compiler converts these Boolean conditions to disjunctive normal form. DNF</span></div><div id="t1515258445000023" t="2018-01-06 17:07:25 mikerod So the conditions in the :and are being split by an :or. "><a href="#t1515258445000023" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-06</span> <span class="t" onclick="H(this)">17:07:25</span>                 mikerod </span><span>So the conditions in the :and are being split by an :or. </span></div><div id="t1515258726000040" t="2018-01-06 17:12:06 mikerod I need to look a bit though. Thought the case above was covered. "><a href="#t1515258726000040" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-06</span> <span class="t" onclick="H(this)">17:12:06</span>                 mikerod </span><span>I need to look a bit though. Thought the case above was covered. </span></div><div id="t1515258752000005" t="2018-01-06 17:12:32 mikerod Basic negated conjunctions should be supported. "><a href="#t1515258752000005" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-06</span> <span class="t" onclick="H(this)">17:12:32</span>                 mikerod </span><span>Basic negated conjunctions should be supported. </span></div><div id="t1515258840000155" t="2018-01-06 17:14:00 alex-dixon Hm ok"><a href="#t1515258840000155" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-06</span> <span class="t" onclick="H(this)">17:14:00</span>              alex-dixon </span><span>Hm ok</span></div><div id="t1515258858000059" t="2018-01-06 17:14:18 alex-dixon By the way is [:not {:exists valid in any way?"><a href="#t1515258858000059" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-06</span> <span class="t" onclick="H(this)">17:14:18</span>              alex-dixon </span><span>By the way is [:not {:exists valid in any way?</span></div><div id="t1515258998000134" t="2018-01-06 17:16:38 alex-dixon @mikerod or is that just equivalent to [:not .. ] ?"><a href="#t1515258998000134" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-06</span> <span class="t" onclick="H(this)">17:16:38</span>              alex-dixon </span><span>@mikerod or is that just equivalent to [:not .. ] ?</span></div><div id="t1515259349000167" t="2018-01-06 17:22:29 mikerod Should mean the same thing. "><a href="#t1515259349000167" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-06</span> <span class="t" onclick="H(this)">17:22:29</span>                 mikerod </span><span>Should mean the same thing. </span></div><div id="t1515259358000063" t="2018-01-06 17:22:38 mikerod Not sure if it works out that way though. Hah"><a href="#t1515259358000063" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-06</span> <span class="t" onclick="H(this)">17:22:38</span>                 mikerod </span><span>Not sure if it works out that way though. Hah</span></div><div id="t1515259362000005" t="2018-01-06 17:22:42 mikerod I’d avoid it. "><a href="#t1515259362000005" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-06</span> <span class="t" onclick="H(this)">17:22:42</span>                 mikerod </span><span>I’d avoid it. </span></div><div id="t1515259410000073" t="2018-01-06 17:23:30 mikerod Some of the negation transformation stuff probably could be improved. I think Will had thoughts on that. I thought he logged an issue. I want to look at what is compiled in your example about to see why you’d have an inbound variable issue "><a href="#t1515259410000073" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-06</span> <span class="t" onclick="H(this)">17:23:30</span>                 mikerod </span><span>Some of the negation transformation stuff probably could be improved. I think Will had thoughts on that. I thought he logged an issue. I want to look at what is compiled in your example about to see why you’d have an inbound variable issue </span></div><div id="t1515259423000023" t="2018-01-06 17:23:43 mikerod I am not on laptop now. Will be in a few. "><a href="#t1515259423000023" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-06</span> <span class="t" onclick="H(this)">17:23:43</span>                 mikerod </span><span>I am not on laptop now. Will be in a few. </span></div><div id="t1515259438000015" t="2018-01-06 17:23:58 mikerod (I don’t run Clara repl experiments on my phone unfortunately)"><a href="#t1515259438000015" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-06</span> <span class="t" onclick="H(this)">17:23:58</span>                 mikerod </span><span>(I don’t run Clara repl experiments on my phone unfortunately)</span></div><div id="t1515263876000035" t="2018-01-06 18:37:56 alex-dixon Ok. Started working on spec stuff. Equally stuck there so let me know lol"><a href="#t1515263876000035" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-06</span> <span class="t" onclick="H(this)">18:37:56</span>              alex-dixon </span><span>Ok. Started working on spec stuff. Equally stuck there so let me know lol</span></div><div id="t1515275984000023" t="2018-01-06 21:59:44 mikerod @alex-dixon See  https://github.com/cerner/clara-rules/issues/347"><a href="#t1515275984000023" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-06</span> <span class="t" onclick="H(this)">21:59:44</span>                 mikerod </span><span>@alex-dixon See </span><a href="https://github.com/cerner/clara-rules/issues/347" target="_blank">https://github.com/cerner/clara-rules/issues/347</a></div><div id="t1515275995000001" t="2018-01-06 21:59:55 alex-dixon Was just looking at it hah"><a href="#t1515275995000001" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-06</span> <span class="t" onclick="H(this)">21:59:55</span>              alex-dixon </span><span>Was just looking at it hah</span></div><div id="t1515276042000027" t="2018-01-06 22:00:42 mikerod There are severael issues here. The work that was done before only worked in a fairly small set of situations"><a href="#t1515276042000027" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-06</span> <span class="t" onclick="H(this)">22:00:42</span>                 mikerod </span><span>There are severael issues here. The work that was done before only worked in a fairly small set of situations</span></div><div id="t1515276042000099" t="2018-01-06 22:00:42 alex-dixon So that’s identical"><a href="#t1515276042000099" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-06</span> <span class="t" onclick="H(this)">22:00:42</span>              alex-dixon </span><span>So that’s identical</span></div><div id="t1515276060000036" t="2018-01-06 22:01:00 mikerod if you can, the workaround is to just move out the conjunction to a different rule I believe"><a href="#t1515276060000036" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-06</span> <span class="t" onclick="H(this)">22:01:00</span>                 mikerod </span><span>if you can, the workaround is to just move out the conjunction to a different rule I believe</span></div><div id="t1515276092000113" t="2018-01-06 22:01:32 alex-dixon Ok. Let me unwind my attempts that aren’t working and attempt that"><a href="#t1515276092000113" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-06</span> <span class="t" onclick="H(this)">22:01:32</span>              alex-dixon </span><span>Ok. Let me unwind my attempts that aren’t working and attempt that</span></div><div id="t1515276124000021" t="2018-01-06 22:02:04 mikerod (defrule r1
  
   [Fact1 (= e ?e) (= a ?a)]
   [Fact2 (= e ?e) (= b ?b)]
  =&gt;
  (insert! (-&gt;Fact3 ?e ?a ?b)))


(defrule r2
  [SomeFact (= a ?a) (= b ?b)]
  [:not [Fact3 (= a ?a) (= b ?b)]]
  =&gt;
  (prn {:a ?a
        :b ?b
        :e ?e}))
"><a href="#t1515276124000021" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-06</span> <span class="t" onclick="H(this)">22:02:04</span>                 mikerod </span><pre>(defrule r1
  
   [Fact1 (= e ?e) (= a ?a)]
   [Fact2 (= e ?e) (= b ?b)]
  =&gt;
  (insert! (-&gt;Fact3 ?e ?a ?b)))


(defrule r2
  [SomeFact (= a ?a) (= b ?b)]
  [:not [Fact3 (= a ?a) (= b ?b)]]
  =&gt;
  (prn {:a ?a
        :b ?b
        :e ?e}))
</pre></div><div id="t1515276136000041" t="2018-01-06 22:02:16 mikerod I believe that is the extraction"><a href="#t1515276136000041" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-06</span> <span class="t" onclick="H(this)">22:02:16</span>                 mikerod </span><span>I believe that is the extraction</span></div><div id="t1515276180000053" t="2018-01-06 22:03:00 mikerod That would pair all  Fact1  and  Fact2  facts together in the  r1  join to make the  Fact3  facts"><a href="#t1515276180000053" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-06</span> <span class="t" onclick="H(this)">22:03:00</span>                 mikerod </span><span>That would pair all </span><code>Fact1</code><span> and </span><code>Fact2</code><span> facts together in the </span><code>r1</code><span> join to make the </span><code>Fact3</code><span> facts</span></div><div id="t1515276203000009" t="2018-01-06 22:03:23 mikerod Then  r2  would be looking for the non-existence of any of those join results to match the same  a  and  b  of a  SomeFact  fact"><a href="#t1515276203000009" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-06</span> <span class="t" onclick="H(this)">22:03:23</span>                 mikerod </span><span>Then </span><code>r2</code><span> would be looking for the non-existence of any of those join results to match the same </span><code>a</code><span> and </span><code>b</code><span> of a </span><code>SomeFact</code><span> fact</span></div><div id="t1515276285000058" t="2018-01-06 22:04:45 alex-dixon Just to clarify my understanding is the :and necessary in r1?"><a href="#t1515276285000058" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-06</span> <span class="t" onclick="H(this)">22:04:45</span>              alex-dixon </span><span>Just to clarify my understanding is the :and necessary in r1?</span></div><div id="t1515276838000046" t="2018-01-06 22:13:58 mikerod @alex-dixon no, sorry"><a href="#t1515276838000046" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-06</span> <span class="t" onclick="H(this)">22:13:58</span>                 mikerod </span><span>@alex-dixon no, sorry</span></div><div id="t1515276850000104" t="2018-01-06 22:14:10 mikerod I just quickly extracted it and forgot I had the  :and  there still"><a href="#t1515276850000104" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-06</span> <span class="t" onclick="H(this)">22:14:10</span>                 mikerod </span><span>I just quickly extracted it and forgot I had the </span><code>:and</code><span> there still</span></div><div id="t1515276856000054" t="2018-01-06 22:14:16 mikerod I’d leave it out  😛"><a href="#t1515276856000054" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-06</span> <span class="t" onclick="H(this)">22:14:16</span>                 mikerod </span><span>I’d leave it out </span><b>😛</b></div><div id="t1515276871000059" t="2018-01-06 22:14:31 mikerod edited to avoid more confusion"><a href="#t1515276871000059" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-06</span> <span class="t" onclick="H(this)">22:14:31</span>                 mikerod </span><span>edited to avoid more confusion</span></div><div id="t1515276910000091" t="2018-01-06 22:15:10 alex-dixon Will try asap. Had to take a break "><a href="#t1515276910000091" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-06</span> <span class="t" onclick="H(this)">22:15:10</span>              alex-dixon </span><span>Will try asap. Had to take a break </span></div><div id="t1515276925000006" t="2018-01-06 22:15:25 alex-dixon Thanks for your responses"><a href="#t1515276925000006" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-06</span> <span class="t" onclick="H(this)">22:15:25</span>              alex-dixon </span><span>Thanks for your responses</span></div><div id="t1515277025000048" t="2018-01-06 22:17:05 mikerod No problem. That is unfortunate that there are still several caveats to nesting conditions within negation"><a href="#t1515277025000048" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-06</span> <span class="t" onclick="H(this)">22:17:05</span>                 mikerod </span><span>No problem. That is unfortunate that there are still several caveats to nesting conditions within negation</span></div><div id="t1515277074000053" t="2018-01-06 22:17:54 mikerod A lot of the time it can be solved by just pulling everything complex out of the  :not  and put it into a different rule where an “bridge”/intermediate fact is used to communicate the logic across the rules"><a href="#t1515277074000053" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-06</span> <span class="t" onclick="H(this)">22:17:54</span>                 mikerod </span><span>A lot of the time it can be solved by just pulling everything complex out of the </span><code>:not</code><span> and put it into a different rule where an “bridge”/intermediate fact is used to communicate the logic across the rules</span></div><div id="t1515277135000022" t="2018-01-06 22:18:55 mikerod I read through some of the outstanding issues on negation. However, I thought that I remember Will mentioning that he maybe had a few more broad concerns with the current way of dealing with them"><a href="#t1515277135000022" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-06</span> <span class="t" onclick="H(this)">22:18:55</span>                 mikerod </span><span>I read through some of the outstanding issues on negation. However, I thought that I remember Will mentioning that he maybe had a few more broad concerns with the current way of dealing with them</span></div><div id="t1515277156000065" t="2018-01-06 22:19:16 mikerod Basically, the currently process is to extract rules out from within the  :not  transparently"><a href="#t1515277156000065" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-06</span> <span class="t" onclick="H(this)">22:19:16</span>                 mikerod </span><span>Basically, the currently process is to extract rules out from within the </span><code>:not</code><span> transparently</span></div><div id="t1515277170000063" t="2018-01-06 22:19:30 mikerod In a way that is similar to what I proposed that you do in the above."><a href="#t1515277170000063" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-06</span> <span class="t" onclick="H(this)">22:19:30</span>                 mikerod </span><span>In a way that is similar to what I proposed that you do in the above.</span></div><div id="t1515277261000088" t="2018-01-06 22:21:01 mikerod I’m surprised that  https://github.com/cerner/clara-rules/issues/347  is still an issue though. I think the fix for it to me seems to be very similar to the work that was done in  https://github.com/cerner/clara-rules/pull/342 
If so, I think that one would be pretty easy to fix."><a href="#t1515277261000088" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-06</span> <span class="t" onclick="H(this)">22:21:01</span>                 mikerod </span><span>I’m surprised that </span><a href="https://github.com/cerner/clara-rules/issues/347" target="_blank">https://github.com/cerner/clara-rules/issues/347</a><span> is still an issue though. I think the fix for it to me seems to be very similar to the work that was done in </span><a href="https://github.com/cerner/clara-rules/pull/342" target="_blank">https://github.com/cerner/clara-rules/pull/342</a><span>
If so, I think that one would be pretty easy to fix.</span></div><div id="t1515371562000003" t="2018-01-08 00:32:42 cfleming In the docs, there’s an example rule:
 (defrule get-windspeeds-from-location
  [?temp &lt;- [Temperature (= ?location location)]]
  [?wind &lt;- (acc/all) :from [WindSpeed (= ?location location)]]
  =&gt;
  ;; do something
)
"><a href="#t1515371562000003" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-08</span> <span class="t" onclick="H(this)">00:32:42</span>                cfleming </span><span>In the docs, there’s an example rule:
</span><pre>(defrule get-windspeeds-from-location
  [?temp &lt;- [Temperature (= ?location location)]]
  [?wind &lt;- (acc/all) :from [WindSpeed (= ?location location)]]
  =&gt;
  ;; do something
)
</pre></div><div id="t1515371602000117" t="2018-01-08 00:33:22 cfleming Am I correct in thinking that the first condition should actually be  [?temp &lt;- Temperature (= ?location location)] , i.e. with no nested vectors?"><a href="#t1515371602000117" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-08</span> <span class="t" onclick="H(this)">00:33:22</span>                cfleming </span><span>Am I correct in thinking that the first condition should actually be </span><code>[?temp &lt;- Temperature (= ?location location)]</code><span>, i.e. with no nested vectors?</span></div><div id="t1515372293000111" t="2018-01-08 00:44:53 alex-dixon It can be either insofar as I know"><a href="#t1515372293000111" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-08</span> <span class="t" onclick="H(this)">00:44:53</span>              alex-dixon </span><span>It can be either insofar as I know</span></div><div id="t1515372398000084" t="2018-01-08 00:46:38 alex-dixon @cfleming I have some changes that I’m not totally happy with that try to accommodate that"><a href="#t1515372398000084" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-08</span> <span class="t" onclick="H(this)">00:46:38</span>              alex-dixon </span><span>@cfleming I have some changes that I’m not totally happy with that try to accommodate that</span></div><div id="t1515373905000070" t="2018-01-08 01:11:45 alex-dixon Oops. Looks like that would entail an “extraneous vcector error”"><a href="#t1515373905000070" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-08</span> <span class="t" onclick="H(this)">01:11:45</span>              alex-dixon </span><span>Oops. Looks like that would entail an “extraneous vcector error”</span></div><div id="t1515373907000155" t="2018-01-08 01:11:47 mikerod @alex-dixon @cfleming I think the first condition of that rule is incorrect"><a href="#t1515373907000155" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-08</span> <span class="t" onclick="H(this)">01:11:47</span>                 mikerod </span><span>@alex-dixon @cfleming I think the first condition of that rule is incorrect</span></div><div id="t1515373955000003" t="2018-01-08 01:12:35 mikerod There shouldn’t be a vector around Temperature in the non-accumulator case. What @cfleming said is right on that one. "><a href="#t1515373955000003" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-08</span> <span class="t" onclick="H(this)">01:12:35</span>                 mikerod </span><span>There shouldn’t be a vector around Temperature in the non-accumulator case. What @cfleming said is right on that one. </span></div><div id="t1515373970000072" t="2018-01-08 01:12:50 mikerod If Clara accepts it. I think it would be with the wrong semantics. "><a href="#t1515373970000072" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-08</span> <span class="t" onclick="H(this)">01:12:50</span>                 mikerod </span><span>If Clara accepts it. I think it would be with the wrong semantics. </span></div><div id="t1515373974000045" t="2018-01-08 01:12:54 cfleming Great, thanks Mike"><a href="#t1515373974000045" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-08</span> <span class="t" onclick="H(this)">01:12:54</span>                cfleming </span><span>Great, thanks Mike</span></div><div id="t1515373980000065" t="2018-01-08 01:13:00 alex-dixon [?order &lt;- [WorkOrder (= ?clientid clientid)
              (= scale :big)
              (&lt; (days-between requestdate duedate) 14)]]
=&gt;
CompilerException clojure.lang.ExceptionInfo: Type [WorkOrder (= ?clientid clientid) (= scale :big) (&lt; (days-between requestdate duedate) 14)] is a vector and appears to contain expressions. Is there an extraneous set of brackets in the condition? 
"><a href="#t1515373980000065" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-08</span> <span class="t" onclick="H(this)">01:13:00</span>              alex-dixon </span><pre>[?order &lt;- [WorkOrder (= ?clientid clientid)
              (= scale :big)
              (&lt; (days-between requestdate duedate) 14)]]
=&gt;
CompilerException clojure.lang.ExceptionInfo: Type [WorkOrder (= ?clientid clientid) (= scale :big) (&lt; (days-between requestdate duedate) 14)] is a vector and appears to contain expressions. Is there an extraneous set of brackets in the condition? 
</pre></div><div id="t1515374015000030" t="2018-01-08 01:13:35 mikerod It’d consider the whole thing to be the “fact type”. Which is related to the issue of ambiguity of syntax when you allow any arbitrary structure for a fact type. We discussed this on some issue recently"><a href="#t1515374015000030" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-08</span> <span class="t" onclick="H(this)">01:13:35</span>                 mikerod </span><span>It’d consider the whole thing to be the “fact type”. Which is related to the issue of ambiguity of syntax when you allow any arbitrary structure for a fact type. We discussed this on some issue recently</span></div><div id="t1515374023000127" t="2018-01-08 01:13:43 cfleming As the unofficial ranter about macro error messages, that’s a very nice message indeed."><a href="#t1515374023000127" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-08</span> <span class="t" onclick="H(this)">01:13:43</span>                cfleming </span><span>As the unofficial ranter about macro error messages, that’s a very nice message indeed.</span></div><div id="t1515374055000076" t="2018-01-08 01:14:15 mikerod Oh nice. Yeah I guess that case was special cased. Due to it being fairly easy to mistakenly do"><a href="#t1515374055000076" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-08</span> <span class="t" onclick="H(this)">01:14:15</span>                 mikerod </span><span>Oh nice. Yeah I guess that case was special cased. Due to it being fairly easy to mistakenly do</span></div><div id="t1515426702000153" t="2018-01-08 15:51:42 wparker @mikerod I haven’t gotten around to doing a comprehensive writeup, but basically I was looking at how to address  https://github.com/cerner/clara-rules/issues/343  and ran into what I think are some issues with to-dnf.  Basically since the :or operation is actually more of a union in the set theory sense, I think the to-dnf transforms can end up messing with cardinality.  For example, [:not [:and A B]] is equivalent to [:or [:not A] [:not B]] in a boolean sense, but the second can match twice and the first can’t in the context of Clara."><a href="#t1515426702000153" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-08</span> <span class="t" onclick="H(this)">15:51:42</span>                 wparker </span><span>@mikerod I haven’t gotten around to doing a comprehensive writeup, but basically I was looking at how to address </span><a href="https://github.com/cerner/clara-rules/issues/343" target="_blank">https://github.com/cerner/clara-rules/issues/343</a><span> and ran into what I think are some issues with to-dnf.  Basically since the :or operation is actually more of a union in the set theory sense, I think the to-dnf transforms can end up messing with cardinality.  For example, [:not [:and A B]] is equivalent to [:or [:not A] [:not B]] in a boolean sense, but the second can match twice and the first can’t in the context of Clara.</span></div><div id="t1515427977000174" t="2018-01-08 16:12:57 mikerod @wparker thanks. I remember the topic better now."><a href="#t1515427977000174" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-08</span> <span class="t" onclick="H(this)">16:12:57</span>                 mikerod </span><span>@wparker thanks. I remember the topic better now.</span></div><div id="t1515462534000204" t="2018-01-09 01:48:54 cfleming In the example query:
 (defquery get-promotions
  &quot;Query to find promotions for the purchase.&quot;
  [:?type]
  [?promotion &lt;- Promotion (= ?type type)])
"><a href="#t1515462534000204" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-09</span> <span class="t" onclick="H(this)">01:48:54</span>                cfleming </span><span>In the example query:
</span><pre>(defquery get-promotions
  &quot;Query to find promotions for the purchase.&quot;
  [:?type]
  [?promotion &lt;- Promotion (= ?type type)])
</pre></div><div id="t1515462578000048" t="2018-01-09 01:49:38 cfleming Does the parameter  :?type  create a unification variable? i.e. are the param and the local variable  ?type  then the same thing?"><a href="#t1515462578000048" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-09</span> <span class="t" onclick="H(this)">01:49:38</span>                cfleming </span><span>Does the parameter </span><code>:?type</code><span> create a unification variable? i.e. are the param and the local variable </span><code>?type</code><span> then the same thing?</span></div><div id="t1515462590000321" t="2018-01-09 01:49:50 cfleming I’m not sure I’m explaining that correctly."><a href="#t1515462590000321" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-09</span> <span class="t" onclick="H(this)">01:49:50</span>                cfleming </span><span>I’m not sure I’m explaining that correctly.</span></div><div id="t1515467912000076" t="2018-01-09 03:18:32 mikerod @cfleming the keyword arg allows the caller to bind a value to the variable. The same variable name as a symbol then should appear somewhere in the query conditions. "><a href="#t1515467912000076" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-09</span> <span class="t" onclick="H(this)">03:18:32</span>                 mikerod </span><span>@cfleming the keyword arg allows the caller to bind a value to the variable. The same variable name as a symbol then should appear somewhere in the query conditions. </span></div><div id="t1515467921000091" t="2018-01-09 03:18:41 mikerod So I think that is what you were saying. "><a href="#t1515467921000091" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-09</span> <span class="t" onclick="H(this)">03:18:41</span>                 mikerod </span><span>So I think that is what you were saying. </span></div><div id="t1515491732000125" t="2018-01-09 09:55:32 cfleming @mikerod Thanks, that’s what I meant, yes."><a href="#t1515491732000125" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-09</span> <span class="t" onclick="H(this)">09:55:32</span>                cfleming </span><span>@mikerod Thanks, that’s what I meant, yes.</span></div><div id="t1515509318000748" t="2018-01-09 14:48:38 wparker Put differently: looking at the example in  http://www.clara-rules.org/docs/queries/   if you removed the :?type from the get-promotions query definition you wouldn’t have “:?type :lunch” in the arguments in this call: (query session get-promotions :?type :lunch) @cfleming"><a href="#t1515509318000748" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-09</span> <span class="t" onclick="H(this)">14:48:38</span>                 wparker </span><span>Put differently: looking at the example in </span><a href="http://www.clara-rules.org/docs/queries/" target="_blank">http://www.clara-rules.org/docs/queries/</a><span>  if you removed the :?type from the get-promotions query definition you wouldn’t have “:?type :lunch” in the arguments in this call: (query session get-promotions :?type :lunch) @cfleming</span></div><div id="t1515526273000002" t="2018-01-09 19:31:13 wparker Clara-rules 0.17.0 is released and on Clojars.  This release is most significant for ClojureScript users, both because of a ClojureScript-specific bugfix and some enhancements with more impact to the ClojureScript side, but there are some enhancements for Clojure as well.  See the changelog for details.  Thanks to @dave.dixon and @alex-dixon for their contributions to the release."><a href="#t1515526273000002" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-09</span> <span class="t" onclick="H(this)">19:31:13</span>                 wparker </span><span>Clara-rules 0.17.0 is released and on Clojars.  This release is most significant for ClojureScript users, both because of a ClojureScript-specific bugfix and some enhancements with more impact to the ClojureScript side, but there are some enhancements for Clojure as well.  See the changelog for details.  Thanks to @dave.dixon and @alex-dixon for their contributions to the release.</span></div><div id="t1515535751000190" t="2018-01-09 22:09:11 zylox are the dixon&apos;s related"><a href="#t1515535751000190" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-09</span> <span class="t" onclick="H(this)">22:09:11</span>                   zylox </span><span>are the dixon&apos;s related</span></div><div id="t1515535756000112" t="2018-01-09 22:09:16 zylox a question for the ages"><a href="#t1515535756000112" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-09</span> <span class="t" onclick="H(this)">22:09:16</span>                   zylox </span><span>a question for the ages</span></div><div id="t1515594374000226" t="2018-01-10 14:26:14 sparkofreason Not to my knowledge. But we do seem to think alike  😉"><a href="#t1515594374000226" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-10</span> <span class="t" onclick="H(this)">14:26:14</span>           sparkofreason </span><span>Not to my knowledge. But we do seem to think alike </span><b>😉</b></div><div id="t1515715683000086" t="2018-01-12 00:08:03 alex-dixon High praise"><a href="#t1515715683000086" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-12</span> <span class="t" onclick="H(this)">00:08:03</span>                   alex-dixon </span><span>High praise</span></div><div id="t1515594554000063" t="2018-01-10 14:29:14 zylox darn"><a href="#t1515594554000063" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-10</span> <span class="t" onclick="H(this)">14:29:14</span>                   zylox </span><span>darn</span></div><div id="t1515715874000159" t="2018-01-12 00:11:14 alex-dixon Do any changes proposed in  https://github.com/cerner/clara-rules/issues/373  affect short circuiting the evaluation of all LHS conditions? My understanding is that if the first condition doesn’t match the remaining ones are still processed"><a href="#t1515715874000159" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-12</span> <span class="t" onclick="H(this)">00:11:14</span>              alex-dixon </span><span>Do any changes proposed in </span><a href="https://github.com/cerner/clara-rules/issues/373" target="_blank">https://github.com/cerner/clara-rules/issues/373</a><span> affect short circuiting the evaluation of all LHS conditions? My understanding is that if the first condition doesn’t match the remaining ones are still processed</span></div><div id="t1515763656000145" t="2018-01-12 13:27:36 mikerod @alex-dixon right now the alpha network is “eagerly” evaluated"><a href="#t1515763656000145" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-12</span> <span class="t" onclick="H(this)">13:27:36</span>                 mikerod </span><span>@alex-dixon right now the alpha network is “eagerly” evaluated</span></div><div id="t1515763667000233" t="2018-01-12 13:27:47 mikerod So constraints within conditions that are independent of a join with another condition"><a href="#t1515763667000233" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-12</span> <span class="t" onclick="H(this)">13:27:47</span>                 mikerod </span><span>So constraints within conditions that are independent of a join with another condition</span></div><div id="t1515763740000149" t="2018-01-12 13:29:00 mikerod Clara has had this sort of “re-ordering” property since way back (maybe always) now. The discusses we have had before about trying to be “lazier” in evaluation by not evaluating any part of a condition if the prior conditions were satisfied, would be affected by this re-ordering logic"><a href="#t1515763740000149" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-12</span> <span class="t" onclick="H(this)">13:29:00</span>                 mikerod </span><span>Clara has had this sort of “re-ordering” property since way back (maybe always) now. The discusses we have had before about trying to be “lazier” in evaluation by not evaluating any part of a condition if the prior conditions were satisfied, would be affected by this re-ordering logic</span></div><div id="t1515777766000119" t="2018-01-12 17:22:46 alex-dixon Thanks. Printed out ch 2 of the paper you recommended. It’s awesome. Working my way through. Will try to avoid asking you to explain rete to me in the interim:blush:

That said:
If Clara’s reordering doesn’t honor the order of conditions in the lhs as they are written (even if just for alphas) would any of the changes in @wparker ‘s proposal make it so the developer’s ordering is honored when evaluating a lhs? My understanding is that’s part of the proposal, but only for Boolean conditions. If that’s right and it’s developed, could  the behavior be extended to apply to all conditions using much of the same code? 

Outside Boolean conditions, would this be a massive breaking change? I think so just want to confirm. 

I’m asking because I think there would be an appreciable performance difference between the two for CEP. I think Drools made changes along these lines for that reason "><a href="#t1515777766000119" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-12</span> <span class="t" onclick="H(this)">17:22:46</span>              alex-dixon </span><span>Thanks. Printed out ch 2 of the paper you recommended. It’s awesome. Working my way through. Will try to avoid asking you to explain rete to me in the interim:blush:

That said:
If Clara’s reordering doesn’t honor the order of conditions in the lhs as they are written (even if just for alphas) would any of the changes in @wparker ‘s proposal make it so the developer’s ordering is honored when evaluating a lhs? My understanding is that’s part of the proposal, but only for Boolean conditions. If that’s right and it’s developed, could  the behavior be extended to apply to all conditions using much of the same code? 

Outside Boolean conditions, would this be a massive breaking change? I think so just want to confirm. 

I’m asking because I think there would be an appreciable performance difference between the two for CEP. I think Drools made changes along these lines for that reason </span></div><div id="t1515780545000415" t="2018-01-12 18:09:05 mikerod @alex-dixon I think the re-ordering (or not) is still being discussed in the 373 linked above.
There already is re-ordering happening. It sounds like there may be some lean towards not needing to do that anymore. You should check out some of the comments in that issue now.
 I did mention the lazier evaluation thing there, but there are still concerns I’d have with that overall."><a href="#t1515780545000415" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-12</span> <span class="t" onclick="H(this)">18:09:05</span>                 mikerod </span><span>@alex-dixon I think the re-ordering (or not) is still being discussed in the 373 linked above.
There already is re-ordering happening. It sounds like there may be some lean towards not needing to do that anymore. You should check out some of the comments in that issue now.
 I did mention the lazier evaluation thing there, but there are still concerns I’d have with that overall.</span></div><div id="t1515780703000505" t="2018-01-12 18:11:43 mikerod And yes, that paper is good. I first heard of it from Ryan putting a reference to it in the Clara GitHub repo @  https://github.com/cerner/clara-rules/wiki/Introduction#the-rules-engine"><a href="#t1515780703000505" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-12</span> <span class="t" onclick="H(this)">18:11:43</span>                 mikerod </span><span>And yes, that paper is good. I first heard of it from Ryan putting a reference to it in the Clara GitHub repo @ </span><a href="https://github.com/cerner/clara-rules/wiki/Introduction#the-rules-engine" target="_blank">https://github.com/cerner/clara-rules/wiki/Introduction#the-rules-engine</a></div><div id="t1515782074000313" t="2018-01-12 18:34:34 sparkofreason If I were to call  insert!  from within an async callback for an effect triggered on the rhs of a rule, I assume that the context would be goofy and result in an exception or other undesirable behavior. Is there a best practice for capturing that context? The use case would be leveraging truth maintenance for facts inserted async, e.g. results from an http request. "><a href="#t1515782074000313" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-12</span> <span class="t" onclick="H(this)">18:34:34</span>           sparkofreason </span><span>If I were to call </span><code>insert!</code><span> from within an async callback for an effect triggered on the rhs of a rule, I assume that the context would be goofy and result in an exception or other undesirable behavior. Is there a best practice for capturing that context? The use case would be leveraging truth maintenance for facts inserted async, e.g. results from an http request. </span></div><div id="t1515785717000155" t="2018-01-12 19:35:17 mikerod @dave.dixon I’d expect the async response to be do an external  insert  when it is done"><a href="#t1515785717000155" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-12</span> <span class="t" onclick="H(this)">19:35:17</span>                 mikerod </span><span>@dave.dixon I’d expect the async response to be do an external </span><code>insert</code><span> when it is done</span></div><div id="t1515785733000096" t="2018-01-12 19:35:33 mikerod You’d “capture context” just via the variable bindings you passed to the async call"><a href="#t1515785733000096" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-12</span> <span class="t" onclick="H(this)">19:35:33</span>                 mikerod </span><span>You’d “capture context” just via the variable bindings you passed to the async call</span></div><div id="t1515785764000220" t="2018-01-12 19:36:04 mikerod Oh, woops, missed part of your purpose"><a href="#t1515785764000220" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-12</span> <span class="t" onclick="H(this)">19:36:04</span>                 mikerod </span><span>Oh, woops, missed part of your purpose</span></div><div id="t1515785804000296" t="2018-01-12 19:36:44 mikerod I think you’d have to model the fact that you caused the effect externally as a fact for TMS to help you. Example:"><a href="#t1515785804000296" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-12</span> <span class="t" onclick="H(this)">19:36:44</span>                 mikerod </span><span>I think you’d have to model the fact that you caused the effect externally as a fact for TMS to help you. Example:</span></div><div id="t1515786224000564" t="2018-01-12 19:43:44 mikerod I don’t really like the  maybe-undo-async-thing  part of that. It doesn’t know which  DownstreamResult  may now be invalid and offloads it all to the external fn  ext-maybe-undo-async-thing"><a href="#t1515786224000564" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-12</span> <span class="t" onclick="H(this)">19:43:44</span>                 mikerod </span><span>I don’t really like the </span><code>maybe-undo-async-thing</code><span> part of that. It doesn’t know which </span><code>DownstreamResult</code><span> may now be invalid and offloads it all to the external fn </span><code>ext-maybe-undo-async-thing</code></div><div id="t1515786236000310" t="2018-01-12 19:43:56 mikerod I think there may be a better way around that"><a href="#t1515786236000310" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-12</span> <span class="t" onclick="H(this)">19:43:56</span>                 mikerod </span><span>I think there may be a better way around that</span></div><div id="t1515786421000115" t="2018-01-12 19:47:01 mikerod I made it so  original-rule  is always satisfied via the accumulator"><a href="#t1515786421000115" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-12</span> <span class="t" onclick="H(this)">19:47:01</span>                 mikerod </span><span>I made it so </span><code>original-rule</code><span> is always satisfied via the accumulator</span></div><div id="t1515786435000581" t="2018-01-12 19:47:15 mikerod So you can carry that information forward on which path you should take"><a href="#t1515786435000581" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-12</span> <span class="t" onclick="H(this)">19:47:15</span>                 mikerod </span><span>So you can carry that information forward on which path you should take</span></div><div id="t1515786437000492" t="2018-01-12 19:47:17 sparkofreason Yes, that&apos;s how I&apos;m doing it now. Like you say, it&apos;s fine when all the relationships are clean, but otherwise gets messy. "><a href="#t1515786437000492" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-12</span> <span class="t" onclick="H(this)">19:47:17</span>           sparkofreason </span><span>Yes, that&apos;s how I&apos;m doing it now. Like you say, it&apos;s fine when all the relationships are clean, but otherwise gets messy. </span></div><div id="t1515786455000682" t="2018-01-12 19:47:35 sparkofreason Referring to the first example. "><a href="#t1515786455000682" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-12</span> <span class="t" onclick="H(this)">19:47:35</span>           sparkofreason </span><span>Referring to the first example. </span></div><div id="t1515786487000644" t="2018-01-12 19:48:07 mikerod So in my 2nd example, you can actually filter  DownstreamResult  if you track which  bs  they originally were associated with via that information being conveyed externally and back on the inserted new facts"><a href="#t1515786487000644" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-12</span> <span class="t" onclick="H(this)">19:48:07</span>                 mikerod </span><span>So in my 2nd example, you can actually filter </span><code>DownstreamResult</code><span> if you track which </span><code>bs</code><span> they originally were associated with via that information being conveyed externally and back on the inserted new facts</span></div><div id="t1515786512000430" t="2018-01-12 19:48:32 mikerod It isn’t perfect, you still have to make an association on the facts, however, I think it could be practical"><a href="#t1515786512000430" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-12</span> <span class="t" onclick="H(this)">19:48:32</span>                 mikerod </span><span>It isn’t perfect, you still have to make an association on the facts, however, I think it could be practical</span></div><div id="t1515786536000175" t="2018-01-12 19:48:56 mikerod This is regarding one part of the overall problem"><a href="#t1515786536000175" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-12</span> <span class="t" onclick="H(this)">19:48:56</span>                 mikerod </span><span>This is regarding one part of the overall problem</span></div><div id="t1515786560000320" t="2018-01-12 19:49:20 mikerod You also have the problem of when the async request is finished, ensuring it inserts to the session that it came from in its final state"><a href="#t1515786560000320" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-12</span> <span class="t" onclick="H(this)">19:49:20</span>                 mikerod </span><span>You also have the problem of when the async request is finished, ensuring it inserts to the session that it came from in its final state</span></div><div id="t1515786583000003" t="2018-01-12 19:49:43 mikerod so after the  fire-rules  that triggered the async request has completed"><a href="#t1515786583000003" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-12</span> <span class="t" onclick="H(this)">19:49:43</span>                 mikerod </span><span>so after the </span><code>fire-rules</code><span> that triggered the async request has completed</span></div><div id="t1515786591000774" t="2018-01-12 19:49:51 mikerod In a single-thread, I think that is not an issue"><a href="#t1515786591000774" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-12</span> <span class="t" onclick="H(this)">19:49:51</span>                 mikerod </span><span>In a single-thread, I think that is not an issue</span></div><div id="t1515786605000507" t="2018-01-12 19:50:05 mikerod And you may be doing this single-threadedly"><a href="#t1515786605000507" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-12</span> <span class="t" onclick="H(this)">19:50:05</span>                 mikerod </span><span>And you may be doing this single-threadedly</span></div><div id="t1515786644000736" t="2018-01-12 19:50:44 mikerod The async call though would need to have a way to access the session when it is finished"><a href="#t1515786644000736" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-12</span> <span class="t" onclick="H(this)">19:50:44</span>                 mikerod </span><span>The async call though would need to have a way to access the session when it is finished</span></div><div id="t1515786863000315" t="2018-01-12 19:54:23 sparkofreason I have a way of handling session. But what I really want is to be able to do the final insert such that the fact is a logical consequence of the rule lhs. Not sure if that actually is meaningful given how rete works. "><a href="#t1515786863000315" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-12</span> <span class="t" onclick="H(this)">19:54:23</span>           sparkofreason </span><span>I have a way of handling session. But what I really want is to be able to do the final insert such that the fact is a logical consequence of the rule lhs. Not sure if that actually is meaningful given how rete works. </span></div><div id="t1515870131000097" t="2018-01-13 19:02:11 alex-dixon I’m not sure whether using Clara’s truth maintenance directly allows that, but you should be able to simulate it  using unconditional inserts/retracts, other rules, and facts that represent the async event cycle.

A poor attempt:

 (defrule make-request-when
  [?task &lt;- AsyncTask]
  =&gt;
  (retract! ?task)
  (insert-unconditional (-&gt;AsyncRequest ?task))
 (async-side-effect! my-session ?task)

(defn async-side-effect! [session fact] (request! fact (fn [err res] 
(if err (insert session (-&gt;AsyncTaskError err fact)
(insert session (-&gt;AsyncTaskSuccess res fact))

(defrule on-async-task-success
  [?success &lt;- AsyncTaskSuccess ?res ?fact]
  [?request &lt;- AsyncTaskRequest ?fact]
=&gt;
(retract! ?success ?request)
(insert-unconditional! (-&gt;SomeFactRepresentingResponseFromThisKindOfRequest ?res)
 
  ;; similarly with error
"><a href="#t1515870131000097" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-13</span> <span class="t" onclick="H(this)">19:02:11</span>                   alex-dixon </span><span>I’m not sure whether using Clara’s truth maintenance directly allows that, but you should be able to simulate it  using unconditional inserts/retracts, other rules, and facts that represent the async event cycle.

A poor attempt:

</span><pre>(defrule make-request-when
  [?task &lt;- AsyncTask]
  =&gt;
  (retract! ?task)
  (insert-unconditional (-&gt;AsyncRequest ?task))
 (async-side-effect! my-session ?task)

(defn async-side-effect! [session fact] (request! fact (fn [err res] 
(if err (insert session (-&gt;AsyncTaskError err fact)
(insert session (-&gt;AsyncTaskSuccess res fact))

(defrule on-async-task-success
  [?success &lt;- AsyncTaskSuccess ?res ?fact]
  [?request &lt;- AsyncTaskRequest ?fact]
=&gt;
(retract! ?success ?request)
(insert-unconditional! (-&gt;SomeFactRepresentingResponseFromThisKindOfRequest ?res)
 
  ;; similarly with error
</pre></div><div id="t1515871603000037" t="2018-01-13 19:26:43 sparkofreason I have something similar, and it works nicely. But it would be nice if I could avoid the manual truth maintenance. "><a href="#t1515871603000037" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-13</span> <span class="t" onclick="H(this)">19:26:43</span>                sparkofreason </span><span>I have something similar, and it works nicely. But it would be nice if I could avoid the manual truth maintenance. </span></div><div id="t1515791783000250" t="2018-01-12 21:16:23 mikerod I don’t think anything built-in would allow you to reliable have an actual “handle” on the mutable session state during fire rules for an  insert!  to go off later yet, still correctly be tracked with TMS"><a href="#t1515791783000250" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-12</span> <span class="t" onclick="H(this)">21:16:23</span>                 mikerod </span><span>I don’t think anything built-in would allow you to reliable have an actual “handle” on the mutable session state during fire rules for an </span><code>insert!</code><span> to go off later yet, still correctly be tracked with TMS</span></div><div id="t1515791795000404" t="2018-01-12 21:16:35 mikerod there’d be quite a bit of complications for the engine to try to support that even I think"><a href="#t1515791795000404" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-12</span> <span class="t" onclick="H(this)">21:16:35</span>                 mikerod </span><span>there’d be quite a bit of complications for the engine to try to support that even I think</span></div><div id="t1515791810000440" t="2018-01-12 21:16:50 mikerod Not to mention the fire-rules wouldn’t be able to be “done” until all async actions were done"><a href="#t1515791810000440" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-12</span> <span class="t" onclick="H(this)">21:16:50</span>                 mikerod </span><span>Not to mention the fire-rules wouldn’t be able to be “done” until all async actions were done</span></div><div id="t1515791833000115" t="2018-01-12 21:17:13 mikerod and it’d have concurrency issues in a multi-threaded environment"><a href="#t1515791833000115" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-12</span> <span class="t" onclick="H(this)">21:17:13</span>                 mikerod </span><span>and it’d have concurrency issues in a multi-threaded environment</span></div><div id="t1515794385000366" t="2018-01-12 21:59:45 sparkofreason Agreed. Maybe the right(ish) answer is to model facts as something like a promise. The semantics and behavior would have to be constrained, so it isn&apos;t just mutating facts behind your back without properly updating the session. But the basic concept seems like a way forward, because conditionally inserting a promise as a fact means it and whatever value it returns will get retracted when TMS requires it."><a href="#t1515794385000366" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-12</span> <span class="t" onclick="H(this)">21:59:45</span>           sparkofreason </span><span>Agreed. Maybe the right(ish) answer is to model facts as something like a promise. The semantics and behavior would have to be constrained, so it isn&apos;t just mutating facts behind your back without properly updating the session. But the basic concept seems like a way forward, because conditionally inserting a promise as a fact means it and whatever value it returns will get retracted when TMS requires it.</span></div><div id="t1515794560000185" t="2018-01-12 22:02:40 sparkofreason The thing I&apos;m trying to avoid is having to manually perform truth management for facts inserted as the result of async effects. In the big picture, those facts are logical consequents of whatever condition triggered the async effect."><a href="#t1515794560000185" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-12</span> <span class="t" onclick="H(this)">22:02:40</span>           sparkofreason </span><span>The thing I&apos;m trying to avoid is having to manually perform truth management for facts inserted as the result of async effects. In the big picture, those facts are logical consequents of whatever condition triggered the async effect.</span></div><div id="t1515797199000136" t="2018-01-12 22:46:39 mikerod Yeah,I think the case is interesting"><a href="#t1515797199000136" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-12</span> <span class="t" onclick="H(this)">22:46:39</span>                 mikerod </span><span>Yeah,I think the case is interesting</span></div><div id="t1515859349000081" t="2018-01-13 16:02:29 sparkofreason I took a shot at forcing conditional inserts in the async handler, if only as an  exercise to understand the code better. I got as far as actually getting the insert to occur, basically grabbing the  *rule-context*  and making it available to the handler, and adding an overload of  fire-rules  that would accept that as an extra parameter. The rule context was modified so it only contained non-empty  :batched-logical-insertions  with the facts being inserted as a logical consequence of the rule triggering the async effect.  clara.rules.engine/*fire-rules*  then also had an extra arity to deal with externally supplied rule context. At this point, I guessed that this approach probably wouldn&apos;t work in general, because it looks to me like the  :token  in the rule context contains the fact bindings which are the logical antecedent. If any of those facts had been retracted in the session between the request and response of the async effect, I assume that  clara.rules.memory/add-insertions!  would be unhappy, as the token would be inconsistent with the state of working memory. Is that correct?"><a href="#t1515859349000081" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-13</span> <span class="t" onclick="H(this)">16:02:29</span>           sparkofreason </span><span>I took a shot at forcing conditional inserts in the async handler, if only as an  exercise to understand the code better. I got as far as actually getting the insert to occur, basically grabbing the </span><code>*rule-context*</code><span> and making it available to the handler, and adding an overload of </span><code>fire-rules</code><span> that would accept that as an extra parameter. The rule context was modified so it only contained non-empty </span><code>:batched-logical-insertions</code><span> with the facts being inserted as a logical consequence of the rule triggering the async effect. </span><code>clara.rules.engine/*fire-rules*</code><span> then also had an extra arity to deal with externally supplied rule context. At this point, I guessed that this approach probably wouldn&apos;t work in general, because it looks to me like the </span><code>:token</code><span> in the rule context contains the fact bindings which are the logical antecedent. If any of those facts had been retracted in the session between the request and response of the async effect, I assume that </span><code>clara.rules.memory/add-insertions!</code><span> would be unhappy, as the token would be inconsistent with the state of working memory. Is that correct?</span></div><div id="t1515862358000099" t="2018-01-13 16:52:38 mikerod Yeah. I don’t think that’d be very tractable. "><a href="#t1515862358000099" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-13</span> <span class="t" onclick="H(this)">16:52:38</span>                 mikerod </span><span>Yeah. I don’t think that’d be very tractable. </span></div><div id="t1515862377000053" t="2018-01-13 16:52:57 mikerod Also working memory is in a mutable state. I think things could easily become inconsistent. "><a href="#t1515862377000053" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-13</span> <span class="t" onclick="H(this)">16:52:57</span>                 mikerod </span><span>Also working memory is in a mutable state. I think things could easily become inconsistent. </span></div><div id="t1515867205000050" t="2018-01-13 18:13:25 sparkofreason Makes sense."><a href="#t1515867205000050" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-13</span> <span class="t" onclick="H(this)">18:13:25</span>           sparkofreason </span><span>Makes sense.</span></div><div id="t1515867298000023" t="2018-01-13 18:14:58 sparkofreason Is there a way to force a rule to fire, even if the fact values don&apos;t change? I&apos;m playing around with using an atom to solve this case, but of course the atom reference doesn&apos;t change when the atom is reset, only the wrapped value changes, so the rule won&apos;t fire after the first time."><a href="#t1515867298000023" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-13</span> <span class="t" onclick="H(this)">18:14:58</span>           sparkofreason </span><span>Is there a way to force a rule to fire, even if the fact values don&apos;t change? I&apos;m playing around with using an atom to solve this case, but of course the atom reference doesn&apos;t change when the atom is reset, only the wrapped value changes, so the rule won&apos;t fire after the first time.</span></div><div id="t1515870366000040" t="2018-01-13 19:06:06 alex-dixon @dave.dixon 
&gt; Is there a way to force a rule to fire, even if the fact values don’t change?
No offense intended at all but that seems off to a bad start even to me….  😄  What are you trying to do?"><a href="#t1515870366000040" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-13</span> <span class="t" onclick="H(this)">19:06:06</span>              alex-dixon </span><span>@dave.dixon 
&gt; Is there a way to force a rule to fire, even if the fact values don’t change?
No offense intended at all but that seems off to a bad start even to me…. </span><b>😄</b><span> What are you trying to do?</span></div><div id="t1515871495000066" t="2018-01-13 19:24:55 sparkofreason Yeah, it sounds bad. I&apos;m trying to get the rhs to evaluate when a fact refers to an atom and the atom value changes. "><a href="#t1515871495000066" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-13</span> <span class="t" onclick="H(this)">19:24:55</span>                sparkofreason </span><span>Yeah, it sounds bad. I&apos;m trying to get the rhs to evaluate when a fact refers to an atom and the atom value changes. </span></div><div id="t1515871633000161" t="2018-01-13 19:27:13 alex-dixon Interesting. Why an atom?"><a href="#t1515871633000161" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-13</span> <span class="t" onclick="H(this)">19:27:13</span>                   alex-dixon </span><span>Interesting. Why an atom?</span></div><div id="t1515871787000006" t="2018-01-13 19:29:47 sparkofreason So I can put the response from an async request in it. "><a href="#t1515871787000006" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-13</span> <span class="t" onclick="H(this)">19:29:47</span>                sparkofreason </span><span>So I can put the response from an async request in it. </span></div><div id="t1515872037000112" t="2018-01-13 19:33:57 alex-dixon Hm ok. Have you tried calling deref on the atom in the condition "><a href="#t1515872037000112" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-13</span> <span class="t" onclick="H(this)">19:33:57</span>                   alex-dixon </span><span>Hm ok. Have you tried calling deref on the atom in the condition </span></div><div id="t1515872220000088" t="2018-01-13 19:37:00 sparkofreason Yes. Doesn&apos;t help. In fact, it doesn&apos;t work in general for making the bindings, which seems odd. "><a href="#t1515872220000088" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-13</span> <span class="t" onclick="H(this)">19:37:00</span>                sparkofreason </span><span>Yes. Doesn&apos;t help. In fact, it doesn&apos;t work in general for making the bindings, which seems odd. </span></div><div id="t1515872396000034" t="2018-01-13 19:39:56 alex-dixon Hm. Potentially wild things I’d try: 1. (deref a) instead of the macro if you’re not already, 2. :test expression"><a href="#t1515872396000034" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-13</span> <span class="t" onclick="H(this)">19:39:56</span>                   alex-dixon </span><span>Hm. Potentially wild things I’d try: 1. (deref a) instead of the macro if you’re not already, 2. :test expression</span></div><div id="t1515872495000070" t="2018-01-13 19:41:35 sparkofreason Have tried both. Deref doesn&apos;t help, but the reader macro works in a test and rhs. "><a href="#t1515872495000070" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-13</span> <span class="t" onclick="H(this)">19:41:35</span>                sparkofreason </span><span>Have tried both. Deref doesn&apos;t help, but the reader macro works in a test and rhs. </span></div><div id="t1515873201000060" t="2018-01-13 19:53:21 alex-dixon Well I’m confused. @mikerod might be able to shine light on it"><a href="#t1515873201000060" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-13</span> <span class="t" onclick="H(this)">19:53:21</span>                   alex-dixon </span><span>Well I’m confused. @mikerod might be able to shine light on it</span></div><div id="t1515875609000035" t="2018-01-13 20:33:29 mikerod I am not sure I understand still. Been traveling today though so somewhat on and off here "><a href="#t1515875609000035" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-13</span> <span class="t" onclick="H(this)">20:33:29</span>                      mikerod </span><span>I am not sure I understand still. Been traveling today though so somewhat on and off here </span></div><div id="t1515876066000154" t="2018-01-13 20:41:06 mikerod I think I’d have to see an example here. Hah"><a href="#t1515876066000154" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-13</span> <span class="t" onclick="H(this)">20:41:06</span>                      mikerod </span><span>I think I’d have to see an example here. Hah</span></div><div id="t1515878242000019" t="2018-01-13 21:17:22 sparkofreason I&apos;ll post it when I get home. "><a href="#t1515878242000019" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-13</span> <span class="t" onclick="H(this)">21:17:22</span>                sparkofreason </span><span>I&apos;ll post it when I get home. </span></div><div id="t1515871221000057" t="2018-01-13 19:20:21 dadair Does Clara support namespace aliases in Fact matching? The following throws an exception, but the long-form works:
 [encounter-actions/EncounterFindingChanged ..] ;; short -- throws ex
[justice.models.core.actions.encounter.EncounterFindingChanged ..] ;; long
"><a href="#t1515871221000057" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-13</span> <span class="t" onclick="H(this)">19:20:21</span>                  dadair </span><span>Does Clara support namespace aliases in Fact matching? The following throws an exception, but the long-form works:
</span><pre>[encounter-actions/EncounterFindingChanged ..] ;; short -- throws ex
[justice.models.core.actions.encounter.EncounterFindingChanged ..] ;; long
</pre></div><div id="t1515871699000075" t="2018-01-13 19:28:19 sparkofreason I hit a similar issue using a macro in a rule definition. "><a href="#t1515871699000075" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-13</span> <span class="t" onclick="H(this)">19:28:19</span>           sparkofreason </span><span>I hit a similar issue using a macro in a rule definition. </span></div><div id="t1515872518000062" t="2018-01-13 19:41:58 mikerod @dadair it should. If it doesn’t it probably needs to be looked at. "><a href="#t1515872518000062" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-13</span> <span class="t" onclick="H(this)">19:41:58</span>                 mikerod </span><span>@dadair it should. If it doesn’t it probably needs to be looked at. </span></div><div id="t1515872523000020" t="2018-01-13 19:42:03 mikerod As an issue I mean"><a href="#t1515872523000020" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-13</span> <span class="t" onclick="H(this)">19:42:03</span>                 mikerod </span><span>As an issue I mean</span></div><div id="t1515875501000061" t="2018-01-13 20:31:41 dadair @mikerod I&apos;ll file an issue, I replicated it with the intro to clara example just moving the defrecords into another ns"><a href="#t1515875501000061" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-13</span> <span class="t" onclick="H(this)">20:31:41</span>                  dadair </span><span>@mikerod I&apos;ll file an issue, I replicated it with the intro to clara example just moving the defrecords into another ns</span></div><div id="t1515875547000007" t="2018-01-13 20:32:27 mikerod @dadair if it’s cljs perhaps it relates to some recent issues already out there. I thought it was fixed though. "><a href="#t1515875547000007" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-13</span> <span class="t" onclick="H(this)">20:32:27</span>                 mikerod </span><span>@dadair if it’s cljs perhaps it relates to some recent issues already out there. I thought it was fixed though. </span></div><div id="t1515875554000136" t="2018-01-13 20:32:34 dadair nope just  .clj"><a href="#t1515875554000136" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-13</span> <span class="t" onclick="H(this)">20:32:34</span>                  dadair </span><span>nope just </span><code>.clj</code></div><div id="t1515875559000026" t="2018-01-13 20:32:39 dadair on  0.17.0"><a href="#t1515875559000026" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-13</span> <span class="t" onclick="H(this)">20:32:39</span>                  dadair </span><span>on </span><code>0.17.0</code></div><div id="t1515875567000068" t="2018-01-13 20:32:47 mikerod Hmm. I’m traveling today so can’t look. "><a href="#t1515875567000068" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-13</span> <span class="t" onclick="H(this)">20:32:47</span>                 mikerod </span><span>Hmm. I’m traveling today so can’t look. </span></div><div id="t1515875642000119" t="2018-01-13 20:34:02 mikerod It should definitely support aliasing. "><a href="#t1515875642000119" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-13</span> <span class="t" onclick="H(this)">20:34:02</span>                 mikerod </span><span>It should definitely support aliasing. </span></div><div id="t1515875684000016" t="2018-01-13 20:34:44 mikerod Unless you didn’t include the alias in the ns or something. Hah. If you could make like a small example where it isn’t working that’d be nice to see. "><a href="#t1515875684000016" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-13</span> <span class="t" onclick="H(this)">20:34:44</span>                 mikerod </span><span>Unless you didn’t include the alias in the ns or something. Hah. If you could make like a small example where it isn’t working that’d be nice to see. </span></div><div id="t1515875801000045" t="2018-01-13 20:36:41 dadair (ns abc.other)

(defrecord SupportRequest [client level])

(defrecord ClientRepresentative [name client])

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

(ns abc.core
  (:require [clara.rules :refer :all]
            [abc.other :as other]))

(defrule is-important
  &quot;Find important support requests.&quot;
  [abc.other.SupportRequest (= :high level)] ;; full path here works; change to other/SupportRequest and an exception is thrown
  =&gt;
  (println &quot;High support requested!&quot;))

(defrule notify-client-rep
  &quot;Find the client representative and request support.&quot;
  [abc.other.SupportRequest (= ?client client)]
  [abc.other.ClientRepresentative (= ?client client) (= ?name name)]
  =&gt;
  (println &quot;Notify&quot; ?name &quot;that&quot;
          ?client &quot;has a new support request!&quot;))

(-&gt; (mk-session &apos;abc.core)
    (insert (other/-&gt;ClientRepresentative &quot;Alice&quot; &quot;Acme&quot;)
            (other/-&gt;SupportRequest &quot;Acme&quot; :high))
    (fire-rules))
"><a href="#t1515875801000045" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-13</span> <span class="t" onclick="H(this)">20:36:41</span>                  dadair </span><pre>(ns abc.other)

(defrecord SupportRequest [client level])

(defrecord ClientRepresentative [name client])

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

(ns abc.core
  (:require [clara.rules :refer :all]
            [abc.other :as other]))

(defrule is-important
  &quot;Find important support requests.&quot;
  [abc.other.SupportRequest (= :high level)] ;; full path here works; change to other/SupportRequest and an exception is thrown
  =&gt;
  (println &quot;High support requested!&quot;))

(defrule notify-client-rep
  &quot;Find the client representative and request support.&quot;
  [abc.other.SupportRequest (= ?client client)]
  [abc.other.ClientRepresentative (= ?client client) (= ?name name)]
  =&gt;
  (println &quot;Notify&quot; ?name &quot;that&quot;
          ?client &quot;has a new support request!&quot;))

(-&gt; (mk-session &apos;abc.core)
    (insert (other/-&gt;ClientRepresentative &quot;Alice&quot; &quot;Acme&quot;)
            (other/-&gt;SupportRequest &quot;Acme&quot; :high))
    (fire-rules))
</pre></div><div id="t1515875849000051" t="2018-01-13 20:37:29 dadair the above example reproduces the problem"><a href="#t1515875849000051" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-13</span> <span class="t" onclick="H(this)">20:37:29</span>                  dadair </span><span>the above example reproduces the problem</span></div><div id="t1515875936000055" t="2018-01-13 20:38:56 mikerod Record types in clojure are referred to by their Java Class name"><a href="#t1515875936000055" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-13</span> <span class="t" onclick="H(this)">20:38:56</span>                 mikerod </span><span>Record types in clojure are referred to by their Java Class name</span></div><div id="t1515875942000044" t="2018-01-13 20:39:02 mikerod You have to use import for those. "><a href="#t1515875942000044" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-13</span> <span class="t" onclick="H(this)">20:39:02</span>                 mikerod </span><span>You have to use import for those. </span></div><div id="t1515875957000106" t="2018-01-13 20:39:17 dadair ah right"><a href="#t1515875957000106" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-13</span> <span class="t" onclick="H(this)">20:39:17</span>                  dadair </span><span>ah right</span></div><div id="t1515875962000128" t="2018-01-13 20:39:22 mikerod They don’t support ns aliasing. Their builder functions do but not the type class itsel"><a href="#t1515875962000128" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-13</span> <span class="t" onclick="H(this)">20:39:22</span>                 mikerod </span><span>They don’t support ns aliasing. Their builder functions do but not the type class itsel</span></div><div id="t1515875972000125" t="2018-01-13 20:39:32 mikerod Sort of a clj quirk that is unfortunate. "><a href="#t1515875972000125" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-13</span> <span class="t" onclick="H(this)">20:39:32</span>                 mikerod </span><span>Sort of a clj quirk that is unfortunate. </span></div><div id="t1515875992000054" t="2018-01-13 20:39:52 mikerod Clara is just using clj for the symbol resolution there though. "><a href="#t1515875992000054" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-13</span> <span class="t" onclick="H(this)">20:39:52</span>                 mikerod </span><span>Clara is just using clj for the symbol resolution there though. </span></div><div id="t1515876153000071" t="2018-01-13 20:42:33 dadair I always forget about imports, thanks!"><a href="#t1515876153000071" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-13</span> <span class="t" onclick="H(this)">20:42:33</span>                  dadair </span><span>I always forget about imports, thanks!</span></div><div id="t1515885748000030" t="2018-01-13 23:22:28 alex-dixon @dave.dixon so in the one that works are there different time facts with different time values?"><a href="#t1515885748000030" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-13</span> <span class="t" onclick="H(this)">23:22:28</span>              alex-dixon </span><span>@dave.dixon so in the one that works are there different time facts with different time values?</span></div><div id="t1515885883000068" t="2018-01-13 23:24:43 sparkofreason @alex-dixon I haven&apos;t tried multiple time facts. I think it should work correctly with upsert, though. Retracting existing fact would lead to retraction of the generated Tag facts, and the subsequent insert would generate an updated set."><a href="#t1515885883000068" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-13</span> <span class="t" onclick="H(this)">23:24:43</span>           sparkofreason </span><span>@alex-dixon I haven&apos;t tried multiple time facts. I think it should work correctly with upsert, though. Retracting existing fact would lead to retraction of the generated Tag facts, and the subsequent insert would generate an updated set.</span></div><div id="t1515886068000024" t="2018-01-13 23:27:48 sparkofreason I was hoping to get away from having auxiliary unconditional facts like  Time . The other version of async is structurally similar, but there the external fact is  Response , which is correlated via a rule with the original  Request . There&apos;s an additional rule that forces retract of  Response  when the corresponding  Request  no longer exists."><a href="#t1515886068000024" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-13</span> <span class="t" onclick="H(this)">23:27:48</span>           sparkofreason </span><span>I was hoping to get away from having auxiliary unconditional facts like </span><code>Time</code><span>. The other version of async is structurally similar, but there the external fact is </span><code>Response</code><span>, which is correlated via a rule with the original </span><code>Request</code><span>. There&apos;s an additional rule that forces retract of </span><code>Response</code><span> when the corresponding </span><code>Request</code><span> no longer exists.</span></div><div id="t1515886197000035" t="2018-01-13 23:29:57 sparkofreason Given that both approaches require unconditional inserts, the  Request /`Response` pattern is arguably cleaner, as the atom approach requires some extra coordination outside of the rulebase to correctly update the session when the atom value changes."><a href="#t1515886197000035" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-13</span> <span class="t" onclick="H(this)">23:29:57</span>           sparkofreason </span><span>Given that both approaches require unconditional inserts, the </span><code>Request</code><span>/`Response` pattern is arguably cleaner, as the atom approach requires some extra coordination outside of the rulebase to correctly update the session when the atom value changes.</span></div><div id="t1515886631000040" t="2018-01-13 23:37:11 alex-dixon I’ll definitely keep this in mind as I try to do similar things. Wish I could be more help but it gets hard for me to reason about and I find my thinking tending toward more immutable approaches which seems like the opposite of the overall approach (fewer intermediate facts/garbage). I’ll try to experiment next time I’m at a laptop "><a href="#t1515886631000040" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-13</span> <span class="t" onclick="H(this)">23:37:11</span>              alex-dixon </span><span>I’ll definitely keep this in mind as I try to do similar things. Wish I could be more help but it gets hard for me to reason about and I find my thinking tending toward more immutable approaches which seems like the opposite of the overall approach (fewer intermediate facts/garbage). I’ll try to experiment next time I’m at a laptop </span></div><div id="t1515886728000063" t="2018-01-13 23:38:48 alex-dixon Curious, did you try a callback in the rhs and logical insert? Seem to recall that being your first approach. If so what happened? Loss of session context?"><a href="#t1515886728000063" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-13</span> <span class="t" onclick="H(this)">23:38:48</span>              alex-dixon </span><span>Curious, did you try a callback in the rhs and logical insert? Seem to recall that being your first approach. If so what happened? Loss of session context?</span></div><div id="t1515889746000094" t="2018-01-14 00:29:06 sparkofreason I have it working with a callback and unconditional insert. I don&apos;t think there&apos;s a way to do a logical insert in the context of the callback. The session has already moved forward, could have been modified further by the time the callback is called, etc."><a href="#t1515889746000094" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-14</span> <span class="t" onclick="H(this)">00:29:06</span>           sparkofreason </span><span>I have it working with a callback and unconditional insert. I don&apos;t think there&apos;s a way to do a logical insert in the context of the callback. The session has already moved forward, could have been modified further by the time the callback is called, etc.</span></div><div id="t1515940984000010" t="2018-01-14 14:43:04 alex-dixon I haven’t played around with it much. Typically I do the same as you I think….wait to handle it on the next fire-rules iteration, but that can be problematic in certain cases. So I’m kind of curious about being able to park/block within the RHS but I haven’t thought about it much. It might be convenient for Javascript but in a parallel or multiple thread environment…I dunno. I forget the case I ran into where I really did want to stop the world / rule activations until I could get a result, but I feel like that’s more an error in my thinking than a feature I need to figure out how to support. Don’t know though"><a href="#t1515940984000010" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-14</span> <span class="t" onclick="H(this)">14:43:04</span>                   alex-dixon </span><span>I haven’t played around with it much. Typically I do the same as you I think….wait to handle it on the next fire-rules iteration, but that can be problematic in certain cases. So I’m kind of curious about being able to park/block within the RHS but I haven’t thought about it much. It might be convenient for Javascript but in a parallel or multiple thread environment…I dunno. I forget the case I ran into where I really did want to stop the world / rule activations until I could get a result, but I feel like that’s more an error in my thinking than a feature I need to figure out how to support. Don’t know though</span></div><div id="t1515890546000021" t="2018-01-14 00:42:26 sparkofreason Part of what I was finding was that beyond the simple request/response case there was a proliferation of auxiliary fact types to deal with requests from the UI. For example, if the user toggled the &quot;Favorite&quot; button on an article, I would insert a  FavoritedArticle  fact, which in turn triggered  Request  to be inserted, along with a rule to handle the response to that  Request . I also had to add clean up rules to get rid of these  FavoritedArticle  facts when the page changed, as well as properly manage upsertion vs. insertion, etc. It was all starting to feel a bit fiddly. But I think you could actually do this with the same  Request /`Response` pattern, just replacing making an HTTP request with rendering the UI which will generate the  Response ."><a href="#t1515890546000021" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-14</span> <span class="t" onclick="H(this)">00:42:26</span>           sparkofreason </span><span>Part of what I was finding was that beyond the simple request/response case there was a proliferation of auxiliary fact types to deal with requests from the UI. For example, if the user toggled the &quot;Favorite&quot; button on an article, I would insert a </span><code>FavoritedArticle</code><span> fact, which in turn triggered </span><code>Request</code><span> to be inserted, along with a rule to handle the response to that </span><code>Request</code><span>. I also had to add clean up rules to get rid of these </span><code>FavoritedArticle</code><span> facts when the page changed, as well as properly manage upsertion vs. insertion, etc. It was all starting to feel a bit fiddly. But I think you could actually do this with the same </span><code>Request</code><span>/`Response` pattern, just replacing making an HTTP request with rendering the UI which will generate the </span><code>Response</code><span>.</span></div><div id="t1515940490000068" t="2018-01-14 14:34:50 alex-dixon So for precept I implemented something like the following. Below is somewhat similar to Redux in Javascript which also reifies this and request/response/fail for api calls for front-end state management. 

 (defrecord Action [type payload])

(defrule actions-only-survive-one-call-to-fire-rules
{:salience -100}
 [?fact &lt;- Action]
=&gt;
(retract! Action)

(defrule on-article-favorited
{:salience 100}
[Action (= ?type :article-favorited) (= ?payload payload)]
=&gt;
;; Still have the async dance but Action facts are automatically cleaned up at the end
(do)
"><a href="#t1515940490000068" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-14</span> <span class="t" onclick="H(this)">14:34:50</span>                   alex-dixon </span><span>So for precept I implemented something like the following. Below is somewhat similar to Redux in Javascript which also reifies this and request/response/fail for api calls for front-end state management. 

</span><pre>(defrecord Action [type payload])

(defrule actions-only-survive-one-call-to-fire-rules
{:salience -100}
 [?fact &lt;- Action]
=&gt;
(retract! Action)

(defrule on-article-favorited
{:salience 100}
[Action (= ?type :article-favorited) (= ?payload payload)]
=&gt;
;; Still have the async dance but Action facts are automatically cleaned up at the end
(do)
</pre></div><div id="t1515944195000027" t="2018-01-14 15:36:35 sparkofreason Right. I&apos;m trying to do this without salience, just to see where it takes me in terms of design, possible changes to clara, etc. One thing that has fallen out is that I think the fact-based immutable history approach of precept is probably the way to go, as opposed to using whole entities as facts and trying to update &quot;in place&quot;."><a href="#t1515944195000027" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-14</span> <span class="t" onclick="H(this)">15:36:35</span>                sparkofreason </span><span>Right. I&apos;m trying to do this without salience, just to see where it takes me in terms of design, possible changes to clara, etc. One thing that has fallen out is that I think the fact-based immutable history approach of precept is probably the way to go, as opposed to using whole entities as facts and trying to update &quot;in place&quot;.</span></div><div id="t1515951565000034" t="2018-01-14 17:39:25 alex-dixon Would you consider agenda groups? I’ve very little experience with systems that use them but we try to simulate them partially in precept by using Clara’s :activation-groups and :activation-group-sort-fn  http://www.clara-rules.org/docs/conflictsalience/"><a href="#t1515951565000034" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-14</span> <span class="t" onclick="H(this)">17:39:25</span>                   alex-dixon </span><span>Would you consider agenda groups? I’ve very little experience with systems that use them but we try to simulate them partially in precept by using Clara’s :activation-groups and :activation-group-sort-fn </span><a href="http://www.clara-rules.org/docs/conflictsalience/" target="_blank">http://www.clara-rules.org/docs/conflictsalience/</a></div><div id="t1515951651000100" t="2018-01-14 17:40:51 alex-dixon So we have :group :cleanup I think, which is given least precedence in the sort fn"><a href="#t1515951651000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-14</span> <span class="t" onclick="H(this)">17:40:51</span>                   alex-dixon </span><span>So we have :group :cleanup I think, which is given least precedence in the sort fn</span></div><div id="t1515952057000010" t="2018-01-14 17:47:37 alex-dixon I still run into wanting update in place but I’m on the fence about it because immutability is easier for me to understand. Case that comes up a lot is a default value:

 (rule when-no-user-selected-article
 [:not SelectedArticleId]
  [?most-recent &lt;- (acc/min :time :returns-fact true) :from [Article]]
=&gt;
(insert! (-&gt;SelectedArticleId (:id ?most-recent)))
"><a href="#t1515952057000010" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-14</span> <span class="t" onclick="H(this)">17:47:37</span>                   alex-dixon </span><span>I still run into wanting update in place but I’m on the fence about it because immutability is easier for me to understand. Case that comes up a lot is a default value:

</span><pre>(rule when-no-user-selected-article
 [:not SelectedArticleId]
  [?most-recent &lt;- (acc/min :time :returns-fact true) :from [Article]]
=&gt;
(insert! (-&gt;SelectedArticleId (:id ?most-recent)))
</pre></div><div id="t1515952184000098" t="2018-01-14 17:49:44 alex-dixon So that loops"><a href="#t1515952184000098" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-14</span> <span class="t" onclick="H(this)">17:49:44</span>                   alex-dixon </span><span>So that loops</span></div><div id="t1515952659000121" t="2018-01-14 17:57:39 alex-dixon There’s a :no-loop prop that’s relatively undocumented. Haven’t played with it but seems like it would solve this case. A (modify!) wouldn’t I guess because the SelectedArticleId doesn’t exist. If it did as something like (SelectedArticleId :unset) then you could match on (= id :unset) and (modify! ?selected-article :id (:id ?most-recent))"><a href="#t1515952659000121" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-14</span> <span class="t" onclick="H(this)">17:57:39</span>                   alex-dixon </span><span>There’s a :no-loop prop that’s relatively undocumented. Haven’t played with it but seems like it would solve this case. A (modify!) wouldn’t I guess because the SelectedArticleId doesn’t exist. If it did as something like (SelectedArticleId :unset) then you could match on (= id :unset) and (modify! ?selected-article :id (:id ?most-recent))</span></div><div id="t1515961706000049" t="2018-01-14 20:28:26 sparkofreason I need to think about it. But I really am trying, as an exercise, to see what happens if you constrain yourself solely to the logical consistency implied by clara. I think I&apos;m converging on something, but I&apos;ve thought that before only to trip over an ugly fact that ruined my beautiful theory."><a href="#t1515961706000049" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-14</span> <span class="t" onclick="H(this)">20:28:26</span>                sparkofreason </span><span>I need to think about it. But I really am trying, as an exercise, to see what happens if you constrain yourself solely to the logical consistency implied by clara. I think I&apos;m converging on something, but I&apos;ve thought that before only to trip over an ugly fact that ruined my beautiful theory.</span></div><div id="t1515961808000005" t="2018-01-14 20:30:08 sparkofreason BTW, the &quot;real world&quot; example app (conduit) is proving to be a great way to exercise this stuff. You might find it useful for precept development.  https://github.com/jacekschae/conduit"><a href="#t1515961808000005" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-14</span> <span class="t" onclick="H(this)">20:30:08</span>                sparkofreason </span><span>BTW, the &quot;real world&quot; example app (conduit) is proving to be a great way to exercise this stuff. You might find it useful for precept development. </span><a href="https://github.com/jacekschae/conduit" target="_blank">https://github.com/jacekschae/conduit</a></div><div id="t1515961925000147" t="2018-01-14 20:32:05 alex-dixon Yeah was thinking same! Would be nice to see it and Clara on their official list as well"><a href="#t1515961925000147" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-14</span> <span class="t" onclick="H(this)">20:32:05</span>                   alex-dixon </span><span>Yeah was thinking same! Would be nice to see it and Clara on their official list as well</span></div><div id="t1516039348000474" t="2018-01-15 18:02:28 alex-dixon @dave.dixon just curious Re part of issue 371: if you had something like s/querydef would you still want ns kw names for defquery?"><a href="#t1516039348000474" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-15</span> <span class="t" onclick="H(this)">18:02:28</span>              alex-dixon </span><span>@dave.dixon just curious Re part of issue 371: if you had something like s/querydef would you still want ns kw names for defquery?</span></div><div id="t1516039505000236" t="2018-01-15 18:05:05 sparkofreason What is  s/querydef ?"><a href="#t1516039505000236" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-15</span> <span class="t" onclick="H(this)">18:05:05</span>                sparkofreason </span><span>What is </span><code>s/querydef</code><span>?</span></div><div id="t1516039566000486" t="2018-01-15 18:06:06 alex-dixon Doesn’t exist.  🙂  Thinking it could be like s/fdef for queries"><a href="#t1516039566000486" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-15</span> <span class="t" onclick="H(this)">18:06:06</span>                   alex-dixon </span><span>Doesn’t exist. </span><b>🙂</b><span> Thinking it could be like s/fdef for queries</span></div><div id="t1516040811000147" t="2018-01-15 18:26:51 sparkofreason That&apos;s a good idea. But I&apos;d still want keyword names. It&apos;s not a big deal, just a nice option to give more flexibility to DSL authors. I have it working in my local branch in CLJS, pretty minor change."><a href="#t1516040811000147" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-15</span> <span class="t" onclick="H(this)">18:26:51</span>                sparkofreason </span><span>That&apos;s a good idea. But I&apos;d still want keyword names. It&apos;s not a big deal, just a nice option to give more flexibility to DSL authors. I have it working in my local branch in CLJS, pretty minor change.</span></div><div id="t1516040996000453" t="2018-01-15 18:29:56 alex-dixon What do the vars end up being named? e.g. (defquery ::some-alias/my-spec ..) =&gt; #’rule-ns/ … ?"><a href="#t1516040996000453" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-15</span> <span class="t" onclick="H(this)">18:29:56</span>                   alex-dixon </span><span>What do the vars end up being named? e.g. (defquery ::some-alias/my-spec ..) =&gt; #’rule-ns/ … ?</span></div><div id="t1516041507000334" t="2018-01-15 18:38:27 sparkofreason There are no vars. I&apos;m not defining the queries as ns-level defs. They&apos;re grouped inside of a named object, and that symbol winds up holding the collection of productions that is provided to  defsession ."><a href="#t1516041507000334" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-15</span> <span class="t" onclick="H(this)">18:38:27</span>                sparkofreason </span><span>There are no vars. I&apos;m not defining the queries as ns-level defs. They&apos;re grouped inside of a named object, and that symbol winds up holding the collection of productions that is provided to </span><code>defsession</code><span>.</span></div><div id="t1516047693000415" t="2018-01-15 20:21:33 alex-dixon Like most of your suggestions and changes I like that. Using defs/the ns as a kind of data structure is something I like sometimes and not others"><a href="#t1516047693000415" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-15</span> <span class="t" onclick="H(this)">20:21:33</span>                   alex-dixon </span><span>Like most of your suggestions and changes I like that. Using defs/the ns as a kind of data structure is something I like sometimes and not others</span></div><div id="t1516047857000299" t="2018-01-15 20:24:17 alex-dixon Is that part of your proposal? If not how would you envision this working for users of Clara? Would it affect session reloading?"><a href="#t1516047857000299" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-15</span> <span class="t" onclick="H(this)">20:24:17</span>                   alex-dixon </span><span>Is that part of your proposal? If not how would you envision this working for users of Clara? Would it affect session reloading?</span></div><div id="t1516051681000225" t="2018-01-15 21:28:01 sparkofreason I&apos;m putting together my own DSL that has those characteristics, not proposing to alter the existing rules DSL packaged with clara. I handle reloading in the implementation of my DSL. Since rules are just grouped in vars, it&apos;s pretty straightforward, don&apos;t have to deal with the subtleties of CLJS namespace reloading etc."><a href="#t1516051681000225" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-15</span> <span class="t" onclick="H(this)">21:28:01</span>                sparkofreason </span><span>I&apos;m putting together my own DSL that has those characteristics, not proposing to alter the existing rules DSL packaged with clara. I handle reloading in the implementation of my DSL. Since rules are just grouped in vars, it&apos;s pretty straightforward, don&apos;t have to deal with the subtleties of CLJS namespace reloading etc.</span></div><div id="t1516074202000236" t="2018-01-16 03:43:22 dadair is there a way to compose accumulators outside of writing a custom reducer? e.g., I want to get  the latest timestamp  of  all  facts, so some combination of  (acc/all)  and  (acc/max :tx)"><a href="#t1516074202000236" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-16</span> <span class="t" onclick="H(this)">03:43:22</span>                  dadair </span><span>is there a way to compose accumulators outside of writing a custom reducer? e.g., I want to get </span><code>the latest timestamp</code><span> of </span><code>all</code><span> facts, so some combination of </span><code>(acc/all)</code><span> and </span><code>(acc/max :tx)</code></div><div id="t1516084436000172" t="2018-01-16 06:33:56 mikerod @dadair there isn’t anything directly for that. On a case by case you may able to get the behavior you want from an accumulator like the max above. "><a href="#t1516084436000172" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-16</span> <span class="t" onclick="H(this)">06:33:56</span>                 mikerod </span><span>@dadair there isn’t anything directly for that. On a case by case you may able to get the behavior you want from an accumulator like the max above. </span></div><div id="t1516084516000075" t="2018-01-16 06:35:16 mikerod If you had a unique ID on all facts for example, you could just do
?l &lt;- (acc/max :tx) :from [A (= id? ?id)]
"><a href="#t1516084516000075" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-16</span> <span class="t" onclick="H(this)">06:35:16</span>                 mikerod </span><span>If you had a unique ID on all facts for example, you could just do
?l &lt;- (acc/max :tx) :from [A (= id? ?id)]
</span></div><div id="t1516084577000016" t="2018-01-16 06:36:17 mikerod I’m not sure that makes much sense though. acc/max is intended to find the max among all facts. Accumulators are mostly for reasoning about aggregates. I may have misunderstood your usage you were looking for. "><a href="#t1516084577000016" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-16</span> <span class="t" onclick="H(this)">06:36:17</span>                 mikerod </span><span>I’m not sure that makes much sense though. acc/max is intended to find the max among all facts. Accumulators are mostly for reasoning about aggregates. I may have misunderstood your usage you were looking for. </span></div><div id="t1516085685000112" t="2018-01-16 06:54:45 dadair The rule engine I work on takes the general from  (state, action) -&gt; actions , where  action  and  actions  are actions to perform (in aggregate) to transition  state  to a new state (basically the RE is a reduce, but instead of reducing to a new state, it returns “diff” operations through querying the resulting state that external service(s) can use to transition the state). A difficulty that I’ve had in general with this pattern is that I need to track changes to  state  as rules propagate, and then insert output actions based on those changes. So for example, given an initial entity A  {:id 1, :x true} , there may be cascading changes over the (short) life of the session that cause it to transition to any number of  {true,false}  values. I always want the stable result, so I have added  tx  values to track “time”. Given that, I may have a rule that “subscribes” to a number of those facts (e.g.,  all   :id s), but I want the  max   :tx  of each of those entities."><a href="#t1516085685000112" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-16</span> <span class="t" onclick="H(this)">06:54:45</span>                  dadair </span><span>The rule engine I work on takes the general from </span><code>(state, action) -&gt; actions</code><span>, where </span><code>action</code><span> and </span><code>actions</code><span> are actions to perform (in aggregate) to transition </span><code>state</code><span> to a new state (basically the RE is a reduce, but instead of reducing to a new state, it returns “diff” operations through querying the resulting state that external service(s) can use to transition the state). A difficulty that I’ve had in general with this pattern is that I need to track changes to </span><code>state</code><span> as rules propagate, and then insert output actions based on those changes. So for example, given an initial entity A </span><code>{:id 1, :x true}</code><span>, there may be cascading changes over the (short) life of the session that cause it to transition to any number of </span><code>{true,false}</code><span> values. I always want the stable result, so I have added </span><code>tx</code><span> values to track “time”. Given that, I may have a rule that “subscribes” to a number of those facts (e.g., </span><code>all</code><span> </span><code>:id</code><span>s), but I want the </span><code>max</code><span> </span><code>:tx</code><span> of each of those entities.</span></div><div id="t1516085734000117" t="2018-01-16 06:55:34 dadair In summary:  [?entities &lt;- (acc/all) :from [TimestampedEntity]] ;; ?entities =&gt; [{:id 1, :x true, :tx 1} {:id 1, :x false, :tx 2} {:id 2, :x true, :tx 3}]  but I only want the latest  :tx  for each unique entity, so desired:  ?entities =&gt; [{:id 1, :x false, :tx 2} {:id 2, :x true, :tx 3}]"><a href="#t1516085734000117" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-16</span> <span class="t" onclick="H(this)">06:55:34</span>                  dadair </span><span>In summary: </span><code>[?entities &lt;- (acc/all) :from [TimestampedEntity]] ;; ?entities =&gt; [{:id 1, :x true, :tx 1} {:id 1, :x false, :tx 2} {:id 2, :x true, :tx 3}]</code><span> but I only want the latest </span><code>:tx</code><span> for each unique entity, so desired: </span><code>?entities =&gt; [{:id 1, :x false, :tx 2} {:id 2, :x true, :tx 3}]</code></div><div id="t1516086027000152" t="2018-01-16 07:00:27 dadair e.g., to calculate a ratio of true entities over all entities (but only for their final states)"><a href="#t1516086027000152" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-16</span> <span class="t" onclick="H(this)">07:00:27</span>                  dadair </span><span>e.g., to calculate a ratio of true entities over all entities (but only for their final states)</span></div><div id="t1516118534000763" t="2018-01-16 16:02:14 mikerod @dadair if you use a variable binding bound to the :id field then the accumulator will give you the latest :tx per :id "><a href="#t1516118534000763" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-16</span> <span class="t" onclick="H(this)">16:02:14</span>                 mikerod </span><span>@dadair if you use a variable binding bound to the :id field then the accumulator will give you the latest :tx per :id </span></div><div id="t1516118696000096" t="2018-01-16 16:04:56 mikerod [?latest &lt;- (acc/max :tx) :from [TsEntity (= ?id id)]]
"><a href="#t1516118696000096" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-16</span> <span class="t" onclick="H(this)">16:04:56</span>                 mikerod </span><pre>[?latest &lt;- (acc/max :tx) :from [TsEntity (= ?id id)]]
</pre></div><div id="t1516118757000105" t="2018-01-16 16:05:57 mikerod That’s the “latest :tx “ of each fact group where they are grouped by :id "><a href="#t1516118757000105" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-16</span> <span class="t" onclick="H(this)">16:05:57</span>                 mikerod </span><span>That’s the “latest :tx “ of each fact group where they are grouped by :id </span></div><div id="t1516155309000097" t="2018-01-17 02:15:09 cfleming What is the logic by which class members from fact types are used to create local variables for the constraints?"><a href="#t1516155309000097" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-17</span> <span class="t" onclick="H(this)">02:15:09</span>                cfleming </span><span>What is the logic by which class members from fact types are used to create local variables for the constraints?</span></div><div id="t1516155398000073" t="2018-01-17 02:16:38 cfleming In  clara.examples.java.shopping , there are some examples  [Customer (= true VIP)]  and  [Order (&gt; total 200)] . I assume  VIP  is mapped to the  isVIP()  method and  total  is mapped to the  getTotal()  method?"><a href="#t1516155398000073" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-17</span> <span class="t" onclick="H(this)">02:16:38</span>                cfleming </span><span>In </span><code>clara.examples.java.shopping</code><span>, there are some examples </span><code>[Customer (= true VIP)]</code><span> and </span><code>[Order (&gt; total 200)]</code><span>. I assume </span><code>VIP</code><span> is mapped to the </span><code>isVIP()</code><span> method and </span><code>total</code><span> is mapped to the </span><code>getTotal()</code><span> method?</span></div><div id="t1516155425000035" t="2018-01-17 02:17:05 cfleming Are the rules around this defined anywhere, or could someone point me to the relevant DSL code?"><a href="#t1516155425000035" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-17</span> <span class="t" onclick="H(this)">02:17:05</span>                cfleming </span><span>Are the rules around this defined anywhere, or could someone point me to the relevant DSL code?</span></div><div id="t1516155685000186" t="2018-01-17 02:21:25 alex-dixon @cfleming  https://github.com/cerner/clara-rules/blob/941b776221690edab4904e3728715d0680bd6121/src/main/clojure/clara/rules/compiler.clj#L308"><a href="#t1516155685000186" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-17</span> <span class="t" onclick="H(this)">02:21:25</span>              alex-dixon </span><span>@cfleming </span><a href="https://github.com/cerner/clara-rules/blob/941b776221690edab4904e3728715d0680bd6121/src/main/clojure/clara/rules/compiler.clj#L308" target="_blank">https://github.com/cerner/clara-rules/blob/941b776221690edab4904e3728715d0680bd6121/src/main/clojure/clara/rules/compiler.clj#L308</a></div><div id="t1516155724000214" t="2018-01-17 02:22:04 cfleming @alex-dixon Isn’t that dealing with unification vars?"><a href="#t1516155724000214" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-17</span> <span class="t" onclick="H(this)">02:22:04</span>                cfleming </span><span>@alex-dixon Isn’t that dealing with unification vars?</span></div><div id="t1516155764000339" t="2018-01-17 02:22:44 cfleming Oh, it looks like  field-name-&gt;accessors-used , right?"><a href="#t1516155764000339" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-17</span> <span class="t" onclick="H(this)">02:22:44</span>                cfleming </span><span>Oh, it looks like </span><code>field-name-&gt;accessors-used</code><span>, right?</span></div><div id="t1516155846000279" t="2018-01-17 02:24:06 alex-dixon https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/rules/compiler.clj#L149"><a href="#t1516155846000279" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-17</span> <span class="t" onclick="H(this)">02:24:06</span>              alex-dixon </span><a href="https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/rules/compiler.clj#L149" target="_blank">https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/rules/compiler.clj#L149</a></div><div id="t1516155962000081" t="2018-01-17 02:26:02 alex-dixon @cfleming Er. get-fields a few down from there what you’re looking for?"><a href="#t1516155962000081" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-17</span> <span class="t" onclick="H(this)">02:26:02</span>              alex-dixon </span><span>@cfleming Er. get-fields a few down from there what you’re looking for?</span></div><div id="t1516155990000277" t="2018-01-17 02:26:30 cfleming Yes, I think so - thanks!"><a href="#t1516155990000277" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-17</span> <span class="t" onclick="H(this)">02:26:30</span>                cfleming </span><span>Yes, I think so - thanks!</span></div><div id="t1516317069000296" t="2018-01-18 23:11:09 zylox so you essentially want a history as long as all members of that history are present"><a href="#t1516317069000296" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-18</span> <span class="t" onclick="H(this)">23:11:09</span>                   zylox </span><span>so you essentially want a history as long as all members of that history are present</span></div><div id="t1516317146000318" t="2018-01-18 23:12:26 zylox given how much the tms relies on present state alone that would be quite a doozy"><a href="#t1516317146000318" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-18</span> <span class="t" onclick="H(this)">23:12:26</span>                   zylox </span><span>given how much the tms relies on present state alone that would be quite a doozy</span></div><div id="t1516317615000436" t="2018-01-18 23:20:15 sparkofreason Yeah, digging around the code, I&apos;m not sure it even makes sense with how rete works. It seems like it would require some modification."><a href="#t1516317615000436" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-18</span> <span class="t" onclick="H(this)">23:20:15</span>           sparkofreason </span><span>Yeah, digging around the code, I&apos;m not sure it even makes sense with how rete works. It seems like it would require some modification.</span></div><div id="t1516317696000371" t="2018-01-18 23:21:36 sparkofreason Seems  similar to a join-node, but has to appear in a different place in the network or something."><a href="#t1516317696000371" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-18</span> <span class="t" onclick="H(this)">23:21:36</span>           sparkofreason </span><span>Seems  similar to a join-node, but has to appear in a different place in the network or something.</span></div><div id="t1516317777000049" t="2018-01-18 23:22:57 zylox you could envisions something like layered sessions that join their nodes (3d memory from a visulization point of view) and query &quot;downward&quot; but thats all a ton of work"><a href="#t1516317777000049" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-18</span> <span class="t" onclick="H(this)">23:22:57</span>                   zylox </span><span>you could envisions something like layered sessions that join their nodes (3d memory from a visulization point of view) and query &quot;downward&quot; but thats all a ton of work</span></div><div id="t1516317785000432" t="2018-01-18 23:23:05 zylox but ya i agree....doesnt really mesh with rete imo"><a href="#t1516317785000432" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-18</span> <span class="t" onclick="H(this)">23:23:05</span>                   zylox </span><span>but ya i agree....doesnt really mesh with rete imo</span></div><div id="t1516374247000545" t="2018-01-19 15:04:07 mikerod @dave.dixon I mostly never would recommend many patterns that make pervasive use of  insert-unconditional!"><a href="#t1516374247000545" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-19</span> <span class="t" onclick="H(this)">15:04:07</span>                 mikerod </span><span>@dave.dixon I mostly never would recommend many patterns that make pervasive use of </span><code>insert-unconditional!</code></div><div id="t1516374312000933" t="2018-01-19 15:05:12 mikerod The one case I keep seeing that is difficult to work around is when needing to retract internally for something like “old events”. Other than that, I think it’s best to avoid. Even then, there are several RHS retract related issues outstanding that can be seen in the GitHub"><a href="#t1516374312000933" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-19</span> <span class="t" onclick="H(this)">15:05:12</span>                 mikerod </span><span>The one case I keep seeing that is difficult to work around is when needing to retract internally for something like “old events”. Other than that, I think it’s best to avoid. Even then, there are several RHS retract related issues outstanding that can be seen in the GitHub</span></div><div id="t1516374328000554" t="2018-01-19 15:05:28 mikerod I’m looking at your example to see if I see anything you could do"><a href="#t1516374328000554" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-19</span> <span class="t" onclick="H(this)">15:05:28</span>                 mikerod </span><span>I’m looking at your example to see if I see anything you could do</span></div><div id="t1516376480000378" t="2018-01-19 15:41:20 mikerod Woops missing a part in that, will edit"><a href="#t1516376480000378" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-19</span> <span class="t" onclick="H(this)">15:41:20</span>                 mikerod </span><span>Woops missing a part in that, will edit</span></div><div id="t1516377487001020" t="2018-01-19 15:58:07 sparkofreason @mikerod Interesting. Let me ponder that."><a href="#t1516377487001020" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-19</span> <span class="t" onclick="H(this)">15:58:07</span>           sparkofreason </span><span>@mikerod Interesting. Let me ponder that.</span></div><div id="t1516377568000570" t="2018-01-19 15:59:28 mikerod I am missing a part still. Trying to get that done. The concept I think can work though in terms of marking a timestamp at each stage. However, the above fails because it is letting TMS remove the intermediary collections from previous runs"><a href="#t1516377568000570" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-19</span> <span class="t" onclick="H(this)">15:59:28</span>                 mikerod </span><span>I am missing a part still. Trying to get that done. The concept I think can work though in terms of marking a timestamp at each stage. However, the above fails because it is letting TMS remove the intermediary collections from previous runs</span></div><div id="t1516377614000424" t="2018-01-19 16:00:14 mikerod I think you have to signal each “stage” as an explicit fact though. Without something like that, the network never knows what each conceptual step is to you. It doesn’t distinguish one  fire-rules  from another really"><a href="#t1516377614000424" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-19</span> <span class="t" onclick="H(this)">16:00:14</span>                 mikerod </span><span>I think you have to signal each “stage” as an explicit fact though. Without something like that, the network never knows what each conceptual step is to you. It doesn’t distinguish one </span><code>fire-rules</code><span> from another really</span></div><div id="t1516377634000619" t="2018-01-19 16:00:34 mikerod So usually when that sort of info is missing, you end up adding it as a fact to represent the idea"><a href="#t1516377634000619" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-19</span> <span class="t" onclick="H(this)">16:00:34</span>                 mikerod </span><span>So usually when that sort of info is missing, you end up adding it as a fact to represent the idea</span></div><div id="t1516380754000528" t="2018-01-19 16:52:34 mikerod @dave.dixon I updated it now"><a href="#t1516380754000528" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-19</span> <span class="t" onclick="H(this)">16:52:34</span>                 mikerod </span><span>@dave.dixon I updated it now</span></div><div id="t1516380789000084" t="2018-01-19 16:53:09 mikerod It is hard to say that it exactly captures what you want. If you look at  :before-retract  though, you get the multiple accumulated groups idea that you were wanting"><a href="#t1516380789000084" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-19</span> <span class="t" onclick="H(this)">16:53:09</span>                 mikerod </span><span>It is hard to say that it exactly captures what you want. If you look at </span><code>:before-retract</code><span> though, you get the multiple accumulated groups idea that you were wanting</span></div><div id="t1516380803000420" t="2018-01-19 16:53:23 mikerod Just requires each fact to be externally stamped with the same “timestamp” as the “fire event” that they were inserted with"><a href="#t1516380803000420" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-19</span> <span class="t" onclick="H(this)">16:53:23</span>                 mikerod </span><span>Just requires each fact to be externally stamped with the same “timestamp” as the “fire event” that they were inserted with</span></div><div id="t1516380814000327" t="2018-01-19 16:53:34 mikerod I couldn’t work out a way for rules to express that stamping due to logical TMS."><a href="#t1516380814000327" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-19</span> <span class="t" onclick="H(this)">16:53:34</span>                 mikerod </span><span>I couldn’t work out a way for rules to express that stamping due to logical TMS.</span></div><div id="t1516380835000180" t="2018-01-19 16:53:55 mikerod Retracting is slightly harder, since you need to retract all matching facts across all timestamps (at least from your sort of example)"><a href="#t1516380835000180" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-19</span> <span class="t" onclick="H(this)">16:53:55</span>                 mikerod </span><span>Retracting is slightly harder, since you need to retract all matching facts across all timestamps (at least from your sort of example)</span></div><div id="t1516380861001006" t="2018-01-19 16:54:21 mikerod This retraction results in all prior groups being updated as well to remove the fact that is gone. That isn’t exactly what you wanted I dont’ think, but it conveys somewhat similar information."><a href="#t1516380861001006" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-19</span> <span class="t" onclick="H(this)">16:54:21</span>                 mikerod </span><span>This retraction results in all prior groups being updated as well to remove the fact that is gone. That isn’t exactly what you wanted I dont’ think, but it conveys somewhat similar information.</span></div><div id="t1516381052000568" t="2018-01-19 16:57:32 mikerod The accumulation for  Nums  could tag it with the  FireEvent   ts  it went with. Then that could be used to do a duplicate removal and/or “newest” result lookup on the  :before-retract  vs  :after-retract"><a href="#t1516381052000568" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-19</span> <span class="t" onclick="H(this)">16:57:32</span>                 mikerod </span><span>The accumulation for </span><code>Nums</code><span> could tag it with the </span><code>FireEvent</code><span> </span><code>ts</code><span> it went with. Then that could be used to do a duplicate removal and/or “newest” result lookup on the </span><code>:before-retract</code><span> vs </span><code>:after-retract</code></div><div id="t1516388275000579" t="2018-01-19 18:57:55 wparker @dave.dixon Perhaps a model like the following might work if you’re OK with accumulating some “garbage” over time.
 - Logically insert a &quot;Request&quot; fact.
- Have a query like [Request (= ?id id)] [:not [RequestResponse (= ?id id)]].
- The client would externally insert a RequestResponse fact when it wanted to &quot;close&quot; a request.
- A todo could be done like [Request (= ?id id)] [:not [RequestResponse (= ?id id)]] =&gt; (insert! (-&gt;ToDo ?id)).
Then further logic downstream could dispatch on the TODOs as required, say if too many were outstanding.
 
If you need to clean up garbage, it almost sounds like you’re asking about retracting a fact without removing downstream insertions due to it.. is that on target at all?"><a href="#t1516388275000579" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-19</span> <span class="t" onclick="H(this)">18:57:55</span>                 wparker </span><span>@dave.dixon Perhaps a model like the following might work if you’re OK with accumulating some “garbage” over time.
</span><pre>- Logically insert a &quot;Request&quot; fact.
- Have a query like [Request (= ?id id)] [:not [RequestResponse (= ?id id)]].
- The client would externally insert a RequestResponse fact when it wanted to &quot;close&quot; a request.
- A todo could be done like [Request (= ?id id)] [:not [RequestResponse (= ?id id)]] =&gt; (insert! (-&gt;ToDo ?id)).
Then further logic downstream could dispatch on the TODOs as required, say if too many were outstanding.
</pre><span>
If you need to clean up garbage, it almost sounds like you’re asking about retracting a fact without removing downstream insertions due to it.. is that on target at all?</span></div><div id="t1516390099000106" t="2018-01-19 19:28:19 sparkofreason @wparker I think in your 4th bullet you would remove the  :not . But otherwise, that&apos;s basically it. The &quot;garbage&quot; is okay, I&apos;m experimenting with rulesets that enforce logical consistency over time, e.g. of some process of interacting with the user and an external server. So the &quot;garbage&quot; is really the history. What I&apos;m finding is that you generally have some &quot;anchor&quot; facts from which the rest of the process logic flows, so when you change the anchor the &quot;garbage&quot; gets collected. For example, in the conduit example, an anchor fact is the filter which retrieves a set of articles from the server, So articles wind up inserted with conditional dependence on the filter fact. Then the user can do a number of things, like change the favorite status of an article, edit if they are the author, etc. So all of that history gets accumulated, but when you change the filter it&apos;s all retracted."><a href="#t1516390099000106" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-19</span> <span class="t" onclick="H(this)">19:28:19</span>           sparkofreason </span><span>@wparker I think in your 4th bullet you would remove the </span><code>:not</code><span>. But otherwise, that&apos;s basically it. The &quot;garbage&quot; is okay, I&apos;m experimenting with rulesets that enforce logical consistency over time, e.g. of some process of interacting with the user and an external server. So the &quot;garbage&quot; is really the history. What I&apos;m finding is that you generally have some &quot;anchor&quot; facts from which the rest of the process logic flows, so when you change the anchor the &quot;garbage&quot; gets collected. For example, in the conduit example, an anchor fact is the filter which retrieves a set of articles from the server, So articles wind up inserted with conditional dependence on the filter fact. Then the user can do a number of things, like change the favorite status of an article, edit if they are the author, etc. So all of that history gets accumulated, but when you change the filter it&apos;s all retracted.</span></div><div id="t1516390339000068" t="2018-01-19 19:32:19 sparkofreason @wparker It wasn&apos;t specifically that I was looking to retract a fact without removing downstream insertions, rather modify the set of facts that went into an accumulator without retracting downstream insertions created by previous activations of the accumulator rule. It makes sense from a purely logical standpoint (I think), but the semantics of accumulators in the rule network are slightly different - not wrong, just making a different logical assertion, and one that is feasible within rule network architecture."><a href="#t1516390339000068" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-19</span> <span class="t" onclick="H(this)">19:32:19</span>           sparkofreason </span><span>@wparker It wasn&apos;t specifically that I was looking to retract a fact without removing downstream insertions, rather modify the set of facts that went into an accumulator without retracting downstream insertions created by previous activations of the accumulator rule. It makes sense from a purely logical standpoint (I think), but the semantics of accumulators in the rule network are slightly different - not wrong, just making a different logical assertion, and one that is feasible within rule network architecture.</span></div><div id="t1517188686000157" t="2018-01-29 01:18:06 tcarls If I have records having a field used for ordering -- like a timestamp -- and want to make rules that reason about or refer to &quot;the immediately preceding X&quot;, or &quot;the most recent X to have attribute Y&quot;, is Clara well-suited to the purpose?"><a href="#t1517188686000157" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-29</span> <span class="t" onclick="H(this)">01:18:06</span>                  tcarls </span><span>If I have records having a field used for ordering -- like a timestamp -- and want to make rules that reason about or refer to &quot;the immediately preceding X&quot;, or &quot;the most recent X to have attribute Y&quot;, is Clara well-suited to the purpose?</span></div><div id="t1517188714000149" t="2018-01-29 01:18:34 tcarls (&quot;immediately preceding&quot; relative to another record, that is, as opposed to, say, an accumulator reflecting the globally most recent insert/assertion)."><a href="#t1517188714000149" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-29</span> <span class="t" onclick="H(this)">01:18:34</span>                  tcarls </span><span>(&quot;immediately preceding&quot; relative to another record, that is, as opposed to, say, an accumulator reflecting the globally most recent insert/assertion).</span></div><div id="t1517194472000013" t="2018-01-29 02:54:32 dadair It can be, I’m currently using it to reason about entities that change over time. I have to admit though that I don’t find it that easy to model (although I could be doing things horribly wrong)."><a href="#t1517194472000013" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-29</span> <span class="t" onclick="H(this)">02:54:32</span>                  dadair </span><span>It can be, I’m currently using it to reason about entities that change over time. I have to admit though that I don’t find it that easy to model (although I could be doing things horribly wrong).</span></div><div id="t1517194562000119" t="2018-01-29 02:56:02 dadair e.g., I have entities of type  A  that can change over time (tracked through a timestamp), and other entities of type  B  that can change over time in response to the changes to type  A  (that is, there is a relation  B = f(A)) , and other entities of type  C = f(B)  that also change over time in response to changes in B"><a href="#t1517194562000119" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-29</span> <span class="t" onclick="H(this)">02:56:02</span>                  dadair </span><span>e.g., I have entities of type </span><code>A</code><span> that can change over time (tracked through a timestamp), and other entities of type </span><code>B</code><span> that can change over time in response to the changes to type </span><code>A</code><span> (that is, there is a relation </span><code>B = f(A))</code><span>, and other entities of type </span><code>C = f(B)</code><span> that also change over time in response to changes in B</span></div><div id="t1517194626000038" t="2018-01-29 02:57:06 dadair I find the rules I’m writing to be quite.. cumbersome, and I find myself inserting special facts just to facilitate rule propagation, to prevent e.g., infinite activations"><a href="#t1517194626000038" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-29</span> <span class="t" onclick="H(this)">02:57:06</span>                  dadair </span><span>I find the rules I’m writing to be quite.. cumbersome, and I find myself inserting special facts just to facilitate rule propagation, to prevent e.g., infinite activations</span></div><div id="t1517194745000134" t="2018-01-29 02:59:05 dadair however, the challenges I face come from the /fact/ that changes are inserted as a consequence of rules, if all history was known prior to rule activation, and I wasn’t inserting new facts from rules (that is, growing/extending  time  within a given session’s  fire-rules ), and I was simply querying certain states throughout a known and unchanging history, that would be perfectly suitable"><a href="#t1517194745000134" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-29</span> <span class="t" onclick="H(this)">02:59:05</span>                  dadair </span><span>however, the challenges I face come from the /fact/ that changes are inserted as a consequence of rules, if all history was known prior to rule activation, and I wasn’t inserting new facts from rules (that is, growing/extending </span><code>time</code><span> within a given session’s </span><code>fire-rules</code><span>), and I was simply querying certain states throughout a known and unchanging history, that would be perfectly suitable</span></div><div id="t1517239247000212" t="2018-01-29 15:20:47 mikerod @tcarls I think that @dadair has some good things to think about in terms of what you are trying to accomplish. Some of it varies according to the situation. 
Here is an example that I think meets at least one part of your question though
 (defrule immediately-preceding
  [A (= timestamp ?ts)]
  [?preceding &lt;- (acc/max :timestamp :returns-fact true) :from [B (&lt; timestamp ?ts)]]
  =&gt;
  &lt;etc&gt;)
"><a href="#t1517239247000212" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-29</span> <span class="t" onclick="H(this)">15:20:47</span>                 mikerod </span><span>@tcarls I think that @dadair has some good things to think about in terms of what you are trying to accomplish. Some of it varies according to the situation. 
Here is an example that I think meets at least one part of your question though
</span><pre>(defrule immediately-preceding
  [A (= timestamp ?ts)]
  [?preceding &lt;- (acc/max :timestamp :returns-fact true) :from [B (&lt; timestamp ?ts)]]
  =&gt;
  &lt;etc&gt;)
</pre></div><div id="t1517239317000312" t="2018-01-29 15:21:57 mikerod You can use an accumulator that constrains the facts that it accumulates over. By doing this, you can match things more specific/localized/“parameterized”, rather than “global” accumulations."><a href="#t1517239317000312" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-29</span> <span class="t" onclick="H(this)">15:21:57</span>                 mikerod </span><span>You can use an accumulator that constrains the facts that it accumulates over. By doing this, you can match things more specific/localized/“parameterized”, rather than “global” accumulations.</span></div><div id="t1517241828000303" t="2018-01-29 16:03:48 tcarls @mikerod, that&apos;s extremely helpful; thank you."><a href="#t1517241828000303" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-29</span> <span class="t" onclick="H(this)">16:03:48</span>                  tcarls </span><span>@mikerod, that&apos;s extremely helpful; thank you.</span></div><div id="t1517328327000629" t="2018-01-30 16:05:27 afurmanov Hello, I have question about  acc/all  behavior, the following snippet of code:  (ns rules-acc-all
  (require [clara.rules :as rules]
           [clara.rules.accumulators :as acc]
           [clojure.pprint :refer [pprint]]))

(defrecord Customer [id])
(defrecord Reward [id])
(defrecord CustomerReward [id customer-id reward-id])

(rules/defrule quals
  [Customer (= ?C id)]
  [Reward (= ?R id) (= id &quot;bonus-1&quot;)]
  ;;[?items &lt;- (acc/all) :from [CustomerReward (= id ?I) (= ?C customer-id)]]
  [?items &lt;- (acc/all) :from [CustomerReward (= ?C customer-id)]]
  =&gt;
  (pprint {&quot;?items&quot; ?items}))


(let [session (-&gt; (rules/mk-session &apos;rules-acc-all)
                  (rules/insert (-&gt;Customer &quot;customer-1&quot;)
                                (-&gt;Reward &quot;bonus-1&quot;)
                                (-&gt;Reward &quot;offer-1&quot;)
                                (-&gt;Reward &quot;offer-2&quot;)
                                (-&gt;CustomerReward &quot;cr-1&quot; &quot;customer-1&quot; &quot;offer-1&quot;)
                                (-&gt;CustomerReward &quot;cr-2&quot; &quot;customer-1&quot; &quot;offer-2&quot;)))
      fired (rules/fire-rules session)]
  )
"><a href="#t1517328327000629" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-30</span> <span class="t" onclick="H(this)">16:05:27</span>               afurmanov </span><span>Hello, I have question about </span><code>acc/all</code><span> behavior, the following snippet of code: </span><pre>(ns rules-acc-all
  (require [clara.rules :as rules]
           [clara.rules.accumulators :as acc]
           [clojure.pprint :refer [pprint]]))

(defrecord Customer [id])
(defrecord Reward [id])
(defrecord CustomerReward [id customer-id reward-id])

(rules/defrule quals
  [Customer (= ?C id)]
  [Reward (= ?R id) (= id &quot;bonus-1&quot;)]
  ;;[?items &lt;- (acc/all) :from [CustomerReward (= id ?I) (= ?C customer-id)]]
  [?items &lt;- (acc/all) :from [CustomerReward (= ?C customer-id)]]
  =&gt;
  (pprint {&quot;?items&quot; ?items}))


(let [session (-&gt; (rules/mk-session &apos;rules-acc-all)
                  (rules/insert (-&gt;Customer &quot;customer-1&quot;)
                                (-&gt;Reward &quot;bonus-1&quot;)
                                (-&gt;Reward &quot;offer-1&quot;)
                                (-&gt;Reward &quot;offer-2&quot;)
                                (-&gt;CustomerReward &quot;cr-1&quot; &quot;customer-1&quot; &quot;offer-1&quot;)
                                (-&gt;CustomerReward &quot;cr-2&quot; &quot;customer-1&quot; &quot;offer-2&quot;)))
      fired (rules/fire-rules session)]
  )
</pre></div><div id="t1517328348000071" t="2018-01-30 16:05:48 afurmanov Prints  {&quot;?items&quot;
 [{:id &quot;cr-1&quot;, :customer-id &quot;customer-1&quot;, :reward-id &quot;offer-1&quot;}
  {:id &quot;cr-2&quot;, :customer-id &quot;customer-1&quot;, :reward-id &quot;offer-2&quot;}]}
"><a href="#t1517328348000071" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-30</span> <span class="t" onclick="H(this)">16:05:48</span>               afurmanov </span><span>Prints </span><pre>{&quot;?items&quot;
 [{:id &quot;cr-1&quot;, :customer-id &quot;customer-1&quot;, :reward-id &quot;offer-1&quot;}
  {:id &quot;cr-2&quot;, :customer-id &quot;customer-1&quot;, :reward-id &quot;offer-2&quot;}]}
</pre></div><div id="t1517328364000005" t="2018-01-30 16:06:04 afurmanov i.e.  ?items  contain two elements."><a href="#t1517328364000005" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-30</span> <span class="t" onclick="H(this)">16:06:04</span>               afurmanov </span><span>i.e. </span><code>?items</code><span> contain two elements.</span></div><div id="t1517328440000673" t="2018-01-30 16:07:20 afurmanov However if condition  [?items &lt;- (acc/all) :from [CustomerReward (= ?C customer-id)]]  is replaced with  [?items &lt;- (acc/all) :from [CustomerReward (= id ?I) (= ?C customer-id)]]  (pretty much same with unification added for CustomerReward  (= id ?I)  the the output would be:"><a href="#t1517328440000673" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-30</span> <span class="t" onclick="H(this)">16:07:20</span>               afurmanov </span><span>However if condition </span><code>[?items &lt;- (acc/all) :from [CustomerReward (= ?C customer-id)]]</code><span> is replaced with </span><code>[?items &lt;- (acc/all) :from [CustomerReward (= id ?I) (= ?C customer-id)]]</code><span> (pretty much same with unification added for CustomerReward </span><code>(= id ?I)</code><span> the the output would be:</span></div><div id="t1517328455000366" t="2018-01-30 16:07:35 afurmanov {&quot;?items&quot;
 [{:id &quot;cr-1&quot;, :customer-id &quot;customer-1&quot;, :reward-id &quot;offer-1&quot;}]}
{&quot;?items&quot;
 [{:id &quot;cr-2&quot;, :customer-id &quot;customer-1&quot;, :reward-id &quot;offer-2&quot;}]}"><a href="#t1517328455000366" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-30</span> <span class="t" onclick="H(this)">16:07:35</span>               afurmanov </span><pre>{&quot;?items&quot;
 [{:id &quot;cr-1&quot;, :customer-id &quot;customer-1&quot;, :reward-id &quot;offer-1&quot;}]}
{&quot;?items&quot;
 [{:id &quot;cr-2&quot;, :customer-id &quot;customer-1&quot;, :reward-id &quot;offer-2&quot;}]}</pre></div><div id="t1517328476000768" t="2018-01-30 16:07:56 afurmanov I.e. ?items contain single element, but rule gets triggered twice."><a href="#t1517328476000768" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-30</span> <span class="t" onclick="H(this)">16:07:56</span>               afurmanov </span><span>I.e. ?items contain single element, but rule gets triggered twice.</span></div><div id="t1517328566000051" t="2018-01-30 16:09:26 afurmanov I am trying to wrap my mind around this, but cannot - those two rules set look pretty much same to me"><a href="#t1517328566000051" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-30</span> <span class="t" onclick="H(this)">16:09:26</span>               afurmanov </span><span>I am trying to wrap my mind around this, but cannot - those two rules set look pretty much same to me</span></div><div id="t1517331671000711" t="2018-01-30 17:01:11 sparkofreason I believe it&apos;s because when you specify  (= id ?I)  in the accumulator, clara will now make a unique binding for each unique value of  id , so the rule fires once for each  id  of  CustomerReward  rather than accumulating over all  CustomerReward &apos;s with different  id &apos;s."><a href="#t1517331671000711" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-30</span> <span class="t" onclick="H(this)">17:01:11</span>           sparkofreason </span><span>I believe it&apos;s because when you specify </span><code>(= id ?I)</code><span> in the accumulator, clara will now make a unique binding for each unique value of </span><code>id</code><span>, so the rule fires once for each </span><code>id</code><span> of </span><code>CustomerReward</code><span> rather than accumulating over all </span><code>CustomerReward</code><span>&apos;s with different </span><code>id</code><span>&apos;s.</span></div><div id="t1517332344000194" t="2018-01-30 17:12:24 afurmanov Thanks @dave.dixon - that kind of explains it. I guess my confusion was due thinking that binding  (= id ?I)  is kind of &quot;local&quot; to accumulator, in other words it works as sub-select in SQL, however it appears such binding makes  ?I  &quot;available&quot; to &quot;outer scope&quot;, i.e. I could refer it for unification in clauses which are siblings of accumulator."><a href="#t1517332344000194" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-30</span> <span class="t" onclick="H(this)">17:12:24</span>               afurmanov </span><span>Thanks @dave.dixon - that kind of explains it. I guess my confusion was due thinking that binding </span><code>(= id ?I)</code><span> is kind of &quot;local&quot; to accumulator, in other words it works as sub-select in SQL, however it appears such binding makes </span><code>?I</code><span> &quot;available&quot; to &quot;outer scope&quot;, i.e. I could refer it for unification in clauses which are siblings of accumulator.</span></div><div id="t1517332394000524" t="2018-01-30 17:13:14 sparkofreason Correct. Or you could refer to  ?I  in the RHS of the rule, where it would have to be unique."><a href="#t1517332394000524" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-30</span> <span class="t" onclick="H(this)">17:13:14</span>           sparkofreason </span><span>Correct. Or you could refer to </span><code>?I</code><span> in the RHS of the rule, where it would have to be unique.</span></div><div id="t1517332417000611" t="2018-01-30 17:13:37 afurmanov Yep, then it makes sense"><a href="#t1517332417000611" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-30</span> <span class="t" onclick="H(this)">17:13:37</span>               afurmanov </span><span>Yep, then it makes sense</span></div><div id="t1517364441000198" t="2018-01-31 02:07:21 tcarls I&apos;m seeing rules no longer firing after I reloaded the namespace that contains them in the REPL, even if I create an entirely new session with  (mk-session :cache false) . What am I missing?"><a href="#t1517364441000198" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-31</span> <span class="t" onclick="H(this)">02:07:21</span>                  tcarls </span><span>I&apos;m seeing rules no longer firing after I reloaded the namespace that contains them in the REPL, even if I create an entirely new session with </span><code>(mk-session :cache false)</code><span>. What am I missing?</span></div><div id="t1517373928000031" t="2018-01-31 04:45:28 dadair @tcarls might need a code example, numerous things could be happening, depending on the state of the namespace"><a href="#t1517373928000031" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-31</span> <span class="t" onclick="H(this)">04:45:28</span>                  dadair </span><span>@tcarls might need a code example, numerous things could be happening, depending on the state of the namespace</span></div><div id="t1517415115000980" t="2018-01-31 16:11:55 tcarls @dadair, in hindsight, I&apos;m pretty sure what&apos;s happening is caused by new  defrecord s being run, but trying to run rules against data from an atom that includes (expensive-to-calculate) cached previous instances of input data. Going to move the definitions into their own namespace; I expect that&apos;ll help."><a href="#t1517415115000980" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-31</span> <span class="t" onclick="H(this)">16:11:55</span>                  tcarls </span><span>@dadair, in hindsight, I&apos;m pretty sure what&apos;s happening is caused by new </span><code>defrecord</code><span>s being run, but trying to run rules against data from an atom that includes (expensive-to-calculate) cached previous instances of input data. Going to move the definitions into their own namespace; I expect that&apos;ll help.</span></div><div id="t1517415173000635" t="2018-01-31 16:12:53 mikerod @tcarls that is common"><a href="#t1517415173000635" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-31</span> <span class="t" onclick="H(this)">16:12:53</span>                 mikerod </span><span>@tcarls that is common</span></div><div id="t1517415213000129" t="2018-01-31 16:13:33 mikerod The  potemkin  lib had some extensions to  defrecord  and other related macros to avoid that sort of redefinition of classes to help with reloading workflows in the REPL"><a href="#t1517415213000129" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-31</span> <span class="t" onclick="H(this)">16:13:33</span>                 mikerod </span><span>The </span><code>potemkin</code><span> lib had some extensions to </span><code>defrecord</code><span> and other related macros to avoid that sort of redefinition of classes to help with reloading workflows in the REPL</span></div><div id="t1517415234000406" t="2018-01-31 16:13:54 mikerod I think one workaround people do for Clara has been to do  defrecord  in a separate ns that you don’t plan to reload much"><a href="#t1517415234000406" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-31</span> <span class="t" onclick="H(this)">16:13:54</span>                 mikerod </span><span>I think one workaround people do for Clara has been to do </span><code>defrecord</code><span> in a separate ns that you don’t plan to reload much</span></div><div id="t1517415248000539" t="2018-01-31 16:14:08 mikerod So the rules don’t get mismatched definitions of the “same class”"><a href="#t1517415248000539" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-31</span> <span class="t" onclick="H(this)">16:14:08</span>                 mikerod </span><span>So the rules don’t get mismatched definitions of the “same class”</span></div><div id="t1517437150000278" t="2018-01-31 22:19:10 tcarls One thing that&apos;s surprising me in using Clara is how one needs to take explicit steps to avoid getting two equal records created if arriving at the same fact via two different rules."><a href="#t1517437150000278" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-31</span> <span class="t" onclick="H(this)">22:19:10</span>                  tcarls </span><span>One thing that&apos;s surprising me in using Clara is how one needs to take explicit steps to avoid getting two equal records created if arriving at the same fact via two different rules.</span></div><div id="t1517438438000082" t="2018-01-31 22:40:38 mikerod @tcarls yeah, there are pro’s and con’s to that"><a href="#t1517438438000082" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-31</span> <span class="t" onclick="H(this)">22:40:38</span>                 mikerod </span><span>@tcarls yeah, there are pro’s and con’s to that</span></div><div id="t1517438453000298" t="2018-01-31 22:40:53 mikerod There are definitely use-cases where “cardinality” matters"><a href="#t1517438453000298" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-31</span> <span class="t" onclick="H(this)">22:40:53</span>                 mikerod </span><span>There are definitely use-cases where “cardinality” matters</span></div><div id="t1517438476000283" t="2018-01-31 22:41:16 mikerod I’ve had quite a few of those before. So if you “removed the duplicates” you’d fail to meet the needs of someone who wanted to count things"><a href="#t1517438476000283" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-31</span> <span class="t" onclick="H(this)">22:41:16</span>                 mikerod </span><span>I’ve had quite a few of those before. So if you “removed the duplicates” you’d fail to meet the needs of someone who wanted to count things</span></div><div id="t1517438483000447" t="2018-01-31 22:41:23 mikerod For whatever purpose"><a href="#t1517438483000447" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-31</span> <span class="t" onclick="H(this)">22:41:23</span>                 mikerod </span><span>For whatever purpose</span></div><div id="t1517438521000344" t="2018-01-31 22:42:01 mikerod In Drools (popular Java-based rules engine), they went with “logical inserts” never are duplicated, but “unconditional inserts” are duplicated if they are not  identical?"><a href="#t1517438521000344" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-31</span> <span class="t" onclick="H(this)">22:42:01</span>                 mikerod </span><span>In Drools (popular Java-based rules engine), they went with “logical inserts” never are duplicated, but “unconditional inserts” are duplicated if they are not </span><code>identical?</code></div><div id="t1517438535000267" t="2018-01-31 22:42:15 mikerod It was nice, when you really just didn’t want duplicates, but difficult to work with when you did"><a href="#t1517438535000267" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-31</span> <span class="t" onclick="H(this)">22:42:15</span>                 mikerod </span><span>It was nice, when you really just didn’t want duplicates, but difficult to work with when you did</span></div><div id="t1517438554000006" t="2018-01-31 22:42:34 mikerod In Clara, if you need some “single count” fact in the end, you can just use an aggregation sort of rule"><a href="#t1517438554000006" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-31</span> <span class="t" onclick="H(this)">22:42:34</span>                 mikerod </span><span>In Clara, if you need some “single count” fact in the end, you can just use an aggregation sort of rule</span></div><div id="t1517438737000093" t="2018-01-31 22:45:37 mikerod I do think it could be interesting if Clara had an options where it made working memory “set-like” and duplicates didn’t show up. There are definitely costs to doing this though."><a href="#t1517438737000093" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-31</span> <span class="t" onclick="H(this)">22:45:37</span>                 mikerod </span><span>I do think it could be interesting if Clara had an options where it made working memory “set-like” and duplicates didn’t show up. There are definitely costs to doing this though.</span></div><div id="t1517440717000066" t="2018-01-31 23:18:37 tcarls headscratch"><a href="#t1517440717000066" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-31</span> <span class="t" onclick="H(this)">23:18:37</span>                  tcarls </span><span>headscratch</span></div><div id="t1517441050000242" t="2018-01-31 23:24:10 tcarls {:lhs [{:type pdfsort.types.Warning, :constraints [], :fact-binding :?warning}], :params #{}, :name &quot;pdfsort.core/get-warnings&quot;} is invalid or not included in the rule base.
 

...seems to be happening consistently for me right now when invoking code from  lein run , but not when invoking the same functions from Emacs/Cider."><a href="#t1517441050000242" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-31</span> <span class="t" onclick="H(this)">23:24:10</span>                  tcarls </span><pre>{:lhs [{:type pdfsort.types.Warning, :constraints [], :fact-binding :?warning}], :params #{}, :name &quot;pdfsort.core/get-warnings&quot;} is invalid or not included in the rule base.
</pre><span>

...seems to be happening consistently for me right now when invoking code from </span><code>lein run</code><span>, but not when invoking the same functions from Emacs/Cider.</span></div><div id="t1517441598000307" t="2018-01-31 23:33:18 dadair @tcarls where is the  mk-session  you’re using (e.g., same ns as the rule? other ns?), and what does the function call look like?"><a href="#t1517441598000307" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-31</span> <span class="t" onclick="H(this)">23:33:18</span>                  dadair </span><span>@tcarls where is the </span><code>mk-session</code><span> you’re using (e.g., same ns as the rule? other ns?), and what does the function call look like?</span></div><div id="t1517441622000462" t="2018-01-31 23:33:42 dadair and can you post a snippet of the rule?"><a href="#t1517441622000462" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-01-31</span> <span class="t" onclick="H(this)">23:33:42</span>                  dadair </span><span>and can you post a snippet of the rule?</span></div><div id="t1517445022000194" t="2018-02-01 00:30:22 tcarls @dadair, same ns, called from the  -main  function with  :cache false . The  get-warnings  rule is basically as simple as the above implies -- it just retrieves every single record we have of type Warning with no filters/joins/etc:  (r/defquery get-warnings [] [?warning &lt;- Warning])"><a href="#t1517445022000194" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-01</span> <span class="t" onclick="H(this)">00:30:22</span>                  tcarls </span><span>@dadair, same ns, called from the </span><code>-main</code><span> function with </span><code>:cache false</code><span>. The </span><code>get-warnings</code><span> rule is basically as simple as the above implies -- it just retrieves every single record we have of type Warning with no filters/joins/etc: </span><code>(r/defquery get-warnings [] [?warning &lt;- Warning])</code></div><div id="t1517446096000386" t="2018-02-01 00:48:16 tcarls Hmm. Unrelated issue, but I have a theory on why I&apos;m getting more fact insertions than I expected. Looking through the  explain  output...
 {:ns-name pdfsort.core,
   :lhs
   [{:type pdfsort.types.Document,
     :constraints [(= ?type (or name-type header-type))],
     :fact-binding :?doc}],
   :rhs (do (r/insert! (-&gt;DocumentType ?doc ?type))),
   :name &quot;pdfsort.core/use-document-type&quot;}
 
I expected the  (or name-type header-type)  to mean that we bind the first non-falsey item of  name-type  or  header-type  to  ?type , but it looks like it actually results in both paths being followed. Changing it to  (if name-type name-type header-type)  results in the initially-expected behavior, of performing one DocumentType insertion per Document."><a href="#t1517446096000386" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-01</span> <span class="t" onclick="H(this)">00:48:16</span>                  tcarls </span><span>Hmm. Unrelated issue, but I have a theory on why I&apos;m getting more fact insertions than I expected. Looking through the </span><code>explain</code><span> output...
</span><pre>{:ns-name pdfsort.core,
   :lhs
   [{:type pdfsort.types.Document,
     :constraints [(= ?type (or name-type header-type))],
     :fact-binding :?doc}],
   :rhs (do (r/insert! (-&gt;DocumentType ?doc ?type))),
   :name &quot;pdfsort.core/use-document-type&quot;}
</pre><span>
I expected the </span><code>(or name-type header-type)</code><span> to mean that we bind the first non-falsey item of </span><code>name-type</code><span> or </span><code>header-type</code><span> to </span><code>?type</code><span>, but it looks like it actually results in both paths being followed. Changing it to </span><code>(if name-type name-type header-type)</code><span> results in the initially-expected behavior, of performing one DocumentType insertion per Document.</span></div><div id="t1517500205000146" t="2018-02-01 15:50:05 wparker @U2V9F98N8 I’d expect the or in the above rule to be short-circuiting i.e. just clojure.core/or.  Something like this is a Clara-specific non-short-circuiting or:  [:or [DocumentType1] [DocumentType2]]   but that doesn’t apply to the case you describe; note the keyword :or not the function invocation of “or”.  If you can create a reproducing case it would be helpful if you could log a GitHub issue - tbh I suspect something else is going on, but you never know"><a href="#t1517500205000146" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-01</span> <span class="t" onclick="H(this)">15:50:05</span>                      wparker </span><span>@U2V9F98N8 I’d expect the or in the above rule to be short-circuiting i.e. just clojure.core/or.  Something like this is a Clara-specific non-short-circuiting or: </span><pre>[:or [DocumentType1] [DocumentType2]] </pre><span> but that doesn’t apply to the case you describe; note the keyword :or not the function invocation of “or”.  If you can create a reproducing case it would be helpful if you could log a GitHub issue - tbh I suspect something else is going on, but you never know</span></div><div id="t1517606212000174" t="2018-02-02 21:16:52 mjmeintjes What&apos;s the best way to ensure that a fact doesn&apos;t get inserted twice. Is there a way to ensure that duplicate facts don&apos;t get inserted into the same session?"><a href="#t1517606212000174" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-02</span> <span class="t" onclick="H(this)">21:16:52</span>              mjmeintjes </span><span>What&apos;s the best way to ensure that a fact doesn&apos;t get inserted twice. Is there a way to ensure that duplicate facts don&apos;t get inserted into the same session?</span></div><div id="t1517607029000361" t="2018-02-02 21:30:29 mikerod @mjmeintjes I talked about this in a few posts above if you can see them?"><a href="#t1517607029000361" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-02</span> <span class="t" onclick="H(this)">21:30:29</span>                 mikerod </span><span>@mjmeintjes I talked about this in a few posts above if you can see them?</span></div><div id="t1517607052000341" t="2018-02-02 21:30:52 mikerod I discussed “cardinality” of equal facts in clara and ways to work with it"><a href="#t1517607052000341" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-02</span> <span class="t" onclick="H(this)">21:30:52</span>                 mikerod </span><span>I discussed “cardinality” of equal facts in clara and ways to work with it</span></div><div id="t1517607056000261" t="2018-02-02 21:30:56 mikerod and tradeoffs etc"><a href="#t1517607056000261" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-02</span> <span class="t" onclick="H(this)">21:30:56</span>                 mikerod </span><span>and tradeoffs etc</span></div><div id="t1517607639000358" t="2018-02-02 21:40:39 mjmeintjes Thanks for the information. I was thinking more about how to efficiently update the session - for example, I have a list of rows from the database. Before firing the rules I need to make sure that all the db rows are included in the session. However, I do not want all the rules to be inserted each time (which causes lots of duplicates), and I also don&apos;t want the session to be recreated each time. What I&apos;ve done now is create a query to retrieve the already inserted rules from the session, and then I&apos;m comparing that against the db rows, and then I only insert the new ones. I was just wondering whether that is the best solution."><a href="#t1517607639000358" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-02</span> <span class="t" onclick="H(this)">21:40:39</span>              mjmeintjes </span><span>Thanks for the information. I was thinking more about how to efficiently update the session - for example, I have a list of rows from the database. Before firing the rules I need to make sure that all the db rows are included in the session. However, I do not want all the rules to be inserted each time (which causes lots of duplicates), and I also don&apos;t want the session to be recreated each time. What I&apos;ve done now is create a query to retrieve the already inserted rules from the session, and then I&apos;m comparing that against the db rows, and then I only insert the new ones. I was just wondering whether that is the best solution.</span></div><div id="t1517607958000178" t="2018-02-02 21:45:58 mikerod @mjmeintjes I think that is a fine way to do it. I think there may be a potential enhancement to clara to do something like an “update” of facts and/or a “mode” that had the working memory act in a set-based way there weren’t duplicates. For now though, the external query idea is good if it can work for you"><a href="#t1517607958000178" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-02</span> <span class="t" onclick="H(this)">21:45:58</span>                 mikerod </span><span>@mjmeintjes I think that is a fine way to do it. I think there may be a potential enhancement to clara to do something like an “update” of facts and/or a “mode” that had the working memory act in a set-based way there weren’t duplicates. For now though, the external query idea is good if it can work for you</span></div><div id="t1517608108000031" t="2018-02-02 21:48:28 mjmeintjes Yeah, being able to efficiently update the session would be great, as each time I&apos;ve used Clara that&apos;s something that I&apos;ve run up against. The only problem with the query approach is that queries are only updated once  fire-rules  has run, which means you can still get duplicates if you aren&apos;t careful to run  fire-rules  before inserting any new data."><a href="#t1517608108000031" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-02</span> <span class="t" onclick="H(this)">21:48:28</span>              mjmeintjes </span><span>Yeah, being able to efficiently update the session would be great, as each time I&apos;ve used Clara that&apos;s something that I&apos;ve run up against. The only problem with the query approach is that queries are only updated once </span><code>fire-rules</code><span> has run, which means you can still get duplicates if you aren&apos;t careful to run </span><code>fire-rules</code><span> before inserting any new data.</span></div><div id="t1517608346000400" t="2018-02-02 21:52:26 mikerod @mjmeintjes Yeah, you should never query prior to  fire-rules . I’d call that an “undefined” state"><a href="#t1517608346000400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-02</span> <span class="t" onclick="H(this)">21:52:26</span>                 mikerod </span><span>@mjmeintjes Yeah, you should never query prior to </span><code>fire-rules</code><span>. I’d call that an “undefined” state</span></div><div id="t1517608375000241" t="2018-02-02 21:52:55 mikerod Clara does some “lazy” sort of batching that isn’t forced until  fire-rules . It can do some good optimizations with this and could even get more “lazy” in the future I’d think."><a href="#t1517608375000241" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-02</span> <span class="t" onclick="H(this)">21:52:55</span>                 mikerod </span><span>Clara does some “lazy” sort of batching that isn’t forced until </span><code>fire-rules</code><span>. It can do some good optimizations with this and could even get more “lazy” in the future I’d think.</span></div><div id="t1517608411000492" t="2018-02-02 21:53:31 mikerod I think it can be difficult to do “logical updates” to facts with what Clara currently offers"><a href="#t1517608411000492" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-02</span> <span class="t" onclick="H(this)">21:53:31</span>                 mikerod </span><span>I think it can be difficult to do “logical updates” to facts with what Clara currently offers</span></div><div id="t1517608466000118" t="2018-02-02 21:54:26 mikerod it relies basically entirely on the caller to query facts and figure out what inserts/retracts to make externally. That is if the rules are going to be written in a way that can smoothly work with the truth maintenance system and logical inserts (ie not  insert-unconditional!  and right-hand-side based  retract! )."><a href="#t1517608466000118" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-02</span> <span class="t" onclick="H(this)">21:54:26</span>                 mikerod </span><span>it relies basically entirely on the caller to query facts and figure out what inserts/retracts to make externally. That is if the rules are going to be written in a way that can smoothly work with the truth maintenance system and logical inserts (ie not </span><code>insert-unconditional!</code><span> and right-hand-side based </span><code>retract!</code><span>).</span></div><div id="t1517608476000531" t="2018-02-02 21:54:36 mikerod These sort of discussions have came up quite a bit here lately."><a href="#t1517608476000531" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-02</span> <span class="t" onclick="H(this)">21:54:36</span>                 mikerod </span><span>These sort of discussions have came up quite a bit here lately.</span></div><div id="t1517608509000107" t="2018-02-02 21:55:09 mikerod I wrote this a while back  http://www.metasimple.org/2017/12/23/clara-updating-facts.html 
Not sure if it is really useful to you. You seem to already have a setup you’ve been using to do your de-duping anyways"><a href="#t1517608509000107" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-02</span> <span class="t" onclick="H(this)">21:55:09</span>                 mikerod </span><span>I wrote this a while back </span><a href="http://www.metasimple.org/2017/12/23/clara-updating-facts.html" target="_blank">http://www.metasimple.org/2017/12/23/clara-updating-facts.html</a><span>
Not sure if it is really useful to you. You seem to already have a setup you’ve been using to do your de-duping anyways</span></div><div id="t1517608560000532" t="2018-02-02 21:56:00 mjmeintjes Thanks for that post, I&apos;ll have a read. Love reading information about Clara, as it is such a great programming model. Always trying to find places to use it."><a href="#t1517608560000532" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-02</span> <span class="t" onclick="H(this)">21:56:00</span>              mjmeintjes </span><span>Thanks for that post, I&apos;ll have a read. Love reading information about Clara, as it is such a great programming model. Always trying to find places to use it.</span></div><div id="t1517608643000102" t="2018-02-02 21:57:23 mikerod Well that’s good."><a href="#t1517608643000102" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-02</span> <span class="t" onclick="H(this)">21:57:23</span>                 mikerod </span><span>Well that’s good.</span></div><div id="t1517608673000240" t="2018-02-02 21:57:53 mikerod Yeah, I’d like to try out some ideas to deal with these sorts of things. I think some sort of rule-triggered “update” would be interesting."><a href="#t1517608673000240" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-02</span> <span class="t" onclick="H(this)">21:57:53</span>                 mikerod </span><span>Yeah, I’d like to try out some ideas to deal with these sorts of things. I think some sort of rule-triggered “update” would be interesting.</span></div><div id="t1517608685000082" t="2018-02-02 21:58:05 mikerod As well as externally specified updates"><a href="#t1517608685000082" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-02</span> <span class="t" onclick="H(this)">21:58:05</span>                 mikerod </span><span>As well as externally specified updates</span></div><div id="t1517608716000332" t="2018-02-02 21:58:36 mikerod The challenge would be to do so in a way that interacted in a well-defined way with the truth maintenance system and logically inserted/retracted facts."><a href="#t1517608716000332" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-02</span> <span class="t" onclick="H(this)">21:58:36</span>                 mikerod </span><span>The challenge would be to do so in a way that interacted in a well-defined way with the truth maintenance system and logically inserted/retracted facts.</span></div><div id="t1517610296000319" t="2018-02-02 22:24:56 mjmeintjes Thanks, useful post, helped clarify/validate the approach I&apos;m taking."><a href="#t1517610296000319" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-02</span> <span class="t" onclick="H(this)">22:24:56</span>              mjmeintjes </span><span>Thanks, useful post, helped clarify/validate the approach I&apos;m taking.</span></div><div id="t1517610308000220" t="2018-02-02 22:25:08 mikerod Oh, good"><a href="#t1517610308000220" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-02</span> <span class="t" onclick="H(this)">22:25:08</span>                 mikerod </span><span>Oh, good</span></div><div id="t1517803134000124" t="2018-02-05 03:58:54 cfleming BTW Cursive 1.6.3-eap3 is out now, which contains support for Clara! Many thanks to @mikerod and @alex-dixon for help with that. I’m interested in any feedback, as always, either here or over in #cursive."><a href="#t1517803134000124" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-05</span> <span class="t" onclick="H(this)">03:58:54</span>                cfleming </span><span>BTW Cursive 1.6.3-eap3 is out now, which contains support for Clara! Many thanks to @mikerod and @alex-dixon for help with that. I’m interested in any feedback, as always, either here or over in #cursive.</span></div><div id="t1517828036000330" t="2018-02-05 10:53:56 urzds Hi!"><a href="#t1517828036000330" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-05</span> <span class="t" onclick="H(this)">10:53:56</span>                   urzds </span><span>Hi!</span></div><div id="t1517882871000293" t="2018-02-06 02:07:51 sparkofreason Is there any documentation of the  :exists  feature? I saw some discussion about it on google groups and maybe in an issue, but haven&apos;t found much else."><a href="#t1517882871000293" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-06</span> <span class="t" onclick="H(this)">02:07:51</span>           sparkofreason </span><span>Is there any documentation of the </span><code>:exists</code><span> feature? I saw some discussion about it on google groups and maybe in an issue, but haven&apos;t found much else.</span></div><div id="t1517929360000694" t="2018-02-06 15:02:40 mikerod @dave.dixon not sure if there are any docs on it"><a href="#t1517929360000694" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-06</span> <span class="t" onclick="H(this)">15:02:40</span>                 mikerod </span><span>@dave.dixon not sure if there are any docs on it</span></div><div id="t1517929365000113" t="2018-02-06 15:02:45 mikerod https://github.com/cerner/clara-rules/issues/130  has some discussion"><a href="#t1517929365000113" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-06</span> <span class="t" onclick="H(this)">15:02:45</span>                 mikerod </span><a href="https://github.com/cerner/clara-rules/issues/130" target="_blank">https://github.com/cerner/clara-rules/issues/130</a><span> has some discussion</span></div><div id="t1517929392000283" t="2018-02-06 15:03:12 mikerod that’s the best I’ve found as far as docs on it"><a href="#t1517929392000283" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-06</span> <span class="t" onclick="H(this)">15:03:12</span>                 mikerod </span><span>that’s the best I’ve found as far as docs on it</span></div><div id="t1517929407000857" t="2018-02-06 15:03:27 mikerod (didn’t do an exhaustive search)"><a href="#t1517929407000857" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-06</span> <span class="t" onclick="H(this)">15:03:27</span>                 mikerod </span><span>(didn’t do an exhaustive search)</span></div><div id="t1517929955000126" t="2018-02-06 15:12:35 wparker @dave.dixon I don’t see any docs on it based on a search for “exists” in the clara-site repo.  Having doc would be desirable.  In the meantime it is really a pretty form of syntax sugar - you can just mentally make the substitution the compiler does at  https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/rules/compiler.clj#L618  if you’re trying to understand the behavior"><a href="#t1517929955000126" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-06</span> <span class="t" onclick="H(this)">15:12:35</span>                 wparker </span><span>@dave.dixon I don’t see any docs on it based on a search for “exists” in the clara-site repo.  Having doc would be desirable.  In the meantime it is really a pretty form of syntax sugar - you can just mentally make the substitution the compiler does at </span><a href="https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/rules/compiler.clj#L618" target="_blank">https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/rules/compiler.clj#L618</a><span> if you’re trying to understand the behavior</span></div><div id="t1517931709000792" t="2018-02-06 15:41:49 sparkofreason @wparker Thanks. So looking at that,  [:not [:exists ...]]  should work as expected, i.e. that &quot;no fact satisfying the conditions exists&quot; as opposed to &quot;maybe some fact exists that doesn&apos;t satisfy the conditions&quot;?"><a href="#t1517931709000792" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-06</span> <span class="t" onclick="H(this)">15:41:49</span>           sparkofreason </span><span>@wparker Thanks. So looking at that, </span><code>[:not [:exists ...]]</code><span> should work as expected, i.e. that &quot;no fact satisfying the conditions exists&quot; as opposed to &quot;maybe some fact exists that doesn&apos;t satisfy the conditions&quot;?</span></div><div id="t1517931816000584" t="2018-02-06 15:43:36 wparker Unfortunately not at the moment; see  https://github.com/cerner/clara-rules/issues/329"><a href="#t1517931816000584" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-06</span> <span class="t" onclick="H(this)">15:43:36</span>                 wparker </span><span>Unfortunately not at the moment; see </span><a href="https://github.com/cerner/clara-rules/issues/329" target="_blank">https://github.com/cerner/clara-rules/issues/329</a></div><div id="t1517931851000849" t="2018-02-06 15:44:11 wparker In the case of :not :exists there isn’t much reason to write it like that though, as I mentioned on the issue"><a href="#t1517931851000849" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-06</span> <span class="t" onclick="H(this)">15:44:11</span>                 wparker </span><span>In the case of :not :exists there isn’t much reason to write it like that though, as I mentioned on the issue</span></div><div id="t1517931883000257" t="2018-02-06 15:44:43 sparkofreason Ah. Okay, I thought maybe I was just writing the expression, wrong. I&apos;ll take a look at the discussion."><a href="#t1517931883000257" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-06</span> <span class="t" onclick="H(this)">15:44:43</span>           sparkofreason </span><span>Ah. Okay, I thought maybe I was just writing the expression, wrong. I&apos;ll take a look at the discussion.</span></div><div id="t1517931887000940" t="2018-02-06 15:44:47 wparker as a general API concern, it is something that seems like it should work.. but haven’t gotten around to fixing it"><a href="#t1517931887000940" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-06</span> <span class="t" onclick="H(this)">15:44:47</span>                 wparker </span><span>as a general API concern, it is something that seems like it should work.. but haven’t gotten around to fixing it</span></div><div id="t1517935253000418" t="2018-02-06 16:40:53 sparkofreason It does seem to work. I was having some issues and thought this may be the culprit, but it was other things (which had nothing to do with clara per se). I was a little suspicious of that binding inside the negation as well, but is seems to operate as intended, i.e. &quot;There is no Request fact equal to the Request entry on the Response fact&quot;."><a href="#t1517935253000418" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-06</span> <span class="t" onclick="H(this)">16:40:53</span>           sparkofreason </span><span>It does seem to work. I was having some issues and thought this may be the culprit, but it was other things (which had nothing to do with clara per se). I was a little suspicious of that binding inside the negation as well, but is seems to operate as intended, i.e. &quot;There is no Request fact equal to the Request entry on the Response fact&quot;.</span></div><div id="t1517953564000584" t="2018-02-06 21:46:04 sparkofreason It looks like the current behavior of parameterized queries is to just return an empty seq if all of the arguments are not bound in the call to  query . It would be useful sometimes if leaving out a parameter just treated it as unbound, though I think you could only get away with this when the parameters are used in simple equality constraints, e.g.  [?:foo] [Foo (= ?foo foo)] . I can get this behavior by wrapping  query , but was wondering if there was a way to achieve it directly in clara."><a href="#t1517953564000584" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-06</span> <span class="t" onclick="H(this)">21:46:04</span>           sparkofreason </span><span>It looks like the current behavior of parameterized queries is to just return an empty seq if all of the arguments are not bound in the call to </span><code>query</code><span>. It would be useful sometimes if leaving out a parameter just treated it as unbound, though I think you could only get away with this when the parameters are used in simple equality constraints, e.g. </span><code>[?:foo] [Foo (= ?foo foo)]</code><span>. I can get this behavior by wrapping </span><code>query</code><span>, but was wondering if there was a way to achieve it directly in clara.</span></div><div id="t1518022555000862" t="2018-02-07 16:55:55 wparker @dave.dixon the query params are defined at query creation time and then used to key the results for the query in a map.  This results in the actual call to “query” basically just being a map lookup.  If arbitrary keys could be missing, I don’t think you could look things up that way without creating a lookup table for every possible permutation of absent and present bindings during fire-rules time, which could become costly.  Looking at the code it seems perhaps we could add logic allowing the user to either pass all present params or none, providing all results regardless of bindings in the later case.  Relevant code sections:  https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/rules/engine.cljc#L1959  for the query implementation in the engine, note the mem/get-tokens call.  In QueryNode note the memory calls as well:  https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/rules/engine.cljc#L431  with the join-bindings coming from the param-keys via this:  https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/rules/engine.cljc#L149   Then see get-tokens and get-tokens-all:  https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/rules/memory.cljc#L451  ; get-tokens-all would ignore the bindings"><a href="#t1518022555000862" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-07</span> <span class="t" onclick="H(this)">16:55:55</span>                 wparker </span><span>@dave.dixon the query params are defined at query creation time and then used to key the results for the query in a map.  This results in the actual call to “query” basically just being a map lookup.  If arbitrary keys could be missing, I don’t think you could look things up that way without creating a lookup table for every possible permutation of absent and present bindings during fire-rules time, which could become costly.  Looking at the code it seems perhaps we could add logic allowing the user to either pass all present params or none, providing all results regardless of bindings in the later case.  Relevant code sections: </span><a href="https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/rules/engine.cljc#L1959" target="_blank">https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/rules/engine.cljc#L1959</a><span> for the query implementation in the engine, note the mem/get-tokens call.  In QueryNode note the memory calls as well: </span><a href="https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/rules/engine.cljc#L431" target="_blank">https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/rules/engine.cljc#L431</a><span> with the join-bindings coming from the param-keys via this: </span><a href="https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/rules/engine.cljc#L149" target="_blank">https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/rules/engine.cljc#L149</a><span>  Then see get-tokens and get-tokens-all: </span><a href="https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/rules/memory.cljc#L451" target="_blank">https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/rules/memory.cljc#L451</a><span> ; get-tokens-all would ignore the bindings</span></div><div id="t1518026729000447" t="2018-02-07 18:05:29 sparkofreason @wparker Thanks, good insight on working memory. It looks like the  inspect  function illustrates how to get at the bindings via  get-tokens-all ."><a href="#t1518026729000447" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-07</span> <span class="t" onclick="H(this)">18:05:29</span>           sparkofreason </span><span>@wparker Thanks, good insight on working memory. It looks like the </span><code>inspect</code><span> function illustrates how to get at the bindings via </span><code>get-tokens-all</code><span>.</span></div><div id="t1518100499000689" t="2018-02-08 14:34:59 alex-dixon Anyone tried the new Cursive yet?"><a href="#t1518100499000689" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-08</span> <span class="t" onclick="H(this)">14:34:59</span>              alex-dixon </span><span>Anyone tried the new Cursive yet?</span></div><div id="t1518101766000694" t="2018-02-08 14:56:06 zylox ive been using it"><a href="#t1518101766000694" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-08</span> <span class="t" onclick="H(this)">14:56:06</span>                   zylox </span><span>ive been using it</span></div><div id="t1518101791000828" t="2018-02-08 14:56:31 zylox though i havent had tooo much time to actually code in it"><a href="#t1518101791000828" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-08</span> <span class="t" onclick="H(this)">14:56:31</span>                   zylox </span><span>though i havent had tooo much time to actually code in it</span></div><div id="t1518102223000787" t="2018-02-08 15:03:43 zylox but it works"><a href="#t1518102223000787" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-08</span> <span class="t" onclick="H(this)">15:03:43</span>                   zylox </span><span>but it works</span></div><div id="t1518102418000360" t="2018-02-08 15:06:58 alex-dixon Awesome. Think it might be available in non-eap now. Haven’t tried yet"><a href="#t1518102418000360" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-08</span> <span class="t" onclick="H(this)">15:06:58</span>              alex-dixon </span><span>Awesome. Think it might be available in non-eap now. Haven’t tried yet</span></div><div id="t1518102519000688" t="2018-02-08 15:08:39 zylox ah, ya im still on eap"><a href="#t1518102519000688" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-08</span> <span class="t" onclick="H(this)">15:08:39</span>                   zylox </span><span>ah, ya im still on eap</span></div><div id="t1518113398000024" t="2018-02-08 18:09:58 cfleming @alex-dixon Yes, 1.6.3 went out yesterday."><a href="#t1518113398000024" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-08</span> <span class="t" onclick="H(this)">18:09:58</span>                cfleming </span><span>@alex-dixon Yes, 1.6.3 went out yesterday.</span></div><div id="t1518452167000534" t="2018-02-12 16:16:07 yyoncho Here is simplified example of what I am trying to accomplish:

I have fact FnHolder which contains how the Temperature facts will be compared/processed. I want to have a rule which produces another fact from the FnHolder and the Temperature but it doesn&apos;t trigger the depending rules when a new Temperature which doesn&apos;t change the produced value(thus I cannot do the accumulation in  the body). This behavior is similar to acc/max which does not trigger if a non-maximal Temperature is inserted. Ideally I would have been able to write the following code but it doesn&apos;t run since ?fn is not visible in the custom-accum block. Can you advice?

 code 
(defrecord Temperature [location temperature])
(defrecord FnHolder [location other-params])

(defrule chaning
  [?fn &lt;- FnHolder  (= location ?loc)]
  [?t &lt;- (custom-accum ?fn) :from [Temperature]]
  =&gt;
  ;; insert facts...
)
 code"><a href="#t1518452167000534" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-12</span> <span class="t" onclick="H(this)">16:16:07</span>                 yyoncho </span><span>Here is simplified example of what I am trying to accomplish:

I have fact FnHolder which contains how the Temperature facts will be compared/processed. I want to have a rule which produces another fact from the FnHolder and the Temperature but it doesn&apos;t trigger the depending rules when a new Temperature which doesn&apos;t change the produced value(thus I cannot do the accumulation in  the body). This behavior is similar to acc/max which does not trigger if a non-maximal Temperature is inserted. Ideally I would have been able to write the following code but it doesn&apos;t run since ?fn is not visible in the custom-accum block. Can you advice?

</span><code>code</code><span>
(defrecord Temperature [location temperature])
(defrecord FnHolder [location other-params])

(defrule chaning
  [?fn &lt;- FnHolder  (= location ?loc)]
  [?t &lt;- (custom-accum ?fn) :from [Temperature]]
  =&gt;
  ;; insert facts...
)
</span><code>code</code></div><div id="t1518458007000219" t="2018-02-12 17:53:27 mikerod @yyoncho I don’t have an immediate complete answer to that question, but perhaps you could accomplish what you are wanting with a  :test  condition after the accumulation. Accumulate with something that doesn’t need to be “parameterized”."><a href="#t1518458007000219" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-12</span> <span class="t" onclick="H(this)">17:53:27</span>                 mikerod </span><span>@yyoncho I don’t have an immediate complete answer to that question, but perhaps you could accomplish what you are wanting with a </span><code>:test</code><span> condition after the accumulation. Accumulate with something that doesn’t need to be “parameterized”.</span></div><div id="t1518458055000397" t="2018-02-12 17:54:15 mikerod Another possibility is to use a sort of joined fact. I’m not sure how appropriate it will be for you, but it would look like:"><a href="#t1518458055000397" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-12</span> <span class="t" onclick="H(this)">17:54:15</span>                 mikerod </span><span>Another possibility is to use a sort of joined fact. I’m not sure how appropriate it will be for you, but it would look like:</span></div><div id="t1518458154000055" t="2018-02-12 17:55:54 mikerod (defrecord Temperature [location temperature])
(defrecord FnHolder [location other-params])
(defrecord TempWithFn [temp fn-holder])

(defrule combine
  [?fn &lt;- FnHolder  (= location ?loc)]
  [?t &lt;- Temperature]
  =&gt;
  (insert (-&gt;TempWithFn ?t ?fn)))

(defrule chaning
  [?t &lt;- (custom-accum :fn-holder) :from [TempWithFn]]
  =&gt;
  ;; insert facts...
)
"><a href="#t1518458154000055" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-12</span> <span class="t" onclick="H(this)">17:55:54</span>                 mikerod </span><pre>(defrecord Temperature [location temperature])
(defrecord FnHolder [location other-params])
(defrecord TempWithFn [temp fn-holder])

(defrule combine
  [?fn &lt;- FnHolder  (= location ?loc)]
  [?t &lt;- Temperature]
  =&gt;
  (insert (-&gt;TempWithFn ?t ?fn)))

(defrule chaning
  [?t &lt;- (custom-accum :fn-holder) :from [TempWithFn]]
  =&gt;
  ;; insert facts...
)
</pre></div><div id="t1518458195000549" t="2018-02-12 17:56:35 mikerod I think the  custom-accum  doesn’t really need the  :fn-holder  key anymore though. it has the whole fact with all that info on it."><a href="#t1518458195000549" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-12</span> <span class="t" onclick="H(this)">17:56:35</span>                 mikerod </span><span>I think the </span><code>custom-accum</code><span> doesn’t really need the </span><code>:fn-holder</code><span> key anymore though. it has the whole fact with all that info on it.</span></div><div id="t1518506155000253" t="2018-02-13 07:15:55 yyoncho @mikerod if I do that I will be able to process the Temperature facts one by one in FnHolder which won&apos;t work since FnHolder is stateful processing over the whole collection of Temperature facts, e. g. find the max Temperature for particular day of the week."><a href="#t1518506155000253" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-13</span> <span class="t" onclick="H(this)">07:15:55</span>                 yyoncho </span><span>@mikerod if I do that I will be able to process the Temperature facts one by one in FnHolder which won&apos;t work since FnHolder is stateful processing over the whole collection of Temperature facts, e. g. find the max Temperature for particular day of the week.</span></div><div id="t1519080208000001" t="2018-02-19 22:43:28 souenzzo 48260  facts is something that I can call &quot;huge&quot;? Or there is other problem on my rules?"><a href="#t1519080208000001" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-19</span> <span class="t" onclick="H(this)">22:43:28</span>                souenzzo </span><code>48260</code><span> facts is something that I can call &quot;huge&quot;? Or there is other problem on my rules?</span></div><div id="t1519080265000096" t="2018-02-19 22:44:25 souenzzo (my application hangs/out-of-memory/stranges exceptions on fire-rules)"><a href="#t1519080265000096" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-19</span> <span class="t" onclick="H(this)">22:44:25</span>                souenzzo </span><span>(my application hangs/out-of-memory/stranges exceptions on fire-rules)</span></div><div id="t1519086231000150" t="2018-02-20 00:23:51 mikerod @souenzzo I wouldn’t normally expect that number of facts to be much of a problem"><a href="#t1519086231000150" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-20</span> <span class="t" onclick="H(this)">00:23:51</span>                 mikerod </span><span>@souenzzo I wouldn’t normally expect that number of facts to be much of a problem</span></div><div id="t1519086246000091" t="2018-02-20 00:24:06 mikerod however, you can certainly write rules in a way that cause a problem (for smaller numbers even)"><a href="#t1519086246000091" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-20</span> <span class="t" onclick="H(this)">00:24:06</span>                 mikerod </span><span>however, you can certainly write rules in a way that cause a problem (for smaller numbers even)</span></div><div id="t1519141142000785" t="2018-02-20 15:39:02 wparker @souenzzo what do you mean by “strange exceptions”?  In terms of number of facts, the only real limit in Clara should be the memory available.. but of course if you have problematic rules (not necessarily incorrectly written, just poorly performing) you can run into problems.  If you can find a reproducing case that seems like it performs more poorly than it should feel free to log an issue.  We’ve mostly optimized Clara against the examples we have at Cerner but representative benchmarks of other workloads could be interesting/useful."><a href="#t1519141142000785" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-20</span> <span class="t" onclick="H(this)">15:39:02</span>                 wparker </span><span>@souenzzo what do you mean by “strange exceptions”?  In terms of number of facts, the only real limit in Clara should be the memory available.. but of course if you have problematic rules (not necessarily incorrectly written, just poorly performing) you can run into problems.  If you can find a reproducing case that seems like it performs more poorly than it should feel free to log an issue.  We’ve mostly optimized Clara against the examples we have at Cerner but representative benchmarks of other workloads could be interesting/useful.</span></div><div id="t1519825896000604" t="2018-02-28 13:51:36 wdullaer I&apos;m doing some stress testing of clara and i&apos;m seeing some weird behaviour"><a href="#t1519825896000604" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-28</span> <span class="t" onclick="H(this)">13:51:36</span>                wdullaer </span><span>I&apos;m doing some stress testing of clara and i&apos;m seeing some weird behaviour</span></div><div id="t1519825917000427" t="2018-02-28 13:51:57 wdullaer the background is that I want to build a sort of access control engine"><a href="#t1519825917000427" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-28</span> <span class="t" onclick="H(this)">13:51:57</span>                wdullaer </span><span>the background is that I want to build a sort of access control engine</span></div><div id="t1519825951000296" t="2018-02-28 13:52:31 wdullaer there are 3 fact types: a consent, a processor and a processingallowed fact"><a href="#t1519825951000296" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-28</span> <span class="t" onclick="H(this)">13:52:31</span>                wdullaer </span><span>there are 3 fact types: a consent, a processor and a processingallowed fact</span></div><div id="t1519825973000516" t="2018-02-28 13:52:53 wdullaer there&apos;s just one rule which inserts processingallowed if there is sufficient amount of concent for a given processor"><a href="#t1519825973000516" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-28</span> <span class="t" onclick="H(this)">13:52:53</span>                wdullaer </span><span>there&apos;s just one rule which inserts processingallowed if there is sufficient amount of concent for a given processor</span></div><div id="t1519826004000666" t="2018-02-28 13:53:24 wdullaer when I insert 1 million random consents, firing the rules takes just a few seconds"><a href="#t1519826004000666" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-28</span> <span class="t" onclick="H(this)">13:53:24</span>                wdullaer </span><span>when I insert 1 million random consents, firing the rules takes just a few seconds</span></div><div id="t1519826027000085" t="2018-02-28 13:53:47 wdullaer if I insert 1 million more into the previous session, firing the rules takes over an hour (I never waiting long enough for it to complete)"><a href="#t1519826027000085" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-28</span> <span class="t" onclick="H(this)">13:53:47</span>                wdullaer </span><span>if I insert 1 million more into the previous session, firing the rules takes over an hour (I never waiting long enough for it to complete)</span></div><div id="t1519826048000019" t="2018-02-28 13:54:08 wdullaer if I insert 2 million random consents in an empty session, firing the rules still only takes a few seconds"><a href="#t1519826048000019" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-28</span> <span class="t" onclick="H(this)">13:54:08</span>                wdullaer </span><span>if I insert 2 million random consents in an empty session, firing the rules still only takes a few seconds</span></div><div id="t1519826182000331" t="2018-02-28 13:56:22 wdullaer while this isn&apos;t a truly realistic scenario (updates to consent would arrive in batches of a few 100 once initialised), I&apos;m still kind of surprised by this behaviour"><a href="#t1519826182000331" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-28</span> <span class="t" onclick="H(this)">13:56:22</span>                wdullaer </span><span>while this isn&apos;t a truly realistic scenario (updates to consent would arrive in batches of a few 100 once initialised), I&apos;m still kind of surprised by this behaviour</span></div><div id="t1519829836000004" t="2018-02-28 14:57:16 mikerod @wdullaer that is interesting. it would seem that the insert 1 mil then 1 mil later is triggering some heavy “retraction” work"><a href="#t1519829836000004" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-28</span> <span class="t" onclick="H(this)">14:57:16</span>                 mikerod </span><span>@wdullaer that is interesting. it would seem that the insert 1 mil then 1 mil later is triggering some heavy “retraction” work</span></div><div id="t1519829858000250" t="2018-02-28 14:57:38 mikerod However, with that sort of time being taken up, it’d be good to have some profiling"><a href="#t1519829858000250" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-28</span> <span class="t" onclick="H(this)">14:57:38</span>                 mikerod </span><span>However, with that sort of time being taken up, it’d be good to have some profiling</span></div><div id="t1519829891000106" t="2018-02-28 14:58:11 wdullaer there is no rule which retracts facts"><a href="#t1519829891000106" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-28</span> <span class="t" onclick="H(this)">14:58:11</span>                wdullaer </span><span>there is no rule which retracts facts</span></div><div id="t1519829899000296" t="2018-02-28 14:58:19 mikerod Unless you can reproduce it in a small case, which may not be easy.

I wonder if you could do some CPU sampling snapshot while it is running excessively via a tool like “visual vm” or similar"><a href="#t1519829899000296" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-28</span> <span class="t" onclick="H(this)">14:58:19</span>                 mikerod </span><span>Unless you can reproduce it in a small case, which may not be easy.

I wonder if you could do some CPU sampling snapshot while it is running excessively via a tool like “visual vm” or similar</span></div><div id="t1519829907000636" t="2018-02-28 14:58:27 wdullaer I haven&apos;t found a good way to do detailed profiling / tracing yet, so all suggestions are welcome  🙂"><a href="#t1519829907000636" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-28</span> <span class="t" onclick="H(this)">14:58:27</span>                wdullaer </span><span>I haven&apos;t found a good way to do detailed profiling / tracing yet, so all suggestions are welcome </span><b>🙂</b></div><div id="t1519829938000752" t="2018-02-28 14:58:58 mikerod Well, retracts can happen due to logical inserts (normal  insert!  in Clara). Also, accumulators may be updated and have to retract previous results. There are quite a few reasons to have “implicit” retracts happening in working memory"><a href="#t1519829938000752" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-28</span> <span class="t" onclick="H(this)">14:58:58</span>                 mikerod </span><span>Well, retracts can happen due to logical inserts (normal </span><code>insert!</code><span> in Clara). Also, accumulators may be updated and have to retract previous results. There are quite a few reasons to have “implicit” retracts happening in working memory</span></div><div id="t1519829960000137" t="2018-02-28 14:59:20 wdullaer make sense"><a href="#t1519829960000137" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-28</span> <span class="t" onclick="H(this)">14:59:20</span>                wdullaer </span><span>make sense</span></div><div id="t1519829971000143" t="2018-02-28 14:59:31 wdullaer I am using an  all  accumulator in the rule"><a href="#t1519829971000143" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-28</span> <span class="t" onclick="H(this)">14:59:31</span>                wdullaer </span><span>I am using an </span><code>all</code><span> accumulator in the rule</span></div><div id="t1519829978000071" t="2018-02-28 14:59:38 mikerod VisualVM is free. I’ve used it mostly just since it was good enough for seeing many things like this."><a href="#t1519829978000071" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-28</span> <span class="t" onclick="H(this)">14:59:38</span>                 mikerod </span><span>VisualVM is free. I’ve used it mostly just since it was good enough for seeing many things like this.</span></div><div id="t1519829991000242" t="2018-02-28 14:59:51 wdullaer but the funny thing is that it works just fine when doing 2 million in bulk on an empty session"><a href="#t1519829991000242" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-28</span> <span class="t" onclick="H(this)">14:59:51</span>                wdullaer </span><span>but the funny thing is that it works just fine when doing 2 million in bulk on an empty session</span></div><div id="t1519830000000537" t="2018-02-28 15:00:00 wdullaer I&apos;ll give that a spin"><a href="#t1519830000000537" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-28</span> <span class="t" onclick="H(this)">15:00:00</span>                wdullaer </span><span>I&apos;ll give that a spin</span></div><div id="t1519830007000907" t="2018-02-28 15:00:07 mikerod That isn’t entirely surprising to me - if you’ve found a bad retraction sort of scenario"><a href="#t1519830007000907" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-28</span> <span class="t" onclick="H(this)">15:00:07</span>                 mikerod </span><span>That isn’t entirely surprising to me - if you’ve found a bad retraction sort of scenario</span></div><div id="t1519830017000940" t="2018-02-28 15:00:17 mikerod In bulk, Clara does a lot of work in batches"><a href="#t1519830017000940" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-28</span> <span class="t" onclick="H(this)">15:00:17</span>                 mikerod </span><span>In bulk, Clara does a lot of work in batches</span></div><div id="t1519830043000334" t="2018-02-28 15:00:43 mikerod Which has one benefit of avoiding “rework” - aka retractions/insertions to update “incorrect” earlier working memory states"><a href="#t1519830043000334" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-28</span> <span class="t" onclick="H(this)">15:00:43</span>                 mikerod </span><span>Which has one benefit of avoiding “rework” - aka retractions/insertions to update “incorrect” earlier working memory states</span></div><div id="t1519830078000489" t="2018-02-28 15:01:18 wdullaer I&apos;m comparing 2 million in 1 go, vs 2 batches of 1 million"><a href="#t1519830078000489" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-28</span> <span class="t" onclick="H(this)">15:01:18</span>                wdullaer </span><span>I&apos;m comparing 2 million in 1 go, vs 2 batches of 1 million</span></div><div id="t1519830093000894" t="2018-02-28 15:01:33 wdullaer (I was expecting memory usage to be a bottleneck, but it&apos;s doing pretty fine on that front)"><a href="#t1519830093000894" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-28</span> <span class="t" onclick="H(this)">15:01:33</span>                wdullaer </span><span>(I was expecting memory usage to be a bottleneck, but it&apos;s doing pretty fine on that front)</span></div><div id="t1519830101000924" t="2018-02-28 15:01:41 wdullaer anyway, visualvm it is  🙂"><a href="#t1519830101000924" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-28</span> <span class="t" onclick="H(this)">15:01:41</span>                wdullaer </span><span>anyway, visualvm it is </span><b>🙂</b></div><div id="t1519830119000253" t="2018-02-28 15:01:59 mikerod So running with the VisualVM idea.
1) Download it, 2) open it, 3) find your JVM process (it has a list on in the UI) running the bad performance case with"><a href="#t1519830119000253" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-28</span> <span class="t" onclick="H(this)">15:01:59</span>                 mikerod </span><span>So running with the VisualVM idea.
1) Download it, 2) open it, 3) find your JVM process (it has a list on in the UI) running the bad performance case with</span></div><div id="t1519830165000077" t="2018-02-28 15:02:45 mikerod (4) click “Sampler” tab (5) click “CPU” (6) start running whatever is taking a long time"><a href="#t1519830165000077" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-28</span> <span class="t" onclick="H(this)">15:02:45</span>                 mikerod </span><span>(4) click “Sampler” tab (5) click “CPU” (6) start running whatever is taking a long time</span></div><div id="t1519830188000715" t="2018-02-28 15:03:08 mikerod (7) let it run for a bit, perhaps like a minute or so, then click “snapshot”"><a href="#t1519830188000715" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-28</span> <span class="t" onclick="H(this)">15:03:08</span>                 mikerod </span><span>(7) let it run for a bit, perhaps like a minute or so, then click “snapshot”</span></div><div id="t1519830219000700" t="2018-02-28 15:03:39 wdullaer :+1:"><a href="#t1519830219000700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-28</span> <span class="t" onclick="H(this)">15:03:39</span>                wdullaer </span><b>:+1:</b></div><div id="t1519830324000807" t="2018-02-28 15:05:24 mikerod Once you have a snapshot, you can dig around the callstack to see where the time is. 
If you want help with that, you can perhaps explain what is taking such a long time in the Clara functions of the callstack and perhaps I (or someone) will know enough by that.

Or you can you can “export to” via an icon in the UI and it’ll give you an nps file to share.

If you have proprietary stuff (I don’t think much proprietary info shows up in these though, but still.) you don’t want to show, you could try to just find good screenshots that cut the callstack down to just the Clara functions parts."><a href="#t1519830324000807" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-28</span> <span class="t" onclick="H(this)">15:05:24</span>                 mikerod </span><span>Once you have a snapshot, you can dig around the callstack to see where the time is. 
If you want help with that, you can perhaps explain what is taking such a long time in the Clara functions of the callstack and perhaps I (or someone) will know enough by that.

Or you can you can “export to” via an icon in the UI and it’ll give you an nps file to share.

If you have proprietary stuff (I don’t think much proprietary info shows up in these though, but still.) you don’t want to show, you could try to just find good screenshots that cut the callstack down to just the Clara functions parts.</span></div><div id="t1519830340000532" t="2018-02-28 15:05:40 wdullaer I have to run now, but I&apos;ll do the test later today and post back with the results"><a href="#t1519830340000532" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-28</span> <span class="t" onclick="H(this)">15:05:40</span>                wdullaer </span><span>I have to run now, but I&apos;ll do the test later today and post back with the results</span></div><div id="t1519830345000131" t="2018-02-28 15:05:45 wdullaer thanks a lot already!"><a href="#t1519830345000131" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-28</span> <span class="t" onclick="H(this)">15:05:45</span>                wdullaer </span><span>thanks a lot already!</span></div><div id="t1519830353000169" t="2018-02-28 15:05:53 mikerod It’s probably not a bad idea to get some familiarity with digging through some cpu sampling snapshot results though. Can definitely be useful for finding bottlenecks quickly"><a href="#t1519830353000169" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-28</span> <span class="t" onclick="H(this)">15:05:53</span>                 mikerod </span><span>It’s probably not a bad idea to get some familiarity with digging through some cpu sampling snapshot results though. Can definitely be useful for finding bottlenecks quickly</span></div><div id="t1519830359000779" t="2018-02-28 15:05:59 mikerod No problem"><a href="#t1519830359000779" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-28</span> <span class="t" onclick="H(this)">15:05:59</span>                 mikerod </span><span>No problem</span></div><div id="t1519834899000062" t="2018-02-28 16:21:39 wparker @wdullaer are you inserting the facts like this:  (-&gt; session (insert first-fact) .... (insert millionth-fact))   or like this:  (insert session [first-fact .. millionth-fact]   It seems odd to me that simply breaking a single batch into two would have such a huge performance impact - OTOH smaller batching could do it.  Arguably Clara should try to batch the first case together anyway, but it doesn’t.  See how facts are added into the “pending-operations” on insertion at  https://github.com/cerner/clara-rules/blob/0.17.0/src/main/clojure/clara/rules/engine.cljc#L1818  and removed from the queue in fire-rules at  https://github.com/cerner/clara-rules/blob/0.17.0/src/main/clojure/clara/rules/engine.cljc#L1870"><a href="#t1519834899000062" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-28</span> <span class="t" onclick="H(this)">16:21:39</span>                 wparker </span><span>@wdullaer are you inserting the facts like this: </span><pre>(-&gt; session (insert first-fact) .... (insert millionth-fact)) </pre><span> or like this: </span><pre>(insert session [first-fact .. millionth-fact] </pre><span> It seems odd to me that simply breaking a single batch into two would have such a huge performance impact - OTOH smaller batching could do it.  Arguably Clara should try to batch the first case together anyway, but it doesn’t.  See how facts are added into the “pending-operations” on insertion at </span><a href="https://github.com/cerner/clara-rules/blob/0.17.0/src/main/clojure/clara/rules/engine.cljc#L1818" target="_blank">https://github.com/cerner/clara-rules/blob/0.17.0/src/main/clojure/clara/rules/engine.cljc#L1818</a><span> and removed from the queue in fire-rules at </span><a href="https://github.com/cerner/clara-rules/blob/0.17.0/src/main/clojure/clara/rules/engine.cljc#L1870" target="_blank">https://github.com/cerner/clara-rules/blob/0.17.0/src/main/clojure/clara/rules/engine.cljc#L1870</a></div><div id="t1519835176000215" t="2018-02-28 16:26:16 wparker If a simple division into two batches really does increase runtime like that I’d be curious to see a reproducing case and if there is some performance optimization we could do - at first glance it doesn’t seem like it should happen, but as always it is hard to say without a concrete case.  On profiling, seconding mikerod’s suggestion of VisualVM.  Another possible route would be to look at the trace of the rule execution for a smaller number of facts - manual examination wouldn’t be practical for millions of facts, but a batch of 2 facts vs 2 batches of 1 fact each might show insights.  I’d probably start with VisualVM though especially since traces generally require some understanding of Clara’s internals to yield much insight.  https://github.com/cerner/clara-rules/blob/0.17.0/src/main/clojure/clara/tools/tracing.cljc"><a href="#t1519835176000215" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-28</span> <span class="t" onclick="H(this)">16:26:16</span>                 wparker </span><span>If a simple division into two batches really does increase runtime like that I’d be curious to see a reproducing case and if there is some performance optimization we could do - at first glance it doesn’t seem like it should happen, but as always it is hard to say without a concrete case.  On profiling, seconding mikerod’s suggestion of VisualVM.  Another possible route would be to look at the trace of the rule execution for a smaller number of facts - manual examination wouldn’t be practical for millions of facts, but a batch of 2 facts vs 2 batches of 1 fact each might show insights.  I’d probably start with VisualVM though especially since traces generally require some understanding of Clara’s internals to yield much insight. </span><a href="https://github.com/cerner/clara-rules/blob/0.17.0/src/main/clojure/clara/tools/tracing.cljc" target="_blank">https://github.com/cerner/clara-rules/blob/0.17.0/src/main/clojure/clara/tools/tracing.cljc</a></div><div id="t1519835520001022" t="2018-02-28 16:32:00 mikerod @wparker sounded like he had batches of 1 million. so not really “small” hah"><a href="#t1519835520001022" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-28</span> <span class="t" onclick="H(this)">16:32:00</span>                 mikerod </span><span>@wparker sounded like he had batches of 1 million. so not really “small” hah</span></div><div id="t1519835553000750" t="2018-02-28 16:32:33 mikerod however, I was thinking that the scenario was “insert 1 million, then fire”, later on, “insert 1 million, then fire”"><a href="#t1519835553000750" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-28</span> <span class="t" onclick="H(this)">16:32:33</span>                 mikerod </span><span>however, I was thinking that the scenario was “insert 1 million, then fire”, later on, “insert 1 million, then fire”</span></div><div id="t1519837807000493" t="2018-02-28 17:10:07 wdullaer that&apos;s exactly it"><a href="#t1519837807000493" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-28</span> <span class="t" onclick="H(this)">17:10:07</span>                     wdullaer </span><span>that&apos;s exactly it</span></div><div id="t1519835565000816" t="2018-02-28 16:32:45 mikerod Trying to reuse and old session state basically"><a href="#t1519835565000816" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-28</span> <span class="t" onclick="H(this)">16:32:45</span>                 mikerod </span><span>Trying to reuse and old session state basically</span></div><div id="t1519835588000429" t="2018-02-28 16:33:08 mikerod It certainly sounds like the batching behavior was critical to the performance of the scenario they were having."><a href="#t1519835588000429" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-28</span> <span class="t" onclick="H(this)">16:33:08</span>                 mikerod </span><span>It certainly sounds like the batching behavior was critical to the performance of the scenario they were having.</span></div><div id="t1519835640000166" t="2018-02-28 16:34:00 mikerod It seems that there is potentially found some bad performing case in terms of updating working memory state that this uncovered.
Also, I think I assumed this was on the JVM. Not sure if that was actually stated before. I’m guessing so with the millions of facts and the discussion around using visualvm"><a href="#t1519835640000166" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-28</span> <span class="t" onclick="H(this)">16:34:00</span>                 mikerod </span><span>It seems that there is potentially found some bad performing case in terms of updating working memory state that this uncovered.
Also, I think I assumed this was on the JVM. Not sure if that was actually stated before. I’m guessing so with the millions of facts and the discussion around using visualvm</span></div><div id="t1519835682000052" t="2018-02-28 16:34:42 wparker My point was that I think it would be possible to think the batch was a million, but actually end up being one at a time when rules fire, so just wanted to make sure that it was batched"><a href="#t1519835682000052" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-28</span> <span class="t" onclick="H(this)">16:34:42</span>                 wparker </span><span>My point was that I think it would be possible to think the batch was a million, but actually end up being one at a time when rules fire, so just wanted to make sure that it was batched</span></div><div id="t1519835693000299" t="2018-02-28 16:34:53 mikerod yeah, true"><a href="#t1519835693000299" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-28</span> <span class="t" onclick="H(this)">16:34:53</span>                 mikerod </span><span>yeah, true</span></div><div id="t1519835723000635" t="2018-02-28 16:35:23 wparker Perhaps Clara should probably take (-&gt; session (insert A) (insert B) fire-rules) and turn it into a single batch - but I think it is 2 at present"><a href="#t1519835723000635" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-28</span> <span class="t" onclick="H(this)">16:35:23</span>                 wparker </span><span>Perhaps Clara should probably take (-&gt; session (insert A) (insert B) fire-rules) and turn it into a single batch - but I think it is 2 at present</span></div><div id="t1519835744000137" t="2018-02-28 16:35:44 mikerod Yeah"><a href="#t1519835744000137" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-28</span> <span class="t" onclick="H(this)">16:35:44</span>                 mikerod </span><span>Yeah</span></div><div id="t1519835760000904" t="2018-02-28 16:36:00 mikerod If they were inserting a million things though, they probably did it in a single insert"><a href="#t1519835760000904" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-28</span> <span class="t" onclick="H(this)">16:36:00</span>                 mikerod </span><span>If they were inserting a million things though, they probably did it in a single insert</span></div><div id="t1519835774000841" t="2018-02-28 16:36:14 mikerod otherwise they’d have to do something like  (reduce insert session million-things)"><a href="#t1519835774000841" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-28</span> <span class="t" onclick="H(this)">16:36:14</span>                 mikerod </span><span>otherwise they’d have to do something like </span><code>(reduce insert session million-things)</code></div><div id="t1519835799000642" t="2018-02-28 16:36:39 mikerod I don’t think they’d write out a million  (insert thing1)  by hand  😛"><a href="#t1519835799000642" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-28</span> <span class="t" onclick="H(this)">16:36:39</span>                 mikerod </span><span>I don’t think they’d write out a million </span><code>(insert thing1)</code><span> by hand </span><b>😛</b></div><div id="t1519835817000465" t="2018-02-28 16:36:57 wparker anyway a VisualVM snapshot would be informative, spending time in memory updates would be a possible culprit"><a href="#t1519835817000465" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-28</span> <span class="t" onclick="H(this)">16:36:57</span>                 wparker </span><span>anyway a VisualVM snapshot would be informative, spending time in memory updates would be a possible culprit</span></div><div id="t1519836054000378" t="2018-02-28 16:40:54 mikerod yeah, I thought it would be good to se"><a href="#t1519836054000378" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-28</span> <span class="t" onclick="H(this)">16:40:54</span>                 mikerod </span><span>yeah, I thought it would be good to se</span></div><div id="t1519836059000936" t="2018-02-28 16:40:59 mikerod hopefully some can be obtained"><a href="#t1519836059000936" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-28</span> <span class="t" onclick="H(this)">16:40:59</span>                 mikerod </span><span>hopefully some can be obtained</span></div><div id="t1519836094000551" t="2018-02-28 16:41:34 mikerod I agree in general though that Clara should just batch the work from multiple insert calls"><a href="#t1519836094000551" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-28</span> <span class="t" onclick="H(this)">16:41:34</span>                 mikerod </span><span>I agree in general though that Clara should just batch the work from multiple insert calls</span></div><div id="t1519836100000813" t="2018-02-28 16:41:40 mikerod Should batch as much as possible"><a href="#t1519836100000813" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-28</span> <span class="t" onclick="H(this)">16:41:40</span>                 mikerod </span><span>Should batch as much as possible</span></div><div id="t1519836131000247" t="2018-02-28 16:42:11 alex-dixon Would insert-all be preferable here?"><a href="#t1519836131000247" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-28</span> <span class="t" onclick="H(this)">16:42:11</span>              alex-dixon </span><span>Would insert-all be preferable here?</span></div><div id="t1519836219000025" t="2018-02-28 16:43:39 mikerod If you have a big collection of things to insert, yes  insert-all"><a href="#t1519836219000025" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-28</span> <span class="t" onclick="H(this)">16:43:39</span>                 mikerod </span><span>If you have a big collection of things to insert, yes </span><code>insert-all</code></div><div id="t1519836232000834" t="2018-02-28 16:43:52 mikerod or you call  insert  via varargs if you have compile-time known ones"><a href="#t1519836232000834" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-28</span> <span class="t" onclick="H(this)">16:43:52</span>                 mikerod </span><span>or you call </span><code>insert</code><span> via varargs if you have compile-time known ones</span></div><div id="t1519836245000289" t="2018-02-28 16:44:05 mikerod You could also do  apply insert , but no reason too since  insert-all  exists"><a href="#t1519836245000289" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-28</span> <span class="t" onclick="H(this)">16:44:05</span>                 mikerod </span><span>You could also do </span><code>apply insert</code><span>, but no reason too since </span><code>insert-all</code><span> exists</span></div><div id="t1519836272000851" t="2018-02-28 16:44:32 mikerod Batched propagation through the rete network can be a big performance boost"><a href="#t1519836272000851" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-28</span> <span class="t" onclick="H(this)">16:44:32</span>                 mikerod </span><span>Batched propagation through the rete network can be a big performance boost</span></div><div id="t1519836281000440" t="2018-02-28 16:44:41 mikerod So it’s best to be as batch’ful as you can be"><a href="#t1519836281000440" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-28</span> <span class="t" onclick="H(this)">16:44:41</span>                 mikerod </span><span>So it’s best to be as batch’ful as you can be</span></div><div id="t1519836365000641" t="2018-02-28 16:46:05 alex-dixon A while ago I think I noticed retracts were slow. Not the result of insert logical though"><a href="#t1519836365000641" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-28</span> <span class="t" onclick="H(this)">16:46:05</span>              alex-dixon </span><span>A while ago I think I noticed retracts were slow. Not the result of insert logical though</span></div><div id="t1519836394000099" t="2018-02-28 16:46:34 mikerod to clarify, external  retract  or RHS  retract! ?"><a href="#t1519836394000099" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-28</span> <span class="t" onclick="H(this)">16:46:34</span>                 mikerod </span><span>to clarify, external </span><code>retract</code><span> or RHS </span><code>retract!</code><span>?</span></div><div id="t1519836519000685" t="2018-02-28 16:48:39 mikerod For no good reason (that I’m aware of) there isn’t a  retract-all  for external retraction right now.
So you should use  apply retract  if you have a batch there."><a href="#t1519836519000685" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-28</span> <span class="t" onclick="H(this)">16:48:39</span>                 mikerod </span><span>For no good reason (that I’m aware of) there isn’t a </span><code>retract-all</code><span> for external retraction right now.
So you should use </span><code>apply retract</code><span> if you have a batch there.</span></div><div id="t1519844179000444" t="2018-02-28 18:56:19 alex-dixon External "><a href="#t1519844179000444" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-28</span> <span class="t" onclick="H(this)">18:56:19</span>                   alex-dixon </span><span>External </span></div><div id="t1519844755000352" t="2018-02-28 19:05:55 mikerod So yep,  apply retract"><a href="#t1519844755000352" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-28</span> <span class="t" onclick="H(this)">19:05:55</span>                      mikerod </span><span>So yep, </span><code>apply retract</code></div><div id="t1519844780000020" t="2018-02-28 19:06:20 mikerod (we should get a  retract-all  added for convenience and symmetry with  insert"><a href="#t1519844780000020" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-28</span> <span class="t" onclick="H(this)">19:06:20</span>                      mikerod </span><span>(we should get a </span><code>retract-all</code><span> added for convenience and symmetry with </span><code>insert</code></div><div id="t1519844800000589" t="2018-02-28 19:06:40 alex-dixon Faster than doseq?"><a href="#t1519844800000589" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-28</span> <span class="t" onclick="H(this)">19:06:40</span>                   alex-dixon </span><span>Faster than doseq?</span></div><div id="t1519844832000544" t="2018-02-28 19:07:12 mikerod I don’t know how you would  doseq  external  retract  - returns a new version of the session, not mutation"><a href="#t1519844832000544" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-28</span> <span class="t" onclick="H(this)">19:07:12</span>                      mikerod </span><span>I don’t know how you would </span><code>doseq</code><span> external </span><code>retract</code><span> - returns a new version of the session, not mutation</span></div><div id="t1519844868000011" t="2018-02-28 19:07:48 mikerod If you have a collection of facts to externally retract
Instead of
 (reduce retract session facts) 
do
 (apply retract session facts)"><a href="#t1519844868000011" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-28</span> <span class="t" onclick="H(this)">19:07:48</span>                      mikerod </span><span>If you have a collection of facts to externally retract
Instead of
</span><code>(reduce retract session facts)</code><span>
do
</span><code>(apply retract session facts)</code></div><div id="t1519837948000359" t="2018-02-28 17:12:28 wdullaer here&apos;s roughly what&apos;s happening:"><a href="#t1519837948000359" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-28</span> <span class="t" onclick="H(this)">17:12:28</span>                wdullaer </span><span>here&apos;s roughly what&apos;s happening:</span></div><div id="t1519838010000695" t="2018-02-28 17:13:30 wdullaer (-&gt;session 
    (insert-all (generate-consents 1000000 test-purposes test-attributes))
    (fire-rules)
    (insert-all (generate-consents 1000000 test-purposes test-attributes))
    (fire-rules))
"><a href="#t1519838010000695" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-28</span> <span class="t" onclick="H(this)">17:13:30</span>                wdullaer </span><pre>(-&gt;session 
    (insert-all (generate-consents 1000000 test-purposes test-attributes))
    (fire-rules)
    (insert-all (generate-consents 1000000 test-purposes test-attributes))
    (fire-rules))
</pre></div><div id="t1519838019000738" t="2018-02-28 17:13:39 wdullaer with some log statements to see where I am"><a href="#t1519838019000738" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-28</span> <span class="t" onclick="H(this)">17:13:39</span>                wdullaer </span><span>with some log statements to see where I am</span></div><div id="t1519838022000208" t="2018-02-28 17:13:42 wdullaer this is on the jvm"><a href="#t1519838022000208" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-28</span> <span class="t" onclick="H(this)">17:13:42</span>                wdullaer </span><span>this is on the jvm</span></div><div id="t1519838060000460" t="2018-02-28 17:14:20 wdullaer I still have to take the snapshot"><a href="#t1519838060000460" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-28</span> <span class="t" onclick="H(this)">17:14:20</span>                wdullaer </span><span>I still have to take the snapshot</span></div><div id="t1519838080000427" t="2018-02-28 17:14:40 wdullaer maybe I&apos;ll try to reduce the code to the size of a gist so I can share it"><a href="#t1519838080000427" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-28</span> <span class="t" onclick="H(this)">17:14:40</span>                wdullaer </span><span>maybe I&apos;ll try to reduce the code to the size of a gist so I can share it</span></div><div id="t1519838184000377" t="2018-02-28 17:16:24 mikerod &gt; maybe I’ll try to reduce the code to the size of a gist so I can share it
Yeah, that is best-case scenario"><a href="#t1519838184000377" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-28</span> <span class="t" onclick="H(this)">17:16:24</span>                 mikerod </span><span>&gt; maybe I’ll try to reduce the code to the size of a gist so I can share it
Yeah, that is best-case scenario</span></div><div id="t1519839130000410" t="2018-02-28 17:32:10 wdullaer I&apos;ll report back tomorrow"><a href="#t1519839130000410" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-02-28</span> <span class="t" onclick="H(this)">17:32:10</span>                wdullaer </span><span>I&apos;ll report back tomorrow</span></div><div id="t1519893226000058" t="2018-03-01 08:33:46 wdullaer So I fired up visualVM"><a href="#t1519893226000058" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-01</span> <span class="t" onclick="H(this)">08:33:46</span>                wdullaer </span><span>So I fired up visualVM</span></div><div id="t1519893256000328" t="2018-03-01 08:34:16 wdullaer and it seems to be spending all the time in  clara.rules.engine$retract_accumulated.invoke()"><a href="#t1519893256000328" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-01</span> <span class="t" onclick="H(this)">08:34:16</span>                wdullaer </span><span>and it seems to be spending all the time in </span><code>clara.rules.engine$retract_accumulated.invoke()</code></div><div id="t1519893304000110" t="2018-03-01 08:35:04 wdullaer which lines up with the theory that implicit retractions are causing this"><a href="#t1519893304000110" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-01</span> <span class="t" onclick="H(this)">08:35:04</span>                wdullaer </span><span>which lines up with the theory that implicit retractions are causing this</span></div><div id="t1519893362000430" t="2018-03-01 08:36:02 wdullaer I can share the snapshot if that would be interesting for people"><a href="#t1519893362000430" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-01</span> <span class="t" onclick="H(this)">08:36:02</span>                wdullaer </span><span>I can share the snapshot if that would be interesting for people</span></div><div id="t1519893380000283" t="2018-03-01 08:36:20 wdullaer I&apos;ll spend some time trimming the example down to a bare bones app I can put in a gist"><a href="#t1519893380000283" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-01</span> <span class="t" onclick="H(this)">08:36:20</span>                wdullaer </span><span>I&apos;ll spend some time trimming the example down to a bare bones app I can put in a gist</span></div><div id="t1519908559000178" t="2018-03-01 12:49:19 wdullaer the gist can be found here:  https://gist.github.com/wdullaer/cecf88b3266ba0ac90b4f060eefe5208"><a href="#t1519908559000178" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-01</span> <span class="t" onclick="H(this)">12:49:19</span>                wdullaer </span><span>the gist can be found here: </span><a href="https://gist.github.com/wdullaer/cecf88b3266ba0ac90b4f060eefe5208" target="_blank">https://gist.github.com/wdullaer/cecf88b3266ba0ac90b4f060eefe5208</a></div><div id="t1519908599000339" t="2018-03-01 12:49:59 wdullaer when making this I noticed that the 2 million case is not exactly the same as 2x 1 million, because of how the attributes are randomly generated"><a href="#t1519908599000339" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-01</span> <span class="t" onclick="H(this)">12:49:59</span>                wdullaer </span><span>when making this I noticed that the 2 million case is not exactly the same as 2x 1 million, because of how the attributes are randomly generated</span></div><div id="t1519908617000241" t="2018-03-01 12:50:17 wdullaer 2x 1 million will generate much more consent for a given personId"><a href="#t1519908617000241" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-01</span> <span class="t" onclick="H(this)">12:50:17</span>                wdullaer </span><span>2x 1 million will generate much more consent for a given personId</span></div><div id="t1519908627000159" t="2018-03-01 12:50:27 wdullaer (giving the accumulator more work)"><a href="#t1519908627000159" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-01</span> <span class="t" onclick="H(this)">12:50:27</span>                wdullaer </span><span>(giving the accumulator more work)</span></div><div id="t1519908645000395" t="2018-03-01 12:50:45 wdullaer 2x 1 million goes fast enough if I make sure they generate distinct sets"><a href="#t1519908645000395" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-01</span> <span class="t" onclick="H(this)">12:50:45</span>                wdullaer </span><span>2x 1 million goes fast enough if I make sure they generate distinct sets</span></div><div id="t1519908678000143" t="2018-03-01 12:51:18 wdullaer however 1x 2 million tweaked to have the same overlap in consent as 2x 1 million still goes an order of magnitude faster"><a href="#t1519908678000143" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-01</span> <span class="t" onclick="H(this)">12:51:18</span>                wdullaer </span><span>however 1x 2 million tweaked to have the same overlap in consent as 2x 1 million still goes an order of magnitude faster</span></div><div id="t1519908733000098" t="2018-03-01 12:52:13 wdullaer I know clara doesn&apos;t deduplicate facts, but I think in this case that would prevent me from running into this scenario"><a href="#t1519908733000098" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-01</span> <span class="t" onclick="H(this)">12:52:13</span>                wdullaer </span><span>I know clara doesn&apos;t deduplicate facts, but I think in this case that would prevent me from running into this scenario</span></div><div id="t1519913408000639" t="2018-03-01 14:10:08 mikerod @wdullaer thanks for the details"><a href="#t1519913408000639" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-01</span> <span class="t" onclick="H(this)">14:10:08</span>                 mikerod </span><span>@wdullaer thanks for the details</span></div><div id="t1519913458000690" t="2018-03-01 14:10:58 mikerod I will take a look. It may be about an hour or so though. Doing a few other things at the moment."><a href="#t1519913458000690" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-01</span> <span class="t" onclick="H(this)">14:10:58</span>                 mikerod </span><span>I will take a look. It may be about an hour or so though. Doing a few other things at the moment.</span></div><div id="t1519913469000206" t="2018-03-01 14:11:09 wdullaer no worries, take all the time you need"><a href="#t1519913469000206" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-01</span> <span class="t" onclick="H(this)">14:11:09</span>                wdullaer </span><span>no worries, take all the time you need</span></div><div id="t1519913481000582" t="2018-03-01 14:11:21 wdullaer I can supply the vm snapshot as well (just need to find a quick place to upload it)"><a href="#t1519913481000582" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-01</span> <span class="t" onclick="H(this)">14:11:21</span>                wdullaer </span><span>I can supply the vm snapshot as well (just need to find a quick place to upload it)</span></div><div id="t1519913506000426" t="2018-03-01 14:11:46 mikerod Yeah, if you have one you can share, that’d be good to take a glance at."><a href="#t1519913506000426" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-01</span> <span class="t" onclick="H(this)">14:11:46</span>                 mikerod </span><span>Yeah, if you have one you can share, that’d be good to take a glance at.</span></div><div id="t1519913510000447" t="2018-03-01 14:11:50 mikerod How to share hmm"><a href="#t1519913510000447" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-01</span> <span class="t" onclick="H(this)">14:11:50</span>                 mikerod </span><span>How to share hmm</span></div><div id="t1519913586000036" t="2018-03-01 14:13:06 wdullaer I&apos;ll put it into dropbox, just a sec"><a href="#t1519913586000036" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-01</span> <span class="t" onclick="H(this)">14:13:06</span>                wdullaer </span><span>I&apos;ll put it into dropbox, just a sec</span></div><div id="t1519913673000597" t="2018-03-01 14:14:33 wdullaer https://www.dropbox.com/s/no6h9pwa03hzt7w/clara-perf.nps?dl=0"><a href="#t1519913673000597" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-01</span> <span class="t" onclick="H(this)">14:14:33</span>                wdullaer </span><a href="https://www.dropbox.com/s/no6h9pwa03hzt7w/clara-perf.nps?dl=0" target="_blank">https://www.dropbox.com/s/no6h9pwa03hzt7w/clara-perf.nps?dl=0</a></div><div id="t1519913674000632" t="2018-03-01 14:14:34 mikerod ok"><a href="#t1519913674000632" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-01</span> <span class="t" onclick="H(this)">14:14:34</span>                 mikerod </span><span>ok</span></div><div id="t1519921408000585" t="2018-03-01 16:23:28 mikerod @wdullaer I’ve only got to look at this briefly so far today"><a href="#t1519921408000585" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-01</span> <span class="t" onclick="H(this)">16:23:28</span>                 mikerod </span><span>@wdullaer I’ve only got to look at this briefly so far today</span></div><div id="t1519921529000582" t="2018-03-01 16:25:29 mikerod It seems like these collections created via  acc/distinct  would be fairly large. Also, there are many of them after the first 1mil facts. There’d be a big  acc/distinct  collection associated with each personId + purpose grouped Consent facts. When the next 1mil facts come in, I believe they will contribute to many  (or perhaps even all) of those same big collections."><a href="#t1519921529000582" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-01</span> <span class="t" onclick="H(this)">16:25:29</span>                 mikerod </span><span>It seems like these collections created via </span><code>acc/distinct</code><span> would be fairly large. Also, there are many of them after the first 1mil facts. There’d be a big </span><code>acc/distinct</code><span> collection associated with each personId + purpose grouped Consent facts. When the next 1mil facts come in, I believe they will contribute to many  (or perhaps even all) of those same big collections.</span></div><div id="t1519921574000125" t="2018-03-01 16:26:14 mikerod The work from the first 1 mil facts is stored in working memory. Clara builds the new collections on the 2nd wave of inserts. It then must remove the old accumulated work it did from working memory - in order to replace it with the updates."><a href="#t1519921574000125" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-01</span> <span class="t" onclick="H(this)">16:26:14</span>                 mikerod </span><span>The work from the first 1 mil facts is stored in working memory. Clara builds the new collections on the 2nd wave of inserts. It then must remove the old accumulated work it did from working memory - in order to replace it with the updates.</span></div><div id="t1519921611000144" t="2018-03-01 16:26:51 mikerod I think the fact that there are many of these large collections in working memory is making it get really expensive to remove them all from working memory. Clara tries to be efficient in finding and removing things in memory. I think huge collections may be a pitfall."><a href="#t1519921611000144" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-01</span> <span class="t" onclick="H(this)">16:26:51</span>                 mikerod </span><span>I think the fact that there are many of these large collections in working memory is making it get really expensive to remove them all from working memory. Clara tries to be efficient in finding and removing things in memory. I think huge collections may be a pitfall.</span></div><div id="t1519921699000796" t="2018-03-01 16:28:19 mikerod I’d like to look a little deeper at it, but haven’t been able to yet. I’m not sure what a reasonable workaround may be, other than inserting everything in one batch (as you’ve found)."><a href="#t1519921699000796" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-01</span> <span class="t" onclick="H(this)">16:28:19</span>                 mikerod </span><span>I’d like to look a little deeper at it, but haven’t been able to yet. I’m not sure what a reasonable workaround may be, other than inserting everything in one batch (as you’ve found).</span></div><div id="t1519921717000405" t="2018-03-01 16:28:37 mikerod It’s an interesting case to explore some more for sure."><a href="#t1519921717000405" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-01</span> <span class="t" onclick="H(this)">16:28:37</span>                 mikerod </span><span>It’s an interesting case to explore some more for sure.</span></div><div id="t1519926102000602" t="2018-03-01 17:41:42 wdullaer thanks for the input"><a href="#t1519926102000602" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-01</span> <span class="t" onclick="H(this)">17:41:42</span>                wdullaer </span><span>thanks for the input</span></div><div id="t1519926116000349" t="2018-03-01 17:41:56 wdullaer I can see how this is a worst case scenario"><a href="#t1519926116000349" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-01</span> <span class="t" onclick="H(this)">17:41:56</span>                wdullaer </span><span>I can see how this is a worst case scenario</span></div><div id="t1519926183000104" t="2018-03-01 17:43:03 wdullaer we probably won’t see this amount of massive updates in a real life scenario, and if it does (say a big data migration), we can always consider starting from scratch"><a href="#t1519926183000104" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-01</span> <span class="t" onclick="H(this)">17:43:03</span>                wdullaer </span><span>we probably won’t see this amount of massive updates in a real life scenario, and if it does (say a big data migration), we can always consider starting from scratch</span></div><div id="t1519926229000255" t="2018-03-01 17:43:49 wdullaer it was a bit surprising that updating these structures is a lot more expensive than creating them"><a href="#t1519926229000255" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-01</span> <span class="t" onclick="H(this)">17:43:49</span>                wdullaer </span><span>it was a bit surprising that updating these structures is a lot more expensive than creating them</span></div><div id="t1519926259000074" t="2018-03-01 17:44:19 wdullaer if I can help in any way here, just let me know"><a href="#t1519926259000074" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-01</span> <span class="t" onclick="H(this)">17:44:19</span>                wdullaer </span><span>if I can help in any way here, just let me know</span></div><div id="t1519926274000475" t="2018-03-01 17:44:34 wdullaer I have a few other benchmarks I’m going to run over the coming days as well"><a href="#t1519926274000475" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-01</span> <span class="t" onclick="H(this)">17:44:34</span>                wdullaer </span><span>I have a few other benchmarks I’m going to run over the coming days as well</span></div><div id="t1519927107000104" t="2018-03-01 17:58:27 mikerod I need to look deeper at what is happening to have a stronger sense of what could be done"><a href="#t1519927107000104" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-01</span> <span class="t" onclick="H(this)">17:58:27</span>                 mikerod </span><span>I need to look deeper at what is happening to have a stronger sense of what could be done</span></div><div id="t1519931439000179" t="2018-03-01 19:10:39 wparker I’ve logged  https://github.com/cerner/clara-rules/issues/385  for this @mikerod @wdullaer , I’d suggest that we post findings there when we have them"><a href="#t1519931439000179" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-01</span> <span class="t" onclick="H(this)">19:10:39</span>                 wparker </span><span>I’ve logged </span><a href="https://github.com/cerner/clara-rules/issues/385" target="_blank">https://github.com/cerner/clara-rules/issues/385</a><span> for this @mikerod @wdullaer , I’d suggest that we post findings there when we have them</span></div><div id="t1519931710000398" t="2018-03-01 19:15:10 wparker From the snapshot it looks like the memory is the bottleneck, which isn’t too surprising.  From my first glance over it I suspect there are some performance optimizations we can make for cases like this, but it may be a bit before I have time to write my thoughts down in a sufficiently articulate form.  The benchmark and snapshot are really helpful and make diagnosing things like this much easier - thanks for that.  It is useful to have benchmarks of realistic rule patterns that stress-test Clara."><a href="#t1519931710000398" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-01</span> <span class="t" onclick="H(this)">19:15:10</span>                 wparker </span><span>From the snapshot it looks like the memory is the bottleneck, which isn’t too surprising.  From my first glance over it I suspect there are some performance optimizations we can make for cases like this, but it may be a bit before I have time to write my thoughts down in a sufficiently articulate form.  The benchmark and snapshot are really helpful and make diagnosing things like this much easier - thanks for that.  It is useful to have benchmarks of realistic rule patterns that stress-test Clara.</span></div><div id="t1519984370000223" t="2018-03-02 09:52:50 wdullaer the insert 1 million is realistic, the update 1 million slightly less so"><a href="#t1519984370000223" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-02</span> <span class="t" onclick="H(this)">09:52:50</span>                wdullaer </span><span>the insert 1 million is realistic, the update 1 million slightly less so</span></div><div id="t1519984383000431" t="2018-03-02 09:53:03 wdullaer thanks for all the help so far!"><a href="#t1519984383000431" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-02</span> <span class="t" onclick="H(this)">09:53:03</span>                wdullaer </span><span>thanks for all the help so far!</span></div><div id="t1520007034000315" t="2018-03-02 16:10:34 alex-dixon @wparker @mikerod Thanks for the clarification on  https://github.com/cerner/clara-rules/issues/386 . Re: breaking changes, Precept recently experienced some with 0.17.0 and realized I should probably speak up about anything that might affect the implementation since I’m the only one that would really know  🙂  Sorry if I’m being overly concerned. It’s hard for me to investigate the effects of changes in detail myself due to time constraints lately, and hard in general since to me there’s a fair amount of complexity at work in Clara  🙂"><a href="#t1520007034000315" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-02</span> <span class="t" onclick="H(this)">16:10:34</span>              alex-dixon </span><span>@wparker @mikerod Thanks for the clarification on </span><a href="https://github.com/cerner/clara-rules/issues/386" target="_blank">https://github.com/cerner/clara-rules/issues/386</a><span>. Re: breaking changes, Precept recently experienced some with 0.17.0 and realized I should probably speak up about anything that might affect the implementation since I’m the only one that would really know </span><b>🙂</b><span> Sorry if I’m being overly concerned. It’s hard for me to investigate the effects of changes in detail myself due to time constraints lately, and hard in general since to me there’s a fair amount of complexity at work in Clara </span><b>🙂</b></div><div id="t1520007521000434" t="2018-03-02 16:18:41 wparker @alex-dixon what sorts of breaking changes?  Have you tracked down the cause(s)?  I totally understand not wanting to be blindsided by breaking changes and am glad you’re looking over the issue list.  🙂   If we created a regression of some kind or need to more clearly communicate public vs private boundaries of some API(s) in Clara that’d be good info to have."><a href="#t1520007521000434" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-02</span> <span class="t" onclick="H(this)">16:18:41</span>                 wparker </span><span>@alex-dixon what sorts of breaking changes?  Have you tracked down the cause(s)?  I totally understand not wanting to be blindsided by breaking changes and am glad you’re looking over the issue list. </span><b>🙂</b><span>  If we created a regression of some kind or need to more clearly communicate public vs private boundaries of some API(s) in Clara that’d be good info to have.</span></div><div id="t1520007721000249" t="2018-03-02 16:22:01 alex-dixon Meh. It’s my responsibility. You guys do a great job. It’s been inspiring to me to see how much effort is put into backward compatibility. I’ve narrowed it down to a couple of commits but since it’s not something that’s fun to solve I haven’t looked very far  😄   https://github.com/CoNarrative/precept/issues/112"><a href="#t1520007721000249" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-02</span> <span class="t" onclick="H(this)">16:22:01</span>              alex-dixon </span><span>Meh. It’s my responsibility. You guys do a great job. It’s been inspiring to me to see how much effort is put into backward compatibility. I’ve narrowed it down to a couple of commits but since it’s not something that’s fun to solve I haven’t looked very far </span><b>😄</b><span> </span><a href="https://github.com/CoNarrative/precept/issues/112" target="_blank">https://github.com/CoNarrative/precept/issues/112</a></div><div id="t1520008147000607" t="2018-03-02 16:29:07 alex-dixon Basically I had some rules that I baked into every Precept session and in 0.17 they’re not making it in. Relevant spots in Precept code (which echoes Clara’s implementation considerably) may include:
 https://github.com/CoNarrative/precept/blob/master/src/clj/precept/macros.clj#L87 
 https://github.com/CoNarrative/precept/blob/690ba6cd30064901ce830b67ca92caaab9a68c93/src/cljc/precept/rules.cljc#L38"><a href="#t1520008147000607" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-02</span> <span class="t" onclick="H(this)">16:29:07</span>                   alex-dixon </span><span>Basically I had some rules that I baked into every Precept session and in 0.17 they’re not making it in. Relevant spots in Precept code (which echoes Clara’s implementation considerably) may include:
</span><a href="https://github.com/CoNarrative/precept/blob/master/src/clj/precept/macros.clj#L87" target="_blank">https://github.com/CoNarrative/precept/blob/master/src/clj/precept/macros.clj#L87</a><span>
</span><a href="https://github.com/CoNarrative/precept/blob/690ba6cd30064901ce830b67ca92caaab9a68c93/src/cljc/precept/rules.cljc#L38" target="_blank">https://github.com/CoNarrative/precept/blob/690ba6cd30064901ce830b67ca92caaab9a68c93/src/cljc/precept/rules.cljc#L38</a></div><div id="t1520008303000593" t="2018-03-02 16:31:43 alex-dixon Pretty confident I can figure it out…seems related to namespace resolution changes that fix rules not being able to see vars defined in their namespace in CLJS. That’s definitely a fix I want so just need to take some time to make this work on my end"><a href="#t1520008303000593" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-02</span> <span class="t" onclick="H(this)">16:31:43</span>                   alex-dixon </span><span>Pretty confident I can figure it out…seems related to namespace resolution changes that fix rules not being able to see vars defined in their namespace in CLJS. That’s definitely a fix I want so just need to take some time to make this work on my end</span></div><div id="t1520008361000842" t="2018-03-02 16:32:41 wparker Yeah, just giving it a fast glance it seems like you’re doing custom stuff with loading rules and such, and the changes in 359 could have impacted that somehow (again without looking at it in any detail).  359 was an obvious bug that needed to be fixed, but if we broke something else with it that ought to work let us know"><a href="#t1520008361000842" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-02</span> <span class="t" onclick="H(this)">16:32:41</span>                      wparker </span><span>Yeah, just giving it a fast glance it seems like you’re doing custom stuff with loading rules and such, and the changes in 359 could have impacted that somehow (again without looking at it in any detail).  359 was an obvious bug that needed to be fixed, but if we broke something else with it that ought to work let us know</span></div><div id="t1520019464000349" t="2018-03-02 19:37:44 ProbablyJody @wdullaer for a workaround in your use case, would it make sense to first filter the consents?  Your example shows 1/10th as many persons as events. Shrinking the search space by explicitly filtering the duplicates may speed things up."><a href="#t1520019464000349" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-02</span> <span class="t" onclick="H(this)">19:37:44</span>            ProbablyJody </span><span>@wdullaer for a workaround in your use case, would it make sense to first filter the consents?  Your example shows 1/10th as many persons as events. Shrinking the search space by explicitly filtering the duplicates may speed things up.</span></div><div id="t1520019734000654" t="2018-03-02 19:42:14 ProbablyJody So adding an additional defrecord  DistinctConsent  and a new rule to map from  Consent  to  DistinctConsent 
The rest of the rules would just use DistinctConsent going forward"><a href="#t1520019734000654" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-02</span> <span class="t" onclick="H(this)">19:42:14</span>            ProbablyJody </span><span>So adding an additional defrecord </span><code>DistinctConsent</code><span> and a new rule to map from </span><code>Consent</code><span> to </span><code>DistinctConsent</code><span>
The rest of the rules would just use DistinctConsent going forward</span></div><div id="t1520019750000050" t="2018-03-02 19:42:30 ProbablyJody as an example"><a href="#t1520019750000050" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-02</span> <span class="t" onclick="H(this)">19:42:30</span>            ProbablyJody </span><span>as an example</span></div><div id="t1520019750000160" t="2018-03-02 19:42:30 wdullaer yes, I’ll probably try to prevent duplicate consent from being created"><a href="#t1520019750000160" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-02</span> <span class="t" onclick="H(this)">19:42:30</span>                wdullaer </span><span>yes, I’ll probably try to prevent duplicate consent from being created</span></div><div id="t1520019781000546" t="2018-03-02 19:43:01 wdullaer that’s also a cool way to handle it actually, I thought about querying before inserting"><a href="#t1520019781000546" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-02</span> <span class="t" onclick="H(this)">19:43:01</span>                wdullaer </span><span>that’s also a cool way to handle it actually, I thought about querying before inserting</span></div><div id="t1520019828000654" t="2018-03-02 19:43:48 ProbablyJody acc/distinct will still be managing a large object for retractions"><a href="#t1520019828000654" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-02</span> <span class="t" onclick="H(this)">19:43:48</span>            ProbablyJody </span><span>acc/distinct will still be managing a large object for retractions</span></div><div id="t1520019855000441" t="2018-03-02 19:44:15 ProbablyJody but it will be smaller than the cross product of Consents and Processors"><a href="#t1520019855000441" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-02</span> <span class="t" onclick="H(this)">19:44:15</span>            ProbablyJody </span><span>but it will be smaller than the cross product of Consents and Processors</span></div><div id="t1520019934000117" t="2018-03-02 19:45:34 wdullaer I don’t fully control how many consent items we’ll have for a given user"><a href="#t1520019934000117" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-02</span> <span class="t" onclick="H(this)">19:45:34</span>                wdullaer </span><span>I don’t fully control how many consent items we’ll have for a given user</span></div><div id="t1520019952000520" t="2018-03-02 19:45:52 wdullaer it depends on the granularity at which this will be recorded and that is not fully within my control"><a href="#t1520019952000520" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-02</span> <span class="t" onclick="H(this)">19:45:52</span>                wdullaer </span><span>it depends on the granularity at which this will be recorded and that is not fully within my control</span></div><div id="t1520019975000476" t="2018-03-02 19:46:15 ProbablyJody But you expect duplicate consents?"><a href="#t1520019975000476" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-02</span> <span class="t" onclick="H(this)">19:46:15</span>            ProbablyJody </span><span>But you expect duplicate consents?</span></div><div id="t1520019989000276" t="2018-03-02 19:46:29 wdullaer most certainly"><a href="#t1520019989000276" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-02</span> <span class="t" onclick="H(this)">19:46:29</span>                wdullaer </span><span>most certainly</span></div><div id="t1520020000000467" t="2018-03-02 19:46:40 ProbablyJody cool"><a href="#t1520020000000467" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-02</span> <span class="t" onclick="H(this)">19:46:40</span>            ProbablyJody </span><span>cool</span></div><div id="t1520020696000697" t="2018-03-02 19:58:16 ProbablyJody another thought (possibly in addition to the previous one) was to explode the Processor facts into something like  DesiredConsent [processorId purpose attribute] , use a rule to match them to a Consent and dump into another intermediate fact  ApprovedDesiredConsent [processorId personId purpose attribute] . Then accumulate and match your ApprovedDesiredConsent to the Processor.

I haven’t tested it, so I don’t know if it’s more performant, but the idea/hope is that you’d accumulate less when creating the AllowedProcessor"><a href="#t1520020696000697" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-02</span> <span class="t" onclick="H(this)">19:58:16</span>            ProbablyJody </span><span>another thought (possibly in addition to the previous one) was to explode the Processor facts into something like </span><code>DesiredConsent [processorId purpose attribute]</code><span>, use a rule to match them to a Consent and dump into another intermediate fact </span><code>ApprovedDesiredConsent [processorId personId purpose attribute]</code><span>. Then accumulate and match your ApprovedDesiredConsent to the Processor.

I haven’t tested it, so I don’t know if it’s more performant, but the idea/hope is that you’d accumulate less when creating the AllowedProcessor</span></div><div id="t1520022553000594" t="2018-03-02 20:29:13 wdullaer I’ll experiment with some of these on Monday"><a href="#t1520022553000594" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-02</span> <span class="t" onclick="H(this)">20:29:13</span>                wdullaer </span><span>I’ll experiment with some of these on Monday</span></div><div id="t1520022596000499" t="2018-03-02 20:29:56 wdullaer the easiest I think is to just ensure that no duplicate consents are asserted, which I think I can do out of band (the consent will intially be put on a log)"><a href="#t1520022596000499" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-02</span> <span class="t" onclick="H(this)">20:29:56</span>                wdullaer </span><span>the easiest I think is to just ensure that no duplicate consents are asserted, which I think I can do out of band (the consent will intially be put on a log)</span></div><div id="t1520057606000012" t="2018-03-03 06:13:26 olivergeorge Newbie question... I&apos;m struggling to write a rule which boils down to &quot;This or that&quot;."><a href="#t1520057606000012" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-03</span> <span class="t" onclick="H(this)">06:13:26</span>            olivergeorge </span><span>Newbie question... I&apos;m struggling to write a rule which boils down to &quot;This or that&quot;.</span></div><div id="t1520057612000015" t="2018-03-03 06:13:32 olivergeorge (defrecord This [x])
  (defrecord That [y])
  (defrule this-or-that
    &quot;Print This if fact exists, else print That.&quot;
    [:or [?x &lt;- This] [?x &lt;- That]]
    =&gt;
    (println :this-or-that ?x))

  (-&gt; (mk-session &apos;labs-costs-clara.core)
      (insert
        (-&gt;This 1)
        (-&gt;That 2))
      (fire-rules))"><a href="#t1520057612000015" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-03</span> <span class="t" onclick="H(this)">06:13:32</span>            olivergeorge </span><pre>(defrecord This [x])
  (defrecord That [y])
  (defrule this-or-that
    &quot;Print This if fact exists, else print That.&quot;
    [:or [?x &lt;- This] [?x &lt;- That]]
    =&gt;
    (println :this-or-that ?x))

  (-&gt; (mk-session &apos;labs-costs-clara.core)
      (insert
        (-&gt;This 1)
        (-&gt;That 2))
      (fire-rules))</pre></div><div id="t1520057627000114" t="2018-03-03 06:13:47 olivergeorge This will print twice which isn&apos;t what I&apos;m after."><a href="#t1520057627000114" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-03</span> <span class="t" onclick="H(this)">06:13:47</span>            olivergeorge </span><span>This will print twice which isn&apos;t what I&apos;m after.</span></div><div id="t1520057650000083" t="2018-03-03 06:14:10 olivergeorge (my real example is patching data... if X exists use it else use some other facts to fill in the gap)"><a href="#t1520057650000083" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-03</span> <span class="t" onclick="H(this)">06:14:10</span>            olivergeorge </span><span>(my real example is patching data... if X exists use it else use some other facts to fill in the gap)</span></div><div id="t1520057665000005" t="2018-03-03 06:14:25 zylox ya, or isnt a xor, it can indeed follow both paths"><a href="#t1520057665000005" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-03</span> <span class="t" onclick="H(this)">06:14:25</span>                   zylox </span><span>ya, or isnt a xor, it can indeed follow both paths</span></div><div id="t1520057688000086" t="2018-03-03 06:14:48 zylox i tend to think of it as if you had two disjunct rules"><a href="#t1520057688000086" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-03</span> <span class="t" onclick="H(this)">06:14:48</span>                   zylox </span><span>i tend to think of it as if you had two disjunct rules</span></div><div id="t1520057697000063" t="2018-03-03 06:14:57 zylox because that is pretty close to what it does"><a href="#t1520057697000063" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-03</span> <span class="t" onclick="H(this)">06:14:57</span>                   zylox </span><span>because that is pretty close to what it does</span></div><div id="t1520057734000058" t="2018-03-03 06:15:34 zylox if you want one but not the other...well you are going to want to use two rules with  :not  on  This  in one and  That  on the other"><a href="#t1520057734000058" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-03</span> <span class="t" onclick="H(this)">06:15:34</span>                   zylox </span><span>if you want one but not the other...well you are going to want to use two rules with </span><code>:not</code><span> on </span><code>This</code><span> in one and </span><code>That</code><span> on the other</span></div><div id="t1520057747000077" t="2018-03-03 06:15:47 olivergeorge That makes sense.  My rules got a bit verbose which is what got me wondering."><a href="#t1520057747000077" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-03</span> <span class="t" onclick="H(this)">06:15:47</span>            olivergeorge </span><span>That makes sense.  My rules got a bit verbose which is what got me wondering.</span></div><div id="t1520057749000014" t="2018-03-03 06:15:49 olivergeorge Thanks"><a href="#t1520057749000014" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-03</span> <span class="t" onclick="H(this)">06:15:49</span>            olivergeorge </span><span>Thanks</span></div><div id="t1520057775000065" t="2018-03-03 06:16:15 olivergeorge The only alternative I could imagine was some kind of  maybe  accumulator"><a href="#t1520057775000065" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-03</span> <span class="t" onclick="H(this)">06:16:15</span>            olivergeorge </span><span>The only alternative I could imagine was some kind of </span><code>maybe</code><span> accumulator</span></div><div id="t1520057784000030" t="2018-03-03 06:16:24 olivergeorge (e.g. distinct but expecting one fact)"><a href="#t1520057784000030" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-03</span> <span class="t" onclick="H(this)">06:16:24</span>            olivergeorge </span><span>(e.g. distinct but expecting one fact)</span></div><div id="t1520057820000024" t="2018-03-03 06:17:00 zylox are you expecting only one, or potentially many"><a href="#t1520057820000024" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-03</span> <span class="t" onclick="H(this)">06:17:00</span>                   zylox </span><span>are you expecting only one, or potentially many</span></div><div id="t1520057862000013" t="2018-03-03 06:17:42 olivergeorge My code was really &quot;if summary value exists use it, else calculate from many other facts&quot; but that&apos;s not critical to the general question."><a href="#t1520057862000013" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-03</span> <span class="t" onclick="H(this)">06:17:42</span>            olivergeorge </span><span>My code was really &quot;if summary value exists use it, else calculate from many other facts&quot; but that&apos;s not critical to the general question.</span></div><div id="t1520057926000002" t="2018-03-03 06:18:46 olivergeorge Thanks for your thoughts @zylox that makes me feel more confident"><a href="#t1520057926000002" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-03</span> <span class="t" onclick="H(this)">06:18:46</span>            olivergeorge </span><span>Thanks for your thoughts @zylox that makes me feel more confident</span></div><div id="t1520058009000059" t="2018-03-03 06:20:09 zylox gotcha. id suggest something like  (defrule with-summary
  &quot;&quot;
  [Summary (= ?data data)]
  =&gt;
  (println ?data))

(defrule without-summary
  &quot;&quot;
  [:not [Summary]]
  [?others &lt;- (acc/all) :from [SecondaryFacts]]
  
  =&gt;
  (println ?others))  then"><a href="#t1520058009000059" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-03</span> <span class="t" onclick="H(this)">06:20:09</span>                   zylox </span><span>gotcha. id suggest something like </span><pre>(defrule with-summary
  &quot;&quot;
  [Summary (= ?data data)]
  =&gt;
  (println ?data))

(defrule without-summary
  &quot;&quot;
  [:not [Summary]]
  [?others &lt;- (acc/all) :from [SecondaryFacts]]
  
  =&gt;
  (println ?others))</pre><span> then</span></div><div id="t1520058015000060" t="2018-03-03 06:20:15 zylox best of luck"><a href="#t1520058015000060" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-03</span> <span class="t" onclick="H(this)">06:20:15</span>                   zylox </span><span>best of luck</span></div><div id="t1520058034000001" t="2018-03-03 06:20:34 olivergeorge Thank you"><a href="#t1520058034000001" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-03</span> <span class="t" onclick="H(this)">06:20:34</span>            olivergeorge </span><span>Thank you</span></div><div id="t1520058100000026" t="2018-03-03 06:21:40 zylox without all the horrible syntax errors i just edited out haha"><a href="#t1520058100000026" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-03</span> <span class="t" onclick="H(this)">06:21:40</span>                   zylox </span><span>without all the horrible syntax errors i just edited out haha</span></div><div id="t1520180997000005" t="2018-03-04 16:29:57 sekao hey, has anyone tried clara with clojurescript 1.10.126? i&apos;m getting a bunch of arity warnings about  MapEntry  and at runtime i&apos;m getting  Maximum call stack size exceeded  from  schema.core  (where mapentry is defined)"><a href="#t1520180997000005" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-04</span> <span class="t" onclick="H(this)">16:29:57</span>                   sekao </span><span>hey, has anyone tried clara with clojurescript 1.10.126? i&apos;m getting a bunch of arity warnings about </span><code>MapEntry</code><span> and at runtime i&apos;m getting </span><code>Maximum call stack size exceeded</code><span> from </span><code>schema.core</code><span> (where mapentry is defined)</span></div><div id="t1520181048000004" t="2018-03-04 16:30:48 sekao i&apos;m guessing schema is not playing well with it. i noticed in their changelog that they had to fix some  MapEntry  warnings in 1.1.6, but clara is already using that version so this must be a new problem"><a href="#t1520181048000004" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-04</span> <span class="t" onclick="H(this)">16:30:48</span>                   sekao </span><span>i&apos;m guessing schema is not playing well with it. i noticed in their changelog that they had to fix some </span><code>MapEntry</code><span> warnings in 1.1.6, but clara is already using that version so this must be a new problem</span></div><div id="t1520181969000134" t="2018-03-04 16:46:09 alex-dixon @sekao Haven’t tried that version. I’m on 1.9.854"><a href="#t1520181969000134" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-04</span> <span class="t" onclick="H(this)">16:46:09</span>              alex-dixon </span><span>@sekao Haven’t tried that version. I’m on 1.9.854</span></div><div id="t1520182058000030" t="2018-03-04 16:47:38 alex-dixon I’ve had problems with the schema library in the past though. I think I got around it by excluding clara’s version and using a newer one. That might not work in this case though"><a href="#t1520182058000030" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-04</span> <span class="t" onclick="H(this)">16:47:38</span>              alex-dixon </span><span>I’ve had problems with the schema library in the past though. I think I got around it by excluding clara’s version and using a newer one. That might not work in this case though</span></div><div id="t1520182069000031" t="2018-03-04 16:47:49 alex-dixon What version of Clara are you using?"><a href="#t1520182069000031" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-04</span> <span class="t" onclick="H(this)">16:47:49</span>              alex-dixon </span><span>What version of Clara are you using?</span></div><div id="t1520182168000038" t="2018-03-04 16:49:28 sekao i&apos;m using 0.17.0 but it happens with master as well. i just mentioned it on the clojurescript channel and it sounds like it is conflicting with  MapEntry  in cljs.core"><a href="#t1520182168000038" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-04</span> <span class="t" onclick="H(this)">16:49:28</span>                   sekao </span><span>i&apos;m using 0.17.0 but it happens with master as well. i just mentioned it on the clojurescript channel and it sounds like it is conflicting with </span><code>MapEntry</code><span> in cljs.core</span></div><div id="t1520191217000095" t="2018-03-04 19:20:17 mikerod @sekao so this is a schema issue with the new cljs version then?"><a href="#t1520191217000095" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-04</span> <span class="t" onclick="H(this)">19:20:17</span>                 mikerod </span><span>@sekao so this is a schema issue with the new cljs version then?</span></div><div id="t1520191874000017" t="2018-03-04 19:31:14 sekao yep it seems so"><a href="#t1520191874000017" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-04</span> <span class="t" onclick="H(this)">19:31:14</span>                   sekao </span><span>yep it seems so</span></div><div id="t1520192008000137" t="2018-03-04 19:33:28 mikerod Alright. Hmm. I guess schema needs to get fixed..."><a href="#t1520192008000137" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-04</span> <span class="t" onclick="H(this)">19:33:28</span>                 mikerod </span><span>Alright. Hmm. I guess schema needs to get fixed...</span></div><div id="t1520192035000105" t="2018-03-04 19:33:55 sekao is it still actively maintained?"><a href="#t1520192035000105" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-04</span> <span class="t" onclick="H(this)">19:33:55</span>                   sekao </span><span>is it still actively maintained?</span></div><div id="t1520196582000075" t="2018-03-04 20:49:42 mikerod @sekao yeah I wasn’t sure on that. "><a href="#t1520196582000075" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-04</span> <span class="t" onclick="H(this)">20:49:42</span>                 mikerod </span><span>@sekao yeah I wasn’t sure on that. </span></div><div id="t1520196626000080" t="2018-03-04 20:50:26 mikerod I think they at least probably still take pull requests"><a href="#t1520196626000080" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-04</span> <span class="t" onclick="H(this)">20:50:26</span>                 mikerod </span><span>I think they at least probably still take pull requests</span></div><div id="t1521051648000261" t="2018-03-14 18:20:48 afurmanov Why this code  (ns experiments.a
  (:require [clara.rules :as rules]

            [clojure.pprint :refer [pprint]]))

(defrecord A [id])

(rules/defrule create-a-if-not-exists
  &quot;&quot;
  [:not [A]]
  =&gt;
  (println &quot;creating A&quot;)
  (rules/insert! (-&gt;A &quot;a&quot;)))

(-&gt; (rules/mk-session)
    (rules/fire-rules))
"><a href="#t1521051648000261" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-14</span> <span class="t" onclick="H(this)">18:20:48</span>               afurmanov </span><span>Why this code </span><pre>(ns experiments.a
  (:require [clara.rules :as rules]

            [clojure.pprint :refer [pprint]]))

(defrecord A [id])

(rules/defrule create-a-if-not-exists
  &quot;&quot;
  [:not [A]]
  =&gt;
  (println &quot;creating A&quot;)
  (rules/insert! (-&gt;A &quot;a&quot;)))

(-&gt; (rules/mk-session)
    (rules/fire-rules))
</pre></div><div id="t1521051659000261" t="2018-03-14 18:20:59 afurmanov creates infinite recursion?"><a href="#t1521051659000261" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-14</span> <span class="t" onclick="H(this)">18:20:59</span>               afurmanov </span><span>creates infinite recursion?</span></div><div id="t1521052060000284" t="2018-03-14 18:27:40 ethanc The initial state of the session makes the LHS of your rule evaluate as  true  thus it inserts an  A ,
 which then makes your rule&apos;s LHS evaluate as  false  causing the truth maintenance of clara to logically retract the  A  that was insert.
repeat"><a href="#t1521052060000284" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-14</span> <span class="t" onclick="H(this)">18:27:40</span>                  ethanc </span><span>The initial state of the session makes the LHS of your rule evaluate as </span><code>true</code><span> thus it inserts an </span><code>A</code><span>,
 which then makes your rule&apos;s LHS evaluate as </span><code>false</code><span> causing the truth maintenance of clara to logically retract the </span><code>A</code><span> that was insert.
repeat</span></div><div id="t1521052075000715" t="2018-03-14 18:27:55 ethanc forever"><a href="#t1521052075000715" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-14</span> <span class="t" onclick="H(this)">18:27:55</span>                  ethanc </span><span>forever</span></div><div id="t1521052081000731" t="2018-03-14 18:28:01 ethanc @alex.furmanov"><a href="#t1521052081000731" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-14</span> <span class="t" onclick="H(this)">18:28:01</span>                  ethanc </span><span>@alex.furmanov</span></div><div id="t1521052121000764" t="2018-03-14 18:28:41 zylox &quot;ok i&apos;ll insert a if there is no A. Inserting. Ok now lets look at the state of things. Oh there is an A. Retract That thing i inserted. Ok now lets look at the state of things. Oh there is no A. Time to insert A....&quot; ~ Internal monologue of the session repeat ad infinitum"><a href="#t1521052121000764" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-14</span> <span class="t" onclick="H(this)">18:28:41</span>                   zylox </span><span>&quot;ok i&apos;ll insert a if there is no A. Inserting. Ok now lets look at the state of things. Oh there is an A. Retract That thing i inserted. Ok now lets look at the state of things. Oh there is no A. Time to insert A....&quot; ~ Internal monologue of the session repeat ad infinitum</span></div><div id="t1521052206000651" t="2018-03-14 18:30:06 zylox http://www.clara-rules.org/docs/truthmaint/  truth maintenance is the name of the game"><a href="#t1521052206000651" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-14</span> <span class="t" onclick="H(this)">18:30:06</span>                   zylox </span><a href="http://www.clara-rules.org/docs/truthmaint/" target="_blank">http://www.clara-rules.org/docs/truthmaint/</a><span> truth maintenance is the name of the game</span></div><div id="t1521052504000104" t="2018-03-14 18:35:04 afurmanov Thanks!"><a href="#t1521052504000104" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-14</span> <span class="t" onclick="H(this)">18:35:04</span>               afurmanov </span><span>Thanks!</span></div><div id="t1521385836000111" t="2018-03-18 15:10:36 sparkofreason The trace listener feature is very helpful for finding the cause of loops."><a href="#t1521385836000111" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-18</span> <span class="t" onclick="H(this)">15:10:36</span>           sparkofreason </span><span>The trace listener feature is very helpful for finding the cause of loops.</span></div><div id="t1521648062000129" t="2018-03-21 16:01:02 talgiat is there a way to query for all types but one?"><a href="#t1521648062000129" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-21</span> <span class="t" onclick="H(this)">16:01:02</span>                 talgiat </span><span>is there a way to query for all types but one?</span></div><div id="t1521648310000503" t="2018-03-21 16:05:10 mikerod @talgiat the main problem I’d see with doing something like that is that the query may become a performance problem"><a href="#t1521648310000503" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-21</span> <span class="t" onclick="H(this)">16:05:10</span>                 mikerod </span><span>@talgiat the main problem I’d see with doing something like that is that the query may become a performance problem</span></div><div id="t1521648340000937" t="2018-03-21 16:05:40 mikerod It would be heavily hit since it’s working memory will change any time any fact in working memory is inserted/retracted (including from truth maintenance)"><a href="#t1521648340000937" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-21</span> <span class="t" onclick="H(this)">16:05:40</span>                 mikerod </span><span>It would be heavily hit since it’s working memory will change any time any fact in working memory is inserted/retracted (including from truth maintenance)</span></div><div id="t1521648436000603" t="2018-03-21 16:07:16 mikerod You could probably do what you ask though:
 (r/defquery []
  [?o &lt;- Object]
  [:test (not (isa? (type ?o) ExcludedType))])

"><a href="#t1521648436000603" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-21</span> <span class="t" onclick="H(this)">16:07:16</span>                 mikerod </span><span>You could probably do what you ask though:
</span><pre>(r/defquery []
  [?o &lt;- Object]
  [:test (not (isa? (type ?o) ExcludedType))])

</pre></div><div id="t1521648452000613" t="2018-03-21 16:07:32 mikerod If you have a custom  :fact-type-fn  you could still accomplish similar"><a href="#t1521648452000613" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-21</span> <span class="t" onclick="H(this)">16:07:32</span>                 mikerod </span><span>If you have a custom </span><code>:fact-type-fn</code><span> you could still accomplish similar</span></div><div id="t1521649818000479" t="2018-03-21 16:30:18 talgiat I do have a :fact-type-fn"><a href="#t1521649818000479" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-21</span> <span class="t" onclick="H(this)">16:30:18</span>                 talgiat </span><span>I do have a :fact-type-fn</span></div><div id="t1521651683000927" t="2018-03-21 17:01:23 mikerod @talgiat you’d have to define an hierarchy then more than likely"><a href="#t1521651683000927" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-21</span> <span class="t" onclick="H(this)">17:01:23</span>                 mikerod </span><span>@talgiat you’d have to define an hierarchy then more than likely</span></div><div id="t1521651731000367" t="2018-03-21 17:02:11 mikerod See  http://www.clara-rules.org/docs/fact_type_customization/"><a href="#t1521651731000367" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-21</span> <span class="t" onclick="H(this)">17:02:11</span>                 mikerod </span><span>See </span><a href="http://www.clara-rules.org/docs/fact_type_customization/" target="_blank">http://www.clara-rules.org/docs/fact_type_customization/</a></div><div id="t1521651763000747" t="2018-03-21 17:02:43 mikerod Potentially you could  derive  all your types to a common ancestor type."><a href="#t1521651763000747" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-21</span> <span class="t" onclick="H(this)">17:02:43</span>                 mikerod </span><span>Potentially you could </span><code>derive</code><span> all your types to a common ancestor type.</span></div><div id="t1521651808000342" t="2018-03-21 17:03:28 mikerod You could leave out the excluded type from that grouping too, and then your query would just be  r/defquery my-q [] [?x &lt;- :parent-type]"><a href="#t1521651808000342" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-21</span> <span class="t" onclick="H(this)">17:03:28</span>                 mikerod </span><span>You could leave out the excluded type from that grouping too, and then your query would just be </span><code>r/defquery my-q [] [?x &lt;- :parent-type]</code></div><div id="t1521652373000314" t="2018-03-21 17:12:53 talgiat yeah, thought about that"><a href="#t1521652373000314" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-21</span> <span class="t" onclick="H(this)">17:12:53</span>                 talgiat </span><span>yeah, thought about that</span></div><div id="t1521652389000778" t="2018-03-21 17:13:09 talgiat prob. better with records implementing a common protocol that will be the parent"><a href="#t1521652389000778" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-21</span> <span class="t" onclick="H(this)">17:13:09</span>                 talgiat </span><span>prob. better with records implementing a common protocol that will be the parent</span></div><div id="t1521655355000087" t="2018-03-21 18:02:35 mikerod @talgiat it can go either way really"><a href="#t1521655355000087" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-21</span> <span class="t" onclick="H(this)">18:02:35</span>                 mikerod </span><span>@talgiat it can go either way really</span></div><div id="t1522266714000241" t="2018-03-28 19:51:54 talgiat Is there a way to have a short circuiting :or in clara, not sure why it is designed that way"><a href="#t1522266714000241" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-28</span> <span class="t" onclick="H(this)">19:51:54</span>                 talgiat </span><span>Is there a way to have a short circuiting :or in clara, not sure why it is designed that way</span></div><div id="t1522266770000546" t="2018-03-28 19:52:50 mikerod @talgiat they aren’t meant for that. They are mostly just syntax sugar for multiple rules"><a href="#t1522266770000546" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-28</span> <span class="t" onclick="H(this)">19:52:50</span>                 mikerod </span><span>@talgiat they aren’t meant for that. They are mostly just syntax sugar for multiple rules</span></div><div id="t1522266787000656" t="2018-03-28 19:53:07 mikerod In the case of you were sharing the stuff around the  :or  (prior conditions) and the RHS"><a href="#t1522266787000656" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-28</span> <span class="t" onclick="H(this)">19:53:07</span>                 mikerod </span><span>In the case of you were sharing the stuff around the </span><code>:or</code><span> (prior conditions) and the RHS</span></div><div id="t1522266809000175" t="2018-03-28 19:53:29 mikerod you can implement a “short circuit ” pattern via multiple rules by making rules that are prioritized over one another"><a href="#t1522266809000175" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-28</span> <span class="t" onclick="H(this)">19:53:29</span>                 mikerod </span><span>you can implement a “short circuit ” pattern via multiple rules by making rules that are prioritized over one another</span></div><div id="t1522266835000211" t="2018-03-28 19:53:55 talgiat can you give an example?"><a href="#t1522266835000211" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-28</span> <span class="t" onclick="H(this)">19:53:55</span>                 talgiat </span><span>can you give an example?</span></div><div id="t1522266972000517" t="2018-03-28 19:56:12 mikerod here is one I made for unrelated reasons mostly  https://gist.github.com/mrrodriguez/6a6f8373b25d69826b3efe154c928fac"><a href="#t1522266972000517" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-28</span> <span class="t" onclick="H(this)">19:56:12</span>                 mikerod </span><span>here is one I made for unrelated reasons mostly </span><a href="https://gist.github.com/mrrodriguez/6a6f8373b25d69826b3efe154c928fac" target="_blank">https://gist.github.com/mrrodriguez/6a6f8373b25d69826b3efe154c928fac</a></div><div id="t1522266990000023" t="2018-03-28 19:56:30 mikerod I can probably do a shorter one in a min"><a href="#t1522266990000023" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-28</span> <span class="t" onclick="H(this)">19:56:30</span>                 mikerod </span><span>I can probably do a shorter one in a min</span></div><div id="t1522267055000416" t="2018-03-28 19:57:35 talgiat yeah this example is in response to my colleague"><a href="#t1522267055000416" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-28</span> <span class="t" onclick="H(this)">19:57:35</span>                 talgiat </span><span>yeah this example is in response to my colleague</span></div><div id="t1522267061000641" t="2018-03-28 19:57:41 talgiat we’re working on the same problem"><a href="#t1522267061000641" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-28</span> <span class="t" onclick="H(this)">19:57:41</span>                 talgiat </span><span>we’re working on the same problem</span></div><div id="t1522267087000527" t="2018-03-28 19:58:07 talgiat just seems kinda hackish"><a href="#t1522267087000527" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-28</span> <span class="t" onclick="H(this)">19:58:07</span>                 talgiat </span><span>just seems kinda hackish</span></div><div id="t1522267096000353" t="2018-03-28 19:58:16 talgiat also you need to know about the other rules"><a href="#t1522267096000353" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-28</span> <span class="t" onclick="H(this)">19:58:16</span>                 talgiat </span><span>also you need to know about the other rules</span></div><div id="t1522267118000182" t="2018-03-28 19:58:38 mikerod (r/defrule short-circuit
  [X] ;; whatever here
  =&gt;
  (r/insert! &lt;your fact here&gt;
             :rule-marker/short-circuit))

(defrule fallback
  [:not [:rule-marker/short-circuit]]
  [Y]
  =&gt;
  (r/insert! &lt;your fact here&gt;))
"><a href="#t1522267118000182" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-28</span> <span class="t" onclick="H(this)">19:58:38</span>                 mikerod </span><pre>(r/defrule short-circuit
  [X] ;; whatever here
  =&gt;
  (r/insert! &lt;your fact here&gt;
             :rule-marker/short-circuit))

(defrule fallback
  [:not [:rule-marker/short-circuit]]
  [Y]
  =&gt;
  (r/insert! &lt;your fact here&gt;))
</pre></div><div id="t1522267124000564" t="2018-03-28 19:58:44 mikerod I see"><a href="#t1522267124000564" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-28</span> <span class="t" onclick="H(this)">19:58:44</span>                 mikerod </span><span>I see</span></div><div id="t1522267158000742" t="2018-03-28 19:59:18 mikerod I don’t know that I see it as hackish. I do understand it could be brittle to more rules added"><a href="#t1522267158000742" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-28</span> <span class="t" onclick="H(this)">19:59:18</span>                 mikerod </span><span>I don’t know that I see it as hackish. I do understand it could be brittle to more rules added</span></div><div id="t1522267160000551" t="2018-03-28 19:59:20 talgiat here is what we have"><a href="#t1522267160000551" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-28</span> <span class="t" onclick="H(this)">19:59:20</span>                 talgiat </span><span>here is what we have</span></div><div id="t1522267162000319" t="2018-03-28 19:59:22 talgiat  `"><a href="#t1522267162000319" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-28</span> <span class="t" onclick="H(this)">19:59:22</span>                 talgiat </span><code></code><span>`</span></div><div id="t1522267163000320" t="2018-03-28 19:59:23 talgiat (defrule premium-video
  [Video (= ?id id)]
  [:or
    [PremiumChannels (= id ?id)]
    [LessThanTwoHours (= id ?id)]
    [PremiumTopics (= id ?id)]]
  =&gt;
  (insert! (create-rule-result -&gt;MarketplacePremiumVideoContent ?id (-&gt;Rule 1 “Premium Video” :points 6)))))"><a href="#t1522267163000320" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-28</span> <span class="t" onclick="H(this)">19:59:23</span>                 talgiat </span><span>(defrule premium-video
  [Video (= ?id id)]
  [:or
    [PremiumChannels (= id ?id)]
    [LessThanTwoHours (= id ?id)]
    [PremiumTopics (= id ?id)]]
  =&gt;
  (insert! (create-rule-result -&gt;MarketplacePremiumVideoContent ?id (-&gt;Rule 1 “Premium Video” :points 6)))))</span></div><div id="t1522267165000392" t="2018-03-28 19:59:25 talgiat  `"><a href="#t1522267165000392" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-28</span> <span class="t" onclick="H(this)">19:59:25</span>                 talgiat </span><code></code><span>`</span></div><div id="t1522267177000548" t="2018-03-28 19:59:37 talgiat ignore the create rule-result"><a href="#t1522267177000548" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-28</span> <span class="t" onclick="H(this)">19:59:37</span>                 talgiat </span><span>ignore the create rule-result</span></div><div id="t1522267181000103" t="2018-03-28 19:59:41 mikerod however a big short-circuiting  :or  would also be just order dependent on all the logic pushed into it"><a href="#t1522267181000103" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-28</span> <span class="t" onclick="H(this)">19:59:41</span>                 mikerod </span><span>however a big short-circuiting </span><code>:or</code><span> would also be just order dependent on all the logic pushed into it</span></div><div id="t1522267213000036" t="2018-03-28 20:00:13 mikerod another thing you can do"><a href="#t1522267213000036" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-28</span> <span class="t" onclick="H(this)">20:00:13</span>                 mikerod </span><span>another thing you can do</span></div><div id="t1522267219000677" t="2018-03-28 20:00:19 mikerod Is let the  :or  fire as much as it can"><a href="#t1522267219000677" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-28</span> <span class="t" onclick="H(this)">20:00:19</span>                 mikerod </span><span>Is let the </span><code>:or</code><span> fire as much as it can</span></div><div id="t1522267227000412" t="2018-03-28 20:00:27 mikerod then reconcile in a separate rule to “choose the best”"><a href="#t1522267227000412" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-28</span> <span class="t" onclick="H(this)">20:00:27</span>                 mikerod </span><span>then reconcile in a separate rule to “choose the best”</span></div><div id="t1522267238000577" t="2018-03-28 20:00:38 talgiat there is no best per se"><a href="#t1522267238000577" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-28</span> <span class="t" onclick="H(this)">20:00:38</span>                 talgiat </span><span>there is no best per se</span></div><div id="t1522267247000598" t="2018-03-28 20:00:47 talgiat they are all equal importance"><a href="#t1522267247000598" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-28</span> <span class="t" onclick="H(this)">20:00:47</span>                 talgiat </span><span>they are all equal importance</span></div><div id="t1522267260000089" t="2018-03-28 20:01:00 mikerod so what is the reason to want short-circuit"><a href="#t1522267260000089" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-28</span> <span class="t" onclick="H(this)">20:01:00</span>                 mikerod </span><span>so what is the reason to want short-circuit</span></div><div id="t1522267274000546" t="2018-03-28 20:01:14 mikerod Do you just not want multiple facts inserted?"><a href="#t1522267274000546" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-28</span> <span class="t" onclick="H(this)">20:01:14</span>                 mikerod </span><span>Do you just not want multiple facts inserted?</span></div><div id="t1522267284000526" t="2018-03-28 20:01:24 talgiat  `"><a href="#t1522267284000526" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-28</span> <span class="t" onclick="H(this)">20:01:24</span>                 talgiat </span><code></code><span>`</span></div><div id="t1522267291000314" t="2018-03-28 20:01:31 talgiat (defrule premium-video
  [Video (= ?id id)]
  [:not [MarketplacePremiumVideoContent (= id ?id)]]
  [:or
    [PremiumChannels (= id ?id)]
    [LessThanTwoHours (= id ?id)]
    [PremiumTopics (= id ?id)]]
  =&gt;
  (insert! (create-rule-result -&gt;MarketplacePremiumVideoContent ?id (-&gt;Rule 1 &quot;Premium Video&quot; :points 6)))))
"><a href="#t1522267291000314" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-28</span> <span class="t" onclick="H(this)">20:01:31</span>                 talgiat </span><pre>(defrule premium-video
  [Video (= ?id id)]
  [:not [MarketplacePremiumVideoContent (= id ?id)]]
  [:or
    [PremiumChannels (= id ?id)]
    [LessThanTwoHours (= id ?id)]
    [PremiumTopics (= id ?id)]]
  =&gt;
  (insert! (create-rule-result -&gt;MarketplacePremiumVideoContent ?id (-&gt;Rule 1 &quot;Premium Video&quot; :points 6)))))
</pre></div><div id="t1522267293000844" t="2018-03-28 20:01:33 talgiat I tried this"><a href="#t1522267293000844" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-28</span> <span class="t" onclick="H(this)">20:01:33</span>                 talgiat </span><span>I tried this</span></div><div id="t1522267301000560" t="2018-03-28 20:01:41 talgiat but it went to an infinite loop"><a href="#t1522267301000560" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-28</span> <span class="t" onclick="H(this)">20:01:41</span>                 talgiat </span><span>but it went to an infinite loop</span></div><div id="t1522267303000544" t="2018-03-28 20:01:43 talgiat not sure why"><a href="#t1522267303000544" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-28</span> <span class="t" onclick="H(this)">20:01:43</span>                 talgiat </span><span>not sure why</span></div><div id="t1522267313000332" t="2018-03-28 20:01:53 talgiat yeah I just want one fact to be inserted"><a href="#t1522267313000332" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-28</span> <span class="t" onclick="H(this)">20:01:53</span>                 talgiat </span><span>yeah I just want one fact to be inserted</span></div><div id="t1522267338000403" t="2018-03-28 20:02:18 mikerod (r/defrule rule-with-or
  [:or
   [A]
   [B]
   [C]]
  =&gt;
  (r/insert! (-&gt;FoundIt)))

(r/defrule aggregate-found
  [?found &lt;- (acc/all) :from [FoundIt]]
 [:test (seq ?found)]
  =&gt;
  (r/insert! (do-aggregation ?found)))
"><a href="#t1522267338000403" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-28</span> <span class="t" onclick="H(this)">20:02:18</span>                 mikerod </span><pre>(r/defrule rule-with-or
  [:or
   [A]
   [B]
   [C]]
  =&gt;
  (r/insert! (-&gt;FoundIt)))

(r/defrule aggregate-found
  [?found &lt;- (acc/all) :from [FoundIt]]
 [:test (seq ?found)]
  =&gt;
  (r/insert! (do-aggregation ?found)))
</pre></div><div id="t1522267343000084" t="2018-03-28 20:02:23 mikerod Insert a middle-fact"><a href="#t1522267343000084" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-28</span> <span class="t" onclick="H(this)">20:02:23</span>                 mikerod </span><span>Insert a middle-fact</span></div><div id="t1522267350000324" t="2018-03-28 20:02:30 mikerod that you aggregate to a single fact"><a href="#t1522267350000324" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-28</span> <span class="t" onclick="H(this)">20:02:30</span>                 mikerod </span><span>that you aggregate to a single fact</span></div><div id="t1522267356000616" t="2018-03-28 20:02:36 mikerod for “downstream” rules to only see 1 fact"><a href="#t1522267356000616" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-28</span> <span class="t" onclick="H(this)">20:02:36</span>                 mikerod </span><span>for “downstream” rules to only see 1 fact</span></div><div id="t1522267373000349" t="2018-03-28 20:02:53 mikerod this can be either a  merge  or just pick one if they are all the same, etc"><a href="#t1522267373000349" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-28</span> <span class="t" onclick="H(this)">20:02:53</span>                 mikerod </span><span>this can be either a </span><code>merge</code><span> or just pick one if they are all the same, etc</span></div><div id="t1522267396000311" t="2018-03-28 20:03:16 mikerod (r/defrule aggregate-found
  [?found &lt;- (acc/all) :from [FoundIt]]
 [:test (seq ?found)]
  =&gt;
;; They are all the same, so I dont&apos; care
  (r/insert! (first ?found)))

"><a href="#t1522267396000311" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-28</span> <span class="t" onclick="H(this)">20:03:16</span>                 mikerod </span><pre>(r/defrule aggregate-found
  [?found &lt;- (acc/all) :from [FoundIt]]
 [:test (seq ?found)]
  =&gt;
;; They are all the same, so I dont&apos; care
  (r/insert! (first ?found)))

</pre></div><div id="t1522267417000123" t="2018-03-28 20:03:37 mikerod I should add a non-empty check to just avoid useless fires"><a href="#t1522267417000123" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-28</span> <span class="t" onclick="H(this)">20:03:37</span>                 mikerod </span><span>I should add a non-empty check to just avoid useless fires</span></div><div id="t1522267510000414" t="2018-03-28 20:05:10 mikerod &gt; but it went to an infinite loop

I believe your rule is invalidating itself"><a href="#t1522267510000414" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-28</span> <span class="t" onclick="H(this)">20:05:10</span>                 mikerod </span><span>&gt; but it went to an infinite loop

I believe your rule is invalidating itself</span></div><div id="t1522267513000245" t="2018-03-28 20:05:13 mikerod logically"><a href="#t1522267513000245" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-28</span> <span class="t" onclick="H(this)">20:05:13</span>                 mikerod </span><span>logically</span></div><div id="t1522267521000376" t="2018-03-28 20:05:21 mikerod however, I don’t know for sure not knowing what  create-rule-result  does"><a href="#t1522267521000376" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-28</span> <span class="t" onclick="H(this)">20:05:21</span>                 mikerod </span><span>however, I don’t know for sure not knowing what </span><code>create-rule-result</code><span> does</span></div><div id="t1522267544000650" t="2018-03-28 20:05:44 talgiat it just creates a record and adds some other metadata to it"><a href="#t1522267544000650" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-28</span> <span class="t" onclick="H(this)">20:05:44</span>                 talgiat </span><span>it just creates a record and adds some other metadata to it</span></div><div id="t1522267547000549" t="2018-03-28 20:05:47 mikerod if somehow the RHS (or later rule) leads to a  MarketplacePremiumVideoContent  to be inserted with that  ?id  then you’d get a loop"><a href="#t1522267547000549" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-28</span> <span class="t" onclick="H(this)">20:05:47</span>                 mikerod </span><span>if somehow the RHS (or later rule) leads to a </span><code>MarketplacePremiumVideoContent</code><span> to be inserted with that </span><code>?id</code><span> then you’d get a loop</span></div><div id="t1522267563000082" t="2018-03-28 20:06:03 mikerod because it’d get inserted, which would make the  :not  become false"><a href="#t1522267563000082" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-28</span> <span class="t" onclick="H(this)">20:06:03</span>                 mikerod </span><span>because it’d get inserted, which would make the </span><code>:not</code><span> become false</span></div><div id="t1522267566000751" t="2018-03-28 20:06:06 mikerod so it’d be retracted"><a href="#t1522267566000751" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-28</span> <span class="t" onclick="H(this)">20:06:06</span>                 mikerod </span><span>so it’d be retracted</span></div><div id="t1522267589000018" t="2018-03-28 20:06:29 mikerod but then  :not  would be true again, so it’d get reinserted, but then  :not  would be false again, so it’d be retracted - and repeat"><a href="#t1522267589000018" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-28</span> <span class="t" onclick="H(this)">20:06:29</span>                 mikerod </span><span>but then </span><code>:not</code><span> would be true again, so it’d get reinserted, but then </span><code>:not</code><span> would be false again, so it’d be retracted - and repeat</span></div><div id="t1522267593000515" t="2018-03-28 20:06:33 talgiat I see"><a href="#t1522267593000515" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-28</span> <span class="t" onclick="H(this)">20:06:33</span>                 talgiat </span><span>I see</span></div><div id="t1522267606000186" t="2018-03-28 20:06:46 talgiat yeah, a bit of a mind bender"><a href="#t1522267606000186" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-28</span> <span class="t" onclick="H(this)">20:06:46</span>                 talgiat </span><span>yeah, a bit of a mind bender</span></div><div id="t1522267608000304" t="2018-03-28 20:06:48 talgiat 🙂"><a href="#t1522267608000304" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-28</span> <span class="t" onclick="H(this)">20:06:48</span>                 talgiat </span><b>🙂</b></div><div id="t1522267617000504" t="2018-03-28 20:06:57 mikerod it’s best to try to think of the rules as declarative and order-independent"><a href="#t1522267617000504" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-28</span> <span class="t" onclick="H(this)">20:06:57</span>                 mikerod </span><span>it’s best to try to think of the rules as declarative and order-independent</span></div><div id="t1522267620000621" t="2018-03-28 20:07:00 mikerod where possible"><a href="#t1522267620000621" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-28</span> <span class="t" onclick="H(this)">20:07:00</span>                 mikerod </span><span>where possible</span></div><div id="t1522267623000295" t="2018-03-28 20:07:03 talgiat at least for people who are not used to rule engines or logic programming"><a href="#t1522267623000295" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-28</span> <span class="t" onclick="H(this)">20:07:03</span>                 talgiat </span><span>at least for people who are not used to rule engines or logic programming</span></div><div id="t1522267647000485" t="2018-03-28 20:07:27 mikerod and their job is to bring working memory into a steady and logically consistent state with all of the LHS of all rules"><a href="#t1522267647000485" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-28</span> <span class="t" onclick="H(this)">20:07:27</span>                 mikerod </span><span>and their job is to bring working memory into a steady and logically consistent state with all of the LHS of all rules</span></div><div id="t1522267661000682" t="2018-03-28 20:07:41 mikerod It can be a trick sometimes"><a href="#t1522267661000682" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-28</span> <span class="t" onclick="H(this)">20:07:41</span>                 mikerod </span><span>It can be a trick sometimes</span></div><div id="t1522267687000461" t="2018-03-28 20:08:07 talgiat the multiple inserts don’t impact our end results correctness"><a href="#t1522267687000461" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-28</span> <span class="t" onclick="H(this)">20:08:07</span>                 talgiat </span><span>the multiple inserts don’t impact our end results correctness</span></div><div id="t1522267696000224" t="2018-03-28 20:08:16 talgiat I just noticed it when testing and didn’t understand why"><a href="#t1522267696000224" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-28</span> <span class="t" onclick="H(this)">20:08:16</span>                 talgiat </span><span>I just noticed it when testing and didn’t understand why</span></div><div id="t1522267707000258" t="2018-03-28 20:08:27 talgiat but thanks so much for the clarification"><a href="#t1522267707000258" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-28</span> <span class="t" onclick="H(this)">20:08:27</span>                 talgiat </span><span>but thanks so much for the clarification</span></div><div id="t1522267774000529" t="2018-03-28 20:09:34 mikerod yeah, I find the “aggregating” to one idea common"><a href="#t1522267774000529" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-28</span> <span class="t" onclick="H(this)">20:09:34</span>                 mikerod </span><span>yeah, I find the “aggregating” to one idea common</span></div><div id="t1522267790000057" t="2018-03-28 20:09:50 mikerod I think the main takeaway is that the rules don’t short-circuit or control “duplcates” for you"><a href="#t1522267790000057" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-28</span> <span class="t" onclick="H(this)">20:09:50</span>                 mikerod </span><span>I think the main takeaway is that the rules don’t short-circuit or control “duplcates” for you</span></div><div id="t1522267795000488" t="2018-03-28 20:09:55 mikerod it lets you decide what makes sense there"><a href="#t1522267795000488" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-28</span> <span class="t" onclick="H(this)">20:09:55</span>                 mikerod </span><span>it lets you decide what makes sense there</span></div><div id="t1522267811000097" t="2018-03-28 20:10:11 mikerod I’d say though, don’t be afraid to introduce “intermediate facts”"><a href="#t1522267811000097" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-28</span> <span class="t" onclick="H(this)">20:10:11</span>                 mikerod </span><span>I’d say though, don’t be afraid to introduce “intermediate facts”</span></div><div id="t1522267817000463" t="2018-03-28 20:10:17 mikerod to tie multiple rules together"><a href="#t1522267817000463" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-28</span> <span class="t" onclick="H(this)">20:10:17</span>                 mikerod </span><span>to tie multiple rules together</span></div><div id="t1522267854000429" t="2018-03-28 20:10:54 talgiat Yeah that makes sense"><a href="#t1522267854000429" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-28</span> <span class="t" onclick="H(this)">20:10:54</span>                 talgiat </span><span>Yeah that makes sense</span></div><div id="t1522267874000561" t="2018-03-28 20:11:14 mikerod So  rule-with-multiple-duplicate-inserts-possible  and  aggregate-the-duplicates  rules with an intermediate/ephemeral fact between the two"><a href="#t1522267874000561" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-28</span> <span class="t" onclick="H(this)">20:11:14</span>                 mikerod </span><span>So </span><code>rule-with-multiple-duplicate-inserts-possible</code><span> and </span><code>aggregate-the-duplicates</code><span> rules with an intermediate/ephemeral fact between the two</span></div><div id="t1522267887000546" t="2018-03-28 20:11:27 mikerod then most other “downstream” rules just take the aggregated selection fact"><a href="#t1522267887000546" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-28</span> <span class="t" onclick="H(this)">20:11:27</span>                 mikerod </span><span>then most other “downstream” rules just take the aggregated selection fact</span></div><div id="t1522267907000320" t="2018-03-28 20:11:47 mikerod Later on, there may be more complex reasoning in the  aggregate-the-duplicates  than just “take one”"><a href="#t1522267907000320" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-28</span> <span class="t" onclick="H(this)">20:11:47</span>                 mikerod </span><span>Later on, there may be more complex reasoning in the </span><code>aggregate-the-duplicates</code><span> than just “take one”</span></div><div id="t1522267926000658" t="2018-03-28 20:12:06 talgiat yeah in our case it really doesn’t matter"><a href="#t1522267926000658" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-28</span> <span class="t" onclick="H(this)">20:12:06</span>                 talgiat </span><span>yeah in our case it really doesn’t matter</span></div><div id="t1522267930000410" t="2018-03-28 20:12:10 mikerod if for example, they are no longer complete duplicates, or perhaps you want to count how many times it was “true” by counting the duplicates"><a href="#t1522267930000410" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-28</span> <span class="t" onclick="H(this)">20:12:10</span>                 mikerod </span><span>if for example, they are no longer complete duplicates, or perhaps you want to count how many times it was “true” by counting the duplicates</span></div><div id="t1522267933000772" t="2018-03-28 20:12:13 mikerod sure"><a href="#t1522267933000772" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-28</span> <span class="t" onclick="H(this)">20:12:13</span>                 mikerod </span><span>sure</span></div><div id="t1522267947000620" t="2018-03-28 20:12:27 talgiat but I see the point"><a href="#t1522267947000620" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-28</span> <span class="t" onclick="H(this)">20:12:27</span>                 talgiat </span><span>but I see the point</span></div><div id="t1522267955000140" t="2018-03-28 20:12:35 mikerod It’s been discussed before to have a working-memory-as-a-set sort of Clara mode"><a href="#t1522267955000140" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-28</span> <span class="t" onclick="H(this)">20:12:35</span>                 mikerod </span><span>It’s been discussed before to have a working-memory-as-a-set sort of Clara mode</span></div><div id="t1522267962000021" t="2018-03-28 20:12:42 talgiat I just think it’ll helpful to have a real or"><a href="#t1522267962000021" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-28</span> <span class="t" onclick="H(this)">20:12:42</span>                 talgiat </span><span>I just think it’ll helpful to have a real or</span></div><div id="t1522267974000039" t="2018-03-28 20:12:54 talgiat instead of doing the heavy lifting yourself"><a href="#t1522267974000039" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-28</span> <span class="t" onclick="H(this)">20:12:54</span>                 talgiat </span><span>instead of doing the heavy lifting yourself</span></div><div id="t1522267982000542" t="2018-03-28 20:13:02 talgiat like a purposeful or"><a href="#t1522267982000542" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-28</span> <span class="t" onclick="H(this)">20:13:02</span>                 talgiat </span><span>like a purposeful or</span></div><div id="t1522268006000676" t="2018-03-28 20:13:26 mikerod where there were never duplicates inserted, etc. Drools does that by default with logical insert (managed by truth maintenance). However, it does have a performance cost to manage a set for working memory (frequent hash code calculations etc) and also, it isn’t always what people want"><a href="#t1522268006000676" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-28</span> <span class="t" onclick="H(this)">20:13:26</span>                 mikerod </span><span>where there were never duplicates inserted, etc. Drools does that by default with logical insert (managed by truth maintenance). However, it does have a performance cost to manage a set for working memory (frequent hash code calculations etc) and also, it isn’t always what people want</span></div><div id="t1522268019000574" t="2018-03-28 20:13:39 mikerod sometimes “cardinality” of duplicate facts inserted can matter to the rule logic"><a href="#t1522268019000574" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-28</span> <span class="t" onclick="H(this)">20:13:39</span>                 mikerod </span><span>sometimes “cardinality” of duplicate facts inserted can matter to the rule logic</span></div><div id="t1522268037000269" t="2018-03-28 20:13:57 talgiat true it can"><a href="#t1522268037000269" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-28</span> <span class="t" onclick="H(this)">20:13:57</span>                 talgiat </span><span>true it can</span></div><div id="t1522268043000174" t="2018-03-28 20:14:03 mikerod Something like a “short circuit” or could be done"><a href="#t1522268043000174" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-28</span> <span class="t" onclick="H(this)">20:14:03</span>                 mikerod </span><span>Something like a “short circuit” or could be done</span></div><div id="t1522268050000440" t="2018-03-28 20:14:10 talgiat but can’t I control which behavior I want"><a href="#t1522268050000440" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-28</span> <span class="t" onclick="H(this)">20:14:10</span>                 talgiat </span><span>but can’t I control which behavior I want</span></div><div id="t1522268052000547" t="2018-03-28 20:14:12 mikerod Easiest would be to just have it generate several rules"><a href="#t1522268052000547" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-28</span> <span class="t" onclick="H(this)">20:14:12</span>                 mikerod </span><span>Easiest would be to just have it generate several rules</span></div><div id="t1522268059000452" t="2018-03-28 20:14:19 mikerod that all do the “tiered” blocking pattern one one another"><a href="#t1522268059000452" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-28</span> <span class="t" onclick="H(this)">20:14:19</span>                 mikerod </span><span>that all do the “tiered” blocking pattern one one another</span></div><div id="t1522268073000394" t="2018-03-28 20:14:33 mikerod just generically"><a href="#t1522268073000394" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-28</span> <span class="t" onclick="H(this)">20:14:33</span>                 mikerod </span><span>just generically</span></div><div id="t1522268153000525" t="2018-03-28 20:15:53 mikerod also, there is nothing stopping you from making a higher-level macro that did the short-circuit rule generation pattern to normal Clara rules"><a href="#t1522268153000525" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-28</span> <span class="t" onclick="H(this)">20:15:53</span>                 mikerod </span><span>also, there is nothing stopping you from making a higher-level macro that did the short-circuit rule generation pattern to normal Clara rules</span></div><div id="t1522268167000496" t="2018-03-28 20:16:07 mikerod If you were sufficiently motivated and had enough places you foudn it useful hah"><a href="#t1522268167000496" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-28</span> <span class="t" onclick="H(this)">20:16:07</span>                 mikerod </span><span>If you were sufficiently motivated and had enough places you foudn it useful hah</span></div><div id="t1522268899000407" t="2018-03-28 20:28:19 talgiat Yeah, can do a macro"><a href="#t1522268899000407" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-28</span> <span class="t" onclick="H(this)">20:28:19</span>                 talgiat </span><span>Yeah, can do a macro</span></div><div id="t1522269351000381" t="2018-03-28 20:35:51 wparker Agreed on all @mikerod’s comments - I just wanted to mention that you don’t necessarily have to use a macro generating “defrule” calls, Clara can take rules as data structures if you prefer to go that way (easier in clj than cljs though)"><a href="#t1522269351000381" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-28</span> <span class="t" onclick="H(this)">20:35:51</span>                 wparker </span><span>Agreed on all @mikerod’s comments - I just wanted to mention that you don’t necessarily have to use a macro generating “defrule” calls, Clara can take rules as data structures if you prefer to go that way (easier in clj than cljs though)</span></div><div id="t1522269426000353" t="2018-03-28 20:37:06 wparker It seems the infinite looping behavior has tripped a lot of people up - we should probably add a page to the  http://clara-rules.org  site on that somewhere.  I’ve also logged an issue before to fail in that scenario analogously to StackOverflowException, just haven’t ever gotten around to it"><a href="#t1522269426000353" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-28</span> <span class="t" onclick="H(this)">20:37:06</span>                 wparker </span><span>It seems the infinite looping behavior has tripped a lot of people up - we should probably add a page to the </span><a href="http://clara-rules.org" target="_blank">http://clara-rules.org</a><span> site on that somewhere.  I’ve also logged an issue before to fail in that scenario analogously to StackOverflowException, just haven’t ever gotten around to it</span></div><div id="t1522726003000115" t="2018-04-03 03:26:43 alex-dixon May have seen this. Was the proposal for a max number of iterations per rule?"><a href="#t1522726003000115" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-04-03</span> <span class="t" onclick="H(this)">03:26:43</span>                   alex-dixon </span><span>May have seen this. Was the proposal for a max number of iterations per rule?</span></div><div id="t1522269543000730" t="2018-03-28 20:39:03 wparker My personal mental model of rules is (I think similar to his) that when using truth maintenance they are like statements that “for each join of things in these sets, these other things must exist”.  Declarative logic, like SQL or even Excel"><a href="#t1522269543000730" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-03-28</span> <span class="t" onclick="H(this)">20:39:03</span>                 wparker </span><span>My personal mental model of rules is (I think similar to his) that when using truth maintenance they are like statements that “for each join of things in these sets, these other things must exist”.  Declarative logic, like SQL or even Excel</span></div><div id="t1522705861000406" t="2018-04-02 21:51:01 ggaillard I have some business processes that end up reading/saving data from and to a relational database. Some of my logic is pure, and some of it need this shared mutable state. Is there an idiomatic or clean way to handle side effects in clara ? It would be great if I could, for example, rollback a transaction in my database when the fact that caused the corresponding side effect is retracted … don&apos;t know if it&apos;s a sane way to tackle the problem thought…"><a href="#t1522705861000406" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-04-02</span> <span class="t" onclick="H(this)">21:51:01</span>               ggaillard </span><span>I have some business processes that end up reading/saving data from and to a relational database. Some of my logic is pure, and some of it need this shared mutable state. Is there an idiomatic or clean way to handle side effects in clara ? It would be great if I could, for example, rollback a transaction in my database when the fact that caused the corresponding side effect is retracted … don&apos;t know if it&apos;s a sane way to tackle the problem thought…</span></div><div id="t1522723085000069" t="2018-04-03 02:38:05 mikerod @ggaillard when you perform the side-effect, you can insert a fact that indicates that the side effect was performed"><a href="#t1522723085000069" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-04-03</span> <span class="t" onclick="H(this)">02:38:05</span>                 mikerod </span><span>@ggaillard when you perform the side-effect, you can insert a fact that indicates that the side effect was performed</span></div><div id="t1522723124000103" t="2018-04-03 02:38:44 mikerod you can then have a rule that uses that to “retract” the side effects"><a href="#t1522723124000103" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-04-03</span> <span class="t" onclick="H(this)">02:38:44</span>                 mikerod </span><span>you can then have a rule that uses that to “retract” the side effects</span></div><div id="t1522723168000034" t="2018-04-03 02:39:28 mikerod you likely need to make these effects “idempotent” so they can be replaced multiple times without causing issues"><a href="#t1522723168000034" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-04-03</span> <span class="t" onclick="H(this)">02:39:28</span>                 mikerod </span><span>you likely need to make these effects “idempotent” so they can be replaced multiple times without causing issues</span></div><div id="t1522723349000039" t="2018-04-03 02:42:29 mikerod maybe something like
 (r/defrule do-thing
  [A (= v :something) (= ?id id)]
  =&gt;
  (do-side-effect ?a)
  (r/insert! (-&gt;DidSideEffectFor ?id)))

(r/defrule undo-thing
  [?effect-data &lt;- DidSideEffectFor (= ?id id)]
  [:not [A (= ?id id)]]
  =&gt;
  (retract-side-effect ?effect-data))
 

Assumes you have a way to link facts up, like an ID. This doesn’t attempt to remove the 
 DidSideEffectFor  facts. So if this is a long running process, this may start to add up as too much data in memory"><a href="#t1522723349000039" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-04-03</span> <span class="t" onclick="H(this)">02:42:29</span>                 mikerod </span><span>maybe something like
</span><pre>(r/defrule do-thing
  [A (= v :something) (= ?id id)]
  =&gt;
  (do-side-effect ?a)
  (r/insert! (-&gt;DidSideEffectFor ?id)))

(r/defrule undo-thing
  [?effect-data &lt;- DidSideEffectFor (= ?id id)]
  [:not [A (= ?id id)]]
  =&gt;
  (retract-side-effect ?effect-data))
</pre><span>

Assumes you have a way to link facts up, like an ID. This doesn’t attempt to remove the 
</span><code>DidSideEffectFor</code><span> facts. So if this is a long running process, this may start to add up as too much data in memory</span></div><div id="t1522723377000062" t="2018-04-03 02:42:57 mikerod If that’s the case, you may just want to handle the side-effects externally and clean up the  DidSideEffectFor  as well"><a href="#t1522723377000062" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-04-03</span> <span class="t" onclick="H(this)">02:42:57</span>                 mikerod </span><span>If that’s the case, you may just want to handle the side-effects externally and clean up the </span><code>DidSideEffectFor</code><span> as well</span></div><div id="t1522723649000149" t="2018-04-03 02:47:29 mikerod My post on ways to update facts may be somewhat related to, if you are interested
 http://www.metasimple.org/2017/12/23/clara-updating-facts.html"><a href="#t1522723649000149" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-04-03</span> <span class="t" onclick="H(this)">02:47:29</span>                 mikerod </span><span>My post on ways to update facts may be somewhat related to, if you are interested
</span><a href="http://www.metasimple.org/2017/12/23/clara-updating-facts.html" target="_blank">http://www.metasimple.org/2017/12/23/clara-updating-facts.html</a></div><div id="t1522747572000347" t="2018-04-03 09:26:12 ggaillard Awesome answer! Thank you!"><a href="#t1522747572000347" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-04-03</span> <span class="t" onclick="H(this)">09:26:12</span>               ggaillard </span><span>Awesome answer! Thank you!</span></div><div id="t1522869551000193" t="2018-04-04 19:19:11 wparker Clara-rules 0.18.0 is released.  The release includes performance optimizations, a bugfix in error handling code, and new APIs targeted at ClojureScript library/platform developers consuming Clara.  The release adds a new listening method that anyone creating a custom listener will need to implement, but the implementation can just be an empty body so it is an easy uplift.  Additionally, the :rule-matches key in session inspection will now only have rules that led to logical insertions, with a new :unfiltered-rule-matches key now optionally available with a superset of the data previously in the :rule-matches.  For a discussion of the rationale behind this change see  https://github.com/cerner/clara-rules/issues/386"><a href="#t1522869551000193" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-04-04</span> <span class="t" onclick="H(this)">19:19:11</span>                 wparker </span><span>Clara-rules 0.18.0 is released.  The release includes performance optimizations, a bugfix in error handling code, and new APIs targeted at ClojureScript library/platform developers consuming Clara.  The release adds a new listening method that anyone creating a custom listener will need to implement, but the implementation can just be an empty body so it is an easy uplift.  Additionally, the :rule-matches key in session inspection will now only have rules that led to logical insertions, with a new :unfiltered-rule-matches key now optionally available with a superset of the data previously in the :rule-matches.  For a discussion of the rationale behind this change see </span><a href="https://github.com/cerner/clara-rules/issues/386" target="_blank">https://github.com/cerner/clara-rules/issues/386</a></div><div id="t1522961646000665" t="2018-04-05 20:54:06 sparkofreason Fellow clarians (?): linked is a draft of an article of describing some of the fun I&apos;ve been having using clara for UX. Any feedback greatly appreciated.  https://sparkofreason.gitbooks.io/maali/content/"><a href="#t1522961646000665" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-04-05</span> <span class="t" onclick="H(this)">20:54:06</span>           sparkofreason </span><span>Fellow clarians (?): linked is a draft of an article of describing some of the fun I&apos;ve been having using clara for UX. Any feedback greatly appreciated. </span><a href="https://sparkofreason.gitbooks.io/maali/content/" target="_blank">https://sparkofreason.gitbooks.io/maali/content/</a></div><div id="t1522967052000067" t="2018-04-05 22:24:12 sparkofreason Please DM or comment in the git book unless the topic is of broader relevance to clara."><a href="#t1522967052000067" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-04-05</span> <span class="t" onclick="H(this)">22:24:12</span>           sparkofreason </span><span>Please DM or comment in the git book unless the topic is of broader relevance to clara.</span></div><div id="t1523305189000181" t="2018-04-09 20:19:49 whilo hi"><a href="#t1523305189000181" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-04-09</span> <span class="t" onclick="H(this)">20:19:49</span>                   whilo </span><span>hi</span></div><div id="t1523305212000358" t="2018-04-09 20:20:12 whilo i have just stumbled over factui and finally realized that clara is like reactive dataflow base programming"><a href="#t1523305212000358" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-04-09</span> <span class="t" onclick="H(this)">20:20:12</span>                   whilo </span><span>i have just stumbled over factui and finally realized that clara is like reactive dataflow base programming</span></div><div id="t1523305220000116" t="2018-04-09 20:20:20 whilo https://github.com/frankmcsherry/differential-dataflow"><a href="#t1523305220000116" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-04-09</span> <span class="t" onclick="H(this)">20:20:20</span>                   whilo </span><a href="https://github.com/frankmcsherry/differential-dataflow" target="_blank">https://github.com/frankmcsherry/differential-dataflow</a></div><div id="t1523305256000203" t="2018-04-09 20:20:56 whilo i am working on datahike:  https://github.com/replikativ/datahike  and am wondering how i would stream datoms properly into clients with factui"><a href="#t1523305256000203" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-04-09</span> <span class="t" onclick="H(this)">20:20:56</span>                   whilo </span><span>i am working on datahike: </span><a href="https://github.com/replikativ/datahike" target="_blank">https://github.com/replikativ/datahike</a><span> and am wondering how i would stream datoms properly into clients with factui</span></div><div id="t1523312855000118" t="2018-04-09 22:27:35 whilo one idea would be to make clara&apos;s memory durable and do a joint database"><a href="#t1523312855000118" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-04-09</span> <span class="t" onclick="H(this)">22:27:35</span>                   whilo </span><span>one idea would be to make clara&apos;s memory durable and do a joint database</span></div><div id="t1523313684000353" t="2018-04-09 22:41:24 whilo so a simple approach would realize the web after tomorrow scenario of @tonsky  http://tonsky.me/blog/the-web-after-tomorrow/"><a href="#t1523313684000353" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-04-09</span> <span class="t" onclick="H(this)">22:41:24</span>                   whilo </span><span>so a simple approach would realize the web after tomorrow scenario of @tonsky </span><a href="http://tonsky.me/blog/the-web-after-tomorrow/" target="_blank">http://tonsky.me/blog/the-web-after-tomorrow/</a></div><div id="t1523313813000312" t="2018-04-09 22:43:33 whilo on a next step one can introduce CRDTs for intermediary result sets. this would allow local and offline edits in p2p fashion, which can occur with a parallel addition of the fact to the main central database that will acknowledge the intermediary result set"><a href="#t1523313813000312" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-04-09</span> <span class="t" onclick="H(this)">22:43:33</span>                   whilo </span><span>on a next step one can introduce CRDTs for intermediary result sets. this would allow local and offline edits in p2p fashion, which can occur with a parallel addition of the fact to the main central database that will acknowledge the intermediary result set</span></div><div id="t1523314033000025" t="2018-04-09 22:47:13 whilo the latter is necessary for the facts to be joinable in a synchronized fashion with other parts of the system. that would yield a very good tradeoff for data driven application development in my opinion"><a href="#t1523314033000025" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-04-09</span> <span class="t" onclick="H(this)">22:47:13</span>                   whilo </span><span>the latter is necessary for the facts to be joinable in a synchronized fashion with other parts of the system. that would yield a very good tradeoff for data driven application development in my opinion</span></div><div id="t1523314155000155" t="2018-04-09 22:49:15 whilo i can provide a durable sorted-map with the hitchhiker tree as a fast and transparent building blog:  https://github.com/datacrypt-project/hitchhiker-tree"><a href="#t1523314155000155" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-04-09</span> <span class="t" onclick="H(this)">22:49:15</span>                   whilo </span><span>i can provide a durable sorted-map with the hitchhiker tree as a fast and transparent building blog: </span><a href="https://github.com/datacrypt-project/hitchhiker-tree" target="_blank">https://github.com/datacrypt-project/hitchhiker-tree</a></div><div id="t1523314174000364" t="2018-04-09 22:49:34 whilo operations can be done in memory and flushed at distinct points in time"><a href="#t1523314174000364" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-04-09</span> <span class="t" onclick="H(this)">22:49:34</span>                   whilo </span><span>operations can be done in memory and flushed at distinct points in time</span></div><div id="t1523314297000310" t="2018-04-09 22:51:37 whilo just to be clear the hitchhiker-tree is not from me, but david greenberg, but i have ported it to clojurescript with core.async and have used it to make datascript durable in datahike"><a href="#t1523314297000310" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-04-09</span> <span class="t" onclick="H(this)">22:51:37</span>                   whilo </span><span>just to be clear the hitchhiker-tree is not from me, but david greenberg, but i have ported it to clojurescript with core.async and have used it to make datascript durable in datahike</span></div><div id="t1523314458000290" t="2018-04-09 22:54:18 whilo i guess i would have to implement IPersistentMemory, IMemoryReader and ITransientMemory for durability, right?"><a href="#t1523314458000290" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-04-09</span> <span class="t" onclick="H(this)">22:54:18</span>                   whilo </span><span>i guess i would have to implement IPersistentMemory, IMemoryReader and ITransientMemory for durability, right?</span></div><div id="t1523314496000327" t="2018-04-09 22:54:56 whilo i am not sure whether this makes sense in your opinion, would be nice to chat a bit about how do it right"><a href="#t1523314496000327" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-04-09</span> <span class="t" onclick="H(this)">22:54:56</span>                   whilo </span><span>i am not sure whether this makes sense in your opinion, would be nice to chat a bit about how do it right</span></div><div id="t1523386637000393" t="2018-04-10 18:57:17 mikerod @whilo I’m not completely up-to-speed on all of the various references you posted here. I can at least (for now) add a bit of light on the “durability” side of things.
Clara does currently have some (fairly raw) support for session and working memory durability.
More on that can be read about first @  http://www.clara-rules.org/docs/durability/"><a href="#t1523386637000393" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-04-10</span> <span class="t" onclick="H(this)">18:57:17</span>                 mikerod </span><span>@whilo I’m not completely up-to-speed on all of the various references you posted here. I can at least (for now) add a bit of light on the “durability” side of things.
Clara does currently have some (fairly raw) support for session and working memory durability.
More on that can be read about first @ </span><a href="http://www.clara-rules.org/docs/durability/" target="_blank">http://www.clara-rules.org/docs/durability/</a></div><div id="t1523386660000153" t="2018-04-10 18:57:40 mikerod Much of the working memory side of the durability implementation is up to your particular use-case"><a href="#t1523386660000153" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-04-10</span> <span class="t" onclick="H(this)">18:57:40</span>                 mikerod </span><span>Much of the working memory side of the durability implementation is up to your particular use-case</span></div><div id="t1523386683000096" t="2018-04-10 18:58:03 mikerod Clara does provide a Fressian backed impl of durability for the Clara infrastructure part of the rule sessions themselves"><a href="#t1523386683000096" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-04-10</span> <span class="t" onclick="H(this)">18:58:03</span>                 mikerod </span><span>Clara does provide a Fressian backed impl of durability for the Clara infrastructure part of the rule sessions themselves</span></div><div id="t1523386708000103" t="2018-04-10 18:58:28 mikerod it offloads all facts in working memory to a separate protocol, that the consumer would implement to effectively serialize their facts."><a href="#t1523386708000103" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-04-10</span> <span class="t" onclick="H(this)">18:58:28</span>                 mikerod </span><span>it offloads all facts in working memory to a separate protocol, that the consumer would implement to effectively serialize their facts.</span></div><div id="t1523386740000070" t="2018-04-10 18:59:00 mikerod Since I’m not familiar with each of the points you mention above though, this may or may not suit the goals you have"><a href="#t1523386740000070" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-04-10</span> <span class="t" onclick="H(this)">18:59:00</span>                 mikerod </span><span>Since I’m not familiar with each of the points you mention above though, this may or may not suit the goals you have</span></div><div id="t1523386763000515" t="2018-04-10 18:59:23 mikerod I need to read a bit deeper into some of your links to have anything else to say on the subject I think"><a href="#t1523386763000515" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-04-10</span> <span class="t" onclick="H(this)">18:59:23</span>                 mikerod </span><span>I need to read a bit deeper into some of your links to have anything else to say on the subject I think</span></div><div id="t1523386909000574" t="2018-04-10 19:01:49 mikerod It seems to me that you may be interested in a way to store facts in a way that are out-of-memory, perhaps because the set of facts will grow to potentially too many to fit all in memory at once."><a href="#t1523386909000574" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-04-10</span> <span class="t" onclick="H(this)">19:01:49</span>                 mikerod </span><span>It seems to me that you may be interested in a way to store facts in a way that are out-of-memory, perhaps because the set of facts will grow to potentially too many to fit all in memory at once.</span></div><div id="t1523386968000793" t="2018-04-10 19:02:48 mikerod In that case, the durability alone won’t be enough. I think you’d then have to do a custom implementation of the memory layer of Clara, as you’ve mentioned. In Clara’s early days, Ryan Brush (the creator of Clara) had a demo project that prototyped how Clara’s working memory could be realized over a distribution cluster using Apache Storm"><a href="#t1523386968000793" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-04-10</span> <span class="t" onclick="H(this)">19:02:48</span>                 mikerod </span><span>In that case, the durability alone won’t be enough. I think you’d then have to do a custom implementation of the memory layer of Clara, as you’ve mentioned. In Clara’s early days, Ryan Brush (the creator of Clara) had a demo project that prototyped how Clara’s working memory could be realized over a distribution cluster using Apache Storm</span></div><div id="t1523387000000079" t="2018-04-10 19:03:20 mikerod https://github.com/rbrush/clara-storm  This isn’t maintained and very likely doesn’t work now. However, perhaps it is inspiration or at least related to some of your ideas you’ve mentioned above."><a href="#t1523387000000079" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-04-10</span> <span class="t" onclick="H(this)">19:03:20</span>                 mikerod </span><a href="https://github.com/rbrush/clara-storm" target="_blank">https://github.com/rbrush/clara-storm</a><span> This isn’t maintained and very likely doesn’t work now. However, perhaps it is inspiration or at least related to some of your ideas you’ve mentioned above.</span></div><div id="t1523567145000391" t="2018-04-12 21:05:45 whilo @mikerod ok thanks  🙂"><a href="#t1523567145000391" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-04-12</span> <span class="t" onclick="H(this)">21:05:45</span>                   whilo </span><span>@mikerod ok thanks </span><b>🙂</b></div><div id="t1523567252000048" t="2018-04-12 21:07:32 whilo actually i would like to have a datahike database somewhere central, stream data out of it in some places that pre-computes datalog queries for clients and writes them to CRDTs which are then replicated. the client can then use these replicated CRDTs to render its views and write to them offline in many cases while sending to the server as well. anyway, i will think it through a bit more and get more familiar with clara."><a href="#t1523567252000048" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-04-12</span> <span class="t" onclick="H(this)">21:07:32</span>                   whilo </span><span>actually i would like to have a datahike database somewhere central, stream data out of it in some places that pre-computes datalog queries for clients and writes them to CRDTs which are then replicated. the client can then use these replicated CRDTs to render its views and write to them offline in many cases while sending to the server as well. anyway, i will think it through a bit more and get more familiar with clara.</span></div><div id="t1525708399000624" t="2018-05-07 15:53:19 jimbob Has anyone explored the area of exploration for why rules left-hand-side did not meet the rules prerequisites for firing of the RHS?"><a href="#t1525708399000624" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-07</span> <span class="t" onclick="H(this)">15:53:19</span>                  jimbob </span><span>Has anyone explored the area of exploration for why rules left-hand-side did not meet the rules prerequisites for firing of the RHS?</span></div><div id="t1525709150000055" t="2018-05-07 16:05:50 mikerod @ben.borders In a way yes. That is, if I understand your question."><a href="#t1525709150000055" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-07</span> <span class="t" onclick="H(this)">16:05:50</span>                 mikerod </span><span>@ben.borders In a way yes. That is, if I understand your question.</span></div><div id="t1525709208000380" t="2018-05-07 16:06:48 mikerod Not directly that though, instead you could consider a pattern to create complementary rules to the primary rules. These complementary rules were meant to catch the opposite case of the assertions."><a href="#t1525709208000380" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-07</span> <span class="t" onclick="H(this)">16:06:48</span>                 mikerod </span><span>Not directly that though, instead you could consider a pattern to create complementary rules to the primary rules. These complementary rules were meant to catch the opposite case of the assertions.</span></div><div id="t1525709380000241" t="2018-05-07 16:09:40 jimbob yes, thats exactly it."><a href="#t1525709380000241" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-07</span> <span class="t" onclick="H(this)">16:09:40</span>                  jimbob </span><span>yes, thats exactly it.</span></div><div id="t1525709486000662" t="2018-05-07 16:11:26 jimbob Interesting..  im assuming then there are multiple complements to each core “rule”.  maybe the # of complements = the number of left hand constrints or something similar?  unless your compllement rule that  is generated has more complex logic"><a href="#t1525709486000662" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-07</span> <span class="t" onclick="H(this)">16:11:26</span>                  jimbob </span><span>Interesting..  im assuming then there are multiple complements to each core “rule”.  maybe the # of complements = the number of left hand constrints or something similar?  unless your compllement rule that  is generated has more complex logic</span></div><div id="t1525709510000502" t="2018-05-07 16:11:50 mikerod I think the structure of generated rules may depend on which sorts of things you need to capture"><a href="#t1525709510000502" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-07</span> <span class="t" onclick="H(this)">16:11:50</span>                 mikerod </span><span>I think the structure of generated rules may depend on which sorts of things you need to capture</span></div><div id="t1525709542000242" t="2018-05-07 16:12:22 mikerod You could end up writing rules in an alternative fixed format that can generated several “tiers” of rules from it. so there was the typically rule where you tried to match, but then there were tiers of unsatisfied matches where different parts of the rule were successively removed"><a href="#t1525709542000242" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-07</span> <span class="t" onclick="H(this)">16:12:22</span>                 mikerod </span><span>You could end up writing rules in an alternative fixed format that can generated several “tiers” of rules from it. so there was the typically rule where you tried to match, but then there were tiers of unsatisfied matches where different parts of the rule were successively removed</span></div><div id="t1525709730000436" t="2018-05-07 16:15:30 jimbob ah interesting, so you made the rules very granular so that the complements might be easier to generate?"><a href="#t1525709730000436" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-07</span> <span class="t" onclick="H(this)">16:15:30</span>                  jimbob </span><span>ah interesting, so you made the rules very granular so that the complements might be easier to generate?</span></div><div id="t1525709755000042" t="2018-05-07 16:15:55 jimbob well.. the main rule you cared about at least."><a href="#t1525709755000042" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-07</span> <span class="t" onclick="H(this)">16:15:55</span>                  jimbob </span><span>well.. the main rule you cared about at least.</span></div><div id="t1525709877000252" t="2018-05-07 16:17:57 mikerod In that example, you can see it’d get carried away if you tried to capture everything perhaps"><a href="#t1525709877000252" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-07</span> <span class="t" onclick="H(this)">16:17:57</span>                 mikerod </span><span>In that example, you can see it’d get carried away if you tried to capture everything perhaps</span></div><div id="t1525709893000375" t="2018-05-07 16:18:13 mikerod but maybe you could split the “constraints” you want to test for into logical “chunks”"><a href="#t1525709893000375" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-07</span> <span class="t" onclick="H(this)">16:18:13</span>                 mikerod </span><span>but maybe you could split the “constraints” you want to test for into logical “chunks”</span></div><div id="t1525709932000451" t="2018-05-07 16:18:52 mikerod And when it comes to joining to other facts, you can do somewhat similar things"><a href="#t1525709932000451" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-07</span> <span class="t" onclick="H(this)">16:18:52</span>                 mikerod </span><span>And when it comes to joining to other facts, you can do somewhat similar things</span></div><div id="t1525709953000442" t="2018-05-07 16:19:13 mikerod but you have to capture the case that facts you are joining to may not be satisfied themselves"><a href="#t1525709953000442" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-07</span> <span class="t" onclick="H(this)">16:19:13</span>                 mikerod </span><span>but you have to capture the case that facts you are joining to may not be satisfied themselves</span></div><div id="t1525710161000661" t="2018-05-07 16:22:41 mikerod So you have to basically just come up with a way to structure these aspects you care about, then probably write something to generate the rules via some extra metadata markup on what is hand-written"><a href="#t1525710161000661" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-07</span> <span class="t" onclick="H(this)">16:22:41</span>                 mikerod </span><span>So you have to basically just come up with a way to structure these aspects you care about, then probably write something to generate the rules via some extra metadata markup on what is hand-written</span></div><div id="t1525710210000582" t="2018-05-07 16:23:30 mikerod I don’t think it is a trivial problem to solve and is going to end up being domain dependent. I think that this may also bring up another interesting question though regarding perhaps comparing the forward-chaining (as used in Clara) vs a backwards chaining approach to the problem"><a href="#t1525710210000582" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-07</span> <span class="t" onclick="H(this)">16:23:30</span>                 mikerod </span><span>I don’t think it is a trivial problem to solve and is going to end up being domain dependent. I think that this may also bring up another interesting question though regarding perhaps comparing the forward-chaining (as used in Clara) vs a backwards chaining approach to the problem</span></div><div id="t1525710452000516" t="2018-05-07 16:27:32 jimbob definitely!  Thanks Mike this helps a lot!"><a href="#t1525710452000516" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-07</span> <span class="t" onclick="H(this)">16:27:32</span>                  jimbob </span><span>definitely!  Thanks Mike this helps a lot!</span></div><div id="t1525710460000144" t="2018-05-07 16:27:40 jimbob @alex.furmanov"><a href="#t1525710460000144" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-07</span> <span class="t" onclick="H(this)">16:27:40</span>                  jimbob </span><span>@alex.furmanov</span></div><div id="t1525710533000469" t="2018-05-07 16:28:53 mikerod No problem"><a href="#t1525710533000469" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-07</span> <span class="t" onclick="H(this)">16:28:53</span>                 mikerod </span><span>No problem</span></div><div id="t1525883213000564" t="2018-05-09 16:26:53 wparker @ben.borders the :condition-matches in session inspection might be of interest as well:  https://github.com/cerner/clara-rules/blob/0.18.0/src/main/clojure/clara/tools/inspect.cljc#L183"><a href="#t1525883213000564" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-09</span> <span class="t" onclick="H(this)">16:26:53</span>                 wparker </span><span>@ben.borders the :condition-matches in session inspection might be of interest as well: </span><a href="https://github.com/cerner/clara-rules/blob/0.18.0/src/main/clojure/clara/tools/inspect.cljc#L183" target="_blank">https://github.com/cerner/clara-rules/blob/0.18.0/src/main/clojure/clara/tools/inspect.cljc#L183</a></div><div id="t1525883318000346" t="2018-05-09 16:28:38 jimbob great point!"><a href="#t1525883318000346" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-09</span> <span class="t" onclick="H(this)">16:28:38</span>                  jimbob </span><span>great point!</span></div><div id="t1525883470000223" t="2018-05-09 16:31:10 wparker So that should be the matches on constraints that don’t depend on joins - if you do [Fact (and (= field 1) (&lt; field2 ?binding-from-ancestor))] you’re forcing those constraints together in Clara’s view, where [Fact (= field 1) (&lt; field2 ?binding-from-ancestor)] keeps them separate"><a href="#t1525883470000223" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-09</span> <span class="t" onclick="H(this)">16:31:10</span>                 wparker </span><span>So that should be the matches on constraints that don’t depend on joins - if you do [Fact (and (= field 1) (&lt; field2 ?binding-from-ancestor))] you’re forcing those constraints together in Clara’s view, where [Fact (= field 1) (&lt; field2 ?binding-from-ancestor)] keeps them separate</span></div><div id="t1525883500000470" t="2018-05-09 16:31:40 wparker The latter is also better for perf reasons, Clara can optimize it more"><a href="#t1525883500000470" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-09</span> <span class="t" onclick="H(this)">16:31:40</span>                 wparker </span><span>The latter is also better for perf reasons, Clara can optimize it more</span></div><div id="t1525883527000844" t="2018-05-09 16:32:07 wparker Also note that :condition-matches doesn’t work for accumulator conditions yet:  https://github.com/cerner/clara-rules/issues/293"><a href="#t1525883527000844" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-09</span> <span class="t" onclick="H(this)">16:32:07</span>                 wparker </span><span>Also note that :condition-matches doesn’t work for accumulator conditions yet: </span><a href="https://github.com/cerner/clara-rules/issues/293" target="_blank">https://github.com/cerner/clara-rules/issues/293</a></div><div id="t1526166234000049" t="2018-05-12 23:03:54 devn Anyone here familiar with any work or have ideas on taking a medium to large rulebase, and then teasing out the underlying order?"><a href="#t1526166234000049" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-12</span> <span class="t" onclick="H(this)">23:03:54</span>                    devn </span><span>Anyone here familiar with any work or have ideas on taking a medium to large rulebase, and then teasing out the underlying order?</span></div><div id="t1526166272000018" t="2018-05-12 23:04:32 devn By, for instance, running a bunch of examples through, and capturing logical &quot;groupings&quot; of rule firings? By namespace, for instance."><a href="#t1526166272000018" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-12</span> <span class="t" onclick="H(this)">23:04:32</span>                    devn </span><span>By, for instance, running a bunch of examples through, and capturing logical &quot;groupings&quot; of rule firings? By namespace, for instance.</span></div><div id="t1526250138000100" t="2018-05-13 22:22:18 wparker @devn Would the fact-graph functionality help?  https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/tools/fact_graph.cljc  I know I never got around to building graphical tools on top of it and frankly probably won’t at this point, but even in a REPL or with text-based visualization maybe it could be useful.  The main ways you’d get at that sort of info would be session inspection (which the fact graph functionality uses internally) or listeners such as tracing - since the resulting data is just Clojure data you could process it as appropriate to make it more easily understood in your use case.  To be honest though, my first thought is that if you need to go from the actual rule firing patterns backwards to the logical order, something is probably suboptimal about the organization of the codebase in question.  Code organization is a tricky thing to get right and IMO highly domain-dependent but FWIW the rulebases I’ve worked with tended to either be DAGs or have broad groupings of rules that could be sketched out with their relationships to each other on a single piece of paper (with each of those groupings potentially containing other groupings and so forth)"><a href="#t1526250138000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-13</span> <span class="t" onclick="H(this)">22:22:18</span>                 wparker </span><span>@devn Would the fact-graph functionality help? </span><a href="https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/tools/fact_graph.cljc" target="_blank">https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/tools/fact_graph.cljc</a><span> I know I never got around to building graphical tools on top of it and frankly probably won’t at this point, but even in a REPL or with text-based visualization maybe it could be useful.  The main ways you’d get at that sort of info would be session inspection (which the fact graph functionality uses internally) or listeners such as tracing - since the resulting data is just Clojure data you could process it as appropriate to make it more easily understood in your use case.  To be honest though, my first thought is that if you need to go from the actual rule firing patterns backwards to the logical order, something is probably suboptimal about the organization of the codebase in question.  Code organization is a tricky thing to get right and IMO highly domain-dependent but FWIW the rulebases I’ve worked with tended to either be DAGs or have broad groupings of rules that could be sketched out with their relationships to each other on a single piece of paper (with each of those groupings potentially containing other groupings and so forth)</span></div><div id="t1526250355000047" t="2018-05-13 22:25:55 alex-dixon Maybe attach a listener and accumulate rule names"><a href="#t1526250355000047" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-13</span> <span class="t" onclick="H(this)">22:25:55</span>              alex-dixon </span><span>Maybe attach a listener and accumulate rule names</span></div><div id="t1526278707000079" t="2018-05-14 06:18:27 devn @wparker for large-ish rule sets, visualization is an extremely tricky problem in my experience"><a href="#t1526278707000079" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-14</span> <span class="t" onclick="H(this)">06:18:27</span>                    devn </span><span>@wparker for large-ish rule sets, visualization is an extremely tricky problem in my experience</span></div><div id="t1526278779000084" t="2018-05-14 06:19:39 devn Once it gets past 25-30 fact types and 100+ rules it’s a mess"><a href="#t1526278779000084" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-14</span> <span class="t" onclick="H(this)">06:19:39</span>                    devn </span><span>Once it gets past 25-30 fact types and 100+ rules it’s a mess</span></div><div id="t1526278931000283" t="2018-05-14 06:22:11 devn The graph I’ve produced, even with distinct edges is huge and mostly incomprehensible. "><a href="#t1526278931000283" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-14</span> <span class="t" onclick="H(this)">06:22:11</span>                    devn </span><span>The graph I’ve produced, even with distinct edges is huge and mostly incomprehensible. </span></div><div id="t1526279110000276" t="2018-05-14 06:25:10 devn Imagine this scenario: you walk up to a system like this, and you know nothing about the “steps” that exist within the maze of fact types and rules that operate over them. Assume that 99% of rules produce a fact on the RHS."><a href="#t1526279110000276" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-14</span> <span class="t" onclick="H(this)">06:25:10</span>                    devn </span><span>Imagine this scenario: you walk up to a system like this, and you know nothing about the “steps” that exist within the maze of fact types and rules that operate over them. Assume that 99% of rules produce a fact on the RHS.</span></div><div id="t1526279216000024" t="2018-05-14 06:26:56 devn What you want, is to try and tease out the clusters of logic."><a href="#t1526279216000024" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-14</span> <span class="t" onclick="H(this)">06:26:56</span>                    devn </span><span>What you want, is to try and tease out the clusters of logic.</span></div><div id="t1526279578000276" t="2018-05-14 06:32:58 devn There are so many variables that make this problem difficult to generalize."><a href="#t1526279578000276" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-14</span> <span class="t" onclick="H(this)">06:32:58</span>                    devn </span><span>There are so many variables that make this problem difficult to generalize.</span></div><div id="t1526280300000121" t="2018-05-14 06:45:00 devn For instance, whether people write fat or skinny rules, whether they have a few types with a lot of fields or a number of facts with variants, etc"><a href="#t1526280300000121" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-14</span> <span class="t" onclick="H(this)">06:45:00</span>                    devn </span><span>For instance, whether people write fat or skinny rules, whether they have a few types with a lot of fields or a number of facts with variants, etc</span></div><div id="t1526339055000066" t="2018-05-14 23:04:15 devn @wparker to your point though about code organization. yeah, that&apos;s really important."><a href="#t1526339055000066" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-14</span> <span class="t" onclick="H(this)">23:04:15</span>                    devn </span><span>@wparker to your point though about code organization. yeah, that&apos;s really important.</span></div><div id="t1526339268000062" t="2018-05-14 23:07:48 devn we have ~28 files containing rules"><a href="#t1526339268000062" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-14</span> <span class="t" onclick="H(this)">23:07:48</span>                    devn </span><span>we have ~28 files containing rules</span></div><div id="t1526339298000362" t="2018-05-14 23:08:18 alex-dixon I’ve made some devtools for Precept. There could be some reuse for Clara if there’s interest"><a href="#t1526339298000362" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-14</span> <span class="t" onclick="H(this)">23:08:18</span>              alex-dixon </span><span>I’ve made some devtools for Precept. There could be some reuse for Clara if there’s interest</span></div><div id="t1526339374000193" t="2018-05-14 23:09:34 devn @alex-dixon interested in taking a look!"><a href="#t1526339374000193" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-14</span> <span class="t" onclick="H(this)">23:09:34</span>                    devn </span><span>@alex-dixon interested in taking a look!</span></div><div id="t1526339428000240" t="2018-05-14 23:10:28 devn @alex-dixon where should i look for that code?"><a href="#t1526339428000240" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-14</span> <span class="t" onclick="H(this)">23:10:28</span>                    devn </span><span>@alex-dixon where should i look for that code?</span></div><div id="t1526339444000341" t="2018-05-14 23:10:44 devn or is there a simple example around that i could use to see what&apos;s there?"><a href="#t1526339444000341" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-14</span> <span class="t" onclick="H(this)">23:10:44</span>                    devn </span><span>or is there a simple example around that i could use to see what&apos;s there?</span></div><div id="t1526339674000032" t="2018-05-14 23:14:34 alex-dixon The visual part is in a private repo I need to make public. The code that gets the data from the session  is here  https://github.com/CoNarrative/precept/pull/113"><a href="#t1526339674000032" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-14</span> <span class="t" onclick="H(this)">23:14:34</span>              alex-dixon </span><span>The visual part is in a private repo I need to make public. The code that gets the data from the session  is here </span><a href="https://github.com/CoNarrative/precept/pull/113" target="_blank">https://github.com/CoNarrative/precept/pull/113</a></div><div id="t1526339707000185" t="2018-05-14 23:15:07 devn cool!"><a href="#t1526339707000185" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-14</span> <span class="t" onclick="H(this)">23:15:07</span>                    devn </span><span>cool!</span></div><div id="t1526339756000335" t="2018-05-14 23:15:56 alex-dixon The basic approach is to attach a listener and put what it gives you onto a core async channel "><a href="#t1526339756000335" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-14</span> <span class="t" onclick="H(this)">23:15:56</span>              alex-dixon </span><span>The basic approach is to attach a listener and put what it gives you onto a core async channel </span></div><div id="t1526339780000155" t="2018-05-14 23:16:20 devn sequential rule operation log, state history over time, etc. are all interesting to me"><a href="#t1526339780000155" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-14</span> <span class="t" onclick="H(this)">23:16:20</span>                    devn </span><span>sequential rule operation log, state history over time, etc. are all interesting to me</span></div><div id="t1526339841000072" t="2018-05-14 23:17:21 devn @alex-dixon this is exciting. thanks for your work."><a href="#t1526339841000072" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-14</span> <span class="t" onclick="H(this)">23:17:21</span>                    devn </span><span>@alex-dixon this is exciting. thanks for your work.</span></div><div id="t1526339942000359" t="2018-05-14 23:19:02 alex-dixon Thanks  😊 . That means a lot"><a href="#t1526339942000359" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-14</span> <span class="t" onclick="H(this)">23:19:02</span>              alex-dixon </span><span>Thanks </span><b>😊</b><span>. That means a lot</span></div><div id="t1526340050000255" t="2018-05-14 23:20:50 devn @alex-dixon lazy clara user writes: please do this for clara too?  🙂"><a href="#t1526340050000255" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-14</span> <span class="t" onclick="H(this)">23:20:50</span>                    devn </span><span>@alex-dixon lazy clara user writes: please do this for clara too? </span><b>🙂</b></div><div id="t1526340068000004" t="2018-05-14 23:21:08 alex-dixon Lol"><a href="#t1526340068000004" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-14</span> <span class="t" onclick="H(this)">23:21:08</span>              alex-dixon </span><span>Lol</span></div><div id="t1526340086000241" t="2018-05-14 23:21:26 alex-dixon What would be helpful?"><a href="#t1526340086000241" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-14</span> <span class="t" onclick="H(this)">23:21:26</span>              alex-dixon </span><span>What would be helpful?</span></div><div id="t1526340258000328" t="2018-05-14 23:24:18 devn explanations and sequential rule operation log stick out"><a href="#t1526340258000328" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-14</span> <span class="t" onclick="H(this)">23:24:18</span>                    devn </span><span>explanations and sequential rule operation log stick out</span></div><div id="t1526340294000063" t="2018-05-14 23:24:54 devn fact history, also"><a href="#t1526340294000063" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-14</span> <span class="t" onclick="H(this)">23:24:54</span>                    devn </span><span>fact history, also</span></div><div id="t1526340438000361" t="2018-05-14 23:27:18 devn does that slider at the bottom let you time travel?"><a href="#t1526340438000361" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-14</span> <span class="t" onclick="H(this)">23:27:18</span>                    devn </span><span>does that slider at the bottom let you time travel?</span></div><div id="t1526340455000001" t="2018-05-14 23:27:35 devn and scrub through firings?"><a href="#t1526340455000001" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-14</span> <span class="t" onclick="H(this)">23:27:35</span>                    devn </span><span>and scrub through firings?</span></div><div id="t1526340458000003" t="2018-05-14 23:27:38 alex-dixon Yeah"><a href="#t1526340458000003" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-14</span> <span class="t" onclick="H(this)">23:27:38</span>              alex-dixon </span><span>Yeah</span></div><div id="t1526340462000172" t="2018-05-14 23:27:42 devn that&apos;s slick!"><a href="#t1526340462000172" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-14</span> <span class="t" onclick="H(this)">23:27:42</span>                    devn </span><span>that&apos;s slick!</span></div><div id="t1526340487000258" t="2018-05-14 23:28:07 alex-dixon There’s also fact tracking and rule tracking outside of that"><a href="#t1526340487000258" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-14</span> <span class="t" onclick="H(this)">23:28:07</span>              alex-dixon </span><span>There’s also fact tracking and rule tracking outside of that</span></div><div id="t1526340534000010" t="2018-05-14 23:28:54 alex-dixon History of a fact, history of a rule"><a href="#t1526340534000010" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-14</span> <span class="t" onclick="H(this)">23:28:54</span>              alex-dixon </span><span>History of a fact, history of a rule</span></div><div id="t1526340615000105" t="2018-05-14 23:30:15 devn super cool. gimme gimme gimme"><a href="#t1526340615000105" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-14</span> <span class="t" onclick="H(this)">23:30:15</span>                    devn </span><span>super cool. gimme gimme gimme</span></div><div id="t1526340618000410" t="2018-05-14 23:30:18 devn 😄"><a href="#t1526340618000410" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-14</span> <span class="t" onclick="H(this)">23:30:18</span>                    devn </span><b>😄</b></div><div id="t1526340710000105" t="2018-05-14 23:31:50 alex-dixon Lol. Thanks. I’m curious about your use case. Not sure how to approach the same with Clara when sessions can be used a lot differently than with ui"><a href="#t1526340710000105" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-14</span> <span class="t" onclick="H(this)">23:31:50</span>              alex-dixon </span><span>Lol. Thanks. I’m curious about your use case. Not sure how to approach the same with Clara when sessions can be used a lot differently than with ui</span></div><div id="t1526340854000030" t="2018-05-14 23:34:14 devn @alex-dixon one obvious one would be for development/debugging. i want to scrub through what is matching and where."><a href="#t1526340854000030" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-14</span> <span class="t" onclick="H(this)">23:34:14</span>                    devn </span><span>@alex-dixon one obvious one would be for development/debugging. i want to scrub through what is matching and where.</span></div><div id="t1526341067000108" t="2018-05-14 23:37:47 devn it might also be helpful for finding any nasty cases where we walk down a big branch of logic only to undo all of it due to truth maintenance. perhaps we missed a constraint."><a href="#t1526341067000108" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-14</span> <span class="t" onclick="H(this)">23:37:47</span>                    devn </span><span>it might also be helpful for finding any nasty cases where we walk down a big branch of logic only to undo all of it due to truth maintenance. perhaps we missed a constraint.</span></div><div id="t1526558508000308" t="2018-05-17 12:01:48 dominicm I&apos;m trying to figure out Clara with tuples, partially as I&apos;ve been brainwashed by Datomic, and partially because I think I like the independence. Precept looks like it&apos;s covered a lot of the work for that, any reason I couldn&apos;t use it as a general purpose library?"><a href="#t1526558508000308" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-17</span> <span class="t" onclick="H(this)">12:01:48</span>                dominicm </span><span>I&apos;m trying to figure out Clara with tuples, partially as I&apos;ve been brainwashed by Datomic, and partially because I think I like the independence. Precept looks like it&apos;s covered a lot of the work for that, any reason I couldn&apos;t use it as a general purpose library?</span></div><div id="t1526559161000235" t="2018-05-17 12:12:41 dominicm It&apos;s more than possible I should convert the tuples into maps or something, but I&apos;m entirely uncertain."><a href="#t1526559161000235" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-17</span> <span class="t" onclick="H(this)">12:12:41</span>                dominicm </span><span>It&apos;s more than possible I should convert the tuples into maps or something, but I&apos;m entirely uncertain.</span></div><div id="t1526560731000184" t="2018-05-17 12:38:51 mikerod @dominicm @alex-dixon is the Precept guru. 
Clara lets you configure the sort of facts it can work with if you want to do something like tuples. 

Some of this is explained in
 http://www.clara-rules.org/docs/fact_type_customization/ 

"><a href="#t1526560731000184" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-17</span> <span class="t" onclick="H(this)">12:38:51</span>                 mikerod </span><span>@dominicm @alex-dixon is the Precept guru. 
Clara lets you configure the sort of facts it can work with if you want to do something like tuples. 

Some of this is explained in
</span><a href="http://www.clara-rules.org/docs/fact_type_customization/" target="_blank">http://www.clara-rules.org/docs/fact_type_customization/</a><span>

</span></div><div id="t1526560753000017" t="2018-05-17 12:39:13 mikerod If precept is using tuples already, could look there for example too. "><a href="#t1526560753000017" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-17</span> <span class="t" onclick="H(this)">12:39:13</span>                 mikerod </span><span>If precept is using tuples already, could look there for example too. </span></div><div id="t1526560905000151" t="2018-05-17 12:41:45 dominicm I did the type customisation for a tuple, it&apos;s working out okay, however my rules are full of a lot of destructuring sugar:

 (defrule app-asg-min-size
  [:box/type [[e a v]] (= v :server) (= ?app e)]
  [?tup &lt;- :min-size [[e a v]] (= e ?app)]
  =&gt;
  (let [[e a v] ?tup]
    (insert!
      [(str e &quot;-asg&quot;) :min-size v])))
"><a href="#t1526560905000151" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-17</span> <span class="t" onclick="H(this)">12:41:45</span>                dominicm </span><span>I did the type customisation for a tuple, it&apos;s working out okay, however my rules are full of a lot of destructuring sugar:

</span><pre>(defrule app-asg-min-size
  [:box/type [[e a v]] (= v :server) (= ?app e)]
  [?tup &lt;- :min-size [[e a v]] (= e ?app)]
  =&gt;
  (let [[e a v] ?tup]
    (insert!
      [(str e &quot;-asg&quot;) :min-size v])))
</pre></div><div id="t1526560965000534" t="2018-05-17 12:42:45 dominicm precept does seem to have something to allow queries like this one:

 (rule todo-is-visible
  [[_ :visibility-filter :active]]
  [[?e :todo/done false]]
  =&gt;
  (println &quot;The todo with this entity id is visible: &quot; ?e)
"><a href="#t1526560965000534" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-17</span> <span class="t" onclick="H(this)">12:42:45</span>                dominicm </span><span>precept does seem to have something to allow queries like this one:

</span><pre>(rule todo-is-visible
  [[_ :visibility-filter :active]]
  [[?e :todo/done false]]
  =&gt;
  (println &quot;The todo with this entity id is visible: &quot; ?e)
</pre></div><div id="t1526560982000586" t="2018-05-17 12:43:02 dominicm I should probably just try it and see what happens  😛"><a href="#t1526560982000586" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-17</span> <span class="t" onclick="H(this)">12:43:02</span>                dominicm </span><span>I should probably just try it and see what happens </span><b>😛</b></div><div id="t1526564110000608" t="2018-05-17 13:35:10 dominicm It doesn&apos;t seem that precept supports newer clara versions, a shame."><a href="#t1526564110000608" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-17</span> <span class="t" onclick="H(this)">13:35:10</span>                dominicm </span><span>It doesn&apos;t seem that precept supports newer clara versions, a shame.</span></div><div id="t1526564491000505" t="2018-05-17 13:41:31 mikerod @dominicm I am not aware of anything in a newer clara that broke Precept. That’d be a bit of a surprise to me. Alex has generally been pretty active in the Clara changes etc. hmm. "><a href="#t1526564491000505" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-17</span> <span class="t" onclick="H(this)">13:41:31</span>                 mikerod </span><span>@dominicm I am not aware of anything in a newer clara that broke Precept. That’d be a bit of a surprise to me. Alex has generally been pretty active in the Clara changes etc. hmm. </span></div><div id="t1526564630000292" t="2018-05-17 13:43:50 mikerod As far as the syntactic overhear you mentioned. I think you may be right there. Precept May have defined its own syntax later with something like a macro and then just generated Clara rule forms from it. Not sure. I’d have to check there as well. "><a href="#t1526564630000292" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-17</span> <span class="t" onclick="H(this)">13:43:50</span>                 mikerod </span><span>As far as the syntactic overhear you mentioned. I think you may be right there. Precept May have defined its own syntax later with something like a macro and then just generated Clara rule forms from it. Not sure. I’d have to check there as well. </span></div><div id="t1526564663000346" t="2018-05-17 13:44:23 mikerod Are you wanting to have it look more like a datalog sort of query I guess? "><a href="#t1526564663000346" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-17</span> <span class="t" onclick="H(this)">13:44:23</span>                 mikerod </span><span>Are you wanting to have it look more like a datalog sort of query I guess? </span></div><div id="t1526564832000507" t="2018-05-17 13:47:12 dominicm @mikerod I can report the bug to Precept, if they will be interested. It would certainly suit my data format better if I did that. I don&apos;t think I&apos;m really utilising the &quot;rule type&quot; concept very much. I&apos;m trying to figure out if I can coerce my facts into maps that would be more like what Clara expects, but I&apos;m not sure the type would be more useful there either."><a href="#t1526564832000507" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-17</span> <span class="t" onclick="H(this)">13:47:12</span>                dominicm </span><span>@mikerod I can report the bug to Precept, if they will be interested. It would certainly suit my data format better if I did that. I don&apos;t think I&apos;m really utilising the &quot;rule type&quot; concept very much. I&apos;m trying to figure out if I can coerce my facts into maps that would be more like what Clara expects, but I&apos;m not sure the type would be more useful there either.</span></div><div id="t1526564969000418" t="2018-05-17 13:49:29 dominicm @mikerod in case you&apos;re interested  https://github.com/CoNarrative/precept/issues/115"><a href="#t1526564969000418" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-17</span> <span class="t" onclick="H(this)">13:49:29</span>                dominicm </span><span>@mikerod in case you&apos;re interested </span><a href="https://github.com/CoNarrative/precept/issues/115" target="_blank">https://github.com/CoNarrative/precept/issues/115</a></div><div id="t1526638504000227" t="2018-05-18 10:15:04 wparker CompilerException java.lang.IllegalArgumentException: Can&apos;t define method not in interfaces: insert_facts_BANG_, compiling:(precept/listeners.cljc:14:1)   I believe the protocol method signature there changes in 0.18.0 so that’s probably it without looking at the code at the moment.  It should be an easy uplift though since the new info passed was a superset of the previous (i.e. arguments were added not removed).  I’ll comment on the Precept issue later. @dominicm"><a href="#t1526638504000227" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-18</span> <span class="t" onclick="H(this)">10:15:04</span>                      wparker </span><pre>CompilerException java.lang.IllegalArgumentException: Can&apos;t define method not in interfaces: insert_facts_BANG_, compiling:(precept/listeners.cljc:14:1) </pre><span> I believe the protocol method signature there changes in 0.18.0 so that’s probably it without looking at the code at the moment.  It should be an easy uplift though since the new info passed was a superset of the previous (i.e. arguments were added not removed).  I’ll comment on the Precept issue later. @dominicm</span></div><div id="t1526639414000497" t="2018-05-18 10:30:14 dominicm yeah, didn&apos;t seem like it would be terrible to fix, but I have no context  🙂"><a href="#t1526639414000497" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-18</span> <span class="t" onclick="H(this)">10:30:14</span>                     dominicm </span><span>yeah, didn&apos;t seem like it would be terrible to fix, but I have no context </span><b>🙂</b></div><div id="t1526565273000070" t="2018-05-17 13:54:33 mikerod That’s strange. I wonder if Alex will give some feedback on that one soon. I guess to mess with precept for now just use the version it has declared. "><a href="#t1526565273000070" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-17</span> <span class="t" onclick="H(this)">13:54:33</span>                 mikerod </span><span>That’s strange. I wonder if Alex will give some feedback on that one soon. I guess to mess with precept for now just use the version it has declared. </span></div><div id="t1526565292000552" t="2018-05-17 13:54:52 mikerod I’ll check that out In a few. Not at laptop at the moment. "><a href="#t1526565292000552" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-17</span> <span class="t" onclick="H(this)">13:54:52</span>                 mikerod </span><span>I’ll check that out In a few. Not at laptop at the moment. </span></div><div id="t1526565425000256" t="2018-05-17 13:57:05 mikerod Yeah it is convenient to model data the same as Clara built in. But not necessary of course. Also making a simpler DSL to interact wouldn’t be too hard potentially. "><a href="#t1526565425000256" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-17</span> <span class="t" onclick="H(this)">13:57:05</span>                 mikerod </span><span>Yeah it is convenient to model data the same as Clara built in. But not necessary of course. Also making a simpler DSL to interact wouldn’t be too hard potentially. </span></div><div id="t1526565464000883" t="2018-05-17 13:57:44 mikerod For tuples. You could make a record type for them that just had an e, a, v fields. Then you’d get more concise Clara syntax at least"><a href="#t1526565464000883" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-17</span> <span class="t" onclick="H(this)">13:57:44</span>                 mikerod </span><span>For tuples. You could make a record type for them that just had an e, a, v fields. Then you’d get more concise Clara syntax at least</span></div><div id="t1526566358000755" t="2018-05-17 14:12:38 alex-dixon @dominicm Hey. I haven’t tried upgrading to 18 yet but there were some breaking changes in 17 that were addressed in this branch  https://github.com/CoNarrative/precept/pull/113"><a href="#t1526566358000755" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-17</span> <span class="t" onclick="H(this)">14:12:38</span>              alex-dixon </span><span>@dominicm Hey. I haven’t tried upgrading to 18 yet but there were some breaking changes in 17 that were addressed in this branch </span><a href="https://github.com/CoNarrative/precept/pull/113" target="_blank">https://github.com/CoNarrative/precept/pull/113</a></div><div id="t1526566590000397" t="2018-05-17 14:16:30 alex-dixon @dominicm Is there something in particular in 0.18.0 that you’re interested in having? I’ve been out of the loop"><a href="#t1526566590000397" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-17</span> <span class="t" onclick="H(this)">14:16:30</span>              alex-dixon </span><span>@dominicm Is there something in particular in 0.18.0 that you’re interested in having? I’ve been out of the loop</span></div><div id="t1526566964000158" t="2018-05-17 14:22:44 alex-dixon @mikerod I’ve been thinking about the roles/responsibilities of libraries like Precept vs. the Clara core. I’d like the devtools I’ve been working on to be compatible with Clara, but I’m somewhat uncomfortable with thinking of that being part of the core, so I was wondering about the group’s thoughts on revitalizing something like clara.tools to house things like that"><a href="#t1526566964000158" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-17</span> <span class="t" onclick="H(this)">14:22:44</span>              alex-dixon </span><span>@mikerod I’ve been thinking about the roles/responsibilities of libraries like Precept vs. the Clara core. I’d like the devtools I’ve been working on to be compatible with Clara, but I’m somewhat uncomfortable with thinking of that being part of the core, so I was wondering about the group’s thoughts on revitalizing something like clara.tools to house things like that</span></div><div id="t1526567265000147" t="2018-05-17 14:27:45 mikerod @alex-dixon to me it made sense to have it be a separate library like the clara.tools concept"><a href="#t1526567265000147" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-17</span> <span class="t" onclick="H(this)">14:27:45</span>                 mikerod </span><span>@alex-dixon to me it made sense to have it be a separate library like the clara.tools concept</span></div><div id="t1526567283000414" t="2018-05-17 14:28:03 alex-dixon Now that dominic brings it up, I’m also curious whether Clara would be interested in a Datalog syntax implementation. And yes…I might have asked this a year ago but there’s reasons I didn’t. Namely I didn’t know Clojure at the time, hadn’t really contributed at all to open source, and like now I’m sort of intimidated by Clara’s codebase and not that confident in my ability to work efficiently in it"><a href="#t1526567283000414" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-17</span> <span class="t" onclick="H(this)">14:28:03</span>              alex-dixon </span><span>Now that dominic brings it up, I’m also curious whether Clara would be interested in a Datalog syntax implementation. And yes…I might have asked this a year ago but there’s reasons I didn’t. Namely I didn’t know Clojure at the time, hadn’t really contributed at all to open source, and like now I’m sort of intimidated by Clara’s codebase and not that confident in my ability to work efficiently in it</span></div><div id="t1526567285000147" t="2018-05-17 14:28:05 dominicm @alex-dixon no idea, I just picked latest and started there."><a href="#t1526567285000147" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-17</span> <span class="t" onclick="H(this)">14:28:05</span>                dominicm </span><span>@alex-dixon no idea, I just picked latest and started there.</span></div><div id="t1526567315000647" t="2018-05-17 14:28:35 dominicm Datomic syntax for clara in an isolated library would be nice, from a total beginner&apos;s pov."><a href="#t1526567315000647" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-17</span> <span class="t" onclick="H(this)">14:28:35</span>                dominicm </span><span>Datomic syntax for clara in an isolated library would be nice, from a total beginner&apos;s pov.</span></div><div id="t1526567351000544" t="2018-05-17 14:29:11 mikerod @alex-dixon It doesn’t have to be in that same repo though really unless you had particular reasoning for that. 
I haven’t had a chance to look at the devtools stuff that was discussed here the other day. It sounded interesting though"><a href="#t1526567351000544" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-17</span> <span class="t" onclick="H(this)">14:29:11</span>                 mikerod </span><span>@alex-dixon It doesn’t have to be in that same repo though really unless you had particular reasoning for that. 
I haven’t had a chance to look at the devtools stuff that was discussed here the other day. It sounded interesting though</span></div><div id="t1526567582000319" t="2018-05-17 14:33:02 mikerod &gt; Datomic syntax for clara in an isolated library would be nice, from a total beginner’s pov.
I agree that that sounds cool"><a href="#t1526567582000319" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-17</span> <span class="t" onclick="H(this)">14:33:02</span>                 mikerod </span><span>&gt; Datomic syntax for clara in an isolated library would be nice, from a total beginner’s pov.
I agree that that sounds cool</span></div><div id="t1526567613000680" t="2018-05-17 14:33:33 mikerod Probably would be applicable to people in the clj-ecosystem looking into Clara too if that was the sort of data models they were already using. Interesting if Precept already has that layer implemented"><a href="#t1526567613000680" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-17</span> <span class="t" onclick="H(this)">14:33:33</span>                 mikerod </span><span>Probably would be applicable to people in the clj-ecosystem looking into Clara too if that was the sort of data models they were already using. Interesting if Precept already has that layer implemented</span></div><div id="t1526567745000127" t="2018-05-17 14:35:45 alex-dixon The devtools were conceived in isolation, so before I’d work on porting some of it to Clara I’d really want to know what would be useful for people. As it stands, you can view the history of a rule, history of a fact, “event log” (all inserts and retractions in order), see explanations for all of those (the rule conditions that were defined, the facts they matched on, the bindings of the variables, what was inserted or retracted), whether something was inserted or removed unconditionally, logically, or the result of schema enforcement, if it was schema enforcement which existing fact triggered the schema enforcement and the relevant schema rule, added and removed facts for a particular rule firing (i.e. diff), and the total set of facts that exist in the session at the end of any rule firing"><a href="#t1526567745000127" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-17</span> <span class="t" onclick="H(this)">14:35:45</span>              alex-dixon </span><span>The devtools were conceived in isolation, so before I’d work on porting some of it to Clara I’d really want to know what would be useful for people. As it stands, you can view the history of a rule, history of a fact, “event log” (all inserts and retractions in order), see explanations for all of those (the rule conditions that were defined, the facts they matched on, the bindings of the variables, what was inserted or retracted), whether something was inserted or removed unconditionally, logically, or the result of schema enforcement, if it was schema enforcement which existing fact triggered the schema enforcement and the relevant schema rule, added and removed facts for a particular rule firing (i.e. diff), and the total set of facts that exist in the session at the end of any rule firing</span></div><div id="t1526567806000758" t="2018-05-17 14:36:46 alex-dixon It’s implemented as a client and server…the client for visualization, the server for receiving messages from the inspected session/app over socket"><a href="#t1526567806000758" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-17</span> <span class="t" onclick="H(this)">14:36:46</span>              alex-dixon </span><span>It’s implemented as a client and server…the client for visualization, the server for receiving messages from the inspected session/app over socket</span></div><div id="t1526568375000168" t="2018-05-17 14:46:15 mikerod @alex-dixon sounds really useful. You should make it public in a github repo or something for people to try out  🙂"><a href="#t1526568375000168" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-17</span> <span class="t" onclick="H(this)">14:46:15</span>                 mikerod </span><span>@alex-dixon sounds really useful. You should make it public in a github repo or something for people to try out </span><b>🙂</b></div><div id="t1526569113000293" t="2018-05-17 14:58:33 alex-dixon Yeah haha…I definitely will, I’ve been dragging my feet because I’m not completely happy with it"><a href="#t1526569113000293" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-17</span> <span class="t" onclick="H(this)">14:58:33</span>              alex-dixon </span><span>Yeah haha…I definitely will, I’ve been dragging my feet because I’m not completely happy with it</span></div><div id="t1526571269000797" t="2018-05-17 15:34:29 mikerod call it alpha  😛"><a href="#t1526571269000797" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-17</span> <span class="t" onclick="H(this)">15:34:29</span>                 mikerod </span><span>call it alpha </span><b>😛</b></div><div id="t1526573220000586" t="2018-05-17 16:07:00 dominicm I have been using the fact graph for fact history, it&apos;s been a pretty cool demo. I wired it up to rhizome pretty easily, and was able to see that X created asg Y, and asg Y has property Z because of Rule A"><a href="#t1526573220000586" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-17</span> <span class="t" onclick="H(this)">16:07:00</span>                dominicm </span><span>I have been using the fact graph for fact history, it&apos;s been a pretty cool demo. I wired it up to rhizome pretty easily, and was able to see that X created asg Y, and asg Y has property Z because of Rule A</span></div><div id="t1526574006000600" t="2018-05-17 16:20:06 zylox im certainly interested as well. i agree with @mikerod, just mark it alpha. works for spec right  😛"><a href="#t1526574006000600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-17</span> <span class="t" onclick="H(this)">16:20:06</span>                   zylox </span><span>im certainly interested as well. i agree with @mikerod, just mark it alpha. works for spec right </span><b>😛</b></div><div id="t1526574152000393" t="2018-05-17 16:22:32 dominicm the alpha stuff works very well, as long as your namespaces are .alpha too"><a href="#t1526574152000393" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-17</span> <span class="t" onclick="H(this)">16:22:32</span>                dominicm </span><span>the alpha stuff works very well, as long as your namespaces are .alpha too</span></div><div id="t1526574931000778" t="2018-05-17 16:35:31 alex-dixon I’ll try to publish it this weekend, maybe just mentioning it here will make that easier  🙂"><a href="#t1526574931000778" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-17</span> <span class="t" onclick="H(this)">16:35:31</span>              alex-dixon </span><span>I’ll try to publish it this weekend, maybe just mentioning it here will make that easier </span><b>🙂</b></div><div id="t1526574942000820" t="2018-05-17 16:35:42 alex-dixon Thanks for the encouragement and feedback"><a href="#t1526574942000820" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-17</span> <span class="t" onclick="H(this)">16:35:42</span>              alex-dixon </span><span>Thanks for the encouragement and feedback</span></div><div id="t1526629678000046" t="2018-05-18 07:47:58 dominicm http://www.clara-rules.org/docs/fact_type_customization/ 

Is it possible to set a fact type in such a way that this isn&apos;t needed?"><a href="#t1526629678000046" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-18</span> <span class="t" onclick="H(this)">07:47:58</span>                dominicm </span><a href="http://www.clara-rules.org/docs/fact_type_customization/" target="_blank">http://www.clara-rules.org/docs/fact_type_customization/</a><span>

Is it possible to set a fact type in such a way that this isn&apos;t needed?</span></div><div id="t1526638392000216" t="2018-05-18 10:13:12 wparker @dominicm Could you give a minimal failing example?  That doesn’t sound like something that should happen but we might be thinking about different things."><a href="#t1526638392000216" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-18</span> <span class="t" onclick="H(this)">10:13:12</span>                      wparker </span><span>@dominicm Could you give a minimal failing example?  That doesn’t sound like something that should happen but we might be thinking about different things.</span></div><div id="t1526629965000512" t="2018-05-18 07:52:45 dominicm That might not be my problem actually. But when my type-fn is  :a  I get an error about alpha nodes if I try and refer to  e ."><a href="#t1526629965000512" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-18</span> <span class="t" onclick="H(this)">07:52:45</span>                dominicm </span><span>That might not be my problem actually. But when my type-fn is </span><code>:a</code><span> I get an error about alpha nodes if I try and refer to </span><code>e</code><span>.</span></div><div id="t1526649074000025" t="2018-05-18 13:11:14 mikerod @dominicm I don’t see any context in your question. Did you post an example? You said where “this isn’t needed”, what were you referring to? "><a href="#t1526649074000025" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-18</span> <span class="t" onclick="H(this)">13:11:14</span>                 mikerod </span><span>@dominicm I don’t see any context in your question. Did you post an example? You said where “this isn’t needed”, what were you referring to? </span></div><div id="t1526649291000350" t="2018-05-18 13:14:51 mikerod FYI I posted an example snippet overriding the fact type for something like tuples above. Well I put them in maps for key access by name. "><a href="#t1526649291000350" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-18</span> <span class="t" onclick="H(this)">13:14:51</span>                 mikerod </span><span>FYI I posted an example snippet overriding the fact type for something like tuples above. Well I put them in maps for key access by name. </span></div><div id="t1526649413000227" t="2018-05-18 13:16:53 mikerod You can’t refer to bare symbols that “represent” lookup keys in a rule condition if you are asking that though with regard to “referring to  e . Clara currently only offers special syntactic access directly to record or “Java bean” field/accessors. If you are using generic types it doesn’t attempt to resolve like the symbol  e  to  (:e this) 

This may be what you’re asking"><a href="#t1526649413000227" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-18</span> <span class="t" onclick="H(this)">13:16:53</span>                 mikerod </span><span>You can’t refer to bare symbols that “represent” lookup keys in a rule condition if you are asking that though with regard to “referring to </span><code>e</code><span>. Clara currently only offers special syntactic access directly to record or “Java bean” field/accessors. If you are using generic types it doesn’t attempt to resolve like the symbol </span><code>e</code><span> to </span><code>(:e this)</code><span>

This may be what you’re asking</span></div><div id="t1526649437000219" t="2018-05-18 13:17:17 mikerod It’d actually be interesting to explore making Clara offer that sort of syntax though on more generic data. "><a href="#t1526649437000219" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-18</span> <span class="t" onclick="H(this)">13:17:17</span>                 mikerod </span><span>It’d actually be interesting to explore making Clara offer that sort of syntax though on more generic data. </span></div><div id="t1526652120000660" t="2018-05-18 14:02:00 dominicm Sorry. I got distracted when I got in and forgot to post it. On phone again, once I&apos;m at the keyboard I will do it."><a href="#t1526652120000660" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-18</span> <span class="t" onclick="H(this)">14:02:00</span>                dominicm </span><span>Sorry. I got distracted when I got in and forgot to post it. On phone again, once I&apos;m at the keyboard I will do it.</span></div><div id="t1526655431000813" t="2018-05-18 14:57:11 sveri Hi, can someone point me to some literature on how to write my own rules engine? I have trouble finding usefull stuff."><a href="#t1526655431000813" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-18</span> <span class="t" onclick="H(this)">14:57:11</span>                   sveri </span><span>Hi, can someone point me to some literature on how to write my own rules engine? I have trouble finding usefull stuff.</span></div><div id="t1526655639000832" t="2018-05-18 15:00:39 zylox clara is heavily based on this paper if you really want to write your own &quot;engine&quot;  http://reports-archive.adm.cs.cmu.edu/anon/1995/CMU-CS-95-113.pdf"><a href="#t1526655639000832" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-18</span> <span class="t" onclick="H(this)">15:00:39</span>                   zylox </span><span>clara is heavily based on this paper if you really want to write your own &quot;engine&quot; </span><a href="http://reports-archive.adm.cs.cmu.edu/anon/1995/CMU-CS-95-113.pdf" target="_blank">http://reports-archive.adm.cs.cmu.edu/anon/1995/CMU-CS-95-113.pdf</a></div><div id="t1526655660000922" t="2018-05-18 15:01:00 sveri I am just curious, thank you @zylox"><a href="#t1526655660000922" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-18</span> <span class="t" onclick="H(this)">15:01:00</span>                   sveri </span><span>I am just curious, thank you @zylox</span></div><div id="t1526655707000774" t="2018-05-18 15:01:47 mikerod Caveat: that paper is really old. There are many modern day rete extensions that Clara uses too. The paper is really good at explaining the foundations of rete though. "><a href="#t1526655707000774" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-18</span> <span class="t" onclick="H(this)">15:01:47</span>                 mikerod </span><span>Caveat: that paper is really old. There are many modern day rete extensions that Clara uses too. The paper is really good at explaining the foundations of rete though. </span></div><div id="t1526655716000149" t="2018-05-18 15:01:56 zylox also just about any info you can get on rete will be intersting"><a href="#t1526655716000149" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-18</span> <span class="t" onclick="H(this)">15:01:56</span>                   zylox </span><span>also just about any info you can get on rete will be intersting</span></div><div id="t1526655744000291" t="2018-05-18 15:02:24 mikerod The Drools/Jboss people also had some good blogs out there regarding rete. "><a href="#t1526655744000291" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-18</span> <span class="t" onclick="H(this)">15:02:24</span>                 mikerod </span><span>The Drools/Jboss people also had some good blogs out there regarding rete. </span></div><div id="t1526655815000053" t="2018-05-18 15:03:35 mikerod Then there is also this great blog about Clara/rete here 
 http://www.metasimple.org/2017/02/28/clarifying-rules-engines.html 

(I wrote it  😛  ) "><a href="#t1526655815000053" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-18</span> <span class="t" onclick="H(this)">15:03:35</span>                 mikerod </span><span>Then there is also this great blog about Clara/rete here 
</span><a href="http://www.metasimple.org/2017/02/28/clarifying-rules-engines.html" target="_blank">http://www.metasimple.org/2017/02/28/clarifying-rules-engines.html</a><span>

(I wrote it </span><b>😛</b><span> ) </span></div><div id="t1526655901000409" t="2018-05-18 15:05:01 sveri @mikerod thank to you too"><a href="#t1526655901000409" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-18</span> <span class="t" onclick="H(this)">15:05:01</span>                   sveri </span><span>@mikerod thank to you too</span></div><div id="t1526656044000431" t="2018-05-18 15:07:24 dominicm (ns roll-alt
  (:require
    [clara.rules :refer :all]
    [clara.tools.fact-graph :as fg]
    [clara.rules.accumulators :as accum]
    [rhizome.viz :as rhizome]))

(defrecord D [e a v])

(defrule todos-done-invisible
  ;; [:todo/title (= ?e e)]
  [:todo/done (= (:v this) false) (= ?e (:e this))]
  =&gt;
  (insert!
    (-&gt;D ?e :todo/visible true)))

(comment
  (-&gt; (mk-session
        :fact-type-fn :a
        :ancestors-fn (constantly [:all]))
      (insert
        (-&gt;D &quot;foo&quot; :todo/title &quot;FOO!&quot;)
        (-&gt;D &quot;foo&quot; :todo/title &quot;FOOBAR!&quot;)
        (-&gt;D &quot;foo&quot; :todo/done true)
        (-&gt;D &quot;blah&quot; :todo/done false))
      (fire-rules)
      (query visible-datoms)))
 
@mikerod the first line in the defrule doesn&apos;t work."><a href="#t1526656044000431" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-18</span> <span class="t" onclick="H(this)">15:07:24</span>                dominicm </span><pre>(ns roll-alt
  (:require
    [clara.rules :refer :all]
    [clara.tools.fact-graph :as fg]
    [clara.rules.accumulators :as accum]
    [rhizome.viz :as rhizome]))

(defrecord D [e a v])

(defrule todos-done-invisible
  ;; [:todo/title (= ?e e)]
  [:todo/done (= (:v this) false) (= ?e (:e this))]
  =&gt;
  (insert!
    (-&gt;D ?e :todo/visible true)))

(comment
  (-&gt; (mk-session
        :fact-type-fn :a
        :ancestors-fn (constantly [:all]))
      (insert
        (-&gt;D &quot;foo&quot; :todo/title &quot;FOO!&quot;)
        (-&gt;D &quot;foo&quot; :todo/title &quot;FOOBAR!&quot;)
        (-&gt;D &quot;foo&quot; :todo/done true)
        (-&gt;D &quot;blah&quot; :todo/done false))
      (fire-rules)
      (query visible-datoms)))
</pre><span>
@mikerod the first line in the defrule doesn&apos;t work.</span></div><div id="t1526656569000414" t="2018-05-18 15:16:09 mikerod @dominicm that seems related to the explanation I at least attempted to give above about when you can refer to “field name” symbols directly in a rule"><a href="#t1526656569000414" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-18</span> <span class="t" onclick="H(this)">15:16:09</span>                 mikerod </span><span>@dominicm that seems related to the explanation I at least attempted to give above about when you can refer to “field name” symbols directly in a rule</span></div><div id="t1526656595000798" t="2018-05-18 15:16:35 mikerod Clara compiler cannot statically/compile time know what those symbols mean since the rule condition has a custom type that can’t be introspected"><a href="#t1526656595000798" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-18</span> <span class="t" onclick="H(this)">15:16:35</span>                 mikerod </span><span>Clara compiler cannot statically/compile time know what those symbols mean since the rule condition has a custom type that can’t be introspected</span></div><div id="t1526656656000829" t="2018-05-18 15:17:36 mikerod It’d be interesting if Clara added support for you to explicitly state “fields” that go with custom fact types. But nothing like that right now. You’d have to do  (:e this)  instead of  e  or use destructuring as you have in the past"><a href="#t1526656656000829" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-18</span> <span class="t" onclick="H(this)">15:17:36</span>                 mikerod </span><span>It’d be interesting if Clara added support for you to explicitly state “fields” that go with custom fact types. But nothing like that right now. You’d have to do </span><code>(:e this)</code><span> instead of </span><code>e</code><span> or use destructuring as you have in the past</span></div><div id="t1526656826000023" t="2018-05-18 15:20:26 mikerod When rules have records or other types of classes directly in the rule condition Clara compiler will reflect on the class to determine its available field names. When it can do that, you can refer to field names directly as their name symbol. "><a href="#t1526656826000023" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-18</span> <span class="t" onclick="H(this)">15:20:26</span>                 mikerod </span><span>When rules have records or other types of classes directly in the rule condition Clara compiler will reflect on the class to determine its available field names. When it can do that, you can refer to field names directly as their name symbol. </span></div><div id="t1526657389000730" t="2018-05-18 15:29:49 dominicm &gt; Clara compiler cannot statically/compile time know what those symbols mean since the rule condition has a custom type that can’t be introspected

That explains it to me, that&apos;s entirely what I was missing. It obviously worked when I wrote the form this way:

 (defrule todos-done-invisible
  [?d &lt;- D (= a :todo/title)]
  =&gt;
  (insert!
    (-&gt;D (:e ?d) :todo/visible true)))
 

Which has a trade-off."><a href="#t1526657389000730" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-18</span> <span class="t" onclick="H(this)">15:29:49</span>                dominicm </span><span>&gt; Clara compiler cannot statically/compile time know what those symbols mean since the rule condition has a custom type that can’t be introspected

That explains it to me, that&apos;s entirely what I was missing. It obviously worked when I wrote the form this way:

</span><pre>(defrule todos-done-invisible
  [?d &lt;- D (= a :todo/title)]
  =&gt;
  (insert!
    (-&gt;D (:e ?d) :todo/visible true)))
</pre><span>

Which has a trade-off.</span></div><div id="t1526657421000853" t="2018-05-18 15:30:21 dominicm I was a bit confused because it was still a record, ergo it should work (in my head)."><a href="#t1526657421000853" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-18</span> <span class="t" onclick="H(this)">15:30:21</span>                dominicm </span><span>I was a bit confused because it was still a record, ergo it should work (in my head).</span></div><div id="t1526657447000785" t="2018-05-18 15:30:47 dominicm I looked for something to provide a custom keys function, and when I didn&apos;t find it, I presumed I was missing something."><a href="#t1526657447000785" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-18</span> <span class="t" onclick="H(this)">15:30:47</span>                dominicm </span><span>I looked for something to provide a custom keys function, and when I didn&apos;t find it, I presumed I was missing something.</span></div><div id="t1526658300000648" t="2018-05-18 15:45:00 mikerod @dominicm It’d be interesting to have a fn that takes your custom “type” and returns a set of “field keys”"><a href="#t1526658300000648" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-18</span> <span class="t" onclick="H(this)">15:45:00</span>                 mikerod </span><span>@dominicm It’d be interesting to have a fn that takes your custom “type” and returns a set of “field keys”</span></div><div id="t1526658313000323" t="2018-05-18 15:45:13 mikerod and that’d be caleld when the compiler was compiling rules and then it’d allow for the shorter accessors"><a href="#t1526658313000323" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-18</span> <span class="t" onclick="H(this)">15:45:13</span>                 mikerod </span><span>and that’d be caleld when the compiler was compiling rules and then it’d allow for the shorter accessors</span></div><div id="t1526658343000721" t="2018-05-18 15:45:43 mikerod Yeah, Clara just has built-in special casing to class types since they have reflection utilities available to find out how to resolve those symbols"><a href="#t1526658343000721" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-18</span> <span class="t" onclick="H(this)">15:45:43</span>                 mikerod </span><span>Yeah, Clara just has built-in special casing to class types since they have reflection utilities available to find out how to resolve those symbols</span></div><div id="t1526658371000258" t="2018-05-18 15:46:11 mikerod I’ll add that you probably don’t want to write all your rules against a single type like  D , so that isn’t a pattern I’d advocate"><a href="#t1526658371000258" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-18</span> <span class="t" onclick="H(this)">15:46:11</span>                 mikerod </span><span>I’ll add that you probably don’t want to write all your rules against a single type like </span><code>D</code><span>, so that isn’t a pattern I’d advocate</span></div><div id="t1526658394000810" t="2018-05-18 15:46:34 mikerod It’d lead to a lot of thrash in the rules since every insert/retract would potentially affect every rule"><a href="#t1526658394000810" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-18</span> <span class="t" onclick="H(this)">15:46:34</span>                 mikerod </span><span>It’d lead to a lot of thrash in the rules since every insert/retract would potentially affect every rule</span></div><div id="t1526658412000549" t="2018-05-18 15:46:52 mikerod The fact type serves as, what I’d call, the first level of discrimination/partitioning in the network."><a href="#t1526658412000549" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-18</span> <span class="t" onclick="H(this)">15:46:52</span>                 mikerod </span><span>The fact type serves as, what I’d call, the first level of discrimination/partitioning in the network.</span></div><div id="t1526660053000570" t="2018-05-18 16:14:13 dominicm My data set isn&apos;t particularly large I think. I&apos;m struggling to come up with good fact types for my domain. But that&apos;s likely a thing on my side."><a href="#t1526660053000570" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-18</span> <span class="t" onclick="H(this)">16:14:13</span>                dominicm </span><span>My data set isn&apos;t particularly large I think. I&apos;m struggling to come up with good fact types for my domain. But that&apos;s likely a thing on my side.</span></div><div id="t1526661350000788" t="2018-05-18 16:35:50 dominicm The problem I have is that I&apos;m operating in a large domain, and I&apos;m asserting facts on a per-key level, instead of whole entities."><a href="#t1526661350000788" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-18</span> <span class="t" onclick="H(this)">16:35:50</span>                dominicm </span><span>The problem I have is that I&apos;m operating in a large domain, and I&apos;m asserting facts on a per-key level, instead of whole entities.</span></div><div id="t1526661414000435" t="2018-05-18 16:36:54 dominicm I suppose I could generate something like S3BucketFact which takes an id, key and value. But it&apos;s not so different from my datom record."><a href="#t1526661414000435" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-18</span> <span class="t" onclick="H(this)">16:36:54</span>                dominicm </span><span>I suppose I could generate something like S3BucketFact which takes an id, key and value. But it&apos;s not so different from my datom record.</span></div><div id="t1526895713000428" t="2018-05-21 09:41:53 wparker Haven’t read through all this, but FYI the ancestors-fn sounds like it could help you as well.  So you could have rules matching all S3BucketFact as well as more rules matching only “subtypes” of S3BucketFact"><a href="#t1526895713000428" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-21</span> <span class="t" onclick="H(this)">09:41:53</span>                      wparker </span><span>Haven’t read through all this, but FYI the ancestors-fn sounds like it could help you as well.  So you could have rules matching all S3BucketFact as well as more rules matching only “subtypes” of S3BucketFact</span></div><div id="t1526895725000177" t="2018-05-21 09:42:05 wparker @dominicm"><a href="#t1526895725000177" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-21</span> <span class="t" onclick="H(this)">09:42:05</span>                      wparker </span><span>@dominicm</span></div><div id="t1526895857000124" t="2018-05-21 09:44:17 dominicm Yeah, I&apos;m deriving all my records, so that I can do a query for all &quot;Props&quot;"><a href="#t1526895857000124" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-21</span> <span class="t" onclick="H(this)">09:44:17</span>                     dominicm </span><span>Yeah, I&apos;m deriving all my records, so that I can do a query for all &quot;Props&quot;</span></div><div id="t1526895881000306" t="2018-05-21 09:44:41 dominicm I&apos;ve introduced a meta &quot;Resource&quot; which goes into the &quot;e&quot; slot too, to make it easier to query for resources without getting the duplicates from props."><a href="#t1526895881000306" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-21</span> <span class="t" onclick="H(this)">09:44:41</span>                     dominicm </span><span>I&apos;ve introduced a meta &quot;Resource&quot; which goes into the &quot;e&quot; slot too, to make it easier to query for resources without getting the duplicates from props.</span></div><div id="t1526662062000384" t="2018-05-18 16:47:42 dominicm Or should I be creating records at the level of S3BucketName, s3bucketYYY, etc.?"><a href="#t1526662062000384" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-18</span> <span class="t" onclick="H(this)">16:47:42</span>                dominicm </span><span>Or should I be creating records at the level of S3BucketName, s3bucketYYY, etc.?</span></div><div id="t1526663990000039" t="2018-05-18 17:19:50 mikerod don’t know about that"><a href="#t1526663990000039" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-18</span> <span class="t" onclick="H(this)">17:19:50</span>                 mikerod </span><span>don’t know about that</span></div><div id="t1526664006000302" t="2018-05-18 17:20:06 mikerod maybe the “fact type” should be the “attribute” slot of these sorts of facts? I’m not sure"><a href="#t1526664006000302" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-18</span> <span class="t" onclick="H(this)">17:20:06</span>                 mikerod </span><span>maybe the “fact type” should be the “attribute” slot of these sorts of facts? I’m not sure</span></div><div id="t1526666397000049" t="2018-05-18 17:59:57 dominicm I guess I can invent static generation of that somehow later. It feels less &quot;open&quot;."><a href="#t1526666397000049" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-18</span> <span class="t" onclick="H(this)">17:59:57</span>                dominicm </span><span>I guess I can invent static generation of that somehow later. It feels less &quot;open&quot;.</span></div><div id="t1526669026000402" t="2018-05-18 18:43:46 mikerod @dominicm I think it’d come down to the sort of rules you were needing to write"><a href="#t1526669026000402" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-18</span> <span class="t" onclick="H(this)">18:43:46</span>                 mikerod </span><span>@dominicm I think it’d come down to the sort of rules you were needing to write</span></div><div id="t1526669059000410" t="2018-05-18 18:44:19 mikerod the fact type is just a useful way to group facts across the network that are coming from an external and also to categorize derived data"><a href="#t1526669059000410" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-18</span> <span class="t" onclick="H(this)">18:44:19</span>                 mikerod </span><span>the fact type is just a useful way to group facts across the network that are coming from an external and also to categorize derived data</span></div><div id="t1526669130000713" t="2018-05-18 18:45:30 mikerod I don’t see the fact types as being a closed off concept. They are just what the rules refer to to match things, join things, and check other constraints.
All of this is probably too vague though. I don’t have a good enough understand of what your data might be looking like and the sorts of things you want to do with it."><a href="#t1526669130000713" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-18</span> <span class="t" onclick="H(this)">18:45:30</span>                 mikerod </span><span>I don’t see the fact types as being a closed off concept. They are just what the rules refer to to match things, join things, and check other constraints.
All of this is probably too vague though. I don’t have a good enough understand of what your data might be looking like and the sorts of things you want to do with it.</span></div><div id="t1526669157000342" t="2018-05-18 18:45:57 mikerod This now does make me wonder what sort of “fact type”s are used in #precept"><a href="#t1526669157000342" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-18</span> <span class="t" onclick="H(this)">18:45:57</span>                 mikerod </span><span>This now does make me wonder what sort of “fact type”s are used in #precept</span></div><div id="t1526684483000046" t="2018-05-18 23:01:23 alex-dixon We use fact type fn :a  https://github.com/CoNarrative/precept/blob/712868374f7339910e1c90596ec41c26283693d7/src/clj/precept/macros.clj#L48"><a href="#t1526684483000046" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-18</span> <span class="t" onclick="H(this)">23:01:23</span>                   alex-dixon </span><span>We use fact type fn :a </span><a href="https://github.com/CoNarrative/precept/blob/712868374f7339910e1c90596ec41c26283693d7/src/clj/precept/macros.clj#L48" target="_blank">https://github.com/CoNarrative/precept/blob/712868374f7339910e1c90596ec41c26283693d7/src/clj/precept/macros.clj#L48</a></div><div id="t1526669531000625" t="2018-05-18 18:52:11 dominicm I&apos;ve been thinking the same, and also how certain problems of querying are solved, particularly around duplicate entities, potentially.

There must be a few additional aspects to the querying in precept over what Clara provides alone."><a href="#t1526669531000625" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-18</span> <span class="t" onclick="H(this)">18:52:11</span>                dominicm </span><span>I&apos;ve been thinking the same, and also how certain problems of querying are solved, particularly around duplicate entities, potentially.

There must be a few additional aspects to the querying in precept over what Clara provides alone.</span></div><div id="t1526669751000231" t="2018-05-18 18:55:51 dominicm It was interesting to see several rules disappear when I got rid of the D record in favour of XFact records. I&apos;m interested to see what happens with X-Y records."><a href="#t1526669751000231" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-18</span> <span class="t" onclick="H(this)">18:55:51</span>                dominicm </span><span>It was interesting to see several rules disappear when I got rid of the D record in favour of XFact records. I&apos;m interested to see what happens with X-Y records.</span></div><div id="t1526672195000060" t="2018-05-18 19:36:35 dominicm Without having at least the concept of &quot;S3Bucket&quot; and &quot;S3BucketFact&quot; it&apos;s quite difficult to do &quot;All S3 buckets must have  :foo 2 &quot;, because the  ?e  is duplicated across so many facts. I could perhaps use an accumulator, but it seems more natural to have strict types."><a href="#t1526672195000060" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-18</span> <span class="t" onclick="H(this)">19:36:35</span>                dominicm </span><span>Without having at least the concept of &quot;S3Bucket&quot; and &quot;S3BucketFact&quot; it&apos;s quite difficult to do &quot;All S3 buckets must have </span><code>:foo 2</code><span>&quot;, because the </span><code>?e</code><span> is duplicated across so many facts. I could perhaps use an accumulator, but it seems more natural to have strict types.</span></div><div id="t1526674753000025" t="2018-05-18 20:19:13 dominicm I&apos;ve written a macro which is run like  (defType Box)  will generate:

-  (defrecord Box) 
-  (defrecord BoxFact) 
-  (derive Box ::Type)   (derive BoxFact ::Fact) 
- Function for converting to Box from other types
- Function for &quot;scoping&quot; a series of  [a v]  into Facts.

I&apos;m moving rather fast. I haven&apos;t gone really deep yet, but I&apos;m going to see how far I can get without declaring every possible attribute on a Box as a type."><a href="#t1526674753000025" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-18</span> <span class="t" onclick="H(this)">20:19:13</span>                dominicm </span><span>I&apos;ve written a macro which is run like </span><code>(defType Box)</code><span> will generate:

- </span><code>(defrecord Box)</code><span>
- </span><code>(defrecord BoxFact)</code><span>
- </span><code>(derive Box ::Type)</code><span> </span><code>(derive BoxFact ::Fact)</code><span>
- Function for converting to Box from other types
- Function for &quot;scoping&quot; a series of </span><code>[a v]</code><span> into Facts.

I&apos;m moving rather fast. I haven&apos;t gone really deep yet, but I&apos;m going to see how far I can get without declaring every possible attribute on a Box as a type.</span></div><div id="t1526674934000372" t="2018-05-18 20:22:14 dominicm It&apos;s certainly cool to see the addition of a route to an app cause the subnet to change, and the route53 records &amp; load balancers to be created."><a href="#t1526674934000372" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-18</span> <span class="t" onclick="H(this)">20:22:14</span>                dominicm </span><span>It&apos;s certainly cool to see the addition of a route to an app cause the subnet to change, and the route53 records &amp; load balancers to be created.</span></div><div id="t1526681740000082" t="2018-05-18 22:15:40 dominicm Sorry, I&apos;m tripping over things I don&apos;t understand again,

 (defquery created-by
  [:?for]
  [?fact &lt;- ::Fact
   (= ?by (:e this))
   (= (:a this) :roll/created-for)
   (= (:v this) ?for)])
 

I&apos;m getting back a result where  :?for  is different to what I input as a parameter:  (query s created-by :?for (-&gt;Box &quot;app&quot; nil)) . I don&apos;t really understand why, any advice?"><a href="#t1526681740000082" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-18</span> <span class="t" onclick="H(this)">22:15:40</span>                dominicm </span><span>Sorry, I&apos;m tripping over things I don&apos;t understand again,

</span><pre>(defquery created-by
  [:?for]
  [?fact &lt;- ::Fact
   (= ?by (:e this))
   (= (:a this) :roll/created-for)
   (= (:v this) ?for)])
</pre><span>

I&apos;m getting back a result where </span><code>:?for</code><span> is different to what I input as a parameter: </span><code>(query s created-by :?for (-&gt;Box &quot;app&quot; nil))</code><span>. I don&apos;t really understand why, any advice?</span></div><div id="t1526684096000096" t="2018-05-18 22:54:56 mikerod the query returns all 3 bound variables and 1 match as expected"><a href="#t1526684096000096" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-18</span> <span class="t" onclick="H(this)">22:54:56</span>                 mikerod </span><span>the query returns all 3 bound variables and 1 match as expected</span></div><div id="t1526684109000041" t="2018-05-18 22:55:09 mikerod if I tweak the query or the inserted  ::Fact , the results go away as expected too"><a href="#t1526684109000041" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-18</span> <span class="t" onclick="H(this)">22:55:09</span>                 mikerod </span><span>if I tweak the query or the inserted </span><code>::Fact</code><span>, the results go away as expected too</span></div><div id="t1526710443000060" t="2018-05-19 06:14:03 dominicm @mikerod I can&apos;t seem to create a minimal repro of this, which leaves me more confused."><a href="#t1526710443000060" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-19</span> <span class="t" onclick="H(this)">06:14:03</span>                dominicm </span><span>@mikerod I can&apos;t seem to create a minimal repro of this, which leaves me more confused.</span></div><div id="t1526710550000019" t="2018-05-19 06:15:50 dominicm {:?fact #roll_altc.LaunchConfigurationFact{:e #roll_altc.LaunchConfiguration{:id &quot;app&quot;, :qualifier nil},
                                            :a :roll/created-for,
                                            :v #roll_altc.ASG{:id &quot;app&quot;, :qualifier nil}},
  :?by #roll_altc.LaunchConfiguration{:id &quot;app&quot;, :qualifier nil},
  :?for #roll_altc.ASG{:id &quot;app&quot;, :qualifier nil}}
 

I definitely have this in my results though, which I just can&apos;t grasp."><a href="#t1526710550000019" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-19</span> <span class="t" onclick="H(this)">06:15:50</span>                dominicm </span><pre>{:?fact #roll_altc.LaunchConfigurationFact{:e #roll_altc.LaunchConfiguration{:id &quot;app&quot;, :qualifier nil},
                                            :a :roll/created-for,
                                            :v #roll_altc.ASG{:id &quot;app&quot;, :qualifier nil}},
  :?by #roll_altc.LaunchConfiguration{:id &quot;app&quot;, :qualifier nil},
  :?for #roll_altc.ASG{:id &quot;app&quot;, :qualifier nil}}
</pre><span>

I definitely have this in my results though, which I just can&apos;t grasp.</span></div><div id="t1526710857000075" t="2018-05-19 06:20:57 dominicm I added a  prn  to do some debugging, and if I refer to  ?for  I get:

&gt; Using variable that is not previously bound. This can happen when an expression uses a previously unbound variable, or if a variable is referenced in a nested part of a parent expression, such as (or (= ?my-expression my-field) ...).

I&apos;m guessing this is suggesting that  ?for  is unbound, which is weird, but does explain what I am seeing."><a href="#t1526710857000075" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-19</span> <span class="t" onclick="H(this)">06:20:57</span>                dominicm </span><span>I added a </span><code>prn</code><span> to do some debugging, and if I refer to </span><code>?for</code><span> I get:

&gt; Using variable that is not previously bound. This can happen when an expression uses a previously unbound variable, or if a variable is referenced in a nested part of a parent expression, such as (or (= ?my-expression my-field) ...).

I&apos;m guessing this is suggesting that </span><code>?for</code><span> is unbound, which is weird, but does explain what I am seeing.</span></div><div id="t1526711023000062" t="2018-05-19 06:23:43 dominicm I get that in the minimal case where it works too, so I guess that&apos;s not it."><a href="#t1526711023000062" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-19</span> <span class="t" onclick="H(this)">06:23:43</span>                dominicm </span><span>I get that in the minimal case where it works too, so I guess that&apos;s not it.</span></div><div id="t1526711570000005" t="2018-05-19 06:32:50 dominicm &gt; A parameter definition, which allow callers to control the scope of the query when it is called.

Makes me think that params should be bound when queries start, but instead it seems like they&apos;re unbound, and filtered at the end. Is that true?"><a href="#t1526711570000005" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-19</span> <span class="t" onclick="H(this)">06:32:50</span>                dominicm </span><span>&gt; A parameter definition, which allow callers to control the scope of the query when it is called.

Makes me think that params should be bound when queries start, but instead it seems like they&apos;re unbound, and filtered at the end. Is that true?</span></div><div id="t1526756159000057" t="2018-05-19 18:55:59 dominicm (defquery created-for-e
  [:?e]
  [RollCreatedFor (= e ?e) (= ?v v)])
 

Is there a reason that  :?e  is optional, when I execute this query without an  :?e  I get no results, I thought it might be like in datalog rules where  it would be treated as an unbound variable in that case."><a href="#t1526756159000057" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-19</span> <span class="t" onclick="H(this)">18:55:59</span>                dominicm </span><pre>(defquery created-for-e
  [:?e]
  [RollCreatedFor (= e ?e) (= ?v v)])
</pre><span>

Is there a reason that </span><code>:?e</code><span> is optional, when I execute this query without an </span><code>:?e</code><span> I get no results, I thought it might be like in datalog rules where  it would be treated as an unbound variable in that case.</span></div><div id="t1526756380000042" t="2018-05-19 18:59:40 alex-dixon Maybe bound to nil?"><a href="#t1526756380000042" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-19</span> <span class="t" onclick="H(this)">18:59:40</span>              alex-dixon </span><span>Maybe bound to nil?</span></div><div id="t1526756774000025" t="2018-05-19 19:06:14 alex-dixon @dominicm are you using the with meta eav pattern? Also curious if you’re using def session or mk session and how you’re defining rules...I forget whether there’s any potential pitfalls with reloading them in clj"><a href="#t1526756774000025" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-19</span> <span class="t" onclick="H(this)">19:06:14</span>              alex-dixon </span><span>@dominicm are you using the with meta eav pattern? Also curious if you’re using def session or mk session and how you’re defining rules...I forget whether there’s any potential pitfalls with reloading them in clj</span></div><div id="t1526757220000009" t="2018-05-19 19:13:40 dominicm @alex-dixon I&apos;m onto &quot;namespace d&quot; now, where I&apos;m trying  (defrecord AWSDBType [e v])  and  (defrecord AWSDB [id qualifier])"><a href="#t1526757220000009" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-19</span> <span class="t" onclick="H(this)">19:13:40</span>                dominicm </span><span>@alex-dixon I&apos;m onto &quot;namespace d&quot; now, where I&apos;m trying </span><code>(defrecord AWSDBType [e v])</code><span> and </span><code>(defrecord AWSDB [id qualifier])</code></div><div id="t1526757494000074" t="2018-05-19 19:18:14 dominicm I have experimented with 4 approaches now  🙂"><a href="#t1526757494000074" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-19</span> <span class="t" onclick="H(this)">19:18:14</span>                dominicm </span><span>I have experimented with 4 approaches now </span><b>🙂</b></div><div id="t1526757520000061" t="2018-05-19 19:18:40 alex-dixon What’s not working? Sorry kind of got lost"><a href="#t1526757520000061" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-19</span> <span class="t" onclick="H(this)">19:18:40</span>              alex-dixon </span><span>What’s not working? Sorry kind of got lost</span></div><div id="t1526757577000085" t="2018-05-19 19:19:37 dominicm Oh, in the original question you mean? I was getting the ASG in the results, when I was specifying  :?for  as  (-&gt;DBBox &quot;main&quot; nil)"><a href="#t1526757577000085" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-19</span> <span class="t" onclick="H(this)">19:19:37</span>                dominicm </span><span>Oh, in the original question you mean? I was getting the ASG in the results, when I was specifying </span><code>:?for</code><span> as </span><code>(-&gt;DBBox &quot;main&quot; nil)</code></div><div id="t1526757721000023" t="2018-05-19 19:22:01 alex-dixon Oh ok. Is there anything you’re stuck on still?"><a href="#t1526757721000023" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-19</span> <span class="t" onclick="H(this)">19:22:01</span>              alex-dixon </span><span>Oh ok. Is there anything you’re stuck on still?</span></div><div id="t1526760383000074" t="2018-05-19 20:06:23 dominicm I&apos;m still confused as to why I&apos;m having issues with the query  https://clojurians.slack.com/archives/C08TC9JCS/p1526681740000082  but I&apos;m unable to create a minimal reproducible."><a href="#t1526760383000074" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-19</span> <span class="t" onclick="H(this)">20:06:23</span>                dominicm </span><span>I&apos;m still confused as to why I&apos;m having issues with the query </span><a href="https://clojurians.slack.com/archives/C08TC9JCS/p1526681740000082" target="_blank">https://clojurians.slack.com/archives/C08TC9JCS/p1526681740000082</a><span> but I&apos;m unable to create a minimal reproducible.</span></div><div id="t1526760551000108" t="2018-05-19 20:09:11 dominicm But otherwise, I&apos;m doing okay. I think I&apos;ve got a grip on this generally though."><a href="#t1526760551000108" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-19</span> <span class="t" onclick="H(this)">20:09:11</span>                dominicm </span><span>But otherwise, I&apos;m doing okay. I think I&apos;ve got a grip on this generally though.</span></div><div id="t1526762893000091" t="2018-05-19 20:48:13 dominicm (defrule DatabaseBox-Engine
  [?dbi &lt;- AWSDBInstance]
  [?dbox &lt;- DatabaseBox]
  [RollCreatedFor (= e ?dbi)]
  [DatabaseBoxEngine (= e ?dbox) (= ?v v)]
  =&gt;
  (insert!
    (-&gt;AWSDBInstanceEngine ?dbi ?v)))
 

This inserts 2  AWSDBInstanceEngine  rules, I think I understand why, it&apos;s due to how the dataset is being queried. Do rule engines / Does clara provide anything around  stopping the insertion of facts twice here? I&apos;m quite happy to &quot;defend&quot; on the LHS, rather than attempt to deduplicate on the RHS.

I&apos;m somewhat trying to avoid having to figure out conflict resolution in my final state."><a href="#t1526762893000091" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-19</span> <span class="t" onclick="H(this)">20:48:13</span>                dominicm </span><pre>(defrule DatabaseBox-Engine
  [?dbi &lt;- AWSDBInstance]
  [?dbox &lt;- DatabaseBox]
  [RollCreatedFor (= e ?dbi)]
  [DatabaseBoxEngine (= e ?dbox) (= ?v v)]
  =&gt;
  (insert!
    (-&gt;AWSDBInstanceEngine ?dbi ?v)))
</pre><span>

This inserts 2 </span><code>AWSDBInstanceEngine</code><span> rules, I think I understand why, it&apos;s due to how the dataset is being queried. Do rule engines / Does clara provide anything around  stopping the insertion of facts twice here? I&apos;m quite happy to &quot;defend&quot; on the LHS, rather than attempt to deduplicate on the RHS.

I&apos;m somewhat trying to avoid having to figure out conflict resolution in my final state.</span></div><div id="t1526764634000058" t="2018-05-19 21:17:14 mikerod @dominicm I haven’t been able to look at anything today. I can quickly answe your last question though: Clara doesn’t try to prevent duplicates. That’s up to your logical structuring.  You can often do something like an accumulate all sort of rule to “de dupe “ or aggregate your duplicate facts and choose how to merge it. So you’d let some “intermediate type” be duplicated but have some downstream aggregate/merged type result from them and then be used in subsequent rules"><a href="#t1526764634000058" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-19</span> <span class="t" onclick="H(this)">21:17:14</span>                 mikerod </span><span>@dominicm I haven’t been able to look at anything today. I can quickly answe your last question though: Clara doesn’t try to prevent duplicates. That’s up to your logical structuring.  You can often do something like an accumulate all sort of rule to “de dupe “ or aggregate your duplicate facts and choose how to merge it. So you’d let some “intermediate type” be duplicated but have some downstream aggregate/merged type result from them and then be used in subsequent rules</span></div><div id="t1526764688000090" t="2018-05-19 21:18:08 mikerod It’d be interesting to have a mode for Clara to prevent duplicates. However there are practical use cases for actually wanting duplicates too. So the default I feel is sane. Think something about logic that cares about cardinality of matches etc. Also removing duplicates tends to be performance overhead. "><a href="#t1526764688000090" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-19</span> <span class="t" onclick="H(this)">21:18:08</span>                 mikerod </span><span>It’d be interesting to have a mode for Clara to prevent duplicates. However there are practical use cases for actually wanting duplicates too. So the default I feel is sane. Think something about logic that cares about cardinality of matches etc. Also removing duplicates tends to be performance overhead. </span></div><div id="t1526764910000046" t="2018-05-19 21:21:50 dominicm @mikerod yeah, I actually want the many cardinality in some cases. I was hoping there might be a way to structure the rule such that there was no duplicates in the query."><a href="#t1526764910000046" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-19</span> <span class="t" onclick="H(this)">21:21:50</span>                dominicm </span><span>@mikerod yeah, I actually want the many cardinality in some cases. I was hoping there might be a way to structure the rule such that there was no duplicates in the query.</span></div><div id="t1526765058000043" t="2018-05-19 21:24:18 mikerod I could give good example if not on phone. Hah"><a href="#t1526765058000043" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-19</span> <span class="t" onclick="H(this)">21:24:18</span>                 mikerod </span><span>I could give good example if not on phone. Hah</span></div><div id="t1526765081000090" t="2018-05-19 21:24:41 alex-dixon (defrule DatabaseBox-Engine
  [?dbi &lt;- AWSDBInstance]
  [?dbox &lt;- DatabaseBox]
  [RollCreatedFor (= e ?dbi)]
  [DatabaseBoxEngine (= e ?dbox) (= ?v v)]
[:not AWSDBInstanceEngine ?dbi ?v]
 
Maybe something like this? Sry on phone also "><a href="#t1526765081000090" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-19</span> <span class="t" onclick="H(this)">21:24:41</span>              alex-dixon </span><pre>(defrule DatabaseBox-Engine
  [?dbi &lt;- AWSDBInstance]
  [?dbox &lt;- DatabaseBox]
  [RollCreatedFor (= e ?dbi)]
  [DatabaseBoxEngine (= e ?dbox) (= ?v v)]
[:not AWSDBInstanceEngine ?dbi ?v]
</pre><span>
Maybe something like this? Sry on phone also </span></div><div id="t1526765088000034" t="2018-05-19 21:24:48 mikerod I tend to just let the rules insert duplicates. But make it a intermediate fact type. Then have a single rule that aggregates it. "><a href="#t1526765088000034" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-19</span> <span class="t" onclick="H(this)">21:24:48</span>                 mikerod </span><span>I tend to just let the rules insert duplicates. But make it a intermediate fact type. Then have a single rule that aggregates it. </span></div><div id="t1526765112000090" t="2018-05-19 21:25:12 mikerod There are negation patterns too. Like @alex-dixon just said. You just have to watch out for making a logical infinite loop"><a href="#t1526765112000090" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-19</span> <span class="t" onclick="H(this)">21:25:12</span>                 mikerod </span><span>There are negation patterns too. Like @alex-dixon just said. You just have to watch out for making a logical infinite loop</span></div><div id="t1526765336000027" t="2018-05-19 21:28:56 mikerod Defrule example

Lhs Logic

=&gt;

Insert IntermediateThing data from rule

Defrule aggregate-dups 

?all &lt;- acc/all :from IntermediateThing (= ?id is)

=&gt;

Insert RealThing (merge-somehow ?all)

"><a href="#t1526765336000027" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-19</span> <span class="t" onclick="H(this)">21:28:56</span>                 mikerod </span><pre>Defrule example

Lhs Logic

=&gt;

Insert IntermediateThing data from rule

Defrule aggregate-dups 

?all &lt;- acc/all :from IntermediateThing (= ?id is)

=&gt;

Insert RealThing (merge-somehow ?all)

</pre></div><div id="t1526765356000018" t="2018-05-19 21:29:16 mikerod Pseudo code"><a href="#t1526765356000018" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-19</span> <span class="t" onclick="H(this)">21:29:16</span>                 mikerod </span><span>Pseudo code</span></div><div id="t1526765787000082" t="2018-05-19 21:36:27 dominicm Appreciate the help here. I&apos;ll take a shot at this tomorrow"><a href="#t1526765787000082" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-19</span> <span class="t" onclick="H(this)">21:36:27</span>                dominicm </span><span>Appreciate the help here. I&apos;ll take a shot at this tomorrow</span></div><div id="t1526765894000005" t="2018-05-19 21:38:14 alex-dixon Nb I think my example above would loop with insert logical, not if you were to use insert unconditional "><a href="#t1526765894000005" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-19</span> <span class="t" onclick="H(this)">21:38:14</span>              alex-dixon </span><span>Nb I think my example above would loop with insert logical, not if you were to use insert unconditional </span></div><div id="t1526767756000070" t="2018-05-19 22:09:16 dominicm I&apos;m worried about unconditional insert, because I don&apos;t want ordering to become a problem. The intermediate facts also feel &quot;icky&quot;, I think because they expose a part of the LHS which isn&apos;t able to match the user&apos;s view of the world. It feels more incidental, and less domain."><a href="#t1526767756000070" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-19</span> <span class="t" onclick="H(this)">22:09:16</span>                dominicm </span><span>I&apos;m worried about unconditional insert, because I don&apos;t want ordering to become a problem. The intermediate facts also feel &quot;icky&quot;, I think because they expose a part of the LHS which isn&apos;t able to match the user&apos;s view of the world. It feels more incidental, and less domain.</span></div><div id="t1526769664000035" t="2018-05-19 22:41:04 mikerod I like to be able to avoid unconditional inserts. But there are reasons where it can’t be easily avoided currently. Those are mostly around expressing removing old facts etc. I typically don’t use it though. "><a href="#t1526769664000035" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-19</span> <span class="t" onclick="H(this)">22:41:04</span>                 mikerod </span><span>I like to be able to avoid unconditional inserts. But there are reasons where it can’t be easily avoided currently. Those are mostly around expressing removing old facts etc. I typically don’t use it though. </span></div><div id="t1526769678000108" t="2018-05-19 22:41:18 mikerod I don’t see intermediate facts as a bad thing. I think it is really common. "><a href="#t1526769678000108" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-19</span> <span class="t" onclick="H(this)">22:41:18</span>                 mikerod </span><span>I don’t see intermediate facts as a bad thing. I think it is really common. </span></div><div id="t1526769715000062" t="2018-05-19 22:41:55 mikerod Often have to express intermediate concepts to connect rules for more complex logical conditions. At least in my experience with the rules I’ve needed to write. "><a href="#t1526769715000062" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-19</span> <span class="t" onclick="H(this)">22:41:55</span>                 mikerod </span><span>Often have to express intermediate concepts to connect rules for more complex logical conditions. At least in my experience with the rules I’ve needed to write. </span></div><div id="t1526805637000003" t="2018-05-20 08:40:37 dominicm I seem to have identified a big misunderstanding on my part:

 (ns bugB
  (:require
    [clara.rules :refer :all]))

(defrecord DatabaseBox [id])
(defrecord AWSDBInstance [id])

(defrecord DatabaseBoxEngine [e v])
(defrecord AWSDBInstanceEngine [e v])
(defrecord RollCreatedFor [e v])

(defrule DatabaseBox-Engine
  [RollCreatedFor (= e ?dbi) (= v ?dbox)]
  [DatabaseBoxEngine (= e ?dbox) (= ?v v)]
  =&gt;
  (println ?dbi ?dbox ?v))

(comment
  (clear-ns-productions!)
  (let [foo (-&gt;DatabaseBox &quot;foo&quot;)
        foo-db (-&gt;AWSDBInstance &quot;foo&quot;)
        foo-db-backup (-&gt;AWSDBInstance &quot;foo-backup&quot;)]
    (-&gt; (mk-session)
        (insert
          foo
          (-&gt;DatabaseBoxEngine foo :postgres)
          foo-db
          (-&gt;RollCreatedFor foo-db foo)
          foo-db-backup
          (-&gt;RollCreatedFor foo-db-backup foo-db)
          (-&gt;RollCreatedFor foo-db-backup foo))
        (fire-rules))))
 

I cannot understand why this prints  #bugB.AWSDBInstance{:id foo-backup} #bugB.AWSDBInstance{:id foo} :postgres  (among the 2 other results, I expect of AWSDBInstace with a  DatabaseBox). I particularly don&apos;t understand how it finds a DatabaseBoxEngine where  e  is an AWSDBInstance?"><a href="#t1526805637000003" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-20</span> <span class="t" onclick="H(this)">08:40:37</span>                dominicm </span><span>I seem to have identified a big misunderstanding on my part:

</span><pre>(ns bugB
  (:require
    [clara.rules :refer :all]))

(defrecord DatabaseBox [id])
(defrecord AWSDBInstance [id])

(defrecord DatabaseBoxEngine [e v])
(defrecord AWSDBInstanceEngine [e v])
(defrecord RollCreatedFor [e v])

(defrule DatabaseBox-Engine
  [RollCreatedFor (= e ?dbi) (= v ?dbox)]
  [DatabaseBoxEngine (= e ?dbox) (= ?v v)]
  =&gt;
  (println ?dbi ?dbox ?v))

(comment
  (clear-ns-productions!)
  (let [foo (-&gt;DatabaseBox &quot;foo&quot;)
        foo-db (-&gt;AWSDBInstance &quot;foo&quot;)
        foo-db-backup (-&gt;AWSDBInstance &quot;foo-backup&quot;)]
    (-&gt; (mk-session)
        (insert
          foo
          (-&gt;DatabaseBoxEngine foo :postgres)
          foo-db
          (-&gt;RollCreatedFor foo-db foo)
          foo-db-backup
          (-&gt;RollCreatedFor foo-db-backup foo-db)
          (-&gt;RollCreatedFor foo-db-backup foo))
        (fire-rules))))
</pre><span>

I cannot understand why this prints </span><code>#bugB.AWSDBInstance{:id foo-backup} #bugB.AWSDBInstance{:id foo} :postgres</code><span> (among the 2 other results, I expect of AWSDBInstace with a  DatabaseBox). I particularly don&apos;t understand how it finds a DatabaseBoxEngine where </span><code>e</code><span> is an AWSDBInstance?</span></div><div id="t1526805670000062" t="2018-05-20 08:41:10 dominicm The total output:

 #bugB.AWSDBInstance{:id foo} #bugB.DatabaseBox{:id foo} :postgres
#bugB.AWSDBInstance{:id foo-backup} #bugB.DatabaseBox{:id foo} :postgres
#bugB.AWSDBInstance{:id foo-backup} #bugB.AWSDBInstance{:id foo} :postgres
"><a href="#t1526805670000062" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-20</span> <span class="t" onclick="H(this)">08:41:10</span>                dominicm </span><span>The total output:

</span><pre>#bugB.AWSDBInstance{:id foo} #bugB.DatabaseBox{:id foo} :postgres
#bugB.AWSDBInstance{:id foo-backup} #bugB.DatabaseBox{:id foo} :postgres
#bugB.AWSDBInstance{:id foo-backup} #bugB.AWSDBInstance{:id foo} :postgres
</pre></div><div id="t1526837539000028" t="2018-05-20 17:32:19 alex-dixon Looks like the only a database box engine has an e of  foo record and if that’s your only rule there’s no way it should match on two different fact types when the fact type function is type"><a href="#t1526837539000028" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-20</span> <span class="t" onclick="H(this)">17:32:19</span>              alex-dixon </span><span>Looks like the only a database box engine has an e of  foo record and if that’s your only rule there’s no way it should match on two different fact types when the fact type function is type</span></div><div id="t1526838848000093" t="2018-05-20 17:54:08 dominicm @alex-dixon sorry, I&apos;m struggling to understand. Can you try in different terms."><a href="#t1526838848000093" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-20</span> <span class="t" onclick="H(this)">17:54:08</span>                dominicm </span><span>@alex-dixon sorry, I&apos;m struggling to understand. Can you try in different terms.</span></div><div id="t1526838883000035" t="2018-05-20 17:54:43 alex-dixon What’s happening seems completely wrong"><a href="#t1526838883000035" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-20</span> <span class="t" onclick="H(this)">17:54:43</span>              alex-dixon </span><span>What’s happening seems completely wrong</span></div><div id="t1526838927000017" t="2018-05-20 17:55:27 alex-dixon Your rule expresses a join your input data can satisfy at most once"><a href="#t1526838927000017" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-20</span> <span class="t" onclick="H(this)">17:55:27</span>              alex-dixon </span><span>Your rule expresses a join your input data can satisfy at most once</span></div><div id="t1526839037000107" t="2018-05-20 17:57:17 alex-dixon And your rule specifies a join on two different fact types. So a match for it that contains only one fact type should be impossible "><a href="#t1526839037000107" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-20</span> <span class="t" onclick="H(this)">17:57:17</span>              alex-dixon </span><span>And your rule specifies a join on two different fact types. So a match for it that contains only one fact type should be impossible </span></div><div id="t1526839102000028" t="2018-05-20 17:58:22 alex-dixon Have you tried restarting the repl?"><a href="#t1526839102000028" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-20</span> <span class="t" onclick="H(this)">17:58:22</span>              alex-dixon </span><span>Have you tried restarting the repl?</span></div><div id="t1526839162000023" t="2018-05-20 17:59:22 alex-dixon Something just seems wildly off. Do you think it could be caused by old repl state?"><a href="#t1526839162000023" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-20</span> <span class="t" onclick="H(this)">17:59:22</span>              alex-dixon </span><span>Something just seems wildly off. Do you think it could be caused by old repl state?</span></div><div id="t1526839451000056" t="2018-05-20 18:04:11 dominicm I&apos;ll try a restart of the repl. I had presumed a fresh namespace was enough."><a href="#t1526839451000056" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-20</span> <span class="t" onclick="H(this)">18:04:11</span>                dominicm </span><span>I&apos;ll try a restart of the repl. I had presumed a fresh namespace was enough.</span></div><div id="t1526839696000031" t="2018-05-20 18:08:16 alex-dixon I would too. I’m not sure how records refresh or whether they are repl friendly in general (think they need imported?). I see you were using clear ns productions but it’s not clear to me how rules are being loaded using mk session without passing in the productions?"><a href="#t1526839696000031" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-20</span> <span class="t" onclick="H(this)">18:08:16</span>              alex-dixon </span><span>I would too. I’m not sure how records refresh or whether they are repl friendly in general (think they need imported?). I see you were using clear ns productions but it’s not clear to me how rules are being loaded using mk session without passing in the productions?</span></div><div id="t1526839833000089" t="2018-05-20 18:10:33 dominicm I&apos;m still getting this behaviour:

 #bugB.AWSDBInstance{:id foo} #bugB.DatabaseBox{:id foo} :postgres
#bugB.AWSDBInstance{:id foo-backup} #bugB.DatabaseBox{:id foo} :postgres
#bugB.AWSDBInstance{:id foo-backup} #bugB.AWSDBInstance{:id foo} :postgres
 

I experimented with  (clear-ns-productions!) , but I&apos;m not actually running it anymore."><a href="#t1526839833000089" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-20</span> <span class="t" onclick="H(this)">18:10:33</span>                dominicm </span><span>I&apos;m still getting this behaviour:

</span><pre>#bugB.AWSDBInstance{:id foo} #bugB.DatabaseBox{:id foo} :postgres
#bugB.AWSDBInstance{:id foo-backup} #bugB.DatabaseBox{:id foo} :postgres
#bugB.AWSDBInstance{:id foo-backup} #bugB.AWSDBInstance{:id foo} :postgres
</pre><span>

I experimented with </span><code>(clear-ns-productions!)</code><span>, but I&apos;m not actually running it anymore.</span></div><div id="t1526839867000096" t="2018-05-20 18:11:07 alex-dixon I see in the source mk session with no args uses /ns/"><a href="#t1526839867000096" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-20</span> <span class="t" onclick="H(this)">18:11:07</span>              alex-dixon </span><span>I see in the source mk session with no args uses /ns/</span></div><div id="t1526839914000123" t="2018-05-20 18:11:54 dominicm yes  🙂"><a href="#t1526839914000123" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-20</span> <span class="t" onclick="H(this)">18:11:54</span>                dominicm </span><span>yes </span><b>🙂</b></div><div id="t1526839920000047" t="2018-05-20 18:12:00 dominicm *ns*"><a href="#t1526839920000047" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-20</span> <span class="t" onclick="H(this)">18:12:00</span>                dominicm </span><code>*ns*</code></div><div id="t1526839922000073" t="2018-05-20 18:12:02 alex-dixon With earmuffs "><a href="#t1526839922000073" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-20</span> <span class="t" onclick="H(this)">18:12:02</span>              alex-dixon </span><span>With earmuffs </span></div><div id="t1526839927000012" t="2018-05-20 18:12:07 alex-dixon Thx lol"><a href="#t1526839927000012" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-20</span> <span class="t" onclick="H(this)">18:12:07</span>              alex-dixon </span><span>Thx lol</span></div><div id="t1526839928000004" t="2018-05-20 18:12:08 dominicm ` is what you&apos;re after"><a href="#t1526839928000004" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-20</span> <span class="t" onclick="H(this)">18:12:08</span>                dominicm </span><span>` is what you&apos;re after</span></div><div id="t1526839956000022" t="2018-05-20 18:12:36 alex-dixon Yeah...Apple doesn’t have that on their phones "><a href="#t1526839956000022" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-20</span> <span class="t" onclick="H(this)">18:12:36</span>              alex-dixon </span><span>Yeah...Apple doesn’t have that on their phones </span></div><div id="t1526840016000083" t="2018-05-20 18:13:36 dominicm oh  😞  silly fruit"><a href="#t1526840016000083" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-20</span> <span class="t" onclick="H(this)">18:13:36</span>                dominicm </span><span>oh </span><b>😞</b><span> silly fruit</span></div><div id="t1526840021000094" t="2018-05-20 18:13:41 alex-dixon The last result is the most glaring"><a href="#t1526840021000094" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-20</span> <span class="t" onclick="H(this)">18:13:41</span>              alex-dixon </span><span>The last result is the most glaring</span></div><div id="t1526840102000158" t="2018-05-20 18:15:02 alex-dixon Try binding the whole fact and printing that out. I may be confused"><a href="#t1526840102000158" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-20</span> <span class="t" onclick="H(this)">18:15:02</span>              alex-dixon </span><span>Try binding the whole fact and printing that out. I may be confused</span></div><div id="t1526840147000111" t="2018-05-20 18:15:47 dominicm which fact, first, second or both?"><a href="#t1526840147000111" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-20</span> <span class="t" onclick="H(this)">18:15:47</span>                dominicm </span><span>which fact, first, second or both?</span></div><div id="t1526840164000029" t="2018-05-20 18:16:04 alex-dixon ?fact1 &lt;- condition 1
?fact2 &lt;- condition 2"><a href="#t1526840164000029" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-20</span> <span class="t" onclick="H(this)">18:16:04</span>              alex-dixon </span><span>?fact1 &lt;- condition 1
?fact2 &lt;- condition 2</span></div><div id="t1526840211000016" t="2018-05-20 18:16:51 dominicm (defrule DatabaseBox-Engine
  [?a &lt;- RollCreatedFor (= e ?dbi) (= v ?dbox)]
  [?b &lt;- DatabaseBoxEngine (= ?dbox e) (= ?v v)]
  =&gt;
  (prn ?a ?b))

=&gt;

; #bugB.RollCreatedFor{:e #bugB.AWSDBInstance{:id &quot;foo&quot;}, :v #bugB.DatabaseBox{:id &quot;foo&quot;}} #bugB.DatabaseBoxEngine{:e #bugB.DatabaseBox{:id &quot;foo&quot;}, :v :postgres}
; #bugB.RollCreatedFor{:e #bugB.AWSDBInstance{:id &quot;foo-backup&quot;}, :v #bugB.DatabaseBox{:id &quot;foo&quot;}} #bugB.DatabaseBoxEngine{:e #bugB.DatabaseBox{:id &quot;foo&quot;}, :v :postgres}
; #bugB.RollCreatedFor{:e #bugB.AWSDBInstance{:id &quot;foo-backup&quot;}, :v #bugB.AWSDBInstance{:id &quot;foo&quot;}} #bugB.DatabaseBoxEngine{:e #bugB.DatabaseBox{:id &quot;foo&quot;}, :v :postgres}
"><a href="#t1526840211000016" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-20</span> <span class="t" onclick="H(this)">18:16:51</span>                dominicm </span><pre>(defrule DatabaseBox-Engine
  [?a &lt;- RollCreatedFor (= e ?dbi) (= v ?dbox)]
  [?b &lt;- DatabaseBoxEngine (= ?dbox e) (= ?v v)]
  =&gt;
  (prn ?a ?b))

=&gt;

; #bugB.RollCreatedFor{:e #bugB.AWSDBInstance{:id &quot;foo&quot;}, :v #bugB.DatabaseBox{:id &quot;foo&quot;}} #bugB.DatabaseBoxEngine{:e #bugB.DatabaseBox{:id &quot;foo&quot;}, :v :postgres}
; #bugB.RollCreatedFor{:e #bugB.AWSDBInstance{:id &quot;foo-backup&quot;}, :v #bugB.DatabaseBox{:id &quot;foo&quot;}} #bugB.DatabaseBoxEngine{:e #bugB.DatabaseBox{:id &quot;foo&quot;}, :v :postgres}
; #bugB.RollCreatedFor{:e #bugB.AWSDBInstance{:id &quot;foo-backup&quot;}, :v #bugB.AWSDBInstance{:id &quot;foo&quot;}} #bugB.DatabaseBoxEngine{:e #bugB.DatabaseBox{:id &quot;foo&quot;}, :v :postgres}
</pre></div><div id="t1526840465000110" t="2018-05-20 18:21:05 alex-dixon Ok so the fact types are right I was mistaken on that"><a href="#t1526840465000110" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-20</span> <span class="t" onclick="H(this)">18:21:05</span>              alex-dixon </span><span>Ok so the fact types are right I was mistaken on that</span></div><div id="t1526842336000131" t="2018-05-20 18:52:16 dominicm I suppose that in    [?b &lt;- DatabaseBoxEngine (= ?dbox e) (= ?v v)]  The  (= ?dbox e)  is being ignored."><a href="#t1526842336000131" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-20</span> <span class="t" onclick="H(this)">18:52:16</span>                dominicm </span><span>I suppose that in </span><code>  [?b &lt;- DatabaseBoxEngine (= ?dbox e) (= ?v v)]</code><span> The </span><code>(= ?dbox e)</code><span> is being ignored.</span></div><div id="t1526854287000112" t="2018-05-20 22:11:27 thegeez (= (-&gt;DatabaseBox &quot;foo&quot;)
     (-&gt;AWSDBInstance &quot;foo&quot;)) ;; =&gt; false
  (.equals (-&gt;DatabaseBox &quot;foo&quot;)
           (-&gt;AWSDBInstance &quot;foo&quot;)) ;; =&gt; true  So there is probably some confusion in some of the java collections used within clara"><a href="#t1526854287000112" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-20</span> <span class="t" onclick="H(this)">22:11:27</span>                 thegeez </span><pre>(= (-&gt;DatabaseBox &quot;foo&quot;)
     (-&gt;AWSDBInstance &quot;foo&quot;)) ;; =&gt; false
  (.equals (-&gt;DatabaseBox &quot;foo&quot;)
           (-&gt;AWSDBInstance &quot;foo&quot;)) ;; =&gt; true</pre><span> So there is probably some confusion in some of the java collections used within clara</span></div><div id="t1526857563000097" t="2018-05-20 23:06:03 thegeez @dominicm the problem is here:  https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/rules/platform.cljc#L11 
Replace the group-by-seq with  (seq (group-by f coll))  and it works properly again"><a href="#t1526857563000097" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-20</span> <span class="t" onclick="H(this)">23:06:03</span>                 thegeez </span><span>@dominicm the problem is here: </span><a href="https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/rules/platform.cljc#L11" target="_blank">https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/rules/platform.cljc#L11</a><span>
Replace the group-by-seq with </span><pre>(seq (group-by f coll))</pre><span> and it works properly again</span></div><div id="t1526857653000073" t="2018-05-20 23:07:33 thegeez (platform/group-by-seq vector
                         [(-&gt;DatabaseBox &quot;foo&quot;)
                          (-&gt;AWSDBInstance &quot;foo&quot;)])
  ;; =&gt;   [[[#clara_bug.core.DatabaseBox{:id &quot;foo&quot;}] [#clara_bug.core.DatabaseBox{:id &quot;foo&quot;} #clara_bug.core.AWSDBInstance{:id &quot;foo&quot;}]]]

  (defn group-by-seq [f coll]
    (seq (group-by f coll)))
  (group-by-seq vector
                [(-&gt;DatabaseBox &quot;foo&quot;)
                 (-&gt;AWSDBInstance &quot;foo&quot;)])
  ;; =&gt; ([[#clara_bug.core.DatabaseBox{:id &quot;foo&quot;}] [#clara_bug.core.DatabaseBox{:id &quot;foo&quot;}]] [[#clara_bug.core.AWSDBInstance{:id &quot;foo&quot;}] [#clara_bug.core.AWSDBInstance{:id &quot;foo&quot;}]])"><a href="#t1526857653000073" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-20</span> <span class="t" onclick="H(this)">23:07:33</span>                 thegeez </span><pre>(platform/group-by-seq vector
                         [(-&gt;DatabaseBox &quot;foo&quot;)
                          (-&gt;AWSDBInstance &quot;foo&quot;)])
  ;; =&gt;   [[[#clara_bug.core.DatabaseBox{:id &quot;foo&quot;}] [#clara_bug.core.DatabaseBox{:id &quot;foo&quot;} #clara_bug.core.AWSDBInstance{:id &quot;foo&quot;}]]]

  (defn group-by-seq [f coll]
    (seq (group-by f coll)))
  (group-by-seq vector
                [(-&gt;DatabaseBox &quot;foo&quot;)
                 (-&gt;AWSDBInstance &quot;foo&quot;)])
  ;; =&gt; ([[#clara_bug.core.DatabaseBox{:id &quot;foo&quot;}] [#clara_bug.core.DatabaseBox{:id &quot;foo&quot;}]] [[#clara_bug.core.AWSDBInstance{:id &quot;foo&quot;}] [#clara_bug.core.AWSDBInstance{:id &quot;foo&quot;}]])</pre></div><div id="t1526880582000054" t="2018-05-21 05:29:42 dominicm That equality is crazy! Thanks!"><a href="#t1526880582000054" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-21</span> <span class="t" onclick="H(this)">05:29:42</span>                dominicm </span><span>That equality is crazy! Thanks!</span></div><div id="t1526881170000153" t="2018-05-21 05:39:30 dominicm https://dev.clojure.org/jira/browse/CLJ-867"><a href="#t1526881170000153" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-21</span> <span class="t" onclick="H(this)">05:39:30</span>                dominicm </span><a href="https://dev.clojure.org/jira/browse/CLJ-867" target="_blank">https://dev.clojure.org/jira/browse/CLJ-867</a></div><div id="t1526882354000077" t="2018-05-21 05:59:14 dominicm http://clojuredocs.org/clojure.core/defrecord 

&gt; and will defined Java .hashCode and .equals consistent with the contract for java.util.Map.

Looks like this is intentional"><a href="#t1526882354000077" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-21</span> <span class="t" onclick="H(this)">05:59:14</span>                dominicm </span><a href="http://clojuredocs.org/clojure.core/defrecord" target="_blank">http://clojuredocs.org/clojure.core/defrecord</a><span>

&gt; and will defined Java .hashCode and .equals consistent with the contract for java.util.Map.

Looks like this is intentional</span></div><div id="t1526889389000216" t="2018-05-21 07:56:29 dominicm (definterface Foo
  (getB []))

(deftype C [a]
  Foo
  (getB [this] a))

(deftype B [a]
  Foo
  (getB [this] a))
 

Onto java beans I go!"><a href="#t1526889389000216" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-21</span> <span class="t" onclick="H(this)">07:56:29</span>                dominicm </span><pre>(definterface Foo
  (getB []))

(deftype C [a]
  Foo
  (getB [this] a))

(deftype B [a]
  Foo
  (getB [this] a))
</pre><span>

Onto java beans I go!</span></div><div id="t1526899926000115" t="2018-05-21 10:52:06 mikerod Clara just uses clojure =. Not sure the issue above? Clojure = takes type into consideration with records. "><a href="#t1526899926000115" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-21</span> <span class="t" onclick="H(this)">10:52:06</span>                 mikerod </span><span>Clara just uses clojure =. Not sure the issue above? Clojure = takes type into consideration with records. </span></div><div id="t1526900065000073" t="2018-05-21 10:54:25 dominicm @mikerod The code that @thegeez referred to uses a java.util.HashMap, which uses java&apos;s notion of equality."><a href="#t1526900065000073" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-21</span> <span class="t" onclick="H(this)">10:54:25</span>                dominicm </span><span>@mikerod The code that @thegeez referred to uses a java.util.HashMap, which uses java&apos;s notion of equality.</span></div><div id="t1526900334000022" t="2018-05-21 10:58:54 dominicm Fortunately for me, I am in an intersection of 2 points:
1) My data is all the same keys
2) I use macros for generating my types

So I&apos;ve been able to switch to beans with  deftype  rather trivially, and that&apos;s resolved everything."><a href="#t1526900334000022" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-21</span> <span class="t" onclick="H(this)">10:58:54</span>                dominicm </span><span>Fortunately for me, I am in an intersection of 2 points:
1) My data is all the same keys
2) I use macros for generating my types

So I&apos;ve been able to switch to beans with </span><code>deftype</code><span> rather trivially, and that&apos;s resolved everything.</span></div><div id="t1526903542000361" t="2018-05-21 11:52:22 mikerod @dominicm that’s interesting. I don’t know how you were encountering the use of  platform/group-by-seq  though. It does sound to me like there could be potential edge cases around  platform/group-by-seq  though on the jvm-impl since it does make use of Java collections to (a) preserve consistent order (b) do the grouping and order preservation efficiently."><a href="#t1526903542000361" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-21</span> <span class="t" onclick="H(this)">11:52:22</span>                 mikerod </span><span>@dominicm that’s interesting. I don’t know how you were encountering the use of </span><code>platform/group-by-seq</code><span> though. It does sound to me like there could be potential edge cases around </span><code>platform/group-by-seq</code><span> though on the jvm-impl since it does make use of Java collections to (a) preserve consistent order (b) do the grouping and order preservation efficiently.</span></div><div id="t1526904145000194" t="2018-05-21 12:02:25 thegeez @mikerod if the promise is that clojure = is used, than @dominicm’s example shows a bug"><a href="#t1526904145000194" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-21</span> <span class="t" onclick="H(this)">12:02:25</span>                 thegeez </span><span>@mikerod if the promise is that clojure = is used, than @dominicm’s example shows a bug</span></div><div id="t1526904310000351" t="2018-05-21 12:05:10 thegeez (defrecord ClauseOne [b])
(defrecord ClauseTwo [b])

(defrule rule-one
  [ClauseOne (= ?b b)]
  [ClauseTwo (= ?b b)]
 =&gt;
  (println &quot;Match found:&quot; ?b )
  )

(defrecord WrapAlice [num])
(defrecord WrapBob [num])

(comment
  (clear-ns-productions!)
  (let [alice (-&gt;WrapAlice 1)
        bob (-&gt;WrapBob 1)]
    (println &quot;(= alice bob)&quot; (= alice bob))
    (println &quot;(.equals alice bob)&quot; (.equals alice bob))
    (-&gt; (mk-session)
        (insert
         (-&gt;ClauseOne alice)
         ;; Line below is important, without it the wrong behavior does not surface
         (-&gt;ClauseTwo alice)
         (-&gt;ClauseTwo bob)
         )
        (fire-rules)
        ))
  ;;(= alice bob) false
  ;;(.equals alice bob) true
  ;; Match found: #clara_bug.core.WrapAlice{:num 1}
  ;; Match found: #clara_bug.core.WrapBob{:num 1} ;; &lt;- should not happen
  )
"><a href="#t1526904310000351" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-21</span> <span class="t" onclick="H(this)">12:05:10</span>                 thegeez </span><pre>(defrecord ClauseOne [b])
(defrecord ClauseTwo [b])

(defrule rule-one
  [ClauseOne (= ?b b)]
  [ClauseTwo (= ?b b)]
 =&gt;
  (println &quot;Match found:&quot; ?b )
  )

(defrecord WrapAlice [num])
(defrecord WrapBob [num])

(comment
  (clear-ns-productions!)
  (let [alice (-&gt;WrapAlice 1)
        bob (-&gt;WrapBob 1)]
    (println &quot;(= alice bob)&quot; (= alice bob))
    (println &quot;(.equals alice bob)&quot; (.equals alice bob))
    (-&gt; (mk-session)
        (insert
         (-&gt;ClauseOne alice)
         ;; Line below is important, without it the wrong behavior does not surface
         (-&gt;ClauseTwo alice)
         (-&gt;ClauseTwo bob)
         )
        (fire-rules)
        ))
  ;;(= alice bob) false
  ;;(.equals alice bob) true
  ;; Match found: #clara_bug.core.WrapAlice{:num 1}
  ;; Match found: #clara_bug.core.WrapBob{:num 1} ;; &lt;- should not happen
  )
</pre></div><div id="t1526906848000055" t="2018-05-21 12:47:28 mikerod @thegeez I think this actually is a bug"><a href="#t1526906848000055" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-21</span> <span class="t" onclick="H(this)">12:47:28</span>                 mikerod </span><span>@thegeez I think this actually is a bug</span></div><div id="t1526906866000058" t="2018-05-21 12:47:46 mikerod I had suspicion of it being one as soon as I saw this discussion above regarding  platform/group-by-seq"><a href="#t1526906866000058" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-21</span> <span class="t" onclick="H(this)">12:47:46</span>                 mikerod </span><span>I had suspicion of it being one as soon as I saw this discussion above regarding </span><code>platform/group-by-seq</code></div><div id="t1526906985000233" t="2018-05-21 12:49:45 mikerod platform/group-by-seq  was added on the JVM-Clara to make the operation of grouping more efficient, as well as to have deterministic ordering of the seq it returns on each run to avoid variance in rule performance. The use of Java collections for this can cause subtle problems when the bindings of fact fields are record types that are  Object.equals()  from Java, but not  clojure.core/= . This is the case with Clj record since their Java-interop form uses Java map equality instead of incorporating the type."><a href="#t1526906985000233" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-21</span> <span class="t" onclick="H(this)">12:49:45</span>                 mikerod </span><code>platform/group-by-seq</code><span> was added on the JVM-Clara to make the operation of grouping more efficient, as well as to have deterministic ordering of the seq it returns on each run to avoid variance in rule performance. The use of Java collections for this can cause subtle problems when the bindings of fact fields are record types that are </span><code>Object.equals()</code><span> from Java, but not </span><code>clojure.core/=</code><span>. This is the case with Clj record since their Java-interop form uses Java map equality instead of incorporating the type.</span></div><div id="t1526907304000132" t="2018-05-21 12:55:04 thegeez @mikerod this might be of use:  https://github.com/ztellman/bizarro-collections  to get a speedy group-by-seq with the semantics of clojure ="><a href="#t1526907304000132" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-21</span> <span class="t" onclick="H(this)">12:55:04</span>                 thegeez </span><span>@mikerod this might be of use: </span><a href="https://github.com/ztellman/bizarro-collections" target="_blank">https://github.com/ztellman/bizarro-collections</a><span> to get a speedy group-by-seq with the semantics of clojure =</span></div><div id="t1526907357000029" t="2018-05-21 12:55:57 mikerod I believe the issue is fairly isolated to the  platform/group-by-seq . I think the solution would be to stop using a Java-based equality hashmap impl. A clj based one would be needed instead. It may be slightly tricky to do to keep similar performance characteristics. (it’s a hot spot in the rule engine)."><a href="#t1526907357000029" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-21</span> <span class="t" onclick="H(this)">12:55:57</span>                 mikerod </span><span>I believe the issue is fairly isolated to the </span><code>platform/group-by-seq</code><span>. I think the solution would be to stop using a Java-based equality hashmap impl. A clj based one would be needed instead. It may be slightly tricky to do to keep similar performance characteristics. (it’s a hot spot in the rule engine).</span></div><div id="t1526907385000340" t="2018-05-21 12:56:25 mikerod @thegeez maybe, but we need a “linked hash map”"><a href="#t1526907385000340" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-21</span> <span class="t" onclick="H(this)">12:56:25</span>                 mikerod </span><span>@thegeez maybe, but we need a “linked hash map”</span></div><div id="t1526907397000120" t="2018-05-21 12:56:37 mikerod the deterministic “order preservation” is an important characteristic"><a href="#t1526907397000120" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-21</span> <span class="t" onclick="H(this)">12:56:37</span>                 mikerod </span><span>the deterministic “order preservation” is an important characteristic</span></div><div id="t1526907420000378" t="2018-05-21 12:57:00 mikerod I believe the bizarro only has hash map (unordered)"><a href="#t1526907420000378" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-21</span> <span class="t" onclick="H(this)">12:57:00</span>                 mikerod </span><span>I believe the bizarro only has hash map (unordered)</span></div><div id="t1526907519000375" t="2018-05-21 12:58:39 mikerod a  java.util.LinkedHashMap  is used to do the grouping by operations, then it is seq’ed in  platform/group-by-seq . The order the  seq  comes out, we want to be the same given the same input, independently from one process/machine to another (really, the Java runtime execution)"><a href="#t1526907519000375" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-21</span> <span class="t" onclick="H(this)">12:58:39</span>                 mikerod </span><span>a </span><code>java.util.LinkedHashMap</code><span> is used to do the grouping by operations, then it is seq’ed in </span><code>platform/group-by-seq</code><span>. The order the </span><code>seq</code><span> comes out, we want to be the same given the same input, independently from one process/machine to another (really, the Java runtime execution)</span></div><div id="t1526907551000369" t="2018-05-21 12:59:11 mikerod If we didn’t need the order preservation part, we could just use a clj transient map and likely not have a problem with performance"><a href="#t1526907551000369" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-21</span> <span class="t" onclick="H(this)">12:59:11</span>                 mikerod </span><span>If we didn’t need the order preservation part, we could just use a clj transient map and likely not have a problem with performance</span></div><div id="t1526907603000704" t="2018-05-21 13:00:03 mikerod One solution would just be to write some sort of collection in Clara to fit this goal. That maybe the smoothest path forward."><a href="#t1526907603000704" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-21</span> <span class="t" onclick="H(this)">13:00:03</span>                 mikerod </span><span>One solution would just be to write some sort of collection in Clara to fit this goal. That maybe the smoothest path forward.</span></div><div id="t1526907814000145" t="2018-05-21 13:03:34 dominicm https://github.com/amalloy/ordered  supports transients."><a href="#t1526907814000145" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-21</span> <span class="t" onclick="H(this)">13:03:34</span>                dominicm </span><a href="https://github.com/amalloy/ordered" target="_blank">https://github.com/amalloy/ordered</a><span> supports transients.</span></div><div id="t1526907836000508" t="2018-05-21 13:03:56 thegeez I don&apos;t know of one of the shelve"><a href="#t1526907836000508" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-21</span> <span class="t" onclick="H(this)">13:03:56</span>                 thegeez </span><span>I don&apos;t know of one of the shelve</span></div><div id="t1526907872000486" t="2018-05-21 13:04:32 thegeez But when does the case occur that the order is different between process? And when do these two different orderings meet?"><a href="#t1526907872000486" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-21</span> <span class="t" onclick="H(this)">13:04:32</span>                 thegeez </span><span>But when does the case occur that the order is different between process? And when do these two different orderings meet?</span></div><div id="t1526908768000210" t="2018-05-21 13:19:28 mikerod @dominicm @thegeez I logged  https://github.com/cerner/clara-rules/issues/393  - fixed link"><a href="#t1526908768000210" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-21</span> <span class="t" onclick="H(this)">13:19:28</span>                 mikerod </span><span>@dominicm @thegeez I logged </span><a href="https://github.com/cerner/clara-rules/issues/393" target="_blank">https://github.com/cerner/clara-rules/issues/393</a><span> - fixed link</span></div><div id="t1526908796000449" t="2018-05-21 13:19:56 mikerod it has quite a bit of detail on this"><a href="#t1526908796000449" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-21</span> <span class="t" onclick="H(this)">13:19:56</span>                 mikerod </span><span>it has quite a bit of detail on this</span></div><div id="t1526908815000614" t="2018-05-21 13:20:15 mikerod determinism from one JVM instance to another is pretty important in some production scenarios"><a href="#t1526908815000614" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-21</span> <span class="t" onclick="H(this)">13:20:15</span>                 mikerod </span><span>determinism from one JVM instance to another is pretty important in some production scenarios</span></div><div id="t1526908839000347" t="2018-05-21 13:20:39 mikerod platform/group-by-seq  is hit in a hot spot in the engine - it has a fairly large effect on performance"><a href="#t1526908839000347" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-21</span> <span class="t" onclick="H(this)">13:20:39</span>                 mikerod </span><code>platform/group-by-seq</code><span> is hit in a hot spot in the engine - it has a fairly large effect on performance</span></div><div id="t1526908866000019" t="2018-05-21 13:21:06 mikerod the order of its results can play a large role in the activity that takes place within the engines evaluation of the network facts"><a href="#t1526908866000019" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-21</span> <span class="t" onclick="H(this)">13:21:06</span>                 mikerod </span><span>the order of its results can play a large role in the activity that takes place within the engines evaluation of the network facts</span></div><div id="t1526908895000104" t="2018-05-21 13:21:35 mikerod If the order changes from run to run, then the performance characteristics change too. This can make it hard to track down a bottleneck that comes up only on occasion"><a href="#t1526908895000104" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-21</span> <span class="t" onclick="H(this)">13:21:35</span>                 mikerod </span><span>If the order changes from run to run, then the performance characteristics change too. This can make it hard to track down a bottleneck that comes up only on occasion</span></div><div id="t1526908937000086" t="2018-05-21 13:22:17 mikerod Also, different orders of evaluation could potentially even lead to things like exceptions thrown in defects in written rules. However, may only sometimes these defects would manifest themselves - aka hard to reproduce problems"><a href="#t1526908937000086" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-21</span> <span class="t" onclick="H(this)">13:22:17</span>                 mikerod </span><span>Also, different orders of evaluation could potentially even lead to things like exceptions thrown in defects in written rules. However, may only sometimes these defects would manifest themselves - aka hard to reproduce problems</span></div><div id="t1526908974000137" t="2018-05-21 13:22:54 mikerod A while back, all known places within Clara’s engine evaluation and compiler were made deterministic run-over-run to alleviate these issues"><a href="#t1526908974000137" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-21</span> <span class="t" onclick="H(this)">13:22:54</span>                 mikerod </span><span>A while back, all known places within Clara’s engine evaluation and compiler were made deterministic run-over-run to alleviate these issues</span></div><div id="t1526909238000694" t="2018-05-21 13:27:18 thegeez This is quickly going beyond what I know of rules systems, which is very little. I&apos;m only surprised to see the &quot;order changes from run to run&quot;, I would expect the ordering to be arbitrary, but the same from run to run with the same input data"><a href="#t1526909238000694" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-21</span> <span class="t" onclick="H(this)">13:27:18</span>                 thegeez </span><span>This is quickly going beyond what I know of rules systems, which is very little. I&apos;m only surprised to see the &quot;order changes from run to run&quot;, I would expect the ordering to be arbitrary, but the same from run to run with the same input data</span></div><div id="t1526910240000097" t="2018-05-21 13:44:00 mikerod @thegeez the ordering guarantees are arbitrary from a user-level semantics"><a href="#t1526910240000097" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-21</span> <span class="t" onclick="H(this)">13:44:00</span>                 mikerod </span><span>@thegeez the ordering guarantees are arbitrary from a user-level semantics</span></div><div id="t1526910250000116" t="2018-05-21 13:44:10 mikerod and the outputs are produced in a deterministic way from that level"><a href="#t1526910250000116" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-21</span> <span class="t" onclick="H(this)">13:44:10</span>                 mikerod </span><span>and the outputs are produced in a deterministic way from that level</span></div><div id="t1526910261000019" t="2018-05-21 13:44:21 mikerod I’m talking on more of a low-level evaluation within the engine"><a href="#t1526910261000019" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-21</span> <span class="t" onclick="H(this)">13:44:21</span>                 mikerod </span><span>I’m talking on more of a low-level evaluation within the engine</span></div><div id="t1526910274000339" t="2018-05-21 13:44:34 mikerod It is basically opaque to the user-level semantics"><a href="#t1526910274000339" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-21</span> <span class="t" onclick="H(this)">13:44:34</span>                 mikerod </span><span>It is basically opaque to the user-level semantics</span></div><div id="t1526910320000787" t="2018-05-21 13:45:20 mikerod however, it has real world implications, (a) deterministic performance characteristics (b) deterministic order things actually are evaluated (mostly useful to reproduce error cases)"><a href="#t1526910320000787" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-21</span> <span class="t" onclick="H(this)">13:45:20</span>                 mikerod </span><span>however, it has real world implications, (a) deterministic performance characteristics (b) deterministic order things actually are evaluated (mostly useful to reproduce error cases)</span></div><div id="t1526910372000468" t="2018-05-21 13:46:12 mikerod Things get more involved if you consider using the truth maintenance system within Clara, ie performing a typical  clara.rules/insert!  on a rule right-hand side (RHS)."><a href="#t1526910372000468" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-21</span> <span class="t" onclick="H(this)">13:46:12</span>                 mikerod </span><span>Things get more involved if you consider using the truth maintenance system within Clara, ie performing a typical </span><code>clara.rules/insert!</code><span> on a rule right-hand side (RHS).</span></div><div id="t1526910395000301" t="2018-05-21 13:46:35 mikerod The engine works to put the system into a consistent logical state"><a href="#t1526910395000301" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-21</span> <span class="t" onclick="H(this)">13:46:35</span>                 mikerod </span><span>The engine works to put the system into a consistent logical state</span></div><div id="t1526910405000034" t="2018-05-21 13:46:45 mikerod The “works” part, is where time is spent"><a href="#t1526910405000034" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-21</span> <span class="t" onclick="H(this)">13:46:45</span>                 mikerod </span><span>The “works” part, is where time is spent</span></div><div id="t1526910436000488" t="2018-05-21 13:47:16 mikerod There are different orders/paths to take to reach the same consistent logical state, depending on how rules are chosen for evaluation, how facts are propagated from node to node in the internal network etc"><a href="#t1526910436000488" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-21</span> <span class="t" onclick="H(this)">13:47:16</span>                 mikerod </span><span>There are different orders/paths to take to reach the same consistent logical state, depending on how rules are chosen for evaluation, how facts are propagated from node to node in the internal network etc</span></div><div id="t1526910452000342" t="2018-05-21 13:47:32 mikerod The determinism I’m talking about is in being deterministic in those inner choices taken"><a href="#t1526910452000342" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-21</span> <span class="t" onclick="H(this)">13:47:32</span>                 mikerod </span><span>The determinism I’m talking about is in being deterministic in those inner choices taken</span></div><div id="t1526910926000423" t="2018-05-21 13:55:26 thegeez If &quot;defsomething A, defsomething B, execute&quot; should do the same as &quot;defsomething B, defsomething A, execute&quot; I would expect the usage of a HashMap instead of a LinkedHashMap, with its insertion-order preserving. That part is still fuzzy in my thinking"><a href="#t1526910926000423" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-21</span> <span class="t" onclick="H(this)">13:55:26</span>                 thegeez </span><span>If &quot;defsomething A, defsomething B, execute&quot; should do the same as &quot;defsomething B, defsomething A, execute&quot; I would expect the usage of a HashMap instead of a LinkedHashMap, with its insertion-order preserving. That part is still fuzzy in my thinking</span></div><div id="t1526911777000696" t="2018-05-21 14:09:37 mikerod @thegeez I guess I’m not able to explain it correctly"><a href="#t1526911777000696" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-21</span> <span class="t" onclick="H(this)">14:09:37</span>                 mikerod </span><span>@thegeez I guess I’m not able to explain it correctly</span></div><div id="t1526911797000580" t="2018-05-21 14:09:57 mikerod Yes, they can do the same thing, however, the way they accomplish it may be different depending on the order"><a href="#t1526911797000580" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-21</span> <span class="t" onclick="H(this)">14:09:57</span>                 mikerod </span><span>Yes, they can do the same thing, however, the way they accomplish it may be different depending on the order</span></div><div id="t1526911808000511" t="2018-05-21 14:10:08 mikerod hash map can arbitrarily change the order"><a href="#t1526911808000511" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-21</span> <span class="t" onclick="H(this)">14:10:08</span>                 mikerod </span><span>hash map can arbitrarily change the order</span></div><div id="t1526911813000448" t="2018-05-21 14:10:13 mikerod and it does"><a href="#t1526911813000448" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-21</span> <span class="t" onclick="H(this)">14:10:13</span>                 mikerod </span><span>and it does</span></div><div id="t1526911837000583" t="2018-05-21 14:10:37 mikerod For example, we had correct rules running in a production case before. However, about 1 in 10 times, it performed about 100x worse"><a href="#t1526911837000583" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-21</span> <span class="t" onclick="H(this)">14:10:37</span>                 mikerod </span><span>For example, we had correct rules running in a production case before. However, about 1 in 10 times, it performed about 100x worse</span></div><div id="t1526911858000207" t="2018-05-21 14:10:58 mikerod that 1 in 10 time, was when the hash map ordered 2 groups in a flipped way"><a href="#t1526911858000207" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-21</span> <span class="t" onclick="H(this)">14:10:58</span>                 mikerod </span><span>that 1 in 10 time, was when the hash map ordered 2 groups in a flipped way</span></div><div id="t1526911874000110" t="2018-05-21 14:11:14 mikerod the engine then went on to do extra work, it hit a performance bottleneck case"><a href="#t1526911874000110" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-21</span> <span class="t" onclick="H(this)">14:11:14</span>                 mikerod </span><span>the engine then went on to do extra work, it hit a performance bottleneck case</span></div><div id="t1526911886000334" t="2018-05-21 14:11:26 mikerod it still was functionally correct, it just went down a “bad path” performance-wise"><a href="#t1526911886000334" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-21</span> <span class="t" onclick="H(this)">14:11:26</span>                 mikerod </span><span>it still was functionally correct, it just went down a “bad path” performance-wise</span></div><div id="t1526911913000683" t="2018-05-21 14:11:53 mikerod fixing the determinism allowed the case to be pinpointed and recreated in a consistent way, the bottleneck was then fixed"><a href="#t1526911913000683" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-21</span> <span class="t" onclick="H(this)">14:11:53</span>                 mikerod </span><span>fixing the determinism allowed the case to be pinpointed and recreated in a consistent way, the bottleneck was then fixed</span></div><div id="t1526911965000397" t="2018-05-21 14:12:45 mikerod There are many places within the engine evaluation where the “order things are done” can make measurable performance differences. Even if the outcome is always the same no matter the order."><a href="#t1526911965000397" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-21</span> <span class="t" onclick="H(this)">14:12:45</span>                 mikerod </span><span>There are many places within the engine evaluation where the “order things are done” can make measurable performance differences. Even if the outcome is always the same no matter the order.</span></div><div id="t1526911995000142" t="2018-05-21 14:13:15 mikerod It is hard to explain most of these, since they are detailed things about the engine/network/fact propagation"><a href="#t1526911995000142" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-21</span> <span class="t" onclick="H(this)">14:13:15</span>                 mikerod </span><span>It is hard to explain most of these, since they are detailed things about the engine/network/fact propagation</span></div><div id="t1526912058000797" t="2018-05-21 14:14:18 mikerod Also, truth maintenance can evaluate a rule, evaluated its RHS actions, like  insert! , but then later, realize that that rule isn’t satisfied anymore due to some other rule that evaluated. The engine can “retract” the work done by the rule in that case."><a href="#t1526912058000797" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-21</span> <span class="t" onclick="H(this)">14:14:18</span>                 mikerod </span><span>Also, truth maintenance can evaluate a rule, evaluated its RHS actions, like </span><code>insert!</code><span>, but then later, realize that that rule isn’t satisfied anymore due to some other rule that evaluated. The engine can “retract” the work done by the rule in that case.</span></div><div id="t1526912077000074" t="2018-05-21 14:14:37 mikerod There are cases (many) where it’d be better to never have evaluated that rule at all, it wasted time"><a href="#t1526912077000074" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-21</span> <span class="t" onclick="H(this)">14:14:37</span>                 mikerod </span><span>There are cases (many) where it’d be better to never have evaluated that rule at all, it wasted time</span></div><div id="t1526912129000558" t="2018-05-21 14:15:29 mikerod The situation is really that the engine can at times “speculatively” evaluate a rule that is later found to be invalidated by other rules. There are ways for user-level directed rule orderings, and also there are engine-level “heuristics” or similar that attempt to avoid premature evaluation"><a href="#t1526912129000558" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-21</span> <span class="t" onclick="H(this)">14:15:29</span>                 mikerod </span><span>The situation is really that the engine can at times “speculatively” evaluate a rule that is later found to be invalidated by other rules. There are ways for user-level directed rule orderings, and also there are engine-level “heuristics” or similar that attempt to avoid premature evaluation</span></div><div id="t1526912146000049" t="2018-05-21 14:15:46 mikerod So a rule could have a RHS that says  (throw (Exception.))"><a href="#t1526912146000049" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-21</span> <span class="t" onclick="H(this)">14:15:46</span>                 mikerod </span><span>So a rule could have a RHS that says </span><code>(throw (Exception.))</code></div><div id="t1526912166000316" t="2018-05-21 14:16:06 mikerod This rule may  never be true after  fire-rules , however, during the truth maintenance cycle, it could actually be evaluated"><a href="#t1526912166000316" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-21</span> <span class="t" onclick="H(this)">14:16:06</span>                 mikerod </span><span>This rule may  never be true after </span><code>fire-rules</code><span>, however, during the truth maintenance cycle, it could actually be evaluated</span></div><div id="t1526912182000337" t="2018-05-21 14:16:22 mikerod So if you have non-determinism in that cycle, you may only sometimes hit the exception side-effect"><a href="#t1526912182000337" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-21</span> <span class="t" onclick="H(this)">14:16:22</span>                 mikerod </span><span>So if you have non-determinism in that cycle, you may only sometimes hit the exception side-effect</span></div><div id="t1526912220000599" t="2018-05-21 14:17:00 mikerod It doesn’t (and likely wouldn’t) be something trivial like that. It could be something less obvious like  (insert! (call-my-fn-that-has-a-defect-for-some-args ?x))"><a href="#t1526912220000599" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-21</span> <span class="t" onclick="H(this)">14:17:00</span>                 mikerod </span><span>It doesn’t (and likely wouldn’t) be something trivial like that. It could be something less obvious like </span><code>(insert! (call-my-fn-that-has-a-defect-for-some-args ?x))</code></div><div id="t1526912256000785" t="2018-05-21 14:17:36 mikerod If that rule sometimes evaluated, but needs to retract later by the truth maintenance, and this only happens 1 in 10 times, you may have a 1 in 10 times sort of scenario you are trying to recreate to debug your defect in your rules"><a href="#t1526912256000785" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-21</span> <span class="t" onclick="H(this)">14:17:36</span>                 mikerod </span><span>If that rule sometimes evaluated, but needs to retract later by the truth maintenance, and this only happens 1 in 10 times, you may have a 1 in 10 times sort of scenario you are trying to recreate to debug your defect in your rules</span></div><div id="t1526912310000244" t="2018-05-21 14:18:30 mikerod This will manifest itself in cases like, our tests fail arbitrarily at times when run on our build servers, but when we rerun the build/retest the error is gone"><a href="#t1526912310000244" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-21</span> <span class="t" onclick="H(this)">14:18:30</span>                 mikerod </span><span>This will manifest itself in cases like, our tests fail arbitrarily at times when run on our build servers, but when we rerun the build/retest the error is gone</span></div><div id="t1526912347000628" t="2018-05-21 14:19:07 mikerod The determinism of ordering used within these areas of Clara help both of these scenarios, the performance situations, and the finding failures scenarios situation"><a href="#t1526912347000628" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-21</span> <span class="t" onclick="H(this)">14:19:07</span>                 mikerod </span><span>The determinism of ordering used within these areas of Clara help both of these scenarios, the performance situations, and the finding failures scenarios situation</span></div><div id="t1526918786000617" t="2018-05-21 16:06:26 thegeez @mikerod Thanks for the explanation"><a href="#t1526918786000617" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-21</span> <span class="t" onclick="H(this)">16:06:26</span>                 thegeez </span><span>@mikerod Thanks for the explanation</span></div><div id="t1526919122000759" t="2018-05-21 16:12:02 alex-dixon @mikerod ditto that was great"><a href="#t1526919122000759" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-21</span> <span class="t" onclick="H(this)">16:12:02</span>              alex-dixon </span><span>@mikerod ditto that was great</span></div><div id="t1526919151000335" t="2018-05-21 16:12:31 zylox we should probably codify that mentality somwhere because we do think of it as first class here when considering changes"><a href="#t1526919151000335" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-21</span> <span class="t" onclick="H(this)">16:12:31</span>                   zylox </span><span>we should probably codify that mentality somwhere because we do think of it as first class here when considering changes</span></div><div id="t1526919160000226" t="2018-05-21 16:12:40 zylox (here being cerner)"><a href="#t1526919160000226" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-21</span> <span class="t" onclick="H(this)">16:12:40</span>                   zylox </span><span>(here being cerner)</span></div><div id="t1526919202000718" t="2018-05-21 16:13:22 zylox not sure where though. When writing rules it shouldnt be a consideration or a concern to the user"><a href="#t1526919202000718" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-21</span> <span class="t" onclick="H(this)">16:13:22</span>                   zylox </span><span>not sure where though. When writing rules it shouldnt be a consideration or a concern to the user</span></div><div id="t1526932843000409" t="2018-05-21 20:00:43 curtis.shaffer engine behavior? or guiding principles perhaps?"><a href="#t1526932843000409" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-21</span> <span class="t" onclick="H(this)">20:00:43</span>          curtis.shaffer </span><span>engine behavior? or guiding principles perhaps?</span></div><div id="t1526933012000615" t="2018-05-21 20:03:32 wparker I think  https://github.com/cerner/clara-rules/blob/master/CONTRIBUTING.md  is intended for that purpose in the GitHub templates, perhaps something there?"><a href="#t1526933012000615" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-21</span> <span class="t" onclick="H(this)">20:03:32</span>                 wparker </span><span>I think </span><a href="https://github.com/cerner/clara-rules/blob/master/CONTRIBUTING.md" target="_blank">https://github.com/cerner/clara-rules/blob/master/CONTRIBUTING.md</a><span> is intended for that purpose in the GitHub templates, perhaps something there?</span></div><div id="t1526934146000189" t="2018-05-21 20:22:26 zylox that makes a degree of sense to me"><a href="#t1526934146000189" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-21</span> <span class="t" onclick="H(this)">20:22:26</span>                   zylox </span><span>that makes a degree of sense to me</span></div><div id="t1527090692000916" t="2018-05-23 15:51:32 jdt Hello all, I&apos;ve been trying a bit of clara-rules to assess it for a project.  I&apos;m having some trouble with  with-tracing  though."><a href="#t1527090692000916" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-23</span> <span class="t" onclick="H(this)">15:51:32</span>                     jdt </span><span>Hello all, I&apos;ve been trying a bit of clara-rules to assess it for a project.  I&apos;m having some trouble with </span><code>with-tracing</code><span> though.</span></div><div id="t1527090774000342" t="2018-05-23 15:52:54 jdt If I omit the  with-tracing  call  fire-rules  does its work.  If I add  with-tracing  before it,  fire-rules  no longer works (none of my rules are fired)."><a href="#t1527090774000342" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-23</span> <span class="t" onclick="H(this)">15:52:54</span>                     jdt </span><span>If I omit the </span><code>with-tracing</code><span> call </span><code>fire-rules</code><span> does its work.  If I add </span><code>with-tracing</code><span> before it, </span><code>fire-rules</code><span> no longer works (none of my rules are fired).</span></div><div id="t1527090798000763" t="2018-05-23 15:53:18 jdt If I move  with-tracing  before  (insert ...)  I get lots of traces."><a href="#t1527090798000763" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-23</span> <span class="t" onclick="H(this)">15:53:18</span>                     jdt </span><span>If I move </span><code>with-tracing</code><span> before </span><code>(insert ...)</code><span> I get lots of traces.</span></div><div id="t1527090822000277" t="2018-05-23 15:53:42 jdt What am I doing wrong?"><a href="#t1527090822000277" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-23</span> <span class="t" onclick="H(this)">15:53:42</span>                     jdt </span><span>What am I doing wrong?</span></div><div id="t1527090844000677" t="2018-05-23 15:54:04 jdt I&apos;m using  [com.cerner/clara-rules &quot;0.18.0&quot;]"><a href="#t1527090844000677" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-23</span> <span class="t" onclick="H(this)">15:54:04</span>                     jdt </span><span>I&apos;m using </span><code>[com.cerner/clara-rules &quot;0.18.0&quot;]</code></div><div id="t1527090854000915" t="2018-05-23 15:54:14 jdt and clojure 1.9"><a href="#t1527090854000915" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-23</span> <span class="t" onclick="H(this)">15:54:14</span>                     jdt </span><span>and clojure 1.9</span></div><div id="t1527090911000365" t="2018-05-23 15:55:11 jdt I don&apos;t want to trace the rete activity on the initial insert, just the activities of fire-rules and the working memory alterations there."><a href="#t1527090911000365" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-23</span> <span class="t" onclick="H(this)">15:55:11</span>                     jdt </span><span>I don&apos;t want to trace the rete activity on the initial insert, just the activities of fire-rules and the working memory alterations there.</span></div><div id="t1527095519000771" t="2018-05-23 17:11:59 mikerod @dave.tenny it’s an interesting point you bring up, but I don’t think it really makes sense to only “partially” have  with-tracing  enabled"><a href="#t1527095519000771" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-23</span> <span class="t" onclick="H(this)">17:11:59</span>                 mikerod </span><span>@dave.tenny it’s an interesting point you bring up, but I don’t think it really makes sense to only “partially” have </span><code>with-tracing</code><span> enabled</span></div><div id="t1527095542000737" t="2018-05-23 17:12:22 mikerod All session interactions prior to  fire-rules  are susceptible to lazy evaluation and batching."><a href="#t1527095542000737" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-23</span> <span class="t" onclick="H(this)">17:12:22</span>                 mikerod </span><span>All session interactions prior to </span><code>fire-rules</code><span> are susceptible to lazy evaluation and batching.</span></div><div id="t1527095572000488" t="2018-05-23 17:12:52 mikerod In general, I’d stress to not rely on any stateful information of a session that has had inserts/retracts performed on it, but no  fire-rules"><a href="#t1527095572000488" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-23</span> <span class="t" onclick="H(this)">17:12:52</span>                 mikerod </span><span>In general, I’d stress to not rely on any stateful information of a session that has had inserts/retracts performed on it, but no </span><code>fire-rules</code></div><div id="t1527095599000521" t="2018-05-23 17:13:19 jdt Heh, not sure I was trying to make a point.  I didn&apos;t understand why  fire-rules  didn&apos;t work based on the placement of  with-tracing .  Since my rules weren&apos;t firing."><a href="#t1527095599000521" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-23</span> <span class="t" onclick="H(this)">17:13:19</span>                     jdt </span><span>Heh, not sure I was trying to make a point.  I didn&apos;t understand why </span><code>fire-rules</code><span> didn&apos;t work based on the placement of </span><code>with-tracing</code><span>.  Since my rules weren&apos;t firing.</span></div><div id="t1527095602000091" t="2018-05-23 17:13:22 mikerod I’d actually rather it be the case that the API threw an exception if you tried to  query  or do something like  with-tracing  when it was in an inconsistent/lazy/batched state prior to  fire-rules"><a href="#t1527095602000091" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-23</span> <span class="t" onclick="H(this)">17:13:22</span>                 mikerod </span><span>I’d actually rather it be the case that the API threw an exception if you tried to </span><code>query</code><span> or do something like </span><code>with-tracing</code><span> when it was in an inconsistent/lazy/batched state prior to </span><code>fire-rules</code></div><div id="t1527095635000781" t="2018-05-23 17:13:55 jdt Naively (since I am naive here), I just figured my session would be upgraded to do tracing."><a href="#t1527095635000781" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-23</span> <span class="t" onclick="H(this)">17:13:55</span>                     jdt </span><span>Naively (since I am naive here), I just figured my session would be upgraded to do tracing.</span></div><div id="t1527095638000259" t="2018-05-23 17:13:58 mikerod It’s an interesting point regarding the limitations of  with-tracing  and lazy/batched insert/retract behavior I meant"><a href="#t1527095638000259" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-23</span> <span class="t" onclick="H(this)">17:13:58</span>                 mikerod </span><span>It’s an interesting point regarding the limitations of </span><code>with-tracing</code><span> and lazy/batched insert/retract behavior I meant</span></div><div id="t1527095671000655" t="2018-05-23 17:14:31 mikerod I certainly haven’t dug into details to diagnose your specific issue, but I’d imaging the  with-tracing  added late, after the  insert  missed some listener information it needed"><a href="#t1527095671000655" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-23</span> <span class="t" onclick="H(this)">17:14:31</span>                 mikerod </span><span>I certainly haven’t dug into details to diagnose your specific issue, but I’d imaging the </span><code>with-tracing</code><span> added late, after the </span><code>insert</code><span> missed some listener information it needed</span></div><div id="t1527095673000119" t="2018-05-23 17:14:33 jdt So how should I be using  with-tracing  here?"><a href="#t1527095673000119" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-23</span> <span class="t" onclick="H(this)">17:14:33</span>                     jdt </span><span>So how should I be using </span><code>with-tracing</code><span> here?</span></div><div id="t1527095698000163" t="2018-05-23 17:14:58 mikerod Only add it when you have a session that doesn’t have  insert ,  insert-all , or  retract  calls possibly still pending on it"><a href="#t1527095698000163" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-23</span> <span class="t" onclick="H(this)">17:14:58</span>                 mikerod </span><span>Only add it when you have a session that doesn’t have </span><code>insert</code><span>, </span><code>insert-all</code><span>, or </span><code>retract</code><span> calls possibly still pending on it</span></div><div id="t1527095710000454" t="2018-05-23 17:15:10 mikerod so either (a) right after your  mk-session , or (b) right after a  fire-rules"><a href="#t1527095710000454" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-23</span> <span class="t" onclick="H(this)">17:15:10</span>                 mikerod </span><span>so either (a) right after your </span><code>mk-session</code><span>, or (b) right after a </span><code>fire-rules</code></div><div id="t1527095750000642" t="2018-05-23 17:15:50 jdt I&apos;m doing  insert!  and  retract!  in my rule RHS&apos;s, but but the only  insert  was as shown, before the  with-tracing  call."><a href="#t1527095750000642" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-23</span> <span class="t" onclick="H(this)">17:15:50</span>                     jdt </span><span>I&apos;m doing </span><code>insert!</code><span> and </span><code>retract!</code><span> in my rule RHS&apos;s, but but the only </span><code>insert</code><span> was as shown, before the </span><code>with-tracing</code><span> call.</span></div><div id="t1527095753000482" t="2018-05-23 17:15:53 mikerod but you won’t get tracing “only for the  fire-rules  actions that took place, you’ll get a complete picture, you can looking into tracing details to find out specific things, like facts inserted due to rules firing etc (at least to some degree)"><a href="#t1527095753000482" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-23</span> <span class="t" onclick="H(this)">17:15:53</span>                 mikerod </span><span>but you won’t get tracing “only for the </span><code>fire-rules</code><span> actions that took place, you’ll get a complete picture, you can looking into tracing details to find out specific things, like facts inserted due to rules firing etc (at least to some degree)</span></div><div id="t1527095929000282" t="2018-05-23 17:18:49 mikerod @dave.tenny you did this?
 (-&gt; (mk-session)
	(with-tracing)
	(insert ...)
	(fire-rules))

"><a href="#t1527095929000282" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-23</span> <span class="t" onclick="H(this)">17:18:49</span>                 mikerod </span><span>@dave.tenny you did this?
</span><pre>(-&gt; (mk-session)
	(with-tracing)
	(insert ...)
	(fire-rules))

</pre></div><div id="t1527095966000154" t="2018-05-23 17:19:26 jdt Yes, that way I get tracing, and fire-rules works as expected."><a href="#t1527095966000154" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-23</span> <span class="t" onclick="H(this)">17:19:26</span>                     jdt </span><span>Yes, that way I get tracing, and fire-rules works as expected.</span></div><div id="t1527095992000224" t="2018-05-23 17:19:52 mikerod that’s the way to use it"><a href="#t1527095992000224" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-23</span> <span class="t" onclick="H(this)">17:19:52</span>                 mikerod </span><span>that’s the way to use it</span></div><div id="t1527096005000293" t="2018-05-23 17:20:05 jdt ok, thanks"><a href="#t1527096005000293" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-23</span> <span class="t" onclick="H(this)">17:20:05</span>                     jdt </span><span>ok, thanks</span></div><div id="t1527096020000016" t="2018-05-23 17:20:20 mikerod So I don’t know what your question is beyond that and beyond what I said about it being misleading in the API to let you add it at arbitrary points"><a href="#t1527096020000016" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-23</span> <span class="t" onclick="H(this)">17:20:20</span>                 mikerod </span><span>So I don’t know what your question is beyond that and beyond what I said about it being misleading in the API to let you add it at arbitrary points</span></div><div id="t1527096037000234" t="2018-05-23 17:20:37 jdt I&apos;m trying to get the network activity after the initial bulk load of facts."><a href="#t1527096037000234" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-23</span> <span class="t" onclick="H(this)">17:20:37</span>                     jdt </span><span>I&apos;m trying to get the network activity after the initial bulk load of facts.</span></div><div id="t1527096042000002" t="2018-05-23 17:20:42 mikerod I think it’d be better to reject an attempt to add it at the “wrong times”, enhancement"><a href="#t1527096042000002" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-23</span> <span class="t" onclick="H(this)">17:20:42</span>                 mikerod </span><span>I think it’d be better to reject an attempt to add it at the “wrong times”, enhancement</span></div><div id="t1527096055000067" t="2018-05-23 17:20:55 jdt And when I do that, by moving the trace after the facts are loaded, my  fire-rules  don&apos;t work."><a href="#t1527096055000067" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-23</span> <span class="t" onclick="H(this)">17:20:55</span>                     jdt </span><span>And when I do that, by moving the trace after the facts are loaded, my </span><code>fire-rules</code><span> don&apos;t work.</span></div><div id="t1527096064000155" t="2018-05-23 17:21:04 mikerod yeah, it doesn’t work on that principle"><a href="#t1527096064000155" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-23</span> <span class="t" onclick="H(this)">17:21:04</span>                 mikerod </span><span>yeah, it doesn’t work on that principle</span></div><div id="t1527096073000238" t="2018-05-23 17:21:13 jdt ok, good to know, still learning"><a href="#t1527096073000238" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-23</span> <span class="t" onclick="H(this)">17:21:13</span>                     jdt </span><span>ok, good to know, still learning</span></div><div id="t1527096163000224" t="2018-05-23 17:22:43 jdt That begs the question of when it is safe to use it.  Say I make a session, load data, run rules, query results.  Then I want to change the data in the session and run it again with tracing.  Will it work then?  Or is it always safe to use  with-tracing  after  fire-rules  calls?"><a href="#t1527096163000224" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-23</span> <span class="t" onclick="H(this)">17:22:43</span>                     jdt </span><span>That begs the question of when it is safe to use it.  Say I make a session, load data, run rules, query results.  Then I want to change the data in the session and run it again with tracing.  Will it work then?  Or is it always safe to use </span><code>with-tracing</code><span> after </span><code>fire-rules</code><span> calls?</span></div><div id="t1527096174000044" t="2018-05-23 17:22:54 mikerod I’m not actually sure there is a way to look at the listener information and know the different between a fact inserted externally, via  insert  and a fact inserted from a RHS, via  insert! . I don’t know of one off hand."><a href="#t1527096174000044" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-23</span> <span class="t" onclick="H(this)">17:22:54</span>                 mikerod </span><span>I’m not actually sure there is a way to look at the listener information and know the different between a fact inserted externally, via </span><code>insert</code><span> and a fact inserted from a RHS, via </span><code>insert!</code><span>. I don’t know of one off hand.</span></div><div id="t1527096232000202" t="2018-05-23 17:23:52 mikerod &gt;  Or is it always safe to use  with-tracing  after  fire-rules  calls?
I think so and expect so. If it has issues, it’d be interesting to discuss them.

Also, I don’t have any reason to think that it should ever change the semantics of the rules, you may just get bad/invalid tracing results"><a href="#t1527096232000202" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-23</span> <span class="t" onclick="H(this)">17:23:52</span>                 mikerod </span><span>&gt;  Or is it always safe to use </span><code>with-tracing</code><span> after </span><code>fire-rules</code><span> calls?
I think so and expect so. If it has issues, it’d be interesting to discuss them.

Also, I don’t have any reason to think that it should ever change the semantics of the rules, you may just get bad/invalid tracing results</span></div><div id="t1527096247000159" t="2018-05-23 17:24:07 mikerod Earlier you said it caused your rules to not fire correctly, I’m skeptical on that"><a href="#t1527096247000159" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-23</span> <span class="t" onclick="H(this)">17:24:07</span>                 mikerod </span><span>Earlier you said it caused your rules to not fire correctly, I’m skeptical on that</span></div><div id="t1527096258000116" t="2018-05-23 17:24:18 mikerod the tracing may not have accurately reported the rule firings, but they probably still fired"><a href="#t1527096258000116" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-23</span> <span class="t" onclick="H(this)">17:24:18</span>                 mikerod </span><span>the tracing may not have accurately reported the rule firings, but they probably still fired</span></div><div id="t1527096276000038" t="2018-05-23 17:24:36 mikerod you can test that assumption, by adding a  defquery  to your session"><a href="#t1527096276000038" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-23</span> <span class="t" onclick="H(this)">17:24:36</span>                 mikerod </span><span>you can test that assumption, by adding a </span><code>defquery</code><span> to your session</span></div><div id="t1527096285000155" t="2018-05-23 17:24:45 jdt re: firing, my rules had  println in them, which didn&apos;t print when the  with-tracing  was done after the  insert ."><a href="#t1527096285000155" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-23</span> <span class="t" onclick="H(this)">17:24:45</span>                     jdt </span><span>re: firing, my rules had </span><code>println</code><span>in them, which didn&apos;t print when the </span><code>with-tracing</code><span> was done after the </span><code>insert</code><span>.</span></div><div id="t1527096288000388" t="2018-05-23 17:24:48 mikerod and then using a  query  on the RHS  insert!  facts that you think didn’t get inserted"><a href="#t1527096288000388" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-23</span> <span class="t" onclick="H(this)">17:24:48</span>                 mikerod </span><span>and then using a </span><code>query</code><span> on the RHS </span><code>insert!</code><span> facts that you think didn’t get inserted</span></div><div id="t1527096304000122" t="2018-05-23 17:25:04 mikerod Yeah, if you can reproduce that case at all, that’d be valuable"><a href="#t1527096304000122" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-23</span> <span class="t" onclick="H(this)">17:25:04</span>                 mikerod </span><span>Yeah, if you can reproduce that case at all, that’d be valuable</span></div><div id="t1527096315000317" t="2018-05-23 17:25:15 jdt Okay, well it&apos;s pretty simple, I&apos;ll see what I can do."><a href="#t1527096315000317" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-23</span> <span class="t" onclick="H(this)">17:25:15</span>                     jdt </span><span>Okay, well it&apos;s pretty simple, I&apos;ll see what I can do.</span></div><div id="t1527096323001047" t="2018-05-23 17:25:23 mikerod I don’t expect  with-tracing  to be able to interfere with evaluation in that way"><a href="#t1527096323001047" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-23</span> <span class="t" onclick="H(this)">17:25:23</span>                 mikerod </span><span>I don’t expect </span><code>with-tracing</code><span> to be able to interfere with evaluation in that way</span></div><div id="t1527096399000930" t="2018-05-23 17:26:39 mikerod @dave.tenny found it"><a href="#t1527096399000930" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-23</span> <span class="t" onclick="H(this)">17:26:39</span>                 mikerod </span><span>@dave.tenny found it</span></div><div id="t1527096411001045" t="2018-05-23 17:26:51 mikerod yeah, so  with-tracing  does appear to wipe out pending work"><a href="#t1527096411001045" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-23</span> <span class="t" onclick="H(this)">17:26:51</span>                 mikerod </span><span>yeah, so </span><code>with-tracing</code><span> does appear to wipe out pending work</span></div><div id="t1527096424000015" t="2018-05-23 17:27:04 mikerod so you’re right, it’d cause trouble like you saw"><a href="#t1527096424000015" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-23</span> <span class="t" onclick="H(this)">17:27:04</span>                 mikerod </span><span>so you’re right, it’d cause trouble like you saw</span></div><div id="t1527096434000455" t="2018-05-23 17:27:14 mikerod after  fire-rules  should be safe - there is no pending work"><a href="#t1527096434000455" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-23</span> <span class="t" onclick="H(this)">17:27:14</span>                 mikerod </span><span>after </span><code>fire-rules</code><span> should be safe - there is no pending work</span></div><div id="t1527096520000318" t="2018-05-23 17:28:40 mikerod it may be a “good thing” that  with-tracing  wipes out pending work since it makes a session that it can actually trace"><a href="#t1527096520000318" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-23</span> <span class="t" onclick="H(this)">17:28:40</span>                 mikerod </span><span>it may be a “good thing” that </span><code>with-tracing</code><span> wipes out pending work since it makes a session that it can actually trace</span></div><div id="t1527096545000878" t="2018-05-23 17:29:05 mikerod well, idk about that, it’s just a weird situation hah - either needs docs or to throw an exception or something I think  🙂"><a href="#t1527096545000878" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-23</span> <span class="t" onclick="H(this)">17:29:05</span>                 mikerod </span><span>well, idk about that, it’s just a weird situation hah - either needs docs or to throw an exception or something I think </span><b>🙂</b></div><div id="t1527096554000543" t="2018-05-23 17:29:14 jdt Sounds like the documentation should be a bit clearer about restrictions though to avoid noob run-ins like mine."><a href="#t1527096554000543" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-23</span> <span class="t" onclick="H(this)">17:29:14</span>                     jdt </span><span>Sounds like the documentation should be a bit clearer about restrictions though to avoid noob run-ins like mine.</span></div><div id="t1527096561000111" t="2018-05-23 17:29:21 mikerod Yes, it is too mysterious"><a href="#t1527096561000111" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-23</span> <span class="t" onclick="H(this)">17:29:21</span>                 mikerod </span><span>Yes, it is too mysterious</span></div><div id="t1527096810000579" t="2018-05-23 17:33:30 jdt I&apos;m just trying to wrap my head around other things, like the Truth Maintenance capabilities that may or may not have been present in the OPS5 systems I was using 30 years ago.  I&apos;m pretty rusty at this.  Retracting the preconditions that led to the state of the RHS doing the retraction seems to mean I need to fire rules, query my reults on the session afterward, make changes, then rinse-lather-repeat, where it used to be I&apos;d do more stuff in the RHS clauses.   Thus my attempts at  ... modular ... tracing."><a href="#t1527096810000579" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-23</span> <span class="t" onclick="H(this)">17:33:30</span>                     jdt </span><span>I&apos;m just trying to wrap my head around other things, like the Truth Maintenance capabilities that may or may not have been present in the OPS5 systems I was using 30 years ago.  I&apos;m pretty rusty at this.  Retracting the preconditions that led to the state of the RHS doing the retraction seems to mean I need to fire rules, query my reults on the session afterward, make changes, then rinse-lather-repeat, where it used to be I&apos;d do more stuff in the RHS clauses.   Thus my attempts at  ... modular ... tracing.</span></div><div id="t1527096942000627" t="2018-05-23 17:35:42 jdt So a bit of catching up for me.  I&apos;m investigating clara for the job dispatch logic of a new scheduler I&apos;m writing."><a href="#t1527096942000627" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-23</span> <span class="t" onclick="H(this)">17:35:42</span>                     jdt </span><span>So a bit of catching up for me.  I&apos;m investigating clara for the job dispatch logic of a new scheduler I&apos;m writing.</span></div><div id="t1527096959000421" t="2018-05-23 17:35:59 jdt Meanwhile thanks for the help."><a href="#t1527096959000421" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-23</span> <span class="t" onclick="H(this)">17:35:59</span>                     jdt </span><span>Meanwhile thanks for the help.</span></div><div id="t1527097056000220" t="2018-05-23 17:37:36 mikerod sure"><a href="#t1527097056000220" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-23</span> <span class="t" onclick="H(this)">17:37:36</span>                 mikerod </span><span>sure</span></div><div id="t1527097092000233" t="2018-05-23 17:38:12 mikerod @alex-dixon has done a lot with Clara’s tracing by extending it for his own purposes in the #precept library. Perhaps you can find some inspiration there."><a href="#t1527097092000233" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-23</span> <span class="t" onclick="H(this)">17:38:12</span>                 mikerod </span><span>@alex-dixon has done a lot with Clara’s tracing by extending it for his own purposes in the #precept library. Perhaps you can find some inspiration there.</span></div><div id="t1527097112000053" t="2018-05-23 17:38:32 mikerod https://github.com/CoNarrative/precept"><a href="#t1527097112000053" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-23</span> <span class="t" onclick="H(this)">17:38:32</span>                 mikerod </span><a href="https://github.com/CoNarrative/precept" target="_blank">https://github.com/CoNarrative/precept</a></div><div id="t1527097434000001" t="2018-05-23 17:43:54 alex-dixon I think I ended up using the listeners namespace only. I forget at the moment how it relates to clara’s tracing"><a href="#t1527097434000001" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-23</span> <span class="t" onclick="H(this)">17:43:54</span>              alex-dixon </span><span>I think I ended up using the listeners namespace only. I forget at the moment how it relates to clara’s tracing</span></div><div id="t1527097462000204" t="2018-05-23 17:44:22 mikerod @alex-dixon oh, tracing just organizes the data coming from listeners I believe"><a href="#t1527097462000204" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-23</span> <span class="t" onclick="H(this)">17:44:22</span>                 mikerod </span><span>@alex-dixon oh, tracing just organizes the data coming from listeners I believe</span></div><div id="t1527097508000818" t="2018-05-23 17:45:08 mikerod wait no, tracing is a default impl over listeners"><a href="#t1527097508000818" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-23</span> <span class="t" onclick="H(this)">17:45:08</span>                 mikerod </span><span>wait no, tracing is a default impl over listeners</span></div><div id="t1527097514000506" t="2018-05-23 17:45:14 alex-dixon Ah ok. That what I seem to remember but thought I may have been confusing it with explanations "><a href="#t1527097514000506" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-23</span> <span class="t" onclick="H(this)">17:45:14</span>              alex-dixon </span><span>Ah ok. That what I seem to remember but thought I may have been confusing it with explanations </span></div><div id="t1527097519000496" t="2018-05-23 17:45:19 mikerod (sort of the same as I said)"><a href="#t1527097519000496" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-23</span> <span class="t" onclick="H(this)">17:45:19</span>                 mikerod </span><span>(sort of the same as I said)</span></div><div id="t1527097529000667" t="2018-05-23 17:45:29 mikerod yeah, explanations/inspect are above all that"><a href="#t1527097529000667" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-23</span> <span class="t" onclick="H(this)">17:45:29</span>                 mikerod </span><span>yeah, explanations/inspect are above all that</span></div><div id="t1527097592000662" t="2018-05-23 17:46:32 alex-dixon Yet listeners is very user friendly imho. Though I may have ran into some private things I wanted public "><a href="#t1527097592000662" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-23</span> <span class="t" onclick="H(this)">17:46:32</span>              alex-dixon </span><span>Yet listeners is very user friendly imho. Though I may have ran into some private things I wanted public </span></div><div id="t1527097724000388" t="2018-05-23 17:48:44 alex-dixon It is nice to have it boxed up and ready to use just at the same time the listeners ns is highly usable in and of itself I mean"><a href="#t1527097724000388" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-23</span> <span class="t" onclick="H(this)">17:48:44</span>              alex-dixon </span><span>It is nice to have it boxed up and ready to use just at the same time the listeners ns is highly usable in and of itself I mean</span></div><div id="t1527098932000650" t="2018-05-23 18:08:52 alex-dixon @dave.tenny If you end up poking around Precept at all I’d recommend the issue 19 branch"><a href="#t1527098932000650" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-23</span> <span class="t" onclick="H(this)">18:08:52</span>              alex-dixon </span><span>@dave.tenny If you end up poking around Precept at all I’d recommend the issue 19 branch</span></div><div id="t1527098991000191" t="2018-05-23 18:09:51 jdt Will keep that in mind, so far have only looked at Clara-rules."><a href="#t1527098991000191" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-23</span> <span class="t" onclick="H(this)">18:09:51</span>                     jdt </span><span>Will keep that in mind, so far have only looked at Clara-rules.</span></div><div id="t1527103108000386" t="2018-05-23 19:18:28 jdt (defquery my-query ...)   followed by a what is typically another function wrapping the query with a call to  (query session my-query)  gets old.  Is there w away to do a lexical  defquery  equivalent at the point I&apos;d call  query ?"><a href="#t1527103108000386" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-23</span> <span class="t" onclick="H(this)">19:18:28</span>                     jdt </span><code>(defquery my-query ...) </code><span> followed by a what is typically another function wrapping the query with a call to </span><code>(query session my-query)</code><span> gets old.  Is there w away to do a lexical </span><code>defquery</code><span> equivalent at the point I&apos;d call </span><code>query</code><span>?</span></div><div id="t1527103497000411" t="2018-05-23 19:24:57 zylox defquery  more or less sets up an endpoint in your rules network, it needs to be known before hand"><a href="#t1527103497000411" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-23</span> <span class="t" onclick="H(this)">19:24:57</span>                   zylox </span><code>defquery</code><span> more or less sets up an endpoint in your rules network, it needs to be known before hand</span></div><div id="t1527103534000757" t="2018-05-23 19:25:34 zylox query  goes and grabs the list it generates at when things are fired, it doesnt go calculate it then (to my knowlege)"><a href="#t1527103534000757" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-23</span> <span class="t" onclick="H(this)">19:25:34</span>                   zylox </span><code>query</code><span> goes and grabs the list it generates at when things are fired, it doesnt go calculate it then (to my knowlege)</span></div><div id="t1527104241000353" t="2018-05-23 19:37:21 zylox you can, and i would not reccomend this outside of development, create a  defquery  for  Object  that just grabs everything in the session and then filter that as you see fit."><a href="#t1527104241000353" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-23</span> <span class="t" onclick="H(this)">19:37:21</span>                   zylox </span><span>you can, and i would not reccomend this outside of development, create a </span><code>defquery</code><span> for </span><code>Object</code><span> that just grabs everything in the session and then filter that as you see fit.</span></div><div id="t1527107735000526" t="2018-05-23 20:35:35 mikerod @dave.tenny I’ve only partially read your example so far, but one immediate piece of feedback, don’t  query  until after  fire-rules"><a href="#t1527107735000526" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-23</span> <span class="t" onclick="H(this)">20:35:35</span>                 mikerod </span><span>@dave.tenny I’ve only partially read your example so far, but one immediate piece of feedback, don’t </span><code>query</code><span> until after </span><code>fire-rules</code></div><div id="t1527107753000106" t="2018-05-23 20:35:53 mikerod think of  query  the same as  with-tracing  earlier, you have to only do it on “consistent” states of a session"><a href="#t1527107753000106" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-23</span> <span class="t" onclick="H(this)">20:35:53</span>                 mikerod </span><span>think of </span><code>query</code><span> the same as </span><code>with-tracing</code><span> earlier, you have to only do it on “consistent” states of a session</span></div><div id="t1527107790000610" t="2018-05-23 20:36:30 mikerod Clara does some delayed evaluation for performance reasons. Any inserts/retracts that occur prior to a  fire-rule  cannot be relied upon and I’d consider the session to be in an “undefined” state"><a href="#t1527107790000610" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-23</span> <span class="t" onclick="H(this)">20:36:30</span>                 mikerod </span><span>Clara does some delayed evaluation for performance reasons. Any inserts/retracts that occur prior to a </span><code>fire-rule</code><span> cannot be relied upon and I’d consider the session to be in an “undefined” state</span></div><div id="t1527107861000276" t="2018-05-23 20:37:41 mikerod I’d actually prefer Clara to change for  query  to either (a) throw exception if called prior to a  fire-rules  or return something that indicates it is not ready yet."><a href="#t1527107861000276" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-23</span> <span class="t" onclick="H(this)">20:37:41</span>                 mikerod </span><span>I’d actually prefer Clara to change for </span><code>query</code><span> to either (a) throw exception if called prior to a </span><code>fire-rules</code><span> or return something that indicates it is not ready yet.</span></div><div id="t1527107930000808" t="2018-05-23 20:38:50 mikerod Clara takes advantaged of batched insertion and also potentially a few other things, so it does not eagerly perform things like  insert  or  retract . The evaluation is typically pushed to batch up the facts propagating through the network. This can play a major role in performance."><a href="#t1527107930000808" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-23</span> <span class="t" onclick="H(this)">20:38:50</span>                 mikerod </span><span>Clara takes advantaged of batched insertion and also potentially a few other things, so it does not eagerly perform things like </span><code>insert</code><span> or </span><code>retract</code><span>. The evaluation is typically pushed to batch up the facts propagating through the network. This can play a major role in performance.</span></div><div id="t1527107989000230" t="2018-05-23 20:39:49 mikerod You mentioned OPS5, which you likely wouldn’t have seen behavior like this long ago. It is more common now. Drools is a popular JVM-based rules engine and it similarly has delayed evaluation of things prior to rule firing due to similar concerns."><a href="#t1527107989000230" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-23</span> <span class="t" onclick="H(this)">20:39:49</span>                 mikerod </span><span>You mentioned OPS5, which you likely wouldn’t have seen behavior like this long ago. It is more common now. Drools is a popular JVM-based rules engine and it similarly has delayed evaluation of things prior to rule firing due to similar concerns.</span></div><div id="t1527108027000423" t="2018-05-23 20:40:27 mikerod This issue seems to somewhat often trip people up though. So I don’t think it is clear enough."><a href="#t1527108027000423" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-23</span> <span class="t" onclick="H(this)">20:40:27</span>                 mikerod </span><span>This issue seems to somewhat often trip people up though. So I don’t think it is clear enough.</span></div><div id="t1527108073000373" t="2018-05-23 20:41:13 mikerod For your second question
&gt;  ;why are my counters still there, I retracted them?

I think it is because  (query % counters)  doesn’t return what you are thinking it does"><a href="#t1527108073000373" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-23</span> <span class="t" onclick="H(this)">20:41:13</span>                 mikerod </span><span>For your second question
&gt;  ;why are my counters still there, I retracted them?

I think it is because </span><code>(query % counters)</code><span> doesn’t return what you are thinking it does</span></div><div id="t1527108112000041" t="2018-05-23 20:41:52 mikerod It doesn’t return the bare counter fact, instead it returns a bindings map from the query, so it returns something like:
 {:?counter &lt;the counter fact&gt;}

"><a href="#t1527108112000041" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-23</span> <span class="t" onclick="H(this)">20:41:52</span>                 mikerod </span><span>It doesn’t return the bare counter fact, instead it returns a bindings map from the query, so it returns something like:
</span><pre>{:?counter &lt;the counter fact&gt;}

</pre></div><div id="t1527108152000415" t="2018-05-23 20:42:32 mikerod so you’d probably have to do something like
 (#(apply retract % (map :?counter (query % counters))))

"><a href="#t1527108152000415" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-23</span> <span class="t" onclick="H(this)">20:42:32</span>                 mikerod </span><span>so you’d probably have to do something like
</span><pre>(#(apply retract % (map :?counter (query % counters))))

</pre></div><div id="t1527108156000178" t="2018-05-23 20:42:36 jdt Oh sorry, forgot to include the output"><a href="#t1527108156000178" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-23</span> <span class="t" onclick="H(this)">20:42:36</span>                     jdt </span><span>Oh sorry, forgot to include the output</span></div><div id="t1527108160000300" t="2018-05-23 20:42:40 jdt It works, just not as expected"><a href="#t1527108160000300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-23</span> <span class="t" onclick="H(this)">20:42:40</span>                     jdt </span><span>It works, just not as expected</span></div><div id="t1527108163000286" t="2018-05-23 20:42:43 jdt Here comes the output"><a href="#t1527108163000286" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-23</span> <span class="t" onclick="H(this)">20:42:43</span>                     jdt </span><span>Here comes the output</span></div><div id="t1527108238000182" t="2018-05-23 20:43:58 mikerod that output looks consistent with the explanation I just gave"><a href="#t1527108238000182" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-23</span> <span class="t" onclick="H(this)">20:43:58</span>                 mikerod </span><span>that output looks consistent with the explanation I just gave</span></div><div id="t1527108243000266" t="2018-05-23 20:44:03 mikerod so try to apply the things I mentioned"><a href="#t1527108243000266" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-23</span> <span class="t" onclick="H(this)">20:44:03</span>                 mikerod </span><span>so try to apply the things I mentioned</span></div><div id="t1527108317000628" t="2018-05-23 20:45:17 jdt Ah, that fixes it"><a href="#t1527108317000628" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-23</span> <span class="t" onclick="H(this)">20:45:17</span>                     jdt </span><span>Ah, that fixes it</span></div><div id="t1527108326000127" t="2018-05-23 20:45:26 jdt (map :?counter ...)"><a href="#t1527108326000127" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-23</span> <span class="t" onclick="H(this)">20:45:26</span>                     jdt </span><code>(map :?counter ...)</code></div><div id="t1527108351000626" t="2018-05-23 20:45:51 mikerod 🎉"><a href="#t1527108351000626" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-23</span> <span class="t" onclick="H(this)">20:45:51</span>                 mikerod </span><b>🎉</b></div><div id="t1527267457000425" t="2018-05-25 16:57:37 jdt I&apos;m guessing the second [Derived 1] is retracted after insertion, though that isn&apos;t what I want, in fact in my POC rule set I&apos;m doing an  insert-unconditional!  because the fact must survive, subsequent retraction, but I still only one exactly one instance to be inserted, i.e. one-time initialization."><a href="#t1527267457000425" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-25</span> <span class="t" onclick="H(this)">16:57:37</span>                     jdt </span><span>I&apos;m guessing the second [Derived 1] is retracted after insertion, though that isn&apos;t what I want, in fact in my POC rule set I&apos;m doing an </span><code>insert-unconditional!</code><span> because the fact must survive, subsequent retraction, but I still only one exactly one instance to be inserted, i.e. one-time initialization.</span></div><div id="t1527267846000144" t="2018-05-25 17:04:06 mikerod @dave.tenny you know you’re inserting a vector there right?"><a href="#t1527267846000144" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-25</span> <span class="t" onclick="H(this)">17:04:06</span>                 mikerod </span><span>@dave.tenny you know you’re inserting a vector there right?</span></div><div id="t1527267859000693" t="2018-05-25 17:04:19 mikerod Just noticed that this seems odd   (insert! [Derived ?x])"><a href="#t1527267859000693" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-25</span> <span class="t" onclick="H(this)">17:04:19</span>                 mikerod </span><span>Just noticed that this seems odd </span><code> (insert! [Derived ?x])</code></div><div id="t1527267877000122" t="2018-05-25 17:04:37 jdt Lol, I looked at it thinking &quot;something isn&apos;t right here&quot; too"><a href="#t1527267877000122" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-25</span> <span class="t" onclick="H(this)">17:04:37</span>                     jdt </span><span>Lol, I looked at it thinking &quot;something isn&apos;t right here&quot; too</span></div><div id="t1527267895000631" t="2018-05-25 17:04:55 jdt Just too Friday-minded to see it, thanks for looking"><a href="#t1527267895000631" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-25</span> <span class="t" onclick="H(this)">17:04:55</span>                     jdt </span><span>Just too Friday-minded to see it, thanks for looking</span></div><div id="t1527267898000612" t="2018-05-25 17:04:58 mikerod however, with  insert!  I think you may get in an infinite loop"><a href="#t1527267898000612" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-25</span> <span class="t" onclick="H(this)">17:04:58</span>                 mikerod </span><span>however, with </span><code>insert!</code><span> I think you may get in an infinite loop</span></div><div id="t1527267907000233" t="2018-05-25 17:05:07 mikerod because your rule becomes a logical contradiction"><a href="#t1527267907000233" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-25</span> <span class="t" onclick="H(this)">17:05:07</span>                 mikerod </span><span>because your rule becomes a logical contradiction</span></div><div id="t1527267936000605" t="2018-05-25 17:05:36 mikerod So I think there are just several different topics with this example,  😛"><a href="#t1527267936000605" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-25</span> <span class="t" onclick="H(this)">17:05:36</span>                 mikerod </span><span>So I think there are just several different topics with this example, </span><b>😛</b></div><div id="t1527267936000643" t="2018-05-25 17:05:36 jdt yes indeed, infinite loop"><a href="#t1527267936000643" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-25</span> <span class="t" onclick="H(this)">17:05:36</span>                     jdt </span><span>yes indeed, infinite loop</span></div><div id="t1527267972000483" t="2018-05-25 17:06:12 mikerod you can do an  insert-unconditional!  of course"><a href="#t1527267972000483" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-25</span> <span class="t" onclick="H(this)">17:06:12</span>                 mikerod </span><span>you can do an </span><code>insert-unconditional!</code><span> of course</span></div><div id="t1527267979000649" t="2018-05-25 17:06:19 jdt Amending the snippet"><a href="#t1527267979000649" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-25</span> <span class="t" onclick="H(this)">17:06:19</span>                     jdt </span><span>Amending the snippet</span></div><div id="t1527267986000419" t="2018-05-25 17:06:26 mikerod I’m not a huge fan of those, because they cause rules to become more order dependent’"><a href="#t1527267986000419" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-25</span> <span class="t" onclick="H(this)">17:06:26</span>                 mikerod </span><span>I’m not a huge fan of those, because they cause rules to become more order dependent’</span></div><div id="t1527268000000054" t="2018-05-25 17:06:40 mikerod However, there are times where they are difficult to avoid I know"><a href="#t1527268000000054" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-25</span> <span class="t" onclick="H(this)">17:06:40</span>                 mikerod </span><span>However, there are times where they are difficult to avoid I know</span></div><div id="t1527268068000295" t="2018-05-25 17:07:48 jdt In my case, I need to add a fact to the system, once to &quot;initialize&quot; the absense of a missing fact.  The fact needs to survive truth maintenace because I am going to retract the basis for creating it, but  not the need for using it later on"><a href="#t1527268068000295" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-25</span> <span class="t" onclick="H(this)">17:07:48</span>                     jdt </span><span>In my case, I need to add a fact to the system, once to &quot;initialize&quot; the absense of a missing fact.  The fact needs to survive truth maintenace because I am going to retract the basis for creating it, but  not the need for using it later on</span></div><div id="t1527268073000592" t="2018-05-25 17:07:53 mikerod Your snippet now has no code, only output"><a href="#t1527268073000592" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-25</span> <span class="t" onclick="H(this)">17:07:53</span>                 mikerod </span><span>Your snippet now has no code, only output</span></div><div id="t1527268084000295" t="2018-05-25 17:08:04 jdt yeah, once sec, reposting the snippet, there was no &quot;edit&quot;"><a href="#t1527268084000295" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-25</span> <span class="t" onclick="H(this)">17:08:04</span>                     jdt </span><span>yeah, once sec, reposting the snippet, there was no &quot;edit&quot;</span></div><div id="t1527268217000656" t="2018-05-25 17:10:17 jdt I deleted the first snippet, it shouldn&apos;t exist at all in slack, actually."><a href="#t1527268217000656" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-25</span> <span class="t" onclick="H(this)">17:10:17</span>                     jdt </span><span>I deleted the first snippet, it shouldn&apos;t exist at all in slack, actually.</span></div><div id="t1527268319000647" t="2018-05-25 17:11:59 jdt Anyway, I&apos;m clearly not yet in the mindset of thinking the way clara wants me to think.  I&apos;d expect a rule like  [:not [Foo]] =&gt; (insert-unconditional! (-&gt;Foo))  to fire exactly once, but clearly my assumptions are wrong."><a href="#t1527268319000647" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-25</span> <span class="t" onclick="H(this)">17:11:59</span>                     jdt </span><span>Anyway, I&apos;m clearly not yet in the mindset of thinking the way clara wants me to think.  I&apos;d expect a rule like </span><code>[:not [Foo]] =&gt; (insert-unconditional! (-&gt;Foo))</code><span> to fire exactly once, but clearly my assumptions are wrong.</span></div><div id="t1527268421000084" t="2018-05-25 17:13:41 alex-dixon Wouldn’t call that a bad assumption but that rule effectively means when not foo foo and when foo not foo"><a href="#t1527268421000084" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-25</span> <span class="t" onclick="H(this)">17:13:41</span>              alex-dixon </span><span>Wouldn’t call that a bad assumption but that rule effectively means when not foo foo and when foo not foo</span></div><div id="t1527268453000136" t="2018-05-25 17:14:13 mikerod if you use  insert!  the behavior is a contradiction, with  insert-unconditional!  it is different"><a href="#t1527268453000136" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-25</span> <span class="t" onclick="H(this)">17:14:13</span>                 mikerod </span><span>if you use </span><code>insert!</code><span> the behavior is a contradiction, with </span><code>insert-unconditional!</code><span> it is different</span></div><div id="t1527268476000225" t="2018-05-25 17:14:36 mikerod There is also a property you can add to rules, I don’t typically like to add it though, but it is  :no-loop"><a href="#t1527268476000225" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-25</span> <span class="t" onclick="H(this)">17:14:36</span>                 mikerod </span><span>There is also a property you can add to rules, I don’t typically like to add it though, but it is </span><code>:no-loop</code></div><div id="t1527268509000696" t="2018-05-25 17:15:09 alex-dixon Oops. with unconditional it should operate as you stated I think"><a href="#t1527268509000696" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-25</span> <span class="t" onclick="H(this)">17:15:09</span>              alex-dixon </span><span>Oops. with unconditional it should operate as you stated I think</span></div><div id="t1527268512000289" t="2018-05-25 17:15:12 mikerod it may be able to stop a logical loop from a contradicting rule like you have here with  insert! , but I’d have to mess with that again"><a href="#t1527268512000289" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-25</span> <span class="t" onclick="H(this)">17:15:12</span>                 mikerod </span><span>it may be able to stop a logical loop from a contradicting rule like you have here with </span><code>insert!</code><span>, but I’d have to mess with that again</span></div><div id="t1527268517000178" t="2018-05-25 17:15:17 jdt Oops, yes, my code snippet iwth the infinite loop isn&apos;t interesting.  When I use  insert-unconditional  it&apos;s still firing more than once"><a href="#t1527268517000178" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-25</span> <span class="t" onclick="H(this)">17:15:17</span>                     jdt </span><span>Oops, yes, my code snippet iwth the infinite loop isn&apos;t interesting.  When I use </span><code>insert-unconditional</code><span> it&apos;s still firing more than once</span></div><div id="t1527268526000066" t="2018-05-25 17:15:26 mikerod @alex-dixon I haven’t seen an  insert-unconditional!  example yet  😛"><a href="#t1527268526000066" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-25</span> <span class="t" onclick="H(this)">17:15:26</span>                 mikerod </span><span>@alex-dixon I haven’t seen an </span><code>insert-unconditional!</code><span> example yet </span><b>😛</b></div><div id="t1527268530000011" t="2018-05-25 17:15:30 jdt Doing the code snippet and output again, apologies"><a href="#t1527268530000011" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-25</span> <span class="t" onclick="H(this)">17:15:30</span>                     jdt </span><span>Doing the code snippet and output again, apologies</span></div><div id="t1527268551000175" t="2018-05-25 17:15:51 mikerod insert-unconditional!  will result in a firing for each of your  Fact  objects, so 3 is rigth"><a href="#t1527268551000175" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-25</span> <span class="t" onclick="H(this)">17:15:51</span>                 mikerod </span><code>insert-unconditional!</code><span> will result in a firing for each of your </span><code>Fact</code><span> objects, so 3 is rigth</span></div><div id="t1527268601000363" t="2018-05-25 17:16:41 alex-dixon What about not exists?"><a href="#t1527268601000363" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-25</span> <span class="t" onclick="H(this)">17:16:41</span>              alex-dixon </span><span>What about not exists?</span></div><div id="t1527268618000045" t="2018-05-25 17:16:58 jdt I thought  [:not [Foo]]  was a not-exist check?"><a href="#t1527268618000045" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-25</span> <span class="t" onclick="H(this)">17:16:58</span>                     jdt </span><span>I thought </span><code>[:not [Foo]]</code><span> was a not-exist check?</span></div><div id="t1527268622000428" t="2018-05-25 17:17:02 mikerod The rules do not treat the working memory as something like a set. It allows “duplicates”. There are useful cases for that - scratch this"><a href="#t1527268622000428" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-25</span> <span class="t" onclick="H(this)">17:17:02</span>                 mikerod </span><span>The rules do not treat the working memory as something like a set. It allows “duplicates”. There are useful cases for that - scratch this</span></div><div id="t1527268633000518" t="2018-05-25 17:17:13 mikerod oh, I see what you mean"><a href="#t1527268633000518" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-25</span> <span class="t" onclick="H(this)">17:17:13</span>                 mikerod </span><span>oh, I see what you mean</span></div><div id="t1527268713000592" t="2018-05-25 17:18:33 mikerod @dave.tenny you’re correct in what  :not  is"><a href="#t1527268713000592" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-25</span> <span class="t" onclick="H(this)">17:18:33</span>                 mikerod </span><span>@dave.tenny you’re correct in what </span><code>:not</code><span> is</span></div><div id="t1527268822000531" t="2018-05-25 17:20:22 mikerod I think it may be an “edge case” on  insert-unconditional!  behavior in the engine. I’d probably call it incorrect how the engine is behaving"><a href="#t1527268822000531" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-25</span> <span class="t" onclick="H(this)">17:20:22</span>                 mikerod </span><span>I think it may be an “edge case” on </span><code>insert-unconditional!</code><span> behavior in the engine. I’d probably call it incorrect how the engine is behaving</span></div><div id="t1527268846000305" t="2018-05-25 17:20:46 jdt I&apos;m confused because on the one hand, the RHS of one rule can impact the firing of another rule.  But in this case it&apos;s like both checks for a [Derived 1] correpesponding to a [Fact 1] took place at the same time, neither aware of the others effect, and unsure how to bridge that."><a href="#t1527268846000305" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-25</span> <span class="t" onclick="H(this)">17:20:46</span>                     jdt </span><span>I&apos;m confused because on the one hand, the RHS of one rule can impact the firing of another rule.  But in this case it&apos;s like both checks for a [Derived 1] correpesponding to a [Fact 1] took place at the same time, neither aware of the others effect, and unsure how to bridge that.</span></div><div id="t1527268901000429" t="2018-05-25 17:21:41 mikerod Like I said, I’m not a fan of  insert-unconditional!  and try to not use it much because I think it makes things have order dependence and always trickier to reason about as far as “global logical consistency” across the rules"><a href="#t1527268901000429" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-25</span> <span class="t" onclick="H(this)">17:21:41</span>                 mikerod </span><span>Like I said, I’m not a fan of </span><code>insert-unconditional!</code><span> and try to not use it much because I think it makes things have order dependence and always trickier to reason about as far as “global logical consistency” across the rules</span></div><div id="t1527268905000600" t="2018-05-25 17:21:45 jdt (reminds me of MVCC transactions, which can be a good thing ... in a database  😉  )"><a href="#t1527268905000600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-25</span> <span class="t" onclick="H(this)">17:21:45</span>                     jdt </span><span>(reminds me of MVCC transactions, which can be a good thing ... in a database </span><b>😉</b><span> )</span></div><div id="t1527268912000308" t="2018-05-25 17:21:52 mikerod However, in this case, I think it is behaving poorly with batched inserts"><a href="#t1527268912000308" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-25</span> <span class="t" onclick="H(this)">17:21:52</span>                 mikerod </span><span>However, in this case, I think it is behaving poorly with batched inserts</span></div><div id="t1527268942000552" t="2018-05-25 17:22:22 mikerod I think all 3 matches are staged independent of one another and all perform  insert-unconditional!  at the “same time”"><a href="#t1527268942000552" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-25</span> <span class="t" onclick="H(this)">17:22:22</span>                 mikerod </span><span>I think all 3 matches are staged independent of one another and all perform </span><code>insert-unconditional!</code><span> at the “same time”</span></div><div id="t1527268959000083" t="2018-05-25 17:22:39 mikerod since they are unconditional, the truth maintenance isn’t used to remove the logical inconsistencies"><a href="#t1527268959000083" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-25</span> <span class="t" onclick="H(this)">17:22:39</span>                 mikerod </span><span>since they are unconditional, the truth maintenance isn’t used to remove the logical inconsistencies</span></div><div id="t1527268986000244" t="2018-05-25 17:23:06 mikerod this is a tougher case to me conceptually to think about"><a href="#t1527268986000244" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-25</span> <span class="t" onclick="H(this)">17:23:06</span>                 mikerod </span><span>this is a tougher case to me conceptually to think about</span></div><div id="t1527268997000327" t="2018-05-25 17:23:17 mikerod as far as a “fix” would go"><a href="#t1527268997000327" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-25</span> <span class="t" onclick="H(this)">17:23:17</span>                 mikerod </span><span>as far as a “fix” would go</span></div><div id="t1527269083000379" t="2018-05-25 17:24:43 jdt Okay, well, I&apos;ll remedy my immediate problem by doing what is fundamentally an initialization step outside of the rule firing and add my initialization outside of the firings (i.e. not in an RHS via  insert! , but via  insert  externally."><a href="#t1527269083000379" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-25</span> <span class="t" onclick="H(this)">17:24:43</span>                     jdt </span><span>Okay, well, I&apos;ll remedy my immediate problem by doing what is fundamentally an initialization step outside of the rule firing and add my initialization outside of the firings (i.e. not in an RHS via </span><code>insert!</code><span>, but via </span><code>insert</code><span> externally.</span></div><div id="t1527269085000512" t="2018-05-25 17:24:45 alex-dixon Wondering if behavior is different if derived is inserted without ?x...maybe y instead "><a href="#t1527269085000512" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-25</span> <span class="t" onclick="H(this)">17:24:45</span>              alex-dixon </span><span>Wondering if behavior is different if derived is inserted without ?x...maybe y instead </span></div><div id="t1527269140000162" t="2018-05-25 17:25:40 jdt I&apos;m definitely still struggling with these little things, though logic principles of  [not x] =&gt; [x]  is a good way ot look at it in my thinking for the future."><a href="#t1527269140000162" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-25</span> <span class="t" onclick="H(this)">17:25:40</span>                     jdt </span><span>I&apos;m definitely still struggling with these little things, though logic principles of </span><code>[not x] =&gt; [x]</code><span> is a good way ot look at it in my thinking for the future.</span></div><div id="t1527269196000312" t="2018-05-25 17:26:36 mikerod @dave.tenny oftentimes, and I’ve said this quite a bit here before, I try to separate the desire of “cardinality” into a different rule from the rule that has the logic to derive the fact in question"><a href="#t1527269196000312" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-25</span> <span class="t" onclick="H(this)">17:26:36</span>                 mikerod </span><span>@dave.tenny oftentimes, and I’ve said this quite a bit here before, I try to separate the desire of “cardinality” into a different rule from the rule that has the logic to derive the fact in question</span></div><div id="t1527269207000705" t="2018-05-25 17:26:47 jdt This particular one is very unfortunate though, if it worked it was much nicer and more foolproof when done via a rule firing."><a href="#t1527269207000705" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-25</span> <span class="t" onclick="H(this)">17:26:47</span>                     jdt </span><span>This particular one is very unfortunate though, if it worked it was much nicer and more foolproof when done via a rule firing.</span></div><div id="t1527269224000030" t="2018-05-25 17:27:04 mikerod So instead of worrying about a rule producing too many of something, I let it produce them, and reconcile them with a separate rule and an accumulator"><a href="#t1527269224000030" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-25</span> <span class="t" onclick="H(this)">17:27:04</span>                 mikerod </span><span>So instead of worrying about a rule producing too many of something, I let it produce them, and reconcile them with a separate rule and an accumulator</span></div><div id="t1527269236000238" t="2018-05-25 17:27:16 alex-dixon @mikerod what’s the upside to the batched unconditional insertions implementation? Is it possible to still attain those benefits without eliciting behavior like this?"><a href="#t1527269236000238" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-25</span> <span class="t" onclick="H(this)">17:27:16</span>              alex-dixon </span><span>@mikerod what’s the upside to the batched unconditional insertions implementation? Is it possible to still attain those benefits without eliciting behavior like this?</span></div><div id="t1527269246000339" t="2018-05-25 17:27:26 mikerod this case is a bit different in a way, but if your real concern is only that you don’t  want 2  Derived :y 1  facts, it applies"><a href="#t1527269246000339" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-25</span> <span class="t" onclick="H(this)">17:27:26</span>                 mikerod </span><span>this case is a bit different in a way, but if your real concern is only that you don’t  want 2 </span><code>Derived :y 1</code><span> facts, it applies</span></div><div id="t1527269273000655" t="2018-05-25 17:27:53 mikerod @alex-dixon batched &lt;anything&gt; upside is basically always performance"><a href="#t1527269273000655" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-25</span> <span class="t" onclick="H(this)">17:27:53</span>                 mikerod </span><span>@alex-dixon batched &lt;anything&gt; upside is basically always performance</span></div><div id="t1527269280000040" t="2018-05-25 17:28:00 mikerod and the performance can be really significant"><a href="#t1527269280000040" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-25</span> <span class="t" onclick="H(this)">17:28:00</span>                 mikerod </span><span>and the performance can be really significant</span></div><div id="t1527269314000096" t="2018-05-25 17:28:34 mikerod However, in the unconditional case, it now concerns me a bit since the truth maintenance won’t “fix it” when different unconditional inserts cause the other to become untrue"><a href="#t1527269314000096" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-25</span> <span class="t" onclick="H(this)">17:28:34</span>                 mikerod </span><span>However, in the unconditional case, it now concerns me a bit since the truth maintenance won’t “fix it” when different unconditional inserts cause the other to become untrue</span></div><div id="t1527269340000020" t="2018-05-25 17:29:00 mikerod however, that is a really gray area to me. if it did behave right, how would it choose which unconditional insert wins, when they contradict each other? In the general case."><a href="#t1527269340000020" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-25</span> <span class="t" onclick="H(this)">17:29:00</span>                 mikerod </span><span>however, that is a really gray area to me. if it did behave right, how would it choose which unconditional insert wins, when they contradict each other? In the general case.</span></div><div id="t1527269346000085" t="2018-05-25 17:29:06 mikerod I guess it would just have to be order-dependent"><a href="#t1527269346000085" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-25</span> <span class="t" onclick="H(this)">17:29:06</span>                 mikerod </span><span>I guess it would just have to be order-dependent</span></div><div id="t1527269401000062" t="2018-05-25 17:30:01 jdt On an unrelated topic, can you recommend tools for pretty-printing/organizing  inspect  and  get-trace  output to assist with reading it?   I made my first attempt at decoding that stuff to debug, but as a raw clojure nested structure it&apos;s rough going for a first try."><a href="#t1527269401000062" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-25</span> <span class="t" onclick="H(this)">17:30:01</span>                     jdt </span><span>On an unrelated topic, can you recommend tools for pretty-printing/organizing </span><code>inspect</code><span> and </span><code>get-trace</code><span> output to assist with reading it?   I made my first attempt at decoding that stuff to debug, but as a raw clojure nested structure it&apos;s rough going for a first try.</span></div><div id="t1527269478000080" t="2018-05-25 17:31:18 mikerod @dave.tenny @alex-dixon is going to release a tool to show tracing stuff nicer  😛"><a href="#t1527269478000080" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-25</span> <span class="t" onclick="H(this)">17:31:18</span>                 mikerod </span><span>@dave.tenny @alex-dixon is going to release a tool to show tracing stuff nicer </span><b>😛</b></div><div id="t1527269536000577" t="2018-05-25 17:32:16 mikerod Joking.. but he has said he had a better visualization thing. The trace results will be pretty verbose and clj data structures. Inspect was supposed to have a few friendlier printers I think. I haven’t used inspect much."><a href="#t1527269536000577" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-25</span> <span class="t" onclick="H(this)">17:32:16</span>                 mikerod </span><span>Joking.. but he has said he had a better visualization thing. The trace results will be pretty verbose and clj data structures. Inspect was supposed to have a few friendlier printers I think. I haven’t used inspect much.</span></div><div id="t1527269642000682" t="2018-05-25 17:34:02 jdt Of course what I really want is a simple movie-mode rule tracing with verbose-mode description of clause evaluation impact on rule consideration/rejection.   Heh, or is that  [:test (do (prn &quot;here I am&quot;) true)]  in the LHS?"><a href="#t1527269642000682" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-25</span> <span class="t" onclick="H(this)">17:34:02</span>                     jdt </span><span>Of course what I really want is a simple movie-mode rule tracing with verbose-mode description of clause evaluation impact on rule consideration/rejection.   Heh, or is that </span><code>[:test (do (prn &quot;here I am&quot;) true)]</code><span> in the LHS?</span></div><div id="t1527269739000160" t="2018-05-25 17:35:39 mikerod @dave.tenny yeah, you can print stuff. I think the tracing output can be used alright, but it’s mostly just composing functions on it to show it however is useful."><a href="#t1527269739000160" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-25</span> <span class="t" onclick="H(this)">17:35:39</span>                 mikerod </span><span>@dave.tenny yeah, you can print stuff. I think the tracing output can be used alright, but it’s mostly just composing functions on it to show it however is useful.</span></div><div id="t1527269769000289" t="2018-05-25 17:36:09 mikerod I don’t have any great pointers there still beyond that"><a href="#t1527269769000289" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-25</span> <span class="t" onclick="H(this)">17:36:09</span>                 mikerod </span><span>I don’t have any great pointers there still beyond that</span></div><div id="t1527269799000055" t="2018-05-25 17:36:39 jdt Haven&apos;t seen any &quot;tips and tricks&quot; documentation for the sorts of things a newbie could use for debugging"><a href="#t1527269799000055" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-25</span> <span class="t" onclick="H(this)">17:36:39</span>                     jdt </span><span>Haven&apos;t seen any &quot;tips and tricks&quot; documentation for the sorts of things a newbie could use for debugging</span></div><div id="t1527269802000714" t="2018-05-25 17:36:42 jdt if it&apos;s out there"><a href="#t1527269802000714" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-25</span> <span class="t" onclick="H(this)">17:36:42</span>                     jdt </span><span>if it&apos;s out there</span></div><div id="t1527270156000134" t="2018-05-25 17:42:36 mikerod Yeah, I think this may be something that is lacking (and would be really nice to have)."><a href="#t1527270156000134" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-25</span> <span class="t" onclick="H(this)">17:42:36</span>                 mikerod </span><span>Yeah, I think this may be something that is lacking (and would be really nice to have).</span></div><div id="t1527270166000182" t="2018-05-25 17:42:46 mikerod The most docs I see are just from  http://www.clara-rules.org/docs/inspection/"><a href="#t1527270166000182" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-25</span> <span class="t" onclick="H(this)">17:42:46</span>                 mikerod </span><span>The most docs I see are just from </span><a href="http://www.clara-rules.org/docs/inspection/" target="_blank">http://www.clara-rules.org/docs/inspection/</a></div><div id="t1527276511000482" t="2018-05-25 19:28:31 alex-dixon @mikerod It’s not better according to me. And yeah…I’m working on it again this weekend  🙂"><a href="#t1527276511000482" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-25</span> <span class="t" onclick="H(this)">19:28:31</span>              alex-dixon </span><span>@mikerod It’s not better according to me. And yeah…I’m working on it again this weekend </span><b>🙂</b></div><div id="t1527276682000470" t="2018-05-25 19:31:22 alex-dixon Might open an issue in Clara about adding Datalog syntax as a separate clara library. For something like the precept devtools concept I’m not sure how that would work….would need to think about it or have some direction from others. A lot of the way I thought about it was Precept-specific. I think the main difference is that there’s framework to manage session transitions, so there’s code that’s aware of when rules are firing and when they’re done firing that allows them to be identified and numbered"><a href="#t1527276682000470" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-25</span> <span class="t" onclick="H(this)">19:31:22</span>              alex-dixon </span><span>Might open an issue in Clara about adding Datalog syntax as a separate clara library. For something like the precept devtools concept I’m not sure how that would work….would need to think about it or have some direction from others. A lot of the way I thought about it was Precept-specific. I think the main difference is that there’s framework to manage session transitions, so there’s code that’s aware of when rules are firing and when they’re done firing that allows them to be identified and numbered</span></div><div id="t1527276695000168" t="2018-05-25 19:31:35 alex-dixon Sorry if that’s incoherent"><a href="#t1527276695000168" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-25</span> <span class="t" onclick="H(this)">19:31:35</span>              alex-dixon </span><span>Sorry if that’s incoherent</span></div><div id="t1527286846000295" t="2018-05-25 22:20:46 mikerod @alex-dixon Yeah, I’d have to think about that more too. I get what you are saying though I think."><a href="#t1527286846000295" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-25</span> <span class="t" onclick="H(this)">22:20:46</span>                 mikerod </span><span>@alex-dixon Yeah, I’d have to think about that more too. I get what you are saying though I think.</span></div><div id="t1527473799000070" t="2018-05-28 02:16:39 alex-dixon I think I’m about ready to release an alpha preview of precept devtools to anyone who’s interested"><a href="#t1527473799000070" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-28</span> <span class="t" onclick="H(this)">02:16:39</span>              alex-dixon </span><span>I think I’m about ready to release an alpha preview of precept devtools to anyone who’s interested</span></div><div id="t1527476706000052" t="2018-05-28 03:05:06 alex-dixon @devn  https://github.com/CoNarrative/precept-devtools"><a href="#t1527476706000052" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-28</span> <span class="t" onclick="H(this)">03:05:06</span>              alex-dixon </span><span>@devn </span><a href="https://github.com/CoNarrative/precept-devtools" target="_blank">https://github.com/CoNarrative/precept-devtools</a></div><div id="t1527476922000162" t="2018-05-28 03:08:42 alex-dixon If at all possible I’d prefer not to publicize it (yet) until I make some improvements to the readme and a few other things"><a href="#t1527476922000162" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-28</span> <span class="t" onclick="H(this)">03:08:42</span>              alex-dixon </span><span>If at all possible I’d prefer not to publicize it (yet) until I make some improvements to the readme and a few other things</span></div><div id="t1527477264000024" t="2018-05-28 03:14:24 alex-dixon I’d definitely appreciate any feedback though"><a href="#t1527477264000024" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-28</span> <span class="t" onclick="H(this)">03:14:24</span>              alex-dixon </span><span>I’d definitely appreciate any feedback though</span></div><div id="t1527685046000002" t="2018-05-30 12:57:26 jdt I&apos;m just building this little prototype rule-based scheduler in clara to see if it will handle things at scale.  It won&apos;t have many rules, but it will have a pragmatic maximum of 1-2 million base facts before firing the rule engine.  Am I wasting my time, or will that overwhelm the system?  (The bulk of the facts are job requests, from which we then infer things like whether there&apos;s a worker with adequate resources, round robin behaviors, and so on.)"><a href="#t1527685046000002" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-30</span> <span class="t" onclick="H(this)">12:57:26</span>                     jdt </span><span>I&apos;m just building this little prototype rule-based scheduler in clara to see if it will handle things at scale.  It won&apos;t have many rules, but it will have a pragmatic maximum of 1-2 million base facts before firing the rule engine.  Am I wasting my time, or will that overwhelm the system?  (The bulk of the facts are job requests, from which we then infer things like whether there&apos;s a worker with adequate resources, round robin behaviors, and so on.)</span></div><div id="t1527685942000266" t="2018-05-30 13:12:22 jdt (I&apos;m building the new intermediate binding of WorkerViableJob and ActiveUserJobCount, I just wondered if there wasn&apos;t a way to correlate the two records in the  :and  subclause that considers them without the use if an intermediate fact)."><a href="#t1527685942000266" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-30</span> <span class="t" onclick="H(this)">13:12:22</span>                     jdt </span><span>(I&apos;m building the new intermediate binding of WorkerViableJob and ActiveUserJobCount, I just wondered if there wasn&apos;t a way to correlate the two records in the </span><code>:and</code><span> subclause that considers them without the use if an intermediate fact).</span></div><div id="t1527695306000295" t="2018-05-30 15:48:26 mikerod @dave.tenny I’d perhaps worry about that being a fairly slow way to do what you are saying given that you have so many facts in the session"><a href="#t1527695306000295" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-30</span> <span class="t" onclick="H(this)">15:48:26</span>                 mikerod </span><span>@dave.tenny I’d perhaps worry about that being a fairly slow way to do what you are saying given that you have so many facts in the session</span></div><div id="t1527695347000129" t="2018-05-30 15:49:07 jdt &quot;that&quot; being using a rules system?"><a href="#t1527695347000129" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-30</span> <span class="t" onclick="H(this)">15:49:07</span>                     jdt </span><span>&quot;that&quot; being using a rules system?</span></div><div id="t1527695369000360" t="2018-05-30 15:49:29 mikerod I think if you have enough memory for that many objects, then the rules could perform alright. However, you will have to look out for bad algorithmic complexity in some rules if they are going to be processed over a very large amount of facts, like if you do some wide-open joins between sets of facts with size N and size M, you’ll get NxM comparisons in the join criteria"><a href="#t1527695369000360" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-30</span> <span class="t" onclick="H(this)">15:49:29</span>                 mikerod </span><span>I think if you have enough memory for that many objects, then the rules could perform alright. However, you will have to look out for bad algorithmic complexity in some rules if they are going to be processed over a very large amount of facts, like if you do some wide-open joins between sets of facts with size N and size M, you’ll get NxM comparisons in the join criteria</span></div><div id="t1527695398000045" t="2018-05-30 15:49:58 jdt yeah, trying to keep things tightly joined, and avoid derived facts that I don&apos;t need where possible"><a href="#t1527695398000045" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-30</span> <span class="t" onclick="H(this)">15:49:58</span>                     jdt </span><span>yeah, trying to keep things tightly joined, and avoid derived facts that I don&apos;t need where possible</span></div><div id="t1527695403000849" t="2018-05-30 15:50:03 mikerod Oh, I mean the rule you gave above may be slow, if there are millions of  WorkerViableJob  and  ActiveUserJobCount"><a href="#t1527695403000849" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-30</span> <span class="t" onclick="H(this)">15:50:03</span>                 mikerod </span><span>Oh, I mean the rule you gave above may be slow, if there are millions of </span><code>WorkerViableJob</code><span> and </span><code>ActiveUserJobCount</code></div><div id="t1527695417000175" t="2018-05-30 15:50:17 jdt No, there&apos;s only millions of raw job request."><a href="#t1527695417000175" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-30</span> <span class="t" onclick="H(this)">15:50:17</span>                     jdt </span><span>No, there&apos;s only millions of raw job request.</span></div><div id="t1527695423000780" t="2018-05-30 15:50:23 mikerod I think that a rules engine, such as Clara, may be capable of having reasonable perf characteristics, but you’d have to be careful for the “hot spots”"><a href="#t1527695423000780" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-30</span> <span class="t" onclick="H(this)">15:50:23</span>                 mikerod </span><span>I think that a rules engine, such as Clara, may be capable of having reasonable perf characteristics, but you’d have to be careful for the “hot spots”</span></div><div id="t1527695454000049" t="2018-05-30 15:50:54 jdt There are relatively fiew WorkerViableJobs (those are jobs for which we know we have worker resources available, and we limit those to a small number of oldest/most-applicable jobs in any fire-rules run)"><a href="#t1527695454000049" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-30</span> <span class="t" onclick="H(this)">15:50:54</span>                     jdt </span><span>There are relatively fiew WorkerViableJobs (those are jobs for which we know we have worker resources available, and we limit those to a small number of oldest/most-applicable jobs in any fire-rules run)</span></div><div id="t1527695454000287" t="2018-05-30 15:50:54 mikerod It’s best to quickly filter down to a smaller set of facts before performing the more involved joins between sets of facts"><a href="#t1527695454000287" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-30</span> <span class="t" onclick="H(this)">15:50:54</span>                 mikerod </span><span>It’s best to quickly filter down to a smaller set of facts before performing the more involved joins between sets of facts</span></div><div id="t1527695488000318" t="2018-05-30 15:51:28 mikerod I would not fear intermediate facts either"><a href="#t1527695488000318" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-30</span> <span class="t" onclick="H(this)">15:51:28</span>                 mikerod </span><span>I would not fear intermediate facts either</span></div><div id="t1527695501000105" t="2018-05-30 15:51:41 mikerod I think it’ll help your rule given above even"><a href="#t1527695501000105" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-30</span> <span class="t" onclick="H(this)">15:51:41</span>                 mikerod </span><span>I think it’ll help your rule given above even</span></div><div id="t1527695524000839" t="2018-05-30 15:52:04 jdt Yeah, already fixed that by asserting facts representing bindings of the clause."><a href="#t1527695524000839" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-30</span> <span class="t" onclick="H(this)">15:52:04</span>                     jdt </span><span>Yeah, already fixed that by asserting facts representing bindings of the clause.</span></div><div id="t1527695537000360" t="2018-05-30 15:52:17 jdt I just wondered if there was a better way"><a href="#t1527695537000360" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-30</span> <span class="t" onclick="H(this)">15:52:17</span>                     jdt </span><span>I just wondered if there was a better way</span></div><div id="t1527695604000573" t="2018-05-30 15:53:24 jdt I also repeatedly fall into the trap of   [:not A] =&gt; A  in my rules, because I only want to make an A if some other particular thing isn&apos;t true.  Finding my way around it, but feels like I fight the problem a lot, whether or not the inserted A is unconditional."><a href="#t1527695604000573" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-30</span> <span class="t" onclick="H(this)">15:53:24</span>                     jdt </span><span>I also repeatedly fall into the trap of  </span><code>[:not A] =&gt; A</code><span> in my rules, because I only want to make an A if some other particular thing isn&apos;t true.  Finding my way around it, but feels like I fight the problem a lot, whether or not the inserted A is unconditional.</span></div><div id="t1527695605000030" t="2018-05-30 15:53:25 mikerod perhaps"><a href="#t1527695605000030" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-30</span> <span class="t" onclick="H(this)">15:53:25</span>                 mikerod </span><span>perhaps</span></div><div id="t1527695688000842" t="2018-05-30 15:54:48 jdt Even though I don&apos;t have too many rules now, there&apos;s actually a lot we want to do in our job management, affinities, special cases for &quot;new job submitters&quot; to give them optimal user experience in interacting with the jobs whose results they want, etc."><a href="#t1527695688000842" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-30</span> <span class="t" onclick="H(this)">15:54:48</span>                     jdt </span><span>Even though I don&apos;t have too many rules now, there&apos;s actually a lot we want to do in our job management, affinities, special cases for &quot;new job submitters&quot; to give them optimal user experience in interacting with the jobs whose results they want, etc.</span></div><div id="t1527695712000096" t="2018-05-30 15:55:12 jdt So that&apos;s why I&apos;m spending a bit too much time to see if this is viable, I think rules could be a real win here."><a href="#t1527695712000096" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-30</span> <span class="t" onclick="H(this)">15:55:12</span>                     jdt </span><span>So that&apos;s why I&apos;m spending a bit too much time to see if this is viable, I think rules could be a real win here.</span></div><div id="t1527695730000520" t="2018-05-30 15:55:30 mikerod So in  your above example, I wonder if you could make use of an accumulator like:
 [?lowest &lt;- (acc/min :n-jobs) :from [ActiveUserJobCount (= ?job-type job-type)]]
"><a href="#t1527695730000520" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-30</span> <span class="t" onclick="H(this)">15:55:30</span>                 mikerod </span><span>So in  your above example, I wonder if you could make use of an accumulator like:
</span><pre>[?lowest &lt;- (acc/min :n-jobs) :from [ActiveUserJobCount (= ?job-type job-type)]]
</pre></div><div id="t1527695743000340" t="2018-05-30 15:55:43 mikerod however, I don’t know that I immediately get the full semantics (like what the RHS) does"><a href="#t1527695743000340" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-30</span> <span class="t" onclick="H(this)">15:55:43</span>                 mikerod </span><span>however, I don’t know that I immediately get the full semantics (like what the RHS) does</span></div><div id="t1527695758000852" t="2018-05-30 15:55:58 mikerod but doing that would give you the min job count for a given  :job-type  in terms of the  ActiveUserJobCount  facts"><a href="#t1527695758000852" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-30</span> <span class="t" onclick="H(this)">15:55:58</span>                 mikerod </span><span>but doing that would give you the min job count for a given </span><code>:job-type</code><span> in terms of the </span><code>ActiveUserJobCount</code><span> facts</span></div><div id="t1527695784000735" t="2018-05-30 15:56:24 mikerod For this one:
&gt; I also repeatedly fall into the trap of   [:not A] =&gt; A  in my rules, because I only want to make an A if some other particular thing isn’t true
I don’t know of a fix-all. It’s a case by case thing. Not sure what sort of scenario keeps getting you into it."><a href="#t1527695784000735" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-30</span> <span class="t" onclick="H(this)">15:56:24</span>                 mikerod </span><span>For this one:
&gt; I also repeatedly fall into the trap of  </span><code>[:not A] =&gt; A</code><span> in my rules, because I only want to make an A if some other particular thing isn’t true
I don’t know of a fix-all. It’s a case by case thing. Not sure what sort of scenario keeps getting you into it.</span></div><div id="t1527695788000511" t="2018-05-30 15:56:28 jdt For one of m y  [:not A] =&gt; A  scenarios I tried  [acc/count ...  and checked for count &lt; than the limit I wanted, but the problem is it won&apos;t fire if the count is zero, even if the accumulator initializes with zero"><a href="#t1527695788000511" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-30</span> <span class="t" onclick="H(this)">15:56:28</span>                     jdt </span><span>For one of m y </span><code>[:not A] =&gt; A</code><span> scenarios I tried </span><code>[acc/count ...</code><span> and checked for count &lt; than the limit I wanted, but the problem is it won&apos;t fire if the count is zero, even if the accumulator initializes with zero</span></div><div id="t1527695888000119" t="2018-05-30 15:58:08 jdt My scenarios are things like &quot;this job is something we want to proceed with if some other job isn&apos;t eligible&quot;, a gross generalism, could be any fact, not just jobs.  It often boils down to counting situations.   E.g. only dispatch at most two at a time on a worker in one fire-rules loop."><a href="#t1527695888000119" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-30</span> <span class="t" onclick="H(this)">15:58:08</span>                     jdt </span><span>My scenarios are things like &quot;this job is something we want to proceed with if some other job isn&apos;t eligible&quot;, a gross generalism, could be any fact, not just jobs.  It often boils down to counting situations.   E.g. only dispatch at most two at a time on a worker in one fire-rules loop.</span></div><div id="t1527695930000747" t="2018-05-30 15:58:50 jdt My approach now is to generate very minimal sets of candidates in a fire-rules session, then query the results, dispatch jobs, update relevant counters-as-facts, then run fire-rules again in a loop."><a href="#t1527695930000747" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-30</span> <span class="t" onclick="H(this)">15:58:50</span>                     jdt </span><span>My approach now is to generate very minimal sets of candidates in a fire-rules session, then query the results, dispatch jobs, update relevant counters-as-facts, then run fire-rules again in a loop.</span></div><div id="t1527695985000941" t="2018-05-30 15:59:45 jdt The counters I need to maintain are mainly worker resource availability and active user job counts partitioned by type of job."><a href="#t1527695985000941" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-30</span> <span class="t" onclick="H(this)">15:59:45</span>                     jdt </span><span>The counters I need to maintain are mainly worker resource availability and active user job counts partitioned by type of job.</span></div><div id="t1527695999000779" t="2018-05-30 15:59:59 jdt Okay, well, hopefully I&apos;m nearing some kind of first load test, we&apos;ll see what happens."><a href="#t1527695999000779" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-30</span> <span class="t" onclick="H(this)">15:59:59</span>                     jdt </span><span>Okay, well, hopefully I&apos;m nearing some kind of first load test, we&apos;ll see what happens.</span></div><div id="t1527696013000590" t="2018-05-30 16:00:13 jdt Advice always appreciated."><a href="#t1527696013000590" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-30</span> <span class="t" onclick="H(this)">16:00:13</span>                     jdt </span><span>Advice always appreciated.</span></div><div id="t1527700306000565" t="2018-05-30 17:11:46 wparker @jdt The Clara count accumulator should fire with an initial value of 0.  Do you have an example where it does not?  Also keep in mind that you can create your own accumulators with arbitrary domain-specific logic.  So say &quot;choose the top two at most&quot; could be done.  My instinct here is that it sounds like the problems you describe might be addressable with accumulators without any insert-unconditional logic, although as always hard to say without knowing the problem space.  It sounds like @mikerod was suggesting that as well."><a href="#t1527700306000565" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-30</span> <span class="t" onclick="H(this)">17:11:46</span>                 wparker </span><span>@jdt The Clara count accumulator should fire with an initial value of 0.  Do you have an example where it does not?  Also keep in mind that you can create your own accumulators with arbitrary domain-specific logic.  So say &quot;choose the top two at most&quot; could be done.  My instinct here is that it sounds like the problems you describe might be addressable with accumulators without any insert-unconditional logic, although as always hard to say without knowing the problem space.  It sounds like @mikerod was suggesting that as well.</span></div><div id="t1527700414000400" t="2018-05-30 17:13:34 wparker See the writing accumulators section at  http://www.clara-rules.org/docs/accumulators/"><a href="#t1527700414000400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-30</span> <span class="t" onclick="H(this)">17:13:34</span>                 wparker </span><span>See the writing accumulators section at </span><a href="http://www.clara-rules.org/docs/accumulators/" target="_blank">http://www.clara-rules.org/docs/accumulators/</a></div><div id="t1527700498000397" t="2018-05-30 17:14:58 wparker Also regarding the cost of joins, that varies depending on the type of join, I&apos;d suggest reading  http://www.clara-rules.org/docs/hash_joins/  if you&apos;re working with millions of facts"><a href="#t1527700498000397" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-30</span> <span class="t" onclick="H(this)">17:14:58</span>                 wparker </span><span>Also regarding the cost of joins, that varies depending on the type of join, I&apos;d suggest reading </span><a href="http://www.clara-rules.org/docs/hash_joins/" target="_blank">http://www.clara-rules.org/docs/hash_joins/</a><span> if you&apos;re working with millions of facts</span></div><div id="t1527703162000193" t="2018-05-30 17:59:22 jdt I thought the behavior I observed with the  acc/count  condition not firing seemed consistent with the documented behavior on this page:  http://www.clara-rules.org/docs/accumulators/ , however I suspect I read it wrong and they were talking about other accumulators not firing when there weren&apos;t facts matching the condition, instead of  acc/count .  I don&apos;t have the example in code any more so will have to revisit it later if necessary.  Meanwhile I&apos;ll checkout those other links you posted."><a href="#t1527703162000193" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-30</span> <span class="t" onclick="H(this)">17:59:22</span>                     jdt </span><span>I thought the behavior I observed with the </span><code>acc/count</code><span> condition not firing seemed consistent with the documented behavior on this page: </span><a href="http://www.clara-rules.org/docs/accumulators/" target="_blank">http://www.clara-rules.org/docs/accumulators/</a><span>, however I suspect I read it wrong and they were talking about other accumulators not firing when there weren&apos;t facts matching the condition, instead of </span><code>acc/count</code><span>.  I don&apos;t have the example in code any more so will have to revisit it later if necessary.  Meanwhile I&apos;ll checkout those other links you posted.</span></div><div id="t1527705523000294" t="2018-05-30 18:38:43 mikerod @dave.tenny if an accumulator has a “truthy”  :initial-value , it’s condition in a rule will be considered satisfied even if no facts exists to match the accumulators fact match criteria"><a href="#t1527705523000294" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-30</span> <span class="t" onclick="H(this)">18:38:43</span>                 mikerod </span><span>@dave.tenny if an accumulator has a “truthy” </span><code>:initial-value</code><span>, it’s condition in a rule will be considered satisfied even if no facts exists to match the accumulators fact match criteria</span></div><div id="t1527705572000367" t="2018-05-30 18:39:32 mikerod default  :initial-value  is  nil , so the default would not be true, however  acc/count  initializes to  0 , so a condition that uses it will be satisfied when no facts match the condition."><a href="#t1527705572000367" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-30</span> <span class="t" onclick="H(this)">18:39:32</span>                 mikerod </span><span>default </span><code>:initial-value</code><span> is </span><code>nil</code><span>, so the default would not be true, however </span><code>acc/count</code><span> initializes to </span><code>0</code><span>, so a condition that uses it will be satisfied when no facts match the condition.</span></div><div id="t1527705612000090" t="2018-05-30 18:40:12 mikerod e.g.  [?count &lt;- (acc/count) :from [NoMatchEver]]  would bind  ?count  to  0  and the condition would be satisfied."><a href="#t1527705612000090" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-30</span> <span class="t" onclick="H(this)">18:40:12</span>                 mikerod </span><span>e.g. </span><code>[?count &lt;- (acc/count) :from [NoMatchEver]]</code><span> would bind </span><code>?count</code><span> to </span><code>0</code><span> and the condition would be satisfied.</span></div><div id="t1527705615000330" t="2018-05-30 18:40:15 jdt I definitely had a  [?x &lt;- (acc/count ...)]   that was not being successful, or at least a [:test (do (prn ...) true) ] following that accum condition was not printed, but perhaps they&apos;re not evaluated sequentially.  My rule definitely wasn&apos;t firing, but again I no longer have the code to reason about it."><a href="#t1527705615000330" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-30</span> <span class="t" onclick="H(this)">18:40:15</span>                     jdt </span><span>I definitely had a </span><code>[?x &lt;- (acc/count ...)]</code><span>  that was not being successful, or at least a [:test (do (prn ...) true) ] following that accum condition was not printed, but perhaps they&apos;re not evaluated sequentially.  My rule definitely wasn&apos;t firing, but again I no longer have the code to reason about it.</span></div><div id="t1527705660000145" t="2018-05-30 18:41:00 mikerod weird, I’d have to see it"><a href="#t1527705660000145" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-30</span> <span class="t" onclick="H(this)">18:41:00</span>                 mikerod </span><span>weird, I’d have to see it</span></div><div id="t1527771971000222" t="2018-05-31 13:06:11 wparker @dave.tenny perhaps your example created new bindings, in that case Clara’s accumulators won’t fire without facts even given an initial value.  i.e. for [?result &lt;- (acc/all) :from [Fact (= ?a a)]] if ?a isn’t created elsewhere you need facts to give ?a a meaning so the accumulator won’t fire without them.  This is in the accumulator docs pages I posted before IIRC, I think there are some examples in the clara-examples project too"><a href="#t1527771971000222" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-31</span> <span class="t" onclick="H(this)">13:06:11</span>                 wparker </span><span>@dave.tenny perhaps your example created new bindings, in that case Clara’s accumulators won’t fire without facts even given an initial value.  i.e. for [?result &lt;- (acc/all) :from [Fact (= ?a a)]] if ?a isn’t created elsewhere you need facts to give ?a a meaning so the accumulator won’t fire without them.  This is in the accumulator docs pages I posted before IIRC, I think there are some examples in the clara-examples project too</span></div><div id="t1527772175000067" t="2018-05-31 13:09:35 mikerod @wparker I forgot that that was ever changed. I thought they still fire always even without a binding"><a href="#t1527772175000067" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-31</span> <span class="t" onclick="H(this)">13:09:35</span>                 mikerod </span><span>@wparker I forgot that that was ever changed. I thought they still fire always even without a binding</span></div><div id="t1527772182000554" t="2018-05-31 13:09:42 mikerod I see what you are saying in the docs though"><a href="#t1527772182000554" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-31</span> <span class="t" onclick="H(this)">13:09:42</span>                 mikerod </span><span>I see what you are saying in the docs though</span></div><div id="t1527772583000425" t="2018-05-31 13:16:23 wparker I can find it in the history later"><a href="#t1527772583000425" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-31</span> <span class="t" onclick="H(this)">13:16:23</span>                 wparker </span><span>I can find it in the history later</span></div><div id="t1527772681000528" t="2018-05-31 13:18:01 wparker note that only applies if the binding in question is new though - if a previous condition creates it the accumulator will still fire with the initial value"><a href="#t1527772681000528" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-31</span> <span class="t" onclick="H(this)">13:18:01</span>                 wparker </span><span>note that only applies if the binding in question is new though - if a previous condition creates it the accumulator will still fire with the initial value</span></div><div id="t1527772722000170" t="2018-05-31 13:18:42 wparker It is a bit confusing.. but otherwise IMO you end up with bindings that don’t make much logical sense"><a href="#t1527772722000170" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-31</span> <span class="t" onclick="H(this)">13:18:42</span>                 wparker </span><span>It is a bit confusing.. but otherwise IMO you end up with bindings that don’t make much logical sense</span></div><div id="t1527773122000551" t="2018-05-31 13:25:22 mikerod Yep, thanks for clarifying"><a href="#t1527773122000551" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-31</span> <span class="t" onclick="H(this)">13:25:22</span>                 mikerod </span><span>Yep, thanks for clarifying</span></div><div id="t1527787448000516" t="2018-05-31 17:24:08 wparker Looks like the work was done under  https://github.com/cerner/clara-rules/issues/102  unfortunately the discussion there is less than simple to understand.  PRs  https://github.com/cerner/clara-rules/pull/204   https://github.com/cerner/clara-rules/pull/208   https://github.com/cerner/clara-rules/pull/210"><a href="#t1527787448000516" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-05-31</span> <span class="t" onclick="H(this)">17:24:08</span>                 wparker </span><span>Looks like the work was done under </span><a href="https://github.com/cerner/clara-rules/issues/102" target="_blank">https://github.com/cerner/clara-rules/issues/102</a><span> unfortunately the discussion there is less than simple to understand.  PRs </span><a href="https://github.com/cerner/clara-rules/pull/204" target="_blank">https://github.com/cerner/clara-rules/pull/204</a><span> </span><a href="https://github.com/cerner/clara-rules/pull/208" target="_blank">https://github.com/cerner/clara-rules/pull/208</a><span> </span><a href="https://github.com/cerner/clara-rules/pull/210" target="_blank">https://github.com/cerner/clara-rules/pull/210</a></div><div id="t1527869375000722" t="2018-06-01 16:09:35 jdt So thanks to all for the help so far, but unless I can solve this &quot;if some fact insert this other fact ONCE&quot; problem I&apos;m about ready to throw in the towel.  It&apos;s really like I want each rule firing to be sensitive to the prior rule firings in a single call to (fire-rules), but that isn&apos;t what happens."><a href="#t1527869375000722" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-01</span> <span class="t" onclick="H(this)">16:09:35</span>                     jdt </span><span>So thanks to all for the help so far, but unless I can solve this &quot;if some fact insert this other fact ONCE&quot; problem I&apos;m about ready to throw in the towel.  It&apos;s really like I want each rule firing to be sensitive to the prior rule firings in a single call to (fire-rules), but that isn&apos;t what happens.</span></div><div id="t1527869570000365" t="2018-06-01 16:12:50 zylox you absoultely are fighting the engine if you do an insert-unconditional based on an inference, but still want logical retractions. Why are you using unconditional again? i havent followed all the conversations."><a href="#t1527869570000365" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-01</span> <span class="t" onclick="H(this)">16:12:50</span>                   zylox </span><span>you absoultely are fighting the engine if you do an insert-unconditional based on an inference, but still want logical retractions. Why are you using unconditional again? i havent followed all the conversations.</span></div><div id="t1527869606000687" t="2018-06-01 16:13:26 jdt that&apos;s just one way to do it, but it wouldn&apos;t work because that rule is going to fire twice and both firings will NOT see the Derived asserted by the first firing"><a href="#t1527869606000687" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-01</span> <span class="t" onclick="H(this)">16:13:26</span>                     jdt </span><span>that&apos;s just one way to do it, but it wouldn&apos;t work because that rule is going to fire twice and both firings will NOT see the Derived asserted by the first firing</span></div><div id="t1527869625000598" t="2018-06-01 16:13:45 jdt So it&apos;s not even about truth maintenance so much as WHEN the LHS is evaluated"><a href="#t1527869625000598" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-01</span> <span class="t" onclick="H(this)">16:13:45</span>                     jdt </span><span>So it&apos;s not even about truth maintenance so much as WHEN the LHS is evaluated</span></div><div id="t1527869640000176" t="2018-06-01 16:14:00 zylox oh..hmm"><a href="#t1527869640000176" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-01</span> <span class="t" onclick="H(this)">16:14:00</span>                   zylox </span><span>oh..hmm</span></div><div id="t1527869735000305" t="2018-06-01 16:15:35 jdt I&apos;m open to any reasonable way to do it, but given LHS matching those two facts I inserted, the result needs to be ONE derived."><a href="#t1527869735000305" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-01</span> <span class="t" onclick="H(this)">16:15:35</span>                     jdt </span><span>I&apos;m open to any reasonable way to do it, but given LHS matching those two facts I inserted, the result needs to be ONE derived.</span></div><div id="t1527869743000064" t="2018-06-01 16:15:43 zylox I guess i dont understand why you need it only inserted once and not that the final state is one in the session."><a href="#t1527869743000064" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-01</span> <span class="t" onclick="H(this)">16:15:43</span>                   zylox </span><span>I guess i dont understand why you need it only inserted once and not that the final state is one in the session.</span></div><div id="t1527869759000790" t="2018-06-01 16:15:59 zylox because you are going to absolutely end up with two if you are using unconditional"><a href="#t1527869759000790" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-01</span> <span class="t" onclick="H(this)">16:15:59</span>                   zylox </span><span>because you are going to absolutely end up with two if you are using unconditional</span></div><div id="t1527869783000579" t="2018-06-01 16:16:23 jdt Maybe all I need to do is replace the [Fact (= ?ftype ftype)] with use of an accumulator and predicate to express the &quot;if there is some&quot;, and fire the rule once, haven&apos;t tried that"><a href="#t1527869783000579" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-01</span> <span class="t" onclick="H(this)">16:16:23</span>                     jdt </span><span>Maybe all I need to do is replace the [Fact (= ?ftype ftype)] with use of an accumulator and predicate to express the &quot;if there is some&quot;, and fire the rule once, haven&apos;t tried that</span></div><div id="t1527869809000175" t="2018-06-01 16:16:49 jdt Can you give a sample of the merge logic?"><a href="#t1527869809000175" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-01</span> <span class="t" onclick="H(this)">16:16:49</span>                     jdt </span><span>Can you give a sample of the merge logic?</span></div><div id="t1527869822000744" t="2018-06-01 16:17:02 jdt Oops, I see you did, I think"><a href="#t1527869822000744" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-01</span> <span class="t" onclick="H(this)">16:17:02</span>                     jdt </span><span>Oops, I see you did, I think</span></div><div id="t1527869825000573" t="2018-06-01 16:17:05 mikerod the rules don’t assume what a “duplicate” means to you or what you want to do with them. You need an extra rule to configure that yourself."><a href="#t1527869825000573" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-01</span> <span class="t" onclick="H(this)">16:17:05</span>                 mikerod </span><span>the rules don’t assume what a “duplicate” means to you or what you want to do with them. You need an extra rule to configure that yourself.</span></div><div id="t1527869843000209" t="2018-06-01 16:17:23 mikerod Example, Maybe you wanted to know how many duplicates you had"><a href="#t1527869843000209" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-01</span> <span class="t" onclick="H(this)">16:17:23</span>                 mikerod </span><span>Example, Maybe you wanted to know how many duplicates you had</span></div><div id="t1527869860000526" t="2018-06-01 16:17:40 mikerod you could then have  (defrecord Derived [ftype matches-count])"><a href="#t1527869860000526" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-01</span> <span class="t" onclick="H(this)">16:17:40</span>                 mikerod </span><span>you could then have </span><code>(defrecord Derived [ftype matches-count])</code></div><div id="t1527869884000491" t="2018-06-01 16:18:04 mikerod Then 
 (defrule merge-derived
  [?all &lt;- (acc/all) :from [::derived-intermediate (= ?ftype (-&gt; this :derived :ftype))]]
  =&gt;
;; Merging to one, but include the count of the &quot;duplicates&quot; for whatever reason
  (insert! (-&gt; ?all first :derived (assoc :matches-count (count ?all))))

"><a href="#t1527869884000491" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-01</span> <span class="t" onclick="H(this)">16:18:04</span>                 mikerod </span><span>Then 
</span><pre>(defrule merge-derived
  [?all &lt;- (acc/all) :from [::derived-intermediate (= ?ftype (-&gt; this :derived :ftype))]]
  =&gt;
;; Merging to one, but include the count of the &quot;duplicates&quot; for whatever reason
  (insert! (-&gt; ?all first :derived (assoc :matches-count (count ?all))))

</pre></div><div id="t1527869930000617" t="2018-06-01 16:18:50 jdt ok, digesting this, back to drawing board"><a href="#t1527869930000617" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-01</span> <span class="t" onclick="H(this)">16:18:50</span>                     jdt </span><span>ok, digesting this, back to drawing board</span></div><div id="t1527872558000165" t="2018-06-01 17:02:38 mikerod @dave.tenny Yep, I don’t see a reason for it there"><a href="#t1527872558000165" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-01</span> <span class="t" onclick="H(this)">17:02:38</span>                 mikerod </span><span>@dave.tenny Yep, I don’t see a reason for it there</span></div><div id="t1527872566000726" t="2018-06-01 17:02:46 mikerod I didn’t use it in the  merge-derived  rule either"><a href="#t1527872566000726" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-01</span> <span class="t" onclick="H(this)">17:02:46</span>                 mikerod </span><span>I didn’t use it in the </span><code>merge-derived</code><span> rule either</span></div><div id="t1527876865000130" t="2018-06-01 18:14:25 jdt That use of  with-meta  and  :type  is interesting to know about when doing  type  based dispatches."><a href="#t1527876865000130" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-01</span> <span class="t" onclick="H(this)">18:14:25</span>                     jdt </span><span>That use of </span><code>with-meta</code><span> and </span><code>:type</code><span> is interesting to know about when doing </span><code>type</code><span> based dispatches.</span></div><div id="t1527876876000020" t="2018-06-01 18:14:36 jdt Interesting tip"><a href="#t1527876876000020" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-01</span> <span class="t" onclick="H(this)">18:14:36</span>                     jdt </span><span>Interesting tip</span></div><div id="t1527877746000557" t="2018-06-01 18:29:06 jdt Anbody got an emacs cider clojure mode switch to adjust LHS condition indentation?  My clauses don&apos;t seem to want to indent to the level of the prior clause."><a href="#t1527877746000557" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-01</span> <span class="t" onclick="H(this)">18:29:06</span>                     jdt </span><span>Anbody got an emacs cider clojure mode switch to adjust LHS condition indentation?  My clauses don&apos;t seem to want to indent to the level of the prior clause.</span></div><div id="t1527877765000615" t="2018-06-01 18:29:25 jdt Rather, bindings/predicates, not the clauses."><a href="#t1527877765000615" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-01</span> <span class="t" onclick="H(this)">18:29:25</span>                     jdt </span><span>Rather, bindings/predicates, not the clauses.</span></div><div id="t1527881591000524" t="2018-06-01 19:33:11 mikerod I don’t have special indentation rules"><a href="#t1527881591000524" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-01</span> <span class="t" onclick="H(this)">19:33:11</span>                 mikerod </span><span>I don’t have special indentation rules</span></div><div id="t1527881600000335" t="2018-06-01 19:33:20 mikerod it indents less than ideal for vectors I’d say"><a href="#t1527881600000335" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-01</span> <span class="t" onclick="H(this)">19:33:20</span>                 mikerod </span><span>it indents less than ideal for vectors I’d say</span></div><div id="t1527881605000424" t="2018-06-01 19:33:25 mikerod I’ve mostly just let it happen"><a href="#t1527881605000424" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-01</span> <span class="t" onclick="H(this)">19:33:25</span>                 mikerod </span><span>I’ve mostly just let it happen</span></div><div id="t1527889823000331" t="2018-06-01 21:50:23 mikerod @dave.tenny I agree it isn’t ideal"><a href="#t1527889823000331" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-01</span> <span class="t" onclick="H(this)">21:50:23</span>                 mikerod </span><span>@dave.tenny I agree it isn’t ideal</span></div><div id="t1527889851000140" t="2018-06-01 21:50:51 mikerod for multiline, I typically go with:
 [WorkerViableJob 
    (= ?user-id user-id)
    (= ?job-type job-type)]
"><a href="#t1527889851000140" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-01</span> <span class="t" onclick="H(this)">21:50:51</span>                 mikerod </span><span>for multiline, I typically go with:
</span><pre>[WorkerViableJob 
    (= ?user-id user-id)
    (= ?job-type job-type)]
</pre></div><div id="t1527890756000111" t="2018-06-01 22:05:56 alex-dixon Clojure in general I find it helps to just give up on making lines short"><a href="#t1527890756000111" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-01</span> <span class="t" onclick="H(this)">22:05:56</span>              alex-dixon </span><span>Clojure in general I find it helps to just give up on making lines short</span></div><div id="t1527890887000196" t="2018-06-01 22:08:07 alex-dixon Most rules I’ve written have positional syntax so everything on one line works well…joins typically line up nicely. In Clara I’d probably do the same for the same reason…try to group things vertically by joins"><a href="#t1527890887000196" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-01</span> <span class="t" onclick="H(this)">22:08:07</span>              alex-dixon </span><span>Most rules I’ve written have positional syntax so everything on one line works well…joins typically line up nicely. In Clara I’d probably do the same for the same reason…try to group things vertically by joins</span></div><div id="t1527948335000008" t="2018-06-02 14:05:35 alex-dixon @mikerod Regarding datalog syntax for Clara: Would you want it to be schema based? The implementation I have only enforces a datomic schema’s cardinality and uniqueness … nothing related to types. It enables upsert behavior, which may or may not be desirable for Clara users. Cardinality and uniqueness indices are checked and updated before inserting or retracting facts (within the insert/retract functions), and if anything should be upserted then the appropriate retracts and inserts are made. Only one to one facts are indexed at this time, since there’s no uniqueness or cardinality enforcement that applies to one to many. Overall I tried to follow Datomic’s semantics on this:  https://docs.datomic.com/on-prem/schema.html#operational-schema-attributes ,  https://docs.datomic.com/on-prem/schema.html#required-schema-attributes . If a fact is not mentioned in a schema it defaults to one to one cardinality. I think that could be changed easily if you wanted…the idea there was facts are typically one to one for UI and we didn’t want to force users type out cardinality for every fact."><a href="#t1527948335000008" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-02</span> <span class="t" onclick="H(this)">14:05:35</span>              alex-dixon </span><span>@mikerod Regarding datalog syntax for Clara: Would you want it to be schema based? The implementation I have only enforces a datomic schema’s cardinality and uniqueness … nothing related to types. It enables upsert behavior, which may or may not be desirable for Clara users. Cardinality and uniqueness indices are checked and updated before inserting or retracting facts (within the insert/retract functions), and if anything should be upserted then the appropriate retracts and inserts are made. Only one to one facts are indexed at this time, since there’s no uniqueness or cardinality enforcement that applies to one to many. Overall I tried to follow Datomic’s semantics on this: </span><a href="https://docs.datomic.com/on-prem/schema.html#operational-schema-attributes" target="_blank">https://docs.datomic.com/on-prem/schema.html#operational-schema-attributes</a><span>, </span><a href="https://docs.datomic.com/on-prem/schema.html#required-schema-attributes" target="_blank">https://docs.datomic.com/on-prem/schema.html#required-schema-attributes</a><span>. If a fact is not mentioned in a schema it defaults to one to one cardinality. I think that could be changed easily if you wanted…the idea there was facts are typically one to one for UI and we didn’t want to force users type out cardinality for every fact.</span></div><div id="t1527948817000039" t="2018-06-02 14:13:37 alex-dixon This would affect the implementation at the session-ish level. None of this has to be part of a LocalSession and I don’t think it should be, but I’m toying with a LocalDatalogSession that takes a LocalSession and “indexes” argument so the indexes can travel with a session. It should be possible to use with insert/retract per the normal api (`(-&gt; session (insert facts) (fire-rules))`) though the insert/retract functions would need be datalog specific (`(clara.rules.datalog/insert)`) if enforcing a schema the way I described"><a href="#t1527948817000039" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-02</span> <span class="t" onclick="H(this)">14:13:37</span>              alex-dixon </span><span>This would affect the implementation at the session-ish level. None of this has to be part of a LocalSession and I don’t think it should be, but I’m toying with a LocalDatalogSession that takes a LocalSession and “indexes” argument so the indexes can travel with a session. It should be possible to use with insert/retract per the normal api (`(-&gt; session (insert facts) (fire-rules))`) though the insert/retract functions would need be datalog specific (`(clara.rules.datalog/insert)`) if enforcing a schema the way I described</span></div><div id="t1528117815000673" t="2018-06-04 13:10:15 mikerod @alex-dixon that’s interesting. When I’ve mentioned support for the datalog syntax before, I was only thinking of it at a syntactic level - like an alternative DSL. The one thing I wasn’t sure of in that was how the fact-type-fn would work (what would it be?).
It sounds like you’re considering an approach that is a bit more integrated with the semantics of these structures. That may be a reasonable thing to do. I haven’t worked with this sort of thing enough to have any big insight. What you describe above seems like something that may be useful and reasonable to me."><a href="#t1528117815000673" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-04</span> <span class="t" onclick="H(this)">13:10:15</span>                 mikerod </span><span>@alex-dixon that’s interesting. When I’ve mentioned support for the datalog syntax before, I was only thinking of it at a syntactic level - like an alternative DSL. The one thing I wasn’t sure of in that was how the fact-type-fn would work (what would it be?).
It sounds like you’re considering an approach that is a bit more integrated with the semantics of these structures. That may be a reasonable thing to do. I haven’t worked with this sort of thing enough to have any big insight. What you describe above seems like something that may be useful and reasonable to me.</span></div><div id="t1528123511000333" t="2018-06-04 14:45:11 alex-dixon @mikerod 
&gt; The one thing I wasn’t sure of in that was how the fact-type-fn would work (what would it be?)
Precept uses  :a  with a Tuple record [e a v t] (t is an incremented fact id). We use the clojure’s (derive) to associate cardinality and uniqueness with  :a  keywords. Clara receives the hierarchy via the :ancestors-fn option in order to be able to match on  :all  attributes. Every  :a  descends from  :all  so you can write conditions that will obtain across attributes (e.g. [?e :all 42]). 

The ancestry is also used outside Clara for maintaining e-a-v and a-v-e indexes. When facts are inserted or retracted it lets us determine their cardinality and uniqueness constraints. Based on that and the current indexes we determine whether inserts and retracts should be performed so that the schema can be adhered to, or whether an error should be thrown. 

Over the weekend I worked on a design that doesn’t use global vars for the indexes and ancestors hierarchy. I haven’t figured it out yet. insert! seems like the real challenge. It’s not part of the ISession protocol and only takes facts as arguments.

My best guess is that we should bind a session’s indexes and ancestry to a dynamic var (like session-context) when fire rules is called on it. Then we could read from it from within an  insert!  implementation and update the indexes there. I think that’d require something like a LocalDatalogSession that could take these extra arguments in its constructor."><a href="#t1528123511000333" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-04</span> <span class="t" onclick="H(this)">14:45:11</span>              alex-dixon </span><span>@mikerod 
&gt; The one thing I wasn’t sure of in that was how the fact-type-fn would work (what would it be?)
Precept uses </span><code>:a</code><span> with a Tuple record [e a v t] (t is an incremented fact id). We use the clojure’s (derive) to associate cardinality and uniqueness with </span><code>:a</code><span> keywords. Clara receives the hierarchy via the :ancestors-fn option in order to be able to match on </span><code>:all</code><span> attributes. Every </span><code>:a</code><span> descends from </span><code>:all</code><span> so you can write conditions that will obtain across attributes (e.g. [?e :all 42]). 

The ancestry is also used outside Clara for maintaining e-a-v and a-v-e indexes. When facts are inserted or retracted it lets us determine their cardinality and uniqueness constraints. Based on that and the current indexes we determine whether inserts and retracts should be performed so that the schema can be adhered to, or whether an error should be thrown. 

Over the weekend I worked on a design that doesn’t use global vars for the indexes and ancestors hierarchy. I haven’t figured it out yet. insert! seems like the real challenge. It’s not part of the ISession protocol and only takes facts as arguments.

My best guess is that we should bind a session’s indexes and ancestry to a dynamic var (like session-context) when fire rules is called on it. Then we could read from it from within an </span><code>insert!</code><span> implementation and update the indexes there. I think that’d require something like a LocalDatalogSession that could take these extra arguments in its constructor.</span></div><div id="t1528125073000029" t="2018-06-04 15:11:13 mikerod @alex-dixon this makes sense to me."><a href="#t1528125073000029" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-04</span> <span class="t" onclick="H(this)">15:11:13</span>                 mikerod </span><span>@alex-dixon this makes sense to me.</span></div><div id="t1528125091000598" t="2018-06-04 15:11:31 mikerod I was thinking that the  :a  may be the best fact type too, wasn’t sure. And good point on deriving from  :all"><a href="#t1528125091000598" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-04</span> <span class="t" onclick="H(this)">15:11:31</span>                 mikerod </span><span>I was thinking that the </span><code>:a</code><span> may be the best fact type too, wasn’t sure. And good point on deriving from </span><code>:all</code></div><div id="t1528203423000462" t="2018-06-05 12:57:03 jdt Any tips on analyzing where I&apos;m spending time in rules? (for example, which rules)."><a href="#t1528203423000462" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-05</span> <span class="t" onclick="H(this)">12:57:03</span>                     jdt </span><span>Any tips on analyzing where I&apos;m spending time in rules? (for example, which rules).</span></div><div id="t1528204208000063" t="2018-06-05 13:10:08 mikerod @dave.tenny should be possible to use Clara tracing to take a look at something like that. Although it’s exploratory to find what you want given the data structures it returns. You could get something like count of times things were evaluated that way. "><a href="#t1528204208000063" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-05</span> <span class="t" onclick="H(this)">13:10:08</span>                 mikerod </span><span>@dave.tenny should be possible to use Clara tracing to take a look at something like that. Although it’s exploratory to find what you want given the data structures it returns. You could get something like count of times things were evaluated that way. </span></div><div id="t1528204247000618" t="2018-06-05 13:10:47 mikerod It’d be nice if Clara had more supporting functions for this purpose though. "><a href="#t1528204247000618" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-05</span> <span class="t" onclick="H(this)">13:10:47</span>                 mikerod </span><span>It’d be nice if Clara had more supporting functions for this purpose though. </span></div><div id="t1528204437000417" t="2018-06-05 13:13:57 jdt There are some minimum number of queries in addition to the above rules."><a href="#t1528204437000417" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-05</span> <span class="t" onclick="H(this)">13:13:57</span>                     jdt </span><span>There are some minimum number of queries in addition to the above rules.</span></div><div id="t1528204596000344" t="2018-06-05 13:16:36 jdt Between each  fire-rules  the dispatcher will select one job per job type (so 15 in this numbers case), dispatch it, update the ActiveUserJobCount, WorkerResource, facts, and retract the dispatched JobRequest facts."><a href="#t1528204596000344" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-05</span> <span class="t" onclick="H(this)">13:16:36</span>                     jdt </span><span>Between each </span><code>fire-rules</code><span> the dispatcher will select one job per job type (so 15 in this numbers case), dispatch it, update the ActiveUserJobCount, WorkerResource, facts, and retract the dispatched JobRequest facts.</span></div><div id="t1528204630000607" t="2018-06-05 13:17:10 jdt So I&apos;m averaging about 1-3 seconds per job dispatch, and whacking the hell out of my CPU.  (Memory footprint is good however... surprise!)"><a href="#t1528204630000607" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-05</span> <span class="t" onclick="H(this)">13:17:10</span>                     jdt </span><span>So I&apos;m averaging about 1-3 seconds per job dispatch, and whacking the hell out of my CPU.  (Memory footprint is good however... surprise!)</span></div><div id="t1528205015000768" t="2018-06-05 13:23:35 jdt I had originally hoped to do the fact maintenance for active user job counts (used for round robin eligibility consideration), and worker resource stats (to track remaining worker capacity), in the RHS of rules.  But I gave that up early in the process because it was a side-effect oriented process with a bunch of  [:not A] =&gt; A  scenarios, which might have been doable, but it was really the timing of the rule LHS evaluations that killed it, since LHS evaluations are perceptually &quot;in parallel&quot; and not sequential with respect to cause and effect for a given rule."><a href="#t1528205015000768" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-05</span> <span class="t" onclick="H(this)">13:23:35</span>                     jdt </span><span>I had originally hoped to do the fact maintenance for active user job counts (used for round robin eligibility consideration), and worker resource stats (to track remaining worker capacity), in the RHS of rules.  But I gave that up early in the process because it was a side-effect oriented process with a bunch of </span><code>[:not A] =&gt; A</code><span> scenarios, which might have been doable, but it was really the timing of the rule LHS evaluations that killed it, since LHS evaluations are perceptually &quot;in parallel&quot; and not sequential with respect to cause and effect for a given rule.</span></div><div id="t1528205080000557" t="2018-06-05 13:24:40 jdt So I compute some eligible things, then do the dispatching and accounting between calls to  fire-rules , then do it all over again (always saving and continuing from the updated session)."><a href="#t1528205080000557" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-05</span> <span class="t" onclick="H(this)">13:24:40</span>                     jdt </span><span>So I compute some eligible things, then do the dispatching and accounting between calls to </span><code>fire-rules</code><span>, then do it all over again (always saving and continuing from the updated session).</span></div><div id="t1528206241000390" t="2018-06-05 13:44:01 mikerod &gt;  but it was really the timing of the rule LHS evaluations that killed it, since LHS evaluations are perceptually “in parallel” and not sequential with respect to cause and effect for a given rule.
Only the case for  insert-unconditional!  (and possibly even a defect), but yeah. if you have to extract these facts after they are “done” it may make most sense to be an external thing anyways."><a href="#t1528206241000390" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-05</span> <span class="t" onclick="H(this)">13:44:01</span>                 mikerod </span><span>&gt;  but it was really the timing of the rule LHS evaluations that killed it, since LHS evaluations are perceptually “in parallel” and not sequential with respect to cause and effect for a given rule.
Only the case for </span><code>insert-unconditional!</code><span> (and possibly even a defect), but yeah. if you have to extract these facts after they are “done” it may make most sense to be an external thing anyways.</span></div><div id="t1528206266000802" t="2018-06-05 13:44:26 mikerod @dave.tenny I can look at your rules from above some, sounds too slow"><a href="#t1528206266000802" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-05</span> <span class="t" onclick="H(this)">13:44:26</span>                 mikerod </span><span>@dave.tenny I can look at your rules from above some, sounds too slow</span></div><div id="t1528206315000190" t="2018-06-05 13:45:15 jdt Happy to share the whole module, nothing but some pretty rules and ugly code to do the bookkeeping and setup mock data and such"><a href="#t1528206315000190" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-05</span> <span class="t" onclick="H(this)">13:45:15</span>                     jdt </span><span>Happy to share the whole module, nothing but some pretty rules and ugly code to do the bookkeeping and setup mock data and such</span></div><div id="t1528206365000802" t="2018-06-05 13:46:05 mikerod when something takes long in that range of seconds (like 10+) I tend to do a cpu sampling"><a href="#t1528206365000802" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-05</span> <span class="t" onclick="H(this)">13:46:05</span>                 mikerod </span><span>when something takes long in that range of seconds (like 10+) I tend to do a cpu sampling</span></div><div id="t1528206369000395" t="2018-06-05 13:46:09 jdt Job dispatch and completion is all about accounting then trying again with updated rules."><a href="#t1528206369000395" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-05</span> <span class="t" onclick="H(this)">13:46:09</span>                     jdt </span><span>Job dispatch and completion is all about accounting then trying again with updated rules.</span></div><div id="t1528206380000497" t="2018-06-05 13:46:20 mikerod With a profiler, I tend to use visualVM because it is good enough for this situation"><a href="#t1528206380000497" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-05</span> <span class="t" onclick="H(this)">13:46:20</span>                 mikerod </span><span>With a profiler, I tend to use visualVM because it is good enough for this situation</span></div><div id="t1528206407000436" t="2018-06-05 13:46:47 mikerod sometimes it gives quicker leads to what is causing issues. Sometimes it is too opaque unless you know the rule engine internals, but not necessarily always"><a href="#t1528206407000436" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-05</span> <span class="t" onclick="H(this)">13:46:47</span>                 mikerod </span><span>sometimes it gives quicker leads to what is causing issues. Sometimes it is too opaque unless you know the rule engine internals, but not necessarily always</span></div><div id="t1528206417000131" t="2018-06-05 13:46:57 jdt Yeah, I&apos;m having problems with VisualVM on my Linux system becuase of some JNI/Jar problem I can&apos;t figure out, and HPROF sampling is usually useless"><a href="#t1528206417000131" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-05</span> <span class="t" onclick="H(this)">13:46:57</span>                     jdt </span><span>Yeah, I&apos;m having problems with VisualVM on my Linux system becuase of some JNI/Jar problem I can&apos;t figure out, and HPROF sampling is usually useless</span></div><div id="t1528206431000071" t="2018-06-05 13:47:11 mikerod but also, doing some just blunt counting of times that certain conditions in rules and/or rule RHS were fired sometimes can give you the outliers as well"><a href="#t1528206431000071" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-05</span> <span class="t" onclick="H(this)">13:47:11</span>                 mikerod </span><span>but also, doing some just blunt counting of times that certain conditions in rules and/or rule RHS were fired sometimes can give you the outliers as well</span></div><div id="t1528206444000872" t="2018-06-05 13:47:24 mikerod Hmm"><a href="#t1528206444000872" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-05</span> <span class="t" onclick="H(this)">13:47:24</span>                 mikerod </span><span>Hmm</span></div><div id="t1528206458000245" t="2018-06-05 13:47:38 mikerod Yeah, VisualVM with “cpu sampler” is what I have used. if things are whacky there, not sure hah"><a href="#t1528206458000245" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-05</span> <span class="t" onclick="H(this)">13:47:38</span>                 mikerod </span><span>Yeah, VisualVM with “cpu sampler” is what I have used. if things are whacky there, not sure hah</span></div><div id="t1528206460000066" t="2018-06-05 13:47:40 jdt Yeah, I&apos;m looking at instrumenting, is it possible to capture the time spent, via instrumentation, in each LHS condition?"><a href="#t1528206460000066" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-05</span> <span class="t" onclick="H(this)">13:47:40</span>                     jdt </span><span>Yeah, I&apos;m looking at instrumenting, is it possible to capture the time spent, via instrumentation, in each LHS condition?</span></div><div id="t1528206478000663" t="2018-06-05 13:47:58 mikerod well, time will obviously go to the instrumentation/tracing you do"><a href="#t1528206478000663" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-05</span> <span class="t" onclick="H(this)">13:47:58</span>                 mikerod </span><span>well, time will obviously go to the instrumentation/tracing you do</span></div><div id="t1528206485000082" t="2018-06-05 13:48:05 mikerod but if you do something like just gather counts"><a href="#t1528206485000082" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-05</span> <span class="t" onclick="H(this)">13:48:05</span>                 mikerod </span><span>but if you do something like just gather counts</span></div><div id="t1528206491000591" t="2018-06-05 13:48:11 mikerod that is not time-sensitive anyways"><a href="#t1528206491000591" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-05</span> <span class="t" onclick="H(this)">13:48:11</span>                 mikerod </span><span>that is not time-sensitive anyways</span></div><div id="t1528206515000387" t="2018-06-05 13:48:35 jdt Re the rules, any obvious stupid hash-join failures or things that might be better done in predicates or with accumulators?"><a href="#t1528206515000387" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-05</span> <span class="t" onclick="H(this)">13:48:35</span>                     jdt </span><span>Re the rules, any obvious stupid hash-join failures or things that might be better done in predicates or with accumulators?</span></div><div id="t1528206516000248" t="2018-06-05 13:48:36 mikerod when I’ve tried “counting condition/rhs” firings before in bad performance cases, there are often outliers"><a href="#t1528206516000248" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-05</span> <span class="t" onclick="H(this)">13:48:36</span>                 mikerod </span><span>when I’ve tried “counting condition/rhs” firings before in bad performance cases, there are often outliers</span></div><div id="t1528206528000825" t="2018-06-05 13:48:48 mikerod Like most things evaluation perhaps no more than 1k times for example"><a href="#t1528206528000825" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-05</span> <span class="t" onclick="H(this)">13:48:48</span>                 mikerod </span><span>Like most things evaluation perhaps no more than 1k times for example</span></div><div id="t1528206536000575" t="2018-06-05 13:48:56 mikerod but then you find something that evaluates like 1 mil times"><a href="#t1528206536000575" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-05</span> <span class="t" onclick="H(this)">13:48:56</span>                 mikerod </span><span>but then you find something that evaluates like 1 mil times</span></div><div id="t1528206546000265" t="2018-06-05 13:49:06 mikerod typically its something like that"><a href="#t1528206546000265" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-05</span> <span class="t" onclick="H(this)">13:49:06</span>                 mikerod </span><span>typically its something like that</span></div><div id="t1528206556000898" t="2018-06-05 13:49:16 jdt In my case I&apos;m worried it&apos;s the tests in the conditions that are firing a lot, but I&apos;ll get more data."><a href="#t1528206556000898" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-05</span> <span class="t" onclick="H(this)">13:49:16</span>                     jdt </span><span>In my case I&apos;m worried it&apos;s the tests in the conditions that are firing a lot, but I&apos;ll get more data.</span></div><div id="t1528206595000400" t="2018-06-05 13:49:55 mikerod So even your rule like  worker-viable-jobs  may be pretty heavy"><a href="#t1528206595000400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-05</span> <span class="t" onclick="H(this)">13:49:55</span>                 mikerod </span><span>So even your rule like </span><code>worker-viable-jobs</code><span> may be pretty heavy</span></div><div id="t1528206606000242" t="2018-06-05 13:50:06 mikerod I’m just looking over what you had and your sort of fact counts"><a href="#t1528206606000242" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-05</span> <span class="t" onclick="H(this)">13:50:06</span>                 mikerod </span><span>I’m just looking over what you had and your sort of fact counts</span></div><div id="t1528206617000934" t="2018-06-05 13:50:17 jdt For example, if I&apos;m doing N^2 firings on the worker-viable-jobs conditions for the 100k job requests and 45 worker-resource facts."><a href="#t1528206617000934" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-05</span> <span class="t" onclick="H(this)">13:50:17</span>                     jdt </span><span>For example, if I&apos;m doing N^2 firings on the worker-viable-jobs conditions for the 100k job requests and 45 worker-resource facts.</span></div><div id="t1528206626000083" t="2018-06-05 13:50:26 mikerod you have 100K job requests facts and 45 workers, and you also have a  :not  in that rule"><a href="#t1528206626000083" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-05</span> <span class="t" onclick="H(this)">13:50:26</span>                 mikerod </span><span>you have 100K job requests facts and 45 workers, and you also have a </span><code>:not</code><span> in that rule</span></div><div id="t1528206635000202" t="2018-06-05 13:50:35 mikerod so you are something like 100K x 100K x 45 territory"><a href="#t1528206635000202" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-05</span> <span class="t" onclick="H(this)">13:50:35</span>                 mikerod </span><span>so you are something like 100K x 100K x 45 territory</span></div><div id="t1528206684000080" t="2018-06-05 13:51:24 jdt Right, is there a way to achieve the semantics there without the combinatorics?"><a href="#t1528206684000080" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-05</span> <span class="t" onclick="H(this)">13:51:24</span>                     jdt </span><span>Right, is there a way to achieve the semantics there without the combinatorics?</span></div><div id="t1528206694000842" t="2018-06-05 13:51:34 mikerod probably just doing millions of comparisons with clj  =  and  &lt;  etc and it adds up"><a href="#t1528206694000842" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-05</span> <span class="t" onclick="H(this)">13:51:34</span>                 mikerod </span><span>probably just doing millions of comparisons with clj </span><code>=</code><span> and </span><code>&lt;</code><span> etc and it adds up</span></div><div id="t1528206703000324" t="2018-06-05 13:51:43 mikerod yes, I think there is a way out of it"><a href="#t1528206703000324" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-05</span> <span class="t" onclick="H(this)">13:51:43</span>                 mikerod </span><span>yes, I think there is a way out of it</span></div><div id="t1528206738000375" t="2018-06-05 13:52:18 jdt This is where, if I could update the worker resources in the RHS and immediately prune the possibilities for the next firing of worker-viable-job it would have been a win, but that doesn&apos;t work because all the worker-viable-jobs are going to fire regardless of whether I update the worker resources because of that seemingly parallel LHS evaluation protocol."><a href="#t1528206738000375" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-05</span> <span class="t" onclick="H(this)">13:52:18</span>                     jdt </span><span>This is where, if I could update the worker resources in the RHS and immediately prune the possibilities for the next firing of worker-viable-job it would have been a win, but that doesn&apos;t work because all the worker-viable-jobs are going to fire regardless of whether I update the worker resources because of that seemingly parallel LHS evaluation protocol.</span></div><div id="t1528206765000452" t="2018-06-05 13:52:45 mikerod Extract a rule, find the oldest jobs first, then only bring those into the join with  WorkerResource  rule here"><a href="#t1528206765000452" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-05</span> <span class="t" onclick="H(this)">13:52:45</span>                 mikerod </span><span>Extract a rule, find the oldest jobs first, then only bring those into the join with </span><code>WorkerResource</code><span> rule here</span></div><div id="t1528206801000179" t="2018-06-05 13:53:21 mikerod in general, you have a lot of  JobRequest  facts to deal with. You want to avoid any rule that may do a join across that set of facts with itself"><a href="#t1528206801000179" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-05</span> <span class="t" onclick="H(this)">13:53:21</span>                 mikerod </span><span>in general, you have a lot of </span><code>JobRequest</code><span> facts to deal with. You want to avoid any rule that may do a join across that set of facts with itself</span></div><div id="t1528206821000423" t="2018-06-05 13:53:41 mikerod I’m not sure how  memory  and  thread  factor into an “oldest job” situation"><a href="#t1528206821000423" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-05</span> <span class="t" onclick="H(this)">13:53:41</span>                 mikerod </span><span>I’m not sure how </span><code>memory</code><span> and </span><code>thread</code><span> factor into an “oldest job” situation</span></div><div id="t1528206827000122" t="2018-06-05 13:53:47 mikerod so hard to give you an example"><a href="#t1528206827000122" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-05</span> <span class="t" onclick="H(this)">13:53:47</span>                 mikerod </span><span>so hard to give you an example</span></div><div id="t1528206827000920" t="2018-06-05 13:53:47 jdt Except we&apos;ll still need to potentially consider the next oldest, and so on, until we find one that fits the avaialble worker resources, so does an extra rule really help?"><a href="#t1528206827000920" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-05</span> <span class="t" onclick="H(this)">13:53:47</span>                     jdt </span><span>Except we&apos;ll still need to potentially consider the next oldest, and so on, until we find one that fits the avaialble worker resources, so does an extra rule really help?</span></div><div id="t1528206843000259" t="2018-06-05 13:54:03 mikerod [:not [JobRequest (&lt; job-id ?job-id) 
                    (= ?job-type job-type)
                    (= ?user-id user-id)
                    (&lt;= threads ?threads)
                    (&lt;= memory ?memory)]]
"><a href="#t1528206843000259" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-05</span> <span class="t" onclick="H(this)">13:54:03</span>                 mikerod </span><pre>[:not [JobRequest (&lt; job-id ?job-id) 
                    (= ?job-type job-type)
                    (= ?user-id user-id)
                    (&lt;= threads ?threads)
                    (&lt;= memory ?memory)]]
</pre></div><div id="t1528206861000277" t="2018-06-05 13:54:21 jdt The memory and thread tests are to test only for jobs that can actually execute on the worker resources, i.e. for which enough resources exist."><a href="#t1528206861000277" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-05</span> <span class="t" onclick="H(this)">13:54:21</span>                     jdt </span><span>The memory and thread tests are to test only for jobs that can actually execute on the worker resources, i.e. for which enough resources exist.</span></div><div id="t1528206894000286" t="2018-06-05 13:54:54 jdt That&apos;s the &quot;viable&quot; part of the semantics"><a href="#t1528206894000286" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-05</span> <span class="t" onclick="H(this)">13:54:54</span>                     jdt </span><span>That&apos;s the &quot;viable&quot; part of the semantics</span></div><div id="t1528206901000341" t="2018-06-05 13:55:01 mikerod the rule can help, just have to figure out what the correct rule is"><a href="#t1528206901000341" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-05</span> <span class="t" onclick="H(this)">13:55:01</span>                 mikerod </span><span>the rule can help, just have to figure out what the correct rule is</span></div><div id="t1528206930000246" t="2018-06-05 13:55:30 mikerod thinking about it"><a href="#t1528206930000246" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-05</span> <span class="t" onclick="H(this)">13:55:30</span>                 mikerod </span><span>thinking about it</span></div><div id="t1528206957000461" t="2018-06-05 13:55:57 jdt Any advice for a beginner on how to effectively use the tracing API here?  The one time I tried it there was too much data to process, and that was on the simplest most minimal amount of facts."><a href="#t1528206957000461" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-05</span> <span class="t" onclick="H(this)">13:55:57</span>                     jdt </span><span>Any advice for a beginner on how to effectively use the tracing API here?  The one time I tried it there was too much data to process, and that was on the simplest most minimal amount of facts.</span></div><div id="t1528207033000912" t="2018-06-05 13:57:13 jdt re: the &quot;oldest job&quot; stuff, I was wondering if accumulators would in any way help, I have no idea how they&apos;re implemented w.r..t incremental fact maintenance."><a href="#t1528207033000912" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-05</span> <span class="t" onclick="H(this)">13:57:13</span>                     jdt </span><span>re: the &quot;oldest job&quot; stuff, I was wondering if accumulators would in any way help, I have no idea how they&apos;re implemented w.r..t incremental fact maintenance.</span></div><div id="t1528207888000318" t="2018-06-05 14:11:28 mikerod &gt; Any advice for a beginner on how to effectively use the tracing API here?  The one time I tried it there was too much data to process, and that was on the simplest most minimal amount of facts.
I haven’t used it as much as I’d expect. I was used to rolling my own stuff prior to when tracing stuff was introduced. However, for counting, I believe you can do something like:
 (let [traced (-&gt; (clara.rules/mk-session &lt;your rules&gt;)
                 (clara.tools.tracing/with-tracing)
                 (insert &lt;your facts&gt;)
                 fire-rules
                 clara.tools.tracing/get-trace)]
  (frequencies (map :node-id traced)))
"><a href="#t1528207888000318" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-05</span> <span class="t" onclick="H(this)">14:11:28</span>                 mikerod </span><span>&gt; Any advice for a beginner on how to effectively use the tracing API here?  The one time I tried it there was too much data to process, and that was on the simplest most minimal amount of facts.
I haven’t used it as much as I’d expect. I was used to rolling my own stuff prior to when tracing stuff was introduced. However, for counting, I believe you can do something like:
</span><pre>(let [traced (-&gt; (clara.rules/mk-session &lt;your rules&gt;)
                 (clara.tools.tracing/with-tracing)
                 (insert &lt;your facts&gt;)
                 fire-rules
                 clara.tools.tracing/get-trace)]
  (frequencies (map :node-id traced)))
</pre></div><div id="t1528207970000328" t="2018-06-05 14:12:50 mikerod or perhaps better sorted:
 (let [tr (-&gt; (clara.rules/mk-session [temp-rule])
                                       (t/with-tracing)
                                       (insert (-&gt;Temperature 10 &quot;MCI&quot;)
                                               (-&gt;Temperature 20 &quot;MCI&quot;))
                                       (fire-rules)
                                       (t/get-trace )
                                       )]
                            (-&gt;&gt;  (map :node-id tr)
                                  frequencies
                                  (sort-by val)
                                  reverse))
"><a href="#t1528207970000328" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-05</span> <span class="t" onclick="H(this)">14:12:50</span>                 mikerod </span><span>or perhaps better sorted:
</span><pre>(let [tr (-&gt; (clara.rules/mk-session [temp-rule])
                                       (t/with-tracing)
                                       (insert (-&gt;Temperature 10 &quot;MCI&quot;)
                                               (-&gt;Temperature 20 &quot;MCI&quot;))
                                       (fire-rules)
                                       (t/get-trace )
                                       )]
                            (-&gt;&gt;  (map :node-id tr)
                                  frequencies
                                  (sort-by val)
                                  reverse))
</pre></div><div id="t1528207990000169" t="2018-06-05 14:13:10 mikerod once you know the highest count  :node-id s you can look those up in the rulebase associated with the session"><a href="#t1528207990000169" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-05</span> <span class="t" onclick="H(this)">14:13:10</span>                 mikerod </span><span>once you know the highest count </span><code>:node-id</code><span>s you can look those up in the rulebase associated with the session</span></div><div id="t1528208015000507" t="2018-06-05 14:13:35 jdt excellent, thanks"><a href="#t1528208015000507" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-05</span> <span class="t" onclick="H(this)">14:13:35</span>                     jdt </span><span>excellent, thanks</span></div><div id="t1528208192000604" t="2018-06-05 14:16:32 mikerod (let [session (-&gt; (clara.rules/mk-session &lt;your rules&gt;)
                  (t/with-tracing)
                  (insert &lt;your facts&gt;)
                  (fire-rules))

      trace (t/get-trace session)
      node-id &lt;whatever node id in question from `trace`&gt;


      {:keys [rulebase]} (clara.rules.engine/components session)
      {:keys [id-to-node]} rulebase]
  (get id-to-node node-id) )
 
This is how you could look up the  node-id  to try to find what node in the engine it is"><a href="#t1528208192000604" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-05</span> <span class="t" onclick="H(this)">14:16:32</span>                 mikerod </span><pre>(let [session (-&gt; (clara.rules/mk-session &lt;your rules&gt;)
                  (t/with-tracing)
                  (insert &lt;your facts&gt;)
                  (fire-rules))

      trace (t/get-trace session)
      node-id &lt;whatever node id in question from `trace`&gt;


      {:keys [rulebase]} (clara.rules.engine/components session)
      {:keys [id-to-node]} rulebase]
  (get id-to-node node-id) )
</pre><span>
This is how you could look up the </span><code>node-id</code><span> to try to find what node in the engine it is</span></div><div id="t1528208212000977" t="2018-06-05 14:16:52 mikerod a node will be a defrecord of stuff, not all that readable to you, but you should be able to recognize aspects of it and align it back to your rules typically"><a href="#t1528208212000977" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-05</span> <span class="t" onclick="H(this)">14:16:52</span>                 mikerod </span><span>a node will be a defrecord of stuff, not all that readable to you, but you should be able to recognize aspects of it and align it back to your rules typically</span></div><div id="t1528211353000724" t="2018-06-05 15:09:13 jdt Thanks Mike, I&apos;ll have a look"><a href="#t1528211353000724" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-05</span> <span class="t" onclick="H(this)">15:09:13</span>                     jdt </span><span>Thanks Mike, I&apos;ll have a look</span></div><div id="t1528216685000178" t="2018-06-05 16:38:05 jdt @mikerod as I am still new at accumulators, I&apos;m trying to discern the purpose of the ?user-id binding on line 30 in the above snippet.  Is it used so that the rule will fire once for each distinct user id?  Does it work given that ?user-id is not otherwise bound?"><a href="#t1528216685000178" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-05</span> <span class="t" onclick="H(this)">16:38:05</span>                     jdt </span><span>@mikerod as I am still new at accumulators, I&apos;m trying to discern the purpose of the ?user-id binding on line 30 in the above snippet.  Is it used so that the rule will fire once for each distinct user id?  Does it work given that ?user-id is not otherwise bound?</span></div><div id="t1528217038000679" t="2018-06-05 16:43:58 mikerod @dave.tenny
&gt;  Is it used so that the rule will fire once for each distinct user id?
yes, in that’s its purpose in that example"><a href="#t1528217038000679" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-05</span> <span class="t" onclick="H(this)">16:43:58</span>                 mikerod </span><span>@dave.tenny
&gt;  Is it used so that the rule will fire once for each distinct user id?
yes, in that’s its purpose in that example</span></div><div id="t1528217094000120" t="2018-06-05 16:44:54 mikerod which makes me realize I had a typo there, it should have been  (= ?user-id (-&gt; this :worker-viable-job :user-id))  since it was nested one level lower, will update. Sorry if that caused confusion."><a href="#t1528217094000120" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-05</span> <span class="t" onclick="H(this)">16:44:54</span>                 mikerod </span><span>which makes me realize I had a typo there, it should have been </span><code>(= ?user-id (-&gt; this :worker-viable-job :user-id))</code><span> since it was nested one level lower, will update. Sorry if that caused confusion.</span></div><div id="t1528217203000084" t="2018-06-05 16:46:43 mikerod Accumulators behavior with field-level bindings like that is explained more in  http://www.clara-rules.org/docs/accumulators/"><a href="#t1528217203000084" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-05</span> <span class="t" onclick="H(this)">16:46:43</span>                 mikerod </span><span>Accumulators behavior with field-level bindings like that is explained more in </span><a href="http://www.clara-rules.org/docs/accumulators/" target="_blank">http://www.clara-rules.org/docs/accumulators/</a></div><div id="t1528217585000209" t="2018-06-05 16:53:05 jdt I&apos;m getting null pointer exceptions on calls to  &lt;  that I think are the accumulator, but are maybe something else, unfortunately the stack trace doesn&apos;t not clue me in other than it&apos;s in  (fire-rules) , pretty much.  However the  acc/min  isn&apos;t documented to accept a  :initial-value  argument, so it&apos;s probably something else.  Just in case something obvious is missing above."><a href="#t1528217585000209" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-05</span> <span class="t" onclick="H(this)">16:53:05</span>                     jdt </span><span>I&apos;m getting null pointer exceptions on calls to </span><code>&lt;</code><span> that I think are the accumulator, but are maybe something else, unfortunately the stack trace doesn&apos;t not clue me in other than it&apos;s in </span><code>(fire-rules)</code><span>, pretty much.  However the </span><code>acc/min</code><span> isn&apos;t documented to accept a </span><code>:initial-value</code><span> argument, so it&apos;s probably something else.  Just in case something obvious is missing above.</span></div><div id="t1528217884000116" t="2018-06-05 16:58:04 jdt Ah wait, maybe it&apos;s because I removed an explicit binding of :user-id in the candidate rule."><a href="#t1528217884000116" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-05</span> <span class="t" onclick="H(this)">16:58:04</span>                     jdt </span><span>Ah wait, maybe it&apos;s because I removed an explicit binding of :user-id in the candidate rule.</span></div><div id="t1528217984000614" t="2018-06-05 16:59:44 mikerod @dave.tenny more typo’s because I forgot the thing was neste"><a href="#t1528217984000614" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-05</span> <span class="t" onclick="H(this)">16:59:44</span>                 mikerod </span><span>@dave.tenny more typo’s because I forgot the thing was neste</span></div><div id="t1528218000000378" t="2018-06-05 17:00:00 mikerod (acc/min (comp :job-id :worker-viable-job) :returns-fact true) , I updated the snippet above to reflect that"><a href="#t1528218000000378" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-05</span> <span class="t" onclick="H(this)">17:00:00</span>                 mikerod </span><code>(acc/min (comp :job-id :worker-viable-job) :returns-fact true)</code><span>, I updated the snippet above to reflect that</span></div><div id="t1528218018000060" t="2018-06-05 17:00:18 mikerod if  :job-id  may be  nil  though, would have to defend against it"><a href="#t1528218018000060" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-05</span> <span class="t" onclick="H(this)">17:00:18</span>                 mikerod </span><span>if </span><code>:job-id</code><span> may be </span><code>nil</code><span> though, would have to defend against it</span></div><div id="t1529029502000004" t="2018-06-15 02:25:02 hiredman I&apos;ve just started exploring with Clara, and don&apos;t have a ton of experience with rules systems, and I&apos;ve run into a surprise. When I have a rule something like  [Foo (= x 1)] (not [Foo (= x 2)]) =&gt; (insert! (-&gt;Foo 2))  it goes in to an infinite loop"><a href="#t1529029502000004" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-15</span> <span class="t" onclick="H(this)">02:25:02</span>                hiredman </span><span>I&apos;ve just started exploring with Clara, and don&apos;t have a ton of experience with rules systems, and I&apos;ve run into a surprise. When I have a rule something like </span><code>[Foo (= x 1)] (not [Foo (= x 2)]) =&gt; (insert! (-&gt;Foo 2))</code><span> it goes in to an infinite loop</span></div><div id="t1529032883000075" t="2018-06-15 03:21:23 mikerod @hiredman insert! Is a conditional insert. These inserts are monitored by a “truth maintenance system” (aka TMS). 
The goal of the TMS is to keep all of the rules and their consequences in a logically consistent state"><a href="#t1529032883000075" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-15</span> <span class="t" onclick="H(this)">03:21:23</span>                 mikerod </span><span>@hiredman insert! Is a conditional insert. These inserts are monitored by a “truth maintenance system” (aka TMS). 
The goal of the TMS is to keep all of the rules and their consequences in a logically consistent state</span></div><div id="t1529032897000180" t="2018-06-15 03:21:37 mikerod So the rule you put above is a logical contradiction. "><a href="#t1529032897000180" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-15</span> <span class="t" onclick="H(this)">03:21:37</span>                 mikerod </span><span>So the rule you put above is a logical contradiction. </span></div><div id="t1529032918000074" t="2018-06-15 03:21:58 mikerod There are workarounds. Depending on what it is you are trying to achieve. "><a href="#t1529032918000074" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-15</span> <span class="t" onclick="H(this)">03:21:58</span>                 mikerod </span><span>There are workarounds. Depending on what it is you are trying to achieve. </span></div><div id="t1529032998000123" t="2018-06-15 03:23:18 mikerod Also the TMS is useful to be able to express large numbers of rules in a declarative/non order dependent way. You don’t have to worry about “when something was inserted” to be careful to not check for it “before it was inserted” and that sort of thing. It leads to a less brittle system. "><a href="#t1529032998000123" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-15</span> <span class="t" onclick="H(this)">03:23:18</span>                 mikerod </span><span>Also the TMS is useful to be able to express large numbers of rules in a declarative/non order dependent way. You don’t have to worry about “when something was inserted” to be careful to not check for it “before it was inserted” and that sort of thing. It leads to a less brittle system. </span></div><div id="t1529033030000143" t="2018-06-15 03:23:50 mikerod The concept of a TMS has been around in many of the more modern rule systems. "><a href="#t1529033030000143" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-15</span> <span class="t" onclick="H(this)">03:23:50</span>                 mikerod </span><span>The concept of a TMS has been around in many of the more modern rule systems. </span></div><div id="t1529086510000096" t="2018-06-15 18:15:10 hiredman @mikerod thanks, makes sense, I hadn&apos;t connected those dots"><a href="#t1529086510000096" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-15</span> <span class="t" onclick="H(this)">18:15:10</span>                hiredman </span><span>@mikerod thanks, makes sense, I hadn&apos;t connected those dots</span></div><div id="t1529087074000789" t="2018-06-15 18:24:34 mikerod @hiredman I will say that the engine going into an infinite loop without trying to help isn’t really user-friendly.
The action a rule does on the right-hand side (aka RHS) of the  =&gt;  is arbitrary from the rules engine perspective, so it cannot “know it is in an infinite loop”. However, something could reasonably be added to allow a configurable upper limit on the times you’d allow what may “look like a loop” to be allowed until the engine halted and reported a possible error. For now though, it could be documented as a FAQ or something as well."><a href="#t1529087074000789" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-15</span> <span class="t" onclick="H(this)">18:24:34</span>                 mikerod </span><span>@hiredman I will say that the engine going into an infinite loop without trying to help isn’t really user-friendly.
The action a rule does on the right-hand side (aka RHS) of the </span><code>=&gt;</code><span> is arbitrary from the rules engine perspective, so it cannot “know it is in an infinite loop”. However, something could reasonably be added to allow a configurable upper limit on the times you’d allow what may “look like a loop” to be allowed until the engine halted and reported a possible error. For now though, it could be documented as a FAQ or something as well.</span></div><div id="t1529087094000580" t="2018-06-15 18:24:54 mikerod eg “If the engine seems to be in an infinite loop, this is commonly the cause…”"><a href="#t1529087094000580" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-15</span> <span class="t" onclick="H(this)">18:24:54</span>                 mikerod </span><span>eg “If the engine seems to be in an infinite loop, this is commonly the cause…”</span></div><div id="t1529087393000449" t="2018-06-15 18:29:53 mikerod There are cases that you may think it is hard to see how to not need a rule like you have above. Some of those can actually be tricky to express, but in many cases that I’ve seen, accumulators can be used to achieve the semantics desired, or a new fact type that is used for the derived fact that is different from what is deriving it
eg instead of
 [:not [Foo (= x 2)]] =&gt; (insert! (-&gt;Foo 2))
 
Something like
 [:not [Foo (= x 2)]] =&gt; (insert! (-&gt;DerivedFoo 2))
"><a href="#t1529087393000449" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-15</span> <span class="t" onclick="H(this)">18:29:53</span>                 mikerod </span><span>There are cases that you may think it is hard to see how to not need a rule like you have above. Some of those can actually be tricky to express, but in many cases that I’ve seen, accumulators can be used to achieve the semantics desired, or a new fact type that is used for the derived fact that is different from what is deriving it
eg instead of
</span><pre>[:not [Foo (= x 2)]] =&gt; (insert! (-&gt;Foo 2))
</pre><span>
Something like
</span><pre>[:not [Foo (= x 2)]] =&gt; (insert! (-&gt;DerivedFoo 2))
</pre></div><div id="t1529164733000069" t="2018-06-16 15:58:53 sparkofreason Just a quick brain-bubble on this topic: I wonder if there could be a sort of &quot;debug mode&quot; where during  fire-rules  a graph is built for the causal relationships, e.g. Fact A -&gt; Rule B -&gt; Fact C -&gt; Rule D... That graph could be analyzed for cycles. Haven&apos;t thought this through at all, and would guess it isn&apos;t perfect, but perhaps better than nothing?"><a href="#t1529164733000069" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-16</span> <span class="t" onclick="H(this)">15:58:53</span>           sparkofreason </span><span>Just a quick brain-bubble on this topic: I wonder if there could be a sort of &quot;debug mode&quot; where during </span><code>fire-rules</code><span> a graph is built for the causal relationships, e.g. Fact A -&gt; Rule B -&gt; Fact C -&gt; Rule D... That graph could be analyzed for cycles. Haven&apos;t thought this through at all, and would guess it isn&apos;t perfect, but perhaps better than nothing?</span></div><div id="t1529166982000089" t="2018-06-16 16:36:22 alex-dixon I think for Clojure :no-loop true can be provided in the properties map. I’ve heard it mentioned a couple times"><a href="#t1529166982000089" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-16</span> <span class="t" onclick="H(this)">16:36:22</span>              alex-dixon </span><span>I think for Clojure :no-loop true can be provided in the properties map. I’ve heard it mentioned a couple times</span></div><div id="t1529167065000086" t="2018-06-16 16:37:45 alex-dixon https://github.com/cerner/clara-rules/blob/8c4898498b5bff7a231f5c5ce74d56ab84453a53/src/test/clojure/clara/test_rules.clj#L1108"><a href="#t1529167065000086" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-16</span> <span class="t" onclick="H(this)">16:37:45</span>              alex-dixon </span><a href="https://github.com/cerner/clara-rules/blob/8c4898498b5bff7a231f5c5ce74d56ab84453a53/src/test/clojure/clara/test_rules.clj#L1108" target="_blank">https://github.com/cerner/clara-rules/blob/8c4898498b5bff7a231f5c5ce74d56ab84453a53/src/test/clojure/clara/test_rules.clj#L1108</a></div><div id="t1529171221000039" t="2018-06-16 17:47:01 mikerod @dave.dixon the thing is that it isn’t clear it is actually looping just because it goes through the same rule path a few times. RHS can do arbitrary logic. Including have different paths they may take via conditionals. "><a href="#t1529171221000039" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-16</span> <span class="t" onclick="H(this)">17:47:01</span>                 mikerod </span><span>@dave.dixon the thing is that it isn’t clear it is actually looping just because it goes through the same rule path a few times. RHS can do arbitrary logic. Including have different paths they may take via conditionals. </span></div><div id="t1529171264000008" t="2018-06-16 17:47:44 mikerod Some sort of general warnings could be nice perhaps that suggest that “maybe” there is a loop though"><a href="#t1529171264000008" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-16</span> <span class="t" onclick="H(this)">17:47:44</span>                 mikerod </span><span>Some sort of general warnings could be nice perhaps that suggest that “maybe” there is a loop though</span></div><div id="t1529171409000146" t="2018-06-16 17:50:09 mikerod @alex-dixon yep. It exists.  Don’t generally recommend it unless the use case really makes sense to use it. "><a href="#t1529171409000146" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-16</span> <span class="t" onclick="H(this)">17:50:09</span>                 mikerod </span><span>@alex-dixon yep. It exists.  Don’t generally recommend it unless the use case really makes sense to use it. </span></div><div id="t1529171433000037" t="2018-06-16 17:50:33 mikerod Typically it’s best to solve the problems just purely via the logical TMS if practical. "><a href="#t1529171433000037" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-16</span> <span class="t" onclick="H(this)">17:50:33</span>                 mikerod </span><span>Typically it’s best to solve the problems just purely via the logical TMS if practical. </span></div><div id="t1529171569000012" t="2018-06-16 17:52:49 sparkofreason Yeah, it&apos;s another version of the halting problem. But it might be a nice way to get some visibility on the causal structure, and highlight loops that are unexpected."><a href="#t1529171569000012" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-16</span> <span class="t" onclick="H(this)">17:52:49</span>           sparkofreason </span><span>Yeah, it&apos;s another version of the halting problem. But it might be a nice way to get some visibility on the causal structure, and highlight loops that are unexpected.</span></div><div id="t1529172190000032" t="2018-06-16 18:03:10 mikerod Yes indeed"><a href="#t1529172190000032" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-16</span> <span class="t" onclick="H(this)">18:03:10</span>                 mikerod </span><span>Yes indeed</span></div><div id="t1529949496000553" t="2018-06-25 17:58:16 tony.kay Hi, is it ok to use  *current-session* ?  it isn’t documented, but it would be handy to run queries during rule execution…or is that just a bad idea?"><a href="#t1529949496000553" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-25</span> <span class="t" onclick="H(this)">17:58:16</span>                tony.kay </span><span>Hi, is it ok to use </span><code>*current-session*</code><span>?  it isn’t documented, but it would be handy to run queries during rule execution…or is that just a bad idea?</span></div><div id="t1529951413000686" t="2018-06-25 18:30:13 mikerod @tony.kay sounds like a bad idea  😛"><a href="#t1529951413000686" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-25</span> <span class="t" onclick="H(this)">18:30:13</span>                 mikerod </span><span>@tony.kay sounds like a bad idea </span><b>😛</b></div><div id="t1529951426000775" t="2018-06-25 18:30:26 mikerod Are you wanting to use it for debugging or for more than that?"><a href="#t1529951426000775" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-25</span> <span class="t" onclick="H(this)">18:30:26</span>                 mikerod </span><span>Are you wanting to use it for debugging or for more than that?</span></div><div id="t1529951474000736" t="2018-06-25 18:31:14 tony.kay So, we have facts that are stored in a datomic-fashion…so “insert” needs to know if the fact (as an E/A pair) is already present so we can retract the old value before inserting the new one"><a href="#t1529951474000736" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-25</span> <span class="t" onclick="H(this)">18:31:14</span>                tony.kay </span><span>So, we have facts that are stored in a datomic-fashion…so “insert” needs to know if the fact (as an E/A pair) is already present so we can retract the old value before inserting the new one</span></div><div id="t1529951490000141" t="2018-06-25 18:31:30 mikerod The thing is (a) it isn’t documented/impl detail, so would be subject to breaking changes (b) but even more worrisome is that there isn’t any strong guarantees about rules firing order or if a rule will be fired/retracted/re-fired etc
So arbitrarily looking into the  *current-session*  could cause problems"><a href="#t1529951490000141" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-25</span> <span class="t" onclick="H(this)">18:31:30</span>                 mikerod </span><span>The thing is (a) it isn’t documented/impl detail, so would be subject to breaking changes (b) but even more worrisome is that there isn’t any strong guarantees about rules firing order or if a rule will be fired/retracted/re-fired etc
So arbitrarily looking into the </span><code>*current-session*</code><span> could cause problems</span></div><div id="t1529951493000077" t="2018-06-25 18:31:33 tony.kay so, we need to know what is in the current session"><a href="#t1529951493000077" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-25</span> <span class="t" onclick="H(this)">18:31:33</span>                tony.kay </span><span>so, we need to know what is in the current session</span></div><div id="t1529951521000657" t="2018-06-25 18:32:01 tony.kay yeah, I understand that, but rule firing order doesn’t matter in that case…I need to know if a fact is in there right as that rule fires"><a href="#t1529951521000657" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-25</span> <span class="t" onclick="H(this)">18:32:01</span>                tony.kay </span><span>yeah, I understand that, but rule firing order doesn’t matter in that case…I need to know if a fact is in there right as that rule fires</span></div><div id="t1529951536000233" t="2018-06-25 18:32:16 mikerod I think that  http://www.metasimple.org/2017/12/23/clara-updating-facts.html  relates to this concept of safely “updating” facts"><a href="#t1529951536000233" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-25</span> <span class="t" onclick="H(this)">18:32:16</span>                 mikerod </span><span>I think that </span><a href="http://www.metasimple.org/2017/12/23/clara-updating-facts.html" target="_blank">http://www.metasimple.org/2017/12/23/clara-updating-facts.html</a><span> relates to this concept of safely “updating” facts</span></div><div id="t1529951548000265" t="2018-06-25 18:32:28 mikerod although it doesn’t provide an ideal solution"><a href="#t1529951548000265" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-25</span> <span class="t" onclick="H(this)">18:32:28</span>                 mikerod </span><span>although it doesn’t provide an ideal solution</span></div><div id="t1529951608000349" t="2018-06-25 18:33:28 mikerod You can use things like  insert-unconditional!  and also  :no-loop  properties on a  defrule  to attempt to do things like you are describing. However, I try to avoid those since they become more imperative/order-dependent etc in nature. Also, they can have interactions at odds with the rest of the truth maintenance system."><a href="#t1529951608000349" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-25</span> <span class="t" onclick="H(this)">18:33:28</span>                 mikerod </span><span>You can use things like </span><code>insert-unconditional!</code><span> and also </span><code>:no-loop</code><span> properties on a </span><code>defrule</code><span> to attempt to do things like you are describing. However, I try to avoid those since they become more imperative/order-dependent etc in nature. Also, they can have interactions at odds with the rest of the truth maintenance system.</span></div><div id="t1529951632000616" t="2018-06-25 18:33:52 mikerod In the post linked above, I mention “Approach 1: Append only updates”"><a href="#t1529951632000616" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-25</span> <span class="t" onclick="H(this)">18:33:52</span>                 mikerod </span><span>In the post linked above, I mention “Approach 1: Append only updates”</span></div><div id="t1529951650000220" t="2018-06-25 18:34:10 mikerod that’s the easiest, but can run up against memory limits depending on how you are using things"><a href="#t1529951650000220" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-25</span> <span class="t" onclick="H(this)">18:34:10</span>                 mikerod </span><span>that’s the easiest, but can run up against memory limits depending on how you are using things</span></div><div id="t1529951719000314" t="2018-06-25 18:35:19 mikerod I didn’t explain in that post, but I think the “Approach 1: Append only updates” could be extended to have an external process/fn that cleans up old  UpdatingFactSnapshot  later (using a query to access them externally)."><a href="#t1529951719000314" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-25</span> <span class="t" onclick="H(this)">18:35:19</span>                 mikerod </span><span>I didn’t explain in that post, but I think the “Approach 1: Append only updates” could be extended to have an external process/fn that cleans up old </span><code>UpdatingFactSnapshot</code><span> later (using a query to access them externally).</span></div><div id="t1529951828000021" t="2018-06-25 18:37:08 tony.kay cool, thanks. I’ll read the article. I’m sure I’m missing somehting about the TMS that I’m not clear on  🙂   Hopefully that’ll get me squared up"><a href="#t1529951828000021" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-25</span> <span class="t" onclick="H(this)">18:37:08</span>                tony.kay </span><span>cool, thanks. I’ll read the article. I’m sure I’m missing somehting about the TMS that I’m not clear on </span><b>🙂</b><span>  Hopefully that’ll get me squared up</span></div><div id="t1529953289000066" t="2018-06-25 19:01:29 tony.kay @mikerod so, in the project I’m helping with, they are not using the logic tracking facility…so invalidating a truth does not auto-retract anything.  Perhaps this is a problem that should be addressed as well, but does that affect your answer at all?"><a href="#t1529953289000066" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-25</span> <span class="t" onclick="H(this)">19:01:29</span>                tony.kay </span><span>@mikerod so, in the project I’m helping with, they are not using the logic tracking facility…so invalidating a truth does not auto-retract anything.  Perhaps this is a problem that should be addressed as well, but does that affect your answer at all?</span></div><div id="t1529953318000381" t="2018-06-25 19:01:58 tony.kay (e.g. they are using unconditional inserts)"><a href="#t1529953318000381" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-25</span> <span class="t" onclick="H(this)">19:01:58</span>                tony.kay </span><span>(e.g. they are using unconditional inserts)</span></div><div id="t1529953342000529" t="2018-06-25 19:02:22 tony.kay oh, I guess you mentioned that…unconditional"><a href="#t1529953342000529" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-25</span> <span class="t" onclick="H(this)">19:02:22</span>                tony.kay </span><span>oh, I guess you mentioned that…unconditional</span></div><div id="t1529953356000385" t="2018-06-25 19:02:36 mikerod If you use unconditional inserts, those rules will rely on order of firing"><a href="#t1529953356000385" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-25</span> <span class="t" onclick="H(this)">19:02:36</span>                 mikerod </span><span>If you use unconditional inserts, those rules will rely on order of firing</span></div><div id="t1529953359000369" t="2018-06-25 19:02:39 tony.kay I lost track while reading the article  😜"><a href="#t1529953359000369" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-25</span> <span class="t" onclick="H(this)">19:02:39</span>                tony.kay </span><span>I lost track while reading the article </span><b>😜</b></div><div id="t1529953367000615" t="2018-06-25 19:02:47 mikerod since the rules won’t try to “correct” for inconsistencies if a rule fires in the “wrong order”"><a href="#t1529953367000615" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-25</span> <span class="t" onclick="H(this)">19:02:47</span>                 mikerod </span><span>since the rules won’t try to “correct” for inconsistencies if a rule fires in the “wrong order”</span></div><div id="t1529953393000534" t="2018-06-25 19:03:13 mikerod but if you are opting out of truth maintenance, then yeah, you can do unconditional things"><a href="#t1529953393000534" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-25</span> <span class="t" onclick="H(this)">19:03:13</span>                 mikerod </span><span>but if you are opting out of truth maintenance, then yeah, you can do unconditional things</span></div><div id="t1529953421000239" t="2018-06-25 19:03:41 tony.kay ok, I’ll try to get to the bottom of why they want to opt-out as well"><a href="#t1529953421000239" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-25</span> <span class="t" onclick="H(this)">19:03:41</span>                tony.kay </span><span>ok, I’ll try to get to the bottom of why they want to opt-out as well</span></div><div id="t1529953436000781" t="2018-06-25 19:03:56 tony.kay I agree it would be nice to reason about things in isolation"><a href="#t1529953436000781" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-25</span> <span class="t" onclick="H(this)">19:03:56</span>                tony.kay </span><span>I agree it would be nice to reason about things in isolation</span></div><div id="t1529953496000391" t="2018-06-25 19:04:56 mikerod (defrule udpate-it
  [?old-one &lt;- A (= ?e e) (= ?a a)]
  [?new-one &lt;- NewA (= ?e e) (= ?a a)]
  =&gt;
  (retract! ?old-one)
  (insert-unconditional! (map-&gt;A ?new-one)))
"><a href="#t1529953496000391" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-25</span> <span class="t" onclick="H(this)">19:04:56</span>                 mikerod </span><pre>(defrule udpate-it
  [?old-one &lt;- A (= ?e e) (= ?a a)]
  [?new-one &lt;- NewA (= ?e e) (= ?a a)]
  =&gt;
  (retract! ?old-one)
  (insert-unconditional! (map-&gt;A ?new-one)))
</pre></div><div id="t1529953507000628" t="2018-06-25 19:05:07 mikerod I’d worry a bit about pervasive use of unconditional inserts"><a href="#t1529953507000628" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-25</span> <span class="t" onclick="H(this)">19:05:07</span>                 mikerod </span><span>I’d worry a bit about pervasive use of unconditional inserts</span></div><div id="t1529953533000028" t="2018-06-25 19:05:33 mikerod it misses out on one fairly large advantage of the rules engine - which is a declarative logical truth maintenance system."><a href="#t1529953533000028" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-25</span> <span class="t" onclick="H(this)">19:05:33</span>                 mikerod </span><span>it misses out on one fairly large advantage of the rules engine - which is a declarative logical truth maintenance system.</span></div><div id="t1529953558000196" t="2018-06-25 19:05:58 mikerod If unconditional is used, it’d be best to a least to try to isolate it to some fringe “layer” of the logic"><a href="#t1529953558000196" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-25</span> <span class="t" onclick="H(this)">19:05:58</span>                 mikerod </span><span>If unconditional is used, it’d be best to a least to try to isolate it to some fringe “layer” of the logic</span></div><div id="t1529954204000518" t="2018-06-25 19:16:44 tony.kay yeah, these are more derived new facts…but I see your point about invalidating the condition of the rule you’re running"><a href="#t1529954204000518" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-25</span> <span class="t" onclick="H(this)">19:16:44</span>                tony.kay </span><span>yeah, these are more derived new facts…but I see your point about invalidating the condition of the rule you’re running</span></div><div id="t1530020627000360" t="2018-06-26 13:43:47 baptiste-from-paris hello friends, is there a way to save the entire LocalSession  in a db"><a href="#t1530020627000360" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-26</span> <span class="t" onclick="H(this)">13:43:47</span>     baptiste-from-paris </span><span>hello friends, is there a way to save the entire LocalSession  in a db</span></div><div id="t1530022854000170" t="2018-06-26 14:20:54 dominicm Is this related to #portkey in some way?  😄"><a href="#t1530022854000170" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-26</span> <span class="t" onclick="H(this)">14:20:54</span>                     dominicm </span><span>Is this related to #portkey in some way? </span><b>😄</b></div><div id="t1530020648000282" t="2018-06-26 13:44:08 baptiste-from-paris I mean serialize/deserialise for later analyse"><a href="#t1530020648000282" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-26</span> <span class="t" onclick="H(this)">13:44:08</span>     baptiste-from-paris </span><span>I mean serialize/deserialise for later analyse</span></div><div id="t1530020738000301" t="2018-06-26 13:45:38 mikerod @baptiste-from-paris there is some support for this. It’s referred to as durability in the Clara codebase. You do have to implement a protocol though to serialize the working memory facts that are specific to your domain of use"><a href="#t1530020738000301" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-26</span> <span class="t" onclick="H(this)">13:45:38</span>                 mikerod </span><span>@baptiste-from-paris there is some support for this. It’s referred to as durability in the Clara codebase. You do have to implement a protocol though to serialize the working memory facts that are specific to your domain of use</span></div><div id="t1530020803000742" t="2018-06-26 13:46:43 baptiste-from-paris nice  🙂"><a href="#t1530020803000742" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-26</span> <span class="t" onclick="H(this)">13:46:43</span>     baptiste-from-paris </span><span>nice </span><b>🙂</b></div><div id="t1530020813000479" t="2018-06-26 13:46:53 mikerod Also, the durability is currently targeted at being fast for serialization, but especially for deserialization. It doesn’t attempt to be able to deal with evolution to the stored data structures. If you have a change of rules, or a change of Clara version, sometime you may have to rerun rules and re-serialize. "><a href="#t1530020813000479" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-26</span> <span class="t" onclick="H(this)">13:46:53</span>                 mikerod </span><span>Also, the durability is currently targeted at being fast for serialization, but especially for deserialization. It doesn’t attempt to be able to deal with evolution to the stored data structures. If you have a change of rules, or a change of Clara version, sometime you may have to rerun rules and re-serialize. </span></div><div id="t1530020834000308" t="2018-06-26 13:47:14 baptiste-from-paris ok, got it"><a href="#t1530020834000308" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-26</span> <span class="t" onclick="H(this)">13:47:14</span>     baptiste-from-paris </span><span>ok, got it</span></div><div id="t1530020859000275" t="2018-06-26 13:47:39 mikerod Well to clarify, any change in rules requires a new run. A change in Clara version may or may not. It just depends on what changes. "><a href="#t1530020859000275" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-26</span> <span class="t" onclick="H(this)">13:47:39</span>                 mikerod </span><span>Well to clarify, any change in rules requires a new run. A change in Clara version may or may not. It just depends on what changes. </span></div><div id="t1530020868000479" t="2018-06-26 13:47:48 baptiste-from-paris yes offcourse"><a href="#t1530020868000479" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-26</span> <span class="t" onclick="H(this)">13:47:48</span>     baptiste-from-paris </span><span>yes offcourse</span></div><div id="t1530020888000443" t="2018-06-26 13:48:08 baptiste-from-paris thanks  for your time  🙂"><a href="#t1530020888000443" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-26</span> <span class="t" onclick="H(this)">13:48:08</span>     baptiste-from-paris </span><span>thanks  for your time </span><b>🙂</b></div><div id="t1530020890000035" t="2018-06-26 13:48:10 mikerod http://www.clara-rules.org/docs/durability/"><a href="#t1530020890000035" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-26</span> <span class="t" onclick="H(this)">13:48:10</span>                 mikerod </span><a href="http://www.clara-rules.org/docs/durability/" target="_blank">http://www.clara-rules.org/docs/durability/</a></div><div id="t1530020910000055" t="2018-06-26 13:48:30 baptiste-from-paris was on it, but I had to ask the communuty  😉"><a href="#t1530020910000055" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-26</span> <span class="t" onclick="H(this)">13:48:30</span>     baptiste-from-paris </span><span>was on it, but I had to ask the communuty </span><b>😉</b></div><div id="t1530026565000825" t="2018-06-26 15:22:45 jeremy How might I accumulate facts of the same type to test if they are: all contain the same value and any contain a certain value?"><a href="#t1530026565000825" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-26</span> <span class="t" onclick="H(this)">15:22:45</span>                  jeremy </span><span>How might I accumulate facts of the same type to test if they are: all contain the same value and any contain a certain value?</span></div><div id="t1530027240001006" t="2018-06-26 15:34:00 mikerod @jeremy642 Sounds like 2 separate things, if so"><a href="#t1530027240001006" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-26</span> <span class="t" onclick="H(this)">15:34:00</span>                 mikerod </span><span>@jeremy642 Sounds like 2 separate things, if so</span></div><div id="t1530027244000244" t="2018-06-26 15:34:04 mikerod ;; ?all contain the same value for :val
[?all &lt;- (acc/all) :from [A (= ?val val)]]


;; ?all has at least one containing :some-val for :val
[?all &lt;- (acc/all) :from [A]]
[:test (some #(= :some-val (:val %))
             ?all)]
"><a href="#t1530027244000244" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-26</span> <span class="t" onclick="H(this)">15:34:04</span>                 mikerod </span><pre>;; ?all contain the same value for :val
[?all &lt;- (acc/all) :from [A (= ?val val)]]


;; ?all has at least one containing :some-val for :val
[?all &lt;- (acc/all) :from [A]]
[:test (some #(= :some-val (:val %))
             ?all)]
</pre></div><div id="t1530027254000136" t="2018-06-26 15:34:14 jeremy Yes  😛"><a href="#t1530027254000136" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-26</span> <span class="t" onclick="H(this)">15:34:14</span>                  jeremy </span><span>Yes </span><b>😛</b></div><div id="t1530027255001016" t="2018-06-26 15:34:15 mikerod However, the 2nd accumulator is weird, not sure why you want to accumulate like that"><a href="#t1530027255001016" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-26</span> <span class="t" onclick="H(this)">15:34:15</span>                 mikerod </span><span>However, the 2nd accumulator is weird, not sure why you want to accumulate like that</span></div><div id="t1530027263000159" t="2018-06-26 15:34:23 mikerod but perhaps"><a href="#t1530027263000159" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-26</span> <span class="t" onclick="H(this)">15:34:23</span>                 mikerod </span><span>but perhaps</span></div><div id="t1530027324000360" t="2018-06-26 15:35:24 mikerod “any contain a certain value”  sounds like a typical rule match"><a href="#t1530027324000360" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-26</span> <span class="t" onclick="H(this)">15:35:24</span>                 mikerod </span><span>“any contain a certain value”  sounds like a typical rule match</span></div><div id="t1530027345000297" t="2018-06-26 15:35:45 mikerod [?all &lt;- (acc/all) :from [A (= ?val val)]]  and this will group each  A  where they have the same value for  val"><a href="#t1530027345000297" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-26</span> <span class="t" onclick="H(this)">15:35:45</span>                 mikerod </span><code>[?all &lt;- (acc/all) :from [A (= ?val val)]]</code><span> and this will group each </span><code>A</code><span> where they have the same value for </span><code>val</code></div><div id="t1530027346000553" t="2018-06-26 15:35:46 jeremy Yes it is."><a href="#t1530027346000553" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-26</span> <span class="t" onclick="H(this)">15:35:46</span>                  jeremy </span><span>Yes it is.</span></div><div id="t1530027360000555" t="2018-06-26 15:36:00 mikerod it’ll match and propagate for each grouping possible"><a href="#t1530027360000555" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-26</span> <span class="t" onclick="H(this)">15:36:00</span>                 mikerod </span><span>it’ll match and propagate for each grouping possible</span></div><div id="t1530027371000334" t="2018-06-26 15:36:11 jeremy Yeah, I think any would be a typical rule match."><a href="#t1530027371000334" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-26</span> <span class="t" onclick="H(this)">15:36:11</span>                  jeremy </span><span>Yeah, I think any would be a typical rule match.</span></div><div id="t1530027380000601" t="2018-06-26 15:36:20 jeremy I think my mind was just farting on it."><a href="#t1530027380000601" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-26</span> <span class="t" onclick="H(this)">15:36:20</span>                  jeremy </span><span>I think my mind was just farting on it.</span></div><div id="t1530027420000681" t="2018-06-26 15:37:00 jeremy But on the all, does that work if there is a fact of the same type with a diff value?"><a href="#t1530027420000681" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-26</span> <span class="t" onclick="H(this)">15:37:00</span>                  jeremy </span><span>But on the all, does that work if there is a fact of the same type with a diff value?</span></div><div id="t1530027460000730" t="2018-06-26 15:37:40 jeremy A : 1, A : 1, A : 2, it shouldn&apos;t match since all As don&apos;t have the same value."><a href="#t1530027460000730" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-26</span> <span class="t" onclick="H(this)">15:37:40</span>                  jeremy </span><span>A : 1, A : 1, A : 2, it shouldn&apos;t match since all As don&apos;t have the same value.</span></div><div id="t1530027566000115" t="2018-06-26 15:39:26 jeremy Maybe it&apos;d be more like the 2nd one"><a href="#t1530027566000115" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-26</span> <span class="t" onclick="H(this)">15:39:26</span>                  jeremy </span><span>Maybe it&apos;d be more like the 2nd one</span></div><div id="t1530027578000349" t="2018-06-26 15:39:38 jeremy Where you accumulate them all together, then apply a test to them."><a href="#t1530027578000349" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-26</span> <span class="t" onclick="H(this)">15:39:38</span>                  jeremy </span><span>Where you accumulate them all together, then apply a test to them.</span></div><div id="t1530030845000429" t="2018-06-26 16:34:05 jeremy Got it  👍   Feel so accomplished when a rule works."><a href="#t1530030845000429" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-26</span> <span class="t" onclick="H(this)">16:34:05</span>                  jeremy </span><span>Got it </span><b>👍</b><span>  Feel so accomplished when a rule works.</span></div><div id="t1530041019000318" t="2018-06-26 19:23:39 jeremy Did any of the visualization stuff that Ryan talks about in his videos get released?"><a href="#t1530041019000318" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-26</span> <span class="t" onclick="H(this)">19:23:39</span>                  jeremy </span><span>Did any of the visualization stuff that Ryan talks about in his videos get released?</span></div><div id="t1530056057000455" t="2018-06-26 23:34:17 tony.kay I’m not seeing anything in the docs that would allow you to separate rule sets, and  defrule  seems global…is there support (planned) for having “rule sets” for different things, or is the idea that you just keep your domains separate by having facts that don’t cross over and trust that the optimizations in the engine will make it mostly “not matter” when your rule set gets big because it covers 10 different domains?"><a href="#t1530056057000455" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-26</span> <span class="t" onclick="H(this)">23:34:17</span>                tony.kay </span><span>I’m not seeing anything in the docs that would allow you to separate rule sets, and </span><code>defrule</code><span> seems global…is there support (planned) for having “rule sets” for different things, or is the idea that you just keep your domains separate by having facts that don’t cross over and trust that the optimizations in the engine will make it mostly “not matter” when your rule set gets big because it covers 10 different domains?</span></div><div id="t1530057630000383" t="2018-06-27 00:00:30 mikerod @jeremy642 I believe what you are referring to was a bit of an experimental project and not actively maintained. "><a href="#t1530057630000383" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-27</span> <span class="t" onclick="H(this)">00:00:30</span>                 mikerod </span><span>@jeremy642 I believe what you are referring to was a bit of an experimental project and not actively maintained. </span></div><div id="t1530057666000223" t="2018-06-27 00:01:06 mikerod It maybe this  https://github.com/rbrush/clara-tools"><a href="#t1530057666000223" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-27</span> <span class="t" onclick="H(this)">00:01:06</span>                 mikerod </span><span>It maybe this </span><a href="https://github.com/rbrush/clara-tools" target="_blank">https://github.com/rbrush/clara-tools</a></div><div id="t1530057785000324" t="2018-06-27 00:03:05 mikerod @tony.kay you can provided collections of rule structures to mk-session. It doesn’t only accept namespaces. You can also define a var that holds a collection of rules and give it metadata :production-seq. So that single var name can be passed. "><a href="#t1530057785000324" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-27</span> <span class="t" onclick="H(this)">00:03:05</span>                 mikerod </span><span>@tony.kay you can provided collections of rule structures to mk-session. It doesn’t only accept namespaces. You can also define a var that holds a collection of rules and give it metadata :production-seq. So that single var name can be passed. </span></div><div id="t1530057798000261" t="2018-06-27 00:03:18 mikerod Different ways to do things. Depending on your goals. "><a href="#t1530057798000261" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-27</span> <span class="t" onclick="H(this)">00:03:18</span>                 mikerod </span><span>Different ways to do things. Depending on your goals. </span></div><div id="t1530057841000024" t="2018-06-27 00:04:01 mikerod However sometimes it can be fine to combine into larger rule sets. Rules that don’t match facts won’t contribute much to runtime. "><a href="#t1530057841000024" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-27</span> <span class="t" onclick="H(this)">00:04:01</span>                 mikerod </span><span>However sometimes it can be fine to combine into larger rule sets. Rules that don’t match facts won’t contribute much to runtime. </span></div><div id="t1530058401000126" t="2018-06-27 00:13:21 tony.kay Ah, I misunderstood how mk-session worked…my bad"><a href="#t1530058401000126" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-27</span> <span class="t" onclick="H(this)">00:13:21</span>                tony.kay </span><span>Ah, I misunderstood how mk-session worked…my bad</span></div><div id="t1530060850000204" t="2018-06-27 00:54:10 mikerod  No problem!"><a href="#t1530060850000204" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-27</span> <span class="t" onclick="H(this)">00:54:10</span>                 mikerod </span><span> No problem!</span></div><div id="t1530066163000210" t="2018-06-27 02:22:43 jeremy @mikerod Thanks"><a href="#t1530066163000210" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-27</span> <span class="t" onclick="H(this)">02:22:43</span>                  jeremy </span><span>@mikerod Thanks</span></div><div id="t1530120058000191" t="2018-06-27 17:20:58 jeremy I have a bunch of rules that derive some final state fact. What I run into is that multiple rules might match and in the end I get multiple results. So in the standard decision tree, there is order to the final state precedence. Would it be appropriate to add a priority property to these final state results and then query on that priority to narrow it down to a single result?"><a href="#t1530120058000191" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-27</span> <span class="t" onclick="H(this)">17:20:58</span>                  jeremy </span><span>I have a bunch of rules that derive some final state fact. What I run into is that multiple rules might match and in the end I get multiple results. So in the standard decision tree, there is order to the final state precedence. Would it be appropriate to add a priority property to these final state results and then query on that priority to narrow it down to a single result?</span></div><div id="t1530122301000335" t="2018-06-27 17:58:21 mikerod @jeremy642 that is one approach"><a href="#t1530122301000335" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-27</span> <span class="t" onclick="H(this)">17:58:21</span>                 mikerod </span><span>@jeremy642 that is one approach</span></div><div id="t1530122313000273" t="2018-06-27 17:58:33 mikerod I think I’ve answered variations of this question a lot of times, but don’t think it’s saved anywhere"><a href="#t1530122313000273" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-27</span> <span class="t" onclick="H(this)">17:58:33</span>                 mikerod </span><span>I think I’ve answered variations of this question a lot of times, but don’t think it’s saved anywhere</span></div><div id="t1530122322000284" t="2018-06-27 17:58:42 jeremy 🙂"><a href="#t1530122322000284" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-27</span> <span class="t" onclick="H(this)">17:58:42</span>                  jeremy </span><b>🙂</b></div><div id="t1530122323000049" t="2018-06-27 17:58:43 mikerod you can prioritize rules by building a tiered structure to them"><a href="#t1530122323000049" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-27</span> <span class="t" onclick="H(this)">17:58:43</span>                 mikerod </span><span>you can prioritize rules by building a tiered structure to them</span></div><div id="t1530122329000149" t="2018-06-27 17:58:49 mikerod or you can let them all fire"><a href="#t1530122329000149" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-27</span> <span class="t" onclick="H(this)">17:58:49</span>                 mikerod </span><span>or you can let them all fire</span></div><div id="t1530122335000160" t="2018-06-27 17:58:55 mikerod insert some “intermediate fact”"><a href="#t1530122335000160" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-27</span> <span class="t" onclick="H(this)">17:58:55</span>                 mikerod </span><span>insert some “intermediate fact”</span></div><div id="t1530122353000509" t="2018-06-27 17:59:13 mikerod then have 1 more rule to accumulate all “intermediate facts” and insert your final fact based on the aggregate of them"><a href="#t1530122353000509" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-27</span> <span class="t" onclick="H(this)">17:59:13</span>                 mikerod </span><span>then have 1 more rule to accumulate all “intermediate facts” and insert your final fact based on the aggregate of them</span></div><div id="t1530122367000036" t="2018-06-27 17:59:27 mikerod I can give examlpes in a bit if needed"><a href="#t1530122367000036" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-27</span> <span class="t" onclick="H(this)">17:59:27</span>                 mikerod </span><span>I can give examlpes in a bit if needed</span></div><div id="t1530122390000142" t="2018-06-27 17:59:50 mikerod I guess I have one example of one approach here  https://gist.github.com/mrrodriguez/6a6f8373b25d69826b3efe154c928fac#file-clara_tiered_fact_update_rules-clj"><a href="#t1530122390000142" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-27</span> <span class="t" onclick="H(this)">17:59:50</span>                 mikerod </span><span>I guess I have one example of one approach here </span><a href="https://gist.github.com/mrrodriguez/6a6f8373b25d69826b3efe154c928fac#file-clara_tiered_fact_update_rules-clj" target="_blank">https://gist.github.com/mrrodriguez/6a6f8373b25d69826b3efe154c928fac#file-clara_tiered_fact_update_rules-clj</a></div><div id="t1530123096000099" t="2018-06-27 18:11:36 jeremy Thanks. I&apos;ll check it out and play with it."><a href="#t1530123096000099" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-27</span> <span class="t" onclick="H(this)">18:11:36</span>                  jeremy </span><span>Thanks. I&apos;ll check it out and play with it.</span></div><div id="t1530300432000326" t="2018-06-29 19:27:12 Daniel Hines Hello all. What is the current status of dynamically generated rules in CLJS with Clara? I saw this thread:  https://groups.google.com/forum/#!topic/clara-rules/9x-dIBM1hoo , but the last bit of activity was several years ago, and I can&apos;t tell where things landed."><a href="#t1530300432000326" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-29</span> <span class="t" onclick="H(this)">19:27:12</span>            Daniel Hines </span><span>Hello all. What is the current status of dynamically generated rules in CLJS with Clara? I saw this thread: </span><a href="https://groups.google.com/forum/#!topic/clara-rules/9x-dIBM1hoo" target="_blank">https://groups.google.com/forum/#!topic/clara-rules/9x-dIBM1hoo</a><span>, but the last bit of activity was several years ago, and I can&apos;t tell where things landed.</span></div><div id="t1530304480000005" t="2018-06-29 20:34:40 mikerod @d4hines I don’t know of any activity on it really"><a href="#t1530304480000005" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-29</span> <span class="t" onclick="H(this)">20:34:40</span>                 mikerod </span><span>@d4hines I don’t know of any activity on it really</span></div><div id="t1530304491000381" t="2018-06-29 20:34:51 mikerod Rules are compiled in clj. The compiler uses eval"><a href="#t1530304491000381" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-29</span> <span class="t" onclick="H(this)">20:34:51</span>                 mikerod </span><span>Rules are compiled in clj. The compiler uses eval</span></div><div id="t1530304516000174" t="2018-06-29 20:35:16 mikerod What are you wanting to explore in this regard?"><a href="#t1530304516000174" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-29</span> <span class="t" onclick="H(this)">20:35:16</span>                 mikerod </span><span>What are you wanting to explore in this regard?</span></div><div id="t1530304718000281" t="2018-06-29 20:38:38 Daniel Hines I know a major goal of Clara is to &quot;take back rules for the developer&quot;, but a major goal of a project I&apos;m working on is to be able to update rules on the fly based on changing business logic. The rules aren&apos;t that complicated at all, but there are a lot of them, so it would be nice to create an interface for a non-developer to edit and publish the rules. It sounds like that would require deploying a new build, correct?"><a href="#t1530304718000281" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-29</span> <span class="t" onclick="H(this)">20:38:38</span>            Daniel Hines </span><span>I know a major goal of Clara is to &quot;take back rules for the developer&quot;, but a major goal of a project I&apos;m working on is to be able to update rules on the fly based on changing business logic. The rules aren&apos;t that complicated at all, but there are a lot of them, so it would be nice to create an interface for a non-developer to edit and publish the rules. It sounds like that would require deploying a new build, correct?</span></div><div id="t1530304788000012" t="2018-06-29 20:39:48 mikerod The thread you linked to discussed it some, but you could have a server that compilers rules and sends it back to client"><a href="#t1530304788000012" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-29</span> <span class="t" onclick="H(this)">20:39:48</span>                 mikerod </span><span>The thread you linked to discussed it some, but you could have a server that compilers rules and sends it back to client</span></div><div id="t1530304794000141" t="2018-06-29 20:39:54 mikerod if you are wanting to have a client in cljs"><a href="#t1530304794000141" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-29</span> <span class="t" onclick="H(this)">20:39:54</span>                 mikerod </span><span>if you are wanting to have a client in cljs</span></div><div id="t1530304820000140" t="2018-06-29 20:40:20 mikerod Not sure what your non-developer constraints are - what would they be editing in?"><a href="#t1530304820000140" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-29</span> <span class="t" onclick="H(this)">20:40:20</span>                 mikerod </span><span>Not sure what your non-developer constraints are - what would they be editing in?</span></div><div id="t1530304834000199" t="2018-06-29 20:40:34 mikerod eg (1) a repl (2) some sort of browser-based UI etc"><a href="#t1530304834000199" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-29</span> <span class="t" onclick="H(this)">20:40:34</span>                 mikerod </span><span>eg (1) a repl (2) some sort of browser-based UI etc</span></div><div id="t1530304969000047" t="2018-06-29 20:42:49 Daniel Hines Well, I was definitely leaning towards (2), but having seen an example of instaparse creating clara rules, it might be neat to create a dsl such that the source of truth for the rules is a text file, in which case a fancy UI might not be as necessary."><a href="#t1530304969000047" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-29</span> <span class="t" onclick="H(this)">20:42:49</span>            Daniel Hines </span><span>Well, I was definitely leaning towards (2), but having seen an example of instaparse creating clara rules, it might be neat to create a dsl such that the source of truth for the rules is a text file, in which case a fancy UI might not be as necessary.</span></div><div id="t1530305050000423" t="2018-06-29 20:44:10 mikerod You can make rulesets in a dynamic way"><a href="#t1530305050000423" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-29</span> <span class="t" onclick="H(this)">20:44:10</span>                 mikerod </span><span>You can make rulesets in a dynamic way</span></div><div id="t1530305115000100" t="2018-06-29 20:45:15 mikerod So bring in some text files, convert format to Clara rules data format, compile them (and ensure you have the right compiling-context for var resolution etc)"><a href="#t1530305115000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-29</span> <span class="t" onclick="H(this)">20:45:15</span>                 mikerod </span><span>So bring in some text files, convert format to Clara rules data format, compile them (and ensure you have the right compiling-context for var resolution etc)</span></div><div id="t1530305130000115" t="2018-06-29 20:45:30 mikerod You can do  mk-session  with collections of rule/query structures"><a href="#t1530305130000115" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-29</span> <span class="t" onclick="H(this)">20:45:30</span>                 mikerod </span><span>You can do </span><code>mk-session</code><span> with collections of rule/query structures</span></div><div id="t1530305143000379" t="2018-06-29 20:45:43 mikerod So they do not have to be bound to Clojure namespaces/vars"><a href="#t1530305143000379" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-29</span> <span class="t" onclick="H(this)">20:45:43</span>                 mikerod </span><span>So they do not have to be bound to Clojure namespaces/vars</span></div><div id="t1530305163000025" t="2018-06-29 20:46:03 mikerod So you could build a more dynamic process around that."><a href="#t1530305163000025" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-29</span> <span class="t" onclick="H(this)">20:46:03</span>                 mikerod </span><span>So you could build a more dynamic process around that.</span></div><div id="t1530305296000025" t="2018-06-29 20:48:16 Daniel Hines I&apos;m not sure I follow, but that&apos;s probably due to my unfamiliarity with Clara in general."><a href="#t1530305296000025" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-29</span> <span class="t" onclick="H(this)">20:48:16</span>            Daniel Hines </span><span>I&apos;m not sure I follow, but that&apos;s probably due to my unfamiliarity with Clara in general.</span></div><div id="t1530307997000261" t="2018-06-29 21:33:17 mikerod Hmm"><a href="#t1530307997000261" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-29</span> <span class="t" onclick="H(this)">21:33:17</span>                 mikerod </span><span>Hmm</span></div><div id="t1530308039000172" t="2018-06-29 21:33:59 mikerod I can try to come up with an example"><a href="#t1530308039000172" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-29</span> <span class="t" onclick="H(this)">21:33:59</span>                 mikerod </span><span>I can try to come up with an example</span></div><div id="t1530308610000112" t="2018-06-29 21:43:30 dominicm Does self hosted Clojure script work?"><a href="#t1530308610000112" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-29</span> <span class="t" onclick="H(this)">21:43:30</span>                dominicm </span><span>Does self hosted Clojure script work?</span></div><div id="t1530308614000335" t="2018-06-29 21:43:34 mikerod nope"><a href="#t1530308614000335" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-29</span> <span class="t" onclick="H(this)">21:43:34</span>                 mikerod </span><span>nope</span></div><div id="t1530308633000038" t="2018-06-29 21:43:53 mikerod some Clara namespaces are only clj"><a href="#t1530308633000038" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-29</span> <span class="t" onclick="H(this)">21:43:53</span>                 mikerod </span><span>some Clara namespaces are only clj</span></div><div id="t1530308638000069" t="2018-06-29 21:43:58 mikerod (not cljc)"><a href="#t1530308638000069" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-29</span> <span class="t" onclick="H(this)">21:43:58</span>                 mikerod </span><span>(not cljc)</span></div><div id="t1530308648000090" t="2018-06-29 21:44:08 mikerod It’d be cool to make it self-host compatible though  😛"><a href="#t1530308648000090" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-29</span> <span class="t" onclick="H(this)">21:44:08</span>                 mikerod </span><span>It’d be cool to make it self-host compatible though </span><b>😛</b></div><div id="t1530308665000173" t="2018-06-29 21:44:25 mikerod adds a bit of a new layer of trickiness to parts of it, macros etc"><a href="#t1530308665000173" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-29</span> <span class="t" onclick="H(this)">21:44:25</span>                 mikerod </span><span>adds a bit of a new layer of trickiness to parts of it, macros etc</span></div><div id="t1530308684000074" t="2018-06-29 21:44:44 dominicm Yeah. There&apos;s some help for that in macrovich"><a href="#t1530308684000074" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-29</span> <span class="t" onclick="H(this)">21:44:44</span>                dominicm </span><span>Yeah. There&apos;s some help for that in macrovich</span></div><div id="t1530308695000052" t="2018-06-29 21:44:55 mikerod yep, I’ve seen that one"><a href="#t1530308695000052" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-29</span> <span class="t" onclick="H(this)">21:44:55</span>                 mikerod </span><span>yep, I’ve seen that one</span></div><div id="t1530308729000063" t="2018-06-29 21:45:29 mikerod If I had more time to do it, I’d definitely look at self-hosted support. Would be cool."><a href="#t1530308729000063" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-29</span> <span class="t" onclick="H(this)">21:45:29</span>                 mikerod </span><span>If I had more time to do it, I’d definitely look at self-hosted support. Would be cool.</span></div><div id="t1530308744000086" t="2018-06-29 21:45:44 mikerod It probably isn’t a terribly long way off, but I’m sure there would be some trickiness"><a href="#t1530308744000086" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-29</span> <span class="t" onclick="H(this)">21:45:44</span>                 mikerod </span><span>It probably isn’t a terribly long way off, but I’m sure there would be some trickiness</span></div><div id="t1530318560000003" t="2018-06-30 00:29:20 mikerod @d4hines mk-session would use clj eval. So it’d need to be running in a JVM process. "><a href="#t1530318560000003" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-30</span> <span class="t" onclick="H(this)">00:29:20</span>                 mikerod </span><span>@d4hines mk-session would use clj eval. So it’d need to be running in a JVM process. </span></div><div id="t1530318607000121" t="2018-06-30 00:30:07 mikerod The rule data structure are just plain clj data so could be made wherever and sent to mk-session"><a href="#t1530318607000121" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-30</span> <span class="t" onclick="H(this)">00:30:07</span>                 mikerod </span><span>The rule data structure are just plain clj data so could be made wherever and sent to mk-session</span></div><div id="t1530318679000046" t="2018-06-30 00:31:19 mikerod Also. I don’t know if you are trying to load rules in cljs still hah"><a href="#t1530318679000046" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-30</span> <span class="t" onclick="H(this)">00:31:19</span>                 mikerod </span><span>Also. I don’t know if you are trying to load rules in cljs still hah</span></div><div id="t1530318884000063" t="2018-06-30 00:34:44 Daniel Hines I got a little confused as to which we were doing  😛 . If  mk-session  requires a JVM, that means I would need to compile it down to CLJS like the google thread described, then require that in a  &lt;script&gt;  tag or similar, right?"><a href="#t1530318884000063" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-30</span> <span class="t" onclick="H(this)">00:34:44</span>            Daniel Hines </span><span>I got a little confused as to which we were doing </span><b>😛</b><span>. If </span><code>mk-session</code><span> requires a JVM, that means I would need to compile it down to CLJS like the google thread described, then require that in a </span><code>&lt;script&gt;</code><span> tag or similar, right?</span></div><div id="t1530318969000042" t="2018-06-30 00:36:09 Daniel Hines I think my use case is such that I could justify just doing a new build/deploy of the whole frontend every time they needed to update the rules (which isn&apos;t at rapid speed or anything), which sounds like it would be much easier and not require any more infrastructure than using Clara with cljs in the first place. Is that a bad way to go?"><a href="#t1530318969000042" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-30</span> <span class="t" onclick="H(this)">00:36:09</span>            Daniel Hines </span><span>I think my use case is such that I could justify just doing a new build/deploy of the whole frontend every time they needed to update the rules (which isn&apos;t at rapid speed or anything), which sounds like it would be much easier and not require any more infrastructure than using Clara with cljs in the first place. Is that a bad way to go?</span></div><div id="t1530318995000126" t="2018-06-30 00:36:35 Daniel Hines Turn it into a CI/CD problem instead of a Clojure problem."><a href="#t1530318995000126" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-30</span> <span class="t" onclick="H(this)">00:36:35</span>            Daniel Hines </span><span>Turn it into a CI/CD problem instead of a Clojure problem.</span></div><div id="t1530319171000088" t="2018-06-30 00:39:31 mikerod Yeah may be reasonable. I’d have to look more to have any better suggestions there. "><a href="#t1530319171000088" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-30</span> <span class="t" onclick="H(this)">00:39:31</span>                 mikerod </span><span>Yeah may be reasonable. I’d have to look more to have any better suggestions there. </span></div><div id="t1530319196000044" t="2018-06-30 00:39:56 mikerod I guess Clara compiled rules cannot be returned from like an xhrio call? Hmm. "><a href="#t1530319196000044" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-30</span> <span class="t" onclick="H(this)">00:39:56</span>                 mikerod </span><span>I guess Clara compiled rules cannot be returned from like an xhrio call? Hmm. </span></div><div id="t1530325491000064" t="2018-06-30 02:24:51 mikerod Yes. It is useful. You can build rules in more dynamic ways when useful. "><a href="#t1530325491000064" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-30</span> <span class="t" onclick="H(this)">02:24:51</span>                 mikerod </span><span>Yes. It is useful. You can build rules in more dynamic ways when useful. </span></div><div id="t1530325673000008" t="2018-06-30 02:27:53 mikerod http://www.toomuchcode.org/blog/2015/11/14/insta-declarative-dsls/ 

A bit older post but related shows interesting things that can be done. I think that Daniel mentioned in an earlier comment today. "><a href="#t1530325673000008" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-30</span> <span class="t" onclick="H(this)">02:27:53</span>                 mikerod </span><a href="http://www.toomuchcode.org/blog/2015/11/14/insta-declarative-dsls/" target="_blank">http://www.toomuchcode.org/blog/2015/11/14/insta-declarative-dsls/</a><span>

A bit older post but related shows interesting things that can be done. I think that Daniel mentioned in an earlier comment today. </span></div><div id="t1530326601000035" t="2018-06-30 02:43:21 jeremy I read through it. Instaparse is a bit of gibberish to me right now. I’ll have to look into it more.  🙂"><a href="#t1530326601000035" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-30</span> <span class="t" onclick="H(this)">02:43:21</span>                  jeremy </span><span>I read through it. Instaparse is a bit of gibberish to me right now. I’ll have to look into it more. </span><b>🙂</b></div><div id="t1530338722000022" t="2018-06-30 06:05:22 alex-dixon @d4hines it’s not a path anyone’s cleared that I know of. I’d expect it to be challenging no matter the approach you take. Another one depending on what kind of setup you ultimately want could involve figwheel I think. I’ve had some success getting live reload to work by redefining the session var in cljs and manipulating the keys in the cljs compiler env that Clara stores productions in. I only had it working for changes to source code though"><a href="#t1530338722000022" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-06-30</span> <span class="t" onclick="H(this)">06:05:22</span>              alex-dixon </span><span>@d4hines it’s not a path anyone’s cleared that I know of. I’d expect it to be challenging no matter the approach you take. Another one depending on what kind of setup you ultimately want could involve figwheel I think. I’ve had some success getting live reload to work by redefining the session var in cljs and manipulating the keys in the cljs compiler env that Clara stores productions in. I only had it working for changes to source code though</span></div><div id="t1531706616000090" t="2018-07-16 02:03:36 alex-dixon Stupid question time: Is it possible to use Rete with disk storage only for working sets that can’t fit into memory? Would there be any advantage to using it as part of a database implementation?"><a href="#t1531706616000090" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-07-16</span> <span class="t" onclick="H(this)">02:03:36</span>              alex-dixon </span><span>Stupid question time: Is it possible to use Rete with disk storage only for working sets that can’t fit into memory? Would there be any advantage to using it as part of a database implementation?</span></div><div id="t1531730065000152" t="2018-07-16 08:34:25 wparker @alex-dixon There isn&apos;t any reason in principle why you can&apos;t use disk storage in a Clara memory implementation.  It would obviously be less performant than in memory storage; if every Rete operation resulted in a random disk seek it could be pretty poor at a guess.  I&apos;ve toyed with the idea of a memory implementation dumping overflow to disk before though with some kind of heuristics for what to keep in memory.  There could be complications to work through if you&apos;re trying to basically serialize random objects too."><a href="#t1531730065000152" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-07-16</span> <span class="t" onclick="H(this)">08:34:25</span>                 wparker </span><span>@alex-dixon There isn&apos;t any reason in principle why you can&apos;t use disk storage in a Clara memory implementation.  It would obviously be less performant than in memory storage; if every Rete operation resulted in a random disk seek it could be pretty poor at a guess.  I&apos;ve toyed with the idea of a memory implementation dumping overflow to disk before though with some kind of heuristics for what to keep in memory.  There could be complications to work through if you&apos;re trying to basically serialize random objects too.</span></div><div id="t1531765020000525" t="2018-07-16 18:17:00 alex-dixon &gt; I’ve toyed with the idea of a memory implementation dumping overflow to disk before though with some kind of heuristics for what to keep in memory
Heh, I was thinking about the same thing yesterday  🙂  I haven’t been able to find any papers or mention of Rete being used with a persistence layer. Do you know of any?"><a href="#t1531765020000525" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-07-16</span> <span class="t" onclick="H(this)">18:17:00</span>              alex-dixon </span><span>&gt; I’ve toyed with the idea of a memory implementation dumping overflow to disk before though with some kind of heuristics for what to keep in memory
Heh, I was thinking about the same thing yesterday </span><b>🙂</b><span> I haven’t been able to find any papers or mention of Rete being used with a persistence layer. Do you know of any?</span></div><div id="t1531768171000314" t="2018-07-16 19:09:31 wparker @alex-dixon No, I don’t know of any offhand.  My (completely untested  🙂  ) guess would be that avoiding internal retractions from truth maintenance would be a big part of it.  Maybe if the data were appropriately structured you could use a local database to back the memory - is that what you were getting at with “Would there be any advantage to using it as part of a database implementation?”"><a href="#t1531768171000314" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-07-16</span> <span class="t" onclick="H(this)">19:09:31</span>                 wparker </span><span>@alex-dixon No, I don’t know of any offhand.  My (completely untested </span><b>🙂</b><span> ) guess would be that avoiding internal retractions from truth maintenance would be a big part of it.  Maybe if the data were appropriately structured you could use a local database to back the memory - is that what you were getting at with “Would there be any advantage to using it as part of a database implementation?”</span></div><div id="t1531773659000266" t="2018-07-16 20:40:59 hiredman there is presentation from, uh, maybe it was at a clojurewest, the presenter discusses implementing a rules system on top of a database, it does away with, maybe just alpha nodes, in rete because it expects database indices to do basically the same thing"><a href="#t1531773659000266" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-07-16</span> <span class="t" onclick="H(this)">20:40:59</span>                hiredman </span><span>there is presentation from, uh, maybe it was at a clojurewest, the presenter discusses implementing a rules system on top of a database, it does away with, maybe just alpha nodes, in rete because it expects database indices to do basically the same thing</span></div><div id="t1531773739000313" t="2018-07-16 20:42:19 hiredman https://github.com/threatgrid/naga"><a href="#t1531773739000313" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-07-16</span> <span class="t" onclick="H(this)">20:42:19</span>                hiredman </span><a href="https://github.com/threatgrid/naga" target="_blank">https://github.com/threatgrid/naga</a></div><div id="t1531934137000312" t="2018-07-18 17:15:37 alex-dixon @hiredman thanks! The readme says in memory only but plans for persistence with an rdf triple store or graph database. I’ll look into it more"><a href="#t1531934137000312" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-07-18</span> <span class="t" onclick="H(this)">17:15:37</span>              alex-dixon </span><span>@hiredman thanks! The readme says in memory only but plans for persistence with an rdf triple store or graph database. I’ll look into it more</span></div><div id="t1531934574000066" t="2018-07-18 17:22:54 alex-dixon @wparker That was poorly phrased but basically yeah. More specifically I’m trying to figure out whether Clara or rete in general could be implemented as a hybrid in memory and persistent db like Datomic that uses rete for in memory processing as well as for querying persistent data that can never fit into memory. "><a href="#t1531934574000066" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-07-18</span> <span class="t" onclick="H(this)">17:22:54</span>              alex-dixon </span><span>@wparker That was poorly phrased but basically yeah. More specifically I’m trying to figure out whether Clara or rete in general could be implemented as a hybrid in memory and persistent db like Datomic that uses rete for in memory processing as well as for querying persistent data that can never fit into memory. </span></div><div id="t1531934668000158" t="2018-07-18 17:24:28 alex-dixon Having rules writing to persistent storage would be key too"><a href="#t1531934668000158" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-07-18</span> <span class="t" onclick="H(this)">17:24:28</span>              alex-dixon </span><span>Having rules writing to persistent storage would be key too</span></div><div id="t1531953296000005" t="2018-07-18 22:34:56 mikerod @alex-dixon seems doable"><a href="#t1531953296000005" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-07-18</span> <span class="t" onclick="H(this)">22:34:56</span>                 mikerod </span><span>@alex-dixon seems doable</span></div><div id="t1531953313000079" t="2018-07-18 22:35:13 mikerod but not without a bunch of effort if you were going to try to implement a memory that works well/performant doing that"><a href="#t1531953313000079" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-07-18</span> <span class="t" onclick="H(this)">22:35:13</span>                 mikerod </span><span>but not without a bunch of effort if you were going to try to implement a memory that works well/performant doing that</span></div><div id="t1531953347000165" t="2018-07-18 22:35:47 mikerod Long ago, Ryan did an example storm cluster-based Clara impl of memory. it was experimental but did show how memory could be extended potentially"><a href="#t1531953347000165" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-07-18</span> <span class="t" onclick="H(this)">22:35:47</span>                 mikerod </span><span>Long ago, Ryan did an example storm cluster-based Clara impl of memory. it was experimental but did show how memory could be extended potentially</span></div><div id="t1531953483000245" t="2018-07-18 22:38:03 alex-dixon Thanks. Yeah I’ve been looking at that. It’s not clear to me what’s going on there. Best I could figure out is storm is doing a lot of the work"><a href="#t1531953483000245" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-07-18</span> <span class="t" onclick="H(this)">22:38:03</span>              alex-dixon </span><span>Thanks. Yeah I’ve been looking at that. It’s not clear to me what’s going on there. Best I could figure out is storm is doing a lot of the work</span></div><div id="t1531953583000116" t="2018-07-18 22:39:43 mikerod yeah, it’d require storm understanding I’m sure"><a href="#t1531953583000116" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-07-18</span> <span class="t" onclick="H(this)">22:39:43</span>                 mikerod </span><span>yeah, it’d require storm understanding I’m sure</span></div><div id="t1531953588000179" t="2018-07-18 22:39:48 mikerod and it isn’t really the same thing"><a href="#t1531953588000179" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-07-18</span> <span class="t" onclick="H(this)">22:39:48</span>                 mikerod </span><span>and it isn’t really the same thing</span></div><div id="t1531953636000018" t="2018-07-18 22:40:36 mikerod You could certainly try to hook a memory impl up to have facts potentially in slower storage, you’d just have to deal with that serialization stuff and also the concern of how to make it not super slow"><a href="#t1531953636000018" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-07-18</span> <span class="t" onclick="H(this)">22:40:36</span>                 mikerod </span><span>You could certainly try to hook a memory impl up to have facts potentially in slower storage, you’d just have to deal with that serialization stuff and also the concern of how to make it not super slow</span></div><div id="t1531953647000234" t="2018-07-18 22:40:47 mikerod also, accumulators are an issue"><a href="#t1531953647000234" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-07-18</span> <span class="t" onclick="H(this)">22:40:47</span>                 mikerod </span><span>also, accumulators are an issue</span></div><div id="t1531953673000232" t="2018-07-18 22:41:13 mikerod if you are dealing in numbers of facts too large for memory, but then you try to do an accumulator that needs to see them all at once"><a href="#t1531953673000232" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-07-18</span> <span class="t" onclick="H(this)">22:41:13</span>                 mikerod </span><span>if you are dealing in numbers of facts too large for memory, but then you try to do an accumulator that needs to see them all at once</span></div><div id="t1531953727000205" t="2018-07-18 22:42:07 mikerod I watched the naga talk before too. It was interesting. It seemed a bit more special-purposed than Clara, but still cool to think about"><a href="#t1531953727000205" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-07-18</span> <span class="t" onclick="H(this)">22:42:07</span>                 mikerod </span><span>I watched the naga talk before too. It was interesting. It seemed a bit more special-purposed than Clara, but still cool to think about</span></div><div id="t1531953966000221" t="2018-07-18 22:46:06 alex-dixon I’m thinking of using RocksDB specifically  https://github.com/facebook/rocksdb/wiki/Performance-Benchmarks"><a href="#t1531953966000221" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-07-18</span> <span class="t" onclick="H(this)">22:46:06</span>              alex-dixon </span><span>I’m thinking of using RocksDB specifically </span><a href="https://github.com/facebook/rocksdb/wiki/Performance-Benchmarks" target="_blank">https://github.com/facebook/rocksdb/wiki/Performance-Benchmarks</a></div><div id="t1531956363000255" t="2018-07-18 23:26:03 mikerod never saw that one"><a href="#t1531956363000255" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-07-18</span> <span class="t" onclick="H(this)">23:26:03</span>                 mikerod </span><span>never saw that one</span></div><div id="t1531956376000069" t="2018-07-18 23:26:16 mikerod looks like it could be interesting to experiment with the idea though"><a href="#t1531956376000069" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-07-18</span> <span class="t" onclick="H(this)">23:26:16</span>                 mikerod </span><span>looks like it could be interesting to experiment with the idea though</span></div><div id="t1533094472000125" t="2018-08-01 03:34:32 jumblemuddle Does it make sense to have singleton facts in my network? Whenver I update one of these I retract the previous fact and insert the updated fact."><a href="#t1533094472000125" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-01</span> <span class="t" onclick="H(this)">03:34:32</span>            jumblemuddle </span><span>Does it make sense to have singleton facts in my network? Whenver I update one of these I retract the previous fact and insert the updated fact.</span></div><div id="t1533130852000411" t="2018-08-01 13:40:52 mikerod @jumblemuddle maybe something I wrote a while back can go through some of those situations  http://www.metasimple.org/2017/12/23/clara-updating-facts.html"><a href="#t1533130852000411" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-01</span> <span class="t" onclick="H(this)">13:40:52</span>                 mikerod </span><span>@jumblemuddle maybe something I wrote a while back can go through some of those situations </span><a href="http://www.metasimple.org/2017/12/23/clara-updating-facts.html" target="_blank">http://www.metasimple.org/2017/12/23/clara-updating-facts.html</a></div><div id="t1533130912000122" t="2018-08-01 13:41:52 mikerod if you are just wanting to skim, perhaps see “Approach 1: Append only updates” and “Approach 2: Externally managed updates” sections"><a href="#t1533130912000122" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-01</span> <span class="t" onclick="H(this)">13:41:52</span>                 mikerod </span><span>if you are just wanting to skim, perhaps see “Approach 1: Append only updates” and “Approach 2: Externally managed updates” sections</span></div><div id="t1533133158000079" t="2018-08-01 14:19:18 jumblemuddle Thanks, @mikerod!"><a href="#t1533133158000079" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-01</span> <span class="t" onclick="H(this)">14:19:18</span>            jumblemuddle </span><span>Thanks, @mikerod!</span></div><div id="t1533763368000016" t="2018-08-08 21:22:48 jeremy @mikerod Do you know if there is a way to go from Java -&gt; Clojure when rules are keywords and not records/java beans?"><a href="#t1533763368000016" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-08</span> <span class="t" onclick="H(this)">21:22:48</span>                  jeremy </span><span>@mikerod Do you know if there is a way to go from Java -&gt; Clojure when rules are keywords and not records/java beans?</span></div><div id="t1533763683000376" t="2018-08-08 21:28:03 enn I have a Clara rulebase that, for comprehensibility reasons, I’d like to split into “phases.” So, phase 1 gets a bunch of facts, the rules fire, and new facts are generated. Somehow, this becomes the input to phase 2, which fires a new set of rules, generating new facts. Etc.

I’m not sure what the best way is to pass the output of one phase into the next. Originally I was thinking I’d just take the session from phase 1 and use that as the starting point for phase 2. But unless I’m missing something, it’s not possible to load new rules into an extant session.

So I guess what I need to do is to just grab all the “output” facts out of phase 1 and insert them into a new session for phase 2. Is there a simpler way to do this than by writing (and then executing) a query for each and every fact type?"><a href="#t1533763683000376" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-08</span> <span class="t" onclick="H(this)">21:28:03</span>                     enn </span><span>I have a Clara rulebase that, for comprehensibility reasons, I’d like to split into “phases.” So, phase 1 gets a bunch of facts, the rules fire, and new facts are generated. Somehow, this becomes the input to phase 2, which fires a new set of rules, generating new facts. Etc.

I’m not sure what the best way is to pass the output of one phase into the next. Originally I was thinking I’d just take the session from phase 1 and use that as the starting point for phase 2. But unless I’m missing something, it’s not possible to load new rules into an extant session.

So I guess what I need to do is to just grab all the “output” facts out of phase 1 and insert them into a new session for phase 2. Is there a simpler way to do this than by writing (and then executing) a query for each and every fact type?</span></div><div id="t1533763801000124" t="2018-08-08 21:30:01 mikerod @enn 
&gt; So I guess what I need to do is to just grab all the “output” facts out of phase 1 and insert them into a new session for phase 2. Is there a simpler way to do this than by writing (and then executing) a query for each and every fact type?
I think this is likely a smoother approach (there is an alternative I can mention in a min)

As far as worrying about querying for too many types, maybe you can make a “parent” type for the output types you care about and just have a query on that parent type."><a href="#t1533763801000124" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-08</span> <span class="t" onclick="H(this)">21:30:01</span>                 mikerod </span><span>@enn 
&gt; So I guess what I need to do is to just grab all the “output” facts out of phase 1 and insert them into a new session for phase 2. Is there a simpler way to do this than by writing (and then executing) a query for each and every fact type?
I think this is likely a smoother approach (there is an alternative I can mention in a min)

As far as worrying about querying for too many types, maybe you can make a “parent” type for the output types you care about and just have a query on that parent type.</span></div><div id="t1533763925000364" t="2018-08-08 21:32:05 mikerod Another possibility is to just use one session with all the rules. I’m not sure what about your logic makes it where you’d want some rules to be separate from others. Are you worried about them running too early or something, performance?, etc"><a href="#t1533763925000364" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-08</span> <span class="t" onclick="H(this)">21:32:05</span>                      mikerod </span><span>Another possibility is to just use one session with all the rules. I’m not sure what about your logic makes it where you’d want some rules to be separate from others. Are you worried about them running too early or something, performance?, etc</span></div><div id="t1533764072000043" t="2018-08-08 21:34:32 mikerod I don’t understand your situation enough, but there is something called “activation groups” that can also be considered in some cases that may relate to yours
 https://github.com/cerner/clara-rules/blob/0.18.0/src/main/clojure/clara/rules.cljc#L328-L331"><a href="#t1533764072000043" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-08</span> <span class="t" onclick="H(this)">21:34:32</span>                      mikerod </span><span>I don’t understand your situation enough, but there is something called “activation groups” that can also be considered in some cases that may relate to yours
</span><a href="https://github.com/cerner/clara-rules/blob/0.18.0/src/main/clojure/clara/rules.cljc#L328-L331" target="_blank">https://github.com/cerner/clara-rules/blob/0.18.0/src/main/clojure/clara/rules.cljc#L328-L331</a></div><div id="t1533764107000284" t="2018-08-08 21:35:07 enn No, they’re all in one session now and it works fine performance-wise. It’s more about making it easier for the programmer to understand the universe of rules and fact types in play at a given point in the code."><a href="#t1533764107000284" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-08</span> <span class="t" onclick="H(this)">21:35:07</span>                          enn </span><span>No, they’re all in one session now and it works fine performance-wise. It’s more about making it easier for the programmer to understand the universe of rules and fact types in play at a given point in the code.</span></div><div id="t1533764351000360" t="2018-08-08 21:39:11 enn And making it easy to ensure that an intermediate fact type (used to derive some other final result) does not get inadvertently referenced outside of its intended scope"><a href="#t1533764351000360" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-08</span> <span class="t" onclick="H(this)">21:39:11</span>                          enn </span><span>And making it easy to ensure that an intermediate fact type (used to derive some other final result) does not get inadvertently referenced outside of its intended scope</span></div><div id="t1533764435000089" t="2018-08-08 21:40:35 enn Maybe my whole idea is antithetical to the idea that a rules engine hides some of the order-of-execution concerns of regular code? I’m not sure."><a href="#t1533764435000089" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-08</span> <span class="t" onclick="H(this)">21:40:35</span>                          enn </span><span>Maybe my whole idea is antithetical to the idea that a rules engine hides some of the order-of-execution concerns of regular code? I’m not sure.</span></div><div id="t1533764961000105" t="2018-08-08 21:49:21 mikerod Yeah, I understand your reasoning then"><a href="#t1533764961000105" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-08</span> <span class="t" onclick="H(this)">21:49:21</span>                      mikerod </span><span>Yeah, I understand your reasoning then</span></div><div id="t1533764970000069" t="2018-08-08 21:49:30 mikerod You can separate them to independent rulesets if that helps reasoning"><a href="#t1533764970000069" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-08</span> <span class="t" onclick="H(this)">21:49:30</span>                      mikerod </span><span>You can separate them to independent rulesets if that helps reasoning</span></div><div id="t1533764992000185" t="2018-08-08 21:49:52 mikerod there would be a slight cost of taking facts from queries of one session and inserting again into another session, but that may not really be a concern"><a href="#t1533764992000185" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-08</span> <span class="t" onclick="H(this)">21:49:52</span>                      mikerod </span><span>there would be a slight cost of taking facts from queries of one session and inserting again into another session, but that may not really be a concern</span></div><div id="t1533765009000237" t="2018-08-08 21:50:09 mikerod but yeah, order independence is a key idea"><a href="#t1533765009000237" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-08</span> <span class="t" onclick="H(this)">21:50:09</span>                      mikerod </span><span>but yeah, order independence is a key idea</span></div><div id="t1533765026000016" t="2018-08-08 21:50:26 mikerod and I’d also sort of argue that rules should be able to somewhat function in aggregation with one another"><a href="#t1533765026000016" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-08</span> <span class="t" onclick="H(this)">21:50:26</span>                      mikerod </span><span>and I’d also sort of argue that rules should be able to somewhat function in aggregation with one another</span></div><div id="t1533765048000294" t="2018-08-08 21:50:48 mikerod where they can all share related information when relevant, but they are also fine when the information they need isn’t present etc"><a href="#t1533765048000294" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-08</span> <span class="t" onclick="H(this)">21:50:48</span>                      mikerod </span><span>where they can all share related information when relevant, but they are also fine when the information they need isn’t present etc</span></div><div id="t1533765105000237" t="2018-08-08 21:51:45 mikerod &gt; And making it easy to ensure that an intermediate fact type (used to derive some other final result) does not get inadvertently referenced outside of its intended scope
I think this is the most interesting concern though."><a href="#t1533765105000237" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-08</span> <span class="t" onclick="H(this)">21:51:45</span>                      mikerod </span><span>&gt; And making it easy to ensure that an intermediate fact type (used to derive some other final result) does not get inadvertently referenced outside of its intended scope
I think this is the most interesting concern though.</span></div><div id="t1533765140000250" t="2018-08-08 21:52:20 mikerod If everything gets lumped together, I can see how it could become problematic if you were wanting to have a better control on scope"><a href="#t1533765140000250" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-08</span> <span class="t" onclick="H(this)">21:52:20</span>                      mikerod </span><span>If everything gets lumped together, I can see how it could become problematic if you were wanting to have a better control on scope</span></div><div id="t1533763816000020" t="2018-08-08 21:30:16 mikerod @jeremy642 I don’t think I understand the question. You want to use rules with “keyword” sort of type dispatch, but on underlying Java objects? Maybe show a dummy example or something."><a href="#t1533763816000020" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-08</span> <span class="t" onclick="H(this)">21:30:16</span>                 mikerod </span><span>@jeremy642 I don’t think I understand the question. You want to use rules with “keyword” sort of type dispatch, but on underlying Java objects? Maybe show a dummy example or something.</span></div><div id="t1533763885000245" t="2018-08-08 21:31:25 jeremy I have rules built on a keyword type dispatch. I wasn&apos;t sure if there might be a way to create them from Java."><a href="#t1533763885000245" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-08</span> <span class="t" onclick="H(this)">21:31:25</span>                  jeremy </span><span>I have rules built on a keyword type dispatch. I wasn&apos;t sure if there might be a way to create them from Java.</span></div><div id="t1533763977000212" t="2018-08-08 21:32:57 jeremy More a question on Java -&gt; Clojure interop I guess than clara-rules. How I might go about creating the necessary type map for clara-rules from Java."><a href="#t1533763977000212" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-08</span> <span class="t" onclick="H(this)">21:32:57</span>                  jeremy </span><span>More a question on Java -&gt; Clojure interop I guess than clara-rules. How I might go about creating the necessary type map for clara-rules from Java.</span></div><div id="t1533764030000066" t="2018-08-08 21:33:50 jeremy"><a href="#t1533764030000066" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-08</span> <span class="t" onclick="H(this)">21:33:50</span>                  jeremy </span></div><div id="t1533764142000234" t="2018-08-08 21:35:42 mikerod @jeremy642 you can provide a custom  fact-type-fn  (and  ancestors-fn  if relevant)   http://www.clara-rules.org/docs/fact_type_customization/"><a href="#t1533764142000234" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-08</span> <span class="t" onclick="H(this)">21:35:42</span>                 mikerod </span><span>@jeremy642 you can provide a custom </span><code>fact-type-fn</code><span> (and </span><code>ancestors-fn</code><span> if relevant)  </span><a href="http://www.clara-rules.org/docs/fact_type_customization/" target="_blank">http://www.clara-rules.org/docs/fact_type_customization/</a></div><div id="t1533764194000138" t="2018-08-08 21:36:34 mikerod This may be what you are looking for. e.g. the  fact-type-fn  could take an arbitrary (Java) object and map it to some keyword/alternative typing system you have within the rules"><a href="#t1533764194000138" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-08</span> <span class="t" onclick="H(this)">21:36:34</span>                 mikerod </span><span>This may be what you are looking for. e.g. the </span><code>fact-type-fn</code><span> could take an arbitrary (Java) object and map it to some keyword/alternative typing system you have within the rules</span></div><div id="t1533764333000396" t="2018-08-08 21:38:53 mikerod A likely incomplete example, but perhaps inspiration to think about."><a href="#t1533764333000396" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-08</span> <span class="t" onclick="H(this)">21:38:53</span>                 mikerod </span><span>A likely incomplete example, but perhaps inspiration to think about.</span></div><div id="t1533764365000370" t="2018-08-08 21:39:25 mikerod I’m not sure if you already have a custom  fact-type-fn  or not though. You might since I see you have a map with  :weather-fact-type"><a href="#t1533764365000370" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-08</span> <span class="t" onclick="H(this)">21:39:25</span>                 mikerod </span><span>I’m not sure if you already have a custom </span><code>fact-type-fn</code><span> or not though. You might since I see you have a map with </span><code>:weather-fact-type</code></div><div id="t1533764385000053" t="2018-08-08 21:39:45 mikerod Clara’s default is  clojure.core/type , which is implemented as  (or (get (meta x) :type) (class x))"><a href="#t1533764385000053" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-08</span> <span class="t" onclick="H(this)">21:39:45</span>                 mikerod </span><span>Clara’s default is </span><code>clojure.core/type</code><span>, which is implemented as </span><code>(or (get (meta x) :type) (class x))</code></div><div id="t1533764406000250" t="2018-08-08 21:40:06 jeremy Yeah I was just thinking of a way to take Java Maps and Convert it to Keyword Key Map in the fact-type-fn?"><a href="#t1533764406000250" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-08</span> <span class="t" onclick="H(this)">21:40:06</span>                  jeremy </span><span>Yeah I was just thinking of a way to take Java Maps and Convert it to Keyword Key Map in the fact-type-fn?</span></div><div id="t1533764430000218" t="2018-08-08 21:40:30 mikerod depending on what is priority, you may flip the  if  above and do alternative things. I was just showing the idea of what could be done at least."><a href="#t1533764430000218" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-08</span> <span class="t" onclick="H(this)">21:40:30</span>                 mikerod </span><span>depending on what is priority, you may flip the </span><code>if</code><span> above and do alternative things. I was just showing the idea of what could be done at least.</span></div><div id="t1533764431000290" t="2018-08-08 21:40:31 jeremy Currently the custom fact-type-fn looks for :type or something like that. I&apos;ll have to grab the work laptop. This just came to me off the top of my head."><a href="#t1533764431000290" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-08</span> <span class="t" onclick="H(this)">21:40:31</span>                  jeremy </span><span>Currently the custom fact-type-fn looks for :type or something like that. I&apos;ll have to grab the work laptop. This just came to me off the top of my head.</span></div><div id="t1533764463000124" t="2018-08-08 21:41:03 mikerod so for the  fact-type-fn  you just need to return the type (a keyword in your case I think)"><a href="#t1533764463000124" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-08</span> <span class="t" onclick="H(this)">21:41:03</span>                 mikerod </span><span>so for the </span><code>fact-type-fn</code><span> you just need to return the type (a keyword in your case I think)</span></div><div id="t1533764468000369" t="2018-08-08 21:41:08 jeremy Yep"><a href="#t1533764468000369" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-08</span> <span class="t" onclick="H(this)">21:41:08</span>                  jeremy </span><span>Yep</span></div><div id="t1533764490000207" t="2018-08-08 21:41:30 mikerod but if you want to also work with the Java data as clj maps, like this:  (&lt; (:temperature this) 0) , you’d have to convert the facts themselves coming into the session"><a href="#t1533764490000207" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-08</span> <span class="t" onclick="H(this)">21:41:30</span>                 mikerod </span><span>but if you want to also work with the Java data as clj maps, like this: </span><code>(&lt; (:temperature this) 0)</code><span>, you’d have to convert the facts themselves coming into the session</span></div><div id="t1533764500000277" t="2018-08-08 21:41:40 mikerod which is different than the  fact-type-fn"><a href="#t1533764500000277" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-08</span> <span class="t" onclick="H(this)">21:41:40</span>                 mikerod </span><span>which is different than the </span><code>fact-type-fn</code></div><div id="t1533764525000331" t="2018-08-08 21:42:05 jeremy Yeah that&apos;s how the rules work with them currently."><a href="#t1533764525000331" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-08</span> <span class="t" onclick="H(this)">21:42:05</span>                  jeremy </span><span>Yeah that&apos;s how the rules work with them currently.</span></div><div id="t1533764525000410" t="2018-08-08 21:42:05 mikerod the  fact-type-fn  doesn’t transform the facts that are used during constraint matching. It just gives a value that is used as the “fact type” partitioning of the network"><a href="#t1533764525000410" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-08</span> <span class="t" onclick="H(this)">21:42:05</span>                 mikerod </span><span>the </span><code>fact-type-fn</code><span> doesn’t transform the facts that are used during constraint matching. It just gives a value that is used as the “fact type” partitioning of the network</span></div><div id="t1533764533000072" t="2018-08-08 21:42:13 jeremy Hmm ok"><a href="#t1533764533000072" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-08</span> <span class="t" onclick="H(this)">21:42:13</span>                  jeremy </span><span>Hmm ok</span></div><div id="t1533764554000062" t="2018-08-08 21:42:34 mikerod I’ve wrote Clara rules a bunch with external Java type data"><a href="#t1533764554000062" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-08</span> <span class="t" onclick="H(this)">21:42:34</span>                 mikerod </span><span>I’ve wrote Clara rules a bunch with external Java type data</span></div><div id="t1533764580000163" t="2018-08-08 21:43:00 mikerod What I’ve done typically is to have some fairly basic rules to match those types and apply any sort of useful filtering if performance was a conern"><a href="#t1533764580000163" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-08</span> <span class="t" onclick="H(this)">21:43:00</span>                 mikerod </span><span>What I’ve done typically is to have some fairly basic rules to match those types and apply any sort of useful filtering if performance was a conern</span></div><div id="t1533764593000421" t="2018-08-08 21:43:13 mikerod but then just had the RHS insert a clj type to use in all the rest of the rules"><a href="#t1533764593000421" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-08</span> <span class="t" onclick="H(this)">21:43:13</span>                 mikerod </span><span>but then just had the RHS insert a clj type to use in all the rest of the rules</span></div><div id="t1533764612000048" t="2018-08-08 21:43:32 mikerod so the rule was sort of a transformation/mapping from Java to CLJ data structures"><a href="#t1533764612000048" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-08</span> <span class="t" onclick="H(this)">21:43:32</span>                 mikerod </span><span>so the rule was sort of a transformation/mapping from Java to CLJ data structures</span></div><div id="t1533764647000014" t="2018-08-08 21:44:07 jeremy Ahh, might be a decent idea."><a href="#t1533764647000014" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-08</span> <span class="t" onclick="H(this)">21:44:07</span>                  jeremy </span><span>Ahh, might be a decent idea.</span></div><div id="t1533764705000315" t="2018-08-08 21:45:05 mikerod (defrule find-java-things
  [JavaThing (= x ?x)]
  =&gt;
  (insert! {:fact-type :thing
            :x ?x}))
"><a href="#t1533764705000315" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-08</span> <span class="t" onclick="H(this)">21:45:05</span>                 mikerod </span><pre>(defrule find-java-things
  [JavaThing (= x ?x)]
  =&gt;
  (insert! {:fact-type :thing
            :x ?x}))
</pre></div><div id="t1533764719000310" t="2018-08-08 21:45:19 mikerod but if you need the  JavaThing  in the end, for the query consumer"><a href="#t1533764719000310" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-08</span> <span class="t" onclick="H(this)">21:45:19</span>                 mikerod </span><span>but if you need the </span><code>JavaThing</code><span> in the end, for the query consumer</span></div><div id="t1533764723000353" t="2018-08-08 21:45:23 mikerod you can attach it to the facts"><a href="#t1533764723000353" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-08</span> <span class="t" onclick="H(this)">21:45:23</span>                 mikerod </span><span>you can attach it to the facts</span></div><div id="t1533764730000340" t="2018-08-08 21:45:30 mikerod either as a first-class field, or metadata"><a href="#t1533764730000340" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-08</span> <span class="t" onclick="H(this)">21:45:30</span>                 mikerod </span><span>either as a first-class field, or metadata</span></div><div id="t1533764743000189" t="2018-08-08 21:45:43 jeremy I was thinking about keeping the rules in a seperate jar. And allowing Java applications and Clojure applications import and use the rules in that jar. The question was just how to define the facts when the rules were all in Clojure and no beans were provided that allowed Java to create them."><a href="#t1533764743000189" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-08</span> <span class="t" onclick="H(this)">21:45:43</span>                  jeremy </span><span>I was thinking about keeping the rules in a seperate jar. And allowing Java applications and Clojure applications import and use the rules in that jar. The question was just how to define the facts when the rules were all in Clojure and no beans were provided that allowed Java to create them.</span></div><div id="t1533764751000291" t="2018-08-08 21:45:51 mikerod (defrule find-java-things
  [?j &lt;- JavaThing (= x ?x)]
  =&gt;
  (insert! (with-meta {:fact-type :thing
                       :x ?x}
             {:source ?j})))
"><a href="#t1533764751000291" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-08</span> <span class="t" onclick="H(this)">21:45:51</span>                 mikerod </span><pre>(defrule find-java-things
  [?j &lt;- JavaThing (= x ?x)]
  =&gt;
  (insert! (with-meta {:fact-type :thing
                       :x ?x}
             {:source ?j})))
</pre></div><div id="t1533764783000263" t="2018-08-08 21:46:23 mikerod If it’s a classpath issue, where you won’t know the types ahead of time you’ll have to be more tricky"><a href="#t1533764783000263" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-08</span> <span class="t" onclick="H(this)">21:46:23</span>                 mikerod </span><span>If it’s a classpath issue, where you won’t know the types ahead of time you’ll have to be more tricky</span></div><div id="t1533764798000311" t="2018-08-08 21:46:38 mikerod and also, you are going to hit reflection stuff I’d think that way"><a href="#t1533764798000311" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-08</span> <span class="t" onclick="H(this)">21:46:38</span>                 mikerod </span><span>and also, you are going to hit reflection stuff I’d think that way</span></div><div id="t1533764848000093" t="2018-08-08 21:47:28 mikerod or you write your core set of rules in a type-independent rule set/session"><a href="#t1533764848000093" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-08</span> <span class="t" onclick="H(this)">21:47:28</span>                 mikerod </span><span>or you write your core set of rules in a type-independent rule set/session</span></div><div id="t1533764899000171" t="2018-08-08 21:48:19 mikerod and you have to write a separate ruleset that does know about specific type mapping parts - or maybe you don’t need rules for that transformation layer at all."><a href="#t1533764899000171" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-08</span> <span class="t" onclick="H(this)">21:48:19</span>                 mikerod </span><span>and you have to write a separate ruleset that does know about specific type mapping parts - or maybe you don’t need rules for that transformation layer at all.</span></div><div id="t1533764987000218" t="2018-08-08 21:49:47 jeremy I thought about just writing a interface for Java to call and create facts, insert into engine. But the rule engine itself would most likely need to be run in clojure and not instantiated from Java so it&apos;s pretty self contained. It&apos;d save me the hassle of dealing with java vs clojure types."><a href="#t1533764987000218" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-08</span> <span class="t" onclick="H(this)">21:49:47</span>                  jeremy </span><span>I thought about just writing a interface for Java to call and create facts, insert into engine. But the rule engine itself would most likely need to be run in clojure and not instantiated from Java so it&apos;s pretty self contained. It&apos;d save me the hassle of dealing with java vs clojure types.</span></div><div id="t1533765079000047" t="2018-08-08 21:51:19 jeremy Java doesn&apos;t really need much control over the engine. Just to insert facts and get response from the queries."><a href="#t1533765079000047" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-08</span> <span class="t" onclick="H(this)">21:51:19</span>                  jeremy </span><span>Java doesn&apos;t really need much control over the engine. Just to insert facts and get response from the queries.</span></div><div id="t1533766182000289" t="2018-08-08 22:09:42 mikerod yeah, hard to say without fully understanding the setup you have"><a href="#t1533766182000289" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-08</span> <span class="t" onclick="H(this)">22:09:42</span>                 mikerod </span><span>yeah, hard to say without fully understanding the setup you have</span></div><div id="t1533833276000231" t="2018-08-09 16:47:56 wparker @jeremy642 @mikerod this might be useful in combination with Mike’s suggestion of using Java objects as facts that you could translate into Clojure objects if desired:  http://www.clara-rules.org/docs/java/  Basically Clara has a wrapper that you can use instead of needing to do the interop glue work yourself.  In case you weren’t already aware."><a href="#t1533833276000231" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-09</span> <span class="t" onclick="H(this)">16:47:56</span>                 wparker </span><span>@jeremy642 @mikerod this might be useful in combination with Mike’s suggestion of using Java objects as facts that you could translate into Clojure objects if desired: </span><a href="http://www.clara-rules.org/docs/java/" target="_blank">http://www.clara-rules.org/docs/java/</a><span> Basically Clara has a wrapper that you can use instead of needing to do the interop glue work yourself.  In case you weren’t already aware.</span></div><div id="t1533833384000463" t="2018-08-09 16:49:44 wparker Also FYI Clara will use the bean properties on Java objects to allow field use by name in the DSL, that isn’t just for records"><a href="#t1533833384000463" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-09</span> <span class="t" onclick="H(this)">16:49:44</span>                 wparker </span><span>Also FYI Clara will use the bean properties on Java objects to allow field use by name in the DSL, that isn’t just for records</span></div><div id="t1533833439000040" t="2018-08-09 16:50:39 wparker i.e. Object A has a “getB” method, you can just refer to “b” in a condition like [A (= b some-value)]"><a href="#t1533833439000040" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-09</span> <span class="t" onclick="H(this)">16:50:39</span>                 wparker </span><span>i.e. Object A has a “getB” method, you can just refer to “b” in a condition like [A (= b some-value)]</span></div><div id="t1533833469000412" t="2018-08-09 16:51:09 jeremy My rules implementation does not use Java types for fact types. So the question was how to handle the interop."><a href="#t1533833469000412" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-09</span> <span class="t" onclick="H(this)">16:51:09</span>                  jeremy </span><span>My rules implementation does not use Java types for fact types. So the question was how to handle the interop.</span></div><div id="t1533833484000340" t="2018-08-09 16:51:24 jeremy (defrule new-return
  &quot;The service is a new return.&quot;
  [:approval-status (= (:value this) :new-return)]
  =&gt;
  (insert! {:type :rule/result
            :id :new-return
            :priority 2}))"><a href="#t1533833484000340" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-09</span> <span class="t" onclick="H(this)">16:51:24</span>                  jeremy </span><pre>(defrule new-return
  &quot;The service is a new return.&quot;
  [:approval-status (= (:value this) :new-return)]
  =&gt;
  (insert! {:type :rule/result
            :id :new-return
            :priority 2}))</pre></div><div id="t1533833547000326" t="2018-08-09 16:52:27 jeremy (r/insert {:type :approval-status :value :new-return})  is how I would insert using clojure."><a href="#t1533833547000326" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-09</span> <span class="t" onclick="H(this)">16:52:27</span>                  jeremy </span><pre>(r/insert {:type :approval-status :value :new-return})</pre><span> is how I would insert using clojure.</span></div><div id="t1533833623000524" t="2018-08-09 16:53:43 jeremy Without changing the rules to beans or defining the facts with defrecords. The big ?? was how to allow Java to create maps with the keyword format that matched the rules properly."><a href="#t1533833623000524" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-09</span> <span class="t" onclick="H(this)">16:53:43</span>                  jeremy </span><span>Without changing the rules to beans or defining the facts with defrecords. The big ?? was how to allow Java to create maps with the keyword format that matched the rules properly.</span></div><div id="t1533833693000201" t="2018-08-09 16:54:53 wparker Perhaps write a rule that matches on Java maps and translates them, then inserts the result?  That way you could just insert the Java map into the session"><a href="#t1533833693000201" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-09</span> <span class="t" onclick="H(this)">16:54:53</span>                 wparker </span><span>Perhaps write a rule that matches on Java maps and translates them, then inserts the result?  That way you could just insert the Java map into the session</span></div><div id="t1533833732000177" t="2018-08-09 16:55:32 wparker That rule could then just not do anything if only Clojure maps  were in the session"><a href="#t1533833732000177" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-09</span> <span class="t" onclick="H(this)">16:55:32</span>                 wparker </span><span>That rule could then just not do anything if only Clojure maps  were in the session</span></div><div id="t1533833766000087" t="2018-08-09 16:56:06 jeremy So that&apos;s one thought. I could write new rules that&apos;s sole job was to convert say a Java map if matches to a clojure map."><a href="#t1533833766000087" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-09</span> <span class="t" onclick="H(this)">16:56:06</span>                  jeremy </span><span>So that&apos;s one thought. I could write new rules that&apos;s sole job was to convert say a Java map if matches to a clojure map.</span></div><div id="t1533833849000364" t="2018-08-09 16:57:29 jeremy I haven&apos;t progressed on any implementation yet. Been busy but I have some ideas to play with."><a href="#t1533833849000364" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-09</span> <span class="t" onclick="H(this)">16:57:29</span>                  jeremy </span><span>I haven&apos;t progressed on any implementation yet. Been busy but I have some ideas to play with.</span></div><div id="t1533833851000214" t="2018-08-09 16:57:31 jeremy 👍"><a href="#t1533833851000214" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-09</span> <span class="t" onclick="H(this)">16:57:31</span>                  jeremy </span><b>👍</b></div><div id="t1533834146000201" t="2018-08-09 17:02:26 wparker Note that Clojure maps also implement Java’s map, so you’d need to guard against an infinite loop there (i.e. require that it a Java Map but not a Clojure map)"><a href="#t1533834146000201" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-09</span> <span class="t" onclick="H(this)">17:02:26</span>                 wparker </span><span>Note that Clojure maps also implement Java’s map, so you’d need to guard against an infinite loop there (i.e. require that it a Java Map but not a Clojure map)</span></div><div id="t1533834866000465" t="2018-08-09 17:14:26 jeremy Thanks"><a href="#t1533834866000465" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-09</span> <span class="t" onclick="H(this)">17:14:26</span>                  jeremy </span><span>Thanks</span></div><div id="t1533834914000471" t="2018-08-09 17:15:14 jeremy I noticed that clara-rules is on the tech radar by thoughtworks.  https://www.thoughtworks.com/radar/languages-and-frameworks"><a href="#t1533834914000471" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-09</span> <span class="t" onclick="H(this)">17:15:14</span>                  jeremy </span><span>I noticed that clara-rules is on the tech radar by thoughtworks. </span><a href="https://www.thoughtworks.com/radar/languages-and-frameworks" target="_blank">https://www.thoughtworks.com/radar/languages-and-frameworks</a></div><div id="t1533855444000159" t="2018-08-09 22:57:24 mikerod Saw this one back when it was new on there. Pretty cool though! "><a href="#t1533855444000159" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-09</span> <span class="t" onclick="H(this)">22:57:24</span>                      mikerod </span><span>Saw this one back when it was new on there. Pretty cool though! </span></div><div id="t1533882615000016" t="2018-08-10 06:30:15 henrik I’m working on an ingestion pipeline for scholarly material. It takes XML files and adds them to a (Datomic) database. There’s a ton of little decisions to be made along the way. Depending on the publisher, the type of material, the presence of related material already in the database, the subject matter, the presence or absence of a myriad of little attributes in the file itself, and so on, the ingestion process behaves differently.

This means tons and tons of conditionals all over the place, and it quickly gets hard to get an overview. I’ve been contemplating ways to extract this decision making process into its own place. Would Clara be a suitable tool for this?"><a href="#t1533882615000016" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-10</span> <span class="t" onclick="H(this)">06:30:15</span>                  henrik </span><span>I’m working on an ingestion pipeline for scholarly material. It takes XML files and adds them to a (Datomic) database. There’s a ton of little decisions to be made along the way. Depending on the publisher, the type of material, the presence of related material already in the database, the subject matter, the presence or absence of a myriad of little attributes in the file itself, and so on, the ingestion process behaves differently.

This means tons and tons of conditionals all over the place, and it quickly gets hard to get an overview. I’ve been contemplating ways to extract this decision making process into its own place. Would Clara be a suitable tool for this?</span></div><div id="t1533896460000246" t="2018-08-10 10:21:00 wparker @U06B8J0AJ that sounds like a plausible use-case.  Much depends on how much involved the logic is - IMO a rules engine has some upfront cost to bring in especially if the team hasn’t used one before, but at a certain complexity of business logic it helps a lot.  Clara does what it can to help by “playing nicely” with the rest of the Clojure ecosystem e.g. by being simple Clojure code rather than an entirely separate framework with its own IDEs etc., but it still is a different way of thinking and is a nontrivial component to introduce to a system.  FWIW the analysis in the ThoughtWorks radar linked above seems on-target to me.  My guess would be that something like you describe would work best with a rules engine if large chunks of logic can be computed before needing to return to the stateful pipeline, but as always it is hard to say since so often it is the details that are most important."><a href="#t1533896460000246" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-10</span> <span class="t" onclick="H(this)">10:21:00</span>                      wparker </span><span>@U06B8J0AJ that sounds like a plausible use-case.  Much depends on how much involved the logic is - IMO a rules engine has some upfront cost to bring in especially if the team hasn’t used one before, but at a certain complexity of business logic it helps a lot.  Clara does what it can to help by “playing nicely” with the rest of the Clojure ecosystem e.g. by being simple Clojure code rather than an entirely separate framework with its own IDEs etc., but it still is a different way of thinking and is a nontrivial component to introduce to a system.  FWIW the analysis in the ThoughtWorks radar linked above seems on-target to me.  My guess would be that something like you describe would work best with a rules engine if large chunks of logic can be computed before needing to return to the stateful pipeline, but as always it is hard to say since so often it is the details that are most important.</span></div><div id="t1533923402000302" t="2018-08-10 17:50:02 devn howdy folks"><a href="#t1533923402000302" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-10</span> <span class="t" onclick="H(this)">17:50:02</span>                    devn </span><span>howdy folks</span></div><div id="t1533923407000322" t="2018-08-10 17:50:07 devn im interested in partial condition matches"><a href="#t1533923407000322" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-10</span> <span class="t" onclick="H(this)">17:50:07</span>                    devn </span><span>im interested in partial condition matches</span></div><div id="t1533923434000063" t="2018-08-10 17:50:34 devn i want to answer the question: what conditions didn&apos;t match for a given rule"><a href="#t1533923434000063" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-10</span> <span class="t" onclick="H(this)">17:50:34</span>                    devn </span><span>i want to answer the question: what conditions didn&apos;t match for a given rule</span></div><div id="t1533923472000234" t="2018-08-10 17:51:12 devn i&apos;m not sure this is possible at the moment"><a href="#t1533923472000234" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-10</span> <span class="t" onclick="H(this)">17:51:12</span>                    devn </span><span>i&apos;m not sure this is possible at the moment</span></div><div id="t1533929422000026" t="2018-08-10 19:30:22 wparker Could you give a concrete example @devn?  I&apos;m not sure what exactly you mean; session inspection has some things that might help."><a href="#t1533929422000026" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-10</span> <span class="t" onclick="H(this)">19:30:22</span>                 wparker </span><span>Could you give a concrete example @devn?  I&apos;m not sure what exactly you mean; session inspection has some things that might help.</span></div><div id="t1533931776000142" t="2018-08-10 20:09:36 devn @wparker I&apos;m looking to answer questions of &quot;what LHS conditions for which rules weren&apos;t satisfiable?&quot;

My understanding may be incorrect, but I seem to recall the condition matches from session inspection not including information on when a rule&apos;s conditions were partially satisfied."><a href="#t1533931776000142" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-10</span> <span class="t" onclick="H(this)">20:09:36</span>                    devn </span><span>@wparker I&apos;m looking to answer questions of &quot;what LHS conditions for which rules weren&apos;t satisfiable?&quot;

My understanding may be incorrect, but I seem to recall the condition matches from session inspection not including information on when a rule&apos;s conditions were partially satisfied.</span></div><div id="t1533931823000289" t="2018-08-10 20:10:23 devn truth: I keep avoiding working out a tracing listener setup that will give me the Real Ultimate Power™ I desire"><a href="#t1533931823000289" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-10</span> <span class="t" onclick="H(this)">20:10:23</span>                    devn </span><span>truth: I keep avoiding working out a tracing listener setup that will give me the Real Ultimate Power™ I desire</span></div><div id="t1533931931000161" t="2018-08-10 20:12:11 devn @alex-dixon I am reminded of a previous conversation that was had here about making something akin to precept-devtools work with clara. However, I am failing to remember details. Which parts of precept-devtools would not be possible without modification to clara?"><a href="#t1533931931000161" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-10</span> <span class="t" onclick="H(this)">20:12:11</span>                    devn </span><span>@alex-dixon I am reminded of a previous conversation that was had here about making something akin to precept-devtools work with clara. However, I am failing to remember details. Which parts of precept-devtools would not be possible without modification to clara?</span></div><div id="t1533933845000330" t="2018-08-10 20:44:05 alex-dixon @devn Pretty much all of it would need redone since it’s so Precept specific…"><a href="#t1533933845000330" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-10</span> <span class="t" onclick="H(this)">20:44:05</span>              alex-dixon </span><span>@devn Pretty much all of it would need redone since it’s so Precept specific…</span></div><div id="t1533933911000136" t="2018-08-10 20:45:11 alex-dixon Clara’s listeners API is what you’re looking for though. You should be able to see every operation the rule engine does"><a href="#t1533933911000136" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-10</span> <span class="t" onclick="H(this)">20:45:11</span>              alex-dixon </span><span>Clara’s listeners API is what you’re looking for though. You should be able to see every operation the rule engine does</span></div><div id="t1533933954000002" t="2018-08-10 20:45:54 alex-dixon I’ve only ever used the terminal node ones but they have everything…alpha activate, alpha retract…stuff I can’t remember"><a href="#t1533933954000002" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-10</span> <span class="t" onclick="H(this)">20:45:54</span>              alex-dixon </span><span>I’ve only ever used the terminal node ones but they have everything…alpha activate, alpha retract…stuff I can’t remember</span></div><div id="t1533933974000333" t="2018-08-10 20:46:14 alex-dixon If you’re interested in CR or rule engines whatsoever it’ll pay off I promise  🙂"><a href="#t1533933974000333" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-10</span> <span class="t" onclick="H(this)">20:46:14</span>              alex-dixon </span><span>If you’re interested in CR or rule engines whatsoever it’ll pay off I promise </span><b>🙂</b></div><div id="t1534115678000073" t="2018-08-12 23:14:38 devn @alex-dixon thanks for the reply. My coworkers and I are working on a (for now) private library called carla. We have a graph view and a rule summary view, a “who produces” and “who depends on” for facts. A tracing listener is coming."><a href="#t1534115678000073" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-12</span> <span class="t" onclick="H(this)">23:14:38</span>                    devn </span><span>@alex-dixon thanks for the reply. My coworkers and I are working on a (for now) private library called carla. We have a graph view and a rule summary view, a “who produces” and “who depends on” for facts. A tracing listener is coming.</span></div><div id="t1534115760000017" t="2018-08-12 23:16:00 devn The question that is most useful to answer for us is often “why didn’t this occur?” (Aka what is the chain of dependent rules that weren’t satisfied, with a root cause)"><a href="#t1534115760000017" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-12</span> <span class="t" onclick="H(this)">23:16:00</span>                    devn </span><span>The question that is most useful to answer for us is often “why didn’t this occur?” (Aka what is the chain of dependent rules that weren’t satisfied, with a root cause)</span></div><div id="t1534115819000064" t="2018-08-12 23:16:59 devn I’m reading a lot of precept code this weekend. Thanks again for putting out a great example of what can be achieved with tooling."><a href="#t1534115819000064" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-12</span> <span class="t" onclick="H(this)">23:16:59</span>                    devn </span><span>I’m reading a lot of precept code this weekend. Thanks again for putting out a great example of what can be achieved with tooling.</span></div><div id="t1534121970000076" t="2018-08-13 00:59:30 alex-dixon @devn rofl Carla "><a href="#t1534121970000076" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-13</span> <span class="t" onclick="H(this)">00:59:30</span>              alex-dixon </span><span>@devn rofl Carla </span></div><div id="t1534122015000108" t="2018-08-13 01:00:15 devn It makes requires confusing, but hilarious "><a href="#t1534122015000108" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-13</span> <span class="t" onclick="H(this)">01:00:15</span>                    devn </span><span>It makes requires confusing, but hilarious </span></div><div id="t1534122035000094" t="2018-08-13 01:00:35 alex-dixon That sounds awesome. Hickey had a recent podcast interview where he seemed to emphasize the role of what a thing provides and what it requires "><a href="#t1534122035000094" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-13</span> <span class="t" onclick="H(this)">01:00:35</span>              alex-dixon </span><span>That sounds awesome. Hickey had a recent podcast interview where he seemed to emphasize the role of what a thing provides and what it requires </span></div><div id="t1534122424000098" t="2018-08-13 01:07:04 alex-dixon Testing for a rule not firing seems hard but important from a practical standpoint "><a href="#t1534122424000098" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-13</span> <span class="t" onclick="H(this)">01:07:04</span>              alex-dixon </span><span>Testing for a rule not firing seems hard but important from a practical standpoint </span></div><div id="t1534122463000039" t="2018-08-13 01:07:43 alex-dixon From a more impractical one I guess we shouldn’t be writing rules expecting them to fire"><a href="#t1534122463000039" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-13</span> <span class="t" onclick="H(this)">01:07:43</span>              alex-dixon </span><span>From a more impractical one I guess we shouldn’t be writing rules expecting them to fire</span></div><div id="t1534502316000100" t="2018-08-17 10:38:36 Petrus Theron @henrik I&apos;m using Clara for something similar (low-cost housing bond approval process) and I&apos;m curious how you are modelling things like review/verification requests"><a href="#t1534502316000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-17</span> <span class="t" onclick="H(this)">10:38:36</span>           Petrus Theron </span><span>@henrik I&apos;m using Clara for something similar (low-cost housing bond approval process) and I&apos;m curious how you are modelling things like review/verification requests</span></div><div id="t1534502343000100" t="2018-08-17 10:39:03 Petrus Theron e.g. certain kinds of documents need to be reviewed and/or signed by certain kinds of people (e.g. Mortgage Lawyer, vs Transfer Lawyer)"><a href="#t1534502343000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-17</span> <span class="t" onclick="H(this)">10:39:03</span>           Petrus Theron </span><span>e.g. certain kinds of documents need to be reviewed and/or signed by certain kinds of people (e.g. Mortgage Lawyer, vs Transfer Lawyer)</span></div><div id="t1534516659000100" t="2018-08-17 14:37:39 Petrus Theron Is anyone using Clara or FactUI on its own, but with Datomic purely as a persistence layer? I&apos;m dealing with really small-scale volume of records, I just want rapid dev and flexible workflows."><a href="#t1534516659000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-17</span> <span class="t" onclick="H(this)">14:37:39</span>           Petrus Theron </span><span>Is anyone using Clara or FactUI on its own, but with Datomic purely as a persistence layer? I&apos;m dealing with really small-scale volume of records, I just want rapid dev and flexible workflows.</span></div><div id="t1534522981000100" t="2018-08-17 16:23:01 mikerod @petrus I don’t understand what you are asking for there. Do you mean to store the state of the rule network working memory or just the resulting facts?"><a href="#t1534522981000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-17</span> <span class="t" onclick="H(this)">16:23:01</span>                 mikerod </span><span>@petrus I don’t understand what you are asking for there. Do you mean to store the state of the rule network working memory or just the resulting facts?</span></div><div id="t1534522991000100" t="2018-08-17 16:23:11 mikerod The resulting facts, can be whatever you want and stored wherever you want."><a href="#t1534522991000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-17</span> <span class="t" onclick="H(this)">16:23:11</span>                 mikerod </span><span>The resulting facts, can be whatever you want and stored wherever you want.</span></div><div id="t1534523017000100" t="2018-08-17 16:23:37 mikerod So I think you may be asking about persisting the state of the rule network’s working memory, but not sure if that’s what you meant."><a href="#t1534523017000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-17</span> <span class="t" onclick="H(this)">16:23:37</span>                 mikerod </span><span>So I think you may be asking about persisting the state of the rule network’s working memory, but not sure if that’s what you meant.</span></div><div id="t1534702491000100" t="2018-08-19 18:14:51 clyfe ANN  https://github.com/clyfe/clara-eav"><a href="#t1534702491000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-19</span> <span class="t" onclick="H(this)">18:14:51</span>                   clyfe </span><span>ANN </span><a href="https://github.com/clyfe/clara-eav" target="_blank">https://github.com/clyfe/clara-eav</a></div><div id="t1534702502000100" t="2018-08-19 18:15:02 clyfe ClaraEAV is a thin layer over Clara-Rules API that simplifies working with EAV triplets"><a href="#t1534702502000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-19</span> <span class="t" onclick="H(this)">18:15:02</span>                   clyfe </span><span>ClaraEAV is a thin layer over Clara-Rules API that simplifies working with EAV triplets</span></div><div id="t1534702547000100" t="2018-08-19 18:15:47 clyfe Main benefit is updates are local to the attribute, maybe some of you find it useful."><a href="#t1534702547000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-19</span> <span class="t" onclick="H(this)">18:15:47</span>                   clyfe </span><span>Main benefit is updates are local to the attribute, maybe some of you find it useful.</span></div><div id="t1534709131000100" t="2018-08-19 20:05:31 mikerod @claudius.nicolae nice. I’ll have to take a look at that some more but seems pretty cool. I’ve heard of people using(or wanting to) EAV data in Clara and this looks like it can help"><a href="#t1534709131000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-19</span> <span class="t" onclick="H(this)">20:05:31</span>                 mikerod </span><span>@claudius.nicolae nice. I’ll have to take a look at that some more but seems pretty cool. I’ve heard of people using(or wanting to) EAV data in Clara and this looks like it can help</span></div><div id="t1534709344000100" t="2018-08-19 20:09:04 clyfe Thanks! Credit mainly goes to the precept project, mine is just a rehash. Nevertheless it may be of use."><a href="#t1534709344000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-19</span> <span class="t" onclick="H(this)">20:09:04</span>                   clyfe </span><span>Thanks! Credit mainly goes to the precept project, mine is just a rehash. Nevertheless it may be of use.</span></div><div id="t1534709560000100" t="2018-08-19 20:12:40 clyfe The guide explains it all pretty well  https://cljdoc.xyz/d/clyfe/clara-eav/0.1.5/doc/guide"><a href="#t1534709560000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-19</span> <span class="t" onclick="H(this)">20:12:40</span>                   clyfe </span><span>The guide explains it all pretty well </span><a href="https://cljdoc.xyz/d/clyfe/clara-eav/0.1.5/doc/guide" target="_blank">https://cljdoc.xyz/d/clyfe/clara-eav/0.1.5/doc/guide</a></div><div id="t1534715766000100" t="2018-08-19 21:56:06 mikerod Oh nice. I’ll read it. And yeah I knew Precept had done some interesting stuff around this. "><a href="#t1534715766000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-08-19</span> <span class="t" onclick="H(this)">21:56:06</span>                 mikerod </span><span>Oh nice. I’ll read it. And yeah I knew Precept had done some interesting stuff around this. </span></div><div id="t1536256121000100" t="2018-09-06 17:48:41 mikerod @claudius.nicolae (I believe you were the one who introduced this, but history has lost it) I finally read through the docs of  https://github.com/clyfe/clara-eav  . I think it looks cool. I plan to read through some of the impl some to see how you’ve accomplished some of this. I think the EAV-as-facts concept is a good one, especially in the Clojure community it seems. I know libs like  precept  have been doing it a while. It’s good to see a standalone impl now."><a href="#t1536256121000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-09-06</span> <span class="t" onclick="H(this)">17:48:41</span>                 mikerod </span><span>@claudius.nicolae (I believe you were the one who introduced this, but history has lost it) I finally read through the docs of </span><a href="https://github.com/clyfe/clara-eav" target="_blank">https://github.com/clyfe/clara-eav</a><span> . I think it looks cool. I plan to read through some of the impl some to see how you’ve accomplished some of this. I think the EAV-as-facts concept is a good one, especially in the Clojure community it seems. I know libs like </span><code>precept</code><span> have been doing it a while. It’s good to see a standalone impl now.</span></div><div id="t1538689598000100" t="2018-10-04 21:46:38 ryanbrush Just a heads up: we&apos;ve had a number of performance improvements and bug fixes merged to master since our last release, so it seems worthwhile to push another one. Unless there are objections, I&apos;ll plan on pushing 0.19.0 out of master in the near future."><a href="#t1538689598000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-04</span> <span class="t" onclick="H(this)">21:46:38</span>               ryanbrush </span><span>Just a heads up: we&apos;ve had a number of performance improvements and bug fixes merged to master since our last release, so it seems worthwhile to push another one. Unless there are objections, I&apos;ll plan on pushing 0.19.0 out of master in the near future.</span></div><div id="t1538693899000100" t="2018-10-04 22:58:19 ryanbrush And Clara 0.19.0 is released and up on Clojars! You can see the changelog for details:  https://github.com/cerner/clara-rules/blob/master/CHANGELOG.md"><a href="#t1538693899000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-04</span> <span class="t" onclick="H(this)">22:58:19</span>               ryanbrush </span><span>And Clara 0.19.0 is released and up on Clojars! You can see the changelog for details: </span><a href="https://github.com/cerner/clara-rules/blob/master/CHANGELOG.md" target="_blank">https://github.com/cerner/clara-rules/blob/master/CHANGELOG.md</a></div><div id="t1540303649000100" t="2018-10-23 14:07:29 dhruv1 hello.

In clara, how can i write recursive queries?"><a href="#t1540303649000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-23</span> <span class="t" onclick="H(this)">14:07:29</span>                  dhruv1 </span><span>hello.

In clara, how can i write recursive queries?</span></div><div id="t1540303664000100" t="2018-10-23 14:07:44 dhruv1 here is an example of the data I have:"><a href="#t1540303664000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-23</span> <span class="t" onclick="H(this)">14:07:44</span>                  dhruv1 </span><span>here is an example of the data I have:</span></div><div id="t1540303671000100" t="2018-10-23 14:07:51 dhruv1 {:type :foo
 :desc &quot;&apos;Foo&apos; node&quot;
 :parent :D}

{:type :D
 :desc &quot;&apos;D&apos; node&quot;
 :parent :C}

{:type :C
 :desc &quot;&apos;C&apos; node&quot;
 :parent :B}

{:type :B
 :desc &quot;&apos;B&apos; node&quot;
 :parent :A}

{:type :A
 :desc &quot;&apos;A&apos; node&quot;}"><a href="#t1540303671000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-23</span> <span class="t" onclick="H(this)">14:07:51</span>                  dhruv1 </span><pre>{:type :foo
 :desc &quot;&apos;Foo&apos; node&quot;
 :parent :D}

{:type :D
 :desc &quot;&apos;D&apos; node&quot;
 :parent :C}

{:type :C
 :desc &quot;&apos;C&apos; node&quot;
 :parent :B}

{:type :B
 :desc &quot;&apos;B&apos; node&quot;
 :parent :A}

{:type :A
 :desc &quot;&apos;A&apos; node&quot;}</pre></div><div id="t1540303782000100" t="2018-10-23 14:09:42 dhruv1 here is what i would like the output of the query to look like:"><a href="#t1540303782000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-23</span> <span class="t" onclick="H(this)">14:09:42</span>                  dhruv1 </span><span>here is what i would like the output of the query to look like:</span></div><div id="t1540303800000100" t="2018-10-23 14:10:00 dhruv1 &apos;(:?node {:type :foo
          :desc &quot;&apos;Foo&apos; node&quot;
          :parent :D}
         
       :?parents [{:type :D
                      :desc &quot;&apos;D&apos; node&quot;
                     :parent :C}

                    {:type :C
                     :desc &quot;&apos;C&apos; node&quot;
                     :parent :B}

                    {:type :B
                     :desc &quot;&apos;B&apos; node&quot;
                     :parent :A}

                    {:type :A
                     :desc &quot;&apos;A&apos; node&quot;}])"><a href="#t1540303800000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-23</span> <span class="t" onclick="H(this)">14:10:00</span>                  dhruv1 </span><pre>&apos;(:?node {:type :foo
          :desc &quot;&apos;Foo&apos; node&quot;
          :parent :D}
         
       :?parents [{:type :D
                      :desc &quot;&apos;D&apos; node&quot;
                     :parent :C}

                    {:type :C
                     :desc &quot;&apos;C&apos; node&quot;
                     :parent :B}

                    {:type :B
                     :desc &quot;&apos;B&apos; node&quot;
                     :parent :A}

                    {:type :A
                     :desc &quot;&apos;A&apos; node&quot;}])</pre></div><div id="t1540303911000100" t="2018-10-23 14:11:51 dhruv1 is this possible with a clara query?"><a href="#t1540303911000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-23</span> <span class="t" onclick="H(this)">14:11:51</span>                  dhruv1 </span><span>is this possible with a clara query?</span></div><div id="t1540309654000100" t="2018-10-23 15:47:34 eraserhd Not with just a query, you&apos;ll need to introduce some facts."><a href="#t1540309654000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-23</span> <span class="t" onclick="H(this)">15:47:34</span>                eraserhd </span><span>Not with just a query, you&apos;ll need to introduce some facts.</span></div><div id="t1540309874000100" t="2018-10-23 15:51:14 eraserhd So you&apos;d have one rule that&apos;s (heavily abbreviating the code): [:test (no-children? ?node)] =&gt; (insert! (-&gt;TreeRep ?node ?node))).  And one that&apos;s [:test (children? ?node)]  ?children &lt;- (acc/all) :from [Node (= parent ?node)] =&gt; (insert! (-&gt;TreeRep ?node (add-children ?node ?children)))."><a href="#t1540309874000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-23</span> <span class="t" onclick="H(this)">15:51:14</span>                eraserhd </span><span>So you&apos;d have one rule that&apos;s (heavily abbreviating the code): [:test (no-children? ?node)] =&gt; (insert! (-&gt;TreeRep ?node ?node))).  And one that&apos;s [:test (children? ?node)]  ?children &lt;- (acc/all) :from [Node (= parent ?node)] =&gt; (insert! (-&gt;TreeRep ?node (add-children ?node ?children))).</span></div><div id="t1540309933000100" t="2018-10-23 15:52:13 eraserhd Assuming your graph is acyclic.  If it isn&apos;t, this will be bad."><a href="#t1540309933000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-23</span> <span class="t" onclick="H(this)">15:52:13</span>                eraserhd </span><span>Assuming your graph is acyclic.  If it isn&apos;t, this will be bad.</span></div><div id="t1540310012000100" t="2018-10-23 15:53:32 eraserhd It might be doable with one rule, actually.  But the point is, AFAICT, there&apos;s no way to recurse without inserting facts."><a href="#t1540310012000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-23</span> <span class="t" onclick="H(this)">15:53:32</span>                eraserhd </span><span>It might be doable with one rule, actually.  But the point is, AFAICT, there&apos;s no way to recurse without inserting facts.</span></div><div id="t1540310510000100" t="2018-10-23 16:01:50 dhruv1 Ah understood.  "><a href="#t1540310510000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-23</span> <span class="t" onclick="H(this)">16:01:50</span>                  dhruv1 </span><span>Ah understood.  </span></div><div id="t1540310524000100" t="2018-10-23 16:02:04 dhruv1 Will give that a go. Thank you!"><a href="#t1540310524000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-23</span> <span class="t" onclick="H(this)">16:02:04</span>                  dhruv1 </span><span>Will give that a go. Thank you!</span></div><div id="t1540311178000100" t="2018-10-23 16:12:58 eraserhd Oh, you want to (acc/all) :from [TreeRep ...], probably."><a href="#t1540311178000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-23</span> <span class="t" onclick="H(this)">16:12:58</span>                eraserhd </span><span>Oh, you want to (acc/all) :from [TreeRep ...], probably.</span></div><div id="t1540311214000100" t="2018-10-23 16:13:34 eraserhd You could also do this with a custom accumulator, but that would be much harder, I&apos;m guessing."><a href="#t1540311214000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-23</span> <span class="t" onclick="H(this)">16:13:34</span>                eraserhd </span><span>You could also do this with a custom accumulator, but that would be much harder, I&apos;m guessing.</span></div><div id="t1540311370000100" t="2018-10-23 16:16:10 mikerod @eraserhd I was thinking along those same lines"><a href="#t1540311370000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-23</span> <span class="t" onclick="H(this)">16:16:10</span>                 mikerod </span><span>@eraserhd I was thinking along those same lines</span></div><div id="t1540311378000100" t="2018-10-23 16:16:18 mikerod about having to introduce some facts to model it"><a href="#t1540311378000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-23</span> <span class="t" onclick="H(this)">16:16:18</span>                 mikerod </span><span>about having to introduce some facts to model it</span></div><div id="t1540311940000100" t="2018-10-23 16:25:40 eraserhd By the way,  👋  clara people!  We are starting to rely heavily on this for work, and it is a good thing."><a href="#t1540311940000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-23</span> <span class="t" onclick="H(this)">16:25:40</span>                eraserhd </span><span>By the way, </span><b>👋</b><span> clara people!  We are starting to rely heavily on this for work, and it is a good thing.</span></div><div id="t1540314249000100" t="2018-10-23 17:04:09 mikerod Nice. What sort of things are you using it for (if you can say) and clj or cljs? "><a href="#t1540314249000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-23</span> <span class="t" onclick="H(this)">17:04:09</span>                      mikerod </span><span>Nice. What sort of things are you using it for (if you can say) and clj or cljs? </span></div><div id="t1540314969000100" t="2018-10-23 17:16:09 eraserhd clj, only"><a href="#t1540314969000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-23</span> <span class="t" onclick="H(this)">17:16:09</span>                     eraserhd </span><span>clj, only</span></div><div id="t1540315010000100" t="2018-10-23 17:16:50 eraserhd We are storing data in Datomic, and importing the facts, and deriving a bunch of stuff from them."><a href="#t1540315010000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-23</span> <span class="t" onclick="H(this)">17:16:50</span>                     eraserhd </span><span>We are storing data in Datomic, and importing the facts, and deriving a bunch of stuff from them.</span></div><div id="t1540315033000100" t="2018-10-23 17:17:13 eraserhd This includes constraint validation, what we are calling &quot;synthetic attributes&quot;, which are computed attributes."><a href="#t1540315033000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-23</span> <span class="t" onclick="H(this)">17:17:13</span>                     eraserhd </span><span>This includes constraint validation, what we are calling &quot;synthetic attributes&quot;, which are computed attributes.</span></div><div id="t1540315056000100" t="2018-10-23 17:17:36 eraserhd This is all business data about the online degree programs we are hosting."><a href="#t1540315056000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-23</span> <span class="t" onclick="H(this)">17:17:36</span>                     eraserhd </span><span>This is all business data about the online degree programs we are hosting.</span></div><div id="t1540315070000100" t="2018-10-23 17:17:50 eraserhd And this system drives the stand up of new systems."><a href="#t1540315070000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-23</span> <span class="t" onclick="H(this)">17:17:50</span>                     eraserhd </span><span>And this system drives the stand up of new systems.</span></div><div id="t1540315237000100" t="2018-10-23 17:20:37 mikerod oh that’s cool"><a href="#t1540315237000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-23</span> <span class="t" onclick="H(this)">17:20:37</span>                      mikerod </span><span>oh that’s cool</span></div><div id="t1540315269000100" t="2018-10-23 17:21:09 mikerod there was a datomic “datom” integration lib with clara"><a href="#t1540315269000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-23</span> <span class="t" onclick="H(this)">17:21:09</span>                      mikerod </span><span>there was a datomic “datom” integration lib with clara</span></div><div id="t1540315274000100" t="2018-10-23 17:21:14 mikerod was that related or something you’ve seen?"><a href="#t1540315274000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-23</span> <span class="t" onclick="H(this)">17:21:14</span>                      mikerod </span><span>was that related or something you’ve seen?</span></div><div id="t1540315322000100" t="2018-10-23 17:22:02 eraserhd We built our own, and we have a library we are attempting to Open Source  :crossed_fingers:"><a href="#t1540315322000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-23</span> <span class="t" onclick="H(this)">17:22:02</span>                     eraserhd </span><span>We built our own, and we have a library we are attempting to Open Source </span><b>:crossed_fingers:</b></div><div id="t1540315337000100" t="2018-10-23 17:22:17 eraserhd Not specifically about Datoms"><a href="#t1540315337000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-23</span> <span class="t" onclick="H(this)">17:22:17</span>                     eraserhd </span><span>Not specifically about Datoms</span></div><div id="t1540315368000100" t="2018-10-23 17:22:48 mikerod ah ok"><a href="#t1540315368000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-23</span> <span class="t" onclick="H(this)">17:22:48</span>                      mikerod </span><span>ah ok</span></div><div id="t1540315379000100" t="2018-10-23 17:22:59 mikerod I’m trying to find the github link I had for that before, but was interesting"><a href="#t1540315379000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-23</span> <span class="t" onclick="H(this)">17:22:59</span>                      mikerod </span><span>I’m trying to find the github link I had for that before, but was interesting</span></div><div id="t1540315387000100" t="2018-10-23 17:23:07 mikerod but would be really interesting if you open sourced hah"><a href="#t1540315387000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-23</span> <span class="t" onclick="H(this)">17:23:07</span>                      mikerod </span><span>but would be really interesting if you open sourced hah</span></div><div id="t1540315407000100" t="2018-10-23 17:23:27 mikerod ah yeah, it was this clara-eav  https://github.com/clyfe/clara-eav"><a href="#t1540315407000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-23</span> <span class="t" onclick="H(this)">17:23:27</span>                      mikerod </span><span>ah yeah, it was this clara-eav </span><a href="https://github.com/clyfe/clara-eav" target="_blank">https://github.com/clyfe/clara-eav</a></div><div id="t1540316102000100" t="2018-10-23 17:35:02 eraserhd @U0LK1552A This actually looks pretty neat.  Our library does a different thing, regarding bulk loading facts from datomic and caching intermediate sessions to save work.  It seems like we could use them together."><a href="#t1540316102000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-23</span> <span class="t" onclick="H(this)">17:35:02</span>                     eraserhd </span><span>@U0LK1552A This actually looks pretty neat.  Our library does a different thing, regarding bulk loading facts from datomic and caching intermediate sessions to save work.  It seems like we could use them together.</span></div><div id="t1540316377000100" t="2018-10-23 17:39:37 mikerod interesting"><a href="#t1540316377000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-23</span> <span class="t" onclick="H(this)">17:39:37</span>                      mikerod </span><span>interesting</span></div><div id="t1540316383000100" t="2018-10-23 17:39:43 mikerod caching intermediate sessions seems interesting too"><a href="#t1540316383000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-23</span> <span class="t" onclick="H(this)">17:39:43</span>                      mikerod </span><span>caching intermediate sessions seems interesting too</span></div><div id="t1540316388000100" t="2018-10-23 17:39:48 mikerod seems like some durability stuff I messed with before"><a href="#t1540316388000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-23</span> <span class="t" onclick="H(this)">17:39:48</span>                      mikerod </span><span>seems like some durability stuff I messed with before</span></div><div id="t1540316400000100" t="2018-10-23 17:40:00 mikerod (well I wrote that stuff in clara originally to try some things out)"><a href="#t1540316400000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-23</span> <span class="t" onclick="H(this)">17:40:00</span>                      mikerod </span><span>(well I wrote that stuff in clara originally to try some things out)</span></div><div id="t1540388542000100" t="2018-10-24 13:42:22 eraserhd I found a paper about the LEAPS algorithm, which apparently out-performs RETE by using gasp laziness.  I wonder if any LEAPS stuff was incorporated into Clara?"><a href="#t1540388542000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-24</span> <span class="t" onclick="H(this)">13:42:22</span>                eraserhd </span><span>I found a paper about the LEAPS algorithm, which apparently out-performs RETE by using gasp laziness.  I wonder if any LEAPS stuff was incorporated into Clara?</span></div><div id="t1540388602000100" t="2018-10-24 13:43:22 eraserhd This one:  http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.96.5371&amp;amp;rep=rep1&amp;amp;type=pdf"><a href="#t1540388602000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-24</span> <span class="t" onclick="H(this)">13:43:22</span>                eraserhd </span><span>This one: </span><a href="http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.96.5371&amp;amp;rep=rep1&amp;amp;type=pdf" target="_blank">http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.96.5371&amp;amp;rep=rep1&amp;amp;type=pdf</a></div><div id="t1540389738000100" t="2018-10-24 14:02:18 mikerod @eraserhd I don’t see the date on this some reason"><a href="#t1540389738000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-24</span> <span class="t" onclick="H(this)">14:02:18</span>                 mikerod </span><span>@eraserhd I don’t see the date on this some reason</span></div><div id="t1540389766000100" t="2018-10-24 14:02:46 eraserhd It&apos;s old, like 94 or something."><a href="#t1540389766000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-24</span> <span class="t" onclick="H(this)">14:02:46</span>                eraserhd </span><span>It&apos;s old, like 94 or something.</span></div><div id="t1540389769000100" t="2018-10-24 14:02:49 mikerod but I know I’ve read about LEAPS before."><a href="#t1540389769000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-24</span> <span class="t" onclick="H(this)">14:02:49</span>                 mikerod </span><span>but I know I’ve read about LEAPS before.</span></div><div id="t1540389787000100" t="2018-10-24 14:03:07 mikerod It is comparing to the traditional rete used in the OPS5 and perhaps a few others at the time"><a href="#t1540389787000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-24</span> <span class="t" onclick="H(this)">14:03:07</span>                 mikerod </span><span>It is comparing to the traditional rete used in the OPS5 and perhaps a few others at the time</span></div><div id="t1540389794000100" t="2018-10-24 14:03:14 mikerod things were quite a bit different in those I believe"><a href="#t1540389794000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-24</span> <span class="t" onclick="H(this)">14:03:14</span>                 mikerod </span><span>things were quite a bit different in those I believe</span></div><div id="t1540389805000100" t="2018-10-24 14:03:25 mikerod Clara takes advantage of batch-oriented fact propagation"><a href="#t1540389805000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-24</span> <span class="t" onclick="H(this)">14:03:25</span>                 mikerod </span><span>Clara takes advantage of batch-oriented fact propagation</span></div><div id="t1540389831000100" t="2018-10-24 14:03:51 mikerod I am of the opinion that that is the biggest perf win"><a href="#t1540389831000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-24</span> <span class="t" onclick="H(this)">14:03:51</span>                 mikerod </span><span>I am of the opinion that that is the biggest perf win</span></div><div id="t1540389860000100" t="2018-10-24 14:04:20 mikerod over any sort of laziness. However, Drools (popular JVM/Java based rules engine) went to a custom algo they decided was sufficiently different enough to get a new name"><a href="#t1540389860000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-24</span> <span class="t" onclick="H(this)">14:04:20</span>                 mikerod </span><span>over any sort of laziness. However, Drools (popular JVM/Java based rules engine) went to a custom algo they decided was sufficiently different enough to get a new name</span></div><div id="t1540389863000100" t="2018-10-24 14:04:23 mikerod “PHREAK”"><a href="#t1540389863000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-24</span> <span class="t" onclick="H(this)">14:04:23</span>                 mikerod </span><span>“PHREAK”</span></div><div id="t1540389871000100" t="2018-10-24 14:04:31 mikerod in Drools 6, they wrote some good stuff on it"><a href="#t1540389871000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-24</span> <span class="t" onclick="H(this)">14:04:31</span>                 mikerod </span><span>in Drools 6, they wrote some good stuff on it</span></div><div id="t1540389888000100" t="2018-10-24 14:04:48 mikerod but it was meant to be lazier and to do things like cut parts of the rete tree off when they aren’t needed"><a href="#t1540389888000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-24</span> <span class="t" onclick="H(this)">14:04:48</span>                 mikerod </span><span>but it was meant to be lazier and to do things like cut parts of the rete tree off when they aren’t needed</span></div><div id="t1540389916000100" t="2018-10-24 14:05:16 mikerod the unfortunate part of that upgrade was that Drools went from eager and single fact propagation to this lazier and batched propagation"><a href="#t1540389916000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-24</span> <span class="t" onclick="H(this)">14:05:16</span>                 mikerod </span><span>the unfortunate part of that upgrade was that Drools went from eager and single fact propagation to this lazier and batched propagation</span></div><div id="t1540389922000100" t="2018-10-24 14:05:22 mikerod and I think the batching is the bigger win"><a href="#t1540389922000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-24</span> <span class="t" onclick="H(this)">14:05:22</span>                 mikerod </span><span>and I think the batching is the bigger win</span></div><div id="t1540389945000100" t="2018-10-24 14:05:45 mikerod So the topic of being lazier in Clara has came up before"><a href="#t1540389945000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-24</span> <span class="t" onclick="H(this)">14:05:45</span>                 mikerod </span><span>So the topic of being lazier in Clara has came up before</span></div><div id="t1540389972000100" t="2018-10-24 14:06:12 mikerod but hasn’t been done since it isn’t clear how much you really gain from that over the batched propagations."><a href="#t1540389972000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-24</span> <span class="t" onclick="H(this)">14:06:12</span>                 mikerod </span><span>but hasn’t been done since it isn’t clear how much you really gain from that over the batched propagations.</span></div><div id="t1540389985000100" t="2018-10-24 14:06:25 mikerod that is assuming you have queries that you intend to use"><a href="#t1540389985000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-24</span> <span class="t" onclick="H(this)">14:06:25</span>                 mikerod </span><span>that is assuming you have queries that you intend to use</span></div><div id="t1540390011000200" t="2018-10-24 14:06:51 mikerod if you had like 10 queries and were only going to want to perform 1 of them a lot of the time or something like that, then there may be a bigger win to delaying things"><a href="#t1540390011000200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-24</span> <span class="t" onclick="H(this)">14:06:51</span>                 mikerod </span><span>if you had like 10 queries and were only going to want to perform 1 of them a lot of the time or something like that, then there may be a bigger win to delaying things</span></div><div id="t1540390011000300" t="2018-10-24 14:06:51 eraserhd I&apos;m only a little way in, and I haven&apos;t seen the laziness part yet (even though it&apos;s claimed in the abstract).  It so far has claimed that the biggest win is not needing to materialize facts in memory.  I don&apos;t understand it yet."><a href="#t1540390011000300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-24</span> <span class="t" onclick="H(this)">14:06:51</span>                eraserhd </span><span>I&apos;m only a little way in, and I haven&apos;t seen the laziness part yet (even though it&apos;s claimed in the abstract).  It so far has claimed that the biggest win is not needing to materialize facts in memory.  I don&apos;t understand it yet.</span></div><div id="t1540390026000100" t="2018-10-24 14:07:06 mikerod also, keep in mind, these older papers"><a href="#t1540390026000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-24</span> <span class="t" onclick="H(this)">14:07:06</span>                 mikerod </span><span>also, keep in mind, these older papers</span></div><div id="t1540390037000100" t="2018-10-24 14:07:17 mikerod they have some good material for sure, but have to be aware of the environments there were dealing with"><a href="#t1540390037000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-24</span> <span class="t" onclick="H(this)">14:07:17</span>                 mikerod </span><span>they have some good material for sure, but have to be aware of the environments there were dealing with</span></div><div id="t1540390077000100" t="2018-10-24 14:07:57 mikerod e.g. sometimes they are really emphasizing using minimal memory (was more constrained then), or higher allocation costs etc"><a href="#t1540390077000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-24</span> <span class="t" onclick="H(this)">14:07:57</span>                 mikerod </span><span>e.g. sometimes they are really emphasizing using minimal memory (was more constrained then), or higher allocation costs etc</span></div><div id="t1540390101000100" t="2018-10-24 14:08:21 mikerod it’s just something to be aware of, still good material out there and most of it is pretty old"><a href="#t1540390101000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-24</span> <span class="t" onclick="H(this)">14:08:21</span>                 mikerod </span><span>it’s just something to be aware of, still good material out there and most of it is pretty old</span></div><div id="t1540390139000200" t="2018-10-24 14:08:59 mikerod also, sometimes things are explaining a situation that is most helpful when dealing with a large number of rules, other times its for dealing with a large number of facts, and occasionally perhaps a large number of both is discussed"><a href="#t1540390139000200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-24</span> <span class="t" onclick="H(this)">14:08:59</span>                 mikerod </span><span>also, sometimes things are explaining a situation that is most helpful when dealing with a large number of rules, other times its for dealing with a large number of facts, and occasionally perhaps a large number of both is discussed</span></div><div id="t1540390161000100" t="2018-10-24 14:09:21 eraserhd yup.  But I read things like this as a hobby, honestly."><a href="#t1540390161000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-24</span> <span class="t" onclick="H(this)">14:09:21</span>                eraserhd </span><span>yup.  But I read things like this as a hobby, honestly.</span></div><div id="t1540390174000100" t="2018-10-24 14:09:34 eraserhd I&apos;m not suddenly suggesting that we must implement this  😄"><a href="#t1540390174000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-24</span> <span class="t" onclick="H(this)">14:09:34</span>                eraserhd </span><span>I&apos;m not suddenly suggesting that we must implement this </span><b>😄</b></div><div id="t1540390196000200" t="2018-10-24 14:09:56 mikerod no, it’s good to discuss and to think about"><a href="#t1540390196000200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-24</span> <span class="t" onclick="H(this)">14:09:56</span>                 mikerod </span><span>no, it’s good to discuss and to think about</span></div><div id="t1540390198000100" t="2018-10-24 14:09:58 eraserhd In fact, it would be neat if there was a bibliography for Clara Rules."><a href="#t1540390198000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-24</span> <span class="t" onclick="H(this)">14:09:58</span>                eraserhd </span><span>In fact, it would be neat if there was a bibliography for Clara Rules.</span></div><div id="t1540390224000100" t="2018-10-24 14:10:24 mikerod quite a bit of perf-related work has been done in Clara already"><a href="#t1540390224000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-24</span> <span class="t" onclick="H(this)">14:10:24</span>                 mikerod </span><span>quite a bit of perf-related work has been done in Clara already</span></div><div id="t1540390245000200" t="2018-10-24 14:10:45 mikerod some of that was just impl details and other things were tweaks to propagation or often accumulators"><a href="#t1540390245000200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-24</span> <span class="t" onclick="H(this)">14:10:45</span>                 mikerod </span><span>some of that was just impl details and other things were tweaks to propagation or often accumulators</span></div><div id="t1540390285000100" t="2018-10-24 14:11:25 eraserhd Neat... I got that impression.  It performs super well for us."><a href="#t1540390285000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-24</span> <span class="t" onclick="H(this)">14:11:25</span>                eraserhd </span><span>Neat... I got that impression.  It performs super well for us.</span></div><div id="t1540486518000100" t="2018-10-25 16:55:18 wparker @eraserhd Agreed with @U0LK1552A’s previous comments - Another interesting way that this played out (both myself and Mike spent a while doing perf optimizations on Clara) is that in practice, it turned out that even for large cases (hundreds of thousands of facts/tens of thousands of rules) the constant factors seemed to be most important.  Hashing turned out to be a large percentage of work performed for example.  A lot of these optimizations (on the Clojure side) are in the memory.cljc namespace with lots of Java interop etc.  That said, this was in use-cases where we didn’t really have lots of data that we were just going to end up discarding, and there’s definitely cases where more laziness could be useful."><a href="#t1540486518000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-25</span> <span class="t" onclick="H(this)">16:55:18</span>                      wparker </span><span>@eraserhd Agreed with @U0LK1552A’s previous comments - Another interesting way that this played out (both myself and Mike spent a while doing perf optimizations on Clara) is that in practice, it turned out that even for large cases (hundreds of thousands of facts/tens of thousands of rules) the constant factors seemed to be most important.  Hashing turned out to be a large percentage of work performed for example.  A lot of these optimizations (on the Clojure side) are in the memory.cljc namespace with lots of Java interop etc.  That said, this was in use-cases where we didn’t really have lots of data that we were just going to end up discarding, and there’s definitely cases where more laziness could be useful.</span></div><div id="t1540390320000100" t="2018-10-24 14:12:00 mikerod Clara make some small mention to background here  https://github.com/cerner/clara-rules/wiki/Introduction#the-rules-engine"><a href="#t1540390320000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-24</span> <span class="t" onclick="H(this)">14:12:00</span>                 mikerod </span><span>Clara make some small mention to background here </span><a href="https://github.com/cerner/clara-rules/wiki/Introduction#the-rules-engine" target="_blank">https://github.com/cerner/clara-rules/wiki/Introduction#the-rules-engine</a></div><div id="t1540390334000100" t="2018-10-24 14:12:14 mikerod The paper referenced there is  http://reports-archive.adm.cs.cmu.edu/anon/1995/CMU-CS-95-113.pdf"><a href="#t1540390334000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-24</span> <span class="t" onclick="H(this)">14:12:14</span>                 mikerod </span><span>The paper referenced there is </span><a href="http://reports-archive.adm.cs.cmu.edu/anon/1995/CMU-CS-95-113.pdf" target="_blank">http://reports-archive.adm.cs.cmu.edu/anon/1995/CMU-CS-95-113.pdf</a></div><div id="t1540390371000100" t="2018-10-24 14:12:51 mikerod It is concerned with the ops system I think. It’s long and not all that relevant to current stuff, but there are some nice fundamental chapters in it"><a href="#t1540390371000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-24</span> <span class="t" onclick="H(this)">14:12:51</span>                 mikerod </span><span>It is concerned with the ops system I think. It’s long and not all that relevant to current stuff, but there are some nice fundamental chapters in it</span></div><div id="t1540390393000100" t="2018-10-24 14:13:13 mikerod Starts with a very basic description of a simple rete impl, and then discusses some interesting ways to improve it, such as left and right unlinking"><a href="#t1540390393000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-24</span> <span class="t" onclick="H(this)">14:13:13</span>                 mikerod </span><span>Starts with a very basic description of a simple rete impl, and then discusses some interesting ways to improve it, such as left and right unlinking</span></div><div id="t1540390442000100" t="2018-10-24 14:14:02 mikerod and Drools has a lot of extra stuff going on that is left out of Clara, but they do have some good docs on approaches  https://docs.jboss.org/drools/release/6.2.0.CR2/drools-docs/html/HybridReasoningChapter.html#ReteOO"><a href="#t1540390442000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-24</span> <span class="t" onclick="H(this)">14:14:02</span>                 mikerod </span><span>and Drools has a lot of extra stuff going on that is left out of Clara, but they do have some good docs on approaches </span><a href="https://docs.jboss.org/drools/release/6.2.0.CR2/drools-docs/html/HybridReasoningChapter.html#ReteOO" target="_blank">https://docs.jboss.org/drools/release/6.2.0.CR2/drools-docs/html/HybridReasoningChapter.html#ReteOO</a></div><div id="t1540390573000100" t="2018-10-24 14:16:13 mikerod That’s their newer one. Not the same as Clara, but there are some commonalities in some the ideas. It also may explain some of the deficiencies in the overly simple approach traditionally taken."><a href="#t1540390573000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-24</span> <span class="t" onclick="H(this)">14:16:13</span>                 mikerod </span><span>That’s their newer one. Not the same as Clara, but there are some commonalities in some the ideas. It also may explain some of the deficiencies in the overly simple approach traditionally taken.</span></div><div id="t1540391216000100" t="2018-10-24 14:26:56 eraserhd Nice, thank you!  I&apos;ve queued all that up for bedtime reading."><a href="#t1540391216000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-24</span> <span class="t" onclick="H(this)">14:26:56</span>                eraserhd </span><span>Nice, thank you!  I&apos;ve queued all that up for bedtime reading.</span></div><div id="t1540391931000100" t="2018-10-24 14:38:51 mikerod sure, sorry it isn’t super organized - reference dump"><a href="#t1540391931000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-24</span> <span class="t" onclick="H(this)">14:38:51</span>                 mikerod </span><span>sure, sorry it isn’t super organized - reference dump</span></div><div id="t1540419351000100" t="2018-10-24 22:15:51 jvtrigueros I&apos;m trying out Clara, but I&apos;m hitting an issue, perhaps I&apos;m using it wrong, here&apos;s the simplest snippet that shows my issue:
 (defrecord Request [resource])

(defn condition
  [x y]
  (= x y))

(defrule some-rule
  [Request (condition ?resource resource)]
  =&gt;
  (println ?resource))

(mk-session)
 
I&apos;m getting an error about  ?resource  not being bound, however if I replace  condition  with  =  this works.

I didn&apos;t see anything in the Boolean Expressions documentation about not being able to use other functions, however if that&apos;s the case, how does one go about doing this?"><a href="#t1540419351000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-24</span> <span class="t" onclick="H(this)">22:15:51</span>             jvtrigueros </span><span>I&apos;m trying out Clara, but I&apos;m hitting an issue, perhaps I&apos;m using it wrong, here&apos;s the simplest snippet that shows my issue:
</span><pre>(defrecord Request [resource])

(defn condition
  [x y]
  (= x y))

(defrule some-rule
  [Request (condition ?resource resource)]
  =&gt;
  (println ?resource))

(mk-session)
</pre><span>
I&apos;m getting an error about </span><code>?resource</code><span> not being bound, however if I replace </span><code>condition</code><span> with </span><code>=</code><span> this works.

I didn&apos;t see anything in the Boolean Expressions documentation about not being able to use other functions, however if that&apos;s the case, how does one go about doing this?</span></div><div id="t1540419661000100" t="2018-10-24 22:21:01 souenzzo [Request (= ?resource resource)]
[:test (condition? ?resource)]
=&gt;
(prn ?resource)
"><a href="#t1540419661000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-24</span> <span class="t" onclick="H(this)">22:21:01</span>                souenzzo </span><pre>[Request (= ?resource resource)]
[:test (condition? ?resource)]
=&gt;
(prn ?resource)
</pre></div><div id="t1540473946000100" t="2018-10-25 13:25:46 ethanc Probably not relevant and more of an FYI, but if the  condition?  is simply equality it could be done with a third argument to  = .

 (r/defrule some-rule
  [Request (= ?resource resource &quot;GET&quot;)]
  =&gt;
  (println ?resource))
"><a href="#t1540473946000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-25</span> <span class="t" onclick="H(this)">13:25:46</span>                       ethanc </span><span>Probably not relevant and more of an FYI, but if the </span><code>condition?</code><span> is simply equality it could be done with a third argument to </span><code>=</code><span>.

</span><pre>(r/defrule some-rule
  [Request (= ?resource resource &quot;GET&quot;)]
  =&gt;
  (println ?resource))
</pre></div><div id="t1540474979000100" t="2018-10-25 13:42:59 souenzzo [Request (= resource &quot;GET&quot;)]
=&gt;
(prn &quot;GET&quot;)
 
Onde it will only match if  resource  is  GET   😅"><a href="#t1540474979000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-25</span> <span class="t" onclick="H(this)">13:42:59</span>                     souenzzo </span><pre>[Request (= resource &quot;GET&quot;)]
=&gt;
(prn &quot;GET&quot;)
</pre><span>
Onde it will only match if </span><code>resource</code><span> is </span><code>GET</code><span> </span><b>😅</b></div><div id="t1540475031000100" t="2018-10-25 13:43:51 souenzzo you can also do
 [?request &lt;- Request (= resource &quot;GET&quot;)]
=&gt;
(prn ?request)
 
Will print the &quot;full record&quot;"><a href="#t1540475031000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-25</span> <span class="t" onclick="H(this)">13:43:51</span>                     souenzzo </span><span>you can also do
</span><pre>[?request &lt;- Request (= resource &quot;GET&quot;)]
=&gt;
(prn ?request)
</pre><span>
Will print the &quot;full record&quot;</span></div><div id="t1540475970000100" t="2018-10-25 13:59:30 jvtrigueros Thanks @U3KC48GHW ! This is actually something that I did need (for a different rule)"><a href="#t1540475970000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-25</span> <span class="t" onclick="H(this)">13:59:30</span>                  jvtrigueros </span><span>Thanks @U3KC48GHW ! This is actually something that I did need (for a different rule)</span></div><div id="t1540419677000100" t="2018-10-24 22:21:17 souenzzo @jvtrigueros"><a href="#t1540419677000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-24</span> <span class="t" onclick="H(this)">22:21:17</span>                souenzzo </span><span>@jvtrigueros</span></div><div id="t1540420408000100" t="2018-10-24 22:33:28 jvtrigueros How does this work? In this contrived example  condition  takes two arguments but here it&apos;s just one.  🤔 

Or perhaps you could point me to the literature for this"><a href="#t1540420408000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-24</span> <span class="t" onclick="H(this)">22:33:28</span>             jvtrigueros </span><span>How does this work? In this contrived example </span><code>condition</code><span> takes two arguments but here it&apos;s just one. </span><b>🤔</b><span>

Or perhaps you could point me to the literature for this</span></div><div id="t1540420757000100" t="2018-10-24 22:39:17 souenzzo (= ?resource resource)  it not a function call. it just a DSL to bind the value of  resource  (form record) to  ?resorce  (symbol)"><a href="#t1540420757000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-24</span> <span class="t" onclick="H(this)">22:39:17</span>                souenzzo </span><code>(= ?resource resource)</code><span> it not a function call. it just a DSL to bind the value of </span><code>resource</code><span> (form record) to </span><code>?resorce</code><span> (symbol)</span></div><div id="t1540421266000100" t="2018-10-24 22:47:46 jvtrigueros Ah gotcha, thank you! This points me in the right direction, I&apos;ll continue to play with Clara  😃"><a href="#t1540421266000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-24</span> <span class="t" onclick="H(this)">22:47:46</span>             jvtrigueros </span><span>Ah gotcha, thank you! This points me in the right direction, I&apos;ll continue to play with Clara </span><b>😃</b></div><div id="t1540425488000100" t="2018-10-24 23:58:08 souenzzo some functions you can use like  (contains? #{:foo} resource)"><a href="#t1540425488000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-24</span> <span class="t" onclick="H(this)">23:58:08</span>                souenzzo </span><span>some functions you can use like </span><code>(contains? #{:foo} resource)</code></div><div id="t1540474426000100" t="2018-10-25 13:33:46 eraserhd @souenzzo wait, really?  Is there a list of functions that Clara handles specially?"><a href="#t1540474426000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-25</span> <span class="t" onclick="H(this)">13:33:46</span>                eraserhd </span><span>@souenzzo wait, really?  Is there a list of functions that Clara handles specially?</span></div><div id="t1540474442000200" t="2018-10-25 13:34:02 eraserhd I mean, knows how to join, other than =?"><a href="#t1540474442000200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-25</span> <span class="t" onclick="H(this)">13:34:02</span>                eraserhd </span><span>I mean, knows how to join, other than =?</span></div><div id="t1540475175000100" t="2018-10-25 13:46:15 souenzzo I use  =  and  contanis? . I learned it when I did not understand how clara works then never search for it."><a href="#t1540475175000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-25</span> <span class="t" onclick="H(this)">13:46:15</span>                souenzzo </span><span>I use </span><code>=</code><span> and </span><code>contanis?</code><span>. I learned it when I did not understand how clara works then never search for it.</span></div><div id="t1540475820000100" t="2018-10-25 13:57:00 jvtrigueros As a newcomer it’s not super clear which functions are built-in. This is definitely an advanced user library :)"><a href="#t1540475820000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-25</span> <span class="t" onclick="H(this)">13:57:00</span>             jvtrigueros </span><span>As a newcomer it’s not super clear which functions are built-in. This is definitely an advanced user library :)</span></div><div id="t1540477324000100" t="2018-10-25 14:22:04 ethanc I&apos;m believe that the only functions that Clara handles specially are the equality expressions:
 https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/rules/compiler.clj#L213-L223"><a href="#t1540477324000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-25</span> <span class="t" onclick="H(this)">14:22:04</span>                  ethanc </span><span>I&apos;m believe that the only functions that Clara handles specially are the equality expressions:
</span><a href="https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/rules/compiler.clj#L213-L223" target="_blank">https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/rules/compiler.clj#L213-L223</a></div><div id="t1540478214000100" t="2018-10-25 14:36:54 mikerod Yeah,  =  is the only special thing"><a href="#t1540478214000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-25</span> <span class="t" onclick="H(this)">14:36:54</span>                 mikerod </span><span>Yeah, </span><code>=</code><span> is the only special thing</span></div><div id="t1540478237000100" t="2018-10-25 14:37:17 mikerod It still means  =  too, but it can also be used for unification purposes/binding variables"><a href="#t1540478237000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-25</span> <span class="t" onclick="H(this)">14:37:17</span>                 mikerod </span><span>It still means </span><code>=</code><span> too, but it can also be used for unification purposes/binding variables</span></div><div id="t1540478267000100" t="2018-10-25 14:37:47 mikerod nothing is special about  contains?  (or anything else)"><a href="#t1540478267000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-25</span> <span class="t" onclick="H(this)">14:37:47</span>                 mikerod </span><span>nothing is special about </span><code>contains?</code><span> (or anything else)</span></div><div id="t1540479256000100" t="2018-10-25 14:54:16 wparker Agreed with other comments that it is just = that is special when used as a top-level value in the constraint to create/join on bindings (starting with ?)"><a href="#t1540479256000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-25</span> <span class="t" onclick="H(this)">14:54:16</span>                 wparker </span><span>Agreed with other comments that it is just = that is special when used as a top-level value in the constraint to create/join on bindings (starting with ?)</span></div><div id="t1540479280000100" t="2018-10-25 14:54:40 wparker that has perf benefits in that those joins are done by hashing"><a href="#t1540479280000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-25</span> <span class="t" onclick="H(this)">14:54:40</span>                 wparker </span><span>that has perf benefits in that those joins are done by hashing</span></div><div id="t1540479312000100" t="2018-10-25 14:55:12 wparker otherwise you can use arbitrary functions and they should behave the same as elsewhere"><a href="#t1540479312000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-25</span> <span class="t" onclick="H(this)">14:55:12</span>                 wparker </span><span>otherwise you can use arbitrary functions and they should behave the same as elsewhere</span></div><div id="t1540479346000100" t="2018-10-25 14:55:46 jvtrigueros While reading the docs, it goes from straightforward to advanced very quickly. In  http://www.clara-rules.org/docs/rules/ , I fully understand the  free-lunch-with-gizmo  because there&apos;s no  ?  binding, you&apos;re matching that an item is  :gizmo , but then in the sophisticated example:
 (defrule grant-discount-months  
  [Purchase (= ?month (get-month date))]
  [DiscountMonth (= ?month month)]
  =&gt;
  (insert! (-&gt;GrantDiscount :for-month ?month)))
 
The  =  doesn&apos;t have the same meaning (in the Purchase condition) as the straightforward example, but it does in the DiscountMonth condition?"><a href="#t1540479346000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-25</span> <span class="t" onclick="H(this)">14:55:46</span>             jvtrigueros </span><span>While reading the docs, it goes from straightforward to advanced very quickly. In </span><a href="http://www.clara-rules.org/docs/rules/" target="_blank">http://www.clara-rules.org/docs/rules/</a><span>, I fully understand the </span><code>free-lunch-with-gizmo</code><span> because there&apos;s no </span><code>?</code><span> binding, you&apos;re matching that an item is </span><code>:gizmo</code><span>, but then in the sophisticated example:
</span><pre>(defrule grant-discount-months  
  [Purchase (= ?month (get-month date))]
  [DiscountMonth (= ?month month)]
  =&gt;
  (insert! (-&gt;GrantDiscount :for-month ?month)))
</pre><span>
The </span><code>=</code><span> doesn&apos;t have the same meaning (in the Purchase condition) as the straightforward example, but it does in the DiscountMonth condition?</span></div><div id="t1540479431000100" t="2018-10-25 14:57:11 wparker it has the same meaning in that it requires equality, but clojure.core/= won’t be called"><a href="#t1540479431000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-25</span> <span class="t" onclick="H(this)">14:57:11</span>                 wparker </span><span>it has the same meaning in that it requires equality, but clojure.core/= won’t be called</span></div><div id="t1540479449000100" t="2018-10-25 14:57:29 eraserhd Not quite."><a href="#t1540479449000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-25</span> <span class="t" onclick="H(this)">14:57:29</span>                eraserhd </span><span>Not quite.</span></div><div id="t1540479496000100" t="2018-10-25 14:58:16 eraserhd =  is unification.  So, it requires the expression to be true.  If there are variables in it that do not yet have a value, the variables are &quot;assigned&quot; such to make it true.  If the variables are already assigned, it works like clojure.core/="><a href="#t1540479496000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-25</span> <span class="t" onclick="H(this)">14:58:16</span>                eraserhd </span><code>=</code><span> is unification.  So, it requires the expression to be true.  If there are variables in it that do not yet have a value, the variables are &quot;assigned&quot; such to make it true.  If the variables are already assigned, it works like clojure.core/=</span></div><div id="t1540479511000100" t="2018-10-25 14:58:31 mikerod That’s a reasonable way to think about it"><a href="#t1540479511000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-25</span> <span class="t" onclick="H(this)">14:58:31</span>                 mikerod </span><span>That’s a reasonable way to think about it</span></div><div id="t1540479516000100" t="2018-10-25 14:58:36 mikerod but Clara may optimize on it"><a href="#t1540479516000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-25</span> <span class="t" onclick="H(this)">14:58:36</span>                 mikerod </span><span>but Clara may optimize on it</span></div><div id="t1540479529000200" t="2018-10-25 14:58:49 mikerod when unifying on a  ?  binding"><a href="#t1540479529000200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-25</span> <span class="t" onclick="H(this)">14:58:49</span>                 mikerod </span><span>when unifying on a </span><code>?</code><span> binding</span></div><div id="t1540479538000100" t="2018-10-25 14:58:58 mikerod it uses it to build the rete graph"><a href="#t1540479538000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-25</span> <span class="t" onclick="H(this)">14:58:58</span>                 mikerod </span><span>it uses it to build the rete graph</span></div><div id="t1540479560000200" t="2018-10-25 14:59:20 jvtrigueros &gt;  =  is unification
This distinction is makes sense!"><a href="#t1540479560000200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-25</span> <span class="t" onclick="H(this)">14:59:20</span>             jvtrigueros </span><span>&gt; </span><code>=</code><span> is unification
This distinction is makes sense!</span></div><div id="t1540479563000100" t="2018-10-25 14:59:23 mikerod makes a hash-based match for nodes known to be doing  =  based bindings"><a href="#t1540479563000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-25</span> <span class="t" onclick="H(this)">14:59:23</span>                 mikerod </span><span>makes a hash-based match for nodes known to be doing </span><code>=</code><span> based bindings</span></div><div id="t1540479576000100" t="2018-10-25 14:59:36 mikerod but  =  is also just  =  when equating to constant values etc"><a href="#t1540479576000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-25</span> <span class="t" onclick="H(this)">14:59:36</span>                 mikerod </span><span>but </span><code>=</code><span> is also just </span><code>=</code><span> when equating to constant values etc</span></div><div id="t1540479576000200" t="2018-10-25 14:59:36 eraserhd If there are many possible values for a variable, it can assign each value consecutively."><a href="#t1540479576000200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-25</span> <span class="t" onclick="H(this)">14:59:36</span>                eraserhd </span><span>If there are many possible values for a variable, it can assign each value consecutively.</span></div><div id="t1540479593000100" t="2018-10-25 14:59:53 mikerod you can do  [Purchase (= ?month month &quot;JAN&quot;)]  for example"><a href="#t1540479593000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-25</span> <span class="t" onclick="H(this)">14:59:53</span>                 mikerod </span><span>you can do </span><code>[Purchase (= ?month month &quot;JAN&quot;)]</code><span> for example</span></div><div id="t1540479595000100" t="2018-10-25 14:59:55 eraserhd (*and what @mikerod is saying is true, I&apos;m only describing the semantics, it doesn&apos;t actually work like that.)"><a href="#t1540479595000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-25</span> <span class="t" onclick="H(this)">14:59:55</span>                eraserhd </span><span>(*and what @mikerod is saying is true, I&apos;m only describing the semantics, it doesn&apos;t actually work like that.)</span></div><div id="t1540479605000100" t="2018-10-25 15:00:05 mikerod yeah, semantics are most important"><a href="#t1540479605000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-25</span> <span class="t" onclick="H(this)">15:00:05</span>                 mikerod </span><span>yeah, semantics are most important</span></div><div id="t1540479625000100" t="2018-10-25 15:00:25 mikerod just making sure someone may not get carried away and try to print within  clojure.core/=  or something and wonder why it isn’t always called hah"><a href="#t1540479625000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-25</span> <span class="t" onclick="H(this)">15:00:25</span>                 mikerod </span><span>just making sure someone may not get carried away and try to print within </span><code>clojure.core/=</code><span> or something and wonder why it isn’t always called hah</span></div><div id="t1540479633000100" t="2018-10-25 15:00:33 mikerod unlikely"><a href="#t1540479633000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-25</span> <span class="t" onclick="H(this)">15:00:33</span>                 mikerod </span><span>unlikely</span></div><div id="t1540479675000100" t="2018-10-25 15:01:15 mikerod [Purchase (= ?month month &quot;JAN&quot;)]  binds the value of the field  month  to  ?month , when  (= month &quot;JAN&quot;)  (via  clojure.core/= )"><a href="#t1540479675000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-25</span> <span class="t" onclick="H(this)">15:01:15</span>                 mikerod </span><code>[Purchase (= ?month month &quot;JAN&quot;)]</code><span> binds the value of the field </span><code>month</code><span> to </span><code>?month</code><span>, when </span><code>(= month &quot;JAN&quot;)</code><span> (via </span><code>clojure.core/=</code><span>)</span></div><div id="t1540479685000100" t="2018-10-25 15:01:25 mikerod Of course in this case,  ?month  would just be “JAN”"><a href="#t1540479685000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-25</span> <span class="t" onclick="H(this)">15:01:25</span>                 mikerod </span><span>Of course in this case, </span><code>?month</code><span> would just be “JAN”</span></div><div id="t1540479711000100" t="2018-10-25 15:01:51 mikerod so perhaps something a bit more useful than that  😛"><a href="#t1540479711000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-25</span> <span class="t" onclick="H(this)">15:01:51</span>                 mikerod </span><span>so perhaps something a bit more useful than that </span><b>😛</b></div><div id="t1540479805000100" t="2018-10-25 15:03:25 wparker This page on the docs might be of interest:  http://www.clara-rules.org/docs/hash_joins/"><a href="#t1540479805000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-25</span> <span class="t" onclick="H(this)">15:03:25</span>                 wparker </span><span>This page on the docs might be of interest: </span><a href="http://www.clara-rules.org/docs/hash_joins/" target="_blank">http://www.clara-rules.org/docs/hash_joins/</a></div><div id="t1540479850000100" t="2018-10-25 15:04:10 jvtrigueros Woah secret docs"><a href="#t1540479850000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-25</span> <span class="t" onclick="H(this)">15:04:10</span>             jvtrigueros </span><span>Woah secret docs</span></div><div id="t1540479974000100" t="2018-10-25 15:06:14 wparker “`=` is unification” =&gt; correct.  Note that this is for top-level constraints though, when nested inside a constraint that isn’t the case i.e. [A (= ?b c)] vs [A (stuff (= ?b c))]"><a href="#t1540479974000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-25</span> <span class="t" onclick="H(this)">15:06:14</span>                 wparker </span><span>“`=` is unification” =&gt; correct.  Note that this is for top-level constraints though, when nested inside a constraint that isn’t the case i.e. [A (= ?b c)] vs [A (stuff (= ?b c))]</span></div><div id="t1540480006000100" t="2018-10-25 15:06:46 wparker Hah not secret, just nested inside the “performance optimization” page"><a href="#t1540480006000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-25</span> <span class="t" onclick="H(this)">15:06:46</span>                 wparker </span><span>Hah not secret, just nested inside the “performance optimization” page</span></div><div id="t1540480047000100" t="2018-10-25 15:07:27 wparker Or more precisely on my last, that is true if you’re trying to create new bindings - it’s still unification semantically if you’re  using bindings from before"><a href="#t1540480047000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-25</span> <span class="t" onclick="H(this)">15:07:27</span>                 wparker </span><span>Or more precisely on my last, that is true if you’re trying to create new bindings - it’s still unification semantically if you’re  using bindings from before</span></div><div id="t1540480157000100" t="2018-10-25 15:09:17 jvtrigueros &gt; [A (= ?b c)] vs [A (stuff (= ?b c))]
Yes! This is what I ran into immediately, I wanted to use my own equality function, but I got pointed to using  :test  instead."><a href="#t1540480157000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-25</span> <span class="t" onclick="H(this)">15:09:17</span>             jvtrigueros </span><span>&gt; [A (= ?b c)] vs [A (stuff (= ?b c))]
Yes! This is what I ran into immediately, I wanted to use my own equality function, but I got pointed to using </span><code>:test</code><span> instead.</span></div><div id="t1540480215000200" t="2018-10-25 15:10:15 jvtrigueros BTW thank you all for helping me understand this!"><a href="#t1540480215000200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-25</span> <span class="t" onclick="H(this)">15:10:15</span>             jvtrigueros </span><span>BTW thank you all for helping me understand this!</span></div><div id="t1540480997000100" t="2018-10-25 15:23:17 mikerod some of the semantics around = can get weird, since it kind of plays 2 roles depending on context"><a href="#t1540480997000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-25</span> <span class="t" onclick="H(this)">15:23:17</span>                 mikerod </span><span>some of the semantics around = can get weird, since it kind of plays 2 roles depending on context</span></div><div id="t1540481007000100" t="2018-10-25 15:23:27 mikerod like when how you can’t nest it within another call to do a unification"><a href="#t1540481007000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-25</span> <span class="t" onclick="H(this)">15:23:27</span>                 mikerod </span><span>like when how you can’t nest it within another call to do a unification</span></div><div id="t1540481018000100" t="2018-10-25 15:23:38 mikerod but most of the time not a big deal"><a href="#t1540481018000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-25</span> <span class="t" onclick="H(this)">15:23:38</span>                 mikerod </span><span>but most of the time not a big deal</span></div><div id="t1540504892000100" t="2018-10-25 22:01:32 jvtrigueros Is it possible to transform the output of  defquery  or would I need to do that in a wrapper function? The RHS of a  defrule  is just Clojure but that doesn&apos;t seem to exist in  defquery s"><a href="#t1540504892000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-25</span> <span class="t" onclick="H(this)">22:01:32</span>             jvtrigueros </span><span>Is it possible to transform the output of </span><code>defquery</code><span> or would I need to do that in a wrapper function? The RHS of a </span><code>defrule</code><span> is just Clojure but that doesn&apos;t seem to exist in </span><code>defquery</code><span>s</span></div><div id="t1540505500000100" t="2018-10-25 22:11:40 mikerod @jvtrigueros  defquery  has  no RHS"><a href="#t1540505500000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-25</span> <span class="t" onclick="H(this)">22:11:40</span>                 mikerod </span><span>@jvtrigueros </span><code>defquery</code><span> has  no RHS</span></div><div id="t1540505531000100" t="2018-10-25 22:12:11 mikerod you can create facts in rules with  defrule  that do some transformations so there is less to transform once you get it from the query"><a href="#t1540505531000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-25</span> <span class="t" onclick="H(this)">22:12:11</span>                 mikerod </span><span>you can create facts in rules with </span><code>defrule</code><span> that do some transformations so there is less to transform once you get it from the query</span></div><div id="t1540505548000100" t="2018-10-25 22:12:28 mikerod but the query return val will just be the maps with the binding keys to the values they are bound to in the query"><a href="#t1540505548000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-25</span> <span class="t" onclick="H(this)">22:12:28</span>                 mikerod </span><span>but the query return val will just be the maps with the binding keys to the values they are bound to in the query</span></div><div id="t1540505826000100" t="2018-10-25 22:17:06 jvtrigueros Thanks! In the  query  docs, it suggests one can write a query like so:
 (query session get-by-last-name :last-name “Jones”)
 
How would one write the  defquery  for that?
 (defquery get-by-last-name
  [:last-name]
  [?person &lt;- Person (= last-name :last-name)])
"><a href="#t1540505826000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-25</span> <span class="t" onclick="H(this)">22:17:06</span>             jvtrigueros </span><span>Thanks! In the </span><code>query</code><span> docs, it suggests one can write a query like so:
</span><pre>(query session get-by-last-name :last-name “Jones”)
</pre><span>
How would one write the </span><code>defquery</code><span> for that?
</span><pre>(defquery get-by-last-name
  [:last-name]
  [?person &lt;- Person (= last-name :last-name)])
</pre></div><div id="t1540505940000100" t="2018-10-25 22:19:00 jvtrigueros I&apos;m only able to create  defquery s that have  ? :
 (defquery get-by-last-name
  [:?last-name]
  [?person &lt;- Person (= last-name ?last-name)])
 
But then the query call wouldn&apos;t be using  :last-name  but  :?last-name"><a href="#t1540505940000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-25</span> <span class="t" onclick="H(this)">22:19:00</span>             jvtrigueros </span><span>I&apos;m only able to create </span><code>defquery</code><span>s that have </span><code>?</code><span>:
</span><pre>(defquery get-by-last-name
  [:?last-name]
  [?person &lt;- Person (= last-name ?last-name)])
</pre><span>
But then the query call wouldn&apos;t be using </span><code>:last-name</code><span> but </span><code>:?last-name</code></div><div id="t1540569170003000" t="2018-10-26 15:52:50 ethanc @jvtrigueros that is correct, the parameter of the query should be  :?last-name , and would work similar to a filter on the  ?last-name  binding in the lhs of the query.
Where did you find that example, it should probably be updated?"><a href="#t1540569170003000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-26</span> <span class="t" onclick="H(this)">15:52:50</span>                  ethanc </span><span>@jvtrigueros that is correct, the parameter of the query should be </span><code>:?last-name</code><span>, and would work similar to a filter on the </span><code>?last-name</code><span> binding in the lhs of the query.
Where did you find that example, it should probably be updated?</span></div><div id="t1540569775003300" t="2018-10-26 16:02:55 ethanc nvm, i found it:
 https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/rules.cljc#L51"><a href="#t1540569775003300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-26</span> <span class="t" onclick="H(this)">16:02:55</span>                  ethanc </span><span>nvm, i found it:
</span><a href="https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/rules.cljc#L51" target="_blank">https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/rules.cljc#L51</a></div><div id="t1540570025003700" t="2018-10-26 16:07:05 jvtrigueros Sweet! Thanks  🙂"><a href="#t1540570025003700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-26</span> <span class="t" onclick="H(this)">16:07:05</span>             jvtrigueros </span><span>Sweet! Thanks </span><b>🙂</b></div><div id="t1540576335005000" t="2018-10-26 17:52:15 eraserhd I&apos;m curious about a number of Clara&apos;s language restrictions.  For example, not being able to use  :and  inside not, not being able to use  :and  on the rhs of an accumulator."><a href="#t1540576335005000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-26</span> <span class="t" onclick="H(this)">17:52:15</span>                eraserhd </span><span>I&apos;m curious about a number of Clara&apos;s language restrictions.  For example, not being able to use </span><code>:and</code><span> inside not, not being able to use </span><code>:and</code><span> on the rhs of an accumulator.</span></div><div id="t1540576383005500" t="2018-10-26 17:53:03 eraserhd Are these technical limitations of the underlying matching engine, or front-end limitations?"><a href="#t1540576383005500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-26</span> <span class="t" onclick="H(this)">17:53:03</span>                eraserhd </span><span>Are these technical limitations of the underlying matching engine, or front-end limitations?</span></div><div id="t1540576714006700" t="2018-10-26 17:58:34 zylox ya that one is a tangled web of very complicated issues...let me see if i can find the logged issues on them because there is a lot of good conversation on them"><a href="#t1540576714006700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-26</span> <span class="t" onclick="H(this)">17:58:34</span>                   zylox </span><span>ya that one is a tangled web of very complicated issues...let me see if i can find the logged issues on them because there is a lot of good conversation on them</span></div><div id="t1540576951007600" t="2018-10-26 18:02:31 zylox https://github.com/cerner/clara-rules/issues/373  this is one of them"><a href="#t1540576951007600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-26</span> <span class="t" onclick="H(this)">18:02:31</span>                   zylox </span><a href="https://github.com/cerner/clara-rules/issues/373" target="_blank">https://github.com/cerner/clara-rules/issues/373</a><span> this is one of them</span></div><div id="t1540576965008100" t="2018-10-26 18:02:45 zylox has a lot of references to other issues"><a href="#t1540576965008100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-26</span> <span class="t" onclick="H(this)">18:02:45</span>                   zylox </span><span>has a lot of references to other issues</span></div><div id="t1540577020009300" t="2018-10-26 18:03:40 mikerod Yep @zylox has a good point on the issues around the complexities. "><a href="#t1540577020009300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-26</span> <span class="t" onclick="H(this)">18:03:40</span>                 mikerod </span><span>Yep @zylox has a good point on the issues around the complexities. </span></div><div id="t1540577137010200" t="2018-10-26 18:05:37 mikerod In general negated conjunctions and rete have complexities due to the structure of the network"><a href="#t1540577137010200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-26</span> <span class="t" onclick="H(this)">18:05:37</span>                 mikerod </span><span>In general negated conjunctions and rete have complexities due to the structure of the network</span></div><div id="t1540577274010800" t="2018-10-26 18:07:54 mikerod Most of the times if things get weird in a rule doing this stuff I think you can typically just break the logic up across more rules to keep the structures simpler "><a href="#t1540577274010800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-26</span> <span class="t" onclick="H(this)">18:07:54</span>                 mikerod </span><span>Most of the times if things get weird in a rule doing this stuff I think you can typically just break the logic up across more rules to keep the structures simpler </span></div><div id="t1540579920013000" t="2018-10-26 18:52:00 eraserhd How cheap are intermediate facts?  I mean, clojure records themselves are cheap, but is memory used by facts interesting?  They are alpha-pruned, I assume."><a href="#t1540579920013000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-26</span> <span class="t" onclick="H(this)">18:52:00</span>                eraserhd </span><span>How cheap are intermediate facts?  I mean, clojure records themselves are cheap, but is memory used by facts interesting?  They are alpha-pruned, I assume.</span></div><div id="t1540580024015400" t="2018-10-26 18:53:44 eraserhd The idea of a NegatedCondition, for example, is that going to be more memory. (Also, I’m not sure how that could work, because it would need to join on a variable number of bindings.)"><a href="#t1540580024015400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-26</span> <span class="t" onclick="H(this)">18:53:44</span>                eraserhd </span><span>The idea of a NegatedCondition, for example, is that going to be more memory. (Also, I’m not sure how that could work, because it would need to join on a variable number of bindings.)</span></div><div id="t1540581200016000" t="2018-10-26 19:13:20 mikerod @eraserhd they aren’t much overhead beyond the fact object itself"><a href="#t1540581200016000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-26</span> <span class="t" onclick="H(this)">19:13:20</span>                 mikerod </span><span>@eraserhd they aren’t much overhead beyond the fact object itself</span></div><div id="t1540581253017100" t="2018-10-26 19:14:13 mikerod You can make a rule that does the conjunction and inserts a fact if it is true. Then a rule with a negation on that fact. Clara actually sometimes automatically does something similar to that. "><a href="#t1540581253017100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-26</span> <span class="t" onclick="H(this)">19:14:13</span>                 mikerod </span><span>You can make a rule that does the conjunction and inserts a fact if it is true. Then a rule with a negation on that fact. Clara actually sometimes automatically does something similar to that. </span></div><div id="t1540581329019100" t="2018-10-26 19:15:29 mikerod Intermediate facts in memory are about the same as just making a new record of whatever is what I meant. Cpu timewise just depends on what it interacts with. The actual working memory insert and retract operations are pretty fast (optimized it quite a bit)"><a href="#t1540581329019100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-26</span> <span class="t" onclick="H(this)">19:15:29</span>                 mikerod </span><span>Intermediate facts in memory are about the same as just making a new record of whatever is what I meant. Cpu timewise just depends on what it interacts with. The actual working memory insert and retract operations are pretty fast (optimized it quite a bit)</span></div><div id="t1540581344019600" t="2018-10-26 19:15:44 mikerod Not sure if that addresses all your questions there"><a href="#t1540581344019600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-26</span> <span class="t" onclick="H(this)">19:15:44</span>                 mikerod </span><span>Not sure if that addresses all your questions there</span></div><div id="t1540581357019800" t="2018-10-26 19:15:57 eraserhd I think so."><a href="#t1540581357019800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-26</span> <span class="t" onclick="H(this)">19:15:57</span>                eraserhd </span><span>I think so.</span></div><div id="t1540582351021000" t="2018-10-26 19:32:31 mikerod When writing rules I typically go pretty heavy on intermediate facts"><a href="#t1540582351021000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-26</span> <span class="t" onclick="H(this)">19:32:31</span>                 mikerod </span><span>When writing rules I typically go pretty heavy on intermediate facts</span></div><div id="t1540582389022100" t="2018-10-26 19:33:09 mikerod With preference on making simple rules that models smaller concepts at a time and then compose them together for main outcome models for query. If that makes any sense. "><a href="#t1540582389022100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-26</span> <span class="t" onclick="H(this)">19:33:09</span>                 mikerod </span><span>With preference on making simple rules that models smaller concepts at a time and then compose them together for main outcome models for query. If that makes any sense. </span></div><div id="t1540582598023300" t="2018-10-26 19:36:38 zylox same here"><a href="#t1540582598023300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-26</span> <span class="t" onclick="H(this)">19:36:38</span>                   zylox </span><span>same here</span></div><div id="t1540584404024400" t="2018-10-26 20:06:44 jimbob what if i have three rules that act on type A and they all output type B while “mutating” some state in the fact.  will the final fact be type B with all the “mutations”?"><a href="#t1540584404024400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-26</span> <span class="t" onclick="H(this)">20:06:44</span>                  jimbob </span><span>what if i have three rules that act on type A and they all output type B while “mutating” some state in the fact.  will the final fact be type B with all the “mutations”?</span></div><div id="t1540584760024700" t="2018-10-26 20:12:40 zylox any time you mutate a fact in the rules network youve opened pandoras box"><a href="#t1540584760024700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-26</span> <span class="t" onclick="H(this)">20:12:40</span>                   zylox </span><span>any time you mutate a fact in the rules network youve opened pandoras box</span></div><div id="t1540584780025100" t="2018-10-26 20:13:00 zylox if you mean creating new intermediate facts, you will have 3 B facts at the end"><a href="#t1540584780025100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-26</span> <span class="t" onclick="H(this)">20:13:00</span>                   zylox </span><span>if you mean creating new intermediate facts, you will have 3 B facts at the end</span></div><div id="t1540584804025500" t="2018-10-26 20:13:24 zylox but the foundation of the rules network is immutability."><a href="#t1540584804025500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-26</span> <span class="t" onclick="H(this)">20:13:24</span>                   zylox </span><span>but the foundation of the rules network is immutability.</span></div><div id="t1540584873026600" t="2018-10-26 20:14:33 zylox you could have a rule that pulls in those 3 B facts (probably with an accumulator), and inserts a FinalB fact that has their combined state. ive seen this pattern used to solve a number of things"><a href="#t1540584873026600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-26</span> <span class="t" onclick="H(this)">20:14:33</span>                   zylox </span><span>you could have a rule that pulls in those 3 B facts (probably with an accumulator), and inserts a FinalB fact that has their combined state. ive seen this pattern used to solve a number of things</span></div><div id="t1541010729028500" t="2018-10-31 18:32:09 eraserhd Hi!  So we&apos;re debugging a performance issue, and it seems like, in our example, fast-token-compare taskes 142 seconds of self time, while PriorityQueue.remove() takes 139 seconds of self time."><a href="#t1541010729028500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-31</span> <span class="t" onclick="H(this)">18:32:09</span>                eraserhd </span><span>Hi!  So we&apos;re debugging a performance issue, and it seems like, in our example, fast-token-compare taskes 142 seconds of self time, while PriorityQueue.remove() takes 139 seconds of self time.</span></div><div id="t1541010821029800" t="2018-10-31 18:33:41 eraserhd It&apos;s not clear from VisualVM&apos;s sampling, but it looks like this referring to the PriorityQueue.remove(Object) method, which is consistent with the fast-token-compare times."><a href="#t1541010821029800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-31</span> <span class="t" onclick="H(this)">18:33:41</span>                eraserhd </span><span>It&apos;s not clear from VisualVM&apos;s sampling, but it looks like this referring to the PriorityQueue.remove(Object) method, which is consistent with the fast-token-compare times.</span></div><div id="t1541010879030800" t="2018-10-31 18:34:39 eraserhd This method is linear for priority queue.  It should be possible to wrap PriorityQueue to make it log(n) by checking when values are extracted.  Is there some reason this won&apos;t work?"><a href="#t1541010879030800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-31</span> <span class="t" onclick="H(this)">18:34:39</span>                eraserhd </span><span>This method is linear for priority queue.  It should be possible to wrap PriorityQueue to make it log(n) by checking when values are extracted.  Is there some reason this won&apos;t work?</span></div><div id="t1541011007031300" t="2018-10-31 18:36:47 eraserhd Alternately, are we doing something wrong to get runtime dominated by PriorityQueue.remove(Object)?"><a href="#t1541011007031300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-31</span> <span class="t" onclick="H(this)">18:36:47</span>                eraserhd </span><span>Alternately, are we doing something wrong to get runtime dominated by PriorityQueue.remove(Object)?</span></div><div id="t1541012761031900" t="2018-10-31 19:06:01 mikerod @eraserhd
&gt; Alternately, are we doing something wrong to get runtime dominated by PriorityQueue.remove(Object)?
Seems like there is a lot of thrash of rules getting activated, but then subsequently “deactivated”"><a href="#t1541012761031900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-31</span> <span class="t" onclick="H(this)">19:06:01</span>                 mikerod </span><span>@eraserhd
&gt; Alternately, are we doing something wrong to get runtime dominated by PriorityQueue.remove(Object)?
Seems like there is a lot of thrash of rules getting activated, but then subsequently “deactivated”</span></div><div id="t1541012787032400" t="2018-10-31 19:06:27 mikerod &gt; This method is linear for priority queue.  It should be possible to wrap PriorityQueue to make it log(n) by checking when values are extracted.  Is there some reason this won’t work?
I don’t understand what this is and how it’d make it log(n)."><a href="#t1541012787032400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-31</span> <span class="t" onclick="H(this)">19:06:27</span>                 mikerod </span><span>&gt; This method is linear for priority queue.  It should be possible to wrap PriorityQueue to make it log(n) by checking when values are extracted.  Is there some reason this won’t work?
I don’t understand what this is and how it’d make it log(n).</span></div><div id="t1541012822033100" t="2018-10-31 19:07:02 mikerod and lastly,  fast-token-compare  may be slowing down due to large tokens in these rules that are struggling with if they are satisfied/not satisfied"><a href="#t1541012822033100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-31</span> <span class="t" onclick="H(this)">19:07:02</span>                 mikerod </span><span>and lastly, </span><code>fast-token-compare</code><span> may be slowing down due to large tokens in these rules that are struggling with if they are satisfied/not satisfied</span></div><div id="t1541012855033900" t="2018-10-31 19:07:35 mikerod perhaps from large data accumulated via something like  (acc/all) ’s or similar"><a href="#t1541012855033900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-31</span> <span class="t" onclick="H(this)">19:07:35</span>                 mikerod </span><span>perhaps from large data accumulated via something like </span><code>(acc/all)</code><span>’s or similar</span></div><div id="t1541012928035300" t="2018-10-31 19:08:48 eraserhd @mikerod if remove/1 stores objects in a hash set, then remove/0 and add/1 skip removed tokens, remove/1 becomes O(1) and I think remove/0 is still O(log N)"><a href="#t1541012928035300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-31</span> <span class="t" onclick="H(this)">19:08:48</span>                eraserhd </span><span>@mikerod if remove/1 stores objects in a hash set, then remove/0 and add/1 skip removed tokens, remove/1 becomes O(1) and I think remove/0 is still O(log N)</span></div><div id="t1541012948035800" t="2018-10-31 19:09:08 mikerod We mostly avoid hashing objects"><a href="#t1541012948035800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-31</span> <span class="t" onclick="H(this)">19:09:08</span>                 mikerod </span><span>We mostly avoid hashing objects</span></div><div id="t1541012952036000" t="2018-10-31 19:09:12 eraserhd Dijkstra&apos;s algorithm is frequently implemented like this, because removing from the priority queue is expensive."><a href="#t1541012952036000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-31</span> <span class="t" onclick="H(this)">19:09:12</span>                eraserhd </span><span>Dijkstra&apos;s algorithm is frequently implemented like this, because removing from the priority queue is expensive.</span></div><div id="t1541012975036300" t="2018-10-31 19:09:35 mikerod because then you hit perf barriers with slow hash code impl’s"><a href="#t1541012975036300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-31</span> <span class="t" onclick="H(this)">19:09:35</span>                 mikerod </span><span>because then you hit perf barriers with slow hash code impl’s</span></div><div id="t1541012989036600" t="2018-10-31 19:09:49 mikerod and often that comes down to the facts being used in the session"><a href="#t1541012989036600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-31</span> <span class="t" onclick="H(this)">19:09:49</span>                 mikerod </span><span>and often that comes down to the facts being used in the session</span></div><div id="t1541013016037100" t="2018-10-31 19:10:16 mikerod in the particular case where the prio queue is used, the object to remove is a new instance too, so wouldn’t be able to have a reusable cached hashcode"><a href="#t1541013016037100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-31</span> <span class="t" onclick="H(this)">19:10:16</span>                 mikerod </span><span>in the particular case where the prio queue is used, the object to remove is a new instance too, so wouldn’t be able to have a reusable cached hashcode</span></div><div id="t1541013067037400" t="2018-10-31 19:11:07 eraserhd Hmm."><a href="#t1541013067037400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-31</span> <span class="t" onclick="H(this)">19:11:07</span>                eraserhd </span><span>Hmm.</span></div><div id="t1541013102037900" t="2018-10-31 19:11:42 mikerod not to say it isn’t worth consideration at any time, just saying hashing isn’t always as cheap as it seems"><a href="#t1541013102037900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-31</span> <span class="t" onclick="H(this)">19:11:42</span>                 mikerod </span><span>not to say it isn’t worth consideration at any time, just saying hashing isn’t always as cheap as it seems</span></div><div id="t1541013123038300" t="2018-10-31 19:12:03 mikerod fast-token-compare  avoids deep equals most of the time too"><a href="#t1541013123038300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-31</span> <span class="t" onclick="H(this)">19:12:03</span>                 mikerod </span><code>fast-token-compare</code><span> avoids deep equals most of the time too</span></div><div id="t1541013139038700" t="2018-10-31 19:12:19 mikerod it uses identity-based equivalence as a first-pass, so via  identical?  in clj semantics"><a href="#t1541013139038700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-31</span> <span class="t" onclick="H(this)">19:12:19</span>                 mikerod </span><span>it uses identity-based equivalence as a first-pass, so via </span><code>identical?</code><span> in clj semantics</span></div><div id="t1541013150039000" t="2018-10-31 19:12:30 mikerod and typically that is all that is needed to find things"><a href="#t1541013150039000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-31</span> <span class="t" onclick="H(this)">19:12:30</span>                 mikerod </span><span>and typically that is all that is needed to find things</span></div><div id="t1541013158039300" t="2018-10-31 19:12:38 mikerod during the  fire-rules  loop at least"><a href="#t1541013158039300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-31</span> <span class="t" onclick="H(this)">19:12:38</span>                 mikerod </span><span>during the </span><code>fire-rules</code><span> loop at least</span></div><div id="t1541013172039800" t="2018-10-31 19:12:52 mikerod I’ve seen this problem of large tokens being slow though"><a href="#t1541013172039800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-31</span> <span class="t" onclick="H(this)">19:12:52</span>                 mikerod </span><span>I’ve seen this problem of large tokens being slow though</span></div><div id="t1541013209040900" t="2018-10-31 19:13:29 mikerod the activation stuff is what uses the prio queue, it has to do with how when rules are satisfied, they are “staged” as available to have their RHS action executed at some future time"><a href="#t1541013209040900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-31</span> <span class="t" onclick="H(this)">19:13:29</span>                 mikerod </span><span>the activation stuff is what uses the prio queue, it has to do with how when rules are satisfied, they are “staged” as available to have their RHS action executed at some future time</span></div><div id="t1541013234041600" t="2018-10-31 19:13:54 mikerod it is a prio queue since you can have precedence on which rules should be staged ahead of one another - e.g.  :salience"><a href="#t1541013234041600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-31</span> <span class="t" onclick="H(this)">19:13:54</span>                 mikerod </span><span>it is a prio queue since you can have precedence on which rules should be staged ahead of one another - e.g. </span><code>:salience</code></div><div id="t1541013366043600" t="2018-10-31 19:16:06 mikerod I think there are some related issues out there (though not explained the same)  https://github.com/cerner/clara-rules/issues/385"><a href="#t1541013366043600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-31</span> <span class="t" onclick="H(this)">19:16:06</span>                 mikerod </span><span>I think there are some related issues out there (though not explained the same) </span><a href="https://github.com/cerner/clara-rules/issues/385" target="_blank">https://github.com/cerner/clara-rules/issues/385</a></div><div id="t1541013416043900" t="2018-10-31 19:16:56 mikerod well, that’s the only one I see at the moment"><a href="#t1541013416043900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-31</span> <span class="t" onclick="H(this)">19:16:56</span>                 mikerod </span><span>well, that’s the only one I see at the moment</span></div><div id="t1541013434044400" t="2018-10-31 19:17:14 mikerod I know I’ve messed around with this sort of problem before though, not sure I ever had a good answer"><a href="#t1541013434044400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-31</span> <span class="t" onclick="H(this)">19:17:14</span>                 mikerod </span><span>I know I’ve messed around with this sort of problem before though, not sure I ever had a good answer</span></div><div id="t1541013446044800" t="2018-10-31 19:17:26 mikerod sometimes you could just avoid a rule setup that is causing it though"><a href="#t1541013446044800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-31</span> <span class="t" onclick="H(this)">19:17:26</span>                 mikerod </span><span>sometimes you could just avoid a rule setup that is causing it though</span></div><div id="t1541013456045300" t="2018-10-31 19:17:36 eraserhd Those stats look very much like ours."><a href="#t1541013456045300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-31</span> <span class="t" onclick="H(this)">19:17:36</span>                eraserhd </span><span>Those stats look very much like ours.</span></div><div id="t1541013466045600" t="2018-10-31 19:17:46 mikerod your hashing thing could be attempted at least, just have to consider a lot of things if it ends up looking like a good path"><a href="#t1541013466045600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-31</span> <span class="t" onclick="H(this)">19:17:46</span>                 mikerod </span><span>your hashing thing could be attempted at least, just have to consider a lot of things if it ends up looking like a good path</span></div><div id="t1541013486046000" t="2018-10-31 19:18:06 mikerod the issue above talks about a “distinct accumulator”, I think that may be overly specific"><a href="#t1541013486046000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-31</span> <span class="t" onclick="H(this)">19:18:06</span>                 mikerod </span><span>the issue above talks about a “distinct accumulator”, I think that may be overly specific</span></div><div id="t1541013490046200" t="2018-10-31 19:18:10 mikerod probably a more general problem"><a href="#t1541013490046200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-31</span> <span class="t" onclick="H(this)">19:18:10</span>                 mikerod </span><span>probably a more general problem</span></div><div id="t1541013495046400" t="2018-10-31 19:18:15 mikerod and I’m fairly sure you have big tokens involved"><a href="#t1541013495046400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-31</span> <span class="t" onclick="H(this)">19:18:15</span>                 mikerod </span><span>and I’m fairly sure you have big tokens involved</span></div><div id="t1541013527047100" t="2018-10-31 19:18:47 mikerod a big token would come from a rule left-hand side (LHS) that had a lot of facts associated with a single activation of the rule"><a href="#t1541013527047100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-31</span> <span class="t" onclick="H(this)">19:18:47</span>                 mikerod </span><span>a big token would come from a rule left-hand side (LHS) that had a lot of facts associated with a single activation of the rule</span></div><div id="t1541013663047600" t="2018-10-31 19:21:03 mikerod Take for example something like
 (r/defrule big-activation-maker
  [?xs &lt;- (acc/all) :from [X]]
  =&gt;
  (do-stuff ?xs))
"><a href="#t1541013663047600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-31</span> <span class="t" onclick="H(this)">19:21:03</span>                 mikerod </span><span>Take for example something like
</span><pre>(r/defrule big-activation-maker
  [?xs &lt;- (acc/all) :from [X]]
  =&gt;
  (do-stuff ?xs))
</pre></div><div id="t1541013674047900" t="2018-10-31 19:21:14 mikerod now if you can get into a situation where the set of all  X  changes a lot"><a href="#t1541013674047900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-31</span> <span class="t" onclick="H(this)">19:21:14</span>                 mikerod </span><span>now if you can get into a situation where the set of all </span><code>X</code><span> changes a lot</span></div><div id="t1541013686048200" t="2018-10-31 19:21:26 mikerod and there are a lot of  X s in working memory overall"><a href="#t1541013686048200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-31</span> <span class="t" onclick="H(this)">19:21:26</span>                 mikerod </span><span>and there are a lot of </span><code>X</code><span>s in working memory overall</span></div><div id="t1541013716049000" t="2018-10-31 19:21:56 mikerod then this rule may keep activating/cancelling/re-activating, as the set of  X  grows - and each time there is a big token comparison to do these removals"><a href="#t1541013716049000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-31</span> <span class="t" onclick="H(this)">19:21:56</span>                 mikerod </span><span>then this rule may keep activating/cancelling/re-activating, as the set of </span><code>X</code><span> grows - and each time there is a big token comparison to do these removals</span></div><div id="t1541013727049300" t="2018-10-31 19:22:07 mikerod in a rule as simple as above, it typically wouldn’t thrash though"><a href="#t1541013727049300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-31</span> <span class="t" onclick="H(this)">19:22:07</span>                 mikerod </span><span>in a rule as simple as above, it typically wouldn’t thrash though</span></div><div id="t1541013756049900" t="2018-10-31 19:22:36 mikerod Most of the time, the network’s “batched propagation” semantics would lead you to a situation where all the  X  are around in one go with only 1 rule activation resulting"><a href="#t1541013756049900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-31</span> <span class="t" onclick="H(this)">19:22:36</span>                 mikerod </span><span>Most of the time, the network’s “batched propagation” semantics would lead you to a situation where all the </span><code>X</code><span> are around in one go with only 1 rule activation resulting</span></div><div id="t1541013766050300" t="2018-10-31 19:22:46 mikerod but certain setups can cause thrashing when more conditions and things are involved"><a href="#t1541013766050300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-31</span> <span class="t" onclick="H(this)">19:22:46</span>                 mikerod </span><span>but certain setups can cause thrashing when more conditions and things are involved</span></div><div id="t1541013784050800" t="2018-10-31 19:23:04 mikerod perhaps the distinct accumulator case was a situations like this one, I just don’t remember"><a href="#t1541013784050800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-31</span> <span class="t" onclick="H(this)">19:23:04</span>                 mikerod </span><span>perhaps the distinct accumulator case was a situations like this one, I just don’t remember</span></div><div id="t1541014049051300" t="2018-10-31 19:27:29 eraserhd This sounds like there is one thing we can write as a custom accumulator to avoid retriggering a whole slew of rules."><a href="#t1541014049051300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-31</span> <span class="t" onclick="H(this)">19:27:29</span>                eraserhd </span><span>This sounds like there is one thing we can write as a custom accumulator to avoid retriggering a whole slew of rules.</span></div><div id="t1541014070051500" t="2018-10-31 19:27:50 mikerod perhaps"><a href="#t1541014070051500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-31</span> <span class="t" onclick="H(this)">19:27:50</span>                 mikerod </span><span>perhaps</span></div><div id="t1541014106052600" t="2018-10-31 19:28:26 ethanc or play with  salience , though as a last resort"><a href="#t1541014106052600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-31</span> <span class="t" onclick="H(this)">19:28:26</span>                  ethanc </span><span>or play with </span><code>salience</code><span>, though as a last resort</span></div><div id="t1541014130053100" t="2018-10-31 19:28:50 mikerod yeah, sometimes that’s useful"><a href="#t1541014130053100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-31</span> <span class="t" onclick="H(this)">19:28:50</span>                 mikerod </span><span>yeah, sometimes that’s useful</span></div><div id="t1541014149053500" t="2018-10-31 19:29:09 mikerod sometimes you can look at the rules and sort of see where an accumulator rule may be getting retriggered in multiple phases of insert"><a href="#t1541014149053500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-31</span> <span class="t" onclick="H(this)">19:29:09</span>                 mikerod </span><span>sometimes you can look at the rules and sort of see where an accumulator rule may be getting retriggered in multiple phases of insert</span></div><div id="t1541014177054100" t="2018-10-31 19:29:37 mikerod and try to prevent that, there is salience to help, as well as just potentially logical structuring"><a href="#t1541014177054100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-10-31</span> <span class="t" onclick="H(this)">19:29:37</span>                 mikerod </span><span>and try to prevent that, there is salience to help, as well as just potentially logical structuring</span></div><div id="t1541082091055000" t="2018-11-01 14:21:31 eraserhd OK, so we&apos;ve just found something really weird with accumulators: retract-fn is never used, though documented in acc/accum."><a href="#t1541082091055000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-01</span> <span class="t" onclick="H(this)">14:21:31</span>                eraserhd </span><span>OK, so we&apos;ve just found something really weird with accumulators: retract-fn is never used, though documented in acc/accum.</span></div><div id="t1541082107055400" t="2018-11-01 14:21:47 eraserhd Because retract-fn does not appear in the Accumulator record."><a href="#t1541082107055400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-01</span> <span class="t" onclick="H(this)">14:21:47</span>                eraserhd </span><span>Because retract-fn does not appear in the Accumulator record.</span></div><div id="t1541082117055700" t="2018-11-01 14:21:57 eraserhd I&apos;m going to guess this is not how it&apos;s supposed to work?"><a href="#t1541082117055700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-01</span> <span class="t" onclick="H(this)">14:21:57</span>                eraserhd </span><span>I&apos;m going to guess this is not how it&apos;s supposed to work?</span></div><div id="t1541082942056400" t="2018-11-01 14:35:42 mikerod @eraserhd odd that it isn’t on the record definition, not sure I know why there, but it is called when provided (well expected to be)"><a href="#t1541082942056400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-01</span> <span class="t" onclick="H(this)">14:35:42</span>                 mikerod </span><span>@eraserhd odd that it isn’t on the record definition, not sure I know why there, but it is called when provided (well expected to be)</span></div><div id="t1541082951056700" t="2018-11-01 14:35:51 mikerod do you have a custom accumulator you are trying to work with?"><a href="#t1541082951056700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-01</span> <span class="t" onclick="H(this)">14:35:51</span>                 mikerod </span><span>do you have a custom accumulator you are trying to work with?</span></div><div id="t1541082969057300" t="2018-11-01 14:36:09 mikerod or did you try to add this to the existing  acc/accum"><a href="#t1541082969057300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-01</span> <span class="t" onclick="H(this)">14:36:09</span>                 mikerod </span><span>or did you try to add this to the existing </span><code>acc/accum</code></div><div id="t1541082996058000" t="2018-11-01 14:36:36 eraserhd We are getting ready to build an accumulator with  accum , and I was looking for how to extract those functions again so we can test drive it, and I found that retract-fn gets lost."><a href="#t1541082996058000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-01</span> <span class="t" onclick="H(this)">14:36:36</span>                eraserhd </span><span>We are getting ready to build an accumulator with </span><code>accum</code><span>, and I was looking for how to extract those functions again so we can test drive it, and I found that retract-fn gets lost.</span></div><div id="t1541083130058600" t="2018-11-01 14:38:50 eraserhd uhhh, whoa.  I had no idea that you could add arbitrary fields to a defrecord with map-&gt;X."><a href="#t1541083130058600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-01</span> <span class="t" onclick="H(this)">14:38:50</span>                eraserhd </span><span>uhhh, whoa.  I had no idea that you could add arbitrary fields to a defrecord with map-&gt;X.</span></div><div id="t1541083153058900" t="2018-11-01 14:39:13 mikerod you are using  clara.rules.accumulators/accum  to build an accumulator?"><a href="#t1541083153058900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-01</span> <span class="t" onclick="H(this)">14:39:13</span>                 mikerod </span><span>you are using </span><code>clara.rules.accumulators/accum</code><span> to build an accumulator?</span></div><div id="t1541083172059400" t="2018-11-01 14:39:32 eraserhd No, doing nothing but research at this point."><a href="#t1541083172059400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-01</span> <span class="t" onclick="H(this)">14:39:32</span>                eraserhd </span><span>No, doing nothing but research at this point.</span></div><div id="t1541083200060100" t="2018-11-01 14:40:00 mikerod yeah, defrecord in clj is often considered more of a perf optimization for a common group of fields you access, they work as regular maps in many cases, and having any number of keys is one of them. the keys not defined on the record are just accessed slower on the impl side"><a href="#t1541083200060100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-01</span> <span class="t" onclick="H(this)">14:40:00</span>                 mikerod </span><span>yeah, defrecord in clj is often considered more of a perf optimization for a common group of fields you access, they work as regular maps in many cases, and having any number of keys is one of them. the keys not defined on the record are just accessed slower on the impl side</span></div><div id="t1541083208060300" t="2018-11-01 14:40:08 mikerod and you can’t reflect for them etc"><a href="#t1541083208060300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-01</span> <span class="t" onclick="H(this)">14:40:08</span>                 mikerod </span><span>and you can’t reflect for them etc</span></div><div id="t1541083232060600" t="2018-11-01 14:40:32 mikerod clara.rules.accumulators/accum  supports passing the  :retract-fn  in"><a href="#t1541083232060600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-01</span> <span class="t" onclick="H(this)">14:40:32</span>                 mikerod </span><code>clara.rules.accumulators/accum</code><span> supports passing the </span><code>:retract-fn</code><span> in</span></div><div id="t1541083258060900" t="2018-11-01 14:40:58 mikerod have to be a bit careful on how you do retraction though if I recall correct"><a href="#t1541083258060900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-01</span> <span class="t" onclick="H(this)">14:40:58</span>                 mikerod </span><span>have to be a bit careful on how you do retraction though if I recall correct</span></div><div id="t1541083273061300" t="2018-11-01 14:41:13 mikerod if you don’t provide one, Clara will default to rebuilding things minus the facts retracted"><a href="#t1541083273061300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-01</span> <span class="t" onclick="H(this)">14:41:13</span>                 mikerod </span><span>if you don’t provide one, Clara will default to rebuilding things minus the facts retracted</span></div><div id="t1541083291061700" t="2018-11-01 14:41:31 mikerod :retract-fn  is meant for when you know how to more efficiently remove a retracted fact from your reduced structure"><a href="#t1541083291061700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-01</span> <span class="t" onclick="H(this)">14:41:31</span>                 mikerod </span><code>:retract-fn</code><span> is meant for when you know how to more efficiently remove a retracted fact from your reduced structure</span></div><div id="t1541083350062300" t="2018-11-01 14:42:30 mikerod If you had an example situation where you think  :retract-fn  wasn’t used though, that’d be easier to look at and walk through"><a href="#t1541083350062300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-01</span> <span class="t" onclick="H(this)">14:42:30</span>                 mikerod </span><span>If you had an example situation where you think </span><code>:retract-fn</code><span> wasn’t used though, that’d be easier to look at and walk through</span></div><div id="t1541083438062600" t="2018-11-01 14:43:58 mikerod ohhhh, there may be cases where it isn’t used at all"><a href="#t1541083438062600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-01</span> <span class="t" onclick="H(this)">14:43:58</span>                 mikerod </span><span>ohhhh, there may be cases where it isn’t used at all</span></div><div id="t1541083445062800" t="2018-11-01 14:44:05 mikerod checking, I’m forgetting things"><a href="#t1541083445062800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-01</span> <span class="t" onclick="H(this)">14:44:05</span>                 mikerod </span><span>checking, I’m forgetting things</span></div><div id="t1541083497063700" t="2018-11-01 14:44:57 eraserhd We have the ability to do more efficient retraction and combining, so we&apos;re writing a custom accumulator to get around the thrashing from yesterday.  It also allows us to get rid of some intermediate facts that are frequently retracted."><a href="#t1541083497063700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-01</span> <span class="t" onclick="H(this)">14:44:57</span>                eraserhd </span><span>We have the ability to do more efficient retraction and combining, so we&apos;re writing a custom accumulator to get around the thrashing from yesterday.  It also allows us to get rid of some intermediate facts that are frequently retracted.</span></div><div id="t1541083668064100" t="2018-11-01 14:47:48 mikerod when you use the accumulator"><a href="#t1541083668064100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-01</span> <span class="t" onclick="H(this)">14:47:48</span>                 mikerod </span><span>when you use the accumulator</span></div><div id="t1541083672064300" t="2018-11-01 14:47:52 mikerod what sort of form does it have"><a href="#t1541083672064300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-01</span> <span class="t" onclick="H(this)">14:47:52</span>                 mikerod </span><span>what sort of form does it have</span></div><div id="t1541083688064700" t="2018-11-01 14:48:08 mikerod [?acc &lt;- custom-acc :from [&lt;this part&gt;]]"><a href="#t1541083688064700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-01</span> <span class="t" onclick="H(this)">14:48:08</span>                 mikerod </span><code>[?acc &lt;- custom-acc :from [&lt;this part&gt;]]</code></div><div id="t1541083743065600" t="2018-11-01 14:49:03 mikerod Are you using some joining conditions there like  [X (test-something ?y z)] , or just  [X] , or equality based join, like  [X (= ?y z)] ?"><a href="#t1541083743065600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-01</span> <span class="t" onclick="H(this)">14:49:03</span>                 mikerod </span><span>Are you using some joining conditions there like </span><code>[X (test-something ?y z)]</code><span>, or just </span><code>[X]</code><span>, or equality based join, like </span><code>[X (= ?y z)]</code><span>?</span></div><div id="t1541083772066400" t="2018-11-01 14:49:32 mikerod The point is there are 2 variants of accumulate nodes in the rules engine, one for the simpler join cases using  =  or no joining at all"><a href="#t1541083772066400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-01</span> <span class="t" onclick="H(this)">14:49:32</span>                 mikerod </span><span>The point is there are 2 variants of accumulate nodes in the rules engine, one for the simpler join cases using </span><code>=</code><span> or no joining at all</span></div><div id="t1541083790066900" t="2018-11-01 14:49:50 mikerod that one is optimized for those cases because they can be done better"><a href="#t1541083790066900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-01</span> <span class="t" onclick="H(this)">14:49:50</span>                 mikerod </span><span>that one is optimized for those cases because they can be done better</span></div><div id="t1541083808067300" t="2018-11-01 14:50:08 mikerod the other variant handles the rest, which are arbitrary other joining criteria"><a href="#t1541083808067300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-01</span> <span class="t" onclick="H(this)">14:50:08</span>                 mikerod </span><span>the other variant handles the rest, which are arbitrary other joining criteria</span></div><div id="t1541083898068700" t="2018-11-01 14:51:38 mikerod At this point, if I recall all the impl details correctly, providing your own  :retract-fn  is only a potential perf optimization. If you use the optimized, easier variant of an accumulator, it will be used, otherwise, it is ignored because it can’t be used from within the more generalized case"><a href="#t1541083898068700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-01</span> <span class="t" onclick="H(this)">14:51:38</span>                 mikerod </span><span>At this point, if I recall all the impl details correctly, providing your own </span><code>:retract-fn</code><span> is only a potential perf optimization. If you use the optimized, easier variant of an accumulator, it will be used, otherwise, it is ignored because it can’t be used from within the more generalized case</span></div><div id="t1541083917069100" t="2018-11-01 14:51:57 mikerod or really, it can’t be used to help in the more general case, it would only be slower"><a href="#t1541083917069100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-01</span> <span class="t" onclick="H(this)">14:51:57</span>                 mikerod </span><span>or really, it can’t be used to help in the more general case, it would only be slower</span></div><div id="t1541085023071600" t="2018-11-01 15:10:23 ProbablyJody Does the accumulator maintain the reduced value before being passed to the  :convert-return-fn  for the purposes of handing it to the  :retract-fn ?"><a href="#t1541085023071600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-01</span> <span class="t" onclick="H(this)">15:10:23</span>            ProbablyJody </span><span>Does the accumulator maintain the reduced value before being passed to the </span><code>:convert-return-fn</code><span> for the purposes of handing it to the </span><code>:retract-fn</code><span>?</span></div><div id="t1541085046071900" t="2018-11-01 15:10:46 ProbablyJody (assuming both are defined)"><a href="#t1541085046071900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-01</span> <span class="t" onclick="H(this)">15:10:46</span>            ProbablyJody </span><span>(assuming both are defined)</span></div><div id="t1541085131072900" t="2018-11-01 15:12:11 ProbablyJody To rephrase, should the  :retract-fn  expect the output of the  :reduce-fn  or the  :convert-return-fn ?"><a href="#t1541085131072900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-01</span> <span class="t" onclick="H(this)">15:12:11</span>            ProbablyJody </span><span>To rephrase, should the </span><code>:retract-fn</code><span> expect the output of the </span><code>:reduce-fn</code><span> or the </span><code>:convert-return-fn</code><span>?</span></div><div id="t1541085502073300" t="2018-11-01 15:18:22 mikerod @jody
&gt; To rephrase, should the  :retract-fn  expect the output of the  :reduce-fn  or the  :convert-return-fn ?
It should expect the output of  :reduce-fn"><a href="#t1541085502073300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-01</span> <span class="t" onclick="H(this)">15:18:22</span>                 mikerod </span><span>@jody
&gt; To rephrase, should the </span><code>:retract-fn</code><span> expect the output of the </span><code>:reduce-fn</code><span> or the </span><code>:convert-return-fn</code><span>?
It should expect the output of </span><code>:reduce-fn</code></div><div id="t1541085546074000" t="2018-11-01 15:19:06 mikerod it’s part of the “reducing phase”,  :convert-return-fn  is only done after everything else"><a href="#t1541085546074000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-01</span> <span class="t" onclick="H(this)">15:19:06</span>                 mikerod </span><span>it’s part of the “reducing phase”, </span><code>:convert-return-fn</code><span> is only done after everything else</span></div><div id="t1541085589074700" t="2018-11-01 15:19:49 mikerod Under the current implementation (would have to double check), I don’t think working memory for the accumulate node ever maintains the  :convert-return-fn  value actually, just the  :reduce-fn /`:retract-fn` returned value state"><a href="#t1541085589074700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-01</span> <span class="t" onclick="H(this)">15:19:49</span>                 mikerod </span><span>Under the current implementation (would have to double check), I don’t think working memory for the accumulate node ever maintains the </span><code>:convert-return-fn</code><span> value actually, just the </span><code>:reduce-fn</code><span>/`:retract-fn` returned value state</span></div><div id="t1541085635075200" t="2018-11-01 15:20:35 mikerod the reason is that the  :convert-return-fn  value is not considered useful to use for any subsequent changes"><a href="#t1541085635075200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-01</span> <span class="t" onclick="H(this)">15:20:35</span>                 mikerod </span><span>the reason is that the </span><code>:convert-return-fn</code><span> value is not considered useful to use for any subsequent changes</span></div><div id="t1541085644075500" t="2018-11-01 15:20:44 mikerod the reducing state is"><a href="#t1541085644075500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-01</span> <span class="t" onclick="H(this)">15:20:44</span>                 mikerod </span><span>the reducing state is</span></div><div id="t1541100663077100" t="2018-11-01 19:31:03 eraserhd Is it possible for an accumulator to get a net negative, e.g. more retractions than insertions.  I&apos;m wondering because maybe this is implied by the &quot;combine&quot; function?"><a href="#t1541100663077100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-01</span> <span class="t" onclick="H(this)">19:31:03</span>                eraserhd </span><span>Is it possible for an accumulator to get a net negative, e.g. more retractions than insertions.  I&apos;m wondering because maybe this is implied by the &quot;combine&quot; function?</span></div><div id="t1541102608078800" t="2018-11-01 20:03:28 ProbablyJody I believe the combine function is just a performance optimizer for the reduce phase. I’d expect a net-negative to represent a bug in truth maintenance. I might be mis-understanding the question though."><a href="#t1541102608078800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-01</span> <span class="t" onclick="H(this)">20:03:28</span>            ProbablyJody </span><span>I believe the combine function is just a performance optimizer for the reduce phase. I’d expect a net-negative to represent a bug in truth maintenance. I might be mis-understanding the question though.</span></div><div id="t1541105324080600" t="2018-11-01 20:48:44 eraserhd I mean, obviously, if you combine all batches, you can&apos;t have more retractions than insertions. But depending on how you are batching, you could have one batch with, say three insertions and another batch with two retractions.  That would mean that two retractions were applied to the initial value in that case."><a href="#t1541105324080600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-01</span> <span class="t" onclick="H(this)">20:48:44</span>                eraserhd </span><span>I mean, obviously, if you combine all batches, you can&apos;t have more retractions than insertions. But depending on how you are batching, you could have one batch with, say three insertions and another batch with two retractions.  That would mean that two retractions were applied to the initial value in that case.</span></div><div id="t1541105457082300" t="2018-11-01 20:50:57 eraserhd Alternately, you could say that Clara enforces that retractions occur in the same batch as insertions.  I&apos;m not sure how it could, though I don&apos;t understand how this is being called."><a href="#t1541105457082300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-01</span> <span class="t" onclick="H(this)">20:50:57</span>                eraserhd </span><span>Alternately, you could say that Clara enforces that retractions occur in the same batch as insertions.  I&apos;m not sure how it could, though I don&apos;t understand how this is being called.</span></div><div id="t1541105794083700" t="2018-11-01 20:56:34 eraserhd I guess one possibility is that Clara only uses this for joins where each reduced value is a selection of attributes, such that insertions and retractions are always sorted into the same batch.  That actually makes the most sense."><a href="#t1541105794083700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-01</span> <span class="t" onclick="H(this)">20:56:34</span>                eraserhd </span><span>I guess one possibility is that Clara only uses this for joins where each reduced value is a selection of attributes, such that insertions and retractions are always sorted into the same batch.  That actually makes the most sense.</span></div><div id="t1541108398084400" t="2018-11-01 21:39:58 mikerod @eraserhd when retracting facts, with respect to an accumulator, the accumulator is only re-ran on facts that were retracted and were found to have previous matches"><a href="#t1541108398084400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-01</span> <span class="t" onclick="H(this)">21:39:58</span>                 mikerod </span><span>@eraserhd when retracting facts, with respect to an accumulator, the accumulator is only re-ran on facts that were retracted and were found to have previous matches</span></div><div id="t1541108426085000" t="2018-11-01 21:40:26 mikerod so the facts retracted and processed by an accumulator, should only be facts that were processed by the same accumulator before, when they were inserted"><a href="#t1541108426085000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-01</span> <span class="t" onclick="H(this)">21:40:26</span>                 mikerod </span><span>so the facts retracted and processed by an accumulator, should only be facts that were processed by the same accumulator before, when they were inserted</span></div><div id="t1541108462085600" t="2018-11-01 21:41:02 mikerod if you batched up retracts of facts that were not inserted yet, the accumulator wouldn’t need to retract anything"><a href="#t1541108462085600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-01</span> <span class="t" onclick="H(this)">21:41:02</span>                 mikerod </span><span>if you batched up retracts of facts that were not inserted yet, the accumulator wouldn’t need to retract anything</span></div><div id="t1541108482085800" t="2018-11-01 21:41:22 mikerod and it wouldn’t try"><a href="#t1541108482085800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-01</span> <span class="t" onclick="H(this)">21:41:22</span>                 mikerod </span><span>and it wouldn’t try</span></div><div id="t1541108517086100" t="2018-11-01 21:41:57 mikerod facts are considered the “same” via  ="><a href="#t1541108517086100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-01</span> <span class="t" onclick="H(this)">21:41:57</span>                 mikerod </span><span>facts are considered the “same” via </span><code>=</code></div><div id="t1541108525086300" t="2018-11-01 21:42:05 mikerod but respecting cardinality of them"><a href="#t1541108525086300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-01</span> <span class="t" onclick="H(this)">21:42:05</span>                 mikerod </span><span>but respecting cardinality of them</span></div><div id="t1541108541086600" t="2018-11-01 21:42:21 mikerod ie insert 2  =  objects, retract 1, you still have 1 left"><a href="#t1541108541086600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-01</span> <span class="t" onclick="H(this)">21:42:21</span>                 mikerod </span><span>ie insert 2 </span><code>=</code><span> objects, retract 1, you still have 1 left</span></div><div id="t1541108571087300" t="2018-11-01 21:42:51 mikerod if the retracted is  identical?  to 1 of  =  instances, that’d like be the one removed - but I think that’s more due to perf optimizations than anything"><a href="#t1541108571087300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-01</span> <span class="t" onclick="H(this)">21:42:51</span>                 mikerod </span><span>if the retracted is </span><code>identical?</code><span> to 1 of </span><code>=</code><span> instances, that’d like be the one removed - but I think that’s more due to perf optimizations than anything</span></div><div id="t1541110367087700" t="2018-11-01 22:12:47 eraserhd @mikerod OK, that makes sense.  Thanks!"><a href="#t1541110367087700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-01</span> <span class="t" onclick="H(this)">22:12:47</span>                eraserhd </span><span>@mikerod OK, that makes sense.  Thanks!</span></div><div id="t1541159772092500" t="2018-11-02 11:56:12 wparker @eraserhd Agreed with @mikerod that the only facts which will be retracted are those that were provided before.  Regarding the inefficiencies of accumulation with non-hash join conditions, I think that’s a more general problem than the :retract-fn actually.  For example, I believe when a new fact matching the accumulation condition is added the previous facts will have the accumulator rerun on them in their entirety, whereas the simple case with no joins or only-hash based joins will store the previous result and add onto it.  Contrast the following in AccumulateNode, the simple case:  https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/rules/engine.cljc#L1156  with the equivalent in AccumulateWithJoinFilterNode, the more complex case:  https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/rules/engine.cljc#L1525"><a href="#t1541159772092500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-02</span> <span class="t" onclick="H(this)">11:56:12</span>                 wparker </span><span>@eraserhd Agreed with @mikerod that the only facts which will be retracted are those that were provided before.  Regarding the inefficiencies of accumulation with non-hash join conditions, I think that’s a more general problem than the :retract-fn actually.  For example, I believe when a new fact matching the accumulation condition is added the previous facts will have the accumulator rerun on them in their entirety, whereas the simple case with no joins or only-hash based joins will store the previous result and add onto it.  Contrast the following in AccumulateNode, the simple case: </span><a href="https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/rules/engine.cljc#L1156" target="_blank">https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/rules/engine.cljc#L1156</a><span> with the equivalent in AccumulateWithJoinFilterNode, the more complex case: </span><a href="https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/rules/engine.cljc#L1525" target="_blank">https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/rules/engine.cljc#L1525</a></div><div id="t1541159891095000" t="2018-11-02 11:58:11 wparker The tricky thing is that Clara’s memory is set up to store the elements (facts coming into the current condition) and tokens (facts from ancestor conditions) separately, but in the case of these complex accumulator joins you’d really want to store them together for maximum efficiency.  I don’t think there is any fundamental reason why this couldn’t be done though, it"><a href="#t1541159891095000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-02</span> <span class="t" onclick="H(this)">11:58:11</span>                 wparker </span><span>The tricky thing is that Clara’s memory is set up to store the elements (facts coming into the current condition) and tokens (facts from ancestor conditions) separately, but in the case of these complex accumulator joins you’d really want to store them together for maximum efficiency.  I don’t think there is any fundamental reason why this couldn’t be done though, it</span></div><div id="t1541159920095600" t="2018-11-02 11:58:40 wparker would just be the work to do it and get it right/performant, plus durability changes probably if the memory structure changed"><a href="#t1541159920095600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-02</span> <span class="t" onclick="H(this)">11:58:40</span>                 wparker </span><span>would just be the work to do it and get it right/performant, plus durability changes probably if the memory structure changed</span></div><div id="t1541160022097400" t="2018-11-02 12:00:22 wparker Clara does avoid downstream thrash from the complex accumulators still when the result didn’t actually change - see  https://github.com/cerner/clara-rules/issues/182  and the changes made there - but the internal calculation has some room for improvement perf-wise"><a href="#t1541160022097400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-02</span> <span class="t" onclick="H(this)">12:00:22</span>                 wparker </span><span>Clara does avoid downstream thrash from the complex accumulators still when the result didn’t actually change - see </span><a href="https://github.com/cerner/clara-rules/issues/182" target="_blank">https://github.com/cerner/clara-rules/issues/182</a><span> and the changes made there - but the internal calculation has some room for improvement perf-wise</span></div><div id="t1541160187098300" t="2018-11-02 12:03:07 wparker If you want to understand how the accumulator logic works, some basic terms:"><a href="#t1541160187098300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-02</span> <span class="t" onclick="H(this)">12:03:07</span>                 wparker </span><span>If you want to understand how the accumulator logic works, some basic terms:</span></div><div id="t1541160206098700" t="2018-11-02 12:03:26 wparker -right-activate: new facts matching the condition at hand"><a href="#t1541160206098700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-02</span> <span class="t" onclick="H(this)">12:03:26</span>                 wparker </span><span>-right-activate: new facts matching the condition at hand</span></div><div id="t1541160226099100" t="2018-11-02 12:03:46 wparker -right-retract: removal of facts matching the condition at hand"><a href="#t1541160226099100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-02</span> <span class="t" onclick="H(this)">12:03:46</span>                 wparker </span><span>-right-retract: removal of facts matching the condition at hand</span></div><div id="t1541160244099600" t="2018-11-02 12:04:04 wparker -left-activate: facts were added to ancestor conditions and need to be passed down the network"><a href="#t1541160244099600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-02</span> <span class="t" onclick="H(this)">12:04:04</span>                 wparker </span><span>-left-activate: facts were added to ancestor conditions and need to be passed down the network</span></div><div id="t1541160279100300" t="2018-11-02 12:04:39 wparker left-retract: facts were removed from ancestor conditions and need to be passed down the network"><a href="#t1541160279100300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-02</span> <span class="t" onclick="H(this)">12:04:39</span>                 wparker </span><span>left-retract: facts were removed from ancestor conditions and need to be passed down the network</span></div><div id="t1541160310101000" t="2018-11-02 12:05:10 wparker AccumulateNode - simple no-condition or hash-join-only accumulation conditions"><a href="#t1541160310101000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-02</span> <span class="t" onclick="H(this)">12:05:10</span>                 wparker </span><span>AccumulateNode - simple no-condition or hash-join-only accumulation conditions</span></div><div id="t1541160356102100" t="2018-11-02 12:05:56 wparker AccumulateWithjoinFilterNode - accumulation condition with arbitrary filter logic taking facts from ancestor conditions as input"><a href="#t1541160356102100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-02</span> <span class="t" onclick="H(this)">12:05:56</span>                 wparker </span><span>AccumulateWithjoinFilterNode - accumulation condition with arbitrary filter logic taking facts from ancestor conditions as input</span></div><div id="t1541160573105200" t="2018-11-02 12:09:33 wparker probably the best source of truth there is the code, fortunately it is a well commented area imo though i’m biased as i wrote many of those comments"><a href="#t1541160573105200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-02</span> <span class="t" onclick="H(this)">12:09:33</span>                 wparker </span><span>probably the best source of truth there is the code, fortunately it is a well commented area imo though i’m biased as i wrote many of those comments</span></div><div id="t1541160615106100" t="2018-11-02 12:10:15 wparker to be clear: when I say to understand how it works, i mean the algorithms at play - the docs should be sufficient for the behavior and if they’re not they should be improved"><a href="#t1541160615106100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-02</span> <span class="t" onclick="H(this)">12:10:15</span>                 wparker </span><span>to be clear: when I say to understand how it works, i mean the algorithms at play - the docs should be sufficient for the behavior and if they’re not they should be improved</span></div><div id="t1541160628106400" t="2018-11-02 12:10:28 wparker hopefully this helps"><a href="#t1541160628106400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-02</span> <span class="t" onclick="H(this)">12:10:28</span>                 wparker </span><span>hopefully this helps</span></div><div id="t1541160666107000" t="2018-11-02 12:11:06 wparker if you’re trying to get a case with complex accumulator joins to perform better, frankly my first reaction would be to use salience most likely"><a href="#t1541160666107000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-02</span> <span class="t" onclick="H(this)">12:11:06</span>                 wparker </span><span>if you’re trying to get a case with complex accumulator joins to perform better, frankly my first reaction would be to use salience most likely</span></div><div id="t1541160722108100" t="2018-11-02 12:12:02 wparker if you’re using truth maintenance without side effects, the salience shouldn’t impact actual behavior so it doesn’t make the code harder to read/understand in that respect"><a href="#t1541160722108100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-02</span> <span class="t" onclick="H(this)">12:12:02</span>                 wparker </span><span>if you’re using truth maintenance without side effects, the salience shouldn’t impact actual behavior so it doesn’t make the code harder to read/understand in that respect</span></div><div id="t1541166252108600" t="2018-11-02 13:44:12 eraserhd @wparker thanks!  This is all good info."><a href="#t1541166252108600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-02</span> <span class="t" onclick="H(this)">13:44:12</span>                eraserhd </span><span>@wparker thanks!  This is all good info.</span></div><div id="t1541166519109700" t="2018-11-02 13:48:39 eraserhd I&apos;m guessing, in [Foo (= ?a a)] [?acc &lt;- (acc/whatever) [Bar (= ?a a)]], Foo would be left and Bar would be right?"><a href="#t1541166519109700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-02</span> <span class="t" onclick="H(this)">13:48:39</span>                eraserhd </span><span>I&apos;m guessing, in [Foo (= ?a a)] [?acc &lt;- (acc/whatever) [Bar (= ?a a)]], Foo would be left and Bar would be right?</span></div><div id="t1541173595110000" t="2018-11-02 15:46:35 mikerod @eraserhd basically yes"><a href="#t1541173595110000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-02</span> <span class="t" onclick="H(this)">15:46:35</span>                 mikerod </span><span>@eraserhd basically yes</span></div><div id="t1541173607110300" t="2018-11-02 15:46:47 mikerod left is the matched-token-so-far in a rule LHS"><a href="#t1541173607110300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-02</span> <span class="t" onclick="H(this)">15:46:47</span>                 mikerod </span><span>left is the matched-token-so-far in a rule LHS</span></div><div id="t1541173633110700" t="2018-11-02 15:47:13 mikerod tokens consist of all facts involved in a match"><a href="#t1541173633110700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-02</span> <span class="t" onclick="H(this)">15:47:13</span>                 mikerod </span><span>tokens consist of all facts involved in a match</span></div><div id="t1541173706112000" t="2018-11-02 15:48:26 mikerod In a LHS  [A] [B] [C]  if we were looking at the network node for the  [C]  condition, incoming  C  facts would be  right-activate ,  left-activate  to this node would be matched up  A +`B`s - represented as a “token”"><a href="#t1541173706112000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-02</span> <span class="t" onclick="H(this)">15:48:26</span>                 mikerod </span><span>In a LHS </span><code>[A] [B] [C]</code><span> if we were looking at the network node for the </span><code>[C]</code><span> condition, incoming </span><code>C</code><span> facts would be </span><code>right-activate</code><span>, </span><code>left-activate</code><span> to this node would be matched up </span><code>A</code><span>+`B`s - represented as a “token”</span></div><div id="t1541179475114300" t="2018-11-02 17:24:35 wparker And for the [B] condition, incoming B facts would be right-activate, left-activate would be tokens passed down from the [A] condition.  For the [A] condition the right-activate would be incoming A facts, the left-activate would basically be a dummy placeholder.  Does that make sense?"><a href="#t1541179475114300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-02</span> <span class="t" onclick="H(this)">17:24:35</span>                 wparker </span><span>And for the [B] condition, incoming B facts would be right-activate, left-activate would be tokens passed down from the [A] condition.  For the [A] condition the right-activate would be incoming A facts, the left-activate would basically be a dummy placeholder.  Does that make sense?</span></div><div id="t1541539357115100" t="2018-11-06 21:22:37 eraserhd queries are prioritized last (in terms of  salience ), I hope, right?"><a href="#t1541539357115100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-06</span> <span class="t" onclick="H(this)">21:22:37</span>                eraserhd </span><span>queries are prioritized last (in terms of </span><code>salience</code><span>), I hope, right?</span></div><div id="t1541541989115700" t="2018-11-06 22:06:29 mikerod @eraserhd I’m can’t think of a reason where it’d matter how queries are “prioritized”"><a href="#t1541541989115700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-06</span> <span class="t" onclick="H(this)">22:06:29</span>                 mikerod </span><span>@eraserhd I’m can’t think of a reason where it’d matter how queries are “prioritized”</span></div><div id="t1541542011116400" t="2018-11-06 22:06:51 mikerod they just receive matches from facts that are currently in working memory"><a href="#t1541542011116400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-06</span> <span class="t" onclick="H(this)">22:06:51</span>                 mikerod </span><span>they just receive matches from facts that are currently in working memory</span></div><div id="t1541542025116900" t="2018-11-06 22:07:05 mikerod priority with  :salience  is about ordering when a rule is eligible to be fired"><a href="#t1541542025116900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-06</span> <span class="t" onclick="H(this)">22:07:05</span>                 mikerod </span><span>priority with </span><code>:salience</code><span> is about ordering when a rule is eligible to be fired</span></div><div id="t1541542038117500" t="2018-11-06 22:07:18 mikerod aka perform the action specified on its RHS, so this concept does not apply to queries"><a href="#t1541542038117500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-06</span> <span class="t" onclick="H(this)">22:07:18</span>                 mikerod </span><span>aka perform the action specified on its RHS, so this concept does not apply to queries</span></div><div id="t1541542110118600" t="2018-11-06 22:08:30 eraserhd hmm, so if I have rules that insert and retract things that are queried, the query results aren&apos;t updated by the firing of a pseudo-rule?"><a href="#t1541542110118600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-06</span> <span class="t" onclick="H(this)">22:08:30</span>                eraserhd </span><span>hmm, so if I have rules that insert and retract things that are queried, the query results aren&apos;t updated by the firing of a pseudo-rule?</span></div><div id="t1541542319120200" t="2018-11-06 22:11:59 eraserhd (bad sentence, but hopefully the question is clear)"><a href="#t1541542319120200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-06</span> <span class="t" onclick="H(this)">22:11:59</span>                eraserhd </span><span>(bad sentence, but hopefully the question is clear)</span></div><div id="t1541543346121000" t="2018-11-06 22:29:06 eraserhd OK, I see.  They are their own thing."><a href="#t1541543346121000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-06</span> <span class="t" onclick="H(this)">22:29:06</span>                eraserhd </span><span>OK, I see.  They are their own thing.</span></div><div id="t1541545627121900" t="2018-11-06 23:07:07 mikerod Not sure I understand that question. But in general always fire rules before query. Not sure if that helps. Hah"><a href="#t1541545627121900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-06</span> <span class="t" onclick="H(this)">23:07:07</span>                 mikerod </span><span>Not sure I understand that question. But in general always fire rules before query. Not sure if that helps. Hah</span></div><div id="t1541599596126200" t="2018-11-07 14:06:36 wparker @eraserhd Not sure I understand the question either, but the API with queries is that if you call the query function on a rules session after firing rules, the query results will reflect all insertions/retractions prior to the fire-rules call.  Under the hood, queries are basically a rule LHS and the results are computed as part of fire-rules - the query function in clara.rules really is more of a “retrieve query results” function than a “run query” in that way.  If your concern was performance, there are optimizations that could be made around deferring some query matching work to later in the fire-rules, thus avoiding the need to retract query matches that are invalidated, but that hasn’t been implemented.   I’ve found it isn’t often an issue and in the few cases where it was it was fairly easy to work around."><a href="#t1541599596126200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-07</span> <span class="t" onclick="H(this)">14:06:36</span>                 wparker </span><span>@eraserhd Not sure I understand the question either, but the API with queries is that if you call the query function on a rules session after firing rules, the query results will reflect all insertions/retractions prior to the fire-rules call.  Under the hood, queries are basically a rule LHS and the results are computed as part of fire-rules - the query function in clara.rules really is more of a “retrieve query results” function than a “run query” in that way.  If your concern was performance, there are optimizations that could be made around deferring some query matching work to later in the fire-rules, thus avoiding the need to retract query matches that are invalidated, but that hasn’t been implemented.   I’ve found it isn’t often an issue and in the few cases where it was it was fairly easy to work around.</span></div><div id="t1542202805129100" t="2018-11-14 13:40:05 nlessa Hi, I am having performance problems in my set of rules. Probably some of the rules are performing bad. Is there any way to profile the time spent by each rule when firing-rules in a session? I couldn&apos;t find any obvious way to get this info  using the inspect api."><a href="#t1542202805129100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-14</span> <span class="t" onclick="H(this)">13:40:05</span>                  nlessa </span><span>Hi, I am having performance problems in my set of rules. Probably some of the rules are performing bad. Is there any way to profile the time spent by each rule when firing-rules in a session? I couldn&apos;t find any obvious way to get this info  using the inspect api.</span></div><div id="t1542205056132800" t="2018-11-14 14:17:36 wparker The inspect api is targeted at understanding the end result of the rules, not performance.  For performance problems you’ll probably want a profiler or perhaps tracing.   Tracing shows all the internal steps of the rules engine, and can produce a lot of data that is probably best sorted through with the REPL rather than manual inspection, but if a single rule is constantly re-firing it can make that clear.  I’d probably start with a profiler though.  Another approach could be to take separate parts of your use-case and see if you can find a simple subset with the perf problem, particularly one you can share that would be easier for someone else to look at."><a href="#t1542205056132800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-14</span> <span class="t" onclick="H(this)">14:17:36</span>                 wparker </span><span>The inspect api is targeted at understanding the end result of the rules, not performance.  For performance problems you’ll probably want a profiler or perhaps tracing.   Tracing shows all the internal steps of the rules engine, and can produce a lot of data that is probably best sorted through with the REPL rather than manual inspection, but if a single rule is constantly re-firing it can make that clear.  I’d probably start with a profiler though.  Another approach could be to take separate parts of your use-case and see if you can find a simple subset with the perf problem, particularly one you can share that would be easier for someone else to look at.</span></div><div id="t1542205078133200" t="2018-11-14 14:17:58 wparker Are you on Clojure or ClojureScript?"><a href="#t1542205078133200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-14</span> <span class="t" onclick="H(this)">14:17:58</span>                 wparker </span><span>Are you on Clojure or ClojureScript?</span></div><div id="t1542205225133800" t="2018-11-14 14:20:25 nlessa Thanks, @wparker! Clojure."><a href="#t1542205225133800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-14</span> <span class="t" onclick="H(this)">14:20:25</span>                  nlessa </span><span>Thanks, @wparker! Clojure.</span></div><div id="t1542213621135700" t="2018-11-14 16:40:21 mikerod @nlessa and feel free to share profiler sample results with me (or anyone interested) (with anything propriety removes). Sometimes just seeing the Clara internals in a profiling snapshot can help point someone in the right direction. Not always though. "><a href="#t1542213621135700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-14</span> <span class="t" onclick="H(this)">16:40:21</span>                 mikerod </span><span>@nlessa and feel free to share profiler sample results with me (or anyone interested) (with anything propriety removes). Sometimes just seeing the Clara internals in a profiling snapshot can help point someone in the right direction. Not always though. </span></div><div id="t1542310997137000" t="2018-11-15 19:43:17 eraserhd dsl seems to parse a thing  :exists  as an operator, but it&apos;s not documented.  This sounds like a missing feature we&apos;ve wanted... is it true?"><a href="#t1542310997137000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-15</span> <span class="t" onclick="H(this)">19:43:17</span>                eraserhd </span><span>dsl seems to parse a thing </span><code>:exists</code><span> as an operator, but it&apos;s not documented.  This sounds like a missing feature we&apos;ve wanted... is it true?</span></div><div id="t1542311451137600" t="2018-11-15 19:50:51 enn Good catch on the missing docs. There was some discussion on the list when it was implemented, see  https://github.com/cerner/clara-rules/issues/130  for details."><a href="#t1542311451137600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-15</span> <span class="t" onclick="H(this)">19:50:51</span>                     enn </span><span>Good catch on the missing docs. There was some discussion on the list when it was implemented, see </span><a href="https://github.com/cerner/clara-rules/issues/130" target="_blank">https://github.com/cerner/clara-rules/issues/130</a><span> for details.</span></div><div id="t1542311583138400" t="2018-11-15 19:53:03 mikerod @eraserhd @enn Yeah, if it isn’t documented seems like it probably should be"><a href="#t1542311583138400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-15</span> <span class="t" onclick="H(this)">19:53:03</span>                 mikerod </span><span>@eraserhd @enn Yeah, if it isn’t documented seems like it probably should be</span></div><div id="t1542311592138700" t="2018-11-15 19:53:12 mikerod good find on the relevant issue"><a href="#t1542311592138700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-15</span> <span class="t" onclick="H(this)">19:53:12</span>                 mikerod </span><span>good find on the relevant issue</span></div><div id="t1542322544139600" t="2018-11-15 22:55:44 eraserhd @claudius.nicolae We are going to start heavily using clara-eav, and we have three big pieces of functionality to contribute back."><a href="#t1542322544139600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-15</span> <span class="t" onclick="H(this)">22:55:44</span>                eraserhd </span><span>@claudius.nicolae We are going to start heavily using clara-eav, and we have three big pieces of functionality to contribute back.</span></div><div id="t1542322563139900" t="2018-11-15 22:56:03 eraserhd Will you be at Clojure/conj?"><a href="#t1542322563139900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-15</span> <span class="t" onclick="H(this)">22:56:03</span>                eraserhd </span><span>Will you be at Clojure/conj?</span></div><div id="t1542658057141200" t="2018-11-19 20:07:37 eraserhd I&apos;ve been reading Rete algorithm stuff, and I&apos;ve been wondering why I haven&apos;t seen references to this paper in them:  http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.6.5507  -- (I couldn&apos;t remember the name of the paper until it appeared on the Clojure list just recently.)"><a href="#t1542658057141200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-19</span> <span class="t" onclick="H(this)">20:07:37</span>                eraserhd </span><span>I&apos;ve been reading Rete algorithm stuff, and I&apos;ve been wondering why I haven&apos;t seen references to this paper in them: </span><a href="http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.6.5507" target="_blank">http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.6.5507</a><span> -- (I couldn&apos;t remember the name of the paper until it appeared on the Clojure list just recently.)</span></div><div id="t1542658116142300" t="2018-11-19 20:08:36 eraserhd It seems like this is a bunch more thought that applies to how to build an alpha network than I&apos;ve seen mentioned before."><a href="#t1542658116142300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-19</span> <span class="t" onclick="H(this)">20:08:36</span>                eraserhd </span><span>It seems like this is a bunch more thought that applies to how to build an alpha network than I&apos;ve seen mentioned before.</span></div><div id="t1542658580142500" t="2018-11-19 20:16:20 mikerod @eraserhd not familiar with this one."><a href="#t1542658580142500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-19</span> <span class="t" onclick="H(this)">20:16:20</span>                 mikerod </span><span>@eraserhd not familiar with this one.</span></div><div id="t1542658626143100" t="2018-11-19 20:17:06 mikerod looks like it’d take a bit to parse through it to see how the ideas relate to other rete things that are out there"><a href="#t1542658626143100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-19</span> <span class="t" onclick="H(this)">20:17:06</span>                 mikerod </span><span>looks like it’d take a bit to parse through it to see how the ideas relate to other rete things that are out there</span></div><div id="t1542658982144600" t="2018-11-19 20:23:02 eraserhd I have yet to see anything about optimizing the order of alpha tests, except for specific things like hashing 8 ways to find an alpha memory when using triplets."><a href="#t1542658982144600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-19</span> <span class="t" onclick="H(this)">20:23:02</span>                eraserhd </span><span>I have yet to see anything about optimizing the order of alpha tests, except for specific things like hashing 8 ways to find an alpha memory when using triplets.</span></div><div id="t1542659093145600" t="2018-11-19 20:24:53 eraserhd AFAICT, there&apos;s no cases of filtering with user tests before storing in an alpha memory, even, and I presume that&apos;s because it&apos;s hard to know when you can do that and not duplicate memories?"><a href="#t1542659093145600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-19</span> <span class="t" onclick="H(this)">20:24:53</span>                eraserhd </span><span>AFAICT, there&apos;s no cases of filtering with user tests before storing in an alpha memory, even, and I presume that&apos;s because it&apos;s hard to know when you can do that and not duplicate memories?</span></div><div id="t1542659383146100" t="2018-11-19 20:29:43 mikerod Clara’s alpha network partitions on how facts match the “type” criteria first"><a href="#t1542659383146100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-19</span> <span class="t" onclick="H(this)">20:29:43</span>                 mikerod </span><span>Clara’s alpha network partitions on how facts match the “type” criteria first</span></div><div id="t1542659405146700" t="2018-11-19 20:30:05 mikerod if you have alpha-side only constraints like  [A (&lt; x 5)]"><a href="#t1542659405146700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-19</span> <span class="t" onclick="H(this)">20:30:05</span>                 mikerod </span><span>if you have alpha-side only constraints like </span><code>[A (&lt; x 5)]</code></div><div id="t1542659420147100" t="2018-11-19 20:30:20 mikerod those will be filtered as they come in and will not be stored in alpha mem if they don’t match"><a href="#t1542659420147100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-19</span> <span class="t" onclick="H(this)">20:30:20</span>                 mikerod </span><span>those will be filtered as they come in and will not be stored in alpha mem if they don’t match</span></div><div id="t1542659470148100" t="2018-11-19 20:31:10 mikerod and if you have variable bindings (via the overloaded  =  semantics), eg.  [A (= ?x x)] , facts in the alpha memory will be stored in a hash lookup keyed by that variable binding"><a href="#t1542659470148100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-19</span> <span class="t" onclick="H(this)">20:31:10</span>                 mikerod </span><span>and if you have variable bindings (via the overloaded </span><code>=</code><span> semantics), eg. </span><code>[A (= ?x x)]</code><span>, facts in the alpha memory will be stored in a hash lookup keyed by that variable binding</span></div><div id="t1542659516148500" t="2018-11-19 20:31:56 mikerod those are the main alpha-side network details I can think of"><a href="#t1542659516148500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-19</span> <span class="t" onclick="H(this)">20:31:56</span>                 mikerod </span><span>those are the main alpha-side network details I can think of</span></div><div id="t1542733378150700" t="2018-11-20 17:02:58 souenzzo Case A
 [:test (my-pred?)]
[MyFact [a] (= a ?a)]
=&gt;
....
 
Case B
 [MyFact [a] (= a ?a)]
[:test (my-pred?)]
=&gt;
....
 
With  A , clara will call  my-pred?  at  mk-session 
With  B , clara will call  my-pred?  at  fire-rules 
There is docs about this behavior?"><a href="#t1542733378150700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-20</span> <span class="t" onclick="H(this)">17:02:58</span>                souenzzo </span><span>Case A
</span><pre>[:test (my-pred?)]
[MyFact [a] (= a ?a)]
=&gt;
....
</pre><span>
Case B
</span><pre>[MyFact [a] (= a ?a)]
[:test (my-pred?)]
=&gt;
....
</pre><span>
With </span><code>A</code><span>, clara will call </span><code>my-pred?</code><span> at </span><code>mk-session</code><span>
With </span><code>B</code><span>, clara will call </span><code>my-pred?</code><span> at </span><code>fire-rules</code><span>
There is docs about this behavior?</span></div><div id="t1542735939153000" t="2018-11-20 17:45:39 ethanc I&apos;m not sure there is any document referencing that behavior. It would be an odd scenario to have a test node that is independent of the other nodes in a production. A typical scenario would make that test node dependent on some upstream fact, thus making the test node evaluate some time during  fire-rules"><a href="#t1542735939153000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-20</span> <span class="t" onclick="H(this)">17:45:39</span>                  ethanc </span><span>I&apos;m not sure there is any document referencing that behavior. It would be an odd scenario to have a test node that is independent of the other nodes in a production. A typical scenario would make that test node dependent on some upstream fact, thus making the test node evaluate some time during </span><code>fire-rules</code></div><div id="t1542737378153300" t="2018-11-20 18:09:38 souenzzo @ethanc can I disable it?"><a href="#t1542737378153300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-20</span> <span class="t" onclick="H(this)">18:09:38</span>                souenzzo </span><span>@ethanc can I disable it?</span></div><div id="t1542737533155600" t="2018-11-20 18:12:13 ethanc I&apos;m not sure what you mean by  disable it . From your example above i am assuming that  my-pred?  is some sort of stateful check, and if that is true then i would recommend against imbedding that sort of logic in the network itself, maybe moving it to the RHS of the rule."><a href="#t1542737533155600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-20</span> <span class="t" onclick="H(this)">18:12:13</span>                  ethanc </span><span>I&apos;m not sure what you mean by </span><code>disable it</code><span>. From your example above i am assuming that </span><code>my-pred?</code><span> is some sort of stateful check, and if that is true then i would recommend against imbedding that sort of logic in the network itself, maybe moving it to the RHS of the rule.</span></div><div id="t1542737607156000" t="2018-11-20 18:13:27 souenzzo It&apos;s not statefull. it access a  *dynamic*  env var  🙂"><a href="#t1542737607156000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-20</span> <span class="t" onclick="H(this)">18:13:27</span>                souenzzo </span><span>It&apos;s not statefull. it access a </span><code>*dynamic*</code><span> env var </span><b>🙂</b></div><div id="t1542739418163300" t="2018-11-20 18:43:38 ethanc The use of a dynamic var would likely be considered stateful, as the state of the var would impact the result from the predicate.

Clara makes some pretty big assumptions on statelessness, as in it will not reevaluate conditions that it &quot;doesn&apos;t have to&quot;. Air quoting  doesn&apos;t have to  because clara determines what must be reevaluated by direct or indirect actions(Truth Maintenance) on the session, ie insertion or retraction of facts.
That being said, if there is statefulness in a session&apos;s rules and for some reason that state changes then all bets are off when it comes to the validity of the outcome of said rules."><a href="#t1542739418163300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-20</span> <span class="t" onclick="H(this)">18:43:38</span>                  ethanc </span><span>The use of a dynamic var would likely be considered stateful, as the state of the var would impact the result from the predicate.

Clara makes some pretty big assumptions on statelessness, as in it will not reevaluate conditions that it &quot;doesn&apos;t have to&quot;. Air quoting </span><code>doesn&apos;t have to</code><span> because clara determines what must be reevaluated by direct or indirect actions(Truth Maintenance) on the session, ie insertion or retraction of facts.
That being said, if there is statefulness in a session&apos;s rules and for some reason that state changes then all bets are off when it comes to the validity of the outcome of said rules.</span></div><div id="t1542739525163800" t="2018-11-20 18:45:25 mikerod Perhaps you could instead insert facts that represent the same thing that this dynamic var encapsulates"><a href="#t1542739525163800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-20</span> <span class="t" onclick="H(this)">18:45:25</span>                 mikerod </span><span>Perhaps you could instead insert facts that represent the same thing that this dynamic var encapsulates</span></div><div id="t1542739554164500" t="2018-11-20 18:45:54 mikerod however, evaluating anything at “compile time” of  mk-session  seems weird to me. I’d have to see it reproduced probably to understand what may be happening there"><a href="#t1542739554164500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-20</span> <span class="t" onclick="H(this)">18:45:54</span>                 mikerod </span><span>however, evaluating anything at “compile time” of </span><code>mk-session</code><span> seems weird to me. I’d have to see it reproduced probably to understand what may be happening there</span></div><div id="t1542745393164900" t="2018-11-20 20:23:13 souenzzo https://gist.github.com/souenzzo/e38e600d486532308084c2bba0a9b3e9  @mikerod"><a href="#t1542745393164900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-20</span> <span class="t" onclick="H(this)">20:23:13</span>                souenzzo </span><a href="https://gist.github.com/souenzzo/e38e600d486532308084c2bba0a9b3e9" target="_blank">https://gist.github.com/souenzzo/e38e600d486532308084c2bba0a9b3e9</a><span> @mikerod</span></div><div id="t1542745553165300" t="2018-11-20 20:25:53 souenzzo #tools-deps is awesme to report bugs  ❤️"><a href="#t1542745553165300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-20</span> <span class="t" onclick="H(this)">20:25:53</span>                souenzzo </span><span>#tools-deps is awesme to report bugs </span><b>❤️</b></div><div id="t1542749769173800" t="2018-11-20 21:36:09 ethanc @souenzzo,

I was looking at your example, it seems that the side effect that you mention is due to:
 https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/rules/engine.cljc#L2050 
which is used during the creation of the session as you described:
 https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/rules.cljc#L264 

The left activate in that snippet seems to be aimed at rules that have no LHS, ex:
 (r/defrule insert-sentinel 
  =&gt;
  (r/insert! (-&gt;SomeFact)))
 
the token being passed is empty. This &quot;bootstrapping&quot; operation is likely done because these productions wouldn&apos;t have an alpha-root for them to be triggered later.

In your scenario:
 (defrule rule1
  [:test (my-pred? :rule1)]
  [Fact (= a ?a)]
  =&gt;
  (prn [&quot;rule1&quot; ?a]))
 
the first node in the beta-roots would be the test-node, as mentioned before this is not a normal pattern as test nodes are usually dependent on prior facts.

When the conditions are reversed the test node would not be evaluated as it would be a child node of a join node."><a href="#t1542749769173800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-20</span> <span class="t" onclick="H(this)">21:36:09</span>                  ethanc </span><span>@souenzzo,

I was looking at your example, it seems that the side effect that you mention is due to:
</span><a href="https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/rules/engine.cljc#L2050" target="_blank">https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/rules/engine.cljc#L2050</a><span>
which is used during the creation of the session as you described:
</span><a href="https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/rules.cljc#L264" target="_blank">https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/rules.cljc#L264</a><span>

The left activate in that snippet seems to be aimed at rules that have no LHS, ex:
</span><pre>(r/defrule insert-sentinel 
  =&gt;
  (r/insert! (-&gt;SomeFact)))
</pre><span>
the token being passed is empty. This &quot;bootstrapping&quot; operation is likely done because these productions wouldn&apos;t have an alpha-root for them to be triggered later.

In your scenario:
</span><pre>(defrule rule1
  [:test (my-pred? :rule1)]
  [Fact (= a ?a)]
  =&gt;
  (prn [&quot;rule1&quot; ?a]))
</pre><span>
the first node in the beta-roots would be the test-node, as mentioned before this is not a normal pattern as test nodes are usually dependent on prior facts.

When the conditions are reversed the test node would not be evaluated as it would be a child node of a join node.</span></div><div id="t1542750267178300" t="2018-11-20 21:44:27 souenzzo PROPOSAL: If is possible to reach LHS, then run the RHS. If there is no how to reach LHS, then do not run anything in RHS.
Is it possible? Is it reasonable? Should I open a issue? I think that I can try a PR."><a href="#t1542750267178300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-20</span> <span class="t" onclick="H(this)">21:44:27</span>                souenzzo </span><span>PROPOSAL: If is possible to reach LHS, then run the RHS. If there is no how to reach LHS, then do not run anything in RHS.
Is it possible? Is it reasonable? Should I open a issue? I think that I can try a PR.</span></div><div id="t1542754493182300" t="2018-11-20 22:54:53 ethanc @souenzzo
I&apos;m not sure i fully understand the intent of your proposal.
The determination of RHS evaluation is done currently by percolating facts down the nodes until they ideally enter a ProductionNode, assuming all conditions are met.
To do this we would still have to evaluate the truthiness of the LHS."><a href="#t1542754493182300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-20</span> <span class="t" onclick="H(this)">22:54:53</span>                  ethanc </span><span>@souenzzo
I&apos;m not sure i fully understand the intent of your proposal.
The determination of RHS evaluation is done currently by percolating facts down the nodes until they ideally enter a ProductionNode, assuming all conditions are met.
To do this we would still have to evaluate the truthiness of the LHS.</span></div><div id="t1543266470184400" t="2018-11-26 21:07:50 eraserhd Hey, where’s the source for the Clara Rules site?  I don’t see it on gh-pages or master in the clara-rules repo. "><a href="#t1543266470184400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-26</span> <span class="t" onclick="H(this)">21:07:50</span>                eraserhd </span><span>Hey, where’s the source for the Clara Rules site?  I don’t see it on gh-pages or master in the clara-rules repo. </span></div><div id="t1543267557184800" t="2018-11-26 21:25:57 mikerod @eraserhd  https://github.com/cerner/clara-site"><a href="#t1543267557184800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-26</span> <span class="t" onclick="H(this)">21:25:57</span>                 mikerod </span><span>@eraserhd </span><a href="https://github.com/cerner/clara-site" target="_blank">https://github.com/cerner/clara-site</a></div><div id="t1543268594185300" t="2018-11-26 21:43:14 eraserhd oh, thanks"><a href="#t1543268594185300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-26</span> <span class="t" onclick="H(this)">21:43:14</span>                eraserhd </span><span>oh, thanks</span></div><div id="t1543270918185800" t="2018-11-26 22:21:58 mikerod no prob, hopefully it has enough info there to see how to work with it"><a href="#t1543270918185800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-26</span> <span class="t" onclick="H(this)">22:21:58</span>                 mikerod </span><span>no prob, hopefully it has enough info there to see how to work with it</span></div><div id="t1543279880188000" t="2018-11-27 00:51:20 eraserhd waving  Don’t know what it’d look like, but I’m at the Conj and would love to meet any/all people using or contributing to Clara."><a href="#t1543279880188000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-27</span> <span class="t" onclick="H(this)">00:51:20</span>                eraserhd </span><b>waving</b><span> Don’t know what it’d look like, but I’m at the Conj and would love to meet any/all people using or contributing to Clara.</span></div><div id="t1543280006188900" t="2018-11-27 00:53:26 jvtrigueros Sad I’m missing Conj this year :( sounded like some really good stuff was gonna be announced"><a href="#t1543280006188900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-27</span> <span class="t" onclick="H(this)">00:53:26</span>             jvtrigueros </span><span>Sad I’m missing Conj this year :( sounded like some really good stuff was gonna be announced</span></div><div id="t1543293384189800" t="2018-11-27 04:36:24 mikerod I won’t be at conj this year sadly. I know a few Clara contributors here are though. "><a href="#t1543293384189800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-27</span> <span class="t" onclick="H(this)">04:36:24</span>                 mikerod </span><span>I won’t be at conj this year sadly. I know a few Clara contributors here are though. </span></div><div id="t1543520551190100" t="2018-11-29 19:42:31 devn waving  "><a href="#t1543520551190100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-29</span> <span class="t" onclick="H(this)">19:42:31</span>                    devn </span><b>waving</b><span> </span></div><div id="t1543520573190800" t="2018-11-29 19:42:53 devn not a contributor, but was a satisfied user for a few years "><a href="#t1543520573190800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-11-29</span> <span class="t" onclick="H(this)">19:42:53</span>                    devn </span><span>not a contributor, but was a satisfied user for a few years </span></div><div id="t1544027024001600" t="2018-12-05 16:23:44 eraserhd I&apos;m in the process of documenting  :exists , and I see that there is a thing called  :condition  which also isn&apos;t documented."><a href="#t1544027024001600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-12-05</span> <span class="t" onclick="H(this)">16:23:44</span>                eraserhd </span><span>I&apos;m in the process of documenting </span><code>:exists</code><span>, and I see that there is a thing called </span><code>:condition</code><span> which also isn&apos;t documented.</span></div><div id="t1544028541001900" t="2018-12-05 16:49:01 mikerod @eraserhd what is this  :condition  that you are referring to?"><a href="#t1544028541001900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-12-05</span> <span class="t" onclick="H(this)">16:49:01</span>                 mikerod </span><span>@eraserhd what is this </span><code>:condition</code><span> that you are referring to?</span></div><div id="t1544028548002200" t="2018-12-05 16:49:08 mikerod where do you see it?"><a href="#t1544028548002200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-12-05</span> <span class="t" onclick="H(this)">16:49:08</span>                 mikerod </span><span>where do you see it?</span></div><div id="t1544028885002900" t="2018-12-05 16:54:45 eraserhd In compiler.clj... I just realized that I didn&apos;t look at the context.  It might be a compiler internal."><a href="#t1544028885002900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-12-05</span> <span class="t" onclick="H(this)">16:54:45</span>                eraserhd </span><span>In compiler.clj... I just realized that I didn&apos;t look at the context.  It might be a compiler internal.</span></div><div id="t1544028899003200" t="2018-12-05 16:54:59 ethanc that sounds right"><a href="#t1544028899003200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-12-05</span> <span class="t" onclick="H(this)">16:54:59</span>                  ethanc </span><span>that sounds right</span></div><div id="t1544028917003600" t="2018-12-05 16:55:17 ethanc i would think that we surfaced it in the dsl proper"><a href="#t1544028917003600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-12-05</span> <span class="t" onclick="H(this)">16:55:17</span>                  ethanc </span><span>i would think that we surfaced it in the dsl proper</span></div><div id="t1544029054003800" t="2018-12-05 16:57:34 ethanc *wouldn&apos;t"><a href="#t1544029054003800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-12-05</span> <span class="t" onclick="H(this)">16:57:34</span>                  ethanc </span><span>*wouldn&apos;t</span></div><div id="t1544029065004100" t="2018-12-05 16:57:45 ethanc sorry about the confusion"><a href="#t1544029065004100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-12-05</span> <span class="t" onclick="H(this)">16:57:45</span>                  ethanc </span><span>sorry about the confusion</span></div><div id="t1544030451004400" t="2018-12-05 17:20:51 mikerod yeah, should just be internal compiler stuff"><a href="#t1544030451004400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-12-05</span> <span class="t" onclick="H(this)">17:20:51</span>                 mikerod </span><span>yeah, should just be internal compiler stuff</span></div><div id="t1544030457004600" t="2018-12-05 17:20:57 mikerod that’s what I thought  :condition  was"><a href="#t1544030457004600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-12-05</span> <span class="t" onclick="H(this)">17:20:57</span>                 mikerod </span><span>that’s what I thought </span><code>:condition</code><span> was</span></div><div id="t1544102996006700" t="2018-12-06 13:29:56 hjrnunes Hello! I&apos;m trying to get some explanations for my rules, but  clara.tools.inspect/explain-activations  doesn&apos;t print anything at all. With  clara.tools.inspect/inspect  I get a map but  :fact-&gt;explanations  is nil:
 {:rule-matches
 {{:ns-name validator.typing,
   :lhs
            [[:not {:type validator.typing.LowCardinality, :constraints []}]],
   :rhs     (do (c/insert! (-&gt;ColType :t))),
   :props   {:salience -100},
   :name    &quot;validator.typing/text&quot;,
   :doc     &quot;The column is textual when cardinality is not low&quot;}
  (),
  ...
  :query-matches ...
  :condition-matches
  {{:type validator.typing.ColInfo, :constraints [(= 1 non-num-vals)]}
                                                                   (),
   {:type validator.typing.LowCardinality, :constraints []}        (),
   ...
  :insertions
  {{:ns-name validator.typing,
    :lhs
             [[:not {:type validator.typing.LowCardinality, :constraints []}]],
    :rhs     (do (c/insert! (-&gt;ColType :t))),
    :props   {:salience -100},
    :name    &quot;validator.typing/text&quot;,
    :doc     &quot;The column is textual when cardinality is not low&quot;}
   (),
   ...},
  :fact-&gt;explanations nil}
"><a href="#t1544102996006700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-12-06</span> <span class="t" onclick="H(this)">13:29:56</span>                hjrnunes </span><span>Hello! I&apos;m trying to get some explanations for my rules, but </span><code>clara.tools.inspect/explain-activations</code><span> doesn&apos;t print anything at all. With </span><code>clara.tools.inspect/inspect</code><span> I get a map but </span><code>:fact-&gt;explanations</code><span> is nil:
</span><pre>{:rule-matches
 {{:ns-name validator.typing,
   :lhs
            [[:not {:type validator.typing.LowCardinality, :constraints []}]],
   :rhs     (do (c/insert! (-&gt;ColType :t))),
   :props   {:salience -100},
   :name    &quot;validator.typing/text&quot;,
   :doc     &quot;The column is textual when cardinality is not low&quot;}
  (),
  ...
  :query-matches ...
  :condition-matches
  {{:type validator.typing.ColInfo, :constraints [(= 1 non-num-vals)]}
                                                                   (),
   {:type validator.typing.LowCardinality, :constraints []}        (),
   ...
  :insertions
  {{:ns-name validator.typing,
    :lhs
             [[:not {:type validator.typing.LowCardinality, :constraints []}]],
    :rhs     (do (c/insert! (-&gt;ColType :t))),
    :props   {:salience -100},
    :name    &quot;validator.typing/text&quot;,
    :doc     &quot;The column is textual when cardinality is not low&quot;}
   (),
   ...},
  :fact-&gt;explanations nil}
</pre></div><div id="t1544103013007100" t="2018-12-06 13:30:13 hjrnunes Is this a problem with my rules?"><a href="#t1544103013007100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-12-06</span> <span class="t" onclick="H(this)">13:30:13</span>                hjrnunes </span><span>Is this a problem with my rules?</span></div><div id="t1544103057007500" t="2018-12-06 13:30:57 hjrnunes Also, how do I interpret this data?"><a href="#t1544103057007500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-12-06</span> <span class="t" onclick="H(this)">13:30:57</span>                hjrnunes </span><span>Also, how do I interpret this data?</span></div><div id="t1544103449009200" t="2018-12-06 13:37:29 hjrnunes OK, I re-read the docs, and I can&apos;t understand what is meant by &apos;logical insertions&quot;. Isn&apos;t this inserting a fact on the RHS of a rule? The one above is inserted in the RHS of a rule, but there&apos;s no explanation for it..."><a href="#t1544103449009200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-12-06</span> <span class="t" onclick="H(this)">13:37:29</span>                hjrnunes </span><span>OK, I re-read the docs, and I can&apos;t understand what is meant by &apos;logical insertions&quot;. Isn&apos;t this inserting a fact on the RHS of a rule? The one above is inserted in the RHS of a rule, but there&apos;s no explanation for it...</span></div><div id="t1544108874010300" t="2018-12-06 15:07:54 mikerod @hjrnunes logical insertion is the default  c/insert!  in the RHS of the rules"><a href="#t1544108874010300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-12-06</span> <span class="t" onclick="H(this)">15:07:54</span>                 mikerod </span><span>@hjrnunes logical insertion is the default </span><code>c/insert!</code><span> in the RHS of the rules</span></div><div id="t1544108915011300" t="2018-12-06 15:08:35 mikerod it is referring to insertions that are managed by the truth maintenance system (TMS) of the engine. If the rule is found to later become unsatisfied in its LHS, the logically inserted fact will be automatically retracted."><a href="#t1544108915011300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-12-06</span> <span class="t" onclick="H(this)">15:08:35</span>                 mikerod </span><span>it is referring to insertions that are managed by the truth maintenance system (TMS) of the engine. If the rule is found to later become unsatisfied in its LHS, the logically inserted fact will be automatically retracted.</span></div><div id="t1544108933011700" t="2018-12-06 15:08:53 mikerod I don’t think that is your main question though, you are wondering why  :fact-&gt;explanations  is nil above"><a href="#t1544108933011700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-12-06</span> <span class="t" onclick="H(this)">15:08:53</span>                 mikerod </span><span>I don’t think that is your main question though, you are wondering why </span><code>:fact-&gt;explanations</code><span> is nil above</span></div><div id="t1544109134012400" t="2018-12-06 15:12:14 mikerod What you have above, if you look at  :insertions , it is saying that the rule  :name   validator.typing/text  had no facts inserted as a result of it."><a href="#t1544109134012400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-12-06</span> <span class="t" onclick="H(this)">15:12:14</span>                 mikerod </span><span>What you have above, if you look at </span><code>:insertions</code><span>, it is saying that the rule </span><code>:name</code><span> </span><code>validator.typing/text</code><span> had no facts inserted as a result of it.</span></div><div id="t1544109155012700" t="2018-12-06 15:12:35 mikerod Also,  :rule-matches  says similar, there were not matches for the rule"><a href="#t1544109155012700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-12-06</span> <span class="t" onclick="H(this)">15:12:35</span>                 mikerod </span><span>Also, </span><code>:rule-matches</code><span> says similar, there were not matches for the rule</span></div><div id="t1544109183013200" t="2018-12-06 15:13:03 mikerod So the result of this is that you have no facts that were inserted from a rule, so there are no  :fact-&gt;explanations  to show"><a href="#t1544109183013200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-12-06</span> <span class="t" onclick="H(this)">15:13:03</span>                 mikerod </span><span>So the result of this is that you have no facts that were inserted from a rule, so there are no </span><code>:fact-&gt;explanations</code><span> to show</span></div><div id="t1544109205013500" t="2018-12-06 15:13:25 mikerod Perhaps you can show how you ran this rule."><a href="#t1544109205013500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-12-06</span> <span class="t" onclick="H(this)">15:13:25</span>                 mikerod </span><span>Perhaps you can show how you ran this rule.</span></div><div id="t1544117126014800" t="2018-12-06 17:25:26 hjrnunes @mikerod thanks! I&apos;ll take a better look at the inspect result and rules tomorrow based on your feedback to see if I get it"><a href="#t1544117126014800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-12-06</span> <span class="t" onclick="H(this)">17:25:26</span>                hjrnunes </span><span>@mikerod thanks! I&apos;ll take a better look at the inspect result and rules tomorrow based on your feedback to see if I get it</span></div><div id="t1544117139015200" t="2018-12-06 17:25:39 hjrnunes if not I&apos;ll come back with a fuller example"><a href="#t1544117139015200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-12-06</span> <span class="t" onclick="H(this)">17:25:39</span>                hjrnunes </span><span>if not I&apos;ll come back with a fuller example</span></div><div id="t1544117848015400" t="2018-12-06 17:37:28 mikerod sounds good"><a href="#t1544117848015400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-12-06</span> <span class="t" onclick="H(this)">17:37:28</span>                 mikerod </span><span>sounds good</span></div><div id="t1544472791016900" t="2018-12-10 20:13:11 eraserhd AFAICT, I have a situation where a [:not [:or A B]] is being ignored on a rule.  Any thoughts about how to troubleshoot this?"><a href="#t1544472791016900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-12-10</span> <span class="t" onclick="H(this)">20:13:11</span>                eraserhd </span><span>AFAICT, I have a situation where a [:not [:or A B]] is being ignored on a rule.  Any thoughts about how to troubleshoot this?</span></div><div id="t1544473967017800" t="2018-12-10 20:32:47 mikerod @eraserhd there are certainly some issues that can happen with negated complex conditions. "><a href="#t1544473967017800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-12-10</span> <span class="t" onclick="H(this)">20:32:47</span>                 mikerod </span><span>@eraserhd there are certainly some issues that can happen with negated complex conditions. </span></div><div id="t1544473976018200" t="2018-12-10 20:32:56 mikerod Can find some in the github issues "><a href="#t1544473976018200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-12-10</span> <span class="t" onclick="H(this)">20:32:56</span>                 mikerod </span><span>Can find some in the github issues </span></div><div id="t1544474015018900" t="2018-12-10 20:33:35 mikerod One thing I’d do is to not combine it all to see that things work"><a href="#t1544474015018900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-12-10</span> <span class="t" onclick="H(this)">20:33:35</span>                 mikerod </span><span>One thing I’d do is to not combine it all to see that things work</span></div><div id="t1544474131020300" t="2018-12-10 20:35:31 mikerod I believe syntax is [:not [:or [A] [B]]]"><a href="#t1544474131020300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-12-10</span> <span class="t" onclick="H(this)">20:35:31</span>                 mikerod </span><span>I believe syntax is [:not [:or [A] [B]]]</span></div><div id="t1544474143020600" t="2018-12-10 20:35:43 mikerod But perhaps you were simplifying"><a href="#t1544474143020600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-12-10</span> <span class="t" onclick="H(this)">20:35:43</span>                 mikerod </span><span>But perhaps you were simplifying</span></div><div id="t1544474155020800" t="2018-12-10 20:35:55 mikerod Or I’m wrong hah"><a href="#t1544474155020800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-12-10</span> <span class="t" onclick="H(this)">20:35:55</span>                 mikerod </span><span>Or I’m wrong hah</span></div><div id="t1544474873021500" t="2018-12-10 20:47:53 eraserhd I&apos;m definitely simplifying.  We&apos;re working on making a small reproduction.  Maybe it&apos;ll go away, or we&apos;ll figure out we&apos;re doing something boneheaded. :D"><a href="#t1544474873021500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-12-10</span> <span class="t" onclick="H(this)">20:47:53</span>                eraserhd </span><span>I&apos;m definitely simplifying.  We&apos;re working on making a small reproduction.  Maybe it&apos;ll go away, or we&apos;ll figure out we&apos;re doing something boneheaded. :D</span></div><div id="t1544475442021900" t="2018-12-10 20:57:22 mikerod Could do 2 not conditions for that one right"><a href="#t1544475442021900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-12-10</span> <span class="t" onclick="H(this)">20:57:22</span>                 mikerod </span><span>Could do 2 not conditions for that one right</span></div><div id="t1544475469022700" t="2018-12-10 20:57:49 mikerod But in general Clara compiler will try to convert things into disjunctive normal form. "><a href="#t1544475469022700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-12-10</span> <span class="t" onclick="H(this)">20:57:49</span>                 mikerod </span><span>But in general Clara compiler will try to convert things into disjunctive normal form. </span></div><div id="t1544475488023400" t="2018-12-10 20:58:08 mikerod Sometimes there may be issues with doing this when variable bindings are used across clauses that are moving around. "><a href="#t1544475488023400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-12-10</span> <span class="t" onclick="H(this)">20:58:08</span>                 mikerod </span><span>Sometimes there may be issues with doing this when variable bindings are used across clauses that are moving around. </span></div><div id="t1544475513024300" t="2018-12-10 20:58:33 mikerod It may or may not relate to your issue. I just think there were perhaps still a few edge cases pointed out in some gh issues outstanding"><a href="#t1544475513024300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-12-10</span> <span class="t" onclick="H(this)">20:58:33</span>                 mikerod </span><span>It may or may not relate to your issue. I just think there were perhaps still a few edge cases pointed out in some gh issues outstanding</span></div><div id="t1544475567025400" t="2018-12-10 20:59:27 mikerod I often will just advocate for breaking more complex expressions into separate rules that have intermediate facts between them to recreate the logic you are looking for"><a href="#t1544475567025400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-12-10</span> <span class="t" onclick="H(this)">20:59:27</span>                 mikerod </span><span>I often will just advocate for breaking more complex expressions into separate rules that have intermediate facts between them to recreate the logic you are looking for</span></div><div id="t1544475600026400" t="2018-12-10 21:00:00 mikerod Generally will lead to less confusion and more transparency in introspection since you can look at the intermediate facts. "><a href="#t1544475600026400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-12-10</span> <span class="t" onclick="H(this)">21:00:00</span>                 mikerod </span><span>Generally will lead to less confusion and more transparency in introspection since you can look at the intermediate facts. </span></div><div id="t1544475613026900" t="2018-12-10 21:00:13 mikerod Often perf is fine or better that way too, but that can depend. "><a href="#t1544475613026900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-12-10</span> <span class="t" onclick="H(this)">21:00:13</span>                 mikerod </span><span>Often perf is fine or better that way too, but that can depend. </span></div><div id="t1544722457027600" t="2018-12-13 17:34:17 eraserhd So, I should follow up.  Clara was working correctly.  We had an extra rule spelled weirdly enough to defy grep."><a href="#t1544722457027600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-12-13</span> <span class="t" onclick="H(this)">17:34:17</span>                eraserhd </span><span>So, I should follow up.  Clara was working correctly.  We had an extra rule spelled weirdly enough to defy grep.</span></div><div id="t1544722597028000" t="2018-12-13 17:36:37 mikerod Oh good I suppose then. Hah"><a href="#t1544722597028000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2018-12-13</span> <span class="t" onclick="H(this)">17:36:37</span>                 mikerod </span><span>Oh good I suppose then. Hah</span></div><div id="t1546978297002200" t="2019-01-08 20:11:37 eraserhd Had some discussions about performance for our use cases, and I made a bunch of assumptions.  1) In terms of inserts/retracts and fire-rules, Clara is single-threaded and does not take advantage of parallelziation.  2) Working set size and memory bandwidth dominate CPU speed."><a href="#t1546978297002200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-08</span> <span class="t" onclick="H(this)">20:11:37</span>                eraserhd </span><span>Had some discussions about performance for our use cases, and I made a bunch of assumptions.  1) In terms of inserts/retracts and fire-rules, Clara is single-threaded and does not take advantage of parallelziation.  2) Working set size and memory bandwidth dominate CPU speed.</span></div><div id="t1546978327002500" t="2019-01-08 20:12:07 eraserhd Do those sound accurate?"><a href="#t1546978327002500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-08</span> <span class="t" onclick="H(this)">20:12:07</span>                eraserhd </span><span>Do those sound accurate?</span></div><div id="t1546979312003100" t="2019-01-08 20:28:32 mikerod @eraserhd (1) seems accurate enough; I think (2) isn’t clear enough to me to say yes/no"><a href="#t1546979312003100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-08</span> <span class="t" onclick="H(this)">20:28:32</span>                 mikerod </span><span>@eraserhd (1) seems accurate enough; I think (2) isn’t clear enough to me to say yes/no</span></div><div id="t1546979415004000" t="2019-01-08 20:30:15 mikerod The CPU is typically dominated by the number of constraints being evaluated against the working set of facts. So yes to that part I believe. What do you mean by memory bandwidth?"><a href="#t1546979415004000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-08</span> <span class="t" onclick="H(this)">20:30:15</span>                 mikerod </span><span>The CPU is typically dominated by the number of constraints being evaluated against the working set of facts. So yes to that part I believe. What do you mean by memory bandwidth?</span></div><div id="t1547012699020400" t="2019-01-09 05:44:59 devn I think they are saying what I might assume to be true. Large numbers of facts coupled with large numbers of rules are likely to create memory pressure as they scale in number. But, I’ll go on record as saying I doubt physical limits are a bottleneck when it comes to performance in Clara. Mechanical sympathists in the audience?"><a href="#t1547012699020400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-09</span> <span class="t" onclick="H(this)">05:44:59</span>                    devn </span><span>I think they are saying what I might assume to be true. Large numbers of facts coupled with large numbers of rules are likely to create memory pressure as they scale in number. But, I’ll go on record as saying I doubt physical limits are a bottleneck when it comes to performance in Clara. Mechanical sympathists in the audience?</span></div><div id="t1547046460031100" t="2019-01-09 15:07:40 wparker Agreed with (1), with the proviso that one could create multiple sessions and get parallelization that way.  Regarding (2), in part I&apos;d have to give the annoying-but-true answer that much depends on the structure and size of your rule/fact set.  For many use cases, particularly on clj since it has gotten most of the perf optimization, perf likely is good enough to be a non-issue.  CPU can be a concern, especially for rulesets with lots of truth maintenance work.  When you say memory bandwidth, do you just mean memory use or the actual speed of retrieval of data from RAM/the CPU cache?  It isn&apos;t clear to me how you&apos;d optimize the latter effectively running on top of the JVM, but TBH I haven&apos;t thought about that level of optimization in the context of Clara.  I suspect there&apos;s still much lower hanging fruit to work on in term of perf improvements."><a href="#t1547046460031100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-09</span> <span class="t" onclick="H(this)">15:07:40</span>                 wparker </span><span>Agreed with (1), with the proviso that one could create multiple sessions and get parallelization that way.  Regarding (2), in part I&apos;d have to give the annoying-but-true answer that much depends on the structure and size of your rule/fact set.  For many use cases, particularly on clj since it has gotten most of the perf optimization, perf likely is good enough to be a non-issue.  CPU can be a concern, especially for rulesets with lots of truth maintenance work.  When you say memory bandwidth, do you just mean memory use or the actual speed of retrieval of data from RAM/the CPU cache?  It isn&apos;t clear to me how you&apos;d optimize the latter effectively running on top of the JVM, but TBH I haven&apos;t thought about that level of optimization in the context of Clara.  I suspect there&apos;s still much lower hanging fruit to work on in term of perf improvements.</span></div><div id="t1547046553032400" t="2019-01-09 15:09:13 eraserhd @mikerod by memory bandwidth, I mean memory bus speed.  If the working set is larger than cache, I assume the speed constraint is loading the data to the CPU, not number crunching."><a href="#t1547046553032400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-09</span> <span class="t" onclick="H(this)">15:09:13</span>                eraserhd </span><span>@mikerod by memory bandwidth, I mean memory bus speed.  If the working set is larger than cache, I assume the speed constraint is loading the data to the CPU, not number crunching.</span></div><div id="t1547046628033100" t="2019-01-09 15:10:28 eraserhd And the way to optimize it is to choose a different AWS instance type :D"><a href="#t1547046628033100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-09</span> <span class="t" onclick="H(this)">15:10:28</span>                eraserhd </span><span>And the way to optimize it is to choose a different AWS instance type :D</span></div><div id="t1547047559033400" t="2019-01-09 15:25:59 mikerod I see. Thanks for clarifying "><a href="#t1547047559033400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-09</span> <span class="t" onclick="H(this)">15:25:59</span>                 mikerod </span><span>I see. Thanks for clarifying </span></div><div id="t1547047604034700" t="2019-01-09 15:26:44 mikerod Yeah. All of this can contribute. The underlying hardware solution would likely be a last resort time. But if you are seeing a perf issue and can get profiler sampling data that could be useful. "><a href="#t1547047604034700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-09</span> <span class="t" onclick="H(this)">15:26:44</span>                 mikerod </span><span>Yeah. All of this can contribute. The underlying hardware solution would likely be a last resort time. But if you are seeing a perf issue and can get profiler sampling data that could be useful. </span></div><div id="t1547047850036300" t="2019-01-09 15:30:50 mikerod There are also some ways to look at tracing output to get a sense of count of times parts of the network were evaluated. Sometimes you can look for outliers there "><a href="#t1547047850036300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-09</span> <span class="t" onclick="H(this)">15:30:50</span>                 mikerod </span><span>There are also some ways to look at tracing output to get a sense of count of times parts of the network were evaluated. Sometimes you can look for outliers there </span></div><div id="t1547049203041200" t="2019-01-09 15:53:23 wparker Keep in mind that the CPU cache will hold more than just what you think of as the data e.g. routines of the JVM itself, methods from the Clojure runtime, Clara itself, etc.  If you were trying to make the cache efficient that might dominate the actual “data” you’re working with.  I’m a bit skeptical that that’s your dominating performance factor though - agreed with Mike that a profiler snapshot showing what’s taking time in Clara would be helpful."><a href="#t1547049203041200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-09</span> <span class="t" onclick="H(this)">15:53:23</span>                 wparker </span><span>Keep in mind that the CPU cache will hold more than just what you think of as the data e.g. routines of the JVM itself, methods from the Clojure runtime, Clara itself, etc.  If you were trying to make the cache efficient that might dominate the actual “data” you’re working with.  I’m a bit skeptical that that’s your dominating performance factor though - agreed with Mike that a profiler snapshot showing what’s taking time in Clara would be helpful.</span></div><div id="t1547132740042100" t="2019-01-10 15:05:40 mauricio.szabo Does clara supports creation of a session and firing rules in different threads?

I&apos;m having an exception trying to do it:
 Exception in thread &quot;async-dispatch-24&quot; java.lang.IllegalArgumentException: find not supported on type: clara.rules.engine.Token$reify__26254
"><a href="#t1547132740042100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-10</span> <span class="t" onclick="H(this)">15:05:40</span>          mauricio.szabo </span><span>Does clara supports creation of a session and firing rules in different threads?

I&apos;m having an exception trying to do it:
</span><pre>Exception in thread &quot;async-dispatch-24&quot; java.lang.IllegalArgumentException: find not supported on type: clara.rules.engine.Token$reify__26254
</pre></div><div id="t1547134108042700" t="2019-01-10 15:28:28 mikerod @mauricio.szabo I’d expect it to be ok. Can I see (1) more stack trace and (2) an (perhaps simplified) example of how you are setting up for this?"><a href="#t1547134108042700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-10</span> <span class="t" onclick="H(this)">15:28:28</span>                 mikerod </span><span>@mauricio.szabo I’d expect it to be ok. Can I see (1) more stack trace and (2) an (perhaps simplified) example of how you are setting up for this?</span></div><div id="t1547137977046200" t="2019-01-10 16:32:57 mauricio.szabo Ok, I&apos;ll run some code here and then give you the results"><a href="#t1547137977046200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-10</span> <span class="t" onclick="H(this)">16:32:57</span>               mauricio.szabo </span><span>Ok, I&apos;ll run some code here and then give you the results</span></div><div id="t1547141373052800" t="2019-01-10 17:29:33 wparker Are you creating more than one session at a time?  The compiler uses eval calls internally, and the Clojure compiler itself isn’t thread-safe."><a href="#t1547141373052800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-10</span> <span class="t" onclick="H(this)">17:29:33</span>                      wparker </span><span>Are you creating more than one session at a time?  The compiler uses eval calls internally, and the Clojure compiler itself isn’t thread-safe.</span></div><div id="t1547141868053200" t="2019-01-10 17:37:48 mikerod yeah, this is why I’m looking for some example of how it is being tried"><a href="#t1547141868053200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-10</span> <span class="t" onclick="H(this)">17:37:48</span>                      mikerod </span><span>yeah, this is why I’m looking for some example of how it is being tried</span></div><div id="t1547143684054100" t="2019-01-10 18:08:04 mauricio.szabo @U0KRSVDHR I&apos;ve tried creating more than one, and don&apos;t creating it, and they both gave me the same error"><a href="#t1547143684054100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-10</span> <span class="t" onclick="H(this)">18:08:04</span>               mauricio.szabo </span><span>@U0KRSVDHR I&apos;ve tried creating more than one, and don&apos;t creating it, and they both gave me the same error</span></div><div id="t1547143838054300" t="2019-01-10 18:10:38 mikerod @mauricio.szabo can you give at least an outline of hwo you are doing this"><a href="#t1547143838054300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-10</span> <span class="t" onclick="H(this)">18:10:38</span>                      mikerod </span><span>@mauricio.szabo can you give at least an outline of hwo you are doing this</span></div><div id="t1547143855054500" t="2019-01-10 18:10:55 mikerod like how you create the session, and then how you distribute it to other threads"><a href="#t1547143855054500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-10</span> <span class="t" onclick="H(this)">18:10:55</span>                      mikerod </span><span>like how you create the session, and then how you distribute it to other threads</span></div><div id="t1547143874054700" t="2019-01-10 18:11:14 mikerod I’m guessing the other threads have the same classloaders too?"><a href="#t1547143874054700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-10</span> <span class="t" onclick="H(this)">18:11:14</span>                      mikerod </span><span>I’m guessing the other threads have the same classloaders too?</span></div><div id="t1547143882054900" t="2019-01-10 18:11:22 mikerod an example would make that easier to track through"><a href="#t1547143882054900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-10</span> <span class="t" onclick="H(this)">18:11:22</span>                      mikerod </span><span>an example would make that easier to track through</span></div><div id="t1547143924055100" t="2019-01-10 18:12:04 mauricio.szabo Okay, just give me some minutes  🙂"><a href="#t1547143924055100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-10</span> <span class="t" onclick="H(this)">18:12:04</span>               mauricio.szabo </span><span>Okay, just give me some minutes </span><b>🙂</b></div><div id="t1547144029055300" t="2019-01-10 18:13:49 mikerod oh, no problem. not time sensitive (for me at least) hah"><a href="#t1547144029055300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-10</span> <span class="t" onclick="H(this)">18:13:49</span>                      mikerod </span><span>oh, no problem. not time sensitive (for me at least) hah</span></div><div id="t1547146420055700" t="2019-01-10 18:53:40 mauricio.szabo @U0LK1552A I&apos;m running the code in the following way:

 (let [session (-&gt; (mk-session &apos;events-reports.reports.deferred
                              &apos;events-reports.reports.normalize-data
                              :fact-type-fn :fact))
      res (jdbc/query db &quot;SELECT * FROM my_table WHERE ...&quot;)
      location-ids (map :id res)]

  (doseq [id location-ids]
    (async/go
     (println &quot;Emitting for&quot; id)
     (jdbc/with-db-connection [db @smart/db]
        (let [facts (search-facts db id)
              rows (-&gt; session
                       (insert-all facts)
                       (fire-rules)
                       (query detailed-anual-report)
                       (-&gt;&gt; (map make-detailed-anual-row)))]
         (println &quot;Saving for&quot; id)
         (save-rows rows))))))
"><a href="#t1547146420055700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-10</span> <span class="t" onclick="H(this)">18:53:40</span>               mauricio.szabo </span><span>@U0LK1552A I&apos;m running the code in the following way:

</span><pre>(let [session (-&gt; (mk-session &apos;events-reports.reports.deferred
                              &apos;events-reports.reports.normalize-data
                              :fact-type-fn :fact))
      res (jdbc/query db &quot;SELECT * FROM my_table WHERE ...&quot;)
      location-ids (map :id res)]

  (doseq [id location-ids]
    (async/go
     (println &quot;Emitting for&quot; id)
     (jdbc/with-db-connection [db @smart/db]
        (let [facts (search-facts db id)
              rows (-&gt; session
                       (insert-all facts)
                       (fire-rules)
                       (query detailed-anual-report)
                       (-&gt;&gt; (map make-detailed-anual-row)))]
         (println &quot;Saving for&quot; id)
         (save-rows rows))))))
</pre></div><div id="t1547146493055900" t="2019-01-10 18:54:53 mauricio.szabo (it&apos;s a simplified version.  search-facts  is simply a bunch of JDBC queries)"><a href="#t1547146493055900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-10</span> <span class="t" onclick="H(this)">18:54:53</span>               mauricio.szabo </span><span>(it&apos;s a simplified version. </span><code>search-facts</code><span> is simply a bunch of JDBC queries)</span></div><div id="t1547147154056100" t="2019-01-10 19:05:54 mauricio.szabo Exception in thread &quot;async-dispatch-4&quot; java.lang.IllegalArgumentException: find not supported on type: clara.rules.engine.Token$reify__26254
        at clojure.lang.RT.find(RT.java:863)
        at clojure.core$select_keys.invokeStatic(core.clj:1539)
        at clojure.core$select_keys.invoke(core.clj:1532)
        at clara.rules.engine$propagate_items_to_nodes$fn__26782.invoke(engine.cljc:154)
        at clara.rules.platform$group_by_seq$fn__26030.invoke(platform.cljc:39)
        at clojure.core.protocols$naive_seq_reduce.invokeStatic(protocols.clj:62)
        at clojure.core.protocols$interface_or_naive_reduce.invokeStatic(protocols.clj:72)
        at clojure.core.protocols$fn__7852.invokeStatic(protocols.clj:169)
        at clojure.core.protocols$fn__7852.invoke(protocols.clj:124)
        at clojure.core.protocols$fn__7807$G__7802__7816.invoke(protocols.clj:19)
        at clojure.core.protocols$seq_reduce.invokeStatic(protocols.clj:31)
        at clojure.core.protocols$fn__7835.invokeStatic(protocols.clj:75)
        at clojure.core.protocols$fn__7835.invoke(protocols.clj:75)
        at clojure.core.protocols$fn__7781$G__7776__7794.invoke(protocols.clj:13)
        at clojure.core$reduce.invokeStatic(core.clj:6748)
        at clojure.core$reduce.invoke(core.clj:6730)
        at clara.rules.platform$group_by_seq.invokeStatic(platform.cljc:38)
        at clara.rules.platform$group_by_seq.invoke(platform.cljc:27)
        at clara.rules.engine$propagate_items_to_nodes.invokeStatic(engine.cljc:154)
        at clara.rules.engine$propagate_items_to_nodes.invoke(engine.cljc:147)
        at clara.rules.engine.LocalTransport.send_elements(engine.cljc:176)
        at clara.rules.engine.AlphaNode.alpha_activate(engine.cljc:538)
        at clara.rules.engine$flush_updates$flush_all__26940.invoke(engine.cljc:269)
        at clara.rules.engine$flush_updates.invokeStatic(engine.cljc:277)
        at clara.rules.engine$flush_updates.invoke(engine.cljc:252)
        at clara.rules.engine$fire_rules_STAR_.invokeStatic(engine.cljc:1825)
        at clara.rules.engine$fire_rules_STAR_.invoke(engine.cljc:1720)
        at clara.rules.engine.LocalSession.fire_rules(engine.cljc:1909)
        at clara.rules$fire_rules.invokeStatic(rules.cljc:44)
        at clara.rules$fire_rules.invoke(rules.cljc:29)
"><a href="#t1547147154056100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-10</span> <span class="t" onclick="H(this)">19:05:54</span>               mauricio.szabo </span><pre>Exception in thread &quot;async-dispatch-4&quot; java.lang.IllegalArgumentException: find not supported on type: clara.rules.engine.Token$reify__26254
        at clojure.lang.RT.find(RT.java:863)
        at clojure.core$select_keys.invokeStatic(core.clj:1539)
        at clojure.core$select_keys.invoke(core.clj:1532)
        at clara.rules.engine$propagate_items_to_nodes$fn__26782.invoke(engine.cljc:154)
        at clara.rules.platform$group_by_seq$fn__26030.invoke(platform.cljc:39)
        at clojure.core.protocols$naive_seq_reduce.invokeStatic(protocols.clj:62)
        at clojure.core.protocols$interface_or_naive_reduce.invokeStatic(protocols.clj:72)
        at clojure.core.protocols$fn__7852.invokeStatic(protocols.clj:169)
        at clojure.core.protocols$fn__7852.invoke(protocols.clj:124)
        at clojure.core.protocols$fn__7807$G__7802__7816.invoke(protocols.clj:19)
        at clojure.core.protocols$seq_reduce.invokeStatic(protocols.clj:31)
        at clojure.core.protocols$fn__7835.invokeStatic(protocols.clj:75)
        at clojure.core.protocols$fn__7835.invoke(protocols.clj:75)
        at clojure.core.protocols$fn__7781$G__7776__7794.invoke(protocols.clj:13)
        at clojure.core$reduce.invokeStatic(core.clj:6748)
        at clojure.core$reduce.invoke(core.clj:6730)
        at clara.rules.platform$group_by_seq.invokeStatic(platform.cljc:38)
        at clara.rules.platform$group_by_seq.invoke(platform.cljc:27)
        at clara.rules.engine$propagate_items_to_nodes.invokeStatic(engine.cljc:154)
        at clara.rules.engine$propagate_items_to_nodes.invoke(engine.cljc:147)
        at clara.rules.engine.LocalTransport.send_elements(engine.cljc:176)
        at clara.rules.engine.AlphaNode.alpha_activate(engine.cljc:538)
        at clara.rules.engine$flush_updates$flush_all__26940.invoke(engine.cljc:269)
        at clara.rules.engine$flush_updates.invokeStatic(engine.cljc:277)
        at clara.rules.engine$flush_updates.invoke(engine.cljc:252)
        at clara.rules.engine$fire_rules_STAR_.invokeStatic(engine.cljc:1825)
        at clara.rules.engine$fire_rules_STAR_.invoke(engine.cljc:1720)
        at clara.rules.engine.LocalSession.fire_rules(engine.cljc:1909)
        at clara.rules$fire_rules.invokeStatic(rules.cljc:44)
        at clara.rules$fire_rules.invoke(rules.cljc:29)
</pre></div><div id="t1547147163056300" t="2019-01-10 19:06:03 mauricio.szabo (More stacktraces :))"><a href="#t1547147163056300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-10</span> <span class="t" onclick="H(this)">19:06:03</span>               mauricio.szabo </span><span>(More stacktraces :))</span></div><div id="t1547148807056600" t="2019-01-10 19:33:27 mikerod thanks for the details"><a href="#t1547148807056600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-10</span> <span class="t" onclick="H(this)">19:33:27</span>                      mikerod </span><span>thanks for the details</span></div><div id="t1547148817056800" t="2019-01-10 19:33:37 mikerod nothing immediately is striking me as odd there"><a href="#t1547148817056800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-10</span> <span class="t" onclick="H(this)">19:33:37</span>                      mikerod </span><span>nothing immediately is striking me as odd there</span></div><div id="t1547148858057000" t="2019-01-10 19:34:18 mikerod looking some at what could be oging on"><a href="#t1547148858057000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-10</span> <span class="t" onclick="H(this)">19:34:18</span>                      mikerod </span><span>looking some at what could be oging on</span></div><div id="t1547148921057200" t="2019-01-10 19:35:21 mikerod This type  clara.rules.engine.Token$reify__26254  is weird to me"><a href="#t1547148921057200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-10</span> <span class="t" onclick="H(this)">19:35:21</span>                      mikerod </span><span>This type </span><code>clara.rules.engine.Token$reify__26254</code><span> is weird to me</span></div><div id="t1547148930057400" t="2019-01-10 19:35:30 mikerod I’m not aware of any  reify  going on in relation to tokens"><a href="#t1547148930057400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-10</span> <span class="t" onclick="H(this)">19:35:30</span>                      mikerod </span><span>I’m not aware of any </span><code>reify</code><span> going on in relation to tokens</span></div><div id="t1547148954057600" t="2019-01-10 19:35:54 mikerod which, I’d think that’s what produces a name like that"><a href="#t1547148954057600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-10</span> <span class="t" onclick="H(this)">19:35:54</span>                      mikerod </span><span>which, I’d think that’s what produces a name like that</span></div><div id="t1547149022057800" t="2019-01-10 19:37:02 mikerod actually, must be thinking about that wrong, since you can’t  reify  a  clara.rules.engine.Token , it’s a record"><a href="#t1547149022057800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-10</span> <span class="t" onclick="H(this)">19:37:02</span>                      mikerod </span><span>actually, must be thinking about that wrong, since you can’t </span><code>reify</code><span> a </span><code>clara.rules.engine.Token</code><span>, it’s a record</span></div><div id="t1547149159058000" t="2019-01-10 19:39:19 mikerod that is just relating to a reify happening from within the clj record impl I see - disregard those comments then,"><a href="#t1547149159058000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-10</span> <span class="t" onclick="H(this)">19:39:19</span>                      mikerod </span><span>that is just relating to a reify happening from within the clj record impl I see - disregard those comments then,</span></div><div id="t1547149271058200" t="2019-01-10 19:41:11 mauricio.szabo Do you want me to open an issue?"><a href="#t1547149271058200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-10</span> <span class="t" onclick="H(this)">19:41:11</span>               mauricio.szabo </span><span>Do you want me to open an issue?</span></div><div id="t1547149530058400" t="2019-01-10 19:45:30 mikerod I suppose we can for tracking"><a href="#t1547149530058400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-10</span> <span class="t" onclick="H(this)">19:45:30</span>                      mikerod </span><span>I suppose we can for tracking</span></div><div id="t1547149547058600" t="2019-01-10 19:45:47 mikerod I think I’ve recreated it to some minimal degree as far as what could cause that type of exception"><a href="#t1547149547058600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-10</span> <span class="t" onclick="H(this)">19:45:47</span>                      mikerod </span><span>I think I’ve recreated it to some minimal degree as far as what could cause that type of exception</span></div><div id="t1547149562058800" t="2019-01-10 19:46:02 mikerod (find (.getLookupThunk (map-&gt;Token {}) :bindings) :x)"><a href="#t1547149562058800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-10</span> <span class="t" onclick="H(this)">19:46:02</span>                      mikerod </span><code>(find (.getLookupThunk (map-&gt;Token {}) :bindings) :x)</code></div><div id="t1547149581059000" t="2019-01-10 19:46:21 mikerod I believe the  getLookupThunk  can happen via clj keyword lookup compile-time inlining stuff"><a href="#t1547149581059000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-10</span> <span class="t" onclick="H(this)">19:46:21</span>                      mikerod </span><span>I believe the </span><code>getLookupThunk</code><span> can happen via clj keyword lookup compile-time inlining stuff</span></div><div id="t1547149616059200" t="2019-01-10 19:46:56 mikerod so this ends up coming from a call  (:bindings &lt;token-obj&gt;)  in the fn  propagate-items-to-nodes"><a href="#t1547149616059200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-10</span> <span class="t" onclick="H(this)">19:46:56</span>                      mikerod </span><span>so this ends up coming from a call </span><code>(:bindings &lt;token-obj&gt;)</code><span> in the fn </span><code>propagate-items-to-nodes</code></div><div id="t1547149896059400" t="2019-01-10 19:51:36 mikerod Also, can you give me your clj/java/core.async versions?"><a href="#t1547149896059400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-10</span> <span class="t" onclick="H(this)">19:51:36</span>                      mikerod </span><span>Also, can you give me your clj/java/core.async versions?</span></div><div id="t1547150527059600" t="2019-01-10 20:02:07 mauricio.szabo Clojure version: Clojure 1.9.0
JVM version: Eclipse OpenJ9 VM 1.8.0_181-b13
Core.Async version: 0.4.490"><a href="#t1547150527059600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-10</span> <span class="t" onclick="H(this)">20:02:07</span>               mauricio.szabo </span><span>Clojure version: Clojure 1.9.0
JVM version: Eclipse OpenJ9 VM 1.8.0_181-b13
Core.Async version: 0.4.490</span></div><div id="t1547150535059800" t="2019-01-10 20:02:15 mauricio.szabo Also, I&apos;ve opened an issue"><a href="#t1547150535059800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-10</span> <span class="t" onclick="H(this)">20:02:15</span>               mauricio.szabo </span><span>Also, I&apos;ve opened an issue</span></div><div id="t1547153227060000" t="2019-01-10 20:47:07 mikerod thanks, I seeit"><a href="#t1547153227060000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-10</span> <span class="t" onclick="H(this)">20:47:07</span>                      mikerod </span><span>thanks, I seeit</span></div><div id="t1547153277060200" t="2019-01-10 20:47:57 mikerod this problem is weird. asked a bit on #clojure-dev to see if there were any thoughts on how you could end up with a keyword callsite messing up like this. The only possible thing that comes to mind so far is just making sure that you aren’t somehow requiring clara.rules.engine (or other ns’s) multiple times"><a href="#t1547153277060200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-10</span> <span class="t" onclick="H(this)">20:47:57</span>                      mikerod </span><span>this problem is weird. asked a bit on #clojure-dev to see if there were any thoughts on how you could end up with a keyword callsite messing up like this. The only possible thing that comes to mind so far is just making sure that you aren’t somehow requiring clara.rules.engine (or other ns’s) multiple times</span></div><div id="t1547153295060400" t="2019-01-10 20:48:15 mikerod so somehow getting different versions of the same classes loaded into successive clj dynamic class loaders"><a href="#t1547153295060400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-10</span> <span class="t" onclick="H(this)">20:48:15</span>                      mikerod </span><span>so somehow getting different versions of the same classes loaded into successive clj dynamic class loaders</span></div><div id="t1547153816060600" t="2019-01-10 20:56:56 mikerod It sort of looks to me now that you may have  clojure.rules.engine  being loaded more than once, and causing a duplicate class of clojure.rules.engine.Token being created."><a href="#t1547153816060600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-10</span> <span class="t" onclick="H(this)">20:56:56</span>                      mikerod </span><span>It sort of looks to me now that you may have </span><code>clojure.rules.engine</code><span> being loaded more than once, and causing a duplicate class of clojure.rules.engine.Token being created.</span></div><div id="t1547134823043300" t="2019-01-10 15:40:23 eraserhd Hmm, this seems to say that we have retractions, right?  (We shouldn’t.):"><a href="#t1547134823043300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-10</span> <span class="t" onclick="H(this)">15:40:23</span>                eraserhd </span><span>Hmm, this seems to say that we have retractions, right?  (We shouldn’t.):</span></div><div id="t1547135242043600" t="2019-01-10 15:47:22 ethanc I think I have seen this behavior before, but i need to verify my suspicions before I could say for sure."><a href="#t1547135242043600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-10</span> <span class="t" onclick="H(this)">15:47:22</span>                       ethanc </span><span>I think I have seen this behavior before, but i need to verify my suspicions before I could say for sure.</span></div><div id="t1547135332043800" t="2019-01-10 15:48:52 eraserhd We are currently investigating.  What should we look for?"><a href="#t1547135332043800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-10</span> <span class="t" onclick="H(this)">15:48:52</span>                     eraserhd </span><span>We are currently investigating.  What should we look for?</span></div><div id="t1547135757044000" t="2019-01-10 15:55:57 ethanc If it is what i&apos;m thinking, its a scenario where facts are inserted but have no corresponding nodes to activate. Thus meaning all work in prior rules was &quot;unnecessary&quot; and can be retracted.

It sounds weird making this comment, but i think it relates to keeping the memory as low as possible...

Again, i need to verify this and i am writing a simple set of rules to test it"><a href="#t1547135757044000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-10</span> <span class="t" onclick="H(this)">15:55:57</span>                       ethanc </span><span>If it is what i&apos;m thinking, its a scenario where facts are inserted but have no corresponding nodes to activate. Thus meaning all work in prior rules was &quot;unnecessary&quot; and can be retracted.

It sounds weird making this comment, but i think it relates to keeping the memory as low as possible...

Again, i need to verify this and i am writing a simple set of rules to test it</span></div><div id="t1547135898044200" t="2019-01-10 15:58:18 eraserhd Ahhh, interesting.  We probably do have a lot of facts that aren&apos;t used by rules."><a href="#t1547135898044200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-10</span> <span class="t" onclick="H(this)">15:58:18</span>                     eraserhd </span><span>Ahhh, interesting.  We probably do have a lot of facts that aren&apos;t used by rules.</span></div><div id="t1547136607044400" t="2019-01-10 16:10:07 eraserhd we&apos;ve verified that we&apos;re not intentionally retracting any datoms in this batch."><a href="#t1547136607044400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-10</span> <span class="t" onclick="H(this)">16:10:07</span>                     eraserhd </span><span>we&apos;ve verified that we&apos;re not intentionally retracting any datoms in this batch.</span></div><div id="t1547136687044600" t="2019-01-10 16:11:27 eraserhd scratch that, no we&apos;re seeing something weird"><a href="#t1547136687044600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-10</span> <span class="t" onclick="H(this)">16:11:27</span>                     eraserhd </span><span>scratch that, no we&apos;re seeing something weird</span></div><div id="t1547137313044800" t="2019-01-10 16:21:53 mikerod alpha-retract  happens from the truth maintenance as well."><a href="#t1547137313044800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-10</span> <span class="t" onclick="H(this)">16:21:53</span>                      mikerod </span><code>alpha-retract</code><span> happens from the truth maintenance as well.</span></div><div id="t1547137346045000" t="2019-01-10 16:22:26 mikerod so using logical insert (the default) can/will lead to them as the TMS keeps the working state’s “truth” consistent"><a href="#t1547137346045000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-10</span> <span class="t" onclick="H(this)">16:22:26</span>                      mikerod </span><span>so using logical insert (the default) can/will lead to them as the TMS keeps the working state’s “truth” consistent</span></div><div id="t1547137412045200" t="2019-01-10 16:23:32 mikerod Seeing your screenshot there though - relative to the other times I see - it looks like a lot of time is being spent in equality comparisons."><a href="#t1547137412045200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-10</span> <span class="t" onclick="H(this)">16:23:32</span>                      mikerod </span><span>Seeing your screenshot there though - relative to the other times I see - it looks like a lot of time is being spent in equality comparisons.</span></div><div id="t1547137447045400" t="2019-01-10 16:24:07 mikerod However, the memory updating functions comparing tokens and “remove first of each” do not seem to be as high."><a href="#t1547137447045400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-10</span> <span class="t" onclick="H(this)">16:24:07</span>                      mikerod </span><span>However, the memory updating functions comparing tokens and “remove first of each” do not seem to be as high.</span></div><div id="t1547137473045600" t="2019-01-10 16:24:33 mikerod I’d have to expand on the callstack trees of these a bit more perhaps to really know what’s going on there though"><a href="#t1547137473045600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-10</span> <span class="t" onclick="H(this)">16:24:33</span>                      mikerod </span><span>I’d have to expand on the callstack trees of these a bit more perhaps to really know what’s going on there though</span></div><div id="t1547137513045800" t="2019-01-10 16:25:13 eraserhd @U3KC48GHW we made a mistake in a parameter in the call we are timing.  After fixing, we don&apos;t see a high alpha-retract time."><a href="#t1547137513045800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-10</span> <span class="t" onclick="H(this)">16:25:13</span>                     eraserhd </span><span>@U3KC48GHW we made a mistake in a parameter in the call we are timing.  After fixing, we don&apos;t see a high alpha-retract time.</span></div><div id="t1547138021046400" t="2019-01-10 16:33:41 mauricio.szabo @U0ECYL0ET what are you using to profile Clara? I&apos;ve tried to use VisualVM but my code hang even with small group of facts..."><a href="#t1547138021046400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-10</span> <span class="t" onclick="H(this)">16:33:41</span>               mauricio.szabo </span><span>@U0ECYL0ET what are you using to profile Clara? I&apos;ve tried to use VisualVM but my code hang even with small group of facts...</span></div><div id="t1547138056046600" t="2019-01-10 16:34:16 eraserhd I&apos;m using the CPU sampler in VisualVM.  I&apos;ve never successfully used the profiler."><a href="#t1547138056046600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-10</span> <span class="t" onclick="H(this)">16:34:16</span>                     eraserhd </span><span>I&apos;m using the CPU sampler in VisualVM.  I&apos;ve never successfully used the profiler.</span></div><div id="t1547138085046800" t="2019-01-10 16:34:45 eraserhd The profiler always hangs for me no matter what I try."><a href="#t1547138085046800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-10</span> <span class="t" onclick="H(this)">16:34:45</span>                     eraserhd </span><span>The profiler always hangs for me no matter what I try.</span></div><div id="t1547138245047000" t="2019-01-10 16:37:25 mikerod Yeah, VisualVM CPU sampler is typically pretty useful"><a href="#t1547138245047000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-10</span> <span class="t" onclick="H(this)">16:37:25</span>                      mikerod </span><span>Yeah, VisualVM CPU sampler is typically pretty useful</span></div><div id="t1547138267047200" t="2019-01-10 16:37:47 mikerod I don’t try to use the more invasive profiler there - I don’t even know that I’d call that “recommended”"><a href="#t1547138267047200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-10</span> <span class="t" onclick="H(this)">16:37:47</span>                      mikerod </span><span>I don’t try to use the more invasive profiler there - I don’t even know that I’d call that “recommended”</span></div><div id="t1547138305047400" t="2019-01-10 16:38:25 mikerod @U0ECYL0ET the example you showed did not look to have a high time spent in alpha-retract, so confused why you considered it a problem there"><a href="#t1547138305047400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-10</span> <span class="t" onclick="H(this)">16:38:25</span>                      mikerod </span><span>@U0ECYL0ET the example you showed did not look to have a high time spent in alpha-retract, so confused why you considered it a problem there</span></div><div id="t1547138316047600" t="2019-01-10 16:38:36 mikerod Or perhaps your screenshot was just not indicative of what you are looking at."><a href="#t1547138316047600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-10</span> <span class="t" onclick="H(this)">16:38:36</span>                      mikerod </span><span>Or perhaps your screenshot was just not indicative of what you are looking at.</span></div><div id="t1547138378047900" t="2019-01-10 16:39:38 mikerod or maybe I was reading this wrong. I tend to look at the callstack based view - so nvm I think"><a href="#t1547138378047900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-10</span> <span class="t" onclick="H(this)">16:39:38</span>                      mikerod </span><span>or maybe I was reading this wrong. I tend to look at the callstack based view - so nvm I think</span></div><div id="t1547138408048100" t="2019-01-10 16:40:08 ethanc yeah, @U0LK1552A thats seems to be a hotspot view"><a href="#t1547138408048100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-10</span> <span class="t" onclick="H(this)">16:40:08</span>                       ethanc </span><span>yeah, @U0LK1552A thats seems to be a hotspot view</span></div><div id="t1547138472048500" t="2019-01-10 16:41:12 mikerod yep, just noticed. Harder to read that to me. but Yeah, that means it is the “entry point” to a lot of the stuff taking the higher self-times below"><a href="#t1547138472048500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-10</span> <span class="t" onclick="H(this)">16:41:12</span>                      mikerod </span><span>yep, just noticed. Harder to read that to me. but Yeah, that means it is the “entry point” to a lot of the stuff taking the higher self-times below</span></div><div id="t1547138487048700" t="2019-01-10 16:41:27 eraserhd Let me post a corrected screenshot..."><a href="#t1547138487048700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-10</span> <span class="t" onclick="H(this)">16:41:27</span>                     eraserhd </span><span>Let me post a corrected screenshot...</span></div><div id="t1547138489048900" t="2019-01-10 16:41:29 mikerod I prefer the other view to see a direct hierarchical/callstack visual on it"><a href="#t1547138489048900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-10</span> <span class="t" onclick="H(this)">16:41:29</span>                      mikerod </span><span>I prefer the other view to see a direct hierarchical/callstack visual on it</span></div><div id="t1547138539049100" t="2019-01-10 16:42:19 mikerod just easier to pinpoint the more specific path to trace through"><a href="#t1547138539049100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-10</span> <span class="t" onclick="H(this)">16:42:19</span>                      mikerod </span><span>just easier to pinpoint the more specific path to trace through</span></div><div id="t1547140135052600" t="2019-01-10 17:08:55 ethanc To my original comment,

the scenario i was remembering was something like:
 (defrule simple-rule
 [A (= ?f f)]
 [?bs &lt;- (acc/all) :from [B (= f ?f)]] 
 =&gt;
(insert! (-&gt;C)))
 

This does cause an retract on the production node, but thats due to new facts being add. So not as i remembered."><a href="#t1547140135052600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-10</span> <span class="t" onclick="H(this)">17:08:55</span>                       ethanc </span><span>To my original comment,

the scenario i was remembering was something like:
</span><pre>(defrule simple-rule
 [A (= ?f f)]
 [?bs &lt;- (acc/all) :from [B (= f ?f)]] 
 =&gt;
(insert! (-&gt;C)))
</pre><span>

This does cause an retract on the production node, but thats due to new facts being add. So not as i remembered.</span></div><div id="t1547139120049300" t="2019-01-10 16:52:00 eraserhd"><a href="#t1547139120049300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-10</span> <span class="t" onclick="H(this)">16:52:00</span>                eraserhd </span></div><div id="t1547139309049600" t="2019-01-10 16:55:09 mikerod @U0ECYL0ET It’s a bit cutoff and always a challenge to really know.

From this, it seems to suggest that you have a rule with a negation -  :not  that is initially true due to no matches at some point in fire-rules. Later, it gets matches so becomes false.
Due to order of rule firing, when it is becomes false, there was already staged activations of the rule from when it was true that need to be discarded now that that is no longer the case - via the truth maintenance"><a href="#t1547139309049600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-10</span> <span class="t" onclick="H(this)">16:55:09</span>                      mikerod </span><span>@U0ECYL0ET It’s a bit cutoff and always a challenge to really know.

From this, it seems to suggest that you have a rule with a negation - </span><code>:not</code><span> that is initially true due to no matches at some point in fire-rules. Later, it gets matches so becomes false.
Due to order of rule firing, when it is becomes false, there was already staged activations of the rule from when it was true that need to be discarded now that that is no longer the case - via the truth maintenance</span></div><div id="t1547139336049800" t="2019-01-10 16:55:36 mikerod The activations being discarded may have large tokens as one possibility - perhaps there is a large data gathered via an accumulator in this rule?"><a href="#t1547139336049800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-10</span> <span class="t" onclick="H(this)">16:55:36</span>                      mikerod </span><span>The activations being discarded may have large tokens as one possibility - perhaps there is a large data gathered via an accumulator in this rule?</span></div><div id="t1547139374050000" t="2019-01-10 16:56:14 mikerod Alternatively, I may have to see more stack to know (or can’t really know), the rule had a lot of combinations of matches resulting in many activations that now all have to be discarded"><a href="#t1547139374050000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-10</span> <span class="t" onclick="H(this)">16:56:14</span>                      mikerod </span><span>Alternatively, I may have to see more stack to know (or can’t really know), the rule had a lot of combinations of matches resulting in many activations that now all have to be discarded</span></div><div id="t1547139461050200" t="2019-01-10 16:57:41 eraserhd OK, my reading also.  We&apos;re going to try to isolate which rule(s) cause it."><a href="#t1547139461050200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-10</span> <span class="t" onclick="H(this)">16:57:41</span>                     eraserhd </span><span>OK, my reading also.  We&apos;re going to try to isolate which rule(s) cause it.</span></div><div id="t1547139522051200" t="2019-01-10 16:58:42 mikerod Maybe you can find one of that structure. The negation May be your actual last condition of the role, although that isn’t strictly true in all cases I believe. "><a href="#t1547139522051200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-10</span> <span class="t" onclick="H(this)">16:58:42</span>                      mikerod </span><span>Maybe you can find one of that structure. The negation May be your actual last condition of the role, although that isn’t strictly true in all cases I believe. </span></div><div id="t1547139565052400" t="2019-01-10 16:59:25 mikerod May be able to do some listener tracing to find more details too. I’d have to play around to come up with a useful example of how to use it in this sort of case. "><a href="#t1547139565052400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-10</span> <span class="t" onclick="H(this)">16:59:25</span>                      mikerod </span><span>May be able to do some listener tracing to find more details too. I’d have to play around to come up with a useful example of how to use it in this sort of case. </span></div><div id="t1547141989053400" t="2019-01-10 17:39:49 wparker Regarding tracing - I wrote some helpers at one point for this that I really need to clean up some and push to master - but basically you get an entry in a list for every interaction in the rules engine, most of which have a node ID attached.  You can then use that ID to look up the node in the session and see what rules/queries it corresponds to.  So if you see an ID come up a lot those rules are doing a lot of work.  Since it is ordered, you can investigate in more complex ways, but often a “lots of stuff is happening in this rule” can be enough to narrow things down enough"><a href="#t1547141989053400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-10</span> <span class="t" onclick="H(this)">17:39:49</span>                      wparker </span><span>Regarding tracing - I wrote some helpers at one point for this that I really need to clean up some and push to master - but basically you get an entry in a list for every interaction in the rules engine, most of which have a node ID attached.  You can then use that ID to look up the node in the session and see what rules/queries it corresponds to.  So if you see an ID come up a lot those rules are doing a lot of work.  Since it is ordered, you can investigate in more complex ways, but often a “lots of stuff is happening in this rule” can be enough to narrow things down enough</span></div><div id="t1547142330053700" t="2019-01-10 17:45:30 mikerod would be good to get some doc examples of this sort of thing"><a href="#t1547142330053700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-10</span> <span class="t" onclick="H(this)">17:45:30</span>                      mikerod </span><span>would be good to get some doc examples of this sort of thing</span></div><div id="t1547385547061600" t="2019-01-13 13:19:07 fricke Hi all,

(in the google-group the title is Infinite Loop when using :not-guard in a rule)

I tried to do something that is really easy to do in e.g. Datalog, like having given a node-&gt;parent relationship, I try to get hold of all the parents that are around (no duplicates). This snippet show the data-model with the rule:

 (defrecord Node2Parent [node parent])
(defrecord Node [node])
(r/defrule insert-all-parents
  [Node2Parent (= ?parent parent)]
  [:not [Node (= node ?parent)]]
  =&gt;
  (r/insert! (-&gt;Node ?parent))
  ) 

The way I read this is that we add a new  Node -fact for each occurring parent, that has not been added already.

And here&apos;s how I call it:
 (defn s [] (-&gt; (r/mk-session &apos;engine.core) (r/insert (-&gt;Node2Parent :inner1 :root)
                                                     (-&gt;Node2Parent :leaf1 :root)
                                                 (-&gt;Node2Parent :leaf2 :inner1)
                                                 (-&gt;Node2Parent :leaf3 :inner1))
           (r/fire-rules)))

(r/defquery all-nodes &quot;all nodes&quot;
  []
  [Node (= ?node node)])
(r/query (s) all-nodes) 

It goes into a infinite loop and never comes back. Adding a print-statement to the rule tell you that it keeps adding :root nodes to the fact-base.
I guess that I miss something the way the unification in the LHS-conditions play out.

thanks and regards
markus"><a href="#t1547385547061600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-13</span> <span class="t" onclick="H(this)">13:19:07</span>                  fricke </span><span>Hi all,

(in the google-group the title is Infinite Loop when using :not-guard in a rule)

I tried to do something that is really easy to do in e.g. Datalog, like having given a node-&gt;parent relationship, I try to get hold of all the parents that are around (no duplicates). This snippet show the data-model with the rule:

</span><pre>(defrecord Node2Parent [node parent])
(defrecord Node [node])
(r/defrule insert-all-parents
  [Node2Parent (= ?parent parent)]
  [:not [Node (= node ?parent)]]
  =&gt;
  (r/insert! (-&gt;Node ?parent))
  )</pre><span>

The way I read this is that we add a new </span><code>Node</code><span>-fact for each occurring parent, that has not been added already.

And here&apos;s how I call it:
</span><pre>(defn s [] (-&gt; (r/mk-session &apos;engine.core) (r/insert (-&gt;Node2Parent :inner1 :root)
                                                     (-&gt;Node2Parent :leaf1 :root)
                                                 (-&gt;Node2Parent :leaf2 :inner1)
                                                 (-&gt;Node2Parent :leaf3 :inner1))
           (r/fire-rules)))

(r/defquery all-nodes &quot;all nodes&quot;
  []
  [Node (= ?node node)])
(r/query (s) all-nodes)</pre><span>

It goes into a infinite loop and never comes back. Adding a print-statement to the rule tell you that it keeps adding :root nodes to the fact-base.
I guess that I miss something the way the unification in the LHS-conditions play out.

thanks and regards
markus</span></div><div id="t1547395486063800" t="2019-01-13 16:04:46 eraserhd @markus.frick the issue here is that Clara performs &quot;truth maintenance&quot;.  The better way to interpret the Node2Parent rule is, &quot;Every Node which does not have a parent, should have a parent.&quot;"><a href="#t1547395486063800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-13</span> <span class="t" onclick="H(this)">16:04:46</span>                eraserhd </span><span>@markus.frick the issue here is that Clara performs &quot;truth maintenance&quot;.  The better way to interpret the Node2Parent rule is, &quot;Every Node which does not have a parent, should have a parent.&quot;</span></div><div id="t1547395551065100" t="2019-01-13 16:05:51 eraserhd In this case, it confuses Clara.  Clara sees a node with no parent and decides it should have one.  Then it sees that the node has a parent, and therefore shouldn&apos;t have one, and therefore retracts it."><a href="#t1547395551065100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-13</span> <span class="t" onclick="H(this)">16:05:51</span>                eraserhd </span><span>In this case, it confuses Clara.  Clara sees a node with no parent and decides it should have one.  Then it sees that the node has a parent, and therefore shouldn&apos;t have one, and therefore retracts it.</span></div><div id="t1547395606065900" t="2019-01-13 16:06:46 eraserhd If there&apos;s no other way for Node to be created, just remove the :not.  If there is, you&apos;ll likely have to restructure it."><a href="#t1547395606065900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-13</span> <span class="t" onclick="H(this)">16:06:46</span>                eraserhd </span><span>If there&apos;s no other way for Node to be created, just remove the :not.  If there is, you&apos;ll likely have to restructure it.</span></div><div id="t1547396274069700" t="2019-01-13 16:17:54 ethanc You could also use an unconditional insert, as this would remove the fact from truth maintenance."><a href="#t1547396274069700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-13</span> <span class="t" onclick="H(this)">16:17:54</span>                  ethanc </span><span>You could also use an unconditional insert, as this would remove the fact from truth maintenance.</span></div><div id="t1547408239075000" t="2019-01-13 19:37:19 fricke oh thanks a lot;  I totally missed the &quot;truth maintenance&quot; aspect (coming from a Datalog world where rule-evaluation is monotonous). I guess it&apos;s just easier to understand and implement, if I add the  Node -facts by hand and add them to the session before I execute the rules. More so, since I won&apos;t get rid of the duplicate facts anyway.
With unconditional inserts I get
 ({:?node :root} {:?node :inner1} {:?node :inner1} {:?node :root}) 
I guess set semantics are just really difficult to have in a world where you just see the fixed number of facts from the LHS.

thanks, markus"><a href="#t1547408239075000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-13</span> <span class="t" onclick="H(this)">19:37:19</span>                  fricke </span><span>oh thanks a lot;  I totally missed the &quot;truth maintenance&quot; aspect (coming from a Datalog world where rule-evaluation is monotonous). I guess it&apos;s just easier to understand and implement, if I add the </span><code>Node</code><span>-facts by hand and add them to the session before I execute the rules. More so, since I won&apos;t get rid of the duplicate facts anyway.
With unconditional inserts I get
</span><pre>({:?node :root} {:?node :inner1} {:?node :inner1} {:?node :root})</pre><span>
I guess set semantics are just really difficult to have in a world where you just see the fixed number of facts from the LHS.

thanks, markus</span></div><div id="t1547587762075700" t="2019-01-15 21:29:22 mikerod @markus.frick late to this answer, but you can eliminate duplicates via “intermediary facts” and accumulators"><a href="#t1547587762075700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-15</span> <span class="t" onclick="H(this)">21:29:22</span>                 mikerod </span><span>@markus.frick late to this answer, but you can eliminate duplicates via “intermediary facts” and accumulators</span></div><div id="t1547587933075800" t="2019-01-15 21:32:13 mikerod"><a href="#t1547587933075800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-15</span> <span class="t" onclick="H(this)">21:32:13</span>                 mikerod </span></div><div id="t1548116054077400" t="2019-01-22 00:14:14 eraserhd I feel like I need a CLI program like awk but using Rete / Datalog.  It would be a souped-up  join ."><a href="#t1548116054077400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-22</span> <span class="t" onclick="H(this)">00:14:14</span>                eraserhd </span><span>I feel like I need a CLI program like awk but using Rete / Datalog.  It would be a souped-up </span><code>join</code><span>.</span></div><div id="t1548116111078400" t="2019-01-22 00:15:11 eraserhd It would take a rule description and an input file of facts, and the RHS can be only &quot;print&quot; or &quot;insert fact&quot;."><a href="#t1548116111078400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-22</span> <span class="t" onclick="H(this)">00:15:11</span>                eraserhd </span><span>It would take a rule description and an input file of facts, and the RHS can be only &quot;print&quot; or &quot;insert fact&quot;.</span></div><div id="t1548288534079300" t="2019-01-24 00:08:54 kahunamoore Did you ever get a response here or elsewhere?"><a href="#t1548288534079300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-24</span> <span class="t" onclick="H(this)">00:08:54</span>             kahunamoore </span><span>Did you ever get a response here or elsewhere?</span></div><div id="t1548289550080500" t="2019-01-24 00:25:50 jvtrigueros I would use that. Trying to figure out a rule system isn’t straightforward if you’re not used to it "><a href="#t1548289550080500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-24</span> <span class="t" onclick="H(this)">00:25:50</span>             jvtrigueros </span><span>I would use that. Trying to figure out a rule system isn’t straightforward if you’re not used to it </span></div><div id="t1548346745082300" t="2019-01-24 16:19:05 eraserhd @kahunamoore no discussion elsewhere"><a href="#t1548346745082300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-24</span> <span class="t" onclick="H(this)">16:19:05</span>                eraserhd </span><span>@kahunamoore no discussion elsewhere</span></div><div id="t1548346772082900" t="2019-01-24 16:19:32 eraserhd I suspect I&apos;ll eventually do it, but it&apos;s behind another personal project that&apos;s probably months away."><a href="#t1548346772082900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-24</span> <span class="t" onclick="H(this)">16:19:32</span>                eraserhd </span><span>I suspect I&apos;ll eventually do it, but it&apos;s behind another personal project that&apos;s probably months away.</span></div><div id="t1548347338083400" t="2019-01-24 16:28:58 mikerod @eraserhd sorry for delay, wasn’t completely clear on what you were saying there"><a href="#t1548347338083400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-24</span> <span class="t" onclick="H(this)">16:28:58</span>                 mikerod </span><span>@eraserhd sorry for delay, wasn’t completely clear on what you were saying there</span></div><div id="t1548347373083800" t="2019-01-24 16:29:33 mikerod is a “rule description” a set of rules/queries? so a ruleset?"><a href="#t1548347373083800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-24</span> <span class="t" onclick="H(this)">16:29:33</span>                 mikerod </span><span>is a “rule description” a set of rules/queries? so a ruleset?</span></div><div id="t1548347501084300" t="2019-01-24 16:31:41 mikerod And this would be convenient because you could tie it in with scripts?"><a href="#t1548347501084300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-24</span> <span class="t" onclick="H(this)">16:31:41</span>                 mikerod </span><span>And this would be convenient because you could tie it in with scripts?</span></div><div id="t1548355092085800" t="2019-01-24 18:38:12 wparker I&apos;m also not clear on what&apos;s being discussed - is this a proposed tool for rule generation?"><a href="#t1548355092085800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-24</span> <span class="t" onclick="H(this)">18:38:12</span>                 wparker </span><span>I&apos;m also not clear on what&apos;s being discussed - is this a proposed tool for rule generation?</span></div><div id="t1548359601087000" t="2019-01-24 19:53:21 eraserhd Ahhh.... OK.  So I&apos;m thinking of a tool like awk that can take a ruleset with -e the way awk takes a program, and reads facts from input, like an FS separated file."><a href="#t1548359601087000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-24</span> <span class="t" onclick="H(this)">19:53:21</span>                eraserhd </span><span>Ahhh.... OK.  So I&apos;m thinking of a tool like awk that can take a ruleset with -e the way awk takes a program, and reads facts from input, like an FS separated file.</span></div><div id="t1548359675088100" t="2019-01-24 19:54:35 eraserhd The example I came up with was a script to iterate through my tmux panes and use their positions to find the upper-rightmost pane (because I need to configure the editor in that one)."><a href="#t1548359675088100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-24</span> <span class="t" onclick="H(this)">19:54:35</span>                eraserhd </span><span>The example I came up with was a script to iterate through my tmux panes and use their positions to find the upper-rightmost pane (because I need to configure the editor in that one).</span></div><div id="t1548359757089400" t="2019-01-24 19:55:57 eraserhd So essentially I had two tables:  &lt;top&gt; &lt;left&gt; &lt;pane-id&gt; and &lt;pane-id&gt; &lt;editor-id&gt;."><a href="#t1548359757089400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-24</span> <span class="t" onclick="H(this)">19:55:57</span>                eraserhd </span><span>So essentially I had two tables:  &lt;top&gt; &lt;left&gt; &lt;pane-id&gt; and &lt;pane-id&gt; &lt;editor-id&gt;.</span></div><div id="t1548359772089800" t="2019-01-24 19:56:12 eraserhd And this is in shell, because my editor likes to be extended that way."><a href="#t1548359772089800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-24</span> <span class="t" onclick="H(this)">19:56:12</span>                eraserhd </span><span>And this is in shell, because my editor likes to be extended that way.</span></div><div id="t1548359824090300" t="2019-01-24 19:57:04 eraserhd But it seemed natural to have a tool that can do datalog-like queries on files like this."><a href="#t1548359824090300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-24</span> <span class="t" onclick="H(this)">19:57:04</span>                eraserhd </span><span>But it seemed natural to have a tool that can do datalog-like queries on files like this.</span></div><div id="t1548963560094400" t="2019-01-31 19:39:20 wparker Ok I think I see @eraserhd.  I&apos;ve only used Clara personally as a component of larger JVM systems so I haven&apos;t needed a CLI tool but I can see the utility and it doesn&apos;t sound unduly difficult.  I haven&apos;t heard of any existing such CLI tools though."><a href="#t1548963560094400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-01-31</span> <span class="t" onclick="H(this)">19:39:20</span>                 wparker </span><span>Ok I think I see @eraserhd.  I&apos;ve only used Clara personally as a component of larger JVM systems so I haven&apos;t needed a CLI tool but I can see the utility and it doesn&apos;t sound unduly difficult.  I haven&apos;t heard of any existing such CLI tools though.</span></div><div id="t1549107107101800" t="2019-02-02 11:31:47 david_clojurian Hello everyone,
I have a problem with clara rules and I hope you can help me.
To resolve components that are productive I create facts of dependencies and mark components that are used by productive components as productive as well.
Right when I have a loop in the dependency chain, clara rules ends up in a endless loop while firing rules.
Here is the code:
 (ns clara.error
  (:require [clara.rules :refer :all]))

(defrecord DependsOn [element dep])
(defrecord Productive [element])

(defrule productive
  &quot;&quot;
  [DependsOn (= ?element1 element) (= ?element2 dep)]
  [Productive (= ?element1 element)]
  =&gt;
  (insert! (-&gt;Productive ?element2)))

; Works
(as-&gt; (mk-session &apos;clara.error) $
      (apply insert $ [(-&gt;Productive &quot;A&quot;)])
      (apply insert $ [(-&gt;DependsOn &quot;A&quot; &quot;B&quot;)
                       (-&gt;DependsOn &quot;B&quot; &quot;C&quot;)
                       (-&gt;DependsOn &quot;C&quot; &quot;D&quot;)])
      (fire-rules $))

; ends in a loop
(as-&gt; (mk-session &apos;clara.error) $
      (apply insert $ [(-&gt;Productive &quot;A&quot;)])
      (apply insert $ [(-&gt;DependsOn &quot;A&quot; &quot;B&quot;)
                       (-&gt;DependsOn &quot;B&quot; &quot;C&quot;)
                       (-&gt;DependsOn &quot;C&quot; &quot;A&quot;)])
      (fire-rules $))
 
The approach of clara rules is awesome. That&apos;s why I hope we can find the problem so I can continue using clara rules.
Thanks in advance."><a href="#t1549107107101800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-02-02</span> <span class="t" onclick="H(this)">11:31:47</span>         david_clojurian </span><span>Hello everyone,
I have a problem with clara rules and I hope you can help me.
To resolve components that are productive I create facts of dependencies and mark components that are used by productive components as productive as well.
Right when I have a loop in the dependency chain, clara rules ends up in a endless loop while firing rules.
Here is the code:
</span><pre>(ns clara.error
  (:require [clara.rules :refer :all]))

(defrecord DependsOn [element dep])
(defrecord Productive [element])

(defrule productive
  &quot;&quot;
  [DependsOn (= ?element1 element) (= ?element2 dep)]
  [Productive (= ?element1 element)]
  =&gt;
  (insert! (-&gt;Productive ?element2)))

; Works
(as-&gt; (mk-session &apos;clara.error) $
      (apply insert $ [(-&gt;Productive &quot;A&quot;)])
      (apply insert $ [(-&gt;DependsOn &quot;A&quot; &quot;B&quot;)
                       (-&gt;DependsOn &quot;B&quot; &quot;C&quot;)
                       (-&gt;DependsOn &quot;C&quot; &quot;D&quot;)])
      (fire-rules $))

; ends in a loop
(as-&gt; (mk-session &apos;clara.error) $
      (apply insert $ [(-&gt;Productive &quot;A&quot;)])
      (apply insert $ [(-&gt;DependsOn &quot;A&quot; &quot;B&quot;)
                       (-&gt;DependsOn &quot;B&quot; &quot;C&quot;)
                       (-&gt;DependsOn &quot;C&quot; &quot;A&quot;)])
      (fire-rules $))
</pre><span>
The approach of clara rules is awesome. That&apos;s why I hope we can find the problem so I can continue using clara rules.
Thanks in advance.</span></div><div id="t1549186847107200" t="2019-02-03 09:40:47 ggaillard Hey David! I&apos;ve been using for some time so I hope I&apos;ll be able to help.
Based on the graph you are building, if I understand correctly, it seems normal that Clara ends up looping.
You have  Productive -[DependsOn]-&gt; Productive .
And you insert  A -&gt; B -&gt; C -&gt; A , but  A DependsOn B , so clara run again  A -&gt; B -&gt; C -&gt; A -&gt; B -&gt; C -&gt; A -&gt; B … . You have a loop in your graph.
It might be a problem with identity. You create a new  Productive  instance every time, but do clara knows that  (-&gt;Productive &quot;A&quot;)  is identical by value to  (-&gt;Productive &quot;A&quot;)  (new instance) ?"><a href="#t1549186847107200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-02-03</span> <span class="t" onclick="H(this)">09:40:47</span>               ggaillard </span><span>Hey David! I&apos;ve been using for some time so I hope I&apos;ll be able to help.
Based on the graph you are building, if I understand correctly, it seems normal that Clara ends up looping.
You have </span><code>Productive -[DependsOn]-&gt; Productive</code><span>.
And you insert </span><code>A -&gt; B -&gt; C -&gt; A</code><span>, but </span><code>A DependsOn B</code><span>, so clara run again </span><code>A -&gt; B -&gt; C -&gt; A -&gt; B -&gt; C -&gt; A -&gt; B …</code><span>. You have a loop in your graph.
It might be a problem with identity. You create a new </span><code>Productive</code><span> instance every time, but do clara knows that </span><code>(-&gt;Productive &quot;A&quot;)</code><span> is identical by value to </span><code>(-&gt;Productive &quot;A&quot;)</code><span> (new instance) ?</span></div><div id="t1549187010110600" t="2019-02-03 09:43:30 david_clojurian Hello @ggaillard. I filed an issue on github and I get 2 answers. I&apos;m evaluating these answers now, but as far as I can see, it seems to resolve my issue. Here is the link:  https://github.com/cerner/clara-rules/issues/418"><a href="#t1549187010110600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-02-03</span> <span class="t" onclick="H(this)">09:43:30</span>         david_clojurian </span><span>Hello @ggaillard. I filed an issue on github and I get 2 answers. I&apos;m evaluating these answers now, but as far as I can see, it seems to resolve my issue. Here is the link: </span><a href="https://github.com/cerner/clara-rules/issues/418" target="_blank">https://github.com/cerner/clara-rules/issues/418</a></div><div id="t1549187034110900" t="2019-02-03 09:43:54 ggaillard Ah nice, will look into it!"><a href="#t1549187034110900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-02-03</span> <span class="t" onclick="H(this)">09:43:54</span>                    ggaillard </span><span>Ah nice, will look into it!</span></div><div id="t1550613848003500" t="2019-02-19 22:04:08 eraserhd Over the next week or so, we&apos;re going to be working on a library to translate pull expressions into Clara rules productions.  Any thoughts on that now could shape how this works."><a href="#t1550613848003500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-02-19</span> <span class="t" onclick="H(this)">22:04:08</span>                eraserhd </span><span>Over the next week or so, we&apos;re going to be working on a library to translate pull expressions into Clara rules productions.  Any thoughts on that now could shape how this works.</span></div><div id="t1550615586005100" t="2019-02-19 22:33:06 dominicm Why do you need this? I&apos;m missing something I think "><a href="#t1550615586005100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-02-19</span> <span class="t" onclick="H(this)">22:33:06</span>                     dominicm </span><span>Why do you need this? I&apos;m missing something I think </span></div><div id="t1550617239005300" t="2019-02-19 23:00:39 eraserhd The primary system I work on models tasks and data dependencies.  Inputs and output for a task are described as pull expressions, and this allows us to compute task dependencies.  We couldn&apos;t do this with raw Clara queries, since they model general computation so halting problem yada yada."><a href="#t1550617239005300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-02-19</span> <span class="t" onclick="H(this)">23:00:39</span>                     eraserhd </span><span>The primary system I work on models tasks and data dependencies.  Inputs and output for a task are described as pull expressions, and this allows us to compute task dependencies.  We couldn&apos;t do this with raw Clara queries, since they model general computation so halting problem yada yada.</span></div><div id="t1550617274005500" t="2019-02-19 23:01:14 eraserhd Pull expressions are a really nice, natural way to describe the shape of data wanted, IMHO."><a href="#t1550617274005500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-02-19</span> <span class="t" onclick="H(this)">23:01:14</span>                     eraserhd </span><span>Pull expressions are a really nice, natural way to describe the shape of data wanted, IMHO.</span></div><div id="t1550617385005700" t="2019-02-19 23:03:05 eraserhd We are moving to Clara handling more of the computation, because its truth maintenance property solves a lot of problem for us, and one of the new things we want to know is when a tasks inputs have changed, in order to retrigger our task."><a href="#t1550617385005700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-02-19</span> <span class="t" onclick="H(this)">23:03:05</span>                     eraserhd </span><span>We are moving to Clara handling more of the computation, because its truth maintenance property solves a lot of problem for us, and one of the new things we want to know is when a tasks inputs have changed, in order to retrigger our task.</span></div><div id="t1550617465005900" t="2019-02-19 23:04:25 eraserhd So we&apos;re building this library to have Clara compute the inputs for a task in real time and update them as new data arrives."><a href="#t1550617465005900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-02-19</span> <span class="t" onclick="H(this)">23:04:25</span>                     eraserhd </span><span>So we&apos;re building this library to have Clara compute the inputs for a task in real time and update them as new data arrives.</span></div><div id="t1550634497009400" t="2019-02-20 03:48:17 adamfeldman @U0ECYL0ET sounds like an interesting project. Do the task inputs and outputs change frequently, preventing the use of a simple dependency graph? Can you say more about the business domain?

If you haven’t seen this, you may find it useful for working with pull expressions:  https://github.com/edn-query-language/eql"><a href="#t1550634497009400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-02-20</span> <span class="t" onclick="H(this)">03:48:17</span>                  adamfeldman </span><span>@U0ECYL0ET sounds like an interesting project. Do the task inputs and outputs change frequently, preventing the use of a simple dependency graph? Can you say more about the business domain?

If you haven’t seen this, you may find it useful for working with pull expressions: </span><a href="https://github.com/edn-query-language/eql" target="_blank">https://github.com/edn-query-language/eql</a></div><div id="t1550644489009700" t="2019-02-20 06:34:49 dominicm This sounds quite similar to something I&apos;ve been working on in my spare time! "><a href="#t1550644489009700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-02-20</span> <span class="t" onclick="H(this)">06:34:49</span>                     dominicm </span><span>This sounds quite similar to something I&apos;ve been working on in my spare time! </span></div><div id="t1550670919000100" t="2019-02-20 13:55:19 eraserhd @UCHV4JZ7A the problem with a hand-coded dependency graph is that the tasks are sort of &quot;locally owned&quot; by different teams.  This project coordinates tasks across the org."><a href="#t1550670919000100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-02-20</span> <span class="t" onclick="H(this)">13:55:19</span>                     eraserhd </span><span>@UCHV4JZ7A the problem with a hand-coded dependency graph is that the tasks are sort of &quot;locally owned&quot; by different teams.  This project coordinates tasks across the org.</span></div><div id="t1550671039000300" t="2019-02-20 13:57:19 eraserhd eql looks really neat, definitely something to investigate"><a href="#t1550671039000300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-02-20</span> <span class="t" onclick="H(this)">13:57:19</span>                     eraserhd </span><span>eql looks really neat, definitely something to investigate</span></div><div id="t1550671205000500" t="2019-02-20 14:00:05 dominicm @U0ECYL0ET are you familiar with terraform at all? would you say your tool is similar?"><a href="#t1550671205000500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-02-20</span> <span class="t" onclick="H(this)">14:00:05</span>                     dominicm </span><span>@U0ECYL0ET are you familiar with terraform at all? would you say your tool is similar?</span></div><div id="t1550671488000700" t="2019-02-20 14:04:48 eraserhd I am familiar, we use it.  I have big rants on terraform.  Our thing is much higher level."><a href="#t1550671488000700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-02-20</span> <span class="t" onclick="H(this)">14:04:48</span>                     eraserhd </span><span>I am familiar, we use it.  I have big rants on terraform.  Our thing is much higher level.</span></div><div id="t1550671625000900" t="2019-02-20 14:07:05 eraserhd Our thing&apos;s tasks are like, &quot;we need a marketing site&quot;.  That integration might use terraform."><a href="#t1550671625000900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-02-20</span> <span class="t" onclick="H(this)">14:07:05</span>                     eraserhd </span><span>Our thing&apos;s tasks are like, &quot;we need a marketing site&quot;.  That integration might use terraform.</span></div><div id="t1550671720002300" t="2019-02-20 14:08:40 eraserhd There&apos;s some similarities, except that we really lean on forward-chaining rules.  We need to have things built as early as possible, and we incrementally discover the information we need to do things."><a href="#t1550671720002300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-02-20</span> <span class="t" onclick="H(this)">14:08:40</span>                     eraserhd </span><span>There&apos;s some similarities, except that we really lean on forward-chaining rules.  We need to have things built as early as possible, and we incrementally discover the information we need to do things.</span></div><div id="t1550671770002900" t="2019-02-20 14:09:30 eraserhd A terraform-like thing using Clara would be nice!"><a href="#t1550671770002900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-02-20</span> <span class="t" onclick="H(this)">14:09:30</span>                     eraserhd </span><span>A terraform-like thing using Clara would be nice!</span></div><div id="t1550672992006000" t="2019-02-20 14:29:52 dominicm I want to write a terraform like thing in clojure. So I may look closer at what you&apos;re saying here."><a href="#t1550672992006000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-02-20</span> <span class="t" onclick="H(this)">14:29:52</span>                     dominicm </span><span>I want to write a terraform like thing in clojure. So I may look closer at what you&apos;re saying here.</span></div><div id="t1550673196000400" t="2019-02-20 14:33:16 adamfeldman @U09LZR36F Pulumi uses Terraform under the hood (and therefore takes advantage of the existing Terraform ecosystem), perhaps adapting Pulumi to Clojure would be a reasonable route to take  https://github.com/pulumi/pulumi ,  https://github.com/pulumi/pulumi-terraform"><a href="#t1550673196000400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-02-20</span> <span class="t" onclick="H(this)">14:33:16</span>                  adamfeldman </span><span>@U09LZR36F Pulumi uses Terraform under the hood (and therefore takes advantage of the existing Terraform ecosystem), perhaps adapting Pulumi to Clojure would be a reasonable route to take </span><a href="https://github.com/pulumi/pulumi" target="_blank">https://github.com/pulumi/pulumi</a><span>, </span><a href="https://github.com/pulumi/pulumi-terraform" target="_blank">https://github.com/pulumi/pulumi-terraform</a></div><div id="t1550673270001300" t="2019-02-20 14:34:30 dominicm Interesting, will take a look"><a href="#t1550673270001300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-02-20</span> <span class="t" onclick="H(this)">14:34:30</span>                     dominicm </span><span>Interesting, will take a look</span></div><div id="t1550673471001400" t="2019-02-20 14:37:51 dominicm @U0ECYL0ET we probably share complaints about terraform, and also the level at which you are describing things sounds similar to a project I tried to tackle things."><a href="#t1550673471001400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-02-20</span> <span class="t" onclick="H(this)">14:37:51</span>                     dominicm </span><span>@U0ECYL0ET we probably share complaints about terraform, and also the level at which you are describing things sounds similar to a project I tried to tackle things.</span></div><div id="t1550673610001500" t="2019-02-20 14:40:10 eraserhd My main complaint is that it is trying to be declarative.  I think that&apos;s a mistake in that domain.  We frequently need one object per thing in some database, for example, and that leads to terrible duplication and weird text ETL procedures."><a href="#t1550673610001500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-02-20</span> <span class="t" onclick="H(this)">14:40:10</span>                     eraserhd </span><span>My main complaint is that it is trying to be declarative.  I think that&apos;s a mistake in that domain.  We frequently need one object per thing in some database, for example, and that leads to terrible duplication and weird text ETL procedures.</span></div><div id="t1550673660001700" t="2019-02-20 14:41:00 eraserhd Those ETL procedures defeat the idea of what terraform is for.  So they&apos;ve added things like loops and getting external data, but it is kind of terrible and they don&apos;t want you to use it."><a href="#t1550673660001700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-02-20</span> <span class="t" onclick="H(this)">14:41:00</span>                     eraserhd </span><span>Those ETL procedures defeat the idea of what terraform is for.  So they&apos;ve added things like loops and getting external data, but it is kind of terrible and they don&apos;t want you to use it.</span></div><div id="t1550673663001900" t="2019-02-20 14:41:03 dominicm Oh I know. And the modules don&apos;t even help! Count doesn&apos;t even work for the &quot;loop construct&quot; in a number of cases, so you have to take explicit counts for everything"><a href="#t1550673663001900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-02-20</span> <span class="t" onclick="H(this)">14:41:03</span>                     dominicm </span><span>Oh I know. And the modules don&apos;t even help! Count doesn&apos;t even work for the &quot;loop construct&quot; in a number of cases, so you have to take explicit counts for everything</span></div><div id="t1550673668002100" t="2019-02-20 14:41:08 eraserhd In reality, it should be pure functional."><a href="#t1550673668002100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-02-20</span> <span class="t" onclick="H(this)">14:41:08</span>                     eraserhd </span><span>In reality, it should be pure functional.</span></div><div id="t1550673699002400" t="2019-02-20 14:41:39 eraserhd right?!"><a href="#t1550673699002400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-02-20</span> <span class="t" onclick="H(this)">14:41:39</span>                     eraserhd </span><span>right?!</span></div><div id="t1550673716002700" t="2019-02-20 14:41:56 dominicm The terraform language sucks, generally. I&apos;d love it if they had a minimal extensible core. "><a href="#t1550673716002700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-02-20</span> <span class="t" onclick="H(this)">14:41:56</span>                     dominicm </span><span>The terraform language sucks, generally. I&apos;d love it if they had a minimal extensible core. </span></div><div id="t1550673736003400" t="2019-02-20 14:42:16 dominicm I quite like the idea of figuring out some primitives for building your own tf :)"><a href="#t1550673736003400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-02-20</span> <span class="t" onclick="H(this)">14:42:16</span>                     dominicm </span><span>I quite like the idea of figuring out some primitives for building your own tf :)</span></div><div id="t1550673843004100" t="2019-02-20 14:44:03 eraserhd In Clojure, terraform really just becomes a data structure and a plan/apply procedure.  The data structure can be generated by a function."><a href="#t1550673843004100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-02-20</span> <span class="t" onclick="H(this)">14:44:03</span>                     eraserhd </span><span>In Clojure, terraform really just becomes a data structure and a plan/apply procedure.  The data structure can be generated by a function.</span></div><div id="t1550673872004700" t="2019-02-20 14:44:32 eraserhd I mean, Clara is probably good here :D  But not necessary."><a href="#t1550673872004700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-02-20</span> <span class="t" onclick="H(this)">14:44:32</span>                     eraserhd </span><span>I mean, Clara is probably good here :D  But not necessary.</span></div><div id="t1550673962006700" t="2019-02-20 14:46:02 eraserhd The data structure needs some kind of ?var to bind results of some operations to inputs of others.  Unlike the go people, we know about proper unification :D"><a href="#t1550673962006700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-02-20</span> <span class="t" onclick="H(this)">14:46:02</span>                     eraserhd </span><span>The data structure needs some kind of ?var to bind results of some operations to inputs of others.  Unlike the go people, we know about proper unification :D</span></div><div id="t1550674061007100" t="2019-02-20 14:47:41 dominicm So, I&apos;m looking at clara to do the dependency graph of work semi-automatically. For example, when do you go fetch the list of GitHub users? Well, if something wants to query them (and then you cache it). If you&apos;ve diffed the list of users, and something inserts a new user, then you need to change your actions based on that.

This is a pretty half-baked idea though  🙂"><a href="#t1550674061007100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-02-20</span> <span class="t" onclick="H(this)">14:47:41</span>                     dominicm </span><span>So, I&apos;m looking at clara to do the dependency graph of work semi-automatically. For example, when do you go fetch the list of GitHub users? Well, if something wants to query them (and then you cache it). If you&apos;ve diffed the list of users, and something inserts a new user, then you need to change your actions based on that.

This is a pretty half-baked idea though </span><b>🙂</b></div><div id="t1550674242007300" t="2019-02-20 14:50:42 eraserhd So, are you using it ahead-of-time to build a plan?  Or are you using it during execution?"><a href="#t1550674242007300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-02-20</span> <span class="t" onclick="H(this)">14:50:42</span>                     eraserhd </span><span>So, are you using it ahead-of-time to build a plan?  Or are you using it during execution?</span></div><div id="t1550674833007500" t="2019-02-20 15:00:33 dominicm execution"><a href="#t1550674833007500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-02-20</span> <span class="t" onclick="H(this)">15:00:33</span>                     dominicm </span><span>execution</span></div><div id="t1550674870007700" t="2019-02-20 15:01:10 dominicm thinking about trade-offs, I decided that a plan is possible to do as an auxiliary based on a secondary set of rules which inform you of the &quot;optimistic write output&quot; of a task."><a href="#t1550674870007700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-02-20</span> <span class="t" onclick="H(this)">15:01:10</span>                     dominicm </span><span>thinking about trade-offs, I decided that a plan is possible to do as an auxiliary based on a secondary set of rules which inform you of the &quot;optimistic write output&quot; of a task.</span></div><div id="t1550613955004700" t="2019-02-19 22:05:55 eraserhd We&apos;re thinking about depending on clara_eav, since this will need a triplet type, and I&apos;m considering the EAV record in clara_eav the &quot;canonical triplet type&quot; for Clara."><a href="#t1550613955004700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-02-19</span> <span class="t" onclick="H(this)">22:05:55</span>                eraserhd </span><span>We&apos;re thinking about depending on clara_eav, since this will need a triplet type, and I&apos;m considering the EAV record in clara_eav the &quot;canonical triplet type&quot; for Clara.</span></div><div id="t1550613976005000" t="2019-02-19 22:06:16 eraserhd It&apos;ll likely use nothing else from it, though."><a href="#t1550613976005000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-02-19</span> <span class="t" onclick="H(this)">22:06:16</span>                eraserhd </span><span>It&apos;ll likely use nothing else from it, though.</span></div><div id="t1550665590010300" t="2019-02-20 12:26:30 dominicm http://www.clara-rules.org/docs/rules/  mentions &quot;props&quot;, but I can&apos;t see documentation for them on that page. Does anyone know what they are?"><a href="#t1550665590010300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-02-20</span> <span class="t" onclick="H(this)">12:26:30</span>                dominicm </span><a href="http://www.clara-rules.org/docs/rules/" target="_blank">http://www.clara-rules.org/docs/rules/</a><span> mentions &quot;props&quot;, but I can&apos;t see documentation for them on that page. Does anyone know what they are?</span></div><div id="t1550671872004100" t="2019-02-20 14:11:12 ethanc @dominicm it is a simple map, currently the only thing supported would be salience, i think.

 http://www.clara-rules.org/docs/conflictsalience/"><a href="#t1550671872004100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-02-20</span> <span class="t" onclick="H(this)">14:11:12</span>                  ethanc </span><span>@dominicm it is a simple map, currently the only thing supported would be salience, i think.

</span><a href="http://www.clara-rules.org/docs/conflictsalience/" target="_blank">http://www.clara-rules.org/docs/conflictsalience/</a></div><div id="t1550672398004600" t="2019-02-20 14:19:58 mikerod @dominicm @ethanc there is also  :no-loop"><a href="#t1550672398004600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-02-20</span> <span class="t" onclick="H(this)">14:19:58</span>                 mikerod </span><span>@dominicm @ethanc there is also </span><code>:no-loop</code></div><div id="t1550672471004800" t="2019-02-20 14:21:11 mikerod https://github.com/cerner/clara-rules/issues/23"><a href="#t1550672471004800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-02-20</span> <span class="t" onclick="H(this)">14:21:11</span>                 mikerod </span><a href="https://github.com/cerner/clara-rules/issues/23" target="_blank">https://github.com/cerner/clara-rules/issues/23</a></div><div id="t1550672481005200" t="2019-02-20 14:21:21 mikerod However, it’s typically not recommended to write rules in a way where you have to use that"><a href="#t1550672481005200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-02-20</span> <span class="t" onclick="H(this)">14:21:21</span>                 mikerod </span><span>However, it’s typically not recommended to write rules in a way where you have to use that</span></div><div id="t1550672485005400" t="2019-02-20 14:21:25 mikerod it can have confusing semantics I believe"><a href="#t1550672485005400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-02-20</span> <span class="t" onclick="H(this)">14:21:25</span>                 mikerod </span><span>it can have confusing semantics I believe</span></div><div id="t1550672500005800" t="2019-02-20 14:21:40 mikerod (probably why it hasn’t been documented much  😛  )"><a href="#t1550672500005800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-02-20</span> <span class="t" onclick="H(this)">14:21:40</span>                 mikerod </span><span>(probably why it hasn’t been documented much </span><b>😛</b><span> )</span></div><div id="t1550673212001200" t="2019-02-20 14:33:32 dominicm Is it possible to create rules with parameters? And be explicit about passing them in?"><a href="#t1550673212001200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-02-20</span> <span class="t" onclick="H(this)">14:33:32</span>                dominicm </span><span>Is it possible to create rules with parameters? And be explicit about passing them in?</span></div><div id="t1550673722003000" t="2019-02-20 14:42:02 mikerod @dominicm It isn’t clear to me how that would work in general"><a href="#t1550673722003000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-02-20</span> <span class="t" onclick="H(this)">14:42:02</span>                 mikerod </span><span>@dominicm It isn’t clear to me how that would work in general</span></div><div id="t1550673730003300" t="2019-02-20 14:42:10 mikerod However, queries take parameters if that’s more what you’re looking for"><a href="#t1550673730003300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-02-20</span> <span class="t" onclick="H(this)">14:42:10</span>                 mikerod </span><span>However, queries take parameters if that’s more what you’re looking for</span></div><div id="t1550673758004000" t="2019-02-20 14:42:38 mikerod For rules, instead of taking a parameter, model the param as a fact inserted by a rule perhaps"><a href="#t1550673758004000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-02-20</span> <span class="t" onclick="H(this)">14:42:38</span>                 mikerod </span><span>For rules, instead of taking a parameter, model the param as a fact inserted by a rule perhaps</span></div><div id="t1550673897005400" t="2019-02-20 14:44:57 mikerod Instead of
 (defrule param-rule
  [A (= &lt;my-param-here&gt; x)]
  =&gt;
  &lt;do things&gt;)
 

Do
 (defrule find-param
  [?i &lt;- InputFact]
  =&gt;
  (insert! (map-&gt;Param (extract-data ?i))))

(defrule param-rule
  [?p &lt;- Param]
  [A (= (:x ?p) x)]
  =&gt;
  &lt;do things&gt;)
"><a href="#t1550673897005400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-02-20</span> <span class="t" onclick="H(this)">14:44:57</span>                 mikerod </span><span>Instead of
</span><pre>(defrule param-rule
  [A (= &lt;my-param-here&gt; x)]
  =&gt;
  &lt;do things&gt;)
</pre><span>

Do
</span><pre>(defrule find-param
  [?i &lt;- InputFact]
  =&gt;
  (insert! (map-&gt;Param (extract-data ?i))))

(defrule param-rule
  [?p &lt;- Param]
  [A (= (:x ?p) x)]
  =&gt;
  &lt;do things&gt;)
</pre></div><div id="t1550673912005700" t="2019-02-20 14:45:12 dominicm @mikerod hmm, maybe I haven&apos;t thought it through. But I want to write rules like &quot;for every X insert 5&quot;, where I might have multiple of these inserted."><a href="#t1550673912005700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-02-20</span> <span class="t" onclick="H(this)">14:45:12</span>                dominicm </span><span>@mikerod hmm, maybe I haven&apos;t thought it through. But I want to write rules like &quot;for every X insert 5&quot;, where I might have multiple of these inserted.</span></div><div id="t1550673915006000" t="2019-02-20 14:45:15 dominicm Ah, right, of course."><a href="#t1550673915006000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-02-20</span> <span class="t" onclick="H(this)">14:45:15</span>                dominicm </span><span>Ah, right, of course.</span></div><div id="t1550673938006600" t="2019-02-20 14:45:38 dominicm My rule just needs to find &quot;Candidate X&quot;, and then insertions can be made about X candidate.  🙂"><a href="#t1550673938006600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-02-20</span> <span class="t" onclick="H(this)">14:45:38</span>                dominicm </span><span>My rule just needs to find &quot;Candidate X&quot;, and then insertions can be made about X candidate. </span><b>🙂</b></div><div id="t1550674016007000" t="2019-02-20 14:46:56 mikerod I think so"><a href="#t1550674016007000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-02-20</span> <span class="t" onclick="H(this)">14:46:56</span>                 mikerod </span><span>I think so</span></div><div id="t1551195909008800" t="2019-02-26 15:45:09 bmaddy Does anyone know if Clara supports recursion in queries? I couldn&apos;t find a mention of it on the website."><a href="#t1551195909008800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-02-26</span> <span class="t" onclick="H(this)">15:45:09</span>                  bmaddy </span><span>Does anyone know if Clara supports recursion in queries? I couldn&apos;t find a mention of it on the website.</span></div><div id="t1551196901009400" t="2019-02-26 16:01:41 ethanc @bmaddy could you elaborate on &quot;recursion in queries&quot;"><a href="#t1551196901009400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-02-26</span> <span class="t" onclick="H(this)">16:01:41</span>                  ethanc </span><span>@bmaddy could you elaborate on &quot;recursion in queries&quot;</span></div><div id="t1551197225012900" t="2019-02-26 16:07:05 bmaddy Sure, be advised that I&apos;m really new to Clara and rules engines in general. Basically, I have a tree of data (nested associatives). I want to convert that into facts to query over it. If you&apos;re familiar with Datomic, it would be like asserting an entity  {:a 1 :b {:c {:d 5}}}  into datoms. I then want to do a query that finds a result if  :d  is  5  and any ancestor has an  :a  with the value  1 . And because I said ancestor there, I think I&apos;ll need a recursive query."><a href="#t1551197225012900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-02-26</span> <span class="t" onclick="H(this)">16:07:05</span>                  bmaddy </span><span>Sure, be advised that I&apos;m really new to Clara and rules engines in general. Basically, I have a tree of data (nested associatives). I want to convert that into facts to query over it. If you&apos;re familiar with Datomic, it would be like asserting an entity </span><code>{:a 1 :b {:c {:d 5}}}</code><span> into datoms. I then want to do a query that finds a result if </span><code>:d</code><span> is </span><code>5</code><span> and any ancestor has an </span><code>:a</code><span> with the value </span><code>1</code><span>. And because I said ancestor there, I think I&apos;ll need a recursive query.</span></div><div id="t1551202125015900" t="2019-02-26 17:28:45 ethanc Sorry for the delay
You could probably brute force it in a query(iterate over the nested maps), but i would think that the idiomatic way would be to deconstruct the parent and insert the children with reference to there parent or root.

for example:
 (ns some.namespace
  (:require [clara.rules :as r]))

(r/defrule expansion-rule
  [?e &lt;- :entity (some map? (vals this))]
  =&gt;
  (doseq [v (vals ?e)
          :when (map? v)
          [k v] v]
    (r/insert! (with-meta
                 ;; wrapping ?e in a vector to prevent
                 ;; v from having a child with that is a map
                 ;; (infinite loop)
                {:key k :val v :root (or (:root ?e) [?e])}
                {:type :entity}))))

(r/defquery get-root
  [:?val :?key]
  [:entity
   (= ?key (:key this))
   (= ?val (:val this))
   (= ?root (or (first (:root this)) this))])


(-&gt; (r/mk-session)
     (r/insert (with-meta {:a 1 :b {:c {:d 5}}} {:type :entity}))
     r/fire-rules
     (r/query get-root :?val 5 :?key :d))
"><a href="#t1551202125015900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-02-26</span> <span class="t" onclick="H(this)">17:28:45</span>                  ethanc </span><span>Sorry for the delay
You could probably brute force it in a query(iterate over the nested maps), but i would think that the idiomatic way would be to deconstruct the parent and insert the children with reference to there parent or root.

for example:
</span><pre>(ns some.namespace
  (:require [clara.rules :as r]))

(r/defrule expansion-rule
  [?e &lt;- :entity (some map? (vals this))]
  =&gt;
  (doseq [v (vals ?e)
          :when (map? v)
          [k v] v]
    (r/insert! (with-meta
                 ;; wrapping ?e in a vector to prevent
                 ;; v from having a child with that is a map
                 ;; (infinite loop)
                {:key k :val v :root (or (:root ?e) [?e])}
                {:type :entity}))))

(r/defquery get-root
  [:?val :?key]
  [:entity
   (= ?key (:key this))
   (= ?val (:val this))
   (= ?root (or (first (:root this)) this))])


(-&gt; (r/mk-session)
     (r/insert (with-meta {:a 1 :b {:c {:d 5}}} {:type :entity}))
     r/fire-rules
     (r/query get-root :?val 5 :?key :d))
</pre></div><div id="t1551202293017800" t="2019-02-26 17:31:33 ethanc Using clara&apos;s fact-type here as i was being lazy and didn&apos;t want to construct a wrapper fact. By default clara uses  clojure.core/type  to determine rules to activate, thus i made the maps of type  :entity"><a href="#t1551202293017800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-02-26</span> <span class="t" onclick="H(this)">17:31:33</span>                  ethanc </span><span>Using clara&apos;s fact-type here as i was being lazy and didn&apos;t want to construct a wrapper fact. By default clara uses </span><code>clojure.core/type</code><span> to determine rules to activate, thus i made the maps of type </span><code>:entity</code></div><div id="t1551203078018800" t="2019-02-26 17:44:38 ethanc The when in the doseq would be wrong and could be removed"><a href="#t1551203078018800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-02-26</span> <span class="t" onclick="H(this)">17:44:38</span>                  ethanc </span><span>The when in the doseq would be wrong and could be removed</span></div><div id="t1551203172019500" t="2019-02-26 17:46:12 ethanc and would be replaced with logic to expand all the keys rather than just maps"><a href="#t1551203172019500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-02-26</span> <span class="t" onclick="H(this)">17:46:12</span>                  ethanc </span><span>and would be replaced with logic to expand all the keys rather than just maps</span></div><div id="t1551204725022000" t="2019-02-26 18:12:05 ethanc The ancestors questions would then have to be post query, either that or you could insert some sort of fact representing what you are trying to join logically. Queries are aimed more at field equivalence"><a href="#t1551204725022000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-02-26</span> <span class="t" onclick="H(this)">18:12:05</span>                  ethanc </span><span>The ancestors questions would then have to be post query, either that or you could insert some sort of fact representing what you are trying to join logically. Queries are aimed more at field equivalence</span></div><div id="t1551208265023700" t="2019-02-26 19:11:05 ethanc As an example of what i mean by inserting a fact to represent what you logically want to join,
 (ns some.namespace
  (:require [clara.rules :as r]))

(r/defrule expansion-rule
  [?e &lt;- :entity (some map? (vals this))]
  =&gt;
  (doseq [v (vals ?e)
          :when (map? v)]
    (r/insert! (with-meta
                 (assoc v :ancestors (conj (or (:ancestors ?e) []) (dissoc ?e :ancestors)))
                 {:type :entity}))))

(r/defrule query-rule
  [:query
   (= ?aq (:ancestor-question this))
   (= ?eq (:entity-question this))
   (= ?t (:query-id this))]
  [?e &lt;- :entity]
  [:test (and (?eq ?e)
              (some ?aq (:ancestors ?e)))]
  =&gt;
  (r/insert!
    (with-meta
      {:res ?e :query-id ?t}
      {:type :result})))

(r/defquery result-query
  [:?query-id]
  [:result
   (= ?query-id (:query-id this))
   (= ?result (:res this))])

(-&gt; (r/mk-session)
    (r/insert (with-meta {:a 1 :b {:c {:d 5}}} {:type :entity}))
    (r/insert (with-meta {:query-id :d-5_a-1
                          :entity-question #(= (:d %) 5)
                          :ancestor-question #(= (:a %) 1)}
                         {:type :query}))
    r/fire-rules
    (r/query result-query :?query-id :d-5_a-1))
=&gt;
({:?query-id :d-5_a-1, :?result {:d 5, :ancestors [{:a 1, :b {:c {:d 5}}} {:c {:d 5}}]}})
"><a href="#t1551208265023700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-02-26</span> <span class="t" onclick="H(this)">19:11:05</span>                  ethanc </span><span>As an example of what i mean by inserting a fact to represent what you logically want to join,
</span><pre>(ns some.namespace
  (:require [clara.rules :as r]))

(r/defrule expansion-rule
  [?e &lt;- :entity (some map? (vals this))]
  =&gt;
  (doseq [v (vals ?e)
          :when (map? v)]
    (r/insert! (with-meta
                 (assoc v :ancestors (conj (or (:ancestors ?e) []) (dissoc ?e :ancestors)))
                 {:type :entity}))))

(r/defrule query-rule
  [:query
   (= ?aq (:ancestor-question this))
   (= ?eq (:entity-question this))
   (= ?t (:query-id this))]
  [?e &lt;- :entity]
  [:test (and (?eq ?e)
              (some ?aq (:ancestors ?e)))]
  =&gt;
  (r/insert!
    (with-meta
      {:res ?e :query-id ?t}
      {:type :result})))

(r/defquery result-query
  [:?query-id]
  [:result
   (= ?query-id (:query-id this))
   (= ?result (:res this))])

(-&gt; (r/mk-session)
    (r/insert (with-meta {:a 1 :b {:c {:d 5}}} {:type :entity}))
    (r/insert (with-meta {:query-id :d-5_a-1
                          :entity-question #(= (:d %) 5)
                          :ancestor-question #(= (:a %) 1)}
                         {:type :query}))
    r/fire-rules
    (r/query result-query :?query-id :d-5_a-1))
=&gt;
({:?query-id :d-5_a-1, :?result {:d 5, :ancestors [{:a 1, :b {:c {:d 5}}} {:c {:d 5}}]}})
</pre></div><div id="t1551212503028500" t="2019-02-26 20:21:43 bmaddy Wow, thanks for all the explanation. I must admit, I&apos;m rather stunned. I thought rules engines would let you do datalog-like queries across data to get notified as it changes, but now it seems like you need to build data up every step of the way in order to answer your question. I was thinking about using that to help with a ton of validations on nested data I have, but that sounds like I might be better off with something like datascript.
So what&apos;s the killer app for rules engines? Right now my understanding of it makes me basically think it&apos;s like calling  iterate  on a set of data until it doesn&apos;t change anymore (applying rules) and then filtering it (the queries).
(If you don&apos;t have the time to explain, I totally understand--you&apos;re generously volunteering your time after all! Thank you!)"><a href="#t1551212503028500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-02-26</span> <span class="t" onclick="H(this)">20:21:43</span>                  bmaddy </span><span>Wow, thanks for all the explanation. I must admit, I&apos;m rather stunned. I thought rules engines would let you do datalog-like queries across data to get notified as it changes, but now it seems like you need to build data up every step of the way in order to answer your question. I was thinking about using that to help with a ton of validations on nested data I have, but that sounds like I might be better off with something like datascript.
So what&apos;s the killer app for rules engines? Right now my understanding of it makes me basically think it&apos;s like calling </span><code>iterate</code><span> on a set of data until it doesn&apos;t change anymore (applying rules) and then filtering it (the queries).
(If you don&apos;t have the time to explain, I totally understand--you&apos;re generously volunteering your time after all! Thank you!)</span></div><div id="t1551213950029000" t="2019-02-26 20:45:50 mikerod @bmaddy I believe the distinction may be more around the forward-chaining vs backward-chaining strengths and weaknesses"><a href="#t1551213950029000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-02-26</span> <span class="t" onclick="H(this)">20:45:50</span>                 mikerod </span><span>@bmaddy I believe the distinction may be more around the forward-chaining vs backward-chaining strengths and weaknesses</span></div><div id="t1551213978029300" t="2019-02-26 20:46:18 mikerod Clara being oriented around the forward-chaining style rules"><a href="#t1551213978029300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-02-26</span> <span class="t" onclick="H(this)">20:46:18</span>                 mikerod </span><span>Clara being oriented around the forward-chaining style rules</span></div><div id="t1551214024030000" t="2019-02-26 20:47:04 mikerod and logic programming systems like prolog (core.logic too?; datascript too?) more around a backward-chaining design"><a href="#t1551214024030000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-02-26</span> <span class="t" onclick="H(this)">20:47:04</span>                 mikerod </span><span>and logic programming systems like prolog (core.logic too?; datascript too?) more around a backward-chaining design</span></div><div id="t1551214892031300" t="2019-02-26 21:01:32 bmaddy Yeah, I&apos;ve heard that. I could certainly stand to do some research to get a better grasp on that."><a href="#t1551214892031300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-02-26</span> <span class="t" onclick="H(this)">21:01:32</span>                  bmaddy </span><span>Yeah, I&apos;ve heard that. I could certainly stand to do some research to get a better grasp on that.</span></div><div id="t1551217794034000" t="2019-02-26 21:49:54 mikerod @bmaddy I think it’s difficult to explain well and there are probably good write-ups out there on the differences"><a href="#t1551217794034000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-02-26</span> <span class="t" onclick="H(this)">21:49:54</span>                 mikerod </span><span>@bmaddy I think it’s difficult to explain well and there are probably good write-ups out there on the differences</span></div><div id="t1551217845035000" t="2019-02-26 21:50:45 mikerod Clara’s forward-chaining approach is good for a type of problem where you have a set of known facts and you have a complex chain of logical inference that can be done based on those facts to arrive at some - typically pre-enumerated set of outcomes"><a href="#t1551217845035000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-02-26</span> <span class="t" onclick="H(this)">21:50:45</span>                 mikerod </span><span>Clara’s forward-chaining approach is good for a type of problem where you have a set of known facts and you have a complex chain of logical inference that can be done based on those facts to arrive at some - typically pre-enumerated set of outcomes</span></div><div id="t1551217889035900" t="2019-02-26 21:51:29 mikerod You can parameterize the queries in Clara to an extent that does allow you to look for different sorts of matches, but I don’t think the concept extends well to asking arbitrary questions about the state of the system"><a href="#t1551217889035900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-02-26</span> <span class="t" onclick="H(this)">21:51:29</span>                 mikerod </span><span>You can parameterize the queries in Clara to an extent that does allow you to look for different sorts of matches, but I don’t think the concept extends well to asking arbitrary questions about the state of the system</span></div><div id="t1551217915036300" t="2019-02-26 21:51:55 mikerod Like, I can say “Give me the outcomes that have an x value between 30-50”"><a href="#t1551217915036300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-02-26</span> <span class="t" onclick="H(this)">21:51:55</span>                 mikerod </span><span>Like, I can say “Give me the outcomes that have an x value between 30-50”</span></div><div id="t1551217946037000" t="2019-02-26 21:52:26 mikerod but it is harder to say, “Tell me what facts I’d need to get an outcome with x value between 30-50”"><a href="#t1551217946037000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-02-26</span> <span class="t" onclick="H(this)">21:52:26</span>                 mikerod </span><span>but it is harder to say, “Tell me what facts I’d need to get an outcome with x value between 30-50”</span></div><div id="t1551217989037900" t="2019-02-26 21:53:09 mikerod So Ethan had good examples above of how you can use forward-chaining to explicitly model relationships - so that you can query on those relationships-as-facts later"><a href="#t1551217989037900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-02-26</span> <span class="t" onclick="H(this)">21:53:09</span>                 mikerod </span><span>So Ethan had good examples above of how you can use forward-chaining to explicitly model relationships - so that you can query on those relationships-as-facts later</span></div><div id="t1551218006038400" t="2019-02-26 21:53:26 mikerod I think backwards-chaining may have more built-in approaches when that’s teh type of problem you are solving"><a href="#t1551218006038400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-02-26</span> <span class="t" onclick="H(this)">21:53:26</span>                 mikerod </span><span>I think backwards-chaining may have more built-in approaches when that’s teh type of problem you are solving</span></div><div id="t1551218073039700" t="2019-02-26 21:54:33 mikerod Forward-chaining is nice when you are doing waht I said above, and it comes with a good mechanism of chaining along a “path” that supports arriving at your various outcomes.
I don’t think anyone tends to say which is better, forward/backwards, I think it’s just that each is better at a certain class of problem."><a href="#t1551218073039700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-02-26</span> <span class="t" onclick="H(this)">21:54:33</span>                 mikerod </span><span>Forward-chaining is nice when you are doing waht I said above, and it comes with a good mechanism of chaining along a “path” that supports arriving at your various outcomes.
I don’t think anyone tends to say which is better, forward/backwards, I think it’s just that each is better at a certain class of problem.</span></div><div id="t1551218094040200" t="2019-02-26 21:54:54 mikerod But not sure why I typed all that. Probably much better explanations available online.  😛"><a href="#t1551218094040200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-02-26</span> <span class="t" onclick="H(this)">21:54:54</span>                 mikerod </span><span>But not sure why I typed all that. Probably much better explanations available online. </span><b>😛</b></div><div id="t1551221087052800" t="2019-02-26 22:44:47 bmaddy Yeah, I&apos;m a little familiar with what you&apos;re describing. I certainly have an entity (nested associative structure) that regularly changes slightly (in one case this is part of a state for a UI) and I want to run the same set of validations on it after every little change. That&apos;s what makes me think a rules engine is the way to go (i.e. my queries don&apos;t change, my data does). I just thought the querying would have something like datalog rules. I think I&apos;ll just need to study Ethan&apos;s examples a little more. I think I get the general idea it&apos;s describing, but haven&apos;t fully wrapped my head around it yet.
Thanks again everyone for your help!"><a href="#t1551221087052800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-02-26</span> <span class="t" onclick="H(this)">22:44:47</span>                  bmaddy </span><span>Yeah, I&apos;m a little familiar with what you&apos;re describing. I certainly have an entity (nested associative structure) that regularly changes slightly (in one case this is part of a state for a UI) and I want to run the same set of validations on it after every little change. That&apos;s what makes me think a rules engine is the way to go (i.e. my queries don&apos;t change, my data does). I just thought the querying would have something like datalog rules. I think I&apos;ll just need to study Ethan&apos;s examples a little more. I think I get the general idea it&apos;s describing, but haven&apos;t fully wrapped my head around it yet.
Thanks again everyone for your help!</span></div><div id="t1551370396003900" t="2019-02-28 16:13:16 wparker I  don’t  have much to add to  the above - as the examples shows, Clara doesn’t  try to query further  into facts,  it just treats them as top level entities  to be joined, inserted, etc.   Right now my understanding of it makes me basically think it&apos;s like calling `iterate` on a set of data until it doesn&apos;t change anymore (applying rules) and then filtering it (the queries).   That sounds on target.  One thing a rules engine such as Clara is good at is efficiently applying small  changes  onto a complex ruleset - the intermediate states of the rule engine internals are kept to facilitate this.  The “truth  maintenance” page  on the webpage is a good one to read if you haven’t yet. @bmaddy"><a href="#t1551370396003900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-02-28</span> <span class="t" onclick="H(this)">16:13:16</span>                 wparker </span><span>I  don’t  have much to add to  the above - as the examples shows, Clara doesn’t  try to query further  into facts,  it just treats them as top level entities  to be joined, inserted, etc.  </span><pre>Right now my understanding of it makes me basically think it&apos;s like calling `iterate` on a set of data until it doesn&apos;t change anymore (applying rules) and then filtering it (the queries). </pre><span> That sounds on target.  One thing a rules engine such as Clara is good at is efficiently applying small  changes  onto a complex ruleset - the intermediate states of the rule engine internals are kept to facilitate this.  The “truth  maintenance” page  on the webpage is a good one to read if you haven’t yet. @bmaddy</span></div><div id="t1551381681006500" t="2019-02-28 19:21:21 bmaddy Thanks, it&apos;s nice to know my mental model is in the right ballpark.  🙂  Yeah, I&apos;ve read that page before--it&apos;s very clear and well written. I haven&apos;t been able to find much on joins though. I actually didn&apos;t even realize that was possible until I was looking at Precept."><a href="#t1551381681006500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-02-28</span> <span class="t" onclick="H(this)">19:21:21</span>                  bmaddy </span><span>Thanks, it&apos;s nice to know my mental model is in the right ballpark. </span><b>🙂</b><span> Yeah, I&apos;ve read that page before--it&apos;s very clear and well written. I haven&apos;t been able to find much on joins though. I actually didn&apos;t even realize that was possible until I was looking at Precept.</span></div><div id="t1554316478000600" t="2019-04-03 18:34:38 eraserhd can we cut a release?  I think the :exists performance is blocking us right now (still running tests, tho)."><a href="#t1554316478000600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-03</span> <span class="t" onclick="H(this)">18:34:38</span>                eraserhd </span><span>can we cut a release?  I think the :exists performance is blocking us right now (still running tests, tho).</span></div><div id="t1554324790004700" t="2019-04-03 20:53:10 defndaines I wanted to test the SNAPSHOT and realized I have to install an older JDK to compile the project.  In particular,  :javac-options [&quot;-target&quot; &quot;1.6&quot; &quot;-source&quot; &quot;1.6&quot;]  is no longer supported. Does anyone know that best version to build with?
(It isn’t enough to just change those to “1.8” … that brings up a  ClassNotFoundException: javax.xml.bind.DatatypeConverter  issue, which I think is JDK11 [LTS] and higher.)"><a href="#t1554324790004700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-03</span> <span class="t" onclick="H(this)">20:53:10</span>              defndaines </span><span>I wanted to test the SNAPSHOT and realized I have to install an older JDK to compile the project.  In particular, </span><code>:javac-options [&quot;-target&quot; &quot;1.6&quot; &quot;-source&quot; &quot;1.6&quot;]</code><span> is no longer supported. Does anyone know that best version to build with?
(It isn’t enough to just change those to “1.8” … that brings up a </span><code>ClassNotFoundException: javax.xml.bind.DatatypeConverter</code><span> issue, which I think is JDK11 [LTS] and higher.)</span></div><div id="t1554326324005500" t="2019-04-03 21:18:44 eraserhd On mac, I do  JAVA_HOME=$(/usr/libexec/java_home -v 1.8) lein install  or what not."><a href="#t1554326324005500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-03</span> <span class="t" onclick="H(this)">21:18:44</span>                eraserhd </span><span>On mac, I do </span><code>JAVA_HOME=$(/usr/libexec/java_home -v 1.8) lein install</code><span> or what not.</span></div><div id="t1554326346005800" t="2019-04-03 21:19:06 eraserhd That just worked for me today."><a href="#t1554326346005800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-03</span> <span class="t" onclick="H(this)">21:19:06</span>                eraserhd </span><span>That just worked for me today.</span></div><div id="t1554326375006200" t="2019-04-03 21:19:35 eraserhd The target options are only about bytecode, iirc."><a href="#t1554326375006200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-03</span> <span class="t" onclick="H(this)">21:19:35</span>                eraserhd </span><span>The target options are only about bytecode, iirc.</span></div><div id="t1554327768006500" t="2019-04-03 21:42:48 mikerod The xml thing is common in libs that haven’t upgrade some deps yet"><a href="#t1554327768006500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-03</span> <span class="t" onclick="H(this)">21:42:48</span>                 mikerod </span><span>The xml thing is common in libs that haven’t upgrade some deps yet</span></div><div id="t1554327782006900" t="2019-04-03 21:43:02 mikerod Clara has some lower version deps right now, it should be changed with some better profiles I think"><a href="#t1554327782006900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-03</span> <span class="t" onclick="H(this)">21:43:02</span>                 mikerod </span><span>Clara has some lower version deps right now, it should be changed with some better profiles I think</span></div><div id="t1554327792007200" t="2019-04-03 21:43:12 mikerod but you can work around the jdk11 things I think with just adding to the module path"><a href="#t1554327792007200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-03</span> <span class="t" onclick="H(this)">21:43:12</span>                 mikerod </span><span>but you can work around the jdk11 things I think with just adding to the module path</span></div><div id="t1554327836007500" t="2019-04-03 21:43:56 mikerod in  :jvm-opts  add  &quot;--add-modules java.xml.bind&quot;"><a href="#t1554327836007500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-03</span> <span class="t" onclick="H(this)">21:43:56</span>                 mikerod </span><span>in </span><code>:jvm-opts</code><span> add </span><code>&quot;--add-modules java.xml.bind&quot;</code></div><div id="t1554327851007900" t="2019-04-03 21:44:11 mikerod can do that in your  ~/.lein/profiles.clj  or just alter Clara’s project"><a href="#t1554327851007900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-03</span> <span class="t" onclick="H(this)">21:44:11</span>                 mikerod </span><span>can do that in your </span><code>~/.lein/profiles.clj</code><span> or just alter Clara’s project</span></div><div id="t1554327874008200" t="2019-04-03 21:44:34 mikerod oh, there is already a profile for this in clara"><a href="#t1554327874008200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-03</span> <span class="t" onclick="H(this)">21:44:34</span>                 mikerod </span><span>oh, there is already a profile for this in clara</span></div><div id="t1554327890008500" t="2019-04-03 21:44:50 mikerod lein with-profile java9 install"><a href="#t1554327890008500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-03</span> <span class="t" onclick="H(this)">21:44:50</span>                 mikerod </span><code>lein with-profile java9 install</code></div><div id="t1554327909008900" t="2019-04-03 21:45:09 mikerod you can build with a bit higher cljs/clj too with a profile built-in"><a href="#t1554327909008900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-03</span> <span class="t" onclick="H(this)">21:45:09</span>                 mikerod </span><span>you can build with a bit higher cljs/clj too with a profile built-in</span></div><div id="t1554327924009200" t="2019-04-03 21:45:24 mikerod lein with-profile java9,recent-clj install"><a href="#t1554327924009200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-03</span> <span class="t" onclick="H(this)">21:45:24</span>                 mikerod </span><code>lein with-profile java9,recent-clj install</code></div><div id="t1554327945009700" t="2019-04-03 21:45:45 mikerod However, the  java9  is slightly misleading, I think it should work with jdk11 too (pending any not testing jdk11 issues with clara or lib it uses)"><a href="#t1554327945009700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-03</span> <span class="t" onclick="H(this)">21:45:45</span>                 mikerod </span><span>However, the </span><code>java9</code><span> is slightly misleading, I think it should work with jdk11 too (pending any not testing jdk11 issues with clara or lib it uses)</span></div><div id="t1554327960010000" t="2019-04-03 21:46:00 mikerod I do not see this though  :javac-options [&quot;-target&quot; &quot;1.6&quot; &quot;-source&quot; &quot;1.6&quot;]  and that doesn’t seem ideal to me"><a href="#t1554327960010000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-03</span> <span class="t" onclick="H(this)">21:46:00</span>                 mikerod </span><span>I do not see this though </span><code>:javac-options [&quot;-target&quot; &quot;1.6&quot; &quot;-source&quot; &quot;1.6&quot;]</code><span> and that doesn’t seem ideal to me</span></div><div id="t1554327978010300" t="2019-04-03 21:46:18 mikerod I think Clara should remove that, maybe a good PR…"><a href="#t1554327978010300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-03</span> <span class="t" onclick="H(this)">21:46:18</span>                 mikerod </span><span>I think Clara should remove that, maybe a good PR…</span></div><div id="t1554328075011300" t="2019-04-03 21:47:55 mikerod maybe just do this:  lein update-in : assoc :javac-opts &quot;^:replace []&quot; -- with-profile java9, recent-clj install  - hah, quite rough"><a href="#t1554328075011300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-03</span> <span class="t" onclick="H(this)">21:47:55</span>                 mikerod </span><span>maybe just do this: </span><code>lein update-in : assoc :javac-opts &quot;^:replace []&quot; -- with-profile java9, recent-clj install</code><span> - hah, quite rough</span></div><div id="t1554328204013100" t="2019-04-03 21:50:04 wparker @eraserhd Regarding cutting a release in the near future, that seems reasonable to me - any objections anyone?  Probably 0.19.1 looking at the changelog."><a href="#t1554328204013100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-03</span> <span class="t" onclick="H(this)">21:50:04</span>                 wparker </span><span>@eraserhd Regarding cutting a release in the near future, that seems reasonable to me - any objections anyone?  Probably 0.19.1 looking at the changelog.</span></div><div id="t1554328208013300" t="2019-04-03 21:50:08 mikerod We likely need to make a profile to build for more modern things and make that the default dev setup. Can have separate install/deploy configuration and testing"><a href="#t1554328208013300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-03</span> <span class="t" onclick="H(this)">21:50:08</span>                 mikerod </span><span>We likely need to make a profile to build for more modern things and make that the default dev setup. Can have separate install/deploy configuration and testing</span></div><div id="t1554328298013800" t="2019-04-03 21:51:38 mikerod @wparker release seems fine to me based on what I see"><a href="#t1554328298013800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-03</span> <span class="t" onclick="H(this)">21:51:38</span>                 mikerod </span><span>@wparker release seems fine to me based on what I see</span></div><div id="t1554328302014000" t="2019-04-03 21:51:42 mikerod and minor version seems acceptable - nothing in there should be breaking or considered a “feature add”"><a href="#t1554328302014000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-03</span> <span class="t" onclick="H(this)">21:51:42</span>                 mikerod </span><span>and minor version seems acceptable - nothing in there should be breaking or considered a “feature add”</span></div><div id="t1554329509014500" t="2019-04-03 22:11:49 ethanc Agreed"><a href="#t1554329509014500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-03</span> <span class="t" onclick="H(this)">22:11:49</span>                  ethanc </span><span>Agreed</span></div><div id="t1554390152015000" t="2019-04-04 15:02:32 defndaines I was able to smoke-test with the SNAPSHOT version and didn’t see any issues."><a href="#t1554390152015000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-04</span> <span class="t" onclick="H(this)">15:02:32</span>              defndaines </span><span>I was able to smoke-test with the SNAPSHOT version and didn’t see any issues.</span></div><div id="t1554390203016100" t="2019-04-04 15:03:23 defndaines As a follow up to the questions yesterday (had to drop off, but thanks for all the suggestions):
I could not build the project with either JDK 11 or 12.
I was able to build the project with JDK 8."><a href="#t1554390203016100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-04</span> <span class="t" onclick="H(this)">15:03:23</span>              defndaines </span><span>As a follow up to the questions yesterday (had to drop off, but thanks for all the suggestions):
I could not build the project with either JDK 11 or 12.
I was able to build the project with JDK 8.</span></div><div id="t1554390983016600" t="2019-04-04 15:16:23 mikerod @defndaines did you try my suggestion on running lein?"><a href="#t1554390983016600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-04</span> <span class="t" onclick="H(this)">15:16:23</span>                 mikerod </span><span>@defndaines did you try my suggestion on running lein?</span></div><div id="t1554391006016900" t="2019-04-04 15:16:46 mikerod Have to use a profile etc"><a href="#t1554391006016900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-04</span> <span class="t" onclick="H(this)">15:16:46</span>                 mikerod </span><span>Have to use a profile etc</span></div><div id="t1554391608018300" t="2019-04-04 15:26:48 defndaines Yeah, I tried all the suggestions above and none of them worked. Maybe it’s a set-up issue, but neither of the profiles work for me.
I suspect that it’s because that XML fix for Java 9 only works in 9 and 10, and then was fully deprecated and removed in 11 so that it doesn’t cut it anymore."><a href="#t1554391608018300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-04</span> <span class="t" onclick="H(this)">15:26:48</span>              defndaines </span><span>Yeah, I tried all the suggestions above and none of them worked. Maybe it’s a set-up issue, but neither of the profiles work for me.
I suspect that it’s because that XML fix for Java 9 only works in 9 and 10, and then was fully deprecated and removed in 11 so that it doesn’t cut it anymore.</span></div><div id="t1554391959018600" t="2019-04-04 15:32:39 mikerod @defndaines I didn’t think 11 went full on breaking for people"><a href="#t1554391959018600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-04</span> <span class="t" onclick="H(this)">15:32:39</span>                 mikerod </span><span>@defndaines I didn’t think 11 went full on breaking for people</span></div><div id="t1554391961018800" t="2019-04-04 15:32:41 mikerod but perhaps"><a href="#t1554391961018800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-04</span> <span class="t" onclick="H(this)">15:32:41</span>                 mikerod </span><span>but perhaps</span></div><div id="t1554391975019200" t="2019-04-04 15:32:55 mikerod we need to update dependencies in Clara, I may try to do this soon"><a href="#t1554391975019200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-04</span> <span class="t" onclick="H(this)">15:32:55</span>                 mikerod </span><span>we need to update dependencies in Clara, I may try to do this soon</span></div><div id="t1554392034019500" t="2019-04-04 15:33:54 mikerod It probably somewhat relates to  https://github.com/cerner/clara-rules/issues/388  so I’ll probably use that one"><a href="#t1554392034019500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-04</span> <span class="t" onclick="H(this)">15:33:54</span>                 mikerod </span><span>It probably somewhat relates to </span><a href="https://github.com/cerner/clara-rules/issues/388" target="_blank">https://github.com/cerner/clara-rules/issues/388</a><span> so I’ll probably use that one</span></div><div id="t1554392047019900" t="2019-04-04 15:34:07 mikerod The offending deps are probably on the cljs side"><a href="#t1554392047019900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-04</span> <span class="t" onclick="H(this)">15:34:07</span>                 mikerod </span><span>The offending deps are probably on the cljs side</span></div><div id="t1554392051020100" t="2019-04-04 15:34:11 mikerod but will have to check"><a href="#t1554392051020100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-04</span> <span class="t" onclick="H(this)">15:34:11</span>                 mikerod </span><span>but will have to check</span></div><div id="t1554392350020300" t="2019-04-04 15:39:10 mikerod They removed it in jdk11 indeed:  https://stackoverflow.com/a/52502208/924604"><a href="#t1554392350020300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-04</span> <span class="t" onclick="H(this)">15:39:10</span>                 mikerod </span><span>They removed it in jdk11 indeed: </span><a href="https://stackoverflow.com/a/52502208/924604" target="_blank">https://stackoverflow.com/a/52502208/924604</a></div><div id="t1554392373020800" t="2019-04-04 15:39:33 mikerod you have to add the jar now to the  :dependencies  is you need it - but we probably don’t need it, just using too old deps."><a href="#t1554392373020800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-04</span> <span class="t" onclick="H(this)">15:39:33</span>                 mikerod </span><span>you have to add the jar now to the </span><code>:dependencies</code><span> is you need it - but we probably don’t need it, just using too old deps.</span></div><div id="t1554395566021900" t="2019-04-04 16:32:46 defndaines Yeah, the error messages I was looking at yesterday when I ran things were all around the CLJS compilation. I tried some quick version updates myself, but it involved a lot more than changing the  project.clj ."><a href="#t1554395566021900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-04</span> <span class="t" onclick="H(this)">16:32:46</span>              defndaines </span><span>Yeah, the error messages I was looking at yesterday when I ran things were all around the CLJS compilation. I tried some quick version updates myself, but it involved a lot more than changing the </span><code>project.clj</code><span>.</span></div><div id="t1554397031022300" t="2019-04-04 16:57:11 mikerod @defndaines yeah, I’m working on the #388 issue a bit, hopefully not long before I can PR it"><a href="#t1554397031022300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-04</span> <span class="t" onclick="H(this)">16:57:11</span>                 mikerod </span><span>@defndaines yeah, I’m working on the #388 issue a bit, hopefully not long before I can PR it</span></div><div id="t1554397048022800" t="2019-04-04 16:57:28 mikerod I want to fix the cljs build in a few ways, but I do have it building now with jdk11 just using some newer clj+cljs deps"><a href="#t1554397048022800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-04</span> <span class="t" onclick="H(this)">16:57:28</span>                 mikerod </span><span>I want to fix the cljs build in a few ways, but I do have it building now with jdk11 just using some newer clj+cljs deps</span></div><div id="t1554397060023200" t="2019-04-04 16:57:40 mikerod I have all the details on that #388 issue if anyone is curious"><a href="#t1554397060023200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-04</span> <span class="t" onclick="H(this)">16:57:40</span>                 mikerod </span><span>I have all the details on that #388 issue if anyone is curious</span></div><div id="t1554397093023700" t="2019-04-04 16:58:13 mikerod It’s still a weird world to me to see the jdk not being backwards compatible. I think that’s basically unheard of until about jdk9 came along hah"><a href="#t1554397093023700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-04</span> <span class="t" onclick="H(this)">16:58:13</span>                 mikerod </span><span>It’s still a weird world to me to see the jdk not being backwards compatible. I think that’s basically unheard of until about jdk9 came along hah</span></div><div id="t1554397128024100" t="2019-04-04 16:58:48 mikerod it’s a new world, new release cadence, new “ownership of distros”"><a href="#t1554397128024100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-04</span> <span class="t" onclick="H(this)">16:58:48</span>                 mikerod </span><span>it’s a new world, new release cadence, new “ownership of distros”</span></div><div id="t1554485038025700" t="2019-04-05 17:23:58 eraserhd ha!  I just found out that  (-&gt; session inspect :insertions keys * :name)  is not a fully qualified symbol, but a symbol with a slash in the  name  part."><a href="#t1554485038025700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-05</span> <span class="t" onclick="H(this)">17:23:58</span>                eraserhd </span><span>ha!  I just found out that </span><code>(-&gt; session inspect :insertions keys * :name)</code><span> is not a fully qualified symbol, but a symbol with a slash in the </span><code>name</code><span> part.</span></div><div id="t1554485252026100" t="2019-04-05 17:27:32 mikerod I do not get it  😵"><a href="#t1554485252026100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-05</span> <span class="t" onclick="H(this)">17:27:32</span>                 mikerod </span><span>I do not get it </span><b>😵</b></div><div id="t1554485262026300" t="2019-04-05 17:27:42 mikerod doing crazy things with the  symbol  fn?"><a href="#t1554485262026300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-05</span> <span class="t" onclick="H(this)">17:27:42</span>                 mikerod </span><span>doing crazy things with the </span><code>symbol</code><span> fn?</span></div><div id="t1554496390027200" t="2019-04-05 20:33:10 devn What is  *  in there @eraserhd? When you say symbol do you mean keyword? I had the same thought as mikerod:  (symbol &quot;not/valid&quot;)"><a href="#t1554496390027200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-05</span> <span class="t" onclick="H(this)">20:33:10</span>                    devn </span><span>What is </span><code>*</code><span> in there @eraserhd? When you say symbol do you mean keyword? I had the same thought as mikerod: </span><code>(symbol &quot;not/valid&quot;)</code></div><div id="t1554496856028200" t="2019-04-05 20:40:56 eraserhd *  was pseudo-code for &quot;some integer&quot;.  I guess  first  would actually work."><a href="#t1554496856028200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-05</span> <span class="t" onclick="H(this)">20:40:56</span>                eraserhd </span><code>*</code><span> was pseudo-code for &quot;some integer&quot;.  I guess </span><code>first</code><span> would actually work.</span></div><div id="t1554496891028800" t="2019-04-05 20:41:31 eraserhd the value at  :name  on a rule map is a symbol"><a href="#t1554496891028800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-05</span> <span class="t" onclick="H(this)">20:41:31</span>                eraserhd </span><span>the value at </span><code>:name</code><span> on a rule map is a symbol</span></div><div id="t1554742059029100" t="2019-04-08 16:47:39 wparker When I tried this I got a string:   clara.other-ruleset=&gt; (-&gt; (mk-session) (insert (-&gt;ColdAndWindy 15 15)) fire-rules inspect/inspect :insertions  keys first :name)
&quot;clara.other-ruleset/is-lousy&quot;
clara.other-ruleset=&gt; (-&gt; (mk-session) (insert (-&gt;ColdAndWindy 15 15)) fire-rules inspect/inspect :insertions  keys first :name class)
java.lang.String   Do you have a reproducing case or maybe I’m misunderstanding something?"><a href="#t1554742059029100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-08</span> <span class="t" onclick="H(this)">16:47:39</span>                      wparker </span><span>When I tried this I got a string:  </span><pre>clara.other-ruleset=&gt; (-&gt; (mk-session) (insert (-&gt;ColdAndWindy 15 15)) fire-rules inspect/inspect :insertions  keys first :name)
&quot;clara.other-ruleset/is-lousy&quot;
clara.other-ruleset=&gt; (-&gt; (mk-session) (insert (-&gt;ColdAndWindy 15 15)) fire-rules inspect/inspect :insertions  keys first :name class)
java.lang.String </pre><span> Do you have a reproducing case or maybe I’m misunderstanding something?</span></div><div id="t1554742086029300" t="2019-04-08 16:48:06 wparker clara.other-ruleset is a test namespace in Clara"><a href="#t1554742086029300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-08</span> <span class="t" onclick="H(this)">16:48:06</span>                      wparker </span><span>clara.other-ruleset is a test namespace in Clara</span></div><div id="t1554744154031800" t="2019-04-08 17:22:34 eraserhd hmm"><a href="#t1554744154031800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-08</span> <span class="t" onclick="H(this)">17:22:34</span>                     eraserhd </span><span>hmm</span></div><div id="t1554744418032100" t="2019-04-08 17:26:58 eraserhd Here&apos;s the function:  https://gist.github.com/eraserhd/b7276d42de798e04b3f1cda0fb8e76ab   ... I don&apos;t see that I&apos;m doing anything weird there..."><a href="#t1554744418032100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-08</span> <span class="t" onclick="H(this)">17:26:58</span>                     eraserhd </span><span>Here&apos;s the function: </span><a href="https://gist.github.com/eraserhd/b7276d42de798e04b3f1cda0fb8e76ab" target="_blank">https://gist.github.com/eraserhd/b7276d42de798e04b3f1cda0fb8e76ab</a><span>  ... I don&apos;t see that I&apos;m doing anything weird there...</span></div><div id="t1554744474032300" t="2019-04-08 17:27:54 eraserhd However, a bunch of rules are generated by some macros.  I&apos;m pretty sure they expand clara.rules/defrule with a normal, unqualified symbol.  But maybe something in the macros is weird?"><a href="#t1554744474032300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-08</span> <span class="t" onclick="H(this)">17:27:54</span>                     eraserhd </span><span>However, a bunch of rules are generated by some macros.  I&apos;m pretty sure they expand clara.rules/defrule with a normal, unqualified symbol.  But maybe something in the macros is weird?</span></div><div id="t1554744589032500" t="2019-04-08 17:29:49 eraserhd (the code on line 22 in the gist was added to work around the observed problem)"><a href="#t1554744589032500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-08</span> <span class="t" onclick="H(this)">17:29:49</span>                     eraserhd </span><span>(the code on line 22 in the gist was added to work around the observed problem)</span></div><div id="t1554744649032700" t="2019-04-08 17:30:49 eraserhd https://github.com/eraserhd/clara-eql/blob/develop/src/net/eraserhead/clara_eql/core.clj  &lt;-- the macro in question"><a href="#t1554744649032700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-08</span> <span class="t" onclick="H(this)">17:30:49</span>                     eraserhd </span><a href="https://github.com/eraserhd/clara-eql/blob/develop/src/net/eraserhead/clara_eql/core.clj" target="_blank">https://github.com/eraserhd/clara-eql/blob/develop/src/net/eraserhead/clara_eql/core.clj</a><span> &lt;-- the macro in question</span></div><div id="t1554742545031500" t="2019-04-08 16:55:45 wparker Clara-rules 0.19.1 has been released; this contains some performance optimizations for memory use with durability, :exists rule conditions, and new functionality for reporting potential performance problems to users.   See the changelog for details:   https://github.com/cerner/clara-rules/blob/master/CHANGELOG.md#0191"><a href="#t1554742545031500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-08</span> <span class="t" onclick="H(this)">16:55:45</span>                 wparker </span><span>Clara-rules 0.19.1 has been released; this contains some performance optimizations for memory use with durability, :exists rule conditions, and new functionality for reporting potential performance problems to users.   See the changelog for details:  </span><a href="https://github.com/cerner/clara-rules/blob/master/CHANGELOG.md#0191" target="_blank">https://github.com/cerner/clara-rules/blob/master/CHANGELOG.md#0191</a></div><div id="t1554918731034900" t="2019-04-10 17:52:11 eraserhd Oh, I missed this.  \o/"><a href="#t1554918731034900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-10</span> <span class="t" onclick="H(this)">17:52:11</span>                eraserhd </span><span>Oh, I missed this.  \o/</span></div><div id="t1554918864036900" t="2019-04-10 17:54:24 eraserhd On another note, we&apos;ve been troubleshooting some serious performance issues loading our database, and I&apos;ve just figured out it is memory.  If I fire-rules with the facts of the worst kind in batches of 5 (that chain the most), it completes in about 25 minutes; otherwise, it takes about 4h10m."><a href="#t1554918864036900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-10</span> <span class="t" onclick="H(this)">17:54:24</span>                eraserhd </span><span>On another note, we&apos;ve been troubleshooting some serious performance issues loading our database, and I&apos;ve just figured out it is memory.  If I fire-rules with the facts of the worst kind in batches of 5 (that chain the most), it completes in about 25 minutes; otherwise, it takes about 4h10m.</span></div><div id="t1554918881037200" t="2019-04-10 17:54:41 eraserhd I mean, that&apos;s what tells me it is memory.  Tell me if I&apos;m wrong."><a href="#t1554918881037200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-10</span> <span class="t" onclick="H(this)">17:54:41</span>                eraserhd </span><span>I mean, that&apos;s what tells me it is memory.  Tell me if I&apos;m wrong.</span></div><div id="t1554919132038600" t="2019-04-10 17:58:52 ethanc Do you have profiles of the heap when this occurs?"><a href="#t1554919132038600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-10</span> <span class="t" onclick="H(this)">17:58:52</span>                  ethanc </span><span>Do you have profiles of the heap when this occurs?</span></div><div id="t1554919357039000" t="2019-04-10 18:02:37 eraserhd No, but I&apos;ll happily make some."><a href="#t1554919357039000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-10</span> <span class="t" onclick="H(this)">18:02:37</span>                eraserhd </span><span>No, but I&apos;ll happily make some.</span></div><div id="t1554923178041800" t="2019-04-10 19:06:18 mikerod @eraserhd both heap profile and CPU sampling snapshot info would be good - not sure what you use. visualvm is good"><a href="#t1554923178041800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-10</span> <span class="t" onclick="H(this)">19:06:18</span>                 mikerod </span><span>@eraserhd both heap profile and CPU sampling snapshot info would be good - not sure what you use. visualvm is good</span></div><div id="t1554923212042800" t="2019-04-10 19:06:52 mikerod Another shot in the dark suggestion - if you are making rules with long LHS sequence of conditions, perhaps you’d be better off breaking it into multiple rules that aren’t as “deep”"><a href="#t1554923212042800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-10</span> <span class="t" onclick="H(this)">19:06:52</span>                 mikerod </span><span>Another shot in the dark suggestion - if you are making rules with long LHS sequence of conditions, perhaps you’d be better off breaking it into multiple rules that aren’t as “deep”</span></div><div id="t1554923226043200" t="2019-04-10 19:07:06 mikerod using “intermediate facts” to represent the parts"><a href="#t1554923226043200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-10</span> <span class="t" onclick="H(this)">19:07:06</span>                 mikerod </span><span>using “intermediate facts” to represent the parts</span></div><div id="t1554923282044200" t="2019-04-10 19:08:02 mikerod this can often give better perf characteristics and I generally think it’s better modularization anyways. This may not be relevant to you at all though. I just noticed the “chain” part and wasn’t sure what it referred to."><a href="#t1554923282044200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-10</span> <span class="t" onclick="H(this)">19:08:02</span>                 mikerod </span><span>this can often give better perf characteristics and I generally think it’s better modularization anyways. This may not be relevant to you at all though. I just noticed the “chain” part and wasn’t sure what it referred to.</span></div><div id="t1554923336045400" t="2019-04-10 19:08:56 mikerod The clara inspection tracing/tools recently had an update by Will I believe where it can try to report “counts” of operations happening at points in the network. if your chaining is resulting in large “cartesian product” of facts joining together, these helpers may be useful to diagnose too"><a href="#t1554923336045400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-10</span> <span class="t" onclick="H(this)">19:08:56</span>                 mikerod </span><span>The clara inspection tracing/tools recently had an update by Will I believe where it can try to report “counts” of operations happening at points in the network. if your chaining is resulting in large “cartesian product” of facts joining together, these helpers may be useful to diagnose too</span></div><div id="t1554923359045600" t="2019-04-10 19:09:19 mikerod This is the relevant commit  https://github.com/cerner/clara-rules/commit/dde409c446a731e364096440d02ea0f7e8442c04"><a href="#t1554923359045600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-10</span> <span class="t" onclick="H(this)">19:09:19</span>                 mikerod </span><span>This is the relevant commit </span><a href="https://github.com/cerner/clara-rules/commit/dde409c446a731e364096440d02ea0f7e8442c04" target="_blank">https://github.com/cerner/clara-rules/commit/dde409c446a731e364096440d02ea0f7e8442c04</a></div><div id="t1554923393046100" t="2019-04-10 19:09:53 mikerod which gives you a fn  clara.tools.tracing/ranked-productions"><a href="#t1554923393046100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-10</span> <span class="t" onclick="H(this)">19:09:53</span>                 mikerod </span><span>which gives you a fn </span><code>clara.tools.tracing/ranked-productions</code></div><div id="t1554926590046700" t="2019-04-10 20:03:10 eraserhd by chain, I mean deep - rule A inserts a fact, then rule B fires and inserts a fact, etc..."><a href="#t1554926590046700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-10</span> <span class="t" onclick="H(this)">20:03:10</span>                eraserhd </span><span>by chain, I mean deep - rule A inserts a fact, then rule B fires and inserts a fact, etc...</span></div><div id="t1554926622047100" t="2019-04-10 20:03:42 eraserhd That counts things seems really relevant.  I&apos;ll try it."><a href="#t1554926622047100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-10</span> <span class="t" onclick="H(this)">20:03:42</span>                eraserhd </span><span>That counts things seems really relevant.  I&apos;ll try it.</span></div><div id="t1554928068049300" t="2019-04-10 20:27:48 eraserhd oh wow.  clojure.lang.Atom memory usage is climbing by 20M per second."><a href="#t1554928068049300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-10</span> <span class="t" onclick="H(this)">20:27:48</span>                eraserhd </span><span>oh wow.  clojure.lang.Atom memory usage is climbing by 20M per second.</span></div><div id="t1554928892049900" t="2019-04-10 20:41:32 mikerod Are you making a lot of atoms? Clara shouldn’t be hah"><a href="#t1554928892049900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-10</span> <span class="t" onclick="H(this)">20:41:32</span>                 mikerod </span><span>Are you making a lot of atoms? Clara shouldn’t be hah</span></div><div id="t1554930794057200" t="2019-04-10 21:13:14 wparker @eraserhd Clara uses atoms in engine.cljc in some places to store pending operations, conceivably you could get there from data being put in those atoms.  It would be fairly hard though.  But then the performant version of your rules sessions taking 25 minutes is striking.  😱  Obviously it could be unavoidable if you’re just processing massive amounts of data, but I’d be curious to see any kind of reproducing example of inordinate resource use, smaller examples obviously being easier to diagnose.  I suspect you’ve uncovered some kind of bad pattern in the way the rule network fires rather than this (poor) level of performance being inevitable.  Most of Clara’s optimization to date has been done against Cerner’s use cases; having a broader sample of benchmarks would be useful."><a href="#t1554930794057200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-10</span> <span class="t" onclick="H(this)">21:13:14</span>                 wparker </span><span>@eraserhd Clara uses atoms in engine.cljc in some places to store pending operations, conceivably you could get there from data being put in those atoms.  It would be fairly hard though.  But then the performant version of your rules sessions taking 25 minutes is striking. </span><b>😱</b><span> Obviously it could be unavoidable if you’re just processing massive amounts of data, but I’d be curious to see any kind of reproducing example of inordinate resource use, smaller examples obviously being easier to diagnose.  I suspect you’ve uncovered some kind of bad pattern in the way the rule network fires rather than this (poor) level of performance being inevitable.  Most of Clara’s optimization to date has been done against Cerner’s use cases; having a broader sample of benchmarks would be useful.</span></div><div id="t1554933881061200" t="2019-04-10 22:04:41 ethanc AlphaNodes are also generated with an  atom  for the bindings that the node will propagate in the event that its satisfied, however they would be scoped to the function that determined the satisfaction of the node. The atom is probably unnecessary and could be probably be replaced with shadowing within the function… I doubt that this is the growth that you are seeing though.

Might be a performance gain by not having to  swap!  that atom though…."><a href="#t1554933881061200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-10</span> <span class="t" onclick="H(this)">22:04:41</span>                       ethanc </span><span>AlphaNodes are also generated with an </span><code>atom</code><span> for the bindings that the node will propagate in the event that its satisfied, however they would be scoped to the function that determined the satisfaction of the node. The atom is probably unnecessary and could be probably be replaced with shadowing within the function… I doubt that this is the growth that you are seeing though.

Might be a performance gain by not having to </span><code>swap!</code><span> that atom though….</span></div><div id="t1554935398061400" t="2019-04-10 22:29:58 mikerod @U3KC48GHW interesting on the use of an atom there. I’ll have to check that out again. However, overall, I wouldn’t expect to see an “Atom” itself taking memory up. It’s a pointer to something that may be large, but it itself shouldn’t show up as taking that memory (that’s not what I expect in heap dumps at least I think?)"><a href="#t1554935398061400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-10</span> <span class="t" onclick="H(this)">22:29:58</span>                      mikerod </span><span>@U3KC48GHW interesting on the use of an atom there. I’ll have to check that out again. However, overall, I wouldn’t expect to see an “Atom” itself taking memory up. It’s a pointer to something that may be large, but it itself shouldn’t show up as taking that memory (that’s not what I expect in heap dumps at least I think?)</span></div><div id="t1554935413061600" t="2019-04-10 22:30:13 mikerod So a lot of memory taken by actual clojure.lang.Atom makes me think there’d be a lot of instances of the Atom class"><a href="#t1554935413061600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-10</span> <span class="t" onclick="H(this)">22:30:13</span>                      mikerod </span><span>So a lot of memory taken by actual clojure.lang.Atom makes me think there’d be a lot of instances of the Atom class</span></div><div id="t1555640420001300" t="2019-04-19 02:20:20 Joel somebody have a starter project for spring boot, but with clara support?"><a href="#t1555640420001300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-19</span> <span class="t" onclick="H(this)">02:20:20</span>                    Joel </span><span>somebody have a starter project for spring boot, but with clara support?</span></div><div id="t1555643453002500" t="2019-04-19 03:10:53 Joel also, what is attracting me to Clara is that I&apos;m expecting i could &quot;introspect&quot; the rules relatively easily, possibly even modify dynamically --- is that a reasonable assumption?"><a href="#t1555643453002500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-19</span> <span class="t" onclick="H(this)">03:10:53</span>                    Joel </span><span>also, what is attracting me to Clara is that I&apos;m expecting i could &quot;introspect&quot; the rules relatively easily, possibly even modify dynamically --- is that a reasonable assumption?</span></div><div id="t1555655205002700" t="2019-04-19 06:26:45 wparker What sorts of introspection did you have in mind?  If you mean introspection on what the rules engine did and why, there&apos;s a good amount of that, you can take a look at the inspect namespace and if you wanted something lower level the tracing namespace.  If you mean introspection on the rules network, possibly yes if you write things yourself, but since the rules can contain arbitrary code (that the user writes) you have the usual problems with inspecting  arbitrary code."><a href="#t1555655205002700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-19</span> <span class="t" onclick="H(this)">06:26:45</span>                      wparker </span><span>What sorts of introspection did you have in mind?  If you mean introspection on what the rules engine did and why, there&apos;s a good amount of that, you can take a look at the inspect namespace and if you wanted something lower level the tracing namespace.  If you mean introspection on the rules network, possibly yes if you write things yourself, but since the rules can contain arbitrary code (that the user writes) you have the usual problems with inspecting  arbitrary code.</span></div><div id="t1555655291002900" t="2019-04-19 06:28:11 wparker Regarding dynamic modification, if you want to change the rules you have to build a new session and rerun the rules."><a href="#t1555655291002900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-19</span> <span class="t" onclick="H(this)">06:28:11</span>                      wparker </span><span>Regarding dynamic modification, if you want to change the rules you have to build a new session and rerun the rules.</span></div><div id="t1555681742003100" t="2019-04-19 13:49:02 Joel no, not in that respect. I&apos;m interested in reading the rules to see what data they are looking for, fetched, and put into working member before running. For DB/REST calls."><a href="#t1555681742003100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-19</span> <span class="t" onclick="H(this)">13:49:02</span>                         Joel </span><span>no, not in that respect. I&apos;m interested in reading the rules to see what data they are looking for, fetched, and put into working member before running. For DB/REST calls.</span></div><div id="t1555681911003300" t="2019-04-19 13:51:51 Joel Basically, its an optimization so multiple calls aren&apos;t made while rules run, can do them all up front with single calls."><a href="#t1555681911003300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-19</span> <span class="t" onclick="H(this)">13:51:51</span>                         Joel </span><span>Basically, its an optimization so multiple calls aren&apos;t made while rules run, can do them all up front with single calls.</span></div><div id="t1555682347003500" t="2019-04-19 13:59:07 Joel The second part, probably thinking about the wrong way, but for parts of the rules that have variables, I&apos;d kind of like to see the rules served up with the variables replaced with actual values, so that it&apos;s easier to understand for user (developer).

Basically I&apos;ll be serving up the rules from a server, and the server will also know what some of the vars should be in the rules, if server could basically inject that info, my thinking it&apos;s easier than having to reason about than having to look-up the values by hand. These variables change infrequently. Maybe server could inject them not necessarily inline so at least easy to see in one place. Hope that makes sense."><a href="#t1555682347003500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-19</span> <span class="t" onclick="H(this)">13:59:07</span>                         Joel </span><span>The second part, probably thinking about the wrong way, but for parts of the rules that have variables, I&apos;d kind of like to see the rules served up with the variables replaced with actual values, so that it&apos;s easier to understand for user (developer).

Basically I&apos;ll be serving up the rules from a server, and the server will also know what some of the vars should be in the rules, if server could basically inject that info, my thinking it&apos;s easier than having to reason about than having to look-up the values by hand. These variables change infrequently. Maybe server could inject them not necessarily inline so at least easy to see in one place. Hope that makes sense.</span></div><div id="t1555945136009500" t="2019-04-22 14:58:56 mikerod @UH13Y2FSA The way to model what you are saying in the “second part” above, would be to make your variables expressed as facts instead."><a href="#t1555945136009500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-22</span> <span class="t" onclick="H(this)">14:58:56</span>                      mikerod </span><span>@UH13Y2FSA The way to model what you are saying in the “second part” above, would be to make your variables expressed as facts instead.</span></div><div id="t1555945165009700" t="2019-04-22 14:59:25 mikerod That’s the typical way it’d be done and the most straightforward with the way the forward-chaining data flow of the rules engine works."><a href="#t1555945165009700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-22</span> <span class="t" onclick="H(this)">14:59:25</span>                      mikerod </span><span>That’s the typical way it’d be done and the most straightforward with the way the forward-chaining data flow of the rules engine works.</span></div><div id="t1555945183009900" t="2019-04-22 14:59:43 mikerod &gt;  if server could basically inject that info
The “injection” would be to just insert these facts."><a href="#t1555945183009900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-22</span> <span class="t" onclick="H(this)">14:59:43</span>                      mikerod </span><span>&gt;  if server could basically inject that info
The “injection” would be to just insert these facts.</span></div><div id="t1555945224010100" t="2019-04-22 15:00:24 mikerod You base logic on them. If you need to derive things from them for other rules - derive “intermediate facts”, ie facts meant to just build up higher-level concepts to relay to other rules."><a href="#t1555945224010100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-22</span> <span class="t" onclick="H(this)">15:00:24</span>                      mikerod </span><span>You base logic on them. If you need to derive things from them for other rules - derive “intermediate facts”, ie facts meant to just build up higher-level concepts to relay to other rules.</span></div><div id="t1555945299010300" t="2019-04-22 15:01:39 mikerod Remember, the working memory “session” state is immutable. So if you don’t want to continually put in these infrequently changed facts, you could potentially create a session, insert these facts only, then use that as your base session for other later independent memory states with the more frequently changing facts."><a href="#t1555945299010300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-22</span> <span class="t" onclick="H(this)">15:01:39</span>                      mikerod </span><span>Remember, the working memory “session” state is immutable. So if you don’t want to continually put in these infrequently changed facts, you could potentially create a session, insert these facts only, then use that as your base session for other later independent memory states with the more frequently changing facts.</span></div><div id="t1556095934034100" t="2019-04-24 08:52:14 wparker This will work and is probably easiest, but if you really want to have the values be determined statically note that Clara can build sessions from rule data structures that you pass it; rules/queries don&apos;t have to be created with the defrule/defquery macros.  So you can have arbitrary generation logic.  You can look at the schemas namespace and the data under rule/query vars for examples.  It might be best to become familiar with code generation e.g. macros in Clojure if you go down this route though."><a href="#t1556095934034100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-24</span> <span class="t" onclick="H(this)">08:52:14</span>                      wparker </span><span>This will work and is probably easiest, but if you really want to have the values be determined statically note that Clara can build sessions from rule data structures that you pass it; rules/queries don&apos;t have to be created with the defrule/defquery macros.  So you can have arbitrary generation logic.  You can look at the schemas namespace and the data under rule/query vars for examples.  It might be best to become familiar with code generation e.g. macros in Clojure if you go down this route though.</span></div><div id="t1555904590005200" t="2019-04-22 03:43:10 Joel (dir clararules.core) will give me a list of the rules in that ns, but how can i tell rules from other items in the namespace?"><a href="#t1555904590005200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-22</span> <span class="t" onclick="H(this)">03:43:10</span>                    Joel </span><span>(dir clararules.core) will give me a list of the rules in that ns, but how can i tell rules from other items in the namespace?</span></div><div id="t1555910144005800" t="2019-04-22 05:15:44 Joel how do i see which rules are/were fired? I don&apos;t see an example."><a href="#t1555910144005800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-22</span> <span class="t" onclick="H(this)">05:15:44</span>                    Joel </span><span>how do i see which rules are/were fired? I don&apos;t see an example.</span></div><div id="t1555937205009000" t="2019-04-22 12:46:45 ethanc @joel380,
Im not sure if this is an implementation detail or not, but clara uses a protocol and metadata to determine productions in a given namespace.
 https://github.com/cerner/clara-rules/blob/0.19.1/src/main/clojure/clara/rules.cljc#L270-L305 

To your second question, i believe the way you would determine if rules have or have not fired would be to use the tracing listener.
 http://www.clara-rules.org/docs/listeners/ 
Either that or the end state of the session could be used via queries and facts returned from those queries."><a href="#t1555937205009000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-22</span> <span class="t" onclick="H(this)">12:46:45</span>                  ethanc </span><span>@joel380,
Im not sure if this is an implementation detail or not, but clara uses a protocol and metadata to determine productions in a given namespace.
</span><a href="https://github.com/cerner/clara-rules/blob/0.19.1/src/main/clojure/clara/rules.cljc#L270-L305" target="_blank">https://github.com/cerner/clara-rules/blob/0.19.1/src/main/clojure/clara/rules.cljc#L270-L305</a><span>

To your second question, i believe the way you would determine if rules have or have not fired would be to use the tracing listener.
</span><a href="http://www.clara-rules.org/docs/listeners/" target="_blank">http://www.clara-rules.org/docs/listeners/</a><span>
Either that or the end state of the session could be used via queries and facts returned from those queries.</span></div><div id="t1555994732011700" t="2019-04-23 04:45:32 Joel thanks... that second question. I was able to look at the session and see a fired rule, so that seems workable.

The link you sent looks good, it looks like it uses something called &quot;meta&quot; to determine (query or rule), but doesn&apos;t seem to work for me."><a href="#t1555994732011700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-23</span> <span class="t" onclick="H(this)">04:45:32</span>                    Joel </span><span>thanks... that second question. I was able to look at the session and see a fired rule, so that seems workable.

The link you sent looks good, it looks like it uses something called &quot;meta&quot; to determine (query or rule), but doesn&apos;t seem to work for me.</span></div><div id="t1555995046012400" t="2019-04-23 04:50:46 Joel actually no, this works: (meta (resolve &apos;has-email))"><a href="#t1555995046012400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-23</span> <span class="t" onclick="H(this)">04:50:46</span>                    Joel </span><span>actually no, this works: (meta (resolve &apos;has-email))</span></div><div id="t1555997521014600" t="2019-04-23 05:32:01 Joel @ethanc --- is there any examples around activation-group-fn. Maybe the documentation is good enough, but being a clojure newbie, I&apos;m really not understanding what that function should be receiving (a map that always represents rules only? or the metadata?) Also the it&apos;s sort sibling is fuzzy to me."><a href="#t1555997521014600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-23</span> <span class="t" onclick="H(this)">05:32:01</span>                    Joel </span><span>@ethanc --- is there any examples around activation-group-fn. Maybe the documentation is good enough, but being a clojure newbie, I&apos;m really not understanding what that function should be receiving (a map that always represents rules only? or the metadata?) Also the it&apos;s sort sibling is fuzzy to me.</span></div><div id="t1556023805019400" t="2019-04-23 12:50:05 ethanc @joel380,
This is a test demonstrating the usage of the  activation-group-fn :
 https://github.com/cerner/clara-rules/blob/0.19.1/src/test/clojurescript/clara/test_salience.cljs#L76-L99 

Please note that the manipulation of salience is typically reserved for tuning poor preforming rules. By poor performing, I mean rule scenarios where a pattern can be established where the execution order of rules will drastically impact the time that subsequent rules will take to execute and maintain truth."><a href="#t1556023805019400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-23</span> <span class="t" onclick="H(this)">12:50:05</span>                  ethanc </span><span>@joel380,
This is a test demonstrating the usage of the </span><code>activation-group-fn</code><span>:
</span><a href="https://github.com/cerner/clara-rules/blob/0.19.1/src/test/clojurescript/clara/test_salience.cljs#L76-L99" target="_blank">https://github.com/cerner/clara-rules/blob/0.19.1/src/test/clojurescript/clara/test_salience.cljs#L76-L99</a><span>

Please note that the manipulation of salience is typically reserved for tuning poor preforming rules. By poor performing, I mean rule scenarios where a pattern can be established where the execution order of rules will drastically impact the time that subsequent rules will take to execute and maintain truth.</span></div><div id="t1556071536019900" t="2019-04-24 02:05:36 Joel another good link, that makes it understandable."><a href="#t1556071536019900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-24</span> <span class="t" onclick="H(this)">02:05:36</span>                    Joel </span><span>another good link, that makes it understandable.</span></div><div id="t1556071753022100" t="2019-04-24 02:09:13 Joel it looks like a &quot;one-to-one&quot; port of existing drools rules is problematic. Drools has a way for you to veto a rule firing, it also can allow us to skip rule groups. It looks like the equivalent involves just ensuring proper behavior by writing appropriate when clauses. I do like how using a defrecord to predicate on is simple."><a href="#t1556071753022100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-24</span> <span class="t" onclick="H(this)">02:09:13</span>                    Joel </span><span>it looks like a &quot;one-to-one&quot; port of existing drools rules is problematic. Drools has a way for you to veto a rule firing, it also can allow us to skip rule groups. It looks like the equivalent involves just ensuring proper behavior by writing appropriate when clauses. I do like how using a defrecord to predicate on is simple.</span></div><div id="t1556073688023000" t="2019-04-24 02:41:28 Joel i suppose the &quot;clara way&quot; to control groups would be to modify the productions --- add predicate(s)"><a href="#t1556073688023000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-24</span> <span class="t" onclick="H(this)">02:41:28</span>                    Joel </span><span>i suppose the &quot;clara way&quot; to control groups would be to modify the productions --- add predicate(s)</span></div><div id="t1556080607024500" t="2019-04-24 04:36:47 Joel i&apos;m getting infinite loops:

(defrule has-email
  &quot;allow rule&quot;
  [User  (= &quot;&lt;mailto: /cdn-cgi/l/email-protection | /cdn-cgi/l/email-protection &gt;&quot; email)]
  [:not [Decision (contains? #{:allow} type)]]
  =&gt;
  (insert! (-&gt;Decision :allow))
  (println &quot;allowed&quot;))

(defrule has-email-deny
  &quot;deny if not allowed&quot;
  [:not [Decision (contains? #{:allow :deny} type)]]
  =&gt;
  (insert! (-&gt;Decision :deny))
  (println &quot;denied&quot;))

trying to make &quot;allow&quot; take precedence over &quot;deny&quot; decisions, but either my &quot;contains&quot; or universal non-existence seems to not be working."><a href="#t1556080607024500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-24</span> <span class="t" onclick="H(this)">04:36:47</span>                    Joel </span><span>i&apos;m getting infinite loops:

(defrule has-email
  &quot;allow rule&quot;
  [User  (= &quot;&lt;mailto:</span><a href="/cdn-cgi/l/email-protection" target="_blank">/cdn-cgi/l/email-protection</a><span>|</span><a href="/cdn-cgi/l/email-protection" target="_blank">/cdn-cgi/l/email-protection</a><span>&gt;&quot; email)]
  [:not [Decision (contains? #{:allow} type)]]
  =&gt;
  (insert! (-&gt;Decision :allow))
  (println &quot;allowed&quot;))

(defrule has-email-deny
  &quot;deny if not allowed&quot;
  [:not [Decision (contains? #{:allow :deny} type)]]
  =&gt;
  (insert! (-&gt;Decision :deny))
  (println &quot;denied&quot;))

trying to make &quot;allow&quot; take precedence over &quot;deny&quot; decisions, but either my &quot;contains&quot; or universal non-existence seems to not be working.</span></div><div id="t1556094824024600" t="2019-04-24 08:33:44 wparker @UH13Y2FSA Does your Decision record have a &quot;type&quot; field?  Perhaps you&apos;re running into  https://github.com/cerner/clara-rules/issues/259"><a href="#t1556094824024600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-24</span> <span class="t" onclick="H(this)">08:33:44</span>                      wparker </span><span>@UH13Y2FSA Does your Decision record have a &quot;type&quot; field?  Perhaps you&apos;re running into </span><a href="https://github.com/cerner/clara-rules/issues/259" target="_blank">https://github.com/cerner/clara-rules/issues/259</a></div><div id="t1556094885024900" t="2019-04-24 08:34:45 wparker If that is the problem you can fix it by using an explicit field lookup e.g. (:type this)"><a href="#t1556094885024900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-24</span> <span class="t" onclick="H(this)">08:34:45</span>                      wparker </span><span>If that is the problem you can fix it by using an explicit field lookup e.g. (:type this)</span></div><div id="t1556157083000300" t="2019-04-25 01:51:23 Joel (defrecord Decision [type])"><a href="#t1556157083000300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-25</span> <span class="t" onclick="H(this)">01:51:23</span>                         Joel </span><span>(defrecord Decision [type])</span></div><div id="t1556157488000500" t="2019-04-25 01:58:08 Joel I tried this format, didn&apos;t help:   [:not [Decision (contains? #{:allow} (:type this))]]"><a href="#t1556157488000500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-25</span> <span class="t" onclick="H(this)">01:58:08</span>                         Joel </span><span>I tried this format, didn&apos;t help:   [:not [Decision (contains? #{:allow} (:type this))]]</span></div><div id="t1556157540000700" t="2019-04-25 01:59:00 Joel kind of feel like i can&apos;t do &quot;non-existance&quot;"><a href="#t1556157540000700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-25</span> <span class="t" onclick="H(this)">01:59:00</span>                         Joel </span><span>kind of feel like i can&apos;t do &quot;non-existance&quot;</span></div><div id="t1556164889000900" t="2019-04-25 04:01:29 Joel i see examples of the same ... i don&apos;t get what I&apos;m doing wrong."><a href="#t1556164889000900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-25</span> <span class="t" onclick="H(this)">04:01:29</span>                         Joel </span><span>i see examples of the same ... i don&apos;t get what I&apos;m doing wrong.</span></div><div id="t1556165393001100" t="2019-04-25 04:09:53 Joel It actually works as expected if I add the fact when making the session."><a href="#t1556165393001100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-25</span> <span class="t" onclick="H(this)">04:09:53</span>                         Joel </span><span>It actually works as expected if I add the fact when making the session.</span></div><div id="t1556167519001300" t="2019-04-25 04:45:19 Joel changing salience fixes this!?"><a href="#t1556167519001300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-25</span> <span class="t" onclick="H(this)">04:45:19</span>                         Joel </span><span>changing salience fixes this!?</span></div><div id="t1556095442034000" t="2019-04-24 08:44:02 wparker Regarding looking at fired rules, the idiomatic way to get output from the session would usually be to have facts that represent that output and query on those facts.  The tracing listener will tell you what rules fired, but it will also include rules that were later retracted.  The API guarantees are generally around the final state of the session, not what rules are fired on the way there.  It&apos;s possible to design rules in a way that constrains this, but this has to be done carefully and wouldn&apos;t be my first approach to solving a given problem.   The tracing listener is primarily intended for debugging and performance problem diagnosis."><a href="#t1556095442034000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-24</span> <span class="t" onclick="H(this)">08:44:02</span>                 wparker </span><span>Regarding looking at fired rules, the idiomatic way to get output from the session would usually be to have facts that represent that output and query on those facts.  The tracing listener will tell you what rules fired, but it will also include rules that were later retracted.  The API guarantees are generally around the final state of the session, not what rules are fired on the way there.  It&apos;s possible to design rules in a way that constrains this, but this has to be done carefully and wouldn&apos;t be my first approach to solving a given problem.   The tracing listener is primarily intended for debugging and performance problem diagnosis.</span></div><div id="t1556214527000800" t="2019-04-25 17:48:47 Joel thanks @wparker. I opened clara ticket and that has been insightful as well."><a href="#t1556214527000800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-25</span> <span class="t" onclick="H(this)">17:48:47</span>                    Joel </span><span>thanks @wparker. I opened clara ticket and that has been insightful as well.</span></div><div id="t1556252479001100" t="2019-04-26 04:21:19 Joel is it possible to refer to the doc string on the RHS?"><a href="#t1556252479001100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-26</span> <span class="t" onclick="H(this)">04:21:19</span>                    Joel </span><span>is it possible to refer to the doc string on the RHS?</span></div><div id="t1556283284002300" t="2019-04-26 12:54:44 mikerod That seems odd. Maybe with a defrule style macro you could refer to its own self var and find the doc string on there somehow. "><a href="#t1556283284002300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-26</span> <span class="t" onclick="H(this)">12:54:44</span>                 mikerod </span><span>That seems odd. Maybe with a defrule style macro you could refer to its own self var and find the doc string on there somehow. </span></div><div id="t1556283314002900" t="2019-04-26 12:55:14 mikerod Would have to test that theory out though. Can’t at the moment. "><a href="#t1556283314002900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-26</span> <span class="t" onclick="H(this)">12:55:14</span>                 mikerod </span><span>Would have to test that theory out though. Can’t at the moment. </span></div><div id="t1556283754004200" t="2019-04-26 13:02:34 ethanc Since clara allows arbitrary clojure in the rhs, most things are possible. It just seems a bit weird to do them:
 (defrule a-rule
  &quot;hello&quot;
  [A (&gt; x 3)]
  =&gt;
  (println (:doc (meta #&apos;a-rule))))

(-&gt; (mk-session)
    (insert (-&gt;A 4))
    fire-rules)
hello
"><a href="#t1556283754004200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-26</span> <span class="t" onclick="H(this)">13:02:34</span>                  ethanc </span><span>Since clara allows arbitrary clojure in the rhs, most things are possible. It just seems a bit weird to do them:
</span><pre>(defrule a-rule
  &quot;hello&quot;
  [A (&gt; x 3)]
  =&gt;
  (println (:doc (meta #&apos;a-rule))))

(-&gt; (mk-session)
    (insert (-&gt;A 4))
    fire-rules)
hello
</pre></div><div id="t1556319726004500" t="2019-04-26 23:02:06 Joel sweet."><a href="#t1556319726004500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-26</span> <span class="t" onclick="H(this)">23:02:06</span>                    Joel </span><span>sweet.</span></div><div id="t1556319841005100" t="2019-04-26 23:04:01 Joel well, i dunno like you say a bit weird, but at least possible."><a href="#t1556319841005100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-26</span> <span class="t" onclick="H(this)">23:04:01</span>                    Joel </span><span>well, i dunno like you say a bit weird, but at least possible.</span></div><div id="t1556320523006200" t="2019-04-26 23:15:23 Joel @ethanc --- commented on ticket #428 - curious if retract rules from :rule-matches reasonably possible."><a href="#t1556320523006200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-26</span> <span class="t" onclick="H(this)">23:15:23</span>                    Joel </span><span>@ethanc --- commented on ticket #428 - curious if retract rules from :rule-matches reasonably possible.</span></div><div id="t1556337895008100" t="2019-04-27 04:04:55 Joel I want to have multiple rule systems, each would have it&apos;s own namespace, but I&apos;d like to share not only records, but defquerys as well. However, I&apos;m not figuring out how to add the defquery from another namespace."><a href="#t1556337895008100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-27</span> <span class="t" onclick="H(this)">04:04:55</span>                    Joel </span><span>I want to have multiple rule systems, each would have it&apos;s own namespace, but I&apos;d like to share not only records, but defquerys as well. However, I&apos;m not figuring out how to add the defquery from another namespace.</span></div><div id="t1556384906008200" t="2019-04-27 17:08:26 mikerod @joel380 you can pass ns names, or a collection of rule/query structures to mk -session"><a href="#t1556384906008200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-27</span> <span class="t" onclick="H(this)">17:08:26</span>                 mikerod </span><span>@joel380 you can pass ns names, or a collection of rule/query structures to mk -session</span></div><div id="t1556384910008300" t="2019-04-27 17:08:30 mikerod So if you did defquery, you’d just do:
 (mk-session [my-query])
"><a href="#t1556384910008300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-27</span> <span class="t" onclick="H(this)">17:08:30</span>                 mikerod </span><span>So if you did defquery, you’d just do:
</span><pre>(mk-session [my-query])
</pre></div><div id="t1556384914008400" t="2019-04-27 17:08:34 mikerod There is more you can do too if you mark a var metadata with :production-seq  that allows you to store sequences of rule/query structures under a single var when a ns is searched for rules/queries. "><a href="#t1556384914008400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-27</span> <span class="t" onclick="H(this)">17:08:34</span>                 mikerod </span><span>There is more you can do too if you mark a var metadata with :production-seq  that allows you to store sequences of rule/query structures under a single var when a ns is searched for rules/queries. </span></div><div id="t1556406884009300" t="2019-04-27 23:14:44 Joel thanks, i had tried (mk-session &apos;(my-query)) ... still getting up to speed on clojure"><a href="#t1556406884009300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-27</span> <span class="t" onclick="H(this)">23:14:44</span>                    Joel </span><span>thanks, i had tried (mk-session &apos;(my-query)) ... still getting up to speed on clojure</span></div><div id="t1556407127009700" t="2019-04-27 23:18:47 Joel hopefully that let&apos;s me use another ns as well. ill give it a go."><a href="#t1556407127009700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-27</span> <span class="t" onclick="H(this)">23:18:47</span>                    Joel </span><span>hopefully that let&apos;s me use another ns as well. ill give it a go.</span></div><div id="t1556445220013000" t="2019-04-28 09:53:40 wparker Yes, you can use an arbitrary mix of namespaces and sequences of explicitly included rules/queries when defining your session."><a href="#t1556445220013000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-28</span> <span class="t" onclick="H(this)">09:53:40</span>                      wparker </span><span>Yes, you can use an arbitrary mix of namespaces and sequences of explicitly included rules/queries when defining your session.</span></div><div id="t1556410216010100" t="2019-04-28 00:10:16 mikerod Use a vector and no quoting needed"><a href="#t1556410216010100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-28</span> <span class="t" onclick="H(this)">00:10:16</span>                 mikerod </span><span>Use a vector and no quoting needed</span></div><div id="t1556423821011900" t="2019-04-28 03:57:01 Joel How is anyone going about getting the reasons for the rule decisions? Or, as often done in other systems, use the rule name, in Clara case the :doc tag.

The problem I see is when I do (inspect session) the :rule-matches matches rules that never fired."><a href="#t1556423821011900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-28</span> <span class="t" onclick="H(this)">03:57:01</span>                    Joel </span><span>How is anyone going about getting the reasons for the rule decisions? Or, as often done in other systems, use the rule name, in Clara case the :doc tag.

The problem I see is when I do (inspect session) the :rule-matches matches rules that never fired.</span></div><div id="t1556425156012800" t="2019-04-28 04:19:16 Joel Actually it looks like the rules have a () &quot;matches&quot; section, that I need to check... Unclear how I should be parsing that. Is there any convenience fn&apos;s?"><a href="#t1556425156012800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-28</span> <span class="t" onclick="H(this)">04:19:16</span>                    Joel </span><span>Actually it looks like the rules have a () &quot;matches&quot; section, that I need to check... Unclear how I should be parsing that. Is there any convenience fn&apos;s?</span></div><div id="t1556445273013200" t="2019-04-28 09:54:33 wparker I&apos;m not sure what you&apos;re trying to do, could you elaborate?"><a href="#t1556445273013200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-28</span> <span class="t" onclick="H(this)">09:54:33</span>                      wparker </span><span>I&apos;m not sure what you&apos;re trying to do, could you elaborate?</span></div><div id="t1556472716013400" t="2019-04-28 17:31:56 Joel I was trying to strip out the rule :docs that had matches. It wasn&apos;t clear to me that there were rules listed that weren&apos;t fired. This did the trick:

(defn matched-rule-docs [session]
  (let [rule-match-map (:rule-matches (inspect session))
        matched-rules (filter #(seq (get rule-match-map %)) (keys rule-match-map))]
    (map :doc matched-rules)))"><a href="#t1556472716013400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-28</span> <span class="t" onclick="H(this)">17:31:56</span>                         Joel </span><span>I was trying to strip out the rule :docs that had matches. It wasn&apos;t clear to me that there were rules listed that weren&apos;t fired. This did the trick:

(defn matched-rule-docs [session]
  (let [rule-match-map (:rule-matches (inspect session))
        matched-rules (filter #(seq (get rule-match-map %)) (keys rule-match-map))]
    (map :doc matched-rules)))</span></div><div id="t1556477824014100" t="2019-04-28 18:57:04 Joel Can this be done w/o using :test?:
&apos;&apos;&apos;
  [?registry &lt;- ListRegistry]
  [:test (.isMember ?registry &quot;userguidwl&quot; &quot;whitelist&quot; &quot;userguid&quot;)]
&apos;&apos;&apos;"><a href="#t1556477824014100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-28</span> <span class="t" onclick="H(this)">18:57:04</span>                    Joel </span><span>Can this be done w/o using :test?:
&apos;&apos;&apos;
  [?registry &lt;- ListRegistry]
  [:test (.isMember ?registry &quot;userguidwl&quot; &quot;whitelist&quot; &quot;userguid&quot;)]
&apos;&apos;&apos;</span></div><div id="t1556477886014900" t="2019-04-28 18:58:06 Joel (java class)"><a href="#t1556477886014900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-28</span> <span class="t" onclick="H(this)">18:58:06</span>                    Joel </span><span>(java class)</span></div><div id="t1556477991016600" t="2019-04-28 18:59:51 ethanc Use the  this  symbol in place of ?registry, If I read your question correctly"><a href="#t1556477991016600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-28</span> <span class="t" onclick="H(this)">18:59:51</span>                  ethanc </span><span>Use the </span><code>this</code><span> symbol in place of ?registry, If I read your question correctly</span></div><div id="t1556478345016900" t="2019-04-28 19:05:45 Joel you probably do read it correctly, ill try that."><a href="#t1556478345016900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-28</span> <span class="t" onclick="H(this)">19:05:45</span>                    Joel </span><span>you probably do read it correctly, ill try that.</span></div><div id="t1556501246018900" t="2019-04-29 01:27:26 mikerod [?registry &lt;- ListRegistry (.isMember this &lt;..etc..&gt;)]
"><a href="#t1556501246018900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-29</span> <span class="t" onclick="H(this)">01:27:26</span>                 mikerod </span><pre>[?registry &lt;- ListRegistry (.isMember this &lt;..etc..&gt;)]
</pre></div><div id="t1556583734021300" t="2019-04-30 00:22:14 Joel How can I apply the working memory from one session to another? Or fire one group of rules, and then apply it&apos;s WM to another set of rules?"><a href="#t1556583734021300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-30</span> <span class="t" onclick="H(this)">00:22:14</span>                    Joel </span><span>How can I apply the working memory from one session to another? Or fire one group of rules, and then apply it&apos;s WM to another set of rules?</span></div><div id="t1556588032022900" t="2019-04-30 01:33:52 mikerod @joel380 if needing to go from one group or rules to another, you could just make query for the facts you want out of the first group, then insert those query results into the next group. "><a href="#t1556588032022900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-30</span> <span class="t" onclick="H(this)">01:33:52</span>                 mikerod </span><span>@joel380 if needing to go from one group or rules to another, you could just make query for the facts you want out of the first group, then insert those query results into the next group. </span></div><div id="t1556588631024300" t="2019-04-30 01:43:51 Joel i&apos;d want all of them, would rather avoid queries for each type."><a href="#t1556588631024300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-30</span> <span class="t" onclick="H(this)">01:43:51</span>                    Joel </span><span>i&apos;d want all of them, would rather avoid queries for each type.</span></div><div id="t1556588697024600" t="2019-04-30 01:44:57 Joel I didn&apos;t see them listed as part of the session."><a href="#t1556588697024600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-30</span> <span class="t" onclick="H(this)">01:44:57</span>                    Joel </span><span>I didn&apos;t see them listed as part of the session.</span></div><div id="t1556630853026800" t="2019-04-30 13:27:33 mikerod Yeah a query for all types is typically rough on performance. "><a href="#t1556630853026800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-30</span> <span class="t" onclick="H(this)">13:27:33</span>                 mikerod </span><span>Yeah a query for all types is typically rough on performance. </span></div><div id="t1556630923028600" t="2019-04-30 13:28:43 mikerod For all facts in working memory I don’t think there is a direct hook. I think maybe @ethanc would remember how we did “all facts” before. "><a href="#t1556630923028600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-30</span> <span class="t" onclick="H(this)">13:28:43</span>                 mikerod </span><span>For all facts in working memory I don’t think there is a direct hook. I think maybe @ethanc would remember how we did “all facts” before. </span></div><div id="t1556630984030500" t="2019-04-30 13:29:44 mikerod Also, keep in mind that the engine won’t hold onto facts that it knows will never match. So for example, if you insert a fact A but no rule will ever be able to match it, it doesn’t stay in working memory. So you wouldn’t get it back with some “all facts” request. "><a href="#t1556630984030500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-30</span> <span class="t" onclick="H(this)">13:29:44</span>                 mikerod </span><span>Also, keep in mind that the engine won’t hold onto facts that it knows will never match. So for example, if you insert a fact A but no rule will ever be able to match it, it doesn’t stay in working memory. So you wouldn’t get it back with some “all facts” request. </span></div><div id="t1556632819033900" t="2019-04-30 14:00:19 ethanc @joel380,
Perhaps creating a marker protocol for the types of facts that you are interested in, and then leveraging a single query on that protocol. Something like:
 (require &apos;[clara.rules :refer :all])
(require &apos;[clara.rules.accumulators :as acc])

(defprotocol ImportantFacts)

(defrecord A [x])
(defrecord B [y])

(defrecord C [z]
  ImportantFacts)

(defrecord D [a]
  ImportantFacts)

(defrecord E [b]
  ImportantFacts)


(defrule a-rule 
  [A (= ?x x)]
  =&gt;
  (insert! (-&gt;C (+ ?x 10))))


(defrule b-rule
  [B (= ?y y)]
  =&gt;
  (insert! (-&gt;D (+ ?y 50))))

(defrule ab-rule
  [A (= ?x x)]
  [B (= ?y y)]
  =&gt;
  (insert! (-&gt;E (+ ?y ?x))))

(defquery important-query
  []
  [?all-important &lt;- (acc/all) :from [user.ImportantFacts]])


(-&gt; (mk-session)
    (insert (-&gt;A 12))
    (insert (-&gt;B 1))
    fire-rules
    (query important-query))
 

There is something goofy about the  clara.rules.dsl  namespace, with respect to how it resolves “types”, specifically protocols so i had to fully qualify the ImportantFacts symbol."><a href="#t1556632819033900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-30</span> <span class="t" onclick="H(this)">14:00:19</span>                  ethanc </span><span>@joel380,
Perhaps creating a marker protocol for the types of facts that you are interested in, and then leveraging a single query on that protocol. Something like:
</span><pre>(require &apos;[clara.rules :refer :all])
(require &apos;[clara.rules.accumulators :as acc])

(defprotocol ImportantFacts)

(defrecord A [x])
(defrecord B [y])

(defrecord C [z]
  ImportantFacts)

(defrecord D [a]
  ImportantFacts)

(defrecord E [b]
  ImportantFacts)


(defrule a-rule 
  [A (= ?x x)]
  =&gt;
  (insert! (-&gt;C (+ ?x 10))))


(defrule b-rule
  [B (= ?y y)]
  =&gt;
  (insert! (-&gt;D (+ ?y 50))))

(defrule ab-rule
  [A (= ?x x)]
  [B (= ?y y)]
  =&gt;
  (insert! (-&gt;E (+ ?y ?x))))

(defquery important-query
  []
  [?all-important &lt;- (acc/all) :from [user.ImportantFacts]])


(-&gt; (mk-session)
    (insert (-&gt;A 12))
    (insert (-&gt;B 1))
    fire-rules
    (query important-query))
</pre><span>

There is something goofy about the </span><code>clara.rules.dsl</code><span> namespace, with respect to how it resolves “types”, specifically protocols so i had to fully qualify the ImportantFacts symbol.</span></div><div id="t1556633367034100" t="2019-04-30 14:09:27 ethanc =&gt; ({:?all-important [#user.C{:z 22} #user.D{:a 51} #user.E{:b 13}]})
"><a href="#t1556633367034100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-30</span> <span class="t" onclick="H(this)">14:09:27</span>                  ethanc </span><pre>=&gt; ({:?all-important [#user.C{:z 22} #user.D{:a 51} #user.E{:b 13}]})
</pre></div><div id="t1556636589036500" t="2019-04-30 15:03:09 mikerod @joel380 @ethanc discussed on the side w/Ethan, but the  defprotocol  pattern for type hierarchies is sort of pedantically “wrong” I’d say. I think the host-type associated w/a  defprotocol  is meant to be more of an “impl details” (although it isn’t going to change), that is concerned with performance optimizations. So I’d probably go w/  definterface  when all you want is the type marker. That said, Clara has supported  defprotocol  types being used in rules when the symbol is in reference to the the class type, not the protocol metadata var. Ethan is likely going to log a Clara issues concerning the 2nd case and how this can get weird."><a href="#t1556636589036500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-04-30</span> <span class="t" onclick="H(this)">15:03:09</span>                 mikerod </span><span>@joel380 @ethanc discussed on the side w/Ethan, but the </span><code>defprotocol</code><span> pattern for type hierarchies is sort of pedantically “wrong” I’d say. I think the host-type associated w/a </span><code>defprotocol</code><span> is meant to be more of an “impl details” (although it isn’t going to change), that is concerned with performance optimizations. So I’d probably go w/ </span><code>definterface</code><span> when all you want is the type marker. That said, Clara has supported </span><code>defprotocol</code><span> types being used in rules when the symbol is in reference to the the class type, not the protocol metadata var. Ethan is likely going to log a Clara issues concerning the 2nd case and how this can get weird.</span></div><div id="t1556673208042200" t="2019-05-01 01:13:28 Joel I appreciate all the help here so far! FWIW, I&apos;m looking into something that might work better than Drools for us. On that side we currently leverage rule-groups, and the order of groups is controlled. I think we can probably break away from that pattern, but just in case, the reason for my question is to see if that behavior could be had as a &quot;fallback&quot; in Clara. I think though if facts get &quot;kicked out&quot; of WM, then managing that could be kind of ugly.

It sounds like the &quot;one true way&quot; in Clara is to put guards in as appropriate, and that&apos;s the approach I&apos;ll take for now rather than trying skip rule-groups or some such by segregating the rules."><a href="#t1556673208042200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-05-01</span> <span class="t" onclick="H(this)">01:13:28</span>                    Joel </span><span>I appreciate all the help here so far! FWIW, I&apos;m looking into something that might work better than Drools for us. On that side we currently leverage rule-groups, and the order of groups is controlled. I think we can probably break away from that pattern, but just in case, the reason for my question is to see if that behavior could be had as a &quot;fallback&quot; in Clara. I think though if facts get &quot;kicked out&quot; of WM, then managing that could be kind of ugly.

It sounds like the &quot;one true way&quot; in Clara is to put guards in as appropriate, and that&apos;s the approach I&apos;ll take for now rather than trying skip rule-groups or some such by segregating the rules.</span></div><div id="t1556673287043200" t="2019-05-01 01:14:47 Joel I&apos;m curious if anyone changes their rules dynamically in a production environment, and any issues that may come up as a result."><a href="#t1556673287043200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-05-01</span> <span class="t" onclick="H(this)">01:14:47</span>                    Joel </span><span>I&apos;m curious if anyone changes their rules dynamically in a production environment, and any issues that may come up as a result.</span></div><div id="t1556721378044600" t="2019-05-01 14:36:18 mikerod @joel380 Clara does have support for activation group like behavior. But it doesn’t completely disable rules. It prioritizes a firing order. It’s much like salience, but on a group of rule level. And salience works within a group. "><a href="#t1556721378044600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-05-01</span> <span class="t" onclick="H(this)">14:36:18</span>                 mikerod </span><span>@joel380 Clara does have support for activation group like behavior. But it doesn’t completely disable rules. It prioritizes a firing order. It’s much like salience, but on a group of rule level. And salience works within a group. </span></div><div id="t1556721419046000" t="2019-05-01 14:36:59 mikerod I just tend to think you can write more robust rules when you don’t write them in order dependent ways. Clara defaults to logical inserts that self-maintain the logical consistency to eliminate a large need for ordering. "><a href="#t1556721419046000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-05-01</span> <span class="t" onclick="H(this)">14:36:59</span>                 mikerod </span><span>I just tend to think you can write more robust rules when you don’t write them in order dependent ways. Clara defaults to logical inserts that self-maintain the logical consistency to eliminate a large need for ordering. </span></div><div id="t1556721449047000" t="2019-05-01 14:37:29 mikerod Drools provides a truth maintenance system too, but it isn’t the default in drools to insert “logical”, you have to call a separate fn for that in Drools. "><a href="#t1556721449047000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-05-01</span> <span class="t" onclick="H(this)">14:37:29</span>                 mikerod </span><span>Drools provides a truth maintenance system too, but it isn’t the default in drools to insert “logical”, you have to call a separate fn for that in Drools. </span></div><div id="t1556721456047300" t="2019-05-01 14:37:36 mikerod In Clara the reverse is true. "><a href="#t1556721456047300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-05-01</span> <span class="t" onclick="H(this)">14:37:36</span>                 mikerod </span><span>In Clara the reverse is true. </span></div><div id="t1556721473047800" t="2019-05-01 14:37:53 mikerod Part 2: what do you mean changing rules dynamically in production? "><a href="#t1556721473047800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-05-01</span> <span class="t" onclick="H(this)">14:37:53</span>                 mikerod </span><span>Part 2: what do you mean changing rules dynamically in production? </span></div><div id="t1556721519049200" t="2019-05-01 14:38:39 mikerod You’d have to create a new session+rulebase for new rules. Clara doesn’t support dynamic addition and removal of rules in an already constructed network. "><a href="#t1556721519049200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-05-01</span> <span class="t" onclick="H(this)">14:38:39</span>                 mikerod </span><span>You’d have to create a new session+rulebase for new rules. Clara doesn’t support dynamic addition and removal of rules in an already constructed network. </span></div><div id="t1556721554050400" t="2019-05-01 14:39:14 mikerod Drools does. And the semantics are to distribute working memory state to the new rules as they are added I believe. Clara has some mice optimization properties due to it not allowing this. "><a href="#t1556721554050400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-05-01</span> <span class="t" onclick="H(this)">14:39:14</span>                 mikerod </span><span>Drools does. And the semantics are to distribute working memory state to the new rules as they are added I believe. Clara has some mice optimization properties due to it not allowing this. </span></div><div id="t1556721634052800" t="2019-05-01 14:40:34 mikerod It’s possible it could be a future “mode” supported, but that’s require someone quite motivated to do it. I tend to think you can often just make a new session and re-run from scratch, or only put new rules in separate session and propagate facts from one to the next as needed. Cases vary though. "><a href="#t1556721634052800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-05-01</span> <span class="t" onclick="H(this)">14:40:34</span>                 mikerod </span><span>It’s possible it could be a future “mode” supported, but that’s require someone quite motivated to do it. I tend to think you can often just make a new session and re-run from scratch, or only put new rules in separate session and propagate facts from one to the next as needed. Cases vary though. </span></div><div id="t1556766374053900" t="2019-05-02 03:06:14 Joel dynamic loading --- i mean doing load-string on a clojure file containing the rules/defsession, at runtime as rules are occasionally dynamically updated."><a href="#t1556766374053900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-05-02</span> <span class="t" onclick="H(this)">03:06:14</span>                    Joel </span><span>dynamic loading --- i mean doing load-string on a clojure file containing the rules/defsession, at runtime as rules are occasionally dynamically updated.</span></div><div id="t1556766610055500" t="2019-05-02 03:10:10 Joel in drools we short-circuit to the last group if a previous group makes a decision basically. I think for Clara we just put guards in all the following rules."><a href="#t1556766610055500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-05-02</span> <span class="t" onclick="H(this)">03:10:10</span>                    Joel </span><span>in drools we short-circuit to the last group if a previous group makes a decision basically. I think for Clara we just put guards in all the following rules.</span></div><div id="t1556893289056700" t="2019-05-03 14:21:29 Joel Couple of questions
1) I see there is no &quot;update!&quot; --- is retract! followed by insert! considered non-idiomatic?"><a href="#t1556893289056700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-05-03</span> <span class="t" onclick="H(this)">14:21:29</span>                    Joel </span><span>Couple of questions
1) I see there is no &quot;update!&quot; --- is retract! followed by insert! considered non-idiomatic?</span></div><div id="t1556894259066800" t="2019-05-03 14:37:39 eraserhd In general, updating a fact would make truth maintenance really hard, if not impossible.  If you find yourself retracting and inserting a fact on a right-hand-side, you are probably also going to run afoul of truth maintenance, likely by creating an infinite loop."><a href="#t1556894259066800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-05-03</span> <span class="t" onclick="H(this)">14:37:39</span>                eraserhd </span><span>In general, updating a fact would make truth maintenance really hard, if not impossible.  If you find yourself retracting and inserting a fact on a right-hand-side, you are probably also going to run afoul of truth maintenance, likely by creating an infinite loop.</span></div><div id="t1556894306067700" t="2019-05-03 14:38:26 eraserhd Logically, if a fact is no longer true because of a new piece of data, you should have an additional condition on the left-hand-side of the original rule."><a href="#t1556894306067700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-05-03</span> <span class="t" onclick="H(this)">14:38:26</span>                eraserhd </span><span>Logically, if a fact is no longer true because of a new piece of data, you should have an additional condition on the left-hand-side of the original rule.</span></div><div id="t1556894331068300" t="2019-05-03 14:38:51 eraserhd Which allows truth maintenance to clear it up."><a href="#t1556894331068300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-05-03</span> <span class="t" onclick="H(this)">14:38:51</span>                eraserhd </span><span>Which allows truth maintenance to clear it up.</span></div><div id="t1556894345068800" t="2019-05-03 14:39:05 Joel 2) I have a case where I take measurements of events
    something like {&quot;eventX&quot; [ (:limit 5 :prior (5 hrs)) (:limit 10 :prior (1 day)) ]}
    also I need to +1 those measures if they just now happened based on rule. (I don&apos;t have a list of events over that time, just the prior totals)

I&apos;m guessing the short answer is I need to &quot;normalize the list&quot; into individual facts and leverage insert-all! as well as use an accumulator (prior total + 1?), but then I need to accumulate and match against the limit, and how to do this with a flexible list is the part I&apos;m not currently seeing. Particularly totaling over each period to compare against limit."><a href="#t1556894345068800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-05-03</span> <span class="t" onclick="H(this)">14:39:05</span>                    Joel </span><span>2) I have a case where I take measurements of events
    something like {&quot;eventX&quot; [ (:limit 5 :prior (5 hrs)) (:limit 10 :prior (1 day)) ]}
    also I need to +1 those measures if they just now happened based on rule. (I don&apos;t have a list of events over that time, just the prior totals)

I&apos;m guessing the short answer is I need to &quot;normalize the list&quot; into individual facts and leverage insert-all! as well as use an accumulator (prior total + 1?), but then I need to accumulate and match against the limit, and how to do this with a flexible list is the part I&apos;m not currently seeing. Particularly totaling over each period to compare against limit.</span></div><div id="t1556894613069400" t="2019-05-03 14:43:33 eraserhd I would absolutely break down the measurements into independent facts."><a href="#t1556894613069400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-05-03</span> <span class="t" onclick="H(this)">14:43:33</span>                eraserhd </span><span>I would absolutely break down the measurements into independent facts.</span></div><div id="t1556894697071300" t="2019-05-03 14:44:57 eraserhd I&apos;m not sure how you are saying :prior works.  Do you want a rule to fire a rule if you get an event more than :limit in the last :prior?"><a href="#t1556894697071300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-05-03</span> <span class="t" onclick="H(this)">14:44:57</span>                eraserhd </span><span>I&apos;m not sure how you are saying :prior works.  Do you want a rule to fire a rule if you get an event more than :limit in the last :prior?</span></div><div id="t1556894751072500" t="2019-05-03 14:45:51 Joel so there&apos;s the existing count (from DB)
if that count + (just now happened) &gt; limit    fire rule."><a href="#t1556894751072500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-05-03</span> <span class="t" onclick="H(this)">14:45:51</span>                    Joel </span><span>so there&apos;s the existing count (from DB)
if that count + (just now happened) &gt; limit    fire rule.</span></div><div id="t1556894838073600" t="2019-05-03 14:47:18 eraserhd You&apos;ve inserted multiple facts that has the database count of events of a particular type?"><a href="#t1556894838073600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-05-03</span> <span class="t" onclick="H(this)">14:47:18</span>                eraserhd </span><span>You&apos;ve inserted multiple facts that has the database count of events of a particular type?</span></div><div id="t1556894913074900" t="2019-05-03 14:48:33 Joel i can do that... currently the logic is the LHS side fetches the info (uses cache)"><a href="#t1556894913074900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-05-03</span> <span class="t" onclick="H(this)">14:48:33</span>                    Joel </span><span>i can do that... currently the logic is the LHS side fetches the info (uses cache)</span></div><div id="t1556894921075100" t="2019-05-03 14:48:41 Joel (java call)"><a href="#t1556894921075100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-05-03</span> <span class="t" onclick="H(this)">14:48:41</span>                    Joel </span><span>(java call)</span></div><div id="t1556894950075700" t="2019-05-03 14:49:10 Joel the final piece is maybe something like
[ EventCount (?name name)(?limit limit)(?period period) (&gt;= ?limit ( accumulate total for ?period ?name))    ; pseudocode"><a href="#t1556894950075700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-05-03</span> <span class="t" onclick="H(this)">14:49:10</span>                    Joel </span><span>the final piece is maybe something like
[ EventCount (?name name)(?limit limit)(?period period) (&gt;= ?limit ( accumulate total for ?period ?name))    ; pseudocode</span></div><div id="t1556895008076600" t="2019-05-03 14:50:08 Joel but then accumulating will be redundant."><a href="#t1556895008076600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-05-03</span> <span class="t" onclick="H(this)">14:50:08</span>                    Joel </span><span>but then accumulating will be redundant.</span></div><div id="t1556895033077200" t="2019-05-03 14:50:33 eraserhd Assuming you aren&apos;t using an immutable, global database, you will likely have trouble with consistency if you put database calls on the left-hand-side."><a href="#t1556895033077200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-05-03</span> <span class="t" onclick="H(this)">14:50:33</span>                eraserhd </span><span>Assuming you aren&apos;t using an immutable, global database, you will likely have trouble with consistency if you put database calls on the left-hand-side.</span></div><div id="t1556895101078500" t="2019-05-03 14:51:41 Joel (the cache fixes that part, only refetches for another session)"><a href="#t1556895101078500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-05-03</span> <span class="t" onclick="H(this)">14:51:41</span>                    Joel </span><span>(the cache fixes that part, only refetches for another session)</span></div><div id="t1556895136079200" t="2019-05-03 14:52:16 Joel but that doesn&apos;t give me a flexible list of periods"><a href="#t1556895136079200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-05-03</span> <span class="t" onclick="H(this)">14:52:16</span>                    Joel </span><span>but that doesn&apos;t give me a flexible list of periods</span></div><div id="t1556895148079500" t="2019-05-03 14:52:28 eraserhd You have access to the session on the left-hand-side?"><a href="#t1556895148079500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-05-03</span> <span class="t" onclick="H(this)">14:52:28</span>                eraserhd </span><span>You have access to the session on the left-hand-side?</span></div><div id="t1556895156079700" t="2019-05-03 14:52:36 eraserhd (in a rule at all, in fact?)"><a href="#t1556895156079700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-05-03</span> <span class="t" onclick="H(this)">14:52:36</span>                eraserhd </span><span>(in a rule at all, in fact?)</span></div><div id="t1556895168080000" t="2019-05-03 14:52:48 Joel no... its a java bean inserted into WM"><a href="#t1556895168080000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-05-03</span> <span class="t" onclick="H(this)">14:52:48</span>                    Joel </span><span>no... its a java bean inserted into WM</span></div><div id="t1556895189080400" t="2019-05-03 14:53:09 eraserhd what&apos;s a WM?"><a href="#t1556895189080400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-05-03</span> <span class="t" onclick="H(this)">14:53:09</span>                eraserhd </span><span>what&apos;s a WM?</span></div><div id="t1556895204080800" t="2019-05-03 14:53:24 Joel but a new one for each ... sorry firing. (working memory : clara currently drools  🙂   )"><a href="#t1556895204080800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-05-03</span> <span class="t" onclick="H(this)">14:53:24</span>                    Joel </span><span>but a new one for each ... sorry firing. (working memory : clara currently drools </span><b>🙂</b><span>  )</span></div><div id="t1556895240081400" t="2019-05-03 14:54:00 Joel basically the bean is inserted before fire rules."><a href="#t1556895240081400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-05-03</span> <span class="t" onclick="H(this)">14:54:00</span>                    Joel </span><span>basically the bean is inserted before fire rules.</span></div><div id="t1556895247081600" t="2019-05-03 14:54:07 eraserhd ah, right.   But this will have the consistency issue I&apos;m talking about.  If the count changes in the database, it will not refire a rule."><a href="#t1556895247081600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-05-03</span> <span class="t" onclick="H(this)">14:54:07</span>                eraserhd </span><span>ah, right.   But this will have the consistency issue I&apos;m talking about.  If the count changes in the database, it will not refire a rule.</span></div><div id="t1556895256081800" t="2019-05-03 14:54:16 Joel not an issue."><a href="#t1556895256081800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-05-03</span> <span class="t" onclick="H(this)">14:54:16</span>                    Joel </span><span>not an issue.</span></div><div id="t1556895270082400" t="2019-05-03 14:54:30 Joel it caches the call and keeps it for rest of that firing."><a href="#t1556895270082400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-05-03</span> <span class="t" onclick="H(this)">14:54:30</span>                    Joel </span><span>it caches the call and keeps it for rest of that firing.</span></div><div id="t1556895280082700" t="2019-05-03 14:54:40 Joel and that&apos;s acceptable."><a href="#t1556895280082700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-05-03</span> <span class="t" onclick="H(this)">14:54:40</span>                    Joel </span><span>and that&apos;s acceptable.</span></div><div id="t1556895285082900" t="2019-05-03 14:54:45 eraserhd Ahhh, I see."><a href="#t1556895285082900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-05-03</span> <span class="t" onclick="H(this)">14:54:45</span>                eraserhd </span><span>Ahhh, I see.</span></div><div id="t1556895305083300" t="2019-05-03 14:55:05 eraserhd It presents an immutable snapshot to the session.  That&apos;s kind of neat."><a href="#t1556895305083300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-05-03</span> <span class="t" onclick="H(this)">14:55:05</span>                eraserhd </span><span>It presents an immutable snapshot to the session.  That&apos;s kind of neat.</span></div><div id="t1556895344084000" t="2019-05-03 14:55:44 Joel but currently we write rules and add to them if we add more periods, that sort of thing... rather have the list of periods flexible and rules take care of."><a href="#t1556895344084000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-05-03</span> <span class="t" onclick="H(this)">14:55:44</span>                    Joel </span><span>but currently we write rules and add to them if we add more periods, that sort of thing... rather have the list of periods flexible and rules take care of.</span></div><div id="t1556895391084900" t="2019-05-03 14:56:31 Joel I think I need two defrecords one for name/period combo and another for keeping the count?"><a href="#t1556895391084900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-05-03</span> <span class="t" onclick="H(this)">14:56:31</span>                    Joel </span><span>I think I need two defrecords one for name/period combo and another for keeping the count?</span></div><div id="t1556895468085900" t="2019-05-03 14:57:48 Joel so match on all periods records and accumulate on the counting records (i think)."><a href="#t1556895468085900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-05-03</span> <span class="t" onclick="H(this)">14:57:48</span>                    Joel </span><span>so match on all periods records and accumulate on the counting records (i think).</span></div><div id="t1556895499086900" t="2019-05-03 14:58:19 Joel i think i was trying to keep this all kind of in one structure, and that&apos;s not do-able."><a href="#t1556895499086900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-05-03</span> <span class="t" onclick="H(this)">14:58:19</span>                    Joel </span><span>i think i was trying to keep this all kind of in one structure, and that&apos;s not do-able.</span></div><div id="t1556895503087100" t="2019-05-03 14:58:23 eraserhd I think doing arbitrary, data-driven periods will be hard without generating rules from data."><a href="#t1556895503087100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-05-03</span> <span class="t" onclick="H(this)">14:58:23</span>                eraserhd </span><span>I think doing arbitrary, data-driven periods will be hard without generating rules from data.</span></div><div id="t1556895559087500" t="2019-05-03 14:59:19 eraserhd Well, maybe not the way you are doing it."><a href="#t1556895559087500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-05-03</span> <span class="t" onclick="H(this)">14:59:19</span>                eraserhd </span><span>Well, maybe not the way you are doing it.</span></div><div id="t1556895632088900" t="2019-05-03 15:00:32 Joel yeah, i&apos;m going to see what that looks like if I can get it working refine from there... Thanks!"><a href="#t1556895632088900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-05-03</span> <span class="t" onclick="H(this)">15:00:32</span>                    Joel </span><span>yeah, i&apos;m going to see what that looks like if I can get it working refine from there... Thanks!</span></div><div id="t1557137853091800" t="2019-05-06 10:17:33 wparker @joel380 not sure if this will impact you, but note that facts should be immutable, including as regards their equals and hash methods.  If, say, a hashcode changed while rules were firing you could get strange (undefined) behavior."><a href="#t1557137853091800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-05-06</span> <span class="t" onclick="H(this)">10:17:33</span>                 wparker </span><span>@joel380 not sure if this will impact you, but note that facts should be immutable, including as regards their equals and hash methods.  If, say, a hashcode changed while rules were firing you could get strange (undefined) behavior.</span></div><div id="t1557372313107800" t="2019-05-09 03:25:13 Joel I&apos;m thinking I may like to express a part of my system as a list (of maps) that gets turned into rules dynamically. However, I&apos;d still need to express part of the LHS conditions in this list. The examples I saw suggested that I should produce the data structure as if the macros had been run.  Is this a bad use case for rule generation, as I&apos;d somehow need to transform these partial conditions and inject into final form?"><a href="#t1557372313107800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-05-09</span> <span class="t" onclick="H(this)">03:25:13</span>                    Joel </span><span>I&apos;m thinking I may like to express a part of my system as a list (of maps) that gets turned into rules dynamically. However, I&apos;d still need to express part of the LHS conditions in this list. The examples I saw suggested that I should produce the data structure as if the macros had been run.  Is this a bad use case for rule generation, as I&apos;d somehow need to transform these partial conditions and inject into final form?</span></div><div id="t1557493510110700" t="2019-05-10 13:05:10 wparker The API constraint is that mk-session needs to receive unevaluated code in the same format that the defrule and defmacro macros construct.  I’ve worked on cases where the rules were generated from a DSL that had quite a bit of processing into Clara rule forms, so what you’re suggesting sounds plausible."><a href="#t1557493510110700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-05-10</span> <span class="t" onclick="H(this)">13:05:10</span>                      wparker </span><span>The API constraint is that mk-session needs to receive unevaluated code in the same format that the defrule and defmacro macros construct.  I’ve worked on cases where the rules were generated from a DSL that had quite a bit of processing into Clara rule forms, so what you’re suggesting sounds plausible.</span></div><div id="t1557938089118900" t="2019-05-15 16:34:49 drewverlee Apologies for asking wide sweeping and possible horrible inaccurate questions:

1. clara (and rules engines in general) has no story for how to persist data correct?
2. datatomic and clara would seem to overlap in that they both use declarative joins to query data.
3. clara has reactive in memory updates to rules, while nothing in the dataomic ecosystem offers this (that i know of, which isn&apos;t saying much).

It seems like reactive datalog, would bridge many of these gaps (but at what costs!). However, i also assume maybe trying to bridge these differences at the library/database level has large implications for how your system has to be setup (databases, etc...). especially in order to be fast enough to be interesting."><a href="#t1557938089118900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-05-15</span> <span class="t" onclick="H(this)">16:34:49</span>              drewverlee </span><span>Apologies for asking wide sweeping and possible horrible inaccurate questions:

1. clara (and rules engines in general) has no story for how to persist data correct?
2. datatomic and clara would seem to overlap in that they both use declarative joins to query data.
3. clara has reactive in memory updates to rules, while nothing in the dataomic ecosystem offers this (that i know of, which isn&apos;t saying much).

It seems like reactive datalog, would bridge many of these gaps (but at what costs!). However, i also assume maybe trying to bridge these differences at the library/database level has large implications for how your system has to be setup (databases, etc...). especially in order to be fast enough to be interesting.</span></div><div id="t1557953028122700" t="2019-05-15 20:43:48 mikerod @drewverlee
&gt; 1. clara (and rules engines in general) has no story for how to persist data correct?

Yeah, for the most part it doesn’t do that. There is some foundations for “durability” supported, but subject to change, but it’s nothing like datomic or something to that extent.

&gt; 2. datatomic and clara would seem to overlap in that they both use declarative joins to query data.

There is some overlap in how you query data out perhaps. However, it’s done much differently. Datomic assumes much more of an ecosystem around it. Clara is a lightweight lib you can drop in the middle of your app and it just is a way to express conditional logic that is perhaps hard to express well with your own  if-then  logic. It also gives you the ability to be more declarative in describing your logic by using a truth maintenance system and a modern variant of the classic rete algorithm for perf benefits.

&gt; 3. clara has reactive in memory updates to rules, while nothing in the dataomic ecosystem offers this (that i know of, which isn’t saying much).

I can’t say exactly that datomic is lacking this. I think you’d have to put a system over it indeed.

You allude then to datalog, which is probably similar to Clara in nature, but I believe it is based on backwards-chaining logic, so then you have to consider forward vs backwards chaining for your application area.

Hopefully this sheds some insight for you."><a href="#t1557953028122700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-05-15</span> <span class="t" onclick="H(this)">20:43:48</span>                 mikerod </span><span>@drewverlee
&gt; 1. clara (and rules engines in general) has no story for how to persist data correct?

Yeah, for the most part it doesn’t do that. There is some foundations for “durability” supported, but subject to change, but it’s nothing like datomic or something to that extent.

&gt; 2. datatomic and clara would seem to overlap in that they both use declarative joins to query data.

There is some overlap in how you query data out perhaps. However, it’s done much differently. Datomic assumes much more of an ecosystem around it. Clara is a lightweight lib you can drop in the middle of your app and it just is a way to express conditional logic that is perhaps hard to express well with your own </span><code>if-then</code><span> logic. It also gives you the ability to be more declarative in describing your logic by using a truth maintenance system and a modern variant of the classic rete algorithm for perf benefits.

&gt; 3. clara has reactive in memory updates to rules, while nothing in the dataomic ecosystem offers this (that i know of, which isn’t saying much).

I can’t say exactly that datomic is lacking this. I think you’d have to put a system over it indeed.

You allude then to datalog, which is probably similar to Clara in nature, but I believe it is based on backwards-chaining logic, so then you have to consider forward vs backwards chaining for your application area.

Hopefully this sheds some insight for you.</span></div><div id="t1557953256123100" t="2019-05-15 20:47:36 drewverlee This is hugely helpful, thank you. I was only recent aware of forwards chaining logic and to find out there is a (potentially) a relationship with datalog through a similar model, backwards chaining logic, is very interesting."><a href="#t1557953256123100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-05-15</span> <span class="t" onclick="H(this)">20:47:36</span>                   drewverlee </span><span>This is hugely helpful, thank you. I was only recent aware of forwards chaining logic and to find out there is a (potentially) a relationship with datalog through a similar model, backwards chaining logic, is very interesting.</span></div><div id="t1557953391123300" t="2019-05-15 20:49:51 mikerod No problem. Yeah, exploring forwards vs backwards chaining and when one may be better suited or not is always a topic of interest to me."><a href="#t1557953391123300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-05-15</span> <span class="t" onclick="H(this)">20:49:51</span>                      mikerod </span><span>No problem. Yeah, exploring forwards vs backwards chaining and when one may be better suited or not is always a topic of interest to me.</span></div><div id="t1557953407123500" t="2019-05-15 20:50:07 mikerod I think more or less, you can do similar things in both, but one may be more optimal for certain usages than the other"><a href="#t1557953407123500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-05-15</span> <span class="t" onclick="H(this)">20:50:07</span>                      mikerod </span><span>I think more or less, you can do similar things in both, but one may be more optimal for certain usages than the other</span></div><div id="t1557953619123700" t="2019-05-15 20:53:39 mikerod And in Clara’s case specifically, queries are expressed in a pre-defined way that is built directly into the rules network - via something such as  defquery . So they are “pre-canned” and actually participate in the forward-chaining logic just like any other rule does.
Something like datalog, I believe you just specify arbitrary queries on demand. These then form backwards chaining execution paths. More like a relational db query or something to that extent."><a href="#t1557953619123700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-05-15</span> <span class="t" onclick="H(this)">20:53:39</span>                      mikerod </span><span>And in Clara’s case specifically, queries are expressed in a pre-defined way that is built directly into the rules network - via something such as </span><code>defquery</code><span>. So they are “pre-canned” and actually participate in the forward-chaining logic just like any other rule does.
Something like datalog, I believe you just specify arbitrary queries on demand. These then form backwards chaining execution paths. More like a relational db query or something to that extent.</span></div><div id="t1557955843123900" t="2019-05-15 21:30:43 drewverlee I think your right mike, that very much gels with what i understand in principle about both.

I think my next step is some papers and hammock time. Thanks a ton!"><a href="#t1557955843123900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-05-15</span> <span class="t" onclick="H(this)">21:30:43</span>                   drewverlee </span><span>I think your right mike, that very much gels with what i understand in principle about both.

I think my next step is some papers and hammock time. Thanks a ton!</span></div><div id="t1558017133125400" t="2019-05-16 14:32:13 eraserhd Just so you know, we use Datomic with Clara, and bolting them together has hit a sweet spot where we solved several problems at once."><a href="#t1558017133125400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-05-16</span> <span class="t" onclick="H(this)">14:32:13</span>                eraserhd </span><span>Just so you know, we use Datomic with Clara, and bolting them together has hit a sweet spot where we solved several problems at once.</span></div><div id="t1558017184126500" t="2019-05-16 14:33:04 eraserhd Before, we had custom data validation code, and custom code to create &quot;synthetics&quot; - computed values that appear in our GraphQL queries that don&apos;t exist in the database."><a href="#t1558017184126500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-05-16</span> <span class="t" onclick="H(this)">14:33:04</span>                eraserhd </span><span>Before, we had custom data validation code, and custom code to create &quot;synthetics&quot; - computed values that appear in our GraphQL queries that don&apos;t exist in the database.</span></div><div id="t1558017244127400" t="2019-05-16 14:34:04 eraserhd We are using less and less of datomic though, as it&apos;s now merely a data store, and we never query it directly except for debugging."><a href="#t1558017244127400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-05-16</span> <span class="t" onclick="H(this)">14:34:04</span>                eraserhd </span><span>We are using less and less of datomic though, as it&apos;s now merely a data store, and we never query it directly except for debugging.</span></div><div id="t1558054096129900" t="2019-05-17 00:48:16 drewverlee How are you using datomic if your not querying it?"><a href="#t1558054096129900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-05-17</span> <span class="t" onclick="H(this)">00:48:16</span>                   drewverlee </span><span>How are you using datomic if your not querying it?</span></div><div id="t1558019390128200" t="2019-05-16 15:09:50 mikerod @eraserhd nice, hybrid situation of above"><a href="#t1558019390128200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-05-16</span> <span class="t" onclick="H(this)">15:09:50</span>                 mikerod </span><span>@eraserhd nice, hybrid situation of above</span></div><div id="t1558019474128500" t="2019-05-16 15:11:14 mikerod forgot to mention this project that came out a bit back and was discussed some here  https://github.com/clyfe/clara-eav"><a href="#t1558019474128500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-05-16</span> <span class="t" onclick="H(this)">15:11:14</span>                 mikerod </span><span>forgot to mention this project that came out a bit back and was discussed some here </span><a href="https://github.com/clyfe/clara-eav" target="_blank">https://github.com/clyfe/clara-eav</a></div><div id="t1558019549129800" t="2019-05-16 15:12:29 mikerod I think the idea was to smoothly use EAV style tuples as facts. I haven’t used it or anything though. I just think it relates to datomic datoms."><a href="#t1558019549129800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-05-16</span> <span class="t" onclick="H(this)">15:12:29</span>                 mikerod </span><span>I think the idea was to smoothly use EAV style tuples as facts. I haven’t used it or anything though. I just think it relates to datomic datoms.</span></div><div id="t1558231698131700" t="2019-05-19 02:08:18 drewverlee Whats the difference from a query and a rule in rules engines in general.

As i understand it. a rule is propositional logic &quot;if X then Y&quot; / X :- Y. But is query something else or is it just a rule where X is some direct match lookup?"><a href="#t1558231698131700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-05-19</span> <span class="t" onclick="H(this)">02:08:18</span>              drewverlee </span><span>Whats the difference from a query and a rule in rules engines in general.

As i understand it. a rule is propositional logic &quot;if X then Y&quot; / X :- Y. But is query something else or is it just a rule where X is some direct match lookup?</span></div><div id="t1558231724132000" t="2019-05-19 02:08:44 drewverlee It seems in clara that rules can have arguments, is that right?"><a href="#t1558231724132000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-05-19</span> <span class="t" onclick="H(this)">02:08:44</span>              drewverlee </span><span>It seems in clara that rules can have arguments, is that right?</span></div><div id="t1558233368134000" t="2019-05-19 02:36:08 mikerod @drewverlee queries gives you an external hook to pull data from the session. It has no RHS. When you “call” the query you get the matches as a result. The match’s have all the variable bindings of the rule bound by those keys for you to access. "><a href="#t1558233368134000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-05-19</span> <span class="t" onclick="H(this)">02:36:08</span>                 mikerod </span><span>@drewverlee queries gives you an external hook to pull data from the session. It has no RHS. When you “call” the query you get the matches as a result. The match’s have all the variable bindings of the rule bound by those keys for you to access. </span></div><div id="t1558233399134800" t="2019-05-19 02:36:39 mikerod You can parameterize a query. When you call it, you bind those parameters. "><a href="#t1558233399134800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-05-19</span> <span class="t" onclick="H(this)">02:36:39</span>                 mikerod </span><span>You can parameterize a query. When you call it, you bind those parameters. </span></div><div id="t1558233424135700" t="2019-05-19 02:37:04 mikerod Normal rules can’t be parameterized like this because you don’t “call” into rules directly. "><a href="#t1558233424135700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-05-19</span> <span class="t" onclick="H(this)">02:37:04</span>                 mikerod </span><span>Normal rules can’t be parameterized like this because you don’t “call” into rules directly. </span></div><div id="t1561575655002300" t="2019-06-26 19:00:55 misha why do rules have to have fact-type? e.g.  Person  here:
 [?person &lt;- Person (= first-name &quot;Alice&quot;) (= ?last-name last-name)]
;; or here
[Person (= ?name1 name) (= ?age1 age)]
"><a href="#t1561575655002300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-06-26</span> <span class="t" onclick="H(this)">19:00:55</span>                   misha </span><span>why do rules have to have fact-type? e.g. </span><code>Person</code><span> here:
</span><pre>[?person &lt;- Person (= first-name &quot;Alice&quot;) (= ?last-name last-name)]
;; or here
[Person (= ?name1 name) (= ?age1 age)]
</pre></div><div id="t1561575932004100" t="2019-06-26 19:05:32 misha how does engine implementation leverages that?
it seems like having datomic-like datalog api would be somewhat more uniform or convenient, or ...?"><a href="#t1561575932004100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-06-26</span> <span class="t" onclick="H(this)">19:05:32</span>                   misha </span><span>how does engine implementation leverages that?
it seems like having datomic-like datalog api would be somewhat more uniform or convenient, or ...?</span></div><div id="t1561579676007000" t="2019-06-26 20:07:56 wparker @misha in essence Clara, given facts, finds the types that match that fact and looks up the rules with conditions on that type.  Note that “matching the type” includes conditions matching on an ancestor of the fact’s type."><a href="#t1561579676007000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-06-26</span> <span class="t" onclick="H(this)">20:07:56</span>                 wparker </span><span>@misha in essence Clara, given facts, finds the types that match that fact and looks up the rules with conditions on that type.  Note that “matching the type” includes conditions matching on an ancestor of the fact’s type.</span></div><div id="t1561579767008900" t="2019-06-26 20:09:27 wparker This improves performance when there are lots of rules - a fact doesn’t have to be evaluated against rules that its’ type won’t allow it to match"><a href="#t1561579767008900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-06-26</span> <span class="t" onclick="H(this)">20:09:27</span>                 wparker </span><span>This improves performance when there are lots of rules - a fact doesn’t have to be evaluated against rules that its’ type won’t allow it to match</span></div><div id="t1561579800009500" t="2019-06-26 20:10:00 wparker There’s some tangentially related discussion of this at  http://www.clara-rules.org/docs/fact_type_fn_perf/"><a href="#t1561579800009500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-06-26</span> <span class="t" onclick="H(this)">20:10:00</span>                 wparker </span><span>There’s some tangentially related discussion of this at </span><a href="http://www.clara-rules.org/docs/fact_type_fn_perf/" target="_blank">http://www.clara-rules.org/docs/fact_type_fn_perf/</a></div><div id="t1561581364010500" t="2019-06-26 20:36:04 mikerod @misha also, there are alternatives to how you could structure a DSL over this - Clara just has this one as the default. It isn’t necessarily trivial to extend things, but there are examples of at least datom-like datom support with  https://github.com/clyfe/clara-eav"><a href="#t1561581364010500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-06-26</span> <span class="t" onclick="H(this)">20:36:04</span>                 mikerod </span><span>@misha also, there are alternatives to how you could structure a DSL over this - Clara just has this one as the default. It isn’t necessarily trivial to extend things, but there are examples of at least datom-like datom support with </span><a href="https://github.com/clyfe/clara-eav" target="_blank">https://github.com/clyfe/clara-eav</a></div><div id="t1561636233018500" t="2019-06-27 11:50:33 misha Thanks, Mike and W.
Reading into both clara and eav sources now.
However I still have strong feeling, something clever can be figured out on top of “vanilla” datalog (or very tightly coupled with). Eav seems to wrap clara, and only pretend to be datomic-like, in dsl layer. I’ll dig deeper into how attribute in conjunction with :aevt index can be used to pre-narrow down query space, as clara does with records-as-ruletypes"><a href="#t1561636233018500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-06-27</span> <span class="t" onclick="H(this)">11:50:33</span>                   misha </span><span>Thanks, Mike and W.
Reading into both clara and eav sources now.
However I still have strong feeling, something clever can be figured out on top of “vanilla” datalog (or very tightly coupled with). Eav seems to wrap clara, and only pretend to be datomic-like, in dsl layer. I’ll dig deeper into how attribute in conjunction with :aevt index can be used to pre-narrow down query space, as clara does with records-as-ruletypes</span></div><div id="t1561645995020800" t="2019-06-27 14:33:15 mikerod @misha Clara implements a forward-chaining, Rete based, engine. Datalog I believe is backward-chaining and maybe based on something like miniKanren or something? 
Either way, they aren’t the same. So that’s a correct observation. "><a href="#t1561645995020800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-06-27</span> <span class="t" onclick="H(this)">14:33:15</span>                 mikerod </span><span>@misha Clara implements a forward-chaining, Rete based, engine. Datalog I believe is backward-chaining and maybe based on something like miniKanren or something? 
Either way, they aren’t the same. So that’s a correct observation. </span></div><div id="t1561646022021600" t="2019-06-27 14:33:42 mikerod And typically on this path, you’ll have to consider the trade offs of the different styles of engine. "><a href="#t1561646022021600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-06-27</span> <span class="t" onclick="H(this)">14:33:42</span>                 mikerod </span><span>And typically on this path, you’ll have to consider the trade offs of the different styles of engine. </span></div><div id="t1561646073023200" t="2019-06-27 14:34:33 mikerod I wasn’t suggesting changing a DSL will change the fundamentals of the underlying engine for you there. It was just if you had EAV style data to represent as facts, and wanted to use them with a forward chaining engine. "><a href="#t1561646073023200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-06-27</span> <span class="t" onclick="H(this)">14:34:33</span>                 mikerod </span><span>I wasn’t suggesting changing a DSL will change the fundamentals of the underlying engine for you there. It was just if you had EAV style data to represent as facts, and wanted to use them with a forward chaining engine. </span></div><div id="t1561646863025100" t="2019-06-27 14:47:43 misha does forward-chaining give any speed, or other guarantees/properties, which clara relies on explicitly (comparing to backward-chaining)?"><a href="#t1561646863025100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-06-27</span> <span class="t" onclick="H(this)">14:47:43</span>                   misha </span><span>does forward-chaining give any speed, or other guarantees/properties, which clara relies on explicitly (comparing to backward-chaining)?</span></div><div id="t1561650973028400" t="2019-06-27 15:56:13 mikerod @misha I think that’s a more difficult question to answer succinctly. There are some papers out there that do discuss this exact topic (which I think we should work to link to in some Clara reference docs sometime soon).
It looks like this paper  https://pdfs.semanticscholar.org/54af/b81b814acea73450430b4dabd0fc5c13732a.pdf 
and (a paper the above references)  http://iips.icci.edu.iq/images/exam/artificial-intelligence-structures-and-strategies-for--complex-problem-solving.pdf  section on “3.2.1 Data-Driven and Goal-Driven Search” have some guidelines and more overview on the topic.
I think there is a lot more out there than this though.

The key concept being,
• forward-chaining emphasizes the “data-driven” approach - use available facts to see what all possible “end states”/“goals” can be reached
• backward-chaining emphasizes the “goal-driven” approach - see if there are available facts to support some desired “end state”/“goal”"><a href="#t1561650973028400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-06-27</span> <span class="t" onclick="H(this)">15:56:13</span>                 mikerod </span><span>@misha I think that’s a more difficult question to answer succinctly. There are some papers out there that do discuss this exact topic (which I think we should work to link to in some Clara reference docs sometime soon).
It looks like this paper </span><a href="https://pdfs.semanticscholar.org/54af/b81b814acea73450430b4dabd0fc5c13732a.pdf" target="_blank">https://pdfs.semanticscholar.org/54af/b81b814acea73450430b4dabd0fc5c13732a.pdf</a><span>
and (a paper the above references) </span><a href="http://iips.icci.edu.iq/images/exam/artificial-intelligence-structures-and-strategies-for--complex-problem-solving.pdf" target="_blank">http://iips.icci.edu.iq/images/exam/artificial-intelligence-structures-and-strategies-for--complex-problem-solving.pdf</a><span> section on “3.2.1 Data-Driven and Goal-Driven Search” have some guidelines and more overview on the topic.
I think there is a lot more out there than this though.

The key concept being,
• forward-chaining emphasizes the “data-driven” approach - use available facts to see what all possible “end states”/“goals” can be reached
• backward-chaining emphasizes the “goal-driven” approach - see if there are available facts to support some desired “end state”/“goal”</span></div><div id="t1561651048029800" t="2019-06-27 15:57:28 mikerod Since they emphasize a different desired solution finding paradigm, they tend to optimize better for that purpose"><a href="#t1561651048029800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-06-27</span> <span class="t" onclick="H(this)">15:57:28</span>                 mikerod </span><span>Since they emphasize a different desired solution finding paradigm, they tend to optimize better for that purpose</span></div><div id="t1561651104030900" t="2019-06-27 15:58:24 mikerod Meaning,
* forward-chaining is likely more performant, and also more natural, when you want the “data-driven” approach.
* backward-chaining is more performant, and also more natural, when you want the “goal-driven” approach."><a href="#t1561651104030900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-06-27</span> <span class="t" onclick="H(this)">15:58:24</span>                 mikerod </span><span>Meaning,
* forward-chaining is likely more performant, and also more natural, when you want the “data-driven” approach.
* backward-chaining is more performant, and also more natural, when you want the “goal-driven” approach.</span></div><div id="t1561651253033600" t="2019-06-27 16:00:53 mikerod There are engines that do a blend of each at times too. Clara doesn’t currently. An example of how where this could apply, is that a Clara style query (typically defined via  defquery ) could be utilized in a way where you perhaps could say  (query session :?x 5)  and the engine could potentially use a backward-chaining approach to arrive at that goal. Perhaps to reduce the search space/work done. Nothing like this exists right now. I think that in the later version of Drools (popular, Java-centric (currently)) Rete-style, forward-chaining rules engine, there was actually limited support of a somewhat backward-chaining approach to deriving query results."><a href="#t1561651253033600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-06-27</span> <span class="t" onclick="H(this)">16:00:53</span>                 mikerod </span><span>There are engines that do a blend of each at times too. Clara doesn’t currently. An example of how where this could apply, is that a Clara style query (typically defined via </span><code>defquery</code><span>) could be utilized in a way where you perhaps could say </span><code>(query session :?x 5)</code><span> and the engine could potentially use a backward-chaining approach to arrive at that goal. Perhaps to reduce the search space/work done. Nothing like this exists right now. I think that in the later version of Drools (popular, Java-centric (currently)) Rete-style, forward-chaining rules engine, there was actually limited support of a somewhat backward-chaining approach to deriving query results.</span></div><div id="t1561651295034300" t="2019-06-27 16:01:35 mikerod however, if your main target is “goal-drive”, it’d likely still be best to use something centered around a full backward-chaining engine."><a href="#t1561651295034300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-06-27</span> <span class="t" onclick="H(this)">16:01:35</span>                 mikerod </span><span>however, if your main target is “goal-drive”, it’d likely still be best to use something centered around a full backward-chaining engine.</span></div><div id="t1561708053034900" t="2019-06-28 07:47:33 misha first paper link is $$$, thank you, Mike"><a href="#t1561708053034900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-06-28</span> <span class="t" onclick="H(this)">07:47:33</span>                   misha </span><span>first paper link is $$$, thank you, Mike</span></div><div id="t1561708441037600" t="2019-06-28 07:54:01 misha (2nd link is probably golden too, but, man, 800pages  kappa )"><a href="#t1561708441037600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-06-28</span> <span class="t" onclick="H(this)">07:54:01</span>                   misha </span><span>(2nd link is probably golden too, but, man, 800pages </span><b>kappa</b><span>)</span></div><div id="t1561713829046000" t="2019-06-28 09:23:49 wparker Another point to consider is that since forward-chaining computes results upfront, applying diffs e.g. new facts can be quite fast once an initial &quot;batch&quot; has been completed."><a href="#t1561713829046000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-06-28</span> <span class="t" onclick="H(this)">09:23:49</span>                 wparker </span><span>Another point to consider is that since forward-chaining computes results upfront, applying diffs e.g. new facts can be quite fast once an initial &quot;batch&quot; has been completed.</span></div><div id="t1561715419047500" t="2019-06-28 09:50:19 misha I wonder if datomic&apos;s datalog is still implemented with backward chaining, given team recommends to put the most specific query clause first"><a href="#t1561715419047500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-06-28</span> <span class="t" onclick="H(this)">09:50:19</span>                   misha </span><span>I wonder if datomic&apos;s datalog is still implemented with backward chaining, given team recommends to put the most specific query clause first</span></div><div id="t1561715577047900" t="2019-06-28 09:52:57 misha https://docs.datomic.com/on-prem/best-practices.html#most-selective-clauses-first"><a href="#t1561715577047900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-06-28</span> <span class="t" onclick="H(this)">09:52:57</span>                   misha </span><a href="https://docs.datomic.com/on-prem/best-practices.html#most-selective-clauses-first" target="_blank">https://docs.datomic.com/on-prem/best-practices.html#most-selective-clauses-first</a></div><div id="t1561716594055300" t="2019-06-28 10:09:54 misha so what I am actually trying to achieve/figure out, – is how to sneak rule-based parasite system onto datomic/datascript, without any changes to user api, e.g.: there are d/q, d/transact, d/transact!, and I&apos;d like the  defrule  to be just a composition of those from user point of view (with some cleverness under the hood, like extra working memory or knowledge base).
For example, clara-eav seems to have lots of internals leaking out into user api, making it less and less looking like datomic/datascript, which people already are used to &quot;dev-flow&quot;-wise.
One seemingly minor, but I think very important from usability/adoption point ov view – is it is still dsl with custom tokens, which will be highlighted all over the ns as undefined in Cursive and probably some other IDE, on top of being yet another DSL you need to remember semantics of."><a href="#t1561716594055300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-06-28</span> <span class="t" onclick="H(this)">10:09:54</span>                   misha </span><span>so what I am actually trying to achieve/figure out, – is how to sneak rule-based parasite system onto datomic/datascript, without any changes to user api, e.g.: there are d/q, d/transact, d/transact!, and I&apos;d like the </span><code>defrule</code><span> to be just a composition of those from user point of view (with some cleverness under the hood, like extra working memory or knowledge base).
For example, clara-eav seems to have lots of internals leaking out into user api, making it less and less looking like datomic/datascript, which people already are used to &quot;dev-flow&quot;-wise.
One seemingly minor, but I think very important from usability/adoption point ov view – is it is still dsl with custom tokens, which will be highlighted all over the ns as undefined in Cursive and probably some other IDE, on top of being yet another DSL you need to remember semantics of.</span></div><div id="t1561716673055900" t="2019-06-28 10:11:13 misha re dsl, from  https://github.com/clyfe/clara-eav#fact-dsl 
 ;; Clara fact syntax
[?eav &lt;- :todo/text (= (:e this) :new)]
[?eav &lt;- (a/all) :from [:eav/all (= (:e this) :new)]]

;; ClaraEAV fact syntax
[?eav &lt;- [:new :todo/text]]
[?eav &lt;- (a/all) :from [[:new]]]
"><a href="#t1561716673055900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-06-28</span> <span class="t" onclick="H(this)">10:11:13</span>                   misha </span><span>re dsl, from </span><a href="https://github.com/clyfe/clara-eav#fact-dsl" target="_blank">https://github.com/clyfe/clara-eav#fact-dsl</a><span>
</span><pre>;; Clara fact syntax
[?eav &lt;- :todo/text (= (:e this) :new)]
[?eav &lt;- (a/all) :from [:eav/all (= (:e this) :new)]]

;; ClaraEAV fact syntax
[?eav &lt;- [:new :todo/text]]
[?eav &lt;- (a/all) :from [[:new]]]
</pre></div><div id="t1561716926057800" t="2019-06-28 10:15:26 misha why this, if everyone is familiar with  let -style bindings, and many libraries manage to represent domain-specific bindings with their custom let forms, eg:
let for monads:  https://github.com/funcool/cats/blob/master/src/cats/core.cljc#L233-L255 
let for generators:  https://github.com/clojure/test.check/blob/master/src/main/clojure/clojure/test/check/generators.cljc#L1590-L1630"><a href="#t1561716926057800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-06-28</span> <span class="t" onclick="H(this)">10:15:26</span>                   misha </span><span>why this, if everyone is familiar with </span><code>let</code><span>-style bindings, and many libraries manage to represent domain-specific bindings with their custom let forms, eg:
let for monads: </span><a href="https://github.com/funcool/cats/blob/master/src/cats/core.cljc#L233-L255" target="_blank">https://github.com/funcool/cats/blob/master/src/cats/core.cljc#L233-L255</a><span>
let for generators: </span><a href="https://github.com/clojure/test.check/blob/master/src/main/clojure/clojure/test/check/generators.cljc#L1590-L1630" target="_blank">https://github.com/clojure/test.check/blob/master/src/main/clojure/clojure/test/check/generators.cljc#L1590-L1630</a></div><div id="t1561997584059000" t="2019-07-01 16:13:04 mikerod https://clojurians.slack.com/archives/C08TC9JCS/p1561715419047500 

I don’t know the specifics here at all. But probably could still be backwards chaining and have something like this apply. "><a href="#t1561997584059000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-07-01</span> <span class="t" onclick="H(this)">16:13:04</span>                 mikerod </span><a href="https://clojurians.slack.com/archives/C08TC9JCS/p1561715419047500" target="_blank">https://clojurians.slack.com/archives/C08TC9JCS/p1561715419047500</a><span>

I don’t know the specifics here at all. But probably could still be backwards chaining and have something like this apply. </span></div><div id="t1561997773062300" t="2019-07-01 16:16:13 mikerod https://clojurians.slack.com/archives/C08TC9JCS/p1561716926057800 

The syntax can be altered if you want an alternative dsl. The rules have a well defined data model. 

It’s not “just let” syntax since that would be awkward to make semantically work for more complex rules. Rules are about unification bindings etc. datalog isn’t let-binding syntax either. 

Also Clara is aligning its default DSL syntax closer to the world of forward chaining rules engines that have existed for a long time. "><a href="#t1561997773062300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-07-01</span> <span class="t" onclick="H(this)">16:16:13</span>                 mikerod </span><a href="https://clojurians.slack.com/archives/C08TC9JCS/p1561716926057800" target="_blank">https://clojurians.slack.com/archives/C08TC9JCS/p1561716926057800</a><span>

The syntax can be altered if you want an alternative dsl. The rules have a well defined data model. 

It’s not “just let” syntax since that would be awkward to make semantically work for more complex rules. Rules are about unification bindings etc. datalog isn’t let-binding syntax either. 

Also Clara is aligning its default DSL syntax closer to the world of forward chaining rules engines that have existed for a long time. </span></div><div id="t1561997834064100" t="2019-07-01 16:17:14 mikerod But your problem seems interesting @misha I don’t have necessarily any easy answers there. First I would make sure the rules can express your problems that you try to solve. Then maybe worry more about blending it with a datalog syntax if that’s you’re goal. "><a href="#t1561997834064100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-07-01</span> <span class="t" onclick="H(this)">16:17:14</span>                 mikerod </span><span>But your problem seems interesting @misha I don’t have necessarily any easy answers there. First I would make sure the rules can express your problems that you try to solve. Then maybe worry more about blending it with a datalog syntax if that’s you’re goal. </span></div><div id="t1563058111068900" t="2019-07-13 22:48:31 drewverlee so rules engines model if then relationships and in the &quot;then&quot; part its easy to insert new facts or take abitrary actions on those facts. What i&apos;m not clear about, is how this model relates/overlaps with building a hierarchy of data, or if its orthogonal. Like, a common rules example is that my fathers brother is my uncle. But what about answering questions like, what are the names of all my friends, something that would be easy with datomic pull."><a href="#t1563058111068900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-07-13</span> <span class="t" onclick="H(this)">22:48:31</span>              drewverlee </span><span>so rules engines model if then relationships and in the &quot;then&quot; part its easy to insert new facts or take abitrary actions on those facts. What i&apos;m not clear about, is how this model relates/overlaps with building a hierarchy of data, or if its orthogonal. Like, a common rules example is that my fathers brother is my uncle. But what about answering questions like, what are the names of all my friends, something that would be easy with datomic pull.</span></div><div id="t1563117917070800" t="2019-07-14 15:25:17 mikerod @drewverlee similar to recent posts in this channel, I think you may be running up against the pros/cons of forward chaining rules (clara) and backwards chaining “paradigm” in terms of what is best for what sort of situation. "><a href="#t1563117917070800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-07-14</span> <span class="t" onclick="H(this)">15:25:17</span>                 mikerod </span><span>@drewverlee similar to recent posts in this channel, I think you may be running up against the pros/cons of forward chaining rules (clara) and backwards chaining “paradigm” in terms of what is best for what sort of situation. </span></div><div id="t1563117931071300" t="2019-07-14 15:25:31 mikerod You could model that question as an explicit query in clara though. "><a href="#t1563117931071300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-07-14</span> <span class="t" onclick="H(this)">15:25:31</span>                 mikerod </span><span>You could model that question as an explicit query in clara though. </span></div><div id="t1563117962072100" t="2019-07-14 15:26:02 mikerod The query could be parameterized to some extent as well to give some flexibility. "><a href="#t1563117962072100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-07-14</span> <span class="t" onclick="H(this)">15:26:02</span>                 mikerod </span><span>The query could be parameterized to some extent as well to give some flexibility. </span></div><div id="t1563117988072300" t="2019-07-14 15:26:28 mikerod https://clojurians.slack.com/archives/C08TC9JCS/p1561651104030900"><a href="#t1563117988072300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-07-14</span> <span class="t" onclick="H(this)">15:26:28</span>                 mikerod </span><a href="https://clojurians.slack.com/archives/C08TC9JCS/p1561651104030900" target="_blank">https://clojurians.slack.com/archives/C08TC9JCS/p1561651104030900</a></div><div id="t1563127364073700" t="2019-07-14 18:02:44 drewverlee Thanks @mikerod, are their any resources that you recommend that compare these two different approaches? Or talk about using them together? Specifically i&apos;m thinking of using clara or precept with datomic."><a href="#t1563127364073700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-07-14</span> <span class="t" onclick="H(this)">18:02:44</span>              drewverlee </span><span>Thanks @mikerod, are their any resources that you recommend that compare these two different approaches? Or talk about using them together? Specifically i&apos;m thinking of using clara or precept with datomic.</span></div><div id="t1563164370074700" t="2019-07-15 04:19:30 mikerod @drewverlee from above post I had a few  https://clojurians.slack.com/archives/C08TC9JCS/p1561650973028400  that were overviews "><a href="#t1563164370074700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-07-15</span> <span class="t" onclick="H(this)">04:19:30</span>                 mikerod </span><span>@drewverlee from above post I had a few </span><a href="https://clojurians.slack.com/archives/C08TC9JCS/p1561650973028400" target="_blank">https://clojurians.slack.com/archives/C08TC9JCS/p1561650973028400</a><span> that were overviews </span></div><div id="t1563191660075200" t="2019-07-15 11:54:20 drewverlee Thanks again, I really appreciate it."><a href="#t1563191660075200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-07-15</span> <span class="t" onclick="H(this)">11:54:20</span>              drewverlee </span><span>Thanks again, I really appreciate it.</span></div><div id="t1564063940000800" t="2019-07-25 14:12:20 drewverlee Can anyone highlight the key differences between Naga and Clara?"><a href="#t1564063940000800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-07-25</span> <span class="t" onclick="H(this)">14:12:20</span>              drewverlee </span><span>Can anyone highlight the key differences between Naga and Clara?</span></div><div id="t1564064103001600" t="2019-07-25 14:15:03 drewverlee Is Naga more focused on interfacing with a database?"><a href="#t1564064103001600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-07-25</span> <span class="t" onclick="H(this)">14:15:03</span>              drewverlee </span><span>Is Naga more focused on interfacing with a database?</span></div><div id="t1564066739002000" t="2019-07-25 14:58:59 mikerod @drewverlee yes, it was built on top of datomic I believe"><a href="#t1564066739002000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-07-25</span> <span class="t" onclick="H(this)">14:58:59</span>                 mikerod </span><span>@drewverlee yes, it was built on top of datomic I believe</span></div><div id="t1564066752002400" t="2019-07-25 14:59:12 mikerod so there is a db-specific integration point"><a href="#t1564066752002400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-07-25</span> <span class="t" onclick="H(this)">14:59:12</span>                 mikerod </span><span>so there is a db-specific integration point</span></div><div id="t1564066765002800" t="2019-07-25 14:59:25 mikerod but I’m no expert there - could be proven wrong."><a href="#t1564066765002800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-07-25</span> <span class="t" onclick="H(this)">14:59:25</span>                 mikerod </span><span>but I’m no expert there - could be proven wrong.</span></div><div id="t1564066948005700" t="2019-07-25 15:02:28 drewverlee Thanks Mike"><a href="#t1564066948005700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-07-25</span> <span class="t" onclick="H(this)">15:02:28</span>              drewverlee </span><span>Thanks Mike</span></div><div id="t1564930415008600" t="2019-08-04 14:53:35 hadils Hi! I am new to Clara. I am very excited to be using it, but I am having difficulty with debugging a rule:
 (defrule processed-transactions-rule
  [?account &lt;- Account (= type :bank)]
  [TransactionSettings (= ?db db)]
  =&gt;
  (insert-all! (get-processed-txs ?db ?account))) 
The error I get is:
 CompilerException clojure.lang.ExceptionInfo: Failed compiling alpha node
{:expr (clojure.core/fn [?__fact__ ?__env__] (clojure.core/let [this ?__fact__ ?__bindings__ (clojure.core/atom {})] (clojure.core/let [?db stackz.laws/db] (clojure.core/swap! ?__bindings__ clojure.core/assoc :?db ?db) (clojure.core/deref ?__bindings__)))), :condition {:type stackz.laws.TransactionSettings, :constraints [(= ?db stackz.laws/db)]}, :env nil}
 {:expr (clojure.core/fn [?__fact__ ?__env__] (clojure.core/let [this ?__fact__ ?__bindings__ (clojure.core/atom {})] (clojure.core/let [?db stackz.laws/db] (clojure.core/swap! ?__bindings__ clojure.core/assoc :?db ?db) (clojure.core/deref ?__bindings__)))), :condition {:type stackz.laws.TransactionSettings, :constraints [(= ?db stackz.laws/db)]}, :env nil}, compiling:(form-init5589377441026521223.clj:1:8) 
 
Can anyone point me in the right direction? Thanks!"><a href="#t1564930415008600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-08-04</span> <span class="t" onclick="H(this)">14:53:35</span>                  hadils </span><span>Hi! I am new to Clara. I am very excited to be using it, but I am having difficulty with debugging a rule:
</span><pre>(defrule processed-transactions-rule
  [?account &lt;- Account (= type :bank)]
  [TransactionSettings (= ?db db)]
  =&gt;
  (insert-all! (get-processed-txs ?db ?account)))</pre><span>
The error I get is:
</span><pre>CompilerException clojure.lang.ExceptionInfo: Failed compiling alpha node
{:expr (clojure.core/fn [?__fact__ ?__env__] (clojure.core/let [this ?__fact__ ?__bindings__ (clojure.core/atom {})] (clojure.core/let [?db stackz.laws/db] (clojure.core/swap! ?__bindings__ clojure.core/assoc :?db ?db) (clojure.core/deref ?__bindings__)))), :condition {:type stackz.laws.TransactionSettings, :constraints [(= ?db stackz.laws/db)]}, :env nil}
 {:expr (clojure.core/fn [?__fact__ ?__env__] (clojure.core/let [this ?__fact__ ?__bindings__ (clojure.core/atom {})] (clojure.core/let [?db stackz.laws/db] (clojure.core/swap! ?__bindings__ clojure.core/assoc :?db ?db) (clojure.core/deref ?__bindings__)))), :condition {:type stackz.laws.TransactionSettings, :constraints [(= ?db stackz.laws/db)]}, :env nil}, compiling:(form-init5589377441026521223.clj:1:8) 
</pre><span>
Can anyone point me in the right direction? Thanks!</span></div><div id="t1564942131009700" t="2019-08-04 18:08:51 mikerod @hadilsabbagh18 is there any more stack trace to be seen? Perhaps  *e  in REPL after you see this or something?"><a href="#t1564942131009700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-08-04</span> <span class="t" onclick="H(this)">18:08:51</span>                 mikerod </span><span>@hadilsabbagh18 is there any more stack trace to be seen? Perhaps </span><code>*e</code><span> in REPL after you see this or something?</span></div><div id="t1564942219011100" t="2019-08-04 18:10:19 mikerod Oh. How is  db  defined? Is it a field on either a record/type/class named  TransactionSettings ?"><a href="#t1564942219011100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-08-04</span> <span class="t" onclick="H(this)">18:10:19</span>                 mikerod </span><span>Oh. How is </span><code>db</code><span> defined? Is it a field on either a record/type/class named </span><code>TransactionSettings</code><span>?</span></div><div id="t1564942331013500" t="2019-08-04 18:12:11 mikerod Based on the form trying to be compiled there it looks like Clara cannot resolve what  db  is for that class so it is assuming it’s just a  symbol resolving to something in the namespace  stacks.laws.db/db  "><a href="#t1564942331013500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-08-04</span> <span class="t" onclick="H(this)">18:12:11</span>                 mikerod </span><span>Based on the form trying to be compiled there it looks like Clara cannot resolve what </span><code>db</code><span> is for that class so it is assuming it’s just a  symbol resolving to something in the namespace </span><code>stacks.laws.db/db</code><span> </span></div><div id="t1565186665015100" t="2019-08-07 14:04:25 hadils Thanks @mikerod !  I am creating an empty session at this point. That seems to resolve these errors. "><a href="#t1565186665015100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-08-07</span> <span class="t" onclick="H(this)">14:04:25</span>                  hadils </span><span>Thanks @mikerod !  I am creating an empty session at this point. That seems to resolve these errors. </span></div><div id="t1565187844015700" t="2019-08-07 14:24:04 mikerod Hmm. Interesting. Well feel free to ask if you have more questions. "><a href="#t1565187844015700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-08-07</span> <span class="t" onclick="H(this)">14:24:04</span>                 mikerod </span><span>Hmm. Interesting. Well feel free to ask if you have more questions. </span></div><div id="t1565209781017100" t="2019-08-07 20:29:41 sparkofreason If the only thing that changes in the LHS of a rule is an accumulator value, is it correct that the rule won&apos;t fire if the collection of facts matching the accumulator condition change?"><a href="#t1565209781017100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-08-07</span> <span class="t" onclick="H(this)">20:29:41</span>           sparkofreason </span><span>If the only thing that changes in the LHS of a rule is an accumulator value, is it correct that the rule won&apos;t fire if the collection of facts matching the accumulator condition change?</span></div><div id="t1565210152019000" t="2019-08-07 20:35:52 ethanc I would think that if an accumulator saw a new value, and the previously accumulated objects changed that there would be work that the rhs would have to do. Though I might be misunderstanding your question"><a href="#t1565210152019000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-08-07</span> <span class="t" onclick="H(this)">20:35:52</span>                  ethanc </span><span>I would think that if an accumulator saw a new value, and the previously accumulated objects changed that there would be work that the rhs would have to do. Though I might be misunderstanding your question</span></div><div id="t1565210214019700" t="2019-08-07 20:36:54 sparkofreason That&apos;s how I want it to behave, but I have a distant recollection that it doesn&apos;t actually work that way. Been awhile since I&apos;ve played with clara."><a href="#t1565210214019700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-08-07</span> <span class="t" onclick="H(this)">20:36:54</span>           sparkofreason </span><span>That&apos;s how I want it to behave, but I have a distant recollection that it doesn&apos;t actually work that way. Been awhile since I&apos;ve played with clara.</span></div><div id="t1565210549022200" t="2019-08-07 20:42:29 ProbablyJody @dave.dixon, are you thinking of the retract-fn’s behavior?"><a href="#t1565210549022200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-08-07</span> <span class="t" onclick="H(this)">20:42:29</span>            ProbablyJody </span><span>@dave.dixon, are you thinking of the retract-fn’s behavior?</span></div><div id="t1565210567022400" t="2019-08-07 20:42:47 sparkofreason Could be. Possible I&apos;m just writing my accumulation clause wrong or something, because sometimes it does seem to behave as you described."><a href="#t1565210567022400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-08-07</span> <span class="t" onclick="H(this)">20:42:47</span>           sparkofreason </span><span>Could be. Possible I&apos;m just writing my accumulation clause wrong or something, because sometimes it does seem to behave as you described.</span></div><div id="t1565211180023400" t="2019-08-07 20:53:00 ProbablyJody Ah, I think this might help:  https://github.com/cerner/clara-rules/blob/ce65c5071a271905786449db1190687ee40e4624/src/test/common/clara/test_accumulation.cljc#L1121"><a href="#t1565211180023400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-08-07</span> <span class="t" onclick="H(this)">20:53:00</span>            ProbablyJody </span><span>Ah, I think this might help: </span><a href="https://github.com/cerner/clara-rules/blob/ce65c5071a271905786449db1190687ee40e4624/src/test/common/clara/test_accumulation.cljc#L1121" target="_blank">https://github.com/cerner/clara-rules/blob/ce65c5071a271905786449db1190687ee40e4624/src/test/common/clara/test_accumulation.cljc#L1121</a></div><div id="t1565212977025200" t="2019-08-07 21:22:57 mikerod @dave.dixon in current version of Clara (and several before) the rule will not continue to propagate if the accumulated value hasn’t changed according to  =  
See lines like  https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/rules/engine.cljc#L1200"><a href="#t1565212977025200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-08-07</span> <span class="t" onclick="H(this)">21:22:57</span>                 mikerod </span><span>@dave.dixon in current version of Clara (and several before) the rule will not continue to propagate if the accumulated value hasn’t changed according to </span><code>=</code><span> 
See lines like </span><a href="https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/rules/engine.cljc#L1200" target="_blank">https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/rules/engine.cljc#L1200</a></div><div id="t1565213074027700" t="2019-08-07 21:24:34 mikerod So specifically if the accumulators result from the  :convert-return-fn  is  =  to what it was in the previous round of accumulating fact matches, propagation stops - which would imply no RHS action being triggered/activated"><a href="#t1565213074027700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-08-07</span> <span class="t" onclick="H(this)">21:24:34</span>                 mikerod </span><span>So specifically if the accumulators result from the </span><code>:convert-return-fn</code><span> is </span><code>=</code><span> to what it was in the previous round of accumulating fact matches, propagation stops - which would imply no RHS action being triggered/activated</span></div><div id="t1565213158028600" t="2019-08-07 21:25:58 mikerod The tests near what Jody pointed too could be enlightening on some more semantics though. I agree"><a href="#t1565213158028600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-08-07</span> <span class="t" onclick="H(this)">21:25:58</span>                 mikerod </span><span>The tests near what Jody pointed too could be enlightening on some more semantics though. I agree</span></div><div id="t1565213181029400" t="2019-08-07 21:26:21 mikerod There are quite detailed github issues out there that also discuss these semantics when we added the related changes. "><a href="#t1565213181029400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-08-07</span> <span class="t" onclick="H(this)">21:26:21</span>                 mikerod </span><span>There are quite detailed github issues out there that also discuss these semantics when we added the related changes. </span></div><div id="t1565214500030700" t="2019-08-07 21:48:20 sparkofreason @mikerod Thanks. Not exactly sure what I was thinking of. My actual problem was that I was hacking at something trying to make it update in place rather than letting truth maintenance do the lifting. Need to get back to &quot;thinking TMS&quot;  😉"><a href="#t1565214500030700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-08-07</span> <span class="t" onclick="H(this)">21:48:20</span>           sparkofreason </span><span>@mikerod Thanks. Not exactly sure what I was thinking of. My actual problem was that I was hacking at something trying to make it update in place rather than letting truth maintenance do the lifting. Need to get back to &quot;thinking TMS&quot; </span><b>😉</b></div><div id="t1565214726031200" t="2019-08-07 21:52:06 mikerod Yes. No mutate in place. That’ll indeed cause issues. "><a href="#t1565214726031200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-08-07</span> <span class="t" onclick="H(this)">21:52:06</span>                 mikerod </span><span>Yes. No mutate in place. That’ll indeed cause issues. </span></div><div id="t1565223990033700" t="2019-08-08 00:26:30 sparkofreason Think I hit another issue trying to update in place. I thought I could get away with it for unconditional facts, but it appears that when I have multiple LHS bindings on a rule that does a  retract!  followed by an  insert-unconditional! , the RHS fires for all bindings, so the retracts all occur before other rules fire that would potentially invalidate the LHS on the first rule after a subset of firings, based on those retractions."><a href="#t1565223990033700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-08-08</span> <span class="t" onclick="H(this)">00:26:30</span>           sparkofreason </span><span>Think I hit another issue trying to update in place. I thought I could get away with it for unconditional facts, but it appears that when I have multiple LHS bindings on a rule that does a </span><code>retract!</code><span> followed by an </span><code>insert-unconditional!</code><span>, the RHS fires for all bindings, so the retracts all occur before other rules fire that would potentially invalidate the LHS on the first rule after a subset of firings, based on those retractions.</span></div><div id="t1565229031035100" t="2019-08-08 01:50:31 mikerod @dave.dixon if you get into the business of doing unconditional things, you’ll have to control rule order more. This can be done with salience and possibly “blocker” fact patterns. "><a href="#t1565229031035100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-08-08</span> <span class="t" onclick="H(this)">01:50:31</span>                 mikerod </span><span>@dave.dixon if you get into the business of doing unconditional things, you’ll have to control rule order more. This can be done with salience and possibly “blocker” fact patterns. </span></div><div id="t1565277583039900" t="2019-08-08 15:19:43 sparkofreason It seems like avoiding this sort of thing can be a guiding principle for data modeling. For example, the existence of an entity might be unconditional, but the facts describing that entity may have more detailed logical relationships. Trying to group those facts as attributes under a single entity fact map or record leads to the headaches I&apos;m encountering. But maybe if I separate them so that they can be separately inserted/retracted, things will be cleaner. Giving clara-eav a try for this purpose."><a href="#t1565277583039900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-08-08</span> <span class="t" onclick="H(this)">15:19:43</span>           sparkofreason </span><span>It seems like avoiding this sort of thing can be a guiding principle for data modeling. For example, the existence of an entity might be unconditional, but the facts describing that entity may have more detailed logical relationships. Trying to group those facts as attributes under a single entity fact map or record leads to the headaches I&apos;m encountering. But maybe if I separate them so that they can be separately inserted/retracted, things will be cleaner. Giving clara-eav a try for this purpose.</span></div><div id="t1566997827001600" t="2019-08-28 13:10:27 grierson Should I run side effectful things (database/email) in the RHS of a rule. Or should I insert a new fact, query the session, and do side effectfs based on the query result?"><a href="#t1566997827001600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-08-28</span> <span class="t" onclick="H(this)">13:10:27</span>                grierson </span><span>Should I run side effectful things (database/email) in the RHS of a rule. Or should I insert a new fact, query the session, and do side effectfs based on the query result?</span></div><div id="t1566999928004600" t="2019-08-28 13:45:28 ethanc The latter is recommended, Clara makes no promises on the number of times that the RHS will be executed before reaching steady state."><a href="#t1566999928004600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-08-28</span> <span class="t" onclick="H(this)">13:45:28</span>                  ethanc </span><span>The latter is recommended, Clara makes no promises on the number of times that the RHS will be executed before reaching steady state.</span></div><div id="t1567000648005700" t="2019-08-28 13:57:28 grierson Thank you @ethanc, I thought that might be the case but just wanted to clara-fy  :rolling_on_the_floor_laughing: ."><a href="#t1567000648005700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-08-28</span> <span class="t" onclick="H(this)">13:57:28</span>                grierson </span><span>Thank you @ethanc, I thought that might be the case but just wanted to clara-fy </span><b>:rolling_on_the_floor_laughing:</b><span>.</span></div><div id="t1568124740009400" t="2019-09-10 14:12:20 mbragg Hi. Im having a play around with Clara and seeing if it’ll fit our use case. One of which is to know which Rule(s) failed. I can see the inspect function gives loads of nice info for all the activations; what could I do if i wanted to know which Rules were not triggered and why?"><a href="#t1568124740009400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-09-10</span> <span class="t" onclick="H(this)">14:12:20</span>                  mbragg </span><span>Hi. Im having a play around with Clara and seeing if it’ll fit our use case. One of which is to know which Rule(s) failed. I can see the inspect function gives loads of nice info for all the activations; what could I do if i wanted to know which Rules were not triggered and why?</span></div><div id="t1568125138009800" t="2019-09-10 14:18:58 mikerod @mbragg I think that will be a bit of a challenge with a forward-chaining approach to rules"><a href="#t1568125138009800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-09-10</span> <span class="t" onclick="H(this)">14:18:58</span>                 mikerod </span><span>@mbragg I think that will be a bit of a challenge with a forward-chaining approach to rules</span></div><div id="t1568125151010100" t="2019-09-10 14:19:11 mikerod if you have more specific questions - you can model that as rules and queries"><a href="#t1568125151010100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-09-10</span> <span class="t" onclick="H(this)">14:19:11</span>                 mikerod </span><span>if you have more specific questions - you can model that as rules and queries</span></div><div id="t1568125177010900" t="2019-09-10 14:19:37 mikerod but just to find out something like “what was missing that you would have needed to reach certain goals/conclusions” is more of a backwards chaining strength (ie goal-driven) I’d say"><a href="#t1568125177010900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-09-10</span> <span class="t" onclick="H(this)">14:19:37</span>                 mikerod </span><span>but just to find out something like “what was missing that you would have needed to reach certain goals/conclusions” is more of a backwards chaining strength (ie goal-driven) I’d say</span></div><div id="t1568125196011300" t="2019-09-10 14:19:56 mikerod • clara is based around the rete algo which is a forward-chaining (ie data-driven) approach

Good references for further reading:
1)  https://pdfs.semanticscholar.org/54af/b81b814acea73450430b4dabd0fc5c13732a.pdf 
2)  http://iips.icci.edu.iq/images/exam/artificial-intelligence-structures-and-strategies-for--complex-problem-solving.pdf  (section 8.2 Rule-Based Expert Systems)"><a href="#t1568125196011300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-09-10</span> <span class="t" onclick="H(this)">14:19:56</span>                 mikerod </span><span>• clara is based around the rete algo which is a forward-chaining (ie data-driven) approach

Good references for further reading:
1) </span><a href="https://pdfs.semanticscholar.org/54af/b81b814acea73450430b4dabd0fc5c13732a.pdf" target="_blank">https://pdfs.semanticscholar.org/54af/b81b814acea73450430b4dabd0fc5c13732a.pdf</a><span>
2) </span><a href="http://iips.icci.edu.iq/images/exam/artificial-intelligence-structures-and-strategies-for--complex-problem-solving.pdf" target="_blank">http://iips.icci.edu.iq/images/exam/artificial-intelligence-structures-and-strategies-for--complex-problem-solving.pdf</a><span> (section 8.2 Rule-Based Expert Systems)</span></div><div id="t1568125236012100" t="2019-09-10 14:20:36 mikerod you can make some progress of course with inspection - you can see what did happen, and subtract that from all the rules you know exists to find which were left out"><a href="#t1568125236012100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-09-10</span> <span class="t" onclick="H(this)">14:20:36</span>                 mikerod </span><span>you can make some progress of course with inspection - you can see what did happen, and subtract that from all the rules you know exists to find which were left out</span></div><div id="t1568125265012600" t="2019-09-10 14:21:05 mikerod you can also make more rules in some cases, perhaps even systematically (and programmatically) that try to capture the “negative” cases"><a href="#t1568125265012600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-09-10</span> <span class="t" onclick="H(this)">14:21:05</span>                 mikerod </span><span>you can also make more rules in some cases, perhaps even systematically (and programmatically) that try to capture the “negative” cases</span></div><div id="t1568125301013300" t="2019-09-10 14:21:41 mikerod eg. if I have a rule  rule a =&gt; insert b , then also make a rule  rule not(a) =&gt; insert z"><a href="#t1568125301013300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-09-10</span> <span class="t" onclick="H(this)">14:21:41</span>                 mikerod </span><span>eg. if I have a rule </span><code>rule a =&gt; insert b</code><span>, then also make a rule </span><code>rule not(a) =&gt; insert z</code></div><div id="t1568125341014000" t="2019-09-10 14:22:21 mikerod of course it can be more difficult than that with mult-condition joins, negation, and accumulators involved"><a href="#t1568125341014000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-09-10</span> <span class="t" onclick="H(this)">14:22:21</span>                 mikerod </span><span>of course it can be more difficult than that with mult-condition joins, negation, and accumulators involved</span></div><div id="t1568126025017900" t="2019-09-10 14:33:45 mbragg Many thanks @mikerod That all makes sense. diffing the activated vs non-activated rules &amp; using inspection does feel a little hacky, It seems like I should either re-think the problem and model it in a forward-chaining manner, or maybe not use clara and implement some sort of backward-chaining model. Thanks again!"><a href="#t1568126025017900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-09-10</span> <span class="t" onclick="H(this)">14:33:45</span>                  mbragg </span><span>Many thanks @mikerod That all makes sense. diffing the activated vs non-activated rules &amp; using inspection does feel a little hacky, It seems like I should either re-think the problem and model it in a forward-chaining manner, or maybe not use clara and implement some sort of backward-chaining model. Thanks again!</span></div><div id="t1568140427019700" t="2019-09-10 18:33:47 devn @mbragg at my previous gig, we found that doing what @mikerod mentioned was sufficient for our observability purposes. (Namely, we generated negative cases for certain types of rules, and created targeted queries to aid in observability.)"><a href="#t1568140427019700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-09-10</span> <span class="t" onclick="H(this)">18:33:47</span>                    devn </span><span>@mbragg at my previous gig, we found that doing what @mikerod mentioned was sufficient for our observability purposes. (Namely, we generated negative cases for certain types of rules, and created targeted queries to aid in observability.)</span></div><div id="t1568140970021100" t="2019-09-10 18:42:50 mbragg Thanks @devn yeah I’m having a think about that too"><a href="#t1568140970021100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-09-10</span> <span class="t" onclick="H(this)">18:42:50</span>                  mbragg </span><span>Thanks @devn yeah I’m having a think about that too</span></div><div id="t1570220340002000" t="2019-10-04 20:19:00 jjttjj Is the support for map types documented anywhere? I found this:  https://github.com/cerner/clara-rules/issues/6  but it seems to use some outdated parts of the api (`mk-query` etc)"><a href="#t1570220340002000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-10-04</span> <span class="t" onclick="H(this)">20:19:00</span>                  jjttjj </span><span>Is the support for map types documented anywhere? I found this: </span><a href="https://github.com/cerner/clara-rules/issues/6" target="_blank">https://github.com/cerner/clara-rules/issues/6</a><span> but it seems to use some outdated parts of the api (`mk-query` etc)</span></div><div id="t1570220651002300" t="2019-10-04 20:24:11 hiredman https://github.com/cerner/clara-rules/wiki/Guide#fact-types"><a href="#t1570220651002300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-10-04</span> <span class="t" onclick="H(this)">20:24:11</span>                hiredman </span><a href="https://github.com/cerner/clara-rules/wiki/Guide#fact-types" target="_blank">https://github.com/cerner/clara-rules/wiki/Guide#fact-types</a></div><div id="t1570220726002500" t="2019-10-04 20:25:26 jjttjj there it is, thanks!"><a href="#t1570220726002500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-10-04</span> <span class="t" onclick="H(this)">20:25:26</span>                  jjttjj </span><span>there it is, thanks!</span></div><div id="t1570223407003000" t="2019-10-04 21:10:07 mikerod @jjttjj you’ll see it used fairly often in test cases within clara as well, such as  https://github.com/cerner/clara-rules/blob/master/src/test/clojure/clara/test_rules.clj#L1129"><a href="#t1570223407003000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-10-04</span> <span class="t" onclick="H(this)">21:10:07</span>                 mikerod </span><span>@jjttjj you’ll see it used fairly often in test cases within clara as well, such as </span><a href="https://github.com/cerner/clara-rules/blob/master/src/test/clojure/clara/test_rules.clj#L1129" target="_blank">https://github.com/cerner/clara-rules/blob/master/src/test/clojure/clara/test_rules.clj#L1129</a></div><div id="t1570227460005300" t="2019-10-04 22:17:40 Eduardo Mata How can I apply rules to my Records and modified them if needed then return all the Records that either change or did not change to the caller?"><a href="#t1570227460005300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-10-04</span> <span class="t" onclick="H(this)">22:17:40</span>            Eduardo Mata </span><span>How can I apply rules to my Records and modified them if needed then return all the Records that either change or did not change to the caller?</span></div><div id="t1570227468005600" t="2019-10-04 22:17:48 Eduardo Mata I am using an atom but maybe that is wrong?"><a href="#t1570227468005600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-10-04</span> <span class="t" onclick="H(this)">22:17:48</span>            Eduardo Mata </span><span>I am using an atom but maybe that is wrong?</span></div><div id="t1570233864006500" t="2019-10-05 00:04:24 mikerod @contact904 Ideally, you’d make a new type of fact for the “modified” record and/or “processed record” and just query for those types"><a href="#t1570233864006500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-10-05</span> <span class="t" onclick="H(this)">00:04:24</span>                 mikerod </span><span>@contact904 Ideally, you’d make a new type of fact for the “modified” record and/or “processed record” and just query for those types</span></div><div id="t1570233878006900" t="2019-10-05 00:04:38 mikerod they can still hold the original, real modified record, so you could still access it"><a href="#t1570233878006900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-10-05</span> <span class="t" onclick="H(this)">00:04:38</span>                 mikerod </span><span>they can still hold the original, real modified record, so you could still access it</span></div><div id="t1570375905011700" t="2019-10-06 15:31:45 jjttjj Are clara sessions intended as throwaway cheap things meant to replace an elaborate  cond ?  I have a long running process that receives events every few seconds, and needs to make decisions based mainly on that new data point, and to a lesser extent some previous, accumulating state, but not previous events in the stream. Which one is the default approach with clara: a new session for each new data point, adding in the needed extra state with  insert ? Or should I be building up one session over time and retracting the old/unused data points"><a href="#t1570375905011700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-10-06</span> <span class="t" onclick="H(this)">15:31:45</span>                  jjttjj </span><span>Are clara sessions intended as throwaway cheap things meant to replace an elaborate </span><code>cond</code><span>?  I have a long running process that receives events every few seconds, and needs to make decisions based mainly on that new data point, and to a lesser extent some previous, accumulating state, but not previous events in the stream. Which one is the default approach with clara: a new session for each new data point, adding in the needed extra state with </span><code>insert</code><span>? Or should I be building up one session over time and retracting the old/unused data points</span></div><div id="t1570376646013700" t="2019-10-06 15:44:06 jjttjj Put slightly differently, the &quot;sensors&quot; example in the clara-examples repo seems similar to what i&apos;m trying to do, but I&apos;m not quite sure how the main function would translate to the &quot;real world&quot;:  https://github.com/cerner/clara-examples/blob/master/src/main/clojure/clara/examples/sensors.clj#L87  Should the same session persist throughout the long-running process that provides the sensor data? Or is the  run-examples  function similar to something that would be called frequently in response to new data?"><a href="#t1570376646013700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-10-06</span> <span class="t" onclick="H(this)">15:44:06</span>                  jjttjj </span><span>Put slightly differently, the &quot;sensors&quot; example in the clara-examples repo seems similar to what i&apos;m trying to do, but I&apos;m not quite sure how the main function would translate to the &quot;real world&quot;: </span><a href="https://github.com/cerner/clara-examples/blob/master/src/main/clojure/clara/examples/sensors.clj#L87" target="_blank">https://github.com/cerner/clara-examples/blob/master/src/main/clojure/clara/examples/sensors.clj#L87</a><span> Should the same session persist throughout the long-running process that provides the sensor data? Or is the </span><code>run-examples</code><span> function similar to something that would be called frequently in response to new data?</span></div><div id="t1570379992014500" t="2019-10-06 16:39:52 mikerod @jjttjj you could certainly create one “base session” and hold a reference to it"><a href="#t1570379992014500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-10-06</span> <span class="t" onclick="H(this)">16:39:52</span>                 mikerod </span><span>@jjttjj you could certainly create one “base session” and hold a reference to it</span></div><div id="t1570380012015200" t="2019-10-06 16:40:12 mikerod Then do insert+fire on independent “branches” from there. In isolation"><a href="#t1570380012015200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-10-06</span> <span class="t" onclick="H(this)">16:40:12</span>                 mikerod </span><span>Then do insert+fire on independent “branches” from there. In isolation</span></div><div id="t1570380046016300" t="2019-10-06 16:40:46 mikerod If old state doesn’t need to influence “new” you don’t need to try retracting the last cycle of facts etc. just start from scratch again from the base session"><a href="#t1570380046016300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-10-06</span> <span class="t" onclick="H(this)">16:40:46</span>                 mikerod </span><span>If old state doesn’t need to influence “new” you don’t need to try retracting the last cycle of facts etc. just start from scratch again from the base session</span></div><div id="t1570380054016600" t="2019-10-06 16:40:54 mikerod This will be cheap. "><a href="#t1570380054016600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-10-06</span> <span class="t" onclick="H(this)">16:40:54</span>                 mikerod </span><span>This will be cheap. </span></div><div id="t1570380210016900" t="2019-10-06 16:43:30 jjttjj great, thanks!"><a href="#t1570380210016900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-10-06</span> <span class="t" onclick="H(this)">16:43:30</span>                  jjttjj </span><span>great, thanks!</span></div><div id="t1570551890018000" t="2019-10-08 16:24:50 Eduardo Mata I have a multi-threaded parallel synchronous processor using Clara rules. How can I make sure that for every Rule session is clear out for the following session?"><a href="#t1570551890018000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-10-08</span> <span class="t" onclick="H(this)">16:24:50</span>            Eduardo Mata </span><span>I have a multi-threaded parallel synchronous processor using Clara rules. How can I make sure that for every Rule session is clear out for the following session?</span></div><div id="t1570552225020100" t="2019-10-08 16:30:25 jjttjj @contact904 I&apos;m still really new to Clara, but sessions are immutable, so you should be able to make a session and then use that as the starting session from any number of parallel threads without worrying. Is the work each thread does independent of all others? Or does there need to be some coordination?"><a href="#t1570552225020100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-10-08</span> <span class="t" onclick="H(this)">16:30:25</span>                  jjttjj </span><span>@contact904 I&apos;m still really new to Clara, but sessions are immutable, so you should be able to make a session and then use that as the starting session from any number of parallel threads without worrying. Is the work each thread does independent of all others? Or does there need to be some coordination?</span></div><div id="t1570552293021100" t="2019-10-08 16:31:33 Eduardo Mata The threads are independent of each other, but some of them use the same rules.clj module"><a href="#t1570552293021100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-10-08</span> <span class="t" onclick="H(this)">16:31:33</span>            Eduardo Mata </span><span>The threads are independent of each other, but some of them use the same rules.clj module</span></div><div id="t1570552360022300" t="2019-10-08 16:32:40 jjttjj Ok then yeah that&apos;s perfect, you should be able to bind  mk-session  somewhere, and then use it from any number of threads and the threads will only see the starting point. (Someone correct me if I&apos;m wrong :)"><a href="#t1570552360022300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-10-08</span> <span class="t" onclick="H(this)">16:32:40</span>                  jjttjj </span><span>Ok then yeah that&apos;s perfect, you should be able to bind </span><code>mk-session</code><span> somewhere, and then use it from any number of threads and the threads will only see the starting point. (Someone correct me if I&apos;m wrong :)</span></div><div id="t1570552479024400" t="2019-10-08 16:34:39 Eduardo Mata So if I have a set of N threads and the N thread are independent of each other running in parallel. All these N threads are using the same rules.clj module. I should not worry because the threads getting facts from other threads as they are only aware of the session the thread created at the time?"><a href="#t1570552479024400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-10-08</span> <span class="t" onclick="H(this)">16:34:39</span>            Eduardo Mata </span><span>So if I have a set of N threads and the N thread are independent of each other running in parallel. All these N threads are using the same rules.clj module. I should not worry because the threads getting facts from other threads as they are only aware of the session the thread created at the time?</span></div><div id="t1570552505024700" t="2019-10-08 16:35:05 jjttjj Yes, that is my understanding"><a href="#t1570552505024700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-10-08</span> <span class="t" onclick="H(this)">16:35:05</span>                  jjttjj </span><span>Yes, that is my understanding</span></div><div id="t1570552588026100" t="2019-10-08 16:36:28 ethanc The rule definitions should be separate from the memory of the sessions that are created."><a href="#t1570552588026100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-10-08</span> <span class="t" onclick="H(this)">16:36:28</span>                  ethanc </span><span>The rule definitions should be separate from the memory of the sessions that are created.</span></div><div id="t1570552622026500" t="2019-10-08 16:37:02 jjttjj you can even share a &quot;root&quot; session because they are immutable, in the same way a bunch of threads can operate on the same root vector in clojure and only see their version of it"><a href="#t1570552622026500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-10-08</span> <span class="t" onclick="H(this)">16:37:02</span>                  jjttjj </span><span>you can even share a &quot;root&quot; session because they are immutable, in the same way a bunch of threads can operate on the same root vector in clojure and only see their version of it</span></div><div id="t1570552669027100" t="2019-10-08 16:37:49 ethanc jjttjj is correct, assuming that all threads were loading the same rules"><a href="#t1570552669027100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-10-08</span> <span class="t" onclick="H(this)">16:37:49</span>                  ethanc </span><span>jjttjj is correct, assuming that all threads were loading the same rules</span></div><div id="t1570556178033600" t="2019-10-08 17:36:18 Eduardo Mata Correct me if I am wrong.
So I have multiple rules, I inserted a collection of events into the current session in progress. My main record is called Event. I will insert-all the Records in to the session and fire the rules. A little of back story, I used to have an atom, now I am inserting facts in to a new Record called NewEvents.
Back to the current situation,  The first rule will create a side effect (modify) on the Record and insert it in to NewEvents. The following rules will be fired with the Record Event, if it fits the rule, I want to look in to the past modified record in NewEvents and apply the changes to the corresponding NewEvent. I tried retract but it didn&apos;t seem to work.

If I retract the fact from NewEvent, then apply changes, I insert it back but then it is not there anymore  😞 . Using insert-unconditional! just makes it eat my available heap space"><a href="#t1570556178033600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-10-08</span> <span class="t" onclick="H(this)">17:36:18</span>            Eduardo Mata </span><span>Correct me if I am wrong.
So I have multiple rules, I inserted a collection of events into the current session in progress. My main record is called Event. I will insert-all the Records in to the session and fire the rules. A little of back story, I used to have an atom, now I am inserting facts in to a new Record called NewEvents.
Back to the current situation,  The first rule will create a side effect (modify) on the Record and insert it in to NewEvents. The following rules will be fired with the Record Event, if it fits the rule, I want to look in to the past modified record in NewEvents and apply the changes to the corresponding NewEvent. I tried retract but it didn&apos;t seem to work.

If I retract the fact from NewEvent, then apply changes, I insert it back but then it is not there anymore </span><b>😞</b><span>. Using insert-unconditional! just makes it eat my available heap space</span></div><div id="t1570559881034900" t="2019-10-08 18:38:01 Eduardo Mata basically, the question would be:
How do I modify a NewEvent?"><a href="#t1570559881034900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-10-08</span> <span class="t" onclick="H(this)">18:38:01</span>            Eduardo Mata </span><span>basically, the question would be:
How do I modify a NewEvent?</span></div><div id="t1570637795000700" t="2019-10-09 16:16:35 jjttjj @contact904 can you post some example code?"><a href="#t1570637795000700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-10-09</span> <span class="t" onclick="H(this)">16:16:35</span>                  jjttjj </span><span>@contact904 can you post some example code?</span></div><div id="t1570638706000800" t="2019-10-09 16:31:46 Eduardo Mata https://github.com/cerner/clara-rules/issues/437"><a href="#t1570638706000800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-10-09</span> <span class="t" onclick="H(this)">16:31:46</span>                 Eduardo Mata </span><a href="https://github.com/cerner/clara-rules/issues/437" target="_blank">https://github.com/cerner/clara-rules/issues/437</a></div><div id="t1572214028007000" t="2019-10-27 22:07:08 wparker Clara 0.20.0 is now released and available on Clojars.  This contains a couple bugfixes and a new default optimization to reduce memory usage.  Details on the changelog:   https://github.com/cerner/clara-rules/blob/master/CHANGELOG.md#0200"><a href="#t1572214028007000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-10-27</span> <span class="t" onclick="H(this)">22:07:08</span>                 wparker </span><span>Clara 0.20.0 is now released and available on Clojars.  This contains a couple bugfixes and a new default optimization to reduce memory usage.  Details on the changelog:  </span><a href="https://github.com/cerner/clara-rules/blob/master/CHANGELOG.md#0200" target="_blank">https://github.com/cerner/clara-rules/blob/master/CHANGELOG.md#0200</a></div><div id="t1572385820008500" t="2019-10-29 21:50:20 bartuka hi people, I am very glad to have found this library"><a href="#t1572385820008500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-10-29</span> <span class="t" onclick="H(this)">21:50:20</span>                 bartuka </span><span>hi people, I am very glad to have found this library</span></div><div id="t1572385846009100" t="2019-10-29 21:50:46 bartuka there is only one thing though that I wish to fix... cider is not identing correctly all my conditions =("><a href="#t1572385846009100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-10-29</span> <span class="t" onclick="H(this)">21:50:46</span>                 bartuka </span><span>there is only one thing though that I wish to fix... cider is not identing correctly all my conditions =(</span></div><div id="t1572385853009400" t="2019-10-29 21:50:53 bartuka any suggestions on how to fix it?  🙂"><a href="#t1572385853009400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-10-29</span> <span class="t" onclick="H(this)">21:50:53</span>                 bartuka </span><span>any suggestions on how to fix it? </span><b>🙂</b></div><div id="t1572398504010100" t="2019-10-30 01:21:44 noprompt See  put-clojure-indent"><a href="#t1572398504010100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-10-30</span> <span class="t" onclick="H(this)">01:21:44</span>                     noprompt </span><span>See </span><code>put-clojure-indent</code></div><div id="t1572744920010900" t="2019-11-03 01:35:20 mikerod Yeah it’d probably be cool if someone could share a cider config that helped indent some of the macros from Clara. "><a href="#t1572744920010900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-11-03</span> <span class="t" onclick="H(this)">01:35:20</span>                 mikerod </span><span>Yeah it’d probably be cool if someone could share a cider config that helped indent some of the macros from Clara. </span></div><div id="t1572744949011600" t="2019-11-03 01:35:49 mikerod I believe cursive IDE has some work in this area perhaps before if I recall. "><a href="#t1572744949011600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-11-03</span> <span class="t" onclick="H(this)">01:35:49</span>                 mikerod </span><span>I believe cursive IDE has some work in this area perhaps before if I recall. </span></div><div id="t1572759535012300" t="2019-11-03 05:38:55 dominicm The clara macros could add metadata to indicate to cider how to indent."><a href="#t1572759535012300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-11-03</span> <span class="t" onclick="H(this)">05:38:55</span>                dominicm </span><span>The clara macros could add metadata to indicate to cider how to indent.</span></div><div id="t1572943480016300" t="2019-11-05 08:44:40 wparker Is this the indentation metadata you’re referring to @dominicm?  https://docs.cider.mx/cider/indent_spec.html   I’ve generally been satisfied with the default indentation in Cider when writing rules, are there examples of cases where the indentation is strange?  My initial instinct if this sort of thing is desired would be to look for/create an extension mechanism for it so various development environments could be supported without everything needing to be in the main codebase (this is orthogonal to whether it would be in the main repo IMO and this could be separately considered)."><a href="#t1572943480016300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-11-05</span> <span class="t" onclick="H(this)">08:44:40</span>                 wparker </span><span>Is this the indentation metadata you’re referring to @dominicm? </span><a href="https://docs.cider.mx/cider/indent_spec.html" target="_blank">https://docs.cider.mx/cider/indent_spec.html</a><span>  I’ve generally been satisfied with the default indentation in Cider when writing rules, are there examples of cases where the indentation is strange?  My initial instinct if this sort of thing is desired would be to look for/create an extension mechanism for it so various development environments could be supported without everything needing to be in the main codebase (this is orthogonal to whether it would be in the main repo IMO and this could be separately considered).</span></div><div id="t1572944167017400" t="2019-11-05 08:56:07 dominicm Cursive looked at implementing the spec, I&apos;m not sure if it happened though.

It hasn&apos;t seen much adoption in other editors."><a href="#t1572944167017400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-11-05</span> <span class="t" onclick="H(this)">08:56:07</span>                dominicm </span><span>Cursive looked at implementing the spec, I&apos;m not sure if it happened though.

It hasn&apos;t seen much adoption in other editors.</span></div><div id="t1572982483022700" t="2019-11-05 19:34:43 sashton I’m trying out Clara right now. Is there a way to get all the current facts from a session? I’ve tried various inspection functions, and come up short.
-  inspect/explain-activations 
-  fact-graph/session-&gt;fact-graph 
-  inspect/inspect 
I can get most facts from the above functions. What I am missing is facts inserted directly into the session, which haven’t themselves fired any rules. This would be just for debugging the rules, not for production queries.
I don’t want to write a query which includes all Fact types, I’m looking for a simple way to enumerate all current facts in the system.
Any ideas?"><a href="#t1572982483022700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-11-05</span> <span class="t" onclick="H(this)">19:34:43</span>                 sashton </span><span>I’m trying out Clara right now. Is there a way to get all the current facts from a session? I’ve tried various inspection functions, and come up short.
- </span><code>inspect/explain-activations</code><span>
- </span><code>fact-graph/session-&gt;fact-graph</code><span>
- </span><code>inspect/inspect</code><span>
I can get most facts from the above functions. What I am missing is facts inserted directly into the session, which haven’t themselves fired any rules. This would be just for debugging the rules, not for production queries.
I don’t want to write a query which includes all Fact types, I’m looking for a simple way to enumerate all current facts in the system.
Any ideas?</span></div><div id="t1572986257023300" t="2019-11-05 20:37:37 mikerod @sashton easiest is a query on Object. "><a href="#t1572986257023300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-11-05</span> <span class="t" onclick="H(this)">20:37:37</span>                 mikerod </span><span>@sashton easiest is a query on Object. </span></div><div id="t1572986263023600" t="2019-11-05 20:37:43 mikerod It doesn’t necessary perform well though"><a href="#t1572986263023600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-11-05</span> <span class="t" onclick="H(this)">20:37:43</span>                 mikerod </span><span>It doesn’t necessary perform well though</span></div><div id="t1572986277024300" t="2019-11-05 20:37:57 mikerod Beyond that, it’s been done with hooking into the listeners Api"><a href="#t1572986277024300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-11-05</span> <span class="t" onclick="H(this)">20:37:57</span>                 mikerod </span><span>Beyond that, it’s been done with hooking into the listeners Api</span></div><div id="t1572986289025100" t="2019-11-05 20:38:09 mikerod I don’t think anything out of the box for it. I may be forgetting"><a href="#t1572986289025100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-11-05</span> <span class="t" onclick="H(this)">20:38:09</span>                 mikerod </span><span>I don’t think anything out of the box for it. I may be forgetting</span></div><div id="t1572986306025700" t="2019-11-05 20:38:26 sashton &gt; listeners api
I was just exploring that path"><a href="#t1572986306025700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-11-05</span> <span class="t" onclick="H(this)">20:38:26</span>                 sashton </span><span>&gt; listeners api
I was just exploring that path</span></div><div id="t1572986324026300" t="2019-11-05 20:38:44 mikerod If you watch the alpha node activations. "><a href="#t1572986324026300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-11-05</span> <span class="t" onclick="H(this)">20:38:44</span>                 mikerod </span><span>If you watch the alpha node activations. </span></div><div id="t1572986328026500" t="2019-11-05 20:38:48 mikerod And retractions. "><a href="#t1572986328026500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-11-05</span> <span class="t" onclick="H(this)">20:38:48</span>                 mikerod </span><span>And retractions. </span></div><div id="t1572986353027400" t="2019-11-05 20:39:13 sashton I’ll try out the Object query, thanks for the pointer. This is only for debugging, so I’m not worried about performance"><a href="#t1572986353027400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-11-05</span> <span class="t" onclick="H(this)">20:39:13</span>                 sashton </span><span>I’ll try out the Object query, thanks for the pointer. This is only for debugging, so I’m not worried about performance</span></div><div id="t1572986367027900" t="2019-11-05 20:39:27 mikerod But there are some complexities involved depending how precise you need it"><a href="#t1572986367027900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-11-05</span> <span class="t" onclick="H(this)">20:39:27</span>                 mikerod </span><span>But there are some complexities involved depending how precise you need it</span></div><div id="t1572986463028700" t="2019-11-05 20:41:03 mikerod Object query is straightforward. It’s slow because it always is activated by all working memory changes"><a href="#t1572986463028700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-11-05</span> <span class="t" onclick="H(this)">20:41:03</span>                 mikerod </span><span>Object query is straightforward. It’s slow because it always is activated by all working memory changes</span></div><div id="t1572986471029000" t="2019-11-05 20:41:11 mikerod And remember to fire rules always before running query"><a href="#t1572986471029000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-11-05</span> <span class="t" onclick="H(this)">20:41:11</span>                 mikerod </span><span>And remember to fire rules always before running query</span></div><div id="t1572986482029400" t="2019-11-05 20:41:22 mikerod They (can) do some batching/lazy stuff they may delay until fire rules."><a href="#t1572986482029400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-11-05</span> <span class="t" onclick="H(this)">20:41:22</span>                 mikerod </span><span>They (can) do some batching/lazy stuff they may delay until fire rules.</span></div><div id="t1572986596029700" t="2019-11-05 20:43:16 sashton Thanks!"><a href="#t1572986596029700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-11-05</span> <span class="t" onclick="H(this)">20:43:16</span>                 sashton </span><span>Thanks!</span></div><div id="t1572991456033900" t="2019-11-05 22:04:16 wparker On the subject of the query performance, something that may be counterintuitive is that the cost comes from the presence of the query in the rules session, not the query call itself.  In essence when fire-rules is called the query results are computed. Agreed that a query on Object is the simplest way to get all facts in the session if the perf hit doesn&apos;t matter e.g. in testing."><a href="#t1572991456033900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-11-05</span> <span class="t" onclick="H(this)">22:04:16</span>                 wparker </span><span>On the subject of the query performance, something that may be counterintuitive is that the cost comes from the presence of the query in the rules session, not the query call itself.  In essence when fire-rules is called the query results are computed. Agreed that a query on Object is the simplest way to get all facts in the session if the perf hit doesn&apos;t matter e.g. in testing.</span></div><div id="t1572991504035300" t="2019-11-05 22:05:04 wparker Assuming we&apos;re talking about JVM clojure, not sure offhand what the cljs equivalent would be."><a href="#t1572991504035300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-11-05</span> <span class="t" onclick="H(this)">22:05:04</span>                 wparker </span><span>Assuming we&apos;re talking about JVM clojure, not sure offhand what the cljs equivalent would be.</span></div><div id="t1573653069038400" t="2019-11-13 13:51:09 sashton I’m trying to figure out if there is a way to accumulate some joined data. I haven’t been able to come up with a single rule which will fire with my desired output.
In the following example, I am trying to answer the question, what is the sum of  quantities  for each  name :
 (defrecord A [id name])
(defrecord B [id quantity])

(defrule merge-things
  ???
  =&gt;
  (println ?name ?total-quanity))

(-&gt; (mk-session)
    (insert (-&gt;A 1 &quot;car&quot;))
    (insert (-&gt;A 2 &quot;truck&quot;))
    (insert (-&gt;A 3 &quot;car&quot;))
    (insert (-&gt;B 1 2))
    (insert (-&gt;B 2 3))
    (insert (-&gt;B 3 5))
    (fire-rules))
 
I am trying to have that rule print out:
 car 7
truck 3
"><a href="#t1573653069038400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-11-13</span> <span class="t" onclick="H(this)">13:51:09</span>                 sashton </span><span>I’m trying to figure out if there is a way to accumulate some joined data. I haven’t been able to come up with a single rule which will fire with my desired output.
In the following example, I am trying to answer the question, what is the sum of </span><code>quantities</code><span> for each </span><code>name</code><span>:
</span><pre>(defrecord A [id name])
(defrecord B [id quantity])

(defrule merge-things
  ???
  =&gt;
  (println ?name ?total-quanity))

(-&gt; (mk-session)
    (insert (-&gt;A 1 &quot;car&quot;))
    (insert (-&gt;A 2 &quot;truck&quot;))
    (insert (-&gt;A 3 &quot;car&quot;))
    (insert (-&gt;B 1 2))
    (insert (-&gt;B 2 3))
    (insert (-&gt;B 3 5))
    (fire-rules))
</pre><span>
I am trying to have that rule print out:
</span><pre>car 7
truck 3
</pre></div><div id="t1573653170039500" t="2019-11-13 13:52:50 sashton I haven’t been able to come up with a  ???  for that rule which works."><a href="#t1573653170039500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-11-13</span> <span class="t" onclick="H(this)">13:52:50</span>                 sashton </span><span>I haven’t been able to come up with a </span><code>???</code><span> for that rule which works.</span></div><div id="t1573653621042900" t="2019-11-13 14:00:21 sashton Well,  duckie   to the rescue. While typing this up, I found one way I hadn’t tried. So now my question is, are there any problems with the following rule definition? (memory,performance,other,…)
It is different that other rules I’ve used. Not sure if using the accumulator and re-creating the set of ids —  (set (map :id ?a))  — in the rule expression would cause any unexpected problems.
 (defrule merge-things
  [?a &lt;- (acc/all) :from [A (= ?name name)]]
  [?total-quantity &lt;- (acc/sum :quantity) :from [B (get (set (map :id ?a)) id)]]
  =&gt;
  (println ?name ?total-quantity))
"><a href="#t1573653621042900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-11-13</span> <span class="t" onclick="H(this)">14:00:21</span>                 sashton </span><span>Well, </span><b>duckie</b><span>  to the rescue. While typing this up, I found one way I hadn’t tried. So now my question is, are there any problems with the following rule definition? (memory,performance,other,…)
It is different that other rules I’ve used. Not sure if using the accumulator and re-creating the set of ids — </span><code>(set (map :id ?a))</code><span> — in the rule expression would cause any unexpected problems.
</span><pre>(defrule merge-things
  [?a &lt;- (acc/all) :from [A (= ?name name)]]
  [?total-quantity &lt;- (acc/sum :quantity) :from [B (get (set (map :id ?a)) id)]]
  =&gt;
  (println ?name ?total-quantity))
</pre></div><div id="t1573756612054800" t="2019-11-14 18:36:52 ethanc @sashton,
Sorry for the delay. From my experience accumulators are relatively cheap with respect to memory/performance in scenarios where the state of the session that they are accumulating is relatively stable.
Performance can degrade in the event that there are massive amounts of logical retractions due to truth maintenance, but it would be directly linked to the data in the session and other rules that may feed into this rule.

To the second half,
&gt; Not sure if using the accumulator and re-creating the set of ids —  (set (map :id ?a))  — in the rule expression would cause any unexpected problems.
I believe that would require each  B  in the session to generate the set again, perhaps using the  distinct  accumulator instead might be ‘better’. Any updates to  A  would also require this work to be redone.
Something like:
 (defrule merge-things
  [?ids &lt;- (acc/distinct :id) :from [A (= ?name name)]]
  [?total-quantity &lt;- (acc/sum :quantity) :from [B (contains? ?ids id)]]
  =&gt;
  (println ?name ?total-quantity))
 
In theory this would only have to recalculate the set when a new  A  was seen and then only if that return value changed then re evaluation of the  B  logic would have to occur.
Then again all of this needs to be taken with a grain of salt as data scenarios can  change the behavior of performance while executing rules."><a href="#t1573756612054800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-11-14</span> <span class="t" onclick="H(this)">18:36:52</span>                  ethanc </span><span>@sashton,
Sorry for the delay. From my experience accumulators are relatively cheap with respect to memory/performance in scenarios where the state of the session that they are accumulating is relatively stable.
Performance can degrade in the event that there are massive amounts of logical retractions due to truth maintenance, but it would be directly linked to the data in the session and other rules that may feed into this rule.

To the second half,
&gt; Not sure if using the accumulator and re-creating the set of ids — </span><code>(set (map :id ?a))</code><span> — in the rule expression would cause any unexpected problems.
I believe that would require each </span><code>B</code><span> in the session to generate the set again, perhaps using the </span><code>distinct</code><span> accumulator instead might be ‘better’. Any updates to </span><code>A</code><span> would also require this work to be redone.
Something like:
</span><pre>(defrule merge-things
  [?ids &lt;- (acc/distinct :id) :from [A (= ?name name)]]
  [?total-quantity &lt;- (acc/sum :quantity) :from [B (contains? ?ids id)]]
  =&gt;
  (println ?name ?total-quantity))
</pre><span>
In theory this would only have to recalculate the set when a new </span><code>A</code><span> was seen and then only if that return value changed then re evaluation of the </span><code>B</code><span> logic would have to occur.
Then again all of this needs to be taken with a grain of salt as data scenarios can  change the behavior of performance while executing rules.</span></div><div id="t1573757045055500" t="2019-11-14 18:44:05 bartuka insteresting error, I am using a private function inside the namespace of the rules and clara gave me the follow stacktrace

 #error {
 :cause var: #&apos;secland.securities.contract-rules/now-in-inst is not public
 :via
 [{:type clojure.lang.ExceptionInfo
   :message Failed compiling alpha node...
"><a href="#t1573757045055500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-11-14</span> <span class="t" onclick="H(this)">18:44:05</span>                 bartuka </span><span>insteresting error, I am using a private function inside the namespace of the rules and clara gave me the follow stacktrace

</span><pre>#error {
 :cause var: #&apos;secland.securities.contract-rules/now-in-inst is not public
 :via
 [{:type clojure.lang.ExceptionInfo
   :message Failed compiling alpha node...
</pre></div><div id="t1573757063055800" t="2019-11-14 18:44:23 bartuka I would like to understand more why"><a href="#t1573757063055800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-11-14</span> <span class="t" onclick="H(this)">18:44:23</span>                 bartuka </span><span>I would like to understand more why</span></div><div id="t1573757312056700" t="2019-11-14 18:48:32 ethanc @iagwanderson, Was the function was used inside the LHS of a rule?"><a href="#t1573757312056700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-11-14</span> <span class="t" onclick="H(this)">18:48:32</span>                  ethanc </span><span>@iagwanderson, Was the function was used inside the LHS of a rule?</span></div><div id="t1573757410057800" t="2019-11-14 18:50:10 ethanc nvm, i missed  Failed compiling alpha node . So the answer to my question would be yes."><a href="#t1573757410057800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-11-14</span> <span class="t" onclick="H(this)">18:50:10</span>                  ethanc </span><span>nvm, i missed </span><code>Failed compiling alpha node</code><span>. So the answer to my question would be yes.</span></div><div id="t1573757913064000" t="2019-11-14 18:58:33 ethanc The reason that this would occur would be due to how clara evaluates LHS/RHS. The LHS is assumed to be namespace agnostic, as nodes that make up the LHS(AlphaNodes, JoinNodes, ect.) could be shared across namespaces and rules in those namespaces, whereas the RHS(ProductionNodes) can’t be shared and can be seen as Namespace bound.

This means that Clara evaluates LHS nodes outside of the original namespace that they are defined within, and production nodes are evaluated within the namespace that they are defined. So, by having a private function within the LHS of a rule clara will cause an exception to be thrown due to illegal access. I’m not sure if that is documented anywhere, but it probably should be… I will see if i can find any."><a href="#t1573757913064000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-11-14</span> <span class="t" onclick="H(this)">18:58:33</span>                  ethanc </span><span>The reason that this would occur would be due to how clara evaluates LHS/RHS. The LHS is assumed to be namespace agnostic, as nodes that make up the LHS(AlphaNodes, JoinNodes, ect.) could be shared across namespaces and rules in those namespaces, whereas the RHS(ProductionNodes) can’t be shared and can be seen as Namespace bound.

This means that Clara evaluates LHS nodes outside of the original namespace that they are defined within, and production nodes are evaluated within the namespace that they are defined. So, by having a private function within the LHS of a rule clara will cause an exception to be thrown due to illegal access. I’m not sure if that is documented anywhere, but it probably should be… I will see if i can find any.</span></div><div id="t1573759814064700" t="2019-11-14 19:30:14 bartuka @ethanc thanks so much for the clear explanation, didn&apos;t find any explanation around it when I searched"><a href="#t1573759814064700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-11-14</span> <span class="t" onclick="H(this)">19:30:14</span>                 bartuka </span><span>@ethanc thanks so much for the clear explanation, didn&apos;t find any explanation around it when I searched</span></div><div id="t1573759957065000" t="2019-11-14 19:32:37 bartuka I have a more general question about code organization"><a href="#t1573759957065000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-11-14</span> <span class="t" onclick="H(this)">19:32:37</span>                 bartuka </span><span>I have a more general question about code organization</span></div><div id="t1573759999065900" t="2019-11-14 19:33:19 bartuka I have some rules that need to be run for specific clients and products, there is a recommended approach about how to organize the rules and the sessions for each situation?"><a href="#t1573759999065900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-11-14</span> <span class="t" onclick="H(this)">19:33:19</span>                 bartuka </span><span>I have some rules that need to be run for specific clients and products, there is a recommended approach about how to organize the rules and the sessions for each situation?</span></div><div id="t1573760028066400" t="2019-11-14 19:33:48 bartuka I would like to enable some users to enable/disable a rule, so probably having a reference to it in a database"><a href="#t1573760028066400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-11-14</span> <span class="t" onclick="H(this)">19:33:48</span>                 bartuka </span><span>I would like to enable some users to enable/disable a rule, so probably having a reference to it in a database</span></div><div id="t1573770800072700" t="2019-11-14 22:33:20 ethanc I guess it would depend on your use-case, i think the way i would handle them would be treating a namespace as a “feature package”. Then a given client could enable features(sets of rules) by namespace, of course through some abstraction(wouldn’t want consumers directly loading namespaces). That way when it comes to session creation you would only have to worry about loading a set of namespaces containing rules, ex
 (defn load-session 
  []
  (let [client-namespaces (get-namespaces-by-client)]
    &lt;require namespaces if not already done&gt;
    (com/mk-session client-namespaces)))
 
per rule filtering would probably be more tricky."><a href="#t1573770800072700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-11-14</span> <span class="t" onclick="H(this)">22:33:20</span>                  ethanc </span><span>I guess it would depend on your use-case, i think the way i would handle them would be treating a namespace as a “feature package”. Then a given client could enable features(sets of rules) by namespace, of course through some abstraction(wouldn’t want consumers directly loading namespaces). That way when it comes to session creation you would only have to worry about loading a set of namespaces containing rules, ex
</span><pre>(defn load-session 
  []
  (let [client-namespaces (get-namespaces-by-client)]
    &lt;require namespaces if not already done&gt;
    (com/mk-session client-namespaces)))
</pre><span>
per rule filtering would probably be more tricky.</span></div><div id="t1574799787073600" t="2019-11-26 20:23:07 bartuka hi, @ethanc thanks for the answer"><a href="#t1574799787073600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-11-26</span> <span class="t" onclick="H(this)">20:23:07</span>                 bartuka </span><span>hi, @ethanc thanks for the answer</span></div><div id="t1574799838074600" t="2019-11-26 20:23:58 bartuka I was out of work these days. I just tried your approach, but the problem is to pass a list of symbols to  mk-session , I am not able to use  apply  because this is a macro"><a href="#t1574799838074600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-11-26</span> <span class="t" onclick="H(this)">20:23:58</span>                 bartuka </span><span>I was out of work these days. I just tried your approach, but the problem is to pass a list of symbols to </span><code>mk-session</code><span>, I am not able to use </span><code>apply</code><span> because this is a macro</span></div><div id="t1574799846074800" t="2019-11-26 20:24:06 bartuka how are you handling this?"><a href="#t1574799846074800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-11-26</span> <span class="t" onclick="H(this)">20:24:06</span>                 bartuka </span><span>how are you handling this?</span></div><div id="t1574800754075200" t="2019-11-26 20:39:14 mikerod @iagwanderson  clara.rules.compiler/mk-session  can be used"><a href="#t1574800754075200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-11-26</span> <span class="t" onclick="H(this)">20:39:14</span>                 mikerod </span><span>@iagwanderson </span><code>clara.rules.compiler/mk-session</code><span> can be used</span></div><div id="t1574800765075500" t="2019-11-26 20:39:25 mikerod it’s the underlying fn - just have to deal with some boilerplate with quotes etc"><a href="#t1574800765075500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-11-26</span> <span class="t" onclick="H(this)">20:39:25</span>                 mikerod </span><span>it’s the underlying fn - just have to deal with some boilerplate with quotes etc</span></div><div id="t1574800787075700" t="2019-11-26 20:39:47 mikerod it’s signature is slightly different"><a href="#t1574800787075700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-11-26</span> <span class="t" onclick="H(this)">20:39:47</span>                 mikerod </span><span>it’s signature is slightly different</span></div><div id="t1574800813076000" t="2019-11-26 20:40:13 mikerod takes sequence of  sources-and-options"><a href="#t1574800813076000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-11-26</span> <span class="t" onclick="H(this)">20:40:13</span>                 mikerod </span><span>takes sequence of </span><code>sources-and-options</code></div><div id="t1574800818076200" t="2019-11-26 20:40:18 mikerod sources expected to come first"><a href="#t1574800818076200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-11-26</span> <span class="t" onclick="H(this)">20:40:18</span>                 mikerod </span><span>sources expected to come first</span></div><div id="t1574800834076500" t="2019-11-26 20:40:34 mikerod then keyword options"><a href="#t1574800834076500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-11-26</span> <span class="t" onclick="H(this)">20:40:34</span>                 mikerod </span><span>then keyword options</span></div><div id="t1574800848076800" t="2019-11-26 20:40:48 mikerod example  [&apos;my.ns.name :my-option :foo]"><a href="#t1574800848076800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-11-26</span> <span class="t" onclick="H(this)">20:40:48</span>                 mikerod </span><span>example </span><code>[&apos;my.ns.name :my-option :foo]</code></div><div id="t1574800962077100" t="2019-11-26 20:42:42 bartuka oh, cool. let me try out! thanks"><a href="#t1574800962077100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-11-26</span> <span class="t" onclick="H(this)">20:42:42</span>                 bartuka </span><span>oh, cool. let me try out! thanks</span></div><div id="t1574801001077300" t="2019-11-26 20:43:21 bartuka worked just fine o/"><a href="#t1574801001077300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-11-26</span> <span class="t" onclick="H(this)">20:43:21</span>                 bartuka </span><span>worked just fine o/</span></div><div id="t1574801509077500" t="2019-11-26 20:51:49 mikerod nice"><a href="#t1574801509077500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-11-26</span> <span class="t" onclick="H(this)">20:51:49</span>                 mikerod </span><span>nice</span></div><div id="t1575983125081300" t="2019-12-10 13:05:25 Konstantinos Tzanidakis Hi everyone, I was hoping to get some help on seriliazing the session in Clara Rules. I am fairly new to Clara and I am trying to start by implementing the example in the docs: &lt;http://www.clara-rules.org/docs/durability/&gt;, for my own facts (using maps along with fact-type-fn). However, during  deserialization  I am getting the following error:  nth not supported on this type: Element . Any ideas/suggestions would be more than welcomed."><a href="#t1575983125081300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-12-10</span> <span class="t" onclick="H(this)">13:05:25</span> Konstantinos Tzanidakis </span><span>Hi everyone, I was hoping to get some help on seriliazing the session in Clara Rules. I am fairly new to Clara and I am trying to start by implementing the example in the docs: &lt;http://www.clara-rules.org/docs/durability/&gt;, for my own facts (using maps along with fact-type-fn). However, during </span><code>deserialization</code><span> I am getting the following error: </span><code>nth not supported on this type: Element</code><span>. Any ideas/suggestions would be more than welcomed.</span></div><div id="t1575989640082500" t="2019-12-10 14:54:00 mikerod @konstantinos562 (1) is it possible to share what you have? &amp; (2) can I see the full stack trace (or the Clara-part of it) coming with this exception?"><a href="#t1575989640082500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-12-10</span> <span class="t" onclick="H(this)">14:54:00</span>                 mikerod </span><span>@konstantinos562 (1) is it possible to share what you have? &amp; (2) can I see the full stack trace (or the Clara-part of it) coming with this exception?</span></div><div id="t1575991231083500" t="2019-12-10 15:20:31 Konstantinos Tzanidakis @mikerod thanks a lot, I have probably figured this out, I was using maps instead of records but when I was storing the session using the serializer I was not providing the :fact-type-fn options as well as I was setting with-rulebase? to false. Most probably, because I didn&apos;t include the fact-type-fn, the deserializer was mistakenly trying to destruct the facts as &quot;Element&quot;s (or something like this). Thank you very much for the prompt response  🙂"><a href="#t1575991231083500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-12-10</span> <span class="t" onclick="H(this)">15:20:31</span> Konstantinos Tzanidakis </span><span>@mikerod thanks a lot, I have probably figured this out, I was using maps instead of records but when I was storing the session using the serializer I was not providing the :fact-type-fn options as well as I was setting with-rulebase? to false. Most probably, because I didn&apos;t include the fact-type-fn, the deserializer was mistakenly trying to destruct the facts as &quot;Element&quot;s (or something like this). Thank you very much for the prompt response </span><b>🙂</b></div><div id="t1575992008084600" t="2019-12-10 15:33:28 mikerod @konstantinos562 that makes sense. Yes, the durability layer stuff can certainly be a bit complicated since you do have to do things quite specifically"><a href="#t1575992008084600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-12-10</span> <span class="t" onclick="H(this)">15:33:28</span>                 mikerod </span><span>@konstantinos562 that makes sense. Yes, the durability layer stuff can certainly be a bit complicated since you do have to do things quite specifically</span></div><div id="t1576157382085700" t="2019-12-12 13:29:42 bartuka I have being caught in infinite-loops some times while using clara and I would like to know if there is any way to handle this issue?"><a href="#t1576157382085700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-12-12</span> <span class="t" onclick="H(this)">13:29:42</span>                 bartuka </span><span>I have being caught in infinite-loops some times while using clara and I would like to know if there is any way to handle this issue?</span></div><div id="t1576157429086700" t="2019-12-12 13:30:29 bartuka Every time it happened was due to error in logic, but would be great to have an exception for that or something"><a href="#t1576157429086700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-12-12</span> <span class="t" onclick="H(this)">13:30:29</span>                 bartuka </span><span>Every time it happened was due to error in logic, but would be great to have an exception for that or something</span></div><div id="t1576157463087200" t="2019-12-12 13:31:03 bartuka it&apos;s possible to see how many times each rule was called during that session?"><a href="#t1576157463087200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-12-12</span> <span class="t" onclick="H(this)">13:31:03</span>                 bartuka </span><span>it&apos;s possible to see how many times each rule was called during that session?</span></div><div id="t1576160771089700" t="2019-12-12 14:26:11 ethanc &gt;  it’s possible to see how many times each rule was called during that session?
Im not sure that there is a way to see the number of executions of a rule, but i do believe that the inspect namespace:
 https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/tools/inspect.cljc 
has some tooling around explanations of rules firing.

Additionally, I believe Will has been playing around with the idea of capturing scenarios that behave like infinite loops:
 https://github.com/cerner/clara-rules/pull/425"><a href="#t1576160771089700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-12-12</span> <span class="t" onclick="H(this)">14:26:11</span>                  ethanc </span><span>&gt;  it’s possible to see how many times each rule was called during that session?
Im not sure that there is a way to see the number of executions of a rule, but i do believe that the inspect namespace:
</span><a href="https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/tools/inspect.cljc" target="_blank">https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/tools/inspect.cljc</a><span>
has some tooling around explanations of rules firing.

Additionally, I believe Will has been playing around with the idea of capturing scenarios that behave like infinite loops:
</span><a href="https://github.com/cerner/clara-rules/pull/425" target="_blank">https://github.com/cerner/clara-rules/pull/425</a></div><div id="t1576163155090400" t="2019-12-12 15:05:55 bartuka @ethanc thanks for pointing the right directions o/"><a href="#t1576163155090400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-12-12</span> <span class="t" onclick="H(this)">15:05:55</span>                 bartuka </span><span>@ethanc thanks for pointing the right directions o/</span></div><div id="t1576199852090900" t="2019-12-13 01:17:32 geraldodev The 1st (= ?cd_paciente cd_paciente) is a binding (since there are no other on the local scope. The second (= ?cd_paciente cd_paciente) is a comparison because the binding is already established right ?"><a href="#t1576199852090900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-12-13</span> <span class="t" onclick="H(this)">01:17:32</span>              geraldodev </span><span>The 1st (= ?cd_paciente cd_paciente) is a binding (since there are no other on the local scope. The second (= ?cd_paciente cd_paciente) is a comparison because the binding is already established right ?</span></div><div id="t1576200006091600" t="2019-12-13 01:20:06 ethanc That is correct"><a href="#t1576200006091600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-12-13</span> <span class="t" onclick="H(this)">01:20:06</span>                  ethanc </span><span>That is correct</span></div><div id="t1576200106092900" t="2019-12-13 01:21:46 geraldodev Its beautiful . (error prone too) if i remove a char of ?cd_paciente I got two bindings"><a href="#t1576200106092900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-12-13</span> <span class="t" onclick="H(this)">01:21:46</span>              geraldodev </span><span>Its beautiful . (error prone too) if i remove a char of ?cd_paciente I got two bindings</span></div><div id="t1576200278096300" t="2019-12-13 01:24:38 ethanc Yeah, i&apos;ve wondered if the Clara compiler should warn on unused bindings..."><a href="#t1576200278096300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-12-13</span> <span class="t" onclick="H(this)">01:24:38</span>                  ethanc </span><span>Yeah, i&apos;ve wondered if the Clara compiler should warn on unused bindings...</span></div><div id="t1576238289097000" t="2019-12-13 11:58:09 bartuka this could be very handy"><a href="#t1576238289097000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-12-13</span> <span class="t" onclick="H(this)">11:58:09</span>                 bartuka </span><span>this could be very handy</span></div><div id="t1576252188000600" t="2019-12-13 15:49:48 mikerod @geraldodev yeah, because  ?binding-name  is just some arbitrary local name you want to give for the context"><a href="#t1576252188000600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-12-13</span> <span class="t" onclick="H(this)">15:49:48</span>                 mikerod </span><span>@geraldodev yeah, because </span><code>?binding-name</code><span> is just some arbitrary local name you want to give for the context</span></div><div id="t1576252204000900" t="2019-12-13 15:50:04 mikerod the warning isn’t a bad idea, @ethanc is a genius"><a href="#t1576252204000900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-12-13</span> <span class="t" onclick="H(this)">15:50:04</span>                 mikerod </span><span>the warning isn’t a bad idea, @ethanc is a genius</span></div><div id="t1576252268001600" t="2019-12-13 15:51:08 ethanc I will log an issue for enhancement, when i get a few free seconds @mikerod"><a href="#t1576252268001600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-12-13</span> <span class="t" onclick="H(this)">15:51:08</span>                  ethanc </span><span>I will log an issue for enhancement, when i get a few free seconds @mikerod</span></div><div id="t1576258108004200" t="2019-12-13 17:28:28 geraldodev @mikerod the warnings from clj-kondo have improved a lot my experience with clojure."><a href="#t1576258108004200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-12-13</span> <span class="t" onclick="H(this)">17:28:28</span>              geraldodev </span><span>@mikerod the warnings from clj-kondo have improved a lot my experience with clojure.</span></div><div id="t1576258609004700" t="2019-12-13 17:36:49 mikerod @geraldodev I’ve started to play around with clj-kondo, but haven’t done so very seriously yet - it looks promising"><a href="#t1576258609004700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-12-13</span> <span class="t" onclick="H(this)">17:36:49</span>                 mikerod </span><span>@geraldodev I’ve started to play around with clj-kondo, but haven’t done so very seriously yet - it looks promising</span></div><div id="t1576258631005300" t="2019-12-13 17:37:11 mikerod for a Clara DSL thing though - not thinking it can help you much? like in the case of this variable binding thing?"><a href="#t1576258631005300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-12-13</span> <span class="t" onclick="H(this)">17:37:11</span>                 mikerod </span><span>for a Clara DSL thing though - not thinking it can help you much? like in the case of this variable binding thing?</span></div><div id="t1576258646005700" t="2019-12-13 17:37:26 mikerod I know it does have some pretty good extension points though - so can do some nice things"><a href="#t1576258646005700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-12-13</span> <span class="t" onclick="H(this)">17:37:26</span>                 mikerod </span><span>I know it does have some pretty good extension points though - so can do some nice things</span></div><div id="t1576260674008900" t="2019-12-13 18:11:14 geraldodev @mikerod I&apos;ve asked on #clj-kondo if it&apos;s possible to lint the unused binding case"><a href="#t1576260674008900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-12-13</span> <span class="t" onclick="H(this)">18:11:14</span>              geraldodev </span><span>@mikerod I&apos;ve asked on #clj-kondo if it&apos;s possible to lint the unused binding case</span></div><div id="t1576260883010800" t="2019-12-13 18:14:43 geraldodev I think it&apos;s a work for a linter. But it&apos;s a very especific syntax. for macros that follows defn or def pattern you simply configure :lint-as on a config file like: {:lint-as
 {com.fulcrologic.fulcro.components/defsc clojure.core/defn
  }}"><a href="#t1576260883010800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-12-13</span> <span class="t" onclick="H(this)">18:14:43</span>              geraldodev </span><span>I think it&apos;s a work for a linter. But it&apos;s a very especific syntax. for macros that follows defn or def pattern you simply configure :lint-as on a config file like: {:lint-as
 {com.fulcrologic.fulcro.components/defsc clojure.core/defn
  }}</span></div><div id="t1576260945011400" t="2019-12-13 18:15:45 mikerod @geraldodev yeah, I’ve seen how to do that pattern following like you have above"><a href="#t1576260945011400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-12-13</span> <span class="t" onclick="H(this)">18:15:45</span>                 mikerod </span><span>@geraldodev yeah, I’ve seen how to do that pattern following like you have above</span></div><div id="t1576260948011600" t="2019-12-13 18:15:48 mikerod I’ve used that one"><a href="#t1576260948011600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-12-13</span> <span class="t" onclick="H(this)">18:15:48</span>                 mikerod </span><span>I’ve used that one</span></div><div id="t1576260958012000" t="2019-12-13 18:15:58 mikerod but the clara DSL is of course more complicated"><a href="#t1576260958012000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-12-13</span> <span class="t" onclick="H(this)">18:15:58</span>                 mikerod </span><span>but the clara DSL is of course more complicated</span></div><div id="t1576260994012500" t="2019-12-13 18:16:34 mikerod of course for unused, it may be just not finding the symbol more than one time in the entire DSL form hah"><a href="#t1576260994012500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-12-13</span> <span class="t" onclick="H(this)">18:16:34</span>                 mikerod </span><span>of course for unused, it may be just not finding the symbol more than one time in the entire DSL form hah</span></div><div id="t1576261005012900" t="2019-12-13 18:16:45 mikerod Ethan did log a Clara issue it looks like now though"><a href="#t1576261005012900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-12-13</span> <span class="t" onclick="H(this)">18:16:45</span>                 mikerod </span><span>Ethan did log a Clara issue it looks like now though</span></div><div id="t1576261054013900" t="2019-12-13 18:17:34 mikerod His proposal targets more on the AST compilation side - which is better since the DSL layer is something that is “pluggable” in Clara (people could use their own and target same AST pre-compilation)"><a href="#t1576261054013900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-12-13</span> <span class="t" onclick="H(this)">18:17:34</span>                 mikerod </span><span>His proposal targets more on the AST compilation side - which is better since the DSL layer is something that is “pluggable” in Clara (people could use their own and target same AST pre-compilation)</span></div><div id="t1576261197015000" t="2019-12-13 18:19:57 geraldodev Yesterday was my 1st day with clara. I&apos;m enjoying."><a href="#t1576261197015000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-12-13</span> <span class="t" onclick="H(this)">18:19:57</span>              geraldodev </span><span>Yesterday was my 1st day with clara. I&apos;m enjoying.</span></div><div id="t1576262530015700" t="2019-12-13 18:42:10 mikerod oh, nice"><a href="#t1576262530015700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-12-13</span> <span class="t" onclick="H(this)">18:42:10</span>                 mikerod </span><span>oh, nice</span></div><div id="t1576269380016300" t="2019-12-13 20:36:20 geraldodev About processing facts that comes from sql databases on long running sessions. Because of mutation, one has to query the session looking for the fact based on the primary key of the table, compare it with the current value and if it&apos;s different retract the old fact and insert again. Is that correct ?"><a href="#t1576269380016300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-12-13</span> <span class="t" onclick="H(this)">20:36:20</span>              geraldodev </span><span>About processing facts that comes from sql databases on long running sessions. Because of mutation, one has to query the session looking for the fact based on the primary key of the table, compare it with the current value and if it&apos;s different retract the old fact and insert again. Is that correct ?</span></div><div id="t1576278647016600" t="2019-12-13 23:10:47 Eduardo Mata what does this even mean&quot;
 Java.lang.IllegalStateException: Attempting to call unbound fn: #&apos;"><a href="#t1576278647016600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-12-13</span> <span class="t" onclick="H(this)">23:10:47</span>            Eduardo Mata </span><span>what does this even mean&quot;
</span><pre>Java.lang.IllegalStateException: Attempting to call unbound fn: #&apos;</pre></div><div id="t1576278770017000" t="2019-12-13 23:12:50 Eduardo Mata ups wrong place"><a href="#t1576278770017000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-12-13</span> <span class="t" onclick="H(this)">23:12:50</span>            Eduardo Mata </span><span>ups wrong place</span></div><div id="t1577131177002000" t="2019-12-23 19:59:37 ethanc @geraldodev, sorry i missed your comment:
&gt; About processing facts that comes from sql databases on long running sessions. Because of mutation, one has to query the session looking for the fact based on the primary key of the table, compare it with the current value and if it’s different retract the old fact and insert again. Is that correct ? 
I think that makes sense, for changes outside of the session, you would have to manually update the fact inside the session via an external retract followed by insertion of the fact."><a href="#t1577131177002000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-12-23</span> <span class="t" onclick="H(this)">19:59:37</span>                  ethanc </span><span>@geraldodev, sorry i missed your comment:
&gt; About processing facts that comes from sql databases on long running sessions. Because of mutation, one has to query the session looking for the fact based on the primary key of the table, compare it with the current value and if it’s different retract the old fact and insert again. Is that correct ? 
I think that makes sense, for changes outside of the session, you would have to manually update the fact inside the session via an external retract followed by insertion of the fact.</span></div><div id="t1577490515003400" t="2019-12-27 23:48:35 futuro Is it possible to compose left hand sides in rules?"><a href="#t1577490515003400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-12-27</span> <span class="t" onclick="H(this)">23:48:35</span>                  futuro </span><span>Is it possible to compose left hand sides in rules?</span></div><div id="t1577491038006700" t="2019-12-27 23:57:18 ethanc Could you elaborate on what you mean by composing?"><a href="#t1577491038006700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-12-27</span> <span class="t" onclick="H(this)">23:57:18</span>                  ethanc </span><span>Could you elaborate on what you mean by composing?</span></div><div id="t1577494301008200" t="2019-12-28 00:51:41 futuro I have three rules which have the same fact expressions in their LHS, and I’d like to extract them to aid in reuse. "><a href="#t1577494301008200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-12-28</span> <span class="t" onclick="H(this)">00:51:41</span>                  futuro </span><span>I have three rules which have the same fact expressions in their LHS, and I’d like to extract them to aid in reuse. </span></div><div id="t1577494324009100" t="2019-12-28 00:52:04 futuro I’m not at a computer, but I can write up a little snippet later if that’d make it clearer. "><a href="#t1577494324009100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-12-28</span> <span class="t" onclick="H(this)">00:52:04</span>                  futuro </span><span>I’m not at a computer, but I can write up a little snippet later if that’d make it clearer. </span></div><div id="t1577494441012100" t="2019-12-28 00:54:01 ethanc I would usually use an intermediate fact in that scenario, one rule that inserts the fact constrained by the common lhs and then downstream rules can rely on the presence of the intermediate fact"><a href="#t1577494441012100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-12-28</span> <span class="t" onclick="H(this)">00:54:01</span>                  ethanc </span><span>I would usually use an intermediate fact in that scenario, one rule that inserts the fact constrained by the common lhs and then downstream rules can rely on the presence of the intermediate fact</span></div><div id="t1577494644014200" t="2019-12-28 00:57:24 futuro Hmmm, yeah, that could work. I suppose you’d put any shared fields you needed into this shared fact, which would allow downstream rules to pull them back out, yeah?"><a href="#t1577494644014200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-12-28</span> <span class="t" onclick="H(this)">00:57:24</span>                  futuro </span><span>Hmmm, yeah, that could work. I suppose you’d put any shared fields you needed into this shared fact, which would allow downstream rules to pull them back out, yeah?</span></div><div id="t1577495431017400" t="2019-12-28 01:10:31 ethanc Yes, they would carry what&apos;s needed. In some cases simply wrapping the whole fact might make sense"><a href="#t1577495431017400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-12-28</span> <span class="t" onclick="H(this)">01:10:31</span>                  ethanc </span><span>Yes, they would carry what&apos;s needed. In some cases simply wrapping the whole fact might make sense</span></div><div id="t1577498229018100" t="2019-12-28 01:57:09 futuro Swanky, thank you @ethanc !"><a href="#t1577498229018100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2019-12-28</span> <span class="t" onclick="H(this)">01:57:09</span>                  futuro </span><span>Swanky, thank you @ethanc !</span></div><div id="t1577816345020700" t="2020-12-31 18:19:05 Matthew Pettis Does anyone know of any examples of clara-rules that solve logic problems?  Or similarily, sudoku?  I&apos;m looking for examples of rules, or good architecture, to make rules that enforce unique exclusions.  Such as in logic problems found here:  https://www.brainzilla.com/logic/logic-grid/apples-to-apples/"><a href="#t1577816345020700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-12-31</span> <span class="t" onclick="H(this)">18:19:05</span>          Matthew Pettis </span><span>Does anyone know of any examples of clara-rules that solve logic problems?  Or similarily, sudoku?  I&apos;m looking for examples of rules, or good architecture, to make rules that enforce unique exclusions.  Such as in logic problems found here: </span><a href="https://www.brainzilla.com/logic/logic-grid/apples-to-apples/" target="_blank">https://www.brainzilla.com/logic/logic-grid/apples-to-apples/</a></div><div id="t1577816446022400" t="2020-12-31 18:20:46 Matthew Pettis I&quot;m looking to do this in an industrial setting (&quot;machine A can&apos;t be on if machine B is on&quot;, or &quot;machine B cannot turn on unless machine A is already on&quot;, etc.)  Logic puzzles seem to be a template for what this concept is..."><a href="#t1577816446022400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-12-31</span> <span class="t" onclick="H(this)">18:20:46</span>          Matthew Pettis </span><span>I&quot;m looking to do this in an industrial setting (&quot;machine A can&apos;t be on if machine B is on&quot;, or &quot;machine B cannot turn on unless machine A is already on&quot;, etc.)  Logic puzzles seem to be a template for what this concept is...</span></div><div id="t1577820581023400" t="2020-12-31 19:29:41 geraldodev https://gist.github.com/geraldodev/076ccb995db907644070f134656fb74b  Hi can you comment on this gist. It looks like defsession with :fact-type-fn does not stick with the var"><a href="#t1577820581023400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-12-31</span> <span class="t" onclick="H(this)">19:29:41</span>              geraldodev </span><a href="https://gist.github.com/geraldodev/076ccb995db907644070f134656fb74b" target="_blank">https://gist.github.com/geraldodev/076ccb995db907644070f134656fb74b</a><span> Hi can you comment on this gist. It looks like defsession with :fact-type-fn does not stick with the var</span></div><div id="t1577822722023600" t="2020-12-31 20:05:22 Matthew Pettis Thank you, I&apos;ll check out."><a href="#t1577822722023600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-12-31</span> <span class="t" onclick="H(this)">20:05:22</span>               Matthew Pettis </span><span>Thank you, I&apos;ll check out.</span></div><div id="t1577822949023900" t="2020-12-31 20:09:09 Matthew Pettis Sorry, thought this was related to my question..."><a href="#t1577822949023900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-12-31</span> <span class="t" onclick="H(this)">20:09:09</span>               Matthew Pettis </span><span>Sorry, thought this was related to my question...</span></div><div id="t1577825699024100" t="2020-12-31 20:54:59 ethanc @U0516053R,
I don’t typically use the defsession macro, but it seems to me that it is building the call to mk-session differently.

 https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/rules.cljc#L368 

 (mk-session [:fact-type-fn :type]) 
vs
 (mk-session :fact-type-fn :type) 
so the  session  in this case is empty(no productions) due to  defsession  not appending the current namespace."><a href="#t1577825699024100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-12-31</span> <span class="t" onclick="H(this)">20:54:59</span>                       ethanc </span><span>@U0516053R,
I don’t typically use the defsession macro, but it seems to me that it is building the call to mk-session differently.

</span><a href="https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/rules.cljc#L368" target="_blank">https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/rules.cljc#L368</a><span>

</span><pre>(mk-session [:fact-type-fn :type])</pre><span>
vs
</span><pre>(mk-session :fact-type-fn :type)</pre><span>
so the </span><code>session</code><span> in this case is empty(no productions) due to </span><code>defsession</code><span> not appending the current namespace.</span></div><div id="t1577825850024500" t="2020-12-31 20:57:30 ethanc To get this to work,
 (defsession session `app.mv.clara2 :fact-type-fn :type) 
the namespace would have to be provided"><a href="#t1577825850024500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-12-31</span> <span class="t" onclick="H(this)">20:57:30</span>                       ethanc </span><span>To get this to work,
</span><pre>(defsession session `app.mv.clara2 :fact-type-fn :type)</pre><span>
the namespace would have to be provided</span></div><div id="t1577842716024700" t="2020-01-01 01:38:36 geraldodev @U3KC48GHW Thank you!. I&apos;ve started with (def session (mk-session . Later I&apos;ve switched to defsession. Also I was trying to infer changes on the sql table based on the primary key. The plan was to baby sit the session like an atom. I&apos;ve stumbled across a issue that shows that clara ignores facts that are not touched by rules and queries.  https://github.com/cerner/clara-rules/issues/48  . I was intending to use it wrong. It looks like reading the table, insert the facts and collect the results and let the session go way is a more correct approach.."><a href="#t1577842716024700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-01</span> <span class="t" onclick="H(this)">01:38:36</span>                   geraldodev </span><span>@U3KC48GHW Thank you!. I&apos;ve started with (def session (mk-session . Later I&apos;ve switched to defsession. Also I was trying to infer changes on the sql table based on the primary key. The plan was to baby sit the session like an atom. I&apos;ve stumbled across a issue that shows that clara ignores facts that are not touched by rules and queries. </span><a href="https://github.com/cerner/clara-rules/issues/48" target="_blank">https://github.com/cerner/clara-rules/issues/48</a><span> . I was intending to use it wrong. It looks like reading the table, insert the facts and collect the results and let the session go way is a more correct approach..</span></div><div id="t1578340529034500" t="2020-01-06 19:55:29 Eduardo Mata I am applying a basic rule saying
 (defrule missing-information
[?event &lt;- Event (nil? flower-id) (= ?id _id)]
=&gt;
(insert! -&gt;AddError _id  :error &quot;Missing Flower _id&quot;))"><a href="#t1578340529034500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-06</span> <span class="t" onclick="H(this)">19:55:29</span>            Eduardo Mata </span><span>I am applying a basic rule saying
</span><pre>(defrule missing-information
[?event &lt;- Event (nil? flower-id) (= ?id _id)]
=&gt;
(insert! -&gt;AddError _id  :error &quot;Missing Flower _id&quot;))</pre></div><div id="t1578340570035400" t="2020-01-06 19:56:10 Eduardo Mata for some reason, I have a Record with flower-id and it clara still telling me the flower-id is missing"><a href="#t1578340570035400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-06</span> <span class="t" onclick="H(this)">19:56:10</span>            Eduardo Mata </span><span>for some reason, I have a Record with flower-id and it clara still telling me the flower-id is missing</span></div><div id="t1578341904038500" t="2020-01-06 20:18:24 mikerod @contact904 do you have more than one Event? Are you saying an Event with a non-nil flower-id and a unique _id is being matched with the above rule which insets the AddError fact? Your -&gt;AddError syntax seems incorrect since it isn’t calling the fn to but guessing that this is maybe pseudo-code"><a href="#t1578341904038500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-06</span> <span class="t" onclick="H(this)">20:18:24</span>                 mikerod </span><span>@contact904 do you have more than one Event? Are you saying an Event with a non-nil flower-id and a unique _id is being matched with the above rule which insets the AddError fact? Your -&gt;AddError syntax seems incorrect since it isn’t calling the fn to but guessing that this is maybe pseudo-code</span></div><div id="t1578342095039500" t="2020-01-06 20:21:35 Eduardo Mata AddError is a new Record with fields  _id, error, value   it is close to a pseudo-code"><a href="#t1578342095039500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-06</span> <span class="t" onclick="H(this)">20:21:35</span>            Eduardo Mata </span><span>AddError is a new Record with fields </span><code>_id, error, value</code><span>  it is close to a pseudo-code</span></div><div id="t1578342124040000" t="2020-01-06 20:22:04 Eduardo Mata I am confused because I have been usings this rule for a long time, this is the first time I get this error"><a href="#t1578342124040000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-06</span> <span class="t" onclick="H(this)">20:22:04</span>            Eduardo Mata </span><span>I am confused because I have been usings this rule for a long time, this is the first time I get this error</span></div><div id="t1578342356040400" t="2020-01-06 20:25:56 Eduardo Mata I see what is my problem. I have similar _id;s"><a href="#t1578342356040400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-06</span> <span class="t" onclick="H(this)">20:25:56</span>            Eduardo Mata </span><span>I see what is my problem. I have similar _id;s</span></div><div id="t1578342899041000" t="2020-01-06 20:34:59 mikerod @contact904  (insert! -&gt;AddError _id  :error &quot;Missing Flower _id&quot;)  is missing parens was my comment on syntax
 (insert! (-&gt;AddError _id  :error &quot;Missing Flower _id&quot;))"><a href="#t1578342899041000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-06</span> <span class="t" onclick="H(this)">20:34:59</span>                 mikerod </span><span>@contact904 </span><code>(insert! -&gt;AddError _id  :error &quot;Missing Flower _id&quot;)</code><span> is missing parens was my comment on syntax
</span><code>(insert! (-&gt;AddError _id  :error &quot;Missing Flower _id&quot;))</code></div><div id="t1578407521048300" t="2020-01-07 14:32:01 Konstantinos Tzanidakis Hi all, I want to serialize/deserialize the working-memory separately so I started off by using a simple implementation for  IWorkingMemorySerializer  that serializes to an atom (as per Clara&apos;s docs) and deserializing from the atom by derefing it. That works perfectly fine, in that I am able to run queries and get the same results from both the original and deserialized session. However, if I add the extra step to write to fressian and read fressian to the ser/deserializer of the  IWorkingMemorySerializer  , all queries in the deserialized version of the session return with nil: eg.  ({:?crn nil})  while the same query on the original is returning  ({:?crn {:fact-type :client-representative-notification, :name &quot;Alice&quot;, :client &quot;Acme&quot;, :level :high}})  . I should note that I am fairly new to clara rules. Has anyone come across something like this before?"><a href="#t1578407521048300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-07</span> <span class="t" onclick="H(this)">14:32:01</span> Konstantinos Tzanidakis </span><span>Hi all, I want to serialize/deserialize the working-memory separately so I started off by using a simple implementation for </span><code>IWorkingMemorySerializer</code><span> that serializes to an atom (as per Clara&apos;s docs) and deserializing from the atom by derefing it. That works perfectly fine, in that I am able to run queries and get the same results from both the original and deserialized session. However, if I add the extra step to write to fressian and read fressian to the ser/deserializer of the </span><code>IWorkingMemorySerializer</code><span> , all queries in the deserialized version of the session return with nil: eg. </span><code>({:?crn nil})</code><span> while the same query on the original is returning </span><code>({:?crn {:fact-type :client-representative-notification, :name &quot;Alice&quot;, :client &quot;Acme&quot;, :level :high}})</code><span> . I should note that I am fairly new to clara rules. Has anyone come across something like this before?</span></div><div id="t1578409791050100" t="2020-01-07 15:09:51 ethanc @konstantinos562,
Do you have a small snippet, it would help me reproduce it locally?"><a href="#t1578409791050100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-07</span> <span class="t" onclick="H(this)">15:09:51</span>                  ethanc </span><span>@konstantinos562,
Do you have a small snippet, it would help me reproduce it locally?</span></div><div id="t1578409944050600" t="2020-01-07 15:12:24 Konstantinos Tzanidakis Hi @ethanc do you need the rules as well?"><a href="#t1578409944050600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-07</span> <span class="t" onclick="H(this)">15:12:24</span> Konstantinos Tzanidakis </span><span>Hi @ethanc do you need the rules as well?</span></div><div id="t1578409988050900" t="2020-01-07 15:13:08 Konstantinos Tzanidakis (defrecord WorkingMemoryAtomSerializer [input output]
  d/IWorkingMemorySerializer
  (serialize-facts [_ facts]
    (reset! state (write-fressian facts)))
  (deserialize-facts [this]
    (-&gt; @state io/input-stream read-fressian)))"><a href="#t1578409988050900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-07</span> <span class="t" onclick="H(this)">15:13:08</span> Konstantinos Tzanidakis </span><pre>(defrecord WorkingMemoryAtomSerializer [input output]
  d/IWorkingMemorySerializer
  (serialize-facts [_ facts]
    (reset! state (write-fressian facts)))
  (deserialize-facts [this]
    (-&gt; @state io/input-stream read-fressian)))</pre></div><div id="t1578410052051800" t="2020-01-07 15:14:12 Konstantinos Tzanidakis with  (def state (atom nil))  in the namespace"><a href="#t1578410052051800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-07</span> <span class="t" onclick="H(this)">15:14:12</span> Konstantinos Tzanidakis </span><span>with </span><code>(def state (atom nil))</code><span> in the namespace</span></div><div id="t1578410076052100" t="2020-01-07 15:14:36 Konstantinos Tzanidakis and the read and write fressian as follows"><a href="#t1578410076052100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-07</span> <span class="t" onclick="H(this)">15:14:36</span> Konstantinos Tzanidakis </span><span>and the read and write fressian as follows</span></div><div id="t1578410080052500" t="2020-01-07 15:14:40 Konstantinos Tzanidakis (defn write-fressian [obj]
  (let [baos (ByteArrayOutputStream.)
        wr   (frz/create-writer baos)]
    (frz/write-object wr obj)
    (.toByteArray baos)))

(defn read-fressian [b]
  (-&gt; b frz/create-reader frz/read-object))"><a href="#t1578410080052500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-07</span> <span class="t" onclick="H(this)">15:14:40</span> Konstantinos Tzanidakis </span><pre>(defn write-fressian [obj]
  (let [baos (ByteArrayOutputStream.)
        wr   (frz/create-writer baos)]
    (frz/write-object wr obj)
    (.toByteArray baos)))

(defn read-fressian [b]
  (-&gt; b frz/create-reader frz/read-object))</pre></div><div id="t1578410087052800" t="2020-01-07 15:14:47 Konstantinos Tzanidakis sorry for the long posting all"><a href="#t1578410087052800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-07</span> <span class="t" onclick="H(this)">15:14:47</span> Konstantinos Tzanidakis </span><span>sorry for the long posting all</span></div><div id="t1578410150054000" t="2020-01-07 15:15:50 Konstantinos Tzanidakis NB: I have replaced fressian with nippy/freeze and nippy/thaw and it works perfectly fine now. I am not sure what the issue was (most probably I am doing something wrong there)"><a href="#t1578410150054000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-07</span> <span class="t" onclick="H(this)">15:15:50</span> Konstantinos Tzanidakis </span><span>NB: I have replaced fressian with nippy/freeze and nippy/thaw and it works perfectly fine now. I am not sure what the issue was (most probably I am doing something wrong there)</span></div><div id="t1578410171054300" t="2020-01-07 15:16:11 mikerod @konstantinos562 not sure what  frz  ns is referring to"><a href="#t1578410171054300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-07</span> <span class="t" onclick="H(this)">15:16:11</span>                 mikerod </span><span>@konstantinos562 not sure what </span><code>frz</code><span> ns is referring to</span></div><div id="t1578410183054700" t="2020-01-07 15:16:23 mikerod You may just not have setup good read/write handlers for your facts"><a href="#t1578410183054700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-07</span> <span class="t" onclick="H(this)">15:16:23</span>                 mikerod </span><span>You may just not have setup good read/write handlers for your facts</span></div><div id="t1578410195055200" t="2020-01-07 15:16:35 mikerod Fressian’s defaults tend to be insufficient"><a href="#t1578410195055200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-07</span> <span class="t" onclick="H(this)">15:16:35</span>                 mikerod </span><span>Fressian’s defaults tend to be insufficient</span></div><div id="t1578410196055400" t="2020-01-07 15:16:36 Konstantinos Tzanidakis sorry it&apos;s the requirement:  [clojure.data.fressian :as frz]"><a href="#t1578410196055400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-07</span> <span class="t" onclick="H(this)">15:16:36</span> Konstantinos Tzanidakis </span><span>sorry it&apos;s the requirement: </span><code>[clojure.data.fressian :as frz]</code></div><div id="t1578410215055900" t="2020-01-07 15:16:55 mikerod or they will cause many clj data structures to become Java structures - or not the same as before"><a href="#t1578410215055900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-07</span> <span class="t" onclick="H(this)">15:16:55</span>                 mikerod </span><span>or they will cause many clj data structures to become Java structures - or not the same as before</span></div><div id="t1578410253057000" t="2020-01-07 15:17:33 mikerod you can see Clara defines a more robust set of fressian handlers for clj to clj serialization  https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/rules/durability/fressian.clj#L231"><a href="#t1578410253057000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-07</span> <span class="t" onclick="H(this)">15:17:33</span>                 mikerod </span><span>you can see Clara defines a more robust set of fressian handlers for clj to clj serialization </span><a href="https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/rules/durability/fressian.clj#L231" target="_blank">https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/rules/durability/fressian.clj#L231</a></div><div id="t1578410267057600" t="2020-01-07 15:17:47 mikerod however, there really is no compelling reason to not just use  nippy  if you have it set up"><a href="#t1578410267057600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-07</span> <span class="t" onclick="H(this)">15:17:47</span>                 mikerod </span><span>however, there really is no compelling reason to not just use </span><code>nippy</code><span> if you have it set up</span></div><div id="t1578410283058200" t="2020-01-07 15:18:03 mikerod I wouldn’t have used Fressian to impl Clara’s session serialization if I were to do it again today. it is difficult to work with in what it provides by default and I don’t think it is any better than something like  nippy  or perhaps a few others. It is also not documented super well and at the “primitive” level makes some unavoidable Java collections that are awkward to convert from (and also wasting perf time)"><a href="#t1578410283058200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-07</span> <span class="t" onclick="H(this)">15:18:03</span>                 mikerod </span><span>I wouldn’t have used Fressian to impl Clara’s session serialization if I were to do it again today. it is difficult to work with in what it provides by default and I don’t think it is any better than something like </span><code>nippy</code><span> or perhaps a few others. It is also not documented super well and at the “primitive” level makes some unavoidable Java collections that are awkward to convert from (and also wasting perf time)</span></div><div id="t1578410291058600" t="2020-01-07 15:18:11 Konstantinos Tzanidakis for this example, I have not set up any handlers but the facts are fairly simple
 [{:fact-type :client-representative :name &quot;Alice&quot; :client &quot;Acme&quot;}
 {:fact-type :support-request :client &quot;Acme&quot; :level :high}]"><a href="#t1578410291058600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-07</span> <span class="t" onclick="H(this)">15:18:11</span> Konstantinos Tzanidakis </span><span>for this example, I have not set up any handlers but the facts are fairly simple
</span><pre>[{:fact-type :client-representative :name &quot;Alice&quot; :client &quot;Acme&quot;}
 {:fact-type :support-request :client &quot;Acme&quot; :level :high}]</pre></div><div id="t1578410299058800" t="2020-01-07 15:18:19 mikerod (this is all pluggable and could be implemented with something else on Clara’s side just as well too)"><a href="#t1578410299058800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-07</span> <span class="t" onclick="H(this)">15:18:19</span>                 mikerod </span><span>(this is all pluggable and could be implemented with something else on Clara’s side just as well too)</span></div><div id="t1578410327059200" t="2020-01-07 15:18:47 mikerod try to Fressian write/read that and see that it returns you the facts in the same structure"><a href="#t1578410327059200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-07</span> <span class="t" onclick="H(this)">15:18:47</span>                 mikerod </span><span>try to Fressian write/read that and see that it returns you the facts in the same structure</span></div><div id="t1578410334059400" t="2020-01-07 15:18:54 mikerod leaving Clara session/rules out of the test"><a href="#t1578410334059400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-07</span> <span class="t" onclick="H(this)">15:18:54</span>                 mikerod </span><span>leaving Clara session/rules out of the test</span></div><div id="t1578410351059600" t="2020-01-07 15:19:11 mikerod that may give some insight"><a href="#t1578410351059600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-07</span> <span class="t" onclick="H(this)">15:19:11</span>                 mikerod </span><span>that may give some insight</span></div><div id="t1578410413060400" t="2020-01-07 15:20:13 Konstantinos Tzanidakis @mikerod simply using the fressian write/read does work correctly in REPL"><a href="#t1578410413060400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-07</span> <span class="t" onclick="H(this)">15:20:13</span> Konstantinos Tzanidakis </span><span>@mikerod simply using the fressian write/read does work correctly in REPL</span></div><div id="t1578410446061100" t="2020-01-07 15:20:46 Konstantinos Tzanidakis yes, I think I will use the nippy as it seems to be something in the  fressian  side that I cannot track at the moment"><a href="#t1578410446061100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-07</span> <span class="t" onclick="H(this)">15:20:46</span> Konstantinos Tzanidakis </span><span>yes, I think I will use the nippy as it seems to be something in the </span><code>fressian</code><span> side that I cannot track at the moment</span></div><div id="t1578410477061700" t="2020-01-07 15:21:17 mikerod &gt; simply using the fressian write/read does work correctly in REPL
You’ve analyzed waht is returned? is it still a clj vector with 2 clj maps etc?"><a href="#t1578410477061700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-07</span> <span class="t" onclick="H(this)">15:21:17</span>                 mikerod </span><span>&gt; simply using the fressian write/read does work correctly in REPL
You’ve analyzed waht is returned? is it still a clj vector with 2 clj maps etc?</span></div><div id="t1578410484062000" t="2020-01-07 15:21:24 Konstantinos Tzanidakis thank you very much for the prompt responses and help!"><a href="#t1578410484062000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-07</span> <span class="t" onclick="H(this)">15:21:24</span> Konstantinos Tzanidakis </span><span>thank you very much for the prompt responses and help!</span></div><div id="t1578410510062800" t="2020-01-07 15:21:50 Konstantinos Tzanidakis @mikerod yes it returns exactly the same facts that are serialized; i.e. a vector of two clj maps"><a href="#t1578410510062800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-07</span> <span class="t" onclick="H(this)">15:21:50</span> Konstantinos Tzanidakis </span><span>@mikerod yes it returns exactly the same facts that are serialized; i.e. a vector of two clj maps</span></div><div id="t1578410515062900" t="2020-01-07 15:21:55 mikerod I’d have to experiment some to look close, can’t right now"><a href="#t1578410515062900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-07</span> <span class="t" onclick="H(this)">15:21:55</span>                 mikerod </span><span>I’d have to experiment some to look close, can’t right now</span></div><div id="t1578410599063200" t="2020-01-07 15:23:19 mikerod I have some examples in  http://www.metasimple.org/2018/02/19/clj-fressian-ext.html"><a href="#t1578410599063200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-07</span> <span class="t" onclick="H(this)">15:23:19</span>                 mikerod </span><span>I have some examples in </span><a href="http://www.metasimple.org/2018/02/19/clj-fressian-ext.html" target="_blank">http://www.metasimple.org/2018/02/19/clj-fressian-ext.html</a></div><div id="t1578410605063500" t="2020-01-07 15:23:25 mikerod where things don’t work out-of-the-box with conversions and types"><a href="#t1578410605063500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-07</span> <span class="t" onclick="H(this)">15:23:25</span>                 mikerod </span><span>where things don’t work out-of-the-box with conversions and types</span></div><div id="t1578410623063700" t="2020-01-07 15:23:43 mikerod Under “Default handlers”"><a href="#t1578410623063700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-07</span> <span class="t" onclick="H(this)">15:23:43</span>                 mikerod </span><span>Under “Default handlers”</span></div><div id="t1578410639064000" t="2020-01-07 15:23:59 mikerod However, didn’t mention anything with vectors/maps there"><a href="#t1578410639064000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-07</span> <span class="t" onclick="H(this)">15:23:59</span>                 mikerod </span><span>However, didn’t mention anything with vectors/maps there</span></div><div id="t1578410812064500" t="2020-01-07 15:26:52 mikerod I immediately see that types at least aren’t preserved
 (let [r (serde-obj [{:fact-type :client-representative :name &quot;Alice&quot; :client &quot;Acme&quot;}
                    {:fact-type :support-request :client &quot;Acme&quot; :level :high}])]

  (type r))
;;= java.util.Arrays$ArrayList"><a href="#t1578410812064500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-07</span> <span class="t" onclick="H(this)">15:26:52</span>                 mikerod </span><span>I immediately see that types at least aren’t preserved
</span><pre>(let [r (serde-obj [{:fact-type :client-representative :name &quot;Alice&quot; :client &quot;Acme&quot;}
                    {:fact-type :support-request :client &quot;Acme&quot; :level :high}])]

  (type r))
;;= java.util.Arrays$ArrayList</pre></div><div id="t1578410829065100" t="2020-01-07 15:27:09 mikerod this isn’t immediately meaning Clara wouldn’t accept it - but it is already on shaky ground"><a href="#t1578410829065100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-07</span> <span class="t" onclick="H(this)">15:27:09</span>                 mikerod </span><span>this isn’t immediately meaning Clara wouldn’t accept it - but it is already on shaky ground</span></div><div id="t1578410834065200" t="2020-01-07 15:27:14 Konstantinos Tzanidakis oh I see"><a href="#t1578410834065200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-07</span> <span class="t" onclick="H(this)">15:27:14</span> Konstantinos Tzanidakis </span><span>oh I see</span></div><div id="t1578410845065500" t="2020-01-07 15:27:25 Konstantinos Tzanidakis @mikerod thank you very much on this!"><a href="#t1578410845065500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-07</span> <span class="t" onclick="H(this)">15:27:25</span> Konstantinos Tzanidakis </span><span>@mikerod thank you very much on this!</span></div><div id="t1578410873066000" t="2020-01-07 15:27:53 mikerod you could attempt to just add the handlers from  clara.rules.durability.fressian"><a href="#t1578410873066000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-07</span> <span class="t" onclick="H(this)">15:27:53</span>                 mikerod </span><span>you could attempt to just add the handlers from </span><code>clara.rules.durability.fressian</code></div><div id="t1578410895066500" t="2020-01-07 15:28:15 mikerod only issue there being you may not want to deal with the “identity preserving” parts potentially"><a href="#t1578410895066500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-07</span> <span class="t" onclick="H(this)">15:28:15</span>                 mikerod </span><span>only issue there being you may not want to deal with the “identity preserving” parts potentially</span></div><div id="t1578410934066800" t="2020-01-07 15:28:54 mikerod you can see examples  https://github.com/cerner/clara-rules/blob/master/src/test/clojure/clara/test_fressian.clj#L16"><a href="#t1578410934066800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-07</span> <span class="t" onclick="H(this)">15:28:54</span>                 mikerod </span><span>you can see examples </span><a href="https://github.com/cerner/clara-rules/blob/master/src/test/clojure/clara/test_fressian.clj#L16" target="_blank">https://github.com/cerner/clara-rules/blob/master/src/test/clojure/clara/test_fressian.clj#L16</a></div><div id="t1578410937067100" t="2020-01-07 15:28:57 mikerod of how you’d do that"><a href="#t1578410937067100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-07</span> <span class="t" onclick="H(this)">15:28:57</span>                 mikerod </span><span>of how you’d do that</span></div><div id="t1578410941067300" t="2020-01-07 15:29:01 Konstantinos Tzanidakis that makes sense"><a href="#t1578410941067300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-07</span> <span class="t" onclick="H(this)">15:29:01</span> Konstantinos Tzanidakis </span><span>that makes sense</span></div><div id="t1578410966067700" t="2020-01-07 15:29:26 mikerod has 2 dynamically scoped bindings you add for it’s internal caching"><a href="#t1578410966067700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-07</span> <span class="t" onclick="H(this)">15:29:26</span>                 mikerod </span><span>has 2 dynamically scoped bindings you add for it’s internal caching</span></div><div id="t1578410980068000" t="2020-01-07 15:29:40 mikerod you can see it via  pform/thread-local-binding"><a href="#t1578410980068000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-07</span> <span class="t" onclick="H(this)">15:29:40</span>                 mikerod </span><span>you can see it via </span><code>pform/thread-local-binding</code></div><div id="t1578410993068300" t="2020-01-07 15:29:53 mikerod d/node-id-&gt;node-cache  doesn’t matter for working memory - so you can leave that off"><a href="#t1578410993068300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-07</span> <span class="t" onclick="H(this)">15:29:53</span>                 mikerod </span><code>d/node-id-&gt;node-cache</code><span> doesn’t matter for working memory - so you can leave that off</span></div><div id="t1578411018068800" t="2020-01-07 15:30:18 mikerod d/clj-struct-holder  is required I’m fairly sure - it is used to preserve object identity during (de)serialization"><a href="#t1578411018068800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-07</span> <span class="t" onclick="H(this)">15:30:18</span>                 mikerod </span><code>d/clj-struct-holder</code><span> is required I’m fairly sure - it is used to preserve object identity during (de)serialization</span></div><div id="t1578495530070000" t="2020-01-08 14:58:50 bartuka is it possible to remove a rule from a session before firing it? I say that because I have a namespace with 10 rules and I want to run 9 of them. I would prefer to insert all the namespace and remove the single one"><a href="#t1578495530070000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-08</span> <span class="t" onclick="H(this)">14:58:50</span>                 bartuka </span><span>is it possible to remove a rule from a session before firing it? I say that because I have a namespace with 10 rules and I want to run 9 of them. I would prefer to insert all the namespace and remove the single one</span></div><div id="t1578500250070800" t="2020-01-08 16:17:30 ethanc @iagwanderson,
Currently there is no way to add/remove rules from the rulebase after the session has been created"><a href="#t1578500250070800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-08</span> <span class="t" onclick="H(this)">16:17:30</span>                  ethanc </span><span>@iagwanderson,
Currently there is no way to add/remove rules from the rulebase after the session has been created</span></div><div id="t1578501473071000" t="2020-01-08 16:37:53 bartuka ok, thanks!"><a href="#t1578501473071000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-08</span> <span class="t" onclick="H(this)">16:37:53</span>                 bartuka </span><span>ok, thanks!</span></div><div id="t1578501631072000" t="2020-01-08 16:40:31 mikerod @iagwanderson as I think you already know you can pass a collection of rules to make a session too. "><a href="#t1578501631072000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-08</span> <span class="t" onclick="H(this)">16:40:31</span>                 mikerod </span><span>@iagwanderson as I think you already know you can pass a collection of rules to make a session too. </span></div><div id="t1578501647072500" t="2020-01-08 16:40:47 mikerod However it’s more of a “white list”. And you seem to want a “black list” "><a href="#t1578501647072500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-08</span> <span class="t" onclick="H(this)">16:40:47</span>                 mikerod </span><span>However it’s more of a “white list”. And you seem to want a “black list” </span></div><div id="t1578501721072800" t="2020-01-08 16:42:01 bartuka exactly, just to avoid typing too much"><a href="#t1578501721072800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-08</span> <span class="t" onclick="H(this)">16:42:01</span>                 bartuka </span><span>exactly, just to avoid typing too much</span></div><div id="t1578502265075900" t="2020-01-08 16:51:05 mikerod You can list rule names in a vector in a var as well with :production-seq metadata. But still doesn’t help you. You can do dynamic stuff to make session to if you use the clara.rules.compiler/mk-session* which is a fn instead of macro"><a href="#t1578502265075900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-08</span> <span class="t" onclick="H(this)">16:51:05</span>                 mikerod </span><span>You can list rule names in a vector in a var as well with :production-seq metadata. But still doesn’t help you. You can do dynamic stuff to make session to if you use the clara.rules.compiler/mk-session* which is a fn instead of macro</span></div><div id="t1578502303076900" t="2020-01-08 16:51:43 mikerod Doing that you could do some manual dynamic stuff with clj ns-publics where you removed the rules you didn’t want. "><a href="#t1578502303076900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-08</span> <span class="t" onclick="H(this)">16:51:43</span>                 mikerod </span><span>Doing that you could do some manual dynamic stuff with clj ns-publics where you removed the rules you didn’t want. </span></div><div id="t1578502321077600" t="2020-01-08 16:52:01 bartuka uhmmm... interesting..."><a href="#t1578502321077600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-08</span> <span class="t" onclick="H(this)">16:52:01</span>                 bartuka </span><span>uhmmm... interesting...</span></div><div id="t1578502333078100" t="2020-01-08 16:52:13 mikerod Or depending on what you’re doing. You could comment out your rule you don’t want and reload ensuring the ns has the old var removed. Hah. "><a href="#t1578502333078100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-08</span> <span class="t" onclick="H(this)">16:52:13</span>                 mikerod </span><span>Or depending on what you’re doing. You could comment out your rule you don’t want and reload ensuring the ns has the old var removed. Hah. </span></div><div id="t1578502353078600" t="2020-01-08 16:52:33 mikerod With ns-unmap I believe. "><a href="#t1578502353078600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-08</span> <span class="t" onclick="H(this)">16:52:33</span>                 mikerod </span><span>With ns-unmap I believe. </span></div><div id="t1578502411079600" t="2020-01-08 16:53:31 bartuka hah.. this option is not possible here  😕  but I will try the dynamic one later. This is more a convenience than a requirement right now"><a href="#t1578502411079600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-08</span> <span class="t" onclick="H(this)">16:53:31</span>                 bartuka </span><span>hah.. this option is not possible here </span><b>😕</b><span> but I will try the dynamic one later. This is more a convenience than a requirement right now</span></div><div id="t1578502441080400" t="2020-01-08 16:54:01 bartuka do you think this functionality would be welcome to clara.core? I can try to implement it as a side project here"><a href="#t1578502441080400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-08</span> <span class="t" onclick="H(this)">16:54:01</span>                 bartuka </span><span>do you think this functionality would be welcome to clara.core? I can try to implement it as a side project here</span></div><div id="t1578502511081100" t="2020-01-08 16:55:11 bartuka I&apos;m making a real investment in this library in my project, so I wish to learn the internals better some time  😃"><a href="#t1578502511081100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-08</span> <span class="t" onclick="H(this)">16:55:11</span>                 bartuka </span><span>I&apos;m making a real investment in this library in my project, so I wish to learn the internals better some time </span><b>😃</b></div><div id="t1578504758082900" t="2020-01-08 17:32:38 mikerod @iagwanderson it seems reasonable to think there could be support for ignoring certain rules. mk-session supports options so it could be added there perhaps. Or maybe rules could just be marked with metadata when wanting something like this. "><a href="#t1578504758082900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-08</span> <span class="t" onclick="H(this)">17:32:38</span>                 mikerod </span><span>@iagwanderson it seems reasonable to think there could be support for ignoring certain rules. mk-session supports options so it could be added there perhaps. Or maybe rules could just be marked with metadata when wanting something like this. </span></div><div id="t1578655532095000" t="2020-01-10 11:25:32 bartuka I was thinking in this  API:

 (defrecord Values [id])

  (defrule testing-&gt;include
    [?value &lt;- Values [v] (= ?id (:id v))]
    =&gt;
    (println &quot;INCLUDING!!! &quot; ?value))

  (defrule testing-&gt;exclude
    [?value &lt;- Values [v] (= ?id (:id v))]
    =&gt;
    (println &quot;EXCLUDING!!! &quot; ?value))

  
  (def session-without (rl/mk-session &apos;clara.rules.compiler/testing-&gt;include
                                      &apos;clara.rules.compiler/testing-&gt;exclude
                                      :blacklist [&apos;clara.rules.compiler/testing-&gt;exclude]))"><a href="#t1578655532095000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-10</span> <span class="t" onclick="H(this)">11:25:32</span>                      bartuka </span><span>I was thinking in this  API:

</span><pre>(defrecord Values [id])

  (defrule testing-&gt;include
    [?value &lt;- Values [v] (= ?id (:id v))]
    =&gt;
    (println &quot;INCLUDING!!! &quot; ?value))

  (defrule testing-&gt;exclude
    [?value &lt;- Values [v] (= ?id (:id v))]
    =&gt;
    (println &quot;EXCLUDING!!! &quot; ?value))

  
  (def session-without (rl/mk-session &apos;clara.rules.compiler/testing-&gt;include
                                      &apos;clara.rules.compiler/testing-&gt;exclude
                                      :blacklist [&apos;clara.rules.compiler/testing-&gt;exclude]))</pre></div><div id="t1578656291095200" t="2020-01-10 11:38:11 bartuka I already have a working solution to this problem. I am touching only the  clara.rules.compiler/mk-session  function. There are many tests namespaces in the project. I was thinking to add a new one with tests to this specific functionality, what you suggests?"><a href="#t1578656291095200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-10</span> <span class="t" onclick="H(this)">11:38:11</span>                      bartuka </span><span>I already have a working solution to this problem. I am touching only the </span><code>clara.rules.compiler/mk-session</code><span> function. There are many tests namespaces in the project. I was thinking to add a new one with tests to this specific functionality, what you suggests?</span></div><div id="t1578661615095500" t="2020-01-10 13:06:55 bartuka Weird, when I add a new test file to the  common  folder I get this error from  lein test  command.

 clojure.lang.ExceptionInfo: failed compiling file:src/test/common/clara/test_common.cljc {:file #object[.File 0x1085a882 &quot;src/test/common/clara/test_common.cljc&quot;]}"><a href="#t1578661615095500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-10</span> <span class="t" onclick="H(this)">13:06:55</span>                      bartuka </span><span>Weird, when I add a new test file to the </span><code>common</code><span> folder I get this error from </span><code>lein test</code><span> command.

</span><pre>clojure.lang.ExceptionInfo: failed compiling file:src/test/common/clara/test_common.cljc {:file #object[.File 0x1085a882 &quot;src/test/common/clara/test_common.cljc&quot;]}</pre></div><div id="t1578648641093700" t="2020-01-10 09:30:41 Konstantinos Tzanidakis Hi all, I&apos;m back  🙂  . Sorry for the several questions and thank you very much for all your prompt and very helpful responses; it&apos;s been very enjoyable working with Clara. I am progressing very well in building up the ruling system in Clara however I am getting some OOMs when I surpass a certain number of facts in my application. My application has around 15 rules, some of which are fired by others, and the facts may well range between 300k - 2m, but when I go closer to the upper end I get OOMs. So, I thought that it may be reasonable to run a few benchmark tests (and maybe start profiling?). I tried the  clara-benchmark  repository and experimented a bit with the  AccumInsert  test; in this I&apos;ve played with the number of Customers, setting it from 250k to 10m. I noticed that on my machine, Clara threw an OOM above 5m facts. I was wondering whether you have a direction to suggest on methods to cut down such costs? In my application the first try was to chop the initial facts only to the absolutely necessary fields required (I am using clojure maps as extracted from a DB) but without luck. Thank you all in advance!"><a href="#t1578648641093700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-10</span> <span class="t" onclick="H(this)">09:30:41</span> Konstantinos Tzanidakis </span><span>Hi all, I&apos;m back </span><b>🙂</b><span> . Sorry for the several questions and thank you very much for all your prompt and very helpful responses; it&apos;s been very enjoyable working with Clara. I am progressing very well in building up the ruling system in Clara however I am getting some OOMs when I surpass a certain number of facts in my application. My application has around 15 rules, some of which are fired by others, and the facts may well range between 300k - 2m, but when I go closer to the upper end I get OOMs. So, I thought that it may be reasonable to run a few benchmark tests (and maybe start profiling?). I tried the </span><code>clara-benchmark</code><span> repository and experimented a bit with the </span><code>AccumInsert</code><span> test; in this I&apos;ve played with the number of Customers, setting it from 250k to 10m. I noticed that on my machine, Clara threw an OOM above 5m facts. I was wondering whether you have a direction to suggest on methods to cut down such costs? In my application the first try was to chop the initial facts only to the absolutely necessary fields required (I am using clojure maps as extracted from a DB) but without luck. Thank you all in advance!</span></div><div id="t1578664156096900" t="2020-01-10 13:49:16 mikerod @konstantinos562 2m facts themself would be quite a memory burden in the jvm I think. If it’s just memory issues is the heap space you’re giving enough? "><a href="#t1578664156096900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-10</span> <span class="t" onclick="H(this)">13:49:16</span>                 mikerod </span><span>@konstantinos562 2m facts themself would be quite a memory burden in the jvm I think. If it’s just memory issues is the heap space you’re giving enough? </span></div><div id="t1578664240099200" t="2020-01-10 13:50:40 mikerod You can use a profiler to look more at the memory layout but Clara will certainly take more space than those 2m facts since it has working memory structure it uses on top of what they already take alone. And if you have rules inserting facts based on them. "><a href="#t1578664240099200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-10</span> <span class="t" onclick="H(this)">13:50:40</span>                 mikerod </span><span>You can use a profiler to look more at the memory layout but Clara will certainly take more space than those 2m facts since it has working memory structure it uses on top of what they already take alone. And if you have rules inserting facts based on them. </span></div><div id="t1578664280100800" t="2020-01-10 13:51:20 mikerod The benchmark stuff would be more aimed at execution time. Which isn’t too useful if you’re running out of memory. If it’s slow it’s probably due to GC thrashing before OOM"><a href="#t1578664280100800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-10</span> <span class="t" onclick="H(this)">13:51:20</span>                 mikerod </span><span>The benchmark stuff would be more aimed at execution time. Which isn’t too useful if you’re running out of memory. If it’s slow it’s probably due to GC thrashing before OOM</span></div><div id="t1578664339102400" t="2020-01-10 13:52:19 mikerod Or at least that’d hide any other perf issues. "><a href="#t1578664339102400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-10</span> <span class="t" onclick="H(this)">13:52:19</span>                 mikerod </span><span>Or at least that’d hide any other perf issues. </span></div><div id="t1578664365102900" t="2020-01-10 13:52:45 Konstantinos Tzanidakis Hi @mikerod, yes that&apos;s true, the heap space is set to 4G. I have tried to trim down the facts&apos; fields to the absolute necessary, and now I am considering of using a strategy to reduce the size of facts sent to Clara"><a href="#t1578664365102900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-10</span> <span class="t" onclick="H(this)">13:52:45</span> Konstantinos Tzanidakis </span><span>Hi @mikerod, yes that&apos;s true, the heap space is set to 4G. I have tried to trim down the facts&apos; fields to the absolute necessary, and now I am considering of using a strategy to reduce the size of facts sent to Clara</span></div><div id="t1578664400103700" t="2020-01-10 13:53:20 mikerod @konstantinos562 it’d be good to know how much of the 4G you are using before running the rules "><a href="#t1578664400103700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-10</span> <span class="t" onclick="H(this)">13:53:20</span>                 mikerod </span><span>@konstantinos562 it’d be good to know how much of the 4G you are using before running the rules </span></div><div id="t1578664414104200" t="2020-01-10 13:53:34 mikerod To gauge how much clara is adding relative to that. "><a href="#t1578664414104200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-10</span> <span class="t" onclick="H(this)">13:53:34</span>                 mikerod </span><span>To gauge how much clara is adding relative to that. </span></div><div id="t1578664499106800" t="2020-01-10 13:54:59 Konstantinos Tzanidakis Hmmm good question, I haven&apos;t noted this down, although I think it&apos;s relatively low as I start from a clean repl."><a href="#t1578664499106800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-10</span> <span class="t" onclick="H(this)">13:54:59</span> Konstantinos Tzanidakis </span><span>Hmmm good question, I haven&apos;t noted this down, although I think it&apos;s relatively low as I start from a clean repl.</span></div><div id="t1578664535107900" t="2020-01-10 13:55:35 mikerod But the diagnosing the issue will also come down to what you’re rules are doing. If they match too many facts in ways where they are producing factors like n^2 or more rule activations and new fact insertions - I think that already is putting you at quite a lot of objects in memory"><a href="#t1578664535107900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-10</span> <span class="t" onclick="H(this)">13:55:35</span>                 mikerod </span><span>But the diagnosing the issue will also come down to what you’re rules are doing. If they match too many facts in ways where they are producing factors like n^2 or more rule activations and new fact insertions - I think that already is putting you at quite a lot of objects in memory</span></div><div id="t1578664536108000" t="2020-01-10 13:55:36 Konstantinos Tzanidakis but will note this with VisualVM"><a href="#t1578664536108000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-10</span> <span class="t" onclick="H(this)">13:55:36</span> Konstantinos Tzanidakis </span><span>but will note this with VisualVM</span></div><div id="t1578664557108600" t="2020-01-10 13:55:57 mikerod Visualvm can be good to get some info for this. "><a href="#t1578664557108600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-10</span> <span class="t" onclick="H(this)">13:55:57</span>                 mikerod </span><span>Visualvm can be good to get some info for this. </span></div><div id="t1578664582109500" t="2020-01-10 13:56:22 Konstantinos Tzanidakis Yes, that is more close to what happening"><a href="#t1578664582109500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-10</span> <span class="t" onclick="H(this)">13:56:22</span> Konstantinos Tzanidakis </span><span>Yes, that is more close to what happening</span></div><div id="t1578664596110400" t="2020-01-10 13:56:36 mikerod Also you can try to just jump heap to like 6G then 8G to get a sense of how much memory it really needs. Of course this may not be acceptable in your production, but for testing "><a href="#t1578664596110400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-10</span> <span class="t" onclick="H(this)">13:56:36</span>                 mikerod </span><span>Also you can try to just jump heap to like 6G then 8G to get a sense of how much memory it really needs. Of course this may not be acceptable in your production, but for testing </span></div><div id="t1578664633111600" t="2020-01-10 13:57:13 mikerod Also Clara shouldn’t hold references to facts that can never match any rules. "><a href="#t1578664633111600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-10</span> <span class="t" onclick="H(this)">13:57:13</span>                 mikerod </span><span>Also Clara shouldn’t hold references to facts that can never match any rules. </span></div><div id="t1578664636111800" t="2020-01-10 13:57:16 Konstantinos Tzanidakis I think I will try another pass on the rules in an effort to downsize the domain"><a href="#t1578664636111800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-10</span> <span class="t" onclick="H(this)">13:57:16</span> Konstantinos Tzanidakis </span><span>I think I will try another pass on the rules in an effort to downsize the domain</span></div><div id="t1578664690113800" t="2020-01-10 13:58:10 mikerod So in some situations, if you actually can filter out a bunch of stuff early, you could do some sort of “stream of facts” in a sense. But your calling code would also have to not hold references past inserting them to Clara and firing rules. "><a href="#t1578664690113800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-10</span> <span class="t" onclick="H(this)">13:58:10</span>                 mikerod </span><span>So in some situations, if you actually can filter out a bunch of stuff early, you could do some sort of “stream of facts” in a sense. But your calling code would also have to not hold references past inserting them to Clara and firing rules. </span></div><div id="t1578664757114000" t="2020-01-10 13:59:17 Konstantinos Tzanidakis I see what you mean"><a href="#t1578664757114000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-10</span> <span class="t" onclick="H(this)">13:59:17</span> Konstantinos Tzanidakis </span><span>I see what you mean</span></div><div id="t1578664855115700" t="2020-01-10 14:00:55 Konstantinos Tzanidakis I am currently retrieving all facts from the DB, which maybe streaming this in Clara without holding a head would make a difference... thanks for the suggestion"><a href="#t1578664855115700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-10</span> <span class="t" onclick="H(this)">14:00:55</span> Konstantinos Tzanidakis </span><span>I am currently retrieving all facts from the DB, which maybe streaming this in Clara without holding a head would make a difference... thanks for the suggestion</span></div><div id="t1578664915116200" t="2020-01-10 14:01:55 mikerod Yeah to not have them all in memory at once I think you’d have to be a bit careful. "><a href="#t1578664915116200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-10</span> <span class="t" onclick="H(this)">14:01:55</span>                 mikerod </span><span>Yeah to not have them all in memory at once I think you’d have to be a bit careful. </span></div><div id="t1578664956117700" t="2020-01-10 14:02:36 mikerod Not sure something like insert-all would be careful enough within Clara. Would probably have to like near N number at a time, then fire rules. Then repeat the next batch"><a href="#t1578664956117700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-10</span> <span class="t" onclick="H(this)">14:02:36</span>                 mikerod </span><span>Not sure something like insert-all would be careful enough within Clara. Would probably have to like near N number at a time, then fire rules. Then repeat the next batch</span></div><div id="t1578664981118600" t="2020-01-10 14:03:01 mikerod But if they are mostly matching or even “partial matching” rules they will be held in memory. So it can be brittle "><a href="#t1578664981118600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-10</span> <span class="t" onclick="H(this)">14:03:01</span>                 mikerod </span><span>But if they are mostly matching or even “partial matching” rules they will be held in memory. So it can be brittle </span></div><div id="t1578665027120200" t="2020-01-10 14:03:47 mikerod A fact is held in memory if it can even “potentially” be used to satisfy a rule later. That’s the “partial match” "><a href="#t1578665027120200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-10</span> <span class="t" onclick="H(this)">14:03:47</span>                 mikerod </span><span>A fact is held in memory if it can even “potentially” be used to satisfy a rule later. That’s the “partial match” </span></div><div id="t1578665034120400" t="2020-01-10 14:03:54 Konstantinos Tzanidakis (I was just checking insert-all&apos;s source, as this is what I am using to insert facts - but will need to check a bit more carefully on the DB side too)"><a href="#t1578665034120400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-10</span> <span class="t" onclick="H(this)">14:03:54</span> Konstantinos Tzanidakis </span><span>(I was just checking insert-all&apos;s source, as this is what I am using to insert facts - but will need to check a bit more carefully on the DB side too)</span></div><div id="t1578665052121000" t="2020-01-10 14:04:12 mikerod Which intuitively makes sense. Since it may be needed later when new facts come. "><a href="#t1578665052121000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-10</span> <span class="t" onclick="H(this)">14:04:12</span>                 mikerod </span><span>Which intuitively makes sense. Since it may be needed later when new facts come. </span></div><div id="t1578665075121700" t="2020-01-10 14:04:35 Konstantinos Tzanidakis Makes sense yeah"><a href="#t1578665075121700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-10</span> <span class="t" onclick="H(this)">14:04:35</span> Konstantinos Tzanidakis </span><span>Makes sense yeah</span></div><div id="t1578665080121800" t="2020-01-10 14:04:40 mikerod But yeah my first thought would be the original stuff I said. Understand memory use a bit more. "><a href="#t1578665080121800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-10</span> <span class="t" onclick="H(this)">14:04:40</span>                 mikerod </span><span>But yeah my first thought would be the original stuff I said. Understand memory use a bit more. </span></div><div id="t1578665264122200" t="2020-01-10 14:07:44 Konstantinos Tzanidakis Thanks a bunch @mikerod"><a href="#t1578665264122200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-10</span> <span class="t" onclick="H(this)">14:07:44</span> Konstantinos Tzanidakis </span><span>Thanks a bunch @mikerod</span></div><div id="t1578665437122900" t="2020-01-10 14:10:37 bartuka hi @mikerod, I am trying to run the tests from clara repository and I keep receiving this error:

 clojure.lang.ExceptionInfo: failed compiling file:src/test/common/clara/test_common.cljc {:file #object[.File 0x1085a882 &quot;src/test/common/clara/test_common.cljc&quot;]}"><a href="#t1578665437122900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-10</span> <span class="t" onclick="H(this)">14:10:37</span>                 bartuka </span><span>hi @mikerod, I am trying to run the tests from clara repository and I keep receiving this error:

</span><pre>clojure.lang.ExceptionInfo: failed compiling file:src/test/common/clara/test_common.cljc {:file #object[.File 0x1085a882 &quot;src/test/common/clara/test_common.cljc&quot;]}</pre></div><div id="t1578665475123700" t="2020-01-10 14:11:15 bartuka there is any setup I need to do when adding a new test namespace?"><a href="#t1578665475123700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-10</span> <span class="t" onclick="H(this)">14:11:15</span>                 bartuka </span><span>there is any setup I need to do when adding a new test namespace?</span></div><div id="t1578665487124000" t="2020-01-10 14:11:27 bartuka Caused by: java.lang.RuntimeException: Unable to resolve symbol: test-rule in this context"><a href="#t1578665487124000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-10</span> <span class="t" onclick="H(this)">14:11:27</span>                 bartuka </span><pre>Caused by: java.lang.RuntimeException: Unable to resolve symbol: test-rule in this context</pre></div><div id="t1578665566125300" t="2020-01-10 14:12:46 mikerod @iagwanderson are you working with clj or cljs for this? And explain what you’re doing a bit more. You added new test ns? How are you trying to run them? "><a href="#t1578665566125300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-10</span> <span class="t" onclick="H(this)">14:12:46</span>                 mikerod </span><span>@iagwanderson are you working with clj or cljs for this? And explain what you’re doing a bit more. You added new test ns? How are you trying to run them? </span></div><div id="t1578665635126500" t="2020-01-10 14:13:55 bartuka I am working with clj, but as I see it should work with cljs as well. I created a file called  test_blacklist.cljc  inside the  test/common/clara  directory"><a href="#t1578665635126500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-10</span> <span class="t" onclick="H(this)">14:13:55</span>                 bartuka </span><span>I am working with clj, but as I see it should work with cljs as well. I created a file called </span><code>test_blacklist.cljc</code><span> inside the </span><code>test/common/clara</code><span> directory</span></div><div id="t1578665654127000" t="2020-01-10 14:14:14 bartuka and I tried to run using a simple  lein test  which runs fine if I remove my new namespace"><a href="#t1578665654127000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-10</span> <span class="t" onclick="H(this)">14:14:14</span>                 bartuka </span><span>and I tried to run using a simple </span><code>lein test</code><span> which runs fine if I remove my new namespace</span></div><div id="t1578666041127600" t="2020-01-10 14:20:41 bartuka I tried to run the lein test again only with this new empty namespace and I got this error msg already"><a href="#t1578666041127600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-10</span> <span class="t" onclick="H(this)">14:20:41</span>                 bartuka </span><span>I tried to run the lein test again only with this new empty namespace and I got this error msg already</span></div><div id="t1578673815128000" t="2020-01-10 16:30:15 mikerod @iagwanderson I’d have to see your changes I think at this point to help"><a href="#t1578673815128000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-10</span> <span class="t" onclick="H(this)">16:30:15</span>                 mikerod </span><span>@iagwanderson I’d have to see your changes I think at this point to help</span></div><div id="t1578676633128700" t="2020-01-10 17:17:13 bartuka This repository has the changes and the test file:  https://github.com/wandersoncferreira/clara-rules"><a href="#t1578676633128700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-10</span> <span class="t" onclick="H(this)">17:17:13</span>                 bartuka </span><span>This repository has the changes and the test file: </span><a href="https://github.com/wandersoncferreira/clara-rules" target="_blank">https://github.com/wandersoncferreira/clara-rules</a></div><div id="t1578676738129400" t="2020-01-10 17:18:58 bartuka I changed the  compiler.clj   file"><a href="#t1578676738129400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-10</span> <span class="t" onclick="H(this)">17:18:58</span>                 bartuka </span><span>I changed the </span><code>compiler.clj</code><span>  file</span></div><div id="t1578676849130100" t="2020-01-10 17:20:49 bartuka https://github.com/wandersoncferreira/clara-rules/blob/ede84e40a0f9671544ce4ab349e7e6735ab151e0/src/main/clojure/clara/rules/compiler.clj#L2040"><a href="#t1578676849130100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-10</span> <span class="t" onclick="H(this)">17:20:49</span>                 bartuka </span><a href="https://github.com/wandersoncferreira/clara-rules/blob/ede84e40a0f9671544ce4ab349e7e6735ab151e0/src/main/clojure/clara/rules/compiler.clj#L2040" target="_blank">https://github.com/wandersoncferreira/clara-rules/blob/ede84e40a0f9671544ce4ab349e7e6735ab151e0/src/main/clojure/clara/rules/compiler.clj#L2040</a></div><div id="t1578676893130400" t="2020-01-10 17:21:33 bartuka and my test file:

 https://github.com/wandersoncferreira/clara-rules/blob/ede84e40a0f9671544ce4ab349e7e6735ab151e0/src/test/common/clara/test_blacklist.cljc"><a href="#t1578676893130400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-10</span> <span class="t" onclick="H(this)">17:21:33</span>                 bartuka </span><span>and my test file:

</span><a href="https://github.com/wandersoncferreira/clara-rules/blob/ede84e40a0f9671544ce4ab349e7e6735ab151e0/src/test/common/clara/test_blacklist.cljc" target="_blank">https://github.com/wandersoncferreira/clara-rules/blob/ede84e40a0f9671544ce4ab349e7e6735ab151e0/src/test/common/clara/test_blacklist.cljc</a></div><div id="t1578679011130900" t="2020-01-10 17:56:51 mikerod Thanks. I’ll take a look in a few. "><a href="#t1578679011130900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-10</span> <span class="t" onclick="H(this)">17:56:51</span>                 mikerod </span><span>Thanks. I’ll take a look in a few. </span></div><div id="t1578693109132400" t="2020-01-10 21:51:49 bartuka Ok, thanks. There is no clear relationship between my implementation and the error messages"><a href="#t1578693109132400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-10</span> <span class="t" onclick="H(this)">21:51:49</span>                 bartuka </span><span>Ok, thanks. There is no clear relationship between my implementation and the error messages</span></div><div id="t1578693788133100" t="2020-01-10 22:03:08 mikerod @iagwanderson you need to use def-rules-test for cross platform “common” tests "><a href="#t1578693788133100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-10</span> <span class="t" onclick="H(this)">22:03:08</span>                 mikerod </span><span>@iagwanderson you need to use def-rules-test for cross platform “common” tests </span></div><div id="t1578693816133400" t="2020-01-10 22:03:36 mikerod That  may be your issue"><a href="#t1578693816133400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-10</span> <span class="t" onclick="H(this)">22:03:36</span>                 mikerod </span><span>That  may be your issue</span></div><div id="t1578693830133900" t="2020-01-10 22:03:50 mikerod Look at another test ns in that dir to see it used. "><a href="#t1578693830133900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-10</span> <span class="t" onclick="H(this)">22:03:50</span>                 mikerod </span><span>Look at another test ns in that dir to see it used. </span></div><div id="t1578693838134400" t="2020-01-10 22:03:58 mikerod It’s used in all the rule sort of tests there. "><a href="#t1578693838134400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-10</span> <span class="t" onclick="H(this)">22:03:58</span>                 mikerod </span><span>It’s used in all the rule sort of tests there. </span></div><div id="t1578693869135800" t="2020-01-10 22:04:29 bartuka Uhmm... Ok. I will make this change."><a href="#t1578693869135800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-10</span> <span class="t" onclick="H(this)">22:04:29</span>                 bartuka </span><span>Uhmm... Ok. I will make this change.</span></div><div id="t1578920898145800" t="2020-01-13 13:08:18 wparker For some background, in Clojure Clara can create sessions on the fly using eval, while in ClojureScript sessions have to be defined at compilation time typically using a call to defsession at the top level.  The dynamic session building in Clojure ultimately uses eval, which is why it doesn&apos;t work in ClojureScript.  Defsession-test essentially makes the static session building in ClojureScript tests look more dynamic without needing to create tons of top-level defs etc."><a href="#t1578920898145800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-13</span> <span class="t" onclick="H(this)">13:08:18</span>                      wparker </span><span>For some background, in Clojure Clara can create sessions on the fly using eval, while in ClojureScript sessions have to be defined at compilation time typically using a call to defsession at the top level.  The dynamic session building in Clojure ultimately uses eval, which is why it doesn&apos;t work in ClojureScript.  Defsession-test essentially makes the static session building in ClojureScript tests look more dynamic without needing to create tons of top-level defs etc.</span></div><div id="t1578958418147000" t="2020-01-13 23:33:38 bartuka interesting!! I noticed during my tests that in these cases I should uses only the names of the rules that I was filtering inside the  mk-session  I was thinking that is was going to create the name with my current namespace in it"><a href="#t1578958418147000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-13</span> <span class="t" onclick="H(this)">23:33:38</span>                      bartuka </span><span>interesting!! I noticed during my tests that in these cases I should uses only the names of the rules that I was filtering inside the </span><code>mk-session</code><span> I was thinking that is was going to create the name with my current namespace in it</span></div><div id="t1578693873136000" t="2020-01-10 22:04:33 mikerod Can’t say it’s certainly the issue. But likely. I can’t remember without looking a bit more "><a href="#t1578693873136000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-10</span> <span class="t" onclick="H(this)">22:04:33</span>                 mikerod </span><span>Can’t say it’s certainly the issue. But likely. I can’t remember without looking a bit more </span></div><div id="t1578693898136800" t="2020-01-10 22:04:58 mikerod There are differences in how you would set this up in clj vs cljs. "><a href="#t1578693898136800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-10</span> <span class="t" onclick="H(this)">22:04:58</span>                 mikerod </span><span>There are differences in how you would set this up in clj vs cljs. </span></div><div id="t1578693910137300" t="2020-01-10 22:05:10 mikerod So the test helper makes that not an issue"><a href="#t1578693910137300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-10</span> <span class="t" onclick="H(this)">22:05:10</span>                 mikerod </span><span>So the test helper makes that not an issue</span></div><div id="t1578693915137500" t="2020-01-10 22:05:15 mikerod For portable test"><a href="#t1578693915137500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-10</span> <span class="t" onclick="H(this)">22:05:15</span>                 mikerod </span><span>For portable test</span></div><div id="t1578693943138700" t="2020-01-10 22:05:43 bartuka I never did cljc before, so I was betting on something related to that"><a href="#t1578693943138700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-10</span> <span class="t" onclick="H(this)">22:05:43</span>                 bartuka </span><span>I never did cljc before, so I was betting on something related to that</span></div><div id="t1578694001139400" t="2020-01-10 22:06:41 bartuka I will make the test work and open a PR for discussions around the implementation"><a href="#t1578694001139400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-10</span> <span class="t" onclick="H(this)">22:06:41</span>                 bartuka </span><span>I will make the test work and open a PR for discussions around the implementation</span></div><div id="t1578695053141600" t="2020-01-10 22:24:13 bartuka @mikerod looks like the  Compiling [&quot;resources/public/js/simple.js&quot;] failed.  because in the  cljs_deps.js  does not have definitions for my new file added"><a href="#t1578695053141600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-10</span> <span class="t" onclick="H(this)">22:24:13</span>                 bartuka </span><span>@mikerod looks like the </span><code>Compiling [&quot;resources/public/js/simple.js&quot;] failed.</code><span> because in the </span><code>cljs_deps.js</code><span> does not have definitions for my new file added</span></div><div id="t1578695692142300" t="2020-01-10 22:34:52 bartuka fixed,  lein do clean, compile    😃"><a href="#t1578695692142300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-10</span> <span class="t" onclick="H(this)">22:34:52</span>                 bartuka </span><span>fixed, </span><code>lein do clean, compile</code><span>  </span><b>😃</b></div><div id="t1578696689143300" t="2020-01-10 22:51:29 mikerod Yeah. I have a long standing issue to improve the cljs setup and build stuff. But it is involved. So for now have to work with this stuff as it is. "><a href="#t1578696689143300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-10</span> <span class="t" onclick="H(this)">22:51:29</span>                 mikerod </span><span>Yeah. I have a long standing issue to improve the cljs setup and build stuff. But it is involved. So for now have to work with this stuff as it is. </span></div><div id="t1578751784143800" t="2020-01-11 14:09:44 bartuka Thanks for all the help @mikerod I opened a PR  https://github.com/cerner/clara-rules/pull/445"><a href="#t1578751784143800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-11</span> <span class="t" onclick="H(this)">14:09:44</span>                 bartuka </span><span>Thanks for all the help @mikerod I opened a PR </span><a href="https://github.com/cerner/clara-rules/pull/445" target="_blank">https://github.com/cerner/clara-rules/pull/445</a></div><div id="t1578754212144500" t="2020-01-11 14:50:12 mikerod @iagwanderson nice. I’ll check it out "><a href="#t1578754212144500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-11</span> <span class="t" onclick="H(this)">14:50:12</span>                 mikerod </span><span>@iagwanderson nice. I’ll check it out </span></div><div id="t1578915639145500" t="2020-01-13 11:40:39 bartuka hi, you guys have customized cider to understand rules indentation correctly?"><a href="#t1578915639145500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-13</span> <span class="t" onclick="H(this)">11:40:39</span>                 bartuka </span><span>hi, you guys have customized cider to understand rules indentation correctly?</span></div><div id="t1578922395146000" t="2020-01-13 13:33:15 wparker I don’t, I think some others may have experimented with it as well as an attempt to format/highlight in Cursive.  I’ve personally just used newlines for new conditions and Cider indents that well enough that it hasn’t bothered me."><a href="#t1578922395146000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-13</span> <span class="t" onclick="H(this)">13:33:15</span>                      wparker </span><span>I don’t, I think some others may have experimented with it as well as an attempt to format/highlight in Cursive.  I’ve personally just used newlines for new conditions and Cider indents that well enough that it hasn’t bothered me.</span></div><div id="t1578922405146200" t="2020-01-13 13:33:25 wparker Is there something in particular that looks strange to you?"><a href="#t1578922405146200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-13</span> <span class="t" onclick="H(this)">13:33:25</span>                      wparker </span><span>Is there something in particular that looks strange to you?</span></div><div id="t1578954108146400" t="2020-01-13 22:21:48 bartuka the default indentation looks like this:"><a href="#t1578954108146400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-13</span> <span class="t" onclick="H(this)">22:21:48</span>                      bartuka </span><span>the default indentation looks like this:</span></div><div id="t1578954113146600" t="2020-01-13 22:21:53 bartuka (defrule rule-&gt;legacy-contract?
  &quot;Add a Legacy fact into the session if the contract was sent with this status.&quot;
  [?contract &lt;- Contract [ct] (= ?principal-external-id (:contract/principal-external-id ct))
   (= :legacy (:contract/status ct))]
  =&gt;
  (insert! (-&gt;Legacy ?principal-external-id)))"><a href="#t1578954113146600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-13</span> <span class="t" onclick="H(this)">22:21:53</span>                      bartuka </span><pre>(defrule rule-&gt;legacy-contract?
  &quot;Add a Legacy fact into the session if the contract was sent with this status.&quot;
  [?contract &lt;- Contract [ct] (= ?principal-external-id (:contract/principal-external-id ct))
   (= :legacy (:contract/status ct))]
  =&gt;
  (insert! (-&gt;Legacy ?principal-external-id)))</pre></div><div id="t1578954145146800" t="2020-01-13 22:22:25 bartuka and I have to manually change it to:

 (defrule rule-&gt;legacy-contract?
  &quot;Add a Legacy fact into the session if the contract was sent with this status.&quot;
  [?contract &lt;- Contract [ct] (= ?principal-external-id (:contract/principal-external-id ct))
                              (= :legacy (:contract/status ct))]
  =&gt;
  (insert! (-&gt;Legacy ?principal-external-id)))"><a href="#t1578954145146800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-13</span> <span class="t" onclick="H(this)">22:22:25</span>                      bartuka </span><span>and I have to manually change it to:

</span><pre>(defrule rule-&gt;legacy-contract?
  &quot;Add a Legacy fact into the session if the contract was sent with this status.&quot;
  [?contract &lt;- Contract [ct] (= ?principal-external-id (:contract/principal-external-id ct))
                              (= :legacy (:contract/status ct))]
  =&gt;
  (insert! (-&gt;Legacy ?principal-external-id)))</pre></div><div id="t1578958471147200" t="2020-01-13 23:34:31 bartuka sometimes I need to use  M-x align-regexp (=  to align the conditions"><a href="#t1578958471147200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-13</span> <span class="t" onclick="H(this)">23:34:31</span>                      bartuka </span><span>sometimes I need to use </span><code>M-x align-regexp (=</code><span> to align the conditions</span></div><div id="t1579090983156000" t="2020-01-15 12:23:03 mbragg Hi. Im evaluating potentially using Clara for one of our use cases. Can you imagine a sensible way to be able to determine the start-time and end-time of a given rule execution? Say I have a rule that has some expensive operation… I’d like to be able to record when it started and ended, ideally without adding the required code to the rule itself and adding the values to the emitted fact (as it would be great if all rules exposed this information implicitly). I’ve started looked into:
• The inspect + trace tools dont seem to provide it
• Creating a new Listener, but this may be a bad idea given it would no longer be immutable if its calling out for the current time?
• Creating a macro and extend the parsing logic to wrap the rule execution somehow
Any thoughts / suggestions appreciated. Many thanks"><a href="#t1579090983156000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-15</span> <span class="t" onclick="H(this)">12:23:03</span>                  mbragg </span><span>Hi. Im evaluating potentially using Clara for one of our use cases. Can you imagine a sensible way to be able to determine the start-time and end-time of a given rule execution? Say I have a rule that has some expensive operation… I’d like to be able to record when it started and ended, ideally without adding the required code to the rule itself and adding the values to the emitted fact (as it would be great if all rules exposed this information implicitly). I’ve started looked into:
• The inspect + trace tools dont seem to provide it
• Creating a new Listener, but this may be a bad idea given it would no longer be immutable if its calling out for the current time?
• Creating a macro and extend the parsing logic to wrap the rule execution somehow
Any thoughts / suggestions appreciated. Many thanks</span></div><div id="t1579108201157000" t="2020-01-15 17:10:01 mikerod @mbragg I don’t think it’s as straightforward as perhaps it seems. Rules aren’t the same as something like a fn body that you can time"><a href="#t1579108201157000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-15</span> <span class="t" onclick="H(this)">17:10:01</span>                 mikerod </span><span>@mbragg I don’t think it’s as straightforward as perhaps it seems. Rules aren’t the same as something like a fn body that you can time</span></div><div id="t1579108234157800" t="2020-01-15 17:10:34 mikerod The rules are structures that are used to create a rete based data flow tree (forest really)"><a href="#t1579108234157800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-15</span> <span class="t" onclick="H(this)">17:10:34</span>                 mikerod </span><span>The rules are structures that are used to create a rete based data flow tree (forest really)</span></div><div id="t1579108360160800" t="2020-01-15 17:12:40 mikerod Some examples of the complexity:

(1) In some cases LHS conditions from separate rules may end up being shared as one common node in this tree. 

(2) rule conditions are nodes on the tree. They have varying degrees of eager vs lazy behavior. In most cases, the engine tries to batch facts up prior to evaluation of conditions 

"><a href="#t1579108360160800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-15</span> <span class="t" onclick="H(this)">17:12:40</span>                 mikerod </span><span>Some examples of the complexity:

(1) In some cases LHS conditions from separate rules may end up being shared as one common node in this tree. 

(2) rule conditions are nodes on the tree. They have varying degrees of eager vs lazy behavior. In most cases, the engine tries to batch facts up prior to evaluation of conditions 

</span></div><div id="t1579108421162200" t="2020-01-15 17:13:41 mikerod (3) before fire-rules happens a certain degree of evaluation takes place. Once fire-rules happens more work is done but always oriented towards batched fact propagation. "><a href="#t1579108421162200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-15</span> <span class="t" onclick="H(this)">17:13:41</span>                 mikerod </span><span>(3) before fire-rules happens a certain degree of evaluation takes place. Once fire-rules happens more work is done but always oriented towards batched fact propagation. </span></div><div id="t1579108486163700" t="2020-01-15 17:14:46 mikerod The inspection/trace stuff can be useful to get a sense of how many times a condition is being evaluated/matched. This tends to just give a relative “count” to compare and often find the outliers. "><a href="#t1579108486163700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-15</span> <span class="t" onclick="H(this)">17:14:46</span>                 mikerod </span><span>The inspection/trace stuff can be useful to get a sense of how many times a condition is being evaluated/matched. This tends to just give a relative “count” to compare and often find the outliers. </span></div><div id="t1579108561165400" t="2020-01-15 17:16:01 mikerod But overall. The rules are more like “sql query structures” where they are then compiled to a network, like the “db eval plan”"><a href="#t1579108561165400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-15</span> <span class="t" onclick="H(this)">17:16:01</span>                 mikerod </span><span>But overall. The rules are more like “sql query structures” where they are then compiled to a network, like the “db eval plan”</span></div><div id="t1579108583166100" t="2020-01-15 17:16:23 mikerod So the concerns tend to be things like how many times is this “join condition” being evaluated given some facts. "><a href="#t1579108583166100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-15</span> <span class="t" onclick="H(this)">17:16:23</span>                 mikerod </span><span>So the concerns tend to be things like how many times is this “join condition” being evaluated given some facts. </span></div><div id="t1579108751169200" t="2020-01-15 17:19:11 mikerod With profiling you can find actually hot spot functions which sometimes end up being a fn used in a condition that is being evaluated a large number of times:
 [MyFact (my-fn ...)] 
If that condition has a large number of matches you may profile and see  my-fn  is a hot spot and looking to be a perf issue."><a href="#t1579108751169200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-15</span> <span class="t" onclick="H(this)">17:19:11</span>                 mikerod </span><span>With profiling you can find actually hot spot functions which sometimes end up being a fn used in a condition that is being evaluated a large number of times:
</span><pre>[MyFact (my-fn ...)]</pre><span>
If that condition has a large number of matches you may profile and see </span><code>my-fn</code><span> is a hot spot and looking to be a perf issue.</span></div><div id="t1579110385171900" t="2020-01-15 17:46:25 mbragg Thanks @mikerod for the explanation, makes sense. I guess I was specifically meaning everything in the RHS do block for a given rule. But I can see it may not be that straight forward... especially if there’s batching involved. "><a href="#t1579110385171900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-15</span> <span class="t" onclick="H(this)">17:46:25</span>                  mbragg </span><span>Thanks @mikerod for the explanation, makes sense. I guess I was specifically meaning everything in the RHS do block for a given rule. But I can see it may not be that straight forward... especially if there’s batching involved. </span></div><div id="t1579128177193000" t="2020-01-15 22:42:57 wparker In case a concrete demonstration helps for clarity, the rule RHS calls like insert! add things to a cache that will be processed later (the details of that probably aren’t super important here), the default implementation of which is in this file:  https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/rules/update_cache/core.cljc  It’s certainly possible to have a poorly-performing function called in a rule, for which profiling with something like VisualVM can be useful, but a simple timer isn’t necessarily much help with diagnosing poorly performing rules networks as Mike has elaborated on."><a href="#t1579128177193000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-15</span> <span class="t" onclick="H(this)">22:42:57</span>                      wparker </span><span>In case a concrete demonstration helps for clarity, the rule RHS calls like insert! add things to a cache that will be processed later (the details of that probably aren’t super important here), the default implementation of which is in this file: </span><a href="https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/rules/update_cache/core.cljc" target="_blank">https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/rules/update_cache/core.cljc</a><span> It’s certainly possible to have a poorly-performing function called in a rule, for which profiling with something like VisualVM can be useful, but a simple timer isn’t necessarily much help with diagnosing poorly performing rules networks as Mike has elaborated on.</span></div><div id="t1579190903201800" t="2020-01-16 16:08:23 mbragg Thanks @U0KRSVDHR "><a href="#t1579190903201800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-16</span> <span class="t" onclick="H(this)">16:08:23</span>                       mbragg </span><span>Thanks @U0KRSVDHR </span></div><div id="t1579110551172100" t="2020-01-15 17:49:11 mikerod @mbragg the RHS is easier to time at least"><a href="#t1579110551172100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-15</span> <span class="t" onclick="H(this)">17:49:11</span>                 mikerod </span><span>@mbragg the RHS is easier to time at least</span></div><div id="t1579110570172600" t="2020-01-15 17:49:30 mikerod I mean you can wrap that fairly easily - but still the time it takes to do the  insert!  sort of functions is where the batching happens"><a href="#t1579110570172600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-15</span> <span class="t" onclick="H(this)">17:49:30</span>                 mikerod </span><span>I mean you can wrap that fairly easily - but still the time it takes to do the </span><code>insert!</code><span> sort of functions is where the batching happens</span></div><div id="t1579110599173200" t="2020-01-15 17:49:59 mikerod so you if you’re RHS is:
 (insert! (-&gt;Something ?x)) 
timing it won’t necessarily tell you much"><a href="#t1579110599173200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-15</span> <span class="t" onclick="H(this)">17:49:59</span>                 mikerod </span><span>so you if you’re RHS is:
</span><pre>(insert! (-&gt;Something ?x))</pre><span>
timing it won’t necessarily tell you much</span></div><div id="t1579110631173800" t="2020-01-15 17:50:31 mikerod that same RHS may end up being activated N times - so it evaluates N times, and you have N  insert!  calls all batched, so no fact is actually inserted right away until a later cycle"><a href="#t1579110631173800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-15</span> <span class="t" onclick="H(this)">17:50:31</span>                 mikerod </span><span>that same RHS may end up being activated N times - so it evaluates N times, and you have N </span><code>insert!</code><span> calls all batched, so no fact is actually inserted right away until a later cycle</span></div><div id="t1579110665174400" t="2020-01-15 17:51:05 mikerod the batching is very useful from a perf standpoint too - but does complicate timing things"><a href="#t1579110665174400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-15</span> <span class="t" onclick="H(this)">17:51:05</span>                 mikerod </span><span>the batching is very useful from a perf standpoint too - but does complicate timing things</span></div><div id="t1579113762177800" t="2020-01-15 18:42:42 mbragg @mikerod ok understood. It think I’m going to suggest that this “rule timing” requirement is something we drop if we go with Clara, as it sounds like it doesn’t really make sense... in the way they are imagining rules being executed anyway. Thanks for all your help "><a href="#t1579113762177800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-15</span> <span class="t" onclick="H(this)">18:42:42</span>                  mbragg </span><span>@mikerod ok understood. It think I’m going to suggest that this “rule timing” requirement is something we drop if we go with Clara, as it sounds like it doesn’t really make sense... in the way they are imagining rules being executed anyway. Thanks for all your help </span></div><div id="t1579114074179000" t="2020-01-15 18:47:54 Matthew Pettis In a defrule RHS, when making a record to insert, is there a way to access the rule name (the symbol associated with the rule that is firing) to store as a field in the inserted fact?"><a href="#t1579114074179000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-15</span> <span class="t" onclick="H(this)">18:47:54</span>          Matthew Pettis </span><span>In a defrule RHS, when making a record to insert, is there a way to access the rule name (the symbol associated with the rule that is firing) to store as a field in the inserted fact?</span></div><div id="t1579114346179800" t="2020-01-15 18:52:26 mikerod @matthew.pettis I suppose you want this instead of being repetitive?
 (defrule my-rule
=&gt;
(insert! (-&gt;MyFact `my-rule))"><a href="#t1579114346179800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-15</span> <span class="t" onclick="H(this)">18:52:26</span>                 mikerod </span><span>@matthew.pettis I suppose you want this instead of being repetitive?
</span><pre>(defrule my-rule
=&gt;
(insert! (-&gt;MyFact `my-rule))</pre></div><div id="t1579114500181700" t="2020-01-15 18:55:00 Matthew Pettis Yeah, right now I&apos;m copying the name as the rule as a string in the creation of  MyFact  , so if there is a way to resolve the name of the rule in which the insert is operating that&apos;s what I&apos;m looking for (so, as you said, I&apos;m not repetitive in the sense of mis-copypasting the rule name into the string...)"><a href="#t1579114500181700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-15</span> <span class="t" onclick="H(this)">18:55:00</span>          Matthew Pettis </span><span>Yeah, right now I&apos;m copying the name as the rule as a string in the creation of </span><code>MyFact</code><span> , so if there is a way to resolve the name of the rule in which the insert is operating that&apos;s what I&apos;m looking for (so, as you said, I&apos;m not repetitive in the sense of mis-copypasting the rule name into the string...)</span></div><div id="t1579114621181800" t="2020-01-15 18:57:01 Matthew Pettis Thinking of something like this, so I can use the same insert statement and not have to copy in the rulename somehow..."><a href="#t1579114621181800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-15</span> <span class="t" onclick="H(this)">18:57:01</span>          Matthew Pettis </span><span>Thinking of something like this, so I can use the same insert statement and not have to copy in the rulename somehow...</span></div><div id="t1579115146182400" t="2020-01-15 19:05:46 mikerod @matthew.pettis have to look to think if anything is directly available"><a href="#t1579115146182400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-15</span> <span class="t" onclick="H(this)">19:05:46</span>                 mikerod </span><span>@matthew.pettis have to look to think if anything is directly available</span></div><div id="t1579115152182700" t="2020-01-15 19:05:52 mikerod however, you can always opt to make your own macro"><a href="#t1579115152182700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-15</span> <span class="t" onclick="H(this)">19:05:52</span>                 mikerod </span><span>however, you can always opt to make your own macro</span></div><div id="t1579115195184200" t="2020-01-15 19:06:35 mikerod defrule  itself is just a macro and rules and queries in Clara are all modeled in a data-oriented data structure underneath that alternative DSL’s can be written to produce (via macros typically)"><a href="#t1579115195184200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-15</span> <span class="t" onclick="H(this)">19:06:35</span>                 mikerod </span><code>defrule</code><span> itself is just a macro and rules and queries in Clara are all modeled in a data-oriented data structure underneath that alternative DSL’s can be written to produce (via macros typically)</span></div><div id="t1579115197184300" t="2020-01-15 19:06:37 Matthew Pettis OK.  A macro implementation might be in line for me too."><a href="#t1579115197184300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-15</span> <span class="t" onclick="H(this)">19:06:37</span>          Matthew Pettis </span><span>OK.  A macro implementation might be in line for me too.</span></div><div id="t1579115204184600" t="2020-01-15 19:06:44 mikerod or you can have a macro that expands to  defrule  for your case"><a href="#t1579115204184600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-15</span> <span class="t" onclick="H(this)">19:06:44</span>                 mikerod </span><span>or you can have a macro that expands to </span><code>defrule</code><span> for your case</span></div><div id="t1579115273186300" t="2020-01-15 19:07:53 Matthew Pettis I think I may follow the custom macro expansion to defrule, thanks.  Was just wondering if it was a common need and something was built in that I was missing..."><a href="#t1579115273186300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-15</span> <span class="t" onclick="H(this)">19:07:53</span>          Matthew Pettis </span><span>I think I may follow the custom macro expansion to defrule, thanks.  Was just wondering if it was a common need and something was built in that I was missing...</span></div><div id="t1579115290186700" t="2020-01-15 19:08:10 mikerod an old (and probably no longer able to run examples) post, that did give a good overview of alterantive DSL’s  http://www.toomuchcode.org/blog/2015/11/14/insta-declarative-dsls/  just for reference if that concept is something you find further interest in - you don’t really need it for this small case"><a href="#t1579115290186700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-15</span> <span class="t" onclick="H(this)">19:08:10</span>                 mikerod </span><span>an old (and probably no longer able to run examples) post, that did give a good overview of alterantive DSL’s </span><a href="http://www.toomuchcode.org/blog/2015/11/14/insta-declarative-dsls/" target="_blank">http://www.toomuchcode.org/blog/2015/11/14/insta-declarative-dsls/</a><span> just for reference if that concept is something you find further interest in - you don’t really need it for this small case</span></div><div id="t1579115462187200" t="2020-01-15 19:11:02 mikerod I don’t see anything built-in as of now"><a href="#t1579115462187200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-15</span> <span class="t" onclick="H(this)">19:11:02</span>                 mikerod </span><span>I don’t see anything built-in as of now</span></div><div id="t1579115571187900" t="2020-01-15 19:12:51 mikerod I have came across a similar use-case in the past. I think I just repeated the name basically - I believe I used keywordized version instead though"><a href="#t1579115571187900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-15</span> <span class="t" onclick="H(this)">19:12:51</span>                 mikerod </span><span>I have came across a similar use-case in the past. I think I just repeated the name basically - I believe I used keywordized version instead though</span></div><div id="t1579115578188200" t="2020-01-15 19:12:58 mikerod but can be error-prone indeed"><a href="#t1579115578188200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-15</span> <span class="t" onclick="H(this)">19:12:58</span>                 mikerod </span><span>but can be error-prone indeed</span></div><div id="t1579115641189500" t="2020-01-15 19:14:01 mikerod I’ve also done alternative DSLs that compile to underlying rule structures though in some cases where there was more to it"><a href="#t1579115641189500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-15</span> <span class="t" onclick="H(this)">19:14:01</span>                 mikerod </span><span>I’ve also done alternative DSLs that compile to underlying rule structures though in some cases where there was more to it</span></div><div id="t1579115809192000" t="2020-01-15 19:16:49 Matthew Pettis I like the macro wrapper for the cases where I want to insert a fact tracking what rule was fired.  And, yeah, in my use case, I was thinking of using rule firing to track all of the rules that were fired on a given fact.  This is like using rules as a way to track all of the ways a fact can violate rules without making a big conditional statement that checks all conditions and logs that observation."><a href="#t1579115809192000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-15</span> <span class="t" onclick="H(this)">19:16:49</span>          Matthew Pettis </span><span>I like the macro wrapper for the cases where I want to insert a fact tracking what rule was fired.  And, yeah, in my use case, I was thinking of using rule firing to track all of the rules that were fired on a given fact.  This is like using rules as a way to track all of the ways a fact can violate rules without making a big conditional statement that checks all conditions and logs that observation.</span></div><div id="t1579116287192200" t="2020-01-15 19:24:47 mikerod Yeah that makes sense "><a href="#t1579116287192200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-15</span> <span class="t" onclick="H(this)">19:24:47</span>                 mikerod </span><span>Yeah that makes sense </span></div><div id="t1579141745195900" t="2020-01-16 02:29:05 Matthew Pettis I&apos;m having some trouble with understanding the  mk-session  function documentation ( http://www.clara-rules.org/apidocs/0.20.0/clojure/clara.rules.html#var-mk-session ).  In particular, it references  rule sources .  Are those namespaces that the rules live in (if they aren&apos;t in the current namespace)?  I&apos;m wondering what the alternative ways there are to giving rules to a session if you don&apos;t use  defrule  in the current namespace.  Can you construct a vector of rules (that don&apos;t have names) that you&apos;d get from  defrule  and feed it to a session?"><a href="#t1579141745195900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-16</span> <span class="t" onclick="H(this)">02:29:05</span>          Matthew Pettis </span><span>I&apos;m having some trouble with understanding the </span><code>mk-session</code><span> function documentation (</span><a href="http://www.clara-rules.org/apidocs/0.20.0/clojure/clara.rules.html#var-mk-session" target="_blank">http://www.clara-rules.org/apidocs/0.20.0/clojure/clara.rules.html#var-mk-session</a><span>).  In particular, it references </span><code>rule sources</code><span>.  Are those namespaces that the rules live in (if they aren&apos;t in the current namespace)?  I&apos;m wondering what the alternative ways there are to giving rules to a session if you don&apos;t use </span><code>defrule</code><span> in the current namespace.  Can you construct a vector of rules (that don&apos;t have names) that you&apos;d get from </span><code>defrule</code><span> and feed it to a session?</span></div><div id="t1579149200197000" t="2020-01-16 04:33:20 mikerod @matthew.pettis you can pass a collection of rules and queries"><a href="#t1579149200197000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-16</span> <span class="t" onclick="H(this)">04:33:20</span>                 mikerod </span><span>@matthew.pettis you can pass a collection of rules and queries</span></div><div id="t1579149213197300" t="2020-01-16 04:33:33 mikerod So a vector yes"><a href="#t1579149213197300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-16</span> <span class="t" onclick="H(this)">04:33:33</span>                 mikerod </span><span>So a vector yes</span></div><div id="t1579149259198300" t="2020-01-16 04:34:19 mikerod If you pass an ns name it’ll be automatically expanded to a collection of all rules sources within it"><a href="#t1579149259198300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-16</span> <span class="t" onclick="H(this)">04:34:19</span>                 mikerod </span><span>If you pass an ns name it’ll be automatically expanded to a collection of all rules sources within it</span></div><div id="t1579149274198800" t="2020-01-16 04:34:34 mikerod Rule sources are defined by a protocol "><a href="#t1579149274198800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-16</span> <span class="t" onclick="H(this)">04:34:34</span>                 mikerod </span><span>Rule sources are defined by a protocol </span></div><div id="t1579149308199600" t="2020-01-16 04:35:08 mikerod There are a few more built in impls but those are the main 2"><a href="#t1579149308199600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-16</span> <span class="t" onclick="H(this)">04:35:08</span>                 mikerod </span><span>There are a few more built in impls but those are the main 2</span></div><div id="t1579149376201200" t="2020-01-16 04:36:16 mikerod And “rule” is a bit overloaded here unfortunately since it includes queries. Clara typically calls them “productions” when referring generally to both. "><a href="#t1579149376201200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-16</span> <span class="t" onclick="H(this)">04:36:16</span>                 mikerod </span><span>And “rule” is a bit overloaded here unfortunately since it includes queries. Clara typically calls them “productions” when referring generally to both. </span></div><div id="t1579576154002600" t="2020-01-21 03:09:14 Matthew Pettis Are there any examples out there that show how to define a session in the namespace  project.a , define facts in namespace  project.b  , rules in  project.c  , and how to import  b  and  c  into  a  to fire rules on them?  I&apos;m struggling because I&quot;m sure I don&apos;t have namespace usage well..."><a href="#t1579576154002600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-21</span> <span class="t" onclick="H(this)">03:09:14</span>          Matthew Pettis </span><span>Are there any examples out there that show how to define a session in the namespace </span><code>project.a</code><span>, define facts in namespace </span><code>project.b</code><span> , rules in </span><code>project.c</code><span> , and how to import </span><code>b</code><span> and </span><code>c</code><span> into </span><code>a</code><span> to fire rules on them?  I&apos;m struggling because I&quot;m sure I don&apos;t have namespace usage well...</span></div><div id="t1579576266003500" t="2020-01-21 03:11:06 Matthew Pettis My two files which fails (I&quot;m looking only at importing rules for this examples, not yet facts):"><a href="#t1579576266003500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-21</span> <span class="t" onclick="H(this)">03:11:06</span>          Matthew Pettis </span><span>My two files which fails (I&quot;m looking only at importing rules for this examples, not yet facts):</span></div><div id="t1579576300003600" t="2020-01-21 03:11:40 Matthew Pettis The session namespace..."><a href="#t1579576300003600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-21</span> <span class="t" onclick="H(this)">03:11:40</span>          Matthew Pettis </span><span>The session namespace...</span></div><div id="t1579576333003900" t="2020-01-21 03:12:13 Matthew Pettis The rule namespace I want to import from..."><a href="#t1579576333003900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-21</span> <span class="t" onclick="H(this)">03:12:13</span>          Matthew Pettis </span><span>The rule namespace I want to import from...</span></div><div id="t1579576887004500" t="2020-01-21 03:21:27 Matthew Pettis The error I get:"><a href="#t1579576887004500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-21</span> <span class="t" onclick="H(this)">03:21:27</span>          Matthew Pettis </span><span>The error I get:</span></div><div id="t1579577381009500" t="2020-01-21 03:29:41 ethanc @matthew.pettis
I believe you would want to import the fact into the namespace where the rule is using it:
 (ns clara-lein.ex06rulesns
  (:require [clara.rules :refer :all] 
            [clara-lein.ex06 :as ex06])
  (:import [clara-lein.ex06 Myfact]))
;; Rules namespace for rules for ex06.
;; Define rules
(defrule rule-1
  &quot;Rule-1 in rulesns&quot;
  [Myfact (= ?size size)]
  [:test (&gt; 1 ?size)]
  =&gt;
  (insert! (ex06/-&gt;Rulefail &quot;rule-1&quot; ?size))) 
Though this might lead to issues with cyclical dependencies, with the session ns and rules ns.

It might be practical to pull the fact definitions out into a separate ns so that they can be pulled by both ns without the possibility of a cycle."><a href="#t1579577381009500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-21</span> <span class="t" onclick="H(this)">03:29:41</span>                  ethanc </span><span>@matthew.pettis
I believe you would want to import the fact into the namespace where the rule is using it:
</span><pre>(ns clara-lein.ex06rulesns
  (:require [clara.rules :refer :all] 
            [clara-lein.ex06 :as ex06])
  (:import [clara-lein.ex06 Myfact]))
;; Rules namespace for rules for ex06.
;; Define rules
(defrule rule-1
  &quot;Rule-1 in rulesns&quot;
  [Myfact (= ?size size)]
  [:test (&gt; 1 ?size)]
  =&gt;
  (insert! (ex06/-&gt;Rulefail &quot;rule-1&quot; ?size)))</pre><span>
Though this might lead to issues with cyclical dependencies, with the session ns and rules ns.

It might be practical to pull the fact definitions out into a separate ns so that they can be pulled by both ns without the possibility of a cycle.</span></div><div id="t1579577719011700" t="2020-01-21 03:35:19 Matthew Pettis Thank you!  If I copy and pasted this correctly, when i run  (require &apos;clara-lein.ex06rulesns)   in  clara-lein.ex06  , I get an error that  No namespace: clara-lein.ex06rulesns found .  I&apos;ll keep poking, but that&apos;s my current error..."><a href="#t1579577719011700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-21</span> <span class="t" onclick="H(this)">03:35:19</span>          Matthew Pettis </span><span>Thank you!  If I copy and pasted this correctly, when i run </span><code>(require &apos;clara-lein.ex06rulesns)</code><span>  in </span><code>clara-lein.ex06</code><span> , I get an error that </span><code>No namespace: clara-lein.ex06rulesns found</code><span>.  I&apos;ll keep poking, but that&apos;s my current error...</span></div><div id="t1579577741012100" t="2020-01-21 03:35:41 Matthew Pettis ... and that&apos;s when I run the final  let  that creates the session..."><a href="#t1579577741012100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-21</span> <span class="t" onclick="H(this)">03:35:41</span>          Matthew Pettis </span><span>... and that&apos;s when I run the final </span><code>let</code><span> that creates the session...</span></div><div id="t1579577841013100" t="2020-01-21 03:37:21 Matthew Pettis oops, I take that back.  When I run that require statement, I get a ClassNotFound exception for clara-lein.ex06.Myfact."><a href="#t1579577841013100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-21</span> <span class="t" onclick="H(this)">03:37:21</span>          Matthew Pettis </span><span>oops, I take that back.  When I run that require statement, I get a ClassNotFound exception for clara-lein.ex06.Myfact.</span></div><div id="t1579623624017800" t="2020-01-21 16:20:24 Matthew Pettis So, I was able to make this work if I included all of the defrecords, rules, queries, and facts in a different namespace, referred that namespace, and then made a session with  mk-session &apos;source.namespace)  .  However, I am struggling to modularize this, so that I can make a session where facts come from one namespace, rules from another namespace, and queries from yet another namespace.  I&apos;m not sure if it is the namespace inclusion-ing that I am messing up, or that I don&apos;t know the proper syntax on  mk-session  or  insert  to build up a session that has facts, rules, and queries from these sources in it.  An pointing to examples of rules that has that would be appreciated.  I am doing this as an exercise to show that you can make a modular rules system and that clara-rules can support that modularity.  Which is why I&apos;m making a toy example that is doing this... thanks in advance..."><a href="#t1579623624017800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-21</span> <span class="t" onclick="H(this)">16:20:24</span>          Matthew Pettis </span><span>So, I was able to make this work if I included all of the defrecords, rules, queries, and facts in a different namespace, referred that namespace, and then made a session with </span><code>mk-session &apos;source.namespace)</code><span> .  However, I am struggling to modularize this, so that I can make a session where facts come from one namespace, rules from another namespace, and queries from yet another namespace.  I&apos;m not sure if it is the namespace inclusion-ing that I am messing up, or that I don&apos;t know the proper syntax on </span><code>mk-session</code><span> or </span><code>insert</code><span> to build up a session that has facts, rules, and queries from these sources in it.  An pointing to examples of rules that has that would be appreciated.  I am doing this as an exercise to show that you can make a modular rules system and that clara-rules can support that modularity.  Which is why I&apos;m making a toy example that is doing this... thanks in advance...</span></div><div id="t1579625988019200" t="2020-01-21 16:59:48 mikerod @matthew.pettis there are no special evaluation rules being done by Clara. You have to appropriately require all ns’s you depend on in the order they depend on each other via standard clj :require "><a href="#t1579625988019200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-21</span> <span class="t" onclick="H(this)">16:59:48</span>                 mikerod </span><span>@matthew.pettis there are no special evaluation rules being done by Clara. You have to appropriately require all ns’s you depend on in the order they depend on each other via standard clj :require </span></div><div id="t1579626002019600" t="2020-01-21 17:00:02 mikerod You can have things in as many ns’s as you want. "><a href="#t1579626002019600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-21</span> <span class="t" onclick="H(this)">17:00:02</span>                 mikerod </span><span>You can have things in as many ns’s as you want. </span></div><div id="t1579626027020500" t="2020-01-21 17:00:27 mikerod If you show your example I maybe can help. I’m confused what you are using to get into a situation you are describing at this point. "><a href="#t1579626027020500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-21</span> <span class="t" onclick="H(this)">17:00:27</span>                 mikerod </span><span>If you show your example I maybe can help. I’m confused what you are using to get into a situation you are describing at this point. </span></div><div id="t1579627561022100" t="2020-01-21 17:26:01 Matthew Pettis @mikerod Thanks for the help!  I pushed a repo here of example code that doesn&apos;t quite work, but has the rules, facts, and queries in separate namespaces.  The part is at the end of the core.clj file, where I assemble a session out of the facts, rules, and queries, to be able to query the session.   https://github.com/mpettis/clara-ns-ex"><a href="#t1579627561022100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-21</span> <span class="t" onclick="H(this)">17:26:01</span>          Matthew Pettis </span><span>@mikerod Thanks for the help!  I pushed a repo here of example code that doesn&apos;t quite work, but has the rules, facts, and queries in separate namespaces.  The part is at the end of the core.clj file, where I assemble a session out of the facts, rules, and queries, to be able to query the session.  </span><a href="https://github.com/mpettis/clara-ns-ex" target="_blank">https://github.com/mpettis/clara-ns-ex</a></div><div id="t1579635732022300" t="2020-01-21 19:42:12 mikerod First just style Notes:

In  clara-ns-ex.core , typically all  :require  are in one spec, but I guess what you have can work? I haven’t actually tested in recent clj:
 (ns clara-ns-ex.core
  (:require [clara.rules :refer :all]
            [clara-ns-ex.facts :refer :all]
            [clara-ns-ex.rules :refer :all]
            [clara-ns-ex.queries :refer :all])) 
Instead of
 fact-sess (apply insert query-sess facts) 
use  insert-all 
 fact-sess (insert-all query-sess facts) 
just since there is API to make you not need to use  apply  with varargs."><a href="#t1579635732022300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-21</span> <span class="t" onclick="H(this)">19:42:12</span>                      mikerod </span><span>First just style Notes:

In </span><code>clara-ns-ex.core</code><span>, typically all </span><code>:require</code><span> are in one spec, but I guess what you have can work? I haven’t actually tested in recent clj:
</span><pre>(ns clara-ns-ex.core
  (:require [clara.rules :refer :all]
            [clara-ns-ex.facts :refer :all]
            [clara-ns-ex.rules :refer :all]
            [clara-ns-ex.queries :refer :all]))</pre><span>
Instead of
</span><pre>fact-sess (apply insert query-sess facts)</pre><span>
use </span><code>insert-all</code><span>
</span><pre>fact-sess (insert-all query-sess facts)</pre><span>
just since there is API to make you not need to use </span><code>apply</code><span> with varargs.</span></div><div id="t1579635789022500" t="2020-01-21 19:43:09 mikerod Second (most important):
You don’t  insert  rules and queries. These are needed upfront at  mk-session  time. Clara actually does not support dynamically adding or removing rules/queries at all right now. It may be a future potential to add, but there are perf benefits to not doing so. Even if it did allow that later though, you wouldn’t “insert rules”.
 insert  is meant for facts, not rules."><a href="#t1579635789022500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-21</span> <span class="t" onclick="H(this)">19:43:09</span>                      mikerod </span><span>Second (most important):
You don’t </span><code>insert</code><span> rules and queries. These are needed upfront at </span><code>mk-session</code><span> time. Clara actually does not support dynamically adding or removing rules/queries at all right now. It may be a future potential to add, but there are perf benefits to not doing so. Even if it did allow that later though, you wouldn’t “insert rules”.
</span><code>insert</code><span> is meant for facts, not rules.</span></div><div id="t1579635839022700" t="2020-01-21 19:43:59 mikerod what you’d need to do for your example is:
 init-sess (mk-session &apos;clara-ns-ex.core &apos;clara-ns-ex.rules &apos;clara-ns-ex.queries) 
if you just wanted to automatically include all rules/queries defined in those namespaces."><a href="#t1579635839022700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-21</span> <span class="t" onclick="H(this)">19:43:59</span>                      mikerod </span><span>what you’d need to do for your example is:
</span><pre>init-sess (mk-session &apos;clara-ns-ex.core &apos;clara-ns-ex.rules &apos;clara-ns-ex.queries)</pre><span>
if you just wanted to automatically include all rules/queries defined in those namespaces.</span></div><div id="t1579640457022900" t="2020-01-21 21:00:57 Matthew Pettis OK, this is super-helpful, thank you so much!  I will try these changes as soon as possible."><a href="#t1579640457022900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-21</span> <span class="t" onclick="H(this)">21:00:57</span>               Matthew Pettis </span><span>OK, this is super-helpful, thank you so much!  I will try these changes as soon as possible.</span></div><div id="t1579640679023100" t="2020-01-21 21:04:39 Matthew Pettis I was not aware that rules and queries could not be dynamically added.  It is nice to see an example of  mk-session  with multiple namepaces put in there.  I wasn&apos;t sure if it was as a varargs or as a vector of namespaces, etc."><a href="#t1579640679023100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-21</span> <span class="t" onclick="H(this)">21:04:39</span>               Matthew Pettis </span><span>I was not aware that rules and queries could not be dynamically added.  It is nice to see an example of </span><code>mk-session</code><span> with multiple namepaces put in there.  I wasn&apos;t sure if it was as a varargs or as a vector of namespaces, etc.</span></div><div id="t1579641369023300" t="2020-01-21 21:16:09 mikerod @matthew.pettis there is likely an issue or 2 in the github repo discussing dynamic rules. However, you may not need it as much as immediately it seems."><a href="#t1579641369023300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-21</span> <span class="t" onclick="H(this)">21:16:09</span>                      mikerod </span><span>@matthew.pettis there is likely an issue or 2 in the github repo discussing dynamic rules. However, you may not need it as much as immediately it seems.</span></div><div id="t1579641382023500" t="2020-01-21 21:16:22 mikerod Often there are solutions that don’t need that sort of feature at least."><a href="#t1579641382023500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-21</span> <span class="t" onclick="H(this)">21:16:22</span>                      mikerod </span><span>Often there are solutions that don’t need that sort of feature at least.</span></div><div id="t1579657916023700" t="2020-01-22 01:51:56 Matthew Pettis I agree; I don&apos;t need dynamic rules.  I more needed a hint as to the fact that they are supplied and loaded upon  mk-session ."><a href="#t1579657916023700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-22</span> <span class="t" onclick="H(this)">01:51:56</span>               Matthew Pettis </span><span>I agree; I don&apos;t need dynamic rules.  I more needed a hint as to the fact that they are supplied and loaded upon </span><code>mk-session</code><span>.</span></div><div id="t1579657994023900" t="2020-01-22 01:53:14 Matthew Pettis To that end, I tried your advice, I think I did it faithfully, and wasn&apos;t able to make it work yet.  My adjustments are at this commit:  https://github.com/mpettis/clara-ns-ex/tree/0bdb72e98a8ef657de08579af6ee993c9008a738"><a href="#t1579657994023900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-22</span> <span class="t" onclick="H(this)">01:53:14</span>               Matthew Pettis </span><span>To that end, I tried your advice, I think I did it faithfully, and wasn&apos;t able to make it work yet.  My adjustments are at this commit: </span><a href="https://github.com/mpettis/clara-ns-ex/tree/0bdb72e98a8ef657de08579af6ee993c9008a738" target="_blank">https://github.com/mpettis/clara-ns-ex/tree/0bdb72e98a8ef657de08579af6ee993c9008a738</a></div><div id="t1579658069024100" t="2020-01-22 01:54:29 Matthew Pettis When I run that, I still get that  Myfact  class cannot be found.  I think I&apos;m probably missing something about using  defrecord  definitions from other namespaces."><a href="#t1579658069024100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-22</span> <span class="t" onclick="H(this)">01:54:29</span>               Matthew Pettis </span><span>When I run that, I still get that </span><code>Myfact</code><span> class cannot be found.  I think I&apos;m probably missing something about using </span><code>defrecord</code><span> definitions from other namespaces.</span></div><div id="t1579658644024500" t="2020-01-22 02:04:04 Matthew Pettis Also, for a baseline, this is how I make it work when everything is in the same namespace...  https://github.com/mpettis/clara-ns-ex/blob/nonamespace/src/clara_ns_ex/core.clj"><a href="#t1579658644024500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-22</span> <span class="t" onclick="H(this)">02:04:04</span>               Matthew Pettis </span><span>Also, for a baseline, this is how I make it work when everything is in the same namespace... </span><a href="https://github.com/mpettis/clara-ns-ex/blob/nonamespace/src/clara_ns_ex/core.clj" target="_blank">https://github.com/mpettis/clara-ns-ex/blob/nonamespace/src/clara_ns_ex/core.clj</a></div><div id="t1579660139025700" t="2020-01-22 02:28:59 mikerod @matthew.pettis so you’re issue isn’t just referring to record symbols. Have to follow normal clojure symbol resolution rules. "><a href="#t1579660139025700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-22</span> <span class="t" onclick="H(this)">02:28:59</span>                      mikerod </span><span>@matthew.pettis so you’re issue isn’t just referring to record symbols. Have to follow normal clojure symbol resolution rules. </span></div><div id="t1579660152026300" t="2020-01-22 02:29:12 mikerod So you require the ns that defines the records - to ensure it is compiled. "><a href="#t1579660152026300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-22</span> <span class="t" onclick="H(this)">02:29:12</span>                      mikerod </span><span>So you require the ns that defines the records - to ensure it is compiled. </span></div><div id="t1579660186027400" t="2020-01-22 02:29:46 mikerod Then you typically would use :import in clj (not cljs) to refer to the record class name as the shortened version"><a href="#t1579660186027400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-22</span> <span class="t" onclick="H(this)">02:29:46</span>                      mikerod </span><span>Then you typically would use :import in clj (not cljs) to refer to the record class name as the shortened version</span></div><div id="t1579660216028300" t="2020-01-22 02:30:16 mikerod Otherwise you’d have to fully qualify it each reference clara_ns_ex.facts.Myfact"><a href="#t1579660216028300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-22</span> <span class="t" onclick="H(this)">02:30:16</span>                      mikerod </span><span>Otherwise you’d have to fully qualify it each reference clara_ns_ex.facts.Myfact</span></div><div id="t1579660822028600" t="2020-01-22 02:40:22 Matthew Pettis Thanks.  I thought about that a bit more after I posted, I&apos;ll think a bit more carefully about resolution rules, and think I may get it... Thanks for the help; learning Clojure as I learn Clara here..."><a href="#t1579660822028600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-22</span> <span class="t" onclick="H(this)">02:40:22</span>               Matthew Pettis </span><span>Thanks.  I thought about that a bit more after I posted, I&apos;ll think a bit more carefully about resolution rules, and think I may get it... Thanks for the help; learning Clojure as I learn Clara here...</span></div><div id="t1579663255029100" t="2020-01-22 03:20:55 mikerod No problem. Let me know if more questions"><a href="#t1579663255029100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-22</span> <span class="t" onclick="H(this)">03:20:55</span>                      mikerod </span><span>No problem. Let me know if more questions</span></div><div id="t1579663272029800" t="2020-01-22 03:21:12 mikerod I’d give better examples but typing on mobile is hard hah"><a href="#t1579663272029800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-22</span> <span class="t" onclick="H(this)">03:21:12</span>                      mikerod </span><span>I’d give better examples but typing on mobile is hard hah</span></div><div id="t1579664854030100" t="2020-01-22 03:47:34 Matthew Pettis I really appreciate the help."><a href="#t1579664854030100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-22</span> <span class="t" onclick="H(this)">03:47:34</span>               Matthew Pettis </span><span>I really appreciate the help.</span></div><div id="t1579666774030300" t="2020-01-22 04:19:34 Matthew Pettis fyi, i think i&apos;m closer, but I can&apos;t decipher the location of where the error of can&apos;t find Class for Myfact, as it won&apos;t tell me at what line it is failing.  This is the state that I have it:  https://github.com/mpettis/clara-ns-ex/tree/f3d6f67346eacb61294205f6da0e1f3073e7428a"><a href="#t1579666774030300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-22</span> <span class="t" onclick="H(this)">04:19:34</span>               Matthew Pettis </span><span>fyi, i think i&apos;m closer, but I can&apos;t decipher the location of where the error of can&apos;t find Class for Myfact, as it won&apos;t tell me at what line it is failing.  This is the state that I have it: </span><a href="https://github.com/mpettis/clara-ns-ex/tree/f3d6f67346eacb61294205f6da0e1f3073e7428a" target="_blank">https://github.com/mpettis/clara-ns-ex/tree/f3d6f67346eacb61294205f6da0e1f3073e7428a</a></div><div id="t1579666889030500" t="2020-01-22 04:21:29 Matthew Pettis I have the import statements, I tested that it worked.  I referenced these pages that went with the hint that @mikerod gave me on using import:  https://danielcompton.net/2016/05/04/requiring-records-clojure-clojurescript  and  https://stackoverflow.com/a/23420084/1022967"><a href="#t1579666889030500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-22</span> <span class="t" onclick="H(this)">04:21:29</span>               Matthew Pettis </span><span>I have the import statements, I tested that it worked.  I referenced these pages that went with the hint that @mikerod gave me on using import: </span><a href="https://danielcompton.net/2016/05/04/requiring-records-clojure-clojurescript" target="_blank">https://danielcompton.net/2016/05/04/requiring-records-clojure-clojurescript</a><span> and </span><a href="https://stackoverflow.com/a/23420084/1022967" target="_blank">https://stackoverflow.com/a/23420084/1022967</a></div><div id="t1579667992030800" t="2020-01-22 04:39:52 Matthew Pettis OK, I got it to work by playing with what did and did not need namespace qualified names, and where.  I don&apos;t fully understand the rules of when I should and should not yet, but I have a working example to go off of, so thanks for all of your help!  Here is the commit that has a working example:  https://github.com/mpettis/clara-ns-ex/tree/d077c141d305ef217043bcf44a328c6921311847"><a href="#t1579667992030800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-22</span> <span class="t" onclick="H(this)">04:39:52</span>               Matthew Pettis </span><span>OK, I got it to work by playing with what did and did not need namespace qualified names, and where.  I don&apos;t fully understand the rules of when I should and should not yet, but I have a working example to go off of, so thanks for all of your help!  Here is the commit that has a working example: </span><a href="https://github.com/mpettis/clara-ns-ex/tree/d077c141d305ef217043bcf44a328c6921311847" target="_blank">https://github.com/mpettis/clara-ns-ex/tree/d077c141d305ef217043bcf44a328c6921311847</a></div><div id="t1579686087031000" t="2020-01-22 09:41:27 wparker Looks like you&apos;ve got it figured out mostly.  :). You don&apos;t need the fact class imports in your core namespace, but rather just in the rule/query namespaces that use them.  Clara rule and query defs use the same evaluation semantics as normal Clojure code, that is something used, be it a function, class, etc. needs to be resolvable in the namespace where the rule/query is being defined.  Also it&apos;s somewhat a matter of personal preference, but I find it more clear where things are coming from when I use :as aliases rather than :refer :all, that might help reduce confusion."><a href="#t1579686087031000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-22</span> <span class="t" onclick="H(this)">09:41:27</span>                      wparker </span><span>Looks like you&apos;ve got it figured out mostly.  :). You don&apos;t need the fact class imports in your core namespace, but rather just in the rule/query namespaces that use them.  Clara rule and query defs use the same evaluation semantics as normal Clojure code, that is something used, be it a function, class, etc. needs to be resolvable in the namespace where the rule/query is being defined.  Also it&apos;s somewhat a matter of personal preference, but I find it more clear where things are coming from when I use :as aliases rather than :refer :all, that might help reduce confusion.</span></div><div id="t1579686211031200" t="2020-01-22 09:43:31 wparker Admittedly there&apos;s a fair amount of code in Clara dealing with that evaluation, but the end result is to have the same user-facing semantics."><a href="#t1579686211031200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-22</span> <span class="t" onclick="H(this)">09:43:31</span>                      wparker </span><span>Admittedly there&apos;s a fair amount of code in Clara dealing with that evaluation, but the end result is to have the same user-facing semantics.</span></div><div id="t1579697664031400" t="2020-01-22 12:54:24 Matthew Pettis Awesome!  I&apos;ll take out the require and import statements in core and use :as aliases in the rest and push a cleaner example.  Thanks for the help."><a href="#t1579697664031400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-22</span> <span class="t" onclick="H(this)">12:54:24</span>               Matthew Pettis </span><span>Awesome!  I&apos;ll take out the require and import statements in core and use :as aliases in the rest and push a cleaner example.  Thanks for the help.</span></div><div id="t1579700902033600" t="2020-01-22 13:48:22 mikerod I also advocate for :as aliases too. It helps to make it clear where symbols are coming from. ClojureScript doesn’t even have :refer :all support! Hah"><a href="#t1579700902033600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-22</span> <span class="t" onclick="H(this)">13:48:22</span>                      mikerod </span><span>I also advocate for :as aliases too. It helps to make it clear where symbols are coming from. ClojureScript doesn’t even have :refer :all support! Hah</span></div><div id="t1579701962034100" t="2020-01-22 14:06:02 Matthew Pettis I just discovered &apos;how to ns&apos; by Sierra, reading that to guide me on that:  https://stuartsierra.com/2016/clojure-how-to-ns.html"><a href="#t1579701962034100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-22</span> <span class="t" onclick="H(this)">14:06:02</span>               Matthew Pettis </span><span>I just discovered &apos;how to ns&apos; by Sierra, reading that to guide me on that: </span><a href="https://stuartsierra.com/2016/clojure-how-to-ns.html" target="_blank">https://stuartsierra.com/2016/clojure-how-to-ns.html</a></div><div id="t1579702255037300" t="2020-01-22 14:10:55 mikerod I thought it had some good points. I can’t remember if I fully agreed with it, but analyzing require forms can become a debate of “taste” at a certain point. Hah. He does at least mention its opinionated.  😎"><a href="#t1579702255037300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-22</span> <span class="t" onclick="H(this)">14:10:55</span>                      mikerod </span><span>I thought it had some good points. I can’t remember if I fully agreed with it, but analyzing require forms can become a debate of “taste” at a certain point. Hah. He does at least mention its opinionated. </span><b>😎</b></div><div id="t1579703573037700" t="2020-01-22 14:32:53 Matthew Pettis OK, just for completeness and posterity... For this question, which was how to use namespaced rules, queries, and facts in making a session, I cleaned up the namespace declaration, using Sierra&apos;s &quot;how to ns&quot; style recommendations, and removed most :require :refer :all statements to be more precise (except for  clara-rules ).  Here is the commit that is cleaned up per this comment:  https://github.com/mpettis/clara-ns-ex/tree/8b78de1442fd8484341cc68d6ac63b7d78cf85e4"><a href="#t1579703573037700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-22</span> <span class="t" onclick="H(this)">14:32:53</span>               Matthew Pettis </span><span>OK, just for completeness and posterity... For this question, which was how to use namespaced rules, queries, and facts in making a session, I cleaned up the namespace declaration, using Sierra&apos;s &quot;how to ns&quot; style recommendations, and removed most :require :refer :all statements to be more precise (except for </span><code>clara-rules</code><span>).  Here is the commit that is cleaned up per this comment: </span><a href="https://github.com/mpettis/clara-ns-ex/tree/8b78de1442fd8484341cc68d6ac63b7d78cf85e4" target="_blank">https://github.com/mpettis/clara-ns-ex/tree/8b78de1442fd8484341cc68d6ac63b7d78cf85e4</a></div><div id="t1579703642037900" t="2020-01-22 14:34:02 Matthew Pettis"><a href="#t1579703642037900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-22</span> <span class="t" onclick="H(this)">14:34:02</span>          Matthew Pettis </span></div><div id="t1579711388038400" t="2020-01-22 16:43:08 mikerod @matthew.pettis nice, glad to see you sorted it out - looks better too"><a href="#t1579711388038400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-22</span> <span class="t" onclick="H(this)">16:43:08</span>                 mikerod </span><span>@matthew.pettis nice, glad to see you sorted it out - looks better too</span></div><div id="t1579725863039800" t="2020-01-22 20:44:23 Matthew Pettis Thanks again for the help.  I think it is helpful to have an example for clara-rules that leverages namespaces.  I think I&apos;ll see if cerner/clara-examples would consider adding it as an example.  Or somewhere.  Nice to have a battery of examples for some of this..."><a href="#t1579725863039800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-22</span> <span class="t" onclick="H(this)">20:44:23</span>          Matthew Pettis </span><span>Thanks again for the help.  I think it is helpful to have an example for clara-rules that leverages namespaces.  I think I&apos;ll see if cerner/clara-examples would consider adding it as an example.  Or somewhere.  Nice to have a battery of examples for some of this...</span></div><div id="t1579726253041100" t="2020-01-22 20:50:53 mikerod @matthew.pettis yeah more examples could be good. Not sure when the last time that repo was updated. But perhaps it is the right place. There are also docs that maybe could explain some things more "><a href="#t1579726253041100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-22</span> <span class="t" onclick="H(this)">20:50:53</span>                 mikerod </span><span>@matthew.pettis yeah more examples could be good. Not sure when the last time that repo was updated. But perhaps it is the right place. There are also docs that maybe could explain some things more </span></div><div id="t1579726277041300" t="2020-01-22 20:51:17 mikerod http://www.clara-rules.org"><a href="#t1579726277041300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-22</span> <span class="t" onclick="H(this)">20:51:17</span>                 mikerod </span><a href="http://www.clara-rules.org" target="_blank">http://www.clara-rules.org</a></div><div id="t1579726638044800" t="2020-01-22 20:57:18 Matthew Pettis @mikerod Yep, started there, read the documentation, some of it was vague to me, and not sure if is lack of experience on my part or it just doesn&apos;t have attention anymore to curate.  Also, fwiw, I am making a different repo of collected small steps for myself for self-training.  In this link, I use clara-rules to solve a logic puzzle, much like could be done with core.logic.  However, I did it in clara-rules not because it was more efficient (oh, my example is real slow and memory hoggy), but because it mimicked a different scenario I think I want to apply clara-rules to.  Here is that particular example...  https://github.com/mpettis/clara-lien/blob/master/src/clara_lein/ex05.clj"><a href="#t1579726638044800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-22</span> <span class="t" onclick="H(this)">20:57:18</span>          Matthew Pettis </span><span>@mikerod Yep, started there, read the documentation, some of it was vague to me, and not sure if is lack of experience on my part or it just doesn&apos;t have attention anymore to curate.  Also, fwiw, I am making a different repo of collected small steps for myself for self-training.  In this link, I use clara-rules to solve a logic puzzle, much like could be done with core.logic.  However, I did it in clara-rules not because it was more efficient (oh, my example is real slow and memory hoggy), but because it mimicked a different scenario I think I want to apply clara-rules to.  Here is that particular example... </span><a href="https://github.com/mpettis/clara-lien/blob/master/src/clara_lein/ex05.clj" target="_blank">https://github.com/mpettis/clara-lien/blob/master/src/clara_lein/ex05.clj</a></div><div id="t1579728516045300" t="2020-01-22 21:28:36 mikerod that’s interesting, could be something nice to add to docs or examples"><a href="#t1579728516045300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-22</span> <span class="t" onclick="H(this)">21:28:36</span>                 mikerod </span><span>that’s interesting, could be something nice to add to docs or examples</span></div><div id="t1580270298000500" t="2020-01-29 03:58:18 bartuka would be great at the examples!"><a href="#t1580270298000500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-29</span> <span class="t" onclick="H(this)">03:58:18</span>                 bartuka </span><span>would be great at the examples!</span></div><div id="t1580270326001200" t="2020-01-29 03:58:46 bartuka I am currently teaching the basics of this library to some teammates and this will be a nice exercise to challenge them latter"><a href="#t1580270326001200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-29</span> <span class="t" onclick="H(this)">03:58:46</span>                 bartuka </span><span>I am currently teaching the basics of this library to some teammates and this will be a nice exercise to challenge them latter</span></div><div id="t1580514974001600" t="2020-01-31 23:56:14 Matthew Pettis My slack history is limited... Do you have a link to the GitHub where I put this?"><a href="#t1580514974001600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-01-31</span> <span class="t" onclick="H(this)">23:56:14</span>               Matthew Pettis </span><span>My slack history is limited... Do you have a link to the GitHub where I put this?</span></div><div id="t1580526291001800" t="2020-02-01 03:04:51 bartuka https://github.com/mpettis/clara-lien/blob/master/src/clara_lein/ex05.clj"><a href="#t1580526291001800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-02-01</span> <span class="t" onclick="H(this)">03:04:51</span>                      bartuka </span><a href="https://github.com/mpettis/clara-lien/blob/master/src/clara_lein/ex05.clj" target="_blank">https://github.com/mpettis/clara-lien/blob/master/src/clara_lein/ex05.clj</a></div><div id="t1580526321002100" t="2020-02-01 03:05:21 bartuka this one?"><a href="#t1580526321002100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-02-01</span> <span class="t" onclick="H(this)">03:05:21</span>                      bartuka </span><span>this one?</span></div><div id="t1580528268002300" t="2020-02-01 03:37:48 Matthew Pettis Yeah.  That repo is where I am putting probably all my examples..."><a href="#t1580528268002300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-02-01</span> <span class="t" onclick="H(this)">03:37:48</span>               Matthew Pettis </span><span>Yeah.  That repo is where I am putting probably all my examples...</span></div><div id="t1580548918002500" t="2020-02-01 09:21:58 bartuka great! thanks"><a href="#t1580548918002500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-02-01</span> <span class="t" onclick="H(this)">09:21:58</span>                      bartuka </span><span>great! thanks</span></div><div id="t1581110083010200" t="2020-02-07 21:14:43 Matthew Pettis Because it occurs to me that rules like this are just like basic syllogisms (which I&apos;m sure others have observed long before me here) I put together a dead-simple example of making the rules engine do modus ponens from basic propositional logic.   https://github.com/mpettis/clara-lien/blob/master/src/clara_lein/ex07.clj"><a href="#t1581110083010200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-02-07</span> <span class="t" onclick="H(this)">21:14:43</span>          Matthew Pettis </span><span>Because it occurs to me that rules like this are just like basic syllogisms (which I&apos;m sure others have observed long before me here) I put together a dead-simple example of making the rules engine do modus ponens from basic propositional logic.  </span><a href="https://github.com/mpettis/clara-lien/blob/master/src/clara_lein/ex07.clj" target="_blank">https://github.com/mpettis/clara-lien/blob/master/src/clara_lein/ex07.clj</a></div><div id="t1581111369011500" t="2020-02-07 21:36:09 ethanc I don’t believe that the rhs should be wrapped in a vector,
 https://github.com/mpettis/clara-lien/blob/master/src/clara_lein/ex07.clj#L28"><a href="#t1581111369011500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-02-07</span> <span class="t" onclick="H(this)">21:36:09</span>                       ethanc </span><span>I don’t believe that the rhs should be wrapped in a vector,
</span><a href="https://github.com/mpettis/clara-lien/blob/master/src/clara_lein/ex07.clj#L28" target="_blank">https://github.com/mpettis/clara-lien/blob/master/src/clara_lein/ex07.clj#L28</a></div><div id="t1581111781011800" t="2020-02-07 21:43:01 ethanc my reasoning with this nit is, that the clara wraps the rhs inside a fn and executes it when the lhs is satisfied.

basically something like:
 (fn [bindings] 
  &lt;original form&gt;) 
The inserts! would be considered stateful as the operate on the active session, thus the example still works its just the vector is superfluous.

I am just being nit picky though"><a href="#t1581111781011800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-02-07</span> <span class="t" onclick="H(this)">21:43:01</span>                       ethanc </span><span>my reasoning with this nit is, that the clara wraps the rhs inside a fn and executes it when the lhs is satisfied.

basically something like:
</span><pre>(fn [bindings] 
  &lt;original form&gt;)</pre><span>
The inserts! would be considered stateful as the operate on the active session, thus the example still works its just the vector is superfluous.

I am just being nit picky though</span></div><div id="t1581111853012000" t="2020-02-07 21:44:13 Matthew Pettis this is good... i was getting some wierd nested results when I ran (but still had right answers).  I&apos;ll remove and see if that does what&apos;s expected; i didn&apos;t notice I had wrapped that..."><a href="#t1581111853012000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-02-07</span> <span class="t" onclick="H(this)">21:44:13</span>               Matthew Pettis </span><span>this is good... i was getting some wierd nested results when I ran (but still had right answers).  I&apos;ll remove and see if that does what&apos;s expected; i didn&apos;t notice I had wrapped that...</span></div><div id="t1581115188012200" t="2020-02-07 22:39:48 Matthew Pettis ... guess i&apos;m a little surprised it worked in the original, now that I see it..."><a href="#t1581115188012200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-02-07</span> <span class="t" onclick="H(this)">22:39:48</span>               Matthew Pettis </span><span>... guess i&apos;m a little surprised it worked in the original, now that I see it...</span></div><div id="t1581117682012400" t="2020-02-07 23:21:22 ethanc I should add that clara also wraps the RHS form in a  do  when you use  defrule .

 (fn [bindings] 
  (do 
     &lt;form&gt;)) 
Since clara doesn’t use the returned value from this function, it doesn’t really make a difference, clojure will gladly return a vector with whatever  insert!  returns.
Which is promptly ignored by clara  🙂"><a href="#t1581117682012400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-02-07</span> <span class="t" onclick="H(this)">23:21:22</span>                       ethanc </span><span>I should add that clara also wraps the RHS form in a </span><code>do</code><span> when you use </span><code>defrule</code><span>.

</span><pre>(fn [bindings] 
  (do 
     &lt;form&gt;))</pre><span>
Since clara doesn’t use the returned value from this function, it doesn’t really make a difference, clojure will gladly return a vector with whatever </span><code>insert!</code><span> returns.
Which is promptly ignored by clara </span><b>🙂</b></div><div id="t1581186376012800" t="2020-02-08 18:26:16 Matthew Pettis fixed and pushed."><a href="#t1581186376012800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-02-08</span> <span class="t" onclick="H(this)">18:26:16</span>               Matthew Pettis </span><span>fixed and pushed.</span></div><div id="t1581110158011300" t="2020-02-07 21:15:58 Matthew Pettis And a slightly more complicated example here too.  I&apos;m just experimenting, not saying this is the optimal way to do this, but it is just fleshing out some thoughts and analogies that might be useful for others teaching rules-engines concepts.  criticisms welcome.   https://github.com/mpettis/clara-lien/blob/master/src/clara_lein/ex08.clj"><a href="#t1581110158011300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-02-07</span> <span class="t" onclick="H(this)">21:15:58</span>          Matthew Pettis </span><span>And a slightly more complicated example here too.  I&apos;m just experimenting, not saying this is the optimal way to do this, but it is just fleshing out some thoughts and analogies that might be useful for others teaching rules-engines concepts.  criticisms welcome.  </span><a href="https://github.com/mpettis/clara-lien/blob/master/src/clara_lein/ex08.clj" target="_blank">https://github.com/mpettis/clara-lien/blob/master/src/clara_lein/ex08.clj</a></div><div id="t1581293917014100" t="2020-02-10 00:18:37 Matthew Pettis Documentation question: from this page ( http://www.clara-rules.org/docs/rules/ ), in the  defrule  structure flow has an optional  props  token.  I can&apos;t find anywhere in the documentation that talks about what that actually is.  Can anyone point me to what that is?"><a href="#t1581293917014100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-02-10</span> <span class="t" onclick="H(this)">00:18:37</span>          Matthew Pettis </span><span>Documentation question: from this page (</span><a href="http://www.clara-rules.org/docs/rules/" target="_blank">http://www.clara-rules.org/docs/rules/</a><span>), in the </span><code>defrule</code><span> structure flow has an optional </span><code>props</code><span> token.  I can&apos;t find anywhere in the documentation that talks about what that actually is.  Can anyone point me to what that is?</span></div><div id="t1581351370014300" t="2020-02-10 16:16:10 wparker The primary property used currently is salience, which allows users to control the order in which rules fire.  Usually it shouldn’t be necessary, but sometimes is useful either for performance optimization or when rules opt out of truth maintenance (by using unconditional insertions and/or RHS retractions).  The latter tends to make things more complicated in my experience, but sometimes can be useful/necessary"><a href="#t1581351370014300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-02-10</span> <span class="t" onclick="H(this)">16:16:10</span>                      wparker </span><span>The primary property used currently is salience, which allows users to control the order in which rules fire.  Usually it shouldn’t be necessary, but sometimes is useful either for performance optimization or when rules opt out of truth maintenance (by using unconditional insertions and/or RHS retractions).  The latter tends to make things more complicated in my experience, but sometimes can be useful/necessary</span></div><div id="t1581352884014500" t="2020-02-10 16:41:24 Matthew Pettis OK, thank you, this is nice to know."><a href="#t1581352884014500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-02-10</span> <span class="t" onclick="H(this)">16:41:24</span>               Matthew Pettis </span><span>OK, thank you, this is nice to know.</span></div><div id="t1581355341015200" t="2020-02-10 17:22:21 mikerod They are undocumented to discourage use perhaps. Hah"><a href="#t1581355341015200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-02-10</span> <span class="t" onclick="H(this)">17:22:21</span>                      mikerod </span><span>They are undocumented to discourage use perhaps. Hah</span></div><div id="t1581355356015800" t="2020-02-10 17:22:36 mikerod I thought salience may be documented somewhere though. Would have to look"><a href="#t1581355356015800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-02-10</span> <span class="t" onclick="H(this)">17:22:36</span>                      mikerod </span><span>I thought salience may be documented somewhere though. Would have to look</span></div><div id="t1581363251016000" t="2020-02-10 19:34:11 Matthew Pettis yep, salience is documented here:  http://www.clara-rules.org/docs/conflictsalience/"><a href="#t1581363251016000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-02-10</span> <span class="t" onclick="H(this)">19:34:11</span>               Matthew Pettis </span><span>yep, salience is documented here: </span><a href="http://www.clara-rules.org/docs/conflictsalience/" target="_blank">http://www.clara-rules.org/docs/conflictsalience/</a></div><div id="t1581363311016300" t="2020-02-10 19:35:11 Matthew Pettis I just didn&apos;t connect what I read there with what I read in the documentation..."><a href="#t1581363311016300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-02-10</span> <span class="t" onclick="H(this)">19:35:11</span>               Matthew Pettis </span><span>I just didn&apos;t connect what I read there with what I read in the documentation...</span></div><div id="t1584390451001100" t="2020-03-16 20:27:31 eraserhd Hey, remember when I said I wanted a command-line Clara rules-like thing?  It exists:  https://www.w3.org/2000/10/swap/doc/cwm.html"><a href="#t1584390451001100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-03-16</span> <span class="t" onclick="H(this)">20:27:31</span>                eraserhd </span><span>Hey, remember when I said I wanted a command-line Clara rules-like thing?  It exists: </span><a href="https://www.w3.org/2000/10/swap/doc/cwm.html" target="_blank">https://www.w3.org/2000/10/swap/doc/cwm.html</a></div><div id="t1584405805001600" t="2020-03-17 00:43:25 staypufd Cool"><a href="#t1584405805001600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-03-17</span> <span class="t" onclick="H(this)">00:43:25</span>                staypufd </span><span>Cool</span></div><div id="t1585740774001000" t="2020-04-01 11:32:54 narkisr Hey Clara team I&apos;m trying to require clara and I&apos;m getting an error

 namespace &apos;clara.rules.schema&apos; not found 
Any idea what I&apos;m missing? (I am able to require &apos; http://calra.ru"><a href="#t1585740774001000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-04-01</span> <span class="t" onclick="H(this)">11:32:54</span>                 narkisr </span><span>Hey Clara team I&apos;m trying to require clara and I&apos;m getting an error

</span><pre>namespace &apos;clara.rules.schema&apos; not found</pre><span>
Any idea what I&apos;m missing? (I am able to require &apos;</span><a href="http://calra.ru" target="_blank">http://calra.ru</a></div><div id="t1585741536001500" t="2020-04-01 11:45:36 narkisr Ok seems like I had a conflicting [prismatic/schema &quot;1.1.6&quot;] version in my classpath all good  🙂"><a href="#t1585741536001500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-04-01</span> <span class="t" onclick="H(this)">11:45:36</span>                 narkisr </span><span>Ok seems like I had a conflicting [prismatic/schema &quot;1.1.6&quot;] version in my classpath all good </span><b>🙂</b></div><div id="t1585750541003700" t="2020-04-01 14:15:41 ethanc I wonder if it would make sense to rip that dependency out of clara. I know it adds a bit of clarity to the underlying structure of the Sessions and whatnot, but it is another dependency we are forcing on consumers. @mikerod do you have any thoughts here?"><a href="#t1585750541003700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-04-01</span> <span class="t" onclick="H(this)">14:15:41</span>                  ethanc </span><span>I wonder if it would make sense to rip that dependency out of clara. I know it adds a bit of clarity to the underlying structure of the Sessions and whatnot, but it is another dependency we are forcing on consumers. @mikerod do you have any thoughts here?</span></div><div id="t1585751602004000" t="2020-04-01 14:33:22 mikerod @ethanc replace with spec or just nothing?"><a href="#t1585751602004000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-04-01</span> <span class="t" onclick="H(this)">14:33:22</span>                 mikerod </span><span>@ethanc replace with spec or just nothing?</span></div><div id="t1585751618004700" t="2020-04-01 14:33:38 mikerod We maybe could get the schema ns usage to be optional (and use it in tests too)"><a href="#t1585751618004700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-04-01</span> <span class="t" onclick="H(this)">14:33:38</span>                 mikerod </span><span>We maybe could get the schema ns usage to be optional (and use it in tests too)</span></div><div id="t1585751658005500" t="2020-04-01 14:34:18 ethanc Spec would probably be the ideal, but i’m not sure what all is going to have to change to uplift clojure/clojurescript versios"><a href="#t1585751658005500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-04-01</span> <span class="t" onclick="H(this)">14:34:18</span>                  ethanc </span><span>Spec would probably be the ideal, but i’m not sure what all is going to have to change to uplift clojure/clojurescript versios</span></div><div id="t1585752376006000" t="2020-04-01 14:46:16 mikerod spec could probably be added without much difficulty on the versioning front, but actually making the spec would be more time consuming"><a href="#t1585752376006000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-04-01</span> <span class="t" onclick="H(this)">14:46:16</span>                 mikerod </span><span>spec could probably be added without much difficulty on the versioning front, but actually making the spec would be more time consuming</span></div><div id="t1585752390006400" t="2020-04-01 14:46:30 mikerod Perhaps we can just get the schema to be an option dependency we only check/bring in during the  :dev  profile?"><a href="#t1585752390006400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-04-01</span> <span class="t" onclick="H(this)">14:46:30</span>                 mikerod </span><span>Perhaps we can just get the schema to be an option dependency we only check/bring in during the </span><code>:dev</code><span> profile?</span></div><div id="t1585752581007000" t="2020-04-01 14:49:41 ethanc I’m not completely sure how we could do that."><a href="#t1585752581007000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-04-01</span> <span class="t" onclick="H(this)">14:49:41</span>                  ethanc </span><span>I’m not completely sure how we could do that.</span></div><div id="t1585754685007600" t="2020-04-01 15:24:45 mikerod probably would have to shim some schema fn’s/macros"><a href="#t1585754685007600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-04-01</span> <span class="t" onclick="H(this)">15:24:45</span>                 mikerod </span><span>probably would have to shim some schema fn’s/macros</span></div><div id="t1585754694007900" t="2020-04-01 15:24:54 mikerod and have them at compile time decide if the dep is there or not - if not fall back"><a href="#t1585754694007900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-04-01</span> <span class="t" onclick="H(this)">15:24:54</span>                 mikerod </span><span>and have them at compile time decide if the dep is there or not - if not fall back</span></div><div id="t1585754714008300" t="2020-04-01 15:25:14 mikerod probably isn’t easy if using harder macro features like schema’s  defn  or  defrecord"><a href="#t1585754714008300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-04-01</span> <span class="t" onclick="H(this)">15:25:14</span>                 mikerod </span><span>probably isn’t easy if using harder macro features like schema’s </span><code>defn</code><span> or </span><code>defrecord</code></div><div id="t1585755780008800" t="2020-04-01 15:43:00 ethanc which clara does, at least for the defrecord."><a href="#t1585755780008800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-04-01</span> <span class="t" onclick="H(this)">15:43:00</span>                  ethanc </span><span>which clara does, at least for the defrecord.</span></div><div id="t1585757293009100" t="2020-04-01 16:08:13 mikerod yeah, so it’s likely difficult  😛"><a href="#t1585757293009100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-04-01</span> <span class="t" onclick="H(this)">16:08:13</span>                 mikerod </span><span>yeah, so it’s likely difficult </span><b>😛</b></div><div id="t1585760751010100" t="2020-04-01 17:05:51 ethanc I really wouldn’t want to be in the business of trying to parse schema’s forms and convert them back into clojure’s forms"><a href="#t1585760751010100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-04-01</span> <span class="t" onclick="H(this)">17:05:51</span>                  ethanc </span><span>I really wouldn’t want to be in the business of trying to parse schema’s forms and convert them back into clojure’s forms</span></div><div id="t1585762087010500" t="2020-04-01 17:28:07 mikerod No. I wouldn’t want that either"><a href="#t1585762087010500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-04-01</span> <span class="t" onclick="H(this)">17:28:07</span>                 mikerod </span><span>No. I wouldn’t want that either</span></div><div id="t1585827604011900" t="2020-04-02 11:40:04 narkisr BTW I think that I have a very interesting use case for Clara rules, once done ill share it but I&apos;m very excited about it"><a href="#t1585827604011900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-04-02</span> <span class="t" onclick="H(this)">11:40:04</span>                 narkisr </span><span>BTW I think that I have a very interesting use case for Clara rules, once done ill share it but I&apos;m very excited about it</span></div><div id="t1585837191014700" t="2020-04-02 14:19:51 narkisr Hi Clara team, is there an option to run a query that matches any fact? for example:

 (defquery get-failures [] 
    (?f &lt;- [_ true])) 
Assuming that the first value in the vector is not important we only care for the second true value"><a href="#t1585837191014700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-04-02</span> <span class="t" onclick="H(this)">14:19:51</span>                 narkisr </span><span>Hi Clara team, is there an option to run a query that matches any fact? for example:

</span><pre>(defquery get-failures [] 
    (?f &lt;- [_ true]))</pre><span>
Assuming that the first value in the vector is not important we only care for the second true value</span></div><div id="t1585837251015500" t="2020-04-02 14:20:51 narkisr Or alternatively:

 (defquery get-failures [] 
    (?f &lt;- _ (= ?failure true)))"><a href="#t1585837251015500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-04-02</span> <span class="t" onclick="H(this)">14:20:51</span>                 narkisr </span><span>Or alternatively:

</span><pre>(defquery get-failures [] 
    (?f &lt;- _ (= ?failure true)))</pre></div><div id="t1585837334015900" t="2020-04-02 14:22:14 narkisr (looks like ancestors-fn might be useful in such a case?)"><a href="#t1585837334015900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-04-02</span> <span class="t" onclick="H(this)">14:22:14</span>                 narkisr </span><span>(looks like ancestors-fn might be useful in such a case?)</span></div><div id="t1585837569017500" t="2020-04-02 14:26:09 ethanc A rule/query that has a fact type of Object would find all facts"><a href="#t1585837569017500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-04-02</span> <span class="t" onclick="H(this)">14:26:09</span>                  ethanc </span><span>A rule/query that has a fact type of Object would find all facts</span></div><div id="t1585838190019700" t="2020-04-02 14:36:30 narkisr In my case I&apos;m using a keyword as the fact type, if I understand this correctly (ancestors :foo) is nil so Object dosent capture this?"><a href="#t1585838190019700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-04-02</span> <span class="t" onclick="H(this)">14:36:30</span>                 narkisr </span><span>In my case I&apos;m using a keyword as the fact type, if I understand this correctly (ancestors :foo) is nil so Object dosent capture this?</span></div><div id="t1585838206020000" t="2020-04-02 14:36:46 narkisr (defquery get-failures [] 
    (?f &lt;- Object (= ?failure true)))"><a href="#t1585838206020000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-04-02</span> <span class="t" onclick="H(this)">14:36:46</span>                 narkisr </span><pre>(defquery get-failures [] 
    (?f &lt;- Object (= ?failure true)))</pre></div><div id="t1585838229020400" t="2020-04-02 14:37:09 narkisr Sounds like I need to use an actual clojure keys hierarchy?"><a href="#t1585838229020400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-04-02</span> <span class="t" onclick="H(this)">14:37:09</span>                 narkisr </span><span>Sounds like I need to use an actual clojure keys hierarchy?</span></div><div id="t1585838804022300" t="2020-04-02 14:46:44 ethanc ah when using a custom fact-type-fn i think the only reliable way to achieve this would be to also provide a matching custom ancestors-fn"><a href="#t1585838804022300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-04-02</span> <span class="t" onclick="H(this)">14:46:44</span>                  ethanc </span><span>ah when using a custom fact-type-fn i think the only reliable way to achieve this would be to also provide a matching custom ancestors-fn</span></div><div id="t1585838858022600" t="2020-04-02 14:47:38 narkisr Makes sense, ill continue to fiddle with it"><a href="#t1585838858022600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-04-02</span> <span class="t" onclick="H(this)">14:47:38</span>                 narkisr </span><span>Makes sense, ill continue to fiddle with it</span></div><div id="t1585838860022800" t="2020-04-02 14:47:40 narkisr Thanks"><a href="#t1585838860022800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-04-02</span> <span class="t" onclick="H(this)">14:47:40</span>                 narkisr </span><span>Thanks</span></div><div id="t1586043911028800" t="2020-04-04 23:45:11 rainbow_bamboo Hi :) I&apos;ve been working on a website to cite data about the pandemic,  http://coronavirus-charts.org  .

Underneath it uses clara rules to generate HTML charts... (A full writeup on the project  https://devpost.com/software/coronavirus-charts-org  and the source code  https://github.com/rainbow-bamboo/coronavirus-charts/  ) any help, advice or feedback is welcome :)"><a href="#t1586043911028800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-04-04</span> <span class="t" onclick="H(this)">23:45:11</span>          rainbow_bamboo </span><span>Hi :) I&apos;ve been working on a website to cite data about the pandemic, </span><a href="http://coronavirus-charts.org" target="_blank">http://coronavirus-charts.org</a><span> .

Underneath it uses clara rules to generate HTML charts... (A full writeup on the project </span><a href="https://devpost.com/software/coronavirus-charts-org" target="_blank">https://devpost.com/software/coronavirus-charts-org</a><span> and the source code </span><a href="https://github.com/rainbow-bamboo/coronavirus-charts/" target="_blank">https://github.com/rainbow-bamboo/coronavirus-charts/</a><span> ) any help, advice or feedback is welcome :)</span></div><div id="t1586126382030000" t="2020-04-05 22:39:42 mikerod @ada this looks interesting! Cool to see clara being used some underneath this. "><a href="#t1586126382030000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-04-05</span> <span class="t" onclick="H(this)">22:39:42</span>                 mikerod </span><span>@ada this looks interesting! Cool to see clara being used some underneath this. </span></div><div id="t1587051759034700" t="2020-04-16 15:42:39 narkisr Hi Clara team just wanted to share my use which is using Clara rules for provisioning  https://github.com/re-ops/re-core/blob/re-flow/src/re_flow/core.clj , the ability to combine different flows easily while getting the computation graph for free is amazing, trying to implement this with procedural if/else or state machines would have resulted with much less composeable and brittle code.

To be able to just query and see why a flow has failed is just the icing on the cake ;)

Thank you for the hard work!"><a href="#t1587051759034700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-04-16</span> <span class="t" onclick="H(this)">15:42:39</span>                 narkisr </span><span>Hi Clara team just wanted to share my use which is using Clara rules for provisioning </span><a href="https://github.com/re-ops/re-core/blob/re-flow/src/re_flow/core.clj" target="_blank">https://github.com/re-ops/re-core/blob/re-flow/src/re_flow/core.clj</a><span>, the ability to combine different flows easily while getting the computation graph for free is amazing, trying to implement this with procedural if/else or state machines would have resulted with much less composeable and brittle code.

To be able to just query and see why a flow has failed is just the icing on the cake ;)

Thank you for the hard work!</span></div><div id="t1587054243036000" t="2020-04-16 16:24:03 ethanc Thats pretty cool, its great to see people using clara in new inventive ways"><a href="#t1587054243036000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-04-16</span> <span class="t" onclick="H(this)">16:24:03</span>                  ethanc </span><span>Thats pretty cool, its great to see people using clara in new inventive ways</span></div><div id="t1587057304036300" t="2020-04-16 17:15:04 noprompt Workflows are where its at  🙂"><a href="#t1587057304036300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-04-16</span> <span class="t" onclick="H(this)">17:15:04</span>                noprompt </span><span>Workflows are where its at </span><b>🙂</b></div><div id="t1587057432037200" t="2020-04-16 17:17:12 noprompt Its awesome to hear/see this idea catching on."><a href="#t1587057432037200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-04-16</span> <span class="t" onclick="H(this)">17:17:12</span>                noprompt </span><span>Its awesome to hear/see this idea catching on.</span></div><div id="t1587060629037700" t="2020-04-16 18:10:29 mikerod @narkisr looks like an interesting use-case. Nice to see."><a href="#t1587060629037700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-04-16</span> <span class="t" onclick="H(this)">18:10:29</span>                 mikerod </span><span>@narkisr looks like an interesting use-case. Nice to see.</span></div><div id="t1588072442050900" t="2020-04-28 11:14:02 narkisr Hi Clara team this is a cross post from the #announcements channel (I hope its ok) just wanted to share my post on how I used Clara and why I think its cool for process automation  http://narkisr.com/posts/27-04-2020-clara-flow/ 

I hope to see more projects make use of this awesome project"><a href="#t1588072442050900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-04-28</span> <span class="t" onclick="H(this)">11:14:02</span>                 narkisr </span><span>Hi Clara team this is a cross post from the #announcements channel (I hope its ok) just wanted to share my post on how I used Clara and why I think its cool for process automation </span><a href="http://narkisr.com/posts/27-04-2020-clara-flow/" target="_blank">http://narkisr.com/posts/27-04-2020-clara-flow/</a><span>

I hope to see more projects make use of this awesome project</span></div><div id="t1588079250051500" t="2020-04-28 13:07:30 mikerod @narkisr this is cool to see. Thanks for writing the blog explaining and sharing. Exciting to see clara being useful here. "><a href="#t1588079250051500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-04-28</span> <span class="t" onclick="H(this)">13:07:30</span>                 mikerod </span><span>@narkisr this is cool to see. Thanks for writing the blog explaining and sharing. Exciting to see clara being useful here. </span></div><div id="t1588457497053500" t="2020-05-02 22:11:37 oskarkv I&apos;m new to Clara Rules. I have been trying to write a rule
for a board game, but I haven&apos;t been able to do it. The rule
in English is:

During a player&apos;s turn, at the stage of the turn called
:into-city, the player will move into the city if either
there are no other players in the city, or if there is just
one player in the city and the total number of players is
more than four.

I have these fact types:

 (defrecord Player [id name health score energy])
(defrecord Turn [id stage])
(defrecord InCity [id]) 
InCity just means that a player is in the city. Turn keeps
track of whose turn it is and at what stage the player is in
his turn. Player just represents a player.

I tried this:

 (cr/defrule into-city
  [?turn &lt;- Turn (= ?id id) (= :into-city stage)]
  [?players &lt;- (acc/count) :from [Player]]
  [?in-city &lt;- (acc/count) :from [InCity]]
  ;; (or (zero? ?in-city
  ;;            (and (= 1 ?in-city)
  ;;                 (&gt; ?players 4))))
  =&gt;
  (cr/retract! ?turn)
  (cr/insert! (-&gt;Turn ?id (next-stage :into-city)))
  (cr/insert! (-&gt;InCity ?id))) 
But of course that part of the condition with &quot;if either
there are no other players in the city, or if there is just
one player in the city and the total number of players is
more than 4&quot; is missing. I have commented out an expression
that I tried to put in there somehow. But I&apos;m not sure where
to put that. As far as I have seen, conditions apply to
individual facts, and I&apos;m not sure if I can put in another
condition line with just boolean logic. Can I?

Also, since, as you can see, I&apos;m retracting the Turn fact
that led to the new facts being inserted, because now the
stage of the turn is the next stage, and so the inserted
facts will be instantly retracted, right? So how should I
think about it? I&apos;m finding it harder than I anticipated to
write a program with rules."><a href="#t1588457497053500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-05-02</span> <span class="t" onclick="H(this)">22:11:37</span>                 oskarkv </span><span>I&apos;m new to Clara Rules. I have been trying to write a rule
for a board game, but I haven&apos;t been able to do it. The rule
in English is:

During a player&apos;s turn, at the stage of the turn called
:into-city, the player will move into the city if either
there are no other players in the city, or if there is just
one player in the city and the total number of players is
more than four.

I have these fact types:

</span><pre>(defrecord Player [id name health score energy])
(defrecord Turn [id stage])
(defrecord InCity [id])</pre><span>
InCity just means that a player is in the city. Turn keeps
track of whose turn it is and at what stage the player is in
his turn. Player just represents a player.

I tried this:

</span><pre>(cr/defrule into-city
  [?turn &lt;- Turn (= ?id id) (= :into-city stage)]
  [?players &lt;- (acc/count) :from [Player]]
  [?in-city &lt;- (acc/count) :from [InCity]]
  ;; (or (zero? ?in-city
  ;;            (and (= 1 ?in-city)
  ;;                 (&gt; ?players 4))))
  =&gt;
  (cr/retract! ?turn)
  (cr/insert! (-&gt;Turn ?id (next-stage :into-city)))
  (cr/insert! (-&gt;InCity ?id)))</pre><span>
But of course that part of the condition with &quot;if either
there are no other players in the city, or if there is just
one player in the city and the total number of players is
more than 4&quot; is missing. I have commented out an expression
that I tried to put in there somehow. But I&apos;m not sure where
to put that. As far as I have seen, conditions apply to
individual facts, and I&apos;m not sure if I can put in another
condition line with just boolean logic. Can I?

Also, since, as you can see, I&apos;m retracting the Turn fact
that led to the new facts being inserted, because now the
stage of the turn is the next stage, and so the inserted
facts will be instantly retracted, right? So how should I
think about it? I&apos;m finding it harder than I anticipated to
write a program with rules.</span></div><div id="t1588526338059000" t="2020-05-03 17:18:58 ethanc To:
&gt; As far as I have seen, conditions apply to
&gt; individual facts, and I&apos;m not sure if I can put in another
&gt; condition line with just boolean logic. Can I?
yes, clara represents this as an underlying join of the two facts. You could also do this in a &quot;test&quot; condition:
 http://www.clara-rules.org/docs/expressions/ 

For:
&gt; Also, since, as you can see, I&apos;m retracting the Turn fact
&gt; that led to the new facts being inserted, because now the
&gt; stage of the turn is the next stage, and so the inserted
&gt; facts will be instantly retracted, right? So how should I
&gt; think about it?
As you alluded to, truth maintenance( http://www.clara-rules.org/docs/truthmaint/ ) would kick in when retracting the fact, meaning that this rule would likely cause a loop to occur. I&apos;ve never really thought about modeling game state management in clara, but i would wonder if the retract is necessary."><a href="#t1588526338059000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-05-03</span> <span class="t" onclick="H(this)">17:18:58</span>                  ethanc </span><span>To:
&gt; As far as I have seen, conditions apply to
&gt; individual facts, and I&apos;m not sure if I can put in another
&gt; condition line with just boolean logic. Can I?
yes, clara represents this as an underlying join of the two facts. You could also do this in a &quot;test&quot; condition:
</span><a href="http://www.clara-rules.org/docs/expressions/" target="_blank">http://www.clara-rules.org/docs/expressions/</a><span>

For:
&gt; Also, since, as you can see, I&apos;m retracting the Turn fact
&gt; that led to the new facts being inserted, because now the
&gt; stage of the turn is the next stage, and so the inserted
&gt; facts will be instantly retracted, right? So how should I
&gt; think about it?
As you alluded to, truth maintenance(</span><a href="http://www.clara-rules.org/docs/truthmaint/" target="_blank">http://www.clara-rules.org/docs/truthmaint/</a><span>) would kick in when retracting the fact, meaning that this rule would likely cause a loop to occur. I&apos;ve never really thought about modeling game state management in clara, but i would wonder if the retract is necessary.</span></div><div id="t1588535784059900" t="2020-05-03 19:56:24 oskarkv I discovered that there is  insert-unconditional  too, maybe I can use that"><a href="#t1588535784059900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-05-03</span> <span class="t" onclick="H(this)">19:56:24</span>                 oskarkv </span><span>I discovered that there is </span><code>insert-unconditional</code><span> too, maybe I can use that</span></div><div id="t1588535785060100" t="2020-05-03 19:56:25 oskarkv Thanks"><a href="#t1588535785060100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-05-03</span> <span class="t" onclick="H(this)">19:56:25</span>                 oskarkv </span><span>Thanks</span></div><div id="t1588555077060400" t="2020-05-04 01:17:57 mikerod @oskarkv maybe related  http://www.metasimple.org/2017/12/23/clara-updating-facts.html"><a href="#t1588555077060400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-05-04</span> <span class="t" onclick="H(this)">01:17:57</span>                 mikerod </span><span>@oskarkv maybe related </span><a href="http://www.metasimple.org/2017/12/23/clara-updating-facts.html" target="_blank">http://www.metasimple.org/2017/12/23/clara-updating-facts.html</a></div><div id="t1588869538060800" t="2020-05-07 16:38:58 oskarkv Thanks!"><a href="#t1588869538060800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-05-07</span> <span class="t" onclick="H(this)">16:38:58</span>                 oskarkv </span><span>Thanks!</span></div><div id="t1588869986064100" t="2020-05-07 16:46:26 oskarkv (cr/defquery my-query
  [:?x :?y]
  [?p &lt;- (acc/all) :from [Player]])

(defn oktest []
  (-&gt; (cr/mk-session)
    (cr/insert (-&gt;Player 0 0 0))
    (cr/insert (-&gt;Player 1 2 3))
    cr/fire-rules
    (cr/query my-query :?x 0 :?y 0))) 
This does not produce any results. But if I use  ?x  and  ?y  in the query, e.g.  (= ?x x)  and same for y then it does produce results. This is kind of surprising since in normal functions one doesn&apos;t have to use the args. Is there any particular reason for this? Same if I remove the arguments  :?x  and  :?y  from the query but keep them in the call to  cr/query , then the query doesn&apos;t produce any results. Also a bit confusing."><a href="#t1588869986064100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-05-07</span> <span class="t" onclick="H(this)">16:46:26</span>                 oskarkv </span><pre>(cr/defquery my-query
  [:?x :?y]
  [?p &lt;- (acc/all) :from [Player]])

(defn oktest []
  (-&gt; (cr/mk-session)
    (cr/insert (-&gt;Player 0 0 0))
    (cr/insert (-&gt;Player 1 2 3))
    cr/fire-rules
    (cr/query my-query :?x 0 :?y 0)))</pre><span>
This does not produce any results. But if I use </span><code>?x</code><span> and </span><code>?y</code><span> in the query, e.g. </span><code>(= ?x x)</code><span> and same for y then it does produce results. This is kind of surprising since in normal functions one doesn&apos;t have to use the args. Is there any particular reason for this? Same if I remove the arguments </span><code>:?x</code><span> and </span><code>:?y</code><span> from the query but keep them in the call to </span><code>cr/query</code><span>, then the query doesn&apos;t produce any results. Also a bit confusing.</span></div><div id="t1588870623064700" t="2020-05-07 16:57:03 oskarkv And apparently this doesn&apos;t work. I&apos;m confused about queries.
 (cr/defquery my-query
  [:?x :?y]
  [?p &lt;- (acc/all) :from [Player (&gt; x ?x) (&gt; y ?y)]])

(defn oktest []
  (-&gt; (cr/mk-session)
    (cr/insert (-&gt;Player 1 1 1))
    (cr/insert (-&gt;Player 2 2 2))
    cr/fire-rules
    (cr/query my-query :?x 0 :?y 0)))"><a href="#t1588870623064700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-05-07</span> <span class="t" onclick="H(this)">16:57:03</span>                 oskarkv </span><span>And apparently this doesn&apos;t work. I&apos;m confused about queries.
</span><pre>(cr/defquery my-query
  [:?x :?y]
  [?p &lt;- (acc/all) :from [Player (&gt; x ?x) (&gt; y ?y)]])

(defn oktest []
  (-&gt; (cr/mk-session)
    (cr/insert (-&gt;Player 1 1 1))
    (cr/insert (-&gt;Player 2 2 2))
    cr/fire-rules
    (cr/query my-query :?x 0 :?y 0)))</pre></div><div id="t1588870791065500" t="2020-05-07 16:59:51 oskarkv What can and should the arguments be used for? Only for testing equality? I don&apos;t get it."><a href="#t1588870791065500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-05-07</span> <span class="t" onclick="H(this)">16:59:51</span>                 oskarkv </span><span>What can and should the arguments be used for? Only for testing equality? I don&apos;t get it.</span></div><div id="t1588871750065900" t="2020-05-07 17:15:50 mikerod @oskarkv perhaps try it all again with  (cr/mk-session :cache false)  just to make sure"><a href="#t1588871750065900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-05-07</span> <span class="t" onclick="H(this)">17:15:50</span>                 mikerod </span><span>@oskarkv perhaps try it all again with </span><code>(cr/mk-session :cache false)</code><span> just to make sure</span></div><div id="t1588871777066500" t="2020-05-07 17:16:17 mikerod It sounds like you are describing 3 variations you have tested"><a href="#t1588871777066500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-05-07</span> <span class="t" onclick="H(this)">17:16:17</span>                 mikerod </span><span>It sounds like you are describing 3 variations you have tested</span></div><div id="t1588871834066700" t="2020-05-07 17:17:14 mikerod &gt; What can and should the arguments be used for? Only for testing equality? I don’t get it.
this should not be the case"><a href="#t1588871834066700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-05-07</span> <span class="t" onclick="H(this)">17:17:14</span>                 mikerod </span><span>&gt; What can and should the arguments be used for? Only for testing equality? I don’t get it.
this should not be the case</span></div><div id="t1588872194067000" t="2020-05-07 17:23:14 oskarkv In the last case I get this error  http://dpaste.com/1QSB24C"><a href="#t1588872194067000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-05-07</span> <span class="t" onclick="H(this)">17:23:14</span>                 oskarkv </span><span>In the last case I get this error </span><a href="http://dpaste.com/1QSB24C" target="_blank">http://dpaste.com/1QSB24C</a></div><div id="t1588872276067500" t="2020-05-07 17:24:36 oskarkv That&apos;s the one with  (&gt; x ?x)  as constraints"><a href="#t1588872276067500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-05-07</span> <span class="t" onclick="H(this)">17:24:36</span>                 oskarkv </span><span>That&apos;s the one with </span><code>(&gt; x ?x)</code><span> as constraints</span></div><div id="t1588872434068100" t="2020-05-07 17:27:14 oskarkv I restarted Clojure and added  :cache false  but nothing was different"><a href="#t1588872434068100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-05-07</span> <span class="t" onclick="H(this)">17:27:14</span>                 oskarkv </span><span>I restarted Clojure and added </span><code>:cache false</code><span> but nothing was different</span></div><div id="t1588872687071100" t="2020-05-07 17:31:27 oskarkv So with  (= x ?x)  I get results if I pass in the correct arguments. With  (&gt; x ?x)  I get an error. Not using  ?x  at all in the query body produce no results although I think it should. Having an empty args vector in the query but passing args in when calling produce no results either. And finally using no args in the query or when calling I get results again. I am very confused."><a href="#t1588872687071100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-05-07</span> <span class="t" onclick="H(this)">17:31:27</span>                 oskarkv </span><span>So with </span><code>(= x ?x)</code><span> I get results if I pass in the correct arguments. With </span><code>(&gt; x ?x)</code><span> I get an error. Not using </span><code>?x</code><span> at all in the query body produce no results although I think it should. Having an empty args vector in the query but passing args in when calling produce no results either. And finally using no args in the query or when calling I get results again. I am very confused.</span></div><div id="t1588873974071300" t="2020-05-07 17:52:54 oskarkv clarax.queriestest&gt; (q1test)
with (= ?x x)
({:?x 1, :?y 1, :?p [{:x 1, :y 1, :z 1}]})
clarax.queriestest&gt; (q2test)
with no ?x or ?y in body
()
clarax.queriestest&gt; (q3test)
with no argsvector
()
clarax.queriestest&gt; (q4test)
argsvector but no args passed in
({:?p [{:x 1, :y 1, :z 1} {:x 2, :y 2, :z 2}]})
clarax.queriestest&gt; (q5test)
no args whatsoever
({:?p [{:x 1, :y 1, :z 1} {:x 2, :y 2, :z 2}]})
clarax.queriestest&gt; (q6test)
with (&gt; x ?x)
Execution error (ExceptionInfo) at clara.rules.compiler/eval18474$sort-conditions$fn (compiler.clj:847). 
I used this source  https://gist.github.com/oskarkv/74cf41ab8937326beabc695711c19618 

I&apos;m using Clara 0.20.0

I would have expected at least q2 with no args in the body to return something, and also the last one with  (&gt; x ?x)  to work."><a href="#t1588873974071300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-05-07</span> <span class="t" onclick="H(this)">17:52:54</span>                 oskarkv </span><pre>clarax.queriestest&gt; (q1test)
with (= ?x x)
({:?x 1, :?y 1, :?p [{:x 1, :y 1, :z 1}]})
clarax.queriestest&gt; (q2test)
with no ?x or ?y in body
()
clarax.queriestest&gt; (q3test)
with no argsvector
()
clarax.queriestest&gt; (q4test)
argsvector but no args passed in
({:?p [{:x 1, :y 1, :z 1} {:x 2, :y 2, :z 2}]})
clarax.queriestest&gt; (q5test)
no args whatsoever
({:?p [{:x 1, :y 1, :z 1} {:x 2, :y 2, :z 2}]})
clarax.queriestest&gt; (q6test)
with (&gt; x ?x)
Execution error (ExceptionInfo) at clara.rules.compiler/eval18474$sort-conditions$fn (compiler.clj:847).</pre><span>
I used this source </span><a href="https://gist.github.com/oskarkv/74cf41ab8937326beabc695711c19618" target="_blank">https://gist.github.com/oskarkv/74cf41ab8937326beabc695711c19618</a><span>

I&apos;m using Clara 0.20.0

I would have expected at least q2 with no args in the body to return something, and also the last one with </span><code>(&gt; x ?x)</code><span> to work.</span></div><div id="t1588881239074300" t="2020-05-07 19:53:59 ethanc @oskarkv
I will take a look at this in a bit. My gut reaction as to why this isn’t acting as expected is due to the implementation of how queries are executed directly on clara’s internal memory."><a href="#t1588881239074300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-05-07</span> <span class="t" onclick="H(this)">19:53:59</span>                  ethanc </span><span>@oskarkv
I will take a look at this in a bit. My gut reaction as to why this isn’t acting as expected is due to the implementation of how queries are executed directly on clara’s internal memory.</span></div><div id="t1588889087074700" t="2020-05-07 22:04:47 mikerod It’d be interesting if it’s not working for non =. "><a href="#t1588889087074700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-05-07</span> <span class="t" onclick="H(this)">22:04:47</span>                 mikerod </span><span>It’d be interesting if it’s not working for non =. </span></div><div id="t1588889102075000" t="2020-05-07 22:05:02 mikerod Perhaps that was its original intent though "><a href="#t1588889102075000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-05-07</span> <span class="t" onclick="H(this)">22:05:02</span>                 mikerod </span><span>Perhaps that was its original intent though </span></div><div id="t1588891426077400" t="2020-05-07 22:43:46 ethanc I was under the assumption that queries never support heavier logic than equality, as its the job of the rules to do more complex filtering and joining logic…
Might be a poor assumption on my part but it sure seems like bound variables are the contract"><a href="#t1588891426077400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-05-07</span> <span class="t" onclick="H(this)">22:43:46</span>                  ethanc </span><span>I was under the assumption that queries never support heavier logic than equality, as its the job of the rules to do more complex filtering and joining logic…
Might be a poor assumption on my part but it sure seems like bound variables are the contract</span></div><div id="t1588891450077800" t="2020-05-07 22:44:10 ethanc at least in its current implementation"><a href="#t1588891450077800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-05-07</span> <span class="t" onclick="H(this)">22:44:10</span>                  ethanc </span><span>at least in its current implementation</span></div><div id="t1588897035081500" t="2020-05-08 00:17:15 mikerod That’s probably accurate "><a href="#t1588897035081500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-05-08</span> <span class="t" onclick="H(this)">00:17:15</span>                 mikerod </span><span>That’s probably accurate </span></div><div id="t1588897447084400" t="2020-05-08 00:24:07 ethanc Ok looking at this,
I would say that clara.rules/query( https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/rules.cljc#L47-L57 ) could use a bit of validation on the args.
As the user provides both the query and key/values to query already it should be pretty straight forward to determine if the map of arguments match that of the params on the query itself.

similar to how we validate that the query is in rulebase today:
 https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/rules/engine.cljc#L1976 

a disjunction between the keys of the params provided and params on the node itself( https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/rules/engine.cljc#L432 )
in the event that the user provided more/less the query behaves quite differently as demonstrated in the examples provided.

This simply comes down to the implementation of query itself:
 https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/rules/engine.cljc#L1978"><a href="#t1588897447084400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-05-08</span> <span class="t" onclick="H(this)">00:24:07</span>                  ethanc </span><span>Ok looking at this,
I would say that clara.rules/query(</span><a href="https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/rules.cljc#L47-L57" target="_blank">https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/rules.cljc#L47-L57</a><span>) could use a bit of validation on the args.
As the user provides both the query and key/values to query already it should be pretty straight forward to determine if the map of arguments match that of the params on the query itself.

similar to how we validate that the query is in rulebase today:
</span><a href="https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/rules/engine.cljc#L1976" target="_blank">https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/rules/engine.cljc#L1976</a><span>

a disjunction between the keys of the params provided and params on the node itself(</span><a href="https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/rules/engine.cljc#L432" target="_blank">https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/rules/engine.cljc#L432</a><span>)
in the event that the user provided more/less the query behaves quite differently as demonstrated in the examples provided.

This simply comes down to the implementation of query itself:
</span><a href="https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/rules/engine.cljc#L1978" target="_blank">https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/rules/engine.cljc#L1978</a></div><div id="t1588897526084900" t="2020-05-08 00:25:26 ethanc as it uses bindings to retrieve the tokens from memory"><a href="#t1588897526084900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-05-08</span> <span class="t" onclick="H(this)">00:25:26</span>                  ethanc </span><span>as it uses bindings to retrieve the tokens from memory</span></div><div id="t1588897583086000" t="2020-05-08 00:26:23 ethanc so the assumption i mentioned above is technically true, and has to be true as it would be inforced by the behavior of the memory"><a href="#t1588897583086000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-05-08</span> <span class="t" onclick="H(this)">00:26:23</span>                  ethanc </span><span>so the assumption i mentioned above is technically true, and has to be true as it would be inforced by the behavior of the memory</span></div><div id="t1588953032087900" t="2020-05-08 15:50:32 ethanc I have logged:
 https://github.com/cerner/clara-rules/issues/454 
for the conversation above.

Please feel free to add Comments/Concerns, it seems pretty straight forward and if i get time this weekend i might knock it out"><a href="#t1588953032087900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-05-08</span> <span class="t" onclick="H(this)">15:50:32</span>                  ethanc </span><span>I have logged:
</span><a href="https://github.com/cerner/clara-rules/issues/454" target="_blank">https://github.com/cerner/clara-rules/issues/454</a><span>
for the conversation above.

Please feel free to add Comments/Concerns, it seems pretty straight forward and if i get time this weekend i might knock it out</span></div><div id="t1588957782089000" t="2020-05-08 17:09:42 oskarkv I&apos;m not completely sure I understand everything you said. Can I only use  =  in query constraints?"><a href="#t1588957782089000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-05-08</span> <span class="t" onclick="H(this)">17:09:42</span>                 oskarkv </span><span>I&apos;m not completely sure I understand everything you said. Can I only use </span><code>=</code><span> in query constraints?</span></div><div id="t1588966628089200" t="2020-05-08 19:37:08 ethanc yes"><a href="#t1588966628089200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-05-08</span> <span class="t" onclick="H(this)">19:37:08</span>                  ethanc </span><span>yes</span></div><div id="t1588966953094000" t="2020-05-08 19:42:33 ethanc in the context of the query
 (= ?x x) 
is defining a binding of  :?x , when querying the memory of a session the bindings of the query denoted by the query parameters are used.

meaning a defquery like:
 (defquery some-query
  [:?x]
  [?a &lt;- SomeFact (= ?x x) (= ?y y)]) 
would use:
 {:?x &lt;val&gt;} 
to retrieve the values of the query from the session."><a href="#t1588966953094000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-05-08</span> <span class="t" onclick="H(this)">19:42:33</span>                  ethanc </span><span>in the context of the query
</span><pre>(= ?x x)</pre><span>
is defining a binding of </span><code>:?x</code><span>, when querying the memory of a session the bindings of the query denoted by the query parameters are used.

meaning a defquery like:
</span><pre>(defquery some-query
  [:?x]
  [?a &lt;- SomeFact (= ?x x) (= ?y y)])</pre><span>
would use:
</span><pre>{:?x &lt;val&gt;}</pre><span>
to retrieve the values of the query from the session.</span></div><div id="t1588967037095200" t="2020-05-08 19:43:57 ethanc where value is provided from the clara.rule/query function like:
 (r/query session some-query :?x 42)"><a href="#t1588967037095200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-05-08</span> <span class="t" onclick="H(this)">19:43:57</span>                  ethanc </span><span>where value is provided from the clara.rule/query function like:
</span><pre>(r/query session some-query :?x 42)</pre></div><div id="t1588967310097900" t="2020-05-08 19:48:30 ethanc however today clara allows arbitrary values to be provided to the query, like:
 (r/query session some-query :?x 42 :?v 1 :?w 2) 
this causes the retrieval from memory to miss tokens as it simply assumes that all values passed are valid bindings."><a href="#t1588967310097900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-05-08</span> <span class="t" onclick="H(this)">19:48:30</span>                  ethanc </span><span>however today clara allows arbitrary values to be provided to the query, like:
</span><pre>(r/query session some-query :?x 42 :?v 1 :?w 2)</pre><span>
this causes the retrieval from memory to miss tokens as it simply assumes that all values passed are valid bindings.</span></div><div id="t1589367016098400" t="2020-05-13 10:50:16 oskarkv When using  :exists , adding a binding variable changes the behaviour of the rule, making it trigger more times. For example (only difference being  ?i &lt;-  in  more ):
 (cr/defrule more
  [?p &lt;- Player (= id ?id)]
  [:exists [?i &lt;- Item (= id ?id)]]
  =&gt;
  (println &quot;more&quot; ?p))

(cr/defrule less
  [?p &lt;- Player (= id ?id)]
  [:exists [Item (= id ?id)]]
  =&gt;
  (println &quot;less&quot; ?p)) 
prints:
 more #claraz.rules.Player{:id 2, :y 2}
more #claraz.rules.Player{:id 1, :y 1}
more #claraz.rules.Player{:id 2, :y 2}
more #claraz.rules.Player{:id 1, :y 1}
more #claraz.rules.Player{:id 1, :y 1}
less #claraz.rules.Player{:id 2, :y 2}
less #claraz.rules.Player{:id 1, :y 1} 
I find that a bit unintuitive. Is it supposed to be this way?"><a href="#t1589367016098400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-05-13</span> <span class="t" onclick="H(this)">10:50:16</span>                 oskarkv </span><span>When using </span><code>:exists</code><span>, adding a binding variable changes the behaviour of the rule, making it trigger more times. For example (only difference being </span><code>?i &lt;-</code><span> in </span><code>more</code><span>):
</span><pre>(cr/defrule more
  [?p &lt;- Player (= id ?id)]
  [:exists [?i &lt;- Item (= id ?id)]]
  =&gt;
  (println &quot;more&quot; ?p))

(cr/defrule less
  [?p &lt;- Player (= id ?id)]
  [:exists [Item (= id ?id)]]
  =&gt;
  (println &quot;less&quot; ?p))</pre><span>
prints:
</span><pre>more #claraz.rules.Player{:id 2, :y 2}
more #claraz.rules.Player{:id 1, :y 1}
more #claraz.rules.Player{:id 2, :y 2}
more #claraz.rules.Player{:id 1, :y 1}
more #claraz.rules.Player{:id 1, :y 1}
less #claraz.rules.Player{:id 2, :y 2}
less #claraz.rules.Player{:id 1, :y 1}</pre><span>
I find that a bit unintuitive. Is it supposed to be this way?</span></div><div id="t1589375946098900" t="2020-05-13 13:19:06 mikerod @oskarkv I think it’s invalid to do a “fact binding” on an  :exists"><a href="#t1589375946098900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-05-13</span> <span class="t" onclick="H(this)">13:19:06</span>                 mikerod </span><span>@oskarkv I think it’s invalid to do a “fact binding” on an </span><code>:exists</code></div><div id="t1589375956099200" t="2020-05-13 13:19:16 mikerod Now that I see that syntax, makes me wonder why it works"><a href="#t1589375956099200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-05-13</span> <span class="t" onclick="H(this)">13:19:16</span>                 mikerod </span><span>Now that I see that syntax, makes me wonder why it works</span></div><div id="t1589376300099500" t="2020-05-13 13:25:00 mikerod So basically, I think  more  is invalid - but I guess it isn’t being checked well"><a href="#t1589376300099500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-05-13</span> <span class="t" onclick="H(this)">13:25:00</span>                 mikerod </span><span>So basically, I think </span><code>more</code><span> is invalid - but I guess it isn’t being checked well</span></div><div id="t1589376315099900" t="2020-05-13 13:25:15 mikerod I don’t understand how it could have any semantically meaningful compilation result"><a href="#t1589376315099900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-05-13</span> <span class="t" onclick="H(this)">13:25:15</span>                 mikerod </span><span>I don’t understand how it could have any semantically meaningful compilation result</span></div><div id="t1589376327100200" t="2020-05-13 13:25:27 mikerod :exists  in general does not allow you to access the fact that “exists”"><a href="#t1589376327100200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-05-13</span> <span class="t" onclick="H(this)">13:25:27</span>                 mikerod </span><code>:exists</code><span> in general does not allow you to access the fact that “exists”</span></div><div id="t1589376341100600" t="2020-05-13 13:25:41 mikerod because it isn’t meaningful directly - there could be more than one"><a href="#t1589376341100600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-05-13</span> <span class="t" onclick="H(this)">13:25:41</span>                 mikerod </span><span>because it isn’t meaningful directly - there could be more than one</span></div><div id="t1589376369101200" t="2020-05-13 13:26:09 mikerod if you need to have an actual fact - and I suppose any fact will do for you - you should use an accumulator"><a href="#t1589376369101200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-05-13</span> <span class="t" onclick="H(this)">13:26:09</span>                 mikerod </span><span>if you need to have an actual fact - and I suppose any fact will do for you - you should use an accumulator</span></div><div id="t1589376428102300" t="2020-05-13 13:27:08 mikerod [?items &lt;- (acc/all) :from [Item ...]]
=&gt;
;; choose one here
... (first ?items) ..."><a href="#t1589376428102300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-05-13</span> <span class="t" onclick="H(this)">13:27:08</span>                 mikerod </span><pre>[?items &lt;- (acc/all) :from [Item ...]]
=&gt;
;; choose one here
... (first ?items) ...</pre></div><div id="t1589376507103000" t="2020-05-13 13:28:27 mikerod In your case, you may be thinking that in your domain there is exactly 1 match or no matches. However, the rules do not know this"><a href="#t1589376507103000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-05-13</span> <span class="t" onclick="H(this)">13:28:27</span>                 mikerod </span><span>In your case, you may be thinking that in your domain there is exactly 1 match or no matches. However, the rules do not know this</span></div><div id="t1589376546103600" t="2020-05-13 13:29:06 mikerod I do find the situation where the syntax is allowing this fact binding to be put inside the  :exists  condition to be something to be addressed though"><a href="#t1589376546103600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-05-13</span> <span class="t" onclick="H(this)">13:29:06</span>                 mikerod </span><span>I do find the situation where the syntax is allowing this fact binding to be put inside the </span><code>:exists</code><span> condition to be something to be addressed though</span></div><div id="t1590858996107600" t="2020-05-30 17:16:36 narkisr Hi Clara team, iv been trying to use Clara rules within a graalvm native image and iv managed to compile it however its failing during runtime on the use of eval, is there an option iv missed to not use eval? (compile the rules ahead of time)

 https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/rules/compiler.clj#L223 

 [{:type clojure.lang.ExceptionInfo
   :message Failed compiling alpha node
{:expr (clojure.core/fn [?__fact__ ?__env__] (clojure.core/let [{:keys [?wildcard]} ?__fact__ ?__bindings__ (clojure.core/atom {:?e ?__fact__})] (clojure.core/let [?wildcard true] (clojure.core/swap! ?__bindings__ clojure.core/assoc :?wildcard ?wildcard) (clojure.core/deref ?__bindings__)))), :condition {:type :grant.rules/user-spec, :constraints [(= ?wildcard true)], :args [{:keys [?wildcard]}], :fact-binding :?e}, :env nil}

   :data {:expr (clojure.core/fn [?__fact__ ?__env__] (clojure.core/let [{:keys [?wildcard]} ?__fact__ ?__bindings__ (clojure.core/atom {:?e ?__fact__})] (clojure.core/let [?wildcard true] (clojure.core/swap! ?__bindings__ clojure.core/assoc :?wildcard ?wildcard) (clojure.core/deref ?__bindings__)))), :condition {:type :grant.rules/user-spec, :constraints [(= ?wildcard true)], :args [{:keys [?wildcard]}], :fact-binding :?e}, :env nil}
   :at [clara.rules.compiler$try_eval invokeStatic compiler.clj 238]}
  {:type clojure.lang.Compiler$CompilerException
   :message Syntax error compiling at (grant/rules.clj:15:0).
   :data {:clojure.error/phase :compile-syntax-check, :clojure.error/line 15, :clojure.error/column 0, :clojure.error/source grant/rules.clj}
   :at [clojure.lang.Compiler analyzeSeq Compiler.java 7115]}
  {:type java.lang.ClassNotFoundException
   :message clojure.lang.PersistentHashMap
   :at [com.oracle.svm.core.hub.ClassForNameSupport forName ClassForNameSupport.java 60]}]
 :trace
 [[com.oracle.svm.core.hub.ClassForNameSupport forName ClassForNameSupport.java 60]
  [java.lang.Class forName DynamicHub.java 1207]
  [clojure.lang.RT classForName RT.java 2211]
  [clojure.lang.RT classForNameNonLoading RT.java 2224]
  [clojure.lang.Compiler$HostExpr maybeClass Compiler.java 1041]
  [clojure.lang.Compiler macroexpand1 Compiler.java 7045]
  [clojure.lang.Compiler analyzeSeq Compiler.java 7093] 
"><a href="#t1590858996107600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-05-30</span> <span class="t" onclick="H(this)">17:16:36</span>                 narkisr </span><span>Hi Clara team, iv been trying to use Clara rules within a graalvm native image and iv managed to compile it however its failing during runtime on the use of eval, is there an option iv missed to not use eval? (compile the rules ahead of time)

</span><a href="https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/rules/compiler.clj#L223" target="_blank">https://github.com/cerner/clara-rules/blob/master/src/main/clojure/clara/rules/compiler.clj#L223</a><span>

</span><pre>[{:type clojure.lang.ExceptionInfo
   :message Failed compiling alpha node
{:expr (clojure.core/fn [?__fact__ ?__env__] (clojure.core/let [{:keys [?wildcard]} ?__fact__ ?__bindings__ (clojure.core/atom {:?e ?__fact__})] (clojure.core/let [?wildcard true] (clojure.core/swap! ?__bindings__ clojure.core/assoc :?wildcard ?wildcard) (clojure.core/deref ?__bindings__)))), :condition {:type :grant.rules/user-spec, :constraints [(= ?wildcard true)], :args [{:keys [?wildcard]}], :fact-binding :?e}, :env nil}

   :data {:expr (clojure.core/fn [?__fact__ ?__env__] (clojure.core/let [{:keys [?wildcard]} ?__fact__ ?__bindings__ (clojure.core/atom {:?e ?__fact__})] (clojure.core/let [?wildcard true] (clojure.core/swap! ?__bindings__ clojure.core/assoc :?wildcard ?wildcard) (clojure.core/deref ?__bindings__)))), :condition {:type :grant.rules/user-spec, :constraints [(= ?wildcard true)], :args [{:keys [?wildcard]}], :fact-binding :?e}, :env nil}
   :at [clara.rules.compiler$try_eval invokeStatic compiler.clj 238]}
  {:type clojure.lang.Compiler$CompilerException
   :message Syntax error compiling at (grant/rules.clj:15:0).
   :data {:clojure.error/phase :compile-syntax-check, :clojure.error/line 15, :clojure.error/column 0, :clojure.error/source grant/rules.clj}
   :at [clojure.lang.Compiler analyzeSeq Compiler.java 7115]}
  {:type java.lang.ClassNotFoundException
   :message clojure.lang.PersistentHashMap
   :at [com.oracle.svm.core.hub.ClassForNameSupport forName ClassForNameSupport.java 60]}]
 :trace
 [[com.oracle.svm.core.hub.ClassForNameSupport forName ClassForNameSupport.java 60]
  [java.lang.Class forName DynamicHub.java 1207]
  [clojure.lang.RT classForName RT.java 2211]
  [clojure.lang.RT classForNameNonLoading RT.java 2224]
  [clojure.lang.Compiler$HostExpr maybeClass Compiler.java 1041]
  [clojure.lang.Compiler macroexpand1 Compiler.java 7045]
  [clojure.lang.Compiler analyzeSeq Compiler.java 7093]</pre><span>
</span></div><div id="t1590861954113600" t="2020-05-30 18:05:54 ethanc @narkisr
Currently there is no such flag to disable eval, that mainly comes down to the fact that we have to evaluate user provided functions(RHS) and generated functions from the LHS of rules on the fly. Otherwise the forms produced by larger sessions would likely exceed some of the constraints of generated code sizes set by java.

I am curious as to the use-case, are you AOT compiling the sessions themselves or are you trying to generate the sessions during runtime?

I know @mikerod has been trying to untangle eval from rule compilation, but i believe that has been focused on Cljs as clara has been doing that wrong."><a href="#t1590861954113600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-05-30</span> <span class="t" onclick="H(this)">18:05:54</span>                  ethanc </span><span>@narkisr
Currently there is no such flag to disable eval, that mainly comes down to the fact that we have to evaluate user provided functions(RHS) and generated functions from the LHS of rules on the fly. Otherwise the forms produced by larger sessions would likely exceed some of the constraints of generated code sizes set by java.

I am curious as to the use-case, are you AOT compiling the sessions themselves or are you trying to generate the sessions during runtime?

I know @mikerod has been trying to untangle eval from rule compilation, but i believe that has been focused on Cljs as clara has been doing that wrong.</span></div><div id="t1590862505115400" t="2020-05-30 18:15:05 mikerod Cljs is closer to meeting that sort of requirement. The clj impl would not be easy to make happen. Unless it also went through a macro expansion type cljs like flow. Then again. I don’t even know exactly the constraints we’d have to use graal for this"><a href="#t1590862505115400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-05-30</span> <span class="t" onclick="H(this)">18:15:05</span>                 mikerod </span><span>Cljs is closer to meeting that sort of requirement. The clj impl would not be easy to make happen. Unless it also went through a macro expansion type cljs like flow. Then again. I don’t even know exactly the constraints we’d have to use graal for this</span></div><div id="t1590862555116700" t="2020-05-30 18:15:55 mikerod I’m guessing if macros could expand to code that avoided any eval and all fn instantiations were done via the compiler directly from the expanded code it’d work. Which is basically what cljs has to do"><a href="#t1590862555116700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-05-30</span> <span class="t" onclick="H(this)">18:15:55</span>                 mikerod </span><span>I’m guessing if macros could expand to code that avoided any eval and all fn instantiations were done via the compiler directly from the expanded code it’d work. Which is basically what cljs has to do</span></div><div id="t1590862575117200" t="2020-05-30 18:16:15 mikerod But only my current side branch of cljs at the moment. And it’s not functional yet. "><a href="#t1590862575117200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-05-30</span> <span class="t" onclick="H(this)">18:16:15</span>                 mikerod </span><span>But only my current side branch of cljs at the moment. And it’s not functional yet. </span></div><div id="t1590892658119100" t="2020-05-31 02:37:38 narkisr Graal&apos;s native-image doesn&apos;t support eval at the moment, I&apos;m not sure if there are any workarounds for this at the moment ill try to research that"><a href="#t1590892658119100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-05-31</span> <span class="t" onclick="H(this)">02:37:38</span>                 narkisr </span><span>Graal&apos;s native-image doesn&apos;t support eval at the moment, I&apos;m not sure if there are any workarounds for this at the moment ill try to research that</span></div><div id="t1590932916122600" t="2020-05-31 13:48:36 mikerod I wouldn’t expect it’d support eval since that’s just arbitrary bytecode being emitted at runtime. "><a href="#t1590932916122600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-05-31</span> <span class="t" onclick="H(this)">13:48:36</span>                 mikerod </span><span>I wouldn’t expect it’d support eval since that’s just arbitrary bytecode being emitted at runtime. </span></div><div id="t1591186562124300" t="2020-06-03 12:16:02 narkisr Yes I agree, still I think that having Clara in native image would have been really cool  🙂"><a href="#t1591186562124300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-06-03</span> <span class="t" onclick="H(this)">12:16:02</span>                 narkisr </span><span>Yes I agree, still I think that having Clara in native image would have been really cool </span><b>🙂</b></div><div id="t1591188179125500" t="2020-06-03 12:42:59 mikerod I agree but think cljs clara is most likely to come closer to supporting it than clj. At least as of now. I’m still working through issues there though.  :exploding_head:"><a href="#t1591188179125500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-06-03</span> <span class="t" onclick="H(this)">12:42:59</span>                 mikerod </span><span>I agree but think cljs clara is most likely to come closer to supporting it than clj. At least as of now. I’m still working through issues there though. </span><b>:exploding_head:</b></div><div id="t1591623202126600" t="2020-06-08 13:33:22 Pieter Slabbert Hi, We are are going to be using clara rules at work, the example at  http://www.clara-rules.org/docs/fact_type_fn_perf/  looks like it will be very useful for part of our system.

There are many facts that we will use records for, but there is one kind of fact in particular which we have many different instances of the same fact but each with a different status (there can be quite a few of these statuses)  Ideally we don&apos;t want to create a new type for each of these statuses. So I would like to be able to create a tuple as shown in the link, but I would also need to be able to write other conditions on it.  There is a hint of how to do it on the page right at the bottom, but I can&apos;t seem to figure it out.  Would anyone be able to provide a fleshed out example with extra conditions?"><a href="#t1591623202126600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-06-08</span> <span class="t" onclick="H(this)">13:33:22</span>         Pieter Slabbert </span><span>Hi, We are are going to be using clara rules at work, the example at </span><a href="http://www.clara-rules.org/docs/fact_type_fn_perf/" target="_blank">http://www.clara-rules.org/docs/fact_type_fn_perf/</a><span> looks like it will be very useful for part of our system.

There are many facts that we will use records for, but there is one kind of fact in particular which we have many different instances of the same fact but each with a different status (there can be quite a few of these statuses)  Ideally we don&apos;t want to create a new type for each of these statuses. So I would like to be able to create a tuple as shown in the link, but I would also need to be able to write other conditions on it.  There is a hint of how to do it on the page right at the bottom, but I can&apos;t seem to figure it out.  Would anyone be able to provide a fleshed out example with extra conditions?</span></div><div id="t1591625266129800" t="2020-06-08 14:07:46 Felix Holmgren Hi everyone!  👋    I just (finally) published a podcast interview I did with @ryanbrush two years ago, about Clara.
I would think most of it is still as relevant, but if Clara has changed in ways that make what&apos;s said in the interview misleading I&apos;d be happy to include pointers in the show notes. In any case, I would of course welcome any feedback/criticism from this community!
 https://thesearch.space/episodes/2-ryan-brush-on-retaking-rules-for-developers"><a href="#t1591625266129800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-06-08</span> <span class="t" onclick="H(this)">14:07:46</span>          Felix Holmgren </span><span>Hi everyone! </span><b>👋</b><span>   I just (finally) published a podcast interview I did with @ryanbrush two years ago, about Clara.
I would think most of it is still as relevant, but if Clara has changed in ways that make what&apos;s said in the interview misleading I&apos;d be happy to include pointers in the show notes. In any case, I would of course welcome any feedback/criticism from this community!
</span><a href="https://thesearch.space/episodes/2-ryan-brush-on-retaking-rules-for-developers" target="_blank">https://thesearch.space/episodes/2-ryan-brush-on-retaking-rules-for-developers</a></div><div id="t1591634816133800" t="2020-06-08 16:46:56 mikerod @blob626 you’ve seen this one too  http://www.clara-rules.org/docs/fact_type_customization/  ?"><a href="#t1591634816133800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-06-08</span> <span class="t" onclick="H(this)">16:46:56</span>                 mikerod </span><span>@blob626 you’ve seen this one too </span><a href="http://www.clara-rules.org/docs/fact_type_customization/" target="_blank">http://www.clara-rules.org/docs/fact_type_customization/</a><span> ?</span></div><div id="t1591634823134200" t="2020-06-08 16:47:03 mikerod the one you linked was more about performance than the feature use itself"><a href="#t1591634823134200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-06-08</span> <span class="t" onclick="H(this)">16:47:03</span>                 mikerod </span><span>the one you linked was more about performance than the feature use itself</span></div><div id="t1591640891135100" t="2020-06-08 18:28:11 ethanc @blob626,
If I remember correctly you should be able to apply constraints to a condition even when using a custom fact type. However, the syntactic sugar that clara provides for field accessors would no longer be available. Meaning that you would have to provide custom destructuring for the fact or have the constraints access the fact via  this  and drill in that way. For example:

 (ns test.rules
  (:require [clara.rules :as r]))


(defrecord SomeFact [id status another-identifier])

(defrecord IncompleteFact [id])

(r/defrule a-rule
  [[SomeFact &quot;id-1&quot;] [{:keys [another-identifier status]}]
    (= ?another-identifier another-identifier)
    (= status &quot;INCOMPLETE&quot;)]
  =&gt;
  (r/insert! (-&gt;IncompleteFact ?another-identifier)))

(r/defquery get-incomplete-facts
  []
  [?f &lt;- IncompleteFact])

(defn fact-type-fn
  [fact]
  (if (instance? SomeFact fact)
    [`SomeFact (:id fact)]
    (type fact))) 

(defn run-test
  []
  (-&gt; (r/mk-session [a-rule get-incomplete-facts]
                    :fact-type-fn fact-type-fn)
      (r/insert (-&gt;SomeFact &quot;id-1&quot; &quot;INCOMPLETE&quot; &quot;external-id&quot;))
      (r/fire-rules)
      (r/query get-incomplete-facts))) 
Specifically,
 [{:keys [another-identifier status]}] 
"><a href="#t1591640891135100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-06-08</span> <span class="t" onclick="H(this)">18:28:11</span>                  ethanc </span><span>@blob626,
If I remember correctly you should be able to apply constraints to a condition even when using a custom fact type. However, the syntactic sugar that clara provides for field accessors would no longer be available. Meaning that you would have to provide custom destructuring for the fact or have the constraints access the fact via </span><code>this</code><span> and drill in that way. For example:

</span><pre>(ns test.rules
  (:require [clara.rules :as r]))


(defrecord SomeFact [id status another-identifier])

(defrecord IncompleteFact [id])

(r/defrule a-rule
  [[SomeFact &quot;id-1&quot;] [{:keys [another-identifier status]}]
    (= ?another-identifier another-identifier)
    (= status &quot;INCOMPLETE&quot;)]
  =&gt;
  (r/insert! (-&gt;IncompleteFact ?another-identifier)))

(r/defquery get-incomplete-facts
  []
  [?f &lt;- IncompleteFact])

(defn fact-type-fn
  [fact]
  (if (instance? SomeFact fact)
    [`SomeFact (:id fact)]
    (type fact))) 

(defn run-test
  []
  (-&gt; (r/mk-session [a-rule get-incomplete-facts]
                    :fact-type-fn fact-type-fn)
      (r/insert (-&gt;SomeFact &quot;id-1&quot; &quot;INCOMPLETE&quot; &quot;external-id&quot;))
      (r/fire-rules)
      (r/query get-incomplete-facts)))</pre><span>
Specifically,
</span><pre>[{:keys [another-identifier status]}]</pre><span>
</span></div><div id="t1591646160136300" t="2020-06-08 19:56:00 apbleonard Clara Rules has a mention in Rich Hickey&apos;s HOPL IV &quot;A History of Clojure&quot; paper!  🙂   https://clojure.org/about/history"><a href="#t1591646160136300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-06-08</span> <span class="t" onclick="H(this)">19:56:00</span>              apbleonard </span><span>Clara Rules has a mention in Rich Hickey&apos;s HOPL IV &quot;A History of Clojure&quot; paper! </span><b>🙂</b><span> </span><a href="https://clojure.org/about/history" target="_blank">https://clojure.org/about/history</a></div><div id="t1591647715136500" t="2020-06-08 20:21:55 ethanc 😮"><a href="#t1591647715136500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-06-08</span> <span class="t" onclick="H(this)">20:21:55</span>                  ethanc </span><b>😮</b></div><div id="t1591655345137000" t="2020-06-08 22:29:05 mikerod thanks for making the example @ethanc"><a href="#t1591655345137000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-06-08</span> <span class="t" onclick="H(this)">22:29:05</span>                 mikerod </span><span>thanks for making the example @ethanc</span></div><div id="t1591655349137200" t="2020-06-08 22:29:09 mikerod perhaps our docs are too weak on this"><a href="#t1591655349137200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-06-08</span> <span class="t" onclick="H(this)">22:29:09</span>                 mikerod </span><span>perhaps our docs are too weak on this</span></div><div id="t1591655355137400" t="2020-06-08 22:29:15 mikerod I need to re-read through"><a href="#t1591655355137400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-06-08</span> <span class="t" onclick="H(this)">22:29:15</span>                 mikerod </span><span>I need to re-read through</span></div><div id="t1591655376137900" t="2020-06-08 22:29:36 mikerod and clara is in the history paper? wow, I’ve been meaning to read it. Clara’s officially famous  😜 \"><a href="#t1591655376137900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-06-08</span> <span class="t" onclick="H(this)">22:29:36</span>                 mikerod </span><span>and clara is in the history paper? wow, I’ve been meaning to read it. Clara’s officially famous </span><b>😜</b><span>\</span></div><div id="t1591686227140000" t="2020-06-09 07:03:47 Pieter Slabbert @mikerod I saw that link but I couldn&apos;t quite see how to make it work for what I needed. (probably just me missing something)

@ethanc Thanks, that was exactly what I needed"><a href="#t1591686227140000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-06-09</span> <span class="t" onclick="H(this)">07:03:47</span>         Pieter Slabbert </span><span>@mikerod I saw that link but I couldn&apos;t quite see how to make it work for what I needed. (probably just me missing something)

@ethanc Thanks, that was exactly what I needed</span></div><div id="t1591714554140600" t="2020-06-09 14:55:54 ethanc side note to the previous post,
 http://www.clara-rules.org/docs/fact_type_fn_perf/ 
im not 100% sure that demo works"><a href="#t1591714554140600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-06-09</span> <span class="t" onclick="H(this)">14:55:54</span>                  ethanc </span><span>side note to the previous post,
</span><a href="http://www.clara-rules.org/docs/fact_type_fn_perf/" target="_blank">http://www.clara-rules.org/docs/fact_type_fn_perf/</a><span>
im not 100% sure that demo works</span></div><div id="t1592576476147000" t="2020-06-19 14:21:16 kvlt Hey all, is there a way to  insert  multiple records inside of a rule, one for each item in a list. Sorry, I think I&apos;m not sure how to properly ask this but I think my example should describe this pretty well:

 (defrule somerule
  [SomeRecord  (= ?list-of-ids list-of-ids)]
  =&gt;
  (for [id ?list-of-ids]
    (insert! (-&gt;Addition id :some-key &quot;icecream&quot;))))"><a href="#t1592576476147000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-06-19</span> <span class="t" onclick="H(this)">14:21:16</span>                    kvlt </span><span>Hey all, is there a way to </span><code>insert</code><span> multiple records inside of a rule, one for each item in a list. Sorry, I think I&apos;m not sure how to properly ask this but I think my example should describe this pretty well:

</span><pre>(defrule somerule
  [SomeRecord  (= ?list-of-ids list-of-ids)]
  =&gt;
  (for [id ?list-of-ids]
    (insert! (-&gt;Addition id :some-key &quot;icecream&quot;))))</pre></div><div id="t1592576647148200" t="2020-06-19 14:24:07 mbragg There is  insert-all! that accepts a sequence of facts which may be useful to you  https://cljdoc.org/d/com.cerner/clara-rules/0.20.0/api/clara.rules#insert-all !"><a href="#t1592576647148200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-06-19</span> <span class="t" onclick="H(this)">14:24:07</span>                  mbragg </span><span>There is </span><code>insert-all!</code><span>that accepts a sequence of facts which may be useful to you </span><a href="https://cljdoc.org/d/com.cerner/clara-rules/0.20.0/api/clara.rules#insert-all" target="_blank">https://cljdoc.org/d/com.cerner/clara-rules/0.20.0/api/clara.rules#insert-all</a><span>!</span></div><div id="t1592576694149000" t="2020-06-19 14:24:54 kvlt @mbragg yes! but how do I generate that sequence of facts? It does not allow me to iterate over  ?list-of-ids"><a href="#t1592576694149000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-06-19</span> <span class="t" onclick="H(this)">14:24:54</span>                    kvlt </span><span>@mbragg yes! but how do I generate that sequence of facts? It does not allow me to iterate over </span><code>?list-of-ids</code></div><div id="t1592576992149500" t="2020-06-19 14:29:52 kvlt Oh, I was wrong, I was really tired last night. Thank you @mbragg"><a href="#t1592576992149500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-06-19</span> <span class="t" onclick="H(this)">14:29:52</span>                    kvlt </span><span>Oh, I was wrong, I was really tired last night. Thank you @mbragg</span></div><div id="t1592755226153400" t="2020-06-21 16:00:26 nick Hey all

I was wondering if there is a simpler way to rewrite this?
 (defrule calc-total-sum
  [?total1 &lt;- (acc/reduce-to-accum (fn [previous value]
                                     (+ previous (get-amount value)))
                                   0
                                   ) :from [Record1]]
  [?total2 &lt;- (acc/reduce-to-accum (fn [previous value]
                                     (+ previous (get-amount value)))
                                   0
                                   ) :from [Record2]]
  =&gt;
  (insert! (-&gt;TotalAmount (+ ?total1 ?total2)))) 
I have lots of record types like RecordN(in this simplified example) defrecord-s and all of them implement the same protocol(`get-amount` func)

I&apos;m trying to get the total amount for all those record types.
Ideally this would be just a single reduce-to-accum with  :from [Record1 Record2 ...]  or  :from [[Record1] [Record2] [...]]  but it doesn&apos;t seem to work."><a href="#t1592755226153400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-06-21</span> <span class="t" onclick="H(this)">16:00:26</span>                    nick </span><span>Hey all

I was wondering if there is a simpler way to rewrite this?
</span><pre>(defrule calc-total-sum
  [?total1 &lt;- (acc/reduce-to-accum (fn [previous value]
                                     (+ previous (get-amount value)))
                                   0
                                   ) :from [Record1]]
  [?total2 &lt;- (acc/reduce-to-accum (fn [previous value]
                                     (+ previous (get-amount value)))
                                   0
                                   ) :from [Record2]]
  =&gt;
  (insert! (-&gt;TotalAmount (+ ?total1 ?total2))))</pre><span>
I have lots of record types like RecordN(in this simplified example) defrecord-s and all of them implement the same protocol(`get-amount` func)

I&apos;m trying to get the total amount for all those record types.
Ideally this would be just a single reduce-to-accum with </span><code>:from [Record1 Record2 ...]</code><span> or </span><code>:from [[Record1] [Record2] [...]]</code><span> but it doesn&apos;t seem to work.</span></div><div id="t1592831153154700" t="2020-06-22 13:05:53 mbragg Have you seen  http://www.clara-rules.org/docs/fact_type_customization/ ? This would allow you to match on the ancestor type and just have the single accumulator."><a href="#t1592831153154700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-06-22</span> <span class="t" onclick="H(this)">13:05:53</span>                  mbragg </span><span>Have you seen </span><a href="http://www.clara-rules.org/docs/fact_type_customization/" target="_blank">http://www.clara-rules.org/docs/fact_type_customization/</a><span>? This would allow you to match on the ancestor type and just have the single accumulator.</span></div><div id="t1592832078156400" t="2020-06-22 13:21:18 ethanc Another option would be to leverage interfaces and allow the default ancestors function to handle it.
Something like:
 (ns test.interfaces
  (:require [clara.rules :as r]
            [clara.rules.accumulators :as acc]))

(definterface Summable
  (^long amount []))


(defrecord RecordOne [x]
  Summable
  (amount [_] x))

(defrecord RecordTwo [y]
  Summable
  (amount [_] y))


(defrecord Sum [z])


(r/defrule sum-rule
  [?s &lt;- (acc/sum #(.amount ^Summable %)) :from [Summable]]
  =&gt;
  (r/insert! (-&gt;Sum ?s)))

(r/defquery sum-query
  []
  [?s &lt;- Sum])

(defn run-test
  []
  (-&gt; (r/mk-session)
      (r/insert (-&gt;RecordOne 1)
                (-&gt;RecordOne 2)
                (-&gt;RecordTwo 3)
                (-&gt;RecordTwo 4))
      (r/fire-rules)
      (r/query sum-query)))

;; (run-test)
;; =&gt; ({:?s #test.interfaces.Sum{:z 10}})"><a href="#t1592832078156400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-06-22</span> <span class="t" onclick="H(this)">13:21:18</span>                  ethanc </span><span>Another option would be to leverage interfaces and allow the default ancestors function to handle it.
Something like:
</span><pre>(ns test.interfaces
  (:require [clara.rules :as r]
            [clara.rules.accumulators :as acc]))

(definterface Summable
  (^long amount []))


(defrecord RecordOne [x]
  Summable
  (amount [_] x))

(defrecord RecordTwo [y]
  Summable
  (amount [_] y))


(defrecord Sum [z])


(r/defrule sum-rule
  [?s &lt;- (acc/sum #(.amount ^Summable %)) :from [Summable]]
  =&gt;
  (r/insert! (-&gt;Sum ?s)))

(r/defquery sum-query
  []
  [?s &lt;- Sum])

(defn run-test
  []
  (-&gt; (r/mk-session)
      (r/insert (-&gt;RecordOne 1)
                (-&gt;RecordOne 2)
                (-&gt;RecordTwo 3)
                (-&gt;RecordTwo 4))
      (r/fire-rules)
      (r/query sum-query)))

;; (run-test)
;; =&gt; ({:?s #test.interfaces.Sum{:z 10}})</pre></div><div id="t1592832157157600" t="2020-06-22 13:22:37 ethanc this assumes you own the definition of the records in the session. Otherwise, @mbragg solution would likely be easier"><a href="#t1592832157157600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-06-22</span> <span class="t" onclick="H(this)">13:22:37</span>                  ethanc </span><span>this assumes you own the definition of the records in the session. Otherwise, @mbragg solution would likely be easier</span></div><div id="t1592834034158000" t="2020-06-22 13:53:54 ethanc cc. @nfedyashev"><a href="#t1592834034158000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-06-22</span> <span class="t" onclick="H(this)">13:53:54</span>                  ethanc </span><span>cc. @nfedyashev</span></div><div id="t1592834215158500" t="2020-06-22 13:56:55 nick @mbragg @ethanc Perfect! Thank you so much"><a href="#t1592834215158500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-06-22</span> <span class="t" onclick="H(this)">13:56:55</span>                    nick </span><span>@mbragg @ethanc Perfect! Thank you so much</span></div><div id="t1592934868160200" t="2020-06-23 17:54:28 kvlt How does one distribute rules over multiple ns&apos;s?
 mk-session  seems to imply that I can pass in multiple ns&apos;s

 (mk-session [&apos;my.core &apos;my.somethingelse] :cache false)  
But it appears this is not the case"><a href="#t1592934868160200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-06-23</span> <span class="t" onclick="H(this)">17:54:28</span>                    kvlt </span><span>How does one distribute rules over multiple ns&apos;s?
</span><code>mk-session</code><span> seems to imply that I can pass in multiple ns&apos;s

</span><pre>(mk-session [&apos;my.core &apos;my.somethingelse] :cache false) </pre><span>
But it appears this is not the case</span></div><div id="t1592935201161700" t="2020-06-23 18:00:01 mbragg You can just pass the namespaces as args I.e
 (mk-session &apos;my.core &apos;my.somethingelse :cache false) "><a href="#t1592935201161700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-06-23</span> <span class="t" onclick="H(this)">18:00:01</span>                  mbragg </span><span>You can just pass the namespaces as args I.e
</span><pre>(mk-session &apos;my.core &apos;my.somethingelse :cache false) </pre></div><div id="t1592935225162300" t="2020-06-23 18:00:25 kvlt Oh, sorry, it&apos;s  &amp;  args"><a href="#t1592935225162300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-06-23</span> <span class="t" onclick="H(this)">18:00:25</span>                    kvlt </span><span>Oh, sorry, it&apos;s </span><code>&amp;</code><span> args</span></div><div id="t1592935231162500" t="2020-06-23 18:00:31 kvlt You&apos;re right, sorry for the stupid question"><a href="#t1592935231162500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-06-23</span> <span class="t" onclick="H(this)">18:00:31</span>                    kvlt </span><span>You&apos;re right, sorry for the stupid question</span></div><div id="t1592935272163100" t="2020-06-23 18:01:12 mbragg No worries  😀"><a href="#t1592935272163100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-06-23</span> <span class="t" onclick="H(this)">18:01:12</span>                  mbragg </span><span>No worries </span><b>😀</b></div><div id="t1593441853164900" t="2020-06-29 14:44:13 Matthew Pettis Is there a way to just dump or inspect all of the facts that exist in a session?  I am thinking about looking at taking a session (which has to be defined with a static set of rules, if I understand correctly), dumping the facts, and creating a new session with a different set of rules to apply to the facts from the previous session."><a href="#t1593441853164900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-06-29</span> <span class="t" onclick="H(this)">14:44:13</span>          Matthew Pettis </span><span>Is there a way to just dump or inspect all of the facts that exist in a session?  I am thinking about looking at taking a session (which has to be defined with a static set of rules, if I understand correctly), dumping the facts, and creating a new session with a different set of rules to apply to the facts from the previous session.</span></div><div id="t1593444485166100" t="2020-06-29 15:28:05 Matthew Pettis Also, I&apos;ve seen in youtube talks some (at the time, just alpha-level) tools that will diagram out a set of rules or fact-firings on the given state of the working memory.  Does anyone have any links to tools like this to play with?"><a href="#t1593444485166100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-06-29</span> <span class="t" onclick="H(this)">15:28:05</span>          Matthew Pettis </span><span>Also, I&apos;ve seen in youtube talks some (at the time, just alpha-level) tools that will diagram out a set of rules or fact-firings on the given state of the working memory.  Does anyone have any links to tools like this to play with?</span></div><div id="t1593456897167300" t="2020-06-29 18:54:57 mbragg @matthew.pettis You can inspect a session to return a number of different rule/fact data structures  http://www.clara-rules.org/apidocs/0.9.0/clojure/clara.tools.inspect.html"><a href="#t1593456897167300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-06-29</span> <span class="t" onclick="H(this)">18:54:57</span>                  mbragg </span><span>@matthew.pettis You can inspect a session to return a number of different rule/fact data structures </span><a href="http://www.clara-rules.org/apidocs/0.9.0/clojure/clara.tools.inspect.html" target="_blank">http://www.clara-rules.org/apidocs/0.9.0/clojure/clara.tools.inspect.html</a></div><div id="t1593456991167900" t="2020-06-29 18:56:31 mbragg That should enable you to retrieve all the facts inserted"><a href="#t1593456991167900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-06-29</span> <span class="t" onclick="H(this)">18:56:31</span>                  mbragg </span><span>That should enable you to retrieve all the facts inserted</span></div><div id="t1593457141168600" t="2020-06-29 18:59:01 mbragg https://github.com/rbrush/clara-tools  might of been what you saw in that YouTube talk"><a href="#t1593457141168600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-06-29</span> <span class="t" onclick="H(this)">18:59:01</span>                  mbragg </span><a href="https://github.com/rbrush/clara-tools" target="_blank">https://github.com/rbrush/clara-tools</a><span> might of been what you saw in that YouTube talk</span></div><div id="t1593459284169800" t="2020-06-29 19:34:44 mikerod @matthew.pettis in general I’d say it’s best to make targeted queries that you use to extract the facts you want to use in the next set of rules. "><a href="#t1593459284169800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-06-29</span> <span class="t" onclick="H(this)">19:34:44</span>                 mikerod </span><span>@matthew.pettis in general I’d say it’s best to make targeted queries that you use to extract the facts you want to use in the next set of rules. </span></div><div id="t1593459318170300" t="2020-06-29 19:35:18 mikerod That’s your smoothest path forward.  "><a href="#t1593459318170300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-06-29</span> <span class="t" onclick="H(this)">19:35:18</span>                 mikerod </span><span>That’s your smoothest path forward.  </span></div><div id="t1593459420171400" t="2020-06-29 19:37:00 mikerod There are some inspect namespaces and stuff in clara you can look at too. But typically more for inspection at a different sort of level"><a href="#t1593459420171400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-06-29</span> <span class="t" onclick="H(this)">19:37:00</span>                 mikerod </span><span>There are some inspect namespaces and stuff in clara you can look at too. But typically more for inspection at a different sort of level</span></div><div id="t1593459433171900" t="2020-06-29 19:37:13 mikerod I’m just on mobile so can’t pull up much currently"><a href="#t1593459433171900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-06-29</span> <span class="t" onclick="H(this)">19:37:13</span>                 mikerod </span><span>I’m just on mobile so can’t pull up much currently</span></div><div id="t1593459501173600" t="2020-06-29 19:38:21 mikerod Clara-tools maybe relevant. I think the codebase is likely outdated though. But perhaps gives extra insight. Clara has inspection and tracing things built in to an extent too. And then there is a listener api you can hook into if you require more specific things. "><a href="#t1593459501173600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-06-29</span> <span class="t" onclick="H(this)">19:38:21</span>                 mikerod </span><span>Clara-tools maybe relevant. I think the codebase is likely outdated though. But perhaps gives extra insight. Clara has inspection and tracing things built in to an extent too. And then there is a listener api you can hook into if you require more specific things. </span></div><div id="t1593460740174300" t="2020-06-29 19:59:00 Matthew Pettis Thanks @mbragg and @mikerod -- I&apos;ll take a look at these things."><a href="#t1593460740174300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-06-29</span> <span class="t" onclick="H(this)">19:59:00</span>          Matthew Pettis </span><span>Thanks @mbragg and @mikerod -- I&apos;ll take a look at these things.</span></div><div id="t1593465810178400" t="2020-06-29 21:23:30 wparker Agreed that if you need to pull out facts, targeted queries are probably the way to go.  You could write a query that would match all facts e.g. against Object on the JVM, but the performance impact of that could be significant.  You might consider whether you actually need multiple sessions though - what is the motivation there as opposed to having the facts you’re extracting trigger those rules in the same session?  You could use a design pattern where you have subsets of your system that have “private” facts that by convention are only used in say a particular namespace, and “glue” facts that connect different parts.   It is highly domain-dependent but that’s a pattern I’ve used before. @matthew.pettis"><a href="#t1593465810178400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-06-29</span> <span class="t" onclick="H(this)">21:23:30</span>                 wparker </span><span>Agreed that if you need to pull out facts, targeted queries are probably the way to go.  You could write a query that would match all facts e.g. against Object on the JVM, but the performance impact of that could be significant.  You might consider whether you actually need multiple sessions though - what is the motivation there as opposed to having the facts you’re extracting trigger those rules in the same session?  You could use a design pattern where you have subsets of your system that have “private” facts that by convention are only used in say a particular namespace, and “glue” facts that connect different parts.   It is highly domain-dependent but that’s a pattern I’ve used before. @matthew.pettis</span></div><div id="t1593522784183700" t="2020-06-30 13:13:04 Matthew Pettis @wparker Thanks for this.  At this point, I am honestly just exploring, and thinking more about the ability to see the complete state of a session after starting with an initial fact set and seeing what all gets generated by firing the rules.  I&apos;m thinking more about a diagnostic to just dump a session and being able to talk through with someone &quot;If you start with these rules and this initial fact set, this is the final set of facts that end up in the session.&quot;  Starting with that fact set and triggering another set of rules was just a thought experiment, but looking at a given state thoroughly was the main driver.  The session use cases I can think of probably won&apos;t be all that large in terms of facts, or at least initial facts, but might get a lot of derived facts with the rule set I put into the session.  I like the &quot;private&quot; and &quot;glue&quot; facts approach... I was thinking along the lines of &quot;initial&quot; and &quot;derived&quot; facts from rules, and comparing those two sets."><a href="#t1593522784183700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-06-30</span> <span class="t" onclick="H(this)">13:13:04</span>          Matthew Pettis </span><span>@wparker Thanks for this.  At this point, I am honestly just exploring, and thinking more about the ability to see the complete state of a session after starting with an initial fact set and seeing what all gets generated by firing the rules.  I&apos;m thinking more about a diagnostic to just dump a session and being able to talk through with someone &quot;If you start with these rules and this initial fact set, this is the final set of facts that end up in the session.&quot;  Starting with that fact set and triggering another set of rules was just a thought experiment, but looking at a given state thoroughly was the main driver.  The session use cases I can think of probably won&apos;t be all that large in terms of facts, or at least initial facts, but might get a lot of derived facts with the rule set I put into the session.  I like the &quot;private&quot; and &quot;glue&quot; facts approach... I was thinking along the lines of &quot;initial&quot; and &quot;derived&quot; facts from rules, and comparing those two sets.</span></div><div id="t1593581259189600" t="2020-07-01 05:27:39 mac Is there an idiomatic way to do hierarchical rules in clara? I have a set of rules that all calculate the same property from a fact but I would like the calculation only to be made by the most specific of the rules that match. I have tried inserting a guard fact when a rule (e.g.  [:not [:guard (= (:active this) true] and (insert! {:type guard :active true}  ) matches and using salience to control firing order, but this results in an endless loop for reasons I cannot figure out."><a href="#t1593581259189600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-07-01</span> <span class="t" onclick="H(this)">05:27:39</span>                     mac </span><span>Is there an idiomatic way to do hierarchical rules in clara? I have a set of rules that all calculate the same property from a fact but I would like the calculation only to be made by the most specific of the rules that match. I have tried inserting a guard fact when a rule (e.g. </span><code>[:not [:guard (= (:active this) true] and (insert! {:type guard :active true}</code><span> ) matches and using salience to control firing order, but this results in an endless loop for reasons I cannot figure out.</span></div><div id="t1593597604190600" t="2020-07-01 10:00:04 mac As an example I don&apos;t understand why the code below goes into an endless loop.
 (defrule test-rule
    &quot;test guard&quot;
    [:not [:guard (= (:active this) true)]]
    =&gt;
    (do
      (println &quot;Inserting guard!&quot;)
      (insert! {:type :guard :active true})))
  (-&gt; (mk-session [test-rule]
                  :fact-type-fn :type)
      (fire-rules))"><a href="#t1593597604190600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-07-01</span> <span class="t" onclick="H(this)">10:00:04</span>                     mac </span><span>As an example I don&apos;t understand why the code below goes into an endless loop.
</span><pre>(defrule test-rule
    &quot;test guard&quot;
    [:not [:guard (= (:active this) true)]]
    =&gt;
    (do
      (println &quot;Inserting guard!&quot;)
      (insert! {:type :guard :active true})))
  (-&gt; (mk-session [test-rule]
                  :fact-type-fn :type)
      (fire-rules))</pre></div><div id="t1593601563191100" t="2020-07-01 11:06:03 mikerod @mac use a different guard type for each tier"><a href="#t1593601563191100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-07-01</span> <span class="t" onclick="H(this)">11:06:03</span>                 mikerod </span><span>@mac use a different guard type for each tier</span></div><div id="t1593601573191400" t="2020-07-01 11:06:13 mikerod Where the rule never inserts it’s own type"><a href="#t1593601573191400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-07-01</span> <span class="t" onclick="H(this)">11:06:13</span>                 mikerod </span><span>Where the rule never inserts it’s own type</span></div><div id="t1593601928192400" t="2020-07-01 11:12:08 mikerod @mac  https://gist.github.com/mrrodriguez/6a6f8373b25d69826b3efe154c928fac  this actually has a somewhat similar model as well. For a slightly different goal but notice the guarding not conditions "><a href="#t1593601928192400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-07-01</span> <span class="t" onclick="H(this)">11:12:08</span>                 mikerod </span><span>@mac </span><a href="https://gist.github.com/mrrodriguez/6a6f8373b25d69826b3efe154c928fac" target="_blank">https://gist.github.com/mrrodriguez/6a6f8373b25d69826b3efe154c928fac</a><span> this actually has a somewhat similar model as well. For a slightly different goal but notice the guarding not conditions </span></div><div id="t1593602368193200" t="2020-07-01 11:19:28 mac @mikerod Thanks, the gist looks very useful. Do you know why my example would loop?"><a href="#t1593602368193200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-07-01</span> <span class="t" onclick="H(this)">11:19:28</span>                     mac </span><span>@mikerod Thanks, the gist looks very useful. Do you know why my example would loop?</span></div><div id="t1593603038194100" t="2020-07-01 11:30:38 mikerod @mac the rules attempt to find a logical consistency balance"><a href="#t1593603038194100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-07-01</span> <span class="t" onclick="H(this)">11:30:38</span>                 mikerod </span><span>@mac the rules attempt to find a logical consistency balance</span></div><div id="t1593603054194600" t="2020-07-01 11:30:54 mikerod Your rule Left side condition is invalidated when the right side inserts. "><a href="#t1593603054194600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-07-01</span> <span class="t" onclick="H(this)">11:30:54</span>                 mikerod </span><span>Your rule Left side condition is invalidated when the right side inserts. </span></div><div id="t1593603069195200" t="2020-07-01 11:31:09 mikerod The engine then retracts that’s fact because it is no longer logically supported. "><a href="#t1593603069195200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-07-01</span> <span class="t" onclick="H(this)">11:31:09</span>                 mikerod </span><span>The engine then retracts that’s fact because it is no longer logically supported. </span></div><div id="t1593603088195500" t="2020-07-01 11:31:28 mikerod It’s called the truth maintenance system"><a href="#t1593603088195500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-07-01</span> <span class="t" onclick="H(this)">11:31:28</span>                 mikerod </span><span>It’s called the truth maintenance system</span></div><div id="t1593603119196400" t="2020-07-01 11:31:59 mikerod Then it can activate again and re insert. And again it invalidates itself. So it’s logical looping"><a href="#t1593603119196400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-07-01</span> <span class="t" onclick="H(this)">11:31:59</span>                 mikerod </span><span>Then it can activate again and re insert. And again it invalidates itself. So it’s logical looping</span></div><div id="t1593603323198000" t="2020-07-01 11:35:23 mac @mikerod OK, so the guard gets removed because the LHS match that caused it to be inserted no longer matches?"><a href="#t1593603323198000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-07-01</span> <span class="t" onclick="H(this)">11:35:23</span>                     mac </span><span>@mikerod OK, so the guard gets removed because the LHS match that caused it to be inserted no longer matches?</span></div><div id="t1593607149198200" t="2020-07-01 12:39:09 mikerod Yes"><a href="#t1593607149198200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-07-01</span> <span class="t" onclick="H(this)">12:39:09</span>                 mikerod </span><span>Yes</span></div><div id="t1593607173199000" t="2020-07-01 12:39:33 mikerod Think of rules not like in order. But instead that the rhs facts inserted are supported by the lhs "><a href="#t1593607173199000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-07-01</span> <span class="t" onclick="H(this)">12:39:33</span>                 mikerod </span><span>Think of rules not like in order. But instead that the rhs facts inserted are supported by the lhs </span></div><div id="t1593612448200000" t="2020-07-01 14:07:28 mac @mikerod Got it, this is much closer to logic programming than I thought, but it makes sense when framed like that."><a href="#t1593612448200000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-07-01</span> <span class="t" onclick="H(this)">14:07:28</span>                     mac </span><span>@mikerod Got it, this is much closer to logic programming than I thought, but it makes sense when framed like that.</span></div><div id="t1594244858200900" t="2020-07-08 21:47:38 Matthew Pettis Regarding fact-type customization, from here:  https://github.com/cerner/clara-examples/blob/master/src/main/clojure/clara/examples/fact_type_options.clj"><a href="#t1594244858200900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-07-08</span> <span class="t" onclick="H(this)">21:47:38</span>          Matthew Pettis </span><span>Regarding fact-type customization, from here: </span><a href="https://github.com/cerner/clara-examples/blob/master/src/main/clojure/clara/examples/fact_type_options.clj" target="_blank">https://github.com/cerner/clara-examples/blob/master/src/main/clojure/clara/examples/fact_type_options.clj</a></div><div id="t1594244960201400" t="2020-07-08 21:49:20 Matthew Pettis Can someone explain how this works to find ancestors?"><a href="#t1594244960201400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-07-08</span> <span class="t" onclick="H(this)">21:49:20</span>          Matthew Pettis </span><span>Can someone explain how this works to find ancestors?</span></div><div id="t1594244975201600" t="2020-07-08 21:49:35 Matthew Pettis (def custom-ancestors-fn {:precise-temperature-reading #{:temperature-reading}})"><a href="#t1594244975201600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-07-08</span> <span class="t" onclick="H(this)">21:49:35</span>          Matthew Pettis </span><code>(def custom-ancestors-fn {:precise-temperature-reading #{:temperature-reading}})</code></div><div id="t1594245057202700" t="2020-07-08 21:50:57 Matthew Pettis I get that a map can work in the function position, and will look up the value for a key given as argument, but I am struggling to see how this def works as a function to look up ancestors."><a href="#t1594245057202700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-07-08</span> <span class="t" onclick="H(this)">21:50:57</span>          Matthew Pettis </span><span>I get that a map can work in the function position, and will look up the value for a key given as argument, but I am struggling to see how this def works as a function to look up ancestors.</span></div><div id="t1594303968204100" t="2020-07-09 14:12:48 ethanc The def itself isn’t special, its just handed off to the  mk-session  call. Unless I am miss interpreting your question"><a href="#t1594303968204100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-07-09</span> <span class="t" onclick="H(this)">14:12:48</span>                  ethanc </span><span>The def itself isn’t special, its just handed off to the </span><code>mk-session</code><span> call. Unless I am miss interpreting your question</span></div><div id="t1594304166204700" t="2020-07-09 14:16:06 mikerod @matthew.pettis I think I don’t know exactly what you are asking either, but perhaps you are just trying to understand what the ancestors fn does?"><a href="#t1594304166204700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-07-09</span> <span class="t" onclick="H(this)">14:16:06</span>                 mikerod </span><span>@matthew.pettis I think I don’t know exactly what you are asking either, but perhaps you are just trying to understand what the ancestors fn does?</span></div><div id="t1594304178205000" t="2020-07-09 14:16:18 mikerod it takes a type, and returns a set of ancestors"><a href="#t1594304178205000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-07-09</span> <span class="t" onclick="H(this)">14:16:18</span>                 mikerod </span><span>it takes a type, and returns a set of ancestors</span></div><div id="t1594304215205700" t="2020-07-09 14:16:55 mikerod And in rules, a type T matches any rule type that is the same type T or any ancestor in the set of ancestors of T - as returned from ancestors fn"><a href="#t1594304215205700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-07-09</span> <span class="t" onclick="H(this)">14:16:55</span>                 mikerod </span><span>And in rules, a type T matches any rule type that is the same type T or any ancestor in the set of ancestors of T - as returned from ancestors fn</span></div><div id="t1594304256206100" t="2020-07-09 14:17:36 mikerod the docs  http://www.clara-rules.org/docs/fact_type_customization/  here seem to explain this with an example though - so not sure this is where you the confusion is"><a href="#t1594304256206100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-07-09</span> <span class="t" onclick="H(this)">14:17:36</span>                 mikerod </span><span>the docs </span><a href="http://www.clara-rules.org/docs/fact_type_customization/" target="_blank">http://www.clara-rules.org/docs/fact_type_customization/</a><span> here seem to explain this with an example though - so not sure this is where you the confusion is</span></div><div id="t1594304318207300" t="2020-07-09 14:18:38 mikerod &gt; I get that a map can work in the function position, and will look up the value for a key given as argument, but I am struggling to see how this def works as a function to look up ancestors.
A map is a fn of 1 argument. It looks no different from the callers perspective.
So the clara-rules engine has a fact with type T, it looks up ancestors like:
 (ancestors-fn T)  which returns the ancestor types"><a href="#t1594304318207300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-07-09</span> <span class="t" onclick="H(this)">14:18:38</span>                 mikerod </span><span>&gt; I get that a map can work in the function position, and will look up the value for a key given as argument, but I am struggling to see how this def works as a function to look up ancestors.
A map is a fn of 1 argument. It looks no different from the callers perspective.
So the clara-rules engine has a fact with type T, it looks up ancestors like:
</span><code>(ancestors-fn T)</code><span> which returns the ancestor types</span></div><div id="t1594304381208000" t="2020-07-09 14:19:41 mikerod in pure clj with the above example:
 (let [ancestors-fn {:precise-temperature-reading #{:temperature-reading}}]
  (ancestors-fn :precise-temperature-reading))
;;= #{:temperature-reading}}"><a href="#t1594304381208000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-07-09</span> <span class="t" onclick="H(this)">14:19:41</span>                 mikerod </span><span>in pure clj with the above example:
</span><pre>(let [ancestors-fn {:precise-temperature-reading #{:temperature-reading}}]
  (ancestors-fn :precise-temperature-reading))
;;= #{:temperature-reading}}</pre></div><div id="t1594306314212800" t="2020-07-09 14:51:54 Matthew Pettis @mikerod Thanks, I think that what you said is enough for me.  The missing thing for me, which I understand from your code snipped, is that it interacts with the fact-type-function.  That is, it seems that first the fact-type-function is used to get a value, and then that value (like :precise-temperature-reading), and then that is the argument to the ancestor-fn, which returns a set of ancestors that the argument belongs to, and then rules that use any of those ancestors are considered.  I was trying to figure out how that ancestor-fn could be applied directly to the the fact, instead of the result of the fact-type-function applied to the fact."><a href="#t1594306314212800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-07-09</span> <span class="t" onclick="H(this)">14:51:54</span>          Matthew Pettis </span><span>@mikerod Thanks, I think that what you said is enough for me.  The missing thing for me, which I understand from your code snipped, is that it interacts with the fact-type-function.  That is, it seems that first the fact-type-function is used to get a value, and then that value (like :precise-temperature-reading), and then that is the argument to the ancestor-fn, which returns a set of ancestors that the argument belongs to, and then rules that use any of those ancestors are considered.  I was trying to figure out how that ancestor-fn could be applied directly to the the fact, instead of the result of the fact-type-function applied to the fact.</span></div><div id="t1594306363213700" t="2020-07-09 14:52:43 Matthew Pettis So, in short, I was missing that ancestor-fn operated on the result of fact-type-fn, not on the original fact itself, which I couldn&apos;t see how that would work."><a href="#t1594306363213700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-07-09</span> <span class="t" onclick="H(this)">14:52:43</span>          Matthew Pettis </span><span>So, in short, I was missing that ancestor-fn operated on the result of fact-type-fn, not on the original fact itself, which I couldn&apos;t see how that would work.</span></div><div id="t1594307114213900" t="2020-07-09 15:05:14 mikerod yes exactly!"><a href="#t1594307114213900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-07-09</span> <span class="t" onclick="H(this)">15:05:14</span>                 mikerod </span><span>yes exactly!</span></div><div id="t1594934200217200" t="2020-07-16 21:16:40 sekao is there any way, either with the public API or with private stuff, that i can determine which fact(s) caused a rule to fire? something that i could check in the right hand side of a rule. i tried looking in  clara.rules.engine/**rule-context**  but the  :token  inside it seems to contain all matching facts, not just the ones that triggered the rule."><a href="#t1594934200217200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-07-16</span> <span class="t" onclick="H(this)">21:16:40</span>                   sekao </span><span>is there any way, either with the public API or with private stuff, that i can determine which fact(s) caused a rule to fire? something that i could check in the right hand side of a rule. i tried looking in </span><code>clara.rules.engine/**rule-context**</code><span> but the </span><code>:token</code><span> inside it seems to contain all matching facts, not just the ones that triggered the rule.</span></div><div id="t1594941196217900" t="2020-07-16 23:13:16 mikerod @sekao if you use a fact level binding you have the fact available as a binding on rhs "><a href="#t1594941196217900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-07-16</span> <span class="t" onclick="H(this)">23:13:16</span>                 mikerod </span><span>@sekao if you use a fact level binding you have the fact available as a binding on rhs </span></div><div id="t1594941242218800" t="2020-07-16 23:14:02 mikerod [?fact &lt;- Something] =&gt; "><a href="#t1594941242218800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-07-16</span> <span class="t" onclick="H(this)">23:14:02</span>                 mikerod </span><span>[?fact &lt;- Something] =&gt; </span></div><div id="t1594943065221600" t="2020-07-16 23:44:25 sekao yes but what i&apos;m hoping to figure out is which of the bound facts actually caused the rule to fire. so if i have three facts bound on the lhs, in the rhs i want to know which of the three caused the current execution. i&apos;m guessing this info is not available anywhere?"><a href="#t1594943065221600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-07-16</span> <span class="t" onclick="H(this)">23:44:25</span>                   sekao </span><span>yes but what i&apos;m hoping to figure out is which of the bound facts actually caused the rule to fire. so if i have three facts bound on the lhs, in the rhs i want to know which of the three caused the current execution. i&apos;m guessing this info is not available anywhere?</span></div><div id="t1594943180223400" t="2020-07-16 23:46:20 sekao during the first execution the answer will be &quot;all three caused it to fire&quot;, but if i insert a new fact that matches the first binding, for example, the rule will execute a second time, and i want to know that the first binding was what caused that second execution."><a href="#t1594943180223400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-07-16</span> <span class="t" onclick="H(this)">23:46:20</span>                   sekao </span><span>during the first execution the answer will be &quot;all three caused it to fire&quot;, but if i insert a new fact that matches the first binding, for example, the rule will execute a second time, and i want to know that the first binding was what caused that second execution.</span></div><div id="t1594987976224600" t="2020-07-17 12:12:56 mikerod @sekao each time there is a match it’s a new rule firing. The cause is whatever the combination of facts it was to cause the rule to fire. "><a href="#t1594987976224600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-07-17</span> <span class="t" onclick="H(this)">12:12:56</span>                 mikerod </span><span>@sekao each time there is a match it’s a new rule firing. The cause is whatever the combination of facts it was to cause the rule to fire. </span></div><div id="t1594987990225100" t="2020-07-17 12:13:10 mikerod Seems an odd thing you are trying to distinguish. "><a href="#t1594987990225100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-07-17</span> <span class="t" onclick="H(this)">12:13:10</span>                 mikerod </span><span>Seems an odd thing you are trying to distinguish. </span></div><div id="t1595000907227200" t="2020-07-17 15:48:27 sekao fair enough. the reason i&apos;m interested in this is that it would potentially be a way to make updating facts within rules more ergonomic (avoiding the infinite loop problem). but it may not fit how clara works underneath."><a href="#t1595000907227200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-07-17</span> <span class="t" onclick="H(this)">15:48:27</span>                   sekao </span><span>fair enough. the reason i&apos;m interested in this is that it would potentially be a way to make updating facts within rules more ergonomic (avoiding the infinite loop problem). but it may not fit how clara works underneath.</span></div><div id="t1595005930227600" t="2020-07-17 17:12:10 mikerod @sekao I’d encourage you read  http://www.metasimple.org/2017/12/23/clara-updating-facts.html"><a href="#t1595005930227600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-07-17</span> <span class="t" onclick="H(this)">17:12:10</span>                 mikerod </span><span>@sekao I’d encourage you read </span><a href="http://www.metasimple.org/2017/12/23/clara-updating-facts.html" target="_blank">http://www.metasimple.org/2017/12/23/clara-updating-facts.html</a></div><div id="t1595005979229100" t="2020-07-17 17:12:59 mikerod I wrote it a while ago but it was an attempt to basically dump as much info I could on the updating facts concept and how it interacts with clara and in general the automatic truth maintenance system model (which is what allows rules to be order independently expressed etc)"><a href="#t1595005979229100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-07-17</span> <span class="t" onclick="H(this)">17:12:59</span>                 mikerod </span><span>I wrote it a while ago but it was an attempt to basically dump as much info I could on the updating facts concept and how it interacts with clara and in general the automatic truth maintenance system model (which is what allows rules to be order independently expressed etc)</span></div><div id="t1595022041229900" t="2020-07-17 21:40:41 MatthewLisp Hello clojurists users of Clara "><a href="#t1595022041229900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-07-17</span> <span class="t" onclick="H(this)">21:40:41</span>             MatthewLisp </span><span>Hello clojurists users of Clara </span></div><div id="t1595022063230500" t="2020-07-17 21:41:03 MatthewLisp I’m currently using Clara on a project and I’m kinda lost really "><a href="#t1595022063230500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-07-17</span> <span class="t" onclick="H(this)">21:41:03</span>             MatthewLisp </span><span>I’m currently using Clara on a project and I’m kinda lost really </span></div><div id="t1595022085231200" t="2020-07-17 21:41:25 MatthewLisp Lost in the designing of the rules and the facts "><a href="#t1595022085231200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-07-17</span> <span class="t" onclick="H(this)">21:41:25</span>             MatthewLisp </span><span>Lost in the designing of the rules and the facts </span></div><div id="t1595022105231800" t="2020-07-17 21:41:45 MatthewLisp I wanted to know how you define what is a Fact? "><a href="#t1595022105231800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-07-17</span> <span class="t" onclick="H(this)">21:41:45</span>             MatthewLisp </span><span>I wanted to know how you define what is a Fact? </span></div><div id="t1595022125232400" t="2020-07-17 21:42:05 MatthewLisp What should be a fact in your system "><a href="#t1595022125232400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-07-17</span> <span class="t" onclick="H(this)">21:42:05</span>             MatthewLisp </span><span>What should be a fact in your system </span></div><div id="t1595022156233300" t="2020-07-17 21:42:36 MatthewLisp Because this directly influence what you insert on right hand side of rules also "><a href="#t1595022156233300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-07-17</span> <span class="t" onclick="H(this)">21:42:36</span>             MatthewLisp </span><span>Because this directly influence what you insert on right hand side of rules also </span></div><div id="t1595022326237000" t="2020-07-17 21:45:26 MatthewLisp Currently my rules are operating on a state map that represents a requisition from outside. I have multiple records but every record has the same data inside. The rules are pretty much looking whether I have key X or not on the map. It feels wrong, it feels that i don’t know how to design the facts "><a href="#t1595022326237000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-07-17</span> <span class="t" onclick="H(this)">21:45:26</span>             MatthewLisp </span><span>Currently my rules are operating on a state map that represents a requisition from outside. I have multiple records but every record has the same data inside. The rules are pretty much looking whether I have key X or not on the map. It feels wrong, it feels that i don’t know how to design the facts </span></div><div id="t1595096993245200" t="2020-07-18 18:29:53 ethanc @matthewlisp,
Clara is pretty flexible with the terminology of fact, clara provides extension points(fact-type-fn &amp; ancestors-fn) to allow users to define their own “facts” or whatever that means to their system.

I’m having trouble visualizing the sort of system that you described with the state map above, perhaps you could provide a small example?"><a href="#t1595096993245200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-07-18</span> <span class="t" onclick="H(this)">18:29:53</span>                  ethanc </span><span>@matthewlisp,
Clara is pretty flexible with the terminology of fact, clara provides extension points(fact-type-fn &amp; ancestors-fn) to allow users to define their own “facts” or whatever that means to their system.

I’m having trouble visualizing the sort of system that you described with the state map above, perhaps you could provide a small example?</span></div><div id="t1595983065249300" t="2020-07-29 00:37:45 Matthew Pettis Are there examples of using things like multiple insert! calls, or insert! inside of an if-let on the RHS of a rule?  Or reasons why that isn&apos;t allowed?  I&apos;ll try once back at a computer, but I wanted to ask in case there was something obvious I should know."><a href="#t1595983065249300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-07-29</span> <span class="t" onclick="H(this)">00:37:45</span>          Matthew Pettis </span><span>Are there examples of using things like multiple insert! calls, or insert! inside of an if-let on the RHS of a rule?  Or reasons why that isn&apos;t allowed?  I&apos;ll try once back at a computer, but I wanted to ask in case there was something obvious I should know.</span></div><div id="t1596030180254000" t="2020-07-29 13:43:00 ethanc The rhs of a rule is inside an implicit let block, so it should allow for multiple inserts:
 (defrule rule-name
  &lt;lhs&gt;
  =&gt;
  (insert! &lt;fact1&gt;)
  (insert! &lt;fact2&gt;)) 
 https://github.com/cerner/clara-rules/blob/main/src/main/clojure/clara/rules/compiler.clj#L454-L456 

The RHS can be arbitrary clojure code, so if-lets would be fine. Though as a word of warning, don’t do stateful things in the RHS of a rule as it can lead to weird side effects."><a href="#t1596030180254000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-07-29</span> <span class="t" onclick="H(this)">13:43:00</span>                  ethanc </span><span>The rhs of a rule is inside an implicit let block, so it should allow for multiple inserts:
</span><pre>(defrule rule-name
  &lt;lhs&gt;
  =&gt;
  (insert! &lt;fact1&gt;)
  (insert! &lt;fact2&gt;))</pre><span>
</span><a href="https://github.com/cerner/clara-rules/blob/main/src/main/clojure/clara/rules/compiler.clj#L454-L456" target="_blank">https://github.com/cerner/clara-rules/blob/main/src/main/clojure/clara/rules/compiler.clj#L454-L456</a><span>

The RHS can be arbitrary clojure code, so if-lets would be fine. Though as a word of warning, don’t do stateful things in the RHS of a rule as it can lead to weird side effects.</span></div><div id="t1596030655255100" t="2020-07-29 13:50:55 Matthew Pettis Thanks!  Warning taken.  I&apos;m trying to put together a framework like the &apos;sensors&apos; example in the  https://github.com/cerner/clara-examples  repo.  I haven&apos;t worked out how I want it structured yet, but I know I want to trigger using a function to compute something based on the presence of facts, and then conditionally insert another fact based on what that function returns.  Something like, &quot;if these two facts exist, do this computation on them.  If that computation yields a certain result (like a constraint violation) insert a fact that records the constraint violation.  Otherwise, don&apos;t insert a fact.&quot;  I&apos;m not sure if good practice is to that computation on the LHS of the rules as a precondition, and then the RHS will trigger if result passes a test, or to do that check totally on the RHS."><a href="#t1596030655255100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-07-29</span> <span class="t" onclick="H(this)">13:50:55</span>               Matthew Pettis </span><span>Thanks!  Warning taken.  I&apos;m trying to put together a framework like the &apos;sensors&apos; example in the </span><a href="https://github.com/cerner/clara-examples" target="_blank">https://github.com/cerner/clara-examples</a><span> repo.  I haven&apos;t worked out how I want it structured yet, but I know I want to trigger using a function to compute something based on the presence of facts, and then conditionally insert another fact based on what that function returns.  Something like, &quot;if these two facts exist, do this computation on them.  If that computation yields a certain result (like a constraint violation) insert a fact that records the constraint violation.  Otherwise, don&apos;t insert a fact.&quot;  I&apos;m not sure if good practice is to that computation on the LHS of the rules as a precondition, and then the RHS will trigger if result passes a test, or to do that check totally on the RHS.</span></div><div id="t1596045559268600" t="2020-07-29 17:59:19 ethanc As mike has mentioned(outside of this thread) LHS is probably the ideal place for this sort of logic.

We can continue that conversation there. :)"><a href="#t1596045559268600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-07-29</span> <span class="t" onclick="H(this)">17:59:19</span>                       ethanc </span><span>As mike has mentioned(outside of this thread) LHS is probably the ideal place for this sort of logic.

We can continue that conversation there. :)</span></div><div id="t1596047089270700" t="2020-07-29 18:24:49 Matthew Pettis Thanks!  Yep,   Or, for my first pass, with my logic, I&apos;m going to not do conditional inserts within rules -- I&apos;m going to try to just do do inserts with a record of a natural structure that allows me to pull out what I want on a query, and put logic in the query, or even post-process query outputs.  Thanks for the help!"><a href="#t1596047089270700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-07-29</span> <span class="t" onclick="H(this)">18:24:49</span>               Matthew Pettis </span><span>Thanks!  Yep,   Or, for my first pass, with my logic, I&apos;m going to not do conditional inserts within rules -- I&apos;m going to try to just do do inserts with a record of a natural structure that allows me to pull out what I want on a query, and put logic in the query, or even post-process query outputs.  Thanks for the help!</span></div><div id="t1596031146256000" t="2020-07-29 13:59:06 Matthew Pettis Here&apos;s some pseudocode of what I am trying to decide between, not sure if both are even feasible or, as noted here, advisable:"><a href="#t1596031146256000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-07-29</span> <span class="t" onclick="H(this)">13:59:06</span>          Matthew Pettis </span><span>Here&apos;s some pseudocode of what I am trying to decide between, not sure if both are even feasible or, as noted here, advisable:</span></div><div id="t1596031151256200" t="2020-07-29 13:59:11 Matthew Pettis ;; pseudocode for a lhs computation.  I&apos;m not sure how to compute ?c here syntactically, if possible at all.
(defrule lhs-pseudocode
 [?a &lt;- ConditionA]
 [?b &lt;- ConditionB]
 ;; [?c &lt;- compute a function return value (check-function ?a ?b)]
 ;; [:test ?c is truthy]
 =&gt;
 (insert! (-&gt;ExceptionFact ?c)))


;; pseudocode for a rhs check
(defrule rhs-pseudocode
 [?a &lt;- ConditionA]
 [?b &lt;- ConditionB]
 =&gt;
 (let [c (check-function ?a ?b)]
  (when (truthy c)
   (insert! (-&gt;ExceptionFact c)))))"><a href="#t1596031151256200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-07-29</span> <span class="t" onclick="H(this)">13:59:11</span>          Matthew Pettis </span><pre>;; pseudocode for a lhs computation.  I&apos;m not sure how to compute ?c here syntactically, if possible at all.
(defrule lhs-pseudocode
 [?a &lt;- ConditionA]
 [?b &lt;- ConditionB]
 ;; [?c &lt;- compute a function return value (check-function ?a ?b)]
 ;; [:test ?c is truthy]
 =&gt;
 (insert! (-&gt;ExceptionFact ?c)))


;; pseudocode for a rhs check
(defrule rhs-pseudocode
 [?a &lt;- ConditionA]
 [?b &lt;- ConditionB]
 =&gt;
 (let [c (check-function ?a ?b)]
  (when (truthy c)
   (insert! (-&gt;ExceptionFact c)))))</pre></div><div id="t1596031526257200" t="2020-07-29 14:05:26 mikerod I’d add it’s generally not good to do conditional things in RHS. The rules themselves are meant to capture the conditional flows"><a href="#t1596031526257200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-07-29</span> <span class="t" onclick="H(this)">14:05:26</span>                 mikerod </span><span>I’d add it’s generally not good to do conditional things in RHS. The rules themselves are meant to capture the conditional flows</span></div><div id="t1596031543257700" t="2020-07-29 14:05:43 mikerod I generally find it an anti pattern for the RHS to “maybe do some insert”"><a href="#t1596031543257700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-07-29</span> <span class="t" onclick="H(this)">14:05:43</span>                 mikerod </span><span>I generally find it an anti pattern for the RHS to “maybe do some insert”</span></div><div id="t1596031547257900" t="2020-07-29 14:05:47 mikerod There are exceptions"><a href="#t1596031547257900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-07-29</span> <span class="t" onclick="H(this)">14:05:47</span>                 mikerod </span><span>There are exceptions</span></div><div id="t1596031561258300" t="2020-07-29 14:06:01 mikerod But above , you’d be better off using a :test node on LHS "><a href="#t1596031561258300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-07-29</span> <span class="t" onclick="H(this)">14:06:01</span>                 mikerod </span><span>But above , you’d be better off using a :test node on LHS </span></div><div id="t1596032067260300" t="2020-07-29 14:14:27 Matthew Pettis Thanks, makes sense.  My question then is: If I do a test, and in that test, I use a function to compute a value which is to be checked, and I want to pass that value on to the RHS as part of the fact insert, what would that look like?  In the first pseudocode above, I want to pass the output value of (check-function) to be inserted as a field in a record on the RHS..."><a href="#t1596032067260300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-07-29</span> <span class="t" onclick="H(this)">14:14:27</span>          Matthew Pettis </span><span>Thanks, makes sense.  My question then is: If I do a test, and in that test, I use a function to compute a value which is to be checked, and I want to pass that value on to the RHS as part of the fact insert, what would that look like?  In the first pseudocode above, I want to pass the output value of (check-function) to be inserted as a field in a record on the RHS...</span></div><div id="t1596032349262400" t="2020-07-29 14:19:09 Matthew Pettis The one way I thought to get around that was to not check conditions at all in the rules, but always insert a fact with the results of the computation I want to do, and that record has the result.  And then, during a query, I can filter out those new records based on some flag/indicator field of the result.  That seems like I potentially put more facts into the session than are necessary."><a href="#t1596032349262400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-07-29</span> <span class="t" onclick="H(this)">14:19:09</span>          Matthew Pettis </span><span>The one way I thought to get around that was to not check conditions at all in the rules, but always insert a fact with the results of the computation I want to do, and that record has the result.  And then, during a query, I can filter out those new records based on some flag/indicator field of the result.  That seems like I potentially put more facts into the session than are necessary.</span></div><div id="t1596032440264000" t="2020-07-29 14:20:40 Matthew Pettis Another thought I was to follow up what I did above, but then add another rule that prunes facts that don&apos;t have a certain value in an indicator field -- like a cleanup rule.  Then there is no conditional inserts in the LHS or RHS of a rule, but another rule takes care of the conditional inserts by removing things that I would not have originally inserted."><a href="#t1596032440264000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-07-29</span> <span class="t" onclick="H(this)">14:20:40</span>          Matthew Pettis </span><span>Another thought I was to follow up what I did above, but then add another rule that prunes facts that don&apos;t have a certain value in an indicator field -- like a cleanup rule.  Then there is no conditional inserts in the LHS or RHS of a rule, but another rule takes care of the conditional inserts by removing things that I would not have originally inserted.</span></div><div id="t1596032485264800" t="2020-07-29 14:21:25 Matthew Pettis Again, new to this, so I am trying to map the ideas of how I want my conditional domain logic I want to the best practices and discipline of a rules system..."><a href="#t1596032485264800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-07-29</span> <span class="t" onclick="H(this)">14:21:25</span>          Matthew Pettis </span><span>Again, new to this, so I am trying to map the ideas of how I want my conditional domain logic I want to the best practices and discipline of a rules system...</span></div><div id="t1596043132265600" t="2020-07-29 17:18:52 mikerod @matthew.pettis I’d recommend a rule that always inserts facts modeling result values you want like that. You sort of already said this above"><a href="#t1596043132265600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-07-29</span> <span class="t" onclick="H(this)">17:18:52</span>                 mikerod </span><span>@matthew.pettis I’d recommend a rule that always inserts facts modeling result values you want like that. You sort of already said this above</span></div><div id="t1596043154266300" t="2020-07-29 17:19:14 mikerod So the answer is just more rules. More “intermediate facts” representing knowledge of the system"><a href="#t1596043154266300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-07-29</span> <span class="t" onclick="H(this)">17:19:14</span>                 mikerod </span><span>So the answer is just more rules. More “intermediate facts” representing knowledge of the system</span></div><div id="t1596043253266900" t="2020-07-29 17:20:53 mikerod I can’t write up too many useful details at the moment though. So I may not be that useful to you "><a href="#t1596043253266900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-07-29</span> <span class="t" onclick="H(this)">17:20:53</span>                 mikerod </span><span>I can’t write up too many useful details at the moment though. So I may not be that useful to you </span></div><div id="t1596043281267600" t="2020-07-29 17:21:21 mikerod If you make queries more specific. You don’t have to worry as much about adding more intermediate level facts though"><a href="#t1596043281267600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-07-29</span> <span class="t" onclick="H(this)">17:21:21</span>                 mikerod </span><span>If you make queries more specific. You don’t have to worry as much about adding more intermediate level facts though</span></div><div id="t1596043309268500" t="2020-07-29 17:21:49 mikerod And don’t typically need cleanup. Unless you have some memory concern or something. That can be somewhat trickier to retract things in a way that plays well with truth maintenance "><a href="#t1596043309268500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-07-29</span> <span class="t" onclick="H(this)">17:21:49</span>                 mikerod </span><span>And don’t typically need cleanup. Unless you have some memory concern or something. That can be somewhat trickier to retract things in a way that plays well with truth maintenance </span></div><div id="t1596045903270500" t="2020-07-29 18:05:03 Matthew Pettis @mikerod Thanks!  The more I thought about my proposed alternatives, the more it seemed to be in line with the rules philosophy.  I&apos;ll be trying that.  I appreciate the thought of writing something up too.  I think I have enough to go on to code to this philosophy to start with, and I&apos;ll probably have other questions later.  Thanks again!"><a href="#t1596045903270500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-07-29</span> <span class="t" onclick="H(this)">18:05:03</span>          Matthew Pettis </span><span>@mikerod Thanks!  The more I thought about my proposed alternatives, the more it seemed to be in line with the rules philosophy.  I&apos;ll be trying that.  I appreciate the thought of writing something up too.  I think I have enough to go on to code to this philosophy to start with, and I&apos;ll probably have other questions later.  Thanks again!</span></div><div id="t1596055683272200" t="2020-07-29 20:48:03 Matthew Pettis Also, from a thread way-back... I&apos;d like to try clara.tools, I see the repo here:  https://github.com/rbrush/clara-tools  ... what I don&apos;t see is the :dependencies version string to put into my project.clj file... and advice on how to install from this repo?"><a href="#t1596055683272200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-07-29</span> <span class="t" onclick="H(this)">20:48:03</span>          Matthew Pettis </span><span>Also, from a thread way-back... I&apos;d like to try clara.tools, I see the repo here: </span><a href="https://github.com/rbrush/clara-tools" target="_blank">https://github.com/rbrush/clara-tools</a><span> ... what I don&apos;t see is the :dependencies version string to put into my project.clj file... and advice on how to install from this repo?</span></div><div id="t1596126074273200" t="2020-07-30 16:21:14 ethanc based on the only issue:
 https://github.com/rbrush/clara-tools/issues/12 

I have a feeling that clara-tools is not really being supported anymore."><a href="#t1596126074273200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-07-30</span> <span class="t" onclick="H(this)">16:21:14</span>                  ethanc </span><span>based on the only issue:
</span><a href="https://github.com/rbrush/clara-tools/issues/12" target="_blank">https://github.com/rbrush/clara-tools/issues/12</a><span>

I have a feeling that clara-tools is not really being supported anymore.</span></div><div id="t1596727689276000" t="2020-08-06 15:28:09 Brian Abbott Hi, I am having a problem with resolving a defrecord call that resides in a seperate namespace from the rule defininitions. I was wondering if someone might be able to help me out. I have the code I made for a small prototype that repros the issue here:  https://github.com/briancabbott/clara-rules-test"><a href="#t1596727689276000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-08-06</span> <span class="t" onclick="H(this)">15:28:09</span>            Brian Abbott </span><span>Hi, I am having a problem with resolving a defrecord call that resides in a seperate namespace from the rule defininitions. I was wondering if someone might be able to help me out. I have the code I made for a small prototype that repros the issue here: </span><a href="https://github.com/briancabbott/clara-rules-test" target="_blank">https://github.com/briancabbott/clara-rules-test</a></div><div id="t1596728325277200" t="2020-08-06 15:38:45 mikerod @briancabbott in CLJ to refer to a defrecord created type you have to use the java interop :import "><a href="#t1596728325277200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-08-06</span> <span class="t" onclick="H(this)">15:38:45</span>                 mikerod </span><span>@briancabbott in CLJ to refer to a defrecord created type you have to use the java interop :import </span></div><div id="t1596728348277900" t="2020-08-06 15:39:08 mikerod So it’s not represented as a var. so :require + :refer won’t work. "><a href="#t1596728348277900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-08-06</span> <span class="t" onclick="H(this)">15:39:08</span>                 mikerod </span><span>So it’s not represented as a var. so :require + :refer won’t work. </span></div><div id="t1596728380278600" t="2020-08-06 15:39:40 mikerod It’s somewhat unfortunate. In CLJS you actually can refer to them as non-interop style symbols. "><a href="#t1596728380278600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-08-06</span> <span class="t" onclick="H(this)">15:39:40</span>                 mikerod </span><span>It’s somewhat unfortunate. In CLJS you actually can refer to them as non-interop style symbols. </span></div><div id="t1596728469280600" t="2020-08-06 15:41:09 mikerod So something like. :

`(:import [ clara_rules_test.parent_rules_split_ns.rule_records
MyFirstRecordOne
MyFirstRecordTwo])`
"><a href="#t1596728469280600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-08-06</span> <span class="t" onclick="H(this)">15:41:09</span>                 mikerod </span><span>So something like. :

`(:import [ clara_rules_test.parent_rules_split_ns.rule_records
MyFirstRecordOne
MyFirstRecordTwo])`
</span></div><div id="t1596728514282000" t="2020-08-06 15:41:54 mikerod Not also the need for underscores instead of hyphens. Again. That’s the java interop part. Cannot have hyphens in class names on JVM so clj converts them (called “munching”)  to underscores. "><a href="#t1596728514282000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-08-06</span> <span class="t" onclick="H(this)">15:41:54</span>                 mikerod </span><span>Not also the need for underscores instead of hyphens. Again. That’s the java interop part. Cannot have hyphens in class names on JVM so clj converts them (called “munching”)  to underscores. </span></div><div id="t1596730999282600" t="2020-08-06 16:23:19 Brian Abbott BAM!!! HELL YES!  🙂  Thank you my friend --- you are my Savior!"><a href="#t1596730999282600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-08-06</span> <span class="t" onclick="H(this)">16:23:19</span>            Brian Abbott </span><span>BAM!!! HELL YES! </span><b>🙂</b><span> Thank you my friend --- you are my Savior!</span></div><div id="t1596731012282900" t="2020-08-06 16:23:32 Brian Abbott @mikerod"><a href="#t1596731012282900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-08-06</span> <span class="t" onclick="H(this)">16:23:32</span>            Brian Abbott </span><span>@mikerod</span></div><div id="t1596732094283200" t="2020-08-06 16:41:34 mikerod 🙌"><a href="#t1596732094283200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-08-06</span> <span class="t" onclick="H(this)">16:41:34</span>                 mikerod </span><b>🙌</b></div><div id="t1596746670285800" t="2020-08-06 20:44:30 eraserhd It&apos;s been a while... are there any issues with  [:not [:exists ...]] ?  I have a rule that is firing, even though the LHS has  [:exists A] [:not [:exists A]] ."><a href="#t1596746670285800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-08-06</span> <span class="t" onclick="H(this)">20:44:30</span>                eraserhd </span><span>It&apos;s been a while... are there any issues with </span><code>[:not [:exists ...]]</code><span>?  I have a rule that is firing, even though the LHS has </span><code>[:exists A] [:not [:exists A]]</code><span>.</span></div><div id="t1596809272286900" t="2020-08-07 14:07:52 ethanc Thats an interesting scenario, i will have to look into whats going on there"><a href="#t1596809272286900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-08-07</span> <span class="t" onclick="H(this)">14:07:52</span>                       ethanc </span><span>Thats an interesting scenario, i will have to look into whats going on there</span></div><div id="t1596746980286500" t="2020-08-06 20:49:40 eraserhd oh, while that is not correct, it is actually silly to say [:not [:exists A]] instead of [:not A], huh"><a href="#t1596746980286500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-08-06</span> <span class="t" onclick="H(this)">20:49:40</span>                eraserhd </span><span>oh, while that is not correct, it is actually silly to say [:not [:exists A]] instead of [:not A], huh</span></div><div id="t1596810548289100" t="2020-08-07 14:29:08 mikerod @eraserhd yes,  :not  is already “not exist”"><a href="#t1596810548289100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-08-07</span> <span class="t" onclick="H(this)">14:29:08</span>                 mikerod </span><span>@eraserhd yes, </span><code>:not</code><span> is already “not exist”</span></div><div id="t1596810555289300" t="2020-08-07 14:29:15 mikerod I don’t think you can nest these thing either"><a href="#t1596810555289300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-08-07</span> <span class="t" onclick="H(this)">14:29:15</span>                 mikerod </span><span>I don’t think you can nest these thing either</span></div><div id="t1596810561289600" t="2020-08-07 14:29:21 mikerod even though the syntax may not check against it"><a href="#t1596810561289600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-08-07</span> <span class="t" onclick="H(this)">14:29:21</span>                 mikerod </span><span>even though the syntax may not check against it</span></div><div id="t1596810564289800" t="2020-08-07 14:29:24 wparker It is a known issue:  https://github.com/cerner/clara-rules/issues/329  As you say though, while [:not [:exists A]] makes logical sense and IMO would ideally work the problem is easily avoided as you wrote."><a href="#t1596810564289800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-08-07</span> <span class="t" onclick="H(this)">14:29:24</span>                 wparker </span><span>It is a known issue: </span><a href="https://github.com/cerner/clara-rules/issues/329" target="_blank">https://github.com/cerner/clara-rules/issues/329</a><span> As you say though, while [:not [:exists A]] makes logical sense and IMO would ideally work the problem is easily avoided as you wrote.</span></div><div id="t1597096658292000" t="2020-08-10 21:57:38 panda hi, this is a noob question but do people typically keep one clara session running for the app and then constantly insert facts and fire rules? or the session more of a localized thing (i.e. once you get a collection of facts, then apply rules on that collection)?"><a href="#t1597096658292000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-08-10</span> <span class="t" onclick="H(this)">21:57:38</span>                   panda </span><span>hi, this is a noob question but do people typically keep one clara session running for the app and then constantly insert facts and fire rules? or the session more of a localized thing (i.e. once you get a collection of facts, then apply rules on that collection)?</span></div><div id="t1597097120293700" t="2020-08-10 22:05:20 panda on that note — are there any more complex github/project examples than the ones listed  https://github.com/cerner/clara-examples/tree/master/src/main/clojure/clara/examples  ?"><a href="#t1597097120293700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-08-10</span> <span class="t" onclick="H(this)">22:05:20</span>                   panda </span><span>on that note — are there any more complex github/project examples than the ones listed </span><a href="https://github.com/cerner/clara-examples/tree/master/src/main/clojure/clara/examples" target="_blank">https://github.com/cerner/clara-examples/tree/master/src/main/clojure/clara/examples</a><span> ?</span></div><div id="t1597156086294500" t="2020-08-11 14:28:06 defndaines We use one session per request, but that may be specific to our scenario, where each request represented a wholly unique patient."><a href="#t1597156086294500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-08-11</span> <span class="t" onclick="H(this)">14:28:06</span>              defndaines </span><span>We use one session per request, but that may be specific to our scenario, where each request represented a wholly unique patient.</span></div><div id="t1597159797296700" t="2020-08-11 15:29:57 panda @defndaines  thanks! any chance you’ve used the explain activations function in the tooling? i’m curious what the best way is to use that if each session is spun up and down for a request"><a href="#t1597159797296700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-08-11</span> <span class="t" onclick="H(this)">15:29:57</span>                   panda </span><span>@defndaines  thanks! any chance you’ve used the explain activations function in the tooling? i’m curious what the best way is to use that if each session is spun up and down for a request</span></div><div id="t1597162914298200" t="2020-08-11 16:21:54 defndaines We have a hook to turn on  explain-activations , but we rarely use it. We accumulate data in each of our facts that helps with all of our debugging. We also capture all of the input to the sessions, so we can reproduce a session for debugging in order to analyze."><a href="#t1597162914298200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-08-11</span> <span class="t" onclick="H(this)">16:21:54</span>              defndaines </span><span>We have a hook to turn on </span><code>explain-activations</code><span>, but we rarely use it. We accumulate data in each of our facts that helps with all of our debugging. We also capture all of the input to the sessions, so we can reproduce a session for debugging in order to analyze.</span></div><div id="t1597162964298600" t="2020-08-11 16:22:44 panda thank you! that’s super helpful"><a href="#t1597162964298600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-08-11</span> <span class="t" onclick="H(this)">16:22:44</span>                   panda </span><span>thank you! that’s super helpful</span></div><div id="t1597173863298900" t="2020-08-11 19:24:23 mikerod So a session is immutable. "><a href="#t1597173863298900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-08-11</span> <span class="t" onclick="H(this)">19:24:23</span>                 mikerod </span><span>So a session is immutable. </span></div><div id="t1597173889299700" t="2020-08-11 19:24:49 mikerod I would necessarily recommend making a new session when speed is important or it is slower due to many rules"><a href="#t1597173889299700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-08-11</span> <span class="t" onclick="H(this)">19:24:49</span>                 mikerod </span><span>I would necessarily recommend making a new session when speed is important or it is slower due to many rules</span></div><div id="t1597173894299900" t="2020-08-11 19:24:54 mikerod With smaller rule sets maybe ok"><a href="#t1597173894299900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-08-11</span> <span class="t" onclick="H(this)">19:24:54</span>                 mikerod </span><span>With smaller rule sets maybe ok</span></div><div id="t1597174001301800" t="2020-08-11 19:26:41 mikerod But typically, I’d store the initial session made via mk-session and then just do new isolated insert+fire callls on it “per unrelated invocation” "><a href="#t1597174001301800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-08-11</span> <span class="t" onclick="H(this)">19:26:41</span>                 mikerod </span><span>But typically, I’d store the initial session made via mk-session and then just do new isolated insert+fire callls on it “per unrelated invocation” </span></div><div id="t1597174045302200" t="2020-08-11 19:27:25 mikerod This is also assuming the rule set is unchanged per use. "><a href="#t1597174045302200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-08-11</span> <span class="t" onclick="H(this)">19:27:25</span>                 mikerod </span><span>This is also assuming the rule set is unchanged per use. </span></div><div id="t1597175056302600" t="2020-08-11 19:44:16 panda thank you! much appreciated."><a href="#t1597175056302600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-08-11</span> <span class="t" onclick="H(this)">19:44:16</span>                   panda </span><span>thank you! much appreciated.</span></div><div id="t1597245131304100" t="2020-08-12 15:12:11 eraserhd Does Clara do better with  [Object (= n ?n) (odd? n)]  than  [Object (= n ?n)] [:test (odd? n)] ?  (In other words, does it filter before working memory in the previous case?)"><a href="#t1597245131304100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-08-12</span> <span class="t" onclick="H(this)">15:12:11</span>                eraserhd </span><span>Does Clara do better with </span><code>[Object (= n ?n) (odd? n)]</code><span> than </span><code>[Object (= n ?n)] [:test (odd? n)]</code><span>?  (In other words, does it filter before working memory in the previous case?)</span></div><div id="t1597257058307800" t="2020-08-12 18:30:58 ethanc I believe that the first example would compile the  odd?  constraint into the alpha node, where as the second would have test node after the AlphaNode.

I don’t believe that either of these nodes add anything to working memory, following nodes might though."><a href="#t1597257058307800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-08-12</span> <span class="t" onclick="H(this)">18:30:58</span>                  ethanc </span><span>I believe that the first example would compile the </span><code>odd?</code><span> constraint into the alpha node, where as the second would have test node after the AlphaNode.

I don’t believe that either of these nodes add anything to working memory, following nodes might though.</span></div><div id="t1597257256308300" t="2020-08-12 18:34:16 eraserhd Hmm, I omitted that I expect there to be another hash-join field on Object."><a href="#t1597257256308300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-08-12</span> <span class="t" onclick="H(this)">18:34:16</span>                eraserhd </span><span>Hmm, I omitted that I expect there to be another hash-join field on Object.</span></div><div id="t1597260030311600" t="2020-08-12 19:20:30 ethanc with the hashJoin between the alpha and the test, then i would expect moving the  odd?  constraint to the alpha node to likely reduce some of the objects being placed into working memory. How much savings it would produce I cannot say."><a href="#t1597260030311600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-08-12</span> <span class="t" onclick="H(this)">19:20:30</span>                  ethanc </span><span>with the hashJoin between the alpha and the test, then i would expect moving the </span><code>odd?</code><span> constraint to the alpha node to likely reduce some of the objects being placed into working memory. How much savings it would produce I cannot say.</span></div><div id="t1598882050004000" t="2020-08-31 13:54:10 Pieter Slabbert I have sample code that I&apos;m trying to figure out the best way to fix.
 (defrecord ThingA [id data])
(defrecord ThingB [k])

(defrule broken
  [ThingB
   (= ?k k)]
  [ThingA
   (= ?id id)
   (= ?data data)
   (= ?entry (-&gt; data :items (get ?k)))
   (some? ?entry)]
  =&gt;
  (println &quot;entry&quot; ?entry))

(-&gt; (rules/mk-session)
    (rules/insert (-&gt;ThingA 1 {:items {:entry {:a 1 :b 2}}}))
    (rules/insert (-&gt;ThingB :entry))
    (rules/fire-rules)) 
When I run this I get
 Execution error at clara.rules.compiler/try-eval (compiler.clj:233).
Unable to resolve symbol: ?entry in this context 
If I hard code the value of ?k it works, but it when I try get it from another fact I get the error.

What would be the proper way to extract a field from one fact and use it to look something up in another fact"><a href="#t1598882050004000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-08-31</span> <span class="t" onclick="H(this)">13:54:10</span>         Pieter Slabbert </span><span>I have sample code that I&apos;m trying to figure out the best way to fix.
</span><pre>(defrecord ThingA [id data])
(defrecord ThingB [k])

(defrule broken
  [ThingB
   (= ?k k)]
  [ThingA
   (= ?id id)
   (= ?data data)
   (= ?entry (-&gt; data :items (get ?k)))
   (some? ?entry)]
  =&gt;
  (println &quot;entry&quot; ?entry))

(-&gt; (rules/mk-session)
    (rules/insert (-&gt;ThingA 1 {:items {:entry {:a 1 :b 2}}}))
    (rules/insert (-&gt;ThingB :entry))
    (rules/fire-rules))</pre><span>
When I run this I get
</span><pre>Execution error at clara.rules.compiler/try-eval (compiler.clj:233).
Unable to resolve symbol: ?entry in this context</pre><span>
If I hard code the value of ?k it works, but it when I try get it from another fact I get the error.

What would be the proper way to extract a field from one fact and use it to look something up in another fact</span></div><div id="t1598962772004400" t="2020-09-01 12:19:32 mikerod @blob626 it looks like the above should work. "><a href="#t1598962772004400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-09-01</span> <span class="t" onclick="H(this)">12:19:32</span>                 mikerod </span><span>@blob626 it looks like the above should work. </span></div><div id="t1598962796005200" t="2020-09-01 12:19:56 mikerod If the ?k is causing problems I’m surprised. Maybe this needs to be an issue logged. "><a href="#t1598962796005200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-09-01</span> <span class="t" onclick="H(this)">12:19:56</span>                 mikerod </span><span>If the ?k is causing problems I’m surprised. Maybe this needs to be an issue logged. </span></div><div id="t1598962807005600" t="2020-09-01 12:20:07 mikerod I need to experiment with it in a bit to see. "><a href="#t1598962807005600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-09-01</span> <span class="t" onclick="H(this)">12:20:07</span>                 mikerod </span><span>I need to experiment with it in a bit to see. </span></div><div id="t1598971088006000" t="2020-09-01 14:38:08 ethanc @mikerod,
Looks similar to  https://github.com/cerner/clara-rules/issues/426"><a href="#t1598971088006000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-09-01</span> <span class="t" onclick="H(this)">14:38:08</span>                  ethanc </span><span>@mikerod,
Looks similar to </span><a href="https://github.com/cerner/clara-rules/issues/426" target="_blank">https://github.com/cerner/clara-rules/issues/426</a></div><div id="t1598971110006400" t="2020-09-01 14:38:30 ethanc cc. @blob626"><a href="#t1598971110006400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-09-01</span> <span class="t" onclick="H(this)">14:38:30</span>                  ethanc </span><span>cc. @blob626</span></div><div id="t1598977426006700" t="2020-09-01 16:23:46 mikerod @ethanc good find. does look the same"><a href="#t1598977426006700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-09-01</span> <span class="t" onclick="H(this)">16:23:46</span>                 mikerod </span><span>@ethanc good find. does look the same</span></div><div id="t1599031158008300" t="2020-09-02 07:19:18 Pieter Slabbert @ethanc thank you, that looks like the problem.  At the moment I&apos;m resorting to an intermediary  &quot;Getter&quot; fact to get around this, its not pretty, but it works"><a href="#t1599031158008300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-09-02</span> <span class="t" onclick="H(this)">07:19:18</span>         Pieter Slabbert </span><span>@ethanc thank you, that looks like the problem.  At the moment I&apos;m resorting to an intermediary  &quot;Getter&quot; fact to get around this, its not pretty, but it works</span></div><div id="t1599060080009200" t="2020-09-02 15:21:20 ethanc @mikerod @blob626,
I haven’t looked at that issue in a while, but i will see if i can find time to give it another pass/look"><a href="#t1599060080009200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-09-02</span> <span class="t" onclick="H(this)">15:21:20</span>                  ethanc </span><span>@mikerod @blob626,
I haven’t looked at that issue in a while, but i will see if i can find time to give it another pass/look</span></div><div id="t1599486164010500" t="2020-09-07 13:42:44 sparkofreason What would be the most efficient way to get notified when results of a specific query have changed?"><a href="#t1599486164010500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-09-07</span> <span class="t" onclick="H(this)">13:42:44</span>           sparkofreason </span><span>What would be the most efficient way to get notified when results of a specific query have changed?</span></div><div id="t1599812568012100" t="2020-09-11 08:22:48 wparker Clara computes query results upfront; when you call (query session ….) you’re basically just doing map lookups.  https://github.com/cerner/clara-rules/blob/main/src/main/clojure/clara/rules/engine.cljc#L1998  So I don’t think different ways of doing this would have much difference in terms of performance; you’d probably want something that stores the previous state, calls query on the session, and then compares them."><a href="#t1599812568012100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-09-11</span> <span class="t" onclick="H(this)">08:22:48</span>                      wparker </span><span>Clara computes query results upfront; when you call (query session ….) you’re basically just doing map lookups. </span><a href="https://github.com/cerner/clara-rules/blob/main/src/main/clojure/clara/rules/engine.cljc#L1998" target="_blank">https://github.com/cerner/clara-rules/blob/main/src/main/clojure/clara/rules/engine.cljc#L1998</a><span> So I don’t think different ways of doing this would have much difference in terms of performance; you’d probably want something that stores the previous state, calls query on the session, and then compares them.</span></div><div id="t1599865178014400" t="2020-09-11 22:59:38 sparkofreason I was thinking more in terms of getting notified per query only when the results changed. I&apos;ll look at doing it with a listener."><a href="#t1599865178014400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-09-11</span> <span class="t" onclick="H(this)">22:59:38</span>                sparkofreason </span><span>I was thinking more in terms of getting notified per query only when the results changed. I&apos;ll look at doing it with a listener.</span></div><div id="t1599812927013900" t="2020-09-11 08:28:47 wparker Clara-rules version 0.21.0 has been released and is available on Clojars.  This release primarily has improvements to error reporting and inspectability along with a minor bugfix where exceptions could be thrown on certain Java object fact types. Further details at  https://github.com/cerner/clara-rules/blob/main/CHANGELOG.md#0210"><a href="#t1599812927013900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-09-11</span> <span class="t" onclick="H(this)">08:28:47</span>                 wparker </span><span>Clara-rules version 0.21.0 has been released and is available on Clojars.  This release primarily has improvements to error reporting and inspectability along with a minor bugfix where exceptions could be thrown on certain Java object fact types. Further details at </span><a href="https://github.com/cerner/clara-rules/blob/main/CHANGELOG.md#0210" target="_blank">https://github.com/cerner/clara-rules/blob/main/CHANGELOG.md#0210</a></div><div id="t1600310390016900" t="2020-09-17 02:39:50 Matthew Pettis Is there a way to import  defrec  definitions from another namespace to use in a rules session?  I want to modularize my rules, queries, and record definitions into different namespaces, and am having troubles getting the definitons/objects recognized in a rules session.  Below is a the most stripped-down example I could make that I cannot figure out..."><a href="#t1600310390016900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-09-17</span> <span class="t" onclick="H(this)">02:39:50</span>          Matthew Pettis </span><span>Is there a way to import </span><code>defrec</code><span> definitions from another namespace to use in a rules session?  I want to modularize my rules, queries, and record definitions into different namespaces, and am having troubles getting the definitons/objects recognized in a rules session.  Below is a the most stripped-down example I could make that I cannot figure out...</span></div><div id="t1600310398017100" t="2020-09-17 02:39:58 Matthew Pettis user=&gt; (ns a
  #_=&gt;   &quot;Has the record definitions&quot;)
nil
a=&gt; (defrecord MyRec [nm])
a.MyRec


a=&gt; (ns b
#_=&gt;     &quot;Has the logic to run the clara rules session&quot;
#_=&gt;     (:require
#_=&gt;         [clara.rules :as r]
#_=&gt;         [a :as nsa])
#_=&gt;     (:import (a MyRec))
#_=&gt; )
nil


b=&gt; (r/defrule therec
#_=&gt;   &quot;Has a MyRec record&quot;
#_=&gt;   [?r &lt;- nsa/MyRec]
#_=&gt;   =&gt;
#_=&gt;   (r/insert! (nsa/-&gt;MyRec :output)))
#&apos;b/therec


b=&gt; (r/defquery qrec
#_=&gt;   []
#_=&gt;   [?e &lt;- nsa/MyRec])
#&apos;b/qrec


b=&gt; (def sess (r/mk-session))
Syntax error (ClassNotFoundException) compiling at (form-init1616251358278573848.clj:1:11).
MyRec"><a href="#t1600310398017100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-09-17</span> <span class="t" onclick="H(this)">02:39:58</span>          Matthew Pettis </span><pre>user=&gt; (ns a
  #_=&gt;   &quot;Has the record definitions&quot;)
nil
a=&gt; (defrecord MyRec [nm])
a.MyRec


a=&gt; (ns b
#_=&gt;     &quot;Has the logic to run the clara rules session&quot;
#_=&gt;     (:require
#_=&gt;         [clara.rules :as r]
#_=&gt;         [a :as nsa])
#_=&gt;     (:import (a MyRec))
#_=&gt; )
nil


b=&gt; (r/defrule therec
#_=&gt;   &quot;Has a MyRec record&quot;
#_=&gt;   [?r &lt;- nsa/MyRec]
#_=&gt;   =&gt;
#_=&gt;   (r/insert! (nsa/-&gt;MyRec :output)))
#&apos;b/therec


b=&gt; (r/defquery qrec
#_=&gt;   []
#_=&gt;   [?e &lt;- nsa/MyRec])
#&apos;b/qrec


b=&gt; (def sess (r/mk-session))
Syntax error (ClassNotFoundException) compiling at (form-init1616251358278573848.clj:1:11).
MyRec</pre></div><div id="t1600310852018600" t="2020-09-17 02:47:32 ethanc @matthew.pettis, i believe that you would want to remove the alias qualifier from the conditions of the query and the rule.
 nsa/MyRec  would instead be  MyRec"><a href="#t1600310852018600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-09-17</span> <span class="t" onclick="H(this)">02:47:32</span>                  ethanc </span><span>@matthew.pettis, i believe that you would want to remove the alias qualifier from the conditions of the query and the rule.
</span><code>nsa/MyRec</code><span> would instead be </span><code>MyRec</code></div><div id="t1600310987018800" t="2020-09-17 02:49:47 Matthew Pettis user=&gt; (ns a
  #_=&gt;   &quot;Has the record definitions&quot;)
nil
a=&gt; (defrecord MyRec [nm])
a.MyRec


a=&gt; (ns b
#_=&gt;     &quot;Has the logic to run the clara rules session&quot;
#_=&gt;     (:require
#_=&gt;         [clara.rules :as r]
#_=&gt;         [a :as nsa])
#_=&gt;     (:import (a MyRec))
#_=&gt; )
nil


b=&gt; (r/defrule therec
#_=&gt;   &quot;Has a MyRec record&quot;
#_=&gt;   [?r &lt;- MyRec]
#_=&gt;   =&gt;
#_=&gt;   (r/insert! (-&gt;MyRec :output)))
#&apos;b/therec


b=&gt; (r/defquery qrec
#_=&gt;   []
#_=&gt;   [?e &lt;- MyRec])
#&apos;b/qrec


b=&gt; (def sess (r/mk-session))
Syntax error compiling at (form-init2860030196736207126.clj:1:11).
Unable to resolve symbol: -&gt;MyRec in this context"><a href="#t1600310987018800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-09-17</span> <span class="t" onclick="H(this)">02:49:47</span>          Matthew Pettis </span><pre>user=&gt; (ns a
  #_=&gt;   &quot;Has the record definitions&quot;)
nil
a=&gt; (defrecord MyRec [nm])
a.MyRec


a=&gt; (ns b
#_=&gt;     &quot;Has the logic to run the clara rules session&quot;
#_=&gt;     (:require
#_=&gt;         [clara.rules :as r]
#_=&gt;         [a :as nsa])
#_=&gt;     (:import (a MyRec))
#_=&gt; )
nil


b=&gt; (r/defrule therec
#_=&gt;   &quot;Has a MyRec record&quot;
#_=&gt;   [?r &lt;- MyRec]
#_=&gt;   =&gt;
#_=&gt;   (r/insert! (-&gt;MyRec :output)))
#&apos;b/therec


b=&gt; (r/defquery qrec
#_=&gt;   []
#_=&gt;   [?e &lt;- MyRec])
#&apos;b/qrec


b=&gt; (def sess (r/mk-session))
Syntax error compiling at (form-init2860030196736207126.clj:1:11).
Unable to resolve symbol: -&gt;MyRec in this context</pre></div><div id="t1600311048019800" t="2020-09-17 02:50:48 Matthew Pettis Different error message though... I keep trying permutations and am having a hard time tracking what each means..."><a href="#t1600311048019800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-09-17</span> <span class="t" onclick="H(this)">02:50:48</span>          Matthew Pettis </span><span>Different error message though... I keep trying permutations and am having a hard time tracking what each means...</span></div><div id="t1600311103020700" t="2020-09-17 02:51:43 ethanc you would still want to qualify the position based constructor function in the RHS of the rule"><a href="#t1600311103020700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-09-17</span> <span class="t" onclick="H(this)">02:51:43</span>                  ethanc </span><span>you would still want to qualify the position based constructor function in the RHS of the rule</span></div><div id="t1600311289021700" t="2020-09-17 02:54:49 Matthew Pettis ah, right, the difference makes sense.  That fixed the error messages, thanks!  But I&apos;m getting an empty query result, but I expect to find two facts with the query... any advice there?"><a href="#t1600311289021700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-09-17</span> <span class="t" onclick="H(this)">02:54:49</span>          Matthew Pettis </span><span>ah, right, the difference makes sense.  That fixed the error messages, thanks!  But I&apos;m getting an empty query result, but I expect to find two facts with the query... any advice there?</span></div><div id="t1600311293021900" t="2020-09-17 02:54:53 Matthew Pettis b=&gt; (ns a
#_=&gt;   &quot;Has the record definitions&quot;)
nil
a=&gt; (defrecord MyRec [nm])
a.MyRec


a=&gt; (ns b
#_=&gt;     &quot;Has the logic to run the clara rules session&quot;
#_=&gt;     (:require
#_=&gt;         [clara.rules :as r]
#_=&gt;         [a :as nsa])
#_=&gt;     (:import (a MyRec))
#_=&gt; )
nil


b=&gt; (r/defrule therec
#_=&gt;   &quot;Has a MyRec record&quot;
#_=&gt;   [?r &lt;- MyRec]
#_=&gt;   =&gt;
#_=&gt;   (r/insert! (nsa/-&gt;MyRec :output)))
#&apos;b/therec


b=&gt; (r/defquery qrec
#_=&gt;   []
#_=&gt;   [?e &lt;- MyRec])
#&apos;b/qrec


b=&gt; (def sess (r/mk-session))
#&apos;b/sess


b=&gt; (let [qsess (-&gt; sess
#_=&gt;                (r/insert-all (nsa/-&gt;MyRec :init))
#_=&gt;                r/fire-rules
#_=&gt;                (r/query qrec))]
#_=&gt;   qsess)
()"><a href="#t1600311293021900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-09-17</span> <span class="t" onclick="H(this)">02:54:53</span>          Matthew Pettis </span><pre>b=&gt; (ns a
#_=&gt;   &quot;Has the record definitions&quot;)
nil
a=&gt; (defrecord MyRec [nm])
a.MyRec


a=&gt; (ns b
#_=&gt;     &quot;Has the logic to run the clara rules session&quot;
#_=&gt;     (:require
#_=&gt;         [clara.rules :as r]
#_=&gt;         [a :as nsa])
#_=&gt;     (:import (a MyRec))
#_=&gt; )
nil


b=&gt; (r/defrule therec
#_=&gt;   &quot;Has a MyRec record&quot;
#_=&gt;   [?r &lt;- MyRec]
#_=&gt;   =&gt;
#_=&gt;   (r/insert! (nsa/-&gt;MyRec :output)))
#&apos;b/therec


b=&gt; (r/defquery qrec
#_=&gt;   []
#_=&gt;   [?e &lt;- MyRec])
#&apos;b/qrec


b=&gt; (def sess (r/mk-session))
#&apos;b/sess


b=&gt; (let [qsess (-&gt; sess
#_=&gt;                (r/insert-all (nsa/-&gt;MyRec :init))
#_=&gt;                r/fire-rules
#_=&gt;                (r/query qrec))]
#_=&gt;   qsess)
()</pre></div><div id="t1600311514023100" t="2020-09-17 02:58:34 Matthew Pettis (But I see that that is not related to my namespace issue... I&apos;m doing something wrong with just basic rules, I think...)"><a href="#t1600311514023100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-09-17</span> <span class="t" onclick="H(this)">02:58:34</span>          Matthew Pettis </span><span>(But I see that that is not related to my namespace issue... I&apos;m doing something wrong with just basic rules, I think...)</span></div><div id="t1600311524023400" t="2020-09-17 02:58:44 ethanc insert-all  in this case is assuming that you passed a list and is probably breaking the record down into a list of keyvalue pairs"><a href="#t1600311524023400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-09-17</span> <span class="t" onclick="H(this)">02:58:44</span>                  ethanc </span><code>insert-all</code><span> in this case is assuming that you passed a list and is probably breaking the record down into a list of keyvalue pairs</span></div><div id="t1600311545023600" t="2020-09-17 02:59:05 ethanc (r/insert-all [(nsa/-&gt;MyRec :init)])"><a href="#t1600311545023600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-09-17</span> <span class="t" onclick="H(this)">02:59:05</span>                  ethanc </span><code>(r/insert-all [(nsa/-&gt;MyRec :init)])</code></div><div id="t1600311590024600" t="2020-09-17 02:59:50 ethanc however this will cause an infinite loop do to  therec  inserting a fact that then triggers itself"><a href="#t1600311590024600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-09-17</span> <span class="t" onclick="H(this)">02:59:50</span>                  ethanc </span><span>however this will cause an infinite loop do to </span><code>therec</code><span> inserting a fact that then triggers itself</span></div><div id="t1600311596024900" t="2020-09-17 02:59:56 ethanc *due"><a href="#t1600311596024900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-09-17</span> <span class="t" onclick="H(this)">02:59:56</span>                  ethanc </span><span>*due</span></div><div id="t1600311608025200" t="2020-09-17 03:00:08 Matthew Pettis ach, yeah, i copied that over from a place where I was inserting a list, thanks for the catch!"><a href="#t1600311608025200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-09-17</span> <span class="t" onclick="H(this)">03:00:08</span>          Matthew Pettis </span><span>ach, yeah, i copied that over from a place where I was inserting a list, thanks for the catch!</span></div><div id="t1600312121025800" t="2020-09-17 03:08:41 Matthew Pettis For posterity, here is a working example where I&apos;m importing the  defrec  from another namespace... And thank you @ethanc for the great help!"><a href="#t1600312121025800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-09-17</span> <span class="t" onclick="H(this)">03:08:41</span>          Matthew Pettis </span><span>For posterity, here is a working example where I&apos;m importing the </span><code>defrec</code><span> from another namespace... And thank you @ethanc for the great help!</span></div><div id="t1600312126026000" t="2020-09-17 03:08:46 Matthew Pettis user=&gt; (ns a
  #_=&gt;   &quot;Has the record definitions&quot;)
nil
a=&gt; (defrecord MyRec [nm])
a.MyRec


a=&gt; (ns b
#_=&gt;     &quot;Has the logic to run the clara rules session&quot;
#_=&gt;     (:require
#_=&gt;         [clara.rules :as r]
#_=&gt;         [a :as nsa])
#_=&gt;     (:import (a MyRec))
#_=&gt; )
nil


b=&gt; (r/defrule therec
#_=&gt;   &quot;Has a MyRec record&quot;
#_=&gt;   [?r &lt;- MyRec (= :nm :init)]
#_=&gt;   =&gt;
#_=&gt;   (r/insert! (nsa/-&gt;MyRec :output)))
#&apos;b/therec


b=&gt; (r/defquery qrec
#_=&gt;   []
#_=&gt;   [?e &lt;- MyRec])
#&apos;b/qrec


b=&gt; (def sess (r/mk-session))
#&apos;b/sess


b=&gt; (let [qsess (-&gt; sess
#_=&gt;                (r/insert-all [(nsa/-&gt;MyRec :init)])
#_=&gt;                r/fire-rules
#_=&gt;                (r/query qrec))]
#_=&gt;   qsess)
({:?e #a.MyRec{:nm :init}})"><a href="#t1600312126026000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-09-17</span> <span class="t" onclick="H(this)">03:08:46</span>          Matthew Pettis </span><pre>user=&gt; (ns a
  #_=&gt;   &quot;Has the record definitions&quot;)
nil
a=&gt; (defrecord MyRec [nm])
a.MyRec


a=&gt; (ns b
#_=&gt;     &quot;Has the logic to run the clara rules session&quot;
#_=&gt;     (:require
#_=&gt;         [clara.rules :as r]
#_=&gt;         [a :as nsa])
#_=&gt;     (:import (a MyRec))
#_=&gt; )
nil


b=&gt; (r/defrule therec
#_=&gt;   &quot;Has a MyRec record&quot;
#_=&gt;   [?r &lt;- MyRec (= :nm :init)]
#_=&gt;   =&gt;
#_=&gt;   (r/insert! (nsa/-&gt;MyRec :output)))
#&apos;b/therec


b=&gt; (r/defquery qrec
#_=&gt;   []
#_=&gt;   [?e &lt;- MyRec])
#&apos;b/qrec


b=&gt; (def sess (r/mk-session))
#&apos;b/sess


b=&gt; (let [qsess (-&gt; sess
#_=&gt;                (r/insert-all [(nsa/-&gt;MyRec :init)])
#_=&gt;                r/fire-rules
#_=&gt;                (r/query qrec))]
#_=&gt;   qsess)
({:?e #a.MyRec{:nm :init}})</pre></div><div id="t1600313093028400" t="2020-09-17 03:24:53 Matthew Pettis Ok, so I tried splitting defrec, rules, and queries up into their own namespace, and run a session in a namespace separate from those three.  With the help above, I was able to not get errors.  But in the final query, I expect to see a single  Outp  record, but the query gives me  () .  It should be a simple step from what I did above, but I&apos;m not seeing where I went wrong...

UPDATE: Below, my rules LHS tried to match the record field as a symbol, not as a symbol.  Fixing below, see update further down."><a href="#t1600313093028400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-09-17</span> <span class="t" onclick="H(this)">03:24:53</span>          Matthew Pettis </span><span>Ok, so I tried splitting defrec, rules, and queries up into their own namespace, and run a session in a namespace separate from those three.  With the help above, I was able to not get errors.  But in the final query, I expect to see a single </span><code>Outp</code><span> record, but the query gives me </span><code>()</code><span>.  It should be a simple step from what I did above, but I&apos;m not seeing where I went wrong...

UPDATE: Below, my rules LHS tried to match the record field as a symbol, not as a symbol.  Fixing below, see update further down.</span></div><div id="t1600313098028600" t="2020-09-17 03:24:58 Matthew Pettis rules-engine.core=&gt; (ns rules-engine.rec-defs
               #_=&gt;   &quot;Records to use in rules&quot;)
nil

rules-engine.rec-defs=&gt; (defrecord Inp [nm])
rules_engine.rec_defs.Inp
rules-engine.rec-defs=&gt; (defrecord Outp [nm])
rules_engine.rec_defs.Outp



rules-engine.rec-defs=&gt; (ns rules-engine.rules
                   #_=&gt;   &quot;Rules to import&quot;
                   #_=&gt;   (:require [clara.rules :as r]
                   #_=&gt;             [rules-engine.rec-defs :as rd])
                   #_=&gt;   (:import (rules_engine.rec_defs Inp Outp))
                   #_=&gt;   )
nil


rules-engine.rules=&gt; (r/defrule has-inp
                #_=&gt;   &quot;Has a Inp record&quot;
                #_=&gt;   [?r &lt;- Inp (= :nm :init)]
                #_=&gt;   =&gt;
                #_=&gt;   (r/insert! (rd/-&gt;Outp :output)))
#&apos;rules-engine.rules/has-inp



rules-engine.rules=&gt; (ns rules-engine.queries
                #_=&gt;   &quot;Queries&quot;
                #_=&gt;   (:require [clara.rules :as r]
                #_=&gt;             [rules-engine.rec-defs :as rd])
                #_=&gt;   (:import (rules_engine.rec_defs Inp Outp)))
nil

rules-engine.queries=&gt; (r/defquery all-outp
                  #_=&gt;   []
                  #_=&gt;   [?e &lt;- Outp])
#&apos;rules-engine.queries/all-outp



rules-engine.queries=&gt; (ns rules-engine.run-it
                  #_=&gt;   &quot;Main script to run a rules set&quot;
                  #_=&gt;   (:require [clara.rules :as r]
                  #_=&gt;             [rules-engine.rec-defs :as rd]
                  #_=&gt;             [rules-engine.rules :as rl]
                  #_=&gt;             [rules-engine.queries :as q]
                  #_=&gt;             )
                  #_=&gt;   (:import (rules_engine.rec_defs Inp Outp))
                  #_=&gt;   )
nil


rules-engine.run-it=&gt; (def sess (r/mk-session &apos;rules-engine.rules &apos;rules-engine.queries))
#&apos;rules-engine.run-it/sess

rules-engine.run-it=&gt; (let [qsess (-&gt; sess
                 #_=&gt;                (r/insert-all [(rd/-&gt;Inp :init)])
                 #_=&gt;                r/fire-rules
                 #_=&gt;                (r/query q/all-outp))]
                 #_=&gt;   qsess)
()"><a href="#t1600313098028600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-09-17</span> <span class="t" onclick="H(this)">03:24:58</span>          Matthew Pettis </span><pre>rules-engine.core=&gt; (ns rules-engine.rec-defs
               #_=&gt;   &quot;Records to use in rules&quot;)
nil

rules-engine.rec-defs=&gt; (defrecord Inp [nm])
rules_engine.rec_defs.Inp
rules-engine.rec-defs=&gt; (defrecord Outp [nm])
rules_engine.rec_defs.Outp



rules-engine.rec-defs=&gt; (ns rules-engine.rules
                   #_=&gt;   &quot;Rules to import&quot;
                   #_=&gt;   (:require [clara.rules :as r]
                   #_=&gt;             [rules-engine.rec-defs :as rd])
                   #_=&gt;   (:import (rules_engine.rec_defs Inp Outp))
                   #_=&gt;   )
nil


rules-engine.rules=&gt; (r/defrule has-inp
                #_=&gt;   &quot;Has a Inp record&quot;
                #_=&gt;   [?r &lt;- Inp (= :nm :init)]
                #_=&gt;   =&gt;
                #_=&gt;   (r/insert! (rd/-&gt;Outp :output)))
#&apos;rules-engine.rules/has-inp



rules-engine.rules=&gt; (ns rules-engine.queries
                #_=&gt;   &quot;Queries&quot;
                #_=&gt;   (:require [clara.rules :as r]
                #_=&gt;             [rules-engine.rec-defs :as rd])
                #_=&gt;   (:import (rules_engine.rec_defs Inp Outp)))
nil

rules-engine.queries=&gt; (r/defquery all-outp
                  #_=&gt;   []
                  #_=&gt;   [?e &lt;- Outp])
#&apos;rules-engine.queries/all-outp



rules-engine.queries=&gt; (ns rules-engine.run-it
                  #_=&gt;   &quot;Main script to run a rules set&quot;
                  #_=&gt;   (:require [clara.rules :as r]
                  #_=&gt;             [rules-engine.rec-defs :as rd]
                  #_=&gt;             [rules-engine.rules :as rl]
                  #_=&gt;             [rules-engine.queries :as q]
                  #_=&gt;             )
                  #_=&gt;   (:import (rules_engine.rec_defs Inp Outp))
                  #_=&gt;   )
nil


rules-engine.run-it=&gt; (def sess (r/mk-session &apos;rules-engine.rules &apos;rules-engine.queries))
#&apos;rules-engine.run-it/sess

rules-engine.run-it=&gt; (let [qsess (-&gt; sess
                 #_=&gt;                (r/insert-all [(rd/-&gt;Inp :init)])
                 #_=&gt;                r/fire-rules
                 #_=&gt;                (r/query q/all-outp))]
                 #_=&gt;   qsess)
()</pre></div><div id="t1600314197029300" t="2020-09-17 03:43:17 Matthew Pettis Well, I know it is my logic, not the namespace stuff... this version works, I&apos;ll work on the one above..."><a href="#t1600314197029300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-09-17</span> <span class="t" onclick="H(this)">03:43:17</span>          Matthew Pettis </span><span>Well, I know it is my logic, not the namespace stuff... this version works, I&apos;ll work on the one above...</span></div><div id="t1600314202029500" t="2020-09-17 03:43:22 Matthew Pettis rules-engine.run-it=&gt; (ns rules-engine.rec-defs
                 #_=&gt;   &quot;Records to use in rules&quot;)
nil
rules-engine.rec-defs=&gt;

rules-engine.rec-defs=&gt; (defrecord Myrec [nm])
rules_engine.rec_defs.Myrec



rules-engine.rec-defs=&gt; (ns rules-engine.rules
                   #_=&gt;   &quot;Rules to import&quot;
                   #_=&gt;   (:require [clara.rules :as r]
                   #_=&gt;             [rules-engine.rec-defs :as rd])
                   #_=&gt;   (:import (rules_engine.rec_defs Myrec)))
nil

rules-engine.rules=&gt; (r/defrule has-inp
                #_=&gt;   &quot;Has a Inp record&quot;
                #_=&gt;   [?r &lt;- Myrec (= :nm :init)]
                #_=&gt;   =&gt;
                #_=&gt;   (r/insert! (rd/-&gt;Myrec :output)))
#&apos;rules-engine.rules/has-inp



rules-engine.rules=&gt; (ns rules-engine.queries
                #_=&gt;   &quot;Queries&quot;
                #_=&gt;   (:require [clara.rules :as r]
                #_=&gt;             [rules-engine.rec-defs :as rd])
                #_=&gt;   (:import (rules_engine.rec_defs Myrec)))
nil

rules-engine.queries=&gt; (r/defquery all-outp
                  #_=&gt;   []
                  #_=&gt;   [?e &lt;- Myrec])
#&apos;rules-engine.queries/all-outp

rules-engine.queries=&gt; (ns rules-engine.run-it
                  #_=&gt;   &quot;Main script to run a rules set&quot;
                  #_=&gt;   (:require [clara.rules :as r]
                  #_=&gt;             [rules-engine.rec-defs :as rd]
                  #_=&gt;             [rules-engine.rules :as rl]
                  #_=&gt;             [rules-engine.queries :as q]
                  #_=&gt;             )
                  #_=&gt;   (:import (rules_engine.rec_defs Myrec)))
nil

rules-engine.run-it=&gt; (def sess (r/mk-session &apos;rules-engine.rules &apos;rules-engine.queries))
#&apos;rules-engine.run-it/sess

rules-engine.run-it=&gt; (let [qsess (-&gt; sess
                 #_=&gt;                (r/insert-all [(rd/-&gt;Myrec :init)])
                 #_=&gt;                r/fire-rules
                 #_=&gt;                (r/query q/all-outp))]
                 #_=&gt;   qsess)
({:?e #rules_engine.rec_defs.Myrec{:nm :init}})"><a href="#t1600314202029500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-09-17</span> <span class="t" onclick="H(this)">03:43:22</span>          Matthew Pettis </span><pre>rules-engine.run-it=&gt; (ns rules-engine.rec-defs
                 #_=&gt;   &quot;Records to use in rules&quot;)
nil
rules-engine.rec-defs=&gt;

rules-engine.rec-defs=&gt; (defrecord Myrec [nm])
rules_engine.rec_defs.Myrec



rules-engine.rec-defs=&gt; (ns rules-engine.rules
                   #_=&gt;   &quot;Rules to import&quot;
                   #_=&gt;   (:require [clara.rules :as r]
                   #_=&gt;             [rules-engine.rec-defs :as rd])
                   #_=&gt;   (:import (rules_engine.rec_defs Myrec)))
nil

rules-engine.rules=&gt; (r/defrule has-inp
                #_=&gt;   &quot;Has a Inp record&quot;
                #_=&gt;   [?r &lt;- Myrec (= :nm :init)]
                #_=&gt;   =&gt;
                #_=&gt;   (r/insert! (rd/-&gt;Myrec :output)))
#&apos;rules-engine.rules/has-inp



rules-engine.rules=&gt; (ns rules-engine.queries
                #_=&gt;   &quot;Queries&quot;
                #_=&gt;   (:require [clara.rules :as r]
                #_=&gt;             [rules-engine.rec-defs :as rd])
                #_=&gt;   (:import (rules_engine.rec_defs Myrec)))
nil

rules-engine.queries=&gt; (r/defquery all-outp
                  #_=&gt;   []
                  #_=&gt;   [?e &lt;- Myrec])
#&apos;rules-engine.queries/all-outp

rules-engine.queries=&gt; (ns rules-engine.run-it
                  #_=&gt;   &quot;Main script to run a rules set&quot;
                  #_=&gt;   (:require [clara.rules :as r]
                  #_=&gt;             [rules-engine.rec-defs :as rd]
                  #_=&gt;             [rules-engine.rules :as rl]
                  #_=&gt;             [rules-engine.queries :as q]
                  #_=&gt;             )
                  #_=&gt;   (:import (rules_engine.rec_defs Myrec)))
nil

rules-engine.run-it=&gt; (def sess (r/mk-session &apos;rules-engine.rules &apos;rules-engine.queries))
#&apos;rules-engine.run-it/sess

rules-engine.run-it=&gt; (let [qsess (-&gt; sess
                 #_=&gt;                (r/insert-all [(rd/-&gt;Myrec :init)])
                 #_=&gt;                r/fire-rules
                 #_=&gt;                (r/query q/all-outp))]
                 #_=&gt;   qsess)
({:?e #rules_engine.rec_defs.Myrec{:nm :init}})</pre></div><div id="t1600314971029900" t="2020-09-17 03:56:11 Matthew Pettis Fixed session from above:"><a href="#t1600314971029900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-09-17</span> <span class="t" onclick="H(this)">03:56:11</span>          Matthew Pettis </span><span>Fixed session from above:</span></div><div id="t1600314976030100" t="2020-09-17 03:56:16 Matthew Pettis rules-engine.run-it=&gt; (ns rules-engine.rec-defs
                 #_=&gt;   &quot;Records to use in rules&quot;)
nil

rules-engine.rec-defs=&gt; (defrecord Inp [nm])
rules_engine.rec_defs.Inp
rules-engine.rec-defs=&gt; (defrecord Outp [nm])
rules_engine.rec_defs.Outp
rules-engine.rec-defs=&gt;



rules-engine.rec-defs=&gt; (ns rules-engine.rules
                   #_=&gt;   &quot;Rules to import&quot;
                   #_=&gt;   (:require [clara.rules :as r]
                   #_=&gt;             [rules-engine.rec-defs :as rd])
                   #_=&gt;   (:import (rules_engine.rec_defs Inp Outp))
                   #_=&gt;   )
nil

rules-engine.rules=&gt; (r/defrule has-inp
                #_=&gt;   &quot;Has a Inp record&quot;
                #_=&gt;   [?r &lt;- Inp (= nm :init)]
                #_=&gt;   =&gt;
                #_=&gt;   (r/insert! (rd/-&gt;Outp :output)))
#&apos;rules-engine.rules/has-inp



rules-engine.rules=&gt; (ns rules-engine.queries
                #_=&gt;   &quot;Queries&quot;
                #_=&gt;   (:require [clara.rules :as r]
                #_=&gt;             [rules-engine.rec-defs :as rd])
                #_=&gt;   (:import (rules_engine.rec_defs Inp Outp)))
nil

rules-engine.queries=&gt; (r/defquery all-outp
                  #_=&gt;   []
                  #_=&gt;   [?e &lt;- Outp])
#&apos;rules-engine.queries/all-outp

rules-engine.queries=&gt; (r/defquery all-inp
                  #_=&gt;   []
                  #_=&gt;   [?e &lt;- Inp])
#&apos;rules-engine.queries/all-inp



rules-engine.queries=&gt; (ns rules-engine.run-it
                  #_=&gt;   &quot;Main script to run a rules set&quot;
                  #_=&gt;   (:require [clara.rules :as r]
                  #_=&gt;             [rules-engine.rec-defs :as rd]
                  #_=&gt;             [rules-engine.rules :as rl]
                  #_=&gt;             [rules-engine.queries :as q]
                  #_=&gt;             )
                  #_=&gt;   (:import (rules_engine.rec_defs Inp Outp)))
nil

rules-engine.run-it=&gt; (def sess (r/mk-session &apos;rules-engine.rules &apos;rules-engine.queries))
#&apos;rules-engine.run-it/sess

rules-engine.run-it=&gt; (let [qsess (-&gt; sess
                 #_=&gt;                (r/insert-all [(rd/-&gt;Inp :init)])
                 #_=&gt;                r/fire-rules
                 #_=&gt;                (r/query q/all-outp))]
                 #_=&gt;   qsess)
({:?e #rules_engine.rec_defs.Outp{:nm :output}})"><a href="#t1600314976030100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-09-17</span> <span class="t" onclick="H(this)">03:56:16</span>          Matthew Pettis </span><pre>rules-engine.run-it=&gt; (ns rules-engine.rec-defs
                 #_=&gt;   &quot;Records to use in rules&quot;)
nil

rules-engine.rec-defs=&gt; (defrecord Inp [nm])
rules_engine.rec_defs.Inp
rules-engine.rec-defs=&gt; (defrecord Outp [nm])
rules_engine.rec_defs.Outp
rules-engine.rec-defs=&gt;



rules-engine.rec-defs=&gt; (ns rules-engine.rules
                   #_=&gt;   &quot;Rules to import&quot;
                   #_=&gt;   (:require [clara.rules :as r]
                   #_=&gt;             [rules-engine.rec-defs :as rd])
                   #_=&gt;   (:import (rules_engine.rec_defs Inp Outp))
                   #_=&gt;   )
nil

rules-engine.rules=&gt; (r/defrule has-inp
                #_=&gt;   &quot;Has a Inp record&quot;
                #_=&gt;   [?r &lt;- Inp (= nm :init)]
                #_=&gt;   =&gt;
                #_=&gt;   (r/insert! (rd/-&gt;Outp :output)))
#&apos;rules-engine.rules/has-inp



rules-engine.rules=&gt; (ns rules-engine.queries
                #_=&gt;   &quot;Queries&quot;
                #_=&gt;   (:require [clara.rules :as r]
                #_=&gt;             [rules-engine.rec-defs :as rd])
                #_=&gt;   (:import (rules_engine.rec_defs Inp Outp)))
nil

rules-engine.queries=&gt; (r/defquery all-outp
                  #_=&gt;   []
                  #_=&gt;   [?e &lt;- Outp])
#&apos;rules-engine.queries/all-outp

rules-engine.queries=&gt; (r/defquery all-inp
                  #_=&gt;   []
                  #_=&gt;   [?e &lt;- Inp])
#&apos;rules-engine.queries/all-inp



rules-engine.queries=&gt; (ns rules-engine.run-it
                  #_=&gt;   &quot;Main script to run a rules set&quot;
                  #_=&gt;   (:require [clara.rules :as r]
                  #_=&gt;             [rules-engine.rec-defs :as rd]
                  #_=&gt;             [rules-engine.rules :as rl]
                  #_=&gt;             [rules-engine.queries :as q]
                  #_=&gt;             )
                  #_=&gt;   (:import (rules_engine.rec_defs Inp Outp)))
nil

rules-engine.run-it=&gt; (def sess (r/mk-session &apos;rules-engine.rules &apos;rules-engine.queries))
#&apos;rules-engine.run-it/sess

rules-engine.run-it=&gt; (let [qsess (-&gt; sess
                 #_=&gt;                (r/insert-all [(rd/-&gt;Inp :init)])
                 #_=&gt;                r/fire-rules
                 #_=&gt;                (r/query q/all-outp))]
                 #_=&gt;   qsess)
({:?e #rules_engine.rec_defs.Outp{:nm :output}})</pre></div><div id="t1600364288030600" t="2020-09-17 17:38:08 mikerod @matthew.pettis it’s just clj rules here for how you refer to record types"><a href="#t1600364288030600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-09-17</span> <span class="t" onclick="H(this)">17:38:08</span>                 mikerod </span><span>@matthew.pettis it’s just clj rules here for how you refer to record types</span></div><div id="t1600364304031100" t="2020-09-17 17:38:24 mikerod in cljs you use ns’s and aliases like your stuff above"><a href="#t1600364304031100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-09-17</span> <span class="t" onclick="H(this)">17:38:24</span>                 mikerod </span><span>in cljs you use ns’s and aliases like your stuff above</span></div><div id="t1600364311031400" t="2020-09-17 17:38:31 mikerod in clj (unfortunately), you have to use interop"><a href="#t1600364311031400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-09-17</span> <span class="t" onclick="H(this)">17:38:31</span>                 mikerod </span><span>in clj (unfortunately), you have to use interop</span></div><div id="t1600364342032100" t="2020-09-17 17:39:02 mikerod so the actual  :import  class symbols"><a href="#t1600364342032100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-09-17</span> <span class="t" onclick="H(this)">17:39:02</span>                 mikerod </span><span>so the actual </span><code>:import</code><span> class symbols</span></div><div id="t1600364346032300" t="2020-09-17 17:39:06 mikerod nothing from a  :require  +  :as  etc"><a href="#t1600364346032300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-09-17</span> <span class="t" onclick="H(this)">17:39:06</span>                 mikerod </span><span>nothing from a </span><code>:require</code><span> + </span><code>:as</code><span> etc</span></div><div id="t1600364512034700" t="2020-09-17 17:41:52 Matthew Pettis @mikerod Thanks.  Yep, I hit this problem once before (I think I posted it here too)... The way I am currently thinking about it is: for rules that do matching on the LHS, I need to import the classes with  :import .  When I want to construct a record I need to insert on the RHS, with  -&gt;Myrecord , I need to require the namespace from which I have my  defrecord  declaration so I have that constructor.  Does that seem right?"><a href="#t1600364512034700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-09-17</span> <span class="t" onclick="H(this)">17:41:52</span>          Matthew Pettis </span><span>@mikerod Thanks.  Yep, I hit this problem once before (I think I posted it here too)... The way I am currently thinking about it is: for rules that do matching on the LHS, I need to import the classes with </span><code>:import</code><span>.  When I want to construct a record I need to insert on the RHS, with </span><code>-&gt;Myrecord</code><span>, I need to require the namespace from which I have my </span><code>defrecord</code><span> declaration so I have that constructor.  Does that seem right?</span></div><div id="t1600365149035200" t="2020-09-17 17:52:29 mikerod @matthew.pettis I do not like it. I think when writing non-interop clj, things like  :import  should not be necessary at all"><a href="#t1600365149035200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-09-17</span> <span class="t" onclick="H(this)">17:52:29</span>                 mikerod </span><span>@matthew.pettis I do not like it. I think when writing non-interop clj, things like </span><code>:import</code><span> should not be necessary at all</span></div><div id="t1600365161035700" t="2020-09-17 17:52:41 mikerod I don’t like that Clara basically enforces this needing to be done for records"><a href="#t1600365161035700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-09-17</span> <span class="t" onclick="H(this)">17:52:41</span>                 mikerod </span><span>I don’t like that Clara basically enforces this needing to be done for records</span></div><div id="t1600365182036200" t="2020-09-17 17:53:02 mikerod Clj does offer some “factory functions” it auto-creates with  defrecord  - which allows you to not have to use interop forms to create records"><a href="#t1600365182036200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-09-17</span> <span class="t" onclick="H(this)">17:53:02</span>                 mikerod </span><span>Clj does offer some “factory functions” it auto-creates with </span><code>defrecord</code><span> - which allows you to not have to use interop forms to create records</span></div><div id="t1600365200036700" t="2020-09-17 17:53:20 mikerod What clj does not offer, is how to refer to records in a way without interop (eg.  :import )"><a href="#t1600365200036700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-09-17</span> <span class="t" onclick="H(this)">17:53:20</span>                 mikerod </span><span>What clj does not offer, is how to refer to records in a way without interop (eg. </span><code>:import</code><span>)</span></div><div id="t1600365214037100" t="2020-09-17 17:53:34 mikerod More frustrating to me, is CLJS does allow you to refer to record types via  :require  +  :as"><a href="#t1600365214037100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-09-17</span> <span class="t" onclick="H(this)">17:53:34</span>                 mikerod </span><span>More frustrating to me, is CLJS does allow you to refer to record types via </span><code>:require</code><span> + </span><code>:as</code></div><div id="t1600365245037800" t="2020-09-17 17:54:05 mikerod so this causes lots of additional problems with say , making cljc files where you want to use  :as  aliases, but then records need to be specified different ways for  :clj  vs   :cljs"><a href="#t1600365245037800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-09-17</span> <span class="t" onclick="H(this)">17:54:05</span>                 mikerod </span><span>so this causes lots of additional problems with say , making cljc files where you want to use </span><code>:as</code><span> aliases, but then records need to be specified different ways for </span><code>:clj</code><span> vs  </span><code>:cljs</code></div><div id="t1600365293038600" t="2020-09-17 17:54:53 mikerod so that’s some background. I don’t know what exactly Clara should/could do here to help. However, Clara’s compilation has control over symbol resolution so it’s likely something could be done to allow for no  :import  to be needed"><a href="#t1600365293038600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-09-17</span> <span class="t" onclick="H(this)">17:54:53</span>                 mikerod </span><span>so that’s some background. I don’t know what exactly Clara should/could do here to help. However, Clara’s compilation has control over symbol resolution so it’s likely something could be done to allow for no </span><code>:import</code><span> to be needed</span></div><div id="t1600365314039000" t="2020-09-17 17:55:14 mikerod I think probably, Clara could attempt to support the cljs style record syntax"><a href="#t1600365314039000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-09-17</span> <span class="t" onclick="H(this)">17:55:14</span>                 mikerod </span><span>I think probably, Clara could attempt to support the cljs style record syntax</span></div><div id="t1600365323039400" t="2020-09-17 17:55:23 mikerod like  a/MyRec"><a href="#t1600365323039400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-09-17</span> <span class="t" onclick="H(this)">17:55:23</span>                 mikerod </span><span>like </span><code>a/MyRec</code></div><div id="t1600365352040200" t="2020-09-17 17:55:52 mikerod and just implicitly know to resolve it in clj following some rules like:
1) first see if  a/MyRec  exists
2) if not, try  a.MyRec1"><a href="#t1600365352040200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-09-17</span> <span class="t" onclick="H(this)">17:55:52</span>                 mikerod </span><span>and just implicitly know to resolve it in clj following some rules like:
1) first see if </span><code>a/MyRec</code><span> exists
2) if not, try </span><code>a.MyRec1</code></div><div id="t1600365400041300" t="2020-09-17 17:56:40 mikerod this could be convenient for Clara’s perspective. it would deviate from the perspective of what clj actually allows"><a href="#t1600365400041300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-09-17</span> <span class="t" onclick="H(this)">17:56:40</span>                 mikerod </span><span>this could be convenient for Clara’s perspective. it would deviate from the perspective of what clj actually allows</span></div><div id="t1600365404041500" t="2020-09-17 17:56:44 mikerod so there’s a pro vs con"><a href="#t1600365404041500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-09-17</span> <span class="t" onclick="H(this)">17:56:44</span>                 mikerod </span><span>so there’s a pro vs con</span></div><div id="t1600365794045500" t="2020-09-17 18:03:14 Matthew Pettis That would be nice to not have the interop require vs. import split, as it seems a typical rules pattern is to have record class referenced in the LHS, and needs to construct and insert a record on the RHS, which needs the constructor via require.  It took me a while to suss out the difference, and a post by Alex Miller (which I can&apos;t find today) helped me understand it a bit more.  I considered going down to the plain maps workflow and not using records, which would take care of this issue, and I assume people who don&apos;t use records make code that should mostly run in either CLJ or CLJS."><a href="#t1600365794045500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-09-17</span> <span class="t" onclick="H(this)">18:03:14</span>          Matthew Pettis </span><span>That would be nice to not have the interop require vs. import split, as it seems a typical rules pattern is to have record class referenced in the LHS, and needs to construct and insert a record on the RHS, which needs the constructor via require.  It took me a while to suss out the difference, and a post by Alex Miller (which I can&apos;t find today) helped me understand it a bit more.  I considered going down to the plain maps workflow and not using records, which would take care of this issue, and I assume people who don&apos;t use records make code that should mostly run in either CLJ or CLJS.</span></div><div id="t1600365973048400" t="2020-09-17 18:06:13 Matthew Pettis But I&apos;ll say that Clara still seems to have better semantics and usability than other solutions I&apos;ve tried.   durable_rules  from jruizgit at github works, but not for my use case, where I like the concept of queries that can return me the facts in the session, which  durable_rules  does not in theory (jruiz made a function to do so after a an issue I filed, but it appears to still have some bugs)."><a href="#t1600365973048400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-09-17</span> <span class="t" onclick="H(this)">18:06:13</span>          Matthew Pettis </span><span>But I&apos;ll say that Clara still seems to have better semantics and usability than other solutions I&apos;ve tried.  </span><code>durable_rules</code><span> from jruizgit at github works, but not for my use case, where I like the concept of queries that can return me the facts in the session, which </span><code>durable_rules</code><span> does not in theory (jruiz made a function to do so after a an issue I filed, but it appears to still have some bugs).</span></div><div id="t1600366000048700" t="2020-09-17 18:06:40 mikerod Nice that Clara has worked better for you!"><a href="#t1600366000048700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-09-17</span> <span class="t" onclick="H(this)">18:06:40</span>                 mikerod </span><span>Nice that Clara has worked better for you!</span></div><div id="t1600366013049000" t="2020-09-17 18:06:53 mikerod and I really wish clj would have supported non-interop ways to refer to records"><a href="#t1600366013049000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-09-17</span> <span class="t" onclick="H(this)">18:06:53</span>                 mikerod </span><span>and I really wish clj would have supported non-interop ways to refer to records</span></div><div id="t1600366016049200" t="2020-09-17 18:06:56 mikerod it’s much nicer in cljs"><a href="#t1600366016049200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-09-17</span> <span class="t" onclick="H(this)">18:06:56</span>                 mikerod </span><span>it’s much nicer in cljs</span></div><div id="t1600366047049900" t="2020-09-17 18:07:27 mikerod you will see in clara-rules test ns’s we have a lot of cljc stuff. And you’ll see a lot of read-conditionals around the difference between having to use  :require  in cljs for records, vs  :import  for clj"><a href="#t1600366047049900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-09-17</span> <span class="t" onclick="H(this)">18:07:27</span>                 mikerod </span><span>you will see in clara-rules test ns’s we have a lot of cljc stuff. And you’ll see a lot of read-conditionals around the difference between having to use </span><code>:require</code><span> in cljs for records, vs </span><code>:import</code><span> for clj</span></div><div id="t1600366074050400" t="2020-09-17 18:07:54 mikerod but yeah, feel free to log a clara-rules github issue if you want to propose allowing the syntactic forms perhaps"><a href="#t1600366074050400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-09-17</span> <span class="t" onclick="H(this)">18:07:54</span>                 mikerod </span><span>but yeah, feel free to log a clara-rules github issue if you want to propose allowing the syntactic forms perhaps</span></div><div id="t1600366085050900" t="2020-09-17 18:08:05 mikerod the only thing I don’t like as much as it differs from how clj resolves symbols"><a href="#t1600366085050900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-09-17</span> <span class="t" onclick="H(this)">18:08:05</span>                 mikerod </span><span>the only thing I don’t like as much as it differs from how clj resolves symbols</span></div><div id="t1600366098051500" t="2020-09-17 18:08:18 mikerod but we do that in other ways throughout forms as well - so maybe not that big of a deal"><a href="#t1600366098051500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-09-17</span> <span class="t" onclick="H(this)">18:08:18</span>                 mikerod </span><span>but we do that in other ways throughout forms as well - so maybe not that big of a deal</span></div><div id="t1600366113052000" t="2020-09-17 18:08:33 mikerod and records can be quite convenient over maps (although both are supported)"><a href="#t1600366113052000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-09-17</span> <span class="t" onclick="H(this)">18:08:33</span>                 mikerod </span><span>and records can be quite convenient over maps (although both are supported)</span></div><div id="t1600366130052800" t="2020-09-17 18:08:50 mikerod records have another benefit in that clara compiler will “understand field references”"><a href="#t1600366130052800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-09-17</span> <span class="t" onclick="H(this)">18:08:50</span>                 mikerod </span><span>records have another benefit in that clara compiler will “understand field references”</span></div><div id="t1600366143053400" t="2020-09-17 18:09:03 mikerod so you can do like  [MyRec (= ?x x)]  where  x  is a field on  MyRec"><a href="#t1600366143053400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-09-17</span> <span class="t" onclick="H(this)">18:09:03</span>                 mikerod </span><span>so you can do like </span><code>[MyRec (= ?x x)]</code><span> where </span><code>x</code><span> is a field on </span><code>MyRec</code></div><div id="t1600366187054800" t="2020-09-17 18:09:47 mikerod if you used a map, you’d have to do  [:my-rec (= ?x (;x this))]  (assuming your map used the clara default  type  impl to produce that  :my-rec  type)"><a href="#t1600366187054800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-09-17</span> <span class="t" onclick="H(this)">18:09:47</span>                 mikerod </span><span>if you used a map, you’d have to do </span><code>[:my-rec (= ?x (;x this))]</code><span> (assuming your map used the clara default </span><code>type</code><span> impl to produce that </span><code>:my-rec</code><span> type)</span></div><div id="t1600366225055800" t="2020-09-17 18:10:25 Matthew Pettis in disclosure, I am not so much a programmer as a data scientist with some ability to code, and I have a some applications I can really see rules engine bridging for me, so I am learning Clojure and Clara mostly at the same time.  I say that so when you see crazy recommendations from me, you&apos;ll take it with a grain of salt."><a href="#t1600366225055800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-09-17</span> <span class="t" onclick="H(this)">18:10:25</span>          Matthew Pettis </span><span>in disclosure, I am not so much a programmer as a data scientist with some ability to code, and I have a some applications I can really see rules engine bridging for me, so I am learning Clojure and Clara mostly at the same time.  I say that so when you see crazy recommendations from me, you&apos;ll take it with a grain of salt.</span></div><div id="t1600366227055900" t="2020-09-17 18:10:27 mikerod and lastly, records can have some efficiency gains where some cases that may matter"><a href="#t1600366227055900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-09-17</span> <span class="t" onclick="H(this)">18:10:27</span>                 mikerod </span><span>and lastly, records can have some efficiency gains where some cases that may matter</span></div><div id="t1600366360057800" t="2020-09-17 18:12:40 Matthew Pettis yeah, that&apos;s why I like the records approach -- it seemed like a much more comprehensible syntax to make rules with.  I haven&apos;t had to address performance yet, as my rulesets are not that large, and probably won&apos;t be for what I am envisioning."><a href="#t1600366360057800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-09-17</span> <span class="t" onclick="H(this)">18:12:40</span>          Matthew Pettis </span><span>yeah, that&apos;s why I like the records approach -- it seemed like a much more comprehensible syntax to make rules with.  I haven&apos;t had to address performance yet, as my rulesets are not that large, and probably won&apos;t be for what I am envisioning.</span></div><div id="t1600793108001500" t="2020-09-22 16:45:08 yenda Is there a way to have async code in the LHS of a rule? It looks like because a go block returns immediately, if one tries to insert! a fact in the go block on the LHS of a rule, the insert throws an error because the context is gone"><a href="#t1600793108001500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-09-22</span> <span class="t" onclick="H(this)">16:45:08</span>                   yenda </span><span>Is there a way to have async code in the LHS of a rule? It looks like because a go block returns immediately, if one tries to insert! a fact in the go block on the LHS of a rule, the insert throws an error because the context is gone</span></div><div id="t1600800739002200" t="2020-09-22 18:52:19 sparkofreason Pretty sure the answer is &quot;no&quot;. Why do you want a go-block in the LHS? Maybe there&apos;s another way to accomplish what you need."><a href="#t1600800739002200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-09-22</span> <span class="t" onclick="H(this)">18:52:19</span>           sparkofreason </span><span>Pretty sure the answer is &quot;no&quot;. Why do you want a go-block in the LHS? Maybe there&apos;s another way to accomplish what you need.</span></div><div id="t1600808786002500" t="2020-09-22 21:06:26 yenda I need to do some async calls to get some info from an api"><a href="#t1600808786002500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-09-22</span> <span class="t" onclick="H(this)">21:06:26</span>                   yenda </span><span>I need to do some async calls to get some info from an api</span></div><div id="t1600808861004900" t="2020-09-22 21:07:41 ethanc Doing stateful things within the rules themselves can lead to bizzare behaviors"><a href="#t1600808861004900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-09-22</span> <span class="t" onclick="H(this)">21:07:41</span>                  ethanc </span><span>Doing stateful things within the rules themselves can lead to bizzare behaviors</span></div><div id="t1600808893005700" t="2020-09-22 21:08:13 yenda if I can&apos;t do it I suppose the way around that is to insert a fact that will describe the api call that needs to be done, query for that fact, insert more fact based on that result then fire rules again?"><a href="#t1600808893005700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-09-22</span> <span class="t" onclick="H(this)">21:08:13</span>                   yenda </span><span>if I can&apos;t do it I suppose the way around that is to insert a fact that will describe the api call that needs to be done, query for that fact, insert more fact based on that result then fire rules again?</span></div><div id="t1600809039007700" t="2020-09-22 21:10:39 ethanc that would likely be the recommended approach, clara works on the presence or absence of non mutating facts and assertions. When stuff starts changing beneath it, truth maintenance starts to break down"><a href="#t1600809039007700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-09-22</span> <span class="t" onclick="H(this)">21:10:39</span>                  ethanc </span><span>that would likely be the recommended approach, clara works on the presence or absence of non mutating facts and assertions. When stuff starts changing beneath it, truth maintenance starts to break down</span></div><div id="t1601412549001600" t="2020-09-29 20:49:09 kvlt Is it possible to have rule run, if it does not find a match, it calls another rule? Or will all rules be run and it&apos;s up to me to clean that out?"><a href="#t1601412549001600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-09-29</span> <span class="t" onclick="H(this)">20:49:09</span>                    kvlt </span><span>Is it possible to have rule run, if it does not find a match, it calls another rule? Or will all rules be run and it&apos;s up to me to clean that out?</span></div><div id="t1601412651001800" t="2020-09-29 20:50:51 kvlt I guess rule chaining"><a href="#t1601412651001800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-09-29</span> <span class="t" onclick="H(this)">20:50:51</span>                    kvlt </span><span>I guess rule chaining</span></div><div id="t1601424531003300" t="2020-09-30 00:08:51 futuro You probably want two rules, one for when there’s a match and one for when there isn’t (using the :not predicate)"><a href="#t1601424531003300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-09-30</span> <span class="t" onclick="H(this)">00:08:51</span>                  futuro </span><span>You probably want two rules, one for when there’s a match and one for when there isn’t (using the :not predicate)</span></div><div id="t1601479040004400" t="2020-09-30 15:17:20 kvlt @futuro it&apos;s possible for it to match multiple rules, but there is a preference as to which one we want to use. Right now I&apos;m assigning a priority to the matches and then using an accumulator to select the best. Is this a valid approach?"><a href="#t1601479040004400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-09-30</span> <span class="t" onclick="H(this)">15:17:20</span>                    kvlt </span><span>@futuro it&apos;s possible for it to match multiple rules, but there is a preference as to which one we want to use. Right now I&apos;m assigning a priority to the matches and then using an accumulator to select the best. Is this a valid approach?</span></div><div id="t1601494249011700" t="2020-09-30 19:30:49 mikerod Yes. Priority sort of logic comes up often in my past usages"><a href="#t1601494249011700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-09-30</span> <span class="t" onclick="H(this)">19:30:49</span>                 mikerod </span><span>Yes. Priority sort of logic comes up often in my past usages</span></div><div id="t1601494289012100" t="2020-09-30 19:31:29 kvlt Thanks @defndaines @mikerod"><a href="#t1601494289012100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-09-30</span> <span class="t" onclick="H(this)">19:31:29</span>                    kvlt </span><span>Thanks @defndaines @mikerod</span></div><div id="t1601494430012300" t="2020-09-30 19:33:50 mikerod https://gist.github.com/mrrodriguez/6a6f8373b25d69826b3efe154c928fac"><a href="#t1601494430012300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-09-30</span> <span class="t" onclick="H(this)">19:33:50</span>                 mikerod </span><a href="https://gist.github.com/mrrodriguez/6a6f8373b25d69826b3efe154c928fac" target="_blank">https://gist.github.com/mrrodriguez/6a6f8373b25d69826b3efe154c928fac</a></div><div id="t1601494445012800" t="2020-09-30 19:34:05 mikerod This this was a related gist I did about it long ago. Not sure if it’s exactly the same situation though. "><a href="#t1601494445012800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-09-30</span> <span class="t" onclick="H(this)">19:34:05</span>                 mikerod </span><span>This this was a related gist I did about it long ago. Not sure if it’s exactly the same situation though. </span></div><div id="t1601494666013200" t="2020-09-30 19:37:46 kvlt @mikerod that&apos;s very useful. It does look like you&apos;re using clojure maps over records?"><a href="#t1601494666013200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-09-30</span> <span class="t" onclick="H(this)">19:37:46</span>                    kvlt </span><span>@mikerod that&apos;s very useful. It does look like you&apos;re using clojure maps over records?</span></div><div id="t1601495207013800" t="2020-09-30 19:46:47 mikerod @petr just for the sake of example. Either would work for the concept"><a href="#t1601495207013800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-09-30</span> <span class="t" onclick="H(this)">19:46:47</span>                 mikerod </span><span>@petr just for the sake of example. Either would work for the concept</span></div><div id="t1601495254014600" t="2020-09-30 19:47:34 kvlt Of course. I think I would prefer to use maps over records in my code-base. I was excited to see an example. I didn’t know it was possible"><a href="#t1601495254014600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-09-30</span> <span class="t" onclick="H(this)">19:47:34</span>                    kvlt </span><span>Of course. I think I would prefer to use maps over records in my code-base. I was excited to see an example. I didn’t know it was possible</span></div><div id="t1601564533015800" t="2020-10-01 15:02:13 mikerod @petr I guess it isn’t really documented that well - but this relates  http://www.clara-rules.org/docs/fact_type_customization/"><a href="#t1601564533015800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-01</span> <span class="t" onclick="H(this)">15:02:13</span>                 mikerod </span><span>@petr I guess it isn’t really documented that well - but this relates </span><a href="http://www.clara-rules.org/docs/fact_type_customization/" target="_blank">http://www.clara-rules.org/docs/fact_type_customization/</a></div><div id="t1601564543016200" t="2020-10-01 15:02:23 mikerod but is more specific than the general case you probably care about."><a href="#t1601564543016200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-01</span> <span class="t" onclick="H(this)">15:02:23</span>                 mikerod </span><span>but is more specific than the general case you probably care about.</span></div><div id="t1601564565016600" t="2020-10-01 15:02:45 mikerod In general though, the type matching dispatch for rules is done via  clojure.core/type"><a href="#t1601564565016600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-01</span> <span class="t" onclick="H(this)">15:02:45</span>                 mikerod </span><span>In general though, the type matching dispatch for rules is done via </span><code>clojure.core/type</code></div><div id="t1601564594017100" t="2020-10-01 15:03:14 mikerod but you can customize that dispatch via  :fact-type-fn  and  :ancestors-fn  if you have “hierarchical relationship”"><a href="#t1601564594017100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-01</span> <span class="t" onclick="H(this)">15:03:14</span>                 mikerod </span><span>but you can customize that dispatch via </span><code>:fact-type-fn</code><span> and </span><code>:ancestors-fn</code><span> if you have “hierarchical relationship”</span></div><div id="t1601564611017300" t="2020-10-01 15:03:31 mikerod my gist I shared mentions this stuff briefly and references the source doc"><a href="#t1601564611017300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-01</span> <span class="t" onclick="H(this)">15:03:31</span>                 mikerod </span><span>my gist I shared mentions this stuff briefly and references the source doc</span></div><div id="t1601567461022600" t="2020-10-01 15:51:01 bmaddy I&apos;m potentially going to be using clara for a situation where end users will be writing their own rules. I&apos;m concerned that the rules will get really complex with non-developers writing them. Are there any techniques to automatically find candidates for new rules that would simplify multiple other rules (like abstracting common clauses out)?
One idea I had when I noticed clara converts expressions to disjunctive normal form was to use that along with karnaugh maps to simplify expressions. Has anyone heard of something like that being done before? Is this a crazy idea?"><a href="#t1601567461022600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-01</span> <span class="t" onclick="H(this)">15:51:01</span>                  bmaddy </span><span>I&apos;m potentially going to be using clara for a situation where end users will be writing their own rules. I&apos;m concerned that the rules will get really complex with non-developers writing them. Are there any techniques to automatically find candidates for new rules that would simplify multiple other rules (like abstracting common clauses out)?
One idea I had when I noticed clara converts expressions to disjunctive normal form was to use that along with karnaugh maps to simplify expressions. Has anyone heard of something like that being done before? Is this a crazy idea?</span></div><div id="t1601647007024200" t="2020-10-02 13:56:47 ethanc @mikerod can probably correct me here, but i believe that clara’s compiler already tries to share common constraints within the same session."><a href="#t1601647007024200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-02</span> <span class="t" onclick="H(this)">13:56:47</span>                  ethanc </span><span>@mikerod can probably correct me here, but i believe that clara’s compiler already tries to share common constraints within the same session.</span></div><div id="t1601647901024700" t="2020-10-02 14:11:41 mikerod Yeah, I believe that common constraints are checked for and can end up being shared nodes on the rulebase network"><a href="#t1601647901024700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-02</span> <span class="t" onclick="H(this)">14:11:41</span>                 mikerod </span><span>Yeah, I believe that common constraints are checked for and can end up being shared nodes on the rulebase network</span></div><div id="t1601647977026100" t="2020-10-02 14:12:57 mikerod So typically, I guess the idea is you don’t need to be overly concerned with “redundancy” in that respect - however, there are clearly times when you want to extract rules to help eliminate large numbers of facts coming into multi-way joins"><a href="#t1601647977026100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-02</span> <span class="t" onclick="H(this)">14:12:57</span>                 mikerod </span><span>So typically, I guess the idea is you don’t need to be overly concerned with “redundancy” in that respect - however, there are clearly times when you want to extract rules to help eliminate large numbers of facts coming into multi-way joins</span></div><div id="t1601649556028200" t="2020-10-02 14:39:16 bmaddy Oh, yeah, I didn&apos;t mean for performance--I didn&apos;t make that clear above. I&apos;m really thinking more in terms of readability for humans (i.e. automatically find a common abstraction to make it easier to understand all your rules). It&apos;s nice to know constraints become shared nodes though!"><a href="#t1601649556028200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-02</span> <span class="t" onclick="H(this)">14:39:16</span>                  bmaddy </span><span>Oh, yeah, I didn&apos;t mean for performance--I didn&apos;t make that clear above. I&apos;m really thinking more in terms of readability for humans (i.e. automatically find a common abstraction to make it easier to understand all your rules). It&apos;s nice to know constraints become shared nodes though!</span></div><div id="t1601654379030300" t="2020-10-02 15:59:39 ethanc i haven’t really thought about static analysis of the rules written in the DSL, its an interesting thought.
In general it would be nice to have analysis tools that would guide rule developers in the right direction with regards to patterns."><a href="#t1601654379030300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-02</span> <span class="t" onclick="H(this)">15:59:39</span>                  ethanc </span><span>i haven’t really thought about static analysis of the rules written in the DSL, its an interesting thought.
In general it would be nice to have analysis tools that would guide rule developers in the right direction with regards to patterns.</span></div><div id="t1601664756030600" t="2020-10-02 18:52:36 mikerod we did write some extra higher-level DSLs in some cases"><a href="#t1601664756030600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-02</span> <span class="t" onclick="H(this)">18:52:36</span>                 mikerod </span><span>we did write some extra higher-level DSLs in some cases</span></div><div id="t1601664762030900" t="2020-10-02 18:52:42 mikerod to abstract away common rule patterns"><a href="#t1601664762030900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-02</span> <span class="t" onclick="H(this)">18:52:42</span>                 mikerod </span><span>to abstract away common rule patterns</span></div><div id="t1601664769031100" t="2020-10-02 18:52:49 mikerod so that’s something to consider sometimes"><a href="#t1601664769031100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-02</span> <span class="t" onclick="H(this)">18:52:49</span>                 mikerod </span><span>so that’s something to consider sometimes</span></div><div id="t1601927160032200" t="2020-10-05 19:46:00 bmaddy Thanks for the thoughts. It will be a while before I get to the position of maybe trying it. If I do end up trying it, I&apos;ll certainly post results back here."><a href="#t1601927160032200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-05</span> <span class="t" onclick="H(this)">19:46:00</span>                  bmaddy </span><span>Thanks for the thoughts. It will be a while before I get to the position of maybe trying it. If I do end up trying it, I&apos;ll certainly post results back here.</span></div><div id="t1601997116035500" t="2020-10-06 15:11:56 futuro A second idea @bmaddy , if it fits your project, would be to create a UI for building rules, perhaps presenting a searchable list of Fact records to users, along with their available fields, and allow them to pick the facts and fields they want to match on, plus the Boolean expression combinations. "><a href="#t1601997116035500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-06</span> <span class="t" onclick="H(this)">15:11:56</span>                  futuro </span><span>A second idea @bmaddy , if it fits your project, would be to create a UI for building rules, perhaps presenting a searchable list of Fact records to users, along with their available fields, and allow them to pick the facts and fields they want to match on, plus the Boolean expression combinations. </span></div><div id="t1601997163036900" t="2020-10-06 15:12:43 futuro That’s definitely not a small project, but might greatly raise the accessibility for non-developers to write facts with, while providing guardrails to help them. "><a href="#t1601997163036900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-06</span> <span class="t" onclick="H(this)">15:12:43</span>                  futuro </span><span>That’s definitely not a small project, but might greatly raise the accessibility for non-developers to write facts with, while providing guardrails to help them. </span></div><div id="t1601998565038500" t="2020-10-06 15:36:05 bmaddy @futuro Yeah, a UI would be nice, but that&apos;s way off in the future. At the moment, we&apos;re not entirely sure we&apos;ll have users writing actual rules yet. We&apos;ll see what happens. Good ideas though!"><a href="#t1601998565038500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-06</span> <span class="t" onclick="H(this)">15:36:05</span>                  bmaddy </span><span>@futuro Yeah, a UI would be nice, but that&apos;s way off in the future. At the moment, we&apos;re not entirely sure we&apos;ll have users writing actual rules yet. We&apos;ll see what happens. Good ideas though!</span></div><div id="t1602015405041500" t="2020-10-06 20:16:45 Matthew Pettis I think I&apos;ve asked this before, but I cannot retrieve the history too far back of this channel... What is the best way to capture the chain of facts and rules that caused a fact to be produced in a session?  I don&apos;t need a full-blown GUI, and honestly would just be able to get a data structure I can manipulate myself..."><a href="#t1602015405041500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-06</span> <span class="t" onclick="H(this)">20:16:45</span>          Matthew Pettis </span><span>I think I&apos;ve asked this before, but I cannot retrieve the history too far back of this channel... What is the best way to capture the chain of facts and rules that caused a fact to be produced in a session?  I don&apos;t need a full-blown GUI, and honestly would just be able to get a data structure I can manipulate myself...</span></div><div id="t1602015500043400" t="2020-10-06 20:18:20 Matthew Pettis So, for instance, if I have a session with a rule that has something like &quot;P =&gt; Q&quot; and I insert a fact P into the session, and query for the fact Q, which should be present, I&apos;d like to be able to take Q and inspect the session and see the presence of fact P and the rule &quot;P =&gt; Q&quot;.  But, you know, with more complex rules and such.  Is this readily available?"><a href="#t1602015500043400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-06</span> <span class="t" onclick="H(this)">20:18:20</span>          Matthew Pettis </span><span>So, for instance, if I have a session with a rule that has something like &quot;P =&gt; Q&quot; and I insert a fact P into the session, and query for the fact Q, which should be present, I&apos;d like to be able to take Q and inspect the session and see the presence of fact P and the rule &quot;P =&gt; Q&quot;.  But, you know, with more complex rules and such.  Is this readily available?</span></div><div id="t1602015579044900" t="2020-10-06 20:19:39 Matthew Pettis I&apos;ve looked at  https://github.com/rbrush/clara-tools  , but I can&apos;t get the shopping.clj example to work -- launches a web page, but with no session and nothing to look at, as far as I can tell.  But again, I really don&apos;t want the gui, I just want to be able to inspect a session for the chain of facts and rules that lead to other facts being present in the system..."><a href="#t1602015579044900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-06</span> <span class="t" onclick="H(this)">20:19:39</span>          Matthew Pettis </span><span>I&apos;ve looked at </span><a href="https://github.com/rbrush/clara-tools" target="_blank">https://github.com/rbrush/clara-tools</a><span> , but I can&apos;t get the shopping.clj example to work -- launches a web page, but with no session and nothing to look at, as far as I can tell.  But again, I really don&apos;t want the gui, I just want to be able to inspect a session for the chain of facts and rules that lead to other facts being present in the system...</span></div><div id="t1602015639046200" t="2020-10-06 20:20:39 Matthew Pettis It should also make sense in simple cases.  As in the prior case, if P is an inserted fact, and I want to see how I got P, I should just see &quot;P&quot; with no rules, as it was inserted a priori..."><a href="#t1602015639046200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-06</span> <span class="t" onclick="H(this)">20:20:39</span>          Matthew Pettis </span><span>It should also make sense in simple cases.  As in the prior case, if P is an inserted fact, and I want to see how I got P, I should just see &quot;P&quot; with no rules, as it was inserted a priori...</span></div><div id="t1602097420047600" t="2020-10-07 19:03:40 wparker As far as I know the clara-tools project isn’t really maintained anymore.  From what you describe though I think you can probably accomplish what you’re looking for in a non-GUI environment with session inspection, particularly the :fact-&gt;explanations key.  http://www.clara-rules.org/docs/inspection/"><a href="#t1602097420047600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-07</span> <span class="t" onclick="H(this)">19:03:40</span>                      wparker </span><span>As far as I know the clara-tools project isn’t really maintained anymore.  From what you describe though I think you can probably accomplish what you’re looking for in a non-GUI environment with session inspection, particularly the :fact-&gt;explanations key. </span><a href="http://www.clara-rules.org/docs/inspection/" target="_blank">http://www.clara-rules.org/docs/inspection/</a></div><div id="t1602097483047900" t="2020-10-07 19:04:43 wparker The fact-graph functionality might also be of use, though note that this is basically just another view over the information returned by session inspection.  https://github.com/cerner/clara-rules/blob/main/src/main/clojure/clara/tools/fact_graph.cljc"><a href="#t1602097483047900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-07</span> <span class="t" onclick="H(this)">19:04:43</span>                      wparker </span><span>The fact-graph functionality might also be of use, though note that this is basically just another view over the information returned by session inspection. </span><a href="https://github.com/cerner/clara-rules/blob/main/src/main/clojure/clara/tools/fact_graph.cljc" target="_blank">https://github.com/cerner/clara-rules/blob/main/src/main/clojure/clara/tools/fact_graph.cljc</a></div><div id="t1602099369051500" t="2020-10-07 19:36:09 Matthew Pettis Thanks!  I think session-inspection is exactly what I need at this point of what I think are my simple needs."><a href="#t1602099369051500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-07</span> <span class="t" onclick="H(this)">19:36:09</span>               Matthew Pettis </span><span>Thanks!  I think session-inspection is exactly what I need at this point of what I think are my simple needs.</span></div><div id="t1602071226046800" t="2020-10-07 11:47:06 dharrigan Can clara be used to enforce a type of &quot;state&quot;, i.e., something starts with a state, then moves to another state, but cannot move to a previous state?"><a href="#t1602071226046800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-07</span> <span class="t" onclick="H(this)">11:47:06</span>               dharrigan </span><span>Can clara be used to enforce a type of &quot;state&quot;, i.e., something starts with a state, then moves to another state, but cannot move to a previous state?</span></div><div id="t1602076136047100" t="2020-10-07 13:08:56 mikerod @dharrigan I’d think you can model this via forward-chaining"><a href="#t1602076136047100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-07</span> <span class="t" onclick="H(this)">13:08:56</span>                 mikerod </span><span>@dharrigan I’d think you can model this via forward-chaining</span></div><div id="t1602079134047500" t="2020-10-07 13:58:54 dharrigan Okay, thank you. I&apos;ll have a play  🙂"><a href="#t1602079134047500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-07</span> <span class="t" onclick="H(this)">13:58:54</span>               dharrigan </span><span>Okay, thank you. I&apos;ll have a play </span><b>🙂</b></div><div id="t1602097706050700" t="2020-10-07 19:08:26 wparker Like a state machine basically?  It certainly could be done in Clara, although maybe something more specifically aimed at representing state machines would be simpler.  Depends on the use case probably and whether it is part of your rules or the whole thing; I haven’t tried encoding any state machines “for real” before."><a href="#t1602097706050700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-07</span> <span class="t" onclick="H(this)">19:08:26</span>                 wparker </span><span>Like a state machine basically?  It certainly could be done in Clara, although maybe something more specifically aimed at representing state machines would be simpler.  Depends on the use case probably and whether it is part of your rules or the whole thing; I haven’t tried encoding any state machines “for real” before.</span></div><div id="t1602098022051000" t="2020-10-07 19:13:42 dharrigan Yes, a very very simple state machine, just a few states."><a href="#t1602098022051000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-07</span> <span class="t" onclick="H(this)">19:13:42</span>               dharrigan </span><span>Yes, a very very simple state machine, just a few states.</span></div><div id="t1602098037051300" t="2020-10-07 19:13:57 dharrigan Perhaps I may just end up doing a cond  🙂"><a href="#t1602098037051300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-07</span> <span class="t" onclick="H(this)">19:13:57</span>               dharrigan </span><span>Perhaps I may just end up doing a cond </span><b>🙂</b></div><div id="t1602115977052300" t="2020-10-08 00:12:57 sparkofreason Is there a technical reason why tests are not included in boolean expressions?"><a href="#t1602115977052300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-08</span> <span class="t" onclick="H(this)">00:12:57</span>           sparkofreason </span><span>Is there a technical reason why tests are not included in boolean expressions?</span></div><div id="t1602116103052700" t="2020-10-08 00:15:03 sparkofreason Maybe because the variables have to be bound before executing the test?"><a href="#t1602116103052700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-08</span> <span class="t" onclick="H(this)">00:15:03</span>           sparkofreason </span><span>Maybe because the variables have to be bound before executing the test?</span></div><div id="t1602116604056400" t="2020-10-08 00:23:24 ethanc As you mentioned, test conditions allow a fact-binding to be bound before evaluation. My go-to example would be checking the result of an accumulator"><a href="#t1602116604056400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-08</span> <span class="t" onclick="H(this)">00:23:24</span>                  ethanc </span><span>As you mentioned, test conditions allow a fact-binding to be bound before evaluation. My go-to example would be checking the result of an accumulator</span></div><div id="t1602128923058400" t="2020-10-08 03:48:43 Matthew Pettis Looking at output of  clara.rules.inspect ... just wondering, when using  inspect  on a session, what is the difference in the contents of the  :condition-matches  vs the  :insertions .  They seem to have pretty much the same information, but granted, I am just using a single rule and single insertion and trying to inspect the output to figure out what  inspect  can tell me, and how, at the moment..."><a href="#t1602128923058400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-08</span> <span class="t" onclick="H(this)">03:48:43</span>          Matthew Pettis </span><span>Looking at output of </span><code>clara.rules.inspect</code><span>... just wondering, when using </span><code>inspect</code><span> on a session, what is the difference in the contents of the </span><code>:condition-matches</code><span> vs the </span><code>:insertions</code><span>.  They seem to have pretty much the same information, but granted, I am just using a single rule and single insertion and trying to inspect the output to figure out what </span><code>inspect</code><span> can tell me, and how, at the moment...</span></div><div id="t1602163966060200" t="2020-10-08 13:32:46 ethanc I believe that the  :condition-matches  is meant to capture/explain join nodes, where  :insertions  should contain what facts were inserted and why they were inserted i believe"><a href="#t1602163966060200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-08</span> <span class="t" onclick="H(this)">13:32:46</span>                  ethanc </span><span>I believe that the </span><code>:condition-matches</code><span> is meant to capture/explain join nodes, where </span><code>:insertions</code><span> should contain what facts were inserted and why they were inserted i believe</span></div><div id="t1602170821062100" t="2020-10-08 15:27:01 Matthew Pettis It looks like  :condition-matches  will also show the unconditional inserts (like the initial facts loaded to a session)... does that seem right?"><a href="#t1602170821062100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-08</span> <span class="t" onclick="H(this)">15:27:01</span>          Matthew Pettis </span><span>It looks like </span><code>:condition-matches</code><span> will also show the unconditional inserts (like the initial facts loaded to a session)... does that seem right?</span></div><div id="t1602859202065600" t="2020-10-16 14:40:02 kvlt Is there a way to create rules without the  defrule  macro? I am currently pulling constraints out of a database and would like to make a bunch of rules based off of those. I noticed that the macro appears to just create a var?

 (def
 do-it
 {:ns-name &apos;woof,
  :lhs &apos;[{:type woof.Person, :constraints [(= name &quot;me&quot;)]}],
  :rhs &apos;(do (prn &quot;99999&quot;)),
  :name &quot;woof/do-it&quot;}) 
However creating that var does not seem to create the rule."><a href="#t1602859202065600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-16</span> <span class="t" onclick="H(this)">14:40:02</span>                    kvlt </span><span>Is there a way to create rules without the </span><code>defrule</code><span> macro? I am currently pulling constraints out of a database and would like to make a bunch of rules based off of those. I noticed that the macro appears to just create a var?

</span><pre>(def
 do-it
 {:ns-name &apos;woof,
  :lhs &apos;[{:type woof.Person, :constraints [(= name &quot;me&quot;)]}],
  :rhs &apos;(do (prn &quot;99999&quot;)),
  :name &quot;woof/do-it&quot;})</pre><span>
However creating that var does not seem to create the rule.</span></div><div id="t1602859429067300" t="2020-10-16 14:43:49 kvlt My guess is that this is not adding that var to the clara-session?"><a href="#t1602859429067300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-16</span> <span class="t" onclick="H(this)">14:43:49</span>                    kvlt </span><span>My guess is that this is not adding that var to the clara-session?</span></div><div id="t1602859646067700" t="2020-10-16 14:47:26 mikerod @petr it is supported and you don’t even need vars"><a href="#t1602859646067700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-16</span> <span class="t" onclick="H(this)">14:47:26</span>                 mikerod </span><span>@petr it is supported and you don’t even need vars</span></div><div id="t1602859650067900" t="2020-10-16 14:47:30 mikerod but you can use vars if that is convenient for you"><a href="#t1602859650067900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-16</span> <span class="t" onclick="H(this)">14:47:30</span>                 mikerod </span><span>but you can use vars if that is convenient for you</span></div><div id="t1602859671068300" t="2020-10-16 14:47:51 mikerod if you do use vars, the question then becomes how is it “auto detected” via Clara’s default namespace scanning impl"><a href="#t1602859671068300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-16</span> <span class="t" onclick="H(this)">14:47:51</span>                 mikerod </span><span>if you do use vars, the question then becomes how is it “auto detected” via Clara’s default namespace scanning impl</span></div><div id="t1602859676068500" t="2020-10-16 14:47:56 mikerod and that is done via metadata"><a href="#t1602859676068500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-16</span> <span class="t" onclick="H(this)">14:47:56</span>                 mikerod </span><span>and that is done via metadata</span></div><div id="t1602859776068800" t="2020-10-16 14:49:36 mikerod https://github.com/cerner/clara-rules/blob/0.21.0/src/main/clojure/clara/rules.cljc#L271-L305"><a href="#t1602859776068800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-16</span> <span class="t" onclick="H(this)">14:49:36</span>                 mikerod </span><a href="https://github.com/cerner/clara-rules/blob/0.21.0/src/main/clojure/clara/rules.cljc#L271-L305" target="_blank">https://github.com/cerner/clara-rules/blob/0.21.0/src/main/clojure/clara/rules.cljc#L271-L305</a></div><div id="t1602859835070500" t="2020-10-16 14:50:35 kvlt @mikerod I would use vars or not. It just feels better than using a macro to generate  defrules"><a href="#t1602859835070500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-16</span> <span class="t" onclick="H(this)">14:50:35</span>                    kvlt </span><span>@mikerod I would use vars or not. It just feels better than using a macro to generate </span><code>defrules</code></div><div id="t1602859852071200" t="2020-10-16 14:50:52 mikerod this is what it does to scan built-in"><a href="#t1602859852071200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-16</span> <span class="t" onclick="H(this)">14:50:52</span>                 mikerod </span><span>this is what it does to scan built-in</span></div><div id="t1602859853071400" t="2020-10-16 14:50:53 mikerod so specifically for vars"><a href="#t1602859853071400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-16</span> <span class="t" onclick="H(this)">14:50:53</span>                 mikerod </span><span>so specifically for vars</span></div><div id="t1602859853071600" t="2020-10-16 14:50:53 mikerod if you have  meta  :
 :rule ,  :query , or  :production-seq"><a href="#t1602859853071600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-16</span> <span class="t" onclick="H(this)">14:50:53</span>                 mikerod </span><span>if you have </span><code>meta</code><span> :
</span><code>:rule</code><span>, </span><code>:query</code><span>, or </span><code>:production-seq</code></div><div id="t1602859853071800" t="2020-10-16 14:50:53 mikerod it is treated as a rule container of some sort"><a href="#t1602859853071800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-16</span> <span class="t" onclick="H(this)">14:50:53</span>                 mikerod </span><span>it is treated as a rule container of some sort</span></div><div id="t1602859854072000" t="2020-10-16 14:50:54 mikerod :rule  and  :query  are a single rule/query"><a href="#t1602859854072000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-16</span> <span class="t" onclick="H(this)">14:50:54</span>                 mikerod </span><code>:rule</code><span> and </span><code>:query</code><span> are a single rule/query</span></div><div id="t1602859854072100" t="2020-10-16 14:50:54 mikerod :production-seq  is a collection of rules/queries - aka “productions”"><a href="#t1602859854072100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-16</span> <span class="t" onclick="H(this)">14:50:54</span>                 mikerod </span><code>:production-seq</code><span> is a collection of rules/queries - aka “productions”</span></div><div id="t1602859854072300" t="2020-10-16 14:50:54 mikerod you don’t need macros"><a href="#t1602859854072300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-16</span> <span class="t" onclick="H(this)">14:50:54</span>                 mikerod </span><span>you don’t need macros</span></div><div id="t1602859855072500" t="2020-10-16 14:50:55 mikerod and you don’t need vars"><a href="#t1602859855072500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-16</span> <span class="t" onclick="H(this)">14:50:55</span>                 mikerod </span><span>and you don’t need vars</span></div><div id="t1602859856072700" t="2020-10-16 14:50:56 mikerod if you have a more data-oriented case"><a href="#t1602859856072700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-16</span> <span class="t" onclick="H(this)">14:50:56</span>                 mikerod </span><span>if you have a more data-oriented case</span></div><div id="t1602859868073000" t="2020-10-16 14:51:08 mikerod mk-session  takes collections of rule/query (aka production) structures"><a href="#t1602859868073000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-16</span> <span class="t" onclick="H(this)">14:51:08</span>                 mikerod </span><code>mk-session</code><span> takes collections of rule/query (aka production) structures</span></div><div id="t1602859873073200" t="2020-10-16 14:51:13 kvlt I&apos;m open to really any approach here"><a href="#t1602859873073200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-16</span> <span class="t" onclick="H(this)">14:51:13</span>                    kvlt </span><span>I&apos;m open to really any approach here</span></div><div id="t1602859899073700" t="2020-10-16 14:51:39 mikerod well, you just have to choose what is best suited"><a href="#t1602859899073700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-16</span> <span class="t" onclick="H(this)">14:51:39</span>                 mikerod </span><span>well, you just have to choose what is best suited</span></div><div id="t1602859907074100" t="2020-10-16 14:51:47 kvlt Oh cool. so I could actually pass those &quot;rule&quot; maps to the  mk-session ?"><a href="#t1602859907074100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-16</span> <span class="t" onclick="H(this)">14:51:47</span>                    kvlt </span><span>Oh cool. so I could actually pass those &quot;rule&quot; maps to the </span><code>mk-session</code><span>?</span></div><div id="t1602859909074200" t="2020-10-16 14:51:49 mikerod vars are awkward to create if you’re doing it like at runtime"><a href="#t1602859909074200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-16</span> <span class="t" onclick="H(this)">14:51:49</span>                 mikerod </span><span>vars are awkward to create if you’re doing it like at runtime</span></div><div id="t1602859951074400" t="2020-10-16 14:52:31 kvlt I agree"><a href="#t1602859951074400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-16</span> <span class="t" onclick="H(this)">14:52:31</span>                    kvlt </span><span>I agree</span></div><div id="t1602859969074900" t="2020-10-16 14:52:49 mikerod if you look at tests"><a href="#t1602859969074900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-16</span> <span class="t" onclick="H(this)">14:52:49</span>                 mikerod </span><span>if you look at tests</span></div><div id="t1602860030076700" t="2020-10-16 14:53:50 mikerod https://github.com/cerner/clara-rules/blob/0.21.0/src/test/clojure/clara/test_rules.clj#L144"><a href="#t1602860030076700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-16</span> <span class="t" onclick="H(this)">14:53:50</span>                 mikerod </span><a href="https://github.com/cerner/clara-rules/blob/0.21.0/src/test/clojure/clara/test_rules.clj#L144" target="_blank">https://github.com/cerner/clara-rules/blob/0.21.0/src/test/clojure/clara/test_rules.clj#L144</a></div><div id="t1602860030076800" t="2020-10-16 14:53:50 mikerod as example"><a href="#t1602860030076800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-16</span> <span class="t" onclick="H(this)">14:53:50</span>                 mikerod </span><span>as example</span></div><div id="t1602860031076900" t="2020-10-16 14:53:51 mikerod you see they are almost all just based on passing rule/query maps in a collection to  mk-session"><a href="#t1602860031076900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-16</span> <span class="t" onclick="H(this)">14:53:51</span>                 mikerod </span><span>you see they are almost all just based on passing rule/query maps in a collection to </span><code>mk-session</code></div><div id="t1602860031077000" t="2020-10-16 14:53:51 mikerod so this is probably all you are really looking for"><a href="#t1602860031077000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-16</span> <span class="t" onclick="H(this)">14:53:51</span>                 mikerod </span><span>so this is probably all you are really looking for</span></div><div id="t1602860031077100" t="2020-10-16 14:53:51 mikerod vars with metadata are basically just a convenience"><a href="#t1602860031077100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-16</span> <span class="t" onclick="H(this)">14:53:51</span>                 mikerod </span><span>vars with metadata are basically just a convenience</span></div><div id="t1602860031077200" t="2020-10-16 14:53:51 mikerod for automatic rule/query detection in namespaces"><a href="#t1602860031077200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-16</span> <span class="t" onclick="H(this)">14:53:51</span>                 mikerod </span><span>for automatic rule/query detection in namespaces</span></div><div id="t1602860047077600" t="2020-10-16 14:54:07 mikerod which works better for cases where you are more statically writing rules via macros/DSL"><a href="#t1602860047077600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-16</span> <span class="t" onclick="H(this)">14:54:07</span>                 mikerod </span><span>which works better for cases where you are more statically writing rules via macros/DSL</span></div><div id="t1602860155077900" t="2020-10-16 14:55:55 kvlt Ohhh that looks useful, thank you for showing me that"><a href="#t1602860155077900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-16</span> <span class="t" onclick="H(this)">14:55:55</span>                    kvlt </span><span>Ohhh that looks useful, thank you for showing me that</span></div><div id="t1602862983078100" t="2020-10-16 15:43:03 mikerod no problem"><a href="#t1602862983078100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-16</span> <span class="t" onclick="H(this)">15:43:03</span>                 mikerod </span><span>no problem</span></div><div id="t1602862996078700" t="2020-10-16 15:43:16 mikerod I looked briefly on  http://clara-rules.org  and do not see any actual good documentation around “rule sources”"><a href="#t1602862996078700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-16</span> <span class="t" onclick="H(this)">15:43:16</span>                 mikerod </span><span>I looked briefly on </span><a href="http://clara-rules.org" target="_blank">http://clara-rules.org</a><span> and do not see any actual good documentation around “rule sources”</span></div><div id="t1602863002078900" t="2020-10-16 15:43:22 mikerod which I think could be improved"><a href="#t1602863002078900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-16</span> <span class="t" onclick="H(this)">15:43:22</span>                 mikerod </span><span>which I think could be improved</span></div><div id="t1602863017079600" t="2020-10-16 15:43:37 kvlt @mikerod thank you so much for that. This has made my day a lot easier"><a href="#t1602863017079600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-16</span> <span class="t" onclick="H(this)">15:43:37</span>                    kvlt </span><span>@mikerod thank you so much for that. This has made my day a lot easier</span></div><div id="t1602863020079700" t="2020-10-16 15:43:40 mikerod I think it’s lacking if we don’t include other major variants of how to load rules"><a href="#t1602863020079700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-16</span> <span class="t" onclick="H(this)">15:43:40</span>                 mikerod </span><span>I think it’s lacking if we don’t include other major variants of how to load rules</span></div><div id="t1602863032080100" t="2020-10-16 15:43:52 mikerod We’ve taken special care in a lot of the clara stuff to make it where the DSL is optional"><a href="#t1602863032080100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-16</span> <span class="t" onclick="H(this)">15:43:52</span>                 mikerod </span><span>We’ve taken special care in a lot of the clara stuff to make it where the DSL is optional</span></div><div id="t1602863051080700" t="2020-10-16 15:44:11 mikerod and to have the API accept other data-oriented options"><a href="#t1602863051080700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-16</span> <span class="t" onclick="H(this)">15:44:11</span>                 mikerod </span><span>and to have the API accept other data-oriented options</span></div><div id="t1602863062081300" t="2020-10-16 15:44:22 kvlt Yeah, this is clearly very well thought out"><a href="#t1602863062081300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-16</span> <span class="t" onclick="H(this)">15:44:22</span>                    kvlt </span><span>Yeah, this is clearly very well thought out</span></div><div id="t1602863070081600" t="2020-10-16 15:44:30 mikerod just DSL + var/ns scan-loading is built-in for convenience and the typical, most easy examples"><a href="#t1602863070081600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-16</span> <span class="t" onclick="H(this)">15:44:30</span>                 mikerod </span><span>just DSL + var/ns scan-loading is built-in for convenience and the typical, most easy examples</span></div><div id="t1603031295082000" t="2020-10-18 14:28:15 schmee are rule clauses order sensitive?"><a href="#t1603031295082000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-18</span> <span class="t" onclick="H(this)">14:28:15</span>                  schmee </span><span>are rule clauses order sensitive?</span></div><div id="t1603031826082700" t="2020-10-18 14:37:06 schmee i.e if I have
 (defrule foo
  [HighCardinality (= foo ?foo)]
  [LowCardinality (= foo ?foo)]
  =&gt;
  (insert! (-&gt;Foo ?name))) 
does it matter for performance that  HighCardinality  is before  LowCardinality ?"><a href="#t1603031826082700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-18</span> <span class="t" onclick="H(this)">14:37:06</span>                  schmee </span><span>i.e if I have
</span><pre>(defrule foo
  [HighCardinality (= foo ?foo)]
  [LowCardinality (= foo ?foo)]
  =&gt;
  (insert! (-&gt;Foo ?name)))</pre><span>
does it matter for performance that </span><code>HighCardinality</code><span> is before </span><code>LowCardinality</code><span>?</span></div><div id="t1603042919087200" t="2020-10-18 17:41:59 ethanc I don&apos;t believe it would impact performance. The cartesian product would be the same size I believe"><a href="#t1603042919087200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-18</span> <span class="t" onclick="H(this)">17:41:59</span>                  ethanc </span><span>I don&apos;t believe it would impact performance. The cartesian product would be the same size I believe</span></div><div id="t1603047849087600" t="2020-10-18 19:04:09 schmee okay, this one has me completely stumped:
 (defrecord Reachable [nodeType name])
(defrecord Node [nodeType area name])

(defrule area-reachability
  [Reachable (= nodeType :area) (= name ?area)]
  [Node (= area ?area) (= nodeType ?nodeType) (= name ?name)]
  ; [:not [Reachable (= nodeType ?nodeType) (= name ?name)]]
  =&gt;
  (insert! (-&gt;Reachable ?nodeType ?name)))

(comment
  (-&gt; (mk-session [area-reachability])
      (insert (-&gt;Reachable :area &quot;World&quot;))
      (insert (-&gt;Node :room &quot;World&quot; &quot;Foo&quot;))
      fire-rules))"><a href="#t1603047849087600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-18</span> <span class="t" onclick="H(this)">19:04:09</span>                  schmee </span><span>okay, this one has me completely stumped:
</span><pre>(defrecord Reachable [nodeType name])
(defrecord Node [nodeType area name])

(defrule area-reachability
  [Reachable (= nodeType :area) (= name ?area)]
  [Node (= area ?area) (= nodeType ?nodeType) (= name ?name)]
  ; [:not [Reachable (= nodeType ?nodeType) (= name ?name)]]
  =&gt;
  (insert! (-&gt;Reachable ?nodeType ?name)))

(comment
  (-&gt; (mk-session [area-reachability])
      (insert (-&gt;Reachable :area &quot;World&quot;))
      (insert (-&gt;Node :room &quot;World&quot; &quot;Foo&quot;))
      fire-rules))</pre></div><div id="t1603047873088200" t="2020-10-18 19:04:33 schmee as written it finishes instantly, if you uncomment the  [:not ...]  it goes into an infinite loop"><a href="#t1603047873088200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-18</span> <span class="t" onclick="H(this)">19:04:33</span>                  schmee </span><span>as written it finishes instantly, if you uncomment the </span><code>[:not ...]</code><span> it goes into an infinite loop</span></div><div id="t1603048286088800" t="2020-10-18 19:11:26 schmee the intent is to not insert the  Reachable  fact if it’s already in the session"><a href="#t1603048286088800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-18</span> <span class="t" onclick="H(this)">19:11:26</span>                  schmee </span><span>the intent is to not insert the </span><code>Reachable</code><span> fact if it’s already in the session</span></div><div id="t1603049252090400" t="2020-10-18 19:27:32 mikerod It’s a commmon issue @schmee and you have to rethink the LHS to be in terms of what’s true about the entire state of the system"><a href="#t1603049252090400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-18</span> <span class="t" onclick="H(this)">19:27:32</span>                 mikerod </span><span>It’s a commmon issue @schmee and you have to rethink the LHS to be in terms of what’s true about the entire state of the system</span></div><div id="t1603049265090900" t="2020-10-18 19:27:45 mikerod So with the :not above you are expressing a logical contradiction. "><a href="#t1603049265090900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-18</span> <span class="t" onclick="H(this)">19:27:45</span>                 mikerod </span><span>So with the :not above you are expressing a logical contradiction. </span></div><div id="t1603049913091700" t="2020-10-18 19:38:33 schmee I see, could you elaborate a bit?"><a href="#t1603049913091700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-18</span> <span class="t" onclick="H(this)">19:38:33</span>                  schmee </span><span>I see, could you elaborate a bit?</span></div><div id="t1603049947092500" t="2020-10-18 19:39:07 schmee my mental model is that since the inserted node is not of  nodeType   :area , it will fail to match the first clause and hence the rule as a whole will not fire"><a href="#t1603049947092500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-18</span> <span class="t" onclick="H(this)">19:39:07</span>                  schmee </span><span>my mental model is that since the inserted node is not of </span><code>nodeType</code><span> </span><code>:area</code><span>, it will fail to match the first clause and hence the rule as a whole will not fire</span></div><div id="t1603049957092900" t="2020-10-18 19:39:17 schmee but that can’t be the case?"><a href="#t1603049957092900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-18</span> <span class="t" onclick="H(this)">19:39:17</span>                  schmee </span><span>but that can’t be the case?</span></div><div id="t1603054764102000" t="2020-10-18 20:59:24 ethanc What Mkie is alluding to is clara&apos;s truth maintenance:
  http://www.clara-rules.org/docs/truthmaint/ 

With the  not  un-commented, the rule itself becomes a logical contradiction of itself. The rule will only execute and  be considered true if the fact in question is not within the session. However, if the rule inserts a fact that itself asserts to be absent, then a loop would be formed.

A base state would be a session without the fact in question, ergo the rule must insert the Fact. Then clara must assert that all truth has been maintained, and finds that the Fact is now present. Meaning that the Rule is no no longer true, thus a logical retraction occurs removing the Fact from the session. Then clara must asser that all truth has been maintained, again. However we are back to the base state meaning that there is no Fact within the session and the Rule is true again, thus the cycle repeats and continues forever.

The wiki mentions ways to circumvent this mechanic using unconditional inserts, however these can lead to non-logical conclusions if assumptions are made."><a href="#t1603054764102000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-18</span> <span class="t" onclick="H(this)">20:59:24</span>                  ethanc </span><span>What Mkie is alluding to is clara&apos;s truth maintenance:
 </span><a href="http://www.clara-rules.org/docs/truthmaint/" target="_blank">http://www.clara-rules.org/docs/truthmaint/</a><span>

With the </span><code>not</code><span> un-commented, the rule itself becomes a logical contradiction of itself. The rule will only execute and  be considered true if the fact in question is not within the session. However, if the rule inserts a fact that itself asserts to be absent, then a loop would be formed.

A base state would be a session without the fact in question, ergo the rule must insert the Fact. Then clara must assert that all truth has been maintained, and finds that the Fact is now present. Meaning that the Rule is no no longer true, thus a logical retraction occurs removing the Fact from the session. Then clara must asser that all truth has been maintained, again. However we are back to the base state meaning that there is no Fact within the session and the Rule is true again, thus the cycle repeats and continues forever.

The wiki mentions ways to circumvent this mechanic using unconditional inserts, however these can lead to non-logical conclusions if assumptions are made.</span></div><div id="t1603055350103100" t="2020-10-18 21:09:10 schmee thanks @ethanc, that clears things up quite a bit! I’ll take some time to ponder that and see if I can write the rule differently"><a href="#t1603055350103100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-18</span> <span class="t" onclick="H(this)">21:09:10</span>                  schmee </span><span>thanks @ethanc, that clears things up quite a bit! I’ll take some time to ponder that and see if I can write the rule differently</span></div><div id="t1603055461104000" t="2020-10-18 21:11:01 schmee I’m coming into Clara with a Datomic mindset, which will surely trip me up a few times before I understand the “rule engine way”"><a href="#t1603055461104000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-18</span> <span class="t" onclick="H(this)">21:11:01</span>                  schmee </span><span>I’m coming into Clara with a Datomic mindset, which will surely trip me up a few times before I understand the “rule engine way”</span></div><div id="t1603060383106100" t="2020-10-18 22:33:03 sparkofreason insert-uncondtional!  is your friend here, if you want to have effects in the LHS of your rules. I find it easier to always use  insert! , so that my rules are pure logic statements. When I want an effect, instead I insert a  request  fact, which is executed by some external component. That effect often invalidates the rule, thus causing the request to then be retracted by truth maintenance."><a href="#t1603060383106100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-18</span> <span class="t" onclick="H(this)">22:33:03</span>           sparkofreason </span><code>insert-uncondtional!</code><span> is your friend here, if you want to have effects in the LHS of your rules. I find it easier to always use </span><code>insert!</code><span>, so that my rules are pure logic statements. When I want an effect, instead I insert a </span><code>request</code><span> fact, which is executed by some external component. That effect often invalidates the rule, thus causing the request to then be retracted by truth maintenance.</span></div><div id="t1603060996106500" t="2020-10-18 22:43:16 mikerod Yeah. I avoid unconditional in most cases. "><a href="#t1603060996106500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-18</span> <span class="t" onclick="H(this)">22:43:16</span>                 mikerod </span><span>Yeah. I avoid unconditional in most cases. </span></div><div id="t1603061041107900" t="2020-10-18 22:44:01 mikerod You typically can phrase the problem in a way that works with TMS. Often intermediate facts and accumulators in an aggregate rule can solve common situations. "><a href="#t1603061041107900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-18</span> <span class="t" onclick="H(this)">22:44:01</span>                 mikerod </span><span>You typically can phrase the problem in a way that works with TMS. Often intermediate facts and accumulators in an aggregate rule can solve common situations. </span></div><div id="t1603201758108600" t="2020-10-20 13:49:18 schmee what a good approach to ensure that a fact is only inserted once, kind of like a primary key in a DB?"><a href="#t1603201758108600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-20</span> <span class="t" onclick="H(this)">13:49:18</span>                  schmee </span><span>what a good approach to ensure that a fact is only inserted once, kind of like a primary key in a DB?</span></div><div id="t1603201789109300" t="2020-10-20 13:49:49 schmee I could have a rule where the RHS literally checks in a DB to see if the key is there, but it seems better to keep as much state as possible in the session?"><a href="#t1603201789109300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-20</span> <span class="t" onclick="H(this)">13:49:49</span>                  schmee </span><span>I could have a rule where the RHS literally checks in a DB to see if the key is there, but it seems better to keep as much state as possible in the session?</span></div><div id="t1603387539119100" t="2020-10-22 17:25:39 kvlt It seems kind of dangerous have side-effects inside of a rule."><a href="#t1603387539119100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-22</span> <span class="t" onclick="H(this)">17:25:39</span>                         kvlt </span><span>It seems kind of dangerous have side-effects inside of a rule.</span></div><div id="t1603207750110300" t="2020-10-20 15:29:10 nikola What would be the best practice to implement a decision table like that?"><a href="#t1603207750110300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-20</span> <span class="t" onclick="H(this)">15:29:10</span>                  nikola </span><span>What would be the best practice to implement a decision table like that?</span></div><div id="t1603207905112100" t="2020-10-20 15:31:45 nikola At my team a couple of product specialists use Excel for logic like that and I was wondering if I can somehow turn them into Clara rules and use it to make decisions. Has anyone have done something similar in the past?"><a href="#t1603207905112100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-20</span> <span class="t" onclick="H(this)">15:31:45</span>                  nikola </span><span>At my team a couple of product specialists use Excel for logic like that and I was wondering if I can somehow turn them into Clara rules and use it to make decisions. Has anyone have done something similar in the past?</span></div><div id="t1603210805112600" t="2020-10-20 16:20:05 mikerod @schmee Use an accumulator for the fact you actually want 1 of"><a href="#t1603210805112600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-20</span> <span class="t" onclick="H(this)">16:20:05</span>                 mikerod </span><span>@schmee Use an accumulator for the fact you actually want 1 of</span></div><div id="t1603210810112800" t="2020-10-20 16:20:10 mikerod if you have rules that may produce multiples"><a href="#t1603210810112800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-20</span> <span class="t" onclick="H(this)">16:20:10</span>                 mikerod </span><span>if you have rules that may produce multiples</span></div><div id="t1603210817113100" t="2020-10-20 16:20:17 mikerod make an intermediate fact type to represent the multiple"><a href="#t1603210817113100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-20</span> <span class="t" onclick="H(this)">16:20:17</span>                 mikerod </span><span>make an intermediate fact type to represent the multiple</span></div><div id="t1603210826113400" t="2020-10-20 16:20:26 mikerod then a single acumulator to aggregate it “down to 1”"><a href="#t1603210826113400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-20</span> <span class="t" onclick="H(this)">16:20:26</span>                 mikerod </span><span>then a single acumulator to aggregate it “down to 1”</span></div><div id="t1603210846113900" t="2020-10-20 16:20:46 mikerod this aggregation rule is you explicitly choosing how you want to represent or handle multiple supporting matches"><a href="#t1603210846113900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-20</span> <span class="t" onclick="H(this)">16:20:46</span>                 mikerod </span><span>this aggregation rule is you explicitly choosing how you want to represent or handle multiple supporting matches</span></div><div id="t1603210874114400" t="2020-10-20 16:21:14 mikerod it’s not always obvious actually - if they happen to have different data associated with them them or something"><a href="#t1603210874114400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-20</span> <span class="t" onclick="H(this)">16:21:14</span>                 mikerod </span><span>it’s not always obvious actually - if they happen to have different data associated with them them or something</span></div><div id="t1603210911114700" t="2020-10-20 16:21:51 schmee gotcha, thanks for the tip!"><a href="#t1603210911114700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-20</span> <span class="t" onclick="H(this)">16:21:51</span>                  schmee </span><span>gotcha, thanks for the tip!</span></div><div id="t1603210931115600" t="2020-10-20 16:22:11 mikerod @nikola.kasev I haven’t attempted anything first-class with tables like that - but you could start by just trying to make rule to represent it and see what patterns may emerge"><a href="#t1603210931115600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-20</span> <span class="t" onclick="H(this)">16:22:11</span>                 mikerod </span><span>@nikola.kasev I haven’t attempted anything first-class with tables like that - but you could start by just trying to make rule to represent it and see what patterns may emerge</span></div><div id="t1603210971116600" t="2020-10-20 16:22:51 mikerod I know some traditional rete-based engines - like Drools on the JVM - had some spreadsheet-like decision table functionality built on top to capture the pattern - but underneath was stilll just plain rules"><a href="#t1603210971116600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-20</span> <span class="t" onclick="H(this)">16:22:51</span>                 mikerod </span><span>I know some traditional rete-based engines - like Drools on the JVM - had some spreadsheet-like decision table functionality built on top to capture the pattern - but underneath was stilll just plain rules</span></div><div id="t1603725455123500" t="2020-10-26 15:17:35 eraserhd @nikola.kasev I use tables a lot, and I&apos;m not sure of a general way to make them into rules (I would definitely be curious about such a thing!), but I have at least one example I can think of:  https://gist.github.com/eraserhd/a60250281e9d47743e9021ccd1337bcaa"><a href="#t1603725455123500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-26</span> <span class="t" onclick="H(this)">15:17:35</span>                eraserhd </span><span>@nikola.kasev I use tables a lot, and I&apos;m not sure of a general way to make them into rules (I would definitely be curious about such a thing!), but I have at least one example I can think of: </span><a href="https://gist.github.com/eraserhd/a60250281e9d47743e9021ccd1337bcaa" target="_blank">https://gist.github.com/eraserhd/a60250281e9d47743e9021ccd1337bcaa</a></div><div id="t1604574283130000" t="2020-11-05 11:04:43 nikola @U0ECYL0ET, can you check the link?"><a href="#t1604574283130000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-11-05</span> <span class="t" onclick="H(this)">11:04:43</span>                       nikola </span><span>@U0ECYL0ET, can you check the link?</span></div><div id="t1603725517123900" t="2020-10-26 15:18:37 eraserhd I&apos;ve also used macros to make different shapes of data into Clara rules."><a href="#t1603725517123900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-26</span> <span class="t" onclick="H(this)">15:18:37</span>                eraserhd </span><span>I&apos;ve also used macros to make different shapes of data into Clara rules.</span></div><div id="t1603731605124400" t="2020-10-26 17:00:05 mikerod https://github.com/cerner/clara-site/issues/34  @wparker did log an issue to document better the rules-as-data model"><a href="#t1603731605124400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-10-26</span> <span class="t" onclick="H(this)">17:00:05</span>                 mikerod </span><a href="https://github.com/cerner/clara-site/issues/34" target="_blank">https://github.com/cerner/clara-site/issues/34</a><span> @wparker did log an issue to document better the rules-as-data model</span></div><div id="t1604275991126000" t="2020-11-02 00:13:11 panda hi, i get this issue on compiling a rules namespace. could anyone help me understand what’s wrong with my bindings?
 Malformed variable binding for #{?contract-provider ?claim-provider}. No associated value.
(defrule associated-contracts
  [:contract (= ?contract this)]
  [:contract (= ?contract-provider (:subject ?contract))]
  [:claim (= ?claim this)]
  [:claim (= ?claim-provider (-&gt; ?claim
                                  :billing-provider
                                  :identifier
                                  :value))]
  [:associated? (= ?claim-provider ?contract-provider)]
  =&gt;
  (insert! {:resource-type :associated-contract
            :claim ?claim
            :contract ?contract})) 
"><a href="#t1604275991126000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-11-02</span> <span class="t" onclick="H(this)">00:13:11</span>                   panda </span><span>hi, i get this issue on compiling a rules namespace. could anyone help me understand what’s wrong with my bindings?
</span><pre>Malformed variable binding for #{?contract-provider ?claim-provider}. No associated value.
(defrule associated-contracts
  [:contract (= ?contract this)]
  [:contract (= ?contract-provider (:subject ?contract))]
  [:claim (= ?claim this)]
  [:claim (= ?claim-provider (-&gt; ?claim
                                  :billing-provider
                                  :identifier
                                  :value))]
  [:associated? (= ?claim-provider ?contract-provider)]
  =&gt;
  (insert! {:resource-type :associated-contract
            :claim ?claim
            :contract ?contract}))</pre><span>
</span></div><div id="t1604276068126100" t="2020-11-02 00:14:28 panda i’m using fact-type functions instead of clojure records but i’m having trouble figuring out what are the right patterns"><a href="#t1604276068126100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-11-02</span> <span class="t" onclick="H(this)">00:14:28</span>                        panda </span><span>i’m using fact-type functions instead of clojure records but i’m having trouble figuring out what are the right patterns</span></div><div id="t1604276083126300" t="2020-11-02 00:14:43 panda in this case i want to bind the entire object to either ?claim or ?contract"><a href="#t1604276083126300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-11-02</span> <span class="t" onclick="H(this)">00:14:43</span>                        panda </span><span>in this case i want to bind the entire object to either ?claim or ?contract</span></div><div id="t1604276104126500" t="2020-11-02 00:15:04 panda and i also want to bind nested variables in that map"><a href="#t1604276104126500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-11-02</span> <span class="t" onclick="H(this)">00:15:04</span>                        panda </span><span>and i also want to bind nested variables in that map</span></div><div id="t1604276400126700" t="2020-11-02 00:20:00 ethanc I don&apos;t have repl open currently, but it looks like this might be because of the multiple conditions with similar fact types.

rather than 2 conditions to bind contract and claim, i would assume that you might actually want a single condition for each. Something like:

 (defrule associated-contracts
  [:contract 
(= ?contract this)
(= ?contract-provider (:subject this))]
  [:claim 
 (= ?claim this)
(= ?claim-provider (-&gt; this
                                  :billing-provider
                                  :identifier
                                  :value))]
  [:associated? (= ?claim-provider ?contract-provider)]
  =&gt;
  (insert! {:resource-type :associated-contract
            :claim ?claim
            :contract ?contract}))"><a href="#t1604276400126700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-11-02</span> <span class="t" onclick="H(this)">00:20:00</span>                       ethanc </span><span>I don&apos;t have repl open currently, but it looks like this might be because of the multiple conditions with similar fact types.

rather than 2 conditions to bind contract and claim, i would assume that you might actually want a single condition for each. Something like:

</span><pre>(defrule associated-contracts
  [:contract 
(= ?contract this)
(= ?contract-provider (:subject this))]
  [:claim 
 (= ?claim this)
(= ?claim-provider (-&gt; this
                                  :billing-provider
                                  :identifier
                                  :value))]
  [:associated? (= ?claim-provider ?contract-provider)]
  =&gt;
  (insert! {:resource-type :associated-contract
            :claim ?claim
            :contract ?contract}))</pre></div><div id="t1604276648127000" t="2020-11-02 00:24:08 panda oh i see — that’s definitely a lot cleaner  🙂  it’s still giving me that error though"><a href="#t1604276648127000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-11-02</span> <span class="t" onclick="H(this)">00:24:08</span>                        panda </span><span>oh i see — that’s definitely a lot cleaner </span><b>🙂</b><span> it’s still giving me that error though</span></div><div id="t1604277061127200" t="2020-11-02 00:31:01 ethanc hmmm, seems clara is incorrectly moving the joined conditional up in front of the binding itself.

Specifially,
 [:associated? (= ?claim-provider ?contract-provider)]"><a href="#t1604277061127200" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-11-02</span> <span class="t" onclick="H(this)">00:31:01</span>                       ethanc </span><span>hmmm, seems clara is incorrectly moving the joined conditional up in front of the binding itself.

Specifially,
</span><pre>[:associated? (= ?claim-provider ?contract-provider)]</pre></div><div id="t1604277114127400" t="2020-11-02 00:31:54 ethanc however this condition seems odd to me, you are looking to a fact in the session but not asserting anything based on this fact"><a href="#t1604277114127400" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-11-02</span> <span class="t" onclick="H(this)">00:31:54</span>                       ethanc </span><span>however this condition seems odd to me, you are looking to a fact in the session but not asserting anything based on this fact</span></div><div id="t1604277175127600" t="2020-11-02 00:32:55 ethanc it almost seems as if that should be a test node:
 [:test (= ?claim-provider ?contract-provider)]"><a href="#t1604277175127600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-11-02</span> <span class="t" onclick="H(this)">00:32:55</span>                       ethanc </span><span>it almost seems as if that should be a test node:
</span><pre>[:test (= ?claim-provider ?contract-provider)]</pre></div><div id="t1604277215127800" t="2020-11-02 00:33:35 ethanc or potentially rolled up into the  :claim  condition itself"><a href="#t1604277215127800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-11-02</span> <span class="t" onclick="H(this)">00:33:35</span>                       ethanc </span><span>or potentially rolled up into the </span><code>:claim</code><span> condition itself</span></div><div id="t1604277285128000" t="2020-11-02 00:34:45 ethanc something like:
 (r/defrule associated-contracts
  [:contract
   (= ?contract this)
   (= ?contract-provider (:subject this))]
  [:claim
   (= ?claim this)
   (= (-&gt; this
          :billing-provider
          :identifier
          :value)
      ?contract-provider)]
  =&gt;
  (r/insert! {:resource-type :associated-contract
              :claim ?claim
              :contract ?contract}))"><a href="#t1604277285128000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-11-02</span> <span class="t" onclick="H(this)">00:34:45</span>                       ethanc </span><span>something like:
</span><pre>(r/defrule associated-contracts
  [:contract
   (= ?contract this)
   (= ?contract-provider (:subject this))]
  [:claim
   (= ?claim this)
   (= (-&gt; this
          :billing-provider
          :identifier
          :value)
      ?contract-provider)]
  =&gt;
  (r/insert! {:resource-type :associated-contract
              :claim ?claim
              :contract ?contract}))</pre></div><div id="t1604277424128300" t="2020-11-02 00:37:04 panda oh that’s totally it — i’m trying to set it up to have the simple predicate comparing facts and i didn’t realize that you had to name it  :test  in order for that to work…"><a href="#t1604277424128300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-11-02</span> <span class="t" onclick="H(this)">00:37:04</span>                        panda </span><span>oh that’s totally it — i’m trying to set it up to have the simple predicate comparing facts and i didn’t realize that you had to name it </span><code>:test</code><span> in order for that to work…</span></div><div id="t1604277464128500" t="2020-11-02 00:37:44 panda would the above example give you ones that matched or all combinations of facts?"><a href="#t1604277464128500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-11-02</span> <span class="t" onclick="H(this)">00:37:44</span>                        panda </span><span>would the above example give you ones that matched or all combinations of facts?</span></div><div id="t1604277537128700" t="2020-11-02 00:38:57 panda also how does querying for the fact-type-fn work? i tried the following:
 (defquery get-associated-contracts
  []
  [?associated-contract &lt;- :associated-contract])"><a href="#t1604277537128700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-11-02</span> <span class="t" onclick="H(this)">00:38:57</span>                        panda </span><span>also how does querying for the fact-type-fn work? i tried the following:
</span><pre>(defquery get-associated-contracts
  []
  [?associated-contract &lt;- :associated-contract])</pre></div><div id="t1604277551128900" t="2020-11-02 00:39:11 ethanc in the example above, the RHS should execute and insert a fact for each combination of a Claim and Contract that share the same provider"><a href="#t1604277551128900" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-11-02</span> <span class="t" onclick="H(this)">00:39:11</span>                       ethanc </span><span>in the example above, the RHS should execute and insert a fact for each combination of a Claim and Contract that share the same provider</span></div><div id="t1604277828129100" t="2020-11-02 00:43:48 panda oh i see"><a href="#t1604277828129100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-11-02</span> <span class="t" onclick="H(this)">00:43:48</span>                        panda </span><span>oh i see</span></div><div id="t1604277835129300" t="2020-11-02 00:43:55 panda that’s perfect! thank you so much!!"><a href="#t1604277835129300" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-11-02</span> <span class="t" onclick="H(this)">00:43:55</span>                        panda </span><span>that’s perfect! thank you so much!!</span></div><div id="t1604277841129500" t="2020-11-02 00:44:01 ethanc Queries should work the same way while using/not using an overridden fact-type-fn. For example:

 (defn test-session
  []
  (-&gt; (r/mk-session :fact-type-fn :resource-type)
      (r/insert {:resource-type :contract :subject :Thomas})
      (r/insert {:resource-type :claim :billing-provider {:identifier {:value :Thomas}}})
      (r/fire-rules)
      (r/query get-associated-contracts))) 
should net:
 ({:?associated-contract {:resource-type :associated-contract,
                         :claim {:resource-type :claim, :billing-provider {:identifier {:value :Thomas}}},
                         :contract {:resource-type :contract, :subject :Thomas}}})"><a href="#t1604277841129500" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-11-02</span> <span class="t" onclick="H(this)">00:44:01</span>                       ethanc </span><span>Queries should work the same way while using/not using an overridden fact-type-fn. For example:

</span><pre>(defn test-session
  []
  (-&gt; (r/mk-session :fact-type-fn :resource-type)
      (r/insert {:resource-type :contract :subject :Thomas})
      (r/insert {:resource-type :claim :billing-provider {:identifier {:value :Thomas}}})
      (r/fire-rules)
      (r/query get-associated-contracts)))</pre><span>
should net:
</span><pre>({:?associated-contract {:resource-type :associated-contract,
                         :claim {:resource-type :claim, :billing-provider {:identifier {:value :Thomas}}},
                         :contract {:resource-type :contract, :subject :Thomas}}})</pre></div><div id="t1604277987129700" t="2020-11-02 00:46:27 panda ooh i see — thank you! that makes sense"><a href="#t1604277987129700" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-11-02</span> <span class="t" onclick="H(this)">00:46:27</span>                        panda </span><span>ooh i see — thank you! that makes sense</span></div><div id="t1605009109131600" t="2020-11-10 11:51:49 narkisr Hi Clara team, I&apos;m looking for a way to add/remove rules from a LocalSession, I&apos;m not seeing any matching function in  http://www.clara-rules.org/apidocs/0.21.0/clojure/index.html  any idea if this is possible? Thanks!"><a href="#t1605009109131600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-11-10</span> <span class="t" onclick="H(this)">11:51:49</span>                 narkisr </span><span>Hi Clara team, I&apos;m looking for a way to add/remove rules from a LocalSession, I&apos;m not seeing any matching function in </span><a href="http://www.clara-rules.org/apidocs/0.21.0/clojure/index.html" target="_blank">http://www.clara-rules.org/apidocs/0.21.0/clojure/index.html</a><span> any idea if this is possible? Thanks!</span></div><div id="t1605009918133000" t="2020-11-10 12:05:18 narkisr (BTW I don&apos;t expect to keep any facts within the session prior to manipulating it, I just want to be able to manipulate the rules prior to usage in some tests)"><a href="#t1605009918133000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-11-10</span> <span class="t" onclick="H(this)">12:05:18</span>                 narkisr </span><span>(BTW I don&apos;t expect to keep any facts within the session prior to manipulating it, I just want to be able to manipulate the rules prior to usage in some tests)</span></div><div id="t1605021457135000" t="2020-11-10 15:17:37 ethanc @narkisr, Clara does not currently support adding or removing productions from a compiled session. I believe that currently the only way to have a session with fewer rules would be to remake the session without providing the rules in question."><a href="#t1605021457135000" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-11-10</span> <span class="t" onclick="H(this)">15:17:37</span>                  ethanc </span><span>@narkisr, Clara does not currently support adding or removing productions from a compiled session. I believe that currently the only way to have a session with fewer rules would be to remake the session without providing the rules in question.</span></div><div id="t1605102658135600" t="2020-11-11 13:50:58 narkisr Yeap thats the route iv went with (the session is stored in atom which makes it possible) thanks for help"><a href="#t1605102658135600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-11-11</span> <span class="t" onclick="H(this)">13:50:58</span>                 narkisr </span><span>Yeap thats the route iv went with (the session is stored in atom which makes it possible) thanks for help</span></div><div id="t1605630974137100" t="2020-11-17 16:36:14 kvlt I&apos;m looking at the rules-dsl and came across  parse-query . The first argument is  params  . I was wondering what that construct is for?"><a href="#t1605630974137100" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-11-17</span> <span class="t" onclick="H(this)">16:36:14</span>                    kvlt </span><span>I&apos;m looking at the rules-dsl and came across </span><code>parse-query</code><span>. The first argument is </span><code>params</code><span> . I was wondering what that construct is for?</span></div><div id="t1605653050137600" t="2020-11-17 22:44:10 mikerod @petr I believe the doc for query mentions how params work"><a href="#t1605653050137600" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-11-17</span> <span class="t" onclick="H(this)">22:44:10</span>                 mikerod </span><span>@petr I believe the doc for query mentions how params work</span></div><div id="t1605653053137800" t="2020-11-17 22:44:13 mikerod Can’t look now"><a href="#t1605653053137800" onclick="S(this)">#</a><span class="u"><span class="t" onclick="D(this)">2020-11-17</span> <span class="t" onclick="H(this)">22:44:13</span>                 mikerod </span><span>Can’t look now</span></div></div></body>