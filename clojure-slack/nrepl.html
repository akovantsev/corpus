<!DOCTYPE html>
<head><title>nrepl</title><meta charset="UTF-8" /><style type="text/css">body {
    font-family: Monaco, Menlo, Consolas, "Courier New", sans-serif;
    font-size: 12px;
    margin: 15px;
}
h2 {text-align: center}
pre,
code {
    font-family: Monaco, Menlo, Consolas, "Courier New", monospace;
    color: #333;
    line-break: anywhere;
}
a {
    line-break: anywhere;
}
code {
    /*line-height: 1.2;*/
    white-space: normal;
    color: #c25;
    background-color: #f7f7f9;
    border: 1px solid #e1e1e8;
}
pre {
    margin: .5rem 0 .2rem;
    font-size: .75rem;
    /*line-height: 1.15rem;*/
    background: #fbfaf8;
    padding: .5rem;
    word-break: normal;
    display: block;
    border: 1px solid rgba(0, 0, 0, .15);
    white-space: pre-wrap;
    word-wrap: break-word;
    border-radius: 4px;
}
/*span {*/
z {
    white-space: pre-wrap;
}

d {padding-right: 8px;}
h {padding-right: 16px;}

w, r {
    margin-right: 10px;
    padding-right: 8px;
    text-align: right;
}

d,h,w,r {
    background-color: lavender;
    margin-top: 1px;
    display: inline-table; /* prevents doubleclick selection spillover into neighbour elements */
}

h:hover,
d:hover {
    text-decoration: underline;
    color: blue;
    cursor: row-resize;
}
d {padding-right: 8px;}
h {padding-right: 16px;}

z {display: block;}

z:target > r,
z:target > w,
z:target > d,
z:target > h {
    background-color: aquamarine
}

#filters-container {
    position: fixed;
    left: 50px;
    z-index: 1;
}
#filters-container > input {
    /*column:*/
    display: block;
    outline-color: aquamarine;
}

y {
    cursor: pointer;
    text-decoration: none;
    color: blue;
    position: absolute;
    left: 3px;
}

y:hover {
    text-decoration: underline;
    color: aquamarine;
}


</style></head><body><style id="css-username">w {min-width: 160px;} r {min-width: 192px;}</style><style id="css-text-filter"></style><style id="css-date-filter"></style><style id="css-filter-override"></style><p id="filters-container"><input id="text-filter" onkeyup="debtextfilter(this.value)" placeholder="filter text" type="string" /><button hidden="hidden" id="date-filter" onclick="cleardatefilter()"></button></p><h2>#nrepl</h2><pre><i>generated UTC: 2023-03-30 09:05</i><i>
latest data: <a href="https://clojurians-log.clojureverse.org/nrepl/2023-01-31">https://clojurians-log.clojureverse.org/nrepl/2023-01-31</a></i><i>
messages: 2936</i>
pro tips:
* Double click on text to filter by it. (doubleclick + cmd-f for extra points).
* Click on date to keep day visible regardless of filter.
* Click on time to keep hour visible regardless of filter.</pre><script>const textFilterInput = document.getElementById("text-filter");
const dateFilterInput = document.getElementById("date-filter");
const filterTextStyle = document.getElementById("css-text-filter");
const filterDateStyle = document.getElementById("css-date-filter");
const filterStyleOverride = document.getElementById("css-filter-override");



function textFilter2(text) {
    var style = '';
    if (text.trim() !== '') {
        text.split(' ').forEach(function (t) {
            if (t !== '') {
                style = style + "z:not([t*='" + t + "' i]) {display: none; opacity: 0.6}";
            }
        });
    }
    filterTextStyle.innerHTML = style;
}
function textFilter(text) {
    filterTextStyle.innerHTML = "";
    if (text.trim() !== '') {
        var sections = document.getElementsByTagName("g");
        var sectionsArr = Array.prototype.slice.call(sections);
        sectionsArr.forEach(function (s){
            var sid = s.getAttribute("id");
            text.split(' ').forEach(function (t) {
                if (t !== '') {
                    filterTextStyle.innerHTML += "\ng#" + sid + " > z:not([t*='" + t + "' i]) {display: none; opacity: 0.6}";
                }
            });
        })
    }
}
function textFilter3(text) {
    console.time("text search");
    filterTextStyle.innerHTML = "";
    if (text.trim() !== '') {
        const re = new RegExp( text, "i");
        var sections = document.getElementsByTagName("g");
        var sectionsArr = Array.prototype.slice.call(sections);
        sectionsArr.forEach(function (w){
            var zs = w.getElementsByTagName ("z");
            var zsArr = Array.prototype.slice.call(zs);
            var ids = zsArr
                .filter(function (el) {
                    return !re.test(el.innerText);
                })
                .map(function (el){
                    return el.getAttribute("id");
                });
            if (ids) {
                filterTextStyle.innerHTML += "\n#" + ids.join(",#") + " {display: none; opacity: 0.6}";
            }
        })
    }
    console.timeEnd("text search");
}


function filterSelection (e) {
    let sel = document.getSelection();
    let txt = sel.toString();
    textFilterInput.value = (txt || "");
    textFilter(txt);
}
function debounce1(callback, delay) {
    let timeout;
    return function(arg) {
        clearTimeout(timeout);
        timeout = setTimeout(callback, delay, arg);
    }
}

function keyUp (e) {
    if (e.code === "KeyF" && e.ctrlKey) {
        let txt = document.getSelection().toString();
        if (txt.length > 0) {
            textFilterInput.value = (txt || "");
            textFilter(txt);
        }
    }
}


function showDateTimes (el, datestr, hourstr) {
    dateFilterInput.innerText = "clear: " + datestr + " " + hourstr;
    dateFilterInput.hidden = false;
    let ids = [];
    const clicked = el.parentElement;  // el = z#id/t
    ids.push(clicked.id);
    // var idbefore, idafter;
    let cursor = clicked;
    function nextCursor (cursor) {
        const id = (cursor && cursor.id);
        const d = (cursor && cursor.children[1]);
        const h = (cursor && cursor.children[2])
        if (id) {
            ids.push(id); //includes 1st next-id not matching date.
        } else {
            cursor = null;
        }
        if (d && (d.textContent === datestr) && (!hourstr || (h && h.textContent.startsWith(hourstr)))) {
        } else {
            cursor = null;
        }
        return cursor;
    }
    while (cursor) {
        cursor = nextCursor(cursor.previousElementSibling);
    }

    cursor = clicked;

    while (cursor) {
        cursor = nextCursor(cursor.nextElementSibling);
    }


    var style1 = '';
    var style2 = '';
    var content;
    if (datestr.includes(" ")) { //hour
        content = " *";
    } else {
        content = "**";
    }
    ids.forEach(function (id) {
        if (id) {
            style1 = style1 + ", #" + id;
            style2 = style2 + ", #" + id + " h:after";
        }
    })
    if (style1) {
        style1 = style1.substring(1) + " {display: block !important}";
    }
    if (style2) {
        style2 = style2.substring(1) + " {content: \"" + content + "\"; position: absolute}"
    }
    filterDateStyle.innerHTML = style1 + "\n" + style2;
}

// https://developer.mozilla.org/en-US/docs/Web/API/Element/scrollIntoView
function filterDay (el) {
    showDateTimes(el, el.textContent);
    el.scrollIntoView({behavior: "smooth", block: "center", inline: "center"});
}

function filterHours (el) {
    showDateTimes(el, el.previousElementSibling.textContent, el.textContent.substring(0, 2));
    el.scrollIntoView({behavior: "smooth", block: "center", inline: "center"});
}

function forceShowSelected (el) {
    var id = el.parentElement.id
    if (id) {
        window.location.hash = "#" + id;
        filterStyleOverride.innerHTML = ""
            + "#" + id
            + " {display: block !important;}"
            + "#" + id + " h:after"
            + " {content: \"  #\"; position: absolute}";

    } else {
        window.location.hash = "";
        filterStyleOverride.innerHTML = "";
    }
}


function cleardatefilter () {
    dateFilterInput.hidden = true;
    dateFilterInput.innerText = "";
    filterDateStyle.innerHTML = "";
}

const debtextfilter = debounce1(textFilter, 200);

function doubleClick (e) {
    if (e.target.tagName !== "INPUT"
        && e.target.tagName !== "D"
        && e.target.tagName !== "H") {

        filterSelection();
        e.target.scrollIntoView({behavior: "auto", block: "center", inline: "start"});
    }
}

function onclick(e) {
    if (e.target.tagName === "Y") {
        e.preventDefault();
        forceShowSelected(e.target);
    } else if (e.target.tagName === "D") {
        e.preventDefault();
        filterDay(e.target);
    } else if (e.target.tagName === "H") {
        e.preventDefault();
        filterHours(e.target);
    }
}

document.onclick = onclick;
document.ondblclick = doubleClick;
document.onkeyup = keyUp;
textFilterInput.focus();
</script><div><g id="s0"><z id="t1462904625" t="bassam.khouri Hi."><y>#</y><d>2016-05-10</d><h>18:23</h><w>bassam.khouri</w>Hi.</z><z id="t1462904637" t="bassam.khouri I&apos;m new to clojure and am in the learning stages. I encountered an error and am unsure how to solve it. In one project, I have a function where I&apos;m invoking a command on a remote REPL. The command on the remote REPL returns a tagged object #object[com.example.namespace.DoubleEntity 0x5359c6c8 &quot;{:mykey \&quot;value\&quot;, :mykey2 \&quot;value2\&quot; }&quot;] .. But my function is returning the following error: RuntimeException No reader function for tag object clojure.lang.LispReader$CtorReader.readTagged (LispReader.java:1245) . Any ideas how I can get my project&apos;s reader to properly read this object?"><y>#</y><d>2016-05-10</d><h>18:23</h><w>bassam.khouri</w>I&apos;m new to clojure and am in the learning stages.  I encountered an error and am unsure how to solve it.  In one project, I have a function where I&apos;m invoking a command on a remote REPL.  The command on the remote REPL returns a tagged object <code>#object[com.example.namespace.DoubleEntity 0x5359c6c8 &quot;{:mykey \&quot;value\&quot;, :mykey2 \&quot;value2\&quot; }&quot;]</code>.. But my function is returning the following error: <code>RuntimeException No reader function for tag object  clojure.lang.LispReader$CtorReader.readTagged (LispReader.java:1245)</code>.   Any ideas how I can get my project&apos;s reader to properly read this object?</z><z id="t1462904825" t="andmed I&apos;ve made this channel by mistake.. there is noone in here. Post to main forum. Sorry about that..."><y>#</y><d>2016-05-10</d><h>18:27</h><w>andmed</w>I&apos;ve made this channel by mistake.. there is noone in here. Post to main forum. Sorry about that...</z><z id="t1486831860" t="dottedmag I see socket-based REPL contrasted to nREPL in several places (like here: https://github.com/bhauman/lein-figwheel/wiki/Using-the-Figwheel-REPL-within-NRepl ). Is it a false dichotomy, can nREPL server be started as a socket server under Clojure 1.8?"><y>#</y><d>2017-02-11</d><h>16:51</h><w>dottedmag</w>I see socket-based REPL contrasted to nREPL in several places (like here: <a href="https://github.com/bhauman/lein-figwheel/wiki/Using-the-Figwheel-REPL-within-NRepl" target="_blank">https://github.com/bhauman/lein-figwheel/wiki/Using-the-Figwheel-REPL-within-NRepl</a>). Is it a false dichotomy, can nREPL server be started as a socket server under Clojure 1.8?</z><z id="t1487011467" t="josh_tackett (set nil)"><y>#</y><d>2017-02-13</d><h>18:44</h><w>josh_tackett</w>(set nil)</z><z id="t1496195116" t="mikera Hi all - anyone have an example of how to take over an existing nREPL session?"><y>#</y><d>2017-05-31</d><h>01:45</h><w>mikera</w>Hi all - anyone have an example of how to take over an existing nREPL session?</z><z id="t1496195328" t="mikera Use case is roughly - I have an existing nREPL session - I want to replace the handler with my own custom handler, so that I can get the user input as a String - A response can be constructed and returned to the session user"><y>#</y><d>2017-05-31</d><h>01:48</h><w>mikera</w>Use case is roughly
- I have an existing nREPL session
- I want to replace the handler with my own custom handler, so that I can get the user input as a String
- A response can be constructed and returned to the session user</z><z id="t1505127192" t="odie Can anybody give me some pointers on how to develop a nrepl middleware?"><y>#</y><d>2017-09-11</d><h>10:53</h><w>odie</w>Can anybody give me some pointers on how to develop a nrepl middleware?</z><z id="t1505127499" t="odie More specifically, even though I can get the right response back when I submit an nrepl message like {:op &quot;eval&quot; :code &quot;(+ 2 3)&quot;}, a simple {:op &quot;describe&quot;} would return nothing."><y>#</y><d>2017-09-11</d><h>10:58</h><w>odie</w>More specifically, even though I can get the right response back when I submit an nrepl message like {:op &quot;eval&quot; :code &quot;(+ 2 3)&quot;}, a simple {:op &quot;describe&quot;} would return nothing.</z><z id="t1505127608" t="odie I had expected to be able to see a list of nrepl messages that can be handled. :("><y>#</y><d>2017-09-11</d><h>11:00</h><w>odie</w>I had expected to be able to see a list of nrepl messages that can be handled. :(</z><z id="t1505127623" t="odie Any help would be appreciated!"><y>#</y><d>2017-09-11</d><h>11:00</h><w>odie</w>Any help would be appreciated!</z><z id="t1512557944" t="andrea.crotti hi guys! I noticed that https://github.com/clojure/tools.nrepl still mentions clojure.contrib in the CONTRIBUTING.md file, and doesn&apos;t have issues enabled"><y>#</y><d>2017-12-06</d><h>10:59</h><w>andrea.crotti</w>hi guys! I noticed that <a href="https://github.com/clojure/tools.nrepl" target="_blank">https://github.com/clojure/tools.nrepl</a>
still mentions clojure.contrib in the CONTRIBUTING.md file, and doesn&apos;t have issues enabled</z><z id="t1512557974" t="andrea.crotti we should not report on Jira for that project now that it&apos;s out of clojure.contrib right?"><y>#</y><d>2017-12-06</d><h>10:59</h><w>andrea.crotti</w>we should not report on Jira for that project now that it&apos;s out of clojure.contrib right?</z><z id="t1517919089" t="bozhidar [:attrs {:href &quot;/_/_/users/U09A6U6GJ&quot;}] I guess you get this often these days, but do you have any idea when can we expect the nREPL 0.3.0 so we can finally start pushing things forward once itâ€™s out?"><y>#</y><d>2018-02-06</d><h>12:11</h><w>bozhidar</w><a>@cemerick</a> I guess you get this often these days, but do you have any idea when can we expect the nREPL 0.3.0 so we can finally start pushing things forward once itâ€™s out?</z><z id="t1517919111" t="bozhidar Ops, this was unexpected. ðŸ™‚"><y>#</y><d>2018-02-06</d><h>12:11</h><w>bozhidar</w>Ops, this was unexpected. <b>ðŸ™‚</b></z><z id="t1519687753" t="unwarysage Hello all. I am attempting to make a middleware to modify error messages, and am having trouble figuring out how set-descriptor!`` can be used to get access to error messages before pr-values converts them into strings. Any advice appreciated"><y>#</y><d>2018-02-26</d><h>23:29</h><w>unwarysage</w>Hello all. I am attempting to make a middleware to modify error messages, and am having trouble figuring out how <code></code>set-descriptor!`` can be used to get access to error messages before pr-values converts them into strings. Any advice appreciated</z><z id="t1519691589" t="unwarysage"><y>#</y><d>2018-02-27</d><h>00:33</h><w>unwarysage</w></z><z id="t1519691601" t="hiredman pr-values isn&apos;t what turns them in to strings"><y>#</y><d>2018-02-27</d><h>00:33</h><w>hiredman</w>pr-values isn&apos;t what turns them in to strings</z><z id="t1519691603" t="unwarysage"><y>#</y><d>2018-02-27</d><h>00:33</h><w>unwarysage</w></z><z id="t1519691640" t="unwarysage [:attrs {:href &quot;/_/_/users/U0NCTKEV8&quot;}] are you thinking of bencode?"><y>#</y><d>2018-02-27</d><h>00:34</h><w>unwarysage</w><a>@hiredman</a> are you thinking of bencode?</z><z id="t1519691655" t="hiredman no"><y>#</y><d>2018-02-27</d><h>00:34</h><w>hiredman</w>no</z><z id="t1519691664" t="unwarysage"><y>#</y><d>2018-02-27</d><h>00:34</h><w>unwarysage</w></z><z id="t1519691669" t="hiredman interruptible-eval does"><y>#</y><d>2018-02-27</d><h>00:34</h><w>hiredman</w>interruptible-eval does</z><z id="t1519691704" t="hiredman it catches exceptions when evaling and sends them back as the error nrepl message with stirng values"><y>#</y><d>2018-02-27</d><h>00:35</h><w>hiredman</w>it catches exceptions when evaling and sends them back as the error nrepl message with stirng values</z><z id="t1519691755" t="hiredman likely the easiest thing to do would be to have your middleware watch for error nrepl messages and then eval *1 to get the error object (before pr-values)"><y>#</y><d>2018-02-27</d><h>00:35</h><w>hiredman</w>likely the easiest thing to do would be to have your middleware watch for error nrepl messages and then eval *1 to get the error object (before pr-values)</z><z id="t1519691774" t="hiredman pr-values only applies to the results of normal execution"><y>#</y><d>2018-02-27</d><h>00:36</h><w>hiredman</w>pr-values only applies to the results of normal execution</z><z id="t1519691793" t="unwarysage this is invaluable to me."><y>#</y><d>2018-02-27</d><h>00:36</h><w>unwarysage</w>this is invaluable to me.</z><z id="t1519691798" t="unwarysage Thank you very much"><y>#</y><d>2018-02-27</d><h>00:36</h><w>unwarysage</w>Thank you very much</z><z id="t1519691990" t="unwarysage okay, follow up question. I have never seen a :ex keyword in a response, it&apos;s always been a string in :err"><y>#</y><d>2018-02-27</d><h>00:39</h><w>unwarysage</w>okay, follow up question. I have never seen a <code>:ex</code> keyword in a response, it&apos;s always been a string in <code>:err</code></z><z id="t1519692297" t="unwarysage what makes :err"><y>#</y><d>2018-02-27</d><h>00:44</h><w>unwarysage</w>what makes <code>:err</code></z><z id="t1519692359" t="hiredman :err is a message printed to *err* not an exception"><y>#</y><d>2018-02-27</d><h>00:45</h><w>hiredman</w>:err is a message printed to <code>*err*</code> not an exception</z><z id="t1519692368" t="hiredman :err is like stderr"><y>#</y><d>2018-02-27</d><h>00:46</h><w>hiredman</w>:err is like stderr</z><z id="t1519692381" t="hiredman :out is like stdout"><y>#</y><d>2018-02-27</d><h>00:46</h><w>hiredman</w>:out is like stdout</z><z id="t1519692416" t="unwarysage okay, and I have messages coming back with :err , so and no :ex so I did not think it was that simple"><y>#</y><d>2018-02-27</d><h>00:46</h><w>unwarysage</w>okay, and I have messages coming back with <code>:err</code>, so and no <code>:ex</code> so I did not think it was that simple</z><z id="t1519692488" t="hiredman you can generate :err s by (binding [*out* *err*] (println &quot;foo&quot;))"><y>#</y><d>2018-02-27</d><h>00:48</h><w>hiredman</w>you can generate <code>:err</code>s by <code>(binding [*out* *err*] (println &quot;foo&quot;))</code></z><z id="t1519692515" t="hiredman and running code can do it at anytime without bubbling up an exception anywhere, or even throwing an exception"><y>#</y><d>2018-02-27</d><h>00:48</h><w>hiredman</w>and running code can do it at anytime without bubbling up an exception anywhere, or even throwing an exception</z><z id="t1519693115" t="unwarysage yes! this was exactly what I needed. Thank you very much [:attrs {:href &quot;/_/_/users/U0NCTKEV8&quot;}]"><y>#</y><d>2018-02-27</d><h>00:58</h><w>unwarysage</w>yes! this was exactly what I needed. Thank you very much <a>@hiredman</a></z><z id="t1520266987" t="raymcdermott hello nreplers"><y>#</y><d>2018-03-05</d><h>16:23</h><w>raymcdermott</w>hello nreplers</z><z id="t1520267025" t="raymcdermott I am trying to write some middleware and have followed the excellent guide from lambdaisland"><y>#</y><d>2018-03-05</d><h>16:23</h><w>raymcdermott</w>I am trying to write  some middleware and have followed the excellent guide from lambdaisland</z><z id="t1520267048" t="raymcdermott https://lambdaisland.com/guides/clojure-repls/introduction"><y>#</y><d>2018-03-05</d><h>16:24</h><w>raymcdermott</w><a href="https://lambdaisland.com/guides/clojure-repls/introduction" target="_blank">https://lambdaisland.com/guides/clojure-repls/introduction</a></z><z id="t1520267072" t="raymcdermott when working through the first example, it all works"><y>#</y><d>2018-03-05</d><h>16:24</h><w>raymcdermott</w>when working through the first example, it all works</z><z id="t1520267082" t="raymcdermott but I get a WARNING"><y>#</y><d>2018-03-05</d><h>16:24</h><w>raymcdermott</w>but I get a WARNING</z><z id="t1520267152" t="raymcdermott from this code"><y>#</y><d>2018-03-05</d><h>16:25</h><w>raymcdermott</w>from this code</z><z id="t1520267198" t="raymcdermott like I say, it works"><y>#</y><d>2018-03-05</d><h>16:26</h><w>raymcdermott</w>like I say, it works</z><z id="t1520267230" t="raymcdermott but even looking at the clojure.tools.nrepl code I cannot see where I am going wonky"><y>#</y><d>2018-03-05</d><h>16:27</h><w>raymcdermott</w>but even looking at the <code>clojure.tools.nrepl</code> code I cannot see where I am going wonky</z><z id="t1520270052" t="hiredman it is likely where you are actually starting the nrepl server"><y>#</y><d>2018-03-05</d><h>17:14</h><w>hiredman</w>it is likely where you are actually starting the nrepl server</z><z id="t1520270090" t="hiredman it looks like you are passing in a function object created with comp somewhere instead of a var"><y>#</y><d>2018-03-05</d><h>17:14</h><w>hiredman</w>it looks like you are passing in a function object created with comp somewhere instead of a var</z><z id="t1520328637" t="raymcdermott ah, ok Iâ€™ll double checkâ€¦ thanks"><y>#</y><d>2018-03-06</d><h>09:30</h><w>raymcdermott</w>ah, ok Iâ€™ll double checkâ€¦ thanks</z><z id="t1520339872" t="raymcdermott hah, yes should have been #&apos;wrap-classpath"><y>#</y><d>2018-03-06</d><h>12:37</h><w>raymcdermott</w>hah, yes should have been <code>#&apos;wrap-classpath</code></z><z id="t1520347833" t="bozhidar [:attrs {:href &quot;/_/_/users/U04V5V0V4&quot;}] Whatâ€™s the middleware youâ€™re working on?"><y>#</y><d>2018-03-06</d><h>14:50</h><w>bozhidar</w><a>@raymcdermott</a> Whatâ€™s the middleware youâ€™re working on?</z><z id="t1520347932" t="raymcdermott I want to have the ability for two (or more) developers to follow each otherâ€™s sessions"><y>#</y><d>2018-03-06</d><h>14:52</h><w>raymcdermott</w>I want to have the ability for two (or more) developers to follow each otherâ€™s sessions</z><z id="t1520347961" t="raymcdermott I looked out there are and thereâ€™s nothing to help yet"><y>#</y><d>2018-03-06</d><h>14:52</h><w>raymcdermott</w>I looked out there are and thereâ€™s nothing to help yet</z><z id="t1520348002" t="raymcdermott there is a small project called concerto but itâ€™s abandonware and also doesnâ€™t do what I need"><y>#</y><d>2018-03-06</d><h>14:53</h><w>raymcdermott</w>there is a small project called <code>concerto</code> but itâ€™s abandonware and also doesnâ€™t do what I need</z><z id="t1520348029" t="raymcdermott unless you [:attrs {:href &quot;/_/_/users/U051BLM8F&quot;}] know better ðŸ˜‰"><y>#</y><d>2018-03-06</d><h>14:53</h><w>raymcdermott</w>unless you <a>@bozhidar</a> know better <b>ðŸ˜‰</b></z><z id="t1520348077" t="raymcdermott goal it to connect this up with a web UI but should also be open for people to write editor bindings too"><y>#</y><d>2018-03-06</d><h>14:54</h><w>raymcdermott</w>goal it to connect this up with a web UI but should also be open for people to write editor bindings too</z><z id="t1520348085" t="raymcdermott but that wonâ€™t be me"><y>#</y><d>2018-03-06</d><h>14:54</h><w>raymcdermott</w>but that wonâ€™t be me</z><z id="t1520348125" t="raymcdermott I also want to be able to connect to a CLJ or CLJS backend depending on user choice and that seems quite simple"><y>#</y><d>2018-03-06</d><h>14:55</h><w>raymcdermott</w>I also want to be able to connect to a CLJ or CLJS backend depending on user choice and that seems quite simple</z><z id="t1520348326" t="raymcdermott tbh Iâ€™m not sure if I will go the nrepl way or the unrepl way â€¦ the latter seems simpler"><y>#</y><d>2018-03-06</d><h>14:58</h><w>raymcdermott</w>tbh Iâ€™m not sure if I will go the nrepl way or the unrepl way â€¦ the latter seems simpler</z><z id="t1520348359" t="raymcdermott Iâ€™ll shut up now though cos Iâ€™m still struggling with the baby steps ðŸ™‚"><y>#</y><d>2018-03-06</d><h>14:59</h><w>raymcdermott</w>Iâ€™ll shut up now though cos Iâ€™m still struggling with the baby steps <b>ðŸ™‚</b></z><z id="t1520348835" t="bozhidar I donâ€™t quite understand whatâ€™s the end goal - what does it mean to follow each otherâ€™s sessions?"><y>#</y><d>2018-03-06</d><h>15:07</h><w>bozhidar</w>I donâ€™t quite understand whatâ€™s the end goal - what does it mean to follow each otherâ€™s sessions?</z><z id="t1520348894" t="raymcdermott maybe I explained it badly, I mean to share the REPL of another user"><y>#</y><d>2018-03-06</d><h>15:08</h><w>raymcdermott</w>maybe I explained it badly, I mean to share the REPL of another user</z><z id="t1520348909" t="bozhidar I see."><y>#</y><d>2018-03-06</d><h>15:08</h><w>bozhidar</w>I see.</z><z id="t1520348919" t="raymcdermott for example their history and the symbols they have defâ€™d"><y>#</y><d>2018-03-06</d><h>15:08</h><w>raymcdermott</w>for example their history and the symbols they have defâ€™d</z><z id="t1520348927" t="bozhidar And everyone connected gets the same state."><y>#</y><d>2018-03-06</d><h>15:08</h><w>bozhidar</w>And everyone connected gets the same state.</z><z id="t1520348947" t="raymcdermott thatâ€™s where it gets tricky but ideally yes"><y>#</y><d>2018-03-06</d><h>15:09</h><w>raymcdermott</w>thatâ€™s where it gets tricky but ideally yes</z><z id="t1520349017" t="raymcdermott but Iâ€™m also thinking that each user should have their own state that can be augmented by the other users"><y>#</y><d>2018-03-06</d><h>15:10</h><w>raymcdermott</w>but Iâ€™m also thinking that each user should have their own state that can be augmented by the other users</z><z id="t1520349050" t="raymcdermott maybe if I def a and the other person defâ€™s a â€¦ should they win?"><y>#</y><d>2018-03-06</d><h>15:10</h><w>raymcdermott</w>maybe if I def a and the other person defâ€™s a â€¦ should they win?</z><z id="t1520349078" t="raymcdermott or should I retain my a?"><y>#</y><d>2018-03-06</d><h>15:11</h><w>raymcdermott</w>or should I retain my a?</z><z id="t1520349098" t="raymcdermott cos as usual with state â€¦ itâ€™s a nightmare"><y>#</y><d>2018-03-06</d><h>15:11</h><w>raymcdermott</w>cos as usual with state â€¦ itâ€™s a nightmare</z><z id="t1520349125" t="raymcdermott and a model thatâ€™s more accretive might be better / more sane for the users to follow"><y>#</y><d>2018-03-06</d><h>15:12</h><w>raymcdermott</w>and a model thatâ€™s more accretive might be better / more sane for the users to follow</z><z id="t1520349137" t="raymcdermott tbh I think I need to experiment with it"><y>#</y><d>2018-03-06</d><h>15:12</h><w>raymcdermott</w>tbh I think I need to experiment with it</z><z id="t1520349141" t="raymcdermott and see what works"><y>#</y><d>2018-03-06</d><h>15:12</h><w>raymcdermott</w>and see what works</z><z id="t1523819932" t="mathpunk I&apos;m learning to work with cognitect/transcriptor and I&apos;m getting unexpected behavior using it in the repl: https://clojurians.slack.com/files/U0E9KE222/FA6D9ATA4/-.clj"><y>#</y><d>2018-04-15</d><h>19:18</h><w>mathpunk</w>I&apos;m learning to work with <code>cognitect/transcriptor</code> and I&apos;m getting unexpected behavior using it in the repl: <a href="https://clojurians.slack.com/files/U0E9KE222/FA6D9ATA4/-.clj" target="_blank">https://clojurians.slack.com/files/U0E9KE222/FA6D9ATA4/-.clj</a></z><z id="t1523819982" t="mathpunk If I evaluate it form by form, or as a region, the check! expression returns nil, as expected. But if I send the buffer, I get"><y>#</y><d>2018-04-15</d><h>19:19</h><w>mathpunk</w>If I evaluate it form by form, or as a region, the <code>check!</code> expression returns nil, as expected. But if I send the buffer, I get</z><z id="t1524253487" t="unwarysage Heyo. I have a question. it seems that the view of messages in nREPL varies depending on whether I looking at them from a middleware, or from a client"><y>#</y><d>2018-04-20</d><h>19:44</h><w>unwarysage</w>Heyo. I have a question. it seems that the view of messages in nREPL varies depending on whether I looking at them from a middleware, or from a client</z><z id="t1524253530" t="unwarysage I&apos;m trying to write a function that takes a piece of code as a string and evaulates it, returning all nREPL messages related to it&apos;s evauluation"><y>#</y><d>2018-04-20</d><h>19:45</h><w>unwarysage</w>I&apos;m trying to write a function that takes a piece of code as a string and evaulates it, returning all nREPL messages related to it&apos;s evauluation</z><z id="t1524253549" t="unwarysage And for standard responses, it&apos;s fine"><y>#</y><d>2018-04-20</d><h>19:45</h><w>unwarysage</w>And for standard responses, it&apos;s fine</z><z id="t1524253577" t="unwarysage But anything sent to err or out doesn&apos;t seem to arrive on the client side"><y>#</y><d>2018-04-20</d><h>19:46</h><w>unwarysage</w>But anything sent to err or out doesn&apos;t seem to arrive on the client side</z><z id="t1524253616" t="unwarysage Which is unfortunate, because I am trying to write code for modifying error messages, and those don&apos;t show up"><y>#</y><d>2018-04-20</d><h>19:46</h><w>unwarysage</w>Which is unfortunate, because I am trying to write code for modifying error messages, and those don&apos;t show up</z><z id="t1524254611" t="hiredman *err* and *out* are thread local bindings, so writing to them will depend on what thread the writing to is occuring on"><y>#</y><d>2018-04-20</d><h>20:03</h><w>hiredman</w><code>*err*</code> and <code>*out*</code> are thread local bindings, so writing to them will depend on what thread the writing to is occuring on</z><z id="t1524254679" t="hiredman if in your server process you are spinning up some thread that somehow doesn&apos;t copy the repls values of *err* and *out* it will get the default values and nrepl won&apos;t be able to capture the output"><y>#</y><d>2018-04-20</d><h>20:04</h><w>hiredman</w>if in your server process you are spinning up some thread that somehow doesn&apos;t copy the repls values of <code>*err*</code> and <code>*out*</code> it will get the default values and nrepl won&apos;t be able to capture the output</z><z id="t1524254777" t="unwarysage So this is what I have. (defn trap-response [inp-code] (with-open [conn (repl/connect :port server-port)] (-&gt; (repl/client conn 1000) (repl/message {:op :eval :code inp-code}) doall))) "><y>#</y><d>2018-04-20</d><h>20:06</h><w>unwarysage</w>So this is what I have.
<pre>(defn trap-response [inp-code]
(with-open [conn (repl/connect :port server-port)]
     (-&gt; (repl/client conn 1000)
       (repl/message {:op :eval :code inp-code})
       doall)))
</pre></z><z id="t1524254792" t="unwarysage With some code to start an nREPL server preceding it"><y>#</y><d>2018-04-20</d><h>20:06</h><w>unwarysage</w>With some code to start an nREPL server preceding it</z><z id="t1524254826" t="unwarysage In the middleware I am trying to test, I know that :err exists"><y>#</y><d>2018-04-20</d><h>20:07</h><w>unwarysage</w>In the middleware I am trying to test, I know that <pre>:err</pre> exists</z><z id="t1524254959" t="unwarysage how can I copy the repl values of *err* ?"><y>#</y><d>2018-04-20</d><h>20:09</h><w>unwarysage</w>how can I copy the repl values of <pre>*err*</pre>?</z><z id="t1524255205" t="hiredman it will depend on what you are running and what inp-code is doing"><y>#</y><d>2018-04-20</d><h>20:13</h><w>hiredman</w>it will depend on what you are running and what inp-code is doing</z><z id="t1524255247" t="hiredman e.g. a new thread launched with say future does automatically inherit the initiating threads values of err and out (also any other dynamic vars bound)"><y>#</y><d>2018-04-20</d><h>20:14</h><w>hiredman</w>e.g. a new  thread launched with say <code>future</code> does automatically inherit the initiating threads values of err and out (also any other dynamic vars bound)</z><z id="t1524255306" t="hiredman if you are manually creating and starting a Thread object you will have do it yourself, the easiest way is likely to use bound-fn"><y>#</y><d>2018-04-20</d><h>20:15</h><w>hiredman</w>if you are manually creating and starting a Thread object you will have do it yourself, the easiest way is likely to use bound-fn</z><z id="t1524255331" t="unwarysage hmm"><y>#</y><d>2018-04-20</d><h>20:15</h><w>unwarysage</w>hmm</z><z id="t1524255341" t="unwarysage for the present I am not doing anyhting threaded"><y>#</y><d>2018-04-20</d><h>20:15</h><w>unwarysage</w>for the present I am not doing anyhting threaded</z><z id="t1524255347" t="hiredman oh, are you saying your middleware is seeing the messages with :err in them?"><y>#</y><d>2018-04-20</d><h>20:15</h><w>hiredman</w>oh, are you saying your middleware is seeing the messages with <code>:err</code> in them?</z><z id="t1524255358" t="unwarysage Yeah"><y>#</y><d>2018-04-20</d><h>20:15</h><w>unwarysage</w>Yeah</z><z id="t1524255371" t="unwarysage My middleware is attempting to improve java error messages"><y>#</y><d>2018-04-20</d><h>20:16</h><w>unwarysage</w>My middleware is attempting to improve java error messages</z><z id="t1524255375" t="hiredman just somewhere between your middleware and the client the message is getting dropped"><y>#</y><d>2018-04-20</d><h>20:16</h><w>hiredman</w>just somewhere between your middleware and the client the message is getting dropped</z><z id="t1524255404" t="hiredman is your middleware forwarding on the message correctly? is it throwing an error causing the error message to be swallowed?"><y>#</y><d>2018-04-20</d><h>20:16</h><w>hiredman</w>is your middleware forwarding on the message correctly? is it throwing an error causing the error message to be swallowed?</z><z id="t1524255411" t="unwarysage Yeah, and the error message comes through, but as a print, and not in right place"><y>#</y><d>2018-04-20</d><h>20:16</h><w>unwarysage</w>Yeah, and the error message comes through, but as a print, and not in right place</z><z id="t1524255430" t="hiredman what do you mean &quot;as a print&quot; and &quot;not in the right place&quot; ?"><y>#</y><d>2018-04-20</d><h>20:17</h><w>hiredman</w>what do you mean &quot;as a  print&quot; and &quot;not in the right place&quot; ?</z><z id="t1524255520" t="unwarysage one moment"><y>#</y><d>2018-04-20</d><h>20:18</h><w>unwarysage</w>one moment</z><z id="t1524255642" t="unwarysage Okay, so I run trap response and I get a list of nrepl messages back"><y>#</y><d>2018-04-20</d><h>20:20</h><w>unwarysage</w>Okay, so I run trap response and I get a list of nrepl messages back</z><z id="t1524255659" t="unwarysage But it also prints the modified error message"><y>#</y><d>2018-04-20</d><h>20:20</h><w>unwarysage</w>But it also prints the modified error message</z><z id="t1524255664" t="unwarysage so I get something like"><y>#</y><d>2018-04-20</d><h>20:21</h><w>unwarysage</w>so I get something like</z><z id="t1524255672" t="unwarysage teardown.core=&gt; (trap-response &quot;(banana)&quot;) Name banana is undefined. ({:ex &quot;class clojure.lang.Compiler$CompilerException&quot;, :id &quot;a71b6465-6515-4b66-801c-91daa498cdf8&quot;, :root-ex &quot;class clojure.lang.Compiler$CompilerException&quot;, :session &quot;50e928a8-2fed-44c9-adae-8404972586f1&quot;, :status [&quot;eval-error&quot;]} {:id &quot;a71b6465-6515-4b66-801c-91daa498cdf8&quot;, :session &quot;50e928a8-2fed-44c9-adae-8404972586f1&quot;, :status [&quot;done&quot;]}) teardown.core=&gt; "><y>#</y><d>2018-04-20</d><h>20:21</h><w>unwarysage</w><pre>teardown.core=&gt; (trap-response &quot;(banana)&quot;)
Name banana is undefined.
({:ex &quot;class clojure.lang.Compiler$CompilerException&quot;, :id &quot;a71b6465-6515-4b66-801c-91daa498cdf8&quot;, :root-ex &quot;class clojure.lang.Compiler$CompilerException&quot;, :session &quot;50e928a8-2fed-44c9-adae-8404972586f1&quot;, :status [&quot;eval-error&quot;]} {:id &quot;a71b6465-6515-4b66-801c-91daa498cdf8&quot;, :session &quot;50e928a8-2fed-44c9-adae-8404972586f1&quot;, :status [&quot;done&quot;]})
teardown.core=&gt; </pre></z><z id="t1524255703" t="hiredman oh, that isn&apos;t :err"><y>#</y><d>2018-04-20</d><h>20:21</h><w>hiredman</w>oh, that isn&apos;t <code>:err</code></z><z id="t1524255712" t="unwarysage okay"><y>#</y><d>2018-04-20</d><h>20:21</h><w>unwarysage</w>okay</z><z id="t1524255719" t="hiredman that is :ex , the exception value"><y>#</y><d>2018-04-20</d><h>20:21</h><w>hiredman</w>that is :ex , the exception value</z><z id="t1524255741" t="hiredman status :eval-error"><y>#</y><d>2018-04-20</d><h>20:22</h><w>hiredman</w>status :eval-error</z><z id="t1524255751" t="unwarysage yeah."><y>#</y><d>2018-04-20</d><h>20:22</h><w>unwarysage</w>yeah.</z><z id="t1524255778" t="hiredman that isn&apos;t output to *out* or *err* , that is the error result of the eval"><y>#</y><d>2018-04-20</d><h>20:22</h><w>hiredman</w>that isn&apos;t output to <code>*out*</code> or <code>*err*</code>, that is the error result of the eval</z><z id="t1524255780" t="unwarysage I would like to see an entry in my list of responses with that key"><y>#</y><d>2018-04-20</d><h>20:23</h><w>unwarysage</w>I would like to see an entry in my list of responses with that key</z><z id="t1524255800" t="hiredman are you just printing the message in your middleware?"><y>#</y><d>2018-04-20</d><h>20:23</h><w>hiredman</w>are you just printing the message in your middleware?</z><z id="t1524255805" t="unwarysage no"><y>#</y><d>2018-04-20</d><h>20:23</h><w>unwarysage</w>no</z><z id="t1524255823" t="hiredman what does trap-response do?"><y>#</y><d>2018-04-20</d><h>20:23</h><w>hiredman</w>what does trap-response do?</z><z id="t1524255853" t="unwarysage https://clojurians.slack.com/archives/C17JYSA3H/p1524254777000128 this is the definition of trap response"><y>#</y><d>2018-04-20</d><h>20:24</h><w>unwarysage</w><a href="https://clojurians.slack.com/archives/C17JYSA3H/p1524254777000128" target="_blank">https://clojurians.slack.com/archives/C17JYSA3H/p1524254777000128</a>
this is the definition of trap response</z><z id="t1524255912" t="hiredman and what does your middleware do? are you running the repl server in the same jvm as you are running trap-response?"><y>#</y><d>2018-04-20</d><h>20:25</h><w>hiredman</w>and what does your middleware do? are you running the repl server in the same jvm as you are running trap-response?</z><z id="t1524255950" t="unwarysage my middleware takes the value of :err and changes it. Eventually I hope to gain access to the exception object, but for the moment I am parsing string to string"><y>#</y><d>2018-04-20</d><h>20:25</h><w>unwarysage</w>my middleware takes the value of :err and changes it. Eventually I hope to gain access to the exception object, but for the moment I am parsing string to string</z><z id="t1524255995" t="hiredman are you sure you aren&apos;t just printing out the string in the middleware? it looks a lot like you are"><y>#</y><d>2018-04-20</d><h>20:26</h><w>hiredman</w>are you sure you aren&apos;t just printing out the string in the middleware? it looks a lot like you are</z><z id="t1524256033" t="hiredman I am not sure that an error like that results in anything coming back with :errr set"><y>#</y><d>2018-04-20</d><h>20:27</h><w>hiredman</w>I am not sure that an error like that results in anything coming back with <code>:errr</code> set</z><z id="t1524256046" t="hiredman I think you just get the :ex"><y>#</y><d>2018-04-20</d><h>20:27</h><w>hiredman</w>I think you just get the <code>:ex</code></z><z id="t1524256048" t="unwarysage no, there are no prints in my middleware"><y>#</y><d>2018-04-20</d><h>20:27</h><w>unwarysage</w>no, there are no prints in my middleware</z><z id="t1524256095" t="unwarysage middleware wraps the transport function in incoming messages, so that post eval this code is run"><y>#</y><d>2018-04-20</d><h>20:28</h><w>unwarysage</w>middleware wraps the transport function in incoming messages, so that post eval this code is run</z><z id="t1524256115" t="unwarysage (defn modify-errors &quot;takes a nREPL response, and returns a message with the errors fixed&quot; [inp-message] (if (contains? inp-message :err) (assoc inp-message :err (m-obj/get-all-text (:msg-info-obj (p-exc/process-spec-errors (inp-message :err))))) inp-message))"><y>#</y><d>2018-04-20</d><h>20:28</h><w>unwarysage</w><pre>(defn modify-errors &quot;takes a nREPL response, and returns a message with the errors fixed&quot;
  [inp-message]
  (if (contains? inp-message :err)
    (assoc inp-message :err (m-obj/get-all-text (:msg-info-obj (p-exc/process-spec-errors (inp-message :err)))))
    inp-message))</pre></z><z id="t1524256175" t="hiredman I am looking at the interruptible-eval middleware right now, and when an exception is thrown it doesn&apos;t set :err , you get back the :ex message"><y>#</y><d>2018-04-20</d><h>20:29</h><w>hiredman</w>I  am looking at the interruptible-eval middleware right now, and when an exception is thrown it doesn&apos;t set <code>:err</code>, you get back the <code>:ex</code> message</z><z id="t1524256216" t="unwarysage and yet my middleware works. I don&apos;t mean to be obtuse, but in developping the middleware I never got access to the :ex message"><y>#</y><d>2018-04-20</d><h>20:30</h><w>unwarysage</w>and yet my middleware works. I don&apos;t mean to be obtuse, but in developping the middleware I never got access to the <pre>:ex</pre> message</z><z id="t1524256250" t="hiredman how recently have you restarted your repl?"><y>#</y><d>2018-04-20</d><h>20:30</h><w>hiredman</w>how recently have you restarted your repl?</z><z id="t1524256288" t="unwarysage fresh for these commands"><y>#</y><d>2018-04-20</d><h>20:31</h><w>unwarysage</w>fresh for these commands</z><z id="t1524256303" t="unwarysage Fresh everytime I touched the middleware"><y>#</y><d>2018-04-20</d><h>20:31</h><w>unwarysage</w>Fresh everytime I touched the middleware</z><z id="t1524256348" t="hiredman I would put in some printlns in each branch of that if to see which branch is actually getting taken"><y>#</y><d>2018-04-20</d><h>20:32</h><w>hiredman</w>I would put in some printlns in each branch of that if to see which branch is actually getting taken</z><z id="t1524256385" t="unwarysage https://github.com/UnwarySage/babel/tree/demo-work/src/babel"><y>#</y><d>2018-04-20</d><h>20:33</h><w>unwarysage</w><a href="https://github.com/UnwarySage/babel/tree/demo-work/src/babel" target="_blank">https://github.com/UnwarySage/babel/tree/demo-work/src/babel</a></z><z id="t1524256390" t="unwarysage This is the code"><y>#</y><d>2018-04-20</d><h>20:33</h><w>unwarysage</w>This is the code</z><z id="t1524256410" t="unwarysage and I know which branch is being taken, because I can see the transformed error messages"><y>#</y><d>2018-04-20</d><h>20:33</h><w>unwarysage</w>and I know which branch is being taken, because I can see the transformed error messages</z><z id="t1524256495" t="hiredman no, you are seeing some printlns"><y>#</y><d>2018-04-20</d><h>20:34</h><w>hiredman</w>no, you are seeing some printlns</z><z id="t1524256518" t="unwarysage okay. I am confused but attentive"><y>#</y><d>2018-04-20</d><h>20:35</h><w>unwarysage</w>okay. I am confused but attentive</z><z id="t1524256604" t="hiredman you are seeing some output that sort of looks like it matches what in some circumstances might match what you would get if your middelware is running"><y>#</y><d>2018-04-20</d><h>20:36</h><w>hiredman</w>you  are seeing some output that sort of looks like it matches what in some circumstances might match what you would get if your middelware is running</z><z id="t1524256659" t="hiredman but that doesn&apos;t actually prove that it is, so you need to prove that it is, and prove that is running the way you expect"><y>#</y><d>2018-04-20</d><h>20:37</h><w>hiredman</w>but that doesn&apos;t actually prove that it is, so you need to prove that it is, and prove that is running the way you expect</z><z id="t1524256678" t="hiredman you may also have an easier time debugging this kind of thing if you run the client and the server in different jvms"><y>#</y><d>2018-04-20</d><h>20:37</h><w>hiredman</w>you may also have an easier time debugging this kind of thing if you run the client and the server in different jvms</z><z id="t1524256697" t="unwarysage I can do that."><y>#</y><d>2018-04-20</d><h>20:38</h><w>unwarysage</w>I can do that.</z><z id="t1524256786" t="unwarysage Well, I can connect to the babel jvm"><y>#</y><d>2018-04-20</d><h>20:39</h><w>unwarysage</w>Well, I can connect to the babel jvm</z><z id="t1524256828" t="hiredman what do you mean by that?"><y>#</y><d>2018-04-20</d><h>20:40</h><w>hiredman</w>what do you mean by that?</z><z id="t1524256877" t="unwarysage I am unsure of how to connect to a nREPL server using the middleware"><y>#</y><d>2018-04-20</d><h>20:41</h><w>unwarysage</w>I am unsure of how to connect to a nREPL server using the middleware</z><z id="t1524256885" t="hiredman I mean, you have two jvms, on running an nrepl server with your middleware, a second running an nrepl server without your middleware, you nrepl into the second and run trap-response"><y>#</y><d>2018-04-20</d><h>20:41</h><w>hiredman</w>I mean, you have two jvms, on running an nrepl server with your middleware, a second running an nrepl server without your middleware, you nrepl into the second and run trap-response</z><z id="t1524256893" t="hiredman (connecting to the first)"><y>#</y><d>2018-04-20</d><h>20:41</h><w>hiredman</w>(connecting to the first)</z><z id="t1524256903" t="unwarysage will try"><y>#</y><d>2018-04-20</d><h>20:41</h><w>unwarysage</w>will try</z><z id="t1524256929" t="hiredman where you see the message printed out will tell you if it is being printed in the client side or the server side"><y>#</y><d>2018-04-20</d><h>20:42</h><w>hiredman</w>where you see the message printed out will tell you if it is being printed in the client side or the server side</z><z id="t1524256944" t="hiredman it is almost certainly on the server side"><y>#</y><d>2018-04-20</d><h>20:42</h><w>hiredman</w>it is almost certainly on the server side</z><z id="t1524256967" t="unwarysage IIRC it is, that was what I meant when I said &quot;in the wrong place&quot;"><y>#</y><d>2018-04-20</d><h>20:42</h><w>unwarysage</w>IIRC it is, that was what I meant when I said &quot;in the wrong place&quot;</z><z id="t1524257014" t="hiredman if you are satisfied that you have proved to yourself that it is printing on the server side, then you can start looking at the code being run on the server side"><y>#</y><d>2018-04-20</d><h>20:43</h><w>hiredman</w>if you are satisfied that you have proved to yourself that it is printing on the server side, then you can start looking at the code being run on the server side</z><z id="t1524257020" t="hiredman are you aot compiling?"><y>#</y><d>2018-04-20</d><h>20:43</h><w>hiredman</w>are you aot compiling?</z><z id="t1524257052" t="unwarysage No."><y>#</y><d>2018-04-20</d><h>20:44</h><w>unwarysage</w>No.</z><z id="t1524257096" t="hiredman what I am getting at there is, is the code you think you are running what is actually running, aot compilation can be a culprit there, but I&apos;ve seen people have multiple copies of the src directory and edit the wrong one, or forget to save the file, or whatever"><y>#</y><d>2018-04-20</d><h>20:44</h><w>hiredman</w>what I am getting at there is, is the code you think you are running what is actually running, aot compilation can be a culprit there, but I&apos;ve seen people have multiple copies of the src directory and edit the wrong one, or forget to save the file, or whatever</z><z id="t1524257125" t="unwarysage Okay, so launching one repl with middleware, connecting a second one to it, defining and running trap response in the second one gets me a modified error message and the return list of messages, both in the second repl"><y>#</y><d>2018-04-20</d><h>20:45</h><w>unwarysage</w>Okay, so launching one repl with middleware, connecting a second one to it, defining and running trap response in the second one gets me a modified error message and the return list of messages, both in the second repl</z><z id="t1524257146" t="hiredman interesting"><y>#</y><d>2018-04-20</d><h>20:45</h><w>hiredman</w>interesting</z><z id="t1524257156" t="unwarysage waitaminute."><y>#</y><d>2018-04-20</d><h>20:45</h><w>unwarysage</w>waitaminute.</z><z id="t1524257196" t="unwarysage trap-response launches a third repl server and sends things to it for eval"><y>#</y><d>2018-04-20</d><h>20:46</h><w>unwarysage</w>trap-response launches a third repl server and sends things to it for eval</z><z id="t1524257216" t="unwarysage How but the error messages are still being modified"><y>#</y><d>2018-04-20</d><h>20:46</h><w>unwarysage</w>How but the error messages are still being modified</z><z id="t1524257319" t="unwarysage so..."><y>#</y><d>2018-04-20</d><h>20:48</h><w>unwarysage</w>so...</z><z id="t1524257322" t="unwarysage I think I see"><y>#</y><d>2018-04-20</d><h>20:48</h><w>unwarysage</w>I think I see</z><z id="t1524257345" t="hiredman my kind of vague hand wavy guess is you have state issues in your middleware stack, global state is being used, which could be a problem if you have more than one nrepl session running"><y>#</y><d>2018-04-20</d><h>20:49</h><w>hiredman</w>my kind of vague hand wavy guess is you have state issues in your middleware stack, global state is being used, which could be a problem if you have more than one nrepl session running</z><z id="t1524257361" t="unwarysage somehow between the repl trap response runs and the one it is in, my middleware steps in"><y>#</y><d>2018-04-20</d><h>20:49</h><w>unwarysage</w>somehow between the repl trap response runs and the one it is in, my middleware steps in</z><z id="t1524257369" t="unwarysage I don&apos;t think there is any state"><y>#</y><d>2018-04-20</d><h>20:49</h><w>unwarysage</w>I don&apos;t think there is any state</z><z id="t1524257393" t="hiredman I dunno, I see a bunch of def&apos;ed atoms, and I made a hand wavy guess"><y>#</y><d>2018-04-20</d><h>20:49</h><w>hiredman</w>I dunno, I see a bunch of def&apos;ed atoms, and I made a hand wavy guess</z><z id="t1524257398" t="unwarysage in core?"><y>#</y><d>2018-04-20</d><h>20:49</h><w>unwarysage</w>in core?</z><z id="t1524257418" t="hiredman yes"><y>#</y><d>2018-04-20</d><h>20:50</h><w>hiredman</w>yes</z><z id="t1524257427" t="unwarysage sorry core has been deprecated. Those were for testing purposes, and no code runs in core now."><y>#</y><d>2018-04-20</d><h>20:50</h><w>unwarysage</w>sorry core has been deprecated. Those were for testing purposes, and no code runs in core now.</z><z id="t1524257432" t="unwarysage really sorry about that"><y>#</y><d>2018-04-20</d><h>20:50</h><w>unwarysage</w>really sorry about that</z><z id="t1524257457" t="hiredman no worries, just took a glance around"><y>#</y><d>2018-04-20</d><h>20:50</h><w>hiredman</w>no worries, just took a glance around</z><z id="t1524257522" t="unwarysage So, just trying out a plain old division by zero error in the repl that runs trap-response, I see it&apos;s error messages are being modified"><y>#</y><d>2018-04-20</d><h>20:52</h><w>unwarysage</w>So, just trying out a plain old division by zero error in the repl that runs trap-response, I see it&apos;s error messages are being modified</z><z id="t1524257565" t="unwarysage https://clojurians.slack.com/archives/C17JYSA3H/p1524256604000032 though I am still concerned by any problems you saw when you said this"><y>#</y><d>2018-04-20</d><h>20:52</h><w>unwarysage</w><a href="https://clojurians.slack.com/archives/C17JYSA3H/p1524256604000032" target="_blank">https://clojurians.slack.com/archives/C17JYSA3H/p1524256604000032</a>
though I am still concerned by any problems you saw when you said this</z><z id="t1524257714" t="hiredman I didn&apos;t see any problems, it is more like like I try to eliminate assumptions when debugging, and that seemed like one"><y>#</y><d>2018-04-20</d><h>20:55</h><w>hiredman</w>I didn&apos;t see any problems, it is more like like I try to eliminate assumptions when debugging, and that seemed like one</z><z id="t1524257731" t="unwarysage fair enough"><y>#</y><d>2018-04-20</d><h>20:55</h><w>unwarysage</w>fair enough</z><z id="t1524257754" t="unwarysage AFK ~2 minutes max"><y>#</y><d>2018-04-20</d><h>20:55</h><w>unwarysage</w>AFK ~2 minutes max</z><z id="t1524258046" t="unwarysage back"><y>#</y><d>2018-04-20</d><h>21:00</h><w>unwarysage</w>back</z><z id="t1524258345" t="unwarysage okay"><y>#</y><d>2018-04-20</d><h>21:05</h><w>unwarysage</w>okay</z><z id="t1524258412" t="unwarysage it seems if trap-response&apos;s own server is set to point at the modified server, then I do get :err"><y>#</y><d>2018-04-20</d><h>21:06</h><w>unwarysage</w>it seems if trap-response&apos;s own server is set to point at the modified server, then I do get <pre>:err</pre></z><z id="t1524258583" t="unwarysage This seems to be working, and I am very grateful"><y>#</y><d>2018-04-20</d><h>21:09</h><w>unwarysage</w>This seems to be working, and I am very grateful</z><z id="t1524258593" t="unwarysage thank you for your time and expertise"><y>#</y><d>2018-04-20</d><h>21:09</h><w>unwarysage</w>thank you for your time and expertise</z><z id="t1525809382" t="kkruit I&apos;m having trouble connecting to a repel running on a virtual server via virtualbox. I&apos;m fairly certain that all the firewalls are turned off and when i do a port scan on the box it says the port that i&apos;m using is open. I&apos;m using spacemacs with ciderconnect and i&apos;m getting the error: Connection closed unexpectedly (connection broken by remote peer)"><y>#</y><d>2018-05-08</d><h>19:56</h><w>kkruit</w>I&apos;m having trouble connecting to a repel running on a virtual server via virtualbox. I&apos;m fairly certain that all the firewalls are turned off and when i do a port scan on the box it says the port that i&apos;m using is open. I&apos;m using spacemacs with ciderconnect and i&apos;m getting the error: Connection closed unexpectedly (connection broken by remote peer)</z><z id="t1525809458" t="kkruit I started it using the following command: lein repl :headless :port 4242"><y>#</y><d>2018-05-08</d><h>19:57</h><w>kkruit</w>I started it using the following command: lein repl :headless :port 4242</z><z id="t1525809582" t="kkruit I&apos;m not sure where to look or how to troubleshoot this issue..."><y>#</y><d>2018-05-08</d><h>19:59</h><w>kkruit</w>I&apos;m not sure where to look or how to troubleshoot this issue...</z><z id="t1525809625" t="kkruit the service that&apos;s running does say: nREPL server started on port 4242 on host 127.0.0.1 - &lt;nrepl://127.0.0.1:4242&gt;"><y>#</y><d>2018-05-08</d><h>20:00</h><w>kkruit</w>the service that&apos;s running does say: nREPL server started on port 4242 on host 127.0.0.1 - &lt;nrepl://127.0.0.1:4242&gt;</z><z id="t1525809917" t="kkruit If i try to connect via: lein repl :connect 127.0.0.1:4242"><y>#</y><d>2018-05-08</d><h>20:05</h><w>kkruit</w>If i try to connect via: lein repl :connect 127.0.0.1:4242</z><z id="t1525809943" t="kkruit i get: Connecting to nREPL at localhost:4242 SocketException The transport&apos;s socket appears to have lost its connection to the nREPL server clojure.tools.nrepl.transport/bencode/fn--5154/fn--5155 (transport.clj:95) clojure.tools.nrepl.transport/bencode/fn--5154 (transport.clj:95) clojure.tools.nrepl.transport/fn-transport/fn--5126 (transport.clj:42) clojure.core/binding-conveyor-fn/fn--4676 (core.clj:1938) java.util.concurrent.FutureTask.run (FutureTask.java:266) java.util.concurrent.ThreadPoolExecutor.runWorker (ThreadPoolExecutor.java:1149) java.util.concurrent.ThreadPoolExecutor$Worker.run (ThreadPoolExecutor.java:624) java.lang.Thread.run (Thread.java:748) Bye for now!"><y>#</y><d>2018-05-08</d><h>20:05</h><w>kkruit</w>i get:
Connecting to nREPL at localhost:4242
SocketException The transport&apos;s socket appears to have lost its connection to the nREPL server
        clojure.tools.nrepl.transport/bencode/fn--5154/fn--5155 (transport.clj:95)
        clojure.tools.nrepl.transport/bencode/fn--5154 (transport.clj:95)
        clojure.tools.nrepl.transport/fn-transport/fn--5126 (transport.clj:42)
        clojure.core/binding-conveyor-fn/fn--4676 (core.clj:1938)
        java.util.concurrent.FutureTask.run (FutureTask.java:266)
        java.util.concurrent.ThreadPoolExecutor.runWorker (ThreadPoolExecutor.java:1149)
        java.util.concurrent.ThreadPoolExecutor$Worker.run (ThreadPoolExecutor.java:624)
        java.lang.Thread.run (Thread.java:748)
Bye for now!</z><z id="t1525810049" t="kkruit hmm. I am able to connect with that same command while sshed into the virtualbox..."><y>#</y><d>2018-05-08</d><h>20:07</h><w>kkruit</w>hmm. I am able to connect with that same command while sshed into the virtualbox...</z><z id="t1525883134" t="kkruit looks like it works if i use :host 0.0.0.0"><y>#</y><d>2018-05-09</d><h>16:25</h><w>kkruit</w>looks like it works if i use :host 0.0.0.0</z><z id="t1525883160" t="kkruit ðŸ¤·"><y>#</y><d>2018-05-09</d><h>16:26</h><w>kkruit</w><b>ðŸ¤·</b></z><z id="t1526462568" t="bozhidar nREPLâ€™s migration out of clojure-contrib is finally done and nREPL 0.3 is out! You can read some details here https://github.com/clojure-emacs/nREPL/blob/master/CHANGELOG.md Enjoy!"><y>#</y><d>2018-05-16</d><h>09:22</h><w>bozhidar</w>nREPLâ€™s migration out of <code>clojure-contrib</code> is finally done and nREPL 0.3 is out! You can read some details here <a href="https://github.com/clojure-emacs/nREPL/blob/master/CHANGELOG.md" target="_blank">https://github.com/clojure-emacs/nREPL/blob/master/CHANGELOG.md</a> Enjoy!</z><z id="t1526970490" t="rahulr92 I am getting the following error while trying to load a buffer to my (remote) REPL: Exception in thread &quot;nREPL-worker-0&quot; java.lang.IllegalArgumentException: No implementation of method: :send of protocol: #&apos;clojure.tools.nrepl.transport/Transport found for class: clojure.tools.nrepl.middleware.load_file$wrap_load_file$fn$reify__668 Complete stack trace: https://pastebin.com/fafec0AV My profiles.clj: {:repl {:plugins [[cider/cider-nrepl &quot;0.17.0-SNAPSHOT&quot;] [refactor-nrepl &quot;2.4.0-SNAPSHOT&quot;]] :dependencies [[org.clojure/tools.nrepl &quot;0.2.12&quot;]] } } Effectively none of my required namespaces are getting loaded. Any help/pointers would be helpful. TIA."><y>#</y><d>2018-05-22</d><h>06:28</h><w>rahulr92</w>I am getting the following error while trying to load a buffer to my (remote) REPL:

<code>Exception in thread &quot;nREPL-worker-0&quot; java.lang.IllegalArgumentException: No implementation of method: :send of protocol: #&apos;clojure.tools.nrepl.transport/Transport found for class: clojure.tools.nrepl.middleware.load_file$wrap_load_file$fn$reify__668</code>

Complete stack trace: <a href="https://pastebin.com/fafec0AV" target="_blank">https://pastebin.com/fafec0AV</a>
My profiles.clj:
<pre>{:repl {:plugins [[cider/cider-nrepl &quot;0.17.0-SNAPSHOT&quot;]
                    [refactor-nrepl &quot;2.4.0-SNAPSHOT&quot;]]
          :dependencies [[org.clojure/tools.nrepl &quot;0.2.12&quot;]]
          }
   }</pre>

Effectively none of my required namespaces are getting loaded. 
Any help/pointers would be helpful. TIA.</z><z id="t1530081683" t="Timo Freiberg hello, i&apos;ve been looking at the stdin handling of nrepl while trying to fix CIDER issue 2317 &quot;`(slurp in)` can&apos;t be interrupted&quot; - https://github.com/clojure-emacs/cider/issues/2317 after fixing the part where the user couldn&apos;t stop the stream, i encountered the following issue: (slurp *in*) will close stdin after it reads EOF and then the nrepl stdin will be closed forever (or until a restart). is that something that should be changed?"><y>#</y><d>2018-06-27</d><h>06:41</h><w>Timo Freiberg</w>hello, i&apos;ve been looking at the stdin handling of nrepl while trying to fix CIDER issue 2317 &quot;`(slurp in)` can&apos;t be interrupted&quot; - <a href="https://github.com/clojure-emacs/cider/issues/2317" target="_blank">https://github.com/clojure-emacs/cider/issues/2317</a>
after fixing the part where the user couldn&apos;t stop the stream, i encountered the following issue:

<code>(slurp *in*)</code> will close stdin after it reads EOF and then the nrepl stdin will be closed forever (or until a restart).
is that something that should be changed?</z><z id="t1530086582" t="bozhidar [:attrs {:href &quot;/_/_/users/UA11M92KE&quot;}] Itâ€™s certainly a bug if we canâ€™t use the the *in* more than once and we should fix this."><y>#</y><d>2018-06-27</d><h>08:03</h><w>bozhidar</w><a>@timo.freiberg</a> Itâ€™s certainly a bug if we canâ€™t use the the <code>*in*</code> more than once and we should fix this.</z><z id="t1530086604" t="bozhidar Luckily ever since nREPL moved out of clojure-contrib contributions have become pretty easy - https://github.com/nrepl/nrepl/"><y>#</y><d>2018-06-27</d><h>08:03</h><w>bozhidar</w>Luckily ever since nREPL moved out of <code>clojure-contrib</code> contributions have become pretty easy - <a href="https://github.com/nrepl/nrepl/" target="_blank">https://github.com/nrepl/nrepl/</a></z><z id="t1530086634" t="bozhidar (the old repo is there just for legal/historical purposes - it was licensed differently to comply with clojure-contrib rules)"><y>#</y><d>2018-06-27</d><h>08:03</h><w>bozhidar</w>(the old repo is there just for legal/historical purposes - it was licensed differently to comply with <code>clojure-contrib</code> rules)</z><z id="t1530086660" t="bozhidar Funny enough - I eventually ended up being the maintainer of both CIDER and nREPL. ðŸ™‚"><y>#</y><d>2018-06-27</d><h>08:04</h><w>bozhidar</w>Funny enough - I eventually ended up being the maintainer of both CIDER and nREPL. <b>ðŸ™‚</b></z><z id="t1530118809" t="Timo Freiberg [:attrs {:href &quot;/_/_/users/U051BLM8F&quot;}] yeah i noticed that after your comments this morning ðŸ™‚"><y>#</y><d>2018-06-27</d><h>17:00</h><w>Timo Freiberg</w><a>@bozhidar</a> yeah i noticed that after your comments this morning <b>ðŸ™‚</b></z><z id="t1530138810" t="bozhidar Well, seems I was the person most motivated to get some improvements in nREPL, as CIDER is so dependent on it. ðŸ™‚ Chas didnâ€™t have much time for the project and eventually he handed it over to me and the rest of our team."><y>#</y><d>2018-06-27</d><h>22:33</h><w>bozhidar</w>Well, seems I was the person most motivated to get some improvements in nREPL, as CIDER is so dependent on it. <b>ðŸ™‚</b> Chas didnâ€™t have much time for the project and eventually he handed it over to me and the rest of our team.</z><z id="t1530221724" t="spiralganglion I&apos;m hitting this error: Exception in thread &quot;main&quot; java.io.FileNotFoundException: Could not locate clojure/tools/nrepl__init.class or clojure/tools/nrepl.clj on classpath., compiling:(cider/piggieback.clj:1:1)"><y>#</y><d>2018-06-28</d><h>21:35</h><w>spiralganglion</w>I&apos;m hitting this error: <code>Exception in thread &quot;main&quot; java.io.FileNotFoundException: Could not locate clojure/tools/nrepl__init.class or clojure/tools/nrepl.clj on classpath., compiling:(cider/piggieback.clj:1:1)</code></z><z id="t1530221747" t="spiralganglion I&apos;m assuming this has to do with the recently changed namespace for nREPL â€” I&apos;m using nREPL 0.4.1 and piggieback 0.3.6, building with the Clojure CLI."><y>#</y><d>2018-06-28</d><h>21:35</h><w>spiralganglion</w>I&apos;m assuming this has to do with the recently changed namespace for nREPL â€” I&apos;m using nREPL 0.4.1 and piggieback 0.3.6, building with the Clojure CLI.</z><z id="t1530221823" t="spiralganglion [:attrs {:href &quot;/_/_/users/U051BLM8F&quot;}] â€” would you kindly let me know if Piggieback still needs to be switched over to use the new nREPL ns, or if perhaps this issue is related to something else? ðŸ™‡"><y>#</y><d>2018-06-28</d><h>21:37</h><w>spiralganglion</w><a>@bozhidar</a> â€” would you kindly let me know if Piggieback still needs to be switched over to use the new nREPL ns, or if perhaps this issue is related to something else? <b>ðŸ™‡</b></z><z id="t1530223181" t="spiralganglion (FWIW: Rolling back to nREPL 0.3.1 works fine.)"><y>#</y><d>2018-06-28</d><h>21:59</h><w>spiralganglion</w>(FWIW: Rolling back to nREPL 0.3.1 works fine.)</z><z id="t1530259840" t="bozhidar [:attrs {:href &quot;/_/_/users/U072TLGJ2&quot;}] yeah, thatâ€™s true."><y>#</y><d>2018-06-29</d><h>08:10</h><w>bozhidar</w><a>@ivanreese</a> yeah, thatâ€™s true.</z><z id="t1530259890" t="bozhidar I havenâ€™t updated all the middleware to target 0.4+, because itâ€™s currently a bit hard for users to start a 0.4 server as both lein and boot depend internally on the legacy 0.2.x."><y>#</y><d>2018-06-29</d><h>08:11</h><w>bozhidar</w>I havenâ€™t updated all the middleware to target 0.4+, because itâ€™s currently a bit hard for users to start a 0.4 server as both lein and boot depend internally on the legacy 0.2.x.</z><z id="t1530259928" t="bozhidar Iâ€™ve send the two projects PRs, hopefully someone will merge them."><y>#</y><d>2018-06-29</d><h>08:12</h><w>bozhidar</w>Iâ€™ve send the two projects PRs, hopefully someone will merge them.</z><z id="t1530259959" t="bozhidar Alternatively I just plan to distribute some lein and boot tasks to spin the new nREPL instead and then I can finally update the middleware."><y>#</y><d>2018-06-29</d><h>08:12</h><w>bozhidar</w>Alternatively I just plan to distribute some lein and boot tasks to spin the new nREPL instead and then I can finally update the middleware.</z><z id="t1530309788" t="spiralganglion :thumbsup: Looking forward to the future, when it arrives."><y>#</y><d>2018-06-29</d><h>22:03</h><w>spiralganglion</w><b>:thumbsup:</b> Looking forward to the future, when it arrives.</z><z id="t1530403158" t="cfleming Hi everyone, Iâ€™m very pleased to see this channel here!"><y>#</y><d>2018-06-30</d><h>23:59</h><w>cfleming</w>Hi everyone, Iâ€™m very pleased to see this channel here!</z><z id="t1530421517" t="cfleming Just to check my understanding of this - is it the case that alembic no longer works under nREPL, because of the dynapath change for Java 9? Sounds like nREPL used to actually modify the URLClassLoader but can no longer do so?"><y>#</y><d>2018-07-01</d><h>05:05</h><w>cfleming</w>Just to check my understanding of this - is it the case that alembic no longer works under nREPL, because of the dynapath change for Java 9? Sounds like nREPL used to actually modify the URLClassLoader but can no longer do so?</z><z id="t1530421558" t="cfleming If so, Iâ€™ll file a ticket for that. Thereâ€™s been some discussion over in #tools-deps about this WRT their new add-lib functionality."><y>#</y><d>2018-07-01</d><h>05:05</h><w>cfleming</w>If so, Iâ€™ll file a ticket for that. Thereâ€™s been some discussion over in #tools-deps about this WRT their new add-lib functionality.</z><z id="t1530421746" t="cfleming Thereâ€™s also been some discussion over in #clojure-dev about it (from [:attrs {:href &quot;/_/_/users/U04V1HS2L&quot;}] )"><y>#</y><d>2018-07-01</d><h>05:09</h><w>cfleming</w>Thereâ€™s also been some discussion over in #clojure-dev about it (from <a>@razum2um</a>)</z><z id="t1530423141" t="dominicm In Java 8 one of the base class loader is a URL, and there was a hack to get at it. It was an implementation detail that is gone in 9. [:attrs {:href &quot;/_/_/users/U0567Q30W&quot;}] "><y>#</y><d>2018-07-01</d><h>05:32</h><w>dominicm</w>In Java 8 one of the base class loader is a URL, and there was a hack to get at it. It was an implementation detail that is gone in 9. <a>@cfleming</a> </z><z id="t1530424551" t="cfleming [:attrs {:href &quot;/_/_/users/U09LZR36F&quot;}] So the fix would be for nREPL to have a DCL which sits above the DCLs it creates for each eval?"><y>#</y><d>2018-07-01</d><h>05:55</h><w>cfleming</w><a>@dominicm</a> So the fix would be for nREPL to have a DCL which sits above the DCLs it creates for each eval?</z><z id="t1530424618" t="cfleming Itâ€™s really pomegranate which doesnâ€™t work, I guess, alembic is only broken transitively."><y>#</y><d>2018-07-01</d><h>05:56</h><w>cfleming</w>Itâ€™s really pomegranate which doesnâ€™t work, I guess, alembic is only broken transitively.</z><z id="t1530424701" t="dominicm Exactly. I started to look at it but ran out of time. "><y>#</y><d>2018-07-01</d><h>05:58</h><w>dominicm</w>Exactly. I started to look at it but ran out of time. </z><z id="t1530479466" t="bozhidar [:attrs {:href &quot;/_/_/users/U0567Q30W&quot;}] Yeah, that would be the fix IMO. I havenâ€™t had any time to work on this either, unfortunately."><y>#</y><d>2018-07-01</d><h>21:11</h><w>bozhidar</w><a>@cfleming</a> Yeah, that would be the fix IMO. I havenâ€™t had any time to work on this either, unfortunately.</z><z id="t1530479517" t="bozhidar Most of my time went into trying to get the â€œnewâ€ nREPL replace the deprecated contrib one in projects like reply (done), boot (PR open) and lein (PR open)."><y>#</y><d>2018-07-01</d><h>21:11</h><w>bozhidar</w>Most of my time went into trying to get the â€œnewâ€ nREPL replace the deprecated contrib one in projects like reply (done), boot (PR open) and lein (PR open).</z><z id="t1530479568" t="bozhidar I see nREPL is issuing some other warnings on Java 9/10, so the DCL might not be our only concern, so help would be welcome."><y>#</y><d>2018-07-01</d><h>21:12</h><w>bozhidar</w>I see nREPL is issuing some other warnings on Java 9/10, so the DCL might not be our only concern, so help would be welcome.</z><z id="t1530479598" t="bozhidar On the bright side - with Clojure dropping support for Java 6 and 7, at least we can focus on support Java 8+. ðŸ™‚"><y>#</y><d>2018-07-01</d><h>21:13</h><w>bozhidar</w>On the bright side - with Clojure dropping support for Java 6 and 7, at least we can focus on support Java 8+. <b>ðŸ™‚</b></z><z id="t1531382993" t="bozhidar nREPL now has an official manual http://nrepl.readthedocs.io/en/latest/ Itâ€™s still pretty much a work in progress (mostly a restructuring of the old README) and your help improving it would be appreciated! ( http://nrepl.readthedocs.io/en/latest/about/contributing/#working-on-the-manual â€¦)"><y>#</y><d>2018-07-12</d><h>08:09</h><w>bozhidar</w>nREPL now has an official manual <a href="http://nrepl.readthedocs.io/en/latest/" target="_blank">http://nrepl.readthedocs.io/en/latest/</a>  Itâ€™s still pretty much a work in progress (mostly a restructuring of the old README) and your help improving it would be appreciated! (<a href="http://nrepl.readthedocs.io/en/latest/about/contributing/#working-on-the-manual" target="_blank">http://nrepl.readthedocs.io/en/latest/about/contributing/#working-on-the-manual</a> â€¦)</z><z id="t1531478950" t="razum2um [:attrs {:href &quot;/_/_/users/U051BLM8F&quot;}] [:attrs {:href &quot;/_/_/users/U09A6U6GJ&quot;}] I was mentioned in this context https://clojurians-log.clojureverse.org/nrepl/2018-07-01 take a look on what I came up with for now: https://github.com/cemerick/pomegranate/pull/102"><y>#</y><d>2018-07-13</d><h>10:49</h><w>razum2um</w><a>@bozhidar</a> <a>@cemerick</a> I was mentioned in this context <a href="https://clojurians-log.clojureverse.org/nrepl/2018-07-01" target="_blank">https://clojurians-log.clojureverse.org/nrepl/2018-07-01</a> take a look on what I came up with for now: <a href="https://github.com/cemerick/pomegranate/pull/102" target="_blank">https://github.com/cemerick/pomegranate/pull/102</a></z><z id="t1531482417" t="bozhidar [:attrs {:href &quot;/_/_/users/U04V1HS2L&quot;}] Iâ€™ll take a look, although Iâ€™m not involved with pomegranate at all. On the other hand - Iâ€™d really love to make it trivial to add dependencies at runtime with nREPL."><y>#</y><d>2018-07-13</d><h>11:46</h><w>bozhidar</w><a>@razum2um</a> Iâ€™ll take a look, although Iâ€™m not involved with pomegranate at all. On the other hand - Iâ€™d really love to make it trivial to add dependencies at runtime with nREPL.</z><z id="t1531499393" t="razum2um [:attrs {:href &quot;/_/_/users/U051BLM8F&quot;}] exactly ðŸ‘ I donâ€™t understand how itâ€™s possible to reload repl when you found a library and you have to restart to try it. still, I wrote that itâ€™s only nrepl-specific issue, plain clojure cli works for me, but itâ€™s not net-aware + I prefer leinâ€™s project.clj to deps.edn but I ended up hacking pomergranate, maybe thereâ€™s a better way, thatâ€™s why mentioned you"><y>#</y><d>2018-07-13</d><h>16:29</h><w>razum2um</w><a>@bozhidar</a> exactly <b>ðŸ‘</b> I donâ€™t understand how itâ€™s possible to reload repl when you found a library and you have to restart to try it. 

still, I wrote that itâ€™s only nrepl-specific issue, plain clojure cli works for me, but itâ€™s not net-aware + I prefer leinâ€™s project.clj to deps.edn 

but I ended up hacking pomergranate, maybe thereâ€™s a better way, thatâ€™s why mentioned you</z><z id="t1531909145" t="bozhidar [:attrs {:href &quot;/_/_/users/U04V1HS2L&quot;}] Btw, see https://github.com/nrepl/nREPL/pull/35"><y>#</y><d>2018-07-18</d><h>10:19</h><w>bozhidar</w><a>@razum2um</a> Btw, see <a href="https://github.com/nrepl/nREPL/pull/35" target="_blank">https://github.com/nrepl/nREPL/pull/35</a></z><z id="t1531909173" t="bozhidar I think this fixes your problem. ðŸ™‚"><y>#</y><d>2018-07-18</d><h>10:19</h><w>bozhidar</w>I think this fixes your problem. <b>ðŸ™‚</b></z><z id="t1533322608" t="tungsten Has anyone connected to the latest drawbridge successfully? I can&apos;t find any documentation anywhere. I&apos;ve been trying to (require &apos;drawbridge.client) and then (clojure.tools.nrepl/connect-url &quot; https://myurl &quot;) but I get an error about no method found for https:// ...."><y>#</y><d>2018-08-03</d><h>18:56</h><w>tungsten</w>Has anyone connected to the latest drawbridge successfully? I can&apos;t find any documentation anywhere. I&apos;ve been trying to (require &apos;drawbridge.client) and then (clojure.tools.nrepl/connect-url &quot;<a href="https://myurl" target="_blank">https://myurl</a>&quot;) but I get an error about no method found for https:// ....</z><z id="t1533369911" t="bozhidar [:attrs {:href &quot;/_/_/users/U0EEGK9NU&quot;}] Version 0.1.1 had a hard dependency to nREPL 0.4, and I see you tried to connect with 0.2. Iâ€™ve relaxed this in 0.1.3. and Iâ€™ve added a few compatibility notes."><y>#</y><d>2018-08-04</d><h>08:05</h><w>bozhidar</w><a>@bfast</a> Version 0.1.1 had a hard dependency to nREPL 0.4, and I see you tried to connect with 0.2. Iâ€™ve relaxed this in 0.1.3. and Iâ€™ve added a few compatibility notes.</z><z id="t1533369941" t="bozhidar Also - lein will soon switch to 0.4 by default https://github.com/technomancy/leiningen/pull/2444"><y>#</y><d>2018-08-04</d><h>08:05</h><w>bozhidar</w>Also - lein will soon switch to 0.4 by default <a href="https://github.com/technomancy/leiningen/pull/2444" target="_blank">https://github.com/technomancy/leiningen/pull/2444</a></z><z id="t1533370035" t="bozhidar https://github.com/nrepl/drawbridge/commit/3e521b108fab59b85dd64e0ea7f40d756168fe1c"><y>#</y><d>2018-08-04</d><h>08:07</h><w>bozhidar</w><a href="https://github.com/nrepl/drawbridge/commit/3e521b108fab59b85dd64e0ea7f40d756168fe1c" target="_blank">https://github.com/nrepl/drawbridge/commit/3e521b108fab59b85dd64e0ea7f40d756168fe1c</a></z><z id="t1533468229" t="pez [:attrs {:href &quot;/_/_/users/U051BLM8F&quot;}] what is the closest to bleeding edge combo of cider-nrepl and nrepl I can use? I tried 0.19-SNAPSHOT with 0.4.4 and that wouldnâ€™t work. Then tried 0.18-SNAPSHOT with 0.4.0 and that seems to work swell."><y>#</y><d>2018-08-05</d><h>11:23</h><w>pez</w><a>@bozhidar</a> what is the closest to bleeding edge combo of cider-nrepl and nrepl I can use? I tried 0.19-SNAPSHOT with 0.4.4 and that wouldnâ€™t work. Then tried 0.18-SNAPSHOT with 0.4.0 and that seems to work swell.</z><z id="t1533468398" t="bozhidar Both combos work fine for me."><y>#</y><d>2018-08-05</d><h>11:26</h><w>bozhidar</w>Both combos work fine for me.</z><z id="t1533468420" t="bozhidar How are you starting the server? What exactly are the problems youâ€™re running into?"><y>#</y><d>2018-08-05</d><h>11:27</h><w>bozhidar</w>How are you starting the server? What exactly are the problems youâ€™re running into?</z><z id="t1533468670" t="pez It is a small figwheel project that I use when hacking on Calva. I have placed all tooling dependencies in profiles.clj . This works: {:repl {:plugins [[cider/cider-nrepl &quot;0.18.0-SNAPSHOT&quot;]] :dependencies [[nrepl &quot;0.4.0&quot;] [cider/piggieback &quot;0.3.5&quot;] [figwheel-sidecar &quot;0.5.16&quot;]] :repl-options {:nrepl-middleware [cider.piggieback/wrap-cljs-repl]}}}"><y>#</y><d>2018-08-05</d><h>11:31</h><w>pez</w>It is a small figwheel project that I use when hacking on Calva. I have placed all tooling dependencies in <code>profiles.clj</code>. This works: <pre>{:repl {:plugins [[cider/cider-nrepl &quot;0.18.0-SNAPSHOT&quot;]]
        :dependencies [[nrepl &quot;0.4.0&quot;]
                       [cider/piggieback &quot;0.3.5&quot;]
                       [figwheel-sidecar &quot;0.5.16&quot;]]
        :repl-options {:nrepl-middleware [cider.piggieback/wrap-cljs-repl]}}}</pre></z><z id="t1533468691" t="bozhidar Itâ€™s piggieback - you need 0.3.8+"><y>#</y><d>2018-08-05</d><h>11:31</h><w>bozhidar</w>Itâ€™s piggieback - you need 0.3.8+</z><z id="t1533468710" t="bozhidar And whatever the latest sidecar is."><y>#</y><d>2018-08-05</d><h>11:31</h><w>bozhidar</w>And whatever the latest sidecar is.</z><z id="t1533468719" t="pez Iâ€™ll try right away."><y>#</y><d>2018-08-05</d><h>11:31</h><w>pez</w>Iâ€™ll try right away.</z><z id="t1533468727" t="bozhidar As for nREPL - 0.4.4"><y>#</y><d>2018-08-05</d><h>11:32</h><w>bozhidar</w>As for nREPL - 0.4.4</z><z id="t1533468753" t="pez Calva works a lot better with 0.4 than with latest contrib version, btw."><y>#</y><d>2018-08-05</d><h>11:32</h><w>pez</w>Calva works a lot better with 0.4 than with latest contrib version, btw.</z><z id="t1533468753" t="bozhidar I recall there was something wrong with 0.4.0, so itâ€™s a bad idea to depend on it. The newer, the better."><y>#</y><d>2018-08-05</d><h>11:32</h><w>bozhidar</w>I recall there was something wrong with 0.4.0, so itâ€™s a bad idea to depend on it. The newer, the better.</z><z id="t1533468844" t="pez 0.3.8 is newest piggieback?"><y>#</y><d>2018-08-05</d><h>11:34</h><w>pez</w>0.3.8 is newest piggieback?</z><z id="t1533468852" t="bozhidar Yes."><y>#</y><d>2018-08-05</d><h>11:34</h><w>bozhidar</w>Yes.</z><z id="t1533468864" t="bozhidar And the first one to support nREPL 0.4. ðŸ™‚"><y>#</y><d>2018-08-05</d><h>11:34</h><w>bozhidar</w>And the first one to support nREPL 0.4. <b>ðŸ™‚</b></z><z id="t1533468942" t="pez Funny that it seemed to work with 0.3.5 and 0.4.0 then."><y>#</y><d>2018-08-05</d><h>11:35</h><w>pez</w>Funny that it seemed to work with 0.3.5 and 0.4.0 then.</z><z id="t1533468955" t="pez seem*s*"><y>#</y><d>2018-08-05</d><h>11:35</h><w>pez</w>seem*s*</z><z id="t1533469012" t="bozhidar Canâ€™t imagine how - piggieback 0.3.5 had a hard dep on tools.nrepl, so nREPL 0.4 would not load such middleware ðŸ™‚"><y>#</y><d>2018-08-05</d><h>11:36</h><w>bozhidar</w>Canâ€™t imagine how - piggieback 0.3.5 had a hard dep on tools.nrepl, so nREPL 0.4 would not load such middleware <b>ðŸ™‚</b></z><z id="t1533469259" t="pez wow. maybe I still have something in project.cljâ€¦"><y>#</y><d>2018-08-05</d><h>11:40</h><w>pez</w>wow. maybe I still have something in project.cljâ€¦</z><z id="t1533469279" t="pez This crashes: {:repl {:plugins [[cider/cider-nrepl &quot;0.19.0-SNAPSHOT&quot;]] :dependencies [[nrepl &quot;0.4.4&quot;] [cider/piggieback &quot;0.3.8&quot;] [figwheel-sidecar &quot;0.5.17-SNAPSHOT&quot;]] :repl-options {:nrepl-middleware [cider.piggieback/wrap-cljs-repl]}}}"><y>#</y><d>2018-08-05</d><h>11:41</h><w>pez</w>This crashes: <pre>{:repl {:plugins [[cider/cider-nrepl &quot;0.19.0-SNAPSHOT&quot;]]
        :dependencies [[nrepl &quot;0.4.4&quot;]
                       [cider/piggieback &quot;0.3.8&quot;]
                       [figwheel-sidecar &quot;0.5.17-SNAPSHOT&quot;]]
        :repl-options {:nrepl-middleware [cider.piggieback/wrap-cljs-repl]}}}</pre></z><z id="t1533469304" t="bozhidar Crashes how?"><y>#</y><d>2018-08-05</d><h>11:41</h><w>bozhidar</w>Crashes how?</z><z id="t1533469312" t="bozhidar Ah, now I see."><y>#</y><d>2018-08-05</d><h>11:41</h><w>bozhidar</w>Ah, now I see.</z><z id="t1533469320" t="bozhidar Youâ€™re using lein repl , right?"><y>#</y><d>2018-08-05</d><h>11:42</h><w>bozhidar</w>Youâ€™re using <code>lein repl</code>, right?</z><z id="t1533469378" t="pez I do ðŸ˜ƒ"><y>#</y><d>2018-08-05</d><h>11:42</h><w>pez</w>I do <b>ðŸ˜ƒ</b></z><z id="t1533469429" t="bozhidar Lein switched to nREPL only in master , otherwise if you stuck with the contrib one."><y>#</y><d>2018-08-05</d><h>11:43</h><w>bozhidar</w>Lein switched to nREPL only in <code>master</code>, otherwise if you stuck with the contrib one.</z><z id="t1533469465" t="bozhidar The nREPL dep youâ€™ve added is completely ignored and cider-nrepl 0.19 has a hard dep on nREPL 0.4, which I removed in 0.18."><y>#</y><d>2018-08-05</d><h>11:44</h><w>bozhidar</w>The nREPL dep youâ€™ve added is completely ignored and cider-nrepl 0.19 has a hard dep on nREPL 0.4, which I removed in 0.18.</z><z id="t1533469471" t="pez OK. Things work if I change to 0.18-SNAPSHOT"><y>#</y><d>2018-08-05</d><h>11:44</h><w>pez</w>OK. Things work if I change to 0.18-SNAPSHOT</z><z id="t1533469487" t="bozhidar Yep, because youâ€™re back to tools.nrepl thenâ€¦"><y>#</y><d>2018-08-05</d><h>11:44</h><w>bozhidar</w>Yep, because youâ€™re back to tools.nrepl thenâ€¦</z><z id="t1533469489" t="pez I see"><y>#</y><d>2018-08-05</d><h>11:44</h><w>pez</w>I see</z><z id="t1533469510" t="bozhidar [:attrs {:href &quot;/_/_/users/U0ETXRFEW&quot;}] See https://github.com/nrepl/lein-nrepl if you want to run 0.4 with lein"><y>#</y><d>2018-08-05</d><h>11:45</h><w>bozhidar</w><a>@pez</a> See <a href="https://github.com/nrepl/lein-nrepl" target="_blank">https://github.com/nrepl/lein-nrepl</a> if you want to run 0.4 with lein</z><z id="t1533469519" t="pez So the improvments in Calva behaviour was do to cider-nrepl, I guess"><y>#</y><d>2018-08-05</d><h>11:45</h><w>pez</w>So the improvments in Calva behaviour was do to cider-nrepl, I guess</z><z id="t1533469539" t="bozhidar likely so ðŸ™‚"><y>#</y><d>2018-08-05</d><h>11:45</h><w>bozhidar</w>likely so <b>ðŸ™‚</b></z><z id="t1533469601" t="pez For a CLI project 0.19 should work?"><y>#</y><d>2018-08-05</d><h>11:46</h><w>pez</w>For a CLI project 0.19 should work?</z><z id="t1533469695" t="pez I want to write as simple instructions to Calva users as possible. Calva does not yet start the repls and inject stuff so people have to fiddle with these dependencies still."><y>#</y><d>2018-08-05</d><h>11:48</h><w>pez</w>I want to write as simple instructions to Calva users as possible. Calva does not yet start the repls and inject stuff so people have to fiddle with these dependencies still.</z><z id="t1533469699" t="bozhidar Yes, but please ignore it completely."><y>#</y><d>2018-08-05</d><h>11:48</h><w>bozhidar</w>Yes, but please ignore it completely.</z><z id="t1533469712" t="pez Ignore what?"><y>#</y><d>2018-08-05</d><h>11:48</h><w>pez</w>Ignore what?</z><z id="t1533469717" t="bozhidar I created 0.19-snapshot just to experiment with nREPL 0.4."><y>#</y><d>2018-08-05</d><h>11:48</h><w>bozhidar</w>I created 0.19-snapshot just to experiment with nREPL 0.4.</z><z id="t1533469727" t="bozhidar Eventually I just folded the work in 0.18."><y>#</y><d>2018-08-05</d><h>11:48</h><w>bozhidar</w>Eventually I just folded the work in 0.18.</z><z id="t1533469762" t="bozhidar The version number is a bit misleading, but I needed a way to be able to distribute this to people willing to test it."><y>#</y><d>2018-08-05</d><h>11:49</h><w>bozhidar</w>The version number is a bit misleading, but I needed a way to be able to distribute this to people willing to test it.</z><z id="t1533469821" t="bozhidar See the CLI instructions here http://nrepl.readthedocs.io/en/latest/usage/"><y>#</y><d>2018-08-05</d><h>11:50</h><w>bozhidar</w>See the CLI instructions here <a href="http://nrepl.readthedocs.io/en/latest/usage/" target="_blank">http://nrepl.readthedocs.io/en/latest/usage/</a></z><z id="t1533469848" t="bozhidar Basically you can just add cider-nrepl 0.18-SNAPSHOT to the example for piggieback and everything will work just fine."><y>#</y><d>2018-08-05</d><h>11:50</h><w>bozhidar</w>Basically you can just add cider-nrepl 0.18-SNAPSHOT to the example for piggieback and everything will work just fine.</z><z id="t1533470874" t="pez I am bad at ignoring things ðŸ˜ƒ Can confirm that 0.19 didnâ€™t crash things at startup if using the latest lein-nrepl plugin. But some Calva features stopped to work."><y>#</y><d>2018-08-05</d><h>12:07</h><w>pez</w>I am bad at ignoring things <b>ðŸ˜ƒ</b> Can confirm that 0.19 didnâ€™t crash things at startup if using the latest lein-nrepl plugin. But some Calva features stopped to work.</z><z id="t1533471219" t="pez I saw that in the lein-nrepl instructions you placed cider-nrepl in :dependencies and not in :plugins ."><y>#</y><d>2018-08-05</d><h>12:13</h><w>pez</w>I saw that in the lein-nrepl instructions you placed cider-nrepl in <code>:dependencies</code> and not in <code>:plugins</code>.</z><z id="t1533471261" t="bozhidar Yes, thatâ€™s intentional."><y>#</y><d>2018-08-05</d><h>12:14</h><w>bozhidar</w>Yes, thatâ€™s intentional.</z><z id="t1533471278" t="pez I am not sure what the difference is. But notice that 0-19 does not work if I keep it in :plugins , but 0.18 does."><y>#</y><d>2018-08-05</d><h>12:14</h><w>pez</w>I am not sure what the difference is. But notice that 0-19 does not work if I keep it in <code>:plugins</code>, but 0.18 does.</z><z id="t1533471308" t="bozhidar The plugin simply overwrites Leinâ€™s repl profile config, but when youâ€™re not using lein repl you donâ€™t want to do this."><y>#</y><d>2018-08-05</d><h>12:15</h><w>bozhidar</w>The plugin simply overwrites Leinâ€™s <code>repl</code> profile config, but when youâ€™re not using <code>lein repl</code> you donâ€™t want to do this.</z><z id="t1533471374" t="bozhidar Very simply put - the plugin generates something like this section: :repl-options {:nrepl-middleware [cider.piggieback/wrap-cljs-repl]}}}"><y>#</y><d>2018-08-05</d><h>12:16</h><w>bozhidar</w>Very simply put - the plugin generates something like this section:

<pre>:repl-options {:nrepl-middleware [cider.piggieback/wrap-cljs-repl]}}}</pre></z><z id="t1533471393" t="bozhidar (but populated with CIDERâ€™s middlewares)"><y>#</y><d>2018-08-05</d><h>12:16</h><w>bozhidar</w>(but populated with CIDERâ€™s middlewares)</z><z id="t1533471537" t="bozhidar &gt; But notice that 0-19 does not work if I keep it in :plugins , but 0.18 does."><y>#</y><d>2018-08-05</d><h>12:18</h><w>bozhidar</w>&gt; But notice that 0-19 does not work if I keep it in <code>:plugins</code>, but 0.18 does.</z><z id="t1533471572" t="bozhidar 0.19 doesnâ€™t work because it generates the config, but as Lein is running an incompatible version of nREPL it canâ€™t understand the config."><y>#</y><d>2018-08-05</d><h>12:19</h><w>bozhidar</w>0.19 doesnâ€™t work because it generates the config, but as Lein is running an incompatible version of nREPL it canâ€™t understand the config.</z><z id="t1533471647" t="bozhidar 0.18 on the other hand checks to see if youâ€™re running the old nREPL and uses it API if thatâ€™s the case, otherwise it switches to the new oneâ€™s API."><y>#</y><d>2018-08-05</d><h>12:20</h><w>bozhidar</w>0.18 on the other hand checks to see if youâ€™re running the old nREPL and uses it API if thatâ€™s the case, otherwise it switches to the new oneâ€™s API.</z><z id="t1533471684" t="bozhidar This commit should make it clearer"><y>#</y><d>2018-08-05</d><h>12:21</h><w>bozhidar</w>This commit should make it clearer</z><z id="t1533471685" t="bozhidar https://github.com/clojure-emacs/cider-nrepl/commit/15d87747f790d300b0f13eef2e5bdc87b9dfd4ec"><y>#</y><d>2018-08-05</d><h>12:21</h><w>bozhidar</w><a href="https://github.com/clojure-emacs/cider-nrepl/commit/15d87747f790d300b0f13eef2e5bdc87b9dfd4ec" target="_blank">https://github.com/clojure-emacs/cider-nrepl/commit/15d87747f790d300b0f13eef2e5bdc87b9dfd4ec</a></z><z id="t1533471685" t="pez Also, if I move 0.18 to :dependencies the repl starts nicely, but some Calva features stop to work. They work if I keep 0.18 in :plugins ."><y>#</y><d>2018-08-05</d><h>12:21</h><w>pez</w>Also, if I move 0.18 to <code>:dependencies</code> the repl starts nicely, but some Calva features stop to work. They work if I keep 0.18 in <code>:plugins</code>.</z><z id="t1533471735" t="pez (Full profile): {:plugins [[nrepl/lein-nrepl &quot;0.1.1&quot;]] :dependencies [[cider/cider-nrepl &quot;0.18.0-SNAPSHOT&quot;] [nrepl &quot;0.4.4&quot;] [cider/piggieback &quot;0.3.8&quot;] [figwheel-sidecar &quot;0.5.17-SNAPSHOT&quot;]] :repl-options {:nrepl-middleware [cider.piggieback/wrap-cljs-repl]}}"><y>#</y><d>2018-08-05</d><h>12:22</h><w>pez</w>(Full profile): <pre>{:plugins [[nrepl/lein-nrepl &quot;0.1.1&quot;]]
        :dependencies [[cider/cider-nrepl &quot;0.18.0-SNAPSHOT&quot;]
                       [nrepl &quot;0.4.4&quot;]
                       [cider/piggieback &quot;0.3.8&quot;]
                       [figwheel-sidecar &quot;0.5.17-SNAPSHOT&quot;]]
        :repl-options {:nrepl-middleware [cider.piggieback/wrap-cljs-repl]}}</pre></z><z id="t1533471739" t="bozhidar For 0.18 itâ€™s fine to stay as a plugin if youâ€™re using it with tools.nrepl ."><y>#</y><d>2018-08-05</d><h>12:22</h><w>bozhidar</w>For 0.18 itâ€™s fine to stay as a plugin if youâ€™re using it with <code>tools.nrepl</code>.</z><z id="t1533471820" t="bozhidar And as lein nrepl doesnâ€™t care about the lein repl config it wonâ€™t be affected negatively by a cider-nrepl used as a plugin, either."><y>#</y><d>2018-08-05</d><h>12:23</h><w>bozhidar</w>And as <code>lein nrepl</code> doesnâ€™t care about the <code>lein repl</code> config it wonâ€™t be affected negatively by a cider-nrepl used as a plugin, either.</z><z id="t1533471886" t="pez Iâ€™ll do that then, since thatâ€™s the config that works. Can I ask for advice about what to instruct Calva users to use? It might be a bit confusing with the above profile, since tools.nrepl will be used anyway, but it seems apt to prepare things for when it is time to move to nrepl."><y>#</y><d>2018-08-05</d><h>12:24</h><w>pez</w>Iâ€™ll do that then, since thatâ€™s the config that works. Can I ask for advice about what to instruct Calva users to use? It might be a bit confusing with the above profile, since tools.nrepl will be used anyway, but it seems apt to prepare things for when it is time to move to nrepl.</z><z id="t1533472201" t="bozhidar Generally they can just keep using lein repl like before for a while, so for now you donâ€™t really need to change any instructions. Changes are needed only people using the cli."><y>#</y><d>2018-08-05</d><h>12:30</h><w>bozhidar</w>Generally they can just keep using <code>lein repl</code> like before for a while, so for now you donâ€™t really need to change any instructions. Changes are needed only people using the cli.</z><z id="t1533472360" t="bozhidar For users of the cli - itâ€™s best to suggest the creation of some profile similar to the one described in nREPLs docs. Then itâ€™s important to be careful with the versions of all deps."><y>#</y><d>2018-08-05</d><h>12:32</h><w>bozhidar</w>For users of the cli - itâ€™s best to suggest the creation of some profile similar to the one described in nREPLs docs. Then itâ€™s important to be careful with the versions of all deps.</z><z id="t1533472426" t="bozhidar I guess Iâ€™ll have to list somewhere a note or two about all of this. ðŸ™‚"><y>#</y><d>2018-08-05</d><h>12:33</h><w>bozhidar</w>I guess Iâ€™ll have to list somewhere a note or two about all of this. <b>ðŸ™‚</b></z><z id="t1533771174" t="cfleming In terms of making a plan to switch Cursive to nrepl.new, what do I need to bear in mind? Cursive uses nrepl itself for the client - if I switch that over to 0.4.x, that should be compatible with older clients, correct?"><y>#</y><d>2018-08-08</d><h>23:32</h><w>cfleming</w>In terms of making a plan to switch Cursive to nrepl.new, what do I need to bear in mind? Cursive uses nrepl itself for the client - if I switch that over to 0.4.x, that should be compatible with older clients, correct?</z><z id="t1533790096" t="bozhidar [:attrs {:href &quot;/_/_/users/U0567Q30W&quot;}] Yep."><y>#</y><d>2018-08-09</d><h>04:48</h><w>bozhidar</w><a>@cfleming</a> Yep.</z><z id="t1533790218" t="bozhidar Itâ€™s 100% backwards compatible."><y>#</y><d>2018-08-09</d><h>04:50</h><w>bozhidar</w>Itâ€™s 100% backwards compatible.</z><z id="t1533790233" t="bozhidar http://nrepl.readthedocs.io/en/latest/installation/#upgrading-from-nrepl-02x-to-04x"><y>#</y><d>2018-08-09</d><h>04:50</h><w>bozhidar</w><a href="http://nrepl.readthedocs.io/en/latest/installation/#upgrading-from-nrepl-02x-to-04x" target="_blank">http://nrepl.readthedocs.io/en/latest/installation/#upgrading-from-nrepl-02x-to-04x</a></z><z id="t1533800981" t="cfleming [:attrs {:href &quot;/_/_/users/U051BLM8F&quot;}] Thanks! Sorry, I should have RTFM."><y>#</y><d>2018-08-09</d><h>07:49</h><w>cfleming</w><a>@bozhidar</a> Thanks! Sorry, I should have RTFM.</z><z id="t1533801010" t="cfleming Does nrepl.new actually use any Clojure 1.8 features? Iâ€™m running 1.7 since Iâ€™m on a fork and Iâ€™ve been lazy to rebase."><y>#</y><d>2018-08-09</d><h>07:50</h><w>cfleming</w>Does nrepl.new actually use any Clojure 1.8 features? Iâ€™m running 1.7 since Iâ€™m on a fork and Iâ€™ve been lazy to rebase.</z><z id="t1533804030" t="bozhidar No, it doesnâ€™t."><y>#</y><d>2018-08-09</d><h>08:40</h><w>bozhidar</w>No, it doesnâ€™t.</z><z id="t1533804036" t="bozhidar It works on Clojure 1.7 just fine."><y>#</y><d>2018-08-09</d><h>08:40</h><w>bozhidar</w>It works on Clojure 1.7 just fine.</z><z id="t1533804115" t="bozhidar I was just curios if someone will complain about this, as I noticed in the State of Clojure survey that over 6 months ago the usage of 1.7 was under 5%."><y>#</y><d>2018-08-09</d><h>08:41</h><w>bozhidar</w>I was just curios if someone will complain about this, as I noticed in the State of Clojure survey that over 6 months ago the usage of 1.7 was under 5%.</z><z id="t1533804340" t="cfleming Yeah, Iâ€™m a special case there."><y>#</y><d>2018-08-09</d><h>08:45</h><w>cfleming</w>Yeah, Iâ€™m a special case there.</z><z id="t1533804348" t="bozhidar Just confirmed that actually the current codebase works fine with Clojure 1.5. ðŸ˜„"><y>#</y><d>2018-08-09</d><h>08:45</h><w>bozhidar</w>Just confirmed that actually the current codebase works fine with Clojure 1.5. <b>ðŸ˜„</b></z><z id="t1533804367" t="cfleming I could update, Iâ€™d just have to rebase and merge and Iâ€™m lazy since thereâ€™s nothing in later versions that I need."><y>#</y><d>2018-08-09</d><h>08:46</h><w>cfleming</w>I could update, Iâ€™d just have to rebase and merge and Iâ€™m lazy since thereâ€™s nothing in later versions that I need.</z><z id="t1533804376" t="cfleming Iâ€™m definitely 1.5 compatible ðŸ™‚"><y>#</y><d>2018-08-09</d><h>08:46</h><w>cfleming</w>Iâ€™m definitely 1.5 compatible <b>ðŸ™‚</b></z><z id="t1533804386" t="bozhidar Iâ€™ll add 1.7 to the build matrix especially for you."><y>#</y><d>2018-08-09</d><h>08:46</h><w>bozhidar</w>Iâ€™ll add 1.7 to the build matrix especially for you.</z><z id="t1533804399" t="cfleming â¤ï¸"><y>#</y><d>2018-08-09</d><h>08:46</h><w>cfleming</w><b>â¤ï¸</b></z><z id="t1533804425" t="cfleming Iâ€™ll update sooner or later, but no pressing need right now."><y>#</y><d>2018-08-09</d><h>08:47</h><w>cfleming</w>Iâ€™ll update sooner or later, but no pressing need right now.</z><z id="t1533804437" t="cfleming Ok, Iâ€™ll try to get this into my next release - it should be pretty trivial for me."><y>#</y><d>2018-08-09</d><h>08:47</h><w>cfleming</w>Ok, Iâ€™ll try to get this into my next release - it should be pretty trivial for me.</z></g><g id="s1"><z id="t1533804924" t="bozhidar [:attrs {:href &quot;/_/_/users/U0567Q30W&quot;}] The build matrix and the manual were updated https://travis-ci.org/nrepl/nREPL"><y>#</y><d>2018-08-09</d><h>08:55</h><w>bozhidar</w><a>@cfleming</a> The build matrix and the manual were updated <a href="https://travis-ci.org/nrepl/nREPL" target="_blank">https://travis-ci.org/nrepl/nREPL</a></z><z id="t1533804972" t="bozhidar &gt; Ok, Iâ€™ll try to get this into my next release - it should be pretty trivial for me."><y>#</y><d>2018-08-09</d><h>08:56</h><w>bozhidar</w>&gt; Ok, Iâ€™ll try to get this into my next release - it should be pretty trivial for me.</z><z id="t1533804974" t="bozhidar Thanks!"><y>#</y><d>2018-08-09</d><h>08:56</h><w>bozhidar</w>Thanks!</z><z id="t1533804996" t="bozhidar Iâ€™m looking so much to the day where everyoneâ€™s on the new nREPL and we can just focus on polishing it. ðŸ™‚"><y>#</y><d>2018-08-09</d><h>08:56</h><w>bozhidar</w>Iâ€™m looking so much to the day where everyoneâ€™s on the new nREPL and we can just focus on polishing it. <b>ðŸ™‚</b></z><z id="t1536974880" t="unwarysage Hello all again."><y>#</y><d>2018-09-15</d><h>01:28</h><w>unwarysage</w>Hello all again.</z><z id="t1536974914" t="unwarysage I am trying to find a way for a piece of middleware to access a var bound in the current thread"><y>#</y><d>2018-09-15</d><h>01:28</h><w>unwarysage</w>I am trying to find a way for a piece of middleware to access a var bound in the current thread</z><z id="t1536975005" t="unwarysage It seems messages inbound to the nREPL have :session bound to an atom containing the bindings. But the message on the way out seems to just have the session id bound"><y>#</y><d>2018-09-15</d><h>01:30</h><w>unwarysage</w>It seems messages inbound to the nREPL have <pre>:session</pre> bound to an atom containing the bindings. But the message on the way out seems to just have the session id bound</z><z id="t1536975032" t="unwarysage This confuses me, as it seems that it should be the other way around"><y>#</y><d>2018-09-15</d><h>01:30</h><w>unwarysage</w>This confuses me, as it seems that it should be the other way around</z><z id="t1536975084" t="unwarysage That session id needs to be on the inbound message, and bound variables put on the transport back"><y>#</y><d>2018-09-15</d><h>01:31</h><w>unwarysage</w>That session id needs to be on the inbound message, and bound variables put on the transport back</z><z id="t1536975092" t="unwarysage does anyone have any insight into this?"><y>#</y><d>2018-09-15</d><h>01:31</h><w>unwarysage</w>does anyone have any insight into this?</z><z id="t1536975862" t="hiredman it will depend where in the stack your middleware goes"><y>#</y><d>2018-09-15</d><h>01:44</h><w>hiredman</w>it will depend where in the stack your middleware goes</z><z id="t1536976616" t="unwarysage okay."><y>#</y><d>2018-09-15</d><h>01:56</h><w>unwarysage</w>okay.</z><z id="t1536976626" t="unwarysage Hello again [:attrs {:href &quot;/_/_/users/U0NCTKEV8&quot;}] ."><y>#</y><d>2018-09-15</d><h>01:57</h><w>unwarysage</w>Hello again <a>@hiredman</a>.</z><z id="t1536976686" t="unwarysage my set-descriptor! call only specifies &quot;eval&quot; as expected"><y>#</y><d>2018-09-15</d><h>01:58</h><w>unwarysage</w>my <pre>set-descriptor!</pre> call only specifies <pre>&quot;eval&quot;</pre> as expected</z><z id="t1536976750" t="unwarysage I wrap the transport of every inbound message to gain access to messages on the way out"><y>#</y><d>2018-09-15</d><h>01:59</h><w>unwarysage</w>I wrap the transport of every inbound message to gain access to messages on the way out</z><z id="t1536976814" t="unwarysage https://gist.github.com/UnwarySage/5f6a06c37ba6f39705d8cf76930d2dd9"><y>#</y><d>2018-09-15</d><h>02:00</h><w>unwarysage</w><a href="https://gist.github.com/UnwarySage/5f6a06c37ba6f39705d8cf76930d2dd9" target="_blank">https://gist.github.com/UnwarySage/5f6a06c37ba6f39705d8cf76930d2dd9</a></z><z id="t1536976819" t="unwarysage this is the raw code"><y>#</y><d>2018-09-15</d><h>02:00</h><w>unwarysage</w>this is the raw code</z><z id="t1536976845" t="unwarysage at present only updating the error message with a test string"><y>#</y><d>2018-09-15</d><h>02:00</h><w>unwarysage</w>at present only updating the error message with a test string</z><z id="t1536976898" t="unwarysage Ideally I would be assoc-ing in the a value derived from the raw exception. (in line 16) IE, I would love to be able to access *e"><y>#</y><d>2018-09-15</d><h>02:01</h><w>unwarysage</w>Ideally I would be assoc-ing in the a value derived from the raw exception. (in line 16) IE, I would love to be able to access <pre>*e</pre></z><z id="t1536990463" t="bozhidar Seems to me you want to do something along the lines of https://github.com/clojure-emacs/cider-nrepl/blob/master/src/cider/nrepl/middleware/util/error_handling.clj#L172"><y>#</y><d>2018-09-15</d><h>05:47</h><w>bozhidar</w>Seems to me you want to do something along the lines of <a href="https://github.com/clojure-emacs/cider-nrepl/blob/master/src/cider/nrepl/middleware/util/error_handling.clj#L172" target="_blank">https://github.com/clojure-emacs/cider-nrepl/blob/master/src/cider/nrepl/middleware/util/error_handling.clj#L172</a></z><z id="t1536993318" t="unwarysage [:attrs {:href &quot;/_/_/users/U051BLM8F&quot;}] Ah, I have seen that one before. Please correct me if I am wrong, but is that not dealing with errors thrown by the middleware, not the user code?"><y>#</y><d>2018-09-15</d><h>06:35</h><w>unwarysage</w><a>@bozhidar</a> Ah, I have seen that one before. Please correct me if I am wrong, but is that not dealing with errors thrown by the middleware, not the user code?</z><z id="t1536994029" t="bozhidar Ah, yeah - thatâ€™s right. Iâ€™m wasnâ€™t quite certain what youâ€™re trying to achieve."><y>#</y><d>2018-09-15</d><h>06:47</h><w>bozhidar</w>Ah, yeah - thatâ€™s right. Iâ€™m wasnâ€™t quite certain what youâ€™re trying to achieve.</z><z id="t1537030633" t="unwarysage I&apos;m trying to capture error messages thrown from user code, so I can re-write them for simplicity, so that beginning students can use clojure for their first programming language"><y>#</y><d>2018-09-15</d><h>16:57</h><w>unwarysage</w>I&apos;m trying to capture error messages thrown from user code, so I can re-write them for simplicity, so that beginning students can use clojure for their first programming language</z><z id="t1537086076" t="bozhidar Well, it seems to me then you just need to process the eval ex-info responses and that should be enough."><y>#</y><d>2018-09-16</d><h>08:21</h><w>bozhidar</w>Well, it seems to me then you just need to process the eval <code>ex-info</code> responses and that should be enough.</z><z id="t1537086101" t="bozhidar Or alternatively - you can simply do some extra processing on the client side."><y>#</y><d>2018-09-16</d><h>08:21</h><w>bozhidar</w>Or alternatively - you can simply do some extra processing on the client side.</z><z id="t1537086135" t="bozhidar You can also take a look at cider-nrepl â€™s stacktrace middleware."><y>#</y><d>2018-09-16</d><h>08:22</h><w>bozhidar</w>You can also take a look at <code>cider-nrepl</code>â€™s stacktrace middleware.</z><z id="t1537325462" t="bbrinck [:attrs {:href &quot;/_/_/users/U9F6U26JE&quot;}] Iâ€™m wondering the same thing. I considered giving up on the nrepl middleware and just having the users start a sub-repl (one that has a custom :caught handler) when the client REPL connects, but unfortunately this ticket https://dev.clojure.org/jira/browse/CLJ-2040 indicates itâ€™s not going to work"><y>#</y><d>2018-09-19</d><h>02:51</h><w>bbrinck</w><a>@shawx538</a> Iâ€™m wondering the same thing. I considered giving up on the nrepl middleware and just having the users start a sub-repl (one that has a custom <code>:caught</code> handler) when the client REPL connects, but unfortunately this ticket <a href="https://dev.clojure.org/jira/browse/CLJ-2040" target="_blank">https://dev.clojure.org/jira/browse/CLJ-2040</a> indicates itâ€™s not going to work</z><z id="t1537368618" t="unwarysage It&apos;s an annoying problem."><y>#</y><d>2018-09-19</d><h>14:50</h><w>unwarysage</w>It&apos;s an annoying problem.</z><z id="t1537368758" t="unwarysage the link is good reading [:attrs {:href &quot;/_/_/users/U08EKSQMS&quot;}] , thank you for sending it"><y>#</y><d>2018-09-19</d><h>14:52</h><w>unwarysage</w>the link is good reading <a>@bbrinck</a>, thank you for sending it</z><z id="t1537368833" t="bbrinck [:attrs {:href &quot;/_/_/users/U9F6U26JE&quot;}] When I get a chance, Iâ€™m going to take a crack at processing the ex-info responses as [:attrs {:href &quot;/_/_/users/U051BLM8F&quot;}] suggested. Iâ€™ll let you know if I make progress."><y>#</y><d>2018-09-19</d><h>14:53</h><w>bbrinck</w><a>@shawx538</a> When I get a chance, Iâ€™m going to take a crack at processing the <code>ex-info</code> responses as <a>@bozhidar</a> suggested. Iâ€™ll let you know if I make progress.</z><z id="t1537368913" t="unwarysage likewise. May I ask what you are hoping to do with them? personally, I and a team of others have been developing a translator, so that they can be understandable by beginners to programming altogether. [:attrs {:href &quot;/_/_/users/U08EKSQMS&quot;}]"><y>#</y><d>2018-09-19</d><h>14:55</h><w>unwarysage</w>likewise. May I ask what you are hoping to do with them? personally, I and a team of others have been developing a translator, so that they can be understandable by beginners to programming altogether. <a>@bbrinck</a></z><z id="t1537369200" t="bbrinck [:attrs {:href &quot;/_/_/users/U9F6U26JE&quot;}] Iâ€™ve been checking in on your babel work - itâ€™s exciting stuff ðŸ™‚ . My goal is a little different - Iâ€™d like users to be able to configure their REPL experience and then share their configs. This means that I could configure a REPL designed for beginners on my team (hopefully using babel!) but perhaps swap out different tools as the users learn more"><y>#</y><d>2018-09-19</d><h>15:00</h><w>bbrinck</w><a>@shawx538</a> Iâ€™ve been checking in on your babel work  - itâ€™s exciting stuff <b>ðŸ™‚</b>. My goal is a little different - Iâ€™d like users to be able to configure their REPL experience and then share their configs. This means that I could configure a REPL designed for beginners on my team (hopefully using babel!) but perhaps swap out different tools as the users learn more</z><z id="t1537369276" t="bbrinck Basically, an extension of the proof-of-concept here: https://gist.github.com/bhb/2686b023d074ac052dbc21f12f324f18 but Iâ€™d like to make it work with nrepl clients"><y>#</y><d>2018-09-19</d><h>15:01</h><w>bbrinck</w>Basically, an extension of the proof-of-concept here: <a href="https://gist.github.com/bhb/2686b023d074ac052dbc21f12f324f18" target="_blank">https://gist.github.com/bhb/2686b023d074ac052dbc21f12f324f18</a> but Iâ€™d like to make it work with nrepl clients</z><z id="t1537377315" t="dominicm https://github.com/jpmonettas/magic-sheet"><y>#</y><d>2018-09-19</d><h>17:15</h><w>dominicm</w><a href="https://github.com/jpmonettas/magic-sheet" target="_blank">https://github.com/jpmonettas/magic-sheet</a></z><z id="t1538081232" t="bozhidar If someoneâ€™s interested in auth support for nREPL they can check out https://github.com/nrepl/nREPL/pull/46"><y>#</y><d>2018-09-27</d><h>20:47</h><w>bozhidar</w>If someoneâ€™s interested in auth support for nREPL they can check out <a href="https://github.com/nrepl/nREPL/pull/46" target="_blank">https://github.com/nrepl/nREPL/pull/46</a></z><z id="t1538112178" t="dominicm Thinking about it, I strongly agree with you that it should be middleware. However the dependency system poses a problem for that approach. I don&apos;t have a good idea that I like though. "><y>#</y><d>2018-09-28</d><h>05:22</h><w>dominicm</w>Thinking about it, I strongly agree with you that it should be middleware. However the dependency system poses a problem for that approach. I don&apos;t have a good idea that I like though. </z><z id="t1538115983" t="bozhidar [:attrs {:href &quot;/_/_/users/U09LZR36F&quot;}] I think if itâ€™s just the root of all deps that should work out pretty well in practice. On server boot we can set some flag that controls the behaviour of the middleware and makes it do something or nothing. But I havenâ€™t thought that much about this either."><y>#</y><d>2018-09-28</d><h>06:26</h><w>bozhidar</w><a>@dominicm</a> I think if itâ€™s just the root of all deps that should work out pretty well in practice. On server boot we can set some flag that controls the behaviour of the middleware and makes it do something or nothing. But I havenâ€™t thought that much about this either.</z><z id="t1538116342" t="dominicm [:attrs {:href &quot;/_/_/users/U051BLM8F&quot;}] the root of all deps? "><y>#</y><d>2018-09-28</d><h>06:32</h><w>dominicm</w><a>@bozhidar</a> the root of all deps? </z><z id="t1538121051" t="bozhidar [:attrs {:href &quot;/_/_/users/U09LZR36F&quot;}] The root of the middleware stack - every middleware would expect the auth middleware to be present."><y>#</y><d>2018-09-28</d><h>07:50</h><w>bozhidar</w><a>@dominicm</a> The root of the middleware stack - every middleware would expect the auth middleware to be present.</z><z id="t1538121094" t="bozhidar Generally thatâ€™s not really needed - I guess weâ€™re mostly concerned about securing eval-type operations."><y>#</y><d>2018-09-28</d><h>07:51</h><w>bozhidar</w>Generally thatâ€™s not really needed - I guess weâ€™re mostly concerned about securing eval-type operations.</z><z id="t1538122797" t="dominicm That makes sense. But conflates authentication with authorization. "><y>#</y><d>2018-09-28</d><h>08:19</h><w>dominicm</w>That makes sense. But conflates authentication with authorization. </z><z id="t1538122823" t="dominicm I guess the auth middleware could evaluate the request statically and determine whether it&apos;s safe. "><y>#</y><d>2018-09-28</d><h>08:20</h><w>dominicm</w>I guess the auth middleware could evaluate the request statically and determine whether it&apos;s safe. </z><z id="t1538122861" t="dominicm Is it possible to add dependencies as a user, as opposed to an author of middleware. I think that would be important. "><y>#</y><d>2018-09-28</d><h>08:21</h><w>dominicm</w>Is it possible to add dependencies as a user, as opposed to an author of middleware. I think that would be important. </z><z id="t1538142155" t="bozhidar &gt; That makes sense. But conflates authentication with authorization. Yep, thatâ€™s true. Anyways, thatâ€™s why I asked for more people to share some feedback - I certainly donâ€™t know whatâ€™s the optimum course of action, but I feel that anything will be an improvement over no security at all. ðŸ™‚"><y>#</y><d>2018-09-28</d><h>13:42</h><w>bozhidar</w>&gt; That makes sense. But conflates authentication with authorization.

Yep, thatâ€™s true. Anyways, thatâ€™s why I asked for more people to share some feedback - I certainly donâ€™t know whatâ€™s the optimum course of action, but I feel that anything will be an improvement over no security at all. <b>ðŸ™‚</b></z><z id="t1538146883" t="dominicm So, if we make this middleware, the world needs to go out and decide whether it&apos;s middleware needs to depend on auth. Conditional on being able to extend the dependencies and authorization of an op as a user, that seems fine. Separating authentication and authorization seems like a good pre emptive strike, particularly for us as we would want to inspect responses for particular values and block them under certain conditions (e.g. Breakglass)"><y>#</y><d>2018-09-28</d><h>15:01</h><w>dominicm</w>So, if we make this middleware, the world needs to go out and decide whether it&apos;s middleware needs to depend on auth.

Conditional on being able to extend the dependencies and authorization of an op as a user, that seems fine.

Separating authentication and authorization seems like a good pre emptive strike, particularly for us as we would want to inspect responses for particular values and block them under certain conditions (e.g. Breakglass)</z><z id="t1538150615" t="bozhidar &gt; So, if we make this middleware, the world needs to go out and decide whether itâ€™s middleware needs to depend on auth."><y>#</y><d>2018-09-28</d><h>16:03</h><w>bozhidar</w>&gt; So, if we make this middleware, the world needs to go out and decide whether itâ€™s middleware needs to depend on auth.</z><z id="t1538150630" t="bozhidar Thatâ€™s true, but the same applies for some very basic things even now - e.g. sessions."><y>#</y><d>2018-09-28</d><h>16:03</h><w>bozhidar</w>Thatâ€™s true, but the same applies for some very basic things even now - e.g. sessions.</z><z id="t1538150669" t="bozhidar One can argue they should always be present, but since they are middleware itâ€™s up to middleware authors to decide how to leverage them."><y>#</y><d>2018-09-28</d><h>16:04</h><w>bozhidar</w>One can argue they should always be present, but since they are middleware itâ€™s up to middleware authors to decide how to leverage them.</z><z id="t1538150809" t="bozhidar &gt; Separating authentication and authorization seems like a good pre emptive strike, particularly for us as we would want to inspect responses for particular values and block them under certain conditions (e.g. Breakglass)"><y>#</y><d>2018-09-28</d><h>16:06</h><w>bozhidar</w>&gt; Separating authentication and authorization seems like a good pre emptive strike, particularly for us as we would want to inspect responses for particular values and block them under certain conditions (e.g. Breakglass)</z><z id="t1538150882" t="bozhidar Btw, what when you talk about authorization youâ€™re mostly talking about making sure people donâ€™t execute some insecure code, right? Because if we go with a simple authentication scheme with no permissions attached to it then there wonâ€™t be much to check for when it comes to authorization."><y>#</y><d>2018-09-28</d><h>16:08</h><w>bozhidar</w>Btw, what when you talk about authorization youâ€™re mostly talking about making sure people donâ€™t execute some insecure code, right? Because if we go with a simple authentication scheme with no permissions attached to it then there wonâ€™t be much to check for when it comes to authorization.</z><z id="t1538151550" t="dominicm I would personally probably build something on a claim system that my authorization system would then check. "><y>#</y><d>2018-09-28</d><h>16:19</h><w>dominicm</w>I would personally probably build something on a claim system that my authorization system would then check. </z><z id="t1538151694" t="bozhidar I donâ€™t understand what you mean. Can you elaborate on this?"><y>#</y><d>2018-09-28</d><h>16:21</h><w>bozhidar</w>I donâ€™t understand what you mean. Can you elaborate on this?</z><z id="t1538172361" t="dominicm You get claims to certain functionality in production. Perhaps evaluations from a predefined set, or just refresh. That would encode into the token along with an expiration and a signature. "><y>#</y><d>2018-09-28</d><h>22:06</h><w>dominicm</w>You get claims to certain functionality in production. Perhaps evaluations from a predefined set, or just refresh. That would encode into the token along with an expiration and a signature. </z><z id="t1538199512" t="bozhidar Thatâ€™d be an interesting approach indeed."><y>#</y><d>2018-09-29</d><h>05:38</h><w>bozhidar</w>Thatâ€™d be an interesting approach indeed.</z><z id="t1539510901" t="dominicm You know what would be cool? If you could start an nrepl the same way a socket repl is started. JVM parameters. Then you would be able to: - Easily run in production, no matter the main - Jack-in on the CLJ tools wouldn&apos;t require 2 parameters for left &amp; right of the command line. And it wouldn&apos;t interfere with any main options the user sets. Downside: - Requires writing &amp; compiling java (but this is a large part of nrepl already)"><y>#</y><d>2018-10-14</d><h>09:55</h><w>dominicm</w>You know what would be cool? If you could start an nrepl the same way a socket repl is started. JVM parameters. Then you would be able to:
- Easily run in production, no matter the main
- Jack-in on the CLJ tools wouldn&apos;t require 2 parameters for left &amp; right of the command line. And it wouldn&apos;t interfere with any main options the user sets.

Downside:
- Requires writing &amp; compiling java (but this is a large part of nrepl already)</z><z id="t1539510915" t="dominicm I bet we can use the same technique as the socket repl does."><y>#</y><d>2018-10-14</d><h>09:55</h><w>dominicm</w>I bet we can use the same technique as the socket repl does.</z><z id="t1539510955" t="dominicm In theory it would allow you to also jack in with lein/boot. It would ignore any boot/lein settings, that might be a good thing though ðŸ˜„"><y>#</y><d>2018-10-14</d><h>09:55</h><w>dominicm</w>In theory it would allow you to also jack in with lein/boot. It would ignore any boot/lein settings, that might be a good thing though <b>ðŸ˜„</b></z><z id="t1539511367" t="dominicm I opened an issue, I think this is worth discussing https://github.com/nrepl/nREPL/issues/54"><y>#</y><d>2018-10-14</d><h>10:02</h><w>dominicm</w>I opened an issue, I think this is worth discussing <a href="https://github.com/nrepl/nREPL/issues/54" target="_blank">https://github.com/nrepl/nREPL/issues/54</a></z><z id="t1539525007" t="bozhidar Sure. Iâ€™ll comment there, as here the history tends to evaporate pretty quickly."><y>#</y><d>2018-10-14</d><h>13:50</h><w>bozhidar</w>Sure. Iâ€™ll comment there, as here the history tends to evaporate pretty quickly.</z><z id="t1539532900" t="bozhidar &gt; - Requires writing &amp; compiling java (but this is a large part of nrepl already)"><y>#</y><d>2018-10-14</d><h>16:01</h><w>bozhidar</w>&gt; - Requires writing &amp; compiling java (but this is a large part of nrepl already)</z><z id="t1539532974" t="bozhidar I was a bit puzzled by this part, btw. nREPL uses Java a lot via interop, but it doesnâ€™t really have any purely Java sources. ðŸ™‚ Just as an FYI; Iâ€™m not opposed to writing some good old Java for great good."><y>#</y><d>2018-10-14</d><h>16:02</h><w>bozhidar</w>I was a bit puzzled by this part, btw. nREPL uses Java a lot via interop, but it doesnâ€™t really have any purely Java sources. <b>ðŸ™‚</b> Just as an FYI; Iâ€™m not opposed to writing some good old Java for great good.</z><z id="t1539539710" t="dominicm Oh really? I guess I&apos;m misremembering. "><y>#</y><d>2018-10-14</d><h>17:55</h><w>dominicm</w>Oh really? I guess I&apos;m misremembering. </z><z id="t1539541338" t="bozhidar Really. ðŸ™‚ There used to be some Java code back in the day, but itâ€™s all gone now except for"><y>#</y><d>2018-10-14</d><h>18:22</h><w>bozhidar</w>Really. <b>ðŸ™‚</b> There used to be some Java code back in the day, but itâ€™s all gone now except for</z><z id="t1539541380" t="bozhidar https://github.com/nrepl/nREPL/blob/master/src/java/nrepl/main.java"><y>#</y><d>2018-10-14</d><h>18:23</h><w>bozhidar</w><a href="https://github.com/nrepl/nREPL/blob/master/src/java/nrepl/main.java" target="_blank">https://github.com/nrepl/nREPL/blob/master/src/java/nrepl/main.java</a></z><z id="t1539541393" t="bozhidar (which I was planning to delete)"><y>#</y><d>2018-10-14</d><h>18:23</h><w>bozhidar</w>(which I was planning to delete)</z><z id="t1539541432" t="bozhidar [:attrs {:href &quot;/_/_/users/U09LZR36F&quot;}] Btw, does the manual generation work only with Node 8?"><y>#</y><d>2018-10-14</d><h>18:23</h><w>bozhidar</w><a>@dominicm</a> Btw, does the manual generation work only with Node 8?</z><z id="t1539541470" t="bozhidar Iâ€™m on 10 and I get some weird errors during npm install ."><y>#</y><d>2018-10-14</d><h>18:24</h><w>bozhidar</w>Iâ€™m on 10 and I get some weird errors during <code>npm install</code>.</z><z id="t1539541478" t="dominicm I think it does yeah. "><y>#</y><d>2018-10-14</d><h>18:24</h><w>dominicm</w>I think it does yeah. </z><z id="t1539542907" t="bozhidar OK, seems to install with 8."><y>#</y><d>2018-10-14</d><h>18:48</h><w>bozhidar</w>OK, seems to install with 8.</z><z id="t1539542914" t="bozhidar Any idea what this error is:"><y>#</y><d>2018-10-14</d><h>18:48</h><w>bozhidar</w>Any idea what this error is:</z><z id="t1539542916" t="bozhidar &gt; error: Specified start page for site not found: nrepl::index.adoc"><y>#</y><d>2018-10-14</d><h>18:48</h><w>bozhidar</w>&gt; error: Specified start page for site not found: nrepl::index.adoc</z><z id="t1539542929" t="bozhidar Happens when I do ./antora site.yml"><y>#</y><d>2018-10-14</d><h>18:48</h><w>bozhidar</w>Happens when I do <code>./antora site.yml</code></z><z id="t1539544017" t="dominicm [:attrs {:href &quot;/_/_/users/U051BLM8F&quot;}] try adding master to the list of branches, or is it there already? "><y>#</y><d>2018-10-14</d><h>19:06</h><w>dominicm</w><a>@bozhidar</a> try adding master to the list of branches, or is it there already? </z><z id="t1539554868" t="bozhidar Yeah, that worked."><y>#</y><d>2018-10-14</d><h>22:07</h><w>bozhidar</w>Yeah, that worked.</z><z id="t1539554881" t="bozhidar I wonder why master doesnâ€™t show in the drop down version though."><y>#</y><d>2018-10-14</d><h>22:08</h><w>bozhidar</w>I wonder why <code>master</code> doesnâ€™t show in the drop down version though.</z><z id="t1539554908" t="bozhidar Iâ€™ve seen in the demos that both tags and branches should appear there, but maybe I just donâ€™t understand it well enough so far."><y>#</y><d>2018-10-14</d><h>22:08</h><w>bozhidar</w>Iâ€™ve seen in the demos that both tags and branches should appear there, but maybe I just donâ€™t understand it well enough so far.</z><z id="t1539554920" t="bozhidar At any rate - I managed to generate something. ðŸ™‚"><y>#</y><d>2018-10-14</d><h>22:08</h><w>bozhidar</w>At any rate - I managed to generate something. <b>ðŸ™‚</b></z><z id="t1539582690" t="dominicm [:attrs {:href &quot;/_/_/users/U051BLM8F&quot;}] the version is in a yml file in the nrepl repo"><y>#</y><d>2018-10-15</d><h>05:51</h><w>dominicm</w><a>@bozhidar</a> the version is in a yml file in the nrepl repo</z><z id="t1539593951" t="bozhidar [:attrs {:href &quot;/_/_/users/U09LZR36F&quot;}] Iâ€™m puzzled. Whatâ€™s the purpose of that config file? It seems to duplicate some of the info in the site.yml. I guess assumed that running antora would generate the docs for all non-blacklisted tags (meaning no tags currently) + the master branch."><y>#</y><d>2018-10-15</d><h>08:59</h><w>bozhidar</w><a>@dominicm</a> Iâ€™m puzzled. Whatâ€™s the purpose of that config file? It seems to duplicate some of the info in the site.yml. I guess assumed that running antora would generate the docs for all non-blacklisted tags (meaning no tags currently) + the <code>master</code> branch.</z><z id="t1539593965" t="bozhidar (as I added it to site.yml )"><y>#</y><d>2018-10-15</d><h>08:59</h><w>bozhidar</w>(as I added it to <code>site.yml</code>)</z><z id="t1539594112" t="dominicm [:attrs {:href &quot;/_/_/users/U051BLM8F&quot;}] it&apos;s a little confusing in the case you have 1 to 1 mapping. Antora allows you to build multiple repos into one site. One example would be for Asciidoctor, they bundle asciidoctor, asciidoctorJ, asciidoctor.js, etc. into one site. All as part of the Asciidoctor organization. Each of those site &quot;sections&quot; has their own antora.yml, which details information about the component. e.g. version, name, title."><y>#</y><d>2018-10-15</d><h>09:01</h><w>dominicm</w><a>@bozhidar</a> it&apos;s a little confusing in the case you have 1 to 1 mapping. Antora allows you to build multiple repos into one site.

One example would be for Asciidoctor, they bundle asciidoctor, asciidoctorJ, asciidoctor.js, etc. into one site. All as part of the Asciidoctor organization.

Each of those site &quot;sections&quot; has their own antora.yml, which details information about the component. e.g. version, name, title.</z><z id="t1539594149" t="dominicm https://docs.antora.org/antora/1.1/component-structure/ might be useful."><y>#</y><d>2018-10-15</d><h>09:02</h><w>dominicm</w><a href="https://docs.antora.org/antora/1.1/component-structure/" target="_blank">https://docs.antora.org/antora/1.1/component-structure/</a> might be useful.</z><z id="t1539594383" t="bozhidar Yeah, I got this part, but I thought the config we had in the site.yml pertained to the only component we have. ðŸ™‚"><y>#</y><d>2018-10-15</d><h>09:06</h><w>bozhidar</w>Yeah, I got this part, but I thought the config we had in the site.yml pertained to the only component we have. <b>ðŸ™‚</b></z><z id="t1539594437" t="bozhidar In general I can how useful this component structure would be if we decide to put in the manual also something about piggieback, drawbridge, cider-nrepl, refactor-nrepl, etc."><y>#</y><d>2018-10-15</d><h>09:07</h><w>bozhidar</w>In general I can how useful this component structure would be if we decide to put in the manual also something about piggieback, drawbridge, cider-nrepl, refactor-nrepl, etc.</z><z id="t1539594442" t="dominicm Bingo."><y>#</y><d>2018-10-15</d><h>09:07</h><w>dominicm</w>Bingo.</z><z id="t1539594461" t="dominicm And very cool is how there&apos;s a xref system in place for safely referencing across components."><y>#</y><d>2018-10-15</d><h>09:07</h><w>dominicm</w>And very cool is how there&apos;s a xref system in place for safely referencing across components.</z><z id="t1539594481" t="dominicm https://docs.antora.org/antora/1.0/asciidoc/page-to-page-xref/"><y>#</y><d>2018-10-15</d><h>09:08</h><w>dominicm</w><a href="https://docs.antora.org/antora/1.0/asciidoc/page-to-page-xref/" target="_blank">https://docs.antora.org/antora/1.0/asciidoc/page-to-page-xref/</a></z><z id="t1539594648" t="dominicm I want to try and get cljdoc to support the xref: macro, because it would allow for some really neat things like: Takes a xref:bidi::vhosts.adoc#model[Bidi VHosts Model] and returns a Yada Handler which processes Yada Resources inside. "><y>#</y><d>2018-10-15</d><h>09:10</h><w>dominicm</w>I want to try and get cljdoc to support the xref: macro, because it would allow for some really neat things like:

<pre>Takes a xref:bidi::vhosts.adoc#model[Bidi VHosts Model] and returns a Yada Handler which processes Yada Resources inside.
</pre></z><z id="t1539594658" t="dominicm Where bidi is just another project on cljdoc."><y>#</y><d>2018-10-15</d><h>09:10</h><w>dominicm</w>Where bidi is just another project on cljdoc.</z><z id="t1539595249" t="bozhidar Yeah, thatâ€™s pretty cool indeed."><y>#</y><d>2018-10-15</d><h>09:20</h><w>bozhidar</w>Yeah, thatâ€™s pretty cool indeed.</z><z id="t1539675420" t="bozhidar [:attrs {:href &quot;/_/_/users/U09LZR36F&quot;}] So, whatâ€™s your idea about loading nREPL early on? Just adding some class with static initializer perhaps?"><y>#</y><d>2018-10-16</d><h>07:37</h><w>bozhidar</w><a>@dominicm</a> So, whatâ€™s your idea about loading nREPL early on? Just adding some class with static initializer perhaps?</z><z id="t1539675461" t="dominicm [:attrs {:href &quot;/_/_/users/U051BLM8F&quot;}] I tried that, it didn&apos;t work ðŸ˜ž I didn&apos;t realise that Clojure is able to do this because everyone is running clojure, so clojure.lang.RT is pretty much always loaded."><y>#</y><d>2018-10-16</d><h>07:37</h><w>dominicm</w><a>@bozhidar</a> I tried that, it didn&apos;t work <b>ðŸ˜ž</b> I didn&apos;t realise that Clojure is able to do this because everyone is running clojure, so clojure.lang.RT is pretty much always loaded.</z><z id="t1539675625" t="bozhidar Iâ€™m out of ideas then, but Iâ€™m certain youâ€™ll think of something. I got pretty excited when you proposed this, so I hope we can make it work somehow."><y>#</y><d>2018-10-16</d><h>07:40</h><w>bozhidar</w>Iâ€™m out of ideas then, but Iâ€™m certain youâ€™ll think of something. I got pretty excited when you proposed this, so I hope we can make it work somehow.</z><z id="t1539675639" t="bozhidar Ideally without having to use a patched version of Clojure. ðŸ˜„"><y>#</y><d>2018-10-16</d><h>07:40</h><w>bozhidar</w>Ideally without having to use a patched version of Clojure. <b>ðŸ˜„</b></z><z id="t1539676810" t="dominicm the compromise might be that a user has to do (import nrepl.server) somewhere in their codebase. But that isn&apos;t wonderful for loading ourselves into java programs."><y>#</y><d>2018-10-16</d><h>08:00</h><w>dominicm</w>the compromise might be that a user has to do <code>(import nrepl.server)</code> somewhere in their codebase. But that isn&apos;t wonderful for loading ourselves into java programs.</z><z id="t1540314803" t="dotemacs I remember reading that http://nrepl.org domain was purchased: https://github.com/nrepl/nrepl/issues/31 which now points to https://nrepl.readthedocs.io/en/latest/ But I also see that http://nrepl.xyz exists and redirects to: https://nrepl.xyz/nrepl/0.4.5/index.html which Iâ€™m guessing is the automated documentation generated by http://cljdoc.org (which used to be http://cljdoc.xyz ) I was about to ask which URL will be used, but seeing the GitHub project page, https://nrepl.xyz is mentioned. So that mystery is solved. Looking at https://cljdoc.org/d/nrepl/nrepl/0.4.5/doc/readme and https://nrepl.xyz/nrepl/0.4.5/index.html the pages have a different style. Is this just the way cljdoc service is meant to work? One uniform style for all the projects sitting under http://cljdoc.org domain and another style if the documentation is accessed via the custom domain of the project?"><y>#</y><d>2018-10-23</d><h>17:13</h><w>dotemacs</w>I remember reading that <a href="http://nrepl.org" target="_blank">http://nrepl.org</a> domain was purchased: <a href="https://github.com/nrepl/nrepl/issues/31" target="_blank">https://github.com/nrepl/nrepl/issues/31</a>
which now points to <a href="https://nrepl.readthedocs.io/en/latest/" target="_blank">https://nrepl.readthedocs.io/en/latest/</a>
But I also see that <a href="http://nrepl.xyz" target="_blank">http://nrepl.xyz</a> exists and redirects to: <a href="https://nrepl.xyz/nrepl/0.4.5/index.html" target="_blank">https://nrepl.xyz/nrepl/0.4.5/index.html</a> which Iâ€™m guessing is the automated documentation generated by <a href="http://cljdoc.org" target="_blank">http://cljdoc.org</a> (which used to be <a href="http://cljdoc.xyz" target="_blank">http://cljdoc.xyz</a>)

I was about to ask which URL will be used, but seeing the GitHub project page, <a href="https://nrepl.xyz" target="_blank">https://nrepl.xyz</a> is mentioned. So that mystery is solved.

Looking at <a href="https://cljdoc.org/d/nrepl/nrepl/0.4.5/doc/readme" target="_blank">https://cljdoc.org/d/nrepl/nrepl/0.4.5/doc/readme</a> and
<a href="https://nrepl.xyz/nrepl/0.4.5/index.html" target="_blank">https://nrepl.xyz/nrepl/0.4.5/index.html</a> the pages have a different style.
Is this just the way cljdoc service is meant to work?
One uniform style for all the projects sitting under <a href="http://cljdoc.org" target="_blank">http://cljdoc.org</a> domain and another style if the documentation is accessed via the custom domain of the project?</z><z id="t1540316327" t="dominicm [:attrs {:href &quot;/_/_/users/U3SG7RX7A&quot;}] the self hosted documentation is just antora."><y>#</y><d>2018-10-23</d><h>17:38</h><w>dominicm</w><a>@dotemacs</a> the self hosted documentation is just antora.</z><z id="t1540316773" t="bozhidar &gt; One uniform style for all the projects sitting under http://cljdoc.org domain and another style if the documentation is accessed via the custom domain of the project?"><y>#</y><d>2018-10-23</d><h>17:46</h><w>bozhidar</w>&gt; One uniform style for all the projects sitting under <a href="http://cljdoc.org" target="_blank">http://cljdoc.org</a> domain and another style if the documentation is accessed via the custom domain of the project?</z><z id="t1540316812" t="bozhidar http://nrepl.org was purchased by [:attrs {:href &quot;/_/_/users/U04V5T0V8&quot;}] , but he was busy lately and I got another domain to make it easier for me to play with Antora."><y>#</y><d>2018-10-23</d><h>17:46</h><w>bozhidar</w><a href="http://nrepl.org" target="_blank">http://nrepl.org</a> was purchased by <a>@arrdem</a>, but he was busy lately and I got another domain to make it easier for me to play with Antora.</z><z id="t1540316843" t="bozhidar I hope weâ€™ll use it at some point, but the old RTD docs are dead and http://nrepl.xyz is the single source of truth."><y>#</y><d>2018-10-23</d><h>17:47</h><w>bozhidar</w>I hope weâ€™ll use it at some point, but the old RTD docs are dead and <a href="http://nrepl.xyz" target="_blank">http://nrepl.xyz</a> is the single source of truth.</z><z id="t1540316904" t="bozhidar Weâ€™ll likely link to all the pages in http://cljdoc.org as well, but itâ€™s lower priority compared to actually writing some goods docs."><y>#</y><d>2018-10-23</d><h>17:48</h><w>bozhidar</w>Weâ€™ll likely link to all the pages in <a href="http://cljdoc.org" target="_blank">http://cljdoc.org</a> as well, but itâ€™s lower priority compared to actually writing some goods docs.</z><z id="t1540316919" t="bozhidar Iâ€™ve spent a lot of time lately extending whatâ€™s on http://nrepl.xyz ."><y>#</y><d>2018-10-23</d><h>17:48</h><w>bozhidar</w>Iâ€™ve spent a lot of time lately extending whatâ€™s on <a href="http://nrepl.xyz" target="_blank">http://nrepl.xyz</a>.</z><z id="t1540317015" t="bozhidar We also need to cut a new release for the http://cljdoc.org stuff to be get regenerated."><y>#</y><d>2018-10-23</d><h>17:50</h><w>bozhidar</w>We also need to cut a new release for the <a href="http://cljdoc.org" target="_blank">http://cljdoc.org</a> stuff to be get regenerated.</z><z id="t1540318083" t="dotemacs Thank you both for the answer."><y>#</y><d>2018-10-23</d><h>18:08</h><w>dotemacs</w>Thank you both for the answer.</z><z id="t1540819709" t="bozhidar https://metaredux.com/posts/2018/10/29/nrepl-redux.html"><y>#</y><d>2018-10-29</d><h>13:28</h><w>bozhidar</w><a href="https://metaredux.com/posts/2018/10/29/nrepl-redux.html" target="_blank">https://metaredux.com/posts/2018/10/29/nrepl-redux.html</a></z><z id="t1540822669" t="eraserhd Hey, this reminds me. I have a need for an nREPL client that is thin and super light-weight, for CLI use. Well, not exactly for CLI use, but for use by an editor that is heavily bought into the idea of small tools and UNIX. Which means, I think, that the client needs to maintain persistent connection, by forking and forwarding."><y>#</y><d>2018-10-29</d><h>14:17</h><w>eraserhd</w>Hey, this reminds me.  I have a  need for an nREPL client that is thin and super light-weight, for CLI use.  Well, not exactly for CLI use, but for use by an editor  that is heavily bought into the idea of small tools and UNIX.  Which means, I think, that the client needs to maintain persistent connection, by forking and forwarding.</z><z id="t1540822718" t="eraserhd I started hacking on a tool a few weeks ago (called rep , because it doesn&apos;t l ). But never got it useful."><y>#</y><d>2018-10-29</d><h>14:18</h><w>eraserhd</w>I started hacking on a tool a few weeks ago (called <code>rep</code>, because it doesn&apos;t <code>l</code>).  But never got it useful.</z><z id="t1540822847" t="dominicm [:attrs {:href &quot;/_/_/users/U0ECYL0ET&quot;}] python? ðŸ˜„"><y>#</y><d>2018-10-29</d><h>14:20</h><w>dominicm</w><a>@eraserhd</a> python? <b>ðŸ˜„</b></z><z id="t1540822920" t="eraserhd Vim loads python dynamically, so it can keep the connection open, I thought. Kakoune won&apos;t do that."><y>#</y><d>2018-10-29</d><h>14:22</h><w>eraserhd</w>Vim loads python dynamically, so it can keep the connection open, I thought.  Kakoune won&apos;t do that.</z><z id="t1540822948" t="dominicm But a python cli would work?"><y>#</y><d>2018-10-29</d><h>14:22</h><w>dominicm</w>But a python cli would work?</z><z id="t1540822970" t="eraserhd Python startup time is acceptable, IIRC."><y>#</y><d>2018-10-29</d><h>14:22</h><w>eraserhd</w>Python startup time is acceptable, IIRC.</z><z id="t1540822974" t="dominicm alternatively, use go, I had success with that too."><y>#</y><d>2018-10-29</d><h>14:22</h><w>dominicm</w>alternatively, use go, I had success with that too.</z><z id="t1540822992" t="eraserhd I started hacking in Rust, &apos;cause I like it so much."><y>#</y><d>2018-10-29</d><h>14:23</h><w>eraserhd</w>I started hacking in Rust, &apos;cause I like it so much.</z><z id="t1540823051" t="dominicm A bencode decoder can be written quite easily, I encourage you to continue with that path"><y>#</y><d>2018-10-29</d><h>14:24</h><w>dominicm</w>A bencode decoder can be written quite easily, I encourage you to continue with that path</z><z id="t1540823093" t="eraserhd OK. It&apos;s on hold for a couple weeks. I was actually wondering if anybody had done something like this."><y>#</y><d>2018-10-29</d><h>14:24</h><w>eraserhd</w>OK.  It&apos;s on hold for a couple weeks.  I was actually wondering if anybody had done something like this.</z><z id="t1540823273" t="dominicm I thought about it, but I came to the conclusion that such a thing would have to end up editor-specific, and wouldn&apos;t be an effective use of my time because of nvim&apos;s remote plugins."><y>#</y><d>2018-10-29</d><h>14:27</h><w>dominicm</w>I thought about it, but I came to the conclusion that such a thing would have to end up editor-specific, and wouldn&apos;t be an effective use of my time because of nvim&apos;s remote plugins.</z><z id="t1540823303" t="dominicm You end up needing to put things in a form that your editor can richly inspect."><y>#</y><d>2018-10-29</d><h>14:28</h><w>dominicm</w>You end up needing to put things in a form that your editor can richly inspect.</z><z id="t1540823335" t="eraserhd Hmm, that&apos;s not my plan. What does it need to richly inspect?"><y>#</y><d>2018-10-29</d><h>14:28</h><w>eraserhd</w>Hmm, that&apos;s not my plan.  What does it need to richly inspect?</z><z id="t1540823364" t="dominicm [:attrs {:href &quot;/_/_/users/U0ECYL0ET&quot;}] e.g. key-values."><y>#</y><d>2018-10-29</d><h>14:29</h><w>dominicm</w><a>@eraserhd</a> e.g. key-values.</z><z id="t1540823393" t="eraserhd So, in terms of the REPL window, it will write, pre-formatted to a fifo. But the client rep command will return EDN or some such structured output."><y>#</y><d>2018-10-29</d><h>14:29</h><w>eraserhd</w>So, in terms of the REPL window, it will write, pre-formatted to a fifo.  But the client <code>rep</code> command will return EDN or some such structured output.</z><z id="t1540823413" t="eraserhd (Kakoune can follow a fifo.)"><y>#</y><d>2018-10-29</d><h>14:30</h><w>eraserhd</w>(Kakoune can follow a fifo.)</z><z id="t1540823415" t="dominicm More obvious example, if you want to have something like quickfix populated by info about a var, you&apos;ll want to convert to a vim structure in order to setqflist()"><y>#</y><d>2018-10-29</d><h>14:30</h><w>dominicm</w>More obvious example, if you want to have something like quickfix populated by info about a var, you&apos;ll want to convert to a vim structure in order to <code>setqflist()</code></z><z id="t1540823426" t="dominicm If you can parse edn in kak, then you have way more power than me ðŸ™‚"><y>#</y><d>2018-10-29</d><h>14:30</h><w>dominicm</w>If you can parse edn in kak, then you have way more power than me <b>ðŸ™‚</b></z><z id="t1540823464" t="eraserhd I guess I can&apos;t, actually. But adding result format options is not too bad."><y>#</y><d>2018-10-29</d><h>14:31</h><w>eraserhd</w>I guess I can&apos;t, actually.  But adding result format options is not too bad.</z><z id="t1540823528" t="dominicm I guess everything probably has json support now, I don&apos;t think vim did at the time I was looking at this"><y>#</y><d>2018-10-29</d><h>14:32</h><w>dominicm</w>I guess everything probably has json support now, I don&apos;t think vim did at the time I was looking at this</z><z id="t1540900821" t="flowthing So I wanted to give Drawbridge a go. I added the Drawbridge Ring handler into my web app and tried to connect to it like this: (require &apos;[nrepl.core :as nrepl] &apos;[drawbridge.client :as client]) (with-open [conn (nrepl/url-connect &quot;&quot;)] (-&gt; (nrepl/client conn 1000) (nrepl/message {:op &quot;eval&quot; :code &quot;(+ 2 3)&quot;}) nrepl/response-values)) But I get this error: ArityException Wrong number of args (0) passed to: client/ring-client-transport/read--2318 clojure.lang.AFn.throwArity (AFn.java:429)"><y>#</y><d>2018-10-30</d><h>12:00</h><w>flowthing</w>So I wanted to give Drawbridge a go. I added the Drawbridge Ring handler into my web app and tried to connect to it like this:

<pre>(require &apos;[nrepl.core :as nrepl]
           &apos;[drawbridge.client :as client])

(with-open [conn (nrepl/url-connect &quot;&quot;)]
    (-&gt; (nrepl/client conn 1000)
        (nrepl/message {:op &quot;eval&quot; :code &quot;(+ 2 3)&quot;})
        nrepl/response-values))
</pre>

But I get this error: <code>ArityException Wrong number of args (0) passed to: client/ring-client-transport/read--2318  clojure.lang.AFn.throwArity (AFn.java:429)</code></z><z id="t1540900886" t="flowthing It looks like the read function in the Drawbridge client expects a single argument ( https://github.com/nrepl/drawbridge/blob/941403588c1cde61f8041f4de82ed53bea837590/src/drawbridge/client.clj#L50 ) but the calling code in nrepl.transport doesn&apos;t supply any https://github.com/nrepl/nrepl/blob/ff70f1e4cac4ee72cdaba1d95f1216640c84e572/src/clojure/nrepl/transport.clj#L41) ."><y>#</y><d>2018-10-30</d><h>12:01</h><w>flowthing</w>It looks like the <code>read</code> function in the Drawbridge client expects a single argument (<a href="https://github.com/nrepl/drawbridge/blob/941403588c1cde61f8041f4de82ed53bea837590/src/drawbridge/client.clj#L50" target="_blank">https://github.com/nrepl/drawbridge/blob/941403588c1cde61f8041f4de82ed53bea837590/src/drawbridge/client.clj#L50</a>) but the calling code in <code>nrepl.transport</code> doesn&apos;t supply any <a href="https://github.com/nrepl/nrepl/blob/ff70f1e4cac4ee72cdaba1d95f1216640c84e572/src/clojure/nrepl/transport.clj#L41)" target="_blank">https://github.com/nrepl/nrepl/blob/ff70f1e4cac4ee72cdaba1d95f1216640c84e572/src/clojure/nrepl/transport.clj#L41)</a>.</z><z id="t1540900946" t="flowthing I can&apos;t see how that&apos;d work, but maybe I&apos;m missing something. I didn&apos;t dive too deeply into the code yet."><y>#</y><d>2018-10-30</d><h>12:02</h><w>flowthing</w>I can&apos;t see how that&apos;d work, but maybe I&apos;m missing something. I didn&apos;t dive too deeply into the code yet.</z><z id="t1540906827" t="bozhidar [:attrs {:href &quot;/_/_/users/U4ZDX466T&quot;}] File a ticket for this. I think someone mention this breakage as well, but I didnâ€™t find a time to investigate it and I forgot about it."><y>#</y><d>2018-10-30</d><h>13:40</h><w>bozhidar</w><a>@flowthing</a> File a ticket for this. I think someone mention this breakage as well, but I didnâ€™t find a time to investigate it and I forgot about it.</z><z id="t1540906862" t="bozhidar The fix should be pretty simple, although Iâ€™m puzzled how we broke this in the first place, as I havenâ€™t really touched the code apart from updating the namespaces for nREPL 0.4 compatibility."><y>#</y><d>2018-10-30</d><h>13:41</h><w>bozhidar</w>The fix should be pretty simple, although Iâ€™m puzzled how we broke this in the first place, as I havenâ€™t really touched the code apart from updating the namespaces for nREPL 0.4 compatibility.</z><z id="t1540906883" t="flowthing OK, will do."><y>#</y><d>2018-10-30</d><h>13:41</h><w>flowthing</w>OK, will do.</z><z id="t1540906890" t="bozhidar Thanks!"><y>#</y><d>2018-10-30</d><h>13:41</h><w>bozhidar</w>Thanks!</z><z id="t1540906928" t="flowthing I&apos;m also a bit puzzled, because I blamed both files as far back as they go and as far as I could see, that discrepancy has always existed."><y>#</y><d>2018-10-30</d><h>13:42</h><w>flowthing</w>I&apos;m also a bit puzzled, because I blamed both files as far back as they go and as far as I could see, that discrepancy has always existed.</z><z id="t1540906959" t="flowthing Might be I just missed something, though."><y>#</y><d>2018-10-30</d><h>13:42</h><w>flowthing</w>Might be I just missed something, though.</z><z id="t1540907368" t="flowthing Filed https://github.com/nrepl/drawbridge/issues/28 ."><y>#</y><d>2018-10-30</d><h>13:49</h><w>flowthing</w>Filed <a href="https://github.com/nrepl/drawbridge/issues/28" target="_blank">https://github.com/nrepl/drawbridge/issues/28</a>.</z><z id="t1540913952" t="bozhidar :thumbsup:"><y>#</y><d>2018-10-30</d><h>15:39</h><w>bozhidar</w><b>:thumbsup:</b></z><z id="t1541015592" t="manas_marthi I tried to set up nrepl on windows 10 with both 1)java 8/clojure 1.8 , lein 2.8.1 and 2) java 11 and clojure 1.10.0-beta4, lein 2.8.1 . In both cases when I tried running lein nrepl It says repl server started but does not give me any repl"><y>#</y><d>2018-10-31</d><h>19:53</h><w>manas_marthi</w>I tried to set up nrepl on windows 10 with both 1)java 8/clojure 1.8 , lein 2.8.1 and 2) java 11 and clojure 1.10.0-beta4, lein 2.8.1 . In both cases when I tried running <pre>lein nrepl</pre> It says repl server started but does not give me any repl</z><z id="t1541015676" t="manas_marthi lein deps as shown below :dependencies [[org.clojure/clojure &quot;1.8.0&quot;] [nrepl &quot;0.4.5&quot;] [nrepl/lein-nrepl &quot;0.2.0&quot;] [cider/cider-nrepl &quot;0.18.0&quot;] [refactor-nrepl &quot;2.4.0&quot;] ] "><y>#</y><d>2018-10-31</d><h>19:54</h><w>manas_marthi</w>lein deps as shown below
<pre>:dependencies [[org.clojure/clojure &quot;1.8.0&quot;]
				 [nrepl &quot;0.4.5&quot;]
				 [nrepl/lein-nrepl &quot;0.2.0&quot;]
				 [cider/cider-nrepl &quot;0.18.0&quot;] 
				 [refactor-nrepl    &quot;2.4.0&quot;] ]
</pre></z><z id="t1541015708" t="manas_marthi do I need any plugins in project.clj and lein profiles.clj? Please advise?"><y>#</y><d>2018-10-31</d><h>19:55</h><w>manas_marthi</w>do I need any plugins in project.clj and lein profiles.clj? Please advise?</z><z id="t1541015717" t="manas_marthi I tried adding the same in plugins as well.. No luck"><y>#</y><d>2018-10-31</d><h>19:55</h><w>manas_marthi</w>I tried adding the same in plugins as well.. No luck</z><z id="t1541015786" t="manas_marthi"><y>#</y><d>2018-10-31</d><h>19:56</h><w>manas_marthi</w></z><z id="t1541019668" t="bozhidar [:attrs {:href &quot;/_/_/users/U7ANZ2MTK&quot;}] Thatâ€™s because lein nrepl current doesnâ€™t have integration with reply (thatâ€™s the actual repl)."><y>#</y><d>2018-10-31</d><h>21:01</h><w>bozhidar</w><a>@manas.marthi</a> Thatâ€™s because <code>lein nrepl</code> current doesnâ€™t have integration with <code>reply</code> (thatâ€™s the actual repl).</z><z id="t1541019708" t="bozhidar The assumption I had was that most people would use the alternative plugin just to start a server and theyâ€™d connect it manually using CIDER or something similar."><y>#</y><d>2018-10-31</d><h>21:01</h><w>bozhidar</w>The assumption I had was that most people would use the alternative plugin just to start a server and theyâ€™d connect it manually using CIDER or something similar.</z><z id="t1541019754" t="bozhidar lein repl starts a server and then connects to it with REPLy. Thatâ€™s something that can easily be added to lein nrepl . I just never needed it. ðŸ™‚"><y>#</y><d>2018-10-31</d><h>21:02</h><w>bozhidar</w><code>lein repl</code> starts a server and then connects to it with REPLy. Thatâ€™s something that can easily be added to <code>lein nrepl</code>. I just never needed it. <b>ðŸ™‚</b></z><z id="t1541047324" t="manas_marthi [:attrs {:href &quot;/_/_/users/U051BLM8F&quot;}] noted. thank you. "><y>#</y><d>2018-11-01</d><h>04:42</h><w>manas_marthi</w><a>@bozhidar</a> noted. thank you. </z><z id="t1541091654" t="bozhidar [:attrs {:href &quot;/_/_/users/U7ANZ2MTK&quot;}] Btw, I cut version 0.3 of the plugin today, which will now start a REPL just like lein repl ."><y>#</y><d>2018-11-01</d><h>17:00</h><w>bozhidar</w><a>@manas.marthi</a> Btw, I cut version 0.3 of the plugin today, which will now start a REPL just like <code>lein repl</code>.</z><z id="t1541091664" t="bozhidar Turned out this was a really trivial change."><y>#</y><d>2018-11-01</d><h>17:01</h><w>bozhidar</w>Turned out this was a really trivial change.</z><z id="t1541091849" t="manas_marthi Thank you. That would avoid new bie confusion."><y>#</y><d>2018-11-01</d><h>17:04</h><w>manas_marthi</w>Thank you. That would avoid new bie confusion.</z><z id="t1541092167" t="manas_marthi [:attrs {:href &quot;/_/_/users/U051BLM8F&quot;}] It downloaded bunch of jars . Are all these affected?"><y>#</y><d>2018-11-01</d><h>17:09</h><w>manas_marthi</w><a>@bozhidar</a> It downloaded bunch of jars . Are all these affected?</z><z id="t1541092219" t="manas_marthi Besides, should I need to worry about that warning ?"><y>#</y><d>2018-11-01</d><h>17:10</h><w>manas_marthi</w>Besides, should I need to worry about that warning ?</z><z id="t1541092344" t="bozhidar Yeah, all the jars are deps of reply ."><y>#</y><d>2018-11-01</d><h>17:12</h><w>bozhidar</w>Yeah, all the jars are deps of <code>reply</code>.</z><z id="t1541092370" t="bozhidar You wonâ€™t see them after the first use."><y>#</y><d>2018-11-01</d><h>17:12</h><w>bozhidar</w>You wonâ€™t see them after the first use.</z><z id="t1541092396" t="bozhidar The warning is something upstream - you can safely ignore it."><y>#</y><d>2018-11-01</d><h>17:13</h><w>bozhidar</w>The warning is something upstream - you can safely ignore it.</z><z id="t1541092427" t="bozhidar Seems that ns needs a core exclude, which is not a big deal."><y>#</y><d>2018-11-01</d><h>17:13</h><w>bozhidar</w>Seems that ns needs a core exclude, which is not a big deal.</z><z id="t1541092573" t="manas_marthi Noted thank you. I added the plugin version number to the documentation (installation) page and sent a pull request"><y>#</y><d>2018-11-01</d><h>17:16</h><w>manas_marthi</w>Noted thank you. I added the plugin version number to the documentation (installation) page and sent a pull request</z><z id="t1541093203" t="manas_marthi [:attrs {:href &quot;/_/_/users/U051BLM8F&quot;}] the repl is not responding user/help, quit, exit, ctrl+D"><y>#</y><d>2018-11-01</d><h>17:26</h><w>manas_marthi</w><a>@bozhidar</a> the repl is not responding user/help, quit, exit, ctrl+D</z><z id="t1541093213" t="manas_marthi had to ctrl+c"><y>#</y><d>2018-11-01</d><h>17:26</h><w>manas_marthi</w>had to ctrl+c</z><z id="t1541093294" t="bozhidar Works just fine when I test it."><y>#</y><d>2018-11-01</d><h>17:28</h><w>bozhidar</w>Works just fine when I test it.</z><z id="t1541093300" t="bozhidar Can someone else take a look as well?"><y>#</y><d>2018-11-01</d><h>17:28</h><w>bozhidar</w>Can someone else take a look as well?</z><z id="t1541093502" t="manas_marthi may be I messed up my deps"><y>#</y><d>2018-11-01</d><h>17:31</h><w>manas_marthi</w>may be I messed up my deps</z><z id="t1541093514" t="manas_marthi I was adding nrepl allover lein profiles and project deps"><y>#</y><d>2018-11-01</d><h>17:31</h><w>manas_marthi</w>I was adding nrepl allover lein profiles and project deps</z><z id="t1541093519" t="manas_marthi I will try again"><y>#</y><d>2018-11-01</d><h>17:31</h><w>manas_marthi</w>I will try again</z><z id="t1541093637" t="bozhidar You only need lein nrepl in your profiles.clj."><y>#</y><d>2018-11-01</d><h>17:33</h><w>bozhidar</w>You only need <code>lein nrepl</code> in your profiles.clj.</z><z id="t1541094677" t="manas_marthi Not sure what I did wrong. I cleared all plugins from .lein\profiles.clj and tried. still same issue. Added all jars in deps &amp; plugins in project.clj. again same problem. tested lein repl again. got a diferent problem"><y>#</y><d>2018-11-01</d><h>17:51</h><w>manas_marthi</w>Not sure what I did wrong. I cleared all plugins from .lein\profiles.clj  and tried. still same issue. Added all jars in deps &amp; plugins in project.clj. again same problem.
 tested <code>lein repl</code> again. got a diferent problem</z><z id="t1541094705" t="manas_marthi lein repl looks to have conflict"><y>#</y><d>2018-11-01</d><h>17:51</h><w>manas_marthi</w><code>lein repl</code> looks to have conflict</z><z id="t1541094711" t="manas_marthi C:\clojureprojects\201812\archboard&gt;lein repl nREPL server started on port 61798 on host 127.0.0.1 - mjava.lang.ClassNotFoundException: nrepl.core mclojure.lang.Compiler$CompilerException: java.lang.ClassNotFoundException: nrepl.core, compiling:(C:\Users\mman\AppData\Local\Temp\form-init799261887591824035.clj:1:82) mjava.lang.Exception: No namespace: reply.eval-modes.nrepl found Error loading namespace; falling back to user #namespace[user]nil user=&gt; quit Bye for now! "><y>#</y><d>2018-11-01</d><h>17:51</h><w>manas_marthi</w><pre>C:\clojureprojects\201812\archboard&gt;lein repl
nREPL server started on port 61798 on host 127.0.0.1 - 
       mjava.lang.ClassNotFoundException: nrepl.core
mclojure.lang.Compiler$CompilerException: java.lang.ClassNotFoundException: nrepl.core, compiling:(C:\Users\mman\AppData\Local\Temp\form-init799261887591824035.clj:1:82)
mjava.lang.Exception: No namespace: reply.eval-modes.nrepl found

Error loading namespace; falling back to user
#namespace[user]nil
user=&gt; quit
Bye for now!
</pre></z><z id="t1541094762" t="manas_marthi my lein is version 2.8.1 . not sure if it has anything to do that"><y>#</y><d>2018-11-01</d><h>17:52</h><w>manas_marthi</w>my lein is version 2.8.1 . not sure if it has anything to do that</z><z id="t1541095255" t="manas_marthi removed everything in project.clj except :dependencies [[org.clojure/clojure &quot;1.8.0&quot;] [nrepl &quot;0.4.5&quot;] ] :plugins [ [nrepl/lein-nrepl &quot;0.3.0&quot;] ] "><y>#</y><d>2018-11-01</d><h>18:00</h><w>manas_marthi</w>removed everything in project.clj except
<pre>:dependencies [[org.clojure/clojure &quot;1.8.0&quot;]
				 [nrepl &quot;0.4.5&quot;]
			 ]
  :plugins [
 				 [nrepl/lein-nrepl &quot;0.3.0&quot;]
]
</pre></z><z id="t1541095290" t="manas_marthi no luck. looking for the emoji to bang head against keyboard ðŸ˜‚"><y>#</y><d>2018-11-01</d><h>18:01</h><w>manas_marthi</w>no luck. looking for the emoji to bang head against keyboard <b>ðŸ˜‚</b></z><z id="t1541095508" t="manas_marthi profiles.clj contents {:user { :plugins [ [nrepl/lein-nrepl &quot;0.3.0&quot;] ] } "><y>#</y><d>2018-11-01</d><h>18:05</h><w>manas_marthi</w>profiles.clj contents
<pre>{:user
  {
   :plugins [
		[nrepl/lein-nrepl &quot;0.3.0&quot;]
	]
   }
</pre></z><z id="t1541095801" t="bozhidar Thatâ€™s all Iâ€™ve got in profiles:"><y>#</y><d>2018-11-01</d><h>18:10</h><w>bozhidar</w>Thatâ€™s all Iâ€™ve got in profiles:</z><z id="t1541095803" t="bozhidar {:user {:plugins [[lein-kibit &quot;0.0.8&quot;] [lein-ancient &quot;0.6.15&quot;] [lein-annotations &quot;0.1.0&quot;] [nrepl/lein-nrepl &quot;0.3.0&quot;]]}}"><y>#</y><d>2018-11-01</d><h>18:10</h><w>bozhidar</w><pre>{:user
 {:plugins [[lein-kibit &quot;0.0.8&quot;]
            [lein-ancient &quot;0.6.15&quot;]
            [lein-annotations &quot;0.1.0&quot;]
            [nrepl/lein-nrepl &quot;0.3.0&quot;]]}}</pre></z><z id="t1541095875" t="bozhidar"><y>#</y><d>2018-11-01</d><h>18:11</h><w>bozhidar</w></z><z id="t1541096042" t="bozhidar Not sure why the lein-nrepl plugin managed to override the version of reply bundled with lein , though."><y>#</y><d>2018-11-01</d><h>18:14</h><w>bozhidar</w>Not sure why the <code>lein-nrepl</code> plugin managed to override the version of <code>reply</code> bundled with <code>lein</code>, though.</z><z id="t1541097376" t="manas_marthi I added these plugins to my profiles. Still no change. lein repl produced this message nREPL server started on port 49822 on host 127.0.0.1 - Exception No namespace: reply.eval-modes.nrepl found clojure.core/the-ns (core.clj:4032) CompilerException java.lang.ClassNotFoundException: nrepl.core, compiling:(C:\Users\mmaun\AppData\Local\Temp\form-init3914890660694616311.clj:1:82) Error loading namespace; falling back to user #object[clojure.lang.Namespace 0x72649392 &quot;user&quot;]nil user=&gt; lein nrepl still does not read my key strokes"><y>#</y><d>2018-11-01</d><h>18:36</h><w>manas_marthi</w>I added these plugins to my profiles. Still no change.
<code>lein repl</code> produced this message
<pre>nREPL server started on port 49822 on host 127.0.0.1 - 
Exception No namespace: reply.eval-modes.nrepl found  clojure.core/the-ns (core.clj:4032)
CompilerException java.lang.ClassNotFoundException: nrepl.core, compiling:(C:\Users\mmaun\AppData\Local\Temp\form-init3914890660694616311.clj:1:82)

Error loading namespace; falling back to user
#object[clojure.lang.Namespace 0x72649392 &quot;user&quot;]nil
user=&gt;
</pre>
<code>lein nrepl</code> still does not read my key strokes</z><z id="t1541097396" t="manas_marthi I will try on a vm with fresh installation"><y>#</y><d>2018-11-01</d><h>18:36</h><w>manas_marthi</w>I will try on a vm with fresh installation</z><z id="t1541097408" t="manas_marthi and on home laptop so there is no proxy"><y>#</y><d>2018-11-01</d><h>18:36</h><w>manas_marthi</w>and on home laptop so there is no proxy</z><z id="t1541097417" t="manas_marthi and I will try on ubuntu vm"><y>#</y><d>2018-11-01</d><h>18:36</h><w>manas_marthi</w>and I will try on ubuntu vm</z><z id="t1541132623" t="manas_marthi Tried with a clean .m2 folder and profiles clj matching yours on a Ubuntu vm.."><y>#</y><d>2018-11-02</d><h>04:23</h><w>manas_marthi</w>Tried with a clean .m2 folder and profiles clj matching yours on a Ubuntu vm..</z><z id="t1541132739" t="manas_marthi lein nrepl was responding to things like &apos;a4 or (println 45) but quit or ctrl D did not work"><y>#</y><d>2018-11-02</d><h>04:25</h><w>manas_marthi</w><code>lein nrepl</code> was responding to things like <code>&apos;a4</code> or <code>(println 45)</code> but <code>quit</code> or <code>ctrl D</code> did not work</z><z id="t1541132784" t="manas_marthi lein repl worked, but it was giving the same namespace error"><y>#</y><d>2018-11-02</d><h>04:26</h><w>manas_marthi</w><code>lein repl</code> worked, but it was giving the same namespace error</z><z id="t1541133075" t="manas_marthi I have not tried using nrepl as server and connect to it from cider in my spacemacs. I will try that as well.."><y>#</y><d>2018-11-02</d><h>04:31</h><w>manas_marthi</w>I have not tried using nrepl as server and connect to it from cider in my spacemacs. I will try that as well..</z><z id="t1541133713" t="manas_marthi On an older project lein repl produced same namespace error. I commented lein-nrepl 0.3.0 in profiles.clj . It started working fine. It was showing what version of nrepl and reply it was using. Looks like lein-nrepl 0.3.0 is unable to play nicely with lein or reply"><y>#</y><d>2018-11-02</d><h>04:41</h><w>manas_marthi</w>On an older project <code>lein repl</code> produced same namespace error. I commented <code>lein-nrepl 0.3.0</code> in <code>profiles.clj</code>. It started working fine. It was showing what version of <code>nrepl</code> and <code>reply</code> it was using. Looks like <code>lein-nrepl</code> 0.3.0 is unable to play nicely with <code> lein </code> or <code>reply</code></z><z id="t1541134266" t="manas_marthi Besides, I switched back to lein-nrepl 0.2.0. and tried lein repl . The server page in http://nrepl.xyz says lein repl will start nrepl if the new nrepl 0.4.5 is on the dependencies list. But the reply prompt is still showing nrepl 0.2.12. Should the doc be changed to lein nrepl ?"><y>#</y><d>2018-11-02</d><h>04:51</h><w>manas_marthi</w>Besides, I switched back to lein-nrepl 0.2.0. and tried <code>lein repl</code>. The server page in <a href="http://nrepl.xyz" target="_blank">http://nrepl.xyz</a> says <code>lein repl</code> will start <code>nrepl</code> if the new nrepl 0.4.5 is on the dependencies list. But the reply prompt is still showing nrepl 0.2.12. Should the doc be changed to <code>lein nrepl</code>?</z><z id="t1541134657" t="manas_marthi Can&apos;t recall where did I see the steps to connect to nrepl server from cider in emacs ðŸ™‚ "><y>#</y><d>2018-11-02</d><h>04:57</h><w>manas_marthi</w>Can&apos;t recall where did I see the steps to connect to nrepl server from cider in emacs <b>ðŸ™‚</b> </z><z id="t1541138681" t="bozhidar Well, lein repl will work, but it will obviously start a legacy server unless youâ€™ve built lein from source."><y>#</y><d>2018-11-02</d><h>06:04</h><w>bozhidar</w>Well, <code>lein repl</code> will work, but it will obviously start a legacy server unless youâ€™ve built <code>lein</code> from source.</z><z id="t1541138740" t="bozhidar I have a feeling that the problem is that adding a dep to the newer reply simply messes up the reply dep that comes with lein, but Iâ€™m completely puzzled why this works for me and not for you."><y>#</y><d>2018-11-02</d><h>06:05</h><w>bozhidar</w>I have a feeling that the problem is that adding a dep to the newer reply simply messes up the reply dep that comes with lein, but Iâ€™m completely puzzled why this works for me and not for you.</z><z id="t1541140195" t="bozhidar [:attrs {:href &quot;/_/_/users/U09LZR36F&quot;}] can you test lein nrepl when youâ€™ve got the chance? Iâ€™m curious if it will work for you."><y>#</y><d>2018-11-02</d><h>06:29</h><w>bozhidar</w><a>@dominicm</a> can you test <code>lein nrepl</code> when youâ€™ve got the chance? Iâ€™m curious if it will work for you.</z><z id="t1541140419" t="dominicm I&apos;ll do it when I&apos;m at a keyboard, about 2 hours? "><y>#</y><d>2018-11-02</d><h>06:33</h><w>dominicm</w>I&apos;ll do it when I&apos;m at a keyboard, about 2 hours? </z><z id="t1541140464" t="bozhidar Whenever you can. Itâ€™s not urgent. I just donâ€™t like unsolved mysteries. ðŸ™‚"><y>#</y><d>2018-11-02</d><h>06:34</h><w>bozhidar</w>Whenever you can. Itâ€™s not urgent. I just donâ€™t like unsolved mysteries. <b>ðŸ™‚</b></z><z id="t1541145702" t="dominicm Me neither"><y>#</y><d>2018-11-02</d><h>08:01</h><w>dominicm</w>Me neither</z><z id="t1541145795" t="dominicm hmph. Exception in thread &quot;main&quot; java.lang.ClassNotFoundException: leiningen.nrepl, compiling:(/tmp/form-init391929446154209103.clj:1:72) "><y>#</y><d>2018-11-02</d><h>08:03</h><w>dominicm</w>hmph.

<pre>Exception in thread &quot;main&quot; java.lang.ClassNotFoundException: leiningen.nrepl, compiling:(/tmp/form-init391929446154209103.clj:1:72)
</pre></z><z id="t1541145853" t="dominicm I think the sample profiles.clj is invalid, also: {:user {:dependencies [[cider/cider-nrepl &quot;0.18.0&quot;]]} {:plugins [[nrepl/lein-nrepl &quot;0.2.0&quot;]]}} "><y>#</y><d>2018-11-02</d><h>08:04</h><w>dominicm</w>I think the sample profiles.clj is invalid, also:

<pre>{:user
 {:dependencies [[cider/cider-nrepl &quot;0.18.0&quot;]]}
 {:plugins [[nrepl/lein-nrepl &quot;0.2.0&quot;]]}}
</pre></z><z id="t1541145872" t="dominicm That&apos;s &quot;things&quot; keys in the top-level map."><y>#</y><d>2018-11-02</d><h>08:04</h><w>dominicm</w>That&apos;s &quot;things&quot; keys in the top-level map.</z><z id="t1541145915" t="dominicm Oh, ignore my exception, it&apos;s because i had an old version in the project."><y>#</y><d>2018-11-02</d><h>08:05</h><w>dominicm</w>Oh, ignore my exception, it&apos;s because i had an old version in the project.</z><z id="t1541145970" t="dominicm Okay. Works. REPL-y loads up for me. ðŸ™‚"><y>#</y><d>2018-11-02</d><h>08:06</h><w>dominicm</w>Okay. Works. REPL-y loads up for me. <b>ðŸ™‚</b></z><z id="t1541145983" t="dominicm Unless there&apos;s a specific invocation I need to test."><y>#</y><d>2018-11-02</d><h>08:06</h><w>dominicm</w>Unless there&apos;s a specific invocation I need to test.</z><z id="t1541145998" t="dominicm Oh, I need to test Ctrl-D, I remember ðŸ™‚"><y>#</y><d>2018-11-02</d><h>08:06</h><w>dominicm</w>Oh, I need to test Ctrl-D, I remember <b>ðŸ™‚</b></z><z id="t1541145999" t="bozhidar Nope, nothing special."><y>#</y><d>2018-11-02</d><h>08:06</h><w>bozhidar</w>Nope, nothing special.</z><z id="t1541146013" t="dominicm Ctrl-D gives me &quot;Bye for now!&quot; then hangs."><y>#</y><d>2018-11-02</d><h>08:06</h><w>dominicm</w>Ctrl-D gives me &quot;Bye for now!&quot; then hangs.</z><z id="t1541146019" t="dominicm Ctrl-C finishes it off."><y>#</y><d>2018-11-02</d><h>08:06</h><w>dominicm</w>Ctrl-C finishes it off.</z><z id="t1541146051" t="bozhidar Thatâ€™s weird. It should hang only with :headless option."><y>#</y><d>2018-11-02</d><h>08:07</h><w>bozhidar</w>Thatâ€™s weird. It should hang only with <code>:headless</code> option.</z><z id="t1541146070" t="bozhidar For it me it works just fine. Itâ€™s so frustrating when something is 5 lines of code and there are still issues with it. ðŸ˜„"><y>#</y><d>2018-11-02</d><h>08:07</h><w>bozhidar</w>For it me it works just fine. Itâ€™s so frustrating when something is 5 lines of code and there are still issues with it. <b>ðŸ˜„</b></z><z id="t1541146149" t="bozhidar https://github.com/nrepl/lein-nrepl/blob/master/src/leiningen/nrepl.clj#L53"><y>#</y><d>2018-11-02</d><h>08:09</h><w>bozhidar</w><a href="https://github.com/nrepl/lein-nrepl/blob/master/src/leiningen/nrepl.clj#L53" target="_blank">https://github.com/nrepl/lein-nrepl/blob/master/src/leiningen/nrepl.clj#L53</a></z><z id="t1541146158" t="bozhidar I stand corrected - 6 lines."><y>#</y><d>2018-11-02</d><h>08:09</h><w>bozhidar</w>I stand corrected - 6 lines.</z><z id="t1541146172" t="dominicm Should be easy to figure out what&apos;s keeping it up, one sec"><y>#</y><d>2018-11-02</d><h>08:09</h><w>dominicm</w>Should be easy to figure out what&apos;s keeping it up, one sec</z><z id="t1541146189" t="bozhidar So, it should not hang unless :block and :headless are both true."><y>#</y><d>2018-11-02</d><h>08:09</h><w>bozhidar</w>So, it should not hang unless :block and :headless are both true.</z><z id="t1541146213" t="dominicm or a thread is keeping the jvm up ðŸ™‚"><y>#</y><d>2018-11-02</d><h>08:10</h><w>dominicm</w>or a thread is keeping the jvm up <b>ðŸ™‚</b></z><z id="t1541146335" t="dominicm &quot;clojure-agent-send-off-pool-1&quot; #10 prio=5 os_prio=0 tid=0x00007f3f00a03000 nid=0x2112 waiting on condition [0x00007f3ee9e16000] there&apos;s a few of these kicking about"><y>#</y><d>2018-11-02</d><h>08:12</h><w>dominicm</w><code>&quot;clojure-agent-send-off-pool-1&quot; #10 prio=5 os_prio=0 tid=0x00007f3f00a03000 nid=0x2112 waiting on condition [0x00007f3ee9e16000]</code> there&apos;s a few of these kicking about</z><z id="t1541146470" t="dominicm main is waiting on something :thinking_face:"><y>#</y><d>2018-11-02</d><h>08:14</h><w>dominicm</w>main is waiting on something <b>:thinking_face:</b></z><z id="t1541146486" t="dominicm &quot;main&quot; #1 prio=5 os_prio=0 tid=0x00007f3f0000a800 nid=0x20fd in Object.wait() [0x00007f3f09449000] java.lang.Thread.State: WAITING (on object monitor) at java.lang.Object.wait(Native Method) - waiting on &lt;0x000000076cf15e80&gt; (a java.lang.Thread) at java.lang.Thread.join(Thread.java:1252) - locked &lt;0x000000076cf15e80&gt; (a java.lang.Thread) at java.lang.Thread.join(Thread.java:1326) at com.hypirion.io.Pipe.join(Pipe.java:120) at leiningen.core.eval$sh.invokeStatic(eval.clj:191) at leiningen.core.eval$sh.doInvoke(eval.clj:173) "><y>#</y><d>2018-11-02</d><h>08:14</h><w>dominicm</w><pre>&quot;main&quot; #1 prio=5 os_prio=0 tid=0x00007f3f0000a800 nid=0x20fd in Object.wait() [0x00007f3f09449000]
   java.lang.Thread.State: WAITING (on object monitor)
        at java.lang.Object.wait(Native Method)
        - waiting on &lt;0x000000076cf15e80&gt; (a java.lang.Thread)
        at java.lang.Thread.join(Thread.java:1252)
        - locked &lt;0x000000076cf15e80&gt; (a java.lang.Thread)
        at java.lang.Thread.join(Thread.java:1326)
        at com.hypirion.io.Pipe.join(Pipe.java:120)
        at leiningen.core.eval$sh.invokeStatic(eval.clj:191)
        at leiningen.core.eval$sh.doInvoke(eval.clj:173)
</pre></z><z id="t1541146506" t="dominicm Maybe I&apos;ve dumped the threads for the outer JVM?"><y>#</y><d>2018-11-02</d><h>08:15</h><w>dominicm</w>Maybe I&apos;ve dumped the threads for the outer JVM?</z><z id="t1541146529" t="bozhidar No idea. Reply and nREPL doesnâ€™t use agents at all."><y>#</y><d>2018-11-02</d><h>08:15</h><w>bozhidar</w>No idea. Reply and nREPL doesnâ€™t use agents at all.</z><z id="t1541146542" t="bozhidar Thatâ€™s why Iâ€™m really puzzled how this happens."><y>#</y><d>2018-11-02</d><h>08:15</h><w>bozhidar</w>Thatâ€™s why Iâ€™m really puzzled how this happens.</z><z id="t1541147062" t="bozhidar Btw, after a few days of experimentation Iâ€™m finally happy with the state of https://github.com/nrepl/nrepl/pull/66 and I just merged it."><y>#</y><d>2018-11-02</d><h>08:24</h><w>bozhidar</w>Btw, after a few days of experimentation Iâ€™m finally happy with the state of <a href="https://github.com/nrepl/nrepl/pull/66" target="_blank">https://github.com/nrepl/nrepl/pull/66</a> and I just merged it.</z><z id="t1541147621" t="dominicm Neat, I can do that in fireplace/replant too ðŸ™‚"><y>#</y><d>2018-11-02</d><h>08:33</h><w>dominicm</w>Neat, I can do that in fireplace/replant too <b>ðŸ™‚</b></z><z id="t1541147763" t="bozhidar Originally I had added some nREPL env variables as well, but I opted to remove them as they made more complex the elegant map merging code (now you just have a global, local and command-line maps that are simply merged together in this order) and opened the question what exactly should be the precedence of the env vars."><y>#</y><d>2018-11-02</d><h>08:36</h><w>bozhidar</w>Originally I had added some nREPL env variables as well, but I opted to remove them as they made more complex the elegant map merging code (now you just have a global, local and command-line maps that are simply merged together in this order) and opened the question what exactly should be the precedence of the env vars.</z><z id="t1541147783" t="bozhidar (higher or lower than global config &amp; local config)"><y>#</y><d>2018-11-02</d><h>08:36</h><w>bozhidar</w>(higher or lower than global config &amp; local config)</z><z id="t1541147791" t="bozhidar In the end I decided that less is more. ðŸ™‚"><y>#</y><d>2018-11-02</d><h>08:36</h><w>bozhidar</w>In the end I decided that less is more. <b>ðŸ™‚</b></z><z id="t1541147814" t="dominicm Fun fact, if I add a println after (client) , it isn&apos;t called when I hit &quot;Ctrl-D&quot;"><y>#</y><d>2018-11-02</d><h>08:36</h><w>dominicm</w>Fun fact, if I add a <code>println</code> after <code>(client)</code>, it isn&apos;t called when I hit &quot;Ctrl-D&quot;</z><z id="t1541147853" t="bozhidar Now Iâ€™m completely puzzled."><y>#</y><d>2018-11-02</d><h>08:37</h><w>bozhidar</w>Now Iâ€™m completely puzzled.</z><z id="t1541147996" t="dominicm (quit) has the same behaviour."><y>#</y><d>2018-11-02</d><h>08:39</h><w>dominicm</w><code>(quit)</code> has the same behaviour.</z><z id="t1541148103" t="dominicm https://github.com/trptcolin/reply/blob/3fb81561c077e40e33b8caaa1432e0daca1ad521/src/clj/reply/main.clj#L106 ðŸ˜„"><y>#</y><d>2018-11-02</d><h>08:41</h><w>dominicm</w><a href="https://github.com/trptcolin/reply/blob/3fb81561c077e40e33b8caaa1432e0daca1ad521/src/clj/reply/main.clj#L106" target="_blank">https://github.com/trptcolin/reply/blob/3fb81561c077e40e33b8caaa1432e0daca1ad521/src/clj/reply/main.clj#L106</a> <b>ðŸ˜„</b></z><z id="t1541148555" t="dominicm Actually, I don&apos;t see any println from code around (client) , so *out* must have an override."><y>#</y><d>2018-11-02</d><h>08:49</h><w>dominicm</w>Actually, I don&apos;t see any println from code around <code>(client)</code>, so <code>*out*</code> must have an override.</z><z id="t1541148681" t="dominicm oh, I fixed it. Somehow."><y>#</y><d>2018-11-02</d><h>08:51</h><w>dominicm</w>oh, I fixed it. Somehow.</z><z id="t1541148760" t="dominicm Okay. It&apos;s not happening anymore. I can&apos;t explain why."><y>#</y><d>2018-11-02</d><h>08:52</h><w>dominicm</w>Okay. It&apos;s not happening anymore. I can&apos;t explain why.</z><z id="t1541148808" t="dominicm Yes I can. When I run it in aero it hangs, when I run it in lein-nrepl , it doesn&apos;t."><y>#</y><d>2018-11-02</d><h>08:53</h><w>dominicm</w>Yes I can. When I run it in aero it hangs, when I run it in <code>lein-nrepl</code>, it doesn&apos;t.</z><z id="t1541149004" t="dominicm I can also reproduce in bidi."><y>#</y><d>2018-11-02</d><h>08:56</h><w>dominicm</w>I can also reproduce in bidi.</z><z id="t1541149013" t="dominicm [:attrs {:href &quot;/_/_/users/U051BLM8F&quot;}] what project(s) did you test on?"><y>#</y><d>2018-11-02</d><h>08:56</h><w>dominicm</w><a>@bozhidar</a> what project(s) did you test on?</z><z id="t1541149682" t="bozhidar In lein-nrepl and without a project."><y>#</y><d>2018-11-02</d><h>09:08</h><w>bozhidar</w>In <code>lein-nrepl</code> and without a project.</z><z id="t1541149705" t="dominicm I can&apos;t run it without a project, I get: â¯ lein nrepl Couldn&apos;t find project.clj, which is needed for nrepl "><y>#</y><d>2018-11-02</d><h>09:08</h><w>dominicm</w>I can&apos;t run it without a project, I get:

<pre>â¯ lein nrepl
Couldn&apos;t find project.clj, which is needed for nrepl
</pre></z><z id="t1541149742" t="bozhidar OK, just tested it another project. It hangs for me as well. Damn, I hate lein at this pointâ€¦"><y>#</y><d>2018-11-02</d><h>09:09</h><w>bozhidar</w>OK, just tested it another project. It hangs for me as well. Damn, I hate lein at this pointâ€¦</z><z id="t1541149763" t="dominicm ðŸ˜„ so much machinery. I get what Cognitect say about it."><y>#</y><d>2018-11-02</d><h>09:09</h><w>dominicm</w><b>ðŸ˜„</b> so much machinery. I get what Cognitect say about it.</z><z id="t1541149776" t="bozhidar Well. lein really overdid it."><y>#</y><d>2018-11-02</d><h>09:09</h><w>bozhidar</w>Well. lein really overdid it.</z><z id="t1541149794" t="bozhidar When I was looking at the code for lein repl I was shocked how much was going on there."><y>#</y><d>2018-11-02</d><h>09:09</h><w>bozhidar</w>When I was looking at the code for <code>lein repl</code> I was shocked how much was going on there.</z><z id="t1541149807" t="dominicm I just loaded it up ðŸ˜„"><y>#</y><d>2018-11-02</d><h>09:10</h><w>dominicm</w>I just loaded it up <b>ðŸ˜„</b></z><z id="t1541149808" t="bozhidar boot repl , on the other hand, is 20 lines."><y>#</y><d>2018-11-02</d><h>09:10</h><w>bozhidar</w><code>boot repl</code>, on the other hand, is 20 lines.</z><z id="t1541149835" t="bozhidar I just borrowed some code from boot repl for lein-nrepl but I guess thatâ€™s not enough."><y>#</y><d>2018-11-02</d><h>09:10</h><w>bozhidar</w>I just borrowed some code from <code>boot repl</code> for <code>lein-nrepl</code> but I guess thatâ€™s not enough.</z><z id="t1541149854" t="bozhidar Anyways, the repl works fine you just have kill it brute-force at the end which is not that bad IMO."><y>#</y><d>2018-11-02</d><h>09:10</h><w>bozhidar</w>Anyways, the repl works fine you just have kill it brute-force at the end which is not that bad IMO.</z><z id="t1541149900" t="dominicm https://github.com/technomancy/leiningen/blob/454c3dc640f4b3507b13154bad2ee8ff91d702c9/src/leiningen/repl.clj#L168 I can&apos;t see where handle is coming from."><y>#</y><d>2018-11-02</d><h>09:11</h><w>dominicm</w><a href="https://github.com/technomancy/leiningen/blob/454c3dc640f4b3507b13154bad2ee8ff91d702c9/src/leiningen/repl.clj#L168" target="_blank">https://github.com/technomancy/leiningen/blob/454c3dc640f4b3507b13154bad2ee8ff91d702c9/src/leiningen/repl.clj#L168</a> I can&apos;t see where <code>handle</code> is coming from.</z><z id="t1541149907" t="dominicm I wonder if this is relevant though"><y>#</y><d>2018-11-02</d><h>09:11</h><w>dominicm</w>I wonder if this is relevant though</z><z id="t1541149928" t="dominicm https://github.com/technomancy/leiningen/blob/454c3dc640f4b3507b13154bad2ee8ff91d702c9/src/leiningen/repl.clj#L217 ah, they force System/exit afterwards. Ouch."><y>#</y><d>2018-11-02</d><h>09:12</h><w>dominicm</w><a href="https://github.com/technomancy/leiningen/blob/454c3dc640f4b3507b13154bad2ee8ff91d702c9/src/leiningen/repl.clj#L217" target="_blank">https://github.com/technomancy/leiningen/blob/454c3dc640f4b3507b13154bad2ee8ff91d702c9/src/leiningen/repl.clj#L217</a>

ah, they force System/exit afterwards. Ouch.</z><z id="t1541150011" t="bozhidar Yeah, I think you found what we were looking for."><y>#</y><d>2018-11-02</d><h>09:13</h><w>bozhidar</w>Yeah, I think you found what we were looking for.</z><z id="t1541150023" t="bozhidar Looks ugly as hell, but probably itâ€™s needed."><y>#</y><d>2018-11-02</d><h>09:13</h><w>bozhidar</w>Looks ugly as hell, but probably itâ€™s needed.</z><z id="t1541150040" t="dominicm Apparently not. I just tested, with no luck."><y>#</y><d>2018-11-02</d><h>09:14</h><w>dominicm</w>Apparently not. I just tested, with no luck.</z><z id="t1541150118" t="bozhidar I never used trampoline, but it seems the regular client code is here https://github.com/technomancy/leiningen/blob/454c3dc640f4b3507b13154bad2ee8ff91d702c9/src/leiningen/repl.clj#L258"><y>#</y><d>2018-11-02</d><h>09:15</h><w>bozhidar</w>I never used trampoline, but it seems the regular client code is here <a href="https://github.com/technomancy/leiningen/blob/454c3dc640f4b3507b13154bad2ee8ff91d702c9/src/leiningen/repl.clj#L258" target="_blank">https://github.com/technomancy/leiningen/blob/454c3dc640f4b3507b13154bad2ee8ff91d702c9/src/leiningen/repl.clj#L258</a></z><z id="t1541150125" t="bozhidar I donâ€™t see anything magical though."><y>#</y><d>2018-11-02</d><h>09:15</h><w>bozhidar</w>I donâ€™t see anything magical though.</z><z id="t1541150179" t="bozhidar Ah, no. Thatâ€™s whatâ€™s invoked in lein repl :connect . My bad."><y>#</y><d>2018-11-02</d><h>09:16</h><w>bozhidar</w>Ah, no. Thatâ€™s whatâ€™s invoked in <code>lein repl :connect</code>. My bad.</z><z id="t1541150186" t="bozhidar Seems you had found the right code."><y>#</y><d>2018-11-02</d><h>09:16</h><w>bozhidar</w>Seems you had found the right code.</z><z id="t1541150252" t="dominicm Doesn&apos;t look like lein install is doing the right thing for me ðŸ˜ž"><y>#</y><d>2018-11-02</d><h>09:17</h><w>dominicm</w>Doesn&apos;t look like <code>lein install</code> is doing the right thing for me <b>ðŸ˜ž</b></z><z id="t1541150268" t="bozhidar It does it for me."><y>#</y><d>2018-11-02</d><h>09:17</h><w>bozhidar</w>It does it for me.</z><z id="t1541150279" t="bozhidar Just make sure you adjust your profile accordingly."><y>#</y><d>2018-11-02</d><h>09:17</h><w>bozhidar</w>Just make sure you adjust your profile accordingly.</z><z id="t1541150290" t="bozhidar And the inner dep of the project."><y>#</y><d>2018-11-02</d><h>09:18</h><w>bozhidar</w>And the inner dep of the project.</z><z id="t1541150319" t="bozhidar https://github.com/nrepl/lein-nrepl/blob/master/src/leiningen/nrepl.clj#L18"><y>#</y><d>2018-11-02</d><h>09:18</h><w>bozhidar</w><a href="https://github.com/nrepl/lein-nrepl/blob/master/src/leiningen/nrepl.clj#L18" target="_blank">https://github.com/nrepl/lein-nrepl/blob/master/src/leiningen/nrepl.clj#L18</a></z><z id="t1541150326" t="dominicm OH"><y>#</y><d>2018-11-02</d><h>09:18</h><w>dominicm</w>OH</z><z id="t1541150328" t="dominicm That would do it"><y>#</y><d>2018-11-02</d><h>09:18</h><w>dominicm</w>That would do it</z><z id="t1541150351" t="dominicm Weird how it worked some of the time"><y>#</y><d>2018-11-02</d><h>09:19</h><w>dominicm</w>Weird how it worked some of the time</z><z id="t1541150713" t="dominicm Okay, you&apos;re right, System/exit worked"><y>#</y><d>2018-11-02</d><h>09:25</h><w>dominicm</w>Okay, you&apos;re right, <code>System/exit</code> worked</z><z id="t1541150734" t="bozhidar It always works. ðŸ˜‰"><y>#</y><d>2018-11-02</d><h>09:25</h><w>bozhidar</w>It always works. <b>ðŸ˜‰</b></z><z id="t1541150772" t="bozhidar Well, I guess you deserve the credit for this, so you can commit the fix directly."><y>#</y><d>2018-11-02</d><h>09:26</h><w>bozhidar</w>Well, I guess you deserve the credit for this, so you can commit the fix directly.</z><z id="t1541150874" t="dominicm Done ðŸ™‚"><y>#</y><d>2018-11-02</d><h>09:27</h><w>dominicm</w>Done <b>ðŸ™‚</b></z><z id="t1541167926" t="bozhidar Thanks!"><y>#</y><d>2018-11-02</d><h>14:12</h><w>bozhidar</w>Thanks!</z><z id="t1541167958" t="bozhidar Iâ€™ve cut 0.3.1, so I guess [:attrs {:href &quot;/_/_/users/U7ANZ2MTK&quot;}] can check it out."><y>#</y><d>2018-11-02</d><h>14:12</h><w>bozhidar</w>Iâ€™ve cut 0.3.1, so I guess <a>@manas.marthi</a> can check it out.</z><z id="t1541171232" t="manas_marthi hi [:attrs {:href &quot;/_/_/users/U051BLM8F&quot;}] , jar downloaded. no luck yet. I will try on my home laptop later this evening. The only difference is I am using office laptop on windows 10 behind proxy &amp; artifactory."><y>#</y><d>2018-11-02</d><h>15:07</h><w>manas_marthi</w>hi <a>@bozhidar</a> , jar downloaded. no luck yet. I will try on my home laptop later this evening. The only difference is I am using office laptop on windows 10 behind proxy &amp; artifactory.</z><z id="t1541171237" t="manas_marthi REPL server started on port 59724 on host localhost - REPL-y 0.4.2, nREPL 0.4.5 Clojure 1.8.0 Java HotSpot(TM) 64-Bit Server VM 1.8.0_181-b13 Exit: Control+D or (exit) or (quit) Commands: (user/help) Docs: (doc function-name-here) (find-doc &quot;part-of-name-here&quot;) Find by Name: (find-name &quot;part-of-name-here&quot;) Source: (source function-name-here) Javadoc: (javadoc java-object-or-class-here) Examples from : [clojuredocs or cdoc] (user/clojuredocs name-here) (user/clojuredocs &quot;ns-here&quot; &quot;name-here&quot;) WARNING: cat already refers to: #&apos;clojure.core/cat in namespace: net.cgrand.parsley.fold, being replaced by: #&apos;net.cgrand.parsley.fold/cat user=&gt; (def x 10) ^D quit Terminate batch job (Y/N)? y "><y>#</y><d>2018-11-02</d><h>15:07</h><w>manas_marthi</w><pre>REPL server started on port 59724 on host localhost - 
REPL-y 0.4.2, nREPL 0.4.5
Clojure 1.8.0
Java HotSpot(TM) 64-Bit Server VM 1.8.0_181-b13
        Exit: Control+D or (exit) or (quit)
    Commands: (user/help)
        Docs: (doc function-name-here)
              (find-doc &quot;part-of-name-here&quot;)
Find by Name: (find-name &quot;part-of-name-here&quot;)
      Source: (source function-name-here)
     Javadoc: (javadoc java-object-or-class-here)
    Examples from : [clojuredocs or cdoc]
              (user/clojuredocs name-here)
              (user/clojuredocs &quot;ns-here&quot; &quot;name-here&quot;)
WARNING: cat already refers to: #&apos;clojure.core/cat in namespace: net.cgrand.parsley.fold, being replaced by: #&apos;net.cgrand.parsley.fold/cat
user=&gt; (def x 10)
^D
quit

Terminate batch job (Y/N)? y
</pre></z><z id="t1541171280" t="manas_marthi C:\clojureprojects\201812\archboard&gt;lein repl nREPL server started on port 59754 on host 127.0.0.1 - Exception No namespace: reply.eval-modes.nrepl found clojure.core/the-ns (core.clj:4032) CompilerException java.lang.ClassNotFoundException: nrepl.core, compiling:(C:\Users\mman\AppData\Local\Temp\form-init8829266633462961081.clj:1:82) #object[clojure.lang.Namespace 0x4a439316 &quot;user&quot;] Error loading namespace; falling back to user nil user=&gt; "><y>#</y><d>2018-11-02</d><h>15:08</h><w>manas_marthi</w><pre>C:\clojureprojects\201812\archboard&gt;lein repl
nREPL server started on port 59754 on host 127.0.0.1 - 
Exception No namespace: reply.eval-modes.nrepl found  clojure.core/the-ns (core.clj:4032)
CompilerException java.lang.ClassNotFoundException: nrepl.core, compiling:(C:\Users\mman\AppData\Local\Temp\form-init8829266633462961081.clj:1:82)
#object[clojure.lang.Namespace 0x4a439316 &quot;user&quot;]
Error loading namespace; falling back to user
nil
user=&gt;
</pre></z><z id="t1541171397" t="manas_marthi I will try headless repl and connect from spacemacs"><y>#</y><d>2018-11-02</d><h>15:09</h><w>manas_marthi</w>I will try headless repl and connect from spacemacs</z><z id="t1541171407" t="manas_marthi I did not try that option yet"><y>#</y><d>2018-11-02</d><h>15:10</h><w>manas_marthi</w>I did not try that option yet</z><z id="t1541171460" t="manas_marthi looks like lein nrepl :headless is not the right command"><y>#</y><d>2018-11-02</d><h>15:11</h><w>manas_marthi</w>looks like <code>lein nrepl :headless</code> is not the right command</z><z id="t1541171944" t="manas_marthi besides lein nrepl made my cpu fan run loudly."><y>#</y><d>2018-11-02</d><h>15:19</h><w>manas_marthi</w>besides <code>lein nrepl</code> made my cpu fan run loudly.</z><z id="t1541171954" t="manas_marthi this is a blank project. I have just opened a repl"><y>#</y><d>2018-11-02</d><h>15:19</h><w>manas_marthi</w>this is a blank project. I have just opened a repl</z><z id="t1541171984" t="manas_marthi I am not liking being the messenger with bad news ðŸ˜ž"><y>#</y><d>2018-11-02</d><h>15:19</h><w>manas_marthi</w>I am not liking being the messenger with bad news <b>ðŸ˜ž</b></z><z id="t1541172646" t="manas_marthi Qualys cloud agent could be messing with the jvm. It keeps pumping pings to open ports"><y>#</y><d>2018-11-02</d><h>15:30</h><w>manas_marthi</w>Qualys cloud agent could be messing with the jvm. It keeps pumping pings to open ports</z><z id="t1541178440" t="bozhidar Itâ€™s lein nrepl :headless true"><y>#</y><d>2018-11-02</d><h>17:07</h><w>bozhidar</w>Itâ€™s <code>lein nrepl :headless true</code></z><z id="t1541178463" t="bozhidar It was easier for me to have all the args be key/value pairs. ðŸ™‚"><y>#</y><d>2018-11-02</d><h>17:07</h><w>bozhidar</w>It was easier for me to have all the args be key/value pairs. <b>ðŸ™‚</b></z><z id="t1541178507" t="bozhidar I really wonder if those problems arenâ€™t somewhat related to Windows, but you said you had them on Linux as well."><y>#</y><d>2018-11-02</d><h>17:08</h><w>bozhidar</w>I really wonder if those problems arenâ€™t somewhat related to Windows, but you said you had them on Linux as well.</z><z id="t1541178534" t="bozhidar For me after we fixed the hang lein nrepl works perfectly and it seems thatâ€™s the case for [:attrs {:href &quot;/_/_/users/U09LZR36F&quot;}] as well."><y>#</y><d>2018-11-02</d><h>17:08</h><w>bozhidar</w>For me after we fixed the hang <code>lein nrepl</code> works perfectly and it seems thatâ€™s the case for <a>@dominicm</a> as well.</z><z id="t1541178566" t="bozhidar Alternatively you can build lein 2.8.2 from source and use it instead."><y>#</y><d>2018-11-02</d><h>17:09</h><w>bozhidar</w>Alternatively you can build lein 2.8.2 from source and use it instead.</z><z id="t1541178598" t="bozhidar Itâ€™s really a pity they havenâ€™t cut a release so far."><y>#</y><d>2018-11-02</d><h>17:09</h><w>bozhidar</w>Itâ€™s really a pity they havenâ€™t cut a release so far.</z><z id="t1541191558" t="manas_marthi I tried lein nrepl :headless true :middleware &quot;[&apos;cider.nrepl/cider-middleware]&quot; and then connected from spacemacs"><y>#</y><d>2018-11-02</d><h>20:45</h><w>manas_marthi</w>I tried <code>lein nrepl :headless true  :middleware &quot;[&apos;cider.nrepl/cider-middleware]&quot;</code> and then connected from spacemacs</z><z id="t1541191689" t="manas_marthi It is connecting fine except"><y>#</y><d>2018-11-02</d><h>20:48</h><w>manas_marthi</w>It is connecting fine except</z><z id="t1541191692" t="manas_marthi a warning"><y>#</y><d>2018-11-02</d><h>20:48</h><w>manas_marthi</w>a warning</z><z id="t1541191748" t="manas_marthi clj-refactor refactor-nrepl are out of sync. their versions are 2.4.0 (package 20180826.2149) and n/a, respectively."><y>#</y><d>2018-11-02</d><h>20:49</h><w>manas_marthi</w><code>clj-refactor refactor-nrepl are out of sync. their versions are 2.4.0 (package 20180826.2149) and n/a, respectively.</code></z><z id="t1541199980" t="dominicm Makes sense, you need to add the refactor middleware too ðŸ™‚"><y>#</y><d>2018-11-02</d><h>23:06</h><w>dominicm</w>Makes sense, you need to add the refactor middleware too <b>ðŸ™‚</b></z><z id="t1541235514" t="bozhidar Or you can disable clj-refactor, if youâ€™re not using it."><y>#</y><d>2018-11-03</d><h>08:58</h><w>bozhidar</w>Or you can disable clj-refactor, if youâ€™re not using it.</z><z id="t1541235523" t="bozhidar I think they made this configurable in spacemacs recently."><y>#</y><d>2018-11-03</d><h>08:58</h><w>bozhidar</w>I think they made this configurable in spacemacs recently.</z><z id="t1541254630" t="bozhidar [:attrs {:href &quot;/_/_/users/U09LZR36F&quot;}] Quick question about Antora - how can we configure a favicon there? I skimmed through the docs and I didnâ€™t find anything."><y>#</y><d>2018-11-03</d><h>14:17</h><w>bozhidar</w><a>@dominicm</a> Quick question about Antora - how can we configure a favicon there? I skimmed through the docs and I didnâ€™t find anything.</z><z id="t1541254667" t="bozhidar I assume we can edit the header template somehow or something like this, but I hope they have a nicer way to do this. ðŸ™‚"><y>#</y><d>2018-11-03</d><h>14:17</h><w>bozhidar</w>I assume we can edit the header template somehow or something like this, but I hope they have a nicer way to do this. <b>ðŸ™‚</b></z><z id="t1541320358" t="manas_marthi Nrepl 0.3.1 is working fine on ubuntu"><y>#</y><d>2018-11-04</d><h>08:32</h><w>manas_marthi</w>Nrepl 0.3.1 is working fine on ubuntu</z><z id="t1541320470" t="manas_marthi Can&apos;t bother to troubleshoot my windows given the :headless true option and cider middleware"><y>#</y><d>2018-11-04</d><h>08:34</h><w>manas_marthi</w>Can&apos;t bother to troubleshoot my windows given the <code>:headless true</code> option and cider middleware</z><z id="t1541323524" t="manas_marthi Just managed to reproduce the issue on Windows"><y>#</y><d>2018-11-04</d><h>09:25</h><w>manas_marthi</w>Just managed to reproduce the issue on Windows</z><z id="t1541323560" t="manas_marthi Proxy/artifactory or other custom settings are not related to this"><y>#</y><d>2018-11-04</d><h>09:26</h><w>manas_marthi</w>Proxy/artifactory or other custom settings are not related to this</z><z id="t1541325935" t="bozhidar Got it. So, itâ€™s Windows-specific indeed."><y>#</y><d>2018-11-04</d><h>10:05</h><w>bozhidar</w>Got it. So, itâ€™s Windows-specific indeed.</z><z id="t1541328248" t="dominicm Putting favicon.ico in doc probably would work"><y>#</y><d>2018-11-04</d><h>10:44</h><w>dominicm</w>Putting favicon.ico in doc probably would work</z><z id="t1541348879" t="bozhidar Looking at https://gitlab.com/antora/docs.antora.org/blob/master/supplemental-ui/partials/head-meta.hbs it seems thatâ€™s probably not the case. ðŸ™‚"><y>#</y><d>2018-11-04</d><h>16:27</h><w>bozhidar</w>Looking at <a href="https://gitlab.com/antora/docs.antora.org/blob/master/supplemental-ui/partials/head-meta.hbs" target="_blank">https://gitlab.com/antora/docs.antora.org/blob/master/supplemental-ui/partials/head-meta.hbs</a> it seems thatâ€™s probably not the case. <b>ðŸ™‚</b></z><z id="t1541348907" t="bozhidar I wonder if those partials are something auto-included or not. Seems odd they didnâ€™t add any special provisions for favicons."><y>#</y><d>2018-11-04</d><h>16:28</h><w>bozhidar</w>I wonder if those partials are something auto-included or not. Seems odd they didnâ€™t add any special provisions for favicons.</z><z id="t1541358161" t="dominicm I think the intention is to paramaterize in response to requests. They&apos;re trying not to create a locked in API that all templates have to follow. "><y>#</y><d>2018-11-04</d><h>19:02</h><w>dominicm</w>I think the intention is to paramaterize in response to requests. They&apos;re trying not to create a locked in API that all templates have to follow. </z><z id="t1541362122" t="bozhidar Well, Iâ€™ve sent them a request. Weâ€™ll see what theyâ€™ll say. ðŸ™‚ Iâ€™m fine with adding a partial, but I really think something as basic as this should just be configuration."><y>#</y><d>2018-11-04</d><h>20:08</h><w>bozhidar</w>Well, Iâ€™ve sent them a request. Weâ€™ll see what theyâ€™ll say. <b>ðŸ™‚</b> Iâ€™m fine with adding a partial, but I really think something as basic as this should just be configuration.</z><z id="t1542156058" t="bostonaholic when upgrading from [org.clojure/tools.nrepl &quot;0.2.12&quot;] to [nrepl &quot;0.4.5&quot;] I get this error when trying to lein repl :connect 6016"><y>#</y><d>2018-11-14</d><h>00:40</h><w>bostonaholic</w>when upgrading from <code>[org.clojure/tools.nrepl &quot;0.2.12&quot;]</code> to <code>[nrepl &quot;0.4.5&quot;]</code> I get this error when trying to <code>lein repl :connect 6016</code></z><z id="t1542156061" t="bostonaholic Connecting to nREPL at 127.0.0.1:6016 CompilerException java.lang.ClassNotFoundException: clojure.tools.nrepl, compiling:(/tmp/form-init7225806873867235170.clj:1:82) #object[clojure.lang.Namespace 0x66756994 &quot;user&quot;] Error loading namespace; falling back to user nil "><y>#</y><d>2018-11-14</d><h>00:41</h><w>bostonaholic</w><pre>Connecting to nREPL at 127.0.0.1:6016
CompilerException java.lang.ClassNotFoundException: clojure.tools.nrepl, compiling:(/tmp/form-init7225806873867235170.clj:1:82)
#object[clojure.lang.Namespace 0x66756994 &quot;user&quot;]
Error loading namespace; falling back to user
nil
</pre></z></g><g id="s2"><z id="t1542156066" t="bostonaholic anyone have any ideas?"><y>#</y><d>2018-11-14</d><h>00:41</h><w>bostonaholic</w>anyone have any ideas?</z><z id="t1542203649" t="bozhidar [:attrs {:href &quot;/_/_/users/U066DVDM5&quot;}] I think youâ€™ve got two options - update to lein from master or use lein-nrepl instead."><y>#</y><d>2018-11-14</d><h>13:54</h><w>bozhidar</w><a>@bostonaholic</a> I think youâ€™ve got two options - update to lein from <code>master</code> or use <code>lein-nrepl</code> instead.</z><z id="t1542203725" t="bozhidar I think I never got to adding :connect to lein-nrepl , though, so probably using the newest lein is the easiest route."><y>#</y><d>2018-11-14</d><h>13:55</h><w>bozhidar</w>I think I never got to adding <code>:connect</code> to <code>lein-nrepl</code>, though, so probably using the newest lein is the easiest route.</z><z id="t1542572753" t="pez [:attrs {:href &quot;/_/_/users/U051BLM8F&quot;}] , so, since Calva is not ready for 0.4.5 yet, I am trying to see what needs to be done about it. Figured using lein-master was the way to go. It complains about Warning: implicit middleware found: cider-nrepl.plugin/middleware and advices to declare it in :middleware instead. Iâ€™d like to have a project.clj that I do not need to change between current lein and lein-master, if that is possible. My current project.clj looks like so: {:repl {:plugins [[cider/cider-nrepl &quot;0.18.0&quot;]] :dependencies [[cider/piggieback &quot;0.3.10&quot;] [figwheel-sidecar &quot;0.5.16&quot;]] :repl-options {:nrepl-middleware [cider.piggieback/wrap-cljs-repl]}}} Any advice?"><y>#</y><d>2018-11-18</d><h>20:25</h><w>pez</w><a>@bozhidar</a>, so, since Calva is not ready for 0.4.5 yet, I am trying to see what needs to be done about it. Figured using <code>lein-master</code> was the way to go. It complains about <code>Warning: implicit middleware found: cider-nrepl.plugin/middleware</code> and advices to declare it in <code>:middleware</code> instead. Iâ€™d like to have a project.clj that I do not need to change between current lein and lein-master, if that is possible. My current project.clj looks like so: <pre>{:repl {:plugins [[cider/cider-nrepl &quot;0.18.0&quot;]]
        :dependencies [[cider/piggieback &quot;0.3.10&quot;]
                       [figwheel-sidecar &quot;0.5.16&quot;]]
        :repl-options {:nrepl-middleware [cider.piggieback/wrap-cljs-repl]}}}</pre>
Any advice?</z><z id="t1542616403" t="bozhidar [:attrs {:href &quot;/_/_/users/U0ETXRFEW&quot;}] Hmm, thatâ€™s odd. We didnâ€™t really change anything on our end in this regard, so thatâ€™s likely a change that happened in lein ."><y>#</y><d>2018-11-19</d><h>08:33</h><w>bozhidar</w><a>@pez</a> Hmm, thatâ€™s odd. We didnâ€™t really change anything on our end in this regard, so thatâ€™s likely a change that happened in <code>lein</code>.</z><z id="t1542616454" t="bozhidar Actually the plugin is what generates the proper :repl-options , so you donâ€™t have to do this manually."><y>#</y><d>2018-11-19</d><h>08:34</h><w>bozhidar</w>Actually the plugin is what generates the proper <code>:repl-options</code>, so you donâ€™t have to do this manually.</z><z id="t1542616642" t="bozhidar Yeah, something changed in master - https://github.com/technomancy/leiningen/commit/3e1459a2b22db6ed39ed6a4de0f2695d1d3ceeeb"><y>#</y><d>2018-11-19</d><h>08:37</h><w>bozhidar</w>Yeah, something changed in master - <a href="https://github.com/technomancy/leiningen/commit/3e1459a2b22db6ed39ed6a4de0f2695d1d3ceeeb" target="_blank">https://github.com/technomancy/leiningen/commit/3e1459a2b22db6ed39ed6a4de0f2695d1d3ceeeb</a></z><z id="t1542616688" t="bozhidar But the warning is actually about the lein middleware, not nREPLâ€™s middleware."><y>#</y><d>2018-11-19</d><h>08:38</h><w>bozhidar</w>But the warning is actually about the lein middleware, not nREPLâ€™s middleware.</z><z id="t1542616708" t="bozhidar (lein middleware is simply a plugin that only transforms the project map)"><y>#</y><d>2018-11-19</d><h>08:38</h><w>bozhidar</w>(lein middleware is simply a plugin that only transforms the project map)</z><z id="t1542616733" t="bozhidar Not sure what weâ€™re expected to do this here, but despite the working everything should work just fine."><y>#</y><d>2018-11-19</d><h>08:38</h><w>bozhidar</w>Not sure what weâ€™re expected to do this here, but despite the working everything should work just fine.</z><z id="t1542625363" t="pez OK. Checking that I understand which plugin you are referring to. If I remove [cider/cider-nrepl &quot;0.18.0&quot;] from the above profile, then leiningen stops complaining. Now I&apos;ll go read the links you provided. ðŸ˜ƒ"><y>#</y><d>2018-11-19</d><h>11:02</h><w>pez</w>OK. Checking that I understand which plugin you are referring to. If I remove <code>[cider/cider-nrepl &quot;0.18.0&quot;]</code> from the above profile, then leiningen stops complaining. Now I&apos;ll go read the links you provided. <b>ðŸ˜ƒ</b></z><z id="t1542625600" t="pez Alright, I can&apos;t make sense out of that patch. Anyway. I can ignore the warning, right?"><y>#</y><d>2018-11-19</d><h>11:06</h><w>pez</w>Alright, I can&apos;t make sense out of that patch. Anyway. I can ignore the warning, right?</z><z id="t1542625934" t="pez I want to track down where from 0.2.13 -&gt; 0.4.5 I stopped being able to decode the messages. Which version is it that is â€the sameâ€ as 0.2.13 now again?"><y>#</y><d>2018-11-19</d><h>11:12</h><w>pez</w>I want to track down where from <code>0.2.13</code> -&gt; <code>0.4.5</code> I stopped being able to decode the messages. Which version is it that is â€the sameâ€ as <code>0.2.13</code> now again?</z><z id="t1542627518" t="bozhidar &gt; Alright, I canâ€™t make sense out of that patch. Anyway. I can ignore the warning, right?"><y>#</y><d>2018-11-19</d><h>11:38</h><w>bozhidar</w>&gt; Alright, I canâ€™t make sense out of that patch. Anyway. I can ignore the warning, right?</z><z id="t1542627525" t="bozhidar &gt; I want to track down where from 0.2.13 -&gt; 0.4.5 I stopped being able to decode the messages. Which version is it that is â€œthe sameâ€ as 0.2.13 now again?"><y>#</y><d>2018-11-19</d><h>11:38</h><w>bozhidar</w>&gt; I want to track down where from <code>0.2.13</code> -&gt; <code>0.4.5</code> I stopped being able to decode the messages. Which version is it that is â€œthe sameâ€ as <code>0.2.13</code> now again?</z><z id="t1542627556" t="bozhidar Nothing with respect to message encoding/decoding has changed between 0.2.13 and 0.4.5."><y>#</y><d>2018-11-19</d><h>11:39</h><w>bozhidar</w>Nothing with respect to message encoding/decoding has changed between 0.2.13 and 0.4.5.</z><z id="t1542627571" t="bozhidar What exactly is the problem youâ€™re encountering?"><y>#</y><d>2018-11-19</d><h>11:39</h><w>bozhidar</w>What exactly is the problem youâ€™re encountering?</z><z id="t1542633935" t="pez I am trying to figure out what exactly is the problem, but what happens is that lots of the decoding starts to fail and also my nrepl client goes into an infinite loop endlessly failing decoding. It doesn&apos;t necessarily have to do with the encoding of the new nrepl. The client in Calva is a bit too naive and probably very sensitive to the order in which responses come back. It is time to fix that, and maybe I should before investigating the problems it has with 0.4.5."><y>#</y><d>2018-11-19</d><h>13:25</h><w>pez</w>I am trying to figure out what exactly is the problem, but what happens is that lots of the decoding starts to fail and also my nrepl client goes into an infinite loop endlessly failing decoding. It doesn&apos;t necessarily have to do with the encoding of the new nrepl. The client in Calva is a bit too naive and probably very sensitive to the order in which responses come back. It is time to fix that, and maybe I should before investigating the problems it has with 0.4.5.</z><z id="t1542649820" t="bozhidar No idea. Seems you can really use that EDN transport (or maybe the transit ones)."><y>#</y><d>2018-11-19</d><h>17:50</h><w>bozhidar</w>No idea. Seems you can really use that EDN transport (or maybe the transit ones).</z><z id="t1542649859" t="bozhidar At any rate - Iâ€™m 100% certain that the encoding logic hasnâ€™t changed at all, so the problem is likely unrelated."><y>#</y><d>2018-11-19</d><h>17:50</h><w>bozhidar</w>At any rate - Iâ€™m 100% certain that the encoding logic hasnâ€™t changed at all, so the problem is likely unrelated.</z><z id="t1542654961" t="pez It seems that what my nrepl client is failing to decode is a java stack trace."><y>#</y><d>2018-11-19</d><h>19:16</h><w>pez</w>It seems that what my nrepl client is failing to decode is a java stack trace.</z><z id="t1542656125" t="pez Found it. It was the figwheel-sidecar dependency that needed to be updated to 0.5.17."><y>#</y><d>2018-11-19</d><h>19:35</h><w>pez</w>Found it. It was the figwheel-sidecar dependency that needed to be updated to 0.5.17.</z><z id="t1542656526" t="pez Now most things work, but the test ops fail with a stack trace starting with Exception in thread &quot;nREPL-worker-2&quot; java.lang.IllegalArgumentException: No implementation of method: :send of protocol: #&apos;clojure.tools.nrepl.transport/Transport found for class: nrepl.transport.FnTransport"><y>#</y><d>2018-11-19</d><h>19:42</h><w>pez</w>Now most things work, but the <code>test</code> ops fail with a stack trace starting with <code>Exception in thread &quot;nREPL-worker-2&quot; java.lang.IllegalArgumentException: No implementation of method: :send of protocol: #&apos;clojure.tools.nrepl.transport/Transport found for class: nrepl.transport.FnTransport</code></z><z id="t1542656620" t="pez"><y>#</y><d>2018-11-19</d><h>19:43</h><w>pez</w></z><z id="t1542660052" t="pez Also this: https://clojurians.slack.com/archives/C0AB48493/p1542659815145900"><y>#</y><d>2018-11-19</d><h>20:40</h><w>pez</w>Also this: <a href="https://clojurians.slack.com/archives/C0AB48493/p1542659815145900" target="_blank">https://clojurians.slack.com/archives/C0AB48493/p1542659815145900</a></z><z id="t1542710095" t="bozhidar [:attrs {:href &quot;/_/_/users/U0ETXRFEW&quot;}] Whatâ€™s the failure?"><y>#</y><d>2018-11-20</d><h>10:34</h><w>bozhidar</w><a>@pez</a> Whatâ€™s the failure?</z><z id="t1542710109" t="bozhidar &gt; Exception in thread &quot;nREPL-worker-2&quot; java.lang.IllegalArgumentException: No implementation of method: :send of protocol: #&apos;clojure.tools.nrepl.transport/Transport found for class: nrepl.transport.FnTransport"><y>#</y><d>2018-11-20</d><h>10:35</h><w>bozhidar</w>&gt; <code>Exception in thread &quot;nREPL-worker-2&quot; java.lang.IllegalArgumentException: No implementation of method: :send of protocol: #&apos;clojure.tools.nrepl.transport/Transport found for class: nrepl.transport.FnTransport</code></z><z id="t1542710133" t="bozhidar According to this stacktrace youâ€™ve got a mixture of tools.nrepl and nrepl in your project."><y>#</y><d>2018-11-20</d><h>10:35</h><w>bozhidar</w>According to this stacktrace youâ€™ve got a mixture of tools.nrepl and nrepl in your project.</z><z id="t1542710184" t="bozhidar Are you sure you donâ€™t have tools.nrepl somewhere in its dependency tree?"><y>#</y><d>2018-11-20</d><h>10:36</h><w>bozhidar</w>Are you sure you donâ€™t have <code>tools.nrepl</code> somewhere in its dependency tree?</z><z id="t1542711375" t="pez [:attrs {:href &quot;/_/_/users/U051BLM8F&quot;}] The failure related to the :repl-options map in the project file?"><y>#</y><d>2018-11-20</d><h>10:56</h><w>pez</w><a>@bozhidar</a> The failure related to the <code>:repl-options</code> map in the project file?</z><z id="t1542711641" t="pez You&apos;re right, it says tools.nrepl right there. I&apos;ll print out the dependency tree and see if I can see it lurking around there. But I really shouldn&apos;t have that. I used the broomstick to chase everything like that out!"><y>#</y><d>2018-11-20</d><h>11:00</h><w>pez</w>You&apos;re right, it says <code>tools.nrepl</code> right there. I&apos;ll print out the dependency tree and see if I can see it lurking around there.  But I really shouldn&apos;t have that. I used the broomstick to chase everything like that out!</z><z id="t1542720110" t="bozhidar It must be there, otherwise you canâ€™t get such a stacktrace."><y>#</y><d>2018-11-20</d><h>13:21</h><w>bozhidar</w>It must be there, otherwise you canâ€™t get such a stacktrace.</z><z id="t1542720120" t="bozhidar As for the :repl-options problem - I donâ€™t know."><y>#</y><d>2018-11-20</d><h>13:22</h><w>bozhidar</w>As for the <code>:repl-options</code> problem - I donâ€™t know.</z><z id="t1542720185" t="bozhidar I donâ€™t have time to play with lein master myself. I just use the lein-nrepl plugin instead."><y>#</y><d>2018-11-20</d><h>13:23</h><w>bozhidar</w>I donâ€™t have time to play with lein master myself. I just use the <code>lein-nrepl</code> plugin instead.</z><z id="t1542722152" t="pez When using that plugin my user namespace didn&apos;t load as it does with a â€normalâ€ repl."><y>#</y><d>2018-11-20</d><h>13:55</h><w>pez</w>When using that plugin my user namespace didn&apos;t load as it does with a â€normalâ€ repl.</z><z id="t1542722464" t="pez I got in a hurry since I had been thinking Calva was ready for 0.4.5 and now when you made me see that I hadn&apos;t even tested that, I want to make it as painless as possible for the users when leiningen upgrades and 0.4.5 starts to be used."><y>#</y><d>2018-11-20</d><h>14:01</h><w>pez</w>I got in a hurry since I had been thinking Calva was ready for 0.4.5 and now when you made me see that I hadn&apos;t even tested that, I want to make it as painless as possible for the users when leiningen upgrades and 0.4.5 starts to be used.</z><z id="t1542723008" t="bozhidar Whatâ€™s in your user.clj , btw?"><y>#</y><d>2018-11-20</d><h>14:10</h><w>bozhidar</w>Whatâ€™s in your <code>user.clj</code>, btw?</z><z id="t1542723023" t="bozhidar Thatâ€™s often the reason for problems like yours."><y>#</y><d>2018-11-20</d><h>14:10</h><w>bozhidar</w>Thatâ€™s often the reason for problems like yours.</z><z id="t1542724368" t="pez In the project I tried the plugin with, user.clj contains just this: (ns routing-example.user (:use [figwheel-sidecar.repl-api :as ra])) (defn start [] (ra/start-figwheel!) (ra/cljs-repl &quot;dev&quot;)) (defn stop [] (ra/stop-figwheel!)) "><y>#</y><d>2018-11-20</d><h>14:32</h><w>pez</w>In the project I tried the plugin with, <code>user.clj</code> contains just this:
<pre>(ns routing-example.user
  (:use [figwheel-sidecar.repl-api :as ra]))

(defn start []
  (ra/start-figwheel!)
  (ra/cljs-repl &quot;dev&quot;))

(defn stop []
  (ra/stop-figwheel!))
</pre></z><z id="t1542730900" t="bozhidar Iâ€™ll have to check figwheel-sidecar deps then. Likely itâ€™s pulling the wrong version of nREPL."><y>#</y><d>2018-11-20</d><h>16:21</h><w>bozhidar</w>Iâ€™ll have to check figwheel-sidecar deps then. Likely itâ€™s pulling the wrong version of nREPL.</z><z id="t1542730956" t="bozhidar https://github.com/bhauman/lein-figwheel/blob/master/sidecar/project.clj#L31"><y>#</y><d>2018-11-20</d><h>16:22</h><w>bozhidar</w><a href="https://github.com/bhauman/lein-figwheel/blob/master/sidecar/project.clj#L31" target="_blank">https://github.com/bhauman/lein-figwheel/blob/master/sidecar/project.clj#L31</a></z><z id="t1542730990" t="bozhidar Yep, thatâ€™s messing everything up. If you remove this file all will be good."><y>#</y><d>2018-11-20</d><h>16:23</h><w>bozhidar</w>Yep, thatâ€™s messing everything up. If you remove this file all will be good.</z><z id="t1542731025" t="bozhidar This loads tools.nrepl, which makes cider-nrepl believe youâ€™re using tools.nrepl (as it checks if itâ€™s loaded to decide which nREPL version to use)."><y>#</y><d>2018-11-20</d><h>16:23</h><w>bozhidar</w>This loads tools.nrepl, which makes cider-nrepl believe youâ€™re using <code>tools.nrepl</code> (as it checks if itâ€™s loaded to decide which nREPL version to use).</z><z id="t1542731093" t="bozhidar Iâ€™m pretty sure everything will work fine for you without this file."><y>#</y><d>2018-11-20</d><h>16:24</h><w>bozhidar</w>Iâ€™m pretty sure everything will work fine for you without this file.</z><z id="t1542781190" t="pez You mean remove that dependency in my local sidecar?"><y>#</y><d>2018-11-21</d><h>06:19</h><w>pez</w>You mean remove that dependency in my local sidecar?</z><z id="t1542791614" t="bozhidar I mean - try to run things without user.clj and running that code after youâ€™ve connected."><y>#</y><d>2018-11-21</d><h>09:13</h><w>bozhidar</w>I mean - try to run things without <code>user.clj</code> and running that code after youâ€™ve connected.</z><z id="t1542810910" t="pez Haha. Sorry. ðŸ˜ƒ"><y>#</y><d>2018-11-21</d><h>14:35</h><w>pez</w>Haha. Sorry. <b>ðŸ˜ƒ</b></z><z id="t1542873661" t="pez [:attrs {:href &quot;/_/_/users/U051BLM8F&quot;}] , OK. So now I got the time to try this again. If I remove the dependency on sidecar all together, things that used to work, still work (in Calva). Except anything ClojureScript, of course. Is Cider working with ClojureScript using the new nrepl?"><y>#</y><d>2018-11-22</d><h>08:01</h><w>pez</w><a>@bozhidar</a>, OK. So now I got the time to try this again. If I remove the dependency on sidecar all together, things that used to work, still work (in Calva). Except anything ClojureScript, of course. Is Cider working with ClojureScript using the new nrepl?</z><z id="t1542875655" t="bozhidar [:attrs {:href &quot;/_/_/users/U0ETXRFEW&quot;}] Of course. ðŸ™‚"><y>#</y><d>2018-11-22</d><h>08:34</h><w>bozhidar</w><a>@pez</a> Of course. <b>ðŸ™‚</b></z><z id="t1542875696" t="bozhidar The problem is not nREPL - the problem is the dependency loading got messed up in your case and youâ€™re running one version of the server and middleware that expects the other one."><y>#</y><d>2018-11-22</d><h>08:34</h><w>bozhidar</w>The problem is not nREPL - the problem is the dependency loading got messed up in your case and youâ€™re running one version of the server and middleware that expects the other one.</z><z id="t1542875701" t="bozhidar That comes from this code."><y>#</y><d>2018-11-22</d><h>08:35</h><w>bozhidar</w>That comes from this code.</z><z id="t1542875772" t="bozhidar https://github.com/clojure-emacs/cider-nrepl/blob/master/src/cider/nrepl.clj#L8"><y>#</y><d>2018-11-22</d><h>08:36</h><w>bozhidar</w><a href="https://github.com/clojure-emacs/cider-nrepl/blob/master/src/cider/nrepl.clj#L8" target="_blank">https://github.com/clojure-emacs/cider-nrepl/blob/master/src/cider/nrepl.clj#L8</a></z><z id="t1542875837" t="bozhidar I hope that this makes sense. With user.clj your altering the expected load order of the libraries, so and in your case it seems to me that sidecar loads the legacy tools.nrepl at some point even though youâ€™re actually trying to connect to the new one."><y>#</y><d>2018-11-22</d><h>08:37</h><w>bozhidar</w>I hope that this makes sense. With <code>user.clj</code> your altering the expected load order of the libraries, so and in your case it seems to me that sidecar loads the legacy tools.nrepl at some point even though youâ€™re actually trying to connect to the new one.</z><z id="t1542875894" t="bozhidar Thatâ€™s going to be fixed for good when I completely kill the support for tools.nrepl in a release or two. But for now without a lein release in a long time it was necessary."><y>#</y><d>2018-11-22</d><h>08:38</h><w>bozhidar</w>Thatâ€™s going to be fixed for good when I completely kill the support for tools.nrepl in a release or two. But for now without a lein release in a long time it was necessary.</z><z id="t1542876160" t="pez I think I have understood that the problem is not nREPL. ðŸ˜„ But even without user.clj I get that trace as long as I have a dependency on sidecar . And without sidecar I donâ€™t know how to start the cljs repl (for Figwheel projects)."><y>#</y><d>2018-11-22</d><h>08:42</h><w>pez</w>I think I have understood that the problem is not nREPL. <b>ðŸ˜„</b> But even without <code>user.clj</code> I get that trace as long as I have a dependency on <code>sidecar</code>. And without sidecar I donâ€™t know how to start the cljs repl (for Figwheel projects).</z><z id="t1542876267" t="dominicm It&apos;s to do with lazy Loading [:attrs {:href &quot;/_/_/users/U051BLM8F&quot;}] "><y>#</y><d>2018-11-22</d><h>08:44</h><w>dominicm</w>It&apos;s to do with lazy Loading <a>@bozhidar</a> </z><z id="t1542876286" t="dominicm Because we lazily load middleware, it finds a different nrepl at different points"><y>#</y><d>2018-11-22</d><h>08:44</h><w>dominicm</w>Because we lazily load middleware, it finds a different nrepl at different points</z><z id="t1542876337" t="bozhidar [:attrs {:href &quot;/_/_/users/U09LZR36F&quot;}] Yeah, but this can only happen if some dep explicitly requires tools.nrepl in the mean time, which should not happen most of the time."><y>#</y><d>2018-11-22</d><h>08:45</h><w>bozhidar</w><a>@dominicm</a> Yeah, but this can only happen if some dep explicitly requires <code>tools.nrepl</code> in the mean time, which should not happen most of the time.</z><z id="t1542876346" t="dominicm Why shouldn&apos;t it? "><y>#</y><d>2018-11-22</d><h>08:45</h><w>dominicm</w>Why shouldn&apos;t it? </z><z id="t1542876403" t="bozhidar Because I assume that most libraries will follow the same pattern as us - have a hard dep on nrepl and dynamically select tools.nrepl if it happens to be present. At least thatâ€™s what all the libs Iâ€™m involved with do."><y>#</y><d>2018-11-22</d><h>08:46</h><w>bozhidar</w>Because I assume that most libraries will follow the same pattern as us - have a hard dep on nrepl and dynamically select tools.nrepl if it happens to be present. At least thatâ€™s what all the libs Iâ€™m involved with do.</z><z id="t1542876500" t="pez So, I should file a PR on sidecar doing that?"><y>#</y><d>2018-11-22</d><h>08:48</h><w>pez</w>So, I should file a PR on sidecar doing that?</z><z id="t1542876551" t="pez Iâ€™m still puzzled how you get the cljs repl up without sidecar, [:attrs {:href &quot;/_/_/users/U051BLM8F&quot;}]"><y>#</y><d>2018-11-22</d><h>08:49</h><w>pez</w>Iâ€™m still puzzled how you get the cljs repl up without sidecar, <a>@bozhidar</a></z><z id="t1542876588" t="bozhidar [:attrs {:href &quot;/_/_/users/U0ETXRFEW&quot;}] Itâ€™s all about the load order - if you load all middleware first this is going to work just fine."><y>#</y><d>2018-11-22</d><h>08:49</h><w>bozhidar</w><a>@pez</a> Itâ€™s all about the load order - if you load all middleware first this is going to work just fine.</z><z id="t1542876645" t="bozhidar As you can see sidecar has support for the new nREPL https://github.com/bhauman/lein-figwheel/blob/dfd010d372280746f64397328fb9a402d448276d/sidecar/src/figwheel_sidecar/components/nrepl_server.clj#L6"><y>#</y><d>2018-11-22</d><h>08:50</h><w>bozhidar</w>As you can see sidecar has support for the new nREPL <a href="https://github.com/bhauman/lein-figwheel/blob/dfd010d372280746f64397328fb9a402d448276d/sidecar/src/figwheel_sidecar/components/nrepl_server.clj#L6" target="_blank">https://github.com/bhauman/lein-figwheel/blob/dfd010d372280746f64397328fb9a402d448276d/sidecar/src/figwheel_sidecar/components/nrepl_server.clj#L6</a></z><z id="t1542876718" t="bozhidar https://github.com/bhauman/lein-figwheel/blob/dfd010d372280746f64397328fb9a402d448276d/sidecar/src/figwheel_sidecar/repl.clj#L228"><y>#</y><d>2018-11-22</d><h>08:51</h><w>bozhidar</w><a href="https://github.com/bhauman/lein-figwheel/blob/dfd010d372280746f64397328fb9a402d448276d/sidecar/src/figwheel_sidecar/repl.clj#L228" target="_blank">https://github.com/bhauman/lein-figwheel/blob/dfd010d372280746f64397328fb9a402d448276d/sidecar/src/figwheel_sidecar/repl.clj#L228</a></z><z id="t1542876746" t="pez Right, so no PR needed. ðŸ˜ƒ"><y>#</y><d>2018-11-22</d><h>08:52</h><w>pez</w>Right, so no PR needed. <b>ðŸ˜ƒ</b></z><z id="t1542876749" t="bozhidar When I tested this it worked just fine for me."><y>#</y><d>2018-11-22</d><h>08:52</h><w>bozhidar</w>When I tested this it worked just fine for me.</z><z id="t1542876799" t="pez I donâ€™t know how to configure the load order, I guess."><y>#</y><d>2018-11-22</d><h>08:53</h><w>pez</w>I donâ€™t know how to configure the load order, I guess.</z><z id="t1542876801" t="bozhidar Probably just changing the dependency that sidecar has is going to fix this, but I donâ€™t have time to look into this. You can update project.clj, build it locally and try."><y>#</y><d>2018-11-22</d><h>08:53</h><w>bozhidar</w>Probably just changing the dependency that sidecar has is going to fix this, but I donâ€™t have time to look into this. You can update project.clj, build it locally and try.</z><z id="t1542876832" t="bozhidar If no other lib you use has a dep on tools.nrepl then this must the root cause of the problem."><y>#</y><d>2018-11-22</d><h>08:53</h><w>bozhidar</w>If no other lib you use has a dep on tools.nrepl then this must the root cause of the problem.</z><z id="t1542876834" t="pez OK, Iâ€™ll do that right away."><y>#</y><d>2018-11-22</d><h>08:53</h><w>pez</w>OK, Iâ€™ll do that right away.</z><z id="t1542876909" t="pez But it still seems strange that I need a patched sidecar, when you donâ€™t. There is something important I am not getting here."><y>#</y><d>2018-11-22</d><h>08:55</h><w>pez</w>But it still seems strange that I need a patched sidecar, when you donâ€™t. There is something important I am not getting here.</z><z id="t1542877206" t="bozhidar Iâ€™m not using user.clj ."><y>#</y><d>2018-11-22</d><h>09:00</h><w>bozhidar</w>Iâ€™m not using <code>user.clj</code>.</z><z id="t1542877214" t="pez Me neither."><y>#</y><d>2018-11-22</d><h>09:00</h><w>pez</w>Me neither.</z><z id="t1542877230" t="bozhidar I just start figwheel via cider-jack-in and thatâ€™s it."><y>#</y><d>2018-11-22</d><h>09:00</h><w>bozhidar</w>I just start figwheel via cider-jack-in and thatâ€™s it.</z><z id="t1542877253" t="bozhidar But I also have no other deps. I always do just very basic cljs tests as I donâ€™t do cljs myself."><y>#</y><d>2018-11-22</d><h>09:00</h><w>bozhidar</w>But I also have no other deps. I always do just very basic cljs tests as I donâ€™t do cljs myself.</z><z id="t1542877354" t="pez OK. So I should look at what cider-jack-in does. It was a while since I did that. Calva needs something similar. Badly."><y>#</y><d>2018-11-22</d><h>09:02</h><w>pez</w>OK. So I should look at what cider-jack-in does. It was a while since I did that. Calva needs something similar. Badly.</z><z id="t1542878247" t="bozhidar I assume itâ€™s going to be pretty easy for you to just carbon-copy CIDERâ€™s approach, as thereâ€™s nothing specific about it."><y>#</y><d>2018-11-22</d><h>09:17</h><w>bozhidar</w>I assume itâ€™s going to be pretty easy for you to just carbon-copy CIDERâ€™s approach, as thereâ€™s nothing specific about it.</z><z id="t1542878296" t="bozhidar We just build a command string that will start nREPL + the necessary middleware, run it and parse its output to check when the server has started."><y>#</y><d>2018-11-22</d><h>09:18</h><w>bozhidar</w>We just build a command string that will start nREPL + the necessary middleware, run it and parse its output to check when the server has started.</z><z id="t1542878327" t="bozhidar Then we open a connection the server - business as usual."><y>#</y><d>2018-11-22</d><h>09:18</h><w>bozhidar</w>Then we open a connection the server - business as usual.</z><z id="t1542878857" t="pez Yes, I think the trickiest part will be how to know when I can connect."><y>#</y><d>2018-11-22</d><h>09:27</h><w>pez</w>Yes, I think the trickiest part will be how to know when I can connect.</z><z id="t1542879049" t="pez OK. So if I remove that dependency from sidecar â€™s projectclj and move piggieback up before nrepl in :dependencies , then it works. I can even have my user.clj and use that for starting the cljs repl."><y>#</y><d>2018-11-22</d><h>09:30</h><w>pez</w>OK. So if I remove that dependency from <code>sidecar</code>â€™s <code>projectclj</code> and move <code>piggieback</code> up before <code>nrepl</code> in <code>:dependencies</code>, then it works. I can even have my <code>user.clj</code> and use that for starting the cljs repl.</z><z id="t1542880496" t="bozhidar Weâ€™re making progress. ðŸ™‚"><y>#</y><d>2018-11-22</d><h>09:54</h><w>bozhidar</w>Weâ€™re making progress. <b>ðŸ™‚</b></z><z id="t1542881814" t="pez For some misconfigurations, sidecar (I think) gives some hints about piggieback and adds: Note: Cider will inject this config into your project.clj. This can cause confusion when your are not using Cider. You could say that again. ðŸ˜„"><y>#</y><d>2018-11-22</d><h>10:16</h><w>pez</w>For some misconfigurations, sidecar (I think) gives some hints about piggieback and adds:
<pre>Note: Cider will inject this config into your project.clj.
This can cause confusion when your are not using Cider.</pre>
You could say that again. <b>ðŸ˜„</b></z><z id="t1542882550" t="bozhidar [:attrs {:href &quot;/_/_/users/U0ETXRFEW&quot;}] But now youâ€™re enlightened! Thatâ€™s always a good thing!"><y>#</y><d>2018-11-22</d><h>10:29</h><w>bozhidar</w><a>@pez</a> But now youâ€™re enlightened! Thatâ€™s always a good thing!</z><z id="t1542882684" t="pez I am trying to cling on to this new knowledge. As well as act on the, not so subtle, hints the process has given me about the need for calva-jack-in."><y>#</y><d>2018-11-22</d><h>10:31</h><w>pez</w>I am trying to cling on to this new knowledge. As well as act on the, not so subtle, hints the process has given me about the need for calva-jack-in.</z><z id="t1542882858" t="pez Also questioning my decision to start with tooling for a language that was so new to me, in all ways possible. But Iâ€™ll compensate with a blood, sweat, tears and a happy moodâ€¦"><y>#</y><d>2018-11-22</d><h>10:34</h><w>pez</w>Also questioning my decision to start with tooling for a language that was so new to me, in all ways possible. But Iâ€™ll compensate with a blood, sweat, tears and a happy moodâ€¦</z><z id="t1542882974" t="bozhidar Well, the process was relatively similar for me as well. I started CIDER with relatively little experience with Clojure, but it somehow worked out (more or less) well."><y>#</y><d>2018-11-22</d><h>10:36</h><w>bozhidar</w>Well, the process was relatively similar for me as well. I started CIDER with relatively little experience with Clojure, but it somehow worked out (more or less) well.</z><z id="t1542882997" t="bozhidar Passion and hard work can get you anywhere. ðŸ™‚"><y>#</y><d>2018-11-22</d><h>10:36</h><w>bozhidar</w>Passion and hard work can get you anywhere. <b>ðŸ™‚</b></z><z id="t1542883084" t="bozhidar (and hard liquor ðŸ˜‰ )"><y>#</y><d>2018-11-22</d><h>10:38</h><w>bozhidar</w>(and hard liquor <b>ðŸ˜‰</b> )</z><z id="t1542883939" t="pez I should now confess that most often I go for Bourbon over Calva."><y>#</y><d>2018-11-22</d><h>10:52</h><w>pez</w>I should now confess that most often I go for Bourbon over Calva.</z><z id="t1542894342" t="bozhidar Donâ€™t speak to me about bourbon now - I had a fun encounter with two bottles of it a day ago and Iâ€™m still recovering. ðŸ˜„"><y>#</y><d>2018-11-22</d><h>13:45</h><w>bozhidar</w>Donâ€™t speak to me about bourbon now - I had a fun encounter with two bottles of it a day ago and Iâ€™m still recovering. <b>ðŸ˜„</b></z><z id="t1542895208" t="pez Just you and two bottles?"><y>#</y><d>2018-11-22</d><h>14:00</h><w>pez</w>Just you and two bottles?</z><z id="t1542971155" t="Marc O&apos;Morain Iâ€™m doing some work with Calva parsing test results, and Iâ€™m wondering if there are any docs on the return values from cider.nrepl.middleware.test https://github.com/clojure-emacs/cider-nrepl/blob/master/src/cider/nrepl/middleware/test.clj Iâ€™m currently trying to reverse engineer from the code. Is there a better way?"><y>#</y><d>2018-11-23</d><h>11:05</h><w>Marc O'Morain</w>Iâ€™m doing some work with Calva parsing test results, and Iâ€™m wondering if there are any docs on the return values from <code>cider.nrepl.middleware.test</code>

<a href="https://github.com/clojure-emacs/cider-nrepl/blob/master/src/cider/nrepl/middleware/test.clj" target="_blank">https://github.com/clojure-emacs/cider-nrepl/blob/master/src/cider/nrepl/middleware/test.clj</a>

Iâ€™m currently trying to reverse engineer from the code. Is there a better way?</z><z id="t1542975797" t="pez Are you fixing bugs or trying to parse something Calva does not already implement?"><y>#</y><d>2018-11-23</d><h>12:23</h><w>pez</w>Are you fixing bugs or trying to parse something Calva does not already implement?</z><z id="t1543183265" t="Marc O&apos;Morain Neither - I was trying to add types to the response message rather than leaving them as bare objects, so that I could leverage more of TypeScript to help me deal with the test results. I went way too far down a rabbit hole - https://github.com/BetterThanTomorrow/calva/pull/88/files#diff-55e125b5407ed6ce11e002a28b4aef0aR285"><y>#</y><d>2018-11-25</d><h>22:01</h><r>Marc O'Morain</r>Neither - I was trying to add types to the response message rather than leaving them as bare objects, so that I could leverage more of TypeScript to help me deal with the test results.

I went way too far down a rabbit hole - <a href="https://github.com/BetterThanTomorrow/calva/pull/88/files#diff-55e125b5407ed6ce11e002a28b4aef0aR285" target="_blank">https://github.com/BetterThanTomorrow/calva/pull/88/files#diff-55e125b5407ed6ce11e002a28b4aef0aR285</a></z><z id="t1543190625" t="pez Looks like you are about to fix the issues with the test runner. ðŸ˜ƒ Now, I must sleep some. ðŸ’¤"><y>#</y><d>2018-11-26</d><h>00:03</h><r>pez</r>Looks like you are about to fix the issues with the test runner. <b>ðŸ˜ƒ</b> Now, I must sleep some. <b>ðŸ’¤</b></z><z id="t1542985780" t="bozhidar [:attrs {:href &quot;/_/_/users/U0K592YDP&quot;}] The middleware descriptor explains the middleware ops and their return values. We donâ€™t have anything better in terms of documentation currently."><y>#</y><d>2018-11-23</d><h>15:09</h><w>bozhidar</w><a>@marc-omorain</a> The middleware descriptor explains the middleware ops and their return values. We donâ€™t have anything better in terms of documentation currently.</z><z id="t1543154126" t="Marc O&apos;Morain Thanks ðŸ™ "><y>#</y><d>2018-11-25</d><h>13:55</h><r>Marc O'Morain</r>Thanks <b>ðŸ™</b> </z><z id="t1542990203" t="dominicm I might have written documentation"><y>#</y><d>2018-11-23</d><h>16:23</h><w>dominicm</w>I might have written documentation</z><z id="t1542990228" t="dominicm https://github.com/SevereOverfl0w/vim-replant/blob/2df6ec1c583f810456904078d51860872125ea60/docs/CIDER.adoc#test-middleware"><y>#</y><d>2018-11-23</d><h>16:23</h><w>dominicm</w><a href="https://github.com/SevereOverfl0w/vim-replant/blob/2df6ec1c583f810456904078d51860872125ea60/docs/CIDER.adoc#test-middleware" target="_blank">https://github.com/SevereOverfl0w/vim-replant/blob/2df6ec1c583f810456904078d51860872125ea60/docs/CIDER.adoc#test-middleware</a></z><z id="t1543169931" t="Marc O&apos;Morain Thank you ðŸ™ "><y>#</y><d>2018-11-25</d><h>18:18</h><r>Marc O'Morain</r>Thank you <b>ðŸ™</b> </z><z id="t1543171444" t="dominicm Those are a little out of date, now that there&apos;s a new query system"><y>#</y><d>2018-11-25</d><h>18:44</h><r>dominicm</r>Those are a little out of date, now that there&apos;s a new query system</z><z id="t1543170018" t="Marc O&apos;Morain There are no discriminator fields in the nREPL response messages, right? So one has to detect the type of message from the keyset?"><y>#</y><d>2018-11-25</d><h>18:20</h><w>Marc O'Morain</w>There are no discriminator fields in the nREPL response messages, right? So one has to detect the type of message from the keyset?</z><z id="t1543171832" t="dominicm Sometimes. Refresh has the information for example. "><y>#</y><d>2018-11-25</d><h>18:50</h><w>dominicm</w>Sometimes. Refresh has the information for example. </z><z id="t1543171848" t="dominicm Nrepl doesn&apos;t require it, but middleware may provide it"><y>#</y><d>2018-11-25</d><h>18:50</h><w>dominicm</w>Nrepl doesn&apos;t require it, but middleware may provide it</z><z id="t1543327734" t="eraserhd I have the day free and am at the Conj, and will be hacking on â€œrepâ€, a single-shot nREPL client for the command-line, written in Rust. It be cool to pair if anyone finds that interesting."><y>#</y><d>2018-11-27</d><h>14:08</h><w>eraserhd</w>I have the day free and am at the Conj, and will be hacking on â€œrepâ€, a single-shot nREPL client for the command-line, written in Rust.  It be cool to pair if anyone finds that interesting.</z><z id="t1543352033" t="bozhidar [:attrs {:href &quot;/_/_/users/U0ECYL0ET&quot;}] â€œsingle-shotâ€? ðŸ™‚"><y>#</y><d>2018-11-27</d><h>20:53</h><w>bozhidar</w><a>@eraserhd</a> â€œsingle-shotâ€? <b>ðŸ™‚</b></z><z id="t1543352644" t="eraserhd hence no &quot;L&quot;."><y>#</y><d>2018-11-27</d><h>21:04</h><w>eraserhd</w>hence no &quot;L&quot;.</z><z id="t1543352685" t="eraserhd It&apos;s actually for an editor that really wants to be a shell, so it does everything by running little programs. ðŸ˜„"><y>#</y><d>2018-11-27</d><h>21:04</h><w>eraserhd</w>It&apos;s actually for an editor that really wants to be a shell, so it does everything by running little programs. <b>ðŸ˜„</b></z><z id="t1543354947" t="bozhidar Got it! That sounds pretty cool!"><y>#</y><d>2018-11-27</d><h>21:42</h><w>bozhidar</w>Got it! That sounds pretty cool!</z><z id="t1543857821" t="eraserhd So I decided to use Clojure, Graalvm, and the official nrepl client library. Graal is choking on the the use of locking here: https://github.com/nrepl/nrepl/blob/master/src/clojure/nrepl/transport.clj#L102"><y>#</y><d>2018-12-03</d><h>17:23</h><w>eraserhd</w>So I decided to use Clojure, Graalvm, and the official nrepl client library.  Graal is choking on the the use of <code>locking</code> here: <a href="https://github.com/nrepl/nrepl/blob/master/src/clojure/nrepl/transport.clj#L102" target="_blank">https://github.com/nrepl/nrepl/blob/master/src/clojure/nrepl/transport.clj#L102</a></z><z id="t1543857870" t="eraserhd This seems to be an issue with how Clojure generates bytecode, and I&apos;m going to poke that issue, but I was wondering about serializing access with an agent. Is that good, bad, terrible idea?"><y>#</y><d>2018-12-03</d><h>17:24</h><w>eraserhd</w>This seems to be an issue with how Clojure generates bytecode, and I&apos;m going to poke that issue, but I was wondering about serializing access with an agent.  Is that good, bad, terrible idea?</z><z id="t1543910449" t="pez This approach to handle large result chunks seems pretty neat: https://youtu.be/c52QhiXsmyI"><y>#</y><d>2018-12-04</d><h>08:00</h><w>pez</w>This approach to handle large result chunks seems pretty neat: <a href="https://youtu.be/c52QhiXsmyI" target="_blank">https://youtu.be/c52QhiXsmyI</a></z><z id="t1543919670" t="Jakub HolÃ½ (HolyJak) Hi! I want to show a greeting message to the client when connected to my nrepl server but can&apos;t figure out how to use :greeting-fn for that. The transport/tty-greeting is quite simple but does not work with a non-tty transports it seems (my client reports the conn was reset when I try to use it). Any tips? ðŸ™"><y>#</y><d>2018-12-04</d><h>10:34</h><w>Jakub HolÃ½ (HolyJak)</w>Hi! I want to show a greeting message to the client when connected to my nrepl server but can&apos;t figure out how to use <code>:greeting-fn</code> for that. The <code>transport/tty-greeting</code> is quite simple but does not work with a non-tty transports it seems (my client reports the conn was reset when I try to use it). Any tips? <b>ðŸ™</b></z><z id="t1543920945" t="bozhidar [:attrs {:href &quot;/_/_/users/U0522TWDA&quot;}] Generally the clients are supposed to provide the greeting message. TTY is an exception as there if you donâ€™t send something server-side you wonâ€™t even realize youâ€™ve connected."><y>#</y><d>2018-12-04</d><h>10:55</h><w>bozhidar</w><a>@holyjak</a> Generally the clients are supposed to provide the greeting message. TTY is an exception as there if you donâ€™t send something server-side you wonâ€™t even realize youâ€™ve connected.</z><z id="t1543921016" t="bozhidar If you elaborate on what youâ€™re trying to achieve I might be able to give you some alternative idea."><y>#</y><d>2018-12-04</d><h>10:56</h><w>bozhidar</w>If you elaborate on what youâ€™re trying to achieve I might be able to give you some alternative idea.</z><z id="t1543921342" t="bozhidar Btw, Iâ€™m puzzled that the greeting fn approach didnâ€™t work for you - itâ€™s a very generic way of sending some message(s) on connect. This should be just fine regardless of your transport."><y>#</y><d>2018-12-04</d><h>11:02</h><w>bozhidar</w>Btw, Iâ€™m puzzled that the greeting fn approach didnâ€™t work for you - itâ€™s a very generic way of sending some message(s) on connect. This should be just fine regardless of your transport.</z><z id="t1543925025" t="Jakub HolÃ½ (HolyJak) Thanks [:attrs {:href &quot;/_/_/users/U051BLM8F&quot;}] ! I have a legacy java/groovy app and want to start a nrepl server within the app so that I could explore it while it is running. I also want to provide convenience vars, fns to interact with it, namely its Spring App.Context. I want to print a message when I connect from a nrepl client to show what vars / fns there are. As you can see, I have currently #_ -commented it out."><y>#</y><d>2018-12-04</d><h>12:03</h><w>Jakub HolÃ½ (HolyJak)</w>Thanks <a>@bozhidar</a>! I have a legacy java/groovy app and want to start a nrepl server within the app so that I could explore it while it is running. I also want to provide convenience vars, fns to interact with it, namely its Spring App.Context. I want to print a message when I connect from a nrepl client to show what vars / fns there are. As you can see, I have currently <code>#_</code>-commented it out.</z><z id="t1543925226" t="Jakub HolÃ½ (HolyJak) If I start the server like this, from a clj repl: (require &apos;[nrepl.server :as n]) (n/start-server :port 55555 :greeting-fn (fn [t] (send t {:out &quot;Welcome!&quot;}))) and connect to it from Cursive, I get at once in the client: &gt; Connecting to remote nREPL server... &gt; Exception starting REPL: java.net.SocketException: Connection reset"><y>#</y><d>2018-12-04</d><h>12:07</h><r>Jakub HolÃ½ (HolyJak)</r>If I start the server like this, from a <code>clj</code> repl: <code>(require &apos;[nrepl.server :as n]) (n/start-server :port 55555 :greeting-fn (fn [t] (send t {:out &quot;Welcome!&quot;})))</code> and connect to it from Cursive, I get at once in the client:
&gt; Connecting to remote nREPL server...
&gt; Exception starting REPL: java.net.SocketException: Connection reset</z><z id="t1543925480" t="Jakub HolÃ½ (HolyJak) Similarly from the command line: $ clj -R:nrepl -m nrepl.cmdline --connect --host 127.0.0.1 --port 55555 Exception in thread &quot;main&quot; java.net.SocketException: The transport&apos;s socket appears to have lost its connection to the nREPL server at nrepl.transport$bencode$fn__691$fn__692.invoke(transport.clj:92) at nrepl.transport$bencode$fn__691.invoke(transport.clj:92) at nrepl.transport$fn_transport$fn__647.invoke(transport.clj:39) (The :nrepl alias = {:extra-deps {nrepl/nrepl {:mvn/version &quot;0.4.5&quot;}}} ) (Same with nrepl 0.5.0)"><y>#</y><d>2018-12-04</d><h>12:11</h><r>Jakub HolÃ½ (HolyJak)</r>Similarly from the command line: <pre>$ clj -R:nrepl -m nrepl.cmdline --connect --host 127.0.0.1 --port 55555
Exception in thread &quot;main&quot; java.net.SocketException: The transport&apos;s socket appears to have lost its connection to the nREPL server
	at nrepl.transport$bencode$fn__691$fn__692.invoke(transport.clj:92)
	at nrepl.transport$bencode$fn__691.invoke(transport.clj:92)
	at nrepl.transport$fn_transport$fn__647.invoke(transport.clj:39)</pre>
(The <code>:nrepl</code> alias = <code>{:extra-deps {nrepl/nrepl {:mvn/version &quot;0.4.5&quot;}}}</code>) (Same with nrepl 0.5.0)</z><z id="t1543936399" t="Jakub HolÃ½ (HolyJak) could it be a bug?"><y>#</y><d>2018-12-04</d><h>15:13</h><r>Jakub HolÃ½ (HolyJak)</r>could it be a bug?</z><z id="t1543996652" t="Jakub HolÃ½ (HolyJak) Sorry to bother [:attrs {:href &quot;/_/_/users/U051BLM8F&quot;}] , have you found out something? Thank you!!!"><y>#</y><d>2018-12-05</d><h>07:57</h><r>Jakub HolÃ½ (HolyJak)</r>Sorry to bother <a>@bozhidar</a>, have you found out something? Thank you!!!</z><z id="t1543925203" t="bozhidar Whatâ€™s the client youâ€™re using? And what is the exact error youâ€™re getting?"><y>#</y><d>2018-12-04</d><h>12:06</h><w>bozhidar</w>Whatâ€™s the client youâ€™re using? And what is the exact error youâ€™re getting?</z><z id="t1543925251" t="Jakub HolÃ½ (HolyJak) see the thread above https://clojurians.slack.com/archives/C17JYSA3H/p1543925226011000?thread_ts=1543925025.010300&amp;amp;cid=C17JYSA3H"><y>#</y><d>2018-12-04</d><h>12:07</h><r>Jakub HolÃ½ (HolyJak)</r>see the thread above <a href="https://clojurians.slack.com/archives/C17JYSA3H/p1543925226011000?thread_ts=1543925025.010300&amp;amp;cid=C17JYSA3H" target="_blank">https://clojurians.slack.com/archives/C17JYSA3H/p1543925226011000?thread_ts=1543925025.010300&amp;amp;cid=C17JYSA3H</a></z><z id="t1543935283" t="bozhidar Please, meet our newest maintainer of nREPL - the one and only [:attrs {:href &quot;/_/_/users/U3E46Q1DG&quot;}] ! :man-bowing: Time to make nREPL as awesome as unREPL. ðŸ˜‰"><y>#</y><d>2018-12-04</d><h>14:54</h><w>bozhidar</w>Please, meet our newest maintainer of nREPL - the one and only <a>@cgrand</a>! <b>:man-bowing:</b> Time to make nREPL as awesome as unREPL. <b>ðŸ˜‰</b></z><z id="t1543935349" t="cgrand Letâ€™s make nrepl great again (oh this joke is getting old)"><y>#</y><d>2018-12-04</d><h>14:55</h><w>cgrand</w>Letâ€™s make nrepl great again (oh this joke is getting old)</z><z id="t1543937056" t="pez MNGA! I like it."><y>#</y><d>2018-12-04</d><h>15:24</h><w>pez</w>MNGA! I like it.</z><z id="t1543953325" t="dchelimsky Hi! I&apos;ve got {:repl {:dependencies [[nrepl/nrepl &quot;0.5.1&quot;]] :plugins [[cider/cider-nrepl &quot;0.18.0&quot;]]}} in ~/.lein/profiles.clj, but when I cider-jack-in I&apos;m still getting nREPL 0.2.12. What might I be missing?"><y>#</y><d>2018-12-04</d><h>19:55</h><w>dchelimsky</w>Hi! I&apos;ve got <pre>{:repl {:dependencies [[nrepl/nrepl &quot;0.5.1&quot;]]
        :plugins      [[cider/cider-nrepl &quot;0.18.0&quot;]]}}</pre> in ~/.lein/profiles.clj, but when I <code>cider-jack-in</code> I&apos;m still getting nREPL 0.2.12. What might I be missing?</z><z id="t1543953755" t="dominicm [:attrs {:href &quot;/_/_/users/U0ENYLGTA&quot;}] I don&apos;t know that cider attempts to use nrepl/nrepl with leiningen, it defers to leiningen. I&apos;m not sure if lein-nrepl ( https://github.com/nrepl/lein-nrepl ) can be configured to work."><y>#</y><d>2018-12-04</d><h>20:02</h><w>dominicm</w><a>@dchelimsky</a> I don&apos;t know that cider attempts to use nrepl/nrepl with leiningen, it defers to leiningen. I&apos;m not sure if <code>lein-nrepl</code> (<a href="https://github.com/nrepl/lein-nrepl" target="_blank">https://github.com/nrepl/lein-nrepl</a>) can be configured to work.</z><z id="t1543953789" t="dominicm https://github.com/nrepl/lein-nrepl#using-with-cider (setq cider-inject-dependencies-at-jack-in nil) (setq lein-parameters &quot;nrepl&quot;) Apparently ðŸ™‚"><y>#</y><d>2018-12-04</d><h>20:03</h><w>dominicm</w><a href="https://github.com/nrepl/lein-nrepl#using-with-cider" target="_blank">https://github.com/nrepl/lein-nrepl#using-with-cider</a>

<pre>(setq cider-inject-dependencies-at-jack-in nil)
(setq lein-parameters &quot;nrepl&quot;)
</pre>

Apparently <b>ðŸ™‚</b></z><z id="t1543954157" t="dchelimsky Thanks for the help [:attrs {:href &quot;/_/_/users/U09LZR36F&quot;}] . Unfortunately, I now have :repl {:dependencies [[nrepl/nrepl &quot;0.5.1&quot;]] :plugins [[cider/cider-nrepl &quot;0.18.0&quot;] [nrepl/lein-nrepl &quot;0.3.1&quot; :exclusions [org.clojure/clojure nrepl commons-io commons-codec]]]} in profiles.clj and (setq cider-inject-dependencies-at-jack-in nil) (setq lein-parameters &quot;nrepl&quot;) in init.el and I still get nREPL 0.2.12"><y>#</y><d>2018-12-04</d><h>20:09</h><w>dchelimsky</w>Thanks for the help <a>@dominicm</a>. Unfortunately, I now have <pre>:repl {:dependencies [[nrepl/nrepl &quot;0.5.1&quot;]]
        :plugins      [[cider/cider-nrepl &quot;0.18.0&quot;]
                       [nrepl/lein-nrepl &quot;0.3.1&quot;
                        :exclusions [org.clojure/clojure
                                     nrepl
                                     commons-io
                                     commons-codec]]]}</pre> in profiles.clj and <pre>(setq cider-inject-dependencies-at-jack-in nil)
(setq lein-parameters &quot;nrepl&quot;)</pre> in init.el and I still get nREPL 0.2.12</z><z id="t1543954467" t="dominicm [:attrs {:href &quot;/_/_/users/U0ENYLGTA&quot;}] When jack-in runs, can you see whether it runs lein repl or lein nrepl ?"><y>#</y><d>2018-12-04</d><h>20:14</h><w>dominicm</w><a>@dchelimsky</a> When jack-in runs, can you see whether it runs <code>lein repl</code> or <code>lein nrepl</code>?</z><z id="t1543954525" t="dchelimsky repl"><y>#</y><d>2018-12-04</d><h>20:15</h><w>dchelimsky</w>repl</z><z id="t1543954540" t="dchelimsky Which suggests that (setq lein-parameters &quot;nrepl&quot;) isn&apos;t being read"><y>#</y><d>2018-12-04</d><h>20:15</h><w>dchelimsky</w>Which suggests that <code>(setq lein-parameters &quot;nrepl&quot;)</code> isn&apos;t being read</z><z id="t1543954608" t="dominicm I&apos;m not an emacs/cider user, so I&apos;m not much help here I&apos;m afraid. M-x customize-var might be able to tell you the proper variable name though."><y>#</y><d>2018-12-04</d><h>20:16</h><w>dominicm</w>I&apos;m not an emacs/cider user, so I&apos;m not much help here I&apos;m afraid. <code>M-x customize-var</code> might be able to tell you the proper variable name though.</z><z id="t1543954621" t="dchelimsky Just trying that"><y>#</y><d>2018-12-04</d><h>20:17</h><w>dchelimsky</w>Just trying that</z><z id="t1543954662" t="dchelimsky Oh, weird. Now I get &quot;&apos;nrepl&apos; is not a task&quot;. Progress!"><y>#</y><d>2018-12-04</d><h>20:17</h><w>dchelimsky</w>Oh, weird. Now I get &quot;&apos;nrepl&apos; is not a task&quot;. Progress!</z><z id="t1543954854" t="dominicm [:attrs {:href &quot;/_/_/users/U0ENYLGTA&quot;}] I think your problem is that you&apos;ve put the lein-nrepl plugin inside of the :repl profile. Maybe it should be the :user profile? I guess :repl is only loaded for lein repl ?"><y>#</y><d>2018-12-04</d><h>20:20</h><w>dominicm</w><a>@dchelimsky</a> I think your problem is that you&apos;ve put the <code>lein-nrepl</code> plugin inside of the <code>:repl</code> profile. Maybe it should be the <code>:user</code> profile? I guess <code>:repl</code> is only loaded for <code>lein repl</code>?</z><z id="t1543955328" t="dchelimsky Yes, that makes sense. Now, of course, I&apos;m getting dependency conflicts that are apparently not-resolvable. :pedantic? :abort is telling me to exclude something but when I exclude it I still get the same message."><y>#</y><d>2018-12-04</d><h>20:28</h><w>dchelimsky</w>Yes, that makes sense. Now, of course, I&apos;m getting dependency conflicts that are apparently not-resolvable. <code>:pedantic? :abort</code> is telling me to exclude something but when I exclude it I still get the same message.</z><z id="t1543955410" t="dominicm [:attrs {:href &quot;/_/_/users/U0ENYLGTA&quot;}] Exclusions added to plugins are ignored. It&apos;s an counter-intuitive quirk of leiningen. The trick is to add a dependency on lein-nrepl with the exclusions, as well as having the :plugins for it."><y>#</y><d>2018-12-04</d><h>20:30</h><w>dominicm</w><a>@dchelimsky</a> Exclusions added to plugins are ignored. It&apos;s an counter-intuitive quirk of leiningen. The trick is to add a dependency on <code>lein-nrepl</code> with the exclusions, as well as having the <code>:plugins</code> for it.</z><z id="t1543955523" t="dchelimsky &quot;as well as having the :plugins for it.&quot; meaning also include lein-nrepl in plugins, but without the exclusions?"><y>#</y><d>2018-12-04</d><h>20:32</h><w>dchelimsky</w>&quot;as well as having the <code>:plugins</code> for it.&quot; meaning also include lein-nrepl in plugins, but without the exclusions?</z><z id="t1543955628" t="dominicm [:attrs {:href &quot;/_/_/users/U0ENYLGTA&quot;}] correct ðŸ™‚"><y>#</y><d>2018-12-04</d><h>20:33</h><w>dominicm</w><a>@dchelimsky</a> correct <b>ðŸ™‚</b></z><z id="t1543956122" t="dchelimsky I still get the messages if I leave out the exclusions from :plugins"><y>#</y><d>2018-12-04</d><h>20:42</h><w>dchelimsky</w>I still get the messages if I leave out the exclusions from  <code>:plugins</code></z><z id="t1543956152" t="dominicm [:attrs {:href &quot;/_/_/users/U0ENYLGTA&quot;}] did you move them to :dependencies ?"><y>#</y><d>2018-12-04</d><h>20:42</h><w>dominicm</w><a>@dchelimsky</a> did you move them to <code>:dependencies</code>?</z><z id="t1543956194" t="dchelimsky :user {:dependencies [[nrepl/nrepl &quot;0.5.1&quot;] [nrepl/lein-nrepl &quot;0.3.1&quot; :exclusions [org.clojure/clojure nrepl commons-io commons-codec]]] :plugins [[cider/cider-nrepl &quot;0.18.0&quot;] [nrepl/lein-nrepl &quot;0.3.1&quot; :exclusions [org.clojure/clojure nrepl commons-io commons-codec]]]"><y>#</y><d>2018-12-04</d><h>20:43</h><w>dchelimsky</w><pre>:user {:dependencies [[nrepl/nrepl &quot;0.5.1&quot;]
                       [nrepl/lein-nrepl &quot;0.3.1&quot;
                        :exclusions [org.clojure/clojure
                                     nrepl
                                     commons-io
                                     commons-codec]]]
        :plugins      [[cider/cider-nrepl &quot;0.18.0&quot;]
                       [nrepl/lein-nrepl &quot;0.3.1&quot;
                        :exclusions [org.clojure/clojure
                                     nrepl
                                     commons-io
                                     commons-codec]]]</pre></z><z id="t1543956211" t="dchelimsky without the exclusions in :plugins I get all the warning messages"><y>#</y><d>2018-12-04</d><h>20:43</h><w>dchelimsky</w>without the exclusions in <code>:plugins</code> I get all the warning messages</z><z id="t1543956226" t="dominicm oh, I&apos;d thought that would work ðŸ˜ž I&apos;m not sure then, sorry. I know this is a weird thing that happens with plugins because of the trampoline system."><y>#</y><d>2018-12-04</d><h>20:43</h><w>dominicm</w>oh, I&apos;d thought that would work <b>ðŸ˜ž</b> I&apos;m not sure then, sorry. I know this is a weird thing that happens with plugins because of the trampoline system.</z><z id="t1543956283" t="dchelimsky It gets even weirder, because now I also need to exclude clojure-complete , but I&apos;m not requiring that anywhere and it&apos;s showing up at the top of lein deps :tree , meaning something, somewhere is injecting it ðŸ˜•"><y>#</y><d>2018-12-04</d><h>20:44</h><w>dchelimsky</w>It gets even weirder, because now I also need to exclude <code>clojure-complete</code>, but I&apos;m not requiring that anywhere and it&apos;s showing up at the top of <code>lein deps :tree</code>, meaning something, somewhere is injecting it <b>ðŸ˜•</b></z><z id="t1543956306" t="dchelimsky And if I exclude it, I get compilation errors! Yay!"><y>#</y><d>2018-12-04</d><h>20:45</h><w>dchelimsky</w>And if I exclude it, I get compilation errors! Yay!</z><z id="t1543956337" t="dchelimsky Thanks for trying to help [:attrs {:href &quot;/_/_/users/U09LZR36F&quot;}] . I appreciate it."><y>#</y><d>2018-12-04</d><h>20:45</h><w>dchelimsky</w>Thanks for trying to help <a>@dominicm</a>. I appreciate it.</z><z id="t1543956445" t="dominicm Thank you for your talk on AWS ðŸ™‚ I&apos;m excited to see what I can do with the aws libs! (although true input streams will be very useful for me!)"><y>#</y><d>2018-12-04</d><h>20:47</h><w>dominicm</w>Thank you for your talk on AWS <b>ðŸ™‚</b> I&apos;m excited to see what I can do with the aws libs! (although true input streams will be very useful for me!)</z><z id="t1543956632" t="dchelimsky [:attrs {:href &quot;/_/_/users/U09LZR36F&quot;}] feel free to comment on https://github.com/cognitect-labs/aws-api/issues/14"><y>#</y><d>2018-12-04</d><h>20:50</h><w>dchelimsky</w><a>@dominicm</a> feel free to comment on <a href="https://github.com/cognitect-labs/aws-api/issues/14" target="_blank">https://github.com/cognitect-labs/aws-api/issues/14</a></z><z id="t1543956664" t="dominicm You&apos;re already ahead of me then! ðŸ˜„ I will add my ðŸ‘ (assuming this is the equivalent of a JIRA vote)"><y>#</y><d>2018-12-04</d><h>20:51</h><w>dominicm</w>You&apos;re already ahead of me then! <b>ðŸ˜„</b> I will add my <b>ðŸ‘</b> (assuming this is the equivalent of a JIRA vote)</z><z id="t1543956735" t="dchelimsky Not equivalent of a JIRA vote, but it makes me feel good ðŸ™‚"><y>#</y><d>2018-12-04</d><h>20:52</h><w>dchelimsky</w>Not equivalent of a JIRA vote, but it makes me feel good <b>ðŸ™‚</b></z><z id="t1543956766" t="dchelimsky Might end up being equivalent. We just haven&apos;t discussed it internally."><y>#</y><d>2018-12-04</d><h>20:52</h><w>dchelimsky</w>Might end up being equivalent. We just haven&apos;t discussed it internally.</z><z id="t1544009202" t="bozhidar [:attrs {:href &quot;/_/_/users/U0ENYLGTA&quot;}] All of this is super odd as for me lein nrepl works just fine without any need for additional setup. ðŸ™‚"><y>#</y><d>2018-12-05</d><h>11:26</h><w>bozhidar</w><a>@dchelimsky</a> All of this is super odd as for me <code>lein nrepl</code> works just fine without any need for additional setup. <b>ðŸ™‚</b></z><z id="t1544009228" t="bozhidar Might be easier for you to simply build lein from master , as there its already using the latest nREPL."><y>#</y><d>2018-12-05</d><h>11:27</h><w>bozhidar</w>Might be easier for you to simply build <code>lein</code> from <code>master</code>, as there its already using the latest nREPL.</z><z id="t1544009254" t="bozhidar (Phil told me recently the lein is feature complete at this point and the next stable release will happen in a week or two)"><y>#</y><d>2018-12-05</d><h>11:27</h><w>bozhidar</w>(Phil told me recently the <code>lein</code> is feature complete at this point and the next stable release will happen in a week or two)</z><z id="t1544009636" t="bozhidar Btw, as the plugin depends only on nREPL Iâ€™m puzzled that you ran into any issues with pedantic. Was this due to tools.logging ? I removed it in 0.5.1, but I havenâ€™t updated the plugin for it."><y>#</y><d>2018-12-05</d><h>11:33</h><w>bozhidar</w>Btw, as the plugin depends only on nREPL Iâ€™m puzzled that you ran into any issues with pedantic. Was this due to <code>tools.logging</code>? I removed it in 0.5.1, but I havenâ€™t updated the plugin for it.</z><z id="t1544015552" t="dchelimsky [:attrs {:href &quot;/_/_/users/U051BLM8F&quot;}] with a fresh install of prelude, modified only by enabling prelude-clojure, cider installed via package-list-packages, and no deps or plugins defined in ~/.lein/profiles.clj, cider-jack-in in a freshly generated lein new foo gets me &quot;CIDER 0.18.0 (Saigon), nREPL 0.2.12&quot;, as expected. Now what should be the minimum I need to add/change/set to use nrepl 0.5.1?"><y>#</y><d>2018-12-05</d><h>13:12</h><w>dchelimsky</w><a>@bozhidar</a> with a fresh install of prelude, modified only by enabling prelude-clojure, cider installed via package-list-packages, and no deps or plugins defined in ~/.lein/profiles.clj, <code>cider-jack-in</code> in a freshly generated <code>lein new foo</code> gets me &quot;CIDER 0.18.0 (Saigon), nREPL 0.2.12&quot;, as expected. Now what should be the minimum I need to add/change/set to use nrepl 0.5.1?</z><z id="t1544017275" t="dchelimsky The pedantic issues are plentiful, btw. Even now, in the state described above, if I add :pedantic? :abort I get error in process sentinel: Could not start nREPL server: Possibly confusing dependencies found: [s3-wagon-private &quot;1.3.1&quot;] -&gt; [com.amazonaws/aws-java-sdk-s3 &quot;1.11.184&quot; :exclusions [com.fasterxml.jackson.core/jackson-core c\ om.fasterxml.jackson.core/jackson-databind]] -&gt; [com.amazonaws/aws-java-sdk-core &quot;1.11.184&quot;] -&gt; [commons-logging &quot;1.1.3&quot;] overrides [s3-wagon-private &quot;1.3.1&quot;] -&gt; [com.amazonaws/aws-java-sdk-s3 &quot;1.11.184&quot; :exclusions [com.fasterxml.jackson.core/jackson-core c\ om.fasterxml.jackson.core/jackson-databind]] -&gt; [com.amazonaws/aws-java-sdk-kms &quot;1.11.184&quot;] -&gt; [com.amazonaws/aws-java-sdk-cor\ e &quot;1.11.184&quot;] -&gt; [org.apache.httpcomponents/httpclient &quot;4.5.2&quot;] -&gt; [commons-logging &quot;1.2&quot;] and [s3-wagon-private &quot;1.3.1&quot;] -&gt; [com.amazonaws/aws-java-sdk-s3 &quot;1.11.184&quot; :exclusions [com.fasterxml.jackson.core/jackson-core c\ om.fasterxml.jackson.core/jackson-databind]] -&gt; [com.amazonaws/aws-java-sdk-core &quot;1.11.184&quot;] -&gt; [org.apache.httpcomponents/htt\ pclient &quot;4.5.2&quot;] -&gt; [commons-logging &quot;1.2&quot;] Consider using these exclusions: [s3-wagon-private &quot;1.3.1&quot; :exclusions [commons-logging]] Aborting due to :pedantic? :abort "><y>#</y><d>2018-12-05</d><h>13:41</h><w>dchelimsky</w>The pedantic issues are plentiful, btw. Even now, in the state described above, if I add <code>:pedantic? :abort</code> I get <pre>error in process sentinel: Could not start nREPL server: Possibly confusing dependencies found:
[s3-wagon-private &quot;1.3.1&quot;] -&gt; [com.amazonaws/aws-java-sdk-s3 &quot;1.11.184&quot; :exclusions [com.fasterxml.jackson.core/jackson-core c\
om.fasterxml.jackson.core/jackson-databind]] -&gt; [com.amazonaws/aws-java-sdk-core &quot;1.11.184&quot;] -&gt; [commons-logging &quot;1.1.3&quot;]
 overrides
[s3-wagon-private &quot;1.3.1&quot;] -&gt; [com.amazonaws/aws-java-sdk-s3 &quot;1.11.184&quot; :exclusions [com.fasterxml.jackson.core/jackson-core c\
om.fasterxml.jackson.core/jackson-databind]] -&gt; [com.amazonaws/aws-java-sdk-kms &quot;1.11.184&quot;] -&gt; [com.amazonaws/aws-java-sdk-cor\
e &quot;1.11.184&quot;] -&gt; [org.apache.httpcomponents/httpclient &quot;4.5.2&quot;] -&gt; [commons-logging &quot;1.2&quot;]
 and
[s3-wagon-private &quot;1.3.1&quot;] -&gt; [com.amazonaws/aws-java-sdk-s3 &quot;1.11.184&quot; :exclusions [com.fasterxml.jackson.core/jackson-core c\
om.fasterxml.jackson.core/jackson-databind]] -&gt; [com.amazonaws/aws-java-sdk-core &quot;1.11.184&quot;] -&gt; [org.apache.httpcomponents/htt\
pclient &quot;4.5.2&quot;] -&gt; [commons-logging &quot;1.2&quot;]

Consider using these exclusions:
[s3-wagon-private &quot;1.3.1&quot; :exclusions [commons-logging]]

Aborting due to :pedantic? :abort
</pre></z><z id="t1544017332" t="dchelimsky So then I add recommended exclusions and get Possibly confusing dependencies found: [org.clojure/tools.nrepl &quot;0.2.13&quot; :exclusions [org.clojure/clojure]] overrides [org.clojure/tools.nrepl &quot;0.2.12&quot; :exclusions [org.clojure/clojure]] Consider using these exclusions: Aborting due to :pedantic? :abort"><y>#</y><d>2018-12-05</d><h>13:42</h><w>dchelimsky</w>So then I add recommended exclusions and get <pre>Possibly confusing dependencies found:
[org.clojure/tools.nrepl &quot;0.2.13&quot; :exclusions [org.clojure/clojure]]
 overrides
[org.clojure/tools.nrepl &quot;0.2.12&quot; :exclusions [org.clojure/clojure]]

Consider using these exclusions:


Aborting due to :pedantic? :abort</pre></z><z id="t1544017575" t="dchelimsky Same deal if I just get rid of the s3-wagon-private plugin entirely."><y>#</y><d>2018-12-05</d><h>13:46</h><w>dchelimsky</w>Same deal if I just get rid of the s3-wagon-private plugin entirely.</z><z id="t1544027449" t="dominicm The tools nrepl thing might be a conflict with the internal Leiningen one. You may need an explicit dependency. "><y>#</y><d>2018-12-05</d><h>16:30</h><w>dominicm</w>The tools nrepl thing might be a conflict with the internal Leiningen one. You may need an explicit dependency. </z><z id="t1544027652" t="dominicm https://cider.readthedocs.io/en/latest/caveats/#injecting-dependencies-and-leiningen-pedantic-abort-mode"><y>#</y><d>2018-12-05</d><h>16:34</h><w>dominicm</w><a href="https://cider.readthedocs.io/en/latest/caveats/#injecting-dependencies-and-leiningen-pedantic-abort-mode" target="_blank">https://cider.readthedocs.io/en/latest/caveats/#injecting-dependencies-and-leiningen-pedantic-abort-mode</a></z><z id="t1544028454" t="bozhidar &gt; Now what should be the minimum I need to add/change/set to use nrepl 0.5.1?"><y>#</y><d>2018-12-05</d><h>16:47</h><w>bozhidar</w>&gt; Now what should be the minimum I need to add/change/set to use nrepl 0.5.1?</z><z id="t1544028467" t="bozhidar [:attrs {:href &quot;/_/_/users/U0ENYLGTA&quot;}] Youâ€™re on Lein 2.8.1, right?"><y>#</y><d>2018-12-05</d><h>16:47</h><w>bozhidar</w><a>@dchelimsky</a> Youâ€™re on Lein 2.8.1, right?</z><z id="t1544028484" t="dchelimsky [:attrs {:href &quot;/_/_/users/U051BLM8F&quot;}] yes"><y>#</y><d>2018-12-05</d><h>16:48</h><w>dchelimsky</w><a>@bozhidar</a> yes</z><z id="t1544028496" t="bozhidar If so - the simplest thing to do is to install the lein snapshot for 2.8.2 and everything will be great."><y>#</y><d>2018-12-05</d><h>16:48</h><w>bozhidar</w>If so - the simplest thing to do is to install the lein snapshot for 2.8.2 and everything will be great.</z><z id="t1544028524" t="dchelimsky I&apos;ll give it a shot"><y>#</y><d>2018-12-05</d><h>16:48</h><w>dchelimsky</w>I&apos;ll give it a shot</z><z id="t1544028544" t="bozhidar As the artefact coordinates changed thereâ€™s no easy way to override the nREPL dep in 2.8.1, thatâ€™s why I created the separate lein-nrepl plugin as a stop gap measure."><y>#</y><d>2018-12-05</d><h>16:49</h><w>bozhidar</w>As the artefact coordinates changed thereâ€™s no easy way to override the nREPL dep in 2.8.1, thatâ€™s why I created the separate <code>lein-nrepl</code> plugin as a stop gap measure.</z><z id="t1544028563" t="bozhidar I never used it with jack-in, though - Iâ€™d run lein nrepl and then cider-connect to it."><y>#</y><d>2018-12-05</d><h>16:49</h><w>bozhidar</w>I never used it with jack-in, though - Iâ€™d run <code>lein nrepl</code> and then <code>cider-connect</code> to it.</z><z id="t1544028716" t="bozhidar As for the nREpl conflicts you got - I guess youâ€™ve got some dependency to 0.2.13 somewhere (lein 2.8.1 uses 0.2.12), but I canâ€™t guess which one. All recent CIDER related libs depend on the â€œnewâ€ nREPL, not on tools.nrepl , so it canâ€™t be coming from them. At least it shouldnâ€™t be. ðŸ™‚"><y>#</y><d>2018-12-05</d><h>16:51</h><w>bozhidar</w>As for the nREpl conflicts you got - I guess youâ€™ve got some dependency to 0.2.13 somewhere (lein 2.8.1 uses 0.2.12), but I canâ€™t guess which one. All recent CIDER related libs depend on the â€œnewâ€ nREPL, not on <code>tools.nrepl</code>, so it canâ€™t be coming from them. At least it shouldnâ€™t be. <b>ðŸ™‚</b></z><z id="t1544030313" t="dchelimsky One thing after another. I just grabbed https://github.com/technomancy/leiningen/blob/master/bin/lein and get this executing it: $ lein Downloading Leiningen to /Users/david/.lein/self-installs/leiningen-2.8.2-SNAPSHOT-standalone.jar now... % Total % Received % Xferd Average Speed Time Time Time Current Dload Upload Total Spent Left Speed 0 0 0 0 0 0 0 0 --:--:-- --:--:-- --:--:-- 0 curl: (22) The requested URL returned error: 404 Not Found Failed to download (exit code 22) It&apos;s possible your HTTP client&apos;s certificate store does not have the correct certificate authority needed. This is often caused by an out-of-date version of libssl. It&apos;s also possible that you&apos;re behind a firewall and haven&apos;t set HTTP_PROXY and HTTPS_PROXY."><y>#</y><d>2018-12-05</d><h>17:18</h><w>dchelimsky</w>One thing after another. I just grabbed <a href="https://github.com/technomancy/leiningen/blob/master/bin/lein" target="_blank">https://github.com/technomancy/leiningen/blob/master/bin/lein</a> and get this executing it: <pre>$ lein
Downloading Leiningen to /Users/david/.lein/self-installs/leiningen-2.8.2-SNAPSHOT-standalone.jar now...
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0
curl: (22) The requested URL returned error: 404 Not Found
Failed to download  (exit code 22)
It&apos;s possible your HTTP client&apos;s certificate store does not have the
correct certificate authority needed. This is often caused by an
out-of-date version of libssl. It&apos;s also possible that you&apos;re behind a
firewall and haven&apos;t set HTTP_PROXY and HTTPS_PROXY.</pre></z><z id="t1544030332" t="dchelimsky And I can&apos;t seem to build an uberjar locally."><y>#</y><d>2018-12-05</d><h>17:18</h><w>dchelimsky</w>And I can&apos;t seem to build an uberjar locally.</z><z id="t1544030361" t="dchelimsky Any idea when 2.8.2 is expected out?"><y>#</y><d>2018-12-05</d><h>17:19</h><w>dchelimsky</w>Any idea when 2.8.2 is expected out?</z><z id="t1544051448" t="bozhidar &gt; Any idea when 2.8.2 is expected out?"><y>#</y><d>2018-12-05</d><h>23:10</h><w>bozhidar</w>&gt; Any idea when 2.8.2 is expected out?</z><z id="t1544051452" t="bozhidar Most likely next week."><y>#</y><d>2018-12-05</d><h>23:10</h><w>bozhidar</w>Most likely next week.</z><z id="t1544111243" t="cgrand Anyone knows which 3rd party middleware uses :printed-value in responses?"><y>#</y><d>2018-12-06</d><h>15:47</h><w>cgrand</w>Anyone knows which 3rd party middleware uses <code>:printed-value</code> in responses?</z><z id="t1544118579" t="bozhidar [:attrs {:href &quot;/_/_/users/U3E46Q1DG&quot;}] None. ðŸ™‚"><y>#</y><d>2018-12-06</d><h>17:49</h><w>bozhidar</w><a>@cgrand</a> None. <b>ðŸ™‚</b></z><z id="t1544118606" t="bozhidar I think thatâ€™s something that we can safely remove or reuse in a different fashion."><y>#</y><d>2018-12-06</d><h>17:50</h><w>bozhidar</w>I think thatâ€™s something that we can safely remove or reuse in a different fashion.</z><z id="t1544118716" t="bozhidar I checked all the middlewares that I know and none of them uses it. Likely there was an idea that someone would use it, but this never quite happened."><y>#</y><d>2018-12-06</d><h>17:51</h><w>bozhidar</w>I checked all the middlewares that I know and none of them uses it. Likely there was an idea that someone would use it, but this never quite happened.</z><z id="t1544214958" t="cgrand Is it normal that tests fail non deterministically?"><y>#</y><d>2018-12-07</d><h>20:35</h><w>cgrand</w>Is it normal that tests fail non deterministically?</z><z id="t1544214997" t="cgrand In other news the elision branch is happily printing. "><y>#</y><d>2018-12-07</d><h>20:36</h><w>cgrand</w>In other news the elision branch is happily printing. </z><z id="t1544228951" t="dominicm I think so"><y>#</y><d>2018-12-08</d><h>00:29</h><w>dominicm</w>I think so</z><z id="t1544228966" t="dominicm Ask again? "><y>#</y><d>2018-12-08</d><h>00:29</h><w>dominicm</w>Ask again? </z><z id="t1544253219" t="cgrand [:attrs {:href &quot;/_/_/users/U09LZR36F&quot;}] as I was running tests on the elisions branch, I get between 1 to 3 failures from run to run. "><y>#</y><d>2018-12-08</d><h>07:13</h><w>cgrand</w><a>@dominicm</a> as I was running tests on the elisions branch, I get between 1 to 3 failures from run to run. </z><z id="t1544254800" t="dominicm [:attrs {:href &quot;/_/_/users/U3E46Q1DG&quot;}] same tests? Different ones? "><y>#</y><d>2018-12-08</d><h>07:40</h><w>dominicm</w><a>@cgrand</a> same tests? Different ones? </z><z id="t1544254923" t="dominicm https://github.com/liquidz/iced-nrepl"><y>#</y><d>2018-12-08</d><h>07:42</h><w>dominicm</w><a href="https://github.com/liquidz/iced-nrepl" target="_blank">https://github.com/liquidz/iced-nrepl</a></z><z id="t1544262518" t="cgrand Just the ones in the main nrepl/nrepl repo"><y>#</y><d>2018-12-08</d><h>09:48</h><w>cgrand</w>Just the ones in the main nrepl/nrepl repo</z><z id="t1544266783" t="bozhidar [:attrs {:href &quot;/_/_/users/U3E46Q1DG&quot;}] Yeah, there are a couple of tests that fail sometimes. Usually only locally, but not on the CI."><y>#</y><d>2018-12-08</d><h>10:59</h><w>bozhidar</w><a>@cgrand</a> Yeah, there are a couple of tests that fail sometimes. Usually only locally, but not on the CI.</z><z id="t1544266806" t="bozhidar Havenâ€™t had time to debug them properly."><y>#</y><d>2018-12-08</d><h>11:00</h><w>bozhidar</w>Havenâ€™t had time to debug them properly.</z><z id="t1544266975" t="bozhidar &gt; In other news the elision branch is happily printing."><y>#</y><d>2018-12-08</d><h>11:02</h><w>bozhidar</w>&gt; In other news the elision branch is happily printing.</z><z id="t1544266989" t="bozhidar Fantastic news! partywombat"><y>#</y><d>2018-12-08</d><h>11:03</h><w>bozhidar</w>Fantastic news! <b>partywombat</b></z><z id="t1544272974" t="dominicm A bit of a side note: can the injection be designed to allow specifying a side loaded transport? I&apos;m sure it would have anyway, but raising it as an explicit thing. "><y>#</y><d>2018-12-08</d><h>12:42</h><w>dominicm</w>A bit of a side note: can the injection be designed to allow specifying a side loaded transport? I&apos;m sure it would have anyway, but raising it as an explicit thing. </z><z id="t1544304158" t="bozhidar Thereâ€™s nothing special about transports - I assume weâ€™d be side-loading them just as any other library."><y>#</y><d>2018-12-08</d><h>21:22</h><w>bozhidar</w>Thereâ€™s nothing special about transports - I assume weâ€™d be side-loading them just as any other library.</z><z id="t1544306443" t="dominicm Depends how early the side loader is available"><y>#</y><d>2018-12-08</d><h>22:00</h><w>dominicm</w>Depends how early the side loader is available</z><z id="t1544440376" t="cgrand You can inject any transport as long as itâ€™s based on a stream of characters"><y>#</y><d>2018-12-10</d><h>11:12</h><w>cgrand</w>You can inject any transport as long as itâ€™s based on a stream of characters</z><z id="t1544440442" t="cgrand so drawbridge is out (whatâ€™s the point of injecting a HTTP transport over an SSH tunneled socket repl)"><y>#</y><d>2018-12-10</d><h>11:14</h><w>cgrand</w>so drawbridge is out (whatâ€™s the point of injecting a HTTP transport over an SSH tunneled socket repl)</z><z id="t1544440520" t="cgrand binary transports are out too (ok maybe with a good amount of reflection it may be worked out)"><y>#</y><d>2018-12-10</d><h>11:15</h><w>cgrand</w>binary transports are out too (ok maybe with a good amount of reflection it may be worked out)</z><z id="t1544456750" t="cgrand Is *msg* dead code or something used for debug?"><y>#</y><d>2018-12-10</d><h>15:45</h><w>cgrand</w>Is <code>*msg*</code> dead code or something used for debug?</z><z id="t1544460020" t="bozhidar [:attrs {:href &quot;/_/_/users/U3E46Q1DG&quot;}] I think without it being bound responses donâ€™t have ids."><y>#</y><d>2018-12-10</d><h>16:40</h><w>bozhidar</w><a>@cgrand</a> I think without it being bound responses donâ€™t have ids.</z><z id="t1544460066" t="bozhidar What lead you to believe it might be dead code?"><y>#</y><d>2018-12-10</d><h>16:41</h><w>bozhidar</w>What lead you to believe it might be dead code?</z><z id="t1544460161" t="cgrand I didnâ€™t look into session for it ðŸ˜• (I really thought I did search the whole codebase)"><y>#</y><d>2018-12-10</d><h>16:42</h><w>cgrand</w>I didnâ€™t look into session for it <b>ðŸ˜•</b> (I really thought I did search the whole codebase)</z><z id="t1544460234" t="cgrand now I feel less bad about creating a circular dep between session and interruptible-eval"><y>#</y><d>2018-12-10</d><h>16:43</h><w>cgrand</w>now I feel less bad about creating a circular dep between session and interruptible-eval</z><z id="t1544460497" t="cgrand So thread management should move to session (where clone and close are handled)"><y>#</y><d>2018-12-10</d><h>16:48</h><w>cgrand</w>So thread management should move to session (where <code>clone</code> and <code>close</code> are handled)</z><z id="t1544468559" t="bozhidar As *msg* is just an implementation detail perhaps you can also find a different way to track the active message."><y>#</y><d>2018-12-10</d><h>19:02</h><w>bozhidar</w>As <code>*msg*</code> is just an implementation detail perhaps you can also find a different way to track the active message.</z><z id="t1544468577" t="bozhidar I donâ€™t think that any user code depends on this."><y>#</y><d>2018-12-10</d><h>19:02</h><w>bozhidar</w>I donâ€™t think that any user code depends on this.</z><z id="t1544468659" t="bozhidar But moving thread management to sessions is also reasonable. The only tricky part will be retaining the thread-local bindings between threads."><y>#</y><d>2018-12-10</d><h>19:04</h><w>bozhidar</w>But moving thread management to sessions is also reasonable. The only tricky part will be retaining the thread-local bindings between threads.</z><z id="t1544474031" t="cgrand [:attrs {:href &quot;/_/_/users/U051BLM8F&quot;}] Bindings of dynvars or of ThreadLocals? I donâ€™t know if youâ€™ve read my latest proposal on #16: a thread per session with a caveat emptor about interrupting evaluation. "><y>#</y><d>2018-12-10</d><h>20:33</h><w>cgrand</w><a>@bozhidar</a> Bindings of dynvars or of ThreadLocals? I donâ€™t know if youâ€™ve read my latest proposal on #16: a thread per session with a caveat emptor about interrupting evaluation. </z><z id="t1544474186" t="cgrand Btw in addition to interrupt in unrepl we have the ability to background the current eval (it returns immediately as a future). "><y>#</y><d>2018-12-10</d><h>20:36</h><w>cgrand</w>Btw in addition to interrupt in unrepl we have the ability to background the current eval (it returns immediately as a future). </z><z id="t1544476331" t="bozhidar &gt; a thread per session with a caveat emptor about interrupting evaluation."><y>#</y><d>2018-12-10</d><h>21:12</h><w>bozhidar</w>&gt; a thread per session with a caveat emptor about interrupting evaluation.</z><z id="t1544476419" t="bozhidar Yeah, that makes a lot of sense. And solves the problem I was thinking about - namely preserving the dynvar bindings, as those are stored in the session anyways."><y>#</y><d>2018-12-10</d><h>21:13</h><w>bozhidar</w>Yeah, that makes a lot of sense. And solves the problem I was thinking about - namely preserving the dynvar bindings, as those are stored in the session anyways.</z><z id="t1544476468" t="bozhidar &gt; Btw in addition to interrupt in unrepl we have the ability to background the current eval (it returns immediately as a future)."><y>#</y><d>2018-12-10</d><h>21:14</h><w>bozhidar</w>&gt; Btw in addition to interrupt in unrepl we have the ability to background the current eval (it returns immediately as a future).</z><z id="t1544476520" t="bozhidar I guess that something like this might be useful to some people who want to enqueue a few long-running evaluations, but Iâ€™m not certain how common this scenario is."><y>#</y><d>2018-12-10</d><h>21:15</h><w>bozhidar</w>I guess that something like this might be useful to some people who want to enqueue a few long-running evaluations, but Iâ€™m not certain how common this scenario is.</z><z id="t1544549273" t="cgrand [:attrs {:href &quot;/_/_/users/U051BLM8F&quot;}] have a look at https://github.com/nrepl/nrepl/commit/61e23d8b3a8a01f7fcbcc7175e9f710e61cddc89"><y>#</y><d>2018-12-11</d><h>17:27</h><w>cgrand</w><a>@bozhidar</a> have a look at <a href="https://github.com/nrepl/nrepl/commit/61e23d8b3a8a01f7fcbcc7175e9f710e61cddc89" target="_blank">https://github.com/nrepl/nrepl/commit/61e23d8b3a8a01f7fcbcc7175e9f710e61cddc89</a></z><z id="t1544609891" t="bozhidar [:attrs {:href &quot;/_/_/users/U3E46Q1DG&quot;}] Looks good to me. The only thing thatâ€™s a bit of a problem is that moving the default executor will break cider-nrepl, as there was a bit of code using this implementation detail directly, but thatâ€™s not a big deal."><y>#</y><d>2018-12-12</d><h>10:18</h><w>bozhidar</w><a>@cgrand</a> Looks good to me. The only thing thatâ€™s a bit of a problem is that moving the default executor will break cider-nrepl, as there was a bit of code using this implementation detail directly, but thatâ€™s not a big deal.</z><z id="t1544609954" t="bozhidar I guess it would also be nice to document the new behavior accordingly, although thatâ€™d be mostly for us - I highly doubt that anyone relied on the implementation details of the execution."><y>#</y><d>2018-12-12</d><h>10:19</h><w>bozhidar</w>I guess it would also be nice to document the new behavior accordingly, although thatâ€™d be mostly for us - I highly doubt that anyone relied on the implementation details of the execution.</z><z id="t1544611153" t="cgrand in the doc for :interrupt ?"><y>#</y><d>2018-12-12</d><h>10:39</h><r>cgrand</r>in the doc for <code>:interrupt</code>?</z><z id="t1544609991" t="bozhidar One more somewhat related thing is the handling of output that we discussed could be improved if we have one thread per session, but I guess this can be done later."><y>#</y><d>2018-12-12</d><h>10:19</h><w>bozhidar</w>One more somewhat related thing is the handling of output that we discussed could be improved if we have one thread per session, but I guess this can be done later.</z><z id="t1544610173" t="bozhidar [:attrs {:href &quot;/_/_/users/U0ENYLGTA&quot;}] The new Lein 2.8.2 is out! ðŸ™‚"><y>#</y><d>2018-12-12</d><h>10:22</h><w>bozhidar</w><a>@dchelimsky</a> The new Lein 2.8.2 is out! <b>ðŸ™‚</b></z><z id="t1544616513" t="dchelimsky Thanks for letting me know!"><y>#</y><d>2018-12-12</d><h>12:08</h><r>dchelimsky</r>Thanks for letting me know!</z><z id="t1544610322" t="cgrand [:attrs {:href &quot;/_/_/users/U051BLM8F&quot;}] another breaking change is that the configurable excutor to interruptible-eval is ignored â€” is it used in practice?"><y>#</y><d>2018-12-12</d><h>10:25</h><w>cgrand</w><a>@bozhidar</a> another breaking change is that the configurable excutor to interruptible-eval is ignored â€” is it used in practice?</z><z id="t1544610351" t="cgrand and what do you do in cider-nrepl with the executor?"><y>#</y><d>2018-12-12</d><h>10:25</h><w>cgrand</w>and what do you do in <code>cider-nrepl</code>with the executor?</z><z id="t1544610441" t="cgrand Oh, thatâ€™s only for tests?"><y>#</y><d>2018-12-12</d><h>10:27</h><w>cgrand</w>Oh, thatâ€™s only for tests?</z><z id="t1544610726" t="cgrand Having worked on thread management, Iâ€™m now wondering if I missed a documentation on the execution model (not the implementation). My understanding: â€¢ msgs from different session are concurrent â€¢ :eval msgs for a given session are serialized â€¢ non-`:eval` msgs for a given session are... concurrent?"><y>#</y><d>2018-12-12</d><h>10:32</h><w>cgrand</w>Having worked on thread management, Iâ€™m now wondering if I missed a documentation on the execution model (not the implementation).
My understanding:
â€¢ msgs from different session are concurrent
â€¢ <code>:eval</code> msgs for a given session are serialized
â€¢ non-`:eval` msgs for a given session are... concurrent?</z><z id="t1544611093" t="bozhidar &gt; [:attrs {:href &quot;/_/_/users/U051BLM8F&quot;}] another breaking change is that the configurable excutor to interruptible-eval is ignored â€” is it used in practice?"><y>#</y><d>2018-12-12</d><h>10:38</h><w>bozhidar</w>&gt; <a>@bozhidar</a> another breaking change is that the configurable excutor to interruptible-eval is ignored â€” is it used in practice?</z><z id="t1544611097" t="bozhidar Itâ€™s not."><y>#</y><d>2018-12-12</d><h>10:38</h><w>bozhidar</w>Itâ€™s not.</z><z id="t1544611153" t="cgrand in the doc for :interrupt ?"><y>#</y><d>2018-12-12</d><h>10:39</h><w>cgrand</w>in the doc for <code>:interrupt</code>?</z><z id="t1544611155" t="bozhidar &gt; and what do you do in cider-nrepl with the executor?"><y>#</y><d>2018-12-12</d><h>10:39</h><w>bozhidar</w>&gt; and what do you do in <code>cider-nrepl</code>with the executor?</z><z id="t1544611171" t="bozhidar Itâ€™s used directly in the test-runner - https://github.com/clojure-emacs/cider-nrepl/blob/7d2ed83b3a57f3883f4a9edd7f6cf83a8d0888b0/src/cider/nrepl/middleware/test.clj#L358"><y>#</y><d>2018-12-12</d><h>10:39</h><w>bozhidar</w>Itâ€™s used directly in the test-runner - <a href="https://github.com/clojure-emacs/cider-nrepl/blob/7d2ed83b3a57f3883f4a9edd7f6cf83a8d0888b0/src/cider/nrepl/middleware/test.clj#L358" target="_blank">https://github.com/clojure-emacs/cider-nrepl/blob/7d2ed83b3a57f3883f4a9edd7f6cf83a8d0888b0/src/cider/nrepl/middleware/test.clj#L358</a></z><z id="t1544611199" t="bozhidar I think thatâ€™d be an easy change, so Iâ€™m not worried about this."><y>#</y><d>2018-12-12</d><h>10:39</h><w>bozhidar</w>I think thatâ€™d be an easy change, so Iâ€™m not worried about this.</z><z id="t1544611246" t="bozhidar &gt; Having worked on thread management, Iâ€™m now wondering if I missed a documentation on the execution model (not the implementation)."><y>#</y><d>2018-12-12</d><h>10:40</h><w>bozhidar</w>&gt; Having worked on thread management, Iâ€™m now wondering if I missed a documentation on the execution model (not the implementation).</z><z id="t1544611251" t="bozhidar Your understanding is perfect."><y>#</y><d>2018-12-12</d><h>10:40</h><w>bozhidar</w>Your understanding is perfect.</z><z id="t1544611276" t="bozhidar I guess we never really documented this, so itâ€™s now only an urban legend. ðŸ™‚"><y>#</y><d>2018-12-12</d><h>10:41</h><w>bozhidar</w>I guess we never really documented this, so itâ€™s now only an urban legend. <b>ðŸ™‚</b></z><z id="t1544611435" t="cgrand The spooky kind: passed amongst client implementors around campfires..."><y>#</y><d>2018-12-12</d><h>10:43</h><w>cgrand</w>The spooky kind: passed amongst client implementors around campfires...</z><z id="t1544611442" t="bozhidar ðŸ˜„"><y>#</y><d>2018-12-12</d><h>10:44</h><w>bozhidar</w><b>ðŸ˜„</b></z><z id="t1544611544" t="cgrand Oh and one canâ€™t interrupt a stray eval (an eval on a transient session) anymore"><y>#</y><d>2018-12-12</d><h>10:45</h><w>cgrand</w>Oh and one canâ€™t interrupt a stray eval (an eval on a transient session) anymore</z><z id="t1544611568" t="bozhidar The difference between the behavior of eval and non-eval messages was a big argument in favour of moving most of the client functionality to middlewares, as if they constantly evaled some messages to get things like completion candidates that could impact performance negatively."><y>#</y><d>2018-12-12</d><h>10:46</h><w>bozhidar</w>The difference between the behavior of eval and non-eval messages was a big argument in favour of moving most of the client functionality to middlewares, as if they constantly evaled some messages to get things like completion candidates that could impact performance negatively.</z><z id="t1544611583" t="bozhidar Whatâ€™s a transient session?"><y>#</y><d>2018-12-12</d><h>10:46</h><w>bozhidar</w>Whatâ€™s a transient session?</z><z id="t1544611807" t="cgrand transient session: non-cloned one"><y>#</y><d>2018-12-12</d><h>10:50</h><w>cgrand</w>transient session: non-cloned one</z><z id="t1544612009" t="cgrand execution model: thanks for the background; what about serializing execution on session+op ? (I donâ€™t have an actual plan, just questioning the statu quo)"><y>#</y><d>2018-12-12</d><h>10:53</h><w>cgrand</w>execution model: thanks for the background; what about serializing execution on <code>session+op</code>? (I donâ€™t have an actual plan, just questioning the statu quo)</z><z id="t1544612588" t="cgrand This will need to be reworked https://github.com/clojure-emacs/cider-nrepl/blob/7d2ed83b3a57f3883f4a9edd7f6cf83a8d0888b0/src/cider/nrepl/middleware/test.clj#L274-L287"><y>#</y><d>2018-12-12</d><h>11:03</h><w>cgrand</w>This will need to be reworked <a href="https://github.com/clojure-emacs/cider-nrepl/blob/7d2ed83b3a57f3883f4a9edd7f6cf83a8d0888b0/src/cider/nrepl/middleware/test.clj#L274-L287" target="_blank">https://github.com/clojure-emacs/cider-nrepl/blob/7d2ed83b3a57f3883f4a9edd7f6cf83a8d0888b0/src/cider/nrepl/middleware/test.clj#L274-L287</a></z><z id="t1544612954" t="bozhidar &gt; execution model: thanks for the background; what about serializing execution on session+op ? (I donâ€™t have an actual plan, just questioning the statu quo)"><y>#</y><d>2018-12-12</d><h>11:09</h><w>bozhidar</w>&gt; execution model: thanks for the background; what about serializing execution on <code>session+op</code>? (I donâ€™t have an actual plan, just questioning the statu quo)</z><z id="t1544613100" t="bozhidar I guess it depends on the op - most ops donâ€™t really affect the global state, so itâ€™s fine to run them concurrently. I donâ€™t see a need for serializing individual ops, unless something in the implementation of the op requires it - e.g. I can imagine multiple refresh ops running in parallel might be a bad idea, but I also wonder if thatâ€™s something people encounter in practice."><y>#</y><d>2018-12-12</d><h>11:11</h><w>bozhidar</w>I guess it depends on the op - most ops donâ€™t really affect the global state, so itâ€™s fine to run them concurrently. I donâ€™t see a need for serializing individual ops, unless something in the implementation of the op requires it - e.g. I can imagine multiple refresh ops running in parallel might be a bad idea, but I also wonder if thatâ€™s something people encounter in practice.</z><z id="t1544613150" t="bozhidar Perhaps there could be some flag to force ops to be serialized to make sure theyâ€™re safely applied?"><y>#</y><d>2018-12-12</d><h>11:12</h><w>bozhidar</w>Perhaps there could be some flag to force ops to be serialized to make sure theyâ€™re safely applied?</z><z id="t1544613159" t="bozhidar &gt; transient session: non-cloned one"><y>#</y><d>2018-12-12</d><h>11:12</h><w>bozhidar</w>&gt; transient session: non-cloned one</z><z id="t1544613215" t="bozhidar Ah, got it. Iâ€™ve been wondering from time to time if we should allow the usage of non-cloned sessions at all. I donâ€™t really see any value in them, but I might be missing something."><y>#</y><d>2018-12-12</d><h>11:13</h><w>bozhidar</w>Ah, got it. Iâ€™ve been wondering from time to time if we should allow the usage of non-cloned sessions at all. I donâ€™t really see any value in them, but I might be missing something.</z><z id="t1544613281" t="bozhidar &gt; This will need to be reworked https://github.com/clojure-emacs/cider-nrepl/blob/7d2ed83b3a57f3883f4a9edd7f6cf83a8d0888b0/src/cider/nrepl/middleware/test.clj#L274-L287"><y>#</y><d>2018-12-12</d><h>11:14</h><w>bozhidar</w>&gt; This will need to be reworked <a href="https://github.com/clojure-emacs/cider-nrepl/blob/7d2ed83b3a57f3883f4a9edd7f6cf83a8d0888b0/src/cider/nrepl/middleware/test.clj#L274-L287" target="_blank">https://github.com/clojure-emacs/cider-nrepl/blob/7d2ed83b3a57f3883f4a9edd7f6cf83a8d0888b0/src/cider/nrepl/middleware/test.clj#L274-L287</a></z><z id="t1544613296" t="bozhidar Yep. Not a big deal, though."><y>#</y><d>2018-12-12</d><h>11:14</h><w>bozhidar</w>Yep. Not a big deal, though.</z><z id="t1544613319" t="cgrand Iâ€™ve created a PR for #16 https://github.com/nrepl/nrepl/pull/98"><y>#</y><d>2018-12-12</d><h>11:15</h><w>cgrand</w>Iâ€™ve created a PR for #16 <a href="https://github.com/nrepl/nrepl/pull/98" target="_blank">https://github.com/nrepl/nrepl/pull/98</a></z><z id="t1544616513" t="dchelimsky Thanks for letting me know!"><y>#</y><d>2018-12-12</d><h>12:08</h><w>dchelimsky</w>Thanks for letting me know!</z><z id="t1544616595" t="bozhidar [:attrs {:href &quot;/_/_/users/U3E46Q1DG&quot;}] Thanks! Iâ€™ll take a look!"><y>#</y><d>2018-12-12</d><h>12:09</h><w>bozhidar</w><a>@cgrand</a> Thanks! Iâ€™ll take a look!</z><z id="t1544692378" t="bozhidar [:attrs {:href &quot;/_/_/users/U3E46Q1DG&quot;}] I left a bit of feedback on the PR, but overall it looks great. Fantastic work!"><y>#</y><d>2018-12-13</d><h>09:12</h><w>bozhidar</w><a>@cgrand</a> I left a bit of feedback on the PR, but overall it looks great. Fantastic work!</z><z id="t1544782053" t="cgrand Reading #44 ( https://github.com/nrepl/nrepl/issues/44 ) caused me to create #100."><y>#</y><d>2018-12-14</d><h>10:07</h><w>cgrand</w>Reading #44 (<a href="https://github.com/nrepl/nrepl/issues/44" target="_blank">https://github.com/nrepl/nrepl/issues/44</a>) caused me to create #100.</z><z id="t1544782067" t="cgrand https://github.com/nrepl/nrepl/issues/100"><y>#</y><d>2018-12-14</d><h>10:07</h><w>cgrand</w><a href="https://github.com/nrepl/nrepl/issues/100" target="_blank">https://github.com/nrepl/nrepl/issues/100</a></z><z id="t1544789359" t="cgrand And here is the PR https://github.com/nrepl/nrepl/pull/101"><y>#</y><d>2018-12-14</d><h>12:09</h><w>cgrand</w>And here is the PR <a href="https://github.com/nrepl/nrepl/pull/101" target="_blank">https://github.com/nrepl/nrepl/pull/101</a></z><z id="t1544945551" t="cfleming [:attrs {:href &quot;/_/_/users/U3E46Q1DG&quot;}] Great to see all the work youâ€™re doing on nREPL. Iâ€™m curious, how has your thinking about streaming vs RPC-style REPLs developed after working on unrepl and now nREPL?"><y>#</y><d>2018-12-16</d><h>07:32</h><w>cfleming</w><a>@cgrand</a> Great to see all the work youâ€™re doing on nREPL. Iâ€™m curious, how has your thinking about streaming vs RPC-style REPLs developed after working on unrepl and now nREPL?</z><z id="t1544945625" t="cfleming I remember at one point you mentioned that you thought you understood Richâ€™s philosophy on REPLs better after working on unrepl, and Iâ€™m pretty sure Rich wouldnâ€™t classify nREPL as a REPL."><y>#</y><d>2018-12-16</d><h>07:33</h><w>cfleming</w>I remember at one point you mentioned that you thought you understood Richâ€™s philosophy on REPLs better after working on unrepl, and Iâ€™m pretty sure Rich wouldnâ€™t classify nREPL as a REPL.</z><z id="t1545038779" t="cgrand As I was reading Drawbridge, I stumbled on: (if (find-ns &apos;clojure.tools.nrepl) (require &apos;[clojure.tools.nrepl :as nrepl] &apos;[clojure.tools.nrepl.server :as server] &apos;[clojure.tools.nrepl.transport :as transport]) (require &apos;[nrepl.core :as nrepl] &apos;[nrepl.server :as server] &apos;[nrepl.transport :as transport])) Wouldnâ€™t it be more sensible to prefer nrepl.core over clojure.tools.nrepl ?"><y>#</y><d>2018-12-17</d><h>09:26</h><w>cgrand</w>As I was reading Drawbridge, I stumbled on:
<pre>(if (find-ns &apos;clojure.tools.nrepl)
  (require
   &apos;[clojure.tools.nrepl :as nrepl]
   &apos;[clojure.tools.nrepl.server :as server]
   &apos;[clojure.tools.nrepl.transport :as transport])
  (require
   &apos;[nrepl.core :as nrepl]
   &apos;[nrepl.server :as server]
   &apos;[nrepl.transport :as transport]))</pre>
Wouldnâ€™t it be more sensible to prefer <code>nrepl.core</code> over <code>clojure.tools.nrepl</code>?</z><z id="t1545039611" t="cgrand [:attrs {:href &quot;/_/_/users/U0567Q30W&quot;}] putting my thoughts together would take time and a small article. streaming pros: super simple model: 1 connection :: 1 repl :: 1 thread; can be taken over (powerful) streaming cons: tracking progress (see prepl and unrepl takes), mixed output streams (because of laziness, modern envs with more than 1 thread, err vs out etc.) (again unrepl and prepl both frame outputs, so their output is a stream of forms instead of a stream of characters); can be taken over (interfer with framing) RPC pros: 1 connection for everything; easy progress report (because framed input) RPC cons: thread management/serialization of evals; explicit lifecycle management; can not be taken over"><y>#</y><d>2018-12-17</d><h>09:40</h><w>cgrand</w><a>@cfleming</a> putting my thoughts together would take time and a small article.
streaming pros: super simple model: 1 connection <b>::</b> 1 repl <b>::</b> 1 thread; can be taken over (powerful)
streaming cons: tracking progress (see prepl and unrepl takes), mixed output streams (because of laziness, modern envs with more than 1 thread, err vs out etc.) (again unrepl and prepl both frame outputs, so their output is a stream of forms instead of a stream of characters); can be taken over (interfer with framing)
RPC pros: 1 connection for everything; easy progress report (because framed input)
RPC cons: thread management/serialization of evals; explicit lifecycle management; can not be taken over</z><z id="t1545040016" t="cgrand summary reality is complex, RPC and streaming are ends of a continuum"><y>#</y><d>2018-12-17</d><h>09:46</h><w>cgrand</w>summary reality is complex, RPC and streaming are ends of a continuum</z><z id="t1545040868" t="bozhidar Excellent summary!"><y>#</y><d>2018-12-17</d><h>10:01</h><w>bozhidar</w>Excellent summary!</z><z id="t1545040876" t="bozhidar &gt; Wouldnâ€™t it be more sensible to prefer nrepl.core over clojure.tools.nrepl ?"><y>#</y><d>2018-12-17</d><h>10:01</h><w>bozhidar</w>&gt; Wouldnâ€™t it be more sensible to prefer <code>nrepl.core</code> over <code>clojure.tools.nrepl</code>?</z><z id="t1545041005" t="bozhidar [:attrs {:href &quot;/_/_/users/U3E46Q1DG&quot;}] Probably. I didnâ€™t think much about this, as it was supposed to be a temporary measure and now that leiningen ships nREPL 0.5 we can remove all the compatibility code."><y>#</y><d>2018-12-17</d><h>10:03</h><w>bozhidar</w><a>@cgrand</a> Probably. I didnâ€™t think much about this, as it was supposed to be a temporary measure and now that leiningen ships nREPL 0.5 we can remove all the compatibility code.</z><z id="t1545041045" t="bozhidar Probably Iâ€™ll cut one more release of cider-nrepl that supports tools.nrepl and afterwards Iâ€™ll go over all the middleware/transport projects and drop this for simplicityâ€™s sake."><y>#</y><d>2018-12-17</d><h>10:04</h><w>bozhidar</w>Probably Iâ€™ll cut one more release of cider-nrepl that supports tools.nrepl and afterwards Iâ€™ll go over all the middleware/transport projects and drop this for simplicityâ€™s sake.</z><z id="t1545047661" t="cgrand Iâ€™m happy to report that datafy/nav is now supported by rich (unrepl) printing: https://github.com/nrepl/nrepl/commit/26e51fbca0dfba5a9ee247605445df7e58e83269"><y>#</y><d>2018-12-17</d><h>11:54</h><w>cgrand</w>Iâ€™m happy to report that datafy/nav is now supported by rich (unrepl) printing: <a href="https://github.com/nrepl/nrepl/commit/26e51fbca0dfba5a9ee247605445df7e58e83269" target="_blank">https://github.com/nrepl/nrepl/commit/26e51fbca0dfba5a9ee247605445df7e58e83269</a></z><z id="t1545049761" t="cgrand Obviously (as for elisions) it requires client-side ui. A datafiable value is represented as #unrepl/browsable [plain-value browsable-value] and to make this lazy the browsable-value is elided. For nav, itâ€™s the same thing: if the datafied value is a map or a vector and is navigable then the map values becomes elided #unrepl/browsable whose elision triggers nav ."><y>#</y><d>2018-12-17</d><h>12:29</h><w>cgrand</w>Obviously (as for elisions) it requires client-side ui.
A datafiable value is represented as <code>#unrepl/browsable [plain-value browsable-value]</code> and to make this lazy the <code>browsable-value</code> is elided.
For nav, itâ€™s the same thing: if the datafied value is a map or a vector and is navigable then the map values becomes elided <code>#unrepl/browsable</code> whose elision triggers <code>nav</code>.</z><z id="t1545049817" t="dominicm Does this affect existing clients? How? "><y>#</y><d>2018-12-17</d><h>12:30</h><w>dominicm</w>Does this affect existing clients? How? </z><z id="t1545049957" t="cgrand unrepl printing is opt-in (set :printer to nrepl.elisions/printer on :eval )"><y>#</y><d>2018-12-17</d><h>12:32</h><w>cgrand</w>unrepl printing is opt-in (set <code>:printer</code> to <code>nrepl.elisions/printer</code> on <code>:eval</code>)</z><z id="t1545057105" t="eraserhd [:attrs {:href &quot;/_/_/users/U3E46Q1DG&quot;}] I&apos;ve been playing with the idea of not needing client side UI by binding variables to ..1 ..2 ..3 and so forth. Except I can&apos;t quite make the idea work."><y>#</y><d>2018-12-17</d><h>14:31</h><w>eraserhd</w><a>@cgrand</a> I&apos;ve been playing with the idea of not needing client side UI by binding variables to ..1 ..2 ..3 and so forth.  Except I can&apos;t quite make the idea work.</z><z id="t1545057244" t="cgrand for some simple elisions, it sort of work"><y>#</y><d>2018-12-17</d><h>14:34</h><w>cgrand</w>for some simple elisions, it sort of work</z><z id="t1545057274" t="cgrand I experimented with /1 /2 etc."><y>#</y><d>2018-12-17</d><h>14:34</h><w>cgrand</w>I experimented with <code>/1</code> <code>/2</code> etc.</z><z id="t1545057334" t="cgrand they are not readable so wonâ€™t clash with clojure code"><y>#</y><d>2018-12-17</d><h>14:35</h><w>cgrand</w>they are not readable so wonâ€™t clash with clojure code</z><z id="t1545057386" t="cgrand ..x are going to be tranformed by the compiler I think (because of the leading dot)"><y>#</y><d>2018-12-17</d><h>14:36</h><w>cgrand</w><code>..x</code> are going to be tranformed by the compiler I think (because of the leading dot)</z><z id="t1545057401" t="eraserhd Ahh, I wasn&apos;t to worried about that. I was worried about needing to keep the numbers forever."><y>#</y><d>2018-12-17</d><h>14:36</h><w>eraserhd</w>Ahh, I wasn&apos;t to worried about that.  I was worried about needing to keep the numbers forever.</z><z id="t1545057413" t="cgrand (if they ccur in function position)"><y>#</y><d>2018-12-17</d><h>14:36</h><w>cgrand</w>(if they ccur in function position)</z><z id="t1545057471" t="cgrand indeed if you use vars, they are interned and you canâ€™t knwo when to GC"><y>#</y><d>2018-12-17</d><h>14:37</h><w>cgrand</w>indeed if you use vars, they are interned and you canâ€™t knwo when to GC</z><z id="t1545057474" t="eraserhd you are right, hrmm"><y>#</y><d>2018-12-17</d><h>14:37</h><w>eraserhd</w>you are right, hrmm</z><z id="t1545057489" t="eraserhd (re: .)"><y>#</y><d>2018-12-17</d><h>14:38</h><w>eraserhd</w>(re: .)</z><z id="t1545057524" t="cgrand or you can choose to keep the last N vars"><y>#</y><d>2018-12-17</d><h>14:38</h><w>cgrand</w>or you can choose to keep the last N vars</z><z id="t1545057540" t="eraserhd right, and then you have unusable stuff in your history."><y>#</y><d>2018-12-17</d><h>14:39</h><w>eraserhd</w>right, and then you have unusable stuff in your history.</z><z id="t1545057557" t="eraserhd but, I want it to work! :D"><y>#</y><d>2018-12-17</d><h>14:39</h><w>eraserhd</w>but, I want it to work!  :D</z><z id="t1545057564" t="cgrand at some point GC pressure may cause collection of elisions anyway"><y>#</y><d>2018-12-17</d><h>14:39</h><w>cgrand</w>at some point GC pressure may cause collection of elisions anyway</z><z id="t1545057631" t="cgrand click (or tab-navigate) to expand is a better ux if you can afford to"><y>#</y><d>2018-12-17</d><h>14:40</h><w>cgrand</w>click (or tab-navigate) to expand is a better ux if you can afford to</z><z id="t1545057683" t="cgrand with datafy/nav, many values may be littered with small affordances hinting that an alternate view is available"><y>#</y><d>2018-12-17</d><h>14:41</h><w>cgrand</w>with datafy/nav, many values may be littered with small affordances hinting that an alternate view is available</z><z id="t1545057846" t="eraserhd Anyway, I&apos;m super excited to have this somehow baked in to my REPL. It solves quite a few problems for me, including 10,000 line exceptions in my primary app. So, thanks for working on it!"><y>#</y><d>2018-12-17</d><h>14:44</h><w>eraserhd</w>Anyway, I&apos;m super excited to have this somehow baked in to my REPL.  It solves quite a few problems for me, including 10,000 line exceptions in my primary app.  So, thanks for working on it!</z><z id="t1545066168" t="eraserhd Hey, that brings up a question about the nREPL client API. Why have a split between connection and client? It doesn&apos;t seem like multiple clients are possible per connection."><y>#</y><d>2018-12-17</d><h>17:02</h><w>eraserhd</w>Hey, that brings up a question about the nREPL client API.  Why have a split between connection and client?  It doesn&apos;t seem like multiple clients are possible per connection.</z><z id="t1545069925" t="dominicm They are. "><y>#</y><d>2018-12-17</d><h>18:05</h><w>dominicm</w>They are. </z><z id="t1545069934" t="dominicm Why do you think they aren&apos;t? "><y>#</y><d>2018-12-17</d><h>18:05</h><w>dominicm</w>Why do you think they aren&apos;t? </z><z id="t1545074480" t="cfleming [:attrs {:href &quot;/_/_/users/U3E46Q1DG&quot;}] Thanks! I agree that the main benefit of streaming REPLs is that theyâ€™re composable, but that definitely comes at a cost."><y>#</y><d>2018-12-17</d><h>19:21</h><w>cfleming</w><a>@cgrand</a> Thanks! I agree that the main benefit of streaming REPLs is that theyâ€™re composable, but that definitely comes at a cost.</z><z id="t1545074592" t="cgrand [:attrs {:href &quot;/_/_/users/U0567Q30W&quot;}] no they are not; see https://github.com/nrepl/nrepl/issues/45#issuecomment-444476311"><y>#</y><d>2018-12-17</d><h>19:23</h><w>cgrand</w><a>@cfleming</a> no they are not; see <a href="https://github.com/nrepl/nrepl/issues/45#issuecomment-444476311" target="_blank">https://github.com/nrepl/nrepl/issues/45#issuecomment-444476311</a></z><z id="t1545074672" t="eraserhd [:attrs {:href &quot;/_/_/users/U09LZR36F&quot;}] I meant, to be clear, that it doesn&apos;t seem to add anything, AFAICT. There&apos;s not concept of client on the wire protocol, only session. And that&apos;s another layer of abstraction in the API."><y>#</y><d>2018-12-17</d><h>19:24</h><w>eraserhd</w><a>@dominicm</a> I meant, to be clear, that it doesn&apos;t seem to add anything, AFAICT.  There&apos;s not concept of client on the wire protocol, only session.  And that&apos;s another layer of abstraction in the API.</z><z id="t1545074756" t="dominicm [:attrs {:href &quot;/_/_/users/U0ECYL0ET&quot;}] I don&apos;t understand the point you&apos;re making. Can you give an example? "><y>#</y><d>2018-12-17</d><h>19:25</h><w>dominicm</w><a>@eraserhd</a> I don&apos;t understand the point you&apos;re making. Can you give an example? </z><z id="t1545074830" t="eraserhd I don&apos;t have a point, I want to understand abstracting clients from connections and sessions."><y>#</y><d>2018-12-17</d><h>19:27</h><w>eraserhd</w>I don&apos;t have a point, I want to understand abstracting clients from connections and sessions.</z><z id="t1545074865" t="dominicm [:attrs {:href &quot;/_/_/users/U0ECYL0ET&quot;}] what&apos;s a client in this context? "><y>#</y><d>2018-12-17</d><h>19:27</h><w>dominicm</w><a>@eraserhd</a> what&apos;s a client in this context? </z><z id="t1545074884" t="eraserhd return of nrepl.core/client "><y>#</y><d>2018-12-17</d><h>19:28</h><w>eraserhd</w>return of nrepl.core/client </z><z id="t1545074941" t="eraserhd https://nrepl.org/nrepl/usage/clients.html#_talking_to_an_nrepl_endpoint_programmatically "><y>#</y><d>2018-12-17</d><h>19:29</h><w>eraserhd</w><a href="https://nrepl.org/nrepl/usage/clients.html#_talking_to_an_nrepl_endpoint_programmatically" target="_blank">https://nrepl.org/nrepl/usage/clients.html#_talking_to_an_nrepl_endpoint_programmatically</a> </z><z id="t1545075356" t="dominicm But you would call that from a separate process, not necessarily even the same network"><y>#</y><d>2018-12-17</d><h>19:35</h><w>dominicm</w>But you would call that from a separate process, not necessarily even the same network</z></g><g id="s3"><z id="t1545148402" t="cgrand Iâ€™m trying to come up with a typology of eval messages, so far I identified four kinds: 1/ regular repl 2/ eval selection (in file buffer) and update repl (`*1` and friends are impacted), serialized with evals of type #1; switch and restore ns as required 3/ eval selection (in file buffer) but displays output in a transient buffer, not serialized with type #1, doesnâ€™t update bindings 4/ out-of-the-blue eval for tooling purposes (doesnâ€™t change bindings)"><y>#</y><d>2018-12-18</d><h>15:53</h><w>cgrand</w>Iâ€™m trying to come up with a typology of eval messages, so far I identified four kinds:
1/ regular repl
2/ eval selection (in file buffer) and update repl (`*1` and friends are impacted), serialized with evals of type #1; switch and restore ns as required
3/ eval selection (in file buffer) but displays output in a transient buffer, not serialized with type #1, doesnâ€™t update bindings
4/ out-of-the-blue eval for tooling purposes (doesnâ€™t change bindings)</z><z id="t1545148528" t="cgrand #4 and #3 may be the same"><y>#</y><d>2018-12-18</d><h>15:55</h><w>cgrand</w>#4 and #3 may be the same</z><z id="t1545149051" t="eraserhd maybe interprocess remote control?"><y>#</y><d>2018-12-18</d><h>16:04</h><w>eraserhd</w>maybe interprocess remote control?</z><z id="t1545149485" t="cgrand hat do you mean?"><y>#</y><d>2018-12-18</d><h>16:11</h><r>cgrand</r>hat do you mean?</z><z id="t1545149612" t="eraserhd Not sure the purpose of the typology, but one use I&apos;ve overheard is processes talking to each other. There&apos;s a bit in the nREPL about using the protocol to notify another server that it&apos;s alive and on what port, for example."><y>#</y><d>2018-12-18</d><h>16:13</h><r>eraserhd</r>Not sure the purpose of the typology, but one use I&apos;ve overheard is processes talking to each other.  There&apos;s a bit in the nREPL about using the protocol to notify another server that it&apos;s alive and on what port, for example.</z><z id="t1545149693" t="eraserhd I can&apos;t delete my DynamoDBs which back my Datomic databases from my laptop, so my restore-dev-environment-from-prod-back script runs datomic.api/delete-database via the socket REPL (over SSH)."><y>#</y><d>2018-12-18</d><h>16:14</h><r>eraserhd</r>I can&apos;t delete my DynamoDBs which back my Datomic databases from my laptop, so my restore-dev-environment-from-prod-back script runs datomic.api/delete-database via the socket REPL (over SSH).</z><z id="t1545149738" t="eraserhd Is this tooling for purposes of your typology?"><y>#</y><d>2018-12-18</d><h>16:15</h><r>eraserhd</r>Is this tooling for purposes of your typology?</z><z id="t1545155141" t="cgrand yes becaue itâ€™s not tied to a user session (a user session being embodied by a repl buffer with history etc.)"><y>#</y><d>2018-12-18</d><h>17:45</h><r>cgrand</r>yes becaue itâ€™s not tied to a user session (a user session being embodied by a repl buffer with history etc.)</z><z id="t1545149092" t="eraserhd Also might be just #4"><y>#</y><d>2018-12-18</d><h>16:04</h><w>eraserhd</w>Also might be just #4</z><z id="t1545149190" t="eraserhd hey, so it&apos;s pretty featureless and not yet documented, but rep , a single-shot nREPL client, is here: https://github.com/eraserhd/rep/tree/develop"><y>#</y><d>2018-12-18</d><h>16:06</h><w>eraserhd</w>hey, so it&apos;s pretty featureless and not yet documented, but <code>rep</code>, a single-shot nREPL client, is here: <a href="https://github.com/eraserhd/rep/tree/develop" target="_blank">https://github.com/eraserhd/rep/tree/develop</a></z><z id="t1545149236" t="eraserhd Building with Graal will be documented. It&apos;s painful and requires a patched Clojure and patched spec.alpha."><y>#</y><d>2018-12-18</d><h>16:07</h><w>eraserhd</w>Building with Graal will be documented.  It&apos;s painful and requires a patched Clojure and patched spec.alpha.</z><z id="t1545149485" t="cgrand hat do you mean?"><y>#</y><d>2018-12-18</d><h>16:11</h><w>cgrand</w>hat do you mean?</z><z id="t1545155461" t="cgrand Rendering is half broken but remote browsing in action"><y>#</y><d>2018-12-18</d><h>17:51</h><w>cgrand</w>Rendering is half broken but remote browsing in action</z><z id="t1545156346" t="eraserhd \o/"><y>#</y><d>2018-12-18</d><h>18:05</h><w>eraserhd</w>\o/</z><z id="t1545236703" t="cgrand Guys, bencode is byte-based but in the transport we assume all byte arrays in messages to be UTF8 strings. Thereâ€™s no easy way to use raw binary without adding much complexity. Base64 to the rescue. Right?"><y>#</y><d>2018-12-19</d><h>16:25</h><w>cgrand</w>Guys, bencode is byte-based but in the transport we assume all byte arrays in messages to be UTF8 strings. Thereâ€™s no easy way to use raw binary without adding much complexity. Base64 to the rescue. Right?</z><z id="t1545275513" t="cfleming [:attrs {:href &quot;/_/_/users/U3E46Q1DG&quot;}] I meant that pure streaming REPLs are composable, but limited."><y>#</y><d>2018-12-20</d><h>03:11</h><w>cfleming</w><a>@cgrand</a> I meant that pure streaming REPLs are composable, but limited.</z><z id="t1545284436" t="cgrand [:attrs {:href &quot;/_/_/users/U0567Q30W&quot;}] itâ€™s with the composability that I strongly disagree. When repls are nested their powers donâ€™t compose because only the innermost is running. "><y>#</y><d>2018-12-20</d><h>05:40</h><w>cgrand</w><a>@cfleming</a> itâ€™s with the composability that I strongly disagree. When repls are nested their powers donâ€™t compose because only the innermost is running. </z><z id="t1545286426" t="cgrand [:attrs {:href &quot;/_/_/users/U0567Q30W&quot;}] imagine you have two repls: one which uses pprint and the other with a slightly more informative prompt. Thereâ€™s no way to get both features at the same time. "><y>#</y><d>2018-12-20</d><h>06:13</h><w>cgrand</w><a>@cfleming</a> imagine you have two repls: one which uses pprint and the other with a slightly more informative prompt. Thereâ€™s no way to get both features at the same time. </z><z id="t1545287906" t="cfleming [:attrs {:href &quot;/_/_/users/U3E46Q1DG&quot;}] Yes, I agree - compose is the wrong word. Iâ€™m really talking about them being nestable."><y>#</y><d>2018-12-20</d><h>06:38</h><w>cfleming</w><a>@cgrand</a> Yes, I agree - compose is the wrong word. Iâ€™m really talking about them being nestable.</z><z id="t1545318909" t="cgrand Sideloading (loading resources/classes from the client without shared filesystem) in nrepl works: https://github.com/nrepl/nrepl/blob/0cfa805ce7f249c5fd9da4bb5343f3130bbc5784/test/clojure/nrepl/core_test.clj#L608-L613"><y>#</y><d>2018-12-20</d><h>15:15</h><w>cgrand</w>Sideloading (loading resources/classes from the client without shared filesystem) in nrepl works: <a href="https://github.com/nrepl/nrepl/blob/0cfa805ce7f249c5fd9da4bb5343f3130bbc5784/test/clojure/nrepl/core_test.clj#L608-L613" target="_blank">https://github.com/nrepl/nrepl/blob/0cfa805ce7f249c5fd9da4bb5343f3130bbc5784/test/clojure/nrepl/core_test.clj#L608-L613</a></z><z id="t1545319743" t="dominicm This implementation doesn&apos;t allow for transports to be sideloaded. Unless we add support for nesting perhaps. "><y>#</y><d>2018-12-20</d><h>15:29</h><w>dominicm</w>This implementation doesn&apos;t allow for transports to be sideloaded. Unless we add support for nesting perhaps. </z><z id="t1545321361" t="cgrand Why would you want to change transport?"><y>#</y><d>2018-12-20</d><h>15:56</h><w>cgrand</w>Why would you want to change transport?</z><z id="t1545322274" t="cgrand Switch encoding over same connection or install a new connection?"><y>#</y><d>2018-12-20</d><h>16:11</h><w>cgrand</w>Switch encoding over same connection or install a new connection?</z><z id="t1545324804" t="cgrand [:attrs {:href &quot;/_/_/users/U09LZR36F&quot;}] could you describe the scenario you have in mind?"><y>#</y><d>2018-12-20</d><h>16:53</h><w>cgrand</w><a>@dominicm</a> could you describe the scenario you have in mind?</z><z id="t1545326165" t="dominicm [:attrs {:href &quot;/_/_/users/U3E46Q1DG&quot;}] now you have made the logistics clear, I think same connection is better for firewall reasons. My reasoning is that editors currently have to specify the transport the user chooses ahead of time in the server, eg vim might choose a json transport, but Emacs uses edn. Perhaps it would be useful for clients to bring a transport, and upgrade a standard connection somehow."><y>#</y><d>2018-12-20</d><h>17:16</h><w>dominicm</w><a>@cgrand</a> now you have made the logistics clear, I think same connection is better for firewall reasons.

My reasoning is that editors currently have to specify the transport the user chooses ahead of time in the server, eg vim might choose a json transport, but Emacs uses edn.

Perhaps it would be useful for clients to bring a transport, and upgrade a standard connection somehow.</z><z id="t1545326786" t="cgrand What are the connection means in use today? TCP socket, stdin/stdout and drawbridge?"><y>#</y><d>2018-12-20</d><h>17:26</h><w>cgrand</w>What are the connection means in use today? TCP socket, stdin/stdout and drawbridge?</z><z id="t1545326988" t="cgrand An injectable nREPL over plain repl would cover the first two cases. Then maybe we would need a drawbridge-lite"><y>#</y><d>2018-12-20</d><h>17:29</h><w>cgrand</w>An injectable nREPL over plain repl would cover the first two cases. Then maybe we would need a drawbridge-lite</z><z id="t1545328671" t="dominicm In practice? Bencode only,"><y>#</y><d>2018-12-20</d><h>17:57</h><w>dominicm</w>In practice? Bencode only,</z><z id="t1545328680" t="dominicm Pretty much anyway afaik. "><y>#</y><d>2018-12-20</d><h>17:58</h><w>dominicm</w>Pretty much anyway afaik. </z><z id="t1545329497" t="pez Yes, bencode, but I&apos;d like to switch over to EDN for Calva. I guess most Calva users are in control over the server. "><y>#</y><d>2018-12-20</d><h>18:11</h><w>pez</w>Yes, bencode, but I&apos;d like to switch over to EDN for Calva. I guess most Calva users are in control over the server. </z><z id="t1545330215" t="cgrand No drawbridge in practice?"><y>#</y><d>2018-12-20</d><h>18:23</h><w>cgrand</w>No drawbridge in practice?</z><z id="t1545330358" t="dominicm I hear someone trying it occasionally, but not really"><y>#</y><d>2018-12-20</d><h>18:25</h><w>dominicm</w>I hear someone trying it occasionally, but not really</z><z id="t1545338849" t="cgrand Does anybody know of a middleware which uses raw binary (byte arrays)? It seems unlikely given my understanding of the whole stack but I prefer to ask."><y>#</y><d>2018-12-20</d><h>20:47</h><w>cgrand</w>Does anybody know of a middleware which uses raw binary (byte arrays)? It seems unlikely given my understanding of the whole stack but I prefer to ask.</z><z id="t1545393700" t="bozhidar [:attrs {:href &quot;/_/_/users/U3E46Q1DG&quot;}] Iâ€™m back behind a keyboard, so Iâ€™ll catch up with the messages and the PRs soon."><y>#</y><d>2018-12-21</d><h>12:01</h><w>bozhidar</w><a>@cgrand</a> Iâ€™m back behind a keyboard, so Iâ€™ll catch up with the messages and the PRs soon.</z><z id="t1545393721" t="bozhidar &gt; Does anybody know of a middleware which uses raw binary (byte arrays)? It seems unlikely given my understanding of the whole stack but I prefer to ask."><y>#</y><d>2018-12-21</d><h>12:02</h><w>bozhidar</w>&gt; Does anybody know of a middleware which uses raw binary (byte arrays)? It seems unlikely given my understanding of the whole stack but I prefer to ask.</z><z id="t1545393761" t="bozhidar I donâ€™t think so. I have to check what exactly was the content-type middleware doing, but everything else certainly deals only with data thatâ€™s representable as text."><y>#</y><d>2018-12-21</d><h>12:02</h><w>bozhidar</w>I donâ€™t think so. I have to check what exactly was the content-type middleware doing, but everything else certainly deals only with data thatâ€™s representable as text.</z><z id="t1545399037" t="cgrand I already checked: base64, not raw binary"><y>#</y><d>2018-12-21</d><h>13:30</h><r>cgrand</r>I already checked: base64, not raw binary</z><z id="t1545404752" t="bozhidar Great. I guess we can just mention somewhere that people canâ€™t use binary data. Potentially we can also enforce this somewhere just to be on the safe side. At any rate - Iâ€™m certainly not concerned about making it clear people are not supposed to use middleware in this manner."><y>#</y><d>2018-12-21</d><h>15:05</h><r>bozhidar</r>Great. I guess we can just mention somewhere that people canâ€™t use binary data. Potentially we can also enforce this somewhere just to be on the safe side. At any rate - Iâ€™m certainly not concerned about making it clear people are not supposed to use middleware in this manner.</z><z id="t1545399037" t="cgrand I already checked: base64, not raw binary"><y>#</y><d>2018-12-21</d><h>13:30</h><w>cgrand</w>I already checked: base64, not raw binary</z><z id="t1545408888" t="bozhidar [:attrs {:href &quot;/_/_/users/U3E46Q1DG&quot;}] [:attrs {:href &quot;/_/_/users/U09LZR36F&quot;}] When youâ€™ve got some time can you take a look here and share your thoughts on the message logging approach?"><y>#</y><d>2018-12-21</d><h>16:14</h><w>bozhidar</w><a>@cgrand</a> <a>@dominicm</a> When youâ€™ve got some time can you take a look here and share your thoughts on the message logging approach?</z><z id="t1545408932" t="bozhidar This PR has been dragging on for a while and before we wrap it up Iâ€™m curious to hear what you think about it."><y>#</y><d>2018-12-21</d><h>16:15</h><w>bozhidar</w>This PR has been dragging on for a while and before we wrap it up Iâ€™m curious to hear what you think about it.</z><z id="t1545410671" t="pez [:attrs {:href &quot;/_/_/users/U051BLM8F&quot;}] Did you forget to share were â€œhereâ€ is?"><y>#</y><d>2018-12-21</d><h>16:44</h><w>pez</w><a>@bozhidar</a> Did you forget to share were â€œhereâ€ is?</z><z id="t1545412951" t="bozhidar Oh, certainly."><y>#</y><d>2018-12-21</d><h>17:22</h><w>bozhidar</w>Oh, certainly.</z><z id="t1545417041" t="bozhidar Here is https://github.com/nrepl/nrepl/pull/87 ðŸ™‚"><y>#</y><d>2018-12-21</d><h>18:30</h><w>bozhidar</w>Here is <a href="https://github.com/nrepl/nrepl/pull/87" target="_blank">https://github.com/nrepl/nrepl/pull/87</a> <b>ðŸ™‚</b></z><z id="t1545421464" t="bozhidar &gt; What are the connection means in use today? TCP socket, stdin/stdout and drawbridge?"><y>#</y><d>2018-12-21</d><h>19:44</h><w>bozhidar</w>&gt; What are the connection means in use today? TCP socket, stdin/stdout and drawbridge?</z><z id="t1545421510" t="bozhidar Thereâ€™s also fastlane - json/messagepack using transit."><y>#</y><d>2018-12-21</d><h>19:45</h><w>bozhidar</w>Thereâ€™s also fastlane - json/messagepack using transit.</z><z id="t1545421526" t="bozhidar And the WIP regarding EDN."><y>#</y><d>2018-12-21</d><h>19:45</h><w>bozhidar</w>And the WIP regarding EDN.</z><z id="t1545421572" t="bozhidar Today almost everyone is using bencode, and a few people are using drawbridge, but I guess things happened in this manner simply because there were no alternatives until quite recently."><y>#</y><d>2018-12-21</d><h>19:46</h><w>bozhidar</w>Today almost everyone is using bencode, and a few people are using drawbridge, but I guess things happened in this manner simply because there were no alternatives until quite recently.</z><z id="t1545421606" t="bozhidar I think the new transports would certainly be more convenient for certain clients."><y>#</y><d>2018-12-21</d><h>19:46</h><w>bozhidar</w>I think the new transports would certainly be more convenient for certain clients.</z><z id="t1546077206" t="vxe are there any especially difficult obstacles for implementing an nrepl middleware for clojure-clr, perhaps providing something like what piggieback provides for clojurescript?"><y>#</y><d>2018-12-29</d><h>09:53</h><w>vxe</w>are there any especially difficult obstacles for implementing an nrepl middleware for clojure-clr, perhaps providing something like what piggieback provides for clojurescript?</z><z id="t1546081147" t="bozhidar [:attrs {:href &quot;/_/_/users/U5Y86G3KL&quot;}] Itâ€™s mostly lack of interest and time. Itâ€™s doable, but given the fact that few people use CLR itâ€™s not something high up on our to-do list. It also canâ€™t be done the same way as itâ€™s done for Piggieback, as you canâ€™t drive the evaluation from a JVM, the same way you can do it for ClojureScript."><y>#</y><d>2018-12-29</d><h>10:59</h><w>bozhidar</w><a>@vxe</a> Itâ€™s mostly lack of interest and time. Itâ€™s doable, but given the fact that few people use CLR itâ€™s not something high up on our to-do list. It also canâ€™t be done the same way as itâ€™s done for Piggieback, as you canâ€™t drive the evaluation from a JVM, the same way you can do it for ClojureScript.</z><z id="t1546081203" t="bozhidar It would be most feasible to have a separate nREPL implementation for CLR or to use reader conditionals in the current implementation to support CLR."><y>#</y><d>2018-12-29</d><h>11:00</h><w>bozhidar</w>It would be most feasible to have a separate nREPL implementation for CLR or to use reader conditionals in the current implementation to support CLR.</z><z id="t1546081245" t="bozhidar However, this would add some complexity for a marginal gain. According to the State of Clojure survey almost no one uses ClojureCLRâ€¦"><y>#</y><d>2018-12-29</d><h>11:00</h><w>bozhidar</w>However, this would add some complexity for a marginal gain. According to the State of Clojure survey almost no one uses ClojureCLRâ€¦</z><z id="t1546081871" t="vxe noted, thx"><y>#</y><d>2018-12-29</d><h>11:11</h><w>vxe</w>noted, thx</z><z id="t1546800435" t="aria42 little rusty on things here, but for reasons out of my control, my project has both a org.clojure/tools.nrepl and newer nrepl dependency, but lein repl seems to always be picking up the older package name and starting with nREPL 0.2.12 . Is this due to lein&apos;s dependency on that? I believe I should be overriding, but because the package is different, not sure if I&apos;m actually overriding."><y>#</y><d>2019-01-06</d><h>18:47</h><w>aria42</w>little rusty on things here, but for reasons out of my control, my project has both a <code>org.clojure/tools.nrepl</code>  and newer <code>nrepl</code>dependency, but <code>lein repl</code> seems to always be picking up the older package name and starting with <code>nREPL 0.2.12</code>. Is this due to lein&apos;s dependency on that? I believe I should be overriding, but because the package is different, not sure if I&apos;m actually overriding.</z><z id="t1546844889" t="bozhidar [:attrs {:href &quot;/_/_/users/U5JFWFE2V&quot;}] You need Lein 2.8.3 or newer to use the modern nREPL."><y>#</y><d>2019-01-07</d><h>07:08</h><w>bozhidar</w><a>@aria42</a> You need Lein 2.8.3 or newer to use the modern nREPL.</z><z id="t1546844909" t="bozhidar Older versions have tools.nrepl as a hardcoded and non-overridable dep."><y>#</y><d>2019-01-07</d><h>07:08</h><w>bozhidar</w>Older versions have <code>tools.nrepl</code> as a hardcoded and non-overridable dep.</z><z id="t1546844938" t="bozhidar &gt; Is this due to leinâ€™s dependency on that? I believe I should be overriding, but because the package is different, not sure if Iâ€™m actually overriding."><y>#</y><d>2019-01-07</d><h>07:08</h><w>bozhidar</w>&gt; Is this due to leinâ€™s dependency on that? I believe I should be overriding, but because the package is different, not sure if Iâ€™m actually overriding.</z><z id="t1546844977" t="bozhidar Generally you canâ€™t override different artifacts. ðŸ™‚"><y>#</y><d>2019-01-07</d><h>07:09</h><w>bozhidar</w>Generally you canâ€™t override different artifacts. <b>ðŸ™‚</b></z><z id="t1547029257" t="cgrand Do you have any idea why lein test :only ... does not work on the nrepl codebase?"><y>#</y><d>2019-01-09</d><h>10:20</h><w>cgrand</w>Do you have any idea why <code>lein test :only ...</code> does not work on the nrepl codebase?</z><z id="t1547031201" t="cgrand ah found the culprit: the macro generating deftest makes the tests private. Why?"><y>#</y><d>2019-01-09</d><h>10:53</h><w>cgrand</w>ah found the culprit: the macro generating <code>deftest</code> makes the tests private. Why?</z><z id="t1547047781" t="bozhidar [:attrs {:href &quot;/_/_/users/U3E46Q1DG&quot;}] No idea. This was way before my time on the project."><y>#</y><d>2019-01-09</d><h>15:29</h><w>bozhidar</w><a>@cgrand</a> No idea. This was way before my time on the project.</z><z id="t1547047789" t="bozhidar I think we can safely change this."><y>#</y><d>2019-01-09</d><h>15:29</h><w>bozhidar</w>I think we can safely change this.</z><z id="t1547140936" t="cgrand A poor clj repl downgraded to a bencode transport"><y>#</y><d>2019-01-10</d><h>17:22</h><w>cgrand</w>A poor clj repl downgraded to a bencode transport</z><z id="t1547145237" t="bozhidar [:attrs {:href &quot;/_/_/users/U3E46Q1DG&quot;}] I almost feel bad for it! ðŸ˜„ Fantastic progress!"><y>#</y><d>2019-01-10</d><h>18:33</h><w>bozhidar</w><a>@cgrand</a> I almost feel bad for it! <b>ðŸ˜„</b> Fantastic progress!</z><z id="t1547150471" t="bozhidar [:attrs {:href &quot;/_/_/users/U052B0PT3&quot;}] Nice to see you here! Awesome work with that streaming patch! I definitely didnâ€™t expect such a quick turnaround."><y>#</y><d>2019-01-10</d><h>20:01</h><w>bozhidar</w><a>@cichli</a> Nice to see you here! Awesome work with that streaming patch! I definitely didnâ€™t expect such a quick turnaround.</z><z id="t1547150509" t="bozhidar Itâ€™s a pity you werenâ€™t there when the changes to printing logic were originally discussed. At this point I hate dealing with printing - spent so much time on this and the work never ends. ðŸ˜„"><y>#</y><d>2019-01-10</d><h>20:01</h><w>bozhidar</w>Itâ€™s a pity you werenâ€™t there when the changes to printing logic were originally discussed. At this point I hate dealing with printing - spent so much time on this and the work never ends. <b>ðŸ˜„</b></z><z id="t1547155877" t="jeremy I must have upgraded something but recently I have been getting a lot of nREPL server started on port 62907 on host 127.0.0.1 - ERROR: Unhandled REPL handler exception processing message {:id 3e1ebf2a-7980-460d-97c6-ceb62ff319fd, :op clone} java.lang.NullPointerException at clojure.core$deref_future.invokeStatic(core.clj:2292) at clojure.core$deref.invokeStatic(core.clj:2312) at clojure.core$deref.invoke(core.clj:2298) at cider.piggieback$wrap_cljs_repl$fn__54058.invoke(piggieback.clj:301) at clojure.tools.nrepl.middleware$wrap_conj_descriptor$fn__47113.invoke(middleware.clj:22)"><y>#</y><d>2019-01-10</d><h>21:31</h><w>jeremy</w>I must have upgraded something but recently I have been getting a lot of
<pre>nREPL server started on port 62907 on host 127.0.0.1 - 
ERROR: Unhandled REPL handler exception processing message {:id 3e1ebf2a-7980-460d-97c6-ceb62ff319fd, :op clone}
java.lang.NullPointerException
        at clojure.core$deref_future.invokeStatic(core.clj:2292)
        at clojure.core$deref.invokeStatic(core.clj:2312)
        at clojure.core$deref.invoke(core.clj:2298)
        at cider.piggieback$wrap_cljs_repl$fn__54058.invoke(piggieback.clj:301)
        at clojure.tools.nrepl.middleware$wrap_conj_descriptor$fn__47113.invoke(middleware.clj:22)</pre></z><z id="t1547156033" t="jeremy I guess I figured out why, but itâ€™s awkward to me."><y>#</y><d>2019-01-10</d><h>21:33</h><w>jeremy</w>I guess I figured out why, but itâ€™s awkward to me.</z><z id="t1547156108" t="jeremy Since I seem to have a project with both nrepl and tools.nrepl, in order to get repl working in Cursive, I needed to add [clojure.tools.nrepl.server] to my require at main. But when Iâ€™m working in Calva it borks me up. So If i remove it I can work in Calva, but not in Cursive. ðŸ˜®"><y>#</y><d>2019-01-10</d><h>21:35</h><w>jeremy</w>Since I seem to have a project with both nrepl and tools.nrepl, in order to get repl working in Cursive, I needed to add [clojure.tools.nrepl.server] to my require at main. But when Iâ€™m working in Calva it borks me up. So If i remove it I can work in Calva, but not in Cursive. <b>ðŸ˜®</b></z><z id="t1547189115" t="bozhidar [:attrs {:href &quot;/_/_/users/UANK2VBHA&quot;}] To my knowledge Cursive should work just fine with the modern nREPL."><y>#</y><d>2019-01-11</d><h>06:45</h><w>bozhidar</w><a>@jeremy642</a> To my knowledge Cursive should work just fine with the modern nREPL.</z><z id="t1547189139" t="bozhidar Perhaps youâ€™re not on the latest version or something like this?"><y>#</y><d>2019-01-11</d><h>06:45</h><w>bozhidar</w>Perhaps youâ€™re not on the latest version or something like this?</z><z id="t1547192029" t="cfleming [:attrs {:href &quot;/_/_/users/U051BLM8F&quot;}] Cursive still uses the old one, but IIRC it should be compatible with the new server, right?"><y>#</y><d>2019-01-11</d><h>07:33</h><w>cfleming</w><a>@bozhidar</a> Cursive still uses the old one, but IIRC it should be compatible with the new server, right?</z><z id="t1547192079" t="cfleming Iâ€™ll upgrade the nREPL Cursive uses for the next release, but that will only be for REPLs managed by Cursive - ones started via lein will use whatever version Lein uses."><y>#</y><d>2019-01-11</d><h>07:34</h><w>cfleming</w>Iâ€™ll upgrade the nREPL Cursive uses for the next release, but that will only be for REPLs managed by Cursive - ones started via lein will use whatever version Lein uses.</z><z id="t1547193869" t="bozhidar [:attrs {:href &quot;/_/_/users/U0567Q30W&quot;}] Itâ€™s compatible on the protocol level, but the middleware is not compatible because of the namespace change."><y>#</y><d>2019-01-11</d><h>08:04</h><w>bozhidar</w><a>@cfleming</a> Itâ€™s compatible on the protocol level, but the middleware is not compatible because of the namespace change.</z><z id="t1547193944" t="bozhidar Generally itâ€™s a bad idea to mix them in the same project as some middlewares use conditional requires to figure out which one to load and if some other code loads the unexpected nREPL you get into a situation like Jeremyâ€™s."><y>#</y><d>2019-01-11</d><h>08:05</h><w>bozhidar</w>Generally itâ€™s a bad idea to mix them in the same project as some middlewares use conditional requires to figure out which one to load and if some other code loads the unexpected nREPL you get into a situation like Jeremyâ€™s.</z><z id="t1547194001" t="bozhidar &gt; Iâ€™ll upgrade the nREPL Cursive uses for the next release, but that will only be for REPLs managed by Cursive - ones started via lein will use whatever version Lein uses."><y>#</y><d>2019-01-11</d><h>08:06</h><w>bozhidar</w>&gt; Iâ€™ll upgrade the nREPL Cursive uses for the next release, but that will only be for REPLs managed by Cursive - ones started via lein will use whatever version Lein uses.</z><z id="t1547194004" t="bozhidar Thatâ€™d be great!"><y>#</y><d>2019-01-11</d><h>08:06</h><w>bozhidar</w>Thatâ€™d be great!</z><z id="t1547194077" t="bozhidar Now all tools are using the new nREPL in their current releases. In this situation Iâ€™ve decided to remove completely support for tools.nrepl in the projects I maintain and just encourage people to upgrade their boot/lein."><y>#</y><d>2019-01-11</d><h>08:07</h><w>bozhidar</w>Now all tools are using the new nREPL in their current releases. In this situation Iâ€™ve decided to remove completely support for tools.nrepl in the projects I maintain and just encourage people to upgrade their boot/lein.</z><z id="t1547485431" t="eraserhd [:attrs {:href &quot;/_/_/users/U051BLM8F&quot;}] thanks for adding rep to the clients page!"><y>#</y><d>2019-01-14</d><h>17:03</h><w>eraserhd</w><a>@bozhidar</a> thanks for adding <code>rep</code> to the clients page!</z><z id="t1547486350" t="bozhidar Youâ€™re welcome!"><y>#</y><d>2019-01-14</d><h>17:19</h><w>bozhidar</w>Youâ€™re welcome!</z><z id="t1547807345" t="mseddon complete and resources-list take a :context parameter, which has the rather cryptic docstring &quot;Completion context for compliment.&quot;, what exactly is a &apos;completion context&apos; and how is it used?"><y>#</y><d>2019-01-18</d><h>10:29</h><w>mseddon</w><code>complete</code> and <code>resources-list</code> take a <code>:context</code> parameter, which has the rather cryptic docstring &quot;Completion context for compliment.&quot;, what exactly is a &apos;completion context&apos; and how is it used?</z><z id="t1547930620" t="cichli [:attrs {:href &quot;/_/_/users/U1GCL8V2B&quot;}] see: https://github.com/alexander-yakushev/compliment/wiki/Context"><y>#</y><d>2019-01-19</d><h>20:43</h><w>cichli</w><a>@mseddon</a> see: <a href="https://github.com/alexander-yakushev/compliment/wiki/Context" target="_blank">https://github.com/alexander-yakushev/compliment/wiki/Context</a></z><z id="t1547930703" t="mseddon [:attrs {:href &quot;/_/_/users/U052B0PT3&quot;}] Perfect, thanks!"><y>#</y><d>2019-01-19</d><h>20:45</h><w>mseddon</w><a>@cichli</a>  Perfect, thanks!</z><z id="t1547930919" t="mseddon I had no idea how smart compliment is. We will definitely start leveraging that"><y>#</y><d>2019-01-19</d><h>20:48</h><w>mseddon</w>I had no idea how smart compliment is. We will definitely start leveraging that</z><z id="t1547937345" t="mseddon Also as a general query, I have seen a little bit of talk regarding nrepl cljs debugger support. Is there anything in the works I can help with, and if not, do you feel the js debugger hook or cps transform instrumentation solution is best?"><y>#</y><d>2019-01-19</d><h>22:35</h><w>mseddon</w>Also as a general query, I have seen a little bit of talk regarding nrepl cljs debugger support. Is there anything in the works I can help with, and if not, do you feel the js debugger hook or cps transform instrumentation solution is best?</z><z id="t1548350444" t="eraserhd OK, passing idea. How could we inject an nREPL server into Chrome for access to dev tools? Not necessarily ClojureScript. But also capturing console errors and warnings not seen with cljs repl?"><y>#</y><d>2019-01-24</d><h>17:20</h><w>eraserhd</w>OK, passing idea.  How could we inject an nREPL server into Chrome for access to dev tools?  Not necessarily ClojureScript.  But also capturing console errors and warnings not seen with cljs repl?</z><z id="t1548352457" t="dominicm You can override console.error/log etc"><y>#</y><d>2019-01-24</d><h>17:54</h><w>dominicm</w>You can override console.error/log etc</z><z id="t1548352477" t="dominicm But into chrome? I&apos;m not sure what you mean by that "><y>#</y><d>2019-01-24</d><h>17:54</h><w>dominicm</w>But into chrome? I&apos;m not sure what you mean by that </z><z id="t1548354337" t="eraserhd I mean evaluate JS in the dev tools window, as well as inspect values."><y>#</y><d>2019-01-24</d><h>18:25</h><w>eraserhd</w>I mean evaluate JS in the dev tools window, as well as inspect values.</z><z id="t1548354363" t="eraserhd And therefore, evaluate JS from the editor."><y>#</y><d>2019-01-24</d><h>18:26</h><w>eraserhd</w>And therefore, evaluate JS from the editor.</z><z id="t1548358439" t="mseddon You could use the devtools protocol perhaps to achieve that, but I think you&apos;d need to launch chrome manually, and really it would have little to do with nrepl at that point"><y>#</y><d>2019-01-24</d><h>19:33</h><w>mseddon</w>You could use the devtools protocol perhaps to achieve that, but I think you&apos;d need to launch chrome manually, and really it would have little to do with nrepl at that point</z><z id="t1548592503" t="Jakub HolÃ½ (HolyJak) Is there a proper way to stop the nrepl server from a client session? Running stop-server from a client connection causes the following error on the server (likely because it first closes the server socket and then tries to close each transport, flushing whatever remains, and perhaps fails to write repsonse to the closing statement): Exception in thread &quot;nREPL-worker-0&quot; java.lang.Error: java.net.SocketException: Socket closed at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1155) at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) at java.lang.Thread.run(Thread.java:748) Caused by: java.net.SocketException: Socket closed at java.net.SocketOutputStream.socketWrite(SocketOutputStream.java:118) at java.net.SocketOutputStream.write(SocketOutputStream.java:155) at java.io.BufferedOutputStream.flushBuffer(BufferedOutputStream.java:82) at java.io.BufferedOutputStream.flush(BufferedOutputStream.java:140) at nrepl.transport$bencode$fn__725.invoke(transport.clj:103) at nrepl.transport.FnTransport.send(transport.clj:28) at nrepl.middleware.pr_values$printing_transport$reify__1137.send(pr_values.clj:40) at nrepl.middleware.interruptible_eval$evaluate$fn__1179$fn__1192.invoke(interruptible_eval.clj:135) at clojure.main$repl$fn__9077.invoke(main.clj:437) at clojure.main$repl.invokeStatic(main.clj:435) at clojure.main$repl.doInvoke(main.clj:345) at clojure.lang.RestFn.invoke(RestFn.java:1523) at nrepl.middleware.interruptible_eval$evaluate$fn__1179.invoke(interruptible_eval.clj:93) at clojure.lang.AFn.applyToHelper(AFn.java:152) at clojure.lang.AFn.applyTo(AFn.java:144) at clojure.core$apply.invokeStatic(core.clj:665) at clojure.core$with_bindings_STAR_.invokeStatic(core.clj:1973) at clojure.core$with_bindings_STAR_.doInvoke(core.clj:1973) at clojure.lang.RestFn.invoke(RestFn.java:425) at nrepl.middleware.interruptible_eval$evaluate.invokeStatic(interruptible_eval.clj:91) at nrepl.middleware.interruptible_eval$evaluate.invoke(interruptible_eval.clj:60) at nrepl.middleware.interruptible_eval$interruptible_eval$fn__1221$fn__1224.invoke(interruptible_eval.clj:231) at nrepl.middleware.interruptible_eval$run_next$fn__1216.invoke(interruptible_eval.clj:199) at clojure.lang.AFn.run(AFn.java:22) at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) ... 2 more And the client cannot be stopped with ctrl-C due to Exception in thread &quot;SIGINT handler&quot; java.net.SocketException: Broken pipe (Write failed)"><y>#</y><d>2019-01-27</d><h>12:35</h><w>Jakub HolÃ½ (HolyJak)</w>Is there a proper way to stop the nrepl server from a client session? Running <code>stop-server</code> from a client connection causes the following error on the server (likely because it first closes the server socket and then tries to close each transport, flushing whatever remains, and perhaps fails to write repsonse to the closing statement): <pre>Exception in thread &quot;nREPL-worker-0&quot; java.lang.Error: java.net.SocketException: Socket closed
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1155)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.net.SocketException: Socket closed
	at java.net.SocketOutputStream.socketWrite(SocketOutputStream.java:118)
	at java.net.SocketOutputStream.write(SocketOutputStream.java:155)
	at java.io.BufferedOutputStream.flushBuffer(BufferedOutputStream.java:82)
	at java.io.BufferedOutputStream.flush(BufferedOutputStream.java:140)
	at nrepl.transport$bencode$fn__725.invoke(transport.clj:103)
	at nrepl.transport.FnTransport.send(transport.clj:28)
	at nrepl.middleware.pr_values$printing_transport$reify__1137.send(pr_values.clj:40)
	at nrepl.middleware.interruptible_eval$evaluate$fn__1179$fn__1192.invoke(interruptible_eval.clj:135)
	at clojure.main$repl$fn__9077.invoke(main.clj:437)
	at clojure.main$repl.invokeStatic(main.clj:435)
	at clojure.main$repl.doInvoke(main.clj:345)
	at clojure.lang.RestFn.invoke(RestFn.java:1523)
	at nrepl.middleware.interruptible_eval$evaluate$fn__1179.invoke(interruptible_eval.clj:93)
	at clojure.lang.AFn.applyToHelper(AFn.java:152)
	at clojure.lang.AFn.applyTo(AFn.java:144)
	at clojure.core$apply.invokeStatic(core.clj:665)
	at clojure.core$with_bindings_STAR_.invokeStatic(core.clj:1973)
	at clojure.core$with_bindings_STAR_.doInvoke(core.clj:1973)
	at clojure.lang.RestFn.invoke(RestFn.java:425)
	at nrepl.middleware.interruptible_eval$evaluate.invokeStatic(interruptible_eval.clj:91)
	at nrepl.middleware.interruptible_eval$evaluate.invoke(interruptible_eval.clj:60)
	at nrepl.middleware.interruptible_eval$interruptible_eval$fn__1221$fn__1224.invoke(interruptible_eval.clj:231)
	at nrepl.middleware.interruptible_eval$run_next$fn__1216.invoke(interruptible_eval.clj:199)
	at clojure.lang.AFn.run(AFn.java:22)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	... 2 more</pre>
And the client cannot be stopped with ctrl-C due to <code>Exception in thread &quot;SIGINT handler&quot; java.net.SocketException: Broken pipe (Write failed)</code></z><z id="t1549397520" t="Jakub HolÃ½ (HolyJak) Hello! A while ago I asked how to inject objects from Java into the environment of a Clojure REPL it started but no answer fit my needs. So here is mine https://engineering.telia.no/blog/java-troubleshooting-on-steroids-with-clojure-repl/ Perhaps somebody will too find it useful "><y>#</y><d>2019-02-05</d><h>20:12</h><w>Jakub HolÃ½ (HolyJak)</w>Hello! A while ago I asked how to inject objects from Java into the environment of a Clojure REPL it started but no answer fit my needs. So here is mine <a href="https://engineering.telia.no/blog/java-troubleshooting-on-steroids-with-clojure-repl/" target="_blank">https://engineering.telia.no/blog/java-troubleshooting-on-steroids-with-clojure-repl/</a> Perhaps somebody will too find it useful </z><z id="t1549709279" t="pez This is a cider-nrepl question, let me know if this is not the right place to ask. Anyway: I am trying to fix a bug/shortcoming in Calva that when running tests for a namespace/file the tests for itâ€™s test ns (same ns with -test appended) are not run unless that namespace is loaded. For project tests there is a load? key I can set to true on the message, but there is no such thing for namespace tests. Iâ€™ve tried to figure out from the Cider code how it is done there, but I do not quite follow whatâ€™s happening. Can I haz some pointers, pretty please? â¤ï¸"><y>#</y><d>2019-02-09</d><h>10:47</h><w>pez</w>This is a <code>cider-nrepl</code> question, let me know if this is not the right place to ask. Anyway: I am trying to fix a bug/shortcoming in Calva that when running tests for a namespace/file the tests for itâ€™s test ns (same ns with <code>-test</code> appended) are not run unless that namespace is loaded. For project tests there is a <code>load?</code> key I can set to true on the message, but there is no such thing for namespace tests. Iâ€™ve tried to figure out from the Cider code how it is done there, but I do not quite follow whatâ€™s happening. Can I haz some pointers, pretty please? <b>â¤ï¸</b></z><z id="t1549709903" t="dominicm There is a key which can load all project namespaces."><y>#</y><d>2019-02-09</d><h>10:58</h><w>dominicm</w>There is a key which can load all project namespaces.</z><z id="t1549709927" t="dominicm Maybe orchard could be updated to minimize how much it loads based on the size of the query? "><y>#</y><d>2019-02-09</d><h>10:58</h><w>dominicm</w>Maybe orchard could be updated to minimize how much it loads based on the size of the query? </z><z id="t1549709948" t="dominicm But generally, loading project namespaces works."><y>#</y><d>2019-02-09</d><h>10:59</h><w>dominicm</w>But generally, loading project namespaces works.</z><z id="t1549712861" t="pez Thanks! Iâ€™ll load all namespaces for now. However, Cider has commands for running tests only for loaded namespaces in the project (thatâ€™s what happens if you donâ€™t pass that load? key to the test-all op). That indicates that Cider does not load all namespaces for running the namespace tests, or I am getting that wrong, maybe?"><y>#</y><d>2019-02-09</d><h>11:47</h><w>pez</w>Thanks! Iâ€™ll load all namespaces for now. However, Cider has commands for running tests only for loaded namespaces in the project (thatâ€™s what happens if you donâ€™t pass that <code>load?</code> key to the <code>test-all</code> op). That indicates that Cider does not load all namespaces for running the namespace tests, or I am getting that wrong, maybe?</z><z id="t1549713154" t="dominicm Oh. Maybe. I wrote this ages ago, so I&apos;ve forgotten how it works."><y>#</y><d>2019-02-09</d><h>11:52</h><w>dominicm</w>Oh. Maybe. I wrote this ages ago, so I&apos;ve forgotten how it works.</z><z id="t1549713182" t="dominicm Reading the source in orchard is the best bet"><y>#</y><d>2019-02-09</d><h>11:53</h><w>dominicm</w>Reading the source in orchard is the best bet</z><z id="t1549713501" t="pez Iâ€™m trying, believe me! As my competitor, Andrey Lisin, says. ðŸ˜ƒ"><y>#</y><d>2019-02-09</d><h>11:58</h><w>pez</w>Iâ€™m trying, believe me! As my competitor, Andrey Lisin, says. <b>ðŸ˜ƒ</b></z><z id="t1549713789" t="dominicm Did you find https://github.com/clojure-emacs/orchard/blob/master/src/orchard/query.clj ? "><y>#</y><d>2019-02-09</d><h>12:03</h><w>dominicm</w>Did you find <a href="https://github.com/clojure-emacs/orchard/blob/master/src/orchard/query.clj" target="_blank">https://github.com/clojure-emacs/orchard/blob/master/src/orchard/query.clj</a> ? </z><z id="t1549713902" t="dominicm Cider test just does this: :load-project-ns? load?"><y>#</y><d>2019-02-09</d><h>12:05</h><w>dominicm</w>Cider test just does this: <code>:load-project-ns? load?</code></z><z id="t1549713911" t="dominicm Iirc, that&apos;s what load did before."><y>#</y><d>2019-02-09</d><h>12:05</h><w>dominicm</w>Iirc, that&apos;s what load did before.</z><z id="t1549714995" t="pez No, didnâ€™t find, thanks again! What I got from the cider-test code was that it only did that for running project tests, not when running tests for some given namespaces. But I could have gotten it wrong."><y>#</y><d>2019-02-09</d><h>12:23</h><w>pez</w>No, didnâ€™t find, thanks again! What I got from the cider-test code was that it only did that for running project tests, not when running tests for some given namespaces. But I could have gotten it wrong.</z><z id="t1549716779" t="dominicm Those specific things are legacy, use the test-var-query instead"><y>#</y><d>2019-02-09</d><h>12:52</h><w>dominicm</w>Those specific things are legacy, use the test-var-query instead</z><z id="t1549716998" t="pez Ah, now weâ€™re talking! Is there somewhere I can read up on these things?"><y>#</y><d>2019-02-09</d><h>12:56</h><w>pez</w>Ah, now weâ€™re talking! Is there somewhere I can read up on these things?</z><z id="t1549717240" t="dominicm Asking is probably it :D"><y>#</y><d>2019-02-09</d><h>13:00</h><w>dominicm</w>Asking is probably it :D</z><z id="t1549717560" t="dominicm I&apos;m pretty bad at writing things down :)"><y>#</y><d>2019-02-09</d><h>13:06</h><w>dominicm</w>I&apos;m pretty bad at writing things down :)</z><z id="t1549717584" t="dominicm I came up with this test var query stuff when I rewrote apropos to be more general"><y>#</y><d>2019-02-09</d><h>13:06</h><w>dominicm</w>I came up with this test var query stuff when I rewrote apropos to be more general</z><z id="t1549717606" t="pez So, I am beginning to understand why you linked me to orchard/queryâ€¦ But I am not quite there yet, what is a var-query? What is an ns-query?"><y>#</y><d>2019-02-09</d><h>13:06</h><w>pez</w>So, I am beginning to understand why you linked me to orchard/queryâ€¦  But I am not quite there yet, what is a var-query? What is an ns-query?</z><z id="t1549717711" t="pez btw. Doing ns-load-all before running tests for a namespaces worked, but it is brutal and makes the first namespace test run take a long time in large projects."><y>#</y><d>2019-02-09</d><h>13:08</h><w>pez</w>btw. Doing ns-load-all before running tests for a namespaces worked, but it is brutal and makes the first namespace test run take a long time in large projects.</z><z id="t1549717780" t="dominicm Var-query is best documented on that orchard docstring, it&apos;s a data description for filtering vars/nss to be the target of an operation"><y>#</y><d>2019-02-09</d><h>13:09</h><w>dominicm</w>Var-query is best documented on that orchard docstring, it&apos;s a data description for filtering vars/nss to be the target of an operation</z><z id="t1549717814" t="pez Iâ€™ll read it more carefully this time then. ðŸ˜ƒ"><y>#</y><d>2019-02-09</d><h>13:10</h><w>pez</w>Iâ€™ll read it more carefully this time then. <b>ðŸ˜ƒ</b></z><z id="t1549718011" t="dominicm Only test and apropos support it for now, but if you can think of somewhere to apply it, that would be cool"><y>#</y><d>2019-02-09</d><h>13:13</h><w>dominicm</w>Only test and apropos support it for now, but if you can think of somewhere to apply it, that would be cool</z><z id="t1549718039" t="pez Looks like I will be able to use this to allow testing of the test under the cursor, right?"><y>#</y><d>2019-02-09</d><h>13:13</h><w>pez</w>Looks like I will be able to use this to allow testing of the test under the cursor, right?</z><z id="t1549718230" t="dominicm Yep! "><y>#</y><d>2019-02-09</d><h>13:17</h><w>dominicm</w>Yep! </z><z id="t1549718279" t="dominicm But you&apos;ll need to identify the test using regex, fireplace has one"><y>#</y><d>2019-02-09</d><h>13:17</h><w>dominicm</w>But you&apos;ll need to identify the test using regex, fireplace has one</z><z id="t1549718521" t="dominicm Maybe refresh would be a cool place to apply this. You could refresh just your test namespaces..."><y>#</y><d>2019-02-09</d><h>13:22</h><w>dominicm</w>Maybe refresh would be a cool place to apply this. You could refresh just your test namespaces...</z><z id="t1549720179" t="pez So, now I run the namespace tests using test-var-query instead, thatâ€™s cool. But I still fail at finding the -test tests, because not loaded. Adding a truthful load-project-ns? to the ns-query doesnâ€™t seem to do anything. This is how my op looks like right now (TypeScript): op: &quot;test-var-query&quot;, ns, id, session: this.sessionId, &quot;var-query&quot;: { &quot;ns-query&quot;: { exactly: [ns], &quot;load-project-ns?&quot;: true } } "><y>#</y><d>2019-02-09</d><h>13:49</h><w>pez</w>So, now I run the namespace tests using test-var-query instead, thatâ€™s cool. But I still fail at finding the <code>-test</code> tests, because not loaded. Adding a truthful <code>load-project-ns?</code> to the ns-query doesnâ€™t seem to do anything. This is how my op looks like right now (TypeScript): <pre>op: &quot;test-var-query&quot;, ns, id, session: this.sessionId, &quot;var-query&quot;: {
                    &quot;ns-query&quot;: {
                        exactly: [ns],
                        &quot;load-project-ns?&quot;: true
                    }
                }
</pre></z><z id="t1549725772" t="dominicm What does true become over bencode? You might want to use 1 or something"><y>#</y><d>2019-02-09</d><h>15:22</h><w>dominicm</w>What does true become over bencode? You might want to use 1 or something</z><z id="t1549730245" t="pez true works elsewhere. But I did try with 1 as well since that is what replant does. ðŸ˜ƒ Looking at the query code, am I correct in reading it as it only considers load-project-ns? if project? also is true? https://github.com/clojure-emacs/orchard/blob/master/src/orchard/query.clj#L23"><y>#</y><d>2019-02-09</d><h>16:37</h><w>pez</w><code>true</code> works elsewhere. But I did try with 1 as well since that is what replant does. <b>ðŸ˜ƒ</b> Looking at the query code, am I correct in reading it as it only considers <code>load-project-ns?</code> if <code>project?</code> also is true? <a href="https://github.com/clojure-emacs/orchard/blob/master/src/orchard/query.clj#L23" target="_blank">https://github.com/clojure-emacs/orchard/blob/master/src/orchard/query.clj#L23</a></z><z id="t1549730296" t="pez (Not that it works setting that to true as well, but anyway.)"><y>#</y><d>2019-02-09</d><h>16:38</h><w>pez</w>(Not that it works setting that to true as well, but anyway.)</z><z id="t1549730907" t="dominicm It might be that is a bug :)"><y>#</y><d>2019-02-09</d><h>16:48</h><w>dominicm</w>It might be that is a bug :)</z><z id="t1549730915" t="dominicm Up to us to define behaviour"><y>#</y><d>2019-02-09</d><h>16:48</h><w>dominicm</w>Up to us to define behaviour</z><z id="t1549731171" t="dominicm I personally don&apos;t have a problem with that behaviour being changed. I don&apos;t think any users of cider would either. It wouldn&apos;t be an API change. If you wanted to be really crazy, you could grow the api to hold onto the old behaviour."><y>#</y><d>2019-02-09</d><h>16:52</h><w>dominicm</w>I personally don&apos;t have a problem with that behaviour being changed. I don&apos;t think any users of cider would either. It wouldn&apos;t be an API change. If you wanted to be really crazy, you could grow the api to hold onto the old behaviour.</z><z id="t1549731197" t="dominicm I didn&apos;t notice this behaviour particularly myself, but I always run with project set to true."><y>#</y><d>2019-02-09</d><h>16:53</h><w>dominicm</w>I didn&apos;t notice this behaviour particularly myself, but I always run with project set to true.</z><z id="t1549733668" t="pez The strange thing is that it doesnâ€™t have an effect for me to set both to trueâ€¦"><y>#</y><d>2019-02-09</d><h>17:34</h><w>pez</w>The strange thing is that it doesnâ€™t have an effect for me to set both to trueâ€¦</z><z id="t1549733739" t="dominicm Double check how nrepl modified the value"><y>#</y><d>2019-02-09</d><h>17:35</h><w>dominicm</w>Double check how nrepl modified the value</z><z id="t1549733896" t="pez Regardless, it does seem wrong that they should be coupled like that (if that is what they are)."><y>#</y><d>2019-02-09</d><h>17:38</h><w>pez</w>Regardless, it does seem wrong that they should be coupled like that (if that is what they are).</z><z id="t1549733951" t="dominicm I agree too :)"><y>#</y><d>2019-02-09</d><h>17:39</h><w>dominicm</w>I agree too :)</z><z id="t1549733991" t="pez Yeah, Iâ€™ll peek into what happens to the values. But later, now family needs food. ðŸ˜ƒ Thanks for the assistance so far!"><y>#</y><d>2019-02-09</d><h>17:39</h><w>pez</w>Yeah, Iâ€™ll peek into what happens to the values. But later, now family needs food. <b>ðŸ˜ƒ</b> Thanks for the assistance so far!</z><z id="t1549734011" t="dominicm https://github.com/clojure-emacs/cider-nrepl/blob/master/src/cider/nrepl/middleware/util/coerce.clj just fyo"><y>#</y><d>2019-02-09</d><h>17:40</h><w>dominicm</w><a href="https://github.com/clojure-emacs/cider-nrepl/blob/master/src/cider/nrepl/middleware/util/coerce.clj" target="_blank">https://github.com/clojure-emacs/cider-nrepl/blob/master/src/cider/nrepl/middleware/util/coerce.clj</a> just fyo</z><z id="t1549734202" t="dominicm So I think you are in the right place. All I can guess is that the code to load project ns isn&apos;t working in your context."><y>#</y><d>2019-02-09</d><h>17:43</h><w>dominicm</w>So I think you are in the right place. All I can guess is that the code to load project ns isn&apos;t working in your context.</z><z id="t1549736466" t="pez It is a bit extra strange that the ns-load-all op works, which uses the exact same function for loadingâ€¦ I think I am doing something wrong, but weâ€™ll see."><y>#</y><d>2019-02-09</d><h>18:21</h><w>pez</w>It is a bit extra strange that the <code>ns-load-all</code> op works, which uses the exact same function for loadingâ€¦ I think I am doing something wrong, but weâ€™ll see.</z><z id="t1549783756" t="dominicm Did you get anywhere? :)"><y>#</y><d>2019-02-10</d><h>07:29</h><w>dominicm</w>Did you get anywhere? :)</z><z id="t1549794334" t="pez I am working around it for my own needs for now. Part of the problem for me was that I came in to it with the wrong expectations. Thinking that there ought to be a way to tell cider-nrepl to load the namespaces I was asking it to test for me. But it seems that Cider users are used to loading the -test namespaces themselves. Right now I am trying to figure out how to load the -test namespace when Calva runs tests for a namespace. There is a curious lack of a load-ns op. ðŸ˜ƒ"><y>#</y><d>2019-02-10</d><h>10:25</h><w>pez</w>I am working around it for my own needs for now. Part of the problem for me  was that I came in to it with the wrong expectations. Thinking that there ought to be a way to tell cider-nrepl to load the namespaces I was asking it to test for me. But it seems that Cider users are used to loading the <code>-test</code> namespaces themselves. Right now I am trying to figure out how to load the <code>-test</code> namespace when Calva runs tests for a namespace. There is a curious lack of a <code>load-ns</code> op. <b>ðŸ˜ƒ</b></z><z id="t1549794478" t="pez Regarding orchard/query I can fiddle some with it once I have gotten this Calva behaviour down. At least try to find out if there is a bug there with the project? key, if that would help you?"><y>#</y><d>2019-02-10</d><h>10:27</h><w>pez</w>Regarding orchard/query I can fiddle some with it once I have gotten this Calva behaviour down. At least try to find out if there is a bug there with the <code>project?</code> key, if that would help you?</z><z id="t1549795959" t="dominicm Fwiw, I don&apos;t always put my tests in -test, so make sure to test the current ns too. "><y>#</y><d>2019-02-10</d><h>10:52</h><w>dominicm</w>Fwiw, I don&apos;t always put my tests in -test, so make sure to test the current ns too. </z><z id="t1549795969" t="dominicm If you&apos;re happy, don&apos;t go out of your way :)"><y>#</y><d>2019-02-10</d><h>10:52</h><w>dominicm</w>If you&apos;re happy, don&apos;t go out of your way :)</z><z id="t1549795991" t="dominicm I think I prefer your solution anyway."><y>#</y><d>2019-02-10</d><h>10:53</h><w>dominicm</w>I think I prefer your solution anyway.</z><z id="t1550072962" t="pez Forgot to update on this. I solved my issue w/o relying on that load-project-ns? thing. Thanks for help and encouragement!"><y>#</y><d>2019-02-13</d><h>15:49</h><r>pez</r>Forgot to update on this. I solved my issue w/o relying on that <code>load-project-ns?</code> thing. Thanks for help and encouragement!</z><z id="t1550250232" t="hkupty Hi folks. Does anyone knows if there&apos;s a way for me to transform a string map return from eval to an actual map? I&apos;m getting {&apos;value&apos;: &apos;{&quot;key&quot; [&quot;v1&quot; &quot;v2&quot;]}&apos; and I&apos;m trying to get that as an actual map instead of a clojure stringified version of the map. Is there any nrepl op that can help me with that?"><y>#</y><d>2019-02-15</d><h>17:03</h><w>hkupty</w>Hi folks. Does anyone knows if there&apos;s a way for me to transform a string map return from <code>eval</code> to an actual map? I&apos;m getting <code>{&apos;value&apos;: &apos;{&quot;key&quot; [&quot;v1&quot; &quot;v2&quot;]}&apos;</code> and I&apos;m trying to get that as an actual map instead of a clojure stringified version of the map. Is there any nrepl op that can help me with that?</z><z id="t1550250557" t="dominicm Not really no, you will need to contribute nrepl middleware"><y>#</y><d>2019-02-15</d><h>17:09</h><w>dominicm</w>Not really no, you will need to contribute nrepl middleware</z><z id="t1550439232" t="dominicm I have a bit of a dilemma."><y>#</y><d>2019-02-17</d><h>21:33</h><w>dominicm</w>I have a bit of a dilemma.</z><z id="t1550439325" t="dominicm Fireplace doesn&apos;t require cider-nrepl. But the current pprint default is cider.fipp because that&apos;s fine: it would only be interpreted of cider was loaded."><y>#</y><d>2019-02-17</d><h>21:35</h><w>dominicm</w>Fireplace doesn&apos;t require cider-nrepl. But the current pprint default is cider.fipp because that&apos;s fine: it would only be interpreted of cider was loaded.</z><z id="t1550439351" t="dominicm I suppose fireplace will have to default to clojure.pprint, which is unfortunately slow and prone to StackOverflows"><y>#</y><d>2019-02-17</d><h>21:35</h><w>dominicm</w>I suppose fireplace will have to default to clojure.pprint, which is unfortunately slow and prone to StackOverflows</z><z id="t1550442655" t="cichli Itâ€™s also a shame how clojure.pprint rebinds *out* , but on the other hand it pretty prints some things that fipp does not (e.g. Datomic entities; see https://github.com/clojure-emacs/cider/issues/1505 )"><y>#</y><d>2019-02-17</d><h>22:30</h><w>cichli</w>Itâ€™s also a shame how clojure.pprint rebinds <code>*out*</code>, but on the other hand it pretty prints some things that fipp does not (e.g. Datomic entities; see <a href="https://github.com/clojure-emacs/cider/issues/1505" target="_blank">https://github.com/clojure-emacs/cider/issues/1505</a>)</z><z id="t1550443069" t="dominicm That&apos;s a benefit of the native integration."><y>#</y><d>2019-02-17</d><h>22:37</h><w>dominicm</w>That&apos;s a benefit of the native integration.</z><z id="t1550443106" t="dominicm I wonder if fipp could use pprint instead of prn when unsure. It would hurt performance though."><y>#</y><d>2019-02-17</d><h>22:38</h><w>dominicm</w>I wonder if fipp could use pprint instead of prn when unsure. It would hurt performance though.</z><z id="t1550490065" t="cichli It actually just falls back to a tagged representation using str [1][2] and avoids using any of the pr machinery â€“ but Iâ€™d say thatâ€™s a virtue, since it means fipp can guarantee anything it prints is valid EDN (ignoring the print-length and print-level settings). pr only promises that anything it prints can be read by the Clojure (JVM) reader [1]: https://github.com/brandonbloom/fipp/blob/master/src/fipp/ednize.clj#L38-L42 [2]: https://github.com/brandonbloom/fipp/blob/master/src/fipp/edn.cljc#L68-L73"><y>#</y><d>2019-02-18</d><h>11:41</h><w>cichli</w>It actually just falls back to a tagged representation using <code>str</code> [1][2] and avoids using any of the <code>pr</code> machinery â€“ but Iâ€™d say thatâ€™s a virtue, since it means fipp can guarantee anything it prints is valid EDN (ignoring the <code>print-length</code> and <code>print-level</code> settings). <code>pr</code> only promises that anything it prints can be read by the Clojure (JVM) reader

[1]: <a href="https://github.com/brandonbloom/fipp/blob/master/src/fipp/ednize.clj#L38-L42" target="_blank">https://github.com/brandonbloom/fipp/blob/master/src/fipp/ednize.clj#L38-L42</a>
[2]: <a href="https://github.com/brandonbloom/fipp/blob/master/src/fipp/edn.cljc#L68-L73" target="_blank">https://github.com/brandonbloom/fipp/blob/master/src/fipp/edn.cljc#L68-L73</a></z><z id="t1550490139" t="dominicm puget seems to do something a bit special here too, going to investigate that a little, but for another project really."><y>#</y><d>2019-02-18</d><h>11:42</h><w>dominicm</w>puget seems to do something a bit special here too, going to investigate that a little, but for another project really.</z><z id="t1550500678" t="eraserhd I have a bit of polish before first real announce, but select-nrepl is now quite usable. This leverages rewrite-clj and provides ops for finding and selecting the current element, form, or toplevel in some code. https://github.com/eraserhd/select-nrepl"><y>#</y><d>2019-02-18</d><h>14:37</h><w>eraserhd</w>I have a bit of polish before first real announce, but <code>select-nrepl</code> is now quite usable.  This leverages rewrite-clj and provides ops for finding and selecting the current element, form, or toplevel in some code. <a href="https://github.com/eraserhd/select-nrepl" target="_blank">https://github.com/eraserhd/select-nrepl</a></z><z id="t1550500781" t="eraserhd It&apos;s smart about what to do if some object is already selected - e.g. repeatedly selecting an element will iterate through elements left-to-right, regardless of nesting. repeatedly selecting forms will find the next-larger form. toplevels will move to the next toplevel."><y>#</y><d>2019-02-18</d><h>14:39</h><w>eraserhd</w>It&apos;s smart about what to do if some object is already selected - e.g. repeatedly selecting an element will iterate through elements left-to-right, regardless of nesting.  repeatedly selecting forms will find the next-larger form.  toplevels will move to the next toplevel.</z><z id="t1550500885" t="eraserhd (Also, selecting objects also takes surrounding metadata and other reader embellishments)"><y>#</y><d>2019-02-18</d><h>14:41</h><w>eraserhd</w>(Also, selecting objects also takes surrounding metadata and other reader embellishments)</z><z id="t1550501751" t="dominicm that&apos;s awesome"><y>#</y><d>2019-02-18</d><h>14:55</h><w>dominicm</w>that&apos;s awesome</z><z id="t1550827573" t="dominicm [:attrs {:href &quot;/_/_/users/U052B0PT3&quot;}] I&apos;ve had a bug report come my way which appears to be a bug in nrepl 0.6.0&apos;s printing stack. https://github.com/rgm/reframe-template/issues/1 I can&apos;t see how the replying-PrintWriter function is ever being called, because vim will never send stream? true . Somehow it looks related to the piggieback stack? But I&apos;m not sure of that much either. I was hoping something might stand out to you as why that would be called with that particular stack?"><y>#</y><d>2019-02-22</d><h>09:26</h><w>dominicm</w><a>@cichli</a> I&apos;ve had a bug report come my way which appears to be a bug in nrepl 0.6.0&apos;s printing stack. <a href="https://github.com/rgm/reframe-template/issues/1" target="_blank">https://github.com/rgm/reframe-template/issues/1</a> I can&apos;t see how the replying-PrintWriter function is ever being called, because vim will never send <code>stream? true</code>. Somehow it looks related to the piggieback stack? But I&apos;m not sure of that much either. I was hoping something might stand out to you as why that would be called with that particular stack?</z><z id="t1550828919" t="dominicm https://github.com/nrepl/nrepl/blob/7721f2f8910faa00a278b52d608a1a6781c2fe0e/src/clojure/nrepl/middleware/interruptible_eval.clj#L76 looks like interruptible eval uses this directly."><y>#</y><d>2019-02-22</d><h>09:48</h><w>dominicm</w><a href="https://github.com/nrepl/nrepl/blob/7721f2f8910faa00a278b52d608a1a6781c2fe0e/src/clojure/nrepl/middleware/interruptible_eval.clj#L76" target="_blank">https://github.com/nrepl/nrepl/blob/7721f2f8910faa00a278b52d608a1a6781c2fe0e/src/clojure/nrepl/middleware/interruptible_eval.clj#L76</a> looks like interruptible eval uses this directly.</z><z id="t1550829142" t="cichli It might be a piggieback issue, it does some manual bookkeeping to make sure *out* and *err* are bound correctly. But Iâ€™m not sure why transport would be nil"><y>#</y><d>2019-02-22</d><h>09:52</h><w>cichli</w>It might be a piggieback issue, it does some manual bookkeeping to make sure <code>*out*</code> and <code>*err*</code> are bound correctly. But Iâ€™m not sure why <code>transport</code> would be nil</z><z id="t1550829246" t="cichli What exactly does :Piggieback eval to start the cljs repl?"><y>#</y><d>2019-02-22</d><h>09:54</h><w>cichli</w>What exactly does <code>:Piggieback</code> eval to start the cljs repl?</z><z id="t1550830218" t="dominicm java.lang.Exception: Stack trace at java.base/java.lang.Thread.dumpStack(Thread.java:1387) at nrepl.middleware.print$replying_PrintWriter.invokeStatic(print.clj:105) at nrepl.middleware.print$replying_PrintWriter.invoke(print.clj:99) at nrepl.middleware.interruptible_eval$evaluate.invokeStatic(interruptible_eval.clj:76) at nrepl.middleware.interruptible_eval$evaluate.invoke(interruptible_eval.clj:55) at nrepl.middleware.session$create_session$fn__8988.invoke(session.clj:143) at nrepl.middleware.session$create_session.invokeStatic(session.clj:142) at nrepl.middleware.session$create_session.invoke(session.clj:124) at nrepl.middleware.session$register_session.invokeStatic(session.clj:201) at nrepl.middleware.session$register_session.invoke(session.clj:197) at nrepl.middleware.session$session$fn__9029.invoke(session.clj:267) at nrepl.middleware$wrap_conj_descriptor$fn__8584.invoke(middleware.clj:16) at cider.nrepl$wrap_enlighten$fn__9440.invoke(nrepl.clj:162) at nrepl.middleware$wrap_conj_descriptor$fn__8584.invoke(middleware.clj:16) at nrepl.middleware.print$wrap_print$fn__8808.invoke(print.clj:238) at nrepl.middleware$wrap_conj_descriptor$fn__8584.invoke(middleware.clj:16) at nrepl.server$handle_STAR_.invokeStatic(server.clj:18) at nrepl.server$handle_STAR_.invoke(server.clj:15) at nrepl.server$handle$fn__9066.invoke(server.clj:27) at clojure.core$binding_conveyor_fn$fn__5739.invoke(core.clj:2030) at clojure.lang.AFn.call(AFn.java:18) at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264) at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128) at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628) at java.base/java.lang.Thread.run(Thread.java:834) Oh, fwiw, this is the trace of creating the printwriter"><y>#</y><d>2019-02-22</d><h>10:10</h><w>dominicm</w><pre>java.lang.Exception: Stack trace
        at java.base/java.lang.Thread.dumpStack(Thread.java:1387)
        at nrepl.middleware.print$replying_PrintWriter.invokeStatic(print.clj:105)
        at nrepl.middleware.print$replying_PrintWriter.invoke(print.clj:99)
        at nrepl.middleware.interruptible_eval$evaluate.invokeStatic(interruptible_eval.clj:76)
        at nrepl.middleware.interruptible_eval$evaluate.invoke(interruptible_eval.clj:55)
        at nrepl.middleware.session$create_session$fn__8988.invoke(session.clj:143)
        at nrepl.middleware.session$create_session.invokeStatic(session.clj:142)
        at nrepl.middleware.session$create_session.invoke(session.clj:124)
        at nrepl.middleware.session$register_session.invokeStatic(session.clj:201)
        at nrepl.middleware.session$register_session.invoke(session.clj:197)
        at nrepl.middleware.session$session$fn__9029.invoke(session.clj:267)
        at nrepl.middleware$wrap_conj_descriptor$fn__8584.invoke(middleware.clj:16)
        at cider.nrepl$wrap_enlighten$fn__9440.invoke(nrepl.clj:162)
        at nrepl.middleware$wrap_conj_descriptor$fn__8584.invoke(middleware.clj:16)
        at nrepl.middleware.print$wrap_print$fn__8808.invoke(print.clj:238)
        at nrepl.middleware$wrap_conj_descriptor$fn__8584.invoke(middleware.clj:16)
        at nrepl.server$handle_STAR_.invokeStatic(server.clj:18)
        at nrepl.server$handle_STAR_.invoke(server.clj:15)
        at nrepl.server$handle$fn__9066.invoke(server.clj:27)
        at clojure.core$binding_conveyor_fn$fn__5739.invoke(core.clj:2030)
        at clojure.lang.AFn.call(AFn.java:18)
        at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)
        at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)
        at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)
        at java.base/java.lang.Thread.run(Thread.java:834)
</pre>

Oh, fwiw, this is the trace of creating the printwriter</z><z id="t1550830285" t="dominicm Piggieback does https://github.com/tpope/vim-fireplace/blob/1ef0f0726cadd96547a5f79103b66339f170da02/plugin/fireplace.vim#L323-L325 So (cider.piggieback/cljs-repl (whatever-you-give-it))"><y>#</y><d>2019-02-22</d><h>10:11</h><w>dominicm</w>Piggieback does <a href="https://github.com/tpope/vim-fireplace/blob/1ef0f0726cadd96547a5f79103b66339f170da02/plugin/fireplace.vim#L323-L325" target="_blank">https://github.com/tpope/vim-fireplace/blob/1ef0f0726cadd96547a5f79103b66339f170da02/plugin/fireplace.vim#L323-L325</a>

So <code>(cider.piggieback/cljs-repl (whatever-you-give-it))</code></z><z id="t1550830337" t="dominicm ^ some of the numbers in the stack may be out a little, I&apos;ve been sprinkling println debugging in"><y>#</y><d>2019-02-22</d><h>10:12</h><w>dominicm</w>^ some of the numbers in the stack may be out a little, I&apos;ve been sprinkling println debugging in</z><z id="t1550830497" t="dominicm https://github.com/nrepl/nrepl/blob/7721f2f8910faa00a278b52d608a1a6781c2fe0e/src/clojure/nrepl/middleware/session.clj#L140 this looks like it could be the issue? Transport isn&apos;t being conveyed here"><y>#</y><d>2019-02-22</d><h>10:14</h><w>dominicm</w><a href="https://github.com/nrepl/nrepl/blob/7721f2f8910faa00a278b52d608a1a6781c2fe0e/src/clojure/nrepl/middleware/session.clj#L140" target="_blank">https://github.com/nrepl/nrepl/blob/7721f2f8910faa00a278b52d608a1a6781c2fe0e/src/clojure/nrepl/middleware/session.clj#L140</a> this looks like it could be the issue? Transport isn&apos;t being conveyed here</z><z id="t1550830538" t="dominicm Adding :transport there fixes the bug for me"><y>#</y><d>2019-02-22</d><h>10:15</h><w>dominicm</w>Adding <code>:transport</code> there fixes the bug for me</z><z id="t1550830806" t="cichli Just realised the same thing ðŸ˜„"><y>#</y><d>2019-02-22</d><h>10:20</h><w>cichli</w>Just realised the same thing <b>ðŸ˜„</b></z><z id="t1550830826" t="cichli As a workaround: just make sure you eval something in the session before calling piggieback"><y>#</y><d>2019-02-22</d><h>10:20</h><w>cichli</w>As a workaround: just make sure you eval something in the session before calling piggieback</z><z id="t1550830928" t="cichli I think we donâ€™t want to pass transport there â€“ otherwise initialising the bindings would cause responses to be sent on the transport"><y>#</y><d>2019-02-22</d><h>10:22</h><w>cichli</w>I think we donâ€™t want to pass <code>transport</code> there â€“ otherwise initialising the bindings would cause responses to be sent on the transport</z><z id="t1550831039" t="cichli But piggieback should definitely be creating new PrintWriter s for each eval message, same as nrepl does. Capturing them from @session is relying on nrepl implementation details"><y>#</y><d>2019-02-22</d><h>10:23</h><w>cichli</w>But piggieback should definitely be creating new <code>PrintWriter</code>s for each eval message, same as nrepl does. Capturing them from <code>@session</code> is relying on nrepl implementation details</z><z id="t1550831427" t="dominicm That workaround may not work. I think fireplace creates a new session for cljs, which is only available there."><y>#</y><d>2019-02-22</d><h>10:30</h><w>dominicm</w>That workaround may not work. I think fireplace creates a new session for cljs, which is only available there.</z><z id="t1550861250" t="cichli Just looking at the fireplace code, it looks like it does clone up a new session (see line 308). Does adding connection.eval(&quot;nil&quot;) on the line before the piggieback eval workaround the problem?"><y>#</y><d>2019-02-22</d><h>18:47</h><r>cichli</r>Just looking at the fireplace code, it looks like it does <code>clone</code> up a new session (see line 308). Does adding <code>connection.eval(&quot;nil&quot;)</code> on the line before the piggieback <code>eval</code> workaround the problem?</z><z id="t1550861575" t="dominicm [:attrs {:href &quot;/_/_/users/U08BW7V1V&quot;}] you&apos;ll be at a keyboard sooner than me ^^ :)"><y>#</y><d>2019-02-22</d><h>18:52</h><r>dominicm</r><a>@rgm</a> you&apos;ll be at a keyboard sooner than me ^^ :)</z><z id="t1550865385" t="cichli It shouldnâ€™t be needed with the new piggieback though"><y>#</y><d>2019-02-22</d><h>19:56</h><r>cichli</r>It shouldnâ€™t be needed with the new piggieback though</z><z id="t1550900373" t="rgm Victory! OK â€¦ so I needed to do a couple things:"><y>#</y><d>2019-02-23</d><h>05:39</h><r>rgm</r>Victory! OK â€¦ so I needed to do a couple things:</z><z id="t1550900688" t="rgm 1. bump to 0.4.1-SNAPSHOT, 2. Patch fireplace.vim, 3. Make sure a cljs-repl was started in the terminal REPL, before trying to run :Piggieback"><y>#</y><d>2019-02-23</d><h>05:44</h><r>rgm</r>1. bump to 0.4.1-SNAPSHOT, 2. Patch fireplace.vim, 3. Make sure a cljs-repl was started in the terminal REPL, before trying to run <code>:Piggieback</code></z><z id="t1550900819" t="rgm so itâ€™s finally working (piggieback + vim/fireplace + figwheel + deps.edn) and I made some notes here: https://github.com/rgm/reframe-template/issues/1#issuecomment-466619263"><y>#</y><d>2019-02-23</d><h>05:46</h><r>rgm</r>so itâ€™s finally working (piggieback + vim/fireplace + figwheel + deps.edn) and I made some notes here: <a href="https://github.com/rgm/reframe-template/issues/1#issuecomment-466619263" target="_blank">https://github.com/rgm/reframe-template/issues/1#issuecomment-466619263</a></z><z id="t1550933622" t="dominicm [:attrs {:href &quot;/_/_/users/U052B0PT3&quot;}] that&apos;s working perfectly for me, thanks!"><y>#</y><d>2019-02-23</d><h>14:53</h><r>dominicm</r><a>@cichli</a> that&apos;s working perfectly for me, thanks!</z><z id="t1550831461" t="dominicm You might be able to poke at fireplace to figure it out, but it&apos;s not an easy workaround ðŸ™‚"><y>#</y><d>2019-02-22</d><h>10:31</h><w>dominicm</w>You might be able to poke at fireplace to figure it out, but it&apos;s not an easy workaround <b>ðŸ™‚</b></z><z id="t1550831674" t="cichli Youâ€™re right, it doesnâ€™t use persistent sessions at all IIRC"><y>#</y><d>2019-02-22</d><h>10:34</h><w>cichli</w>Youâ€™re right, it doesnâ€™t use persistent sessions at all IIRC</z><z id="t1550831748" t="cichli I have to go catch a train in a few minutes but Iâ€™ll get a fix into piggieback this afternoon"><y>#</y><d>2019-02-22</d><h>10:35</h><w>cichli</w>I have to go catch a train in a few minutes but Iâ€™ll get a fix into piggieback this afternoon</z><z id="t1550831844" t="dominicm [:attrs {:href &quot;/_/_/users/U052B0PT3&quot;}] that&apos;s awesome, thank you! â¤ï¸ This was an interesting one to poke at, reminded me that I need to spend some more time working on nrepl ðŸ™‚"><y>#</y><d>2019-02-22</d><h>10:37</h><w>dominicm</w><a>@cichli</a> that&apos;s awesome, thank you! <b>â¤ï¸</b> This was an interesting one to poke at, reminded me that I need to spend some more time working on nrepl <b>ðŸ™‚</b></z><z id="t1550850753" t="cichli [:attrs {:href &quot;/_/_/users/U08BW7V1V&quot;}] [:attrs {:href &quot;/_/_/users/U09LZR36F&quot;}] any chance you could retest with [cider/piggieback &quot;0.4.1-SNAPSHOT&quot;] ?"><y>#</y><d>2019-02-22</d><h>15:52</h><w>cichli</w><a>@rgm</a> <a>@dominicm</a> any chance you could retest with <code>[cider/piggieback &quot;0.4.1-SNAPSHOT&quot;]</code>?</z><z id="t1550855654" t="rgm Just tried it and with 0.5.3 and 0.6.0/pback 0.4.1-snapshot I get the same ... progress (?) from this comment: https://github.com/rgm/reframe-template/issues/1#issuecomment-466411581"><y>#</y><d>2019-02-22</d><h>17:14</h><w>rgm</w>Just tried it and with 0.5.3 and 0.6.0/pback 0.4.1-snapshot I get the same ... progress (?) from this comment: <a href="https://github.com/rgm/reframe-template/issues/1#issuecomment-466411581" target="_blank">https://github.com/rgm/reframe-template/issues/1#issuecomment-466411581</a></z><z id="t1550855685" t="rgm Running into a morning of meetings but (again) thanks so much for looking into this."><y>#</y><d>2019-02-22</d><h>17:14</h><w>rgm</w>Running into a morning of meetings but (again) thanks so much for looking into this.</z><z id="t1550855810" t="rgm (This has that feeling like thereâ€™s a stack of errors of use, my own misconceptions and new-to-discover minor bugs that Iâ€™ll just have to pop one by one, so I really appreciate the help)."><y>#</y><d>2019-02-22</d><h>17:16</h><w>rgm</w>(This has that feeling like thereâ€™s a stack of errors of use, my own misconceptions and new-to-discover minor bugs that Iâ€™ll just have to pop one by one, so I really appreciate the help).</z><z id="t1550865405" t="cichli If I connect to a regular Clojure REPL and start a CLJS REPL manually with: (cider.piggieback/cljs-repl (figwheel.main.api/repl-env &quot;config/dev&quot;)) then I donâ€™t get the nil IReplEnvOption error, but the first evaluation does raise that same Error: Cannot find module &apos;@cljs-oss/module-deps&apos;"><y>#</y><d>2019-02-22</d><h>19:56</h><w>cichli</w>If I connect to a regular Clojure REPL and start a CLJS REPL manually with: <code>(cider.piggieback/cljs-repl (figwheel.main.api/repl-env &quot;config/dev&quot;))</code> then I donâ€™t get the <code>nil</code> <code>IReplEnvOption</code> error, but the first evaluation does raise that same <code>Error: Cannot find module &apos;@cljs-oss/module-deps&apos;</code></z><z id="t1550865435" t="cichli Possibly related? https://github.com/bhauman/figwheel-main/issues/21"><y>#</y><d>2019-02-22</d><h>19:57</h><w>cichli</w>Possibly related? <a href="https://github.com/bhauman/figwheel-main/issues/21" target="_blank">https://github.com/bhauman/figwheel-main/issues/21</a></z><z id="t1550865663" t="dominicm That message is normal, yeah"><y>#</y><d>2019-02-22</d><h>20:01</h><w>dominicm</w>That message is normal, yeah</z><z id="t1550900819" t="rgm so itâ€™s finally working (piggieback + vim/fireplace + figwheel + deps.edn) and I made some notes here: https://github.com/rgm/reframe-template/issues/1#issuecomment-466619263"><y>#</y><d>2019-02-23</d><h>05:46</h><w>rgm</w>so itâ€™s finally working (piggieback + vim/fireplace + figwheel + deps.edn) and I made some notes here: <a href="https://github.com/rgm/reframe-template/issues/1#issuecomment-466619263" target="_blank">https://github.com/rgm/reframe-template/issues/1#issuecomment-466619263</a></z><z id="t1550886004" t="devth what would be a minimal example of hitting an nrepl, e.g. using something like netcat?"><y>#</y><d>2019-02-23</d><h>01:40</h><w>devth</w>what would be a minimal example of hitting an nrepl, e.g. using something like netcat?</z><z id="t1550886017" t="devth i.e. what&apos;s the hello world of nrepl?"><y>#</y><d>2019-02-23</d><h>01:40</h><w>devth</w>i.e. what&apos;s the hello world of nrepl?</z><z id="t1550886768" t="devth or telnet"><y>#</y><d>2019-02-23</d><h>01:52</h><w>devth</w>or telnet</z><z id="t1550886837" t="devth ok so apparently you can&apos;t use telnet unless you set the tty transport"><y>#</y><d>2019-02-23</d><h>01:53</h><w>devth</w>ok so apparently you can&apos;t use telnet unless you set the tty transport</z><z id="t1550891001" t="devth trying to connect to an nrepl inside a docker container on a remote server. in docker i expose the nrepl (port 65432 ) to the host. then i ssh to the host with port forwarding: ssh -vNL 40000:localhost:65432 my-remote-host i verify there&apos;s a connection (at least i think this means it worked) nc -vv localhost 40000 found 0 associations found 1 connections: 1: flags=82&lt;CONNECTED,PREFERRED&gt; outif lo0 src ::1 port 65316 dst ::1 port 40000 rank info not available TCP aux info available Connection to localhost port 40000 [tcp/safetynetp] succeeded! then try to connect a repl client: lein repl :connect localhost:40000 Warning: implicit middleware found: cider-nrepl.plugin/middleware Please declare all middleware in :middleware as implicit loading is deprecated. Connecting to nREPL at localhost:40000 SocketException The transport&apos;s socket appears to have lost its connection to the nR EPL server nrepl.transport/bencode/fn--5187/fn--5188 (transport.clj:95) nrepl.transport/bencode/fn--5187 (transport.clj:95) nrepl.transport/fn-transport/fn--5159 (transport.clj:42) clojure.core/binding-conveyor-fn/fn--4676 (core.clj:1938) java.util.concurrent.FutureTask.run (FutureTask.java:264) java.util.concurrent.ThreadPoolExecutor.runWorker (ThreadPoolExecutor.java:1 128) java.util.concurrent.ThreadPoolExecutor$Worker.run (ThreadPoolExecutor.java: 628) java.lang.Thread.run (Thread.java:834) Bye for now! logs from ssh tunnel: debug1: Connection to port 40000 forwarding to localhos t port 65432 requested. debug2: fd 8 setting TCP_NODELAY debug1: channel 3: new [direct-tcpip] debug2: channel 3: open confirm rwindow 2097152 rmax 32 768 debug2: channel 3: rcvd eof debug2: channel 3: output open -&gt; drain debug2: channel 3: obuf empty debug2: channel 3: chan_shutdown_write (i0 o1 sock 8 wf d 8 efd -1 [closed]) debug2: channel 3: output drain -&gt; closed debug2: channel 3: read&lt;=0 rfd 8 len 0 debug2: channel 3: read failed debug2: channel 3: chan_shutdown_read (i0 o3 sock 8 wfd 8 efd -1 [closed]) debug2: channel 3: input open -&gt; drain debug2: channel 3: ibuf empty debug2: channel 3: send eof debug2: channel 3: input drain -&gt; closed debug2: channel 3: send close debug2: channel 3: rcvd close debug2: channel 3: is dead debug2: channel 3: garbage collecting debug1: channel 3: free: direct-tcpip: listening port 4 0000 for localhost port 65432, connect from 127.0.0.1 p ort 49790 to 127.0.0.1 port 40000, nchannels 4 any ideas?"><y>#</y><d>2019-02-23</d><h>03:03</h><w>devth</w>trying to connect to an nrepl inside a docker container on a remote server. in docker i expose the nrepl (port <code>65432</code>) to the host. then i ssh to the host with port forwarding:

<pre>ssh -vNL 40000:localhost:65432 my-remote-host
</pre>

i verify there&apos;s a connection (at least i think this means it worked)

<pre>nc -vv localhost 40000
found 0 associations
found 1 connections:
     1: flags=82&lt;CONNECTED,PREFERRED&gt;
        outif lo0
        src ::1 port 65316
        dst ::1 port 40000
        rank info not available
        TCP aux info available

Connection to localhost port 40000 [tcp/safetynetp] succeeded!
</pre>

then try to connect a repl client:

<pre>lein repl :connect localhost:40000
Warning: implicit middleware found: cider-nrepl.plugin/middleware
Please declare all middleware in :middleware as implicit loading is deprecated.
Connecting to nREPL at localhost:40000
SocketException The transport&apos;s socket appears to have lost its connection to the nR
EPL server
        nrepl.transport/bencode/fn--5187/fn--5188 (transport.clj:95)
        nrepl.transport/bencode/fn--5187 (transport.clj:95)
        nrepl.transport/fn-transport/fn--5159 (transport.clj:42)
        clojure.core/binding-conveyor-fn/fn--4676 (core.clj:1938)
        java.util.concurrent.FutureTask.run (FutureTask.java:264)
        java.util.concurrent.ThreadPoolExecutor.runWorker (ThreadPoolExecutor.java:1
128)
        java.util.concurrent.ThreadPoolExecutor$Worker.run (ThreadPoolExecutor.java:
628)
        java.lang.Thread.run (Thread.java:834)
Bye for now!
</pre>

logs from ssh tunnel:


<pre>debug1: Connection to port 40000 forwarding to localhos
t port 65432 requested.
debug2: fd 8 setting TCP_NODELAY
debug1: channel 3: new [direct-tcpip]
debug2: channel 3: open confirm rwindow 2097152 rmax 32
768
debug2: channel 3: rcvd eof
debug2: channel 3: output open -&gt; drain
debug2: channel 3: obuf empty
debug2: channel 3: chan_shutdown_write (i0 o1 sock 8 wf
d 8 efd -1 [closed])
debug2: channel 3: output drain -&gt; closed
debug2: channel 3: read&lt;=0 rfd 8 len 0
debug2: channel 3: read failed
debug2: channel 3: chan_shutdown_read (i0 o3 sock 8 wfd
 8 efd -1 [closed])
debug2: channel 3: input open -&gt; drain
debug2: channel 3: ibuf empty
debug2: channel 3: send eof
debug2: channel 3: input drain -&gt; closed
debug2: channel 3: send close
debug2: channel 3: rcvd close
debug2: channel 3: is dead
debug2: channel 3: garbage collecting
debug1: channel 3: free: direct-tcpip: listening port 4
0000 for localhost port 65432, connect from 127.0.0.1 p
ort 49790 to 127.0.0.1 port 40000, nchannels 4
</pre>

any ideas?</z><z id="t1550893102" t="hiredman what OS? I would try 127.0.0.1 explicitly in the lein connect command"><y>#</y><d>2019-02-23</d><h>03:38</h><w>hiredman</w>what OS? I would try 127.0.0.1 explicitly in the lein connect command</z><z id="t1550940658" t="devth macos locally. ubuntu 16.04 on the server tried 127.0.0.1 - same problem i&apos;m starting the nrepl like: (nrepl/start-server :port nrepl-port :bind &quot;localhost&quot;) "><y>#</y><d>2019-02-23</d><h>16:50</h><r>devth</r>macos locally. ubuntu 16.04 on the server

tried 127.0.0.1 - same problem

i&apos;m starting the nrepl like:

<pre>(nrepl/start-server :port nrepl-port :bind &quot;localhost&quot;)
</pre></z><z id="t1550940689" t="devth verified i can: 1. ssh to host 2. docker exec into container 3. run lein connect and get a repl"><y>#</y><d>2019-02-23</d><h>16:51</h><r>devth</r>verified i can:
1. ssh to host
2. docker exec into container
3. run <code>lein connect</code> and get a repl</z><z id="t1550893171" t="hiredman the jvm might be prefering the ipv6 address for localhost"><y>#</y><d>2019-02-23</d><h>03:39</h><w>hiredman</w>the jvm might be prefering the ipv6 address for localhost</z><z id="t1550986028" t="craftybones Anybody here?"><y>#</y><d>2019-02-24</d><h>05:27</h><w>craftybones</w>Anybody here?</z><z id="t1550991800" t="dominicm Yes"><y>#</y><d>2019-02-24</d><h>07:03</h><w>dominicm</w>Yes</z><z id="t1551047677" t="cfleming Iâ€™m chatting over in #rebl with people trying to get https://github.com/RickMoynihan/nrebl.middleware to work."><y>#</y><d>2019-02-24</d><h>22:34</h><w>cfleming</w>Iâ€™m chatting over in #rebl with people trying to get <a href="https://github.com/RickMoynihan/nrebl.middleware" target="_blank">https://github.com/RickMoynihan/nrebl.middleware</a> to work.</z><z id="t1551047723" t="cfleming My understanding is that in nrepl responses, the :value should always be a string, since itâ€™s the pr-str ed evaluation result."><y>#</y><d>2019-02-24</d><h>22:35</h><w>cfleming</w>My understanding is that in nrepl responses, the <code>:value</code> should always be a string, since itâ€™s the <code>pr-str</code>ed evaluation result.</z><z id="t1551047763" t="cfleming The doc backs that up: https://nrepl.org/nrepl/0.6.0/design/overview.html#_responses &gt; value The result of printing a result of evaluating a form in the code sent in the corresponding request."><y>#</y><d>2019-02-24</d><h>22:36</h><w>cfleming</w>The doc backs that up: <a href="https://nrepl.org/nrepl/0.6.0/design/overview.html#_responses" target="_blank">https://nrepl.org/nrepl/0.6.0/design/overview.html#_responses</a>
&gt; <code>value</code> The result of printing a result of evaluating a form in the code sent in the corresponding request.</z><z id="t1551047783" t="cfleming Iâ€™m still on the old nrepl, and that has always been true there."><y>#</y><d>2019-02-24</d><h>22:36</h><w>cfleming</w>Iâ€™m still on the old nrepl, and that has always been true there.</z><z id="t1551047879" t="cfleming [:attrs {:href &quot;/_/_/users/U0773UB6D&quot;}] has been doing some experimentation, and is sometimes seeing nil values in responses."><y>#</y><d>2019-02-24</d><h>22:37</h><w>cfleming</w><a>@maxt</a> has been doing some experimentation, and is sometimes seeing <code>nil</code> values in responses.</z><z id="t1551048664" t="maxt nrebl.middleware implements Transport send, which gets the same request twice, but with different keys in the response map. First time it includes :value , the second time it gets :status #{:done} without value."><y>#</y><d>2019-02-24</d><h>22:51</h><w>maxt</w>nrebl.middleware implements Transport send, which gets the same request twice, but with different keys in the response map. First time it includes <code>:value</code>, the second time it gets <code>:status #{:done}</code> without value.</z><z id="t1551048895" t="cfleming [:attrs {:href &quot;/_/_/users/U0773UB6D&quot;}] That is expected - not all messages include a :value"><y>#</y><d>2019-02-24</d><h>22:54</h><w>cfleming</w><a>@maxt</a> That is expected - not all messages include a <code>:value</code></z><z id="t1551048935" t="cfleming Does that mean that when youâ€™re getting nil from :value , that itâ€™s just because thereâ€™s no :value entry at all?"><y>#</y><d>2019-02-24</d><h>22:55</h><w>cfleming</w>Does that mean that when youâ€™re getting <code>nil</code> from <code>:value</code>, that itâ€™s just because thereâ€™s no <code>:value</code> entry at all?</z><z id="t1551048938" t="maxt Yes, I just read up on that."><y>#</y><d>2019-02-24</d><h>22:55</h><w>maxt</w>Yes, I just read up on that.</z><z id="t1551049026" t="maxt [:attrs {:href &quot;/_/_/users/U0567Q30W&quot;}] most likley. I&apos;ll test to wrap it in a check for the existence of the :value key."><y>#</y><d>2019-02-24</d><h>22:57</h><w>maxt</w><a>@cfleming</a> most likley. I&apos;ll test to wrap it in a check for the existence of the :value key.</z><z id="t1551049064" t="maxt Could :value ever be nil ?"><y>#</y><d>2019-02-24</d><h>22:57</h><w>maxt</w>Could :value ever be <code>nil</code>?</z><z id="t1551049103" t="maxt Simply wrapping it in (when value ,,,) works great from what I can see."><y>#</y><d>2019-02-24</d><h>22:58</h><w>maxt</w>Simply wrapping it in <code>(when value ,,,)</code> works great from what I can see.</z><z id="t1551049130" t="cfleming Over in #rebl, [:attrs {:href &quot;/_/_/users/U4YGF4NGM&quot;}] has reported that he does indeed see the values correctly in REBL, using CIDER and nREPL 0.5.x. Could it be that the CIDER middleware is causing the :value to be an actual value, i.e. a non-`pr-str`ed string?"><y>#</y><d>2019-02-24</d><h>22:58</h><w>cfleming</w>Over in #rebl, <a>@lilactown</a> has reported that he does indeed see the values correctly in REBL, using CIDER and nREPL 0.5.x. Could it be that the CIDER middleware is causing the <code>:value</code> to be an actual value, i.e. a non-`pr-str`ed string?</z><z id="t1551049174" t="cfleming [:attrs {:href &quot;/_/_/users/U0773UB6D&quot;}] In my experience (all with old nREPL), if that :value is present it is never nil."><y>#</y><d>2019-02-24</d><h>22:59</h><w>cfleming</w><a>@maxt</a> In my experience (all with old nREPL), if that <code>:value</code> is present it is never nil.</z><z id="t1551049192" t="cfleming But (when value ...) seems like a fine check to me."><y>#</y><d>2019-02-24</d><h>22:59</h><w>cfleming</w>But <code>(when value ...)</code> seems like a fine check to me.</z><z id="t1551049233" t="cfleming Actually, looking at the Cursive code I do (when-let [val (:value item)] so Iâ€™d never know if there were nil values, but they seem safe to ignore if there ever are any."><y>#</y><d>2019-02-24</d><h>23:00</h><w>cfleming</w>Actually, looking at the Cursive code I do <code>(when-let [val (:value item)]</code> so Iâ€™d never know if there were <code>nil</code> values, but they seem safe to ignore if there ever are any.</z><z id="t1551052140" t="maxt [:attrs {:href &quot;/_/_/users/U0567Q30W&quot;}] This patch seems to work well for me in Cursive. https://github.com/RickMoynihan/nrebl.middleware/pull/16 I can also successfully combine it with https://github.com/RickMoynihan/nrebl.middleware/pull/11 to get a nrepl REBL working as a clojure.main rebel. I have not, however, tested it with any other editor."><y>#</y><d>2019-02-24</d><h>23:49</h><w>maxt</w><a>@cfleming</a> This patch seems to work well for me in Cursive. <a href="https://github.com/RickMoynihan/nrebl.middleware/pull/16" target="_blank">https://github.com/RickMoynihan/nrebl.middleware/pull/16</a>   I can also successfully combine it with <a href="https://github.com/RickMoynihan/nrebl.middleware/pull/11" target="_blank">https://github.com/RickMoynihan/nrebl.middleware/pull/11</a> to get a nrepl REBL working as a clojure.main rebel. I have not, however, tested it with any other editor.</z><z id="t1551052281" t="dpsutton I think [:attrs {:href &quot;/_/_/users/U052B0PT3&quot;}] has been doing a lot of work on nrepl recently and might have some thoughts"><y>#</y><d>2019-02-24</d><h>23:51</h><w>dpsutton</w>I think <a>@cichli</a> has been doing a lot of work on nrepl recently and might have some thoughts</z><z id="t1551052994" t="maxt [:attrs {:href &quot;/_/_/users/U0567Q30W&quot;}] Still one issue with together with Cursive. When I send forms from the editor, they get wrapped in a long expression. Sending from the repl-window doesn&apos;t have this problem."><y>#</y><d>2019-02-25</d><h>00:03</h><w>maxt</w><a>@cfleming</a> Still one issue with together with Cursive. When I send forms from the editor, they get wrapped in a long expression. Sending from the repl-window doesn&apos;t have this problem.</z><z id="t1551053840" t="maxt [:attrs {:href &quot;/_/_/users/U0567Q30W&quot;}] I see now that&apos;s already reported https://github.com/cursive-ide/cursive/issues/2113"><y>#</y><d>2019-02-25</d><h>00:17</h><w>maxt</w><a>@cfleming</a> I see now that&apos;s already reported <a href="https://github.com/cursive-ide/cursive/issues/2113" target="_blank">https://github.com/cursive-ide/cursive/issues/2113</a></z><z id="t1551054751" t="cfleming [:attrs {:href &quot;/_/_/users/U0773UB6D&quot;}] Yes, Iâ€™m planning to fix #2113 in the next build."><y>#</y><d>2019-02-25</d><h>00:32</h><w>cfleming</w><a>@maxt</a> Yes, Iâ€™m planning to fix #2113 in the next build.</z><z id="t1551054808" t="maxt Great!"><y>#</y><d>2019-02-25</d><h>00:33</h><w>maxt</w>Great!</z><z id="t1551060906" t="cfleming I found another incompatibility that isnâ€™t documented at https://nrepl.org/nrepl/0.6.0/installation.html#upgrading - on the nrepl.server.Server record, the ss field has changed to server-socket . Probably a good change, but one that clients might be using."><y>#</y><d>2019-02-25</d><h>02:15</h><w>cfleming</w>I found another incompatibility that isnâ€™t documented at <a href="https://nrepl.org/nrepl/0.6.0/installation.html#upgrading" target="_blank">https://nrepl.org/nrepl/0.6.0/installation.html#upgrading</a> - on the <code>nrepl.server.Server</code> record, the <code>ss</code> field has changed to <code>server-socket</code>. Probably a good change, but one that clients might be using.</z><z id="t1551060926" t="cfleming I use that for printing out the port that the REPL server started on."><y>#</y><d>2019-02-25</d><h>02:15</h><w>cfleming</w>I use that for printing out the port that the REPL server started on.</z><z id="t1551620020" t="Jon coffee&gt; client.lsSessions (err, result) -&gt; console.log result { id: &apos;D554DFD6-8014-40D9-A298-F33F41AD6DF5&apos;, op: &apos;ls-sessions&apos; } coffee&gt; [ { id: &apos;D554DFD6-8014-40D9-A298-F33F41AD6DF5&apos;, session: &apos;c915cda9-ab75-4445-95a0-66bf7027e661&apos;, sessions: [], status: [ &apos;done&apos; ] } ] undefined coffee&gt; client.eval &quot;(println (range 100))&quot;, &apos;cljs.user&apos;, &apos;c915cda9-ab75-4445-95a0-66bf7027e661&apos;, (err, result) -&gt; console.log err, result send chunk: { op: &apos;eval&apos;, code: &apos;(println (range 100))&apos;, ns: &apos;cljs.user&apos;, session: &apos;c915cda9-ab75-4445-95a0-66bf7027e661&apos;, id: undefined, eval: undefined } { id: &apos;B4E0DE55-E082-41C2-9AC7-62692CAEAF03&apos;, op: &apos;eval&apos;, code: &apos;(println (range 100))&apos;, ns: &apos;cljs.user&apos;, session: &apos;c915cda9-ab75-4445-95a0-66bf7027e661&apos; } coffee&gt; null [ { id: &apos;B4E0DE55-E082-41C2-9AC7-62692CAEAF03&apos;, session: &apos;c915cda9-ab75-4445-95a0-66bf7027e661&apos;, status: [ &apos;done&apos;, &apos;unknown-session&apos;, &apos;error&apos; ] } ] "><y>#</y><d>2019-03-03</d><h>13:33</h><w>Jon</w><pre>coffee&gt; client.lsSessions (err, result) -&gt; console.log result
{ id: &apos;D554DFD6-8014-40D9-A298-F33F41AD6DF5&apos;,
  op: &apos;ls-sessions&apos; }
coffee&gt; [ { id: &apos;D554DFD6-8014-40D9-A298-F33F41AD6DF5&apos;,
    session: &apos;c915cda9-ab75-4445-95a0-66bf7027e661&apos;,
    sessions: [],
    status: [ &apos;done&apos; ] } ]

undefined
coffee&gt; client.eval &quot;(println (range 100))&quot;, &apos;cljs.user&apos;, &apos;c915cda9-ab75-4445-95a0-66bf7027e661&apos;, (err, result) -&gt; console.log err, result
send chunk: { op: &apos;eval&apos;,
  code: &apos;(println (range 100))&apos;,
  ns: &apos;cljs.user&apos;,
  session: &apos;c915cda9-ab75-4445-95a0-66bf7027e661&apos;,
  id: undefined,
  eval: undefined }
{ id: &apos;B4E0DE55-E082-41C2-9AC7-62692CAEAF03&apos;,
  op: &apos;eval&apos;,
  code: &apos;(println (range 100))&apos;,
  ns: &apos;cljs.user&apos;,
  session: &apos;c915cda9-ab75-4445-95a0-66bf7027e661&apos; }
coffee&gt; null [ { id: &apos;B4E0DE55-E082-41C2-9AC7-62692CAEAF03&apos;,
    session: &apos;c915cda9-ab75-4445-95a0-66bf7027e661&apos;,
    status: [ &apos;done&apos;, &apos;unknown-session&apos;, &apos;error&apos; ] } ]
</pre></z><z id="t1551620039" t="Jon I got some trouble understanding &quot;session&quot; in nREPL."><y>#</y><d>2019-03-03</d><h>13:33</h><w>Jon</w>I got some trouble understanding &quot;session&quot; in nREPL.</z><z id="t1551620080" t="Jon I copied session value from last response, as my session argument"><y>#</y><d>2019-03-03</d><h>13:34</h><w>Jon</w>I copied <code>session</code> value from last response, as my session argument</z><z id="t1551620099" t="Jon however it kept telling me &quot;unknown-session&quot;"><y>#</y><d>2019-03-03</d><h>13:34</h><w>Jon</w>however it kept telling me &quot;unknown-session&quot;</z><z id="t1551620662" t="dominicm If you want to use a session, you need to create one first"><y>#</y><d>2019-03-03</d><h>13:44</h><w>dominicm</w>If you want to use a session, you need to create one first</z><z id="t1551621226" t="Jon clone one.."><y>#</y><d>2019-03-03</d><h>13:53</h><w>Jon</w>clone one..</z><z id="t1551621227" t="Jon got"><y>#</y><d>2019-03-03</d><h>13:53</h><w>Jon</w>got</z><z id="t1551621256" t="Jon =&gt;&gt; coffee client.coffee send chunk: { op: &apos;eval&apos;, code: &apos;(println a)&apos;, ns: &apos;user&apos;, session: &apos;6d931230-e646-4ba8-aef5-85127d3e9ff4&apos;, id: undefined, eval: undefined } eval null [ { err: &apos;SyntaxError: Unexpected token .\n at at Object.shadow$cljs$devtools$client$env$repl_call [as repl_call] ()\n at Object.shadow$cljs$devtools$client$browser$repl_invoke [as repl_invoke] ()\n at shadow$cljs$devtools$client$browser$handle_message ()\n at Object.shadow$cljs$devtools$client$env$process_ws_msg [as process_ws_msg] ()\n at WebSocket.&lt;anonymous&gt; ()&apos;, id: &apos;177DD78E-6ED6-4105-BA7A-05BDDE95F7C0&apos;, session: &apos;6d931230-e646-4ba8-aef5-85127d3e9ff4&apos; }, { id: &apos;177DD78E-6ED6-4105-BA7A-05BDDE95F7C0&apos;, session: &apos;6d931230-e646-4ba8-aef5-85127d3e9ff4&apos;, status: [ &apos;done&apos; ] } ] "><y>#</y><d>2019-03-03</d><h>13:54</h><w>Jon</w><pre>=&gt;&gt; coffee client.coffee
send chunk: { op: &apos;eval&apos;,
  code: &apos;(println a)&apos;,
  ns: &apos;user&apos;,
  session: &apos;6d931230-e646-4ba8-aef5-85127d3e9ff4&apos;,
  id: undefined,
  eval: undefined }
eval null [ { err:
     &apos;SyntaxError: Unexpected token .\n    at     at Object.shadow$cljs$devtools$client$env$repl_call [as repl_call] ()\n    at Object.shadow$cljs$devtools$client$browser$repl_invoke [as repl_invoke] ()\n    at shadow$cljs$devtools$client$browser$handle_message ()\n    at Object.shadow$cljs$devtools$client$env$process_ws_msg [as process_ws_msg] ()\n    at WebSocket.&lt;anonymous&gt; ()&apos;,
    id: &apos;177DD78E-6ED6-4105-BA7A-05BDDE95F7C0&apos;,
    session: &apos;6d931230-e646-4ba8-aef5-85127d3e9ff4&apos; },
  { id: &apos;177DD78E-6ED6-4105-BA7A-05BDDE95F7C0&apos;,
    session: &apos;6d931230-e646-4ba8-aef5-85127d3e9ff4&apos;,
    status: [ &apos;done&apos; ] } ]
</pre></z><z id="t1551621260" t="Jon how about this error?"><y>#</y><d>2019-03-03</d><h>13:54</h><w>Jon</w>how about this error?</z><z id="t1551621276" t="Jon I don&apos;t know why it has syntax errors..."><y>#</y><d>2019-03-03</d><h>13:54</h><w>Jon</w>I don&apos;t know why it has syntax errors...</z><z id="t1551621406" t="Jon ....probably caused by shadow-cljs.. will look into that. thx."><y>#</y><d>2019-03-03</d><h>13:56</h><w>Jon</w>....probably caused by shadow-cljs.. will look into that. thx.</z><z id="t1551806873" t="Jon what does the &quot;stdin&quot; op mean?"><y>#</y><d>2019-03-05</d><h>17:27</h><w>Jon</w>what does the &quot;stdin&quot; op mean?</z><z id="t1551810637" t="dominicm I think it is an indication to send input which will be fed to stdin, "><y>#</y><d>2019-03-05</d><h>18:30</h><w>dominicm</w>I think it is an indication to send input which will be fed to stdin, </z><z id="t1553633584" t="cfleming In the latest Cursive, Iâ€™ve upgraded the nREPL used internally to nrepl:nrepl:0.6.0 ."><y>#</y><d>2019-03-26</d><h>20:53</h><w>cfleming</w>In the latest Cursive, Iâ€™ve upgraded the nREPL used internally to <code>nrepl:nrepl:0.6.0</code>.</z><z id="t1553633653" t="cfleming I have a user with a CLJS project using Leiningen whoâ€™s reporting that under this version his app breaks at startup, with an error like this: Exception in thread &quot;main&quot; java.lang.RuntimeException: No such var: nrepl.transport/uri-scheme, compiling:(/private/var/folders/fw/gd1yg_sd5sx_dvqv5pnk6f3m0000gn/T/form-init4758704793550975827.clj:1:3327) at clojure.lang.Compiler.analyze(Compiler.java:6792) at clojure.lang.Compiler.analyze(Compiler.java:6729) "><y>#</y><d>2019-03-26</d><h>20:54</h><w>cfleming</w>I have a user with a CLJS project using Leiningen whoâ€™s reporting that under this version his app breaks at startup, with an error like this:
<pre>Exception in thread &quot;main&quot; java.lang.RuntimeException: No such var: nrepl.transport/uri-scheme, compiling:(/private/var/folders/fw/gd1yg_sd5sx_dvqv5pnk6f3m0000gn/T/form-init4758704793550975827.clj:1:3327)
    at clojure.lang.Compiler.analyze(Compiler.java:6792)
    at clojure.lang.Compiler.analyze(Compiler.java:6729)
</pre></z><z id="t1553633680" t="cfleming Cursive doesnâ€™t use that var at all, and Iâ€™m awaiting details on what his stack looks like. But does that look familiar to anyone?"><y>#</y><d>2019-03-26</d><h>20:54</h><w>cfleming</w>Cursive doesnâ€™t use that var at all, and Iâ€™m awaiting details on what his stack looks like. But does that look familiar to anyone?</z><z id="t1553633706" t="cfleming I assume itâ€™s a conflict between the new nREPL and piggieback or something similar."><y>#</y><d>2019-03-26</d><h>20:55</h><w>cfleming</w>I assume itâ€™s a conflict between the new nREPL and piggieback or something similar.</z><z id="t1553633807" t="cfleming The var thatâ€™s required but missing is in the new nREPL namespace though, strangely."><y>#</y><d>2019-03-26</d><h>20:56</h><w>cfleming</w>The var thatâ€™s required but missing is in the new nREPL namespace though, strangely.</z><z id="t1553642187" t="cfleming Actually, I suspect that this might be a lein version incompatibility, and the nREPL upgrade is a red herring. Iâ€™m waiting for feedback to confirm that."><y>#</y><d>2019-03-26</d><h>23:16</h><w>cfleming</w>Actually, I suspect that this might be a lein version incompatibility, and the nREPL upgrade is a red herring. Iâ€™m waiting for feedback to confirm that.</z><z id="t1553667398" t="bozhidar [:attrs {:href &quot;/_/_/users/U0567Q30W&quot;}] Thatâ€™s the first time I see such an error. That new var is simply a way for tools like Lein to print properly the nREPL url now that it has more transports (before all tools had hardcoded nrepl:// ). The var was actually added in nREPL 0.5."><y>#</y><d>2019-03-27</d><h>06:16</h><w>bozhidar</w><a>@cfleming</a> Thatâ€™s the first time I see such an error. That new var is simply a way for tools like Lein to print properly the nREPL url now that it has more transports (before all tools had hardcoded <code>nrepl://</code>). The var was actually added in nREPL 0.5.</z><z id="t1553667485" t="bozhidar https://github.com/nrepl/nrepl/blob/master/src/clojure/nrepl/transport.clj#L220"><y>#</y><d>2019-03-27</d><h>06:18</h><w>bozhidar</w><a href="https://github.com/nrepl/nrepl/blob/master/src/clojure/nrepl/transport.clj#L220" target="_blank">https://github.com/nrepl/nrepl/blob/master/src/clojure/nrepl/transport.clj#L220</a></z><z id="t1553667557" t="bozhidar Whatâ€™s his piggieback version? Your user should be on 0.4 for things to work properly."><y>#</y><d>2019-03-27</d><h>06:19</h><w>bozhidar</w>Whatâ€™s his piggieback version? Your user should be on 0.4 for things to work properly.</z><z id="t1553677797" t="cfleming [:attrs {:href &quot;/_/_/users/U051BLM8F&quot;}] Actually, itâ€™s not the first time youâ€™ve seen it :-): https://github.com/eraserhd/rep/issues/1"><y>#</y><d>2019-03-27</d><h>09:09</h><w>cfleming</w><a>@bozhidar</a> Actually, itâ€™s not the first time youâ€™ve seen it :-): <a href="https://github.com/eraserhd/rep/issues/1" target="_blank">https://github.com/eraserhd/rep/issues/1</a></z><z id="t1553677834" t="cfleming Iâ€™m waiting for some details on his setup, such as piggieback version."><y>#</y><d>2019-03-27</d><h>09:10</h><w>cfleming</w>Iâ€™m waiting for some details on his setup, such as piggieback version.</z><z id="t1553678350" t="cfleming Iâ€™ll let him know that 0.4 is what he should be using."><y>#</y><d>2019-03-27</d><h>09:19</h><w>cfleming</w>Iâ€™ll let him know that 0.4 is what he should be using.</z><z id="t1553678443" t="bozhidar &gt; https://github.com/eraserhd/rep/issues/1 Itâ€™s different here - he injected an older version of nREPL when Lein expected a newer one. I think you mentioned your user was on 0.6, thatâ€™s why I can imagine how this can be missing."><y>#</y><d>2019-03-27</d><h>09:20</h><w>bozhidar</w>&gt; <a href="https://github.com/eraserhd/rep/issues/1" target="_blank">https://github.com/eraserhd/rep/issues/1</a>

Itâ€™s different here - he injected an older version of nREPL when Lein expected a newer one. I think you mentioned your user was on 0.6, thatâ€™s why I can imagine how this can be missing.</z><z id="t1553678757" t="cfleming Yeah, I donâ€™t know much about his setup - he just said itâ€™s a CLJS project and he gets the error at startup. But I think the fact that Cursive has upgraded the nREPL it uses is misleading, since if heâ€™s using lein that version wonâ€™t be used anyway, itâ€™ll be whatever lein is using."><y>#</y><d>2019-03-27</d><h>09:25</h><w>cfleming</w>Yeah, I donâ€™t know much about his setup - he just said itâ€™s a CLJS project and he gets the error at startup. But I think the fact that Cursive has upgraded the nREPL it uses is misleading, since if heâ€™s using lein that version wonâ€™t be used anyway, itâ€™ll be whatever lein is using.</z><z id="t1553678842" t="cfleming I suspect that upgrading Cursive will have caused him to use a later leiningen, which is incompatible with whatever piggieback heâ€™s using, but Iâ€™m not sure yet."><y>#</y><d>2019-03-27</d><h>09:27</h><w>cfleming</w>I suspect that upgrading Cursive will have caused him to use a later leiningen, which is incompatible with whatever piggieback heâ€™s using, but Iâ€™m not sure yet.</z><z id="t1553679644" t="cfleming Awesome, problem was fixed by upgrading nREPL and Piggieback."><y>#</y><d>2019-03-27</d><h>09:40</h><w>cfleming</w>Awesome, problem was fixed by upgrading nREPL and Piggieback.</z><z id="t1553682096" t="bozhidar Great!"><y>#</y><d>2019-03-27</d><h>10:21</h><w>bozhidar</w>Great!</z><z id="t1553682163" t="bozhidar How does Cursive start nREPL itself, btw? It doesnâ€™t use any build tool and sorts out the projects deps itself?"><y>#</y><d>2019-03-27</d><h>10:22</h><w>bozhidar</w>How does Cursive start nREPL itself, btw? It doesnâ€™t use any build tool and sorts out the projects deps itself?</z><z id="t1553682255" t="cfleming Thatâ€™s used when someone wants a REPL in a project thatâ€™s not managed by something like lein that will start a REPL for you. So things like Gradle or Maven, or a manually configured project. Then, right, Cursive will use the IntelliJ classpath and just add nREPL to it, and then inject an init script which starts the server."><y>#</y><d>2019-03-27</d><h>10:24</h><w>cfleming</w>Thatâ€™s used when someone wants a REPL in a project thatâ€™s not managed by something like lein that will start a REPL for you. So things like Gradle or Maven, or a manually configured project. Then, right, Cursive will use the IntelliJ classpath and just add nREPL to it, and then inject an init script which starts the server.</z><z id="t1553682802" t="bozhidar Understood. That sounds neat!"><y>#</y><d>2019-03-27</d><h>10:33</h><w>bozhidar</w>Understood. That sounds neat!</z><z id="t1553682856" t="cfleming Yeah, I use it a lot since I use Gradle a fair bit for mixed Clojure/Kotlin projects (Cursive itself, in particular)."><y>#</y><d>2019-03-27</d><h>10:34</h><w>cfleming</w>Yeah, I use it a lot since I use Gradle a fair bit for mixed Clojure/Kotlin projects (Cursive itself, in particular).</z><z id="t1553687267" t="bozhidar I havenâ€™t used Gradle since my days as a Java programmer. ðŸ™‚"><y>#</y><d>2019-03-27</d><h>11:47</h><w>bozhidar</w>I havenâ€™t used Gradle since my days as a Java programmer. <b>ðŸ™‚</b></z><z id="t1553877995" t="bozhidar A long overdue article https://metaredux.com/posts/2019/03/29/nrepl-0-6.html"><y>#</y><d>2019-03-29</d><h>16:46</h><w>bozhidar</w>A long overdue article <a href="https://metaredux.com/posts/2019/03/29/nrepl-0-6.html" target="_blank">https://metaredux.com/posts/2019/03/29/nrepl-0-6.html</a></z><z id="t1553878159" t="dpsutton #announcements ?"><y>#</y><d>2019-03-29</d><h>16:49</h><w>dpsutton</w>#announcements ?</z><z id="t1553880013" t="bozhidar It was released 2 months ago. ðŸ™‚"><y>#</y><d>2019-03-29</d><h>17:20</h><w>bozhidar</w>It was released 2 months ago. <b>ðŸ™‚</b></z><z id="t1553880329" t="dpsutton announce the informative post ðŸ™‚"><y>#</y><d>2019-03-29</d><h>17:25</h><w>dpsutton</w>announce the informative post <b>ðŸ™‚</b></z><z id="t1553885332" t="bozhidar Done!"><y>#</y><d>2019-03-29</d><h>18:48</h><w>bozhidar</w>Done!</z><z id="t1553893420" t="cfleming Does the new nREPL actually require Java 8 for anything? I didnâ€™t realise it had that dependency, and have started receiving issues from users who are using JDK7."><y>#</y><d>2019-03-29</d><h>21:03</h><w>cfleming</w>Does the new nREPL actually require Java 8 for anything? I didnâ€™t realise it had that dependency, and have started receiving issues from users who are using JDK7.</z><z id="t1553895064" t="dpsutton the change points here: https://github.com/nrepl/nREPL/issues/26"><y>#</y><d>2019-03-29</d><h>21:31</h><w>dpsutton</w>the change points here: <a href="https://github.com/nrepl/nREPL/issues/26" target="_blank">https://github.com/nrepl/nREPL/issues/26</a></z><z id="t1553895665" t="dpsutton all tests pass with :javac-options [&quot;-target&quot; &quot;6&quot; &quot;-source&quot; &quot;6&quot;]"><y>#</y><d>2019-03-29</d><h>21:41</h><w>dpsutton</w>all tests pass with <code>:javac-options [&quot;-target&quot; &quot;6&quot; &quot;-source&quot; &quot;6&quot;]</code></z><z id="t1553895672" t="dpsutton not sure if that&apos;s dispositive or not"><y>#</y><d>2019-03-29</d><h>21:41</h><w>dpsutton</w>not sure if that&apos;s dispositive or not</z><z id="t1553895955" t="cfleming [:attrs {:href &quot;/_/_/users/U11BV7MTK&quot;}] Thanks! Since the version in Cursive is only used when Cursive starts its own REPL, perhaps Iâ€™ll fork a version compiled against Java 6. But in general, it seems like it would be good to support older versions if newer ones are not required for anything."><y>#</y><d>2019-03-29</d><h>21:45</h><w>cfleming</w><a>@dpsutton</a> Thanks! Since the version in Cursive is only used when Cursive starts its own REPL, perhaps Iâ€™ll fork a version compiled against Java 6. But in general, it seems like it would be good to support older versions if newer ones are not required for anything.</z><z id="t1553895996" t="dpsutton from the ticket it doesn&apos;t look like raising the bar was ~intended~ unintended. I guess [:attrs {:href &quot;/_/_/users/U051BLM8F&quot;}] took 8 to be the current java version rather than the current bytecode version?"><y>#</y><d>2019-03-29</d><h>21:46</h><w>dpsutton</w>from the ticket it doesn&apos;t look like raising the bar was ~intended~ unintended. I guess <a>@bozhidar</a> took 8 to be the current java version rather than the current bytecode version?</z><z id="t1553896011" t="dpsutton it was usually 6 for clojure until 1.10 right?"><y>#</y><d>2019-03-29</d><h>21:46</h><w>dpsutton</w>it was usually 6 for clojure until 1.10 right?</z><z id="t1553896019" t="dpsutton (unless i&apos;m conflating issues)"><y>#</y><d>2019-03-29</d><h>21:46</h><w>dpsutton</w>(unless i&apos;m conflating issues)</z><z id="t1553896033" t="cfleming Yes, thatâ€™s right."><y>#</y><d>2019-03-29</d><h>21:47</h><w>cfleming</w>Yes, thatâ€™s right.</z><z id="t1553896058" t="cfleming But Cursive is used a lot in enterprise environments, where upgrading is often not a choice."><y>#</y><d>2019-03-29</d><h>21:47</h><w>cfleming</w>But Cursive is used a lot in enterprise environments, where upgrading is often not a choice.</z><z id="t1553896062" t="dpsutton for sure"><y>#</y><d>2019-03-29</d><h>21:47</h><w>dpsutton</w>for sure</z><z id="t1553896075" t="dpsutton is this just in an EAP?"><y>#</y><d>2019-03-29</d><h>21:47</h><w>dpsutton</w>is this just in an EAP?</z><z id="t1553896097" t="dpsutton or have you gone full nrepl 6 in the main version?"><y>#</y><d>2019-03-29</d><h>21:48</h><w>dpsutton</w>or have you gone full nrepl 6 in the main version?</z><z id="t1553896109" t="cfleming No, I released it in the latest stable release, I hadnâ€™t realised that it had a Java 8 dep."><y>#</y><d>2019-03-29</d><h>21:48</h><w>cfleming</w>No, I released it in the latest stable release, I hadnâ€™t realised that it had a Java 8 dep.</z><z id="t1553896126" t="dpsutton ah. shucks"><y>#</y><d>2019-03-29</d><h>21:48</h><w>dpsutton</w>ah. shucks</z><z id="t1553896178" t="cfleming Well, when users start a REPL via lein or deps, you get whatever they use, which is probably 90% of the REPL use. But some users start a REPL in a project not managed by one of those two (e.g. Maven, Gradle, manual project setup or some other means), and then Cursive injects nREPL to start the server."><y>#</y><d>2019-03-29</d><h>21:49</h><w>cfleming</w>Well, when users start a REPL via lein or deps, you get whatever they use, which is probably 90% of the REPL use. But some users start a REPL in a project not managed by one of those two (e.g. Maven, Gradle, manual project setup or some other means), and then Cursive injects nREPL to start the server.</z><z id="t1553896202" t="cfleming In that case, it uses the version bundled with Cursive, which is now 0.6"><y>#</y><d>2019-03-29</d><h>21:50</h><w>cfleming</w>In that case, it uses the version bundled with Cursive, which is now 0.6</z><z id="t1553939676" t="bozhidar [:attrs {:href &quot;/_/_/users/U0567Q30W&quot;}] It probably works on Java 6, but I have no idea. It became hard to test against 6 at some point and I decided it wasnâ€™t worth it. Iâ€™m reasonably certain it should work well with 7."><y>#</y><d>2019-03-30</d><h>09:54</h><w>bozhidar</w><a>@cfleming</a> It probably works on Java 6, but I have no idea. It became hard to test against 6 at some point and I decided it wasnâ€™t worth it. Iâ€™m reasonably certain it should work well with 7.</z><z id="t1553939747" t="cfleming [:attrs {:href &quot;/_/_/users/U051BLM8F&quot;}] Ok, Iâ€™ll probably fork and create a Java 6 version to bundle with Cursive then."><y>#</y><d>2019-03-30</d><h>09:55</h><w>cfleming</w><a>@bozhidar</a> Ok, Iâ€™ll probably fork and create a Java 6 version to bundle with Cursive then.</z><z id="t1553939750" t="bozhidar It certainly doesnâ€™t using anything special introduced in Java 8. I just removed 6 and 7 from the build matrix and changed the compiler flag."><y>#</y><d>2019-03-30</d><h>09:55</h><w>bozhidar</w>It certainly doesnâ€™t using anything special introduced in Java 8. I just removed 6 and 7 from the build matrix and changed the compiler flag.</z><z id="t1553939883" t="bozhidar Itâ€™s interesting that no one had asked about Java 6 and 7 so far. I just assumed even enterprises had updated by now. ðŸ™‚ I do assume weâ€™d be stuck on Java 8 forever, though."><y>#</y><d>2019-03-30</d><h>09:58</h><w>bozhidar</w>Itâ€™s interesting that no one had asked about Java 6 and 7 so far. I just assumed even enterprises had updated by now. <b>ðŸ™‚</b> I do assume weâ€™d be stuck on Java 8 forever, though.</z><z id="t1553945950" t="shen What would be involved in supporting java 6 and 7?"><y>#</y><d>2019-03-30</d><h>11:39</h><w>shen</w>What would be involved in supporting java 6 and 7?</z><z id="t1553945971" t="shen the javac flag? or do we need a way to test?"><y>#</y><d>2019-03-30</d><h>11:39</h><w>shen</w>the javac flag? or do we need a way to test?</z><z id="t1553951392" t="bozhidar Itâ€™s just a matter of tweaking :javac-options [&quot;-target&quot; &quot;8&quot; &quot;-source&quot; &quot;8&quot;] in project.clj."><y>#</y><d>2019-03-30</d><h>13:09</h><w>bozhidar</w>Itâ€™s just a matter of tweaking <code>:javac-options [&quot;-target&quot; &quot;8&quot; &quot;-source&quot; &quot;8&quot;]</code> in project.clj.</z><z id="t1553951420" t="bozhidar I think it has been set to Java 8 for quite a while now, but I donâ€™t remember how long exactly."><y>#</y><d>2019-03-30</d><h>13:10</h><w>bozhidar</w>I think it has been set to Java 8 for quite a while now, but I donâ€™t remember how long exactly.</z><z id="t1553951605" t="bozhidar Someone has to test this to make sure it actually works, I removed those JDKs from the CI when they were removed by Travis. Plus the build matrix had become huge (and the tests on Travis were super slow) and it seemed pointless to test platforms which werenâ€™t used much, anyways."><y>#</y><d>2019-03-30</d><h>13:13</h><w>bozhidar</w>Someone has to test this to make sure it actually works, I removed those JDKs from the CI when they were removed by Travis. Plus the build matrix had become huge (and the tests on Travis were super slow) and it seemed pointless to test platforms which werenâ€™t used much, anyways.</z><z id="t1553956533" t="bozhidar Just confirmed - Java 8 has been the compilation target pretty much since the beginning of the new nREPL. See https://github.com/nrepl/nrepl/commit/90db7f9b36a35fa9fff8691a1e121e284ab5fdf4"><y>#</y><d>2019-03-30</d><h>14:35</h><w>bozhidar</w>Just confirmed - Java 8 has been the compilation target pretty much since the beginning of the new nREPL. See <a href="https://github.com/nrepl/nrepl/commit/90db7f9b36a35fa9fff8691a1e121e284ab5fdf4" target="_blank">https://github.com/nrepl/nrepl/commit/90db7f9b36a35fa9fff8691a1e121e284ab5fdf4</a></z><z id="t1553956617" t="bozhidar [:attrs {:href &quot;/_/_/users/U0567Q30W&quot;}] What was the version of nREPL Cursive bundled before? I was under the impression you had switched to nrepl/nrepl a while ago."><y>#</y><d>2019-03-30</d><h>14:36</h><w>bozhidar</w><a>@cfleming</a> What was the version of nREPL Cursive bundled before? I was under the impression you had switched to nrepl/nrepl a while ago.</z><z id="t1553960999" t="shen I&apos;ve been looking at testing with Java 1.6 and 1.7 on CircleCI"><y>#</y><d>2019-03-30</d><h>15:49</h><w>shen</w>I&apos;ve been looking at testing with Java 1.6 and 1.7 on CircleCI</z><z id="t1553961062" t="shen the tricky part is finding a suitable Docker image. CircleCi&apos;s ones are based on the official Clojure images, which are, in turn, based on the Docker official OpenJDK ones"><y>#</y><d>2019-03-30</d><h>15:51</h><w>shen</w>the tricky part is finding a suitable Docker image. CircleCi&apos;s ones are based on the official Clojure images, which are, in turn, based on the Docker official OpenJDK ones</z><z id="t1553961165" t="shen There are OpenJDK java 7 (and of interest, 12 and 13-ea) images, but the Clojure, and thus CircleCI ones, don&apos;t follow"><y>#</y><d>2019-03-30</d><h>15:52</h><w>shen</w>There are OpenJDK java 7 (and of interest, 12 and 13-ea) images, but the Clojure, and thus CircleCI ones, don&apos;t follow</z><z id="t1553981752" t="cfleming [:attrs {:href &quot;/_/_/users/U051BLM8F&quot;}] No, my switch was very recent. Iâ€™ve been talking about doing it for a while ðŸ™‚"><y>#</y><d>2019-03-30</d><h>21:35</h><w>cfleming</w><a>@bozhidar</a> No, my switch was very recent. Iâ€™ve been talking about doing it for a while <b>ðŸ™‚</b></z><z id="t1553982428" t="bozhidar Got it."><y>#</y><d>2019-03-30</d><h>21:47</h><w>bozhidar</w>Got it.</z><z id="t1553982452" t="bozhidar &gt; There are OpenJDK java 7 (and of interest, 12 and 13-ea) images, but the Clojure, and thus CircleCI ones, donâ€™t follow"><y>#</y><d>2019-03-30</d><h>21:47</h><w>bozhidar</w>&gt; There are OpenJDK java 7 (and of interest, 12 and 13-ea) images, but the Clojure, and thus CircleCI ones, donâ€™t follow</z><z id="t1553982517" t="bozhidar I imagined as much. TravisCI removed JDK 6 and 7 a while ago. Seems most people have written them off at this point."><y>#</y><d>2019-03-30</d><h>21:48</h><w>bozhidar</w>I imagined as much. TravisCI removed JDK 6 and 7 a while ago. Seems most people have written them off at this point.</z></g><g id="s4"><z id="t1553982807" t="bozhidar Iâ€™d be fine with updating the build target upstream as well. I went over the code and I donâ€™t see anything requiring JDK &gt; 6. Itâ€™d be nice if we managed to run the tests somehow to be on the safe side, though. ðŸ˜„"><y>#</y><d>2019-03-30</d><h>21:53</h><w>bozhidar</w>Iâ€™d be fine with updating the build target upstream as well. I went over the code and I donâ€™t see anything requiring JDK &gt; 6. Itâ€™d be nice if we managed to run the tests somehow to be on the safe side, though. <b>ðŸ˜„</b></z><z id="t1554734185" t="lilactown Iâ€™m considering trying to connect to nREPL from a web app / chrome extension for a project. is there any prior art for something like this?"><y>#</y><d>2019-04-08</d><h>14:36</h><w>lilactown</w>Iâ€™m considering trying to connect to nREPL from a web app / chrome extension for a project. is there any prior art for something like this?</z><z id="t1554734202" t="dominicm Drawbridge I think"><y>#</y><d>2019-04-08</d><h>14:36</h><w>dominicm</w>Drawbridge I think</z><z id="t1554734204" t="lilactown Iâ€™m looking at drawbridge, which seems like it might be the way to go."><y>#</y><d>2019-04-08</d><h>14:36</h><w>lilactown</w>Iâ€™m looking at drawbridge, which seems like it might be the way to go.</z><z id="t1554734205" t="lilactown yeah"><y>#</y><d>2019-04-08</d><h>14:36</h><w>lilactown</w>yeah</z><z id="t1554734239" t="lilactown Iâ€™m a bit bummed that it requires a separate dep. the dream would be that I could just connect to any old nREPL server"><y>#</y><d>2019-04-08</d><h>14:37</h><w>lilactown</w>Iâ€™m a bit bummed that it requires a separate dep. the dream would be that I could just connect to any old nREPL server</z><z id="t1554734481" t="shen Think the fundamental limit is that a web app will need to speak http or ws"><y>#</y><d>2019-04-08</d><h>14:41</h><w>shen</w>Think the fundamental limit is that a web app will need to speak http or ws</z><z id="t1554735062" t="shen and I don&apos;t think Java standard libraries provide either of those."><y>#</y><d>2019-04-08</d><h>14:51</h><w>shen</w>and I don&apos;t think Java standard libraries provide either of those.</z><z id="t1554735174" t="lilactown yeah. I wish there was some way for Chrome to connect to a regular olâ€™ socket ðŸ˜­ pulling in an HTTP server for every project using nREPL seems potentially problematic"><y>#</y><d>2019-04-08</d><h>14:52</h><w>lilactown</w>yeah. I wish there was some way for Chrome to connect to a regular olâ€™ socket <b>ðŸ˜­</b> pulling in an HTTP server for every project using nREPL seems potentially problematic</z><z id="t1554735409" t="bozhidar &gt; Iâ€™m a bit bummed that it requires a separate dep. the dream would be that I could just connect to any old nREPL server (edited)"><y>#</y><d>2019-04-08</d><h>14:56</h><w>bozhidar</w>&gt; Iâ€™m a bit bummed that it requires a separate dep. the dream would be that I could just connect to any old nREPL server (edited)</z><z id="t1554735459" t="bozhidar Thatâ€™s hard to do as you need to bundle somehow an HTTP server with the REPL. Leiningen used to ship Drawbridge at some point, but Iâ€™m not sure if thatâ€™s still the case."><y>#</y><d>2019-04-08</d><h>14:57</h><w>bozhidar</w>Thatâ€™s hard to do as you need to bundle somehow an HTTP server with the REPL. Leiningen used to ship Drawbridge at some point, but Iâ€™m not sure if thatâ€™s still the case.</z><z id="t1554735523" t="bozhidar In theory we could have a trivial self-contained http implementation bundled with nREPL, but there never was a lot of demand for this."><y>#</y><d>2019-04-08</d><h>14:58</h><w>bozhidar</w>In theory we could have a trivial self-contained http implementation bundled with nREPL, but there never was a lot of demand for this.</z><z id="t1554735635" t="lilactown makes sense."><y>#</y><d>2019-04-08</d><h>15:00</h><w>lilactown</w>makes sense.</z><z id="t1554735825" t="lilactown would you take a PR with something like that? I might be able to put something together, but I also understand if itâ€™s just increasing surface area to support for something not many other people need"><y>#</y><d>2019-04-08</d><h>15:03</h><w>lilactown</w>would you take a PR with something like that? I might be able to put something together, but I also understand if itâ€™s just increasing surface area to support for something not many other people need</z><z id="t1554735899" t="shen what&apos;s the usecase here, [:attrs {:href &quot;/_/_/users/U4YGF4NGM&quot;}] ?"><y>#</y><d>2019-04-08</d><h>15:04</h><w>shen</w>what&apos;s the usecase here, <a>@lilactown</a>?</z><z id="t1554735926" t="lilactown Iâ€™m working on some devtooling a la REBL for the browser"><y>#</y><d>2019-04-08</d><h>15:05</h><w>lilactown</w>Iâ€™m working on some devtooling a la REBL for the browser</z><z id="t1554736024" t="lilactown I previously implemented my own shoddy protocol on top of websockets for Node.js / JVM, but I was thinking i might be able to simplify my life by just connecting directly to a REPL"><y>#</y><d>2019-04-08</d><h>15:07</h><w>lilactown</w>I previously implemented my own shoddy protocol on top of websockets for Node.js / JVM, but I was thinking i might be able to simplify my life by just connecting directly to a REPL</z><z id="t1554736212" t="dominicm I think the side loading work might be useful here?"><y>#</y><d>2019-04-08</d><h>15:10</h><w>dominicm</w>I think the side loading work might be useful here?</z><z id="t1554736230" t="dominicm I guess not actually, as you can&apos;t sideload a transport"><y>#</y><d>2019-04-08</d><h>15:10</h><w>dominicm</w>I guess not actually, as you can&apos;t sideload a transport</z><z id="t1554736271" t="lilactown specifically Iâ€™m now pivoting to a chrome extension that would connect to a remote session: CLJS in an inspected page, Node.js, and JVM. I previously implemented different â€œadaptersâ€ for each platform, but I know that most projects already have nREPL which would reduce dependencies users would have to install and potentially reduce the differences in implementation"><y>#</y><d>2019-04-08</d><h>15:11</h><w>lilactown</w>specifically Iâ€™m now pivoting to a chrome extension that would connect to a remote session: CLJS in an inspected page, Node.js, and JVM.

I previously implemented different â€œadaptersâ€ for each platform, but I know that most projects already have nREPL which would reduce dependencies users would have to install and potentially reduce the differences in implementation</z><z id="t1554736311" t="shen this might be useful?"><y>#</y><d>2019-04-08</d><h>15:11</h><w>shen</w>this might be useful?</z><z id="t1554736312" t="shen https://github.com/tomjakubowski/weasel"><y>#</y><d>2019-04-08</d><h>15:11</h><w>shen</w><a href="https://github.com/tomjakubowski/weasel" target="_blank">https://github.com/tomjakubowski/weasel</a></z><z id="t1554736401" t="lilactown I looked at that as well. itâ€™s still another transport, right? and it didnâ€™t look like it had been updated in awhile, so I wasnâ€™t sure if it supported the latest nREPL"><y>#</y><d>2019-04-08</d><h>15:13</h><w>lilactown</w>I looked at that as well. itâ€™s still another transport, right? and it didnâ€™t look like it had been updated in awhile, so I wasnâ€™t sure if it supported the latest nREPL</z><z id="t1554736424" t="shen I imagine step one is getting this all to work with drawbridge/your own http transport"><y>#</y><d>2019-04-08</d><h>15:13</h><w>shen</w>I imagine step one is getting this all to work with drawbridge/your own http transport</z><z id="t1554736442" t="shen and then check if it&apos;s worth trying to merge the functionality into nREPL"><y>#</y><d>2019-04-08</d><h>15:14</h><w>shen</w>and then check if it&apos;s worth trying to merge the functionality into nREPL</z><z id="t1554736512" t="shen I&apos;ve seen some roll-your-own HTTP implementations, and if you are super narrow about the usecase, it can be manageable. But all depends on what it looks like"><y>#</y><d>2019-04-08</d><h>15:15</h><w>shen</w>I&apos;ve seen some roll-your-own HTTP implementations, and if you are super narrow about the usecase, it can be manageable. But all depends on what it looks like</z><z id="t1554736556" t="lilactown yeah. Iâ€™m afraid that it will bloom into â€œnow nREPL has a fully-fledged HTTP server implâ€ lol"><y>#</y><d>2019-04-08</d><h>15:15</h><w>lilactown</w>yeah. Iâ€™m afraid that it will bloom into â€œnow nREPL has a fully-fledged HTTP server implâ€ lol</z><z id="t1554737760" t="bozhidar &gt; I looked at that as well. itâ€™s still another transport, right? and it didnâ€™t look like it had been updated in awhile, so I wasnâ€™t sure if it supported the latest nREPL"><y>#</y><d>2019-04-08</d><h>15:36</h><w>bozhidar</w>&gt; I looked at that as well. itâ€™s still another transport, right? and it didnâ€™t look like it had been updated in awhile, so I wasnâ€™t sure if it supported the latest nREPL</z><z id="t1554737865" t="bozhidar Not really. Itâ€™s just a ClojureScript REPL based on piggieback."><y>#</y><d>2019-04-08</d><h>15:37</h><w>bozhidar</w>Not really. Itâ€™s just a ClojureScript REPL based on piggieback.</z><z id="t1554738728" t="shen isn&apos;t it a way to speak to piggieback via a websocket?"><y>#</y><d>2019-04-08</d><h>15:52</h><r>shen</r>isn&apos;t it a way to speak to piggieback via a websocket?</z><z id="t1554738773" t="shen think it&apos;s part of boot&apos;s counterpart to lein-figwheel"><y>#</y><d>2019-04-08</d><h>15:52</h><r>shen</r>think it&apos;s part of boot&apos;s counterpart to lein-figwheel</z><z id="t1554737882" t="bozhidar &gt; yeah. Iâ€™m afraid that it will bloom into â€œnow nREPL has a fully-fledged HTTP server implâ€ lol"><y>#</y><d>2019-04-08</d><h>15:38</h><w>bozhidar</w>&gt; yeah. Iâ€™m afraid that it will bloom into â€œnow nREPL has a fully-fledged HTTP server implâ€ lol</z><z id="t1554737890" t="bozhidar Thatâ€™s always a possible outcome. ðŸ˜„"><y>#</y><d>2019-04-08</d><h>15:38</h><w>bozhidar</w>Thatâ€™s always a possible outcome. <b>ðŸ˜„</b></z><z id="t1554737947" t="bozhidar &gt; I guess not actually, as you canâ€™t sideload a transport"><y>#</y><d>2019-04-08</d><h>15:39</h><w>bozhidar</w>&gt; I guess not actually, as you canâ€™t sideload a transport</z><z id="t1554738021" t="bozhidar [:attrs {:href &quot;/_/_/users/U09LZR36F&quot;}] You wonâ€™t need to sideload it, thouhg. You could inject it in the initial payload youâ€™d use to convert a socket repl to nREPL. Once we get there that is. [:attrs {:href &quot;/_/_/users/U3E46Q1DG&quot;}] already has some branch where the injection works, so I guess thatâ€™d be just an extension of this idea."><y>#</y><d>2019-04-08</d><h>15:40</h><w>bozhidar</w><a>@dominicm</a> You wonâ€™t need to sideload it, thouhg. You could inject it in the initial payload youâ€™d use to convert a socket repl to nREPL. Once we get there that is. <a>@cgrand</a> already has some branch where the injection works, so I guess thatâ€™d be just an extension of this idea.</z><z id="t1554739391" t="cgrand hmm no the injection is not done yet (been busy)"><y>#</y><d>2019-04-08</d><h>16:03</h><w>cgrand</w>hmm no the injection is not done yet (been busy)</z><z id="t1554739794" t="bozhidar yeah, I know. Just remember that demo you showed me way back in December and that we spoke that the injection could be a good way to provide custom transports seamlessly."><y>#</y><d>2019-04-08</d><h>16:09</h><w>bozhidar</w>yeah, I know. Just remember that demo you showed me way back in December and that we spoke that the injection could be a good way to provide custom transports seamlessly.</z><z id="t1554740015" t="dominicm [:attrs {:href &quot;/_/_/users/U051BLM8F&quot;}] I don&apos;t think that browsers let you make arbitrary socket calls."><y>#</y><d>2019-04-08</d><h>16:13</h><w>dominicm</w><a>@bozhidar</a> I don&apos;t think that browsers let you make arbitrary socket calls.</z><z id="t1554740185" t="bozhidar Good point. That approach would work for conventional clients, but not for [:attrs {:href &quot;/_/_/users/U4YGF4NGM&quot;}] â€™s use case."><y>#</y><d>2019-04-08</d><h>16:16</h><w>bozhidar</w>Good point. That approach would work for conventional clients, but not for <a>@lilactown</a>â€™s use case.</z><z id="t1554740293" t="lilactown I kind of want just a dumb endpoint that I could dump some code into to â€œinjectâ€ stuff, like a heavier HTTP transport if needed"><y>#</y><d>2019-04-08</d><h>16:18</h><w>lilactown</w>I kind of want just a dumb endpoint that I could dump some code into to â€œinjectâ€ stuff, like a heavier HTTP transport if needed</z><z id="t1554744901" t="dominicm An interesting idea would be to have the default transport allow sideloading via a very dumb detection of http request"><y>#</y><d>2019-04-08</d><h>17:35</h><w>dominicm</w>An interesting idea would be to have the default transport allow sideloading via a very dumb detection of http request</z><z id="t1554744980" t="dominicm Not sure how much parsing would be needed for the cases we want to support."><y>#</y><d>2019-04-08</d><h>17:36</h><w>dominicm</w>Not sure how much parsing would be needed for the cases we want to support.</z><z id="t1555063119" t="roklenarcic In https://github.com/nrepl/piggieback readme there&apos;s this instruction. :profiles {:dev {:dependencies [[cider/piggieback &quot;0.4.0&quot;]] :repl-options {:nrepl-middleware [cider.piggieback/wrap-cljs-repl]}}} I have that and also [cider/cider-nrepl &quot;0.19.0&quot;] dependency. However when I run lein repl I get this: [WARNING] No nREPL middleware descriptor in metadata of #&apos;cider.piggieback/wrap-cljs-repl, see clojure.tools.middleware/set-descriptor! and repl doesn&apos;t work. It works when I downgrade cider/piggieback to 0.3.10"><y>#</y><d>2019-04-12</d><h>09:58</h><w>roklenarcic</w>In <a href="https://github.com/nrepl/piggieback" target="_blank">https://github.com/nrepl/piggieback</a> readme there&apos;s this instruction.

<pre>:profiles {:dev {:dependencies [[cider/piggieback &quot;0.4.0&quot;]]
                 :repl-options {:nrepl-middleware [cider.piggieback/wrap-cljs-repl]}}}
</pre>

I have that and also <code>[cider/cider-nrepl &quot;0.19.0&quot;]</code> dependency. However when I run <code>lein repl</code> I get this:

<pre>[WARNING] No nREPL middleware descriptor in metadata of #&apos;cider.piggieback/wrap-cljs-repl, see clojure.tools.middleware/set-descriptor!
</pre>
and repl doesn&apos;t work. It works when I downgrade <code>cider/piggieback</code> to 0.3.10</z><z id="t1555063150" t="roklenarcic But that piggieback version doesn&apos;t work in other envrionment so I&apos;m kinda stuck"><y>#</y><d>2019-04-12</d><h>09:59</h><w>roklenarcic</w>But that piggieback version doesn&apos;t work in other envrionment so I&apos;m kinda stuck</z><z id="t1555081710" t="bozhidar [:attrs {:href &quot;/_/_/users/U66G3SGP5&quot;}] You should also use cider-nrepl 0.21 and nREPL 0.6 (lein 2.9.1)."><y>#</y><d>2019-04-12</d><h>15:08</h><w>bozhidar</w><a>@roklenarcic</a> You should also use <code>cider-nrepl 0.21</code> and nREPL 0.6 (lein 2.9.1).</z><z id="t1555081815" t="bozhidar Seems to me youâ€™re using some older Lein/nREPL combo."><y>#</y><d>2019-04-12</d><h>15:10</h><w>bozhidar</w>Seems to me youâ€™re using some older Lein/nREPL combo.</z><z id="t1555320765" t="roklenarcic It works if I upgrade lein to latest version"><y>#</y><d>2019-04-15</d><h>09:32</h><w>roklenarcic</w>It works if I upgrade lein to latest version</z><z id="t1556048614" t="pez Can anyone see the reason why this project file: (defproject pftv &quot;0.1.0-SNAPSHOT&quot; :description &quot;FIXME: write description&quot; :url &quot;&quot; :license {:name &quot;EPL-2.0 OR GPL-2.0-or-later WITH Classpath-exception-2.0&quot; :url &quot;&quot;} :dependencies [[org.clojure/clojure &quot;1.9.0&quot;] [criterium &quot;0.4.4&quot;]] :repl-options {:init-ns pftv.core}) With this command line: lein update-in :dependencies conj &quot;[nrepl \&quot;0.5.3\&quot;]&quot; -- update-in :plugins conj &quot;[cider/cider-nrepl \&quot;0.20.0\&quot;]&quot; -- update-in &quot;[:repl-options :nrepl-middleware]&quot; conj &quot;[\&quot;cider.nrepl/cider-middleware\&quot;]&quot; -- repl Would fail like this: Error loading cider.nrepl: Syntax error compiling at (cider/nrepl.clj:1:1). ... Exception in thread &quot;main&quot; Syntax error compiling var at (/private/var/folders/cs/v0sbd67j3_s93nx488j890bw0000gn/T/form-init7118680432847839889.clj:1:9206). at clojure.lang.Compiler.analyzeSeq(Compiler.java:7114) at clojure.lang.Compiler.analyze(Compiler.java:6789) at clojure.lang.Compiler.analyze(Compiler.java:6745) at clojure.lang.Compiler$InvokeExpr.parse(Compiler.java:3888) at clojure.lang.Compiler.analyzeSeq(Compiler.java:7108) at clojure.lang.Compiler.analyze(Compiler.java:6789) at clojure.lang.Compiler.analyze(Compiler.java:6745) at clojure.lang.Compiler$InvokeExpr.parse(Compiler.java:3888) at clojure.lang.Compiler.analyzeSeq(Compiler.java:7108) at clojure.lang.Compiler.analyze(Compiler.java:6789) at clojure.lang.Compiler.access$300(Compiler.java:38) at clojure.lang.Compiler$LetExpr$Parser.parse(Compiler.java:6384) at clojure.lang.Compiler.analyzeSeq(Compiler.java:7106) at clojure.lang.Compiler.analyze(Compiler.java:6789) at clojure.lang.Compiler.analyze(Compiler.java:6745) at clojure.lang.Compiler$BodyExpr$Parser.parse(Compiler.java:6120) at clojure.lang.Compiler$FnMethod.parse(Compiler.java:5467) at clojure.lang.Compiler$FnExpr.parse(Compiler.java:4029) at clojure.lang.Compiler.analyzeSeq(Compiler.java:7104) at clojure.lang.Compiler.analyze(Compiler.java:6789) at clojure.lang.Compiler.eval(Compiler.java:7173) at clojure.lang.Compiler.eval(Compiler.java:7166) at clojure.lang.Compiler.eval(Compiler.java:7166) at clojure.lang.Compiler.eval(Compiler.java:7166) at clojure.lang.Compiler.load(Compiler.java:7635) at clojure.lang.Compiler.loadFile(Compiler.java:7573) at clojure.main$load_script.invokeStatic(main.clj:452) at clojure.main$init_opt.invokeStatic(main.clj:454) at clojure.main$init_opt.invoke(main.clj:454) at clojure.main$initialize.invokeStatic(main.clj:485) at clojure.main$null_opt.invokeStatic(main.clj:519) at clojure.main$null_opt.invoke(main.clj:516) at clojure.main$main.invokeStatic(main.clj:598) at clojure.main$main.doInvoke(main.clj:561) at clojure.lang.RestFn.applyTo(RestFn.java:137) at clojure.lang.Var.applyTo(Var.java:705) at clojure.main.main(main.java:37) Caused by: java.lang.RuntimeException: Unable to resolve var: cider.nrepl/wrap-apropos in this context at clojure.lang.Util.runtimeException(Util.java:221) at clojure.lang.Compiler$TheVarExpr$Parser.parse(Compiler.java:720) at clojure.lang.Compiler.analyzeSeq(Compiler.java:7106) ... 36 more "><y>#</y><d>2019-04-23</d><h>19:43</h><w>pez</w>Can anyone see the reason why this project file:<pre>(defproject pftv &quot;0.1.0-SNAPSHOT&quot;
  :description &quot;FIXME: write description&quot;
  :url &quot;&quot;
  :license {:name &quot;EPL-2.0 OR GPL-2.0-or-later WITH Classpath-exception-2.0&quot;
            :url &quot;&quot;}
  :dependencies [[org.clojure/clojure &quot;1.9.0&quot;]
                 [criterium &quot;0.4.4&quot;]]
  :repl-options {:init-ns pftv.core})
</pre>
With this command line: <pre>lein update-in :dependencies conj &quot;[nrepl \&quot;0.5.3\&quot;]&quot; -- update-in :plugins conj &quot;[cider/cider-nrepl \&quot;0.20.0\&quot;]&quot; -- update-in &quot;[:repl-options :nrepl-middleware]&quot; conj &quot;[\&quot;cider.nrepl/cider-middleware\&quot;]&quot;  -- repl
</pre>
Would fail like this: <pre>Error loading cider.nrepl: Syntax error compiling at (cider/nrepl.clj:1:1).
...
Exception in thread &quot;main&quot; Syntax error compiling var at (/private/var/folders/cs/v0sbd67j3_s93nx488j890bw0000gn/T/form-init7118680432847839889.clj:1:9206).
	at clojure.lang.Compiler.analyzeSeq(Compiler.java:7114)
	at clojure.lang.Compiler.analyze(Compiler.java:6789)
	at clojure.lang.Compiler.analyze(Compiler.java:6745)
	at clojure.lang.Compiler$InvokeExpr.parse(Compiler.java:3888)
	at clojure.lang.Compiler.analyzeSeq(Compiler.java:7108)
	at clojure.lang.Compiler.analyze(Compiler.java:6789)
	at clojure.lang.Compiler.analyze(Compiler.java:6745)
	at clojure.lang.Compiler$InvokeExpr.parse(Compiler.java:3888)
	at clojure.lang.Compiler.analyzeSeq(Compiler.java:7108)
	at clojure.lang.Compiler.analyze(Compiler.java:6789)
	at clojure.lang.Compiler.access$300(Compiler.java:38)
	at clojure.lang.Compiler$LetExpr$Parser.parse(Compiler.java:6384)
	at clojure.lang.Compiler.analyzeSeq(Compiler.java:7106)
	at clojure.lang.Compiler.analyze(Compiler.java:6789)
	at clojure.lang.Compiler.analyze(Compiler.java:6745)
	at clojure.lang.Compiler$BodyExpr$Parser.parse(Compiler.java:6120)
	at clojure.lang.Compiler$FnMethod.parse(Compiler.java:5467)
	at clojure.lang.Compiler$FnExpr.parse(Compiler.java:4029)
	at clojure.lang.Compiler.analyzeSeq(Compiler.java:7104)
	at clojure.lang.Compiler.analyze(Compiler.java:6789)
	at clojure.lang.Compiler.eval(Compiler.java:7173)
	at clojure.lang.Compiler.eval(Compiler.java:7166)
	at clojure.lang.Compiler.eval(Compiler.java:7166)
	at clojure.lang.Compiler.eval(Compiler.java:7166)
	at clojure.lang.Compiler.load(Compiler.java:7635)
	at clojure.lang.Compiler.loadFile(Compiler.java:7573)
	at clojure.main$load_script.invokeStatic(main.clj:452)
	at clojure.main$init_opt.invokeStatic(main.clj:454)
	at clojure.main$init_opt.invoke(main.clj:454)
	at clojure.main$initialize.invokeStatic(main.clj:485)
	at clojure.main$null_opt.invokeStatic(main.clj:519)
	at clojure.main$null_opt.invoke(main.clj:516)
	at clojure.main$main.invokeStatic(main.clj:598)
	at clojure.main$main.doInvoke(main.clj:561)
	at clojure.lang.RestFn.applyTo(RestFn.java:137)
	at clojure.lang.Var.applyTo(Var.java:705)
	at clojure.main.main(main.java:37)
Caused by: java.lang.RuntimeException: Unable to resolve var: cider.nrepl/wrap-apropos in this context
	at clojure.lang.Util.runtimeException(Util.java:221)
	at clojure.lang.Compiler$TheVarExpr$Parser.parse(Compiler.java:720)
	at clojure.lang.Compiler.analyzeSeq(Compiler.java:7106)
	... 36 more
</pre></z><z id="t1556048838" t="dominicm feels like something is missing."><y>#</y><d>2019-04-23</d><h>19:47</h><w>dominicm</w>feels like something is missing.</z><z id="t1556048854" t="dominicm oh, that doesn&apos;t fail for me"><y>#</y><d>2019-04-23</d><h>19:47</h><w>dominicm</w>oh, that doesn&apos;t fail for me</z><z id="t1556048855" t="pez The background here is that I am tryin gto figure out the right jack-in command lines for Calva 2. And using nrepl 0.6.0 , cider-nrepl 0.21.1 and piggieback 0.4.0 behaves sufficiently different for the cljs repl that I would like to try use the generation before. That works nicely in my cljs test project, but then I tried with a simple clj-only project and got the above."><y>#</y><d>2019-04-23</d><h>19:47</h><w>pez</w>The background here is that I am tryin gto figure out the right jack-in command lines for Calva 2. And using nrepl 0.6.0 , cider-nrepl 0.21.1 and piggieback 0.4.0 behaves sufficiently different for the cljs repl that I would like to try use the generation before. That works nicely in my cljs test project, but then I tried with a simple clj-only project and got the above.</z><z id="t1556048903" t="dominicm ah, it does with your project.clj"><y>#</y><d>2019-04-23</d><h>19:48</h><w>dominicm</w>ah, it does with your project.clj</z><z id="t1556048913" t="pez The above project starts smoothly if I change the command line to the latest nrepl etc."><y>#</y><d>2019-04-23</d><h>19:48</h><w>pez</w>The above project starts smoothly if I change the command line to the latest nrepl etc.</z><z id="t1556048928" t="pez What about my project.clj?"><y>#</y><d>2019-04-23</d><h>19:48</h><w>pez</w>What about my project.clj?</z><z id="t1556048931" t="dominicm works for me if I remove the clojure dependency"><y>#</y><d>2019-04-23</d><h>19:48</h><w>dominicm</w>works for me if I remove the clojure dependency</z><z id="t1556048958" t="pez Wow, remove it? Why did you even try that?"><y>#</y><d>2019-04-23</d><h>19:49</h><w>pez</w>Wow, remove it? Why did you even try that?</z><z id="t1556048973" t="dominicm because of the test project.clj it happened to work on when I tried it"><y>#</y><d>2019-04-23</d><h>19:49</h><w>dominicm</w>because of the test project.clj it happened to work on when I tried it</z><z id="t1556048978" t="dominicm I get a lot of Error loading cider.nrepl: java.io.FileNotFoundException: Could not locate nrepl/middleware/pr_values__init.class or nrepl/middleware/pr_values.clj on classpath. Please check that namespaces with dashes use underscores in the Clojure file name., compiling:(cider/nrepl.clj:1:1) on clojure 1.8.0"><y>#</y><d>2019-04-23</d><h>19:49</h><w>dominicm</w>I get a lot of <code>Error loading cider.nrepl: java.io.FileNotFoundException: Could not locate nrepl/middleware/pr_values__init.class or nrepl/middleware/pr_values.clj on classpath. Please check that namespaces with dashes use underscores in the Clojure file name., compiling:(cider/nrepl.clj:1:1)</code> on clojure 1.8.0</z><z id="t1556049015" t="pez I tried using clojure 1.10.0, but that didnâ€™t help. Would never have tried to remove it."><y>#</y><d>2019-04-23</d><h>19:50</h><w>pez</w>I tried using clojure 1.10.0, but that didnâ€™t help. Would never have tried to remove it.</z><z id="t1556049026" t="dominicm No idea why it works"><y>#</y><d>2019-04-23</d><h>19:50</h><w>dominicm</w>No idea why it works</z><z id="t1556049063" t="pez So that helps with my project, but not for Calva reallyâ€¦"><y>#</y><d>2019-04-23</d><h>19:51</h><w>pez</w>So that helps with my project, but not for Calva reallyâ€¦</z><z id="t1556049190" t="dominicm have you compared what cider generates for your project?"><y>#</y><d>2019-04-23</d><h>19:53</h><w>dominicm</w>have you compared what cider generates for your project?</z><z id="t1556049195" t="dominicm with an older cider version I guess?"><y>#</y><d>2019-04-23</d><h>19:53</h><w>dominicm</w>with an older cider version I guess?</z><z id="t1556049254" t="pez If I remove the clojure dependency I get Error: Could not find or load main class clojure.main Caused by: java.lang.ClassNotFoundException: clojure.main Subprocess failed"><y>#</y><d>2019-04-23</d><h>19:54</h><w>pez</w>If I remove the clojure dependency I get <pre>Error: Could not find or load main class clojure.main
Caused by: java.lang.ClassNotFoundException: clojure.main
Subprocess failed</pre></z><z id="t1556049285" t="dominicm I can go even simpler than your example though lein update-in :plugins conj &quot;[cider/cider-nrepl \&quot;0.20.0\&quot;]&quot; -- repl doesn&apos;t work, lein update-in :plugins conj &quot;[cider/cider-nrepl \&quot;0.21.0\&quot;]&quot; -- repl does"><y>#</y><d>2019-04-23</d><h>19:54</h><w>dominicm</w>I can go even simpler than your example though <code>lein update-in :plugins conj &quot;[cider/cider-nrepl \&quot;0.20.0\&quot;]&quot; -- repl</code>
doesn&apos;t work, <code>lein update-in :plugins conj &quot;[cider/cider-nrepl \&quot;0.21.0\&quot;]&quot; -- repl</code> does</z><z id="t1556049300" t="pez And if I also remove the criterium dependency the repl starts, but before that a lot of complaints and of course my code needing criterium will not work."><y>#</y><d>2019-04-23</d><h>19:55</h><w>pez</w>And if I also remove the criterium dependency the repl starts, but before that a lot of complaints and of course my code needing criterium will not work.</z><z id="t1556049406" t="pez You mean trying with emacs/cider? No, havenâ€™t. I will do that now. Thing is my computer does not really like emacs, which is why Calva even exists. But I will force feed it."><y>#</y><d>2019-04-23</d><h>19:56</h><w>pez</w>You mean trying with emacs/cider? No, havenâ€™t. I will do that now. Thing is my computer does not really like emacs, which is why Calva even exists. But I will force feed it.</z><z id="t1556049422" t="dominicm I wonder if that&apos;s true if you just put it straight into the project.clj."><y>#</y><d>2019-04-23</d><h>19:57</h><w>dominicm</w>I wonder if that&apos;s true if you just put it straight into the project.clj.</z><z id="t1556049436" t="pez If what is true?"><y>#</y><d>2019-04-23</d><h>19:57</h><w>pez</w>If what is true?</z><z id="t1556049531" t="dominicm If it fails still, sorry"><y>#</y><d>2019-04-23</d><h>19:58</h><w>dominicm</w>If it fails still, sorry</z><z id="t1556049549" t="dominicm Does criterium depends on nrepl maybe?"><y>#</y><d>2019-04-23</d><h>19:59</h><w>dominicm</w>Does criterium depends on nrepl maybe?</z><z id="t1556049690" t="pez I doubt it uses nrepl. But that might explain stuff. Must check."><y>#</y><d>2019-04-23</d><h>20:01</h><w>pez</w>I doubt it uses nrepl. But that might explain stuff. Must check.</z><z id="t1556049906" t="dominicm (defproject pftv &quot;0.1.0-SNAPSHOT&quot; :dependencies [[org.clojure/clojure &quot;1.8.0&quot;]] :plugins [[cider/cider-nrepl &quot;0.20.0&quot;]]) with lein repl is broken"><y>#</y><d>2019-04-23</d><h>20:05</h><w>dominicm</w><pre>(defproject pftv &quot;0.1.0-SNAPSHOT&quot;
 :dependencies [[org.clojure/clojure &quot;1.8.0&quot;]]
 :plugins [[cider/cider-nrepl &quot;0.20.0&quot;]])
</pre>

with <code>lein repl</code> is broken</z><z id="t1556049906" t="pez No nrepl deps thereâ€¦"><y>#</y><d>2019-04-23</d><h>20:05</h><w>pez</w>No nrepl deps thereâ€¦</z><z id="t1556049946" t="dominicm â¯ lein deps :tree [cider/cider-nrepl &quot;0.20.0&quot;] [cider/orchard &quot;0.4.0&quot; :exclusions [[org.clojure/clojure]]] [org.tcrawley/dynapath &quot;0.2.5&quot; :exclusions [[org.clojure/clojure]]] [cljfmt &quot;0.6.1&quot; :exclusions [[org.clojure/clojure] [org.clojure/clojurescript]]] [com.googlecode.java-diff-utils/diffutils &quot;1.3.0&quot;] [org.clojure/tools.cli &quot;0.3.7&quot;] [rewrite-clj &quot;0.6.0&quot;] [rewrite-cljs &quot;0.4.4&quot;] [cljs-tooling &quot;0.3.1&quot; :exclusions [[org.clojure/clojure]]] [compliment &quot;0.3.8&quot; :exclusions [[org.clojure/clojure]]] [fipp &quot;0.6.14&quot; :exclusions [[org.clojure/clojure]]] [org.clojure/core.rrb-vector &quot;0.0.13&quot;] [mvxcvi/puget &quot;1.0.2&quot; :exclusions [[org.clojure/clojure]]] [mvxcvi/arrangement &quot;1.1.1&quot;] [org.clojure/java.classpath &quot;0.3.0&quot; :exclusions [[org.clojure/clojure]]] [org.clojure/tools.namespace &quot;0.3.0-alpha4&quot; :exclusions [[org.clojure/clojure]]] [org.clojure/tools.reader &quot;1.2.2&quot; :exclusions [[org.clojure/clojure]]] [org.clojure/tools.trace &quot;0.7.10&quot; :exclusions [[org.clojure/clojure]]] [thunknyc/profile &quot;0.5.2&quot; :exclusions [[org.clojure/clojure]]] [clojure-complete &quot;0.2.5&quot; :exclusions [[org.clojure/clojure]]] [nrepl &quot;0.6.0&quot; :exclusions [[org.clojure/clojure]]] [org.clojure/clojure &quot;1.8.0&quot;] Looks good to me, modern nrepl version"><y>#</y><d>2019-04-23</d><h>20:05</h><w>dominicm</w><pre>â¯ lein deps :tree    
 [cider/cider-nrepl &quot;0.20.0&quot;]
   [cider/orchard &quot;0.4.0&quot; :exclusions [[org.clojure/clojure]]]
     [org.tcrawley/dynapath &quot;0.2.5&quot; :exclusions [[org.clojure/clojure]]]
   [cljfmt &quot;0.6.1&quot; :exclusions [[org.clojure/clojure] [org.clojure/clojurescript]]]
     [com.googlecode.java-diff-utils/diffutils &quot;1.3.0&quot;]
     [org.clojure/tools.cli &quot;0.3.7&quot;]
     [rewrite-clj &quot;0.6.0&quot;]
     [rewrite-cljs &quot;0.4.4&quot;]
   [cljs-tooling &quot;0.3.1&quot; :exclusions [[org.clojure/clojure]]]
   [compliment &quot;0.3.8&quot; :exclusions [[org.clojure/clojure]]]
   [fipp &quot;0.6.14&quot; :exclusions [[org.clojure/clojure]]]
     [org.clojure/core.rrb-vector &quot;0.0.13&quot;]
   [mvxcvi/puget &quot;1.0.2&quot; :exclusions [[org.clojure/clojure]]]
     [mvxcvi/arrangement &quot;1.1.1&quot;]
   [org.clojure/java.classpath &quot;0.3.0&quot; :exclusions [[org.clojure/clojure]]]
   [org.clojure/tools.namespace &quot;0.3.0-alpha4&quot; :exclusions [[org.clojure/clojure]]]
   [org.clojure/tools.reader &quot;1.2.2&quot; :exclusions [[org.clojure/clojure]]]
   [org.clojure/tools.trace &quot;0.7.10&quot; :exclusions [[org.clojure/clojure]]]
   [thunknyc/profile &quot;0.5.2&quot; :exclusions [[org.clojure/clojure]]]
 [clojure-complete &quot;0.2.5&quot; :exclusions [[org.clojure/clojure]]]
 [nrepl &quot;0.6.0&quot; :exclusions [[org.clojure/clojure]]]
 [org.clojure/clojure &quot;1.8.0&quot;]
</pre>

Looks good to me, modern nrepl version</z><z id="t1556050004" t="dominicm Weird, without cider I&apos;m getting: â¯ lein repl nREPL server started on port 42939 on host 127.0.0.1 - REPL-y 0.4.3, nREPL 0.6.0 Clojure 1.8.0 OpenJDK 64-Bit Server VM 1.8.0_202-b00 Docs: (doc function-name-here) (find-doc &quot;part-of-name-here&quot;) Source: (source function-name-here) Javadoc: (javadoc java-object-or-class-here) Exit: Control+D or (exit) or (quit) Results: Stored in vars *1, *2, *3, an exception in *e user=&gt; (require &apos;nrepl.middleware.pr-values) "><y>#</y><d>2019-04-23</d><h>20:06</h><w>dominicm</w>Weird, without cider I&apos;m getting:

<pre>â¯ lein repl      
nREPL server started on port 42939 on host 127.0.0.1 - 
REPL-y 0.4.3, nREPL 0.6.0
Clojure 1.8.0
OpenJDK 64-Bit Server VM 1.8.0_202-b00
    Docs: (doc function-name-here)
          (find-doc &quot;part-of-name-here&quot;)
  Source: (source function-name-here)
 Javadoc: (javadoc java-object-or-class-here)
    Exit: Control+D or (exit) or (quit)
 Results: Stored in vars *1, *2, *3, an exception in *e

user=&gt; (require &apos;nrepl.middleware.pr-values)
</pre></z><z id="t1556050035" t="dominicm ah, 0.6.0 doesn&apos;t have pr-values!"><y>#</y><d>2019-04-23</d><h>20:07</h><w>dominicm</w>ah, 0.6.0 doesn&apos;t have pr-values!</z><z id="t1556050064" t="dominicm (defproject pftv &quot;0.1.0-SNAPSHOT&quot; :dependencies [[org.clojure/clojure &quot;1.8.0&quot;] [nrepl &quot;0.5.3&quot;]] :plugins [[cider/cider-nrepl &quot;0.20.0&quot;]]) This works fine"><y>#</y><d>2019-04-23</d><h>20:07</h><w>dominicm</w><pre>(defproject pftv &quot;0.1.0-SNAPSHOT&quot;
 :dependencies [[org.clojure/clojure &quot;1.8.0&quot;]
                [nrepl &quot;0.5.3&quot;]]
 :plugins [[cider/cider-nrepl &quot;0.20.0&quot;]])
</pre>

This works fine</z><z id="t1556050092" t="dominicm (of course, your injecting that via cli should work too, but it&apos;s not for some reasons, but now we know what is wrong)"><y>#</y><d>2019-04-23</d><h>20:08</h><w>dominicm</w>(of course, your injecting that via cli should work too, but it&apos;s not for some reasons, but now we know what is wrong)</z><z id="t1556050120" t="pez Iâ€™ve seen complains about pr-values. What is that?"><y>#</y><d>2019-04-23</d><h>20:08</h><w>pez</w>Iâ€™ve seen complains about pr-values. What is that?</z><z id="t1556050139" t="dominicm A middleware ðŸ˜„"><y>#</y><d>2019-04-23</d><h>20:08</h><w>dominicm</w>A middleware <b>ðŸ˜„</b></z><z id="t1556050157" t="dominicm I have a suspicion that leiningen doesn&apos;t allow injecting the nrepl version via update-in"><y>#</y><d>2019-04-23</d><h>20:09</h><w>dominicm</w>I have a suspicion that leiningen doesn&apos;t allow injecting the nrepl version via update-in</z><z id="t1556050189" t="pez Oh, wow, that would screw me up quite a lot."><y>#</y><d>2019-04-23</d><h>20:09</h><w>pez</w>Oh, wow, that would screw me up quite a lot.</z><z id="t1556050208" t="dominicm easily verified: /tmp/foo 1 21:09:49 â¯ lein update-in :dependencies conj &quot;[nrepl \&quot;0.5.3\&quot;]&quot; -- deps :treePossibly confusing dependencies found: [nrepl &quot;0.6.0&quot; :exclusions [org.clojure/clojure]] overrides [nrepl &quot;0.5.3&quot;] Consider using these exclusions: [clojure-complete &quot;0.2.5&quot; :exclusions [[org.clojure/clojure]]] [nrepl &quot;0.6.0&quot; :exclusions [[org.clojure/clojure]]] [org.clojure/clojure &quot;1.8.0&quot;] "><y>#</y><d>2019-04-23</d><h>20:10</h><w>dominicm</w>easily verified:

<pre>/tmp/foo                                                                1 21:09:49
â¯ lein update-in :dependencies conj &quot;[nrepl \&quot;0.5.3\&quot;]&quot; -- deps :treePossibly confusing dependencies found:
[nrepl &quot;0.6.0&quot; :exclusions [org.clojure/clojure]]
 overrides
[nrepl &quot;0.5.3&quot;]

Consider using these exclusions:


 [clojure-complete &quot;0.2.5&quot; :exclusions [[org.clojure/clojure]]]
 [nrepl &quot;0.6.0&quot; :exclusions [[org.clojure/clojure]]]
 [org.clojure/clojure &quot;1.8.0&quot;]
</pre></z><z id="t1556050213" t="dominicm yeah, doesn&apos;t work ðŸ™‚"><y>#</y><d>2019-04-23</d><h>20:10</h><w>dominicm</w>yeah, doesn&apos;t work <b>ðŸ™‚</b></z><z id="t1556050234" t="dominicm nrepl is added to :dependencies before update-in has a chance to run"><y>#</y><d>2019-04-23</d><h>20:10</h><w>dominicm</w><code>nrepl</code> is added to <code>:dependencies</code> before <code>update-in</code> has a chance to run</z><z id="t1556050296" t="pez leiningen adds that?"><y>#</y><d>2019-04-23</d><h>20:11</h><w>pez</w>leiningen adds that?</z><z id="t1556050425" t="dominicm yup"><y>#</y><d>2019-04-23</d><h>20:13</h><w>dominicm</w>yup</z><z id="t1556050525" t="dpsutton https://github.com/technomancy/leiningen/blob/master/project.clj#L21"><y>#</y><d>2019-04-23</d><h>20:15</h><w>dpsutton</w><a href="https://github.com/technomancy/leiningen/blob/master/project.clj#L21" target="_blank">https://github.com/technomancy/leiningen/blob/master/project.clj#L21</a></z><z id="t1556050574" t="dpsutton just realized how crazy is it that leiningen has its own project.clj file..."><y>#</y><d>2019-04-23</d><h>20:16</h><w>dpsutton</w>just realized how crazy is it that leiningen has its own project.clj file...</z><z id="t1556050660" t="pez OK. I would have hoped that things moved in the direction where no project includes nrepl etc , and instead the world would depend on injections."><y>#</y><d>2019-04-23</d><h>20:17</h><w>pez</w>OK. I would have hoped that things moved in the direction where no project includes nrepl etc , and instead the world would depend on injections.</z><z id="t1556050702" t="dominicm leiningen depends on it in order to provide the lein repl command"><y>#</y><d>2019-04-23</d><h>20:18</h><w>dominicm</w>leiningen depends on it in order to provide the <code>lein repl</code> command</z><z id="t1556050848" t="pez Yeah, it makes some sense, of course, but â€¦ Anyway, this leaves me with the only option to try figure out why Calva does not work with piggieback 0.4.0 (not sure it is piggieback that is the culprit, but the hints I have gathered so far points in that direction."><y>#</y><d>2019-04-23</d><h>20:20</h><w>pez</w>Yeah, it makes some sense, of course, but â€¦ Anyway, this leaves me with the only option to try figure out why Calva does not work with piggieback 0.4.0 (not sure it is piggieback that is the culprit, but the hints I have gathered so far points in that direction.</z><z id="t1556050894" t="pez [:attrs {:href &quot;/_/_/users/U1GCL8V2B&quot;}] ^ lein hardcodes nrepl 0.6.0, all bets are off ^"><y>#</y><d>2019-04-23</d><h>20:21</h><w>pez</w><a>@mseddon</a> ^ lein hardcodes nrepl 0.6.0, all bets are off ^</z><z id="t1556051275" t="pez So, this might be the best place to ask this. With piggieback 0.4.0 (again, I think itâ€™s piggieback) I do not get any out or err result messages from my eval calls for the cljs repl. Am I supposed to look for them in some other way?"><y>#</y><d>2019-04-23</d><h>20:27</h><w>pez</w>So, this might be the best place to ask this. With piggieback 0.4.0 (again, I think itâ€™s piggieback) I do not get any <code>out</code> or <code>err</code> result messages from my <code>eval</code> calls for the cljs repl. Am I supposed to look for them in some other way?</z><z id="t1556051368" t="dpsutton (--&gt; id &quot;310&quot; op &quot;eval&quot; session &quot;65a5a0ee-d1f8-4fb4-ac1d-fac1df6e19c8&quot; time-stamp &quot;2019-04-23 15:28:51.837145000&quot; code &quot;(prn (+ 1 1)) &quot; column 1 file &quot;/Users/dan/projects/aclaimant/acl/resources/public/js/app.ou...&quot; line 56 nrepl.middleware.print/print &quot;cider.nrepl.pprint/pr&quot; nrepl.middleware.print/quota 1048576 nrepl.middleware.print/stream? nil ns &quot;pushy.core&quot; ) (&lt;-- id &quot;11&quot; session &quot;65a5a0ee-d1f8-4fb4-ac1d-fac1df6e19c8&quot; time-stamp &quot;2019-04-23 15:28:51.876571000&quot; out &quot;2 &quot; ) (&lt;-- id &quot;310&quot; session &quot;65a5a0ee-d1f8-4fb4-ac1d-fac1df6e19c8&quot; time-stamp &quot;2019-04-23 15:28:51.882699000&quot; ns &quot;pushy.core&quot; printed-value 1 value &quot;nil&quot; ) (&lt;-- id &quot;310&quot; session &quot;65a5a0ee-d1f8-4fb4-ac1d-fac1df6e19c8&quot; time-stamp &quot;2019-04-23 15:28:51.884496000&quot; status (&quot;done&quot;) ) "><y>#</y><d>2019-04-23</d><h>20:29</h><w>dpsutton</w><pre>(--&gt;
  id                             &quot;310&quot;
  op                             &quot;eval&quot;
  session                        &quot;65a5a0ee-d1f8-4fb4-ac1d-fac1df6e19c8&quot;
  time-stamp                     &quot;2019-04-23 15:28:51.837145000&quot;
  code                           &quot;(prn (+ 1 1))
&quot;
  column                         1
  file                           &quot;/Users/dan/projects/aclaimant/acl/resources/public/js/app.ou...&quot;
  line                           56
  nrepl.middleware.print/print   &quot;cider.nrepl.pprint/pr&quot;
  nrepl.middleware.print/quota   1048576
  nrepl.middleware.print/stream? nil
  ns                             &quot;pushy.core&quot;
)
(&lt;--
  id         &quot;11&quot;
  session    &quot;65a5a0ee-d1f8-4fb4-ac1d-fac1df6e19c8&quot;
  time-stamp &quot;2019-04-23 15:28:51.876571000&quot;
  out        &quot;2
&quot;
)
(&lt;--
  id            &quot;310&quot;
  session       &quot;65a5a0ee-d1f8-4fb4-ac1d-fac1df6e19c8&quot;
  time-stamp    &quot;2019-04-23 15:28:51.882699000&quot;
  ns            &quot;pushy.core&quot;
  printed-value 1
  value         &quot;nil&quot;
)
(&lt;--
  id         &quot;310&quot;
  session    &quot;65a5a0ee-d1f8-4fb4-ac1d-fac1df6e19c8&quot;
  time-stamp &quot;2019-04-23 15:28:51.884496000&quot;
  status     (&quot;done&quot;)
)
</pre></z><z id="t1556051377" t="pez Also. I get this in the terminal where I started the REPL with 0.4.0: Exception in thread &quot;nRepl-session-8067c4a9-e320-4f8e-b84f-890c8cbf2097&quot; java.lang.IllegalArgumentException: No implementation of method: :send of protocol: #&apos;nrepl.transport/Transport found for class: nil at clojure.core$_cache_protocol_fn.invokeStatic(core_deftype.clj:583) at clojure.core$_cache_protocol_fn.invoke(core_deftype.clj:575) at nrepl.transport$eval20664$fn__20665$G__20655__20672.invoke(transport.clj:16) at nrepl.middleware.print$replying_PrintWriter$fn__21121.invoke(print.clj:115) at nrepl.middleware.print.proxy$java.io.Writer$ff19274a.write(Unknown Source) at java.io.BufferedWriter.flushBuffer(BufferedWriter.java:129) at java.io.BufferedWriter.flush(BufferedWriter.java:253) at java.io.PrintWriter.newLine(PrintWriter.java:482) at java.io.PrintWriter.println(PrintWriter.java:629) at java.io.PrintWriter.println(PrintWriter.java:757) at java.lang.Throwable$WrappedPrintWriter.println(Throwable.java:764) at java.lang.Throwable.printStackTrace(Throwable.java:655) at java.lang.Throwable.printStackTrace(Throwable.java:721) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at java.lang.reflect.Method.invoke(Method.java:498) at clojure.lang.Reflector.invokeMatchingMethod(Reflector.java:93) at clojure.lang.Reflector.invokeInstanceMethod(Reflector.java:28) at cljs.repl$repl_caught.invokeStatic(repl.cljc:802) at cljs.repl$repl_caught.invoke(repl.cljc:788) at cider.piggieback$repl_caught.invokeStatic(piggieback.clj:105) at cider.piggieback$repl_caught.invoke(piggieback.clj:98) at cider.piggieback$do_eval.invokeStatic(piggieback.clj:265) at cider.piggieback$do_eval.invoke(piggieback.clj:227) at cider.piggieback$evaluate.invokeStatic(piggieback.clj:273) at cider.piggieback$evaluate.invoke(piggieback.clj:271) at clojure.lang.Var.invoke(Var.java:381) at cider.piggieback$wrap_cljs_repl$fn__21926$fn__21929$fn__21930.invoke(piggieback.clj:305) at cider.piggieback$enqueue$fn__21898.invoke(piggieback.clj:195) at clojure.lang.AFn.run(AFn.java:22) at nrepl.middleware.session$session_exec$main_loop__21356$fn__21360.invoke(session.clj:171) at nrepl.middleware.session$session_exec$main_loop__21356.invoke(session.clj:170) at clojure.lang.AFn.run(AFn.java:22) at java.lang.Thread.run(Thread.java:748)"><y>#</y><d>2019-04-23</d><h>20:29</h><w>pez</w>Also. I get this in the terminal where I started the REPL with 0.4.0: <pre>Exception in thread &quot;nRepl-session-8067c4a9-e320-4f8e-b84f-890c8cbf2097&quot; java.lang.IllegalArgumentException: No implementation of method: :send of protocol: #&apos;nrepl.transport/Transport found for class: nil
	at clojure.core$_cache_protocol_fn.invokeStatic(core_deftype.clj:583)
	at clojure.core$_cache_protocol_fn.invoke(core_deftype.clj:575)
	at nrepl.transport$eval20664$fn__20665$G__20655__20672.invoke(transport.clj:16)
	at nrepl.middleware.print$replying_PrintWriter$fn__21121.invoke(print.clj:115)
	at nrepl.middleware.print.proxy$java.io.Writer$ff19274a.write(Unknown Source)
	at java.io.BufferedWriter.flushBuffer(BufferedWriter.java:129)
	at java.io.BufferedWriter.flush(BufferedWriter.java:253)
	at java.io.PrintWriter.newLine(PrintWriter.java:482)
	at java.io.PrintWriter.println(PrintWriter.java:629)
	at java.io.PrintWriter.println(PrintWriter.java:757)
	at java.lang.Throwable$WrappedPrintWriter.println(Throwable.java:764)
	at java.lang.Throwable.printStackTrace(Throwable.java:655)
	at java.lang.Throwable.printStackTrace(Throwable.java:721)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at clojure.lang.Reflector.invokeMatchingMethod(Reflector.java:93)
	at clojure.lang.Reflector.invokeInstanceMethod(Reflector.java:28)
	at cljs.repl$repl_caught.invokeStatic(repl.cljc:802)
	at cljs.repl$repl_caught.invoke(repl.cljc:788)
	at cider.piggieback$repl_caught.invokeStatic(piggieback.clj:105)
	at cider.piggieback$repl_caught.invoke(piggieback.clj:98)
	at cider.piggieback$do_eval.invokeStatic(piggieback.clj:265)
	at cider.piggieback$do_eval.invoke(piggieback.clj:227)
	at cider.piggieback$evaluate.invokeStatic(piggieback.clj:273)
	at cider.piggieback$evaluate.invoke(piggieback.clj:271)
	at clojure.lang.Var.invoke(Var.java:381)
	at cider.piggieback$wrap_cljs_repl$fn__21926$fn__21929$fn__21930.invoke(piggieback.clj:305)
	at cider.piggieback$enqueue$fn__21898.invoke(piggieback.clj:195)
	at clojure.lang.AFn.run(AFn.java:22)
	at nrepl.middleware.session$session_exec$main_loop__21356$fn__21360.invoke(session.clj:171)
	at nrepl.middleware.session$session_exec$main_loop__21356.invoke(session.clj:170)
	at clojure.lang.AFn.run(AFn.java:22)
	at java.lang.Thread.run(Thread.java:748)</pre></z><z id="t1556051439" t="dominicm ooh, that&apos;s a bug"><y>#</y><d>2019-04-23</d><h>20:30</h><w>dominicm</w>ooh, that&apos;s a bug</z><z id="t1556051453" t="dominicm I found that one a while ago"><y>#</y><d>2019-04-23</d><h>20:30</h><w>dominicm</w>I found that one a while ago</z><z id="t1556051527" t="pez [:attrs {:href &quot;/_/_/users/U11BV7MTK&quot;}] . you get the out messageâ€¦. Is that with piggieback 0.4.0?"><y>#</y><d>2019-04-23</d><h>20:32</h><w>pez</w><a>@dpsutton</a>. you get the <code>out</code> messageâ€¦. Is that with piggieback 0.4.0?</z><z id="t1556051550" t="pez Which one did you find, [:attrs {:href &quot;/_/_/users/U09LZR36F&quot;}] ?"><y>#</y><d>2019-04-23</d><h>20:32</h><w>pez</w>Which one did you find, <a>@dominicm</a>?</z><z id="t1556051559" t="dpsutton no it didn&apos;t show up in my repl"><y>#</y><d>2019-04-23</d><h>20:32</h><w>dpsutton</w>no it didn&apos;t show up in my repl</z><z id="t1556051561" t="dominicm that exact message, [:attrs {:href &quot;/_/_/users/U052B0PT3&quot;}] fixed it though"><y>#</y><d>2019-04-23</d><h>20:32</h><w>dominicm</w>that exact message, <a>@cichli</a> fixed it though</z><z id="t1556051570" t="dpsutton yes 0.4.0 i believe"><y>#</y><d>2019-04-23</d><h>20:32</h><w>dpsutton</w>yes 0.4.0 i believe</z><z id="t1556051590" t="dpsutton :nrepl-middleware [&quot;cider.piggieback/wrap-cljs-repl&quot;] is present?"><y>#</y><d>2019-04-23</d><h>20:33</h><w>dpsutton</w><code>:nrepl-middleware [&quot;cider.piggieback/wrap-cljs-repl&quot;]</code> is present?</z><z id="t1556051618" t="pez You get the message, but with ID 11, I havenâ€™t looked for it with some other ID."><y>#</y><d>2019-04-23</d><h>20:33</h><w>pez</w>You get the message, but with ID 11, I havenâ€™t looked for it with some other ID.</z><z id="t1556051666" t="dpsutton ah yes. longstanding bug"><y>#</y><d>2019-04-23</d><h>20:34</h><w>dpsutton</w>ah yes. longstanding bug</z><z id="t1556051677" t="dpsutton responds to the subscription message i believe"><y>#</y><d>2019-04-23</d><h>20:34</h><w>dpsutton</w>responds to the subscription message i believe</z><z id="t1556051790" t="pez I think Calva users can live it for a while. But right now that error thrown kills my cljs repl client. I should of course try to make it handle that more gracefullyâ€¦"><y>#</y><d>2019-04-23</d><h>20:36</h><w>pez</w>I think Calva users can live it for a while. But right now that error thrown kills my cljs repl client. I should of course try to make it handle that more gracefullyâ€¦</z><z id="t1556051793" t="dpsutton the out-subscribe"><y>#</y><d>2019-04-23</d><h>20:36</h><w>dpsutton</w>the out-subscribe</z><z id="t1556052200" t="pez I think I might want to get at the info in the out-subscribe, btw. Lots of users ask about where output from their apps go, and that would be a way to present it, right?"><y>#</y><d>2019-04-23</d><h>20:43</h><w>pez</w>I think I might want to get at the info in the out-subscribe, btw. Lots of users ask about where output from their apps go, and that would be a way to present it, right?</z><z id="t1556052354" t="dpsutton yes that&apos;s the way to get the out of the process back into the repl"><y>#</y><d>2019-04-23</d><h>20:45</h><w>dpsutton</w>yes that&apos;s the way to get the out of the process back into the repl</z><z id="t1556052816" t="pez You know where I can read about that subscription?"><y>#</y><d>2019-04-23</d><h>20:53</h><w>pez</w>You know where I can read about that subscription?</z><z id="t1556052873" t="dpsutton https://github.com/clojure-emacs/cider-nrepl/blob/master/src/cider/nrepl/middleware/out.clj#L104"><y>#</y><d>2019-04-23</d><h>20:54</h><w>dpsutton</w><a href="https://github.com/clojure-emacs/cider-nrepl/blob/master/src/cider/nrepl/middleware/out.clj#L104" target="_blank">https://github.com/clojure-emacs/cider-nrepl/blob/master/src/cider/nrepl/middleware/out.clj#L104</a></z><z id="t1556052876" t="dpsutton this whole ns"><y>#</y><d>2019-04-23</d><h>20:54</h><w>dpsutton</w>this whole ns</z><z id="t1556104962" t="bozhidar [:attrs {:href &quot;/_/_/users/U0ETXRFEW&quot;}] Did you manage to solve your problem? I saw the convo just now."><y>#</y><d>2019-04-24</d><h>11:22</h><w>bozhidar</w><a>@pez</a> Did you manage to solve your problem? I saw the convo just now.</z><z id="t1556117616" t="pez [:attrs {:href &quot;/_/_/users/U051BLM8F&quot;}] I am writing an issue on Leiningen right now. And will volunteer to prepare the PR is they think that removing the hard dependency on nrepl is a good idea."><y>#</y><d>2019-04-24</d><h>14:53</h><w>pez</w><a>@bozhidar</a> I am writing an issue on Leiningen right now. And will volunteer to prepare the PR is they think that removing the hard dependency on nrepl is a good idea.</z><z id="t1556117621" t="pez But that is for the long run. In the shorter perspective I must get Calva to work with latest piggieback."><y>#</y><d>2019-04-24</d><h>14:53</h><w>pez</w>But that is for the long run. In the shorter perspective I must get Calva to work with latest piggieback.</z><z id="t1556117676" t="bozhidar So, what exactly is the problem? The latest piggieback didnâ€™t really change anything (it was just updated to work with the current printing middleware) and seems to work fine for me."><y>#</y><d>2019-04-24</d><h>14:54</h><w>bozhidar</w>So, what exactly is the problem? The latest piggieback didnâ€™t really change anything (it was just updated to work with the current printing middleware) and seems to work fine for me.</z><z id="t1556117727" t="pez There is a known (if I understoof [:attrs {:href &quot;/_/_/users/U09LZR36F&quot;}] correctly) bug with out and err messages, that I think I can live with a while. But there is also an exception thrown. Probably because I do something stupid."><y>#</y><d>2019-04-24</d><h>14:55</h><w>pez</w>There is a known (if I understoof <a>@dominicm</a> correctly) bug with <code>out</code> and <code>err</code> messages, that I think I can live with a while. But there is also an exception thrown. Probably because I do something stupid.</z><z id="t1556117809" t="pez OK. I don&apos;t know for sure it stems from piggieback. But using nrepl 0.6.0, cider-nrepl 0.21.1 and piggieback 0.4.0 I get those two problems, and I don&apos;t get them fith 0.5.2, 0.20.0, and 0.3.10, respectively."><y>#</y><d>2019-04-24</d><h>14:56</h><w>pez</w>OK. I don&apos;t know for sure it stems from piggieback. But using nrepl 0.6.0, cider-nrepl 0.21.1 and piggieback 0.4.0 I get those two problems, and I don&apos;t get them fith 0.5.2, 0.20.0, and 0.3.10, respectively.</z><z id="t1556117823" t="bozhidar The thing that [:attrs {:href &quot;/_/_/users/U11BV7MTK&quot;}] discussed is a middleware in cider-nrepl, but I assume youâ€™re referring to this."><y>#</y><d>2019-04-24</d><h>14:57</h><w>bozhidar</w>The thing that <a>@dpsutton</a> discussed is a middleware in cider-nrepl, but I assume youâ€™re referring to this.</z><z id="t1556117880" t="bozhidar https://github.com/nrepl/nrepl/issues/119"><y>#</y><d>2019-04-24</d><h>14:58</h><w>bozhidar</w><a href="https://github.com/nrepl/nrepl/issues/119" target="_blank">https://github.com/nrepl/nrepl/issues/119</a></z><z id="t1556117977" t="bozhidar &gt; OK. I donâ€™t know for sure it stems from piggieback. But using nrepl 0.6.0, cider-nrepl 0.21.1 and piggieback 0.4.0 I get those two problems, and I donâ€™t get them fith 0.5.2, 0.20.0, and 0.3.10, respectively."><y>#</y><d>2019-04-24</d><h>14:59</h><w>bozhidar</w>&gt; OK. I donâ€™t know for sure it stems from piggieback. But using nrepl 0.6.0, cider-nrepl 0.21.1 and piggieback 0.4.0 I get those two problems, and I donâ€™t get them fith 0.5.2, 0.20.0, and 0.3.10, respectively.</z><z id="t1556117984" t="pez Let me read that issue..."><y>#</y><d>2019-04-24</d><h>14:59</h><w>pez</w>Let me read that issue...</z><z id="t1556117996" t="bozhidar Looking at the stacktraces youâ€™ve posted they certainly seem like some version mismatch."><y>#</y><d>2019-04-24</d><h>14:59</h><w>bozhidar</w>Looking at the stacktraces youâ€™ve posted they certainly seem like some version mismatch.</z><z id="t1556118022" t="bozhidar E.g. itâ€™s not possible to get an error about pr_values missing with cider-nrepl 0.21."><y>#</y><d>2019-04-24</d><h>15:00</h><w>bozhidar</w>E.g. itâ€™s not possible to get an error about <code>pr_values</code> missing with <code>cider-nrepl</code> 0.21.</z><z id="t1556118033" t="pez It doesn&apos;t look exactly like what I am experiencing."><y>#</y><d>2019-04-24</d><h>15:00</h><w>pez</w>It doesn&apos;t look exactly like what I am experiencing.</z><z id="t1556118104" t="bozhidar &gt; Exception in thread â€œnRepl-session-8067c4a9-e320-4f8e-b84f-890c8cbf2097â€ java.lang.IllegalArgumentException: No implementation of method: :send of protocol: #â€™nrepl.transport/Transport found for class: nil"><y>#</y><d>2019-04-24</d><h>15:01</h><w>bozhidar</w>&gt; Exception in thread â€œnRepl-session-8067c4a9-e320-4f8e-b84f-890c8cbf2097â€ java.lang.IllegalArgumentException: No implementation of method: :send of protocol: #â€™nrepl.transport/Transport found for class: nil</z><z id="t1556118114" t="bozhidar Is that the stopper problem?"><y>#</y><d>2019-04-24</d><h>15:01</h><w>bozhidar</w>Is that the stopper problem?</z><z id="t1556118171" t="pez I am not sure if it is. I think I should be able to keep my repl client standing, and if so it is not a stopper."><y>#</y><d>2019-04-24</d><h>15:02</h><w>pez</w>I am not sure if it is. I think I should be able to keep my repl client standing, and if so it is not a stopper.</z><z id="t1556118210" t="pez But I haven&apos;t really tried fixing it on my end yet, Just very rececently realized the problem was there."><y>#</y><d>2019-04-24</d><h>15:03</h><w>pez</w>But I haven&apos;t really tried fixing it on my end yet, Just very rececently realized the problem was there.</z><z id="t1556118523" t="pez I have a pretty reproducable problem with those version combos I mentioned above. With the older set of versions, out and err messages arrive as I expect them to, but with the newer set, those messages are gone. What is pr_values , btw?"><y>#</y><d>2019-04-24</d><h>15:08</h><w>pez</w>I have a pretty reproducable problem with those version combos I mentioned above. With the older set of versions, <code>out</code> and <code>err</code> messages arrive as I expect them to, but with the newer set, those messages are gone. What is <code>pr_values</code>,  btw?</z><z id="t1556118658" t="bozhidar It used to be the middleware that converted EDN values into strings that can go in the :value slot."><y>#</y><d>2019-04-24</d><h>15:10</h><w>bozhidar</w>It used to be the middleware that converted EDN values into strings that can go in the <code>:value</code> slot.</z><z id="t1556118698" t="bozhidar It was replaced by a similar, but more flexible print middleware."><y>#</y><d>2019-04-24</d><h>15:11</h><w>bozhidar</w>It was replaced by a similar, but more flexible <code>print</code> middleware.</z><z id="t1556118801" t="bozhidar &gt; With the older set of versions, out and err messages arrive as I expect them to, but with the newer set, those messages are gone"><y>#</y><d>2019-04-24</d><h>15:13</h><w>bozhidar</w>&gt; With the older set of versions, <code>out</code> and <code>err</code> messages arrive as I expect them to, but with the newer set, those messages are gone</z><z id="t1556118811" t="bozhidar They behave now the same way they always did."><y>#</y><d>2019-04-24</d><h>15:13</h><w>bozhidar</w>They behave now the same way they always did.</z><z id="t1556118856" t="bozhidar Thatâ€™s what happened to pr_values - https://nrepl.org/nrepl/0.6.0/design/middleware.html#_pretty_printing"><y>#</y><d>2019-04-24</d><h>15:14</h><w>bozhidar</w>Thatâ€™s what happened to pr_values - <a href="https://nrepl.org/nrepl/0.6.0/design/middleware.html#_pretty_printing" target="_blank">https://nrepl.org/nrepl/0.6.0/design/middleware.html#_pretty_printing</a></z><z id="t1556118869" t="bozhidar I think youâ€™ll find it very useful."><y>#</y><d>2019-04-24</d><h>15:14</h><w>bozhidar</w>I think youâ€™ll find it very useful.</z><z id="t1556118940" t="bozhidar Your error indicates that somehow the print transport is nil for you, but I canâ€™t imagine how this can happen. Maybe youâ€™re passing some weird params in the eval request?"><y>#</y><d>2019-04-24</d><h>15:15</h><w>bozhidar</w>Your error indicates that somehow the print transport is <code>nil</code> for you, but I canâ€™t imagine how this can happen. Maybe youâ€™re passing some weird params in the eval request?</z><z id="t1556119707" t="pez Maybe I am. Will investigate deeper tonight, and let you know if I still think the problem is with the new versions. But thing is that even with the new versions the clj repl behaves as I expect, it is only the cljs repl that gives me grief."><y>#</y><d>2019-04-24</d><h>15:28</h><w>pez</w>Maybe I am. Will investigate deeper tonight, and let you know if I still think the problem is with the new versions. But thing is that even with the new versions the clj repl behaves as I expect, it is only the cljs repl that gives me grief.</z><z id="t1556120233" t="bozhidar Thatâ€™s pretty weird. This has been out for 3 months now and no one has reported similar issues."><y>#</y><d>2019-04-24</d><h>15:37</h><w>bozhidar</w>Thatâ€™s pretty weird. This has been out for 3 months now and no one has reported similar issues.</z><z id="t1556120544" t="pez I&apos;ll try to produce a repro. What will probably happen is that I find out what i am doing wrong. "><y>#</y><d>2019-04-24</d><h>15:42</h><w>pez</w>I&apos;ll try to produce a repro. What will probably happen is that I find out what i am doing wrong. </z><z id="t1556120601" t="bozhidar :thumbsup:"><y>#</y><d>2019-04-24</d><h>15:43</h><w>bozhidar</w><b>:thumbsup:</b></z><z id="t1556192228" t="pez Status report, [:attrs {:href &quot;/_/_/users/U051BLM8F&quot;}] : In trying to isolate a repro I have found that my nrepl client was sometimes relying on a specific order of messages returned for a request. (Or, not really order, but I was resolving my promises too early). I am pretty sure this is the problem, but I will dig a bit further before I am ready to conclude so. It would at least explain why something might have changed w/o anyone complaining, but me. ðŸ˜ƒ"><y>#</y><d>2019-04-25</d><h>11:37</h><w>pez</w>Status report, <a>@bozhidar</a>: In trying to isolate a repro I have found that my nrepl client was sometimes relying on a specific order of messages returned for a request. (Or, not really order, but I was resolving my promises too early). I am pretty sure this is the problem, but I will dig a bit further before I am ready to conclude so. It would at least explain why something might have changed w/o anyone complaining, but me. <b>ðŸ˜ƒ</b></z><z id="t1556193536" t="bozhidar Roger that! Looking forward to seeing the conclusion of your investigation."><y>#</y><d>2019-04-25</d><h>11:58</h><w>bozhidar</w>Roger that! Looking forward to seeing the conclusion of your investigation.</z><z id="t1556225508" t="pez OK, so that was a good exercise for me. The hard Leiningen dep on 0.6.0 meant I had to use other tools and it was about time I checked out clj/deps and Figwheel main, anyway. It was like I had already sort of found out. When thereâ€™s an error in an evaluation the ex and err messages come in different order and I had a check for eval-error that terminated my waiting for done and caused a disturbance in the force. But the real havoc was caused by me not realizing that Leiningen did not care about me injecting some other nrepl version, so your guess about a version mismatch was on target, [:attrs {:href &quot;/_/_/users/U051BLM8F&quot;}] . Now thereâ€™s hope for Calva Jack-in again."><y>#</y><d>2019-04-25</d><h>20:51</h><w>pez</w>OK, so that was a good exercise for me. The hard Leiningen dep on 0.6.0 meant I had to use other tools and it was about time I checked out clj/deps and Figwheel main, anyway. It was like I had already sort of found out. When thereâ€™s an error in an evaluation the <code>ex</code> and <code>err</code> messages come in different order and I had a check for <code>eval-error</code> that terminated my waiting for <code>done</code> and caused a disturbance in the force. But the real havoc was caused by me not realizing that Leiningen did not care about me injecting some other <code>nrepl</code> version, so your guess about a version mismatch was on target, <a>@bozhidar</a>. Now thereâ€™s hope for Calva Jack-in again.</z><z id="t1556226123" t="pez I made a little script that runs a sequence of nrepl evals, first on the CLJ repl, then with the CLJS one. Here are the results from running the script on the two sets of nrepl dependencies that I have been trying to use lately."><y>#</y><d>2019-04-25</d><h>21:02</h><w>pez</w>I made a little script that runs a sequence of nrepl evals, first on the CLJ repl, then with the CLJS one. Here are the results from running the script on the two sets of nrepl dependencies that I have been trying to use lately.</z><z id="t1556277625" t="flowthing I&apos;d like to do the equivalent of lein repl :connect with clj . That is, something along the lines of clj -Sdeps &apos;{:deps {nrepl {:mvn/version &quot;0.6.0&quot;} nrepl/drawbridge {:mvn/version &quot;0.2.0&quot;}}}&apos; -m nrepl.cmdline --interactive --connect --url . I think that&apos;s currently not possible, since the --url flag doesn&apos;t exist. Would it make sense to add something like that?"><y>#</y><d>2019-04-26</d><h>11:20</h><w>flowthing</w>I&apos;d like to do the equivalent of <code>lein repl :connect </code> with <code>clj</code>. That is, something along the lines of <code>clj -Sdeps &apos;{:deps {nrepl {:mvn/version &quot;0.6.0&quot;} nrepl/drawbridge {:mvn/version &quot;0.2.0&quot;}}}&apos; -m nrepl.cmdline --interactive --connect --url </code>. I think that&apos;s currently not possible, since the <code>--url</code> flag doesn&apos;t exist. Would it make sense to add something like that?</z><z id="t1556282203" t="flowthing ...although it&apos;s pretty easy to just do something like that yourself. I pieced together a small app that connects to a Drawbridge nREPL endpoint and uses rebel-readline for the REPL stuff."><y>#</y><d>2019-04-26</d><h>12:36</h><r>flowthing</r>...although it&apos;s pretty easy to just do something like that yourself. I pieced together a small app that connects to a Drawbridge nREPL endpoint and uses rebel-readline for the REPL stuff.</z><z id="t1556284040" t="pez Tried --host and --port ?"><y>#</y><d>2019-04-26</d><h>13:07</h><w>pez</w>Tried <code>--host</code> and <code>--port</code>?</z><z id="t1556346471" t="flowthing Yes, but if the Drawbridge endpoint is e.g. at http://localhost:3001/repl , host and port isn&apos;t enough, need to pass the /repl bit as well. And anyway, connecting to a Drawbridge endpoint is done via nrepl/url-connect , whereas nrepl.cmdline currently uses nrepl/connect ."><y>#</y><d>2019-04-27</d><h>06:27</h><r>flowthing</r>Yes, but if the Drawbridge endpoint is e.g. at <a href="http://localhost:3001/repl" target="_blank">http://localhost:3001/repl</a>, host and port isn&apos;t enough, need to pass the <code>/repl</code> bit as well. And anyway, connecting to a Drawbridge endpoint is done via <code>nrepl/url-connect</code>, whereas <code>nrepl.cmdline</code> currently uses <code>nrepl/connect</code>.</z><z id="t1556348575" t="pez Gotcha. Completly missed the /repl part."><y>#</y><d>2019-04-27</d><h>07:02</h><r>pez</r>Gotcha. Completly missed the /repl part.</z><z id="t1556290123" t="bozhidar The problem is that for connect to know how to handle http, drawbridge has to have been required already. Thereâ€™s no real need for a separate param. We just need to add some check in the cmd client to require the drawbridge client ns (if present)."><y>#</y><d>2019-04-26</d><h>14:48</h><w>bozhidar</w>The problem is that for connect to know how to handle http, drawbridge has to have been required already. Thereâ€™s no real need for a separate param. We just need to add some check in the cmd client to require the drawbridge client ns (if present).</z><z id="t1556290163" t="bozhidar Thatâ€™s a common problem for all third-party transports url-connect should be made aware of them somehow, so itâ€™d work with them."><y>#</y><d>2019-04-26</d><h>14:49</h><w>bozhidar</w>Thatâ€™s a common problem for all third-party transports <code>url-connect</code> should be made aware of them somehow, so itâ€™d work with them.</z><z id="t1556367274" t="pez OK. So I am doing something wrong, but canâ€™t figure out what it is. Maybe someone in here can see some pattern that I am missing so that I can start looking at the right place for the source of error. In my little test project I could get things to work (see above), but in Calva, I still have something lurking. The symptoms are: 1. Everything seems to be dandy with CLJ repls. 1. In CLJS repls things go wrong if I try to do something as simple as (println 1) . 1. Evaluating things in general, works. 1. Things go wrong liks this: 1. I get an ex message back class java.lang.IllegalArgumentException . Iâ€™ll post the stacktrace in a separate snippet. 1. I get an exception in the terminal/process I started the repl from. Iâ€™ll post that as a seperate snippet too."><y>#</y><d>2019-04-27</d><h>12:14</h><w>pez</w>OK. So I am doing something wrong, but canâ€™t figure out what it is. Maybe someone in here can see some pattern that I am missing so that I can start looking at the right place for the source of error. In my little test project I could get things to work (see above), but in Calva, I still have something lurking. The symptoms are:
1. Everything seems to be dandy with CLJ repls.
1. In CLJS repls things go wrong if I try to do something as simple as <code>(println 1)</code>.
   1. Evaluating things in general, works.
   1. Things go wrong liks this:
      1.  I get an <code>ex</code> message back <code>class java.lang.IllegalArgumentException</code>. Iâ€™ll post the stacktrace in a separate snippet.
      1. I get an exception in the terminal/process I started the repl from. Iâ€™ll post that as a seperate snippet too.</z><z id="t1556367330" t="pez"><y>#</y><d>2019-04-27</d><h>12:15</h><w>pez</w></z><z id="t1556367370" t="pez"><y>#</y><d>2019-04-27</d><h>12:16</h><w>pez</w></z><z id="t1556376432" t="dpsutton [:attrs {:href &quot;/_/_/users/U0ETXRFEW&quot;}] how are you starting it up?"><y>#</y><d>2019-04-27</d><h>14:47</h><w>dpsutton</w><a>@pez</a> how are you starting it up?</z><z id="t1556376819" t="pez The Clojure REPL is started like so for a cli/deps project: clojure -Sdeps &quot;{:deps {nrepl {:mvn/version \&quot;0.6.0\&quot;} cider/cider-nrepl {:mvn/version \&quot;0.21.1\&quot;} cider/piggieback {:mvn/version \&quot;0.4.0\&quot;} figwheel-sidecar {:mvn/version \&quot;0.5.18\&quot;}}}&quot; -m nrepl.cmdline --middleware &quot;[cider.nrepl/cider-middleware cider.piggieback/wrap-cljs-repl]&quot;"><y>#</y><d>2019-04-27</d><h>14:53</h><w>pez</w>The Clojure REPL is started like so for a cli/deps project: <pre>clojure -Sdeps &quot;{:deps {nrepl {:mvn/version \&quot;0.6.0\&quot;} cider/cider-nrepl {:mvn/version \&quot;0.21.1\&quot;} cider/piggieback {:mvn/version \&quot;0.4.0\&quot;} figwheel-sidecar {:mvn/version \&quot;0.5.18\&quot;}}}&quot; -m nrepl.cmdline --middleware &quot;[cider.nrepl/cider-middleware cider.piggieback/wrap-cljs-repl]&quot;</pre></z><z id="t1556377007" t="pez Then it depends on project type for the cljs repl, but for figwheel: (do (require &apos;figwheel-sidecar.repl-api) (if (not (figwheel-sidecar.repl-api/figwheel-running?)) (figwheel-sidecar.repl-api/start-figwheel!)) (figwheel-sidecar.repl-api/cljs-repl))"><y>#</y><d>2019-04-27</d><h>14:56</h><w>pez</w>Then it depends on project type for the cljs repl, but for figwheel: <pre>(do (require &apos;figwheel-sidecar.repl-api) (if (not (figwheel-sidecar.repl-api/figwheel-running?)) (figwheel-sidecar.repl-api/start-figwheel!)) (figwheel-sidecar.repl-api/cljs-repl))</pre></z><z id="t1556377803" t="dpsutton does figwheel sidecar and the old figwheel work with clojure ?"><y>#</y><d>2019-04-27</d><h>15:10</h><w>dpsutton</w>does figwheel sidecar and the old figwheel work with <code>clojure</code>?</z><z id="t1556378701" t="pez Yes. And I have the same problems with Leiningen. ðŸ˜ƒ"><y>#</y><d>2019-04-27</d><h>15:25</h><w>pez</w>Yes. And I have the same problems with Leiningen. <b>ðŸ˜ƒ</b></z><z id="t1556387940" t="bozhidar [:attrs {:href &quot;/_/_/users/U0ETXRFEW&quot;}] Iâ€™m on the road with very bad internet for a few days. Iâ€™d suggesting pinging [:attrs {:href &quot;/_/_/users/U052B0PT3&quot;}] in private about this."><y>#</y><d>2019-04-27</d><h>17:59</h><w>bozhidar</w><a>@pez</a> Iâ€™m on the road with very bad internet for a few days. Iâ€™d suggesting pinging <a>@cichli</a> in private about this.</z><z id="t1556390095" t="pez Thanks, [:attrs {:href &quot;/_/_/users/U051BLM8F&quot;}] , but I&apos;m pretty sure this is not a fault with nrepl or other tooling. It&apos;s me getting lost in async calls and not being able to read the signs. I long for that facepalm, even if it&apos;s going to hurt."><y>#</y><d>2019-04-27</d><h>18:34</h><w>pez</w>Thanks, <a>@bozhidar</a> , but I&apos;m pretty sure this is not a fault with nrepl or other tooling. It&apos;s me getting lost in async calls and not being able to read the signs. I long for that facepalm, even if it&apos;s going to hurt.</z><z id="t1556569646" t="bozhidar [:attrs {:href &quot;/_/_/users/U0ETXRFEW&quot;}] You should debug what happens with the printing transport. We have to know why it becomes nil for you."><y>#</y><d>2019-04-29</d><h>20:27</h><w>bozhidar</w><a>@pez</a> You should debug what happens with the printing transport. We have to know why it becomes nil for you.</z><z id="t1556569731" t="bozhidar https://github.com/nrepl/nrepl/blob/master/src/clojure/nrepl/middleware/print.clj#L169"><y>#</y><d>2019-04-29</d><h>20:28</h><w>bozhidar</w><a href="https://github.com/nrepl/nrepl/blob/master/src/clojure/nrepl/middleware/print.clj#L169" target="_blank">https://github.com/nrepl/nrepl/blob/master/src/clojure/nrepl/middleware/print.clj#L169</a></z><z id="t1556569747" t="bozhidar The code is simple so you should be able to track down the problem quickly."><y>#</y><d>2019-04-29</d><h>20:29</h><w>bozhidar</w>The code is simple so you should be able to track down the problem quickly.</z><z id="t1556571353" t="pez Thanks!"><y>#</y><d>2019-04-29</d><h>20:55</h><w>pez</w>Thanks!</z><z id="t1556695105" t="pez [:attrs {:href &quot;/_/_/users/U051BLM8F&quot;}] : Building nrepl from master I get a third behaviour from Calva. With my test script, using the same bencode and nrepl-client as Calva does, I get consistent behaviour across 0.5.3, 0.6.0, and 0.7.0-SNAPSHOT. But with Calva I get that behaviour only with 0.5.3. However, with 0.6.0 I get an ex message, with a stacktrace pointing me at the same file as you are pointing me at. So Iâ€™ll try to see if the nrepl code can help me figure out what I am doing wrong in Calva."><y>#</y><d>2019-05-01</d><h>07:18</h><w>pez</w><a>@bozhidar</a>: Building nrepl from master I get a third behaviour from Calva. With my test script, using the same bencode and nrepl-client as Calva does, I get consistent behaviour across 0.5.3, 0.6.0, and 0.7.0-SNAPSHOT. But with Calva I get that behaviour only with 0.5.3. However, with 0.6.0 I get an <code>ex</code> message, with a stacktrace pointing me at the same file as you are pointing me at. So Iâ€™ll try to see if the nrepl code can help me figure out what I am doing wrong in Calva.</z><z id="t1556698490" t="pez I am not quite following the instructions at https://nrepl.org/nrepl/0.6.0/hacking_on_nrepl.html#_interactive_hacking"><y>#</y><d>2019-05-01</d><h>08:14</h><w>pez</w>I am not quite following the instructions at <a href="https://nrepl.org/nrepl/0.6.0/hacking_on_nrepl.html#_interactive_hacking" target="_blank">https://nrepl.org/nrepl/0.6.0/hacking_on_nrepl.html#_interactive_hacking</a></z><z id="t1556698595" t="pez One example of â€œnot followingâ€ is: â€œmake some changes and test them by starting new nREPL instances from the REPL and connecting to them to see how they are havingâ€."><y>#</y><d>2019-05-01</d><h>08:16</h><w>pez</w>One example of â€œnot followingâ€ is: â€œmake some changes and test them by starting new nREPL instances from the REPL and connecting to them to see how they are havingâ€.</z><z id="t1556698614" t="pez How do I start new instances from the REPL?"><y>#</y><d>2019-05-01</d><h>08:16</h><w>pez</w>How do I start new instances from the REPL?</z><z id="t1556698712" t="pez The example code/session there works. And I do start a server there, is that was is meant in the piece I quoted?"><y>#</y><d>2019-05-01</d><h>08:18</h><w>pez</w>The example code/session there works. And I do start a server there, is that was is meant in the piece I quoted?</z><z id="t1556698951" t="pez As I am seeing the problems I have only in the CLJS REPL, I need some advice on how to do some interactive hacking towards that. I tried to promote/convert the repl by eval:ing (figwheel.main.api/cljs-repl :dev) , which might or might not have worked, but donâ€™t really have a clue how to go about it."><y>#</y><d>2019-05-01</d><h>08:22</h><w>pez</w>As I am seeing the problems I have only in the CLJS REPL, I need some advice on how to do some interactive hacking towards that. I tried to promote/convert the repl by eval:ing <code>(figwheel.main.api/cljs-repl :dev)</code>,  which might or might not have worked, but donâ€™t really have a clue how to go about it.</z><z id="t1556702038" t="bozhidar &gt; How do I start new instances from the REPL?"><y>#</y><d>2019-05-01</d><h>09:13</h><w>bozhidar</w>&gt; How do I start new instances from the REPL?</z><z id="t1556702064" t="bozhidar Thereâ€™s a start-server function in the nrepl.server namespace. I guess we should make this clearer."><y>#</y><d>2019-05-01</d><h>09:14</h><w>bozhidar</w>Thereâ€™s a <code>start-server</code> function in the <code>nrepl.server</code> namespace. I guess we should make this clearer.</z><z id="t1556702135" t="bozhidar &gt; How do I start new instances from the REPL?"><y>#</y><d>2019-05-01</d><h>09:15</h><w>bozhidar</w>&gt; How do I start new instances from the REPL?</z><z id="t1556702151" t="bozhidar You also have to eval a bit of piggieback code for this to work."><y>#</y><d>2019-05-01</d><h>09:15</h><w>bozhidar</w>You also have to eval a bit of piggieback code for this to work.</z><z id="t1556702191" t="bozhidar https://github.com/nrepl/piggieback#usage"><y>#</y><d>2019-05-01</d><h>09:16</h><w>bozhidar</w><a href="https://github.com/nrepl/piggieback#usage" target="_blank">https://github.com/nrepl/piggieback#usage</a></z><z id="t1556702200" t="bozhidar Thatâ€™s how I typically test cljs interactions."><y>#</y><d>2019-05-01</d><h>09:16</h><w>bozhidar</w>Thatâ€™s how I typically test cljs interactions.</z><z id="t1556702252" t="bozhidar &gt; Building nrepl from master I get a third behaviour from Calva. With my test script, using the same bencode and nrepl-client as Calva does, I get consistent behaviour across 0.5.3, 0.6.0, and 0.7.0-SNAPSHOT. But with Calva I get that behaviour only with 0.5.3. However, with 0.6.0 I get an ex message, with a stacktrace pointing me at the same file as you are pointing me at. So Iâ€™ll try to see if the nrepl code can help me figure out what I am doing wrong in Calva."><y>#</y><d>2019-05-01</d><h>09:17</h><w>bozhidar</w>&gt; Building nrepl from master I get a third behaviour from Calva. With my test script, using the same bencode and nrepl-client as Calva does, I get consistent behaviour across 0.5.3, 0.6.0, and 0.7.0-SNAPSHOT. But with Calva I get that behaviour only with 0.5.3. However, with 0.6.0 I get an <code>ex</code> message, with a stacktrace pointing me at the same file as you are pointing me at. So Iâ€™ll try to see if the nrepl code can help me figure out what I am doing wrong in Calva.</z><z id="t1556702311" t="bozhidar I think itâ€™d be easiest for you to just modify that particular function with some debug info and see whatâ€™s going on there. Whatâ€™s the third behaviour youâ€™re getting on master ?"><y>#</y><d>2019-05-01</d><h>09:18</h><w>bozhidar</w>I think itâ€™d be easiest for you to just modify that particular function with some debug info and see whatâ€™s going on there. Whatâ€™s the third behaviour youâ€™re getting on <code>master</code>?</z><z id="t1556702327" t="bozhidar &gt; With my test script, using the same bencode and nrepl-client as Calva does, I get consistent behaviour across 0.5.3, 0.6.0, and 0.7.0-SNAPSHOT. But with Calva I get that behaviour only with 0.5.3."><y>#</y><d>2019-05-01</d><h>09:18</h><w>bozhidar</w>&gt; With my test script, using the same bencode and nrepl-client as Calva does, I get consistent behaviour across 0.5.3, 0.6.0, and 0.7.0-SNAPSHOT. But with Calva I get that behaviour only with 0.5.3.</z><z id="t1556702343" t="bozhidar How come youâ€™re getting different behaviour if youâ€™re using the same client? ðŸ™‚"><y>#</y><d>2019-05-01</d><h>09:19</h><w>bozhidar</w>How come youâ€™re getting different behaviour if youâ€™re using the same client? <b>ðŸ™‚</b></z><z id="t1556703299" t="pez Yeah, it is a total mystery for me still, despite having trying to figure it out for a while now. But in my test script I force the communication to be synchronous, so it might well be that what goes wrong in Calva is to due with asynchronisity."><y>#</y><d>2019-05-01</d><h>09:34</h><w>pez</w>Yeah, it is a total mystery for me still, despite having trying to figure it out for a while now. But in my test script I force the communication to be synchronous, so it might well be that what goes wrong in Calva is to due with asynchronisity.</z><z id="t1556703562" t="pez With master I get the value and status (`done`) responses, but no out and no ex . (I shouldnâ€™t say I donâ€™t get those, I think I do, but that I somehow mess things up so that they are not delivered to my nrepl client.)"><y>#</y><d>2019-05-01</d><h>09:39</h><w>pez</w>With <code>master</code> I get the <code>value</code> and <code>status</code> (`done`)  responses, but no <code>out</code> and no <code>ex</code>. (I shouldnâ€™t say I donâ€™t get those, I think I do, but that I somehow mess things up so that they are not delivered to my nrepl client.)</z><z id="t1556710738" t="pez Is there any particular profile I should start when jacking in to the nrepl project?"><y>#</y><d>2019-05-01</d><h>11:38</h><w>pez</w>Is there any particular profile I should start when jacking in to the nrepl project?</z><z id="t1556712203" t="pez Iâ€™m using the :master profile and it sort of works. But it seems that being jacked in to the same server as I am developing causes it to start recursing, so maybe I should go about it some other wayâ€¦"><y>#</y><d>2019-05-01</d><h>12:03</h><w>pez</w>Iâ€™m using the <code>:master</code> profile and it sort of works. But it seems that being jacked in to the same server as I am developing causes it to start recursing, so maybe I should go about it some other wayâ€¦</z><z id="t1556714153" t="bozhidar Iâ€™m simply using the dev profile and Iâ€™m connecting to the new servers I start afterwards."><y>#</y><d>2019-05-01</d><h>12:35</h><w>bozhidar</w>Iâ€™m simply using the dev profile and Iâ€™m connecting to the new servers I start afterwards.</z><z id="t1556714188" t="bozhidar Alternatively you can always make some changes, do lein install and use force the use of that build in profiles.clj ."><y>#</y><d>2019-05-01</d><h>12:36</h><w>bozhidar</w>Alternatively you can always make some changes, do <code>lein install</code> and use force the use of that build in <code>profiles.clj</code>.</z><z id="t1556718449" t="pez There is no dev profile as far as I can see."><y>#</y><d>2019-05-01</d><h>13:47</h><w>pez</w>There is no dev profile as far as I can see.</z><z id="t1556718504" t="dpsutton oh sorry. nrepl ðŸ™‚"><y>#</y><d>2019-05-01</d><h>13:48</h><w>dpsutton</w>oh sorry. nrepl <b>ðŸ™‚</b></z><z id="t1556718738" t="pez Leiningen does not complain when I say I want to use profile dev . And it seems to work. It also seems to me that I modify the server I am connected to when I evaluate forms in the source of that server. But what you are saying, [:attrs {:href &quot;/_/_/users/U051BLM8F&quot;}] , is that I should create a new server and connect to that one after modifying the source?"><y>#</y><d>2019-05-01</d><h>13:52</h><w>pez</w>Leiningen does not complain when I say I want to use profile <code>dev</code>. And it seems to work. It also seems to me that I modify the server I am connected to when I evaluate forms in the source of that server. But what you are saying, <a>@bozhidar</a>, is that I should create a new server and connect to that one after modifying the source?</z><z id="t1556718801" t="pez My mind is actually quite blown away by connecting to the server I am modifying. Starting to realize what happened to Cantorâ€¦"><y>#</y><d>2019-05-01</d><h>13:53</h><w>pez</w>My mind is actually quite blown away by connecting to the server I am modifying. Starting to realize what happened to Cantorâ€¦</z><z id="t1556718872" t="bozhidar Yeah, you are in essence modifying the server youâ€™re connected to, although certain things are set when the server starts and those canâ€™t be modified on the fly. For those cases you need to start a new server from the updated code."><y>#</y><d>2019-05-01</d><h>13:54</h><w>bozhidar</w>Yeah, you are in essence modifying the server youâ€™re connected to, although certain things are set when the server starts and those canâ€™t be modified on the fly. For those cases you need to start a new server from the updated code.</z><z id="t1556718890" t="bozhidar I know what you mean. This was super mind bending to me when I started working on CIDER back in the day."><y>#</y><d>2019-05-01</d><h>13:54</h><w>bozhidar</w>I know what you mean. This was super mind bending to me when I started working on CIDER back in the day.</z><z id="t1556719132" t="pez There is a lot of stuff in the msg map. Is there something in particular I should be looking for?"><y>#</y><d>2019-05-01</d><h>13:58</h><w>pez</w>There is a lot of stuff in the <code>msg</code> map. Is there something in particular I should be looking for?</z><z id="t1556719742" t="pez When I add some println s to the function I get StackOverflow when it runsâ€¦"><y>#</y><d>2019-05-01</d><h>14:09</h><w>pez</w>When I add some <code>println</code>s to the function I get StackOverflow when it runsâ€¦</z><z id="t1556722482" t="pez So, if I start the repl like so: lein update-in :dependencies conj &quot;[nrepl \&quot;0.7.0-SNAPSHOT\&quot;]&quot; -- update-in :plugins conj &quot;[cider/cider-nrepl \&quot;0.21.1\&quot;]&quot; -- update-in &quot;[:repl-options :nrepl-middleware]&quot; conj &quot;[\&quot;cider.nrepl/cider-middleware\&quot;]&quot; -- repl 2&gt; repl-errors.txt It prints the following. (I do (printn (pr-str msg)) in that function)."><y>#</y><d>2019-05-01</d><h>14:54</h><w>pez</w>So, if I start the repl like so: <pre>lein update-in :dependencies conj &quot;[nrepl \&quot;0.7.0-SNAPSHOT\&quot;]&quot; -- update-in :plugins conj &quot;[cider/cider-nrepl \&quot;0.21.1\&quot;]&quot; -- update-in &quot;[:repl-options :nrepl-middleware]&quot; conj &quot;[\&quot;cider.nrepl/cider-middleware\&quot;]&quot; -- repl 2&gt; repl-errors.txt</pre>
It prints the following. (I do <code>(printn (pr-str msg))</code> in that function).</z><z id="t1556722575" t="pez My terminal stars throwing away input when it grows to large so I catch stderr in a file. Where we find this error:"><y>#</y><d>2019-05-01</d><h>14:56</h><w>pez</w>My terminal stars throwing away input when it grows to large so I catch stderr in a file. Where we find this error:</z><z id="t1556723169" t="bozhidar Hmm, a StackOverflow is usually in indication of some endless recursion. Thatâ€™s weird."><y>#</y><d>2019-05-01</d><h>15:06</h><w>bozhidar</w>Hmm, a StackOverflow is usually in indication of some endless recursion. Thatâ€™s weird.</z><z id="t1556723315" t="bozhidar Looking at the debug output it seems to be in order, but I assuming thatâ€™s from a Clojure session, right?"><y>#</y><d>2019-05-01</d><h>15:08</h><w>bozhidar</w>Looking at the debug output it seems to be in order, but I assuming thatâ€™s from a Clojure session, right?</z><z id="t1556723320" t="pez Yeah, I thought that was the Cantor thing first, but then I noticed that it happened before I connected anything. Iâ€™ve seen some other errors that indicate it is the pr-str ."><y>#</y><d>2019-05-01</d><h>15:08</h><w>pez</w>Yeah, I thought that was the Cantor thing first, but then I noticed that it happened before I connected anything. Iâ€™ve seen some other errors that indicate it is the <code>pr-str</code>.</z><z id="t1556723449" t="pez Looks like so. Including some traces of what else I have tried to do. ðŸ˜ƒ"><y>#</y><d>2019-05-01</d><h>15:10</h><w>pez</w>Looks like so. Including some traces of what else I have tried to do. <b>ðŸ˜ƒ</b></z><z id="t1556723907" t="pez The session is before I do anything else. So, probably from starting the repl?"><y>#</y><d>2019-05-01</d><h>15:18</h><w>pez</w>The session is before I do anything else. So, probably from starting the repl?</z><z id="t1556723944" t="pez It lasts a bit longer if I add :headless ."><y>#</y><d>2019-05-01</d><h>15:19</h><w>pez</w>It lasts a bit longer if I add <code>:headless</code>.</z><z id="t1556724036" t="pez Also when removing piggieback and other dependencies things crash if I try to reference that mysterious dev profile. So maybe that profile comes from some of those projects?"><y>#</y><d>2019-05-01</d><h>15:20</h><w>pez</w>Also when removing piggieback and other dependencies things crash if I try to reference that mysterious <code>dev</code> profile. So maybe that profile comes from some of those projects?</z><z id="t1556724646" t="bozhidar When I said dev profile I meant I was under the impression thatâ€™s what lein runs by default."><y>#</y><d>2019-05-01</d><h>15:30</h><w>bozhidar</w>When I said dev profile I meant I was under the impression thatâ€™s what lein runs by default.</z><z id="t1556724681" t="bozhidar You can just select Clojure 1.10 or whatever for that matter."><y>#</y><d>2019-05-01</d><h>15:31</h><w>bozhidar</w>You can just select Clojure 1.10 or whatever for that matter.</z><z id="t1556724727" t="pez At least I can reproduce the problem using that nashorn cljs-repl and such. But if I try to peek at it, with that println, things blow up. Observation changes behaviour, or something."><y>#</y><d>2019-05-01</d><h>15:32</h><w>pez</w>At least I can reproduce the problem using that nashorn cljs-repl and such. But if I try to peek at it, with that println, things blow up. Observation changes behaviour, or something.</z><z id="t1556725041" t="pez Anyone else that can repro the stackoerflow crash? Just tuck that (println &quot;printing-transport msg: &quot; (pr-str msg)) in there and run: lein update-in :dependencies conj &quot;[nrepl \&quot;0.7.0-SNAPSHOT\&quot;]&quot; -- update-in :dependencies conj &quot;[cider/piggieback \&quot;0.4.0\&quot;]&quot; -- update-in :dependencies conj &quot;[figwheel-sidecar \&quot;0.5.18\&quot;]&quot; -- update-in :plugins conj &quot;[cider/cider-nrepl \&quot;0.21.1\&quot;]&quot; -- update-in &quot;[:repl-options :nrepl-middleware]&quot; conj &quot;[\&quot;cider.nrepl/cider-middleware\&quot;]&quot; -- update-in &quot;[:repl-options :nrepl-middleware]&quot; conj &quot;[\&quot;cider.piggieback/wrap-cljs-repl\&quot;]&quot; -- repl"><y>#</y><d>2019-05-01</d><h>15:37</h><w>pez</w>Anyone else that can repro the stackoerflow crash? Just tuck that  <code>(println &quot;printing-transport msg: &quot; (pr-str msg))</code> in there and run: <pre>lein update-in :dependencies conj &quot;[nrepl \&quot;0.7.0-SNAPSHOT\&quot;]&quot; -- update-in :dependencies conj &quot;[cider/piggieback \&quot;0.4.0\&quot;]&quot; -- update-in :dependencies conj &quot;[figwheel-sidecar \&quot;0.5.18\&quot;]&quot; -- update-in :plugins conj &quot;[cider/cider-nrepl \&quot;0.21.1\&quot;]&quot; -- update-in &quot;[:repl-options :nrepl-middleware]&quot; conj &quot;[\&quot;cider.nrepl/cider-middleware\&quot;]&quot; -- update-in &quot;[:repl-options :nrepl-middleware]&quot; conj &quot;[\&quot;cider.piggieback/wrap-cljs-repl\&quot;]&quot; -- repl</pre></z><z id="t1556726655" t="pez Actually it doesnâ€™t matter what I print. (println &quot;foo&quot;) results in the same SO."><y>#</y><d>2019-05-01</d><h>16:04</h><w>pez</w>Actually it doesnâ€™t matter what I print. <code>(println &quot;foo&quot;)</code> results in the same SO.</z><z id="t1556729478" t="pez I&apos;m thinking... Since my first impression was that things started to recurse. Maybe that is what is happening? When I collected the output in that log, it grew very fast. So, maybe the stuff I put in stdout here, gets fed back into the function somehow?"><y>#</y><d>2019-05-01</d><h>16:51</h><w>pez</w>I&apos;m thinking... Since my first impression was that things started to recurse. Maybe that is what is happening?  When I collected the output in that log, it grew very fast. So, maybe the stuff I put in stdout here, gets fed back into the function somehow?</z><z id="t1556730785" t="bozhidar I donâ€™t see how this can happen. It should act only on middleware responses."><y>#</y><d>2019-05-01</d><h>17:13</h><w>bozhidar</w>I donâ€™t see how this can happen. It should act only on middleware responses.</z><z id="t1556730840" t="bozhidar But the SO is certainly indicative of some recursion. Go figureâ€¦"><y>#</y><d>2019-05-01</d><h>17:14</h><w>bozhidar</w>But the SO is certainly indicative of some recursion. Go figureâ€¦</z><z id="t1556731279" t="pez SO happens in 0.5.3 if I add a println there too. Iâ€™m not knowledgeable enough to go figure about it. ðŸ˜ƒ But Iâ€™m out of ideas on how to inspect the messagingâ€¦ No.. maybe I can send it to a fileâ€¦"><y>#</y><d>2019-05-01</d><h>17:21</h><w>pez</w>SO happens in 0.5.3 if I add a <code>println</code> there too. Iâ€™m not knowledgeable enough to go figure about it. <b>ðŸ˜ƒ</b>  But Iâ€™m out of ideas on how to inspect the messagingâ€¦ No.. maybe I can send it to a fileâ€¦</z><z id="t1556731923" t="pez Yeah, spitting it out worked. Now dinner, will examine the output later. ðŸ˜ƒ"><y>#</y><d>2019-05-01</d><h>17:32</h><w>pez</w>Yeah, spitting it out worked. Now dinner, will examine the output later. <b>ðŸ˜ƒ</b></z><z id="t1556732333" t="dpsutton is it possible the middleware is set up to handle println and you are println-ing from the middleware giving you the SO?"><y>#</y><d>2019-05-01</d><h>17:38</h><w>dpsutton</w>is it possible the middleware is set up to handle println and you are println-ing from the middleware giving you the SO?</z><z id="t1556732386" t="pez Sounds very possible to me. "><y>#</y><d>2019-05-01</d><h>17:39</h><w>pez</w>Sounds very possible to me. </z><z id="t1556782984" t="pez Here&apos;s a log from a test with nrepl master. It looks like the println output never gets sent from printing-transport . I see it in the terminal where I started the repl. (I am pretty sure I saw a different pattern yesterday, but I had been staring at this for very long then and might have been hallucinating.) I&apos;ll try with 0.6.0, since Calva behaves much better with master."><y>#</y><d>2019-05-02</d><h>07:43</h><w>pez</w>Here&apos;s a log from a test with nrepl master. It looks like the println output never gets sent from <code>printing-transport</code>. I see it in the terminal where I started the repl.  (I am pretty sure I saw a different pattern yesterday, but I had been staring at this for very long then and might have been hallucinating.) I&apos;ll try with 0.6.0, since Calva behaves much better with master.</z><z id="t1556784380" t="bozhidar [:attrs {:href &quot;/_/_/users/U0ETXRFEW&quot;}] Everything seems fine here. I donâ€™t see any errors/problems."><y>#</y><d>2019-05-02</d><h>08:06</h><w>bozhidar</w><a>@pez</a> Everything seems fine here. I donâ€™t see any errors/problems.</z><z id="t1556784459" t="bozhidar &gt; nrc receiving: {â€œidâ€:â€œ39&quot;,â€œnsâ€:â€œlive-hackingâ€,â€œprinted-valueâ€:1,â€œsessionâ€:â€œc9e4bd22-bdef-425f-9fb9-c4ef24aaaa3fâ€,â€œvalueâ€:â€œnilâ€}"><y>#</y><d>2019-05-02</d><h>08:07</h><w>bozhidar</w>&gt; nrc receiving: {â€œidâ€:â€œ39&quot;,â€œnsâ€:â€œlive-hackingâ€,â€œprinted-valueâ€:1,â€œsessionâ€:â€œc9e4bd22-bdef-425f-9fb9-c4ef24aaaa3fâ€,â€œvalueâ€:â€œnilâ€}</z><z id="t1556784473" t="bozhidar I guess thatâ€™s the missing output you referred to, so thatâ€™s fine as well."><y>#</y><d>2019-05-02</d><h>08:07</h><w>bozhidar</w>I guess thatâ€™s the missing output you referred to, so thatâ€™s fine as well.</z><z id="t1556784500" t="bozhidar &gt; Iâ€™ll try with 0.6.0, since Calva behaves much better with master."><y>#</y><d>2019-05-02</d><h>08:08</h><w>bozhidar</w>&gt; Iâ€™ll try with 0.6.0, since Calva behaves much better with master.</z><z id="t1556784557" t="bozhidar I wonder why - there has been no changes other than the inclusion of the EDN transport and a bit of transport cleanup related to it. I can always cut some release for you, but I donâ€™t think there should be any material differences."><y>#</y><d>2019-05-02</d><h>08:09</h><w>bozhidar</w>I wonder why - there has been no changes other than the inclusion of the EDN transport and a bit of transport cleanup related to it. I can always cut some release for you, but I donâ€™t think there should be any material differences.</z><z id="t1556784636" t="pez No cutting of any releases yet. ðŸ˜ƒ Things are not as they should with Calva, and I need to find and fix that."><y>#</y><d>2019-05-02</d><h>08:10</h><w>pez</w>No cutting of any releases yet. <b>ðŸ˜ƒ</b> Things are not as they should with Calva, and I need to find and fix that.</z><z id="t1556784749" t="pez &gt; nrc receiving: {â€œidâ€:â€œ39&quot;,â€œnsâ€:â€œlive-hackingâ€,â€œprinted-valueâ€:1,â€œsessionâ€:â€œc9e4bd22-bdef-425f-9fb9-c4ef24aaaa3fâ€,â€œvalueâ€:â€œnilâ€} That&apos;s from the :cljs/quit , right?"><y>#</y><d>2019-05-02</d><h>08:12</h><w>pez</w>&gt; nrc receiving: {â€œidâ€:â€œ39&quot;,â€œnsâ€:â€œlive-hackingâ€,â€œprinted-valueâ€:1,â€œsessionâ€:â€œc9e4bd22-bdef-425f-9fb9-c4ef24aaaa3fâ€,â€œvalueâ€:â€œnilâ€}
That&apos;s from the <code>:cljs/quit</code>, right?</z><z id="t1556785383" t="bozhidar My bad."><y>#</y><d>2019-05-02</d><h>08:23</h><w>bozhidar</w>My bad.</z><z id="t1556785387" t="bozhidar nrc sending: {&quot;op&quot;:&quot;eval&quot;,&quot;session&quot;:&quot;c9e4bd22-bdef-425f-9fb9-c4ef24aaaa3f&quot;,&quot;code&quot;:&quot;(println 1)&quot;,&quot;id&quot;:&quot;38&quot;} nrc receiving: {&quot;id&quot;:&quot;38&quot;,&quot;ns&quot;:&quot;cljs.user&quot;,&quot;printed-value&quot;:1,&quot;session&quot;:&quot;c9e4bd22-bdef-425f-9fb9-c4ef24aaaa3f&quot;,&quot;value&quot;:&quot;nil&quot;} "><y>#</y><d>2019-05-02</d><h>08:23</h><w>bozhidar</w><pre>nrc sending: {&quot;op&quot;:&quot;eval&quot;,&quot;session&quot;:&quot;c9e4bd22-bdef-425f-9fb9-c4ef24aaaa3f&quot;,&quot;code&quot;:&quot;(println 1)&quot;,&quot;id&quot;:&quot;38&quot;}
nrc receiving: {&quot;id&quot;:&quot;38&quot;,&quot;ns&quot;:&quot;cljs.user&quot;,&quot;printed-value&quot;:1,&quot;session&quot;:&quot;c9e4bd22-bdef-425f-9fb9-c4ef24aaaa3f&quot;,&quot;value&quot;:&quot;nil&quot;}
</pre></z><z id="t1556785407" t="bozhidar I pasted the wrong line. Looking at this itâ€™s perfectly correct."><y>#</y><d>2019-05-02</d><h>08:23</h><w>bozhidar</w>I pasted the wrong line. Looking at this itâ€™s perfectly correct.</z><z id="t1556785560" t="bozhidar Your client logging seems a bit buggy, though. Notice:"><y>#</y><d>2019-05-02</d><h>08:26</h><w>bozhidar</w>Your client logging seems a bit buggy, though. Notice:</z><z id="t1556785563" t="bozhidar nrc sending: {&quot;op&quot;:&quot;eval&quot;,&quot;session&quot;:&quot;c9e4bd22-bdef-425f-9fb9-c4ef24aaaa3f&quot;,&quot;code&quot;:&quot;(+ 1 1)&quot;,&quot;id&quot;:&quot;37&quot;} nrc receiving: {&quot;id&quot;:&quot;37&quot;,&quot;ns&quot;:&quot;cljs.user&quot;,&quot;printed-value&quot;:1,&quot;session&quot;:&quot;c9e4bd22-bdef-425f-9fb9-c4ef24aaaa3f&quot;,&quot;value&quot;:&quot;2&quot;}"><y>#</y><d>2019-05-02</d><h>08:26</h><w>bozhidar</w><pre>nrc sending: {&quot;op&quot;:&quot;eval&quot;,&quot;session&quot;:&quot;c9e4bd22-bdef-425f-9fb9-c4ef24aaaa3f&quot;,&quot;code&quot;:&quot;(+ 1 1)&quot;,&quot;id&quot;:&quot;37&quot;}
nrc receiving: {&quot;id&quot;:&quot;37&quot;,&quot;ns&quot;:&quot;cljs.user&quot;,&quot;printed-value&quot;:1,&quot;session&quot;:&quot;c9e4bd22-bdef-425f-9fb9-c4ef24aaaa3f&quot;,&quot;value&quot;:&quot;2&quot;}</pre></z><z id="t1556785580" t="bozhidar Youâ€™ve got some printed-value here, although there should be none. Only value ."><y>#</y><d>2019-05-02</d><h>08:26</h><w>bozhidar</w>Youâ€™ve got some <code>printed-value</code> here, although there should be none. Only <code>value</code>.</z><z id="t1556785774" t="pez I have noticed that as well. But it is what I am logging from printing-transport as well: printing-transport: {:id &quot;37&quot;, :session &quot;c9e4bd22-bdef-425f-9fb9-c4ef24aaaa3f&quot;, :value &quot;2&quot;, :printed-value 1, :ns cljs.user}"><y>#</y><d>2019-05-02</d><h>08:29</h><w>pez</w>I have noticed that as well. But it is what I am logging from <code>printing-transport</code> as well: <pre>printing-transport: {:id &quot;37&quot;, :session &quot;c9e4bd22-bdef-425f-9fb9-c4ef24aaaa3f&quot;, :value &quot;2&quot;, :printed-value 1, :ns cljs.user}</pre></z><z id="t1556785883" t="pez Also. I think I must be missing something fundamental here. In my test script, and with 0.5.3, I get an out message, containing the output. I don&apos;t get that in these tests."><y>#</y><d>2019-05-02</d><h>08:31</h><w>pez</w>Also. I think I must be missing something fundamental here. In my test script, and with 0.5.3, I get an <code>out</code> message, containing the output. I don&apos;t get that in these tests.</z><z id="t1556785927" t="bozhidar Hmm, I just assumed you had renamed out to printed-value in your logger."><y>#</y><d>2019-05-02</d><h>08:32</h><w>bozhidar</w>Hmm, I just assumed you had renamed <code>out</code> to printed-value in your logger.</z><z id="t1556785952" t="bozhidar Yeah, than something is broken indeed, but keep in mind thereâ€™s no printed-value field in nREPL at all."><y>#</y><d>2019-05-02</d><h>08:32</h><w>bozhidar</w>Yeah, than something is broken indeed, but keep in mind thereâ€™s no <code>printed-value</code> field in nREPL at all.</z><z id="t1556785954" t="pez Yeah, a bit confusing that I print 1 . I&apos;ve changed that now in my tests."><y>#</y><d>2019-05-02</d><h>08:32</h><w>pez</w>Yeah, a bit confusing that I print <code>1</code>. I&apos;ve changed that now in my tests.</z><z id="t1556785982" t="bozhidar Whatâ€™s the cider-nrepl youâ€™re using, btw?"><y>#</y><d>2019-05-02</d><h>08:33</h><w>bozhidar</w>Whatâ€™s the cider-nrepl youâ€™re using, btw?</z><z id="t1556786033" t="pez I have never relied on printed-value in any way. Been thinking I should ask about it, but now I know to continue disregard it."><y>#</y><d>2019-05-02</d><h>08:33</h><w>pez</w>I have never relied on <code>printed-value</code> in any way. Been thinking I should ask about it, but now I know to continue disregard it.</z><z id="t1556786058" t="pez 0.21.1"><y>#</y><d>2019-05-02</d><h>08:34</h><w>pez</w>0.21.1</z><z id="t1556786234" t="bozhidar Good."><y>#</y><d>2019-05-02</d><h>08:37</h><w>bozhidar</w>Good.</z><z id="t1556786279" t="bozhidar And the out is missing only for ClojureScript, right?"><y>#</y><d>2019-05-02</d><h>08:37</h><w>bozhidar</w>And the out is missing only for ClojureScript, right?</z><z id="t1556786329" t="pez Another thing I think is a bit off is: nrc sending: {&quot;op&quot;:&quot;eval&quot;,&quot;session&quot;:&quot;418d21f5-8cc5-47b4-a51c-be817ab10a00&quot;,&quot;code&quot;:&quot;(println \&quot;hello\&quot;)&quot;,&quot;id&quot;:&quot;16&quot;} nrc receiving: {&quot;id&quot;:&quot;16&quot;,&quot;ns&quot;:&quot;cljs.user&quot;,&quot;printed-value&quot;:1,&quot;session&quot;:&quot;418d21f5-8cc5-47b4-a51c-be817ab10a00&quot;,&quot;value&quot;:&quot;nil&quot;} nrc receiving: {&quot;id&quot;:&quot;16&quot;,&quot;session&quot;:&quot;418d21f5-8cc5-47b4-a51c-be817ab10a00&quot;,&quot;status&quot;:[&quot;done&quot;]} printing-transport: {:id &quot;16&quot;, :session &quot;418d21f5-8cc5-47b4-a51c-be817ab10a00&quot;, :value &quot;nil&quot;, :printed-value 1, :ns cljs.user} printing-transport: {:id &quot;16&quot;, :session &quot;418d21f5-8cc5-47b4-a51c-be817ab10a00&quot;, :status #{:done}} printing-transport: {:id &quot;16&quot;, :session &quot;418d21f5-8cc5-47b4-a51c-be817ab10a00&quot;, :changed-namespaces {}, :repl-type :cljs, :status #{:state}} The state message, coming after done ."><y>#</y><d>2019-05-02</d><h>08:38</h><w>pez</w>Another thing I think is a bit off is: <pre>nrc sending: {&quot;op&quot;:&quot;eval&quot;,&quot;session&quot;:&quot;418d21f5-8cc5-47b4-a51c-be817ab10a00&quot;,&quot;code&quot;:&quot;(println \&quot;hello\&quot;)&quot;,&quot;id&quot;:&quot;16&quot;}
nrc receiving: {&quot;id&quot;:&quot;16&quot;,&quot;ns&quot;:&quot;cljs.user&quot;,&quot;printed-value&quot;:1,&quot;session&quot;:&quot;418d21f5-8cc5-47b4-a51c-be817ab10a00&quot;,&quot;value&quot;:&quot;nil&quot;}
nrc receiving: {&quot;id&quot;:&quot;16&quot;,&quot;session&quot;:&quot;418d21f5-8cc5-47b4-a51c-be817ab10a00&quot;,&quot;status&quot;:[&quot;done&quot;]}

printing-transport: {:id &quot;16&quot;, :session &quot;418d21f5-8cc5-47b4-a51c-be817ab10a00&quot;, :value &quot;nil&quot;, :printed-value 1, :ns cljs.user}
printing-transport: {:id &quot;16&quot;, :session &quot;418d21f5-8cc5-47b4-a51c-be817ab10a00&quot;, :status #{:done}}
printing-transport: {:id &quot;16&quot;, :session &quot;418d21f5-8cc5-47b4-a51c-be817ab10a00&quot;, :changed-namespaces {}, :repl-type :cljs, :status #{:state}}</pre>
The <code>state</code> message, coming after <code>done</code>.</z><z id="t1556786384" t="pez Yes, only for ClojureScript."><y>#</y><d>2019-05-02</d><h>08:39</h><w>pez</w>Yes, only for ClojureScript.</z><z id="t1556786472" t="pez (The reason my client doesn&apos;t log the state there is that I stop listening once I have gotten the done .)"><y>#</y><d>2019-05-02</d><h>08:41</h><w>pez</w>(The reason my client doesn&apos;t log the <code>state</code> there is that I stop listening once I have gotten the <code>done</code>.)</z><z id="t1556786595" t="pez But maybe I should be alert on : changed-namespaces ... I notice that my repl prompt is sometimes lying..."><y>#</y><d>2019-05-02</d><h>08:43</h><w>pez</w>But maybe I should be alert on <code>: changed-namespaces</code>... I notice that my repl prompt is sometimes lying...</z><z id="t1556786652" t="pez With these tests, I get the same behaviour in 0.6.0 as in master, just as you expected, btw."><y>#</y><d>2019-05-02</d><h>08:44</h><w>pez</w>With these tests, I get the same behaviour in 0.6.0 as in master, just as you expected, btw.</z><z id="t1556786957" t="bozhidar &gt; But maybe I should be alert on : changed-namespaces ... I notice that my repl prompt is sometimes lying..."><y>#</y><d>2019-05-02</d><h>08:49</h><w>bozhidar</w>&gt; But maybe I should be alert on <code>: changed-namespaces</code>... I notice that my repl prompt is sometimes lying...</z><z id="t1556786993" t="bozhidar You can safely ignore this. This middleware is in cider-nrepl and it tracks updates to namespaces, so the client to can act efficiently on them."><y>#</y><d>2019-05-02</d><h>08:49</h><w>bozhidar</w>You can safely ignore this. This middleware is in cider-nrepl and it tracks updates to namespaces, so the client to can act efficiently on them.</z><z id="t1556787035" t="bozhidar Most notably it provides you an up-to-date list of vars in the namespace so you can syntax highlight them accordingly."><y>#</y><d>2019-05-02</d><h>08:50</h><w>bozhidar</w>Most notably it provides you an up-to-date list of vars in the namespace so you can syntax highlight them accordingly.</z><z id="t1556787079" t="bozhidar We also use this in CIDER to show notifications that that source code and the REPL are in sync (meaning everything has been evaluated)."><y>#</y><d>2019-05-02</d><h>08:51</h><w>bozhidar</w>We also use this in CIDER to show notifications that that source code and the REPL are in sync (meaning everything has been evaluated).</z><z id="t1556787145" t="pez I&apos;ll implement that stuff once I&apos;ve gotten this crazy println thing under control. ðŸ˜ƒ"><y>#</y><d>2019-05-02</d><h>08:52</h><w>pez</w>I&apos;ll implement that stuff once I&apos;ve gotten this crazy println thing under control. <b>ðŸ˜ƒ</b></z><z id="t1556787148" t="bozhidar Probably we should add some way for the middleware to be disabled without having to be removed from the middleware graph, for clients that donâ€™t need it."><y>#</y><d>2019-05-02</d><h>08:52</h><w>bozhidar</w>Probably we should add some way for the middleware to be disabled without having to be removed from the middleware graph, for clients that donâ€™t need it.</z><z id="t1556787169" t="bozhidar In generates a lot of messages which are confusing if someone doesnâ€™t need it."><y>#</y><d>2019-05-02</d><h>08:52</h><w>bozhidar</w>In generates a lot of messages which are confusing if someone doesnâ€™t need it.</z><z id="t1556787191" t="pez Huge messages, even. ðŸ˜ƒ"><y>#</y><d>2019-05-02</d><h>08:53</h><w>pez</w>Huge messages, even. <b>ðŸ˜ƒ</b></z><z id="t1556787291" t="pez When I evaluate in a project that uses Figwheel Main and using the clojars 0.6.0, I get this when evaluating a printn : nrc sending: {&quot;op&quot;:&quot;eval&quot;,&quot;session&quot;:&quot;b282a095-a368-4ffd-9fc3-dec8549cbc2d&quot;,&quot;code&quot;:&quot;(println \&quot;Hello from CLJS\&quot;)&quot;,&quot;id&quot;:&quot;16&quot;} nrc receiving: {&quot;ex&quot;:&quot;class java.lang.IllegalArgumentException&quot;,&quot;id&quot;:&quot;16&quot;,&quot;root-ex&quot;:&quot;class java.lang.IllegalArgumentException&quot;,&quot;session&quot;:&quot;b282a095-a368-4ffd-9fc3-dec8549cbc2d&quot;,&quot;status&quot;:[&quot;eval-error&quot;]} "><y>#</y><d>2019-05-02</d><h>08:54</h><w>pez</w>When I evaluate in a project that uses Figwheel Main and using the clojars 0.6.0, I get this when evaluating a <code>printn</code>: <pre>nrc sending: {&quot;op&quot;:&quot;eval&quot;,&quot;session&quot;:&quot;b282a095-a368-4ffd-9fc3-dec8549cbc2d&quot;,&quot;code&quot;:&quot;(println \&quot;Hello from CLJS\&quot;)&quot;,&quot;id&quot;:&quot;16&quot;}
nrc receiving: {&quot;ex&quot;:&quot;class java.lang.IllegalArgumentException&quot;,&quot;id&quot;:&quot;16&quot;,&quot;root-ex&quot;:&quot;class java.lang.IllegalArgumentException&quot;,&quot;session&quot;:&quot;b282a095-a368-4ffd-9fc3-dec8549cbc2d&quot;,&quot;status&quot;:[&quot;eval-error&quot;]} </pre></z><z id="t1556787355" t="pez And also a stack trace in the terminal where I started the REPL."><y>#</y><d>2019-05-02</d><h>08:55</h><w>pez</w>And also a stack trace in the terminal where I started the REPL.</z><z id="t1556787435" t="bozhidar You also have figwheel-sidecar there, right?"><y>#</y><d>2019-05-02</d><h>08:57</h><w>bozhidar</w>You also have figwheel-sidecar there, right?</z><z id="t1556787442" t="pez Yes"><y>#</y><d>2019-05-02</d><h>08:57</h><w>pez</w>Yes</z><z id="t1556787722" t="pez I now tested a thing and I think the exeception only comes if I have done (enable-console-print!) . So that&apos;s one mystery less, hopefully."><y>#</y><d>2019-05-02</d><h>09:02</h><w>pez</w>I now tested a thing and I think the exeception only comes if I have done <code>(enable-console-print!)</code>. So that&apos;s one mystery less, hopefully.</z><z id="t1556789505" t="bozhidar :thumbsup:"><y>#</y><d>2019-05-02</d><h>09:31</h><w>bozhidar</w><b>:thumbsup:</b></z><z id="t1556792223" t="pez Damnit. It wasn&apos;t (enable-console-print) ."><y>#</y><d>2019-05-02</d><h>10:17</h><w>pez</w>Damnit. It wasn&apos;t <code>(enable-console-print)</code>.</z><z id="t1556799483" t="pez Now I have brought in Figwheel into the mix. Starting the nrepl project like so: lein update-in :dependencies conj &quot;[com.bhauman/figwheel-main \&quot;0.2.0\&quot;]&quot; -- update-in :dependencies conj &quot;[nrepl \&quot;0.6.0-PEZ-TESTING\&quot;]&quot; -- update-in :dependencies conj &quot;[cider/piggieback \&quot;0.4.0\&quot;]&quot; -- update-in :dependencies conj &quot;[figwheel-sidecar \&quot;0.5.18\&quot;]&quot; -- update-in :plugins conj &quot;[cider/cider-nrepl \&quot;0.21.1\&quot;]&quot; -- update-in &quot;[:repl-options :nrepl-middleware]&quot; conj &quot;[\&quot;cider.nrepl/cider-middleware\&quot;]&quot; -- update-in &quot;[:repl-options :nrepl-middleware]&quot; conj &quot;[\&quot;cider.piggieback/wrap-cljs-repl\&quot;]&quot; -- with-profile fig repl Then I get that exception consistently when trying to evaluate (println &quot;hello&quot;) from my repl window."><y>#</y><d>2019-05-02</d><h>12:18</h><w>pez</w>Now I have brought in Figwheel into the mix. Starting the nrepl project like so:
<pre>lein update-in :dependencies conj &quot;[com.bhauman/figwheel-main \&quot;0.2.0\&quot;]&quot; -- update-in :dependencies conj &quot;[nrepl \&quot;0.6.0-PEZ-TESTING\&quot;]&quot; -- update-in :dependencies conj &quot;[cider/piggieback \&quot;0.4.0\&quot;]&quot; -- update-in :dependencies conj &quot;[figwheel-sidecar \&quot;0.5.18\&quot;]&quot; -- update-in :plugins conj &quot;[cider/cider-nrepl \&quot;0.21.1\&quot;]&quot; -- update-in &quot;[:repl-options :nrepl-middleware]&quot; conj &quot;[\&quot;cider.nrepl/cider-middleware\&quot;]&quot; -- update-in &quot;[:repl-options :nrepl-middleware]&quot; conj &quot;[\&quot;cider.piggieback/wrap-cljs-repl\&quot;]&quot; -- with-profile fig repl
</pre>
Then I get that exception consistently when trying to evaluate  <code>(println &quot;hello&quot;)</code> from my repl window.</z><z id="t1556799610" t="pez I don&apos;t get that when I evaluate inline in the buffer, however. Then my printing-transport logger writes this: printing-transport: {:id &quot;72&quot;, :session &quot;41106734-a7e2-4b75-8509-d4a44f545601&quot;, :status #{:done}} printing-transport: {:id 8, :session 41106734-a7e2-4b75-8509-d4a44f545601, :out hello } printing-transport: {:id &quot;73&quot;, :session &quot;41106734-a7e2-4b75-8509-d4a44f545601&quot;, :value &quot;nil&quot;, :printed-value 1, :ns clojure.live-cljs-hacking} printing-transport: {:id &quot;73&quot;, :session &quot;41106734-a7e2-4b75-8509-d4a44f545601&quot;, :status #{:done}} printing-transport: {:id &quot;74&quot;, :session &quot;41106734-a7e2-4b75-8509-d4a44f545601&quot;, &quot;file&quot; nil, &quot;line&quot; 1, &quot;ns&quot; &quot;clojure.live-cljs-hacking&quot;, &quot;doc&quot; nil, &quot;name&quot; &quot;clojure.live-cljs-hacking&quot;, :status #{:done}} See how the out message has a strange id ?"><y>#</y><d>2019-05-02</d><h>12:20</h><w>pez</w>I don&apos;t get that when I evaluate inline in the buffer, however. Then my printing-transport logger writes this: <pre>printing-transport: {:id &quot;72&quot;, :session &quot;41106734-a7e2-4b75-8509-d4a44f545601&quot;, :status #{:done}}
printing-transport: {:id 8, :session 41106734-a7e2-4b75-8509-d4a44f545601, :out hello
}
printing-transport: {:id &quot;73&quot;, :session &quot;41106734-a7e2-4b75-8509-d4a44f545601&quot;, :value &quot;nil&quot;, :printed-value 1, :ns clojure.live-cljs-hacking}
printing-transport: {:id &quot;73&quot;, :session &quot;41106734-a7e2-4b75-8509-d4a44f545601&quot;, :status #{:done}}
printing-transport: {:id &quot;74&quot;, :session &quot;41106734-a7e2-4b75-8509-d4a44f545601&quot;, &quot;file&quot; nil, &quot;line&quot; 1, &quot;ns&quot; &quot;clojure.live-cljs-hacking&quot;, &quot;doc&quot; nil, &quot;name&quot; &quot;clojure.live-cljs-hacking&quot;, :status #{:done}}</pre>
See how the <code>out</code> message has a strange <code>id</code>?</z><z id="t1556799943" t="pez I don&apos;t know why the two different methods to evaluate would give different results. Maybe it is because the buffer&apos;s session is cloned off early in the connection process, while the repl window&apos;s session is cloned later and something wedges itself in between those two clonings..."><y>#</y><d>2019-05-02</d><h>12:25</h><w>pez</w>I don&apos;t know why the two different methods to evaluate would give different results. Maybe it is because the buffer&apos;s session is cloned off early in the connection process, while the repl window&apos;s session is cloned later and something wedges itself in between those two clonings...</z><z id="t1556799985" t="pez Now I must rest my brain from this a while. If someone has an idea about what else to investigate, please let me know."><y>#</y><d>2019-05-02</d><h>12:26</h><w>pez</w>Now I must rest my brain from this a while. If someone has an idea about what else to investigate, please let me know.</z><z id="t1556817565" t="pez Yet another thing that is funny is that the logged row with id 8 there is that both the id and the out are printed without quotes. Also If I alter the evaluated string, say to (println &quot;hello again&quot;) , that is also logged with the same id , a bare 8 ."><y>#</y><d>2019-05-02</d><h>17:19</h><w>pez</w>Yet another thing that is funny is that the logged row with <code>id</code> 8 there is that both the <code>id</code> and the <code>out</code> are printed without quotes. Also If I alter the evaluated string, say to <code>(println &quot;hello again&quot;)</code>, that is also logged with the same <code>id</code>, a bare <code>8</code>.</z><z id="t1556824058" t="pez Not sure that made sense. This is how the logs look."><y>#</y><d>2019-05-02</d><h>19:07</h><w>pez</w>Not sure that made sense. This is how the logs look.</z><z id="t1556865578" t="pez Now I also noticed I have this error from Figwheel lurking in the terminal where I started the REPL: [Figwheel:WARNING] Compile Exception: Could not locate nrepl/impl/docs__init.class or nrepl/impl/docs.clj on classpath. [Figwheel:SEVERE] java.io.FileNotFoundException: Could not locate nrepl/impl/docs__init.class or nrepl/impl/docs.clj on classpath. [Figwheel:WARNING] Couldn&apos;t load Clojure file src/clojure/nrepl/core.clj line:222 column:1 No such var: transport/edn 217 [uri] 218 (apply connect (mapcat identity 219 (merge connect-defaults 220 (socket-info uri)))))) 221 222 (add-socket-connect-method! &quot;nrepl+edn&quot; {:transport-fn transport/edn ^--- 223 :port 7888}) 224 (add-socket-connect-method! &quot;nrepl&quot; {:transport-fn transport/bencode 225 :port 7888}) 226 (add-socket-connect-method! &quot;telnet&quot; {:transport-fn transport/tty}) 227 [Figwheel:SEVERE] java.lang.RuntimeException: No such var: transport/edn Don&apos;t know if it is significant, but it sure looks a bit suspicious."><y>#</y><d>2019-05-03</d><h>06:39</h><w>pez</w>Now I also noticed I have this error from Figwheel lurking in the terminal where I started the REPL: <pre>[Figwheel:WARNING] Compile Exception: Could not locate nrepl/impl/docs__init.class or nrepl/impl/docs.clj on classpath.
[Figwheel:SEVERE] java.io.FileNotFoundException: Could not locate nrepl/impl/docs__init.class or nrepl/impl/docs.clj on classpath.
[Figwheel:WARNING] Couldn&apos;t load Clojure file   src/clojure/nrepl/core.clj   line:222  column:1

  No such var: transport/edn

  217      [uri]
  218      (apply connect (mapcat identity
  219                             (merge connect-defaults
  220                                    (socket-info uri))))))
  221
  222  (add-socket-connect-method! &quot;nrepl+edn&quot; {:transport-fn transport/edn
       ^---
  223                                           :port 7888})
  224  (add-socket-connect-method! &quot;nrepl&quot; {:transport-fn transport/bencode
  225                                       :port 7888})
  226  (add-socket-connect-method! &quot;telnet&quot; {:transport-fn transport/tty})
  227

[Figwheel:SEVERE] java.lang.RuntimeException: No such var: transport/edn</pre>
Don&apos;t know if it is significant, but it sure looks a bit suspicious.</z><z id="t1556866219" t="bozhidar Thatâ€™s weird. This certainly exists on master , I assume in happens when youâ€™re testing with it, right?"><y>#</y><d>2019-05-03</d><h>06:50</h><w>bozhidar</w>Thatâ€™s weird. This certainly exists on <code>master</code>, I assume in happens when youâ€™re testing with it, right?</z><z id="t1556866601" t="pez I am testing with master, right."><y>#</y><d>2019-05-03</d><h>06:56</h><w>pez</w>I am testing with master, right.</z><z id="t1556866784" t="pez No, sorry. Checking that again, that came when testing from the 0.6.0 branch."><y>#</y><d>2019-05-03</d><h>06:59</h><w>pez</w>No, sorry. Checking that again, that came when testing from the 0.6.0 branch.</z><z id="t1556876557" t="bozhidar But 0.6 doesnâ€™t have such a method, so I wonder how a reference to it came into being."><y>#</y><d>2019-05-03</d><h>09:42</h><w>bozhidar</w>But 0.6 doesnâ€™t have such a method, so I wonder how a reference to it came into being.</z><z id="t1556877564" t="pez It could have been me who didn&apos;t reload the server cleanly enough."><y>#</y><d>2019-05-03</d><h>09:59</h><w>pez</w>It could have been me who didn&apos;t reload the server cleanly enough.</z><z id="t1557836576" t="markwoodhall Hi, has anyone come across this before? This setup was previously working fine but now I get the below error when trying to open any ClojureScript file in vim (vim-fireplace). I am using cider-nrepl 0.21.1 and piggieback 0.4.0. I imagine there might be a version mismatch or something but I am not sure where. Exception in thread &quot;nRepl-session-b1e1107c-001d-4433-8db7-e66291d821f2&quot; java.lang.IllegalArgumentException: No implementation of method: :send of protocol: #&apos;nrepl.transport/Transport found for class: nil at clojure.core$_cache_protocol_fn.invokeStatic(core_deftype.clj:583) at clojure.core$_cache_protocol_fn.invoke(core_deftype.clj:575) at nrepl.transport$eval48462$fn__48463$G__48453__48470.invoke(transport.clj:16) at nrepl.middleware.print$replying_PrintWriter$fn__48919.invoke(print.clj:115) at nrepl.middleware.print.proxy$java.io.Writer$ff19274a.write(Unknown Source) at java.io.BufferedWriter.flushBuffer(BufferedWriter.java:129) at java.io.BufferedWriter.flush(BufferedWriter.java:253) at java.io.PrintWriter.newLine(PrintWriter.java:482) at java.io.PrintWriter.println(PrintWriter.java:629) at java.io.PrintWriter.println(PrintWriter.java:757) at java.lang.Throwable$WrappedPrintWriter.println(Throwable.java:764) at java.lang.Throwable.printStackTrace(Throwable.java:655) at java.lang.Throwable.printStackTrace(Throwable.java:721) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at java.lang.reflect.Method.invoke(Method.java:498) at clojure.lang.Reflector.invokeMatchingMethod(Reflector.java:93) at clojure.lang.Reflector.invokeInstanceMethod(Reflector.java:28) at cljs.repl$repl_caught.invokeStatic(repl.cljc:809) at cljs.repl$repl_caught.invoke(repl.cljc:795) at cider.piggieback$repl_caught.invokeStatic(piggieback.clj:105) at cider.piggieback$repl_caught.invoke(piggieback.clj:98) at cider.piggieback$do_eval.invokeStatic(piggieback.clj:265) at cider.piggieback$do_eval.invoke(piggieback.clj:227) at cider.piggieback$evaluate.invokeStatic(piggieback.clj:273) at cider.piggieback$evaluate.invoke(piggieback.clj:271) at clojure.lang.Var.invoke(Var.java:381) at cider.piggieback$wrap_cljs_repl$fn__49637$fn__49640$fn__49641.invoke(piggieback.clj:305) at cider.piggieback$enqueue$fn__49609.invoke(piggieback.clj:195) at clojure.lang.AFn.run(AFn.java:22) at nrepl.middleware.session$session_exec$main_loop__49154$fn__49158.invoke(session.clj:171) at nrepl.middleware.session$session_exec$main_loop__49154.invoke(session.clj:170) at clojure.lang.AFn.run(AFn.java:22) at java.lang.Thread.run(Thread.java:748) "><y>#</y><d>2019-05-14</d><h>12:22</h><w>markwoodhall</w>Hi, has anyone come across this before? This setup was previously working fine but now I get the below error when trying to open any ClojureScript file in vim (vim-fireplace). I am using cider-nrepl 0.21.1 and piggieback 0.4.0. I imagine there might be a version mismatch or something but I am not sure where.

<pre>Exception in thread &quot;nRepl-session-b1e1107c-001d-4433-8db7-e66291d821f2&quot; java.lang.IllegalArgumentException: No implementation of method: :send of protocol: #&apos;nrepl.transport/Transport found for class: nil
        at clojure.core$_cache_protocol_fn.invokeStatic(core_deftype.clj:583)
        at clojure.core$_cache_protocol_fn.invoke(core_deftype.clj:575)
        at nrepl.transport$eval48462$fn__48463$G__48453__48470.invoke(transport.clj:16)
        at nrepl.middleware.print$replying_PrintWriter$fn__48919.invoke(print.clj:115)
        at nrepl.middleware.print.proxy$java.io.Writer$ff19274a.write(Unknown Source)
        at java.io.BufferedWriter.flushBuffer(BufferedWriter.java:129)
        at java.io.BufferedWriter.flush(BufferedWriter.java:253)
        at java.io.PrintWriter.newLine(PrintWriter.java:482)
        at java.io.PrintWriter.println(PrintWriter.java:629)
        at java.io.PrintWriter.println(PrintWriter.java:757)
        at java.lang.Throwable$WrappedPrintWriter.println(Throwable.java:764)
        at java.lang.Throwable.printStackTrace(Throwable.java:655)
        at java.lang.Throwable.printStackTrace(Throwable.java:721)
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
        at java.lang.reflect.Method.invoke(Method.java:498)
        at clojure.lang.Reflector.invokeMatchingMethod(Reflector.java:93)
        at clojure.lang.Reflector.invokeInstanceMethod(Reflector.java:28)
        at cljs.repl$repl_caught.invokeStatic(repl.cljc:809)
        at cljs.repl$repl_caught.invoke(repl.cljc:795)
        at cider.piggieback$repl_caught.invokeStatic(piggieback.clj:105)
        at cider.piggieback$repl_caught.invoke(piggieback.clj:98)
        at cider.piggieback$do_eval.invokeStatic(piggieback.clj:265)
        at cider.piggieback$do_eval.invoke(piggieback.clj:227)
        at cider.piggieback$evaluate.invokeStatic(piggieback.clj:273)
        at cider.piggieback$evaluate.invoke(piggieback.clj:271)
        at clojure.lang.Var.invoke(Var.java:381)
        at cider.piggieback$wrap_cljs_repl$fn__49637$fn__49640$fn__49641.invoke(piggieback.clj:305)
        at cider.piggieback$enqueue$fn__49609.invoke(piggieback.clj:195)
        at clojure.lang.AFn.run(AFn.java:22)
        at nrepl.middleware.session$session_exec$main_loop__49154$fn__49158.invoke(session.clj:171)
        at nrepl.middleware.session$session_exec$main_loop__49154.invoke(session.clj:170)
        at clojure.lang.AFn.run(AFn.java:22)
        at java.lang.Thread.run(Thread.java:748)
</pre></z><z id="t1557836719" t="bozhidar I think [:attrs {:href &quot;/_/_/users/U0ETXRFEW&quot;}] mentioned a similar problem (take a look at this history)."><y>#</y><d>2019-05-14</d><h>12:25</h><w>bozhidar</w>I think <a>@pez</a> mentioned a similar problem (take a look at this history).</z><z id="t1557836728" t="pez Yes, I&apos;ve seen it often with the dev build of Calva, which seems to provoke this thing often. I have failed to trace it down, though."><y>#</y><d>2019-05-14</d><h>12:25</h><w>pez</w>Yes, I&apos;ve seen it often with the dev build of Calva, which seems to provoke this thing often. I have failed to trace it down, though.</z><z id="t1557836730" t="bozhidar I havenâ€™t been able to reproduce it, though."><y>#</y><d>2019-05-14</d><h>12:25</h><w>bozhidar</w>I havenâ€™t been able to reproduce it, though.</z><z id="t1557836751" t="pez The history is eaten by the 10K monster."><y>#</y><d>2019-05-14</d><h>12:25</h><w>pez</w>The history is eaten by the 10K monster.</z><z id="t1557836833" t="bozhidar Ah, damn it. My best guess is that the problem happens only with a certain format of the evaluation requests, as no CIDER users have ever reported this."><y>#</y><d>2019-05-14</d><h>12:27</h><w>bozhidar</w>Ah, damn it. My best guess is that the problem happens only with a certain format of the evaluation requests, as no CIDER users have ever reported this.</z><z id="t1557836837" t="dominicm [:attrs {:href &quot;/_/_/users/U052B0PT3&quot;}] helped me with this before"><y>#</y><d>2019-05-14</d><h>12:27</h><w>dominicm</w><a>@cichli</a> helped me with this before</z><z id="t1557836865" t="dominicm It might be fixed in snapshot piggieback?"><y>#</y><d>2019-05-14</d><h>12:27</h><w>dominicm</w>It might be fixed in snapshot piggieback?</z><z id="t1557836871" t="bozhidar He hasnâ€™t been around much lately, but heâ€™s definitely the expert on this part of the code."><y>#</y><d>2019-05-14</d><h>12:27</h><w>bozhidar</w>He hasnâ€™t been around much lately, but heâ€™s definitely the expert on this part of the code.</z><z id="t1557836916" t="pez My theory has been that it is provoked by something that happens before the evaluation request."><y>#</y><d>2019-05-14</d><h>12:28</h><w>pez</w>My theory has been that it is provoked by something that happens before the evaluation request.</z><z id="t1557836952" t="bozhidar One thing that comes to mind is that CIDER uses streamed values by default. I wonder if the problem happens only without them."><y>#</y><d>2019-05-14</d><h>12:29</h><w>bozhidar</w>One thing that comes to mind is that CIDER uses streamed values by default. I wonder if the problem happens only without them.</z><z id="t1557836960" t="bozhidar &gt; It might be fixed in snapshot piggieback?"><y>#</y><d>2019-05-14</d><h>12:29</h><w>bozhidar</w>&gt; It might be fixed in snapshot piggieback?</z><z id="t1557836995" t="bozhidar Good idea. [:attrs {:href &quot;/_/_/users/U052B0PT3&quot;}] did some refactorings there, although I donâ€™t think anything related to bug reports."><y>#</y><d>2019-05-14</d><h>12:29</h><w>bozhidar</w>Good idea. <a>@cichli</a> did some refactorings there, although I donâ€™t think anything related to bug reports.</z><z id="t1557837043" t="pez I shall see if it is still easy to get this with Calva, if so I can also check wether snapshot fixes it."><y>#</y><d>2019-05-14</d><h>12:30</h><w>pez</w>I shall see if it is still easy to get this with Calva, if so I can also check wether snapshot fixes it.</z><z id="t1557837419" t="markwoodhall I am hitting the problem consistently, I have just tried with piggieback 0.4.1-SNAPSHOT and the issue went away. Will keep trying and see how I get on."><y>#</y><d>2019-05-14</d><h>12:36</h><w>markwoodhall</w>I am hitting the problem consistently, I have just tried with piggieback <code>0.4.1-SNAPSHOT</code> and the issue went away. Will keep trying and see how I get on.</z><z id="t1557838014" t="markwoodhall I did look at the diff between 0.4.0 and 0.4.1-SNAPSHOT and it looked like nothing there could resolve it, it looks like it has though."><y>#</y><d>2019-05-14</d><h>12:46</h><w>markwoodhall</w>I did look at the diff between <code>0.4.0</code> and <code>0.4.1-SNAPSHOT</code> and it looked like nothing there could resolve it, it looks like it has though.</z><z id="t1557838413" t="bozhidar [:attrs {:href &quot;/_/_/users/U1MG96K32&quot;}] Thatâ€™s an unexpected, but welcome development. I can cut a release for 0.4.1 is a day or two. Letâ€™s just make sure that the problem goes away for good."><y>#</y><d>2019-05-14</d><h>12:53</h><w>bozhidar</w><a>@markwoodhall</a> Thatâ€™s an unexpected, but welcome development. I can cut a release for 0.4.1 is a day or two. Letâ€™s just make sure that the problem goes away for good.</z><z id="t1557838485" t="bozhidar Ah, Iâ€™m pretty sure thatâ€™s the bug fix https://github.com/nrepl/piggieback/commit/f43e12c13725e2bd31b944d39a55b38dd6b5587c"><y>#</y><d>2019-05-14</d><h>12:54</h><w>bozhidar</w>Ah, Iâ€™m pretty sure thatâ€™s the bug fix <a href="https://github.com/nrepl/piggieback/commit/f43e12c13725e2bd31b944d39a55b38dd6b5587c" target="_blank">https://github.com/nrepl/piggieback/commit/f43e12c13725e2bd31b944d39a55b38dd6b5587c</a></z><z id="t1557838845" t="bozhidar In light of this revelation Iâ€™ve just released 0.4.1 right away. Iâ€™m just sorry poor [:attrs {:href &quot;/_/_/users/U0ETXRFEW&quot;}] wasted a ton of time debugging this, before [:attrs {:href &quot;/_/_/users/U09LZR36F&quot;}] saved us."><y>#</y><d>2019-05-14</d><h>13:00</h><w>bozhidar</w>In light of this revelation Iâ€™ve just released 0.4.1 right away. Iâ€™m just sorry poor <a>@pez</a> wasted a ton of time debugging this, before <a>@dominicm</a> saved us.</z><z id="t1557839023" t="pez Haha, I learnt a lot in the process, shed no tears my way. â¤ï¸"><y>#</y><d>2019-05-14</d><h>13:03</h><w>pez</w>Haha, I learnt a lot in the process, shed no tears my way. <b>â¤ï¸</b></z><z id="t1557991798" t="bozhidar After several quiet months Iâ€™ve created a bunch of nREPL tickets with a few ideas I have for the future. They are mostly about promoting some things weâ€™ve developed for cider-nrepl upstream."><y>#</y><d>2019-05-16</d><h>07:29</h><w>bozhidar</w>After several quiet months Iâ€™ve created a bunch of nREPL tickets with a few ideas I have for the future. They are mostly about promoting some things weâ€™ve developed for cider-nrepl upstream.</z><z id="t1557991851" t="bozhidar On a related note - I might cut 0.7 soon only with [:attrs {:href &quot;/_/_/users/U1XERPZ18&quot;}] â€™s work on the EDN transport, as there has been no traction on the other fronts unfortunately."><y>#</y><d>2019-05-16</d><h>07:30</h><w>bozhidar</w>On a related note - I might cut 0.7 soon only with <a>@shen</a>â€™s work on the EDN transport, as there has been no traction on the other fronts unfortunately.</z><z id="t1558115649" t="urzds Hi!"><y>#</y><d>2019-05-17</d><h>17:54</h><w>urzds</w>Hi!</z><z id="t1558115711" t="urzds Is there an nREPL multiplexer? Something like tmux or screen, but for nREPL? Something that allows multiple nREPL clients to connect to the same process and see the same output and receive the same results from functions and catch the same exceptions?"><y>#</y><d>2019-05-17</d><h>17:55</h><w>urzds</w>Is there an nREPL multiplexer? Something like tmux or screen, but for nREPL? Something that allows multiple nREPL clients to connect to the same process and see the same output and receive the same results from functions and catch the same exceptions?</z></g><g id="s5"><z id="t1558123420" t="dominicm There is cider-spy in this space"><y>#</y><d>2019-05-17</d><h>20:03</h><w>dominicm</w>There is cider-spy in this space</z><z id="t1558146712" t="bozhidar There was also https://github.com/jamii/concerto/ at some point."><y>#</y><d>2019-05-18</d><h>02:31</h><w>bozhidar</w>There was also <a href="https://github.com/jamii/concerto/" target="_blank">https://github.com/jamii/concerto/</a> at some point.</z><z id="t1558146741" t="bozhidar Generally creating a multiplexer shouldnâ€™t be particularly hard."><y>#</y><d>2019-05-18</d><h>02:32</h><w>bozhidar</w>Generally creating a multiplexer shouldnâ€™t be particularly hard.</z><z id="t1558162066" t="dominicm I suspect that client support is the hard part"><y>#</y><d>2019-05-18</d><h>06:47</h><w>dominicm</w>I suspect that client support is the hard part</z><z id="t1558248248" t="bozhidar Yeah, although it shouldnâ€™t be particularly hard."><y>#</y><d>2019-05-19</d><h>06:44</h><w>bozhidar</w>Yeah, although it shouldnâ€™t be particularly hard.</z><z id="t1558345419" t="urzds Thanks!"><y>#</y><d>2019-05-20</d><h>09:43</h><w>urzds</w>Thanks!</z><z id="t1559385604" t="pez I have a strange situation with my work project (Leiningen + lein-figwheel), with four different behaviours on four different machines. Letâ€™s call them A, B, C and D . A. I can only start the project with repl :headless , otherwise I get: REPL server launch timed out. regardless of how long I allow the timeout to be. Starting it headless I canâ€™t start figwheel. I get Execution error (IllegalArgumentException) at figwheel-sidecar.utils/illegal-argument (utils.clj:53) when it tries to require the namespace with my figwheel :ring-handler . B. I can start the project with an interactive repl. And then also start fighweel from that repl. However if I start the repl :headless I get the same error as with A when trying to start figwheel. C. I get the same timeout error as with A starting with an interactive repl. But I can start it headless, and I can start figwheel from the headless repl session. D. I can start the repl interactive or headless and also start fighweel regardless. It is all Macs with latest macos and all are using Java 8 (because reasons). Not sure where to post this, but figured that in this channel there is the knowledge that might help me pinpoint where the problem stems from."><y>#</y><d>2019-06-01</d><h>10:40</h><w>pez</w>I have a strange situation with my work project (Leiningen + lein-figwheel), with four different behaviours on four different machines. Letâ€™s call them A, B,  C and D .

A. I can only start the project with <code>repl :headless</code>, otherwise I get: <code>REPL server launch timed out.</code> regardless of how long I allow the timeout to be. Starting it headless I canâ€™t start figwheel. I get <code>Execution error (IllegalArgumentException) at figwheel-sidecar.utils/illegal-argument (utils.clj:53)</code> when it tries to require the namespace with my figwheel <code>:ring-handler</code>.

B. I can start the project with an interactive repl. And then also start fighweel from that repl. However if I start the repl <code>:headless</code> I get the same error as with A when trying to start figwheel.

C. I get the same timeout error as with A starting with an interactive repl. But I can start it headless, and I can start figwheel from the headless repl session.

D. I can start the repl interactive or headless and also start fighweel regardless.

It is all Macs with latest macos and all are using Java 8 (because reasons).

Not sure where to post this, but figured that in this channel there is the knowledge that might help me pinpoint where the problem stems from.</z><z id="t1559583150" t="pez Hello, I am going to appear on a Clojure podcast soon, to talk about Calva. In pondering what the heck to say, I started to think about how nice it would be to be able to use Calva together with Lumo. From what I understand, a big hurdle there is the lack of an nrepl server. But I have also heard rumours about an nrepl server being possible on top of the socket server. Is that so? What can you share about the prospects of using an nrepl client with self hosted ClojureScript?"><y>#</y><d>2019-06-03</d><h>17:32</h><w>pez</w>Hello, I am going to appear on a Clojure podcast soon, to talk about Calva. In pondering what the heck to say, I started to think about how nice it would be to be able to use Calva together with Lumo. From what I understand, a big hurdle there is the lack of an nrepl server. But I have also heard rumours about an nrepl server being possible on top of the socket server. Is that so? What can you share about the prospects of using an nrepl client with self hosted ClojureScript?</z><z id="t1559583509" t="dominicm [:attrs {:href &quot;/_/_/users/U0ETXRFEW&quot;}] I think that the trick doesn&apos;t work in clojurescript because the repl is a little special. It might be workable for lumo, I can&apos;t remember if the changes were made to it&apos;s repl function. Nrepl is still mostly written with jvm in mind though, so I imagine there would need to be a lot of changes."><y>#</y><d>2019-06-03</d><h>17:38</h><w>dominicm</w><a>@pez</a> I think that the trick doesn&apos;t work in clojurescript because the repl is a little special. It might be workable for lumo, I can&apos;t remember if the changes were made to it&apos;s repl function. Nrepl is still mostly written with jvm in mind though, so I imagine there would need to be a lot of changes.</z><z id="t1559583525" t="dominicm The unrepl wiki has notes on clojurescript"><y>#</y><d>2019-06-03</d><h>17:38</h><w>dominicm</w>The unrepl wiki has notes on clojurescript</z><z id="t1559583550" t="pez Thanks! I&apos;ll have a look. "><y>#</y><d>2019-06-03</d><h>17:39</h><w>pez</w>Thanks! I&apos;ll have a look. </z><z id="t1559588351" t="pez I didnâ€™t understand much about what was said about cljs on that wiki. But I found an issue that self hosted cljs support is on [:attrs {:href &quot;/_/_/users/U3E46Q1DG&quot;}] â€™s wishlist. However, I also do not know what unrepl support for self hosted cljs would mean for Calva. Iâ€™ll stay away from discussing it on the podcast, but am of course very curious."><y>#</y><d>2019-06-03</d><h>18:59</h><w>pez</w>I didnâ€™t understand much about what was said about cljs on that wiki. But I found an issue that self hosted cljs support is on <a>@cgrand</a>â€™s wishlist. However, I also do not know what unrepl support for self hosted cljs would mean for Calva. Iâ€™ll stay away from discussing it on the podcast, but am of course very curious.</z><z id="t1559589698" t="dominicm :) I&apos;d mention it&apos;s of interest, but still a research topic"><y>#</y><d>2019-06-03</d><h>19:21</h><w>dominicm</w>:) I&apos;d mention it&apos;s of interest, but still a research topic</z><z id="t1559589951" t="dominicm Someone could step up and pioneer it, and they&apos;d find support from this channel"><y>#</y><d>2019-06-03</d><h>19:25</h><w>dominicm</w>Someone could step up and pioneer it, and they&apos;d find support from this channel</z><z id="t1559633247" t="bozhidar &gt; I have a strange situation with my work project (Leiningen + lein-figwheel), with four different behaviours on four different machines. Letâ€™s call them A, B, C and D ."><y>#</y><d>2019-06-04</d><h>07:27</h><w>bozhidar</w>&gt; I have a strange situation with my work project (Leiningen + lein-figwheel), with four different behaviours on four different machines. Letâ€™s call them A, B,  C and D .</z><z id="t1559633297" t="bozhidar [:attrs {:href &quot;/_/_/users/U0ETXRFEW&quot;}] Did you manage to sort this out? The problems you described didnâ€™t seem nREPL related to me, more like something to do with Lein."><y>#</y><d>2019-06-04</d><h>07:28</h><w>bozhidar</w><a>@pez</a> Did you manage to sort this out? The problems you described didnâ€™t seem nREPL related to me, more like something to do with Lein.</z><z id="t1559633315" t="bozhidar &gt; Hello, I am going to appear on a Clojure podcast soon, to talk about Calva. In pondering what the heck to say, I started to think about how nice it would be to be able to use Calva together with Lumo. From what I understand, a big hurdle there is the lack of an nrepl server. But I have also heard rumours about an nrepl server being possible on top of the socket server. Is that so? What can you share about the prospects of using an nrepl client with self hosted ClojureScript?"><y>#</y><d>2019-06-04</d><h>07:28</h><w>bozhidar</w>&gt; Hello, I am going to appear on a Clojure podcast soon, to talk about Calva. In pondering what the heck to say, I started to think about how nice it would be to be able to use Calva together with Lumo. From what I understand, a big hurdle there is the lack of an nrepl server. But I have also heard rumours about an nrepl server being possible on top of the socket server. Is that so? What can you share about the prospects of using an nrepl client with self hosted ClojureScript?</z><z id="t1559633445" t="bozhidar Adding to what was already said here - I think that implementing an nREPL server in ClojureScript wonâ€™t be hard, provided someone decides to tackle it. But the real difficulty would be the broader ecosystem of middleware - most of them rely on Java in one way or another and porting a lot of middleware is obviously a lot of work."><y>#</y><d>2019-06-04</d><h>07:30</h><w>bozhidar</w>Adding to what was already said here - I think that implementing an nREPL server in ClojureScript wonâ€™t be hard, provided someone decides to tackle it. But the real difficulty would be the broader ecosystem of middleware - most of them rely on Java in one way or another and porting a lot of middleware is obviously a lot of work.</z><z id="t1559633502" t="bozhidar Thatâ€™s why we avoided in general the route of the self-hosted nREPL for ClojureScript and tried to do as much as possible with the boostrapped version - this simplified a lot the work needed to provide â€œsomeâ€ ClojureScript support."><y>#</y><d>2019-06-04</d><h>07:31</h><w>bozhidar</w>Thatâ€™s why we avoided in general the route of the self-hosted nREPL for ClojureScript and tried to do as much as possible with the boostrapped version - this simplified a lot the work needed to provide â€œsomeâ€ ClojureScript support.</z><z id="t1559633543" t="bozhidar In the end of the day itâ€™s always fairly simply to provide some basic eval functionality, but the more complex the features get, the harder it is to avoid using some host features."><y>#</y><d>2019-06-04</d><h>07:32</h><w>bozhidar</w>In the end of the day itâ€™s always fairly simply to provide some basic eval functionality, but the more complex the features get, the harder it is to avoid using some host features.</z><z id="t1559633566" t="bozhidar &gt; However, I also do not know what unrepl support for self hosted cljs would mean for Calva."><y>#</y><d>2019-06-04</d><h>07:32</h><w>bozhidar</w>&gt;  However, I also do not know what unrepl support for self hosted cljs would mean for Calva.</z><z id="t1559633568" t="pez Re: my timeout problems. I thought it might be nrepl related a while because had different results with some different dependencies injected, but that was a smoke screen it seems. It is probably something to do with some libraries we use. We&apos;ll figure it out, hopefully."><y>#</y><d>2019-06-04</d><h>07:32</h><w>pez</w>Re: my timeout problems. I thought it might be nrepl related a while because had different results with some different dependencies injected, but that was a smoke screen it seems. It is probably something to do with some libraries we use. We&apos;ll figure it out, hopefully.</z><z id="t1559633598" t="bozhidar I assume it would mean nothing, as youâ€™d have to implement a different API if you want to support unrepl/prepl."><y>#</y><d>2019-06-04</d><h>07:33</h><w>bozhidar</w>I assume it would mean nothing, as youâ€™d have to implement a different API if you want to support unrepl/prepl.</z><z id="t1559634767" t="dominicm To clarify my intention here, unrepl&apos;s problem with running over a socket repl are the same problems that nrepl will have, same approach."><y>#</y><d>2019-06-04</d><h>07:52</h><r>dominicm</r>To clarify my intention here, unrepl&apos;s problem with running over a socket repl are the same problems that nrepl will have, same approach.</z><z id="t1559634811" t="bozhidar Yep, exactly."><y>#</y><d>2019-06-04</d><h>07:53</h><r>bozhidar</r>Yep, exactly.</z><z id="t1559633664" t="bozhidar I spent some time researching the possibility for supporting different REPL providers in CIDER in the past, but in the end it seemed like too much work for very little gain."><y>#</y><d>2019-06-04</d><h>07:34</h><w>bozhidar</w>I spent some time researching the possibility for supporting different REPL providers in CIDER in the past, but in the end it seemed like too much work for very little gain.</z><z id="t1559633695" t="pez Calva is pretty bare bones. So probably not a lot of middleware involved."><y>#</y><d>2019-06-04</d><h>07:34</h><w>pez</w>Calva is pretty bare bones. So probably not a lot of middleware involved.</z><z id="t1559633696" t="bozhidar You basically need to provide an abstraction layer over nrepl/unrepl/prepl and have to reconcile the differences between them in that layer."><y>#</y><d>2019-06-04</d><h>07:34</h><w>bozhidar</w>You basically need to provide an abstraction layer over nrepl/unrepl/prepl and have to reconcile the differences between them in that layer.</z><z id="t1559633762" t="bozhidar If youâ€™re mostly using eval I guess you can get away with an nREPL implementation that simply doesnâ€™t support middleware at all and just provides the ops you need for Calva."><y>#</y><d>2019-06-04</d><h>07:36</h><w>bozhidar</w>If youâ€™re mostly using eval I guess you can get away with an nREPL implementation that simply doesnâ€™t support middleware at all and just provides the ops you need for Calva.</z><z id="t1559633814" t="bozhidar I know thatâ€™s what Arcadiaâ€™s team did to build a working nREPL server for ClojureCLR. Their implementation was something like one file and would be a good starting point for ClojureScript support as well."><y>#</y><d>2019-06-04</d><h>07:36</h><w>bozhidar</w>I know thatâ€™s what Arcadiaâ€™s team did to build a working nREPL server for ClojureCLR. Their implementation was something like one file and would be a good starting point for ClojureScript support as well.</z><z id="t1559633870" t="pez Cool. I&apos;ll have a look at that. Arcadia is another environment I&apos;d like Calva to be useful with anyway."><y>#</y><d>2019-06-04</d><h>07:37</h><w>pez</w>Cool. I&apos;ll have a look at that. Arcadia is another environment I&apos;d like Calva to be useful with anyway.</z><z id="t1559633955" t="bozhidar For Arcadia itâ€™s simpler in general - I think the piggieback approach (just provide eval support via middleware) would work for them."><y>#</y><d>2019-06-04</d><h>07:39</h><w>bozhidar</w>For Arcadia itâ€™s simpler in general - I think the piggieback approach (just provide eval support via middleware) would work for them.</z><z id="t1559633967" t="bozhidar Hereâ€™s actually an implementation of that https://github.com/spacepluk/arcadia.nrepl/blob/master/src/arcadia/nrepl.clj"><y>#</y><d>2019-06-04</d><h>07:39</h><w>bozhidar</w>Hereâ€™s actually an implementation of that <a href="https://github.com/spacepluk/arcadia.nrepl/blob/master/src/arcadia/nrepl.clj" target="_blank">https://github.com/spacepluk/arcadia.nrepl/blob/master/src/arcadia/nrepl.clj</a></z><z id="t1559634012" t="bozhidar &gt; This is an nREPL bridge for Arcadia Unity. It spins up a standard nREPL server and it redirects eval operations to the Arcadia UDP REPL. This will allow to use existing tooling and editor integrations without the need to port nREPL and other middlewares/libraries to ClojureCLR."><y>#</y><d>2019-06-04</d><h>07:40</h><w>bozhidar</w>&gt; This is an nREPL bridge for Arcadia Unity. It spins up a standard nREPL server and it redirects eval operations to the Arcadia UDP REPL. This will allow to use existing tooling and editor integrations without the need to port nREPL and other middlewares/libraries to ClojureCLR.</z><z id="t1559634029" t="bozhidar Thatâ€™s the beauty of nREPL modular architecture in action. ðŸ™‚"><y>#</y><d>2019-06-04</d><h>07:40</h><w>bozhidar</w>Thatâ€™s the beauty of nREPL modular architecture in action. <b>ðŸ™‚</b></z><z id="t1559634232" t="pez You are making me cry here. ðŸ˜ƒ"><y>#</y><d>2019-06-04</d><h>07:43</h><w>pez</w>You are making me cry here. <b>ðŸ˜ƒ</b></z><z id="t1559634767" t="dominicm To clarify my intention here, unrepl&apos;s problem with running over a socket repl are the same problems that nrepl will have, same approach."><y>#</y><d>2019-06-04</d><h>07:52</h><w>dominicm</w>To clarify my intention here, unrepl&apos;s problem with running over a socket repl are the same problems that nrepl will have, same approach.</z><z id="t1559634833" t="bozhidar [:attrs {:href &quot;/_/_/users/U0ETXRFEW&quot;}] I didnâ€™t want to ruin your day. ðŸ˜‰"><y>#</y><d>2019-06-04</d><h>07:53</h><w>bozhidar</w><a>@pez</a> I didnâ€™t want to ruin your day. <b>ðŸ˜‰</b></z><z id="t1559634936" t="pez Haha, I just have a soft spot for beauty."><y>#</y><d>2019-06-04</d><h>07:55</h><w>pez</w>Haha, I just have a soft spot for beauty.</z><z id="t1559638161" t="bozhidar ðŸ˜„ ðŸ˜„ ðŸ˜„"><y>#</y><d>2019-06-04</d><h>08:49</h><w>bozhidar</w><b>ðŸ˜„</b> <b>ðŸ˜„</b> <b>ðŸ˜„</b></z><z id="t1561120696" t="bozhidar FYI - https://metaredux.com/posts/2019/06/21/nrepl-0-7-introducing-a-native-edn-transport.html"><y>#</y><d>2019-06-21</d><h>12:38</h><w>bozhidar</w>FYI - <a href="https://metaredux.com/posts/2019/06/21/nrepl-0-7-introducing-a-native-edn-transport.html" target="_blank">https://metaredux.com/posts/2019/06/21/nrepl-0-7-introducing-a-native-edn-transport.html</a></z><z id="t1561125363" t="stathissideris hello"><y>#</y><d>2019-06-21</d><h>13:56</h><w>stathissideris</w>hello</z><z id="t1561125453" t="stathissideris I tried: Â» clj -Sdeps &apos;{:deps {nrepl {:mvn/version &quot;0.7.0-alpha1&quot;}}}&apos; Clojure 1.10.0 user=&gt; (require &apos;[nrepl.server :refer [start-server stop-server]]) nil user=&gt; (defonce server (start-server :bind &quot;localhost&quot; :port 4001)) and then from emacs (with Cider 0.21.0): M-x cider-jack-in When typing (+ 1 1) in the resulting REPL I get: error in process filter: &apos;nil&apos; requires the nREPL op &quot;classpath&quot; (provided by cider-nrepl) and the resulting â€œtickerâ€ running forever"><y>#</y><d>2019-06-21</d><h>13:57</h><w>stathissideris</w>I tried:
<pre>Â» clj -Sdeps &apos;{:deps {nrepl {:mvn/version &quot;0.7.0-alpha1&quot;}}}&apos;
Clojure 1.10.0
user=&gt; (require &apos;[nrepl.server :refer [start-server stop-server]])
nil
user=&gt; (defonce server (start-server :bind &quot;localhost&quot; :port 4001))
</pre>
and then from emacs (with Cider 0.21.0): <code>M-x cider-jack-in</code>

When typing <code>(+ 1 1)</code> in the resulting REPL I get:
<code>error in process filter: &apos;nil&apos; requires the nREPL op &quot;classpath&quot; (provided by cider-nrepl)</code>
and the resulting â€œtickerâ€ running forever</z><z id="t1561125467" t="stathissideris also happens with nrepl 0.6.0"><y>#</y><d>2019-06-21</d><h>13:57</h><w>stathissideris</w>also happens with nrepl 0.6.0</z><z id="t1561125482" t="stathissideris (the result never gets printed)"><y>#</y><d>2019-06-21</d><h>13:58</h><w>stathissideris</w>(the result never gets printed)</z><z id="t1561125531" t="bozhidar [:attrs {:href &quot;/_/_/users/U050AACJB&quot;}] I think this was a bug thatâ€™s fixed on the current master of CIDER. Basically it didnâ€™t work without cider-nrepl without that fix."><y>#</y><d>2019-06-21</d><h>13:58</h><w>bozhidar</w><a>@stathissideris</a> I think this was a bug thatâ€™s fixed on the current <code>master</code> of CIDER. Basically it didnâ€™t work without cider-nrepl without that fix.</z><z id="t1561125549" t="stathissideris ok, thanks, good to know ðŸ™‚"><y>#</y><d>2019-06-21</d><h>13:59</h><w>stathissideris</w>ok, thanks, good to know <b>ðŸ™‚</b></z><z id="t1561402980" t="pez I have a strange bug in Calvaâ€™s cljs repl handling that I canâ€™t wrap my head around. I think I have reasons to suspect something in the Orchard territory, but really, it could be just me doing something wrong in my usage as well. So here is what happens: I can create a CLJS repl by evaluating (do (require &apos;[cljs.repl.node]) (require &apos;[cider.piggieback]) (cider.piggieback/cljs-repl (cljs.repl.node/repl-env))) and that repl works. But if I clone it (the nrepl op clone , that is), then evaluating something as simple as 42 I get this stack trace: java.lang.NullPointerException at cljs.repl.node$node_eval.invokeStatic(node.clj:66) at cljs.repl.node$node_eval.invoke(node.clj:60) at cljs.repl.node.NodeEnv._evaluate(node.clj:238) at user.Delegatingcljs_repl_node_NodeEnv._evaluate(form-init5732710029644372935.clj:66) at cljs.repl$evaluate_form.invokeStatic(repl.cljc:569) at cljs.repl$evaluate_form.invoke(repl.cljc:499) at cider.piggieback$eval_cljs.invokeStatic(piggieback.clj:208) at cider.piggieback$eval_cljs.invoke(piggieback.clj:207) at cider.piggieback$do_eval$fn__1599.invoke(piggieback.clj:244) at clojure.lang.AFn.applyToHelper(AFn.java:152) at clojure.lang.AFn.applyTo(AFn.java:144) at clojure.core$apply.invokeStatic(core.clj:665) at clojure.core$with_bindings_STAR_.invokeStatic(core.clj:1973) at clojure.core$with_bindings_STAR_.doInvoke(core.clj:1973) at clojure.lang.RestFn.invoke(RestFn.java:425) at cider.piggieback$do_eval.invokeStatic(piggieback.clj:221) at cider.piggieback$do_eval.invoke(piggieback.clj:220) at cider.piggieback$evaluate.invokeStatic(piggieback.clj:267) at cider.piggieback$evaluate.invoke(piggieback.clj:265) at clojure.lang.Var.invoke(Var.java:384) at cider.piggieback$wrap_cljs_repl$fn__1615$fn__1618$fn__1619.invoke(piggieback.clj:299) at cider.piggieback$enqueue$fn__1585.invoke(piggieback.clj:191) at clojure.lang.AFn.run(AFn.java:22) at nrepl.middleware.session$session_exec$main_loop__1022$fn__1026.invoke(session.clj:171) at nrepl.middleware.session$session_exec$main_loop__1022.invoke(session.clj:170) at clojure.lang.AFn.run(AFn.java:22) at java.lang.Thread.run(Thread.java:748) class java.lang.NullPointerException"><y>#</y><d>2019-06-24</d><h>19:03</h><w>pez</w>I have a strange bug in Calvaâ€™s cljs repl handling that I canâ€™t wrap my head around. I think I have reasons to suspect something in the Orchard territory, but really, it could be just me doing something wrong in my usage as well. So here is what happens: I can create a CLJS repl by evaluating <pre>(do (require &apos;[cljs.repl.node]) (require &apos;[cider.piggieback]) (cider.piggieback/cljs-repl (cljs.repl.node/repl-env)))</pre> and that repl works. But if I clone it (the nrepl op <code>clone</code>, that is), then evaluating something as simple as <code>42</code> I get this stack trace: <pre>java.lang.NullPointerException
	at cljs.repl.node$node_eval.invokeStatic(node.clj:66)
	at cljs.repl.node$node_eval.invoke(node.clj:60)
	at cljs.repl.node.NodeEnv._evaluate(node.clj:238)
	at user.Delegatingcljs_repl_node_NodeEnv._evaluate(form-init5732710029644372935.clj:66)
	at cljs.repl$evaluate_form.invokeStatic(repl.cljc:569)
	at cljs.repl$evaluate_form.invoke(repl.cljc:499)
	at cider.piggieback$eval_cljs.invokeStatic(piggieback.clj:208)
	at cider.piggieback$eval_cljs.invoke(piggieback.clj:207)
	at cider.piggieback$do_eval$fn__1599.invoke(piggieback.clj:244)
	at clojure.lang.AFn.applyToHelper(AFn.java:152)
	at clojure.lang.AFn.applyTo(AFn.java:144)
	at clojure.core$apply.invokeStatic(core.clj:665)
	at clojure.core$with_bindings_STAR_.invokeStatic(core.clj:1973)
	at clojure.core$with_bindings_STAR_.doInvoke(core.clj:1973)
	at clojure.lang.RestFn.invoke(RestFn.java:425)
	at cider.piggieback$do_eval.invokeStatic(piggieback.clj:221)
	at cider.piggieback$do_eval.invoke(piggieback.clj:220)
	at cider.piggieback$evaluate.invokeStatic(piggieback.clj:267)
	at cider.piggieback$evaluate.invoke(piggieback.clj:265)
	at clojure.lang.Var.invoke(Var.java:384)
	at cider.piggieback$wrap_cljs_repl$fn__1615$fn__1618$fn__1619.invoke(piggieback.clj:299)
	at cider.piggieback$enqueue$fn__1585.invoke(piggieback.clj:191)
	at clojure.lang.AFn.run(AFn.java:22)
	at nrepl.middleware.session$session_exec$main_loop__1022$fn__1026.invoke(session.clj:171)
	at nrepl.middleware.session$session_exec$main_loop__1022.invoke(session.clj:170)
	at clojure.lang.AFn.run(AFn.java:22)
	at java.lang.Thread.run(Thread.java:748)
class java.lang.NullPointerException</pre></z><z id="t1561403062" t="pez That repl server is started like so: lein update-in :dependencies conj &quot;[nrepl \&quot;0.6.0\&quot;]&quot; -- update-in :dependencies conj &quot;[cider/piggieback \&quot;0.4.1\&quot;]&quot; -- update-in :dependencies conj &quot;[figwheel-sidecar \&quot;0.5.18\&quot;]&quot; -- update-in :plugins conj &quot;[cider/cider-nrepl \&quot;0.21.1\&quot;]&quot; -- update-in &quot;[:repl-options :nrepl-middleware]&quot; conj &quot;[\&quot;cider.nrepl/cider-middleware\&quot;]&quot; -- update-in &quot;[:repl-options :nrepl-middleware]&quot; conj &quot;[\&quot;cider.piggieback/wrap-cljs-repl\&quot;]&quot; -- with-profile +dev repl :headless"><y>#</y><d>2019-06-24</d><h>19:04</h><w>pez</w>That repl server is started like so: <pre>lein update-in :dependencies conj &quot;[nrepl \&quot;0.6.0\&quot;]&quot; -- update-in :dependencies conj &quot;[cider/piggieback \&quot;0.4.1\&quot;]&quot; -- update-in :dependencies conj &quot;[figwheel-sidecar \&quot;0.5.18\&quot;]&quot; -- update-in :plugins conj &quot;[cider/cider-nrepl \&quot;0.21.1\&quot;]&quot; -- update-in &quot;[:repl-options :nrepl-middleware]&quot; conj &quot;[\&quot;cider.nrepl/cider-middleware\&quot;]&quot; -- update-in &quot;[:repl-options :nrepl-middleware]&quot; conj &quot;[\&quot;cider.piggieback/wrap-cljs-repl\&quot;]&quot; -- with-profile +dev repl :headless</pre></z><z id="t1561461690" t="bozhidar [:attrs {:href &quot;/_/_/users/U0ETXRFEW&quot;}] Iâ€™m reasonably certain that after you clone the piggieback session it goes back to being a plain nREPL session."><y>#</y><d>2019-06-25</d><h>11:21</h><w>bozhidar</w><a>@pez</a> Iâ€™m reasonably certain that after you clone the piggieback session it goes back to being a plain nREPL session.</z><z id="t1561461805" t="bozhidar Inspecting the session bindings would answer this for certain. Btw, does this work for other cljs REPL types - e.g. a node or nashorn repl?"><y>#</y><d>2019-06-25</d><h>11:23</h><w>bozhidar</w>Inspecting the session bindings would answer this for certain. Btw, does this work for other cljs REPL types - e.g. a node or nashorn repl?</z><z id="t1561462886" t="galvs Hi all. Im running an embedded nrepl inside a mixed java/clojure project. Is there anyway to expose a user.clj or equivalent for some start/reset/stop functions?"><y>#</y><d>2019-06-25</d><h>11:41</h><w>galvs</w>Hi all. Im running an embedded nrepl inside a mixed java/clojure project. Is there anyway to expose a user.clj or equivalent for some start/reset/stop functions?</z><z id="t1561468352" t="pez [:attrs {:href &quot;/_/_/users/U051BLM8F&quot;}] : I have a feeling it might not work with nashorn, because that would explain some of the problems i ran into when trying to reproduce some funky nrepl stuff a while ago. However, it does work with lein-figwheel, Figwheel Main, and shadow-cljs, which is why I have assumed I am doing things right... (They do not revert back to plain anything.)"><y>#</y><d>2019-06-25</d><h>13:12</h><w>pez</w><a>@bozhidar</a>: I have a feeling it might not work with nashorn, because that would explain some of the problems i ran into when trying to reproduce some funky nrepl stuff a while ago. However, it does work with lein-figwheel, Figwheel Main, and shadow-cljs, which is why I have assumed I am doing things right... (They do not revert back to plain anything.)</z><z id="t1561468418" t="pez So, maybe I should instead clone the clj repl and promote that one each time?"><y>#</y><d>2019-06-25</d><h>13:13</h><w>pez</w>So, maybe I should instead clone the clj repl and promote that one each time?</z><z id="t1561468481" t="bozhidar &gt; So, maybe I should instead clone the clj repl and promote that one each time?"><y>#</y><d>2019-06-25</d><h>13:14</h><w>bozhidar</w>&gt; So, maybe I should instead clone the clj repl and promote that one each time?</z><z id="t1561468495" t="bozhidar Probably. Iâ€™m certain this will work."><y>#</y><d>2019-06-25</d><h>13:14</h><w>bozhidar</w>Probably. Iâ€™m certain this will work.</z><z id="t1561468506" t="pez Is that how CIDER does it?"><y>#</y><d>2019-06-25</d><h>13:15</h><w>pez</w>Is that how CIDER does it?</z><z id="t1561468510" t="bozhidar CIDER never clones any existing sessions, so I never played much with this."><y>#</y><d>2019-06-25</d><h>13:15</h><w>bozhidar</w>CIDER never clones any existing sessions, so I never played much with this.</z><z id="t1561468520" t="pez Interesting."><y>#</y><d>2019-06-25</d><h>13:15</h><w>pez</w>Interesting.</z><z id="t1561468560" t="bozhidar I think you should at least open a ticket about this on nREPL (or piggiebackâ€™s repo), so we would investigate this further at some point."><y>#</y><d>2019-06-25</d><h>13:16</h><w>bozhidar</w>I think you should at least open a ticket about this on nREPL (or piggiebackâ€™s repo), so we would investigate this further at some point.</z><z id="t1561468591" t="pez I&apos;ll do that. What session bindings should I inspect?"><y>#</y><d>2019-06-25</d><h>13:16</h><w>pez</w>I&apos;ll do that. What session bindings should I inspect?</z><z id="t1561468594" t="bozhidar Close is supposed to clone most session bindings, but I donâ€™t remember which one exactly."><y>#</y><d>2019-06-25</d><h>13:16</h><w>bozhidar</w>Close is supposed to clone most session bindings, but I donâ€™t remember which one exactly.</z><z id="t1561468779" t="pez I&apos;ll inspect some bindings and see if I can figure it out. ðŸ˜ƒ"><y>#</y><d>2019-06-25</d><h>13:19</h><w>pez</w>I&apos;ll inspect some bindings and see if I can figure it out. <b>ðŸ˜ƒ</b></z><z id="t1561468851" t="pez I was certain that starting off with cloning the session you get when you connect was the way you should do it. So how does CIDER do these things?"><y>#</y><d>2019-06-25</d><h>13:20</h><w>pez</w>I was certain that starting off with cloning the session you get when you connect was the way you should do it. So how does CIDER do these things?</z><z id="t1561468879" t="bozhidar *cljs-repl-env* this one for instance."><y>#</y><d>2019-06-25</d><h>13:21</h><w>bozhidar</w><code>*cljs-repl-env* </code> this one for instance.</z><z id="t1561469029" t="bozhidar Just pull those from the session like this https://github.com/clojure-emacs/cider-nrepl/blob/master/src/cider/nrepl/middleware/util/cljs.clj#L53"><y>#</y><d>2019-06-25</d><h>13:23</h><w>bozhidar</w>Just pull those from the session like this <a href="https://github.com/clojure-emacs/cider-nrepl/blob/master/src/cider/nrepl/middleware/util/cljs.clj#L53" target="_blank">https://github.com/clojure-emacs/cider-nrepl/blob/master/src/cider/nrepl/middleware/util/cljs.clj#L53</a></z><z id="t1561469046" t="bozhidar &gt; I was certain that starting off with cloning the session you get when you connect was the way you should do it."><y>#</y><d>2019-06-25</d><h>13:24</h><w>bozhidar</w>&gt; I was certain that starting off with cloning the session you get when you connect was the way you should do it.</z><z id="t1561469105" t="bozhidar CIDER sets up two basic sessions for each logical connection - one for evaluations and one for everything else (aka the tooling session). The second is cloned from the first."><y>#</y><d>2019-06-25</d><h>13:25</h><w>bozhidar</w>CIDER sets up two basic sessions for each logical connection - one for evaluations and one for everything else (aka the tooling session). The second is cloned from the first.</z><z id="t1561469183" t="bozhidar They can be upgraded to ClojureScript later if needed, but we always start off with Clojure sessions."><y>#</y><d>2019-06-25</d><h>13:26</h><w>bozhidar</w>They can be upgraded to ClojureScript later if needed, but we always start off with Clojure sessions.</z><z id="t1561469203" t="bozhidar I think thatâ€™s most historical. When the project was created ClojureScript simply didnâ€™t exist."><y>#</y><d>2019-06-25</d><h>13:26</h><w>bozhidar</w>I think thatâ€™s most historical. When the project was created ClojureScript simply didnâ€™t exist.</z><z id="t1561529453" t="pez I&apos;m not sure how to pull those from the session. I can&apos;t evaluate anything in it. Which is very different from if it was just a plain session again. It is instead something in between..."><y>#</y><d>2019-06-26</d><h>06:10</h><w>pez</w>I&apos;m not sure how to pull those from the session. I can&apos;t evaluate anything in it. Which is very different from if it was just a plain session again. It is instead something in between...</z><z id="t1561533544" t="pez I created this issue, [:attrs {:href &quot;/_/_/users/U051BLM8F&quot;}] : https://github.com/nrepl/piggieback/issues/105"><y>#</y><d>2019-06-26</d><h>07:19</h><w>pez</w>I created this issue, <a>@bozhidar</a>: <a href="https://github.com/nrepl/piggieback/issues/105" target="_blank">https://github.com/nrepl/piggieback/issues/105</a></z><z id="t1561533573" t="pez Please let me know if it needs more/different info."><y>#</y><d>2019-06-26</d><h>07:19</h><w>pez</w>Please let me know if it needs more/different info.</z><z id="t1561537795" t="bozhidar [:attrs {:href &quot;/_/_/users/U0ETXRFEW&quot;}] Thanks!"><y>#</y><d>2019-06-26</d><h>08:29</h><w>bozhidar</w><a>@pez</a> Thanks!</z><z id="t1561537807" t="bozhidar &gt; Hi all. Im running an embedded nrepl inside a mixed java/clojure project. Is there anyway to expose a user.clj or equivalent for some start/reset/stop functions?"><y>#</y><d>2019-06-26</d><h>08:30</h><w>bozhidar</w>&gt; Hi all. Im running an embedded nrepl inside a mixed java/clojure project. Is there anyway to expose a user.clj or equivalent for some start/reset/stop functions?</z><z id="t1561537824" t="bozhidar [:attrs {:href &quot;/_/_/users/U0NBD9UBB&quot;}] Iâ€™m not quite sure what you need to do so a bit more context would be useful."><y>#</y><d>2019-06-26</d><h>08:30</h><w>bozhidar</w><a>@galvs</a> Iâ€™m not quite sure what you need to do so a bit more context would be useful.</z><z id="t1562088341" t="nwjsmith https://clojurians.slack.com/archives/C0617A8PQ/p1562088112489600"><y>#</y><d>2019-07-02</d><h>17:25</h><w>nwjsmith</w><a href="https://clojurians.slack.com/archives/C0617A8PQ/p1562088112489600" target="_blank">https://clojurians.slack.com/archives/C0617A8PQ/p1562088112489600</a></z><z id="t1562617892" t="mkarp Hey everyone! I&apos;ve got a newcomer question. In an nREPL middleware, is there a way to determine if a message came from an nREPL client with an active ClojureScript session? What I&apos;m trying to do: every time I evaluate ClojureScript code in an editor, I would like to call Reagent&apos;s reload function. Here&apos;s the trick I came up with https://github.com/mkarp/cljs-nrepl-exercise/blob/master/src/cljs_test/nrepl_middleware.clj#L8 . It works in my case, however some nREPL clients do not provide :file in the message they send. Any ideas how to improve it are appreciated ðŸ™"><y>#</y><d>2019-07-08</d><h>20:31</h><w>mkarp</w>Hey everyone! I&apos;ve got a newcomer question. In an nREPL middleware, is there a way to determine if a message came from an nREPL client with an active ClojureScript session? What I&apos;m trying to do: every time I evaluate ClojureScript code in an editor, I would like to call Reagent&apos;s reload function. Here&apos;s the trick I came up with <a href="https://github.com/mkarp/cljs-nrepl-exercise/blob/master/src/cljs_test/nrepl_middleware.clj#L8" target="_blank">https://github.com/mkarp/cljs-nrepl-exercise/blob/master/src/cljs_test/nrepl_middleware.clj#L8</a>. It works in my case, however some nREPL clients do not provide <code>:file</code> in the message they send. Any ideas how to improve it are appreciated <b>ðŸ™</b></z><z id="t1562652641" t="bozhidar [:attrs {:href &quot;/_/_/users/U9ES37CSZ&quot;}] You can just check the session bindings. You can check there for cider.piggieback/*cljs-compiler-env* ."><y>#</y><d>2019-07-09</d><h>06:10</h><w>bozhidar</w><a>@me1676</a> You can just check the session bindings. You can check there for <code>cider.piggieback/*cljs-compiler-env*</code>.</z><z id="t1562652685" t="bozhidar &gt; however some nREPL clients do not provide :file in the message they send. Any ideas how to improve it are appreciated"><y>#</y><d>2019-07-09</d><h>06:11</h><w>bozhidar</w>&gt; however some nREPL clients do not provide <code>:file</code> in the message they send. Any ideas how to improve it are appreciated</z><z id="t1562652706" t="bozhidar Keep in mind that you can have evaluations without a file anyways - e.g. those coming from a REPL."><y>#</y><d>2019-07-09</d><h>06:11</h><w>bozhidar</w>Keep in mind that you can have evaluations without a file anyways - e.g. those coming from a REPL.</z><z id="t1562674033" t="mkarp [:attrs {:href &quot;/_/_/users/U051BLM8F&quot;}] Thank you! I&apos;ll try it out"><y>#</y><d>2019-07-09</d><h>12:07</h><w>mkarp</w><a>@bozhidar</a> Thank you! I&apos;ll try it out</z><z id="t1563494154" t="phreed What is needed to start nrepl server in a java program? "><y>#</y><d>2019-07-18</d><h>23:55</h><w>phreed</w>What is needed to start nrepl server in a java program? </z><z id="t1563525432" t="bozhidar [:attrs {:href &quot;/_/_/users/U0XTHMGMP&quot;}] See https://github.com/nrepl/nrepl/blob/master/src/java/nrepl/main.java"><y>#</y><d>2019-07-19</d><h>08:37</h><w>bozhidar</w><a>@phreed</a> See <a href="https://github.com/nrepl/nrepl/blob/master/src/java/nrepl/main.java" target="_blank">https://github.com/nrepl/nrepl/blob/master/src/java/nrepl/main.java</a></z><z id="t1563558316" t="phreed [:attrs {:href &quot;/_/_/users/U051BLM8F&quot;}] I am having a problem running that.. java.lang.ExceptionInInitializerError at clojure.lang.RT.baseLoader(RT.java:2179) at clojure.lang.RT.load(RT.java:432) at clojure.lang.RT.load(RT.java:424) at clojure.lang.RT.&lt;clinit&gt;(RT.java:338) at edu.vanderbilt.isis.MdInspectPlugin.init(MdInspectPlugin.java:58) at com.nomagic.magicdraw.plugins.q.b(q.java:721) ...etc... at com.nomagic.launcher.Launcher.main(Launcher.java:70) Caused by: java.lang.ClassCastException: org.eclipse.osgi.internal.framework.EquinoxConfiguration$1 cannot be cast to java.lang.String at clojure.lang.Compiler.&lt;clinit&gt;(Compiler.java:274) The context is that this is being run as part of a plugin in a modeling tool (MagicDraw). The failing code at line 58 is: RT.var(&quot;clojure.core&quot;, &quot;require&quot;) .invoke(Symbol.intern(&quot;nrepl.cmdline&quot;)); "><y>#</y><d>2019-07-19</d><h>17:45</h><w>phreed</w><a>@bozhidar</a> I am having a problem running that..
<pre>java.lang.ExceptionInInitializerError
	at clojure.lang.RT.baseLoader(RT.java:2179)
	at clojure.lang.RT.load(RT.java:432)
	at clojure.lang.RT.load(RT.java:424)
	at clojure.lang.RT.&lt;clinit&gt;(RT.java:338)
	at edu.vanderbilt.isis.MdInspectPlugin.init(MdInspectPlugin.java:58)
	at com.nomagic.magicdraw.plugins.q.b(q.java:721)
...etc...
	at com.nomagic.launcher.Launcher.main(Launcher.java:70)
Caused by: java.lang.ClassCastException: org.eclipse.osgi.internal.framework.EquinoxConfiguration$1 cannot be cast to java.lang.String
	at clojure.lang.Compiler.&lt;clinit&gt;(Compiler.java:274)
</pre>
The context is that this is being run as part of a plugin in a modeling tool (MagicDraw).
The failing code at line 58 is:
<pre>RT.var(&quot;clojure.core&quot;, &quot;require&quot;)
                .invoke(Symbol.intern(&quot;nrepl.cmdline&quot;));
</pre></z><z id="t1563559339" t="phreed I have also tried this style http://clojure.github.io/clojure/javadoc/clojure/java/api/package-summary.html with similar results. final IFn plus = Clojure.var(&quot;clojure.core&quot;, &quot;+&quot;); "><y>#</y><d>2019-07-19</d><h>18:02</h><r>phreed</r>I have also tried this style <a href="http://clojure.github.io/clojure/javadoc/clojure/java/api/package-summary.html" target="_blank">http://clojure.github.io/clojure/javadoc/clojure/java/api/package-summary.html</a> with similar results.
<pre>final IFn plus = Clojure.var(&quot;clojure.core&quot;, &quot;+&quot;);
</pre></z><z id="t1563560101" t="phreed I think I see the problem. https://github.com/clojure/clojure/blob/master/src/jvm/clojure/lang/Compiler.java#L274 The value of some of the system properties is null."><y>#</y><d>2019-07-19</d><h>18:15</h><r>phreed</r>I think I see the problem. <a href="https://github.com/clojure/clojure/blob/master/src/jvm/clojure/lang/Compiler.java#L274" target="_blank">https://github.com/clojure/clojure/blob/master/src/jvm/clojure/lang/Compiler.java#L274</a>
The value of some of the system properties is null.</z><z id="t1563562898" t="phreed Here is the code that seems to work for me: public void init() { (&quot;init for plugin&quot;); for (Map.Entry entry : System.getProperties().entrySet()) { String name = (String) entry.getKey(); try { String value = (String) entry.getValue(); (&quot;key: {}, value: {}&quot;, name, value); } catch (ClassCastException ex) { //javax.swing.JOptionPane.showMessageDialog( // null, // entry.getKey().toString() + &quot; : &quot; + entry.getValue().toString()); entry.setValue(&quot;&quot;); (&quot;key: {}, null value&quot;, name); } } // (clojure.core/+ 1 2) final IFn plus = Clojure.var(&quot;clojure.core&quot;, &quot;+&quot;); final Object object = plus.invoke(1, 2); log.debug(&quot;plus invoked, result was: {}&quot;, object); // (clojure.core/require clojure.tools.nrepl.server) final IFn require = Clojure.var(&quot;clojure.core&quot;, &quot;require&quot;); require.invoke(Clojure.read(&quot;nrepl.server&quot;)); // (clojure.tools.nrepl.server/start-server :port 12000) final IFn server = Clojure.var(&quot;nrepl.server&quot;, &quot;start-server&quot;); server.invoke(Clojure.read(&quot;:port&quot;), Clojure.read(&quot;12000&quot;)); I needed the following dependencies: implementation(group=&quot;org.clojure&quot;, name=&quot;clojure&quot;, version=clojure_version) implementation(group=&quot;org.clojure&quot;, name=&quot;spec.alpha&quot;, version=spec_version) implementation(group=&quot;org.clojure&quot;, name=&quot;core.specs.alpha&quot;, version=core_specs_version) implementation(group=&quot;nrepl&quot;, name=&quot;nrepl&quot;, version=nrepl_version) "><y>#</y><d>2019-07-19</d><h>19:01</h><r>phreed</r>Here is the code that seems to work for me:
<pre>public void init()
    {
        (&quot;init for plugin&quot;);
        for (Map.Entry entry : System.getProperties().entrySet())
        {
            String name = (String) entry.getKey();
            try
            {
                String value = (String) entry.getValue();
                (&quot;key: {}, value: {}&quot;, name, value);
            } catch (ClassCastException ex) {
                //javax.swing.JOptionPane.showMessageDialog(
                //        null,
                //        entry.getKey().toString() + &quot; : &quot; + entry.getValue().toString());
                entry.setValue(&quot;&quot;);
                (&quot;key: {}, null value&quot;, name);
            }

        }

        // (clojure.core/+ 1 2)
        final IFn plus = Clojure.var(&quot;clojure.core&quot;, &quot;+&quot;);
        final Object object = plus.invoke(1, 2);

        log.debug(&quot;plus invoked, result was: {}&quot;, object);

        // (clojure.core/require clojure.tools.nrepl.server)
        final IFn require = Clojure.var(&quot;clojure.core&quot;, &quot;require&quot;);
        require.invoke(Clojure.read(&quot;nrepl.server&quot;));

        // (clojure.tools.nrepl.server/start-server :port 12000)
        final IFn server = Clojure.var(&quot;nrepl.server&quot;, &quot;start-server&quot;);
        server.invoke(Clojure.read(&quot;:port&quot;), Clojure.read(&quot;12000&quot;));
</pre>
I needed the following dependencies:
<pre>implementation(group=&quot;org.clojure&quot;, name=&quot;clojure&quot;, version=clojure_version)
    implementation(group=&quot;org.clojure&quot;, name=&quot;spec.alpha&quot;, version=spec_version)
    implementation(group=&quot;org.clojure&quot;, name=&quot;core.specs.alpha&quot;, version=core_specs_version)
	implementation(group=&quot;nrepl&quot;, name=&quot;nrepl&quot;, version=nrepl_version)
</pre></z><z id="t1563562959" t="phreed Note that I needed both core.specs.alpha and spec.alpha."><y>#</y><d>2019-07-19</d><h>19:02</h><r>phreed</r>Note that I needed both core.specs.alpha and spec.alpha.</z><z id="t1566003030" t="cfleming Iâ€™d like to be able to send arbitrary messages back from my nREPL server process to the client. Any suggestions for how to handle this?"><y>#</y><d>2019-08-17</d><h>00:50</h><w>cfleming</w>Iâ€™d like to be able to send arbitrary messages back from my nREPL server process to the client. Any suggestions for how to handle this?</z><z id="t1566003110" t="cfleming Currently the way this works in Cursive is that for a particular evaluation, I register a handler which handles values, out &amp; err, errors etc, and associate the handler with the eval ID. When the eval is done I remove the handler so they donâ€™t hang around forever."><y>#</y><d>2019-08-17</d><h>00:51</h><w>cfleming</w>Currently the way this works in Cursive is that for a particular evaluation, I register a handler which handles values, out &amp; err, errors etc, and associate the handler with the eval ID. When the eval is done I remove the handler so they donâ€™t hang around forever.</z><z id="t1566003199" t="cfleming However this doesnâ€™t work very well for some use cases. For example, when working with CLJS when an eval results in a promise it would be nice to be able to send that value back to the client when the promise is fulfilled, but by that time the original evaluation is probably done and the handler will have been cleaned up."><y>#</y><d>2019-08-17</d><h>00:53</h><w>cfleming</w>However this doesnâ€™t work very well for some use cases. For example, when working with CLJS when an eval results in a promise it would be nice to be able to send that value back to the client when the promise is fulfilled, but by that time the original evaluation is probably done and the handler will have been cleaned up.</z><z id="t1566003272" t="cfleming I donâ€™t want to keep all handlers around forever, but Iâ€™m not sure what a good expiry policy would be for them. Keep them around for n seconds? Keep the latest 100 around and expire them in a LRU fashion? Iâ€™m not sure."><y>#</y><d>2019-08-17</d><h>00:54</h><w>cfleming</w>I donâ€™t want to keep all handlers around forever, but Iâ€™m not sure what a good expiry policy would be for them. Keep them around for n seconds? Keep the latest 100 around and expire them in a LRU fashion? Iâ€™m not sure.</z><z id="t1566003326" t="cfleming This is also an issue with Clojure if an eval spins up a new thread."><y>#</y><d>2019-08-17</d><h>00:55</h><w>cfleming</w>This is also an issue with Clojure if an eval spins up a new thread.</z><z id="t1566017464" t="dominicm Cider provides middleware for this I think."><y>#</y><d>2019-08-17</d><h>04:51</h><w>dominicm</w>Cider provides middleware for this I think.</z><z id="t1566024324" t="bozhidar &gt; Currently the way this works in Cursive is that for a particular evaluation, I register a handler which handles values, out &amp; err, errors etc, and associate the handler with the eval ID. When the eval is done I remove the handler so they donâ€™t hang around forever."><y>#</y><d>2019-08-17</d><h>06:45</h><w>bozhidar</w>&gt; Currently the way this works in Cursive is that for a particular evaluation, I register a handler which handles values, out &amp; err, errors etc, and associate the handler with the eval ID. When the eval is done I remove the handler so they donâ€™t hang around forever.</z><z id="t1566024603" t="bozhidar [:attrs {:href &quot;/_/_/users/U0567Q30W&quot;}] CIDER operates similarly. I just remove the handlers when a message is :done and fallback to a default handler for responses that come for messages without a removed handler. Iâ€™ve been meaning to improve this for ages, but I never got to doing so."><y>#</y><d>2019-08-17</d><h>06:50</h><w>bozhidar</w><a>@cfleming</a> CIDER operates similarly. I just remove the handlers when a message is <code>:done</code> and fallback to a default handler for responses that come for messages without a removed handler. Iâ€™ve been meaning to improve this for ages, but I never got to doing so.</z><z id="t1566024624" t="bozhidar &gt; Keep the latest 100 around and expire them in a LRU fashion?"><y>#</y><d>2019-08-17</d><h>06:50</h><w>bozhidar</w>&gt; Keep the latest 100 around and expire them in a LRU fashion?</z><z id="t1566024653" t="bozhidar Iâ€™d probably go with this one, although I doubt youâ€™ll need more than the last 10."><y>#</y><d>2019-08-17</d><h>06:50</h><w>bozhidar</w>Iâ€™d probably go with this one, although I doubt youâ€™ll need more than the last 10.</z><z id="t1566024854" t="bozhidar &gt; Cider provides middleware for this I think. No, the handlers are purely a client concern. Every client decides themselves how to track responses and react to them - a handler in CIDER is just several lambdas that act on value , err , out , etc for a particular message id."><y>#</y><d>2019-08-17</d><h>06:54</h><w>bozhidar</w>&gt; Cider provides middleware for this I think.

No, the handlers are purely a client concern. Every client decides themselves how to track responses and react to them - a handler in CIDER is just several lambdas that act on <code>value</code>, <code>err</code>, <code>out</code>, etc for a particular message id.</z><z id="t1566028235" t="bozhidar &gt; Iâ€™d like to be able to send arbitrary messages back from my nREPL server process to the client. Any suggestions for how to handle this?"><y>#</y><d>2019-08-17</d><h>07:50</h><w>bozhidar</w>&gt; Iâ€™d like to be able to send arbitrary messages back from my nREPL server process to the client. Any suggestions for how to handle this?</z><z id="t1566028246" t="bozhidar Can you elaborate on this? Some example would be useful."><y>#</y><d>2019-08-17</d><h>07:50</h><w>bozhidar</w>Can you elaborate on this? Some example would be useful.</z><z id="t1566028283" t="bozhidar I assume you want to associate some extra data with the requests and it would be attached to the responses, but Iâ€™m not quite certain I got this right."><y>#</y><d>2019-08-17</d><h>07:51</h><w>bozhidar</w>I assume you want to associate some extra data with the requests and it would be attached to the responses, but Iâ€™m not quite certain I got this right.</z><z id="t1566032091" t="dominicm Maybe I misunderstood, I thought he was after wrap-out"><y>#</y><d>2019-08-17</d><h>08:54</h><w>dominicm</w>Maybe I misunderstood, I thought he was after wrap-out</z><z id="t1566032280" t="pez What is wrap-out? Sounds like something I&apos;ve been out looking for..."><y>#</y><d>2019-08-17</d><h>08:58</h><w>pez</w>What is wrap-out? Sounds like something I&apos;ve been out looking for...</z><z id="t1566033233" t="bozhidar [:attrs {:href &quot;/_/_/users/U0ETXRFEW&quot;}] Output redirection middleware https://github.com/clojure-emacs/cider-nrepl/blob/master/src/cider/nrepl/middleware/out.clj"><y>#</y><d>2019-08-17</d><h>09:13</h><w>bozhidar</w><a>@pez</a> Output redirection middleware <a href="https://github.com/clojure-emacs/cider-nrepl/blob/master/src/cider/nrepl/middleware/out.clj" target="_blank">https://github.com/clojure-emacs/cider-nrepl/blob/master/src/cider/nrepl/middleware/out.clj</a></z><z id="t1566033279" t="bozhidar It ensure that output doesnâ€™t end up in the server terminal instead of the userâ€™s REPL/code buffer."><y>#</y><d>2019-08-17</d><h>09:14</h><w>bozhidar</w>It ensure that output doesnâ€™t end up in the server terminal instead of the userâ€™s REPL/code buffer.</z><z id="t1566033358" t="pez &gt; It ensure that output doesnâ€™t end up in the server terminal instead of the userâ€™s REPL/code buffer. So I was out looking for this! ðŸ˜„"><y>#</y><d>2019-08-17</d><h>09:15</h><w>pez</w>&gt; It ensure that output doesnâ€™t end up in the server terminal instead of the userâ€™s REPL/code buffer.
So I was out looking for this! <b>ðŸ˜„</b></z><z id="t1566131688" t="Daniel Slutsky Hi All. Out of the existing nREPL clients ( https://nrepl.org/nrepl/0.6.0/usage/clients.html ) (not just the Clojure ones), I am looking for a client that could be considered a good example to learn from -- preferably a rather simple one, that was written recently, and is know to be designed well. ðŸ™‚ My goal is to understand the existing R client ( https://github.com/vspinu/R-nREPL ), and see if I want to change anything and rewrite some parts. I am doing that in order to allow RStudio to behave as a Clojure IDE. So, I thought it would be nice to have an example client to learn from. Any ideas?"><y>#</y><d>2019-08-18</d><h>12:34</h><w>Daniel Slutsky</w>Hi All.

Out of the existing nREPL clients (<a href="https://nrepl.org/nrepl/0.6.0/usage/clients.html" target="_blank">https://nrepl.org/nrepl/0.6.0/usage/clients.html</a>) (not just the Clojure ones), I am looking for a client that could be considered a good example to learn from -- preferably a rather simple one, that was written recently, and is know to be designed well. <b>ðŸ™‚</b>

My goal is to understand the existing R client (<a href="https://github.com/vspinu/R-nREPL" target="_blank">https://github.com/vspinu/R-nREPL</a>), and see if I want to change anything and rewrite some parts. I am doing that in order to allow RStudio to behave as a Clojure IDE.

So, I thought it would be nice to have an example client to learn from.

Any ideas?</z><z id="t1566131957" t="Daniel Slutsky (Maybe Monroe or REPL-y would be considerably simple examples to learn from? Any other ideas?)"><y>#</y><d>2019-08-18</d><h>12:39</h><w>Daniel Slutsky</w>(Maybe Monroe or REPL-y would be considerably simple examples to learn from? Any other ideas?)</z><z id="t1566136799" t="pez I think the one in Calva is pretty well designed and reasonably simple. It&apos;s definitely recently written. ðŸ˜Ž (I&apos;m not the designer of it, so my bias there isn&apos;t too strong. But it is easy to use, is my experience.)"><y>#</y><d>2019-08-18</d><h>13:59</h><w>pez</w>I think the one in Calva is pretty well designed and reasonably simple. It&apos;s definitely recently written. <b>ðŸ˜Ž</b> (I&apos;m not the designer of it, so my bias there isn&apos;t too strong. But it is easy to use, is my experience.)</z><z id="t1566137329" t="Daniel Slutsky Thanks [:attrs {:href &quot;/_/_/users/U0ETXRFEW&quot;}] , this helps so much!"><y>#</y><d>2019-08-18</d><h>14:08</h><w>Daniel Slutsky</w>Thanks <a>@pez</a>, this helps so much!</z><z id="t1566144478" t="Daniel Slutsky Also, the built-in nREPL client implementation is quite readable! https://github.com/nrepl/nrepl/blob/master/src/clojure/nrepl/core.clj (just a basic client)"><y>#</y><d>2019-08-18</d><h>16:07</h><w>Daniel Slutsky</w>Also, the built-in nREPL client implementation is quite readable!
<a href="https://github.com/nrepl/nrepl/blob/master/src/clojure/nrepl/core.clj" target="_blank">https://github.com/nrepl/nrepl/blob/master/src/clojure/nrepl/core.clj</a>
(just a basic client)</z><z id="t1566144979" t="bozhidar Yeah, Iâ€™d say itâ€™s a classic. ðŸ™‚"><y>#</y><d>2019-08-18</d><h>16:16</h><w>bozhidar</w>Yeah, Iâ€™d say itâ€™s a classic. <b>ðŸ™‚</b></z><z id="t1566455355" t="pez If I get back a message with printed-value in it. Am I using some old nrepl stuff? I remember looking at this quite long ago and thought I learnt that that behaviour had been changed..."><y>#</y><d>2019-08-22</d><h>06:29</h><w>pez</w>If I get back a message with <code>printed-value</code> in it. Am I using some old nrepl stuff? I remember looking at this quite long ago and thought I learnt that that behaviour had been changed...</z><z id="t1566455857" t="pez Also the out message comes in a separate session than the eval where I printed. And with an old id . This is shadow-cljs which I start like so: npx shadow-cljs -d cider/cider-nrepl:0.21.1 watch :app"><y>#</y><d>2019-08-22</d><h>06:37</h><w>pez</w>Also the <code>out</code> message comes in a separate session than the <code>eval</code> where I printed. And with an old <code>id</code>. This is shadow-cljs which I start like so: <pre>npx shadow-cljs -d cider/cider-nrepl:0.21.1 watch :app</pre></z><z id="t1566456246" t="bozhidar I think piggieback still returns it in its responses. Or at least it did up to some version."><y>#</y><d>2019-08-22</d><h>06:44</h><w>bozhidar</w>I think piggieback still returns it in its responses. Or at least it did up to some version.</z><z id="t1566456278" t="bozhidar See https://github.com/nrepl/piggieback/pull/108"><y>#</y><d>2019-08-22</d><h>06:44</h><w>bozhidar</w>See <a href="https://github.com/nrepl/piggieback/pull/108" target="_blank">https://github.com/nrepl/piggieback/pull/108</a></z><z id="t1566456662" t="pez But why would the out come with an old message id ?"><y>#</y><d>2019-08-22</d><h>06:51</h><w>pez</w>But why would the <code>out</code> come with an old message <code>id</code>?</z><z id="t1566458059" t="dominicm Wrap-out"><y>#</y><d>2019-08-22</d><h>07:14</h><w>dominicm</w>Wrap-out</z><z id="t1566458106" t="dominicm Or threads"><y>#</y><d>2019-08-22</d><h>07:15</h><w>dominicm</w>Or threads</z><z id="t1566465739" t="pez Does that mean that shadow is wrapping or threading it? Where should I be looking for a way to solve the problem, I guess I am asking. ðŸ˜ƒ"><y>#</y><d>2019-08-22</d><h>09:22</h><w>pez</w>Does that mean that shadow is wrapping or threading it? Where should I be looking for a way to solve the problem, I guess I am asking. <b>ðŸ˜ƒ</b></z><z id="t1566465961" t="dominicm There was a bug in Figwheel for a while where it processed messages by taking an initial copy of the thread locals and processing them in a separate thread. This would cause the message id to be an older one, but a fixed older one."><y>#</y><d>2019-08-22</d><h>09:26</h><w>dominicm</w>There was a bug in Figwheel for a while where it processed messages by taking an initial copy of the thread locals and processing them in a separate thread. This would cause the message id to be an older one, but a fixed older one.</z><z id="t1566466229" t="pez It is a fixed older one here as well, I think. (At least in my quick testing it is always the same id+session)."><y>#</y><d>2019-08-22</d><h>09:30</h><w>pez</w>It is a fixed older one here as well, I think. (At least in my quick testing it is always the same id+session).</z><z id="t1566466557" t="dominicm Then it sounds like a similar class to me. I&apos;d check shadow&apos;s repl-env implementation"><y>#</y><d>2019-08-22</d><h>09:35</h><w>dominicm</w>Then it sounds like a similar class to me. I&apos;d check shadow&apos;s repl-env implementation</z><z id="t1567090691" t="exit2 HI all, Iâ€™m getting this strange error in my clj/cljs app"><y>#</y><d>2019-08-29</d><h>14:58</h><w>exit2</w>HI all, Iâ€™m getting this strange error in my clj/cljs app</z><z id="t1567090692" t="exit2 Aug 29, 2019 10:56:21 AM clojure.tools.logging$eval18878$fn__18883 invoke SEVERE: [NREPLTunnelServer#1 of [NREPLTunnel#1]] Received a bootstrap timeout from client [WebSocketServerClient#20] : {:op :bootstrap-timeout} "><y>#</y><d>2019-08-29</d><h>14:58</h><w>exit2</w><pre>Aug 29, 2019 10:56:21 AM clojure.tools.logging$eval18878$fn__18883 invoke
SEVERE: [NREPLTunnelServer#1 of [NREPLTunnel#1]] Received a bootstrap timeout from client [WebSocketServerClient#20] :
 {:op :bootstrap-timeout}
</pre></z><z id="t1567149503" t="bozhidar [:attrs {:href &quot;/_/_/users/U3MG3NJCC&quot;}] Iâ€™ve got no idea whatâ€™s an nREPL tunnel server. Iâ€™m pretty sure this is not coming from nREPL itself."><y>#</y><d>2019-08-30</d><h>07:18</h><w>bozhidar</w><a>@njj</a> Iâ€™ve got no idea whatâ€™s an nREPL tunnel server. Iâ€™m pretty sure this is not coming from nREPL itself.</z><z id="t1567152683" t="dominicm I wonder if that&apos;s a cljs devtools thing?"><y>#</y><d>2019-08-30</d><h>08:11</h><w>dominicm</w>I wonder if that&apos;s a cljs devtools thing?</z><z id="t1567152690" t="dominicm They historically had issues with cider"><y>#</y><d>2019-08-30</d><h>08:11</h><w>dominicm</w>They historically had issues with cider</z><z id="t1567152891" t="dominicm Dirac"><y>#</y><d>2019-08-30</d><h>08:14</h><w>dominicm</w>Dirac</z><z id="t1567152914" t="dominicm Yeah, nrepl tunnel is a dirac thing."><y>#</y><d>2019-08-30</d><h>08:15</h><w>dominicm</w>Yeah, nrepl tunnel is a dirac thing.</z><z id="t1567158241" t="bozhidar Good to know."><y>#</y><d>2019-08-30</d><h>09:44</h><w>bozhidar</w>Good to know.</z><z id="t1567168345" t="exit2 Ok thanks guys"><y>#</y><d>2019-08-30</d><h>12:32</h><w>exit2</w>Ok thanks guys</z><z id="t1568225551" t="danboykis anyone have suggestions on how to lock down nrepl server on an app?"><y>#</y><d>2019-09-11</d><h>18:12</h><w>danboykis</w>anyone have suggestions on how to lock down nrepl server on an app?</z><z id="t1568226722" t="bozhidar Lock down in which sense?"><y>#</y><d>2019-09-11</d><h>18:32</h><w>bozhidar</w>Lock down in which sense?</z><z id="t1568226743" t="bozhidar If you just donâ€™t want to allow outside connections itâ€™s usually best to tunnel the connection via ssh."><y>#</y><d>2019-09-11</d><h>18:32</h><w>bozhidar</w>If you just donâ€™t want to allow outside connections itâ€™s usually best to tunnel the connection via ssh.</z><z id="t1568252005" t="danboykis [:attrs {:href &quot;/_/_/users/U051BLM8F&quot;}] i have an app in a docker container and I was thinking have some sort of password or key based auth"><y>#</y><d>2019-09-12</d><h>01:33</h><w>danboykis</w><a>@bozhidar</a> i have an app in a docker container and I was thinking have some sort of password or key based auth</z><z id="t1568252936" t="dpsutton We only start the nrepl server in a dev environment. Not sure if that could help you"><y>#</y><d>2019-09-12</d><h>01:48</h><w>dpsutton</w>We only start the nrepl server in a dev environment. Not sure if that could help you</z><z id="t1568269860" t="bozhidar [:attrs {:href &quot;/_/_/users/U0CME35FV&quot;}] Thereâ€™s no security currently. Some form of auth was discussed in the past, but there was never a lot of demand for it."><y>#</y><d>2019-09-12</d><h>06:31</h><w>bozhidar</w><a>@danboykis</a> Thereâ€™s no security currently. Some form of auth was discussed in the past, but there was never a lot of demand for it.</z><z id="t1568269941" t="bozhidar A simple password-based approach wonâ€™t work, as the nREPL requests are not encrypted."><y>#</y><d>2019-09-12</d><h>06:32</h><w>bozhidar</w>A simple password-based approach wonâ€™t work, as the nREPL requests are not encrypted.</z><z id="t1568622990" t="thheller can any nREPL expert tell me if it is possible for a nREPL middleware to be notified when a nREPL connection is terminated/disconnected?"><y>#</y><d>2019-09-16</d><h>08:36</h><w>thheller</w>can any nREPL expert tell me if it is possible for a nREPL middleware to be notified when a nREPL connection is terminated/disconnected?</z><z id="t1568623001" t="thheller ie. a middleware received a message and started something running in a separate thread. how do I terminate that thread if the underlying nrepl connection closed and no further messages will come?"><y>#</y><d>2019-09-16</d><h>08:36</h><w>thheller</w>ie. a middleware received a message and started something running in a separate thread. how do I terminate that thread if the underlying nrepl connection closed and no further messages will come?</z><z id="t1568623049" t="thheller maybe even better at the session level? or is there no explicit &quot;this session has ended&quot;?"><y>#</y><d>2019-09-16</d><h>08:37</h><w>thheller</w>maybe even better at the session level? or is there no explicit &quot;this session has ended&quot;?</z><z id="t1569399180" t="shen Just had a look through the source, and looks like when a client disconnects, it dies here: https://github.com/nrepl/nrepl/blob/5aca552d2081ef2f7f0410ce18f2436efd7f30e0/src/clojure/nrepl/server.clj#L56"><y>#</y><d>2019-09-25</d><h>08:13</h><r>shen</r>Just had a look through the source, and looks like when a client disconnects, it dies here: <a href="https://github.com/nrepl/nrepl/blob/5aca552d2081ef2f7f0410ce18f2436efd7f30e0/src/clojure/nrepl/server.clj#L56" target="_blank">https://github.com/nrepl/nrepl/blob/5aca552d2081ef2f7f0410ce18f2436efd7f30e0/src/clojure/nrepl/server.clj#L56</a></z><z id="t1569399372" t="shen i&apos;m not aware of any &quot;connection&quot; closed messages"><y>#</y><d>2019-09-25</d><h>08:16</h><r>shen</r>i&apos;m not aware of any &quot;connection&quot; closed messages</z><z id="t1569399451" t="shen though it&apos;s not clear a connection ending is the end of a session."><y>#</y><d>2019-09-25</d><h>08:17</h><r>shen</r>though it&apos;s not clear a connection ending is the end of a session.</z><z id="t1570271439" t="pez Where can I read about how to know when the REPL is waiting for input? Iâ€™m looking at this issue on Calva and realize I donâ€™t know where to even start: https://github.com/BetterThanTomorrow/calva/issues/377"><y>#</y><d>2019-10-05</d><h>10:30</h><w>pez</w>Where can I read about how to know when the REPL is waiting for input? Iâ€™m looking at this issue on Calva and realize I donâ€™t know where to even start: <a href="https://github.com/BetterThanTomorrow/calva/issues/377" target="_blank">https://github.com/BetterThanTomorrow/calva/issues/377</a></z><z id="t1570273778" t="bozhidar [:attrs {:href &quot;/_/_/users/U0ETXRFEW&quot;}] Thereâ€™s a stdin message that gets sent when the REPL is waiting for input."><y>#</y><d>2019-10-05</d><h>11:09</h><w>bozhidar</w><a>@pez</a> Thereâ€™s a <code>stdin</code> message that gets sent when the REPL is waiting for input.</z><z id="t1570273823" t="bozhidar See https://nrepl.org/nrepl/0.6.0/ops.html#_stdin"><y>#</y><d>2019-10-05</d><h>11:10</h><w>bozhidar</w>See <a href="https://nrepl.org/nrepl/0.6.0/ops.html#_stdin" target="_blank">https://nrepl.org/nrepl/0.6.0/ops.html#_stdin</a></z><z id="t1570277191" t="pez Thanks [:attrs {:href &quot;/_/_/users/U051BLM8F&quot;}] . Iâ€™ll add this to the issue and then I hope I get the time to try fix it."><y>#</y><d>2019-10-05</d><h>12:06</h><w>pez</w>Thanks <a>@bozhidar</a>. Iâ€™ll add this to the issue and then I hope I get the time to try fix it.</z><z id="t1570375574" t="pez What can nrepl help me with when it comes to help me drill down the results, w/o having to realize it all, when it is large? Ellisions and that kind of stuff, I guess I am asking about."><y>#</y><d>2019-10-06</d><h>15:26</h><w>pez</w>What can nrepl help me with when it comes to help me drill down the results, w/o having to realize it all, when it is large? Ellisions and that kind of stuff, I guess I am asking about.</z><z id="t1570379909" t="bozhidar [:attrs {:href &quot;/_/_/users/U0ETXRFEW&quot;}] Thereâ€™s an unfinished PR by [:attrs {:href &quot;/_/_/users/U3E46Q1DG&quot;}] that tackles this."><y>#</y><d>2019-10-06</d><h>16:38</h><w>bozhidar</w><a>@pez</a> Thereâ€™s an unfinished PR by <a>@cgrand</a> that tackles this.</z><z id="t1570379915" t="bozhidar See https://github.com/nrepl/nrepl/pull/106"><y>#</y><d>2019-10-06</d><h>16:38</h><w>bozhidar</w>See <a href="https://github.com/nrepl/nrepl/pull/106" target="_blank">https://github.com/nrepl/nrepl/pull/106</a></z><z id="t1570379924" t="bozhidar Weâ€™ll have to wrap this one eventually."><y>#</y><d>2019-10-06</d><h>16:38</h><w>bozhidar</w>Weâ€™ll have to wrap this one eventually.</z><z id="t1570379961" t="pez Cool. I think I have seen work on this reported about in this channel."><y>#</y><d>2019-10-06</d><h>16:39</h><w>pez</w>Cool. I think I have seen work on this reported about in this channel.</z><z id="t1570380005" t="pez How does cider-inspect work then?"><y>#</y><d>2019-10-06</d><h>16:40</h><w>pez</w>How does cider-inspect work then?</z><z id="t1570380767" t="bozhidar [:attrs {:href &quot;/_/_/users/U0ETXRFEW&quot;}] Itâ€™s a different middleware thatâ€™s independent of eval ."><y>#</y><d>2019-10-06</d><h>16:52</h><w>bozhidar</w><a>@pez</a> Itâ€™s a different middleware thatâ€™s independent of <code>eval</code>.</z><z id="t1570380782" t="bozhidar It knows how to handle infinite sequences and stuff like this."><y>#</y><d>2019-10-06</d><h>16:53</h><w>bozhidar</w>It knows how to handle infinite sequences and stuff like this.</z><z id="t1570381020" t="pez I see. That is nice, of course. ðŸ˜ƒ"><y>#</y><d>2019-10-06</d><h>16:57</h><w>pez</w>I see. That is nice, of course. <b>ðŸ˜ƒ</b></z><z id="t1570441894" t="bozhidar Yeah, it is. At first I thought you were asking if thereâ€™s something in nREPL itself about the infinite results, therefore my confusion."><y>#</y><d>2019-10-07</d><h>09:51</h><w>bozhidar</w>Yeah, it is. At first I thought you were asking if thereâ€™s something in nREPL itself about the infinite results, therefore my confusion.</z><z id="t1570442027" t="pez That&apos;s what I asked. ðŸ˜€"><y>#</y><d>2019-10-07</d><h>09:53</h><w>pez</w>That&apos;s what I asked. <b>ðŸ˜€</b></z><z id="t1570442512" t="bozhidar FYI - nREPL 0.7.0-alpha2 is out with support for sideloading! Read more about it here https://nrepl.org/nrepl/design/middleware.html#_sideloading . Special thanks to [:attrs {:href &quot;/_/_/users/U3E46Q1DG&quot;}] and [:attrs {:href &quot;/_/_/users/U1XERPZ18&quot;}] for working on this! :man-bowing:"><y>#</y><d>2019-10-07</d><h>10:01</h><w>bozhidar</w>FYI - nREPL 0.7.0-alpha2 is out with support for sideloading! Read more about it here <a href="https://nrepl.org/nrepl/design/middleware.html#_sideloading" target="_blank">https://nrepl.org/nrepl/design/middleware.html#_sideloading</a>. Special thanks to <a>@cgrand</a> and <a>@shen</a> for working on this! <b>:man-bowing:</b></z><z id="t1570444550" t="cgrand Iâ€™m sorry of not having been able to dedicate some attention to it ðŸ˜•"><y>#</y><d>2019-10-07</d><h>10:35</h><r>cgrand</r>Iâ€™m sorry of not having been able to dedicate some attention to it <b>ðŸ˜•</b></z><z id="t1570444836" t="shen glad to be able to get your work over the line"><y>#</y><d>2019-10-07</d><h>10:40</h><r>shen</r>glad to be able to get your work over the line</z><z id="t1570442668" t="shen I&apos;m very keen to see how this can get used. If anyone is working on client side functionality, please keep us update?"><y>#</y><d>2019-10-07</d><h>10:04</h><w>shen</w>I&apos;m very keen to see how this can get used. If anyone is working on client side functionality, please keep us update?</z><z id="t1570442916" t="shen btw, saw the failing test in master. I&apos;m 95% sure it&apos;s related to https://github.com/nrepl/nrepl/issues/158"><y>#</y><d>2019-10-07</d><h>10:08</h><w>shen</w>btw, saw the failing test in master. I&apos;m 95% sure it&apos;s related to <a href="https://github.com/nrepl/nrepl/issues/158" target="_blank">https://github.com/nrepl/nrepl/issues/158</a></z><z id="t1570920846" t="pez Is there a way I can control the line length used for wrapping lines for stdout? It is 1024 by default."><y>#</y><d>2019-10-12</d><h>22:54</h><w>pez</w>Is there a way I can control the line length used for wrapping lines for stdout? It is 1024 by default.</z><z id="t1570950143" t="bozhidar [:attrs {:href &quot;/_/_/users/U0ETXRFEW&quot;}] Do you really mean wrapping or do you actually mean the size at which something is split into multiple messages? nREPL doesnâ€™t wrap output."><y>#</y><d>2019-10-13</d><h>07:02</h><w>bozhidar</w><a>@pez</a> Do you really mean wrapping or do you actually mean the size at which something is split into multiple messages? nREPL doesnâ€™t wrap output.</z><z id="t1570951612" t="pez I tried to increase nrepl.middleware.print/buffer-size (which is 1024 by default, the docs say), but it had no impact. Iâ€™ll look at what messages I get and maybe can ask a more informed question after that."><y>#</y><d>2019-10-13</d><h>07:26</h><w>pez</w>I tried to increase <code>nrepl.middleware.print/buffer-size</code> (which is 1024 by default, the docs say), but it had no impact.  Iâ€™ll look at what messages I get and maybe can ask a more informed question after that.</z><z id="t1570953158" t="pez Youâ€™re right, Itâ€™s where the messages are split up. But it only happens with stdout, not with the result values."><y>#</y><d>2019-10-13</d><h>07:52</h><w>pez</w>Youâ€™re right, Itâ€™s where the messages are split up. But it only happens with stdout, not with the result values.</z><z id="t1570954718" t="bozhidar Have you enabled streaming for the values? Otherwise this setting would be ignored for them."><y>#</y><d>2019-10-13</d><h>08:18</h><w>bozhidar</w>Have you enabled streaming for the values? Otherwise this setting would be ignored for them.</z><z id="t1570954740" t="bozhidar Itâ€™s the same config for both values and output."><y>#</y><d>2019-10-13</d><h>08:19</h><w>bozhidar</w>Itâ€™s the same config for both values and output.</z><z id="t1570955213" t="pez And which setting would that be? ðŸ˜€"><y>#</y><d>2019-10-13</d><h>08:26</h><w>pez</w>And which setting would that be? <b>ðŸ˜€</b></z><z id="t1571035888" t="cfleming Iâ€™m having a problem implementing support for nrepl.edn in Cursive, although Iâ€™m not sure if this is an nREPL problem or a piggieback one."><y>#</y><d>2019-10-14</d><h>06:51</h><w>cfleming</w>Iâ€™m having a problem implementing support for <code>nrepl.edn</code> in Cursive, although Iâ€™m not sure if this is an nREPL problem or a piggieback one.</z><z id="t1571035928" t="cfleming I thought I had implemented the support, but when I try to test piggieback, I get: Connecting to local nREPL server... nREPL server started on port 52466 on host 127.0.0.1 Clojure 1.10.1 (require &apos;cljs.repl.nashorn &apos;cider.piggieback) =&gt; nil (cider.piggieback/cljs-repl (cljs.repl.nashorn/repl-env)) Execution error (IllegalStateException) at cider.piggieback/cljs-repl (piggieback_impl.clj:168). Can&apos;t change/establish root binding of: *cljs-repl-env* with set "><y>#</y><d>2019-10-14</d><h>06:52</h><w>cfleming</w>I thought I had implemented the support, but when I try to test piggieback, I get:
<pre>Connecting to local nREPL server...
nREPL server started on port 52466 on host 127.0.0.1
Clojure 1.10.1
(require &apos;cljs.repl.nashorn &apos;cider.piggieback)
=&gt; nil
(cider.piggieback/cljs-repl (cljs.repl.nashorn/repl-env))
Execution error (IllegalStateException) at cider.piggieback/cljs-repl (piggieback_impl.clj:168).
Can&apos;t change/establish root binding of: *cljs-repl-env* with set
</pre></z><z id="t1571035965" t="cfleming I found a couple of issues about this, but they were either about using very old versions of various things, or about using trampoline with leiningen."><y>#</y><d>2019-10-14</d><h>06:52</h><w>cfleming</w>I found a couple of issues about this, but they were either about using very old versions of various things, or about using trampoline with leiningen.</z><z id="t1571036020" t="cfleming Iâ€™m establishing my server like this: `(do (-&gt; (File. ~(.getCanonicalPath init-file)) (.deleteOnExit)) (try (require &apos;nrepl.server &apos;nrepl.config &apos;nrepl.cmdline) (catch Throwable t# (println &quot;Error loading nrepl.server:&quot; (or (.getMessage t#) (type t#))))) (try (let [config# (merge {:host &quot;127.0.0.1&quot; :port 0} nrepl.config/config) {:keys [port# bind# handler# transport# greeting#]} (nrepl.cmdline/server-opts config#) server# (nrepl.server/start-server :port port# :bind bind# :ack-port ~ack-port :handler handler# :transport-fn transport# :greeting-fn greeting#) port# (:port server#)] (println &quot;nREPL server started on port&quot; port# &quot;on host 127.0.0.1&quot;)) (catch Throwable t# (println &quot;Error starting server:&quot; (or (.getMessage t#) (type t#)))))) "><y>#</y><d>2019-10-14</d><h>06:53</h><w>cfleming</w>Iâ€™m establishing my server like this:
<pre>`(do
   (-&gt; (File. ~(.getCanonicalPath init-file))
       (.deleteOnExit))
   (try (require &apos;nrepl.server &apos;nrepl.config &apos;nrepl.cmdline)
        (catch Throwable t#
          (println &quot;Error loading nrepl.server:&quot;
                   (or (.getMessage t#) (type t#)))))
   (try
     (let [config# (merge {:host &quot;127.0.0.1&quot;
                           :port 0}
                          nrepl.config/config)
           {:keys [port# bind# handler# transport# greeting#]} (nrepl.cmdline/server-opts config#)
           server# (nrepl.server/start-server
                     :port port#
                     :bind bind#
                     :ack-port ~ack-port
                     :handler handler#
                     :transport-fn transport#
                     :greeting-fn greeting#)
           port# (:port server#)]
       (println &quot;nREPL server started on port&quot; port# &quot;on host 127.0.0.1&quot;))
     (catch Throwable t#
       (println &quot;Error starting server:&quot;
                (or (.getMessage t#) (type t#))))))
</pre></z><z id="t1571036047" t="cfleming deps.edn: {:deps {org.clojure/clojurescript {:mvn/version &quot;1.10.520&quot;}} :aliases {:repl {:extra-deps {nrepl/nrepl {:mvn/version &quot;0.6.0&quot;} cider/piggieback {:mvn/version &quot;0.4.2&quot;}}}}} "><y>#</y><d>2019-10-14</d><h>06:54</h><w>cfleming</w>deps.edn:
<pre>{:deps    {org.clojure/clojurescript {:mvn/version &quot;1.10.520&quot;}}
 :aliases {:repl {:extra-deps {nrepl/nrepl {:mvn/version &quot;0.6.0&quot;}
                               cider/piggieback {:mvn/version &quot;0.4.2&quot;}}}}}
</pre></z><z id="t1571036068" t="cfleming nrepl.edn: {:middleware [cider.piggieback/wrap-cljs-repl]} "><y>#</y><d>2019-10-14</d><h>06:54</h><w>cfleming</w>nrepl.edn:
<pre>{:middleware [cider.piggieback/wrap-cljs-repl]}
</pre></z><z id="t1571036130" t="cfleming Iâ€™m not directly invoking nrepl.cmdline for everything, but I am reusing most of its logic, in particular for creating the handler from the configured middleware."><y>#</y><d>2019-10-14</d><h>06:55</h><w>cfleming</w>Iâ€™m not directly invoking <code>nrepl.cmdline</code> for everything, but I am reusing most of its logic, in particular for creating the handler from the configured middleware.</z><z id="t1571036137" t="cfleming Am I missing something obvious?"><y>#</y><d>2019-10-14</d><h>06:55</h><w>cfleming</w>Am I missing something obvious?</z><z id="t1571038654" t="cfleming Ok, one problem was that nrepl.edn should have been .nrepl.edn , so the middleware wasnâ€™t being found. However even after fixing that Iâ€™m still having the same problem."><y>#</y><d>2019-10-14</d><h>07:37</h><w>cfleming</w>Ok, one problem was that <code>nrepl.edn</code> should have been <code>.nrepl.edn</code>, so the middleware wasnâ€™t being found. However even after fixing that Iâ€™m still having the same problem.</z><z id="t1571039098" t="cfleming Iâ€™ve debugged this, and the piggieback middleware does seem to be being applied to the handler correctly, which means Iâ€™m pretty much out of ideas."><y>#</y><d>2019-10-14</d><h>07:44</h><w>cfleming</w>Iâ€™ve debugged this, and the piggieback middleware does seem to be being applied to the handler correctly, which means Iâ€™m pretty much out of ideas.</z><z id="t1571039285" t="bozhidar Hmm, if the handler is correct I canâ€™t imagine how this wouldnâ€™t work."><y>#</y><d>2019-10-14</d><h>07:48</h><w>bozhidar</w>Hmm, if the handler is correct I canâ€™t imagine how this wouldnâ€™t work.</z><z id="t1571039379" t="cfleming Iâ€™m going to try just calling nrepl.cmdline directly and passing the args as if I were calling -main, and see if Iâ€™m missing something subtle."><y>#</y><d>2019-10-14</d><h>07:49</h><w>cfleming</w>Iâ€™m going to try just calling nrepl.cmdline directly and passing the args as if I were calling -main, and see if Iâ€™m missing something subtle.</z><z id="t1571039386" t="bozhidar Did you try it with some other middleware as well?"><y>#</y><d>2019-10-14</d><h>07:49</h><w>bozhidar</w>Did you try it with some other middleware as well?</z><z id="t1571039398" t="cfleming No, is there an easy one to test with?"><y>#</y><d>2019-10-14</d><h>07:49</h><w>cfleming</w>No, is there an easy one to test with?</z><z id="t1571039417" t="cfleming Is there an echo middleware or something like that?"><y>#</y><d>2019-10-14</d><h>07:50</h><w>cfleming</w>Is there an echo middleware or something like that?</z><z id="t1571039477" t="bozhidar Thereâ€™s not, but I guess itâ€™s not a bad idea. ðŸ™‚ There a few pretty basic ops in cider-nrepl , though - e.g. classpath ."><y>#</y><d>2019-10-14</d><h>07:51</h><w>bozhidar</w>Thereâ€™s not, but I guess itâ€™s not a bad idea. <b>ðŸ™‚</b> There a few pretty basic ops in <code>cider-nrepl</code>, though - e.g. <code>classpath</code>.</z><z id="t1571039499" t="cfleming The problem is I donâ€™t have anything in the client for sending custom messages."><y>#</y><d>2019-10-14</d><h>07:51</h><w>cfleming</w>The problem is I donâ€™t have anything in the client for sending custom messages.</z><z id="t1571039518" t="cfleming Iâ€™m going to try calling nrepl.cmdline first, which is an easy test."><y>#</y><d>2019-10-14</d><h>07:51</h><w>cfleming</w>Iâ€™m going to try calling nrepl.cmdline first, which is an easy test.</z><z id="t1571039527" t="bozhidar Oh, got it. I always assumed you had some generic support for custom messages."><y>#</y><d>2019-10-14</d><h>07:52</h><w>bozhidar</w>Oh, got it. I always assumed you had some generic support for custom messages.</z><z id="t1571039532" t="bozhidar :thumbsup:"><y>#</y><d>2019-10-14</d><h>07:52</h><w>bozhidar</w><b>:thumbsup:</b></z><z id="t1571039549" t="cfleming I donâ€™t really use custom messages at all, so Iâ€™ve never had the need."><y>#</y><d>2019-10-14</d><h>07:52</h><w>cfleming</w>I donâ€™t really use custom messages at all, so Iâ€™ve never had the need.</z><z id="t1571040383" t="cfleming Ok, so if I just call nrepl.cmdline directly, that works."><y>#</y><d>2019-10-14</d><h>08:06</h><w>cfleming</w>Ok, so if I just call nrepl.cmdline directly, that works.</z><z id="t1571040786" t="bozhidar That definitely surprised me, as your code looked legit to me, but Iâ€™m glad to hear we didnâ€™t break something. ðŸ˜„"><y>#</y><d>2019-10-14</d><h>08:13</h><r>bozhidar</r>That definitely surprised me, as your code looked legit to me, but Iâ€™m glad to hear we didnâ€™t break something. <b>ðŸ˜„</b></z><z id="t1571041218" t="cfleming Yeah, itâ€™s weird. I think Iâ€™ll continue just calling that directly, but itâ€™s definitely odd."><y>#</y><d>2019-10-14</d><h>08:20</h><r>cfleming</r>Yeah, itâ€™s weird. I think Iâ€™ll continue just calling that directly, but itâ€™s definitely odd.</z><z id="t1571040404" t="cfleming So Iâ€™m obviously missing something either subtle or obvious."><y>#</y><d>2019-10-14</d><h>08:06</h><w>cfleming</w>So Iâ€™m obviously missing something either subtle or obvious.</z><z id="t1571040465" t="cfleming I think Iâ€™ll just keep doing that so that Cursive will interop better with all the related nREPL tooling, and things like .nrepl.port should just work."><y>#</y><d>2019-10-14</d><h>08:07</h><w>cfleming</w>I think Iâ€™ll just keep doing that so that Cursive will interop better with all the related nREPL tooling, and things like <code>.nrepl.port</code> should just work.</z><z id="t1571040724" t="bozhidar I agree. Iâ€™d also welcome some feedback on the current state of the nrepl.cmdline API, which I consider experimental at this point. Obviously without having clients of it around it was hard to assess if we got it right or not. ðŸ™‚"><y>#</y><d>2019-10-14</d><h>08:12</h><r>bozhidar</r>I agree. Iâ€™d also welcome some feedback on the current state of the <code>nrepl.cmdline</code> API, which I consider experimental at this point. Obviously without having clients of it around it was hard to assess if we got it right or not. <b>ðŸ™‚</b></z><z id="t1571040780" t="cfleming This is currently the extent of my use of it: (try (require &apos;nrepl.cmdline) (catch Throwable t# (println &quot;Error loading nREPL:&quot; (or (.getMessage t#) (type t#))) (System/exit 1))) (nrepl.cmdline/-main &quot;--ack&quot; ~(str ack-port)) "><y>#</y><d>2019-10-14</d><h>08:13</h><r>cfleming</r>This is currently the extent of my use of it:
<pre>(try (require &apos;nrepl.cmdline)
               (catch Throwable t#
                 (println &quot;Error loading nREPL:&quot;
                          (or (.getMessage t#) (type t#)))
                 (System/exit 1)))
          (nrepl.cmdline/-main &quot;--ack&quot; ~(str ack-port))
</pre></z><z id="t1571040783" t="cfleming ðŸ™‚"><y>#</y><d>2019-10-14</d><h>08:13</h><r>cfleming</r><b>ðŸ™‚</b></z><z id="t1571040816" t="bozhidar Ah, got it. I thought you went more granular than that. ðŸ˜„"><y>#</y><d>2019-10-14</d><h>08:13</h><r>bozhidar</r>Ah, got it. I thought you went more granular than that. <b>ðŸ˜„</b></z><z id="t1571040868" t="bozhidar One bit of feedback I see is that maybe we should suppress exceptions coming from -main ."><y>#</y><d>2019-10-14</d><h>08:14</h><r>bozhidar</r>One bit of feedback I see is that maybe we should suppress exceptions coming from <code>-main</code>.</z><z id="t1571040492" t="cfleming It would be nice to be able to hide the port ack message."><y>#</y><d>2019-10-14</d><h>08:08</h><w>cfleming</w>It would be nice to be able to hide the port ack message.</z><z id="t1571040740" t="bozhidar Can you file a ticket about this?"><y>#</y><d>2019-10-14</d><h>08:12</h><r>bozhidar</r>Can you file a ticket about this?</z><z id="t1571041139" t="cfleming https://github.com/nrepl/nrepl/issues/167"><y>#</y><d>2019-10-14</d><h>08:18</h><r>cfleming</r><a href="https://github.com/nrepl/nrepl/issues/167" target="_blank">https://github.com/nrepl/nrepl/issues/167</a></z><z id="t1571127372" t="cfleming Do Cider (and other editors) implement support for nREPL over HTTP using drawbridge?"><y>#</y><d>2019-10-15</d><h>08:16</h><w>cfleming</w>Do Cider (and other editors) implement support for nREPL over HTTP using drawbridge?</z><z id="t1571127437" t="cfleming If so, how does that work? Iâ€™d assumed Cider had an elisp nREPL client, but if it does then I assume it canâ€™t use drawbridge."><y>#</y><d>2019-10-15</d><h>08:17</h><w>cfleming</w>If so, how does that work? Iâ€™d assumed Cider had an elisp nREPL client, but if it does then I assume it canâ€™t use drawbridge.</z><z id="t1571132988" t="dominicm No. I don&apos;t think so."><y>#</y><d>2019-10-15</d><h>09:49</h><w>dominicm</w>No. I don&apos;t think so.</z><z id="t1571133001" t="dominicm I don&apos;t think the alternative protocols get much love."><y>#</y><d>2019-10-15</d><h>09:50</h><w>dominicm</w>I don&apos;t think the alternative protocols get much love.</z><z id="t1571135636" t="shen I&apos;m not sure what uses drawbridge really"><y>#</y><d>2019-10-15</d><h>10:33</h><w>shen</w>I&apos;m not sure what uses drawbridge really</z><z id="t1571138500" t="pez There was an Eclipse extension using it, iirc. Forgot the name of it now..."><y>#</y><d>2019-10-15</d><h>11:21</h><w>pez</w>There was an Eclipse extension using it, iirc. Forgot the name of it now...</z><z id="t1571169865" t="cfleming CounterClockwise, probably"><y>#</y><d>2019-10-15</d><h>20:04</h><w>cfleming</w>CounterClockwise, probably</z><z id="t1571170610" t="pez Yes, thatâ€™s the name. Is anyone using Eclipse for Clojure hacking these days, you think?"><y>#</y><d>2019-10-15</d><h>20:16</h><w>pez</w>Yes, thatâ€™s the name. Is anyone using Eclipse for Clojure hacking these days, you think?</z><z id="t1571173646" t="bozhidar It has been dead for years."><y>#</y><d>2019-10-15</d><h>21:07</h><w>bozhidar</w>It has been dead for years.</z><z id="t1571173673" t="bozhidar &gt; Iâ€™m not sure what uses drawbridge really"><y>#</y><d>2019-10-15</d><h>21:07</h><w>bozhidar</w>&gt; Iâ€™m not sure what uses drawbridge really</z><z id="t1571173681" t="bozhidar Most notably Leiningen. ðŸ™‚"><y>#</y><d>2019-10-15</d><h>21:08</h><w>bozhidar</w>Most notably Leiningen. <b>ðŸ™‚</b></z><z id="t1571173696" t="bozhidar &gt; Do Cider (and other editors) implement support for nREPL over HTTP using drawbridge?"><y>#</y><d>2019-10-15</d><h>21:08</h><w>bozhidar</w>&gt; Do Cider (and other editors) implement support for nREPL over HTTP using drawbridge?</z><z id="t1571173724" t="bozhidar [:attrs {:href &quot;/_/_/users/U0567Q30W&quot;}] To my knowledge no editor does this."><y>#</y><d>2019-10-15</d><h>21:08</h><w>bozhidar</w><a>@cfleming</a> To my knowledge no editor does this.</z><z id="t1571173831" t="bozhidar &gt; If so, how does that work? Iâ€™d assumed Cider had an elisp nREPL client, but if it does then I assume it canâ€™t use drawbridge. Basically you need to send the same requests/process the same responses over HTTP. Drawbridge itself would be transparent to the clients, but the overhead of dealing with HTTP is overkill for most clients I guess. A few users requested support for this in Emacs over the years, but the only real use-case was to debug remote apps, which they can easily do over an ssh tunnel as well."><y>#</y><d>2019-10-15</d><h>21:10</h><w>bozhidar</w>&gt; If so, how does that work? Iâ€™d assumed Cider had an elisp nREPL client, but if it does then I assume it canâ€™t use drawbridge.

Basically you need to send the same requests/process the same responses over HTTP. Drawbridge itself would be transparent to the clients, but the overhead of dealing with HTTP is overkill for most clients I guess. A few users requested support for this in Emacs over the years, but the only real use-case was to debug remote apps, which they can easily do over an ssh tunnel as well.</z><z id="t1571173877" t="cfleming The main use case that has been requested for Cursive is to have a REPL exposed with better auth control."><y>#</y><d>2019-10-15</d><h>21:11</h><w>cfleming</w>The main use case that has been requested for Cursive is to have a REPL exposed with better auth control.</z><z id="t1571173926" t="cfleming Iâ€™m actually having problems getting drawbridge to work. When I connect, new-session just hangs. I can get a client and a transport, but I canâ€™t see why that should be the case."><y>#</y><d>2019-10-15</d><h>21:12</h><w>cfleming</w>Iâ€™m actually having problems getting drawbridge to work. When I connect, new-session just hangs. I can get a client and a transport, but I canâ€™t see why that should be the case.</z><z id="t1571174082" t="cfleming [:attrs {:href &quot;/_/_/users/U051BLM8F&quot;}] AFAICT, all lein does to support drawbridge is to (require &apos;drawbridge.client) when connecting to a URL, is that right?"><y>#</y><d>2019-10-15</d><h>21:14</h><w>cfleming</w><a>@bozhidar</a> AFAICT, all lein does to support drawbridge is to <code>(require &apos;drawbridge.client)</code> when connecting to a URL, is that right?</z><z id="t1571208501" t="bozhidar Yeah, pretty much it."><y>#</y><d>2019-10-16</d><h>06:48</h><w>bozhidar</w>Yeah, pretty much it.</z><z id="t1571208546" t="bozhidar This registers the necessary URL handler."><y>#</y><d>2019-10-16</d><h>06:49</h><w>bozhidar</w>This registers the necessary URL handler.</z><z id="t1571270204" t="cfleming Ok, in that case I just canâ€™t get it to work. I think Iâ€™m going to ditch that support for now."><y>#</y><d>2019-10-16</d><h>23:56</h><w>cfleming</w>Ok, in that case I just canâ€™t get it to work. I think Iâ€™m going to ditch that support for now.</z><z id="t1571281111" t="bozhidar Fair enough. Sorry for not being able to provide more help with this, but this week is beyond crazy for me."><y>#</y><d>2019-10-17</d><h>02:58</h><w>bozhidar</w>Fair enough. Sorry for not being able to provide more help with this, but this week is beyond crazy for me.</z><z id="t1571281175" t="bozhidar As usual - please file a ticket, so we can follow-up on this. I assume that whatever the problem is itâ€™s probably something small. Always the hard part of drawbridge was setting it up server-side. ðŸ™‚"><y>#</y><d>2019-10-17</d><h>02:59</h><w>bozhidar</w>As usual - please file a ticket, so we can follow-up on this. I assume that whatever the problem is itâ€™s probably something small. Always the hard part of drawbridge was setting it up server-side. <b>ðŸ™‚</b></z><z id="t1571485546" t="pez Where can I find a list of â€œbuilt-inâ€ pprint vars?"><y>#</y><d>2019-10-19</d><h>11:45</h><w>pez</w>Where can I find a list of â€œbuilt-inâ€  pprint vars?</z><z id="t1571485660" t="pez Found it. https://github.com/clojure-emacs/cider-nrepl/blob/master/src/cider/nrepl/pprint.clj"><y>#</y><d>2019-10-19</d><h>11:47</h><w>pez</w>Found it. <a href="https://github.com/clojure-emacs/cider-nrepl/blob/master/src/cider/nrepl/pprint.clj" target="_blank">https://github.com/clojure-emacs/cider-nrepl/blob/master/src/cider/nrepl/pprint.clj</a></z><z id="t1571486213" t="pez However, if I try to use zpring-pprint I get Could not locate zprint/core__init.class, zprint/core.clj or zprint/core.cljc on classpath. I somehow recognize having asked about this before, but canâ€™t remember what the conclusion was. puget and fipp both work. (But give me errors when printing datomic-api results, which is why I want to try zprint)"><y>#</y><d>2019-10-19</d><h>11:56</h><w>pez</w>However, if I try to use <code>zpring-pprint</code> I get <pre>Could not locate zprint/core__init.class, zprint/core.clj or zprint/core.cljc on classpath.</pre> I somehow recognize having asked about this before, but canâ€™t remember what the conclusion was. puget and fipp both work. (But give me errors when printing datomic-api results, which is why I want to try zprint)</z><z id="t1571488241" t="pez I donâ€™t know where to report this, if it is even something that is possible to fix, but anyway, hereâ€™s a test project: https://github.com/PEZ/nrepl-pprint-datomic"><y>#</y><d>2019-10-19</d><h>12:30</h><w>pez</w>I donâ€™t know where to report this, if it is even something that is possible to fix, but anyway, hereâ€™s a test project: <a href="https://github.com/PEZ/nrepl-pprint-datomic" target="_blank">https://github.com/PEZ/nrepl-pprint-datomic</a></z><z id="t1571488505" t="pez I get a bit of different results depending on which pprint function I use. In this mini-project: puget throws in the towel with Error printing return value at clojure.lang.Util/runtimeException (Util.java:221). Unable to convert: class datomic.btset.BTSet to Object[] zprint dumps the whole database, with schemas and all, retaining reader literals. fipp also dumps the whole database, but â€œexpandsâ€ (or whatever the term is) the reader literals. clojure.core/pprint prints the same thing as with no pretty printing. Which is: {:db-before "><y>#</y><d>2019-10-19</d><h>12:35</h><w>pez</w>I get a bit of different results depending on which pprint function I use. In this mini-project:
<code>puget</code> throws in the towel with <pre>Error printing return value at clojure.lang.Util/runtimeException (Util.java:221).
Unable to convert: class datomic.btset.BTSet to Object[]</pre>
<code>zprint</code> dumps the whole database, with schemas and all, retaining reader literals.
<code>fipp</code> also dumps the whole database, but â€œexpandsâ€ (or whatever the term is) the reader literals.
<code>clojure.core/pprint</code> prints the same thing as with no pretty printing. Which is: <pre>{:db-before </pre></z><z id="t1571488741" t="dominicm I don&apos;t think any are built in except clojure.pprint"><y>#</y><d>2019-10-19</d><h>12:39</h><w>dominicm</w>I don&apos;t think any are built in except clojure.pprint</z><z id="t1571488749" t="dominicm There&apos;s some in cider-nrepl though"><y>#</y><d>2019-10-19</d><h>12:39</h><w>dominicm</w>There&apos;s some in cider-nrepl though</z><z id="t1571489655" t="pez Those that I have tried are the cider-nrepl ones. Even though I had to provide the dependency on zprint in the test project."><y>#</y><d>2019-10-19</d><h>12:54</h><w>pez</w>Those that I have tried are the cider-nrepl ones. Even though I had to provide the dependency on zprint in the test project.</z><z id="t1571491391" t="dominicm They are defined under a special symbol iirc"><y>#</y><d>2019-10-19</d><h>13:23</h><w>dominicm</w>They are defined under a special symbol iirc</z><z id="t1571491416" t="dominicm If you have a dependency on zprint then I think it should work"><y>#</y><d>2019-10-19</d><h>13:23</h><w>dominicm</w>If you have a dependency on zprint then I think it should work</z><z id="t1571491426" t="dominicm Can you require it normally?"><y>#</y><d>2019-10-19</d><h>13:23</h><w>dominicm</w>Can you require it normally?</z><z id="t1571491527" t="pez Yeah, no problems with zprint really. Itâ€™s a bit strange that I need to include the dependency, but no biggie."><y>#</y><d>2019-10-19</d><h>13:25</h><w>pez</w>Yeah, no problems with zprint really. Itâ€™s a bit strange that I need to include the dependency, but no biggie.</z><z id="t1571491816" t="dominicm Sideload it ;)"><y>#</y><d>2019-10-19</d><h>13:30</h><w>dominicm</w>Sideload it ;)</z><z id="t1571492852" t="pez Itâ€™s still not the problem. ðŸ˜ƒ The issue here is that is I use a pretty printing printer for nrepl.middleware.print/print with results from Datomic, they print the whole database for things like :db-before . Which surprises the user who probably thought that the result map should just be printed in a tad more readable way. Also, in Calva pretty printing is default, and people can have pretty huge databases."><y>#</y><d>2019-10-19</d><h>13:47</h><w>pez</w>Itâ€™s still not the problem. <b>ðŸ˜ƒ</b> The issue here is that is I use a pretty printing printer for <code>nrepl.middleware.print/print</code> with results from Datomic, they print the whole database for things like <code>:db-before </code>. Which surprises the user who probably thought that the result map should just be printed in a tad more readable way. Also, in Calva pretty printing is default, and people can have pretty huge databases.</z><z id="t1571492925" t="dpsutton The db is a value. So itâ€™s important not to print it right? Since it could be huge"><y>#</y><d>2019-10-19</d><h>13:48</h><w>dpsutton</w>The db is a value. So itâ€™s important not to print it right? Since it could be huge</z><z id="t1571492946" t="pez Yeah, always is pretty huge."><y>#</y><d>2019-10-19</d><h>13:49</h><w>pez</w>Yeah, always is pretty huge.</z><z id="t1571492959" t="pez (In the case of a datomic database.)"><y>#</y><d>2019-10-19</d><h>13:49</h><w>pez</w>(In the case of a datomic database.)</z><z id="t1571492959" t="dpsutton If you just prn it youâ€™d see the same thing?"><y>#</y><d>2019-10-19</d><h>13:49</h><w>dpsutton</w>If you just prn it youâ€™d see the same thing?</z><z id="t1571492973" t="dpsutton I donâ€™t see how this is a pretty printing issue"><y>#</y><d>2019-10-19</d><h>13:49</h><w>dpsutton</w>I donâ€™t see how this is a pretty printing issue</z><z id="t1571493024" t="pez I can try with prn . But, clojure.core/pprint doesnâ€™t print the database."><y>#</y><d>2019-10-19</d><h>13:50</h><w>pez</w>I can try with <code>prn</code>. But, <code>clojure.core/pprint</code> doesnâ€™t print the database.</z><z id="t1571493072" t="dpsutton Oh i see"><y>#</y><d>2019-10-19</d><h>13:51</h><w>dpsutton</w>Oh i see</z><z id="t1571493094" t="pez &gt; I donâ€™t see how this is a pretty printing issue It is an issue at least. Not sure how to categorize it, but if not pretty printing, things do not go crazy."><y>#</y><d>2019-10-19</d><h>13:51</h><w>pez</w>&gt; I donâ€™t see how this is a pretty printing issue
It is an issue at least. Not sure how to categorize it, but if not pretty printing, things do not go crazy.</z><z id="t1571493171" t="dpsutton Wild guess. The db implements IAssoc or something but not a print method and the pretty printers walk it trying to be helpful"><y>#</y><d>2019-10-19</d><h>13:52</h><w>dpsutton</w>Wild guess. The db implements IAssoc or something but not a print method and the pretty printers walk it trying to be helpful</z><z id="t1571493468" t="pez I probably need to do my pretty printing in a static way."><y>#</y><d>2019-10-19</d><h>13:57</h><w>pez</w>I probably need to do my pretty printing in a static way.</z><z id="t1571493653" t="pez &gt; and the pretty printers walk it trying to be helpful It certainly seems to be something like this, because on my work project, evaluating something like @(d/transact conn [{:db/doc &quot;Hello world&quot;}]) with pretty printing enabled never finishes and the java process heat up my machine like mad."><y>#</y><d>2019-10-19</d><h>14:00</h><w>pez</w>&gt; and the pretty printers walk it trying to be helpful
It certainly seems to be something like this, because on my work project, evaluating something like <pre>@(d/transact conn [{:db/doc &quot;Hello world&quot;}])</pre> with pretty printing enabled never finishes and the java process heat up my machine like mad.</z><z id="t1571495268" t="dominicm Yeah. This is pretty normal with pretty printing."><y>#</y><d>2019-10-19</d><h>14:27</h><w>dominicm</w>Yeah. This is pretty normal with pretty printing.</z><z id="t1571495274" t="dominicm Component is another common one."><y>#</y><d>2019-10-19</d><h>14:27</h><w>dominicm</w>Component is another common one.</z><z id="t1571605954" t="pez Stupid question time. Is there a chance I can get the results from eval as EDN if I use the EDN transport?"><y>#</y><d>2019-10-20</d><h>21:12</h><w>pez</w>Stupid question time. Is there a chance I can get the results from <code>eval</code> as EDN if I use the EDN transport?</z><z id="t1571636397" t="bozhidar [:attrs {:href &quot;/_/_/users/U0ETXRFEW&quot;}] Right now this canâ€™t be done, but weâ€™ve discussed it at some point with [:attrs {:href &quot;/_/_/users/U1XERPZ18&quot;}] . As this would result in changing more than the data encoding weâ€™ve decided to first just return exactly the same data and consider a â€œricherâ€ format down the road."><y>#</y><d>2019-10-21</d><h>05:39</h><w>bozhidar</w><a>@pez</a> Right now this canâ€™t be done, but weâ€™ve discussed it at some point with <a>@shen</a>. As this would result in changing more than the data encoding weâ€™ve decided to first just return exactly the same data and consider a â€œricherâ€ format down the road.</z><z id="t1571636438" t="bozhidar How do you plan to handle raw EDN on the client, btw? You might end up having to deal with unknown data readers (for instance)?"><y>#</y><d>2019-10-21</d><h>05:40</h><w>bozhidar</w>How do you plan to handle raw EDN on the client, btw? You might end up having to deal with unknown data readers (for instance)?</z><z id="t1571644536" t="shen This is the rich printing functionality from unrepl?"><y>#</y><d>2019-10-21</d><h>07:55</h><w>shen</w>This is the rich printing functionality from unrepl?</z><z id="t1571646153" t="pez &gt; How do you plan to handle raw EDN on the client, btw? You might end up having to deal with unknown data readers (for instance)? To avoid burning up my computer just because I have pprint enabled when I evaluate a datomic transaction, I am moving the pprint stuff client side in Calva. I then have the problem that I need to parse the result and those datomic value-symbols do not parse. I solve it by just printing it w/o prettifying in the catch clause. But if I could get the result that I today get as EDN, then maybe I can get a prettifyer to work on it. I haven&apos;t tested that yet, because I don&apos;t know how to test it. So wanted to check if I could even dream about having EDN in, before I go about figuring out the next step."><y>#</y><d>2019-10-21</d><h>08:22</h><w>pez</w>&gt; How do you plan to handle raw EDN on the client, btw? You might end up having to deal with unknown data readers (for instance)?
To avoid burning up my computer just because I have pprint enabled when I evaluate a datomic transaction, I am moving the pprint stuff client side in Calva. I then have the problem that I need to parse the result and those datomic value-symbols do not parse. I solve it by just printing it w/o prettifying in the <code>catch</code> clause. But if I could get the result that I today get as EDN, then maybe I can get a prettifyer to work on it. I haven&apos;t tested that yet, because I don&apos;t know how to test it. So wanted to check if I could even dream about having EDN in, before I go about figuring out the next step.</z><z id="t1571646237" t="dominicm Seems like you could write a new server-side pretty printer?"><y>#</y><d>2019-10-21</d><h>08:23</h><w>dominicm</w>Seems like you could write a new server-side pretty printer?</z><z id="t1571646240" t="pez As for unkown data readers. We already have that situation with the non-pretty results, right? They come back as literals. Only if I let nrepl pretty-print it they get unpacked."><y>#</y><d>2019-10-21</d><h>08:24</h><w>pez</w>As for unkown data readers. We already have that situation with the non-pretty results, right? They come back as literals. Only if I let nrepl pretty-print it they get unpacked.</z><z id="t1571646317" t="pez Yeah, I should test with providing a server side pretty printer too. I&apos;ll try to find the time."><y>#</y><d>2019-10-21</d><h>08:25</h><w>pez</w>Yeah, I should test with providing a server side pretty printer too. I&apos;ll try to find the time.</z><z id="t1571646763" t="dominicm I&apos;m assuming it&apos;s the same effort, and it means I can use it too"><y>#</y><d>2019-10-21</d><h>08:32</h><w>dominicm</w>I&apos;m assuming it&apos;s the same effort, and it means I can use it too</z><z id="t1571646791" t="dominicm Fwiw, we could also include default printers for annoying things in common libraries (eg datomic db)"><y>#</y><d>2019-10-21</d><h>08:33</h><w>dominicm</w>Fwiw, we could also include default printers for annoying things in common libraries (eg datomic db)</z><z id="t1571646813" t="dominicm That&apos;s a much easier solution really."><y>#</y><d>2019-10-21</d><h>08:33</h><w>dominicm</w>That&apos;s a much easier solution really.</z><z id="t1571649149" t="bozhidar [:attrs {:href &quot;/_/_/users/U09LZR36F&quot;}] I agree."><y>#</y><d>2019-10-21</d><h>09:12</h><w>bozhidar</w><a>@dominicm</a> I agree.</z><z id="t1571649217" t="bozhidar &gt; This is the rich printing functionality from unrepl?"><y>#</y><d>2019-10-21</d><h>09:13</h><w>bozhidar</w>&gt; This is the rich printing functionality from unrepl?</z><z id="t1571649249" t="bozhidar [:attrs {:href &quot;/_/_/users/U1XERPZ18&quot;}] Yeah. Although I think we had discussed this independently before as well."><y>#</y><d>2019-10-21</d><h>09:14</h><w>bozhidar</w><a>@shen</a> Yeah. Although I think we had discussed this independently before as well.</z><z id="t1571650998" t="shen righto."><y>#</y><d>2019-10-21</d><h>09:43</h><w>shen</w>righto.</z><z id="t1571651062" t="shen guess this could also help if there were a server side printer? https://github.com/nrepl/nrepl/issues/93"><y>#</y><d>2019-10-21</d><h>09:44</h><w>shen</w>guess this could also help if there were a server side printer? <a href="https://github.com/nrepl/nrepl/issues/93" target="_blank">https://github.com/nrepl/nrepl/issues/93</a></z><z id="t1571651190" t="cgrand Iâ€™m a channel zombie but... whatâ€™s the status/current thinking on printing? Last I was alive and taked with [:attrs {:href &quot;/_/_/users/U051BLM8F&quot;}] I think we discussed: 1/ unbundling printing in: * generic preemptible walking (can only done server-side) * layout (client or server) 2/ using unlikely char sequences (unicode provate or ANSI escape code) to intersperse â€œbrowsing affordancesâ€ in the middle of printed output (for quick regex-powered rendering)"><y>#</y><d>2019-10-21</d><h>09:46</h><w>cgrand</w>Iâ€™m a channel zombie but... whatâ€™s the status/current thinking on printing?
Last I was alive and taked with <a>@bozhidar</a> I think we discussed:
1/ unbundling printing in:
 * generic preemptible walking (can only done server-side)
 * layout (client or server)
2/ using unlikely char sequences (unicode provate or ANSI escape code) to intersperse â€œbrowsing affordancesâ€ in the middle of printed output (for quick regex-powered rendering)</z><z id="t1571651671" t="shen Not sure there has been much more talk? think [:attrs {:href &quot;/_/_/users/U051BLM8F&quot;}] just talked to me about some of the ideas that&apos;s been floating around"><y>#</y><d>2019-10-21</d><h>09:54</h><w>shen</w>Not sure there has been much more talk? think <a>@bozhidar</a> just talked to me about some of the ideas that&apos;s been floating around</z><z id="t1571651728" t="bozhidar Yeah, nothing much has happened. The convos we had with [:attrs {:href &quot;/_/_/users/U3E46Q1DG&quot;}] in the printer PR are still as relevant as before and we still need to decide on the approach there."><y>#</y><d>2019-10-21</d><h>09:55</h><w>bozhidar</w>Yeah, nothing much has happened. The convos we had with <a>@cgrand</a> in the printer PR are still as relevant as before and we still need to decide on the approach there.</z><z id="t1571655062" t="pez &gt; Iâ€™m assuming itâ€™s the same effort, and it means I can use it too Fair enough. Before I go about changing Calva to use EDN Transport and try solve it that way, Iâ€™ll look at doing it server side, where we already have EDN (I assume)."><y>#</y><d>2019-10-21</d><h>10:51</h><w>pez</w>&gt; Iâ€™m assuming itâ€™s the same effort, and it means I can use it too
Fair enough. Before I go about changing Calva to use EDN Transport and try solve it that way, Iâ€™ll look at doing it server side, where we already have EDN (I assume).</z><z id="t1571655778" t="dominicm In the server, you have values, classes, objects, etc"><y>#</y><d>2019-10-21</d><h>11:02</h><w>dominicm</w>In the server, you have values, classes, objects, etc</z><z id="t1571655789" t="dominicm It&apos;s way easier, because you have richer data."><y>#</y><d>2019-10-21</d><h>11:03</h><w>dominicm</w>It&apos;s way easier, because you have richer data.</z><z id="t1571656411" t="pez Though it is the data richness that is my current problem. ðŸ˜ƒ"><y>#</y><d>2019-10-21</d><h>11:13</h><w>pez</w>Though it is the data richness that is my current problem. <b>ðŸ˜ƒ</b></z><z id="t1571673368" t="pez From https://docs.cider.mx/cider-nrepl/hacking.html &gt; If youâ€™re already using a client that depends on cider-nrepl (e.g. CIDER) making changes to the cider-nrepl code will normally result in those changes becoming immediately available to your client. How do I set things up to reach this nirvana?"><y>#</y><d>2019-10-21</d><h>15:56</h><w>pez</w>From <a href="https://docs.cider.mx/cider-nrepl/hacking.html" target="_blank">https://docs.cider.mx/cider-nrepl/hacking.html</a>
&gt; If youâ€™re already using a client that depends on cider-nrepl (e.g. CIDER) making changes to the cider-nrepl code will normally result in those changes becoming immediately available to your client.
How do I set things up to reach this nirvana?</z><z id="t1571673903" t="bozhidar I just start lein repl in the source folder of cider-nrepl and connect to it. Pretty simple."><y>#</y><d>2019-10-21</d><h>16:05</h><w>bozhidar</w>I just start <code>lein repl</code> in the source folder of <code>cider-nrepl</code> and connect to it. Pretty simple.</z><z id="t1571675851" t="pez That sound pretty simple, yes."><y>#</y><d>2019-10-21</d><h>16:37</h><w>pez</w>That sound pretty simple, yes.</z><z id="t1571676011" t="pez Wow. that just worked."><y>#</y><d>2019-10-21</d><h>16:40</h><w>pez</w>Wow. that just worked.</z><z id="t1571676450" t="pez Is there a way I can get the same magic with my test project? I mean, I have a test project with which Iâ€™d like to use my custom cider-nrepl."><y>#</y><d>2019-10-21</d><h>16:47</h><w>pez</w>Is there a way I can get the same magic with my test project? I mean, I have a test project with which Iâ€™d like to use my custom cider-nrepl.</z><z id="t1571689095" t="tmountain Hi, I use Spacemacs/Cider for my Clojure development. Earlier today, cider results stopped pretty printing for me."><y>#</y><d>2019-10-21</d><h>20:18</h><w>tmountain</w>Hi, I use Spacemacs/Cider for my Clojure development. Earlier today, cider results stopped pretty printing for me.</z><z id="t1571689106" t="tmountain If I eval the following in Spacemacs, it starts working again."><y>#</y><d>2019-10-21</d><h>20:18</h><w>tmountain</w>If I eval the following in Spacemacs, it starts working again.</z><z id="t1571689109" t="tmountain (set! nrepl.middleware.print/*print-fn* clojure.pprint/pprint)"><y>#</y><d>2019-10-21</d><h>20:18</h><w>tmountain</w><code>(set! nrepl.middleware.print/*print-fn* clojure.pprint/pprint)</code></z><z id="t1571689200" t="tmountain But, I have to this every time a new nrepl session is initiated."><y>#</y><d>2019-10-21</d><h>20:20</h><w>tmountain</w>But, I have to this every time a new nrepl session is initiated.</z><z id="t1571689268" t="tmountain Any ideas why this happened, and worst-case, is there a way to set the expression above in a global config to get back to the desired behavior?"><y>#</y><d>2019-10-21</d><h>20:21</h><w>tmountain</w>Any ideas why this happened, and worst-case, is there a way to set the expression above in a global config to get back to the desired behavior?</z><z id="t1571689415" t="pez Which version of cider-nrepl is being used?"><y>#</y><d>2019-10-21</d><h>20:23</h><w>pez</w>Which version of cider-nrepl is being used?</z><z id="t1571689513" t="tmountain I&apos;m not sure. It&apos;s using whatever Spacemacs installed. Is there a way to get the version?"><y>#</y><d>2019-10-21</d><h>20:25</h><w>tmountain</w>I&apos;m not sure. It&apos;s using whatever Spacemacs installed. Is there a way to get the version?</z><z id="t1571689587" t="dpsutton it&apos;ll be in the messages buffer when you start a session. also, can you check m-x cider-version ?"><y>#</y><d>2019-10-21</d><h>20:26</h><w>dpsutton</w>it&apos;ll be in the messages buffer when you start a session. also, can you check <code>m-x cider-version</code>?</z><z id="t1571689606" t="tmountain CIDER 0.22.0snapshot (package: 20190623.1003)"><y>#</y><d>2019-10-21</d><h>20:26</h><w>tmountain</w><code>CIDER 0.22.0snapshot (package: 20190623.1003)</code></z><z id="t1571689639" t="tmountain 0.22.0-beta4 &lt;- cider-nrepl version"><y>#</y><d>2019-10-21</d><h>20:27</h><w>tmountain</w><code>0.22.0-beta4</code> &lt;- cider-nrepl version</z><z id="t1571689679" t="dpsutton well nothing in your setup related to CIDER changed today i don&apos;t think. is this a new/different project? maybe there are some dir-locals in the other one if so?"><y>#</y><d>2019-10-21</d><h>20:27</h><w>dpsutton</w>well nothing in your setup related to CIDER changed today i don&apos;t think. is this a new/different project? maybe there are some dir-locals in the other one if so?</z><z id="t1571689777" t="tmountain Yeah, it&apos;s super weird. Spacemacs crashed (loading a very large JSON payload from an API), and then after that, it&apos;s been refusing to pretty-print. I spun up a new project with lein to see if it was specific to my existing project, and the same issue persists."><y>#</y><d>2019-10-21</d><h>20:29</h><w>tmountain</w>Yeah, it&apos;s super weird. Spacemacs crashed (loading a very large JSON payload from an API), and then after that, it&apos;s been refusing to pretty-print. I spun up a new project with lein to see if it was specific to my existing project, and the same issue persists.</z><z id="t1571689947" t="dpsutton you can m-x toggle-message-logging and watch for the values going over. (i think they are config that are sent over at startup)"><y>#</y><d>2019-10-21</d><h>20:32</h><w>dpsutton</w>you can <code>m-x toggle-message-logging</code> and watch for the values going over. (i think they are config that are sent over at startup)</z><z id="t1571689955" t="dpsutton haven&apos;t dug into the pprinting stuff too much"><y>#</y><d>2019-10-21</d><h>20:32</h><w>dpsutton</w>haven&apos;t dug into the pprinting stuff too much</z><z id="t1571689966" t="dpsutton but i&apos;ve never regretted watching the nrepl traffic"><y>#</y><d>2019-10-21</d><h>20:32</h><w>dpsutton</w>but i&apos;ve never regretted watching the nrepl traffic</z></g><g id="s6"><z id="t1571690318" t="pez Itâ€™s a pretty ancient CIDER though. Maybe take the opportunity to upgrade it?"><y>#</y><d>2019-10-21</d><h>20:38</h><w>pez</w>Itâ€™s a pretty ancient CIDER though. Maybe take the opportunity to upgrade it?</z><z id="t1571690392" t="pez Iâ€™m pulling my hair trying to test my custom cider-nrepl in another project. make install should do it, right? Except, it doesnâ€™t."><y>#</y><d>2019-10-21</d><h>20:39</h><w>pez</w>Iâ€™m pulling my hair trying to test my custom cider-nrepl in another project. <code>make install</code> should do it, right? Except, it doesnâ€™t.</z><z id="t1571690468" t="tmountain Gonna give that a try."><y>#</y><d>2019-10-21</d><h>20:41</h><w>tmountain</w>Gonna give that a try.</z><z id="t1571690488" t="dpsutton what lein are you on [:attrs {:href &quot;/_/_/users/U0ETXRFEW&quot;}] . some older leins had trouble with that"><y>#</y><d>2019-10-21</d><h>20:41</h><w>dpsutton</w>what lein are you on <a>@pez</a>. some older leins had trouble with that</z><z id="t1571690638" t="tmountain Now it&apos;s working."><y>#</y><d>2019-10-21</d><h>20:43</h><w>tmountain</w>Now it&apos;s working.</z><z id="t1571690638" t="pez 2.9.1"><y>#</y><d>2019-10-21</d><h>20:43</h><w>pez</w>2.9.1</z><z id="t1571690642" t="tmountain Thank you."><y>#</y><d>2019-10-21</d><h>20:44</h><w>tmountain</w>Thank you.</z><z id="t1571690787" t="dpsutton [:attrs {:href &quot;/_/_/users/U0ETXRFEW&quot;}] in the makefile there&apos;s some file that&apos;s created to indicate the inlining had been done. try deleting that and lein clean and then make install again"><y>#</y><d>2019-10-21</d><h>20:46</h><w>dpsutton</w><a>@pez</a> in the makefile there&apos;s some file that&apos;s created to indicate the inlining had been done. try deleting that and lein clean and then make install again</z><z id="t1571690816" t="dpsutton also, make sure that the version you are installing is the version you are using in your projects. if it installs 24-snapshot and the others are using 23 or something you&apos;ll not see it"><y>#</y><d>2019-10-21</d><h>20:46</h><w>dpsutton</w>also, make sure that the version you are installing is the version you are using in your projects. if it installs 24-snapshot and the others are using 23 or something you&apos;ll not see it</z><z id="t1571690955" t="pez Yeah. Iâ€™ve tried bumping it to 27 and such just to force it to use my install. Will try the cleaning now."><y>#</y><d>2019-10-21</d><h>20:49</h><w>pez</w>Yeah. Iâ€™ve tried bumping it to 27 and such just to force it to use my install. Will try the cleaning now.</z><z id="t1571690977" t="dpsutton touch .inline-deps that one"><y>#</y><d>2019-10-21</d><h>20:49</h><w>dpsutton</w><code>touch .inline-deps</code> that one</z><z id="t1571691270" t="pez So I deleted the file .inline-deps , then lein clean and then make install . The inlining happened again. But my version is still not used. So strangeâ€¦"><y>#</y><d>2019-10-21</d><h>20:54</h><w>pez</w>So I deleted the file <code>.inline-deps</code>, then <code>lein clean</code> and then <code>make install</code>. The inlining happened again. But my version is still not used. So strangeâ€¦</z><z id="t1571691871" t="pez I start the repl like so: lein update-in :dependencies conj &apos;[nrepl&quot;0.6.0&quot;]&apos; -- update-in :plugins conj &apos;[cider/cider-nrepl&quot;0.27.0-SNAPSHOT&quot;]&apos; -- update-in &apos;[:repl-options :nrepl-middleware]&apos; conj &apos;[&quot;cider.nrepl/cider-middleware&quot;]&apos; -- repl :headless"><y>#</y><d>2019-10-21</d><h>21:04</h><w>pez</w>I start the repl like so: <pre>lein update-in :dependencies conj &apos;[nrepl&quot;0.6.0&quot;]&apos; -- update-in :plugins conj &apos;[cider/cider-nrepl&quot;0.27.0-SNAPSHOT&quot;]&apos; -- update-in &apos;[:repl-options :nrepl-middleware]&apos; conj &apos;[&quot;cider.nrepl/cider-middleware&quot;]&apos; -- repl :headless</pre></z><z id="t1571691991" t="dpsutton /usr/local/bin/lein update-in :dependencies conj \[nrepl\ \&quot;0.6.0\&quot;\] -- update-in :plugins conj \[cider/cider-nrepl\ \&quot;0.22.4-SNAPSHOT\&quot;\] -- repl :headless :host localhost is what CIDER cranks up"><y>#</y><d>2019-10-21</d><h>21:06</h><w>dpsutton</w><code>/usr/local/bin/lein update-in :dependencies conj \[nrepl\ \&quot;0.6.0\&quot;\] -- update-in :plugins conj \[cider/cider-nrepl\ \&quot;0.22.4-SNAPSHOT\&quot;\] -- repl :headless :host localhost</code> is what CIDER cranks up</z><z id="t1571692191" t="pez Iâ€™ll try with removing :repl-options and see if that is what causes the strangeness."><y>#</y><d>2019-10-21</d><h>21:09</h><w>pez</w>Iâ€™ll try with removing <code>:repl-options</code> and see if that is what causes the strangeness.</z><z id="t1571692256" t="dpsutton not sure if the different style of quoting matters Â¯\(ãƒ„)/Â¯"><y>#</y><d>2019-10-21</d><h>21:10</h><w>dpsutton</w>not sure if the different style of quoting matters Â¯\(ãƒ„)/Â¯</z><z id="t1571692462" t="pez That would make it not work at all, rather. Not just pull in some wahetevr cider-nrepl. Well, thatâ€™s what I think. Right now I am ready to believe anything. ðŸ˜ƒ"><y>#</y><d>2019-10-21</d><h>21:14</h><w>pez</w>That would make it not work at all, rather. Not just pull in some wahetevr cider-nrepl. Well, thatâ€™s what I think. Right now I am ready to believe anything. <b>ðŸ˜ƒ</b></z><z id="t1571725596" t="bozhidar Btw, when I do experiments with make install I usually just put the local version in my profiles and do a lein repl . Generally you donâ€™t need anything else besides overriding the plugin version."><y>#</y><d>2019-10-22</d><h>06:26</h><w>bozhidar</w>Btw, when I do experiments with <code>make install</code> I usually just put the local version in my profiles and do a <code>lein repl</code>. Generally you donâ€™t need anything else besides overriding the plugin version.</z><z id="t1571729813" t="pez I&apos;ll try that."><y>#</y><d>2019-10-22</d><h>07:36</h><w>pez</w>I&apos;ll try that.</z><z id="t1571911058" t="Shuai Lin A question about class loader for importing java classes (in repl) https://clojurians.slack.com/archives/C03S1KBA2/p1571910839208600"><y>#</y><d>2019-10-24</d><h>09:57</h><w>Shuai Lin</w>A question about class loader for importing java classes (in repl) <a href="https://clojurians.slack.com/archives/C03S1KBA2/p1571910839208600" target="_blank">https://clojurians.slack.com/archives/C03S1KBA2/p1571910839208600</a></z><z id="t1571914212" t="dominicm There&apos;s a shared class loader at the root"><y>#</y><d>2019-10-24</d><h>10:50</h><w>dominicm</w>There&apos;s a shared class loader at the root</z><z id="t1571914240" t="dominicm Leiningen puts you in a strange place where a separate overriding class loader is set though."><y>#</y><d>2019-10-24</d><h>10:50</h><w>dominicm</w>Leiningen puts you in a strange place where a separate overriding class loader is set though.</z><z id="t1571914341" t="shen is it this issue? https://github.com/nrepl/nrepl/issues/113"><y>#</y><d>2019-10-24</d><h>10:52</h><w>shen</w>is it this issue? <a href="https://github.com/nrepl/nrepl/issues/113" target="_blank">https://github.com/nrepl/nrepl/issues/113</a></z><z id="t1571915285" t="dominicm Yeah, it is :)"><y>#</y><d>2019-10-24</d><h>11:08</h><w>dominicm</w>Yeah, it is :)</z><z id="t1571915884" t="shen I spent a bit of time looking at the issue, but think I need to understand how classloaders work a bit more ðŸ˜¬"><y>#</y><d>2019-10-24</d><h>11:18</h><w>shen</w>I spent a bit of time looking at the issue, but think I need to understand how classloaders work a bit more <b>ðŸ˜¬</b></z><z id="t1572107028" t="pez Can I interrupt an â€œevaluationâ€, resulting from code like this: (go (while true (println &quot;hello&quot;) (Thread/sleep 1000))) "><y>#</y><d>2019-10-26</d><h>16:23</h><w>pez</w>Can I interrupt an â€œevaluationâ€, resulting from code like this:
<pre>(go
    (while true
      (println &quot;hello&quot;)
      (Thread/sleep 1000)))
</pre></z><z id="t1572114635" t="dominicm I don&apos;t think so, it&apos;s in another thread now."><y>#</y><d>2019-10-26</d><h>18:30</h><w>dominicm</w>I don&apos;t think so, it&apos;s in another thread now.</z><z id="t1572116461" t="thheller [:attrs {:href &quot;/_/_/users/U0ETXRFEW&quot;}] there is no way to interrupt that no. it would also occupy an entire thread from the thread pool so this must be avoided at all cost ðŸ˜›"><y>#</y><d>2019-10-26</d><h>19:01</h><w>thheller</w><a>@pez</a> there is no way to interrupt that no. it would also occupy an entire thread from the thread pool so this must be avoided at all cost <b>ðŸ˜›</b></z><z id="t1572116622" t="dominicm I wonder if you can poke at that thread pool,"><y>#</y><d>2019-10-26</d><h>19:03</h><w>dominicm</w>I wonder if you can poke at that thread pool,</z><z id="t1572116713" t="thheller its a var in some namespace"><y>#</y><d>2019-10-26</d><h>19:05</h><w>thheller</w>its a var in some namespace</z><z id="t1572116750" t="pez How about if it is in ClojureScript? Iâ€™m just curious."><y>#</y><d>2019-10-26</d><h>19:05</h><w>pez</w>How about if it is in ClojureScript? Iâ€™m just curious.</z><z id="t1572116767" t="thheller CLJS doesn&apos;t have Thread/sleep?"><y>#</y><d>2019-10-26</d><h>19:06</h><w>thheller</w>CLJS doesn&apos;t have Thread/sleep?</z><z id="t1572116809" t="pez No, but it has similar constructs, no? So you can evaluate something and get â€œdoneâ€ back and it would keep running."><y>#</y><d>2019-10-26</d><h>19:06</h><w>pez</w>No, but it has similar constructs, no? So you can evaluate something and get â€œdoneâ€ back and it would keep running.</z><z id="t1572116819" t="thheller but no you can&apos;t interrupt an infinite loop in JS. the browser will kill it eventually together with your page though ðŸ˜‰"><y>#</y><d>2019-10-26</d><h>19:06</h><w>thheller</w>but no you can&apos;t interrupt an infinite loop in JS. the browser will kill it eventually together with your page though <b>ðŸ˜‰</b></z><z id="t1572116839" t="thheller no, you can&apos;t block in JS"><y>#</y><d>2019-10-26</d><h>19:07</h><w>thheller</w>no, you can&apos;t block in JS</z><z id="t1572116870" t="dominicm There&apos;s no sleep function at least"><y>#</y><d>2019-10-26</d><h>19:07</h><w>dominicm</w>There&apos;s no sleep function at least</z><z id="t1572116872" t="thheller if you just keep doing work nothing else will ever happen and your browser/node will lock up"><y>#</y><d>2019-10-26</d><h>19:07</h><w>thheller</w>if you just keep doing work nothing else will ever happen and your browser/node will lock up</z><z id="t1572116890" t="dominicm There are blocking functions (e.g. Nodejs)"><y>#</y><d>2019-10-26</d><h>19:08</h><w>dominicm</w>There are blocking functions (e.g. Nodejs)</z><z id="t1572117046" t="thheller ok yes. there are ways to block, but it is a terrible idea to do that ðŸ˜›"><y>#</y><d>2019-10-26</d><h>19:10</h><w>thheller</w>ok yes. there are ways to block, but it is a terrible idea to do that <b>ðŸ˜›</b></z><z id="t1572117076" t="thheller its ok if that is the only thing your program is supposed to be doing anyways"><y>#</y><d>2019-10-26</d><h>19:11</h><w>thheller</w>its ok if that is the only thing your program is supposed to be doing anyways</z><z id="t1572117914" t="pez So in a ClojureScript REPL, using nREPL, is it possible to interrupt this? ((fn foo [] (println &quot;hello&quot;) (js/setTimeout foo 1000)))"><y>#</y><d>2019-10-26</d><h>19:25</h><w>pez</w>So in a ClojureScript REPL, using nREPL, is it possible to interrupt this? <pre>((fn foo []
   (println &quot;hello&quot;)
   (js/setTimeout foo 1000)))</pre></z><z id="t1572118064" t="thheller no"><y>#</y><d>2019-10-26</d><h>19:27</h><w>thheller</w>no</z><z id="t1572118065" t="pez Or does that fall under this? &gt; no you canâ€™t interrupt an infinite loop in JS"><y>#</y><d>2019-10-26</d><h>19:27</h><w>pez</w>Or does that fall under this?
&gt; no you canâ€™t interrupt an infinite loop in JS</z><z id="t1572118086" t="thheller well it will have returned a number"><y>#</y><d>2019-10-26</d><h>19:28</h><w>thheller</w>well it will have returned a number</z><z id="t1572118097" t="thheller you can use that number to call (js/clearTimeout num)"><y>#</y><d>2019-10-26</d><h>19:28</h><w>thheller</w>you can use that number to call <code>(js/clearTimeout num)</code></z><z id="t1572118149" t="pez Yeah, but thatâ€™s cheating. ðŸ˜ƒ"><y>#</y><d>2019-10-26</d><h>19:29</h><w>pez</w>Yeah, but thatâ€™s cheating. <b>ðŸ˜ƒ</b></z><z id="t1572118150" t="thheller but that only works if you hit it before the first repeat ðŸ˜‰"><y>#</y><d>2019-10-26</d><h>19:29</h><w>thheller</w>but that only works if you hit it before the first repeat <b>ðŸ˜‰</b></z><z id="t1572118194" t="thheller but no that will forever keep doing its thing. no way to stop it. at least it will allow the browser to do other stuff while waiting for the timeout ðŸ˜›"><y>#</y><d>2019-10-26</d><h>19:29</h><w>thheller</w>but no that will forever keep doing its thing. no way to stop it. at least it will allow the browser to do other stuff while waiting for the timeout <b>ðŸ˜›</b></z><z id="t1572118196" t="pez Indeed. It keeps printing here."><y>#</y><d>2019-10-26</d><h>19:29</h><w>pez</w>Indeed. It keeps printing here.</z><z id="t1572118292" t="thheller you can override what setTimeout does but that gets into really messy territory ðŸ˜›"><y>#</y><d>2019-10-26</d><h>19:31</h><w>thheller</w>you can override what <code>setTimeout</code> does but that gets into really messy territory <b>ðŸ˜›</b></z><z id="t1572118311" t="pez At least in a browser app I can reload the page."><y>#</y><d>2019-10-26</d><h>19:31</h><w>pez</w>At least in a browser app I can reload the page.</z><z id="t1572118404" t="pez Iâ€™m asking this because weâ€™re implementing the interrupt op in Calva."><y>#</y><d>2019-10-26</d><h>19:33</h><w>pez</w>Iâ€™m asking this because weâ€™re implementing the interrupt op in Calva.</z><z id="t1572118430" t="dominicm Seems like there&apos;d be some value in a debugging api provided by browsers that had these registries available."><y>#</y><d>2019-10-26</d><h>19:33</h><w>dominicm</w>Seems like there&apos;d be some value in a debugging api provided by browsers that had these registries available.</z><z id="t1572118439" t="thheller interrupt doesn&apos;t even work reliably in clojure/JVM"><y>#</y><d>2019-10-26</d><h>19:33</h><w>thheller</w>interrupt doesn&apos;t even work reliably in clojure/JVM</z><z id="t1572118444" t="pez And we can now stop trying to figure out how these constructs would be interrupted. ðŸ˜ƒ"><y>#</y><d>2019-10-26</d><h>19:34</h><w>pez</w>And we can now stop trying to figure out how these constructs would be interrupted. <b>ðŸ˜ƒ</b></z><z id="t1572251319" t="shen There&apos;s been some recent work on interrupts (in JVM): https://github.com/nrepl/nrepl/pull/153"><y>#</y><d>2019-10-28</d><h>08:28</h><w>shen</w>There&apos;s been some recent work on interrupts (in JVM): <a href="https://github.com/nrepl/nrepl/pull/153" target="_blank">https://github.com/nrepl/nrepl/pull/153</a></z><z id="t1572251329" t="shen and https://github.com/nrepl/nrepl/pull/163"><y>#</y><d>2019-10-28</d><h>08:28</h><w>shen</w>and <a href="https://github.com/nrepl/nrepl/pull/163" target="_blank">https://github.com/nrepl/nrepl/pull/163</a></z><z id="t1572251757" t="bozhidar FYI - Iâ€™ve ported the nREPL ops docs generation to cider-nrepl https://docs.cider.mx/cider-nrepl/nrepl-api/ops.html"><y>#</y><d>2019-10-28</d><h>08:35</h><w>bozhidar</w>FYI - Iâ€™ve ported the nREPL ops docs generation to cider-nrepl <a href="https://docs.cider.mx/cider-nrepl/nrepl-api/ops.html" target="_blank">https://docs.cider.mx/cider-nrepl/nrepl-api/ops.html</a></z><z id="t1572251816" t="bozhidar Probably at some point weâ€™ll have to make this reusable, so any middleware can use it, but at least Iâ€™ve solved the most pressing and long-standing issue of generating some API docs for cider-nrepl itself."><y>#</y><d>2019-10-28</d><h>08:36</h><w>bozhidar</w>Probably at some point weâ€™ll have to make this reusable, so any middleware can use it, but at least Iâ€™ve solved the most pressing and long-standing issue of generating some API docs for cider-nrepl itself.</z><z id="t1572252141" t="pez That is awesome, [:attrs {:href &quot;/_/_/users/U051BLM8F&quot;}] !!!"><y>#</y><d>2019-10-28</d><h>08:42</h><w>pez</w>That is awesome, <a>@bozhidar</a>!!!</z><z id="t1572252160" t="shen I can&apos;t remember if we can interrupt a thread that was spawned by the main session thread, but if if we are using a shared thread pool to run a fn, then without some knowledge of the threadpool, not sure how we can just interrupt something running in it?"><y>#</y><d>2019-10-28</d><h>08:42</h><w>shen</w>I can&apos;t remember if we can interrupt a thread that was spawned by the main session thread, but if if we are using a shared thread pool to run a fn, then without some knowledge of the threadpool, not sure how we can just interrupt something running in it?</z><z id="t1572252169" t="shen (sorry, interlacing the conversation)"><y>#</y><d>2019-10-28</d><h>08:42</h><w>shen</w>(sorry, interlacing the conversation)</z><z id="t1572252186" t="pez Â¯\(ãƒ„)/Â¯"><y>#</y><d>2019-10-28</d><h>08:43</h><r>pez</r>Â¯\(ãƒ„)/Â¯</z><z id="t1572252307" t="bozhidar [:attrs {:href &quot;/_/_/users/U1XERPZ18&quot;}] If we can do this, thatâ€™d be great, but Iâ€™m not sure how we can get any insight as to where exactly some thread spawned from the main thread ended up."><y>#</y><d>2019-10-28</d><h>08:45</h><w>bozhidar</w><a>@shen</a> If we can do this, thatâ€™d be great, but Iâ€™m not sure how we can get any insight as to where exactly some thread spawned from the main thread ended up.</z><z id="t1572252342" t="bozhidar I never really looked into this, though. I just assumed it probably wasnâ€™t feasible (or it was pretty hard) if Chas didnâ€™t implement it initially."><y>#</y><d>2019-10-28</d><h>08:45</h><w>bozhidar</w>I never really looked into this, though. I just assumed it probably wasnâ€™t feasible (or it was pretty hard) if Chas didnâ€™t implement it initially.</z><z id="t1572252374" t="shen Do you know about the interrupting non-pooled thread part?"><y>#</y><d>2019-10-28</d><h>08:46</h><w>shen</w>Do you know about the interrupting non-pooled thread part?</z><z id="t1572252547" t="shen https://github.com/nrepl/nrepl/blob/f189b4c07579f8b6752f2e385e52c3680c2e1d60/src/clojure/nrepl/middleware/session.clj#L204-L207 &lt;- how we make non-pooled threads"><y>#</y><d>2019-10-28</d><h>08:49</h><w>shen</w><a href="https://github.com/nrepl/nrepl/blob/f189b4c07579f8b6752f2e385e52c3680c2e1d60/src/clojure/nrepl/middleware/session.clj#L204-L207" target="_blank">https://github.com/nrepl/nrepl/blob/f189b4c07579f8b6752f2e385e52c3680c2e1d60/src/clojure/nrepl/middleware/session.clj#L204-L207</a> &lt;- how we make non-pooled threads</z><z id="t1572267793" t="bozhidar [:attrs {:href &quot;/_/_/users/U1XERPZ18&quot;}] What about it exactly? I donâ€™t think we have any provisions for interrupting anything besides the session thread."><y>#</y><d>2019-10-28</d><h>13:03</h><w>bozhidar</w><a>@shen</a> What about it exactly? I donâ€™t think we have any provisions for interrupting anything besides the session thread.</z><z id="t1572267885" t="bozhidar I think that even to be able to track the relationship between parent and child threads we need some explicit tracking with a ThreadGroup or something similar."><y>#</y><d>2019-10-28</d><h>13:04</h><w>bozhidar</w>I think that even to be able to track the relationship between parent and child threads we need some explicit tracking with a ThreadGroup or something similar.</z><z id="t1572267909" t="bozhidar If I recall correctly Java threads donâ€™t keep any info about the their children/parent threads."><y>#</y><d>2019-10-28</d><h>13:05</h><w>bozhidar</w>If I recall correctly Java threads donâ€™t keep any info about the their children/parent threads.</z><z id="t1572268054" t="dominicm I&apos;ve never heard of that happening."><y>#</y><d>2019-10-28</d><h>13:07</h><w>dominicm</w>I&apos;ve never heard of that happening.</z><z id="t1572268445" t="shen Ok. I wasn&apos;t sure if we had some way of doing that"><y>#</y><d>2019-10-28</d><h>13:14</h><w>shen</w>Ok. I wasn&apos;t sure if we had some way of doing that</z><z id="t1572268452" t="shen sounds like a no then"><y>#</y><d>2019-10-28</d><h>13:14</h><w>shen</w>sounds like a no then</z><z id="t1572268468" t="shen the code quoted just creates the main session thread, right?"><y>#</y><d>2019-10-28</d><h>13:14</h><w>shen</w>the code quoted just creates the main session thread, right?</z><z id="t1572421088" t="pez Before I file an issue, I want to check if Iâ€™m misunderstanding something. When creating a fresh re-frame app with 10x, using the Leiningen template I get this events.cljs file: (ns fresh-10x.events (:require [re-frame.core :as re-frame] [fresh-10x.db :as db] [day8.re-frame.tracing :refer-macros [fn-traced defn-traced]] )) (re-frame/reg-event-db ::initialize-db (fn-traced [_ _] db/default-db)) (re-frame/reg-event-db ::set-active-panel (fn-traced [db [_ active-panel]] (assoc db :active-panel active-panel))) Requesting info on this namespace (`fresh-10x.events`) gives back a response with an empty file entry (an empty array, as it happens). But if I add (def foo 42) to the file, then the info op resolves the file path. What gives?"><y>#</y><d>2019-10-30</d><h>07:38</h><w>pez</w>Before I file an issue, I want to check if Iâ€™m misunderstanding something. When creating a fresh re-frame app with 10x, using the Leiningen template I get this <code>events.cljs</code> file: <pre>(ns fresh-10x.events
  (:require
   [re-frame.core :as re-frame]
   [fresh-10x.db :as db]
   [day8.re-frame.tracing :refer-macros [fn-traced defn-traced]]
   ))

(re-frame/reg-event-db
 ::initialize-db
 (fn-traced [_ _]
   db/default-db))

(re-frame/reg-event-db
 ::set-active-panel
 (fn-traced [db [_ active-panel]]
   (assoc db :active-panel active-panel)))
</pre>
Requesting <code>info</code> on this namespace (`fresh-10x.events`) gives back a response with an empty <code>file</code> entry (an empty array, as it happens). But if I add <code>(def foo 42)</code> to the file, then the <code>info</code> op resolves the file path. What gives?</z><z id="t1572428410" t="bozhidar &gt; the code quoted just creates the main session thread, right?"><y>#</y><d>2019-10-30</d><h>09:40</h><w>bozhidar</w>&gt; the code quoted just creates the main session thread, right?</z><z id="t1572428413" t="bozhidar [:attrs {:href &quot;/_/_/users/U1XERPZ18&quot;}] Yes."><y>#</y><d>2019-10-30</d><h>09:40</h><w>bozhidar</w><a>@shen</a> Yes.</z><z id="t1572512766" t="pez Should I file an issue with the info mystery I mentioned above?"><y>#</y><d>2019-10-31</d><h>09:06</h><w>pez</w>Should I file an issue with the <code>info</code> mystery I mentioned above?</z><z id="t1572514646" t="bozhidar [:attrs {:href &quot;/_/_/users/U0ETXRFEW&quot;}] Definitely."><y>#</y><d>2019-10-31</d><h>09:37</h><w>bozhidar</w><a>@pez</a> Definitely.</z><z id="t1572515355" t="pez Cool. Will do. Then if I can solve my problems with hacking on cider-nrepl, maybe I can even try fix it. ðŸ˜ƒ"><y>#</y><d>2019-10-31</d><h>09:49</h><w>pez</w>Cool. Will do. Then if I can solve my problems with hacking on cider-nrepl, maybe I can even try fix it. <b>ðŸ˜ƒ</b></z><z id="t1572515705" t="bozhidar Thatâ€™s likely something in orchard , as thatâ€™s there the real info functionality lives."><y>#</y><d>2019-10-31</d><h>09:55</h><w>bozhidar</w>Thatâ€™s likely something in <code>orchard</code>, as thatâ€™s there the real info functionality lives.</z><z id="t1572515717" t="bozhidar cider-nrepl just delegates to orchard ."><y>#</y><d>2019-10-31</d><h>09:55</h><w>bozhidar</w><code>cider-nrepl</code> just delegates to <code>orchard</code>.</z><z id="t1572518442" t="dominicm Even for cljs?"><y>#</y><d>2019-10-31</d><h>10:40</h><w>dominicm</w>Even for cljs?</z><z id="t1572518452" t="dominicm I&apos;m guessing it&apos;s a problem with getting the env"><y>#</y><d>2019-10-31</d><h>10:40</h><w>dominicm</w>I&apos;m guessing it&apos;s a problem with getting the env</z><z id="t1572518478" t="bozhidar [:attrs {:href &quot;/_/_/users/U09LZR36F&quot;}] Yes."><y>#</y><d>2019-10-31</d><h>10:41</h><w>bozhidar</w><a>@dominicm</a> Yes.</z><z id="t1572518511" t="bozhidar Now the only thing weâ€™re still using for cljs-tooling is the completion code, as itâ€™s integration with compliment was never fully completed."><y>#</y><d>2019-10-31</d><h>10:41</h><w>bozhidar</w>Now the only thing weâ€™re still using for <code>cljs-tooling</code> is the completion code, as itâ€™s integration with <code>compliment</code> was never fully completed.</z><z id="t1572557640" t="pez The issue is there for clj as well."><y>#</y><d>2019-10-31</d><h>21:34</h><w>pez</w>The issue is there for <code>clj</code> as well.</z><z id="t1572557658" t="pez Can I read about how to hack on orchard somewhere?"><y>#</y><d>2019-10-31</d><h>21:34</h><w>pez</w>Can I read about how to hack on orchard somewhere?</z><z id="t1572559451" t="pez Hereâ€™s the issue. Please let me know how I can improve it. https://github.com/clojure-emacs/orchard/issues/75"><y>#</y><d>2019-10-31</d><h>22:04</h><w>pez</w>Hereâ€™s the issue. Please let me know how I can improve it. <a href="https://github.com/clojure-emacs/orchard/issues/75" target="_blank">https://github.com/clojure-emacs/orchard/issues/75</a></z><z id="t1572588886" t="bozhidar [:attrs {:href &quot;/_/_/users/U0ETXRFEW&quot;}] Orchard is a regular library. Hacking on it is pretty natural IMO. Just take a look at ."><y>#</y><d>2019-11-01</d><h>06:14</h><w>bozhidar</w><a>@pez</a> Orchard is a regular library. Hacking on it is pretty natural IMO. Just take a look at <code></code>.</z><z id="t1572596930" t="pez [:attrs {:href &quot;/_/_/users/U051BLM8F&quot;}] , Iâ€™ve gotten that far. ðŸ˜„ I should have been clearerâ€¦ What Iâ€™d like to setup is so that I can run my orchard.info.clj end-to-end, from the editor and explore what happens down there in info.clj . If thatâ€™s possible."><y>#</y><d>2019-11-01</d><h>08:28</h><w>pez</w><a>@bozhidar</a>, Iâ€™ve gotten that far. <b>ðŸ˜„</b> I should have been clearerâ€¦ What Iâ€™d like to setup is so that I can run my <code>orchard.info.clj</code> end-to-end, from the editor and explore what happens down there in <code>info.clj</code>. If thatâ€™s possible.</z><z id="t1572601277" t="bozhidar [:attrs {:href &quot;/_/_/users/U0ETXRFEW&quot;}] I just develop it like any other library and test the changes in the REPL, while hacking on something. Alternatively you can rebuild cider-nrepl with the snapshot of orchard and test your changes end-to-end in this manner."><y>#</y><d>2019-11-01</d><h>09:41</h><w>bozhidar</w><a>@pez</a> I just develop it like any other library and test the changes in the REPL, while hacking on something. Alternatively you can rebuild cider-nrepl with the snapshot of orchard and test your changes end-to-end in this manner.</z><z id="t1572601615" t="pez Yeah, Iâ€™ll just have to figure out why my lein install of cider-nrepl isnâ€™t used. Iâ€™m doing it the â€œjust another library wayâ€ now. Added this test: https://github.com/PEZ/orchard/commit/754ae065cac18e97db80164a261e8e44f76792b9 If you have feedback to an orchard noob, please donâ€™t hesitate. ðŸ˜ƒ"><y>#</y><d>2019-11-01</d><h>09:46</h><w>pez</w>Yeah, Iâ€™ll just have to figure out why my <code>lein install</code> of <code>cider-nrepl</code> isnâ€™t used. Iâ€™m doing it the â€œjust another library wayâ€ now. Added this test: <a href="https://github.com/PEZ/orchard/commit/754ae065cac18e97db80164a261e8e44f76792b9" target="_blank">https://github.com/PEZ/orchard/commit/754ae065cac18e97db80164a261e8e44f76792b9</a>
If you have feedback to an orchard noob, please donâ€™t hesitate. <b>ðŸ˜ƒ</b></z><z id="t1572610205" t="pez I have isolated the problem down to that meta/ns-meta relies on (ns-publics) to give it something to get a var out of, and then run (var-meta) on that to get the file path. So then if the namespace doesnâ€™t have any publics we get get a nil file entry. A brute fix is this (defn ns-meta [ns] (when ns (merge (meta ns) {:ns (ns-name ns) :name (ns-name ns) :file (or (-&gt; (ns-publics ns) first second var-meta :file) (-&gt; (ns/canonical-source ns) .getPath)) :line 1}))) But it feels like there should be something more elegant/safeâ€¦ What do you guys think?"><y>#</y><d>2019-11-01</d><h>12:10</h><w>pez</w>I have isolated the problem down to that <code>meta/ns-meta</code> relies on <code>(ns-publics)</code> to give it something to get a var out of, and then run <code>(var-meta)</code> on that to get the file path. So then if the namespace doesnâ€™t have any publics we get get a <code>nil</code> file entry. A brute fix is this <pre>(defn ns-meta
  [ns]
  (when ns
    (merge
     (meta ns)
     {:ns (ns-name ns)
      :name (ns-name ns)
      :file (or (-&gt; (ns-publics ns)
                    first
                    second
                    var-meta
                    :file)
                (-&gt;
                 (ns/canonical-source ns)
                 .getPath))
      :line 1})))</pre>
But it feels like there should be something more elegant/safeâ€¦ What do you guys think?</z><z id="t1573305044" t="pez Is there a reason why zprint dependencies are not provided directly with cider-nrepl as they are with puget and fipp?"><y>#</y><d>2019-11-09</d><h>13:10</h><w>pez</w>Is there a reason why zprint dependencies are not provided directly with cider-nrepl as they are with puget and fipp?</z><z id="t1573329672" t="dominicm Puget and fipp are grandfathered in. They&apos;d be removed if it wouldn&apos;t break the backwards compatibility. The goal is to make cider lighter."><y>#</y><d>2019-11-09</d><h>20:01</h><w>dominicm</w>Puget and fipp are grandfathered in. They&apos;d be removed if it wouldn&apos;t break the backwards compatibility. The goal is to make cider lighter.</z><z id="t1573330313" t="pez Oki. Not sending the PR then. ðŸ˜Ž"><y>#</y><d>2019-11-09</d><h>20:11</h><w>pez</w>Oki. Not sending the PR then. <b>ðŸ˜Ž</b></z><z id="t1573339269" t="pez I am having problems giving zprint this option map over nREPL: {:record {:to-string? true}} , because I donâ€™t seem to be able to bencode booleans to anything else but 0/1, and zprint checks that it is a booleanâ€¦ Is it possible to send a boolean proper over bencode? Or is there some other way I can achieve this? Feels like a problem I should have encountered before, but I havenâ€™tâ€¦"><y>#</y><d>2019-11-09</d><h>22:41</h><w>pez</w>I am having problems giving <code>zprint</code> this option map over nREPL: <code>{:record {:to-string? true}}</code>, because I donâ€™t seem to be able to bencode booleans to anything else but 0/1, and zprint checks that it is a booleanâ€¦  Is it possible to send a boolean proper over bencode? Or is there some other way I can achieve this? Feels like a problem I should have encountered before, but I havenâ€™tâ€¦</z><z id="t1573414667" t="shen I wonder if we should read-string the value?"><y>#</y><d>2019-11-10</d><h>19:37</h><r>shen</r>I wonder if we should read-string the value?</z><z id="t1573414779" t="shen It feels quite limiting to only be able to use what can survive the bencode conversion to and fro"><y>#</y><d>2019-11-10</d><h>19:39</h><r>shen</r>It feels quite limiting to only be able to use what can survive the bencode conversion to and fro</z><z id="t1573415003" t="shen Googling &quot;:nrepl.middleware.print/options&quot; doesn&apos;t yield that many results, so I&apos;m guessing this doesn&apos;t get used much other than to pass {:right-margin 70} or similar around"><y>#</y><d>2019-11-10</d><h>19:43</h><r>shen</r>Googling <code>&quot;:nrepl.middleware.print/options&quot;</code> doesn&apos;t yield that many results, so I&apos;m guessing this doesn&apos;t get used much other than to pass <code>{:right-margin 70}</code> or similar around</z><z id="t1573467650" t="pez Yeah, it is a bit surprising that it took me so long to run in to this limitation. A bit hard to see how it could be fixed though..."><y>#</y><d>2019-11-11</d><h>10:20</h><r>pez</r>Yeah, it is a bit surprising that it took me so long to run in to this limitation. A bit hard to see how it could be fixed though...</z><z id="t1573475079" t="shen I think if we allowed that to be passed as a (edn) string (v.s. bencode map), that could be better?"><y>#</y><d>2019-11-11</d><h>12:24</h><r>shen</r>I think if we allowed that to be passed as a (edn) string (v.s. bencode map), that could be better?</z><z id="t1573475116" t="shen that would require a (non-breaking) change to nrepl though"><y>#</y><d>2019-11-11</d><h>12:25</h><r>shen</r>that would require a (non-breaking) change to nrepl though</z><z id="t1573475271" t="pez Could be made opt in, though?"><y>#</y><d>2019-11-11</d><h>12:27</h><r>pez</r>Could be made opt in, though?</z><z id="t1573475375" t="shen yes definitely"><y>#</y><d>2019-11-11</d><h>12:29</h><r>shen</r>yes definitely</z><z id="t1573475420" t="shen (if-not (string? opt) opt (read-string opt)) in the right place"><y>#</y><d>2019-11-11</d><h>12:30</h><r>shen</r><code>(if-not (string? opt) opt (read-string opt))</code> in the right place</z><z id="t1573475467" t="pez I was more thinking in some config of the transport."><y>#</y><d>2019-11-11</d><h>12:31</h><r>pez</r>I was more thinking in some config of the transport.</z><z id="t1573475565" t="shen guess we could even allow boolean in the bencode transport. Would just need to think about how to encode it"><y>#</y><d>2019-11-11</d><h>12:32</h><r>shen</r>guess we could even allow boolean in the bencode transport. Would just need to think about how to encode it</z><z id="t1573475962" t="shen (I don&apos;t think it&apos;s part of the bencode spec)"><y>#</y><d>2019-11-11</d><h>12:39</h><r>shen</r>(I don&apos;t think it&apos;s part of the bencode spec)</z><z id="t1573476033" t="pez It isn&apos;t. But, yeah, doesn&apos;t need to be. haha."><y>#</y><d>2019-11-11</d><h>12:40</h><r>pez</r>It isn&apos;t. But, yeah, doesn&apos;t need to be. haha.</z><z id="t1573476136" t="pez b0e /`b1e`, or bfe /`bte`, maybe."><y>#</y><d>2019-11-11</d><h>12:42</h><r>pez</r><code>b0e</code>/`b1e`, or <code>bfe</code>/`bte`, maybe.</z><z id="t1573476244" t="pez Would be nice to be able to transfer nil as well."><y>#</y><d>2019-11-11</d><h>12:44</h><r>pez</r>Would be nice to be able to transfer <code>nil</code> as well.</z><z id="t1573477791" t="shen I just had a look around at how various other bencode implementations dealt with this. Nothing jumped out as an especially good options"><y>#</y><d>2019-11-11</d><h>13:09</h><r>shen</r>I just had a look around at how various other bencode implementations dealt with this. Nothing jumped out as an especially good options</z><z id="t1573478190" t="shen something different:"><y>#</y><d>2019-11-11</d><h>13:16</h><r>shen</r>something different:</z><z id="t1573478208" t="shen what are you trying to use as the print-fn for zprint?"><y>#</y><d>2019-11-11</d><h>13:16</h><r>shen</r>what are you trying to use as the print-fn for zprint?</z><z id="t1573478219" t="shen zprint.core/zprint doesn&apos;t have the right signature"><y>#</y><d>2019-11-11</d><h>13:16</h><r>shen</r><code>zprint.core/zprint</code> doesn&apos;t have the right signature</z><z id="t1573478232" t="shen it needs to be [value writer options]"><y>#</y><d>2019-11-11</d><h>13:17</h><r>shen</r>it needs to be <code>[value writer options]</code></z><z id="t1573478419" t="shen not actually sure what has that signature, other than the built in fn&apos;s"><y>#</y><d>2019-11-11</d><h>13:20</h><r>shen</r>not actually sure what has that signature, other than the built in fn&apos;s</z><z id="t1573478708" t="shen (i.e. to use zprint, you might need to provide a wrapper fn anyways"><y>#</y><d>2019-11-11</d><h>13:25</h><r>shen</r>(i.e. to use zprint, you might need to provide a wrapper fn anyways</z><z id="t1573479520" t="pez I&apos;m using cider.nrepl.pprint/zprint-pprint , and providing the options via nrepl.middleware.print/options ."><y>#</y><d>2019-11-11</d><h>13:38</h><r>pez</r>I&apos;m using <code>cider.nrepl.pprint/zprint-pprint</code>, and providing the options via <code>nrepl.middleware.print/options</code>.</z><z id="t1573479895" t="shen ah-ha"><y>#</y><d>2019-11-11</d><h>13:44</h><r>shen</r>ah-ha</z><z id="t1573479921" t="shen then think it might be better to patch https://github.com/clojure-emacs/cider-nrepl/blob/7cdbe4d32b4893ab1d856b92cc802f96bb31f1f5/src/cider/nrepl/pprint.clj#L86 to coerce :to-string? to boolean"><y>#</y><d>2019-11-11</d><h>13:45</h><r>shen</r>then think it might be better to patch <a href="https://github.com/clojure-emacs/cider-nrepl/blob/7cdbe4d32b4893ab1d856b92cc802f96bb31f1f5/src/cider/nrepl/pprint.clj#L86" target="_blank">https://github.com/clojure-emacs/cider-nrepl/blob/7cdbe4d32b4893ab1d856b92cc802f96bb31f1f5/src/cider/nrepl/pprint.clj#L86</a> to coerce <code>:to-string?</code> to boolean</z><z id="t1573480033" t="shen (if (get-in options [:record :to-string?]) (update-in options [:record :to-string?] boolean) options)"><y>#</y><d>2019-11-11</d><h>13:47</h><r>shen</r><code>(if (get-in options [:record :to-string?]) (update-in options [:record :to-string?] boolean) options)</code></z><z id="t1573480079" t="shen cider-nrepl releases way more frequently than nrepl itself"><y>#</y><d>2019-11-11</d><h>13:47</h><r>shen</r>cider-nrepl releases way more frequently than nrepl itself</z><z id="t1573480187" t="pez Kim Kinnear is going to relax the spec to allow for 1 as representing not false . So this particular option will be covered that way."><y>#</y><d>2019-11-11</d><h>13:49</h><r>pez</r>Kim Kinnear is going to relax the spec to allow for <code>1</code> as representing not <code>false</code>. So this particular option will be covered that way.</z><z id="t1573375324" t="dominicm There isn&apos;t booleans in bencode"><y>#</y><d>2019-11-10</d><h>08:42</h><w>dominicm</w>There isn&apos;t booleans in bencode</z><z id="t1573375338" t="dominicm It&apos;s been worked around mostly"><y>#</y><d>2019-11-10</d><h>08:42</h><w>dominicm</w>It&apos;s been worked around mostly</z><z id="t1573377351" t="pez Yeah, [:attrs {:href &quot;/_/_/users/U0LV6TT0Q&quot;}] is going to work around it for me. ðŸ˜Ž"><y>#</y><d>2019-11-10</d><h>09:15</h><w>pez</w>Yeah, <a>@kkinnear</a> is going to work around it for me. <b>ðŸ˜Ž</b></z><z id="t1573379140" t="pez And I am starting to think I should try use the EDN transport instead. A lot of the problems I have fought lately has been related to that I do not allow the data to stay in EDN as far as possible."><y>#</y><d>2019-11-10</d><h>09:45</h><w>pez</w>And I am starting to think I should try use the EDN transport instead. A lot of the problems I have fought lately has been related to that I do not allow the data to stay in EDN as far as possible.</z><z id="t1573415344" t="shen There&apos;s also a few features on the horizon that might be EDN transport only."><y>#</y><d>2019-11-10</d><h>19:49</h><r>shen</r>There&apos;s also a few features on the horizon that might be EDN transport only.</z><z id="t1573415389" t="shen including the upgrading socket repl to nREPL one..."><y>#</y><d>2019-11-10</d><h>19:49</h><r>shen</r>including the upgrading socket repl to nREPL one...</z><z id="t1573417521" t="pez Oh, wow. Sounds crazily cool!"><y>#</y><d>2019-11-10</d><h>20:25</h><r>pez</r>Oh, wow. Sounds crazily cool!</z><z id="t1573417607" t="pez Is it still only clojure cli where I can start the edn transport server via a command line switch?"><y>#</y><d>2019-11-10</d><h>20:26</h><r>pez</r>Is it still only clojure cli where I can start the edn transport server via a command line switch?</z><z id="t1573455701" t="shen hmm.. how do you normally start the repl process?"><y>#</y><d>2019-11-11</d><h>07:01</h><r>shen</r>hmm.. how do you normally start the repl process?</z><z id="t1573455704" t="shen lein repl ?"><y>#</y><d>2019-11-11</d><h>07:01</h><r>shen</r><code>lein repl</code>?</z><z id="t1573455797" t="shen think setting it in .nrepl.edn also works?"><y>#</y><d>2019-11-11</d><h>07:03</h><r>shen</r>think setting it in <code>.nrepl.edn</code> also works?</z><z id="t1573458004" t="pez Calva supports tools.deps, lein and shadow-cljs. Ideally Iâ€™d like to add whatever is needed to the command lines starting the processes. But Iâ€™ll check out .nrep.edn too."><y>#</y><d>2019-11-11</d><h>07:40</h><r>pez</r>Calva supports tools.deps, lein and shadow-cljs.  Ideally Iâ€™d like to add whatever is needed to the command lines starting the processes. But Iâ€™ll check out <code>.nrep.edn</code> too.</z><z id="t1573458610" t="shen Bottom of this page: https://nrepl.org/nrepl/0.6.0/usage/server.html"><y>#</y><d>2019-11-11</d><h>07:50</h><r>shen</r>Bottom of this page: <a href="https://nrepl.org/nrepl/0.6.0/usage/server.html" target="_blank">https://nrepl.org/nrepl/0.6.0/usage/server.html</a></z><z id="t1573458733" t="shen There was a discussion of configuring nrepl via JVM opts: https://github.com/nrepl/nrepl/issues/54"><y>#</y><d>2019-11-11</d><h>07:52</h><r>shen</r>There was a discussion of configuring nrepl via JVM opts: <a href="https://github.com/nrepl/nrepl/issues/54" target="_blank">https://github.com/nrepl/nrepl/issues/54</a></z><z id="t1573458869" t="shen in lein, it&apos;s passed via :repl-options"><y>#</y><d>2019-11-11</d><h>07:54</h><r>shen</r>in lein, it&apos;s passed via <code>:repl-options</code></z><z id="t1573458924" t="shen guess .nrepl.edn is something different, but saves you the effort of threading config through whichever tool you are supporting?"><y>#</y><d>2019-11-11</d><h>07:55</h><r>shen</r>guess <code>.nrepl.edn</code> is something different, but saves you the effort of threading config through whichever tool you are supporting?</z><z id="t1573458994" t="shen https://shadow-cljs.github.io/docs/UsersGuide.html#nREPL &lt;- how to configure shadow"><y>#</y><d>2019-11-11</d><h>07:56</h><r>shen</r><a href="https://shadow-cljs.github.io/docs/UsersGuide.html#nREPL" target="_blank">https://shadow-cljs.github.io/docs/UsersGuide.html#nREPL</a> &lt;- how to configure shadow</z><z id="t1573460959" t="pez Thanks. I was looking at the shadow-docs yesterday and it wasn&apos;t obvious to me what I should put there to get the EDN selected."><y>#</y><d>2019-11-11</d><h>08:29</h><r>pez</r>Thanks. I was looking at the shadow-docs yesterday and it wasn&apos;t obvious to me what I should put there to get the EDN selected.</z><z id="t1573460983" t="pez (Still isn&apos;t. so if you can give me a hint. ðŸ˜ƒ )"><y>#</y><d>2019-11-11</d><h>08:29</h><r>pez</r>(Still isn&apos;t. so if you can give me a hint. <b>ðŸ˜ƒ</b> )</z><z id="t1573462985" t="shen I&apos;m looking now, think shadow might need to do some work to support it: https://github.com/thheller/shadow-cljs/blob/92bb8076f6d1774bdbcf32dc8b0e14ce949c769a/src/main/shadow/cljs/devtools/server/nrepl.clj#L123"><y>#</y><d>2019-11-11</d><h>09:03</h><r>shen</r>I&apos;m looking now, think shadow might need to do some work to support it: <a href="https://github.com/thheller/shadow-cljs/blob/92bb8076f6d1774bdbcf32dc8b0e14ce949c769a/src/main/shadow/cljs/devtools/server/nrepl.clj#L123" target="_blank">https://github.com/thheller/shadow-cljs/blob/92bb8076f6d1774bdbcf32dc8b0e14ce949c769a/src/main/shadow/cljs/devtools/server/nrepl.clj#L123</a></z><z id="t1573463037" t="shen or rather, it seems to support .nrepl.edn"><y>#</y><d>2019-11-11</d><h>09:03</h><r>shen</r>or rather, it seems to support <code>.nrepl.edn</code></z><z id="t1573463070" t="shen but not by adding things into shadow-cljs.edn"><y>#</y><d>2019-11-11</d><h>09:04</h><r>shen</r>but not by adding things into <code>shadow-cljs.edn</code></z><z id="t1573463943" t="pez Thanks again!"><y>#</y><d>2019-11-11</d><h>09:19</h><r>pez</r>Thanks again!</z><z id="t1573464116" t="pez [:attrs {:href &quot;/_/_/users/U05224H0W&quot;}] , is this something you would consider adding as a configuration option? I could probably go via .nrepl.edn , and maybe even should go that way, but so far I haven&apos;t let Calva edit config files on the user&apos;s behalf. It&apos;s pretty nice to be able to specify these things on the command line."><y>#</y><d>2019-11-11</d><h>09:21</h><r>pez</r><a>@U05224H0W</a>, is this something you would consider adding as a configuration option? I could probably go via <code>.nrepl.edn</code>, and maybe even should go that way, but so far I haven&apos;t let Calva edit config files on the user&apos;s behalf. It&apos;s pretty nice to be able to specify these things on the command line.</z><z id="t1573464343" t="thheller add what? not entirely sure what you are talking about here"><y>#</y><d>2019-11-11</d><h>09:25</h><r>thheller</r>add what? not entirely sure what you are talking about here</z><z id="t1573464932" t="pez Sorry. Add a way to config the nrepl server to use another transport. (EDN transport is what I currently am considering to try with for Calva.)"><y>#</y><d>2019-11-11</d><h>09:35</h><r>pez</r>Sorry. Add a way to config the nrepl server to use another transport. (EDN transport is what I currently am considering to try with for Calva.)</z><z id="t1573464989" t="thheller as soon as the alpha tag disappears I guess? https://github.com/thheller/shadow-cljs/issues/514"><y>#</y><d>2019-11-11</d><h>09:36</h><r>thheller</r>as soon as the alpha tag disappears I guess? <a href="https://github.com/thheller/shadow-cljs/issues/514" target="_blank">https://github.com/thheller/shadow-cljs/issues/514</a></z><z id="t1573465023" t="thheller don&apos;t know why it has an alpha tag, not keeping up with whats going on over there"><y>#</y><d>2019-11-11</d><h>09:37</h><r>thheller</r>don&apos;t know why it has an alpha tag, not keeping up with whats going on over there</z><z id="t1573465059" t="thheller but I guess I can add the config option regardless"><y>#</y><d>2019-11-11</d><h>09:37</h><r>thheller</r>but I guess I can add the config option regardless</z><z id="t1573465061" t="pez The API is not settled, is one thing I have picked up."><y>#</y><d>2019-11-11</d><h>09:37</h><r>pez</r>The API is not settled, is one thing I have picked up.</z><z id="t1573465961" t="shen I was just about to comment on that issue"><y>#</y><d>2019-11-11</d><h>09:52</h><r>shen</r>I was just about to comment on that issue</z><z id="t1573466375" t="thheller https://github.com/thheller/shadow-cljs/commit/43050cf14338236a30d823a247e51e8cdf1a51ec"><y>#</y><d>2019-11-11</d><h>09:59</h><r>thheller</r><a href="https://github.com/thheller/shadow-cljs/commit/43050cf14338236a30d823a247e51e8cdf1a51ec" target="_blank">https://github.com/thheller/shadow-cljs/commit/43050cf14338236a30d823a247e51e8cdf1a51ec</a></z><z id="t1573466405" t="thheller trying to finish up some other work. will probably make a release later"><y>#</y><d>2019-11-11</d><h>10:00</h><r>thheller</r>trying to finish up some other work. will probably make a release later</z><z id="t1573467102" t="pez Working fast!"><y>#</y><d>2019-11-11</d><h>10:11</h><r>pez</r>Working fast!</z><z id="t1573510650" t="chrishacker Cross posting this here as well. Thanks in advance for any help."><y>#</y><d>2019-11-11</d><h>22:17</h><w>chrishacker</w>Cross posting this here as well. Thanks in advance for any help.</z><z id="t1573512020" t="dpsutton i use cider connect into a docker application every day"><y>#</y><d>2019-11-11</d><h>22:40</h><w>dpsutton</w>i use cider connect into a docker application every day</z><z id="t1573512023" t="dpsutton what issue are you having?"><y>#</y><d>2019-11-11</d><h>22:40</h><w>dpsutton</w>what issue are you having?</z><z id="t1573512045" t="dpsutton (cider-connect (list :host &quot;&quot; :port ,port :project-dir dir)) is from the emacs side"><y>#</y><d>2019-11-11</d><h>22:40</h><w>dpsutton</w><pre>(cider-connect (list :host &quot;&quot; :port ,port
                              :project-dir dir))
</pre>
is from the emacs side</z><z id="t1573523874" t="chrishacker We had misread/misunderstood the instructions. We were using :bind rather than :host for the key on the server side."><y>#</y><d>2019-11-12</d><h>01:57</h><w>chrishacker</w>We had misread/misunderstood the instructions. We were using :bind rather than :host for the key on the server side.</z><z id="t1573554396" t="bozhidar :bind is the right key for the server. host is used only in clients."><y>#</y><d>2019-11-12</d><h>10:26</h><w>bozhidar</w><code>:bind</code> is the right key for the server. <code>host</code> is used only in clients.</z><z id="t1576077507" t="Jakub HolÃ½ (HolyJak) Hello! Any tips how to connect to nRepl over drawbridge using clj ? I got it working with lein - see https://github.com/nrepl/drawbridge/issues/40 Thank you!"><y>#</y><d>2019-12-11</d><h>15:18</h><w>Jakub HolÃ½ (HolyJak)</w>Hello! Any tips how to connect to nRepl over drawbridge using <code>clj</code>? I got it working with <code>lein</code>  - see <a href="https://github.com/nrepl/drawbridge/issues/40" target="_blank">https://github.com/nrepl/drawbridge/issues/40</a> Thank you!</z><z id="t1576146547" t="Jakub HolÃ½ (HolyJak) FYI I have just published https://blog.jakubholy.net/nrepl-over-http-with-drwabridge-in-2020/"><y>#</y><d>2019-12-12</d><h>10:29</h><w>Jakub HolÃ½ (HolyJak)</w>FYI I have just published <a href="https://blog.jakubholy.net/nrepl-over-http-with-drwabridge-in-2020/" target="_blank">https://blog.jakubholy.net/nrepl-over-http-with-drwabridge-in-2020/</a></z><z id="t1576150429" t="bozhidar Nice!"><y>#</y><d>2019-12-12</d><h>11:33</h><w>bozhidar</w>Nice!</z><z id="t1576776762" t="Pavel KlavÃ­k Hi, trying to get Drawbridge running on my server. I get the following output when trying in lein: lein repl :connect "><y>#</y><d>2019-12-19</d><h>17:32</h><w>Pavel KlavÃ­k</w>Hi, trying to get Drawbridge running on my server. I get the following output when trying in lein:
<pre>lein repl :connect </pre>
</z><z id="t1576776768" t="Pavel KlavÃ­k Connecting to nREPL at ConnectException Connection refused: connect .DualStackPlainSocketImpl.connect0 (:-2) .DualStackPlainSocketImpl.socketConnect (:-1) .AbstractPlainSocketImpl.doConnect (:-1) .AbstractPlainSocketImpl.connectToAddress (:-1) .AbstractPlainSocketImpl.connect (:-1) .PlainSocketImpl.connect (:-1) .SocksSocketImpl.connect (:-1) .Socket.connect (:-1) org.apache.http.conn.socket.PlainConnectionSocketFactory.connectSocket (PlainConnectionSocketFactory.java:75) org.apache.http.impl.conn.DefaultHttpClientConnectionOperator.connect (DefaultHttpClientConnectionOperator.java:142) org.apache.http.impl.conn.BasicHttpClientConnectionManager.connect (BasicHttpClientConnectionManager.java:323) org.apache.http.impl.execchain.MainClientExec.establishRoute (MainClientExec.java:381) Bye for now!"><y>#</y><d>2019-12-19</d><h>17:32</h><w>Pavel KlavÃ­k</w><pre>Connecting to nREPL at 
ConnectException Connection refused: connect
        .DualStackPlainSocketImpl.connect0 (:-2)
        .DualStackPlainSocketImpl.socketConnect (:-1)
        .AbstractPlainSocketImpl.doConnect (:-1)
        .AbstractPlainSocketImpl.connectToAddress (:-1)
        .AbstractPlainSocketImpl.connect (:-1)
        .PlainSocketImpl.connect (:-1)
        .SocksSocketImpl.connect (:-1)
        .Socket.connect (:-1)
        org.apache.http.conn.socket.PlainConnectionSocketFactory.connectSocket (PlainConnectionSocketFactory.java:75)
        org.apache.http.impl.conn.DefaultHttpClientConnectionOperator.connect (DefaultHttpClientConnectionOperator.java:142)
        org.apache.http.impl.conn.BasicHttpClientConnectionManager.connect (BasicHttpClientConnectionManager.java:323)
        org.apache.http.impl.execchain.MainClientExec.establishRoute (MainClientExec.java:381)
Bye for now!</pre></z><z id="t1576776819" t="Pavel KlavÃ­k (defn drawbridge-handler [] (-&gt; (drawbridge/ring-handler) util/wrap-log-request-and-response (defaults/wrap-defaults (assoc-in defaults/api-defaults [:params :nested] true)) session/wrap-session)) "><y>#</y><d>2019-12-19</d><h>17:33</h><w>Pavel KlavÃ­k</w><pre>(defn drawbridge-handler
  []
  (-&gt; (drawbridge/ring-handler)
      util/wrap-log-request-and-response
      (defaults/wrap-defaults (assoc-in defaults/api-defaults [:params :nested] true))
      session/wrap-session))</pre>
</z><z id="t1576777180" t="Pavel KlavÃ­k When I open I get [ ]"><y>#</y><d>2019-12-19</d><h>17:39</h><w>Pavel KlavÃ­k</w>When I open
<pre></pre>
 I get
<pre>[

]</pre></z><z id="t1576777323" t="Pavel KlavÃ­k Ok, the problem solved, I was using a wrong port and was calling the handler wrongly ðŸ™‚ ."><y>#</y><d>2019-12-19</d><h>17:42</h><w>Pavel KlavÃ­k</w>Ok, the problem solved, I was using a wrong port and was calling the handler wrongly <b>ðŸ™‚</b>.</z><z id="t1576784758" t="Pavel KlavÃ­k btw. is possible to use DrawBridge with HTTPs instead of HTTP?"><y>#</y><d>2019-12-19</d><h>19:45</h><w>Pavel KlavÃ­k</w>btw. is possible to use DrawBridge with HTTPs instead of HTTP?</z><z id="t1576786837" t="Pavel KlavÃ­k Got this working by using the port 443 instead of 80. Should be mentioned in https://devcenter.heroku.com/articles/debugging-clojure ."><y>#</y><d>2019-12-19</d><h>20:20</h><r>Pavel KlavÃ­k</r>Got this working by using the port 443 instead of 80. Should be mentioned in <a href="https://devcenter.heroku.com/articles/debugging-clojure" target="_blank">https://devcenter.heroku.com/articles/debugging-clojure</a>.</z><z id="t1576784768" t="Pavel KlavÃ­k and it is possible to connect to it in Cursive?"><y>#</y><d>2019-12-19</d><h>19:46</h><w>Pavel KlavÃ­k</w>and it is possible to connect to it in Cursive?</z><z id="t1576786392" t="cfleming [:attrs {:href &quot;/_/_/users/UFHE11C83&quot;}] Unfortunately I tried to get drawbridge working in Cursive and I couldnâ€™t. I meant to file an issue in the nrepl repo about it but never got around to it."><y>#</y><d>2019-12-19</d><h>20:13</h><w>cfleming</w><a>@pavel.klavik</a> Unfortunately I tried to get drawbridge working in Cursive and I couldnâ€™t. I meant to file an issue in the nrepl repo about it but never got around to it.</z><z id="t1576786663" t="Pavel KlavÃ­k [:attrs {:href &quot;/_/_/users/U0567Q30W&quot;}] Would be great to have it since REPL in shell sucks compared to Cursive. But it will be sufficient for us at least for now."><y>#</y><d>2019-12-19</d><h>20:17</h><w>Pavel KlavÃ­k</w><a>@cfleming</a> Would be great to have it since REPL in shell sucks compared to Cursive. But it will be sufficient for us at least for now.</z><z id="t1576786703" t="cfleming Several people have asked about it again recently so Iâ€™ll try to take another tilt at it soon."><y>#</y><d>2019-12-19</d><h>20:18</h><w>cfleming</w>Several people have asked about it again recently so Iâ€™ll try to take another tilt at it soon.</z><z id="t1576786762" t="Pavel KlavÃ­k Btw. thx for amazing Cursive, running on it for about a year and we are very happy with it. One quality of life improvement would be this: https://github.com/cursive-ide/cursive/issues/2258 ."><y>#</y><d>2019-12-19</d><h>20:19</h><w>Pavel KlavÃ­k</w>Btw. thx for amazing Cursive, running on it for about a year and we are very happy with it. One quality of life improvement would be this: <a href="https://github.com/cursive-ide/cursive/issues/2258" target="_blank">https://github.com/cursive-ide/cursive/issues/2258</a>.</z><z id="t1576786840" t="cfleming Thanks! Iâ€™ll take this over to #cursive since itâ€™s not nrepl related."><y>#</y><d>2019-12-19</d><h>20:20</h><r>cfleming</r>Thanks! Iâ€™ll take this over to #cursive since itâ€™s not nrepl related.</z><z id="t1576832685" t="bozhidar [:attrs {:href &quot;/_/_/users/UFHE11C83&quot;}] Did you see https://blog.jakubholy.net/nrepl-over-http-with-drwabridge-in-2020/"><y>#</y><d>2019-12-20</d><h>09:04</h><w>bozhidar</w><a>@pavel.klavik</a> Did you see <a href="https://blog.jakubholy.net/nrepl-over-http-with-drwabridge-in-2020/" target="_blank">https://blog.jakubholy.net/nrepl-over-http-with-drwabridge-in-2020/</a></z><z id="t1576832725" t="bozhidar Seems to me Drawbridge works just fine with Lein. Unfortunately Iâ€™ve had no time for the project recently, so it has been in a mostly dormant state, but I know for a fact some people are using it, which leads me to believe it still works. ðŸ™‚"><y>#</y><d>2019-12-20</d><h>09:05</h><w>bozhidar</w>Seems to me Drawbridge works just fine with Lein. Unfortunately Iâ€™ve had no time for the project recently, so it has been in a mostly dormant state, but I know for a fact some people are using it, which leads me to believe it still works. <b>ðŸ™‚</b></z><z id="t1576834223" t="Pavel KlavÃ­k Ya, it works. I just had some problem getting it running."><y>#</y><d>2019-12-20</d><h>09:30</h><w>Pavel KlavÃ­k</w>Ya, it works. I just had some problem getting it running.</z><z id="t1576858839" t="bozhidar Ah, got it. I missed that part."><y>#</y><d>2019-12-20</d><h>16:20</h><w>bozhidar</w>Ah, got it. I missed that part.</z><z id="t1578037204" t="sjharms I am using VSCode / Calva with nrepl, and when I use clojure.tools.logging in the default configuration the log messages (despite going to stdout ) do not appear in my nrepl buffer. If I switch to taoensso.timbre they do appear. Is this normal or does it sound like I have configured it incorrectly?"><y>#</y><d>2020-01-03</d><h>07:40</h><w>sjharms</w>I am using VSCode / Calva with nrepl, and when I use <code>clojure.tools.logging</code> in the default configuration the log messages (despite going to <code>stdout</code>) do not appear in my nrepl buffer.  If I switch to <code>taoensso.timbre</code> they do appear.   Is this normal or does it sound like I have configured it incorrectly?</z><z id="t1578040166" t="pez This is probably a question for #calva-dev , but anyway, interesting that timbre gets them routed. There is a setting in Calva for where async stdout should go. "><y>#</y><d>2020-01-03</d><h>08:29</h><w>pez</w>This is probably a question for #calva-dev , but anyway, interesting that timbre gets them routed. There is a setting in Calva for where async stdout should go. </z><z id="t1582385252" t="Joshua Suskalo I&apos;m currently doing a project with OpenGL, which requires you to be particular about which thread things get run on (namely on linux, you must run all subsequent context-specific commands on the thread which creates a context), and I was curious if there is a way to effectively give the thread I&apos;m doing operations on back to nrepl so that it can process messages on it, and then resume my code&apos;s execution, or would it be better for me to just make sure that the code I write happens on a thread other than the repl thread, and that anything context-specific gets sent to a queue to get processed on that thread?"><y>#</y><d>2020-02-22</d><h>15:27</h><w>Joshua Suskalo</w>I&apos;m currently doing a project with OpenGL, which requires you to be particular about which thread things get run on (namely on linux, you must run all subsequent context-specific commands on the thread which creates a context), and I was curious if there is a way to effectively give the thread I&apos;m doing operations on back to nrepl so that it can process messages on it, and then resume my code&apos;s execution, or would it be better for me to just make sure that the code I write happens on a thread other than the repl thread, and that anything context-specific gets sent to a queue to get processed on that thread?</z><z id="t1582400953" t="dominicm There is a threadpool behind nrepl. I think you could potentially achieve what you desire, but I also think it would be arduous."><y>#</y><d>2020-02-22</d><h>19:49</h><w>dominicm</w>There is a threadpool behind nrepl. I think you could potentially achieve what you desire, but I also think it would be arduous.</z><z id="t1582408587" t="Joshua Suskalo Alright, fair enough. I was hoping I could do something like livesupport in slime, but if that&apos;s not the case, then that&apos;s alright, I can just figure it out with a separate thread."><y>#</y><d>2020-02-22</d><h>21:56</h><w>Joshua Suskalo</w>Alright, fair enough. I was hoping I could do something like livesupport in slime, but if that&apos;s not the case, then that&apos;s alright, I can just figure it out with a separate thread.</z><z id="t1582449968" t="bozhidar [:attrs {:href &quot;/_/_/users/U5NCUG8NR&quot;}] Whatâ€™s livesupport?"><y>#</y><d>2020-02-23</d><h>09:26</h><w>bozhidar</w><a>@suskeyhose</a> Whatâ€™s livesupport?</z><z id="t1582543868" t="shen https://github.com/cbaggers/livesupport ?"><y>#</y><d>2020-02-24</d><h>11:31</h><w>shen</w><a href="https://github.com/cbaggers/livesupport" target="_blank">https://github.com/cbaggers/livesupport</a> ?</z><z id="t1582548781" t="bozhidar Probably. Itâ€™s hard to figure out what this actually does from the README, though."><y>#</y><d>2020-02-24</d><h>12:53</h><w>bozhidar</w>Probably. Itâ€™s hard to figure out what this actually does from the README, though.</z><z id="t1583335838" t="Joe Corneli I am trying to connect to a new Drawbridge setup, here&apos;s what I see."><y>#</y><d>2020-03-04</d><h>15:30</h><w>Joe Corneli</w>I am trying to connect to a new Drawbridge setup, here&apos;s what I see.</z><z id="t1583335864" t="Joe Corneli $ AUTH_USER=myuser AUTH_PASS=mypass lein repl :connect Connecting to nREPL at SSLException Unrecognized SSL message, plaintext connection? sun.security.ssl.InputRecord.handleUnknownRecord (InputRecord.java:710) sun.security.ssl.InputRecord.read (InputRecord.java:527) sun.security.ssl.SSLSocketImpl.readRecord (SSLSocketImpl.java:975) sun.security.ssl.SSLSocketImpl.performInitialHandshake (SSLSocketImpl.java:1367) sun.security.ssl.SSLSocketImpl.startHandshake (SSLSocketImpl.java:1395) sun.security.ssl.SSLSocketImpl.startHandshake (SSLSocketImpl.java:1379) org.apache.http.conn.ssl.SSLConnectionSocketFactory.createLayeredSocket (SSLConnectionSocketFactory.java:396) org.apache.http.conn.ssl.SSLConnectionSocketFactory.connectSocket (SSLConnectionSocketFactory.java:355) org.apache.http.impl.conn.DefaultHttpClientConnectionOperator.connect (DefaultHttpClientConnectionOperator.java:142) org.apache.http.impl.conn.BasicHttpClientConnectionManager.connect (BasicHttpClientConnectionManager.java:323) org.apache.http.impl.execchain.MainClientExec.establishRoute (MainClientExec.java:381) org.apache.http.impl.execchain.MainClientExec.execute (MainClientExec.java:237) Bye for now!"><y>#</y><d>2020-03-04</d><h>15:31</h><w>Joe Corneli</w><pre>$ AUTH_USER=myuser AUTH_PASS=mypass lein repl :connect 
Connecting to nREPL at 
SSLException Unrecognized SSL message, plaintext connection?
	sun.security.ssl.InputRecord.handleUnknownRecord (InputRecord.java:710)
	sun.security.ssl.InputRecord.read (InputRecord.java:527)
	sun.security.ssl.SSLSocketImpl.readRecord (SSLSocketImpl.java:975)
	sun.security.ssl.SSLSocketImpl.performInitialHandshake (SSLSocketImpl.java:1367)
	sun.security.ssl.SSLSocketImpl.startHandshake (SSLSocketImpl.java:1395)
	sun.security.ssl.SSLSocketImpl.startHandshake (SSLSocketImpl.java:1379)
	org.apache.http.conn.ssl.SSLConnectionSocketFactory.createLayeredSocket (SSLConnectionSocketFactory.java:396)
	org.apache.http.conn.ssl.SSLConnectionSocketFactory.connectSocket (SSLConnectionSocketFactory.java:355)
	org.apache.http.impl.conn.DefaultHttpClientConnectionOperator.connect (DefaultHttpClientConnectionOperator.java:142)
	org.apache.http.impl.conn.BasicHttpClientConnectionManager.connect (BasicHttpClientConnectionManager.java:323)
	org.apache.http.impl.execchain.MainClientExec.establishRoute (MainClientExec.java:381)
	org.apache.http.impl.execchain.MainClientExec.execute (MainClientExec.java:237)
Bye for now!</pre></z><z id="t1583335886" t="Joe Corneli Have also tried with lein repl :connect :"><y>#</y><d>2020-03-04</d><h>15:31</h><w>Joe Corneli</w>Have also tried with <code>lein repl :connect :</code></z><z id="t1583335892" t="Joe Corneli I get the same error"><y>#</y><d>2020-03-04</d><h>15:31</h><w>Joe Corneli</w>I get the same error</z><z id="t1583337359" t="Joe Corneli This is on: $ lein --version Leiningen 2.9.1 on Java 1.8.0_242 OpenJDK 64-Bit Server VM"><y>#</y><d>2020-03-04</d><h>15:55</h><w>Joe Corneli</w>This is on:
<pre>$ lein --version
Leiningen 2.9.1 on Java 1.8.0_242 OpenJDK 64-Bit Server VM</pre></z><z id="t1583349367" t="hiredman are you actually using ssl for 127.0.0.1:8080?"><y>#</y><d>2020-03-04</d><h>19:16</h><w>hiredman</w>are you actually using ssl for 127.0.0.1:8080?</z><z id="t1583349466" t="hiredman (I just to make sure because using ssl for a local dev server is unusual)"><y>#</y><d>2020-03-04</d><h>19:17</h><w>hiredman</w>(I just to make sure because using ssl for a local dev server is unusual)</z><z id="t1583354922" t="Joe Corneli [:attrs {:href &quot;/_/_/users/U0NCTKEV8&quot;}] yes, we are using HTTPS. (I did try with HTTP and that is turned off.) What I want to do is connect to the instance on Heroku, ultimately, and it is definitely using HTTPS across the board."><y>#</y><d>2020-03-04</d><h>20:48</h><w>Joe Corneli</w><a>@hiredman</a> yes, we are using HTTPS.  (I did try with HTTP and that is turned off.)  What I want to do is connect to the instance on Heroku, ultimately, and it is definitely using HTTPS across the board.</z><z id="t1583355073" t="hiredman You should curl whatever url and see what you get"><y>#</y><d>2020-03-04</d><h>20:51</h><w>hiredman</w>You should curl whatever url and see what you get</z><z id="t1583355202" t="Joe Corneli OK"><y>#</y><d>2020-03-04</d><h>20:53</h><w>Joe Corneli</w>OK</z><z id="t1583444973" t="Joe Corneli Hey, I think I was wrong about HTTPS on dev!"><y>#</y><d>2020-03-05</d><h>21:49</h><w>Joe Corneli</w>Hey, I think I was wrong about HTTPS on dev!</z><z id="t1583444978" t="Joe Corneli I have switched it to HTTP"><y>#</y><d>2020-03-05</d><h>21:49</h><w>Joe Corneli</w>I have switched it to HTTP</z><z id="t1583445012" t="Joe Corneli Still doesn&apos;t seem to work with lein but here is what I get with curl: $ curl -v * Trying 127.0.0.1... * TCP_NODELAY set * Connected to 127.0.0.1 (127.0.0.1) port 8080 (#0) &gt; GET /repl HTTP/1.1 &gt; Host: 127.0.0.1:8080 &gt; User-Agent: curl/7.58.0 &gt; Accept: */* &gt; &lt; HTTP/1.1 200 OK &lt; Set-Cookie: openmarkets-client-session=dd0c18227184047e7d9dc37a4a3e9b8e69479577471006d5be21803fea5965a3;Path=/;HttpOnly &lt; Server: Aleph/0.4.4 &lt; Connection: Keep-Alive &lt; Date: Thu, 05 Mar 2020 21:48:37 GMT &lt; content-length: 0 &lt; * Connection #0 to host 127.0.0.1 left intact "><y>#</y><d>2020-03-05</d><h>21:50</h><w>Joe Corneli</w>Still doesn&apos;t seem to work with <code>lein</code> but here is what I get with curl:
<pre>$ curl -v 
*   Trying 127.0.0.1...
* TCP_NODELAY set
* Connected to 127.0.0.1 (127.0.0.1) port 8080 (#0)
&gt; GET /repl HTTP/1.1
&gt; Host: 127.0.0.1:8080
&gt; User-Agent: curl/7.58.0
&gt; Accept: */*
&gt; 
&lt; HTTP/1.1 200 OK
&lt; Set-Cookie: openmarkets-client-session=dd0c18227184047e7d9dc37a4a3e9b8e69479577471006d5be21803fea5965a3;Path=/;HttpOnly
&lt; Server: Aleph/0.4.4
&lt; Connection: Keep-Alive
&lt; Date: Thu, 05 Mar 2020 21:48:37 GMT
&lt; content-length: 0
&lt; 
* Connection #0 to host 127.0.0.1 left intact</pre>
</z><z id="t1583445085" t="Joe Corneli However lein now reports the following: $ lein repl :connect Connecting to nREPL at ExceptionInfo clj-http: status 403 {:cached nil, :request-time 127, :repeatable? false, :protocol-version {:name &quot;HTTP&quot;, :major 1, :minor 1}, :streaming? true, :http-client #object[org.apache.http.impl.client.InternalHttpClient 0x4db0ba1c &quot;"><y>#</y><d>2020-03-05</d><h>21:51</h><w>Joe Corneli</w>However <code>lein</code> now reports the following:
<pre>$ lein repl :connect 
Connecting to nREPL at 
ExceptionInfo clj-http: status 403 {:cached nil, :request-time 127, :repeatable? false, :protocol-version {:name &quot;HTTP&quot;, :major 1, :minor 1}, :streaming? true, :http-client #object[org.apache.http.impl.client.InternalHttpClient 0x4db0ba1c &quot;</pre></z><z id="t1583508976" t="Joe Corneli Aha, trying curl with POST reveals something."><y>#</y><d>2020-03-06</d><h>15:36</h><w>Joe Corneli</w>Aha, trying <code>curl</code> with POST reveals something.</z><z id="t1583509077" t="Joe Corneli $ curl -v -d &quot;(+ 1 1)&quot; -H &quot;Content-Type: text/plain&quot; * Trying 127.0.0.1... * TCP_NODELAY set * Connected to 127.0.0.1 (127.0.0.1) port 8080 (#0) &gt; POST /repl HTTP/1.1 &gt; Host: 127.0.0.1:8080 &gt; User-Agent: curl/7.58.0 &gt; Accept: */* &gt; Content-Type: text/plain &gt; Content-Length: 7 &gt; * upload completely sent off: 7 out of 7 bytes &lt; HTTP/1.1 403 Forbidden &lt; Content-Type: text/html &lt; Server: Aleph/0.4.4 &lt; Connection: Keep-Alive &lt; Date: Fri, 06 Mar 2020 15:35:21 GMT &lt; content-length: 35 &lt; * Connection #0 to host 127.0.0.1 left intact &lt;h1&gt;Invalid anti-forgery token&lt;/h1&gt; ^^ So the error is unique to our tool, and I&apos;ll have to figure out how to disable this check."><y>#</y><d>2020-03-06</d><h>15:37</h><w>Joe Corneli</w><pre>$ curl -v -d &quot;(+ 1 1)&quot; -H &quot;Content-Type: text/plain&quot; 
*   Trying 127.0.0.1...
* TCP_NODELAY set
* Connected to 127.0.0.1 (127.0.0.1) port 8080 (#0)
&gt; POST /repl HTTP/1.1
&gt; Host: 127.0.0.1:8080
&gt; User-Agent: curl/7.58.0
&gt; Accept: */*
&gt; Content-Type: text/plain
&gt; Content-Length: 7
&gt; 
* upload completely sent off: 7 out of 7 bytes
&lt; HTTP/1.1 403 Forbidden
&lt; Content-Type: text/html
&lt; Server: Aleph/0.4.4
&lt; Connection: Keep-Alive
&lt; Date: Fri, 06 Mar 2020 15:35:21 GMT
&lt; content-length: 35
&lt; 
* Connection #0 to host 127.0.0.1 left intact
&lt;h1&gt;Invalid anti-forgery token&lt;/h1&gt;</pre>
^^ So the error is unique to our tool, and I&apos;ll have to figure out how to disable this check.</z><z id="t1583510716" t="Joe Corneli Commenting out one of the relevant lines in the app (for now) I have gotten past that. Now I see a different error that seems legitimately related to Drawbridge."><y>#</y><d>2020-03-06</d><h>16:05</h><w>Joe Corneli</w>Commenting out one of the relevant lines in the app (for now) I have gotten past that.  Now I see a different error that seems legitimately related to Drawbridge.</z><z id="t1583510739" t="Joe Corneli $ lein repl :connect Connecting to nREPL at IllegalArgumentException Cannot open &lt;nil&gt; as a Reader. (io.clj:288) (io.clj:288) (io.clj:69) (io.clj:102) (io.clj:86) drawbridge.client/ring-client-transport/fill--4204 (client.clj:25) drawbridge.client/ring-client-transport/http--4208 (client.clj:42) nrepl.transport.FnTransport (transport.clj:41) nrepl.core/client/this--9259 (core.clj:56) clojure.core/comp/fn--5792 (core.clj:2569) clojure.core/comp/fn--5792 (core.clj:2569) clojure.lang.AFunction$1.doInvoke (AFunction.java:31) Bye for now! "><y>#</y><d>2020-03-06</d><h>16:05</h><w>Joe Corneli</w><pre>$ lein repl :connect 
Connecting to nREPL at 
IllegalArgumentException Cannot open &lt;nil&gt; as a Reader.
	 (io.clj:288)
	 (io.clj:288)
	 (io.clj:69)
	 (io.clj:102)
	 (io.clj:86)
	drawbridge.client/ring-client-transport/fill--4204 (client.clj:25)
	drawbridge.client/ring-client-transport/http--4208 (client.clj:42)
	nrepl.transport.FnTransport (transport.clj:41)
	nrepl.core/client/this--9259 (core.clj:56)
	clojure.core/comp/fn--5792 (core.clj:2569)
	clojure.core/comp/fn--5792 (core.clj:2569)
	clojure.lang.AFunction$1.doInvoke (AFunction.java:31)
Bye for now!</pre>
</z><z id="t1583514069" t="bozhidar Probably itâ€™s something to do with the web server that drawbridge starts, not so much with drawbridge itself."><y>#</y><d>2020-03-06</d><h>17:01</h><w>bozhidar</w>Probably itâ€™s something to do with the web server that drawbridge starts, not so much with drawbridge itself.</z><z id="t1583514079" t="bozhidar Unfortunately Iâ€™m slammed at work these days, so I canâ€™t look into this."><y>#</y><d>2020-03-06</d><h>17:01</h><w>bozhidar</w>Unfortunately Iâ€™m slammed at work these days, so I canâ€™t look into this.</z><z id="t1583516318" t="Joe Corneli I can try to make a minimal reproduction which is bound to be helpful. Possibly I&apos;ll even be able to find the problem. I created a ticket in the issue tracker and will update there with any progress."><y>#</y><d>2020-03-06</d><h>17:38</h><w>Joe Corneli</w>I can try to make a minimal reproduction which is bound to be helpful.  Possibly I&apos;ll even be able to find the problem. I created a ticket in the issue tracker and will update there with any progress.</z><z id="t1583517137" t="bozhidar Sounds good! thumbsup_all"><y>#</y><d>2020-03-06</d><h>17:52</h><w>bozhidar</w>Sounds good! <b>thumbsup_all</b></z><z id="t1583672630" t="bozhidar Iâ€™ve cut nREPL 0.7.0-beta1 today. I hope that weâ€™ll have the final release out there in a week or two."><y>#</y><d>2020-03-08</d><h>13:03</h><w>bozhidar</w>Iâ€™ve cut nREPL 0.7.0-beta1 today. I hope that weâ€™ll have the final release out there in a week or two.</z><z id="t1583943339" t="Joe Corneli Here&apos;s an note summarising my experience trying to connect CIDER -&gt; Catapult -&gt; Drawbridge https://github.com/clojure-emacs/cider/issues/39#issuecomment-597684479"><y>#</y><d>2020-03-11</d><h>16:15</h><w>Joe Corneli</w>Here&apos;s an note summarising my experience trying to connect CIDER -&gt; Catapult -&gt; Drawbridge <a href="https://github.com/clojure-emacs/cider/issues/39#issuecomment-597684479" target="_blank">https://github.com/clojure-emacs/cider/issues/39#issuecomment-597684479</a></z><z id="t1583943423" t="Joe Corneli tl;dr: I&apos;m still waiting for a prompt in CIDER. Possibly the root cause of the slowness is the issue described here: https://github.com/nrepl/drawbridge/issues/10"><y>#</y><d>2020-03-11</d><h>16:17</h><w>Joe Corneli</w>tl;dr: I&apos;m still waiting for a prompt in CIDER.  Possibly the  root cause of the slowness is the issue described here: <a href="https://github.com/nrepl/drawbridge/issues/10" target="_blank">https://github.com/nrepl/drawbridge/issues/10</a></z><z id="t1583950158" t="Joe Corneli I&apos;m also having trouble connecting Drawbridge -&gt; Heroku on HTTPS."><y>#</y><d>2020-03-11</d><h>18:09</h><w>Joe Corneli</w>I&apos;m also having trouble connecting Drawbridge -&gt; Heroku on HTTPS.</z><z id="t1583950160" t="Joe Corneli https://github.com/nrepl/drawbridge/issues/43"><y>#</y><d>2020-03-11</d><h>18:09</h><w>Joe Corneli</w><a href="https://github.com/nrepl/drawbridge/issues/43" target="_blank">https://github.com/nrepl/drawbridge/issues/43</a></z><z id="t1584908563" t="djblue I have a quick question about the nrepl protocol. Is there a concept of a langauge when connected to a nrepl server? Whenever I see nrepl implemented for Clojurescript, it&apos;s always like a side channel thing that takes over the session that the client has to side effect. The client can&apos;t easily ask what language it&apos;s connected to over nrepl."><y>#</y><d>2020-03-22</d><h>20:22</h><w>djblue</w>I have a quick question about the nrepl protocol. Is there a concept of a langauge when connected to a nrepl server? Whenever I see nrepl implemented for Clojurescript, it&apos;s always like a side channel thing that takes over the session that the client has to side effect. The client can&apos;t easily ask what language it&apos;s connected to over nrepl.</z><z id="t1584908714" t="djblue I ask this because in implementing a native clojurescript nrepl server, I can&apos;t seem to find any clients (vim-fireplace, calva, etc.) that work out of the box, they all assume clojure and have specific hacks for piggieback, figwheel and shadow-cljs."><y>#</y><d>2020-03-22</d><h>20:25</h><w>djblue</w>I ask this because in implementing a native clojurescript nrepl server, I can&apos;t seem to find any clients (vim-fireplace, calva, etc.) that work out of the box, they all assume clojure and have specific hacks for piggieback, figwheel and shadow-cljs.</z><z id="t1584910219" t="bozhidar &gt; I have a quick question about the nrepl protocol. Is there a concept of a langauge when connected to a nrepl server? "><y>#</y><d>2020-03-22</d><h>20:50</h><w>bozhidar</w>&gt; I have a quick question about the nrepl protocol. Is there a concept of a langauge when connected to a nrepl server? </z><z id="t1584910243" t="bozhidar Currently thereâ€™s nothing like this, but it can easily be added to the session metadata (for instance)."><y>#</y><d>2020-03-22</d><h>20:50</h><w>bozhidar</w>Currently thereâ€™s nothing like this, but it can easily be added to the session metadata (for instance).</z><z id="t1584910260" t="bozhidar &gt; Whenever I see nrepl implemented for Clojurescript, itâ€™s always like a side channel thing that takes over the session that the client has to side effect. The client canâ€™t easily ask what language itâ€™s connected to over nrepl."><y>#</y><d>2020-03-22</d><h>20:51</h><w>bozhidar</w>&gt; Whenever I see nrepl implemented for Clojurescript, itâ€™s always like a side channel thing that takes over the session that the client has to side effect. The client canâ€™t easily ask what language itâ€™s connected to over nrepl.</z><z id="t1584910377" t="bozhidar To my knowledge there are no ClojureScript implementation of nREPL, so Iâ€™m a bit puzzled as to what youâ€™re referring to. Piggieback simply changes a regular evaluation session to use the ClojureScript compiler, but itâ€™s still written in Clojure. Therefore the need for clients to look for certain bindings in the session and determine whether itâ€™s Clojure or ClojureScript session."><y>#</y><d>2020-03-22</d><h>20:52</h><w>bozhidar</w>To my knowledge there are no ClojureScript implementation of nREPL, so Iâ€™m a bit puzzled as to what youâ€™re referring to. Piggieback simply changes a regular evaluation session to use the ClojureScript compiler, but itâ€™s still written in Clojure. Therefore the need for clients to look for certain bindings in the session and determine whether itâ€™s Clojure or ClojureScript session.</z><z id="t1584910432" t="bozhidar If we had native ClojureScript servers the clients would know they connected to one and there wouldnâ€™t really be a need to query about the language, although I understand this might be useful in certain cases."><y>#</y><d>2020-03-22</d><h>20:53</h><w>bozhidar</w>If we had native ClojureScript servers the clients would know they connected to one and there wouldnâ€™t really be a need to query about the language, although I understand this might be useful in certain cases.</z><z id="t1584910817" t="djblue How do they distinguish clojure from clojurescript from the nrepl protocol?"><y>#</y><d>2020-03-22</d><h>21:00</h><r>djblue</r>How do they distinguish clojure from clojurescript from the nrepl protocol?</z><z id="t1584910465" t="bozhidar Obviously with a native ClojureScript server you wonâ€™t be able to host both Clojure and ClojureScript REPLs in the same server, but I doubt thatâ€™s an issue for most people ."><y>#</y><d>2020-03-22</d><h>20:54</h><w>bozhidar</w>Obviously with a native ClojureScript server you wonâ€™t be able to host both Clojure and ClojureScript REPLs in the same server, but I doubt thatâ€™s an issue for most people .</z><z id="t1584910507" t="bozhidar &gt; I ask this because in implementing a native clojurescript nrepl server, I canâ€™t seem to find any clients (vim-fireplace, calva, etc.) that work out of the box, they all assume clojure and have specific hacks for piggieback, figwheel and shadow-cljs. Because so far there hasnâ€™t been an alternative. ðŸ™‚ Are you working on a native ClojureScript implementation?"><y>#</y><d>2020-03-22</d><h>20:55</h><w>bozhidar</w>&gt; I ask this because in implementing a native clojurescript nrepl server, I canâ€™t seem to find any clients (vim-fireplace, calva, etc.) that work out of the box, they all assume clojure and have specific hacks for piggieback, figwheel and shadow-cljs.
Because so far there hasnâ€™t been an alternative. <b>ðŸ™‚</b> Are you working on a native ClojureScript implementation?</z><z id="t1584910606" t="djblue Thanks for the quick and in-depth response [:attrs {:href &quot;/_/_/users/U051BLM8F&quot;}] !"><y>#</y><d>2020-03-22</d><h>20:56</h><w>djblue</w>Thanks for the quick and in-depth response <a>@bozhidar</a>!</z><z id="t1584910721" t="djblue I started working on an nrepl server prototype that ran on lumo/nodejs last year and ran into these issues. I got busy with some other stuff but was inspired by https://www.youtube.com/watch?v=dZ4xczP5zDI to start looking into it again."><y>#</y><d>2020-03-22</d><h>20:58</h><w>djblue</w>I started working on an nrepl server prototype that ran on lumo/nodejs last year and ran into these issues. I got busy with some other stuff but was inspired by <a href="https://www.youtube.com/watch?v=dZ4xczP5zDI" target="_blank">https://www.youtube.com/watch?v=dZ4xczP5zDI</a> to start looking into it again.</z><z id="t1584910750" t="djblue It&apos;s a very rough prototype https://github.com/djblue/nrepl-cljs"><y>#</y><d>2020-03-22</d><h>20:59</h><w>djblue</w>It&apos;s a very rough prototype <a href="https://github.com/djblue/nrepl-cljs" target="_blank">https://github.com/djblue/nrepl-cljs</a></z><z id="t1584912459" t="bozhidar Glad to hear this!"><y>#</y><d>2020-03-22</d><h>21:27</h><w>bozhidar</w>Glad to hear this!</z><z id="t1584912576" t="bozhidar Iâ€™m hear to help if you need me. Btw, on a similar note - [:attrs {:href &quot;/_/_/users/U04V15CAJ&quot;}] just started to work on nREPL for babashka!"><y>#</y><d>2020-03-22</d><h>21:29</h><w>bozhidar</w>Iâ€™m hear to help if you need me. Btw, on a similar note - <a>@borkdude</a> just started to work on nREPL for babashka!</z><z id="t1584912648" t="borkdude cool, I&apos;ll take a look at nrepl-cljs as reference"><y>#</y><d>2020-03-22</d><h>21:30</h><w>borkdude</w>cool, I&apos;ll take a look at nrepl-cljs as reference</z><z id="t1584913263" t="djblue The code is pretty rough ðŸ˜†"><y>#</y><d>2020-03-22</d><h>21:41</h><r>djblue</r>The code is pretty rough <b>ðŸ˜†</b></z><z id="t1584913284" t="djblue The best part is probably https://github.com/djblue/nrepl-cljs/blob/master/src/nrepl/bencode.cljs"><y>#</y><d>2020-03-22</d><h>21:41</h><r>djblue</r>The best part is probably <a href="https://github.com/djblue/nrepl-cljs/blob/master/src/nrepl/bencode.cljs" target="_blank">https://github.com/djblue/nrepl-cljs/blob/master/src/nrepl/bencode.cljs</a></z><z id="t1584913335" t="borkdude no worries ðŸ˜‰"><y>#</y><d>2020-03-22</d><h>21:42</h><r>borkdude</r>no worries <b>ðŸ˜‰</b></z><z id="t1584913413" t="djblue Although setting up a proxy https://github.com/djblue/nrepl-cljs/blob/master/src/nrepl/proxy.cljs and logging message with an existing implementation is really helpful :thumbsup:"><y>#</y><d>2020-03-22</d><h>21:43</h><r>djblue</r>Although setting up a proxy <a href="https://github.com/djblue/nrepl-cljs/blob/master/src/nrepl/proxy.cljs" target="_blank">https://github.com/djblue/nrepl-cljs/blob/master/src/nrepl/proxy.cljs</a> and logging message with an existing implementation is really helpful <b>:thumbsup:</b></z><z id="t1584913576" t="djblue It would be really cool if you made the nrepl_server.clj a cljc file and made the transport platform specific!"><y>#</y><d>2020-03-22</d><h>21:46</h><r>djblue</r>It would be really cool if you made the nrepl_server.clj a cljc file and made the transport platform specific!</z><z id="t1584913696" t="borkdude The primary goal is to make it work for babashka. What&apos;s the goal of nrepl-cljs?"><y>#</y><d>2020-03-22</d><h>21:48</h><r>borkdude</r>The primary goal is to make it work for babashka. What&apos;s the goal of nrepl-cljs?</z><z id="t1584913720" t="djblue I wanted to get it working with lumo or any other nodejs based runtime"><y>#</y><d>2020-03-22</d><h>21:48</h><r>djblue</r>I wanted to get it working with lumo or any other nodejs based runtime</z><z id="t1584913745" t="djblue Also found https://github.com/borkdude/nrepl-server#reverse-engineering-the-nrepl-protocol , so it seems we have done very similar things ðŸ˜†"><y>#</y><d>2020-03-22</d><h>21:49</h><r>djblue</r>Also found <a href="https://github.com/borkdude/nrepl-server#reverse-engineering-the-nrepl-protocol" target="_blank">https://github.com/borkdude/nrepl-server#reverse-engineering-the-nrepl-protocol</a>, so it seems we have done very similar things <b>ðŸ˜†</b></z><z id="t1584913821" t="djblue Basically I want people to be able to dev clojurescript without the jvm"><y>#</y><d>2020-03-22</d><h>21:50</h><r>djblue</r>Basically I want people to be able to dev clojurescript without the jvm</z><z id="t1584913862" t="borkdude What nREPL clients don&apos;t use the JVM?"><y>#</y><d>2020-03-22</d><h>21:51</h><r>borkdude</r>What nREPL clients don&apos;t use the JVM?</z><z id="t1584913958" t="djblue Vim-fireplace, calva, and other editors which act as clients don&apos;t require a jvm right?"><y>#</y><d>2020-03-22</d><h>21:52</h><r>djblue</r>Vim-fireplace, calva, and other editors which act as clients don&apos;t require a jvm right?</z><z id="t1584914004" t="djblue They usually just connect to the server via something like python or typescript based on the editor"><y>#</y><d>2020-03-22</d><h>21:53</h><r>djblue</r>They usually just connect to the server via something like python or typescript based on the editor</z><z id="t1584914020" t="borkdude right"><y>#</y><d>2020-03-22</d><h>21:53</h><r>borkdude</r>right</z><z id="t1584914038" t="borkdude I just started working on this today"><y>#</y><d>2020-03-22</d><h>21:53</h><r>borkdude</r>I just started working on this today</z><z id="t1584914224" t="djblue I don&apos;t think you will run into as many problems as I did because babashka is more clojure than clojurescript."><y>#</y><d>2020-03-22</d><h>21:57</h><r>djblue</r>I don&apos;t think you will run into as many problems as I did because babashka is more clojure than clojurescript.</z><z id="t1584952332" t="bozhidar There are also OCaml, Python and Ruby clients for nREPL, btw. Probably some others as well, I never tried to keep track of all of them."><y>#</y><d>2020-03-23</d><h>08:32</h><r>bozhidar</r>There are also OCaml, Python and Ruby clients for nREPL, btw. Probably some others as well, I never tried to keep track of all of them.</z><z id="t1584915670" t="borkdude [:attrs {:href &quot;/_/_/users/U051BLM8F&quot;}] I&apos;m trying to use nrepl/bencode with babashka which is compiled with GraalVM. GraalVM doesn&apos;t like this part: https://github.com/nrepl/bencode/blob/04287269237788811ee4726d5a51db72d5d600d1/src/bencode/core.clj#L317 Since 1.9 Clojure has a bytes? predicate: (defn bytes? &quot;Return true if x is a byte array&quot; {:added &quot;1.9&quot;} [x] (if (nil? x) false (-&gt; x class .getComponentType (= Byte/TYPE)))) Maybe we could use that in bencode?"><y>#</y><d>2020-03-22</d><h>22:21</h><w>borkdude</w><a>@bozhidar</a> I&apos;m trying to use nrepl/bencode with babashka which is compiled with GraalVM. GraalVM doesn&apos;t like this part:
<a href="https://github.com/nrepl/bencode/blob/04287269237788811ee4726d5a51db72d5d600d1/src/bencode/core.clj#L317" target="_blank">https://github.com/nrepl/bencode/blob/04287269237788811ee4726d5a51db72d5d600d1/src/bencode/core.clj#L317</a>
Since 1.9 Clojure has a <code>bytes?</code> predicate:
<pre>(defn bytes?
  &quot;Return true if x is a byte array&quot;
  {:added &quot;1.9&quot;}
  [x] (if (nil? x)
        false
        (-&gt; x class .getComponentType (= Byte/TYPE))))</pre>
Maybe we could use that in bencode?</z><z id="t1584915710" t="borkdude If bencode should still support clojure 1.8 we could just inline that expression"><y>#</y><d>2020-03-22</d><h>22:21</h><w>borkdude</w>If bencode should still support clojure 1.8 we could just inline that expression</z><z id="t1584915797" t="borkdude for now I&apos;m just going to copy the bencode code and modify it for babashka"><y>#</y><d>2020-03-22</d><h>22:23</h><w>borkdude</w>for now I&apos;m just going to copy the bencode code and modify it for babashka</z><z id="t1584945301" t="pez A CLJS nREPL server? I must pinch my arm."><y>#</y><d>2020-03-23</d><h>06:35</h><w>pez</w>A CLJS nREPL server? I must pinch my arm.</z><z id="t1584977472" t="djblue For now I&apos;m targeting node/lumo but eventually any javascript runtime with tcp should work. I got calva working with nrepl-cljs by pretending it was nashhorn."><y>#</y><d>2020-03-23</d><h>15:31</h><r>djblue</r>For now I&apos;m targeting node/lumo but eventually any javascript runtime with tcp should work. I got calva working with nrepl-cljs by pretending it was nashhorn.</z><z id="t1584977591" t="djblue I guess calva checks for a specific string before it trusts its actually a cljs nrepl server."><y>#</y><d>2020-03-23</d><h>15:33</h><r>djblue</r>I guess calva checks for a specific string before it trusts its actually a cljs nrepl server.</z><z id="t1584977621" t="djblue &quot;To quit, type: :cljs/quit&quot;"><y>#</y><d>2020-03-23</d><h>15:33</h><r>djblue</r><code>&quot;To quit, type: :cljs/quit&quot;</code></z><z id="t1584977697" t="pez That&apos;s configurable, but yes, by default it waits for that string before it considers the connection complete."><y>#</y><d>2020-03-23</d><h>15:34</h><r>pez</r>That&apos;s configurable, but yes, by default it waits for that string before it considers the connection complete.</z><z id="t1584977800" t="pez We will need to modify Calva a bit to support this in a smooth way. And I am eager to do those modifications! ðŸ˜ƒ"><y>#</y><d>2020-03-23</d><h>15:36</h><r>pez</r>We will need to modify Calva a bit to support this in a smooth way. And I am eager to do those modifications! <b>ðŸ˜ƒ</b></z><z id="t1584978214" t="djblue I already pulled down the calva repo for debugging through the first problem. I&apos;m down to pull down any test branches to see how it works :thumbsup:"><y>#</y><d>2020-03-23</d><h>15:43</h><r>djblue</r>I already pulled down the calva repo for debugging through the first problem. I&apos;m down to pull down any test branches to see how it works <b>:thumbsup:</b></z><z id="t1584978478" t="pez Today Calva makes quite a big assumption that it is connectiong to a CLJ server. To create a sensible Ux we will need to remove that assumption. Which I think might be a pretty heavy rewrite. But also, it isn&apos;t all that much code, so should be within reach."><y>#</y><d>2020-03-23</d><h>15:47</h><r>pez</r>Today Calva makes quite a big assumption that it is connectiong to a CLJ server. To create a sensible Ux we will need to remove that assumption. Which I think might be a pretty heavy rewrite. But also, it isn&apos;t all that much code, so should be within reach.</z><z id="t1584981583" t="pez Here&apos;s a branch where I have started adding a generic project type. Still CLJ and all that, but anyway. I can connect smoothly to babashka&apos;s nrepl server at least. https://github.com/BetterThanTomorrow/calva/tree/wip/generic-project-type"><y>#</y><d>2020-03-23</d><h>16:39</h><r>pez</r>Here&apos;s a branch where I have started adding a generic project type. Still CLJ and all that, but anyway. I can connect smoothly to babashka&apos;s nrepl server at least. <a href="https://github.com/BetterThanTomorrow/calva/tree/wip/generic-project-type" target="_blank">https://github.com/BetterThanTomorrow/calva/tree/wip/generic-project-type</a></z><z id="t1584990860" t="pez Thinking about it.... It should be possible to connect to your CLJS repl there, using that branch. Calva will think it is a CLJ repl, but if the files are named as .cljc it would work."><y>#</y><d>2020-03-23</d><h>19:14</h><r>pez</r>Thinking about it.... It should be possible to connect to your CLJS repl there, using that branch. Calva will think it is a CLJ repl, but if the files are named as <code>.cljc</code> it would work.</z><z id="t1584945593" t="pez As for querying the language from the server, as [:attrs {:href &quot;/_/_/users/U051BLM8F&quot;}] says, there hasn&apos;t been a need for that yet. ðŸ˜ƒ But even so, Calva can check the project files and ask the user."><y>#</y><d>2020-03-23</d><h>06:39</h><w>pez</w>As for querying the language from the server, as <a>@bozhidar</a> says, there hasn&apos;t been a need for that yet. <b>ðŸ˜ƒ</b> But even so, Calva can check the project files and ask the user.</z><z id="t1584945606" t="pez (If I understand the question correctly.)"><y>#</y><d>2020-03-23</d><h>06:40</h><w>pez</w>(If I understand the question correctly.)</z><z id="t1584952056" t="bozhidar [:attrs {:href &quot;/_/_/users/U04V15CAJ&quot;}] Feel free to also directly update the library. Probably itâ€™s a good idea to retain compatibility with older Clojure releases, as there is still some usage of Clojure 1.7/1.8 in the wild."><y>#</y><d>2020-03-23</d><h>08:27</h><w>bozhidar</w><a>@borkdude</a> Feel free to also directly update the library. Probably itâ€™s a good idea to retain compatibility with older Clojure releases, as there is still some usage of Clojure 1.7/1.8 in the wild.</z><z id="t1584978284" t="djblue Adding cljs support would be awesome ðŸ˜„"><y>#</y><d>2020-03-23</d><h>15:44</h><r>djblue</r>Adding cljs support would be awesome <b>ðŸ˜„</b></z><z id="t1584978320" t="djblue I have an implementation here https://github.com/djblue/nrepl-cljs/blob/master/src/nrepl/bencode.cljs"><y>#</y><d>2020-03-23</d><h>15:45</h><r>djblue</r>I have an implementation here <a href="https://github.com/djblue/nrepl-cljs/blob/master/src/nrepl/bencode.cljs" target="_blank">https://github.com/djblue/nrepl-cljs/blob/master/src/nrepl/bencode.cljs</a></z><z id="t1584978390" t="djblue Since you can&apos;t block on reads in cljs, the api can&apos;t be the same"><y>#</y><d>2020-03-23</d><h>15:46</h><r>djblue</r>Since you can&apos;t block on reads in cljs, the api can&apos;t be the same</z><z id="t1585043886" t="bozhidar Well, I guess thatâ€™s fine. It can very well be a different library then."><y>#</y><d>2020-03-24</d><h>09:58</h><r>bozhidar</r>Well, I guess thatâ€™s fine. It can very well be a different library then.</z><z id="t1585043900" t="bozhidar As long as it serves the purpose the API doesnâ€™t matter that much."><y>#</y><d>2020-03-24</d><h>09:58</h><r>bozhidar</r>As long as it serves the purpose the API doesnâ€™t matter that much.</z><z id="t1585046928" t="borkdude I welcome anyone who is interested in the nREPL support for babashka to contribute. See https://github.com/borkdude/babashka/issues/301#issue-585482011 for the issue."><y>#</y><d>2020-03-24</d><h>10:48</h><w>borkdude</w>I welcome anyone who is interested in the nREPL support for babashka to contribute. See <a href="https://github.com/borkdude/babashka/issues/301#issue-585482011" target="_blank">https://github.com/borkdude/babashka/issues/301#issue-585482011</a> for the issue.</z><z id="t1585409797" t="bozhidar nREPL 0.7 is out https://metaredux.com/posts/2020/03/28/nrepl-0-7.html"><y>#</y><d>2020-03-28</d><h>15:36</h><w>bozhidar</w>nREPL 0.7 is out <a href="https://metaredux.com/posts/2020/03/28/nrepl-0-7.html" target="_blank">https://metaredux.com/posts/2020/03/28/nrepl-0-7.html</a></z><z id="t1585410128" t="pez Typo: I already wrote about the END transport"><y>#</y><d>2020-03-28</d><h>15:42</h><w>pez</w>Typo: I already wrote about the END transport</z><z id="t1585410144" t="pez Otherwise: partywombat"><y>#</y><d>2020-03-28</d><h>15:42</h><w>pez</w>Otherwise: <b>partywombat</b></z><z id="t1585431172" t="bozhidar Just fixed the typo. Thanks for spotting it!"><y>#</y><d>2020-03-28</d><h>21:32</h><w>bozhidar</w>Just fixed the typo. Thanks for spotting it!</z><z id="t1585663485" t="Kevin Hi! I want to create a UI that modifies Clojure functions. Basically in the UI there should be a text editor containing a specific function&apos;s (or defmethod) body. On save that function body should change in the selected project. Is NREPL the correct tool for this? I was thinking of having an NREPL start in the Clojure application, and the UI would communicate through that. Is that a viable option or would I have to use a different method?"><y>#</y><d>2020-03-31</d><h>14:04</h><w>Kevin</w>Hi! I want to create a UI that modifies Clojure functions. Basically in the UI there should be a text editor containing a specific function&apos;s (or defmethod) body. On save that function body should change in the selected project.

 Is NREPL the correct tool for this? I was thinking of having an NREPL start in the Clojure application, and the UI would communicate through that. Is that a viable option or would I have to use a different method?</z><z id="t1585663554" t="Kevin I don&apos;t think NREPL can actually change the code in the file. But maybe it can help with finding function locations and such?"><y>#</y><d>2020-03-31</d><h>14:05</h><w>Kevin</w>I don&apos;t think NREPL can actually change the code in the file. But maybe it can help with finding function locations and such?</z><z id="t1585663613" t="Kevin Any advice would be appreciated simple_smile"><y>#</y><d>2020-03-31</d><h>14:06</h><w>Kevin</w>Any advice would be appreciated <b>simple_smile</b></z><z id="t1585728894" t="bozhidar Well, you can do pretty much everything with a REPL, so while itâ€™s main purpose is to eval code, thereâ€™s no limit to what that code can do. Itâ€™d be pretty easy to figure out where something is defined simply by checking itâ€™s metadata."><y>#</y><d>2020-04-01</d><h>08:14</h><r>bozhidar</r>Well, you can do pretty much everything with a REPL, so while itâ€™s main purpose is to eval code, thereâ€™s no limit to what that code can do. Itâ€™d be pretty easy to figure out where something is defined simply by checking itâ€™s metadata.</z><z id="t1585729186" t="Kevin Oh wow. I didn&apos;t even know function definitions have meta data. (well I should&apos;ve, since I do use ^:private quite a bit)"><y>#</y><d>2020-04-01</d><h>08:19</h><r>Kevin</r>Oh wow. I didn&apos;t even know function definitions have meta data. (well I should&apos;ve, since I do use <code>^:private</code> quite a bit)</z><z id="t1585729281" t="Kevin So if I were to attach to an NREPL in a specific project, I could check the metadata like you said"><y>#</y><d>2020-04-01</d><h>08:21</h><r>Kevin</r>So if I were to attach to an NREPL in a specific project, I could check the metadata like you said</z><z id="t1585729305" t="Kevin Thank you, Clojure is full of surprises for me ðŸ™‚"><y>#</y><d>2020-04-01</d><h>08:21</h><r>Kevin</r>Thank you, Clojure is full of surprises for me <b>ðŸ™‚</b></z><z id="t1585663894" t="Kevin Well, this might answer my question on defmethods at least: https://stackoverflow.com/questions/52861401/dynamically-get-the-source-strings-of-clojure-multimethod-implementation"><y>#</y><d>2020-03-31</d><h>14:11</h><w>Kevin</w>Well, this might answer my question on defmethods at least: <a href="https://stackoverflow.com/questions/52861401/dynamically-get-the-source-strings-of-clojure-multimethod-implementation" target="_blank">https://stackoverflow.com/questions/52861401/dynamically-get-the-source-strings-of-clojure-multimethod-implementation</a></z><z id="t1585725784" t="vinai Hello everyone. Got an issue with nrepl/drawbridge , if there is a better channel to post to, please let me know. Anyhow, Iâ€™ve got an app deployed to heroku (since 2.5 years) that I mainly administer with using drawbridge. The problem is, since yesterday leiningen no longer connects, it just hangs with the message Connecting to nREPL at https:/user: I can see there is plenty of HTTP traffic to /repl all the time while it hangsâ€¦ When I start the uberjar locally and try to connect with drawbridge all works fine. Do you have a pointer how to debug this?"><y>#</y><d>2020-04-01</d><h>07:23</h><w>vinai</w>Hello everyone. Got an issue with <code>nrepl/drawbridge</code>, if there is a better channel to post to, please let me know.

Anyhow, Iâ€™ve got an app deployed to heroku (since 2.5 years) that I mainly administer with using drawbridge.
The problem is, since yesterday leiningen no longer connects, it just hangs with the message
<pre>Connecting to nREPL at https:/user:</pre>
I can see there is plenty of HTTP traffic to <code>/repl</code> all the time while it hangsâ€¦

When I start the uberjar locally and try to connect with drawbridge all works fine.
Do you have a pointer how to debug this?</z><z id="t1585728653" t="bozhidar Hmm, thatâ€™s pretty weird. There hasnâ€™t been any recent drawbridge changes. Can you think of something youâ€™ve changed in the app recently that might be related?"><y>#</y><d>2020-04-01</d><h>08:10</h><w>bozhidar</w>Hmm, thatâ€™s pretty weird. There hasnâ€™t been any recent drawbridge changes. Can you think of something youâ€™ve changed in the app recently that might be related?</z><z id="t1585728770" t="bozhidar As for the debugging - Iâ€™m not sure whatâ€™s the best approach, but itâ€™d simple enough to add some logging to drawbridge, build a local package and test with it."><y>#</y><d>2020-04-01</d><h>08:12</h><w>bozhidar</w>As for the debugging - Iâ€™m not sure whatâ€™s the best approach, but itâ€™d simple enough to add some logging to drawbridge, build a local package and test with it.</z><z id="t1585730988" t="vinai Thank you. There where no changes on the app, but maybe Heroku made some changes - even though that is kind of unlikely, too. I guess Iâ€™ll try to build a local package with loggingâ€¦"><y>#</y><d>2020-04-01</d><h>08:49</h><w>vinai</w>Thank you. There where no changes on the app, but maybe Heroku made some changes - even though that is kind of unlikely, too. I guess Iâ€™ll try to build a local package with loggingâ€¦</z><z id="t1586691482" t="pez If I place a breakpoint on line 8 here: https://github.com/PEZ/clojurecism/blob/master/meetup/src/meetup.clj#L8 things lock up when I evaluate something that should hit it."><y>#</y><d>2020-04-12</d><h>11:38</h><w>pez</w>If I place a breakpoint on line 8 here: <a href="https://github.com/PEZ/clojurecism/blob/master/meetup/src/meetup.clj#L8" target="_blank">https://github.com/PEZ/clojurecism/blob/master/meetup/src/meetup.clj#L8</a> things lock up when I evaluate something that should hit it.</z><z id="t1586700019" t="bozhidar [:attrs {:href &quot;/_/_/users/U0ETXRFEW&quot;}] Seems like a pretty ordinary function to me. Do you want me to test it in CIDER?"><y>#</y><d>2020-04-12</d><h>14:00</h><w>bozhidar</w><a>@pez</a> Seems like a pretty ordinary function to me. Do you want me to test it in CIDER?</z><z id="t1586701937" t="pez Thatâ€™s what I did. "><y>#</y><d>2020-04-12</d><h>14:32</h><w>pez</w>Thatâ€™s what I did. </z><z id="t1586702298" t="pez Calva is bug compatible. ðŸ˜ƒ"><y>#</y><d>2020-04-12</d><h>14:38</h><w>pez</w>Calva is bug compatible. <b>ðŸ˜ƒ</b></z><z id="t1586704284" t="pez Should I file this as an issue?"><y>#</y><d>2020-04-12</d><h>15:11</h><w>pez</w>Should I file this as an issue?</z><z id="t1586704469" t="bozhidar [:attrs {:href &quot;/_/_/users/U0ETXRFEW&quot;}] Yep, you should."><y>#</y><d>2020-04-12</d><h>15:14</h><w>bozhidar</w><a>@pez</a> Yep, you should.</z><z id="t1586704559" t="bozhidar Actually, on second thought I think the problem is pretty simple. I assume you donâ€™t set any print lenth limit, but (range) is infinite and and when you try to realize it in the debugger nothing good can come out of this."><y>#</y><d>2020-04-12</d><h>15:15</h><w>bozhidar</w>Actually, on second thought I think the problem is pretty simple. I assume you donâ€™t set any print lenth limit, but <code>(range)</code> is infinite and and when you try to realize it in the debugger nothing good can come out of this.</z><z id="t1586704600" t="bozhidar Iâ€™m wondering if it doesnâ€™t make sense to add some special handling for range and other forms like it that we know are going to cause a lockup without some additional configuration."><y>#</y><d>2020-04-12</d><h>15:16</h><w>bozhidar</w>Iâ€™m wondering if it doesnâ€™t make sense to add some special handling for <code>range</code> and other forms like it that we know are going to cause a lockup without some additional configuration.</z><z id="t1586705004" t="pez Ah, I see. The thing is that the problem seemed a bit intermittent , so I never suspected the range thing, which we have discussed recently somewhere."><y>#</y><d>2020-04-12</d><h>15:23</h><w>pez</w>Ah, I see. The thing is that the problem seemed a bit intermittent , so I never suspected the <code>range</code> thing, which we have discussed recently somewhere.</z></g><g id="s7"><z id="t1586705103" t="pez Maybe the default should be that the implementing side sets some non-locking print length?"><y>#</y><d>2020-04-12</d><h>15:25</h><w>pez</w>Maybe the default should be that the implementing side sets some non-locking print length?</z><z id="t1586705495" t="bozhidar Well, thatâ€™s certainly an option, although I think itâ€™s better for editor clients to set some default, as this is more visible to the end users. Otherwise they might wonder where some limit is coming from."><y>#</y><d>2020-04-12</d><h>15:31</h><w>bozhidar</w>Well, thatâ€™s certainly an option, although I think itâ€™s better for editor clients to set some default, as this is more visible to the end users. Otherwise they might wonder where some limit is coming from.</z><z id="t1586705519" t="bozhidar &gt; The thing is that the problem seemed a bit intermittent"><y>#</y><d>2020-04-12</d><h>15:31</h><w>bozhidar</w>&gt; The thing is that the problem seemed a bit intermittent</z><z id="t1586705542" t="bozhidar What happens when you step over it and it doesnâ€™t blow up? Without some print limit I canâ€™t expect how this can work in some cases. ðŸ™‚"><y>#</y><d>2020-04-12</d><h>15:32</h><w>bozhidar</w>What happens when you step over it and it doesnâ€™t blow up? Without some print limit I canâ€™t expect how this can work in some cases. <b>ðŸ™‚</b></z><z id="t1586705859" t="pez With implementing side, I meant editor clients. ðŸ˜ƒ"><y>#</y><d>2020-04-12</d><h>15:37</h><w>pez</w>With implementing side, I meant editor clients. <b>ðŸ˜ƒ</b></z><z id="t1586705920" t="bozhidar ðŸ˜„"><y>#</y><d>2020-04-12</d><h>15:38</h><w>bozhidar</w><b>ðŸ˜„</b></z><z id="t1586705945" t="bozhidar CIDER used to have separate print options configs for regular evaluation and for the debugger but at some point we folded those together ."><y>#</y><d>2020-04-12</d><h>15:39</h><w>bozhidar</w>CIDER used to have separate print options configs for regular evaluation and for the debugger but at some point we folded those together .</z><z id="t1586705981" t="bozhidar (defcustom cider-print-options nil &quot;A map of options that will be passed to `cider-print-fn&apos;. Here&apos;s an example for `pprint&apos;: &apos;((\&quot;length\&quot; 50) (\&quot;right-margin\&quot; 70))&quot; :type &apos;list :group &apos;cider :package-version &apos;(cider . &quot;0.21.0&quot;))"><y>#</y><d>2020-04-12</d><h>15:39</h><w>bozhidar</w><pre>(defcustom cider-print-options nil
  &quot;A map of options that will be passed to `cider-print-fn&apos;.
Here&apos;s an example for `pprint&apos;:

  &apos;((\&quot;length\&quot; 50) (\&quot;right-margin\&quot; 70))&quot;
  :type &apos;list
  :group &apos;cider
  :package-version &apos;(cider . &quot;0.21.0&quot;))</pre></z><z id="t1586705986" t="bozhidar You can add something like this."><y>#</y><d>2020-04-12</d><h>15:39</h><w>bozhidar</w>You can add something like this.</z><z id="t1586706013" t="bozhidar Funny enough, when those options had defaults people were complaining there were defaults, and when we removed them - people were complaining there were no defaults. ðŸ˜„"><y>#</y><d>2020-04-12</d><h>15:40</h><w>bozhidar</w>Funny enough, when those options had defaults people were complaining there were defaults, and when we removed them - people were complaining there were no defaults. <b>ðŸ˜„</b></z><z id="t1586706175" t="pez I have had many moments like that with Calva!"><y>#</y><d>2020-04-12</d><h>15:42</h><w>pez</w>I have had many moments like that with Calva!</z><z id="t1586706206" t="pez But generally, Calva comes with a lot of defaults, so people are more used to it there. ðŸ˜ƒ"><y>#</y><d>2020-04-12</d><h>15:43</h><w>pez</w>But generally, Calva comes with a lot of defaults, so people are more used to it there. <b>ðŸ˜ƒ</b></z><z id="t1586706266" t="pez The intermittent thing might have been my testing. Probably was my testing. There were a lot of branches and versions involved... I easily get confused."><y>#</y><d>2020-04-12</d><h>15:44</h><w>pez</w>The intermittent thing might have been my testing. Probably was my testing. There were a lot of branches and versions involved... I easily get confused.</z><z id="t1586706458" t="pez [:attrs {:href &quot;/_/_/users/U9A1RLFNV&quot;}] maybe we should consider debug defaults like ^ that ^? I might not be the only one not realizing the implications of attempting to realize and infinite sequence. ðŸ˜ƒ"><y>#</y><d>2020-04-12</d><h>15:47</h><w>pez</w><a>@brandon.ringe</a> maybe we should consider debug defaults like ^ that ^? I might not be the only one not realizing the implications of attempting to realize and infinite sequence. <b>ðŸ˜ƒ</b></z><z id="t1586723196" t="bringe Yeah, or even a default that is used everywhere, like Bozhidar said. This is related to the large result set issue I think. So a fix there could fix the debug issue perhaps"><y>#</y><d>2020-04-12</d><h>20:26</h><w>bringe</w>Yeah, or even a default that is used everywhere, like Bozhidar said. This is related to the large result set issue I think. So a fix there could fix the debug issue perhaps</z><z id="t1586723223" t="bringe I think I saw this same issue being discussed elsewhere just the other day, in this slack workspace, but I don&apos;t remember where."><y>#</y><d>2020-04-12</d><h>20:27</h><w>bringe</w>I think I saw this same issue being discussed elsewhere just the other day, in this slack workspace, but I don&apos;t remember where.</z><z id="t1586723242" t="bringe Related to infinite sequences and print length"><y>#</y><d>2020-04-12</d><h>20:27</h><w>bringe</w>Related to infinite sequences and print length</z><z id="t1586723258" t="pez Same here. I know we discussed it somewhere, but where... a slack syndrome."><y>#</y><d>2020-04-12</d><h>20:27</h><w>pez</w>Same here. I know we discussed it somewhere, but where... a slack syndrome.</z><z id="t1586723363" t="pez But it makes sense to me to have a default of infinite generally, but for debug, something finite, and to have settings where both can be changed by the user."><y>#</y><d>2020-04-12</d><h>20:29</h><w>pez</w>But it makes sense to me to have a default of <code>infinite</code> generally, but for debug, something finite, and to have settings where both can be changed by the user.</z><z id="t1586723417" t="bringe Yeah, more settings with reasonable defaults is usually better, imo"><y>#</y><d>2020-04-12</d><h>20:30</h><w>bringe</w>Yeah, more settings with reasonable defaults is usually better, imo</z><z id="t1586723444" t="pez Less settings is my usual goto. ðŸ˜ƒ"><y>#</y><d>2020-04-12</d><h>20:30</h><w>pez</w>Less settings is my usual goto. <b>ðŸ˜ƒ</b></z><z id="t1586723511" t="pez But this does come to mind. https://youtu.be/QHZ48AE3TOI"><y>#</y><d>2020-04-12</d><h>20:31</h><w>pez</w>But this does come to mind. <a href="https://youtu.be/QHZ48AE3TOI" target="_blank">https://youtu.be/QHZ48AE3TOI</a></z><z id="t1588237131" t="shen [:attrs {:href &quot;/_/_/users/U051BLM8F&quot;}] : thoughts on using more modern dev-time tooling for nREPL?"><y>#</y><d>2020-04-30</d><h>08:58</h><w>shen</w><a>@bozhidar</a>: thoughts on using more modern dev-time tooling for nREPL?</z><z id="t1588237149" t="shen I&apos;m thinking of kaocha in particular"><y>#</y><d>2020-04-30</d><h>08:59</h><w>shen</w>I&apos;m thinking of kaocha in particular</z><z id="t1588237212" t="shen as long as we have zero runtime deps, and runtime compatibility back to Clojure 1.7, that should be fine right?"><y>#</y><d>2020-04-30</d><h>09:00</h><w>shen</w>as long as we have zero runtime deps, and runtime compatibility back to Clojure 1.7, that should be fine right?</z><z id="t1588244396" t="bozhidar [:attrs {:href &quot;/_/_/users/U1XERPZ18&quot;}] Yeah, totally!"><y>#</y><d>2020-04-30</d><h>10:59</h><w>bozhidar</w><a>@shen</a> Yeah, totally!</z><z id="t1588244414" t="bozhidar Dev dependencies are not really an issue - we have to be careful only on the runtime side."><y>#</y><d>2020-04-30</d><h>11:00</h><w>bozhidar</w>Dev dependencies are not really an issue - we have to be careful only on the runtime side.</z><z id="t1588244504" t="shen ok. it only works with clojure 1.9+, but for the CI matrix, we should still be able to use lein run for older versions"><y>#</y><d>2020-04-30</d><h>11:01</h><w>shen</w>ok. it only works with clojure 1.9+, but for the CI matrix, we should still be able to use <code>lein run</code> for older versions</z><z id="t1588246344" t="bozhidar Fine by me."><y>#</y><d>2020-04-30</d><h>11:32</h><r>bozhidar</r>Fine by me.</z><z id="t1588244557" t="shen so, got most of the dynamic middleware thing working. just trying to figure out dependencies between the modules."><y>#</y><d>2020-04-30</d><h>11:02</h><w>shen</w>so, got most of the dynamic middleware thing working. just trying to figure out dependencies between the modules.</z><z id="t1588244688" t="shen e.g. sideloader depends on session, and both sits downstream from the dynamic loader (which is not really a middleware), so need to think of a clean way for it to have access to those capabilities without having everything entwined"><y>#</y><d>2020-04-30</d><h>11:04</h><w>shen</w>e.g. sideloader depends on session, and both sits <code>downstream</code> from the dynamic loader (which is not really a middleware), so need to think of a clean way for it to have access to those capabilities without having everything entwined</z><z id="t1588246409" t="bozhidar Looking forward to see what youâ€™ve come up with!"><y>#</y><d>2020-04-30</d><h>11:33</h><w>bozhidar</w>Looking forward to see what youâ€™ve come up with!</z><z id="t1588246747" t="shen quite excited. this should allow cider-connect to do almost as much as cider-jack-in"><y>#</y><d>2020-04-30</d><h>11:39</h><w>shen</w>quite excited. this should allow <code>cider-connect</code> to do almost as much as <code>cider-jack-in</code></z><z id="t1588248145" t="bozhidar Thatâ€™s the dream!"><y>#</y><d>2020-04-30</d><h>12:02</h><w>bozhidar</w>Thatâ€™s the dream!</z><z id="t1588348680" t="shen https://github.com/nrepl/nrepl/pull/185 &lt;- Draft PR for the dynamic-loader . This needs some finishing, but I think I&apos;ve got this approach to work."><y>#</y><d>2020-05-01</d><h>15:58</h><w>shen</w><a href="https://github.com/nrepl/nrepl/pull/185" target="_blank">https://github.com/nrepl/nrepl/pull/185</a> &lt;- Draft PR for the <code>dynamic-loader</code>. This needs some finishing, but I think I&apos;ve got this approach to work.</z><z id="t1588348714" t="shen Would really like to get some comments/suggestions before I go further"><y>#</y><d>2020-05-01</d><h>15:58</h><w>shen</w>Would really like to get some comments/suggestions before I go further</z><z id="t1588348870" t="pez That sounds absolutely wonderful, [:attrs {:href &quot;/_/_/users/U1XERPZ18&quot;}] !"><y>#</y><d>2020-05-01</d><h>16:01</h><w>pez</w>That sounds absolutely wonderful, <a>@shen</a>!</z><z id="t1588349004" t="shen thanks! been thinking about this on and off for a while now. Finally took the plunge to actually get it to work"><y>#</y><d>2020-05-01</d><h>16:03</h><w>shen</w>thanks! been thinking about this on and off for a while now. Finally took the plunge to actually get it to work</z><z id="t1588498576" t="Eugen hi, I&apos;m new to clojure from Java and I would like to know how to embed nrepl in a production java app and what gui tools can I use to connect to it. what options are there for security (authentication) ?"><y>#</y><d>2020-05-03</d><h>09:36</h><w>Eugen</w>hi, I&apos;m new to clojure from Java and I would like to know how to embed nrepl in a production java app and what gui tools can I use to connect to it. what options are there for security (authentication) ?</z><z id="t1588537161" t="shen the default transports are all socket based. What people typically do is to allow connection from local only, without security, then reply on SSH to provide security"><y>#</y><d>2020-05-03</d><h>20:19</h><r>shen</r>the default transports are all socket based. What people typically do is to allow connection from local only, without security, then reply on SSH to provide security</z><z id="t1588537241" t="shen there is https://github.com/nrepl/drawbridge , which gives access over https. don&apos;t think there&apos;s any built in security, but you are free to add your own there."><y>#</y><d>2020-05-03</d><h>20:20</h><r>shen</r>there is <a href="https://github.com/nrepl/drawbridge" target="_blank">https://github.com/nrepl/drawbridge</a>, which gives access over https. don&apos;t think there&apos;s any built in security, but you are free to add your own there.</z><z id="t1588537440" t="shen in term of GUI tools, the best bet are the ones built into the major clojure dev tools, e.g. Cursive for IntelliJ or Calva for VSCode"><y>#</y><d>2020-05-03</d><h>20:24</h><r>shen</r>in term of GUI tools, the best bet are the ones built into the major clojure dev tools, e.g. Cursive for IntelliJ or Calva for VSCode</z><z id="t1588537463" t="shen I&apos;m sure standalone tools exist, but that&apos;s not a common way to use nREPL, so doubt they are too well developed"><y>#</y><d>2020-05-03</d><h>20:24</h><r>shen</r>I&apos;m sure standalone tools exist, but that&apos;s not a common way to use nREPL, so doubt they are too well developed</z><z id="t1588537475" t="shen ditto for brower based clients"><y>#</y><d>2020-05-03</d><h>20:24</h><r>shen</r>ditto for brower based clients</z><z id="t1588537582" t="shen Here&apos;s a list of clients: https://nrepl.org/nrepl/0.7.0/usage/clients.html"><y>#</y><d>2020-05-03</d><h>20:26</h><r>shen</r>Here&apos;s a list of clients: <a href="https://nrepl.org/nrepl/0.7.0/usage/clients.html" target="_blank">https://nrepl.org/nrepl/0.7.0/usage/clients.html</a></z><z id="t1588537604" t="shen not all of them are in active development, and some are very dead though"><y>#</y><d>2020-05-03</d><h>20:26</h><r>shen</r>not all of them are in active development, and some are very dead though</z><z id="t1588537613" t="shen but compatibility should still be good"><y>#</y><d>2020-05-03</d><h>20:26</h><r>shen</r>but compatibility should still be good</z><z id="t1588584061" t="Eugen thanks, it&apos;s very helpful"><y>#</y><d>2020-05-04</d><h>09:21</h><r>Eugen</r>thanks, it&apos;s very helpful</z><z id="t1588584072" t="Eugen I did manage to do what I was aiming for https://github.com/netdava/ofbiz-clojure-repl"><y>#</y><d>2020-05-04</d><h>09:21</h><r>Eugen</r>I did manage to do what I was aiming for <a href="https://github.com/netdava/ofbiz-clojure-repl" target="_blank">https://github.com/netdava/ofbiz-clojure-repl</a></z><z id="t1588584110" t="Eugen I&apos;ve gone with basic socket based nRepl"><y>#</y><d>2020-05-04</d><h>09:21</h><r>Eugen</r>I&apos;ve gone with basic socket based nRepl</z><z id="t1588584129" t="Eugen it can be started / stopped at will"><y>#</y><d>2020-05-04</d><h>09:22</h><r>Eugen</r>it can be started / stopped at will</z><z id="t1588584171" t="Eugen authentication is an issue - since there are no OOTB options out there"><y>#</y><d>2020-05-04</d><h>09:22</h><r>Eugen</r>authentication is an issue - since there are no OOTB options out there</z><z id="t1588584284" t="Eugen I think drawbridh over websocket + Oauth2 / OpenID connect would be nice at some point"><y>#</y><d>2020-05-04</d><h>09:24</h><r>Eugen</r>I think drawbridh over websocket + Oauth2 / OpenID connect would be nice at some point</z><z id="t1588498689" t="Eugen I&apos;m working on adopting clojure inside some projects and this is something that I would like to experiment with: â€¢ make the application start with nrepl â€¢ expose some &apos;context&apos; that I can use to interact with the application runtime - like a spring application context"><y>#</y><d>2020-05-03</d><h>09:38</h><w>Eugen</w>I&apos;m working on adopting clojure inside some projects and this is something that I would like to experiment with:
â€¢ make the application start with nrepl
â€¢ expose some &apos;context&apos; that I can use to interact with the application runtime - like a spring application context</z><z id="t1588498734" t="Eugen ideally this should be usable from the browser but connecting from ide would be ok too."><y>#</y><d>2020-05-03</d><h>09:38</h><w>Eugen</w>ideally this should be usable from the browser but connecting from ide would be ok too.</z><z id="t1588498989" t="Eugen for whom it might concern: just found https://github.com/tstout/spring-repl which is a nice start, please share how you use it"><y>#</y><d>2020-05-03</d><h>09:43</h><w>Eugen</w>for whom it might concern: just found <a href="https://github.com/tstout/spring-repl" target="_blank">https://github.com/tstout/spring-repl</a> which is a nice start, please share how you use it</z><z id="t1588500288" t="Eugen also found https://libraries.io/github/matlux/jvm-breakglass , is there a browser IDE for clojure /nrepl?"><y>#</y><d>2020-05-03</d><h>10:04</h><w>Eugen</w>also found <a href="https://libraries.io/github/matlux/jvm-breakglass" target="_blank">https://libraries.io/github/matlux/jvm-breakglass</a> , is there a browser IDE for clojure /nrepl?</z><z id="t1588538704" t="Lennart Buit Hai. I have a bit of a question, I have this nrepl server, and I like to configure which ns you â€˜drop intoâ€™ when you connect to it. Ala :init-ns in a leiningen project. Now I found https://github.com/lambdaisland/nrepl which is deprecated and suggests that you can configure this in nREPL. However, I canâ€™t find out how ðŸ˜ž , can someone shine a bit of a light on that for me ^^?"><y>#</y><d>2020-05-03</d><h>20:45</h><w>Lennart Buit</w>Hai. I have a bit of a question, I have this nrepl server, and I like to configure which ns you â€˜drop intoâ€™ when you connect to it. Ala <code>:init-ns</code> in a leiningen project. Now I found <a href="https://github.com/lambdaisland/nrepl" target="_blank">https://github.com/lambdaisland/nrepl</a> which is deprecated and suggests that you can configure this in nREPL. However, I canâ€™t find out how <b>ðŸ˜ž</b>, can someone shine a bit of a light on that for me ^^?</z><z id="t1588578278" t="bozhidar Feel free to submit a ticket for nREPL to add a command-line flag for this. I never needed it, so it didnâ€™t cross my mind, but itâ€™s easy to do."><y>#</y><d>2020-05-04</d><h>07:44</h><r>bozhidar</r>Feel free to submit a ticket for nREPL to add a command-line flag for this. I never needed it, so it didnâ€™t cross my mind, but itâ€™s easy to do.</z><z id="t1588578305" t="bozhidar Itâ€™s just a matter of setting *ns* for the initial nREPL session manually."><y>#</y><d>2020-05-04</d><h>07:45</h><r>bozhidar</r>Itâ€™s just a matter of setting <code>*ns*</code> for the initial nREPL session manually.</z><z id="t1588580084" t="Lennart Buit Iâ€™ll create an issue somewhere today ^^, thanks"><y>#</y><d>2020-05-04</d><h>08:14</h><r>Lennart Buit</r>Iâ€™ll create an issue somewhere today ^^, thanks</z><z id="t1588586149" t="shen what client are you using to connect to nREPL?"><y>#</y><d>2020-05-04</d><h>09:55</h><r>shen</r>what client are you using to connect to nREPL?</z><z id="t1588586171" t="shen this feels like a client-space feature"><y>#</y><d>2020-05-04</d><h>09:56</h><r>shen</r>this feels like a client-space feature</z><z id="t1588587591" t="Lennart Buit Using leiningen. I wonder tho, I wanted to configure it server side because the default user namespace has nothing, so I would say that it shouldnâ€™t matter which client you use, you just want to drop in the â€˜maintenanceâ€™ namespace so to say."><y>#</y><d>2020-05-04</d><h>10:19</h><r>Lennart Buit</r>Using leiningen. I wonder tho, I wanted to configure it server side because the default <code>user</code> namespace has nothing, so I would say that it shouldnâ€™t matter which client you use, you just want to drop in the â€˜maintenanceâ€™ namespace so to say.</z><z id="t1588587699" t="Lennart Buit My experience with nREPL is very limited tho"><y>#</y><d>2020-05-04</d><h>10:21</h><r>Lennart Buit</r>My experience with nREPL is very limited tho</z><z id="t1588587728" t="shen think if you can configure it in lein, do that rather"><y>#</y><d>2020-05-04</d><h>10:22</h><r>shen</r>think if you can configure it in lein, do that rather</z><z id="t1588587749" t="shen fwiw, I use user.clj as the maintenance ns for this reason"><y>#</y><d>2020-05-04</d><h>10:22</h><r>shen</r>fwiw, I use <code>user.clj</code> as the maintenance ns for this reason</z><z id="t1588587873" t="shen the general approach is that nREPL is mainly there to enable client-tools to serve enduser requirements"><y>#</y><d>2020-05-04</d><h>10:24</h><r>shen</r>the general approach is that nREPL is mainly there to enable client-tools to serve enduser requirements</z><z id="t1588587888" t="shen and not fulfil it directly"><y>#</y><d>2020-05-04</d><h>10:24</h><r>shen</r>and not fulfil it directly</z><z id="t1588588075" t="Lennart Buit Iâ€™ll try convincing lein once more"><y>#</y><d>2020-05-04</d><h>10:27</h><r>Lennart Buit</r>Iâ€™ll try convincing lein once more</z><z id="t1588588750" t="shen check this line in the example project? https://github.com/technomancy/leiningen/blob/145ba54eb0a5fc099380ad6feb04688a2fca9173/sample.project.clj#L373"><y>#</y><d>2020-05-04</d><h>10:39</h><r>shen</r>check this line in the example project? <a href="https://github.com/technomancy/leiningen/blob/145ba54eb0a5fc099380ad6feb04688a2fca9173/sample.project.clj#L373" target="_blank">https://github.com/technomancy/leiningen/blob/145ba54eb0a5fc099380ad6feb04688a2fca9173/sample.project.clj#L373</a></z><z id="t1588590057" t="Lennart Buit Yeah I think I tried that, but I wasnâ€™t too awake anymore, so I probably did something wrong ^^. Thanks for your help!"><y>#</y><d>2020-05-04</d><h>11:00</h><r>Lennart Buit</r>Yeah I think I tried that, but I wasnâ€™t too awake anymore, so I probably did something wrong ^^. Thanks for your help!</z><z id="t1588590751" t="shen pleasure"><y>#</y><d>2020-05-04</d><h>11:12</h><r>shen</r>pleasure</z><z id="t1588716277" t="shen hey. just saw the issue you posted in nREPL"><y>#</y><d>2020-05-05</d><h>22:04</h><r>shen</r>hey. just saw the issue you posted in nREPL</z><z id="t1588716289" t="shen I just checked what you are trying to do"><y>#</y><d>2020-05-05</d><h>22:04</h><r>shen</r>I just checked what you are trying to do</z><z id="t1588716319" t="shen did you place the :init-ns inside of :repl-options ?"><y>#</y><d>2020-05-05</d><h>22:05</h><r>shen</r>did you place the <code>:init-ns</code> inside of <code>:repl-options</code>?</z><z id="t1588716357" t="shen i.e. this :repl-options {:init-ns your.namespace} inside of project.clj"><y>#</y><d>2020-05-05</d><h>22:05</h><r>shen</r>i.e. this <code>:repl-options {:init-ns your.namespace}</code> inside of <code>project.clj</code></z><z id="t1588717870" t="Lennart Buit Yes, it works for lein repl but not for lein repl :connect ... ."><y>#</y><d>2020-05-05</d><h>22:31</h><r>Lennart Buit</r>Yes, it works for <code>lein repl</code> but not for <code>lein repl :connect ...</code>.</z><z id="t1588748706" t="Lennart Buit Oh there is a difference between connecting to the nrepl server started by leiningen (which does apply your init-ns), and connecting to one you started manually (e.g. with nrepl.server/start-server ) which does not. That said, my applications donâ€™t run through leiningen, so it would still be beneficial to me if either leiningen or nREPL allows â€˜forcingâ€™ an init-ns. I amended the issue with this information."><y>#</y><d>2020-05-06</d><h>07:05</h><r>Lennart Buit</r>Oh there is a difference between connecting to the nrepl server started by leiningen (which does apply your init-ns), and connecting to one you started manually (e.g. with <code>nrepl.server/start-server</code>) which does not. That said, my applications donâ€™t run through leiningen, so it would still be beneficial to me if either leiningen or nREPL allows â€˜forcingâ€™ an init-ns. I amended the issue with this information.</z><z id="t1588760163" t="shen ah right. that makes sense."><y>#</y><d>2020-05-06</d><h>10:16</h><r>shen</r>ah right. that makes sense.</z><z id="t1588760285" t="shen will respond in the gh issue"><y>#</y><d>2020-05-06</d><h>10:18</h><r>shen</r>will respond in the gh issue</z><z id="t1588765500" t="shen just want to check: do you have a workaround right now?"><y>#</y><d>2020-05-06</d><h>11:45</h><r>shen</r>just want to check: do you have a workaround right now?</z><z id="t1588765508" t="shen release cycle for nrepl/lein etc. is not that fast"><y>#</y><d>2020-05-06</d><h>11:45</h><r>shen</r>release cycle for nrepl/lein etc. is not that fast</z><z id="t1588770883" t="Lennart Buit yeah, just swapping ns manually. Usually connecting with cursive so thats not too much of a hassle!"><y>#</y><d>2020-05-06</d><h>13:14</h><r>Lennart Buit</r>yeah, just swapping ns manually. Usually connecting with cursive so thats not too much of a hassle!</z><z id="t1588770960" t="Lennart Buit Thank you for asking, and once more, if there is something I can assist in let me know! Given the constraints of being an nREPL newbie, ofcourse ðŸ™‚"><y>#</y><d>2020-05-06</d><h>13:16</h><r>Lennart Buit</r>Thank you for asking, and once more, if there is something I can assist in let me know! Given the constraints of being an nREPL newbie, ofcourse <b>ðŸ™‚</b></z><z id="t1588780111" t="shen you can probably also ask Ian to see if he&apos;ll add the feature to cursive"><y>#</y><d>2020-05-06</d><h>15:48</h><r>shen</r>you can probably also ask Ian to see if he&apos;ll add the feature to cursive</z><z id="t1588780168" t="shen (that&apos;s the cursive author)"><y>#</y><d>2020-05-06</d><h>15:49</h><r>shen</r>(that&apos;s the cursive author)</z><z id="t1588538970" t="dominicm There&apos;s no configuration flag for it"><y>#</y><d>2020-05-03</d><h>20:49</h><w>dominicm</w>There&apos;s no configuration flag for it</z><z id="t1588538979" t="dominicm I think lein uses a custom middleware"><y>#</y><d>2020-05-03</d><h>20:49</h><w>dominicm</w>I think lein uses a custom middleware</z><z id="t1588539562" t="Lennart Buit Sorry, I donâ€™t quite understand. Are you saying that there is no â€˜easyâ€™ way to configure it on the nrepl server side, but that leiningen uses a custom middleware to apply its init-ns when connecting to it?"><y>#</y><d>2020-05-03</d><h>20:59</h><r>Lennart Buit</r>Sorry, I donâ€™t quite understand. Are you saying that there is no â€˜easyâ€™ way to configure it on the nrepl server side, but that leiningen uses a custom middleware to apply its init-ns when connecting to it?</z><z id="t1588542838" t="dominicm Yes"><y>#</y><d>2020-05-03</d><h>21:53</h><r>dominicm</r>Yes</z><z id="t1588578223" t="bozhidar I donâ€™t think thatâ€™s the case, actually. If I recall correctly it was just setting *ns* manually."><y>#</y><d>2020-05-04</d><h>07:43</h><r>bozhidar</r>I donâ€™t think thatâ€™s the case, actually. If I recall correctly it was just setting <code>*ns*</code> manually.</z><z id="t1588585974" t="shen ha. does look like a custom middleware"><y>#</y><d>2020-05-04</d><h>09:52</h><r>shen</r>ha. does look like a custom middleware</z><z id="t1588585977" t="shen https://github.com/technomancy/leiningen/blob/145ba54eb0a5fc099380ad6feb04688a2fca9173/src/leiningen/repl.clj#L147-L167"><y>#</y><d>2020-05-04</d><h>09:52</h><r>shen</r><a href="https://github.com/technomancy/leiningen/blob/145ba54eb0a5fc099380ad6feb04688a2fca9173/src/leiningen/repl.clj#L147-L167" target="_blank">https://github.com/technomancy/leiningen/blob/145ba54eb0a5fc099380ad6feb04688a2fca9173/src/leiningen/repl.clj#L147-L167</a></z><z id="t1588678921" t="bozhidar Indeed! I stand corrected then. ðŸ˜„"><y>#</y><d>2020-05-05</d><h>11:42</h><r>bozhidar</r>Indeed! I stand corrected then. <b>ðŸ˜„</b></z><z id="t1588678966" t="bozhidar Well, I guess we really have to make this easier to set in nREPL directly - e.g. we can pass some optional initial ns to the server when starting or something along those lines."><y>#</y><d>2020-05-05</d><h>11:42</h><r>bozhidar</r>Well, I guess we really have to make this easier to set in nREPL directly - e.g. we can pass some optional initial ns to the server when starting or something along those lines.</z><z id="t1588698296" t="Lennart Buit Iâ€™ll start a discussion on that in a GitHub issue then ^^"><y>#</y><d>2020-05-05</d><h>17:04</h><r>Lennart Buit</r>Iâ€™ll start a discussion on that in a GitHub issue then ^^</z><z id="t1588698467" t="Lennart Buit also for traceability if it ends up being something that is not desirable for some reason"><y>#</y><d>2020-05-05</d><h>17:07</h><r>Lennart Buit</r>also for traceability if it ends up being something that is not desirable for some reason</z><z id="t1588700582" t="Lennart Buit Lets continue these two threads here: https://github.com/nrepl/nrepl/issues/186 ^^"><y>#</y><d>2020-05-05</d><h>17:43</h><r>Lennart Buit</r>Lets continue these two threads here: <a href="https://github.com/nrepl/nrepl/issues/186" target="_blank">https://github.com/nrepl/nrepl/issues/186</a> ^^</z><z id="t1588668101" t="Misha Bohdan Hello! Iâ€™m trying to adopt drawbridge to my project. Iâ€™ve done all the same way as described at README, but got next error .FileNotFoundException: Could not locate drawbridge/client__init.class, drawbridge/client.clj or drawbridge/client.cljc on classpath. at clojure.lang.RT.load (RT.java:466) ` How can it be fixed?"><y>#</y><d>2020-05-05</d><h>08:41</h><w>Misha Bohdan</w>Hello! Iâ€™m trying to adopt <code>drawbridge</code> to my project. Iâ€™ve done all the same way as described at README, but got next error
<pre>.FileNotFoundException: Could not locate drawbridge/client__init.class, drawbridge/client.clj or drawbridge/client.cljc on classpath.
 at clojure.lang.RT.load (RT.java:466)</pre>`
How can it be fixed?</z><z id="t1588669773" t="Misha Bohdan Solution found: just added dependency to the ~/.lein/profiles.clj"><y>#</y><d>2020-05-05</d><h>09:09</h><r>Misha Bohdan</r>Solution found: just added dependency to the <code>~/.lein/profiles.clj</code></z><z id="t1588675807" t="Eugen yes, the error means that the library is not found - if it is added, a restart should do the trick. I get this in InterlliJ with gradle"><y>#</y><d>2020-05-05</d><h>10:50</h><r>Eugen</r>yes, the error means that the library is not found - if it is added, a restart should do the trick. I get this in InterlliJ with gradle</z><z id="t1588675814" t="Eugen I have to restart the repl"><y>#</y><d>2020-05-05</d><h>10:50</h><r>Eugen</r>I have to restart the repl</z><z id="t1589118534" t="shen I&apos;m happy with the dynamic-loader PR now: https://github.com/nrepl/nrepl/pull/185/ [:attrs {:href &quot;/_/_/users/U051BLM8F&quot;}] when you next have some time, wouldn&apos;t mind a review"><y>#</y><d>2020-05-10</d><h>13:48</h><w>shen</w>I&apos;m happy with the dynamic-loader PR now: <a href="https://github.com/nrepl/nrepl/pull/185/" target="_blank">https://github.com/nrepl/nrepl/pull/185/</a> <a>@bozhidar</a> when you next have some time, wouldn&apos;t mind a review</z><z id="t1589129102" t="bozhidar [:attrs {:href &quot;/_/_/users/U1XERPZ18&quot;}] Roger that! Starting that review right away. ðŸ™‚"><y>#</y><d>2020-05-10</d><h>16:45</h><w>bozhidar</w><a>@shen</a> Roger that! Starting that review right away. <b>ðŸ™‚</b></z><z id="t1589136103" t="shen thanks! making a few small changes, but keen to talk about hotloading etc."><y>#</y><d>2020-05-10</d><h>18:41</h><r>shen</r>thanks! making a few small changes, but keen to talk about hotloading etc.</z><z id="t1589455145" t="flowthing Does nREPL have a feature that would let me do something like this? send-&gt; {:op &quot;eval&quot; :code &quot;(+ 1 2)&quot; :my-thing/silent? true} &lt;-recv {:value &quot;3&quot; :my-thing/silent? true} My use case is that I want to eval an entire namespace, but I don&apos;t want to flood the REPL output with the names of every var that gets defined. Instead, I&apos;d like to just show something like &quot;Loading my.awesome.nsâ€¦&quot;. I know I can do it by keeping track of the IDs of the ops I&apos;m sending, but I&apos;m just wondering whether there&apos;s something simpler I could do."><y>#</y><d>2020-05-14</d><h>11:19</h><w>flowthing</w>Does nREPL have a feature that would let me do something like this?

<pre>send-&gt; {:op &quot;eval&quot; :code &quot;(+ 1 2)&quot; :my-thing/silent? true}
&lt;-recv {:value &quot;3&quot; :my-thing/silent? true}</pre>
My use case is that I want to eval an entire namespace, but I don&apos;t want to flood the REPL output with the names of every var that gets defined. Instead, I&apos;d like to just show something like &quot;Loading my.awesome.nsâ€¦&quot;.

I know I can do it by keeping track of the IDs of the ops I&apos;m sending, but I&apos;m just wondering whether there&apos;s something simpler I could do.</z><z id="t1589456149" t="flowthing The documentation suggests that :id is the only datum that&apos;s the same in the request and the response, so I think I&apos;ll just use that."><y>#</y><d>2020-05-14</d><h>11:35</h><r>flowthing</r>The documentation suggests that <code>:id</code> is the only datum that&apos;s the same in the request and the response, so I think I&apos;ll just use that.</z><z id="t1589529763" t="shen hmm.. what client you are using?"><y>#</y><d>2020-05-15</d><h>08:02</h><r>shen</r>hmm.. what client you are using?</z><z id="t1589529822" t="shen as bozhidar said, nothing built in, and this is probably way easier to do on the client side than server"><y>#</y><d>2020-05-15</d><h>08:03</h><r>shen</r>as bozhidar said, nothing built in, and this is probably way easier to do on the client side than server</z><z id="t1589529925" t="flowthing I&apos;m building my own: https://github.com/eerohele/tutkain"><y>#</y><d>2020-05-15</d><h>08:05</h><r>flowthing</r>I&apos;m building my own:

<a href="https://github.com/eerohele/tutkain" target="_blank">https://github.com/eerohele/tutkain</a></z><z id="t1589529944" t="flowthing Yeah, I&apos;m currently working on the client side exclusively."><y>#</y><d>2020-05-15</d><h>08:05</h><r>flowthing</r>Yeah, I&apos;m currently working on the client side exclusively.</z><z id="t1589530176" t="shen oh cool. a new client!"><y>#</y><d>2020-05-15</d><h>08:09</h><r>shen</r>oh cool. a new client!</z><z id="t1589530190" t="shen what&apos;s the landscape on the submlime text side of things?"><y>#</y><d>2020-05-15</d><h>08:09</h><r>shen</r>what&apos;s the landscape on the submlime text side of things?</z><z id="t1589530421" t="flowthing Well, it&apos;s got potential. With https://github.com/snoe/clojure-lsp and https://github.com/sublimelsp/LSP (and my plugin, after some more work), I think I could get most of what I&apos;m looking for in a Clojure editing tool. I&apos;m currently using that setup as a daily driver, and it is looking somewhat promising."><y>#</y><d>2020-05-15</d><h>08:13</h><r>flowthing</r>Well, it&apos;s got potential. With <a href="https://github.com/snoe/clojure-lsp" target="_blank">https://github.com/snoe/clojure-lsp</a> and <a href="https://github.com/sublimelsp/LSP" target="_blank">https://github.com/sublimelsp/LSP</a> (and my plugin, after some more work), I think I could get most of what I&apos;m looking for in a Clojure editing tool. I&apos;m currently using that setup as a daily driver, and it is looking somewhat promising.</z><z id="t1589530499" t="flowthing I might also need to reimplement https://github.com/odyssomay/paredit and https://github.com/odyssomay/sublime-lispindent to be more Clojure-friendly, but we&apos;ll see."><y>#</y><d>2020-05-15</d><h>08:14</h><r>flowthing</r>I might also need to reimplement <a href="https://github.com/odyssomay/paredit" target="_blank">https://github.com/odyssomay/paredit</a> and <a href="https://github.com/odyssomay/sublime-lispindent" target="_blank">https://github.com/odyssomay/sublime-lispindent</a> to be more Clojure-friendly, but we&apos;ll see.</z><z id="t1589530547" t="flowthing In sum, it&apos;s pretty incomplete at the moment. But I&apos;m hoping I can build it into something feasible."><y>#</y><d>2020-05-15</d><h>08:15</h><r>flowthing</r>In sum, it&apos;s pretty incomplete at the moment. But I&apos;m hoping I can build it into something feasible.</z><z id="t1589530831" t="shen sounds like a fun project ðŸ™‚"><y>#</y><d>2020-05-15</d><h>08:20</h><r>shen</r>sounds like a fun project <b>ðŸ™‚</b></z><z id="t1589530863" t="flowthing That it is, and if nothing else, it has been an education. ðŸ™‚"><y>#</y><d>2020-05-15</d><h>08:21</h><r>flowthing</r>That it is, and if nothing else, it has been an education. <b>ðŸ™‚</b></z><z id="t1589698187" t="bozhidar Thereâ€™s a private channel for Clojure dev tooling authors. Iâ€™ll invite you there, so we can support you better."><y>#</y><d>2020-05-17</d><h>06:49</h><r>bozhidar</r>Thereâ€™s a private channel for Clojure dev tooling authors. Iâ€™ll invite you there, so we can support you better.</z><z id="t1589525601" t="bozhidar So, if I understand correctly you want to be able to echo some request params in the responses, right? I assume your client will processing those specially if they are present?"><y>#</y><d>2020-05-15</d><h>06:53</h><w>bozhidar</w>So, if I understand correctly you want to be able to echo some request params in the responses, right? I assume your client will processing those specially if they are present?</z><z id="t1589525664" t="bozhidar Thereâ€™s nothing like this today, but I guess itâ€™d be easy to add a middleware that just attaches certain request params to the responses."><y>#</y><d>2020-05-15</d><h>06:54</h><w>bozhidar</w>Thereâ€™s nothing like this today, but I guess itâ€™d be easy to add a middleware that just attaches certain request params to the responses.</z><z id="t1589529902" t="flowthing [:attrs {:href &quot;/_/_/users/U051BLM8F&quot;}] Yes, exactly. Turns out it was pretty straightforward to build what I needed by just using op IDs to match requests and responses, and I can use that functionality for other things as well."><y>#</y><d>2020-05-15</d><h>08:05</h><w>flowthing</w><a>@bozhidar</a> Yes, exactly. Turns out it was pretty straightforward to build what I needed by just using op IDs to match requests and responses, and I can use that functionality for other things as well.</z><z id="t1589549319" t="borkdude Is there an overview of bencode libraries for various languages that support streaming to build nREPL functionality?"><y>#</y><d>2020-05-15</d><h>13:28</h><w>borkdude</w>Is there an overview of bencode libraries for various languages that support streaming to build nREPL functionality?</z><z id="t1589549337" t="borkdude I found one for python and for Rust. Obviously we have one for Clojure"><y>#</y><d>2020-05-15</d><h>13:28</h><w>borkdude</w>I found one for python and for Rust. Obviously we have one for Clojure</z><z id="t1589549558" t="borkdude I guess this page serves as such a resource: https://nrepl.org/nrepl/beyond_clojure.html"><y>#</y><d>2020-05-15</d><h>13:32</h><w>borkdude</w>I guess this page serves as such a resource: <a href="https://nrepl.org/nrepl/beyond_clojure.html" target="_blank">https://nrepl.org/nrepl/beyond_clojure.html</a></z><z id="t1589549737" t="borkdude ah, btw [:attrs {:href &quot;/_/_/users/U051BLM8F&quot;}] - the nREPL server in babashka has now been broken out into a library: https://github.com/babashka/babashka.nrepl so the reference on that page could be changed to that"><y>#</y><d>2020-05-15</d><h>13:35</h><w>borkdude</w>ah, btw <a>@bozhidar</a> - the nREPL server in babashka has now been broken out into a library: <a href="https://github.com/babashka/babashka.nrepl" target="_blank">https://github.com/babashka/babashka.nrepl</a>
so the reference on that page could be changed to that</z><z id="t1589564828" t="dominicm Python"><y>#</y><d>2020-05-15</d><h>17:47</h><w>dominicm</w>Python</z><z id="t1589564844" t="dominicm I think clojure-vim maintains it now, but was written by Chas/Stu, I can&apos;t remember now."><y>#</y><d>2020-05-15</d><h>17:47</h><w>dominicm</w>I think clojure-vim maintains it now, but was written by Chas/Stu, I can&apos;t remember now.</z><z id="t1589567803" t="borkdude [:attrs {:href &quot;/_/_/users/U09LZR36F&quot;}] &quot;it&quot; being?"><y>#</y><d>2020-05-15</d><h>18:36</h><w>borkdude</w><a>@dominicm</a> &quot;it&quot; being?</z><z id="t1589567882" t="dominicm the bencode library"><y>#</y><d>2020-05-15</d><h>18:38</h><w>dominicm</w>the bencode library</z><z id="t1589567900" t="dominicm https://github.com/clojure-vim/nrepl-python-client"><y>#</y><d>2020-05-15</d><h>18:38</h><w>dominicm</w><a href="https://github.com/clojure-vim/nrepl-python-client" target="_blank">https://github.com/clojure-vim/nrepl-python-client</a></z><z id="t1589567928" t="dominicm https://github.com/clojure-vim/nrepl-python-client/blob/master/nrepl/bencode.py bencode is inlined admittedly"><y>#</y><d>2020-05-15</d><h>18:38</h><w>dominicm</w><a href="https://github.com/clojure-vim/nrepl-python-client/blob/master/nrepl/bencode.py" target="_blank">https://github.com/clojure-vim/nrepl-python-client/blob/master/nrepl/bencode.py</a> bencode is inlined admittedly</z><z id="t1589568046" t="borkdude it&apos;s nice how in almost any language the bencode impl ends up being around 200 lines"><y>#</y><d>2020-05-15</d><h>18:40</h><w>borkdude</w>it&apos;s nice how in almost any language the bencode impl ends up being around 200 lines</z><z id="t1589568073" t="dominicm fireplace has a really short one"><y>#</y><d>2020-05-15</d><h>18:41</h><w>dominicm</w>fireplace has a really short one</z><z id="t1589568106" t="dominicm https://github.com/tpope/vim-fireplace/blob/6c968f26f0bd3dd04b18fad8761e0e9e1220a3da/pythonx/fireplace.py#L9-L77"><y>#</y><d>2020-05-15</d><h>18:41</h><w>dominicm</w><a href="https://github.com/tpope/vim-fireplace/blob/6c968f26f0bd3dd04b18fad8761e0e9e1220a3da/pythonx/fireplace.py#L9-L77" target="_blank">https://github.com/tpope/vim-fireplace/blob/6c968f26f0bd3dd04b18fad8761e0e9e1220a3da/pythonx/fireplace.py#L9-L77</a></z><z id="t1589568106" t="borkdude so probably clojure-vim/nrepl-python-client should also be listed there?"><y>#</y><d>2020-05-15</d><h>18:41</h><w>borkdude</w>so probably clojure-vim/nrepl-python-client should also be listed there?</z><z id="t1589568114" t="dominicm yeah, it should"><y>#</y><d>2020-05-15</d><h>18:41</h><w>dominicm</w>yeah, it should</z><z id="t1589568133" t="borkdude and the fireplace one"><y>#</y><d>2020-05-15</d><h>18:42</h><w>borkdude</w>and the fireplace one</z><z id="t1589568154" t="borkdude the page lists server implementations, but I think it&apos;s also useful to list client impls"><y>#</y><d>2020-05-15</d><h>18:42</h><w>borkdude</w>the page lists server implementations, but I think it&apos;s also useful to list client impls</z><z id="t1589698031" t="bozhidar There are some non-Clojure clients on the clients page as well. I guess I can add there the python one. If I recall correctly I didnâ€™t add it originally because I thought it was defunct. I have some memory we were discussing with [:attrs {:href &quot;/_/_/users/U09LZR36F&quot;}] to have some fork of it under the nREPL GitHub org."><y>#</y><d>2020-05-17</d><h>06:47</h><w>bozhidar</w>There are some non-Clojure clients on the clients page as well. I guess I can add there the python one. If I recall correctly I didnâ€™t add it originally because I thought it was defunct. I have some memory we were discussing with <a>@dominicm</a> to have some fork of it under the nREPL GitHub org.</z><z id="t1591560329" t="manas_marthi I added projectile to my emacs. I am getting tons of warnings after that. not sure what needs to be changed. can anyone please help ^&quot; -- update-in :plugins conj ^&quot;[cider/cider-nrepl \^&quot;0.25.0\^&quot;]^&quot; -- repl :headless :host localhost Reflection warning, cider/nrepl/inlined_deps/orchard/v0v5v9/orchard/inspect.clj:397:37 - call to static method alength on clojure.lang.RT can&apos;t be resolved (argument types: unknown). Reflection warning, cider/nrepl/inlined_deps/orchard/v0v5v9/orchard/inspect.clj:443:61 - reference to field getClass can&apos;t be resolved. Reflection warning, cider/nrepl/inlined_deps/orchard/v0v5v9/orchard/inspect.clj:443:51 - reference to field getName can&apos;t be resolved. Reflection warning, cider/nrepl/inlined_deps/orchard/v0v5v9/orchard/namespace.clj:57:5 - call to method startsWith can&apos;t be resolved (target class is unknown). Reflection warning, cider/nrepl/inlined_deps/orchard/v0v5v9/orchard/cljs/meta.cljc:18:7 - reference to field getPath can&apos;t be resolved. Reflection warning, cider/nrepl/inlined_deps/orchard/v0v5v9/orchard/java/resource.clj:11:7 - call to method startsWith can&apos;t be resolved (target class is unknown). Reflection warning, cider/nrepl/inlined_deps/orchard/v0v5v9/orchard/java/resource.clj:34:20 - call to method startsWith can&apos;t be resolved (target class is unknown). Reflection warning, cider/nrepl/inlined_deps/orchard/v0v5v9/orchard/java/resource.clj:25:36 - reference to field getPath can&apos;t be resolved. Reflection warning, cider/nrepl/inlined_deps/orchard/v0v5v9/orchard/java/resource.clj:27:37 - reference to field getPath can&apos;t be resolved. Reflection warning, cider/nrepl/inlined_deps/orchard/v0v5v9/orchard/java/resource.clj:26:36 - call to method replaceFirst can&apos;t be resolved (target class is unknown). Reflection warning, cider/nrepl/inlined_deps/orchard/v0v5v9/orchard/java/resource.clj:22:19 - call to method isFile can&apos;t be resolved (target class is unknown). Reflection warning, cider/nrepl/inlined_deps/orchard/v0v5v9/orchard/java/resource.clj:36:12 - call to method isDirectory can&apos;t be resolved (target class is unknown). Reflection warning, cider/nrepl/inlined_deps/orchard/v0v5v9/orchard/java/resource.clj:59:37 - reference to field getPath can&apos;t be resolved. Reflection warning, cider/nrepl/inlined_deps/orchard/v0v5v9/orchard/java.clj:48:25 - reference to field canRead can&apos;t be resolved. Reflection warning, cider/nrepl/inlined_deps/orchard/v0v5v9/orchard/java.clj:56:28 - reference to field getJarFileURL on java.net.URLConnection can&apos;t be resolved. Reflection warning, cider/nrepl/inlined_deps/orchard/v0v5v9/orchard/java.clj:67:17 - reference to field getJarFileURL on java.net.URLConnection can&apos;t be resolved. Reflection warning, cider/nrepl/inlined_deps/orchard/v0v5v9/orchard/meta.clj:70:22 - reference to field getPath can&apos;t be resolved. Reflection warning, cider/nrepl/inlined_deps/orchard/v0v5v9/orchard/meta.clj:237:36 - reference to field read can&apos;t be resolved. Reflection warning, cider/nrepl/inlined_deps/orchard/v0v5v9/orchard/meta.clj:244:28 - call to method unread can&apos;t be resolved (target class is unknown). Reflection warning, cider/nrepl/inlined_deps/orchard/v0v5v9/orchard/meta.clj:272:7 - reference to field getPath can&apos;t be resolved. Reflection warning, cider/nrepl/middleware/debug.clj:160:29 - reference to field sym on java.lang.Object can&apos;t be resolved. Reflection warning, cider/nrepl/middleware/debug.clj:160:29 - reference to field sym on java.lang.Object can&apos;t be resolved. user&gt; "><y>#</y><d>2020-06-07</d><h>20:05</h><w>manas_marthi</w>I added projectile to my emacs. I am getting tons of warnings after that. not sure what needs to be changed. can anyone please help

<pre>^&quot; -- update-in :plugins conj ^&quot;[cider/cider-nrepl \^&quot;0.25.0\^&quot;]^&quot; -- repl :headless :host localhost
Reflection warning, cider/nrepl/inlined_deps/orchard/v0v5v9/orchard/inspect.clj:397:37 - call to static method alength on clojure.lang.RT can&apos;t be resolved (argument types: unknown).
Reflection warning, cider/nrepl/inlined_deps/orchard/v0v5v9/orchard/inspect.clj:443:61 - reference to field getClass can&apos;t be resolved.
Reflection warning, cider/nrepl/inlined_deps/orchard/v0v5v9/orchard/inspect.clj:443:51 - reference to field getName can&apos;t be resolved.
Reflection warning, cider/nrepl/inlined_deps/orchard/v0v5v9/orchard/namespace.clj:57:5 - call to method startsWith can&apos;t be resolved (target class is unknown).
Reflection warning, cider/nrepl/inlined_deps/orchard/v0v5v9/orchard/cljs/meta.cljc:18:7 - reference to field getPath can&apos;t be resolved.
Reflection warning, cider/nrepl/inlined_deps/orchard/v0v5v9/orchard/java/resource.clj:11:7 - call to method startsWith can&apos;t be resolved (target class is unknown).
Reflection warning, cider/nrepl/inlined_deps/orchard/v0v5v9/orchard/java/resource.clj:34:20 - call to method startsWith can&apos;t be resolved (target class is unknown).
Reflection warning, cider/nrepl/inlined_deps/orchard/v0v5v9/orchard/java/resource.clj:25:36 - reference to field getPath can&apos;t be resolved.
Reflection warning, cider/nrepl/inlined_deps/orchard/v0v5v9/orchard/java/resource.clj:27:37 - reference to field getPath can&apos;t be resolved.
Reflection warning, cider/nrepl/inlined_deps/orchard/v0v5v9/orchard/java/resource.clj:26:36 - call to method replaceFirst can&apos;t be resolved (target class is unknown).
Reflection warning, cider/nrepl/inlined_deps/orchard/v0v5v9/orchard/java/resource.clj:22:19 - call to method isFile can&apos;t be resolved (target class is unknown).
Reflection warning, cider/nrepl/inlined_deps/orchard/v0v5v9/orchard/java/resource.clj:36:12 - call to method isDirectory can&apos;t be resolved (target class is unknown).
Reflection warning, cider/nrepl/inlined_deps/orchard/v0v5v9/orchard/java/resource.clj:59:37 - reference to field getPath can&apos;t be resolved.
Reflection warning, cider/nrepl/inlined_deps/orchard/v0v5v9/orchard/java.clj:48:25 - reference to field canRead can&apos;t be resolved.
Reflection warning, cider/nrepl/inlined_deps/orchard/v0v5v9/orchard/java.clj:56:28 - reference to field getJarFileURL on java.net.URLConnection can&apos;t be resolved.
Reflection warning, cider/nrepl/inlined_deps/orchard/v0v5v9/orchard/java.clj:67:17 - reference to field getJarFileURL on java.net.URLConnection can&apos;t be resolved.
Reflection warning, cider/nrepl/inlined_deps/orchard/v0v5v9/orchard/meta.clj:70:22 - reference to field getPath can&apos;t be resolved.
Reflection warning, cider/nrepl/inlined_deps/orchard/v0v5v9/orchard/meta.clj:237:36 - reference to field read can&apos;t be resolved.
Reflection warning, cider/nrepl/inlined_deps/orchard/v0v5v9/orchard/meta.clj:244:28 - call to method unread can&apos;t be resolved (target class is unknown).
Reflection warning, cider/nrepl/inlined_deps/orchard/v0v5v9/orchard/meta.clj:272:7 - reference to field getPath can&apos;t be resolved.
Reflection warning, cider/nrepl/middleware/debug.clj:160:29 - reference to field sym on java.lang.Object can&apos;t be resolved.
Reflection warning, cider/nrepl/middleware/debug.clj:160:29 - reference to field sym on java.lang.Object can&apos;t be resolved.
user&gt; </pre></z><z id="t1591560810" t="dpsutton those appear to be reflection warnings in cider-nrepl&apos;s deps."><y>#</y><d>2020-06-07</d><h>20:13</h><w>dpsutton</w>those appear to be reflection warnings in cider-nrepl&apos;s deps.</z><z id="t1591562056" t="manas_marthi any idea how to resolve them?"><y>#</y><d>2020-06-07</d><h>20:34</h><w>manas_marthi</w>any idea how to resolve them?</z><z id="t1591562127" t="manas_marthi they were not appearing before I added extra modes . They started showing up after I added company, projectile, which-key, to my emacs"><y>#</y><d>2020-06-07</d><h>20:35</h><w>manas_marthi</w>they were not appearing before I added extra modes . They started showing up after I  added company, projectile, which-key, to my emacs</z><z id="t1591562772" t="dpsutton Sounds strange. Are you using CIDER? weâ€™re you previously? Have you recently set to warn on reflection globally?"><y>#</y><d>2020-06-07</d><h>20:46</h><w>dpsutton</w>Sounds strange. Are you using CIDER? weâ€™re you previously? Have you recently set to warn on reflection globally?</z><z id="t1591563177" t="manas_marthi yes I am using cider. I saw these warnings as soon as I jack in. it started as usual but showed these warnings. Cider start up log: Startup: &quot;c:/Users/admin/AppData/Roaming/npm/lein.bat&quot; update-in :dependencies conj ^&quot;[nrepl \^&quot;0.7.0\^&quot;]^&quot; -- update-in :plugins conj ^&quot;[cider/cider-nrepl \^&quot;0.25.0\^&quot;]^&quot; -- repl :headless :host localhost"><y>#</y><d>2020-06-07</d><h>20:52</h><w>manas_marthi</w>yes I am using cider. I saw these warnings as soon as I jack in. it started as usual but showed these warnings. Cider start up log: <code>Startup: &quot;c:/Users/admin/AppData/Roaming/npm/lein.bat&quot; update-in :dependencies conj ^&quot;[nrepl \^&quot;0.7.0\^&quot;]^&quot; -- update-in :plugins conj ^&quot;[cider/cider-nrepl \^&quot;0.25.0\^&quot;]^&quot; -- repl :headless :host localhost</code></z><z id="t1591563219" t="manas_marthi I installed cider two days ago only. I suppose I am having the latest release"><y>#</y><d>2020-06-07</d><h>20:53</h><w>manas_marthi</w>I installed cider two days ago only. I suppose I am having the latest release</z><z id="t1591563241" t="manas_marthi Is it related to Jdk version? I have jdk12 in path"><y>#</y><d>2020-06-07</d><h>20:54</h><w>manas_marthi</w>Is it related to Jdk version? I have jdk12 in path</z><z id="t1591564220" t="dpsutton I donâ€™t believe so. Those dependencies use reflection and the warning says so. "><y>#</y><d>2020-06-07</d><h>21:10</h><w>dpsutton</w>I donâ€™t believe so. Those dependencies use reflection and the warning says so. </z><z id="t1591564590" t="uochan This may not be relevant, but how about using cider-nrepl 0.25.1 or 0.25.2? orchard 0.5.9 which depends on cider-nrepl 0.25.0 has some problem. https://github.com/clojure-emacs/orchard/issues/91"><y>#</y><d>2020-06-07</d><h>21:16</h><w>uochan</w>This may not be relevant, but how about using cider-nrepl 0.25.1 or 0.25.2?
orchard 0.5.9 which depends on cider-nrepl 0.25.0 has some problem.
<a href="https://github.com/clojure-emacs/orchard/issues/91" target="_blank">https://github.com/clojure-emacs/orchard/issues/91</a></z><z id="t1591565447" t="dpsutton Orchard doesnâ€™t depend on cider-nrepl. Cider-nrepl depends on orchard"><y>#</y><d>2020-06-07</d><h>21:30</h><w>dpsutton</w>Orchard doesnâ€™t depend on cider-nrepl. Cider-nrepl depends on orchard</z><z id="t1591565588" t="dpsutton Unless I misread your meaning"><y>#</y><d>2020-06-07</d><h>21:33</h><w>dpsutton</w>Unless I misread your meaning</z><z id="t1591565652" t="uochan oh, that&apos;s right ðŸ™‚"><y>#</y><d>2020-06-07</d><h>21:34</h><w>uochan</w>oh, that&apos;s right <b>ðŸ™‚</b></z><z id="t1591568216" t="manas_marthi not sure how to change it.. I tried adding it in :profiles { :dev {:dependencies [] list . But cider jack in does not recognize this version. It is still taking 0.25.0"><y>#</y><d>2020-06-07</d><h>22:16</h><w>manas_marthi</w>not sure how to change it.. I tried adding it in <code>:profiles { :dev {:dependencies []</code>  list . But cider jack in does not recognize this version. It is still taking 0.25.0</z><z id="t1591568987" t="dpsutton Donâ€™t add it to your profiles file. This is something that CIDER injects when starting up. If you update CIDER it will update the version it injects to the latest if youâ€™re not already there. These warnings are not an issue. Reflection warnings let you find slow spots in your code but this is fooling that exists only at dev time"><y>#</y><d>2020-06-07</d><h>22:29</h><w>dpsutton</w>Donâ€™t add it to your profiles file. This is something that CIDER injects when starting up. If you update CIDER it will update the version it injects to the latest if youâ€™re not already there. These warnings are not an issue. Reflection warnings let you find slow spots in your code but this is fooling that exists only at dev time</z><z id="t1591572277" t="manas_marthi I am returning to clojure after a long time. This is a fresh installation of emacs and cider - just one two days old.."><y>#</y><d>2020-06-07</d><h>23:24</h><r>manas_marthi</r>I am returning to clojure after a long time. This is a fresh installation of emacs and cider - just one two days old..</z><z id="t1591572773" t="dpsutton Ok. Then I think everything is fine. There are reflection warnings because there is reflection"><y>#</y><d>2020-06-07</d><h>23:32</h><r>dpsutton</r>Ok. Then I think everything is fine.  There are reflection warnings because there is reflection</z><z id="t1591572787" t="dpsutton But not sure why the warnings are enabled. Itâ€™s off by default"><y>#</y><d>2020-06-07</d><h>23:33</h><r>dpsutton</r>But not sure why the warnings are enabled. Itâ€™s off by default</z><z id="t1591569022" t="dpsutton Itâ€™s also not clear if this just recently popped up or if you recently started using CIDER. "><y>#</y><d>2020-06-07</d><h>22:30</h><w>dpsutton</w>Itâ€™s also not clear if this just recently popped up or if you recently started using CIDER. </z><z id="t1592994487" t="dominicm Putting this out there in vain hope, has anyone seen an issue where the cider-nrepl middleware causes the JVM to hit it&apos;s maximum open files limit? Repro: clojure -Sdeps &apos;{:deps {nrepl {:mvn/version &quot;0.7.0&quot;} refactor-nrepl {:mvn/version &quot;2.5.0&quot;} cider/piggieback {:mvn/version &quot;0.4.2&quot;} cider/cider-nrepl {:mvn/version &quot;0.25.2&quot;}}}&apos; -m nrepl.cmdline --middleware &quot;[ cider.nrepl/cider-middleware ]&quot; In another terminal: # List open file count for the JVM, assumes only one JVM open, tweak as necessary $ ls -las /proc/$(pgrep &apos;java&apos;)/fd | wc -l $ clojure -Sdeps &apos;{:deps {nrepl {:mvn/version &quot;0.7.0&quot;}}}&apos; -m nrepl.cmdline -c -p 46397 nREPL 0.7.0 Clojure 1.10.0 OpenJDK 64-Bit Server VM 11.0.5-internal+11-adhoc..jdk11u-jdk-11.0.510 Interrupt: Control+C Exit: Control+D or (exit) or (quit) user=&gt; (+ 1 1) 2 user=&gt; (exit) $ ls -las /proc/$(pgrep java)/fd | wc -l 4098 "><y>#</y><d>2020-06-24</d><h>10:28</h><w>dominicm</w>Putting this out there in vain hope, has anyone seen an issue where the cider-nrepl middleware causes the JVM to hit it&apos;s maximum open files limit?

Repro:

<pre>clojure -Sdeps &apos;{:deps {nrepl {:mvn/version &quot;0.7.0&quot;} refactor-nrepl {:mvn/version &quot;2.5.0&quot;} cider/piggieback {:mvn/version &quot;0.4.2&quot;} cider/cider-nrepl {:mvn/version &quot;0.25.2&quot;}}}&apos; -m nrepl.cmdline --middleware &quot;[ cider.nrepl/cider-middleware ]&quot;
</pre>

In another terminal:

<pre># List open file count for the JVM, assumes only one JVM open, tweak as necessary
$ ls -las /proc/$(pgrep &apos;java&apos;)/fd | wc -l
$ clojure -Sdeps &apos;{:deps {nrepl {:mvn/version &quot;0.7.0&quot;}}}&apos; -m nrepl.cmdline -c -p 46397
nREPL 0.7.0
Clojure 1.10.0
OpenJDK 64-Bit Server VM 11.0.5-internal+11-adhoc..jdk11u-jdk-11.0.510
Interrupt: Control+C
Exit:      Control+D or (exit) or (quit)
user=&gt; (+ 1 1)
2
user=&gt; (exit)
$ ls -las /proc/$(pgrep java)/fd | wc -l
4098
</pre>
</z><z id="t1592995343" t="dominicm It appears to be a problem with the debug middleware. I can trim the repro down to typing (require &apos;cider.nrepl.middleware.debug) which sometimes never returns."><y>#</y><d>2020-06-24</d><h>10:42</h><w>dominicm</w>It appears to be a problem with the debug middleware.  I can trim the repro down to typing <code>(require &apos;cider.nrepl.middleware.debug)</code> which sometimes never returns.</z><z id="t1592995604" t="dominicm OK, tracked it down to (require &apos;cider.nrepl.inlined-deps.orchard.v0v5v10.orchard.java) , so I guess orchard problem"><y>#</y><d>2020-06-24</d><h>10:46</h><w>dominicm</w>OK, tracked it down to <code>(require &apos;cider.nrepl.inlined-deps.orchard.v0v5v10.orchard.java)</code>, so I guess orchard problem</z><z id="t1592996291" t="dominicm It&apos;s down to these lines: (future (doseq [class (-&gt;&gt; (ns-imports &apos;clojure.core) (map #(-&gt; % ^Class val .getName symbol)))] (class-info class))) "><y>#</y><d>2020-06-24</d><h>10:58</h><w>dominicm</w>It&apos;s down to these lines:

<pre>(future
  (doseq [class (-&gt;&gt; (ns-imports &apos;clojure.core)
                     (map #(-&gt; % ^Class val .getName symbol)))]
    (class-info class)))
</pre></z><z id="t1593002340" t="dominicm Narrowed down to: (let [klass &apos;java.lang.Enum] (when-let [path (source-path klass)] (when-let [root (parse-java path (module-name klass))] (.getTypeElement (.getElementUtils root) &quot;java.lang.Enum&quot;)))) "><y>#</y><d>2020-06-24</d><h>12:39</h><w>dominicm</w>Narrowed down to:

<pre>(let [klass &apos;java.lang.Enum]
    (when-let [path (source-path klass)]
      (when-let [root (parse-java path (module-name klass))]
        (.getTypeElement (.getElementUtils root) &quot;java.lang.Enum&quot;))))
</pre></z><z id="t1593002932" t="bozhidar &gt; Putting this out there in vain hope, has anyone seen an issue where the cider-nrepl middleware causes the JVM to hit itâ€™s maximum open files limit? Nope. ðŸ™‚"><y>#</y><d>2020-06-24</d><h>12:48</h><w>bozhidar</w>&gt; Putting this out there in vain hope, has anyone seen an issue where the cider-nrepl middleware causes the JVM to hit itâ€™s maximum open files limit?
Nope. <b>ðŸ™‚</b></z><z id="t1593003062" t="bozhidar Seems youâ€™ve narrowed down the issue pretty quickly, though."><y>#</y><d>2020-06-24</d><h>12:51</h><w>bozhidar</w>Seems youâ€™ve narrowed down the issue pretty quickly, though.</z><z id="t1593003119" t="bozhidar Iâ€™m wondering why the resources donâ€™t get released, though."><y>#</y><d>2020-06-24</d><h>12:51</h><w>bozhidar</w>Iâ€™m wondering why the resources donâ€™t get released, though.</z><z id="t1593003307" t="dominicm Blugh, sorry, I forgot to mention a critical detail: It&apos;s .jar files that are being opened, most importantly, it&apos;s my classpath&apos;s jar files being duplicated."><y>#</y><d>2020-06-24</d><h>12:55</h><w>dominicm</w>Blugh, sorry, I forgot to mention a critical detail:  It&apos;s .jar files that are being opened, most importantly, it&apos;s my classpath&apos;s jar files being duplicated.</z><z id="t1593003335" t="dominicm My open file count nearly doubles when I run the above."><y>#</y><d>2020-06-24</d><h>12:55</h><w>dominicm</w>My open file count nearly doubles when I run the above.</z><z id="t1593003971" t="dominicm In fact, it happens every time I run the above, it adds ~36 items (length of my cp)"><y>#</y><d>2020-06-24</d><h>13:06</h><w>dominicm</w>In fact, it happens every time I run the above, it adds ~36 items (length of my cp)</z><z id="t1593003993" t="dpsutton adds 36 new open files?"><y>#</y><d>2020-06-24</d><h>13:06</h><w>dpsutton</w>adds 36 new open files?</z><z id="t1593004206" t="dominicm Yup, but they&apos;re the same files as are already open."><y>#</y><d>2020-06-24</d><h>13:10</h><w>dominicm</w>Yup, but they&apos;re the same files as are already open.</z><z id="t1593004218" t="dominicm So I end up with yada.jar twice, ring.jar twice, etc."><y>#</y><d>2020-06-24</d><h>13:10</h><w>dominicm</w>So I end up with yada.jar twice, ring.jar twice, etc.</z><z id="t1593004235" t="dpsutton i&apos;m running clojure -Sdeps &apos;{:deps {nrepl {:mvn/version &quot;0.7.0&quot;}}}&apos; -m nrepl.cmdline -c -p 46397 but getting connection refused for some reason"><y>#</y><d>2020-06-24</d><h>13:10</h><w>dpsutton</w>i&apos;m running <code>clojure -Sdeps &apos;{:deps {nrepl {:mvn/version &quot;0.7.0&quot;}}}&apos; -m nrepl.cmdline -c -p 46397</code> but getting connection refused for some reason</z><z id="t1593004397" t="dominicm [:attrs {:href &quot;/_/_/users/U11BV7MTK&quot;}] you&apos;ll need to make sure you use the right port :)"><y>#</y><d>2020-06-24</d><h>13:13</h><w>dominicm</w><a>@dpsutton</a> you&apos;ll need to make sure you use the right port :)</z><z id="t1593004408" t="dominicm But the better way to do all of this is to work from the orchard repo"><y>#</y><d>2020-06-24</d><h>13:13</h><w>dominicm</w>But the better way to do all of this is to work from the orchard repo</z><z id="t1593004414" t="dominicm I&apos;ve detached nrepl itself from the problem now"><y>#</y><d>2020-06-24</d><h>13:13</h><w>dominicm</w>I&apos;ve detached nrepl itself from the problem now</z><z id="t1593004418" t="dpsutton ah ok"><y>#</y><d>2020-06-24</d><h>13:13</h><w>dpsutton</w>ah ok</z><z id="t1593004467" t="dpsutton i was thinking that was starting up an nrepl server on port 46397 so the port in the command line was the right port"><y>#</y><d>2020-06-24</d><h>13:14</h><w>dpsutton</w>i was thinking that was starting up an nrepl server on port 46397 so the port in the command line was the right port</z><z id="t1593004476" t="dominicm Steps to repro now are to: * Check file descriptor count * Go to orchard, type: $ clj Clojure 1.10.1 user=&gt; (require &apos;orchard.java) (require &apos;orchard.java.parser) (in-ns &apos;orchard.java.parser) nil nil #object[clojure.lang.Namespace 0x5c83ae01 &quot;orchard.java.parser&quot;] (let [klass &apos;java.lang.Enum] (when-let [path (source-path klass)] (when-let [root (parse-java path (module-name klass))] (.getTypeElement (.getElementUtils root) (str klass))))) WARNING: An illegal reflective access operation has occurred WARNING: Illegal reflective access by clojure.lang.InjectedInvoker/0x0000000800232040 (file:/home/overfl0w/.m2/repository/org/clojure/clojure/1.10.1/clojure-1.10.1.jar) to method com.sun.tools.javac.model.JavacElements.getTypeElement(java.lang.CharSequence) WARNING: Please consider reporting this to the maintainers of clojure.lang.InjectedInvoker/0x0000000800232040 WARNING: Use --illegal-access=warn to enable warnings of further illegal reflective access operations WARNING: All illegal access operations will be denied in a future release #object[com.sun.tools.javac.code.Symbol$ClassSymbol 0x383caf89 &quot;java.lang.Enum&quot;] * Check file descriptor again"><y>#</y><d>2020-06-24</d><h>13:14</h><w>dominicm</w>Steps to repro now are to:

* Check file descriptor count
* Go to orchard, type:
<pre>$ clj
Clojure 1.10.1
user=&gt; (require &apos;orchard.java) (require &apos;orchard.java.parser) (in-ns &apos;orchard.java.parser)
nil
nil
#object[clojure.lang.Namespace 0x5c83ae01 &quot;orchard.java.parser&quot;]
(let [klass &apos;java.lang.Enum]
    (when-let [path (source-path klass)]
      (when-let [root (parse-java path (module-name klass))]
        (.getTypeElement (.getElementUtils root) (str klass)))))
WARNING: An illegal reflective access operation has occurred
WARNING: Illegal reflective access by clojure.lang.InjectedInvoker/0x0000000800232040 (file:/home/overfl0w/.m2/repository/org/clojure/clojure/1.10.1/clojure-1.10.1.jar) to method com.sun.tools.javac.model.JavacElements.getTypeElement(java.lang.CharSequence)
WARNING: Please consider reporting this to the maintainers of clojure.lang.InjectedInvoker/0x0000000800232040
WARNING: Use --illegal-access=warn to enable warnings of further illegal reflective access operations
WARNING: All illegal access operations will be denied in a future release
#object[com.sun.tools.javac.code.Symbol$ClassSymbol 0x383caf89 &quot;java.lang.Enum&quot;]
</pre>
* Check file descriptor again</z><z id="t1593004485" t="dominicm Sorry, no :p I was a bit lazy"><y>#</y><d>2020-06-24</d><h>13:14</h><w>dominicm</w>Sorry, no :p I was a bit lazy</z><z id="t1593004539" t="dominicm I&apos;m starting to think that I&apos;m going to end up reporting a JDK bug :("><y>#</y><d>2020-06-24</d><h>13:15</h><w>dominicm</w>I&apos;m starting to think that I&apos;m going to end up reporting a JDK bug :(</z><z id="t1593004635" t="dominicm find /proc/$(pgrep java)/fd -printf &apos;%l\n&apos; | sort | uniq --repeated will show you what&apos;s repeated in the fds."><y>#</y><d>2020-06-24</d><h>13:17</h><w>dominicm</w><code>find /proc/$(pgrep java)/fd -printf &apos;%l\n&apos; | sort | uniq --repeated</code> will show you what&apos;s repeated in the fds.</z><z id="t1593004954" t="dominicm If I reuse the return value of getElementUtils, it doesn&apos;t use additional. So it&apos;s a resource managed by getElementUtils, but activated by calling getTypeElement."><y>#</y><d>2020-06-24</d><h>13:22</h><w>dominicm</w>If I reuse the return value of getElementUtils, it doesn&apos;t use additional.  So it&apos;s a resource managed by getElementUtils, but activated by calling getTypeElement.</z><z id="t1593005024" t="dpsutton well speaking of jdk bug, can you easily switch versions and repo, and then switch jdk vendors and repo? got correto laying around?"><y>#</y><d>2020-06-24</d><h>13:23</h><w>dpsutton</w>well speaking of jdk bug, can you easily switch versions and repo, and then switch jdk vendors and repo? got correto laying around?</z><z id="t1593005248" t="dominicm I can switch to 8, but that uses a totally different code path, so doesn&apos;t seem worth testing."><y>#</y><d>2020-06-24</d><h>13:27</h><w>dominicm</w>I can switch to 8, but that uses a totally different code path, so doesn&apos;t seem worth testing.</z><z id="t1593005262" t="dominicm I&apos;ll give corretto a go"><y>#</y><d>2020-06-24</d><h>13:27</h><w>dominicm</w>I&apos;ll give corretto a go</z><z id="t1593005521" t="dominicm I can repro on corretto 11."><y>#</y><d>2020-06-24</d><h>13:32</h><w>dominicm</w>I can repro on corretto 11.</z><z id="t1593005917" t="dominicm If I close the JavaFileManager under the env, the files are cleaned up!"><y>#</y><d>2020-06-24</d><h>13:38</h><w>dominicm</w>If I close the JavaFileManager under the env, the files are cleaned up!</z><z id="t1593006147" t="dominicm Sticking a finally around the use of the doclet env which closes the file manager seems to do the trick, but I&apos;d love to find some java docs saying what the cleanup is for this kind of thingâ€¦"><y>#</y><d>2020-06-24</d><h>13:42</h><w>dominicm</w>Sticking a <code>finally</code> around the use of the doclet env which closes the file manager seems to do the trick, but I&apos;d love to find some java docs saying what the cleanup is for this kind of thingâ€¦</z><z id="t1593006170" t="dominicm Alternatively, we could use our own file manager, which might dedupe if it&apos;s (re)used across doclets. Then you only double the classpath."><y>#</y><d>2020-06-24</d><h>13:42</h><w>dominicm</w>Alternatively, we could use our own file manager, which might dedupe if it&apos;s (re)used across doclets.  Then you only double the classpath.</z><z id="t1593006440" t="dpsutton where is this?"><y>#</y><d>2020-06-24</d><h>13:47</h><w>dpsutton</w>where is this?</z><z id="t1593006479" t="dominicm In the orchard repo, in orchard.java.parser, this version fixes it: (defn source-info &quot;If the source for the Java class is available on the classpath, parse it and return info to supplement reflection. Specifically, this includes source file and position, docstring, and argument name info. Info returned has the same structure as that of `orchard.java/reflect-info`.&quot; [klass] {:pre [(symbol? klass)]} (try (when-let [path (source-path klass)] (when-let [root (parse-java path (module-name klass))] (try (assoc (-&gt;&gt; (.getIncludedElements ^DocletEnvironment root) (filter #(#{ElementKind/CLASS ElementKind/INTERFACE ElementKind/ENUM} (.getKind ^Element %))) (map #(parse-info % root)) (filter #(= klass (:class %))) (first)) :file path :path (.getPath (io/resource path))) (finally (.close (.getJavaFileManager root)))))) (catch Throwable _))) "><y>#</y><d>2020-06-24</d><h>13:47</h><w>dominicm</w>In the orchard repo, in orchard.java.parser, this version fixes it:

<pre>(defn source-info
  &quot;If the source for the Java class is available on the classpath, parse it
  and return info to supplement reflection. Specifically, this includes source
  file and position, docstring, and argument name info. Info returned has the
  same structure as that of `orchard.java/reflect-info`.&quot;
  [klass]
  {:pre [(symbol? klass)]}
  (try
    (when-let [path (source-path klass)]
      (when-let [root (parse-java path (module-name klass))]
        (try
          (assoc (-&gt;&gt; (.getIncludedElements ^DocletEnvironment root)
                      (filter #(#{ElementKind/CLASS
                                  ElementKind/INTERFACE
                                  ElementKind/ENUM}
                                 (.getKind ^Element %)))
                      (map #(parse-info % root))
                      (filter #(= klass (:class %)))
                      (first))
                 :file path
                 :path (.getPath (io/resource path)))
          (finally
            (.close (.getJavaFileManager root))))))
    (catch Throwable _)))
</pre></z><z id="t1593006485" t="dominicm I think I&apos;ve found the info I was looking for"><y>#</y><d>2020-06-24</d><h>13:48</h><w>dominicm</w>I think I&apos;ve found the info I was looking for</z><z id="t1593006608" t="dominicm https://docs.oracle.com/en/java/javase/11/docs/api/java.compiler/javax/tools/JavaCompiler.html &gt; Reusing a file manager can potentially reduce overhead of scanning the file system and reading jar files. Although there might be no reduction in overhead, a standard file manager must work with multiple sequential compilations making the following example a recommended coding pattern: And the recommended coding pattern includes: &gt; fileManager.close();"><y>#</y><d>2020-06-24</d><h>13:50</h><w>dominicm</w><a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.compiler/javax/tools/JavaCompiler.html" target="_blank">https://docs.oracle.com/en/java/javase/11/docs/api/java.compiler/javax/tools/JavaCompiler.html</a>

&gt; Reusing a file manager can potentially reduce overhead of scanning the file system and reading jar files. Although there might be no reduction in overhead, a standard file manager must work with multiple sequential compilations making the following example a recommended coding pattern: 

And the recommended coding pattern includes:

&gt;        fileManager.close();</z><z id="t1593006645" t="dominicm Given that we want to dynamically work with new docs over an extended period, I think the correct behavior is to reuse a file manager"><y>#</y><d>2020-06-24</d><h>13:50</h><w>dominicm</w>Given that we want to dynamically work with new docs over an extended period, I think the correct behavior is to reuse a file manager</z><z id="t1593007008" t="dominicm Reusing the file manager seems to have done the trick. It doesn&apos;t even double the count, it just doesn&apos;t go up at all!"><y>#</y><d>2020-06-24</d><h>13:56</h><w>dominicm</w>Reusing the file manager seems to have done the trick.  It doesn&apos;t even double the count, it just doesn&apos;t go up at all!</z><z id="t1593007053" t="dominicm oh, that&apos;s because it&apos;s broken and there&apos;s a (catch Throwable _) ðŸ˜"><y>#</y><d>2020-06-24</d><h>13:57</h><w>dominicm</w>oh, that&apos;s because it&apos;s broken and there&apos;s a <code>(catch Throwable _)</code> <b>ðŸ˜</b></z><z id="t1593007114" t="dominicm Okay, now it behaved like I expect. It went 36-&gt;67, but it didn&apos;t keep ballooning like it did before. I forgot to note that I commented out the (future) ."><y>#</y><d>2020-06-24</d><h>13:58</h><w>dominicm</w>Okay, now it behaved like I expect.  It went 36-&gt;67, but it didn&apos;t keep ballooning like it did before.  I forgot to note that I commented out the <code>(future)</code>.</z><z id="t1593010272" t="dominicm So, it works from the REPL, but not the tests."><y>#</y><d>2020-06-24</d><h>14:51</h><w>dominicm</w>So, it works from the REPL, but not the tests.</z><z id="t1593010904" t="dominicm And they run fine independently. Yay. State."><y>#</y><d>2020-06-24</d><h>15:01</h><w>dominicm</w>And they run fine independently.  Yay. State.</z><z id="t1593011809" t="dominicm This is why it fails in the tests (and nowhere else): /tmp/ISeq.java:18: error: cannot find symbol public interface ISeq extends IPersistentCollection { ^ symbol: class IPersistentCollection 1 error I don&apos;t really understand :("><y>#</y><d>2020-06-24</d><h>15:16</h><w>dominicm</w>This is why it fails in the tests (and nowhere else):

<pre>/tmp/ISeq.java:18: error: cannot find symbol
public interface ISeq extends IPersistentCollection {
                              ^
  symbol: class IPersistentCollection
1 error
</pre>

I don&apos;t really understand :(</z><z id="t1593012026" t="dominicm I wonder if there&apos;s something stateful going on with the file manager..."><y>#</y><d>2020-06-24</d><h>15:20</h><w>dominicm</w>I wonder if there&apos;s something stateful going on with the file manager...</z><z id="t1593014743" t="dominicm I can&apos;t get compiler reuse version to work, so I&apos;m going to assume that it can&apos;t work for some technical reason I don&apos;t understand, and instead use .close."><y>#</y><d>2020-06-24</d><h>16:05</h><w>dominicm</w>I can&apos;t get compiler reuse version to work, so I&apos;m going to assume that it can&apos;t work for some technical reason I don&apos;t understand, and instead use .close.</z><z id="t1593014762" t="dominicm It&apos;s no less efficient than the code is now, it just would have been faster if I&apos;d got it to work"><y>#</y><d>2020-06-24</d><h>16:06</h><w>dominicm</w>It&apos;s no less efficient than the code is now, it just would have been faster if I&apos;d got it to work</z><z id="t1593014771" t="dominicm I suspect it&apos;s because there&apos;s compiler state between builds, or something."><y>#</y><d>2020-06-24</d><h>16:06</h><w>dominicm</w>I suspect it&apos;s because there&apos;s compiler state between builds, or something.</z><z id="t1593015548" t="dominicm https://github.com/clojure-emacs/orchard/pull/95 Opened the .close solution."><y>#</y><d>2020-06-24</d><h>16:19</h><w>dominicm</w><a href="https://github.com/clojure-emacs/orchard/pull/95" target="_blank">https://github.com/clojure-emacs/orchard/pull/95</a> Opened the .close solution.</z><z id="t1593015570" t="dominicm I guess I can try and workaround this by monkeypatching cider&apos;s orchard? Yikes."><y>#</y><d>2020-06-24</d><h>16:19</h><w>dominicm</w>I guess I can try and workaround this by monkeypatching cider&apos;s orchard? Yikes.</z><z id="t1593065854" t="bozhidar [:attrs {:href &quot;/_/_/users/U09LZR36F&quot;}] Thanks! Iâ€™ll merge this and cut a bug fix release soon."><y>#</y><d>2020-06-25</d><h>06:17</h><w>bozhidar</w><a>@dominicm</a> Thanks! Iâ€™ll merge this and cut a bug fix release soon.</z><z id="t1593795453" t="Jakub HolÃ½ (HolyJak) Hello! When I start nREPL from a terminal then some output (println, System.out.print etc) will go to that terminal. Is there a way for the output to go also to the connected client so that I can only focus on the REPL window in my editor and don&apos;t need to check the terminal in addition to that? Thank you!"><y>#</y><d>2020-07-03</d><h>16:57</h><w>Jakub HolÃ½ (HolyJak)</w>Hello! When I start nREPL from a terminal then some output (println, System.out.print etc) will go to that terminal. Is there  a way for the output to go also to the connected client so that I can only focus on the REPL window in my editor and don&apos;t need to check the terminal in addition to that? Thank you!</z><z id="t1593805557" t="dominicm There&apos;s a cider middleware which can capture System out"><y>#</y><d>2020-07-03</d><h>19:45</h><w>dominicm</w>There&apos;s a cider middleware which can capture System out</z><z id="t1593805656" t="flowthing I am actually also interested if thereâ€™s a non-CIDER option."><y>#</y><d>2020-07-03</d><h>19:47</h><w>flowthing</w>I am actually also interested if thereâ€™s a non-CIDER option.</z><z id="t1593805714" t="flowthing I vaguely remember something about rebinding *out* , but not sure."><y>#</y><d>2020-07-03</d><h>19:48</h><w>flowthing</w>I vaguely remember something about rebinding <code>*out*</code>, but not sure.</z><z id="t1593849606" t="dominicm That wouldn&apos;t work for System/out."><y>#</y><d>2020-07-04</d><h>08:00</h><w>dominicm</w>That wouldn&apos;t work for System/out.</z><z id="t1593849652" t="dominicm The CIDER version exists because there&apos;s nothing built in for this. You could copy the cider solution if you wanted I suppose."><y>#</y><d>2020-07-04</d><h>08:00</h><w>dominicm</w>The CIDER version exists because there&apos;s nothing built in for this.  You could copy the cider solution if you wanted I suppose.</z><z id="t1593850474" t="flowthing Right, Iâ€™ll look into it â€” thanks."><y>#</y><d>2020-07-04</d><h>08:14</h><w>flowthing</w>Right, Iâ€™ll look into it â€” thanks.</z><z id="t1594017293" t="bozhidar Probably at some point we should revisit the topic in nREPL itself."><y>#</y><d>2020-07-06</d><h>06:34</h><w>bozhidar</w>Probably at some point we should revisit the topic in nREPL itself.</z><z id="t1594017367" t="bozhidar Hereâ€™s the middleware in question https://github.com/clojure-emacs/cider-nrepl/blob/master/src/cider/nrepl/middleware/out.clj"><y>#</y><d>2020-07-06</d><h>06:36</h><w>bozhidar</w>Hereâ€™s the middleware in question <a href="https://github.com/clojure-emacs/cider-nrepl/blob/master/src/cider/nrepl/middleware/out.clj" target="_blank">https://github.com/clojure-emacs/cider-nrepl/blob/master/src/cider/nrepl/middleware/out.clj</a></z><z id="t1594017472" t="bozhidar There has been a ticket for this for a while now https://github.com/nrepl/nrepl/issues/119"><y>#</y><d>2020-07-06</d><h>06:37</h><w>bozhidar</w>There has been a ticket for this for a while now <a href="https://github.com/nrepl/nrepl/issues/119" target="_blank">https://github.com/nrepl/nrepl/issues/119</a></z><z id="t1594199044" t="Jakub HolÃ½ (HolyJak) Hello! Why does running 0.8.0-alpha5 via tools deps with :main-opts [&quot;-m&quot; &quot;nrepl.cmdline&quot; &quot;--port&quot; &quot;9832&quot;] fail with &gt; Execution error (AssertionError) at nrepl.core/connect (core.clj:168). &gt; Assert failed: port ? I expected it to start the server at the given port, not trying to connect to one?! What do I do wrong? Thank you!"><y>#</y><d>2020-07-08</d><h>09:04</h><w>Jakub HolÃ½ (HolyJak)</w>Hello! Why does running 0.8.0-alpha5 via tools deps with <code>:main-opts [&quot;-m&quot; &quot;nrepl.cmdline&quot; &quot;--port&quot; &quot;9832&quot;]</code> fail with
&gt; Execution error (AssertionError) at nrepl.core/connect (core.clj:168).
&gt; Assert failed: port
? I expected it to start the server at the given port, not trying to connect to one?! What do I do wrong? Thank you!</z><z id="t1594199206" t="flowthing How are you invoking clojure ? I have an alias like this in my deps.edn : :aliases {:nrepl/server {:extra-deps {nrepl {:mvn/version &quot;0.8.0-alpha5&quot;}} :main-opts [&quot;--main&quot; &quot;nrepl.cmdline&quot; &quot;--port&quot; &quot;1234&quot;]}} And I invoke it like this: $ clojure -A:nrepl/server And it works fine."><y>#</y><d>2020-07-08</d><h>09:06</h><r>flowthing</r>How are you invoking <code>clojure</code>?

I have an alias like this in my <code>deps.edn</code>:
<pre>:aliases {:nrepl/server {:extra-deps {nrepl {:mvn/version &quot;0.8.0-alpha5&quot;}}
                         :main-opts [&quot;--main&quot; &quot;nrepl.cmdline&quot; &quot;--port&quot; &quot;1234&quot;]}}</pre>
And I invoke it like this:
<pre>$ clojure -A:nrepl/server</pre>
And it works fine.</z><z id="t1594199290" t="flowthing Also, have you tried -Srepro ? Maybe thereâ€™s something in your ~/.clojure/deps.edn that causes the issue."><y>#</y><d>2020-07-08</d><h>09:08</h><r>flowthing</r>Also, have you tried <code>-Srepro</code> ? Maybe thereâ€™s something in your <code>~/.clojure/deps.edn</code> that causes the issue.</z><z id="t1594199315" t="flowthing (Also, on an unrelated note, I absolutely despise how Slack wonâ€™t let me just use Markdown any moreâ€¦)"><y>#</y><d>2020-07-08</d><h>09:08</h><r>flowthing</r>(Also, on an unrelated note, I absolutely despise how Slack wonâ€™t let me just use Markdown any moreâ€¦)</z><z id="t1594199868" t="Jakub HolÃ½ (HolyJak) Thanks a lot! The solution was simple: rm ~/.clojure/deps.edn ðŸ™‚ I had the nrepl profile defined there as well, differently. Surprisingly the local deps.edn does not take precedence..."><y>#</y><d>2020-07-08</d><h>09:17</h><r>Jakub HolÃ½ (HolyJak)</r>Thanks a lot! The solution was simple: <code>rm ~/.clojure/deps.edn</code> <b>ðŸ™‚</b> I had the nrepl profile defined there as well, differently. Surprisingly the local deps.edn does not take precedence...</z><z id="t1594199933" t="flowthing Well, you could have just removed the alias instead of deleting the whole file, but Iâ€™m glad the issueâ€™s solved. ðŸ™‚"><y>#</y><d>2020-07-08</d><h>09:18</h><r>flowthing</r>Well, you could have just removed the alias instead of deleting the whole file, but Iâ€™m glad the issueâ€™s solved. <b>ðŸ™‚</b></z><z id="t1594200373" t="Jakub HolÃ½ (HolyJak) sure ðŸ™‚"><y>#</y><d>2020-07-08</d><h>09:26</h><r>Jakub HolÃ½ (HolyJak)</r>sure <b>ðŸ™‚</b></z><z id="t1594200757" t="Jakub HolÃ½ (HolyJak) Question 2: After having started a server as described above â˜ï¸ I try to connect to it (same options plus --connect ) but it fails with &gt; Exception starting REPL: java.lang.IllegalStateException: Could not open new session; :clone response Why? Thank you!"><y>#</y><d>2020-07-08</d><h>09:32</h><w>Jakub HolÃ½ (HolyJak)</w>Question 2: After having started a server as described above <b>â˜ï¸</b> I try to connect to it (same options plus <code>--connect</code> ) but it fails with
&gt; Exception starting REPL: java.lang.IllegalStateException: Could not open new session; :clone response
Why? Thank you!</z><z id="t1594201311" t="flowthing $ clojure -Srepro -Sdeps &apos;{:deps {nrepl {:mvn/version &quot;0.8.0-alpha5&quot;}}}&apos; --main nrepl.cmdline --port 1234 Followed by: clojure -Srepro -Sdeps &apos;{:deps {nrepl {:mvn/version &quot;0.8.0-alpha5&quot;}}}&apos; --main nrepl.cmdline --connect --port 1234 Seems to work for me."><y>#</y><d>2020-07-08</d><h>09:41</h><r>flowthing</r><pre>$ clojure -Srepro -Sdeps &apos;{:deps {nrepl {:mvn/version &quot;0.8.0-alpha5&quot;}}}&apos; --main nrepl.cmdline --port 1234</pre>
Followed by:

<pre>clojure -Srepro -Sdeps &apos;{:deps {nrepl {:mvn/version &quot;0.8.0-alpha5&quot;}}}&apos; --main nrepl.cmdline --connect --port 1234</pre>
Seems to work for me.</z><z id="t1594201377" t="flowthing You could maybe add -J-Dclojure.main.report=stderr to your command-line invocation and show us the full stack trace â€” that might be helpful."><y>#</y><d>2020-07-08</d><h>09:42</h><r>flowthing</r>You could maybe add <code>-J-Dclojure.main.report=stderr</code> to your command-line invocation and show us the full stack trace â€” that might be helpful.</z><z id="t1594211844" t="Jakub HolÃ½ (HolyJak) Thank you! I found the problem. I am running it inside a Docker container and thought that the default bind addr. of 127.0.0.1 is ok when I map the docker port to a local port but obviously not. So the fix was to add -b 0.0.0.0 to the server inside Docker"><y>#</y><d>2020-07-08</d><h>12:37</h><r>Jakub HolÃ½ (HolyJak)</r>Thank you! I found the problem. I am running it inside a Docker container and thought that the default bind addr. of 127.0.0.1 is ok when I map the docker port to a local port but obviously not. So the fix was to add <code>-b 0.0.0.0</code> to the server inside Docker</z><z id="t1594200897" t="Jakub HolÃ½ (HolyJak) â˜ï¸ fixed it by downgrading to alpha1"><y>#</y><d>2020-07-08</d><h>09:34</h><w>Jakub HolÃ½ (HolyJak)</w><b>â˜ï¸</b> fixed it by downgrading to alpha1</z><z id="t1594585443" t="Kevin Hello, I&apos;m trying out nrepl/drawbridge and I got it to work, but the CPU usage is very high when I&apos;m connected via lein repl :connect ,,, . All I&apos;m doing is following the README, creating an nrepl-handler, and passing it the request variable in my handler. In my setup I&apos;m using Duct (The param middlewares are included)"><y>#</y><d>2020-07-12</d><h>20:24</h><w>Kevin</w>Hello, I&apos;m trying out <code>nrepl/drawbridge</code> and I got it to work, but the CPU usage is very high when I&apos;m connected via <code>lein repl :connect ,,,</code>. All I&apos;m doing is following the README, creating an nrepl-handler, and passing it the <code>request</code> variable in my handler. In my setup I&apos;m using Duct (The param middlewares are included)</z><z id="t1594585534" t="Kevin And I&apos;m using Reitit for routing, but not sure if that matters or not"><y>#</y><d>2020-07-12</d><h>20:25</h><w>Kevin</w>And I&apos;m using Reitit for routing, but not sure if that matters or not</z><z id="t1594586244" t="Kevin Oh, might be this issue https://github.com/nrepl/drawbridge/issues/10"><y>#</y><d>2020-07-12</d><h>20:37</h><w>Kevin</w>Oh, might be this issue <a href="https://github.com/nrepl/drawbridge/issues/10" target="_blank">https://github.com/nrepl/drawbridge/issues/10</a></z><z id="t1596095636" t="wegi Hey there, is it possible to execute a main method on nREPL startup? I am using IntelliJ+Cursive for development and starting an nrepl with deps.edn seems to ignore the -m my.awesome.class defined in the deps alias. I&apos;m trying to use."><y>#</y><d>2020-07-30</d><h>07:53</h><w>wegi</w>Hey there, is it possible to execute a main method on nREPL startup? I am using IntelliJ+Cursive for development and starting an nrepl with deps.edn seems to ignore the <code>-m my.awesome.class</code> defined in the deps alias. I&apos;m trying to use.</z><z id="t1596141967" t="bozhidar [:attrs {:href &quot;/_/_/users/U49RJG1L0&quot;}] So, your main is supposed to kick off the server, right? I never thought of something like this as it was always my assumption that you&apos;d want to run the main that boots the server."><y>#</y><d>2020-07-30</d><h>20:46</h><w>bozhidar</w><a>@wegi</a> So, your main is supposed to kick off the server, right? I never thought of something like this as it was always my assumption that you&apos;d want to run the main that boots the server.</z><z id="t1596178292" t="wegi Yes exactly. I could of course just start the repl and the start the server out of the repl. It would just be a convenience, and I was not sure if I maybe missed an option ðŸ˜„"><y>#</y><d>2020-07-31</d><h>06:51</h><w>wegi</w>Yes exactly. I could of course just start the repl and the start the server out of the repl. It would just be a convenience, and I was not sure if I maybe missed an option <b>ðŸ˜„</b></z><z id="t1596178730" t="dominicm Can share the snippet I use for this :)"><y>#</y><d>2020-07-31</d><h>06:58</h><w>dominicm</w>Can share the snippet I use for this :)</z><z id="t1596178980" t="dominicm clojure -Sdeps &apos;{:deps {nrepl {:mvn/version &quot;0.7.0&quot;}}}&apos; -e &quot;(require &apos;nrepl.cmdline) (future (nrepl.cmdline/-main))&quot; -m your.main This is no good for short-lived (exiting) processes though, as there&apos;s leftover agents."><y>#</y><d>2020-07-31</d><h>07:03</h><w>dominicm</w><code>clojure -Sdeps &apos;{:deps {nrepl {:mvn/version &quot;0.7.0&quot;}}}&apos; -e &quot;(require &apos;nrepl.cmdline) (future (nrepl.cmdline/-main))&quot; -m your.main</code> This is no good for short-lived (exiting) processes though, as there&apos;s leftover agents.</z><z id="t1596179309" t="wegi This is cool, thanks. I only need it for server processes and in development anyway. Thank you :thumbsup:"><y>#</y><d>2020-07-31</d><h>07:08</h><w>wegi</w>This is cool, thanks. I only need it for server processes and in development anyway. Thank you <b>:thumbsup:</b></z><z id="t1596349030" t="bozhidar FYI - nREPL 0.8 is out https://github.com/nrepl/nrepl/releases/tag/0.8.0"><y>#</y><d>2020-08-02</d><h>06:17</h><w>bozhidar</w>FYI - nREPL 0.8 is out <a href="https://github.com/nrepl/nrepl/releases/tag/0.8.0" target="_blank">https://github.com/nrepl/nrepl/releases/tag/0.8.0</a></z><z id="t1596704060" t="mjmeintjes I am using nrepl in embedded mode, and I am trying to figure out how to set nrepl.middleware.print/print-fn. How and where do I set these dynamic variables?"><y>#</y><d>2020-08-06</d><h>08:54</h><w>mjmeintjes</w>I am using nrepl in embedded mode, and I am trying to figure out how to set nrepl.middleware.print/print-fn. How and where do I set these dynamic variables?</z><z id="t1597139959" t="bozhidar [:attrs {:href &quot;/_/_/users/U0ELC2CG6&quot;}] You just set them in your REPL, like any other dynamic variable."><y>#</y><d>2020-08-11</d><h>09:59</h><w>bozhidar</w><a>@mjmeintjes</a> You just set them in your REPL, like any other dynamic variable.</z><z id="t1597304901" t="dharrigan I&apos;m trying an experiment in pre-compiling the source of my projects to speed up launch time of the clj, following the information presented here . However, I&apos;m enountering an issue that seems to be thrown by nrepl (in 0.7.0 and in 0.8.0 - the stack is higher in 0.8.0), when I open my editor (neovim + conjure). Here is a snippet of what is thrown:"><y>#</y><d>2020-08-13</d><h>07:48</h><w>dharrigan</w>I&apos;m trying an experiment in pre-compiling the source of my projects to speed up launch time of the clj, following the information presented here <code></code>. However, I&apos;m enountering an issue that seems to be thrown by nrepl (in 0.7.0 and in 0.8.0 - the stack is higher in 0.8.0), when I open my editor (neovim + conjure). Here is a snippet of what is thrown:</z><z id="t1597304922" t="dharrigan user=&gt; ERROR: Unhandled REPL handler exception processing message {:code (ns conjure.internal (:require [clojure.pprint :as pp]))(defn pprint [val w opts] (apply pp/write val (mapcat identity (assoc opts :stream w)))), :id 15ba2b17-3b84-463d-bc55-8a1b0dcf882a, :op eval} java.lang.NullPointerException at clojure.core$deref_future.invokeStatic(core.clj:2300) at clojure.core$deref.invokeStatic(core.clj:2320) at clojure.core$deref.invoke(core.clj:2306) at cider.nrepl$wrap_tracker$fn__4976.invoke(nrepl.clj:460) at nrepl.middleware$wrap_conj_descriptor$fn__3858.invoke(middleware.clj:16) at nrepl.middleware.session$session$fn__4249.invoke(session.clj:309) at nrepl.middleware$wrap_conj_descriptor$fn__3858.invoke(middleware.clj:16) at nrepl.server$default_handler$fn__4779.invoke(server.clj:130)"><y>#</y><d>2020-08-13</d><h>07:48</h><w>dharrigan</w><pre>user=&gt; ERROR: Unhandled REPL handler exception processing message {:code (ns conjure.internal  (:require [clojure.pprint :as pp]))(defn pprint [val w opts]  (apply pp/write val    (mapcat identity (assoc opts :stream w)))), :id 15ba2b17-3b84-463d-bc55-8a1b0dcf882a, :op eval}
java.lang.NullPointerException
	at clojure.core$deref_future.invokeStatic(core.clj:2300)
	at clojure.core$deref.invokeStatic(core.clj:2320)
	at clojure.core$deref.invoke(core.clj:2306)
	at cider.nrepl$wrap_tracker$fn__4976.invoke(nrepl.clj:460)
	at nrepl.middleware$wrap_conj_descriptor$fn__3858.invoke(middleware.clj:16)
	at nrepl.middleware.session$session$fn__4249.invoke(session.clj:309)
	at nrepl.middleware$wrap_conj_descriptor$fn__3858.invoke(middleware.clj:16)
	at nrepl.server$default_handler$fn__4779.invoke(server.clj:130)</pre></z><z id="t1597304936" t="dharrigan and below it, another exeption"><y>#</y><d>2020-08-13</d><h>07:48</h><w>dharrigan</w>and below it, another exeption</z><z id="t1597304940" t="dharrigan ERROR: Unhandled REPL handler exception processing message {:code #?(:clj &apos;clj :cljs &apos;cljs :cljr &apos;cljr :default &apos;unknown), :id 7be0fda4-379d-49e0-b2d6-37fa14de595a, :op eval, :session 61afff04-3d2a-4eaa-9155-8c31f5d12f46} java.lang.NullPointerException at clojure.core$deref_future.invokeStatic(core.clj:2300) at clojure.core$deref.invokeStatic(core.clj:2320) at clojure.core$deref.invoke(core.clj:2306) at cider.nrepl$wrap_tracker$fn__4976.invoke(nrepl.clj:460)"><y>#</y><d>2020-08-13</d><h>07:49</h><w>dharrigan</w><pre>ERROR: Unhandled REPL handler exception processing message {:code #?(:clj &apos;clj :cljs &apos;cljs :cljr &apos;cljr :default &apos;unknown), :id 7be0fda4-379d-49e0-b2d6-37fa14de595a, :op eval, :session 61afff04-3d2a-4eaa-9155-8c31f5d12f46}
java.lang.NullPointerException
	at clojure.core$deref_future.invokeStatic(core.clj:2300)
	at clojure.core$deref.invokeStatic(core.clj:2320)
	at clojure.core$deref.invoke(core.clj:2306)
	at cider.nrepl$wrap_tracker$fn__4976.invoke(nrepl.clj:460)</pre></z><z id="t1597304979" t="dharrigan When I delete the classes directory and launch clj normally, thus reverting to on-demand compliation of the clj files, no exceptions are thrown."><y>#</y><d>2020-08-13</d><h>07:49</h><w>dharrigan</w>When I delete the <code>classes</code> directory and launch <code>clj</code> normally, thus reverting to on-demand compliation of the clj files, no exceptions are thrown.</z><z id="t1597305032" t="dharrigan So, to recap, if I pre-compile clj, launch the repl and open the editor, that stack is thrown. If I remove the classes directory, launch the repl and open the editor, no exceptions are thrown."><y>#</y><d>2020-08-13</d><h>07:50</h><w>dharrigan</w>So, to recap, if I pre-compile clj, launch the repl and open the editor, that stack is thrown. If I remove the classes directory, launch the repl and open the editor, no exceptions are thrown.</z><z id="t1597305038" t="dharrigan Has anyone come across this one before?"><y>#</y><d>2020-08-13</d><h>07:50</h><w>dharrigan</w>Has anyone come across this one before?</z><z id="t1597306208" t="dominicm Second error looks like cider"><y>#</y><d>2020-08-13</d><h>08:10</h><w>dominicm</w>Second error looks like cider</z><z id="t1597306216" t="dominicm I think there&apos;s a cider issue about aot"><y>#</y><d>2020-08-13</d><h>08:10</h><w>dominicm</w>I think there&apos;s a cider issue about aot</z><z id="t1597306747" t="dharrigan ooh"><y>#</y><d>2020-08-13</d><h>08:19</h><w>dharrigan</w>ooh</z><z id="t1599935406" t="Jakub HolÃ½ (HolyJak) Hello! I am trying to run nrepl inside Docker for a VSCode remote dev container. The Dockerfile ends up with CMD [&quot;clojure&quot;, &quot;-A:nrepl&quot;, &quot;--bind&quot;, &quot;0.0.0.0&quot;] and the port is defined in deps.edn and exposed and I can connect to it with telnet. But when I connect with a nrepl client, I never get to the prompt, it just freezes: ðŸŸ clj -A:nrepl --connect --host me --port 52162 [*master] nREPL 0.8.0-alpha5 Clojure 1.10.1 OpenJDK 64-Bit Server VM 11.0.1+13 Interrupt: Control+C Exit: Control+D or (exit) or (quit) What could it mean? How to troubleshoot? In deps.edn I have :nrepl {:extra-deps {nrepl/nrepl {:mvn/version &quot;0.8.0-alpha5&quot;}} :main-opts [&quot;-m&quot; &quot;nrepl.cmdline&quot; &quot;--port&quot; &quot;52162&quot;]}"><y>#</y><d>2020-09-12</d><h>18:30</h><w>Jakub HolÃ½ (HolyJak)</w>Hello! I am trying to run nrepl inside Docker for a VSCode remote dev container. The Dockerfile ends up with <code>CMD [&quot;clojure&quot;, &quot;-A:nrepl&quot;, &quot;--bind&quot;, &quot;0.0.0.0&quot;]</code> and the port is defined in <code>deps.edn</code> and exposed and I can connect to it with telnet. But when I connect with a nrepl client, I never get to the prompt, it just freezes:
<pre>ðŸŸ  clj -A:nrepl --connect --host me --port 52162          [*master]
nREPL 0.8.0-alpha5
Clojure 1.10.1
OpenJDK 64-Bit Server VM 11.0.1+13
Interrupt: Control+C
Exit:      Control+D or (exit) or (quit)</pre>
What could it mean? How to troubleshoot? In deps.edn I have
<pre>:nrepl {:extra-deps {nrepl/nrepl {:mvn/version &quot;0.8.0-alpha5&quot;}}
        :main-opts [&quot;-m&quot; &quot;nrepl.cmdline&quot; &quot;--port&quot; &quot;52162&quot;]}</pre></z><z id="t1599936366" t="Jakub HolÃ½ (HolyJak) BTW sometimes it works as it should... So I guess it is some kind of a timing issue."><y>#</y><d>2020-09-12</d><h>18:46</h><r>Jakub HolÃ½ (HolyJak)</r>BTW sometimes it works as it should... So I guess it is some kind of a timing issue.</z><z id="t1599973932" t="flowthing I donâ€™t know what the issue is, but I also worked on making a Docker image for running an nREPL server a while back, and ended up with this: FROM clojure:openjdk-16-tools-deps-alpine ENV NREPL_VERSION 0.8.0 ENTRYPOINT clojure -Sdeps &quot;{:deps {nrepl/nrepl {:mvn/version \&quot;$NREPL_VERSION\&quot;}}}&quot; --main nrepl.cmdline --bind 0.0.0.0 --port 1234 ADD healthcheck.clj . HEALTHCHECK --interval=5s --timeout=30s --start-period=5s --retries=5 CMD clojure healthcheck.clj EXPOSE 1234/tcp Where healthcheck.clj looks like this: (import &apos;( Socket)) (Socket. &quot;localhost&quot; 1234) Not that the health check is necessary in your case. Anyway, it seems to work â€” at least I havenâ€™t encountered the issue you describe. FWIW. ðŸ™‚"><y>#</y><d>2020-09-13</d><h>05:12</h><r>flowthing</r>I donâ€™t know what the issue is, but I also worked on making a Docker image for running an nREPL server a while back, and ended up with this:

<pre>FROM clojure:openjdk-16-tools-deps-alpine
ENV NREPL_VERSION 0.8.0
ENTRYPOINT clojure -Sdeps &quot;{:deps {nrepl/nrepl {:mvn/version \&quot;$NREPL_VERSION\&quot;}}}&quot; --main nrepl.cmdline --bind 0.0.0.0 --port 1234
ADD healthcheck.clj .
HEALTHCHECK --interval=5s --timeout=30s --start-period=5s --retries=5 CMD clojure healthcheck.clj
EXPOSE 1234/tcp</pre>
Where <code>healthcheck.clj</code> looks like this:

<pre>(import &apos;( Socket))
(Socket. &quot;localhost&quot; 1234)</pre>
Not that the health check is necessary in your case.

Anyway, it seems to work â€” at least I havenâ€™t encountered the issue you describe. FWIW. <b>ðŸ™‚</b></z><z id="t1599996793" t="dominicm Both refactor-nrepl and cider-nrepl have difflib inlined at /"><y>#</y><d>2020-09-13</d><h>11:33</h><w>dominicm</w>Both refactor-nrepl and cider-nrepl have difflib inlined at /</z><z id="t1600084666" t="bozhidar [:attrs {:href &quot;/_/_/users/U09LZR36F&quot;}] I guess it&apos;s a transitive dep of something, as I don&apos;t recall us using it anywhere directly."><y>#</y><d>2020-09-14</d><h>11:57</h><w>bozhidar</w><a>@dominicm</a> I guess it&apos;s a transitive dep of something, as I don&apos;t recall us using it anywhere directly.</z><z id="t1600084804" t="dominicm [:attrs {:href &quot;/_/_/users/U051BLM8F&quot;}] comes in via cljfmt&apos;s dependency on com.googlecode.java-diff-utils/diffutils"><y>#</y><d>2020-09-14</d><h>12:00</h><w>dominicm</w><a>@bozhidar</a> comes in via cljfmt&apos;s dependency on com.googlecode.java-diff-utils/diffutils</z><z id="t1600084825" t="dominicm Dunno why inline-dep wouldn&apos;t be working in that case."><y>#</y><d>2020-09-14</d><h>12:00</h><w>dominicm</w>Dunno why inline-dep wouldn&apos;t be working in that case.</z><z id="t1600101515" t="bozhidar No idea as well. Might be something to do with the ancient version of jarjar that&apos;s currently used by MrAnderson https://github.com/benedekfazekas/mranderson/issues/17"><y>#</y><d>2020-09-14</d><h>16:38</h><w>bozhidar</w>No idea as well. Might be something to do with the ancient version of jarjar that&apos;s currently used by MrAnderson <a href="https://github.com/benedekfazekas/mranderson/issues/17" target="_blank">https://github.com/benedekfazekas/mranderson/issues/17</a></z><z id="t1600603752" t="Pradeep B Hi there !! I have recently written a clojure app using lein + compojure + clj-http and created an uberjar. Now wondering if i can enable the nrepl on the built jar file? Something like - having an api endpoint to start/stop nrepl inside the uberjar. That will help me debug issue in the built jar file when it interacts with test data. P.S.: I am doing this in my UAT environment debugging and Production will be getting rid of this (security concerns)."><y>#</y><d>2020-09-20</d><h>12:09</h><w>Pradeep B</w>Hi there !!

I have recently written a clojure app using lein + compojure + clj-http and created an uberjar.
Now wondering if i can enable the nrepl on the built jar file? Something like - having an api endpoint to start/stop nrepl inside the uberjar. That will help me debug issue in the built jar file when it interacts with test data.

P.S.: I am doing this in my UAT environment debugging and Production will be getting rid of this (security concerns).</z><z id="t1600603778" t="Pradeep B [:attrs {:href &quot;/_/_/users/U0522TWDA&quot;}] you mentioned the approach, in that case service is running with clj."><y>#</y><d>2020-09-20</d><h>12:09</h><r>Pradeep B</r><a>@U0522TWDA</a> you mentioned the approach, in that case service is running with clj.</z><z id="t1600603806" t="Pradeep B some more details related to this in thread here https://clojurians.slack.com/archives/C03S1KBA2/p1600600378139500"><y>#</y><d>2020-09-20</d><h>12:10</h><r>Pradeep B</r>some more details related to this in thread here <a href="https://clojurians.slack.com/archives/C03S1KBA2/p1600600378139500" target="_blank">https://clojurians.slack.com/archives/C03S1KBA2/p1600600378139500</a></z><z id="t1600610446" t="Jakub HolÃ½ (HolyJak) Just start nrepl server in your -main - https://nrepl.org/nrepl/usage/server.html#embedding-nrepl I :bind to 0.0.0.0 since localhost is the default I believe"><y>#</y><d>2020-09-20</d><h>14:00</h><r>Jakub HolÃ½ (HolyJak)</r>Just start nrepl server  in your -main - <a href="https://nrepl.org/nrepl/usage/server.html#embedding-nrepl" target="_blank">https://nrepl.org/nrepl/usage/server.html#embedding-nrepl</a> I :bind to 0.0.0.0 since localhost is the default I believe</z><z id="t1600610952" t="Pradeep B thanks for the response. Did the changes and updated the thread. There was silly code mistake and that was leading to failure. Now resolved and achieved it."><y>#</y><d>2020-09-20</d><h>14:09</h><r>Pradeep B</r>thanks for the response. Did the changes and updated the thread. There was silly code mistake and that was leading to failure. Now resolved and achieved it.</z><z id="t1601055463" t="austin.chamberlin Hello, I&apos;m running REPLy on the command line and the backspace key prints $&lt;3&gt; to the screen. Can anybody help with this? ["><y>#</y><d>2020-09-25</d><h>17:37</h><w>austin.chamberlin</w>Hello, I&apos;m running REPLy on the command line and the backspace key prints <code>$&lt;3&gt;</code> to the screen. Can anybody help with this?
<pre>[</pre></z><z id="t1601066586" t="eraserhd hey all, I just rewrote rep , my single-shot nREPL client, in C for maintainability reasons. It should have complete feature parity with the previous version, but if anyone who is using rep wants to try it out, I would appreciate it. https://github.com/eraserhd/rep/tree/ansi-c"><y>#</y><d>2020-09-25</d><h>20:43</h><w>eraserhd</w>hey all, I just rewrote <code>rep</code>, my single-shot nREPL client, in C for maintainability reasons.  It should have complete feature parity with the previous version, but if anyone who is using rep wants to try it out, I would appreciate it.  <a href="https://github.com/eraserhd/rep/tree/ansi-c" target="_blank">https://github.com/eraserhd/rep/tree/ansi-c</a></z><z id="t1601395476" t="borkdude [:attrs {:href &quot;/_/_/users/U0ECYL0ET&quot;}] Hey, very cool. Feel free to add it to my new package manager: https://github.com/borkdude/glam Just curious, why is the C version more maintainable for you?"><y>#</y><d>2020-09-29</d><h>16:04</h><w>borkdude</w><a>@eraserhd</a> Hey, very cool. Feel free to add it to my new package manager: <a href="https://github.com/borkdude/glam" target="_blank">https://github.com/borkdude/glam</a>
Just curious, why is the C version more maintainable for you?</z><z id="t1601395614" t="eraserhd GraalVM is very hard to build from scratch. In Nixpkgs, which is my preferred package manager, it has never worked on Mac OS, even though people have spent weeks trying to get it to build and work. It worked on Linux for a few weeks after someone put in a hurculean effort to get it to build, but then it broke and nobody wants to deal with it."><y>#</y><d>2020-09-29</d><h>16:06</h><r>eraserhd</r>GraalVM is very hard to build from scratch.  In Nixpkgs, which is my preferred package manager, it has never worked on Mac OS, even though people have spent weeks trying to get it to build and work.  It worked on Linux for a few weeks after someone put in a hurculean effort to get it to build, but then it broke and nobody wants to deal with it.</z><z id="t1601395658" t="borkdude I see, thanks"><y>#</y><d>2020-09-29</d><h>16:07</h><r>borkdude</r>I see, thanks</z><z id="t1601395667" t="eraserhd This means that I can&apos;t put Graal-built packages into Nixpkgs, because nix requires everything built from source. Or at least wants that very strongly."><y>#</y><d>2020-09-29</d><h>16:07</h><r>eraserhd</r>This means that I can&apos;t put Graal-built packages into Nixpkgs, because nix requires everything built from source.  Or at least wants that very strongly.</z><z id="t1601395688" t="borkdude Some of my GraalVM binaries do have nix packages, maintained by others"><y>#</y><d>2020-09-29</d><h>16:08</h><r>borkdude</r>Some of my GraalVM binaries do have nix packages, maintained by others</z><z id="t1601395707" t="borkdude They do this by starting with the uberjar, but I&apos;m not sure how they proceed"><y>#</y><d>2020-09-29</d><h>16:08</h><r>borkdude</r>They do this by starting with the uberjar, but I&apos;m not sure how they proceed</z><z id="t1601395747" t="borkdude ah I see it hasn&apos;t maintained for long: https://github.com/NixOS/nixpkgs/blob/master/pkgs/development/tools/clj-kondo/default.nix"><y>#</y><d>2020-09-29</d><h>16:09</h><r>borkdude</r>ah I see it hasn&apos;t maintained for long:
<a href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/development/tools/clj-kondo/default.nix" target="_blank">https://github.com/NixOS/nixpkgs/blob/master/pkgs/development/tools/clj-kondo/default.nix</a></z><z id="t1601395773" t="borkdude https://github.com/NixOS/nixpkgs/blob/master/pkgs/development/interpreters/clojure/babashka.nix"><y>#</y><d>2020-09-29</d><h>16:09</h><r>borkdude</r><a href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/development/interpreters/clojure/babashka.nix" target="_blank">https://github.com/NixOS/nixpkgs/blob/master/pkgs/development/interpreters/clojure/babashka.nix</a></z><z id="t1601395792" t="eraserhd I&apos;m checking clj-kondo on NixOS right now... yeah it doesn&apos;t work now :/"><y>#</y><d>2020-09-29</d><h>16:09</h><r>eraserhd</r>I&apos;m checking clj-kondo on NixOS right now...  yeah it doesn&apos;t work now :/</z><z id="t1601395812" t="eraserhd Maybe we can kick somebody&apos;s butt at Oracle?"><y>#</y><d>2020-09-29</d><h>16:10</h><r>eraserhd</r>Maybe we can kick somebody&apos;s butt at Oracle?</z><z id="t1601395836" t="borkdude is this because of the graalvm 8 -&gt; 11 change of both packages? I haven&apos;t had contact with the people behind those packages"><y>#</y><d>2020-09-29</d><h>16:10</h><r>borkdude</r>is this because of the graalvm 8 -&gt; 11 change of both packages? I haven&apos;t had contact with the people behind those packages</z><z id="t1601395895" t="eraserhd Oh, sorry... I&apos;m on bleeding edge Nixpkgs because I contribute to it a lot. It might work on the last stable."><y>#</y><d>2020-09-29</d><h>16:11</h><r>eraserhd</r>Oh, sorry... I&apos;m on bleeding edge Nixpkgs because I contribute to it a lot.  It might work on the last stable.</z><z id="t1601396000" t="eraserhd I think there might actually also be a binary graal package for the &quot;enterprise edition&quot;. If clj-kondo uses that, it might still work on stable."><y>#</y><d>2020-09-29</d><h>16:13</h><r>eraserhd</r>I think there might actually also be a binary graal package for the &quot;enterprise edition&quot;.  If clj-kondo uses that, it might still work on stable.</z><z id="t1601522397" t="cfleming What is the current state of being able to load libraries dynamically into an nREPL REPL? I have a vague recollection that pomegranate had problems under the module system, did that ever get fixed? Is anyone doing this?"><y>#</y><d>2020-10-01</d><h>03:19</h><w>cfleming</w>What is the current state of being able to load libraries dynamically into an nREPL REPL? I have a vague recollection that pomegranate had problems under the module system, did that ever get fixed? Is anyone doing this?</z><z id="t1601523277" t="dpsutton https://github.com/nrepl/nrepl/pull/162 has some discussion"><y>#</y><d>2020-10-01</d><h>03:34</h><w>dpsutton</w><a href="https://github.com/nrepl/nrepl/pull/162" target="_blank">https://github.com/nrepl/nrepl/pull/162</a> has some discussion</z><z id="t1601524675" t="cfleming [:attrs {:href &quot;/_/_/users/U11BV7MTK&quot;}] Isnâ€™t that different, though? My understanding was that that would go back from the server to the client for a namespace if it couldnâ€™t be found on the server."><y>#</y><d>2020-10-01</d><h>03:57</h><w>cfleming</w><a>@dpsutton</a> Isnâ€™t that different, though? My understanding was that that would go back from the server to the client for a namespace if it couldnâ€™t be found on the server.</z><z id="t1601524819" t="dpsutton i thought it was a general purpose code loading mechanism. but i haven&apos;t followed too closely"><y>#</y><d>2020-10-01</d><h>04:00</h><w>dpsutton</w>i thought it was a general purpose code loading mechanism. but i haven&apos;t followed too closely</z><z id="t1601524827" t="cfleming Although that issue also talks about handing back entire jars."><y>#</y><d>2020-10-01</d><h>04:00</h><w>cfleming</w>Although that issue also talks about handing back entire jars.</z><z id="t1601524831" t="dpsutton and now i&apos;m not sure if its jar or just source based"><y>#</y><d>2020-10-01</d><h>04:00</h><w>dpsutton</w>and now i&apos;m not sure if its jar or just source based</z><z id="t1601524994" t="cfleming Thereâ€™s some doc, but it doesnâ€™t clarify much: https://nrepl.org/nrepl/0.8/building_clients.html#implementing-sideloading"><y>#</y><d>2020-10-01</d><h>04:03</h><w>cfleming</w>Thereâ€™s some doc, but it doesnâ€™t clarify much: <a href="https://nrepl.org/nrepl/0.8/building_clients.html#implementing-sideloading" target="_blank">https://nrepl.org/nrepl/0.8/building_clients.html#implementing-sideloading</a></z><z id="t1601545293" t="flowthing &gt; My understanding was that that would go back from the server to the client for a namespace if it couldnâ€™t be found on the server. I believe the sideloader is exactly for that purpose, yeah. I don&apos;t think it can handle JAR files, but someone can correct me if I&apos;m wrong. This is the only thing I&apos;m aware of with regard to hot-loading libs: https://nrepl.org/nrepl/0.8/usage/misc.html#hot-loading-dependencies"><y>#</y><d>2020-10-01</d><h>09:41</h><w>flowthing</w>&gt; My understanding was that that would go back from the server to the client for a namespace if it couldnâ€™t be found on the server.
I believe the sideloader is exactly for that purpose, yeah. I don&apos;t think it can handle JAR files, but someone can correct me if I&apos;m wrong.

This is the only thing I&apos;m aware of with regard to hot-loading libs:

<a href="https://nrepl.org/nrepl/0.8/usage/misc.html#hot-loading-dependencies" target="_blank">https://nrepl.org/nrepl/0.8/usage/misc.html#hot-loading-dependencies</a></z><z id="t1601580554" t="cfleming Oh great, thanks - Iâ€™ll try both of those."><y>#</y><d>2020-10-01</d><h>19:29</h><w>cfleming</w>Oh great, thanks - Iâ€™ll try both of those.</z><z id="t1601584369" t="bozhidar You can sideload anything that you can normally load via a classloader."><y>#</y><d>2020-10-01</d><h>20:32</h><w>bozhidar</w>You can sideload anything that you can normally load via a classloader.</z><z id="t1601584390" t="bozhidar &gt; I have a vague recollection that pomegranate had problems under the module system, did that ever get fixed? Is anyone doing this?"><y>#</y><d>2020-10-01</d><h>20:33</h><w>bozhidar</w>&gt;  I have a vague recollection that pomegranate had problems under the module system, did that ever get fixed? Is anyone doing this?</z><z id="t1601584393" t="bozhidar Yep, those were fixed."><y>#</y><d>2020-10-01</d><h>20:33</h><w>bozhidar</w>Yep, those were fixed.</z><z id="t1601584468" t="bozhidar (that&apos;s the bugfix https://github.com/nrepl/nrepl/pull/190 )"><y>#</y><d>2020-10-01</d><h>20:34</h><w>bozhidar</w>(that&apos;s the bugfix <a href="https://github.com/nrepl/nrepl/pull/190" target="_blank">https://github.com/nrepl/nrepl/pull/190</a>)</z><z id="t1601584538" t="bozhidar And a follow-up, as it turned out that the fix was causing some issues with Orchard on JDK 8."><y>#</y><d>2020-10-01</d><h>20:35</h><w>bozhidar</w>And a follow-up, as it turned out that the fix was causing some issues with Orchard on JDK 8.</z><z id="t1601584540" t="bozhidar https://github.com/nrepl/nrepl/pull/210"><y>#</y><d>2020-10-01</d><h>20:35</h><w>bozhidar</w><a href="https://github.com/nrepl/nrepl/pull/210" target="_blank">https://github.com/nrepl/nrepl/pull/210</a></z><z id="t1601584770" t="cfleming [:attrs {:href &quot;/_/_/users/U051BLM8F&quot;}] How does that work, then? Iâ€™m not sure how this should work from either a client implementation or a user UI point of view"><y>#</y><d>2020-10-01</d><h>20:39</h><w>cfleming</w><a>@bozhidar</a> How does that work, then? Iâ€™m not sure how this should work from either a client implementation or a user UI point of view</z><z id="t1601584836" t="cfleming In my mind, a user would say â€œIâ€™d like to use library xâ€, Cursive downloads the lib and its deps and then sends them to the server. Iâ€™m not sure how this works with this model."><y>#</y><d>2020-10-01</d><h>20:40</h><w>cfleming</w>In my mind, a user would say â€œIâ€™d like to use library xâ€, Cursive downloads the lib and its deps and then sends them to the server. Iâ€™m not sure how this works with this model.</z><z id="t1601584992" t="cfleming What I had envisioned for the sideloading had been more the namespaces that Cursive loads for e.g. completion, i.e. I call cursive.runtime/complete or whatever, the server sees it doesnâ€™t have that and requests it from the client."><y>#</y><d>2020-10-01</d><h>20:43</h><w>cfleming</w>What I had envisioned for the sideloading had been more the namespaces that Cursive loads for e.g. completion, i.e. I call <code>cursive.runtime/complete</code> or whatever, the server sees it doesnâ€™t have that and requests it from the client.</z></g><g id="s8"><z id="t1601585170" t="cfleming But for loading dependency jars, Iâ€™m not sure how that would work. Do I create a sideloading session for each dep the user wants to load? Iâ€™m guessing that for things like classes, the server will request them one by one rather than requesting a full jar. But that then means that I have to keep the sideloading session open for as long as the user might eval something using that dep, right?"><y>#</y><d>2020-10-01</d><h>20:46</h><w>cfleming</w>But for loading dependency jars, Iâ€™m not sure how that would work. Do I create a sideloading session for each dep the user wants to load? Iâ€™m guessing that for things like classes, the server will request them one by one rather than requesting a full jar. But that then means that I have to keep the sideloading session open for as long as the user might eval something using that dep, right?</z><z id="t1601586229" t="bozhidar Yeah, exactly. Basically when you try to require something that&apos;s not present nREPL will ask you to provide the missing resource. As you don&apos;t want to this to happen in the main eval session it makes sense to either have a dedicated session for sideloading or one-off sessions."><y>#</y><d>2020-10-01</d><h>21:03</h><w>bozhidar</w>Yeah, exactly. Basically when you try to require something that&apos;s not present nREPL will ask you to provide the missing resource. As you don&apos;t want to this to happen in the main eval session it makes sense to either have a dedicated session for sideloading or one-off sessions.</z><z id="t1601586239" t="bozhidar &gt; Iâ€™m guessing that for things like classes, the server will request them one by one rather than requesting a full jar."><y>#</y><d>2020-10-01</d><h>21:03</h><w>bozhidar</w>&gt; Iâ€™m guessing that for things like classes, the server will request them one by one rather than requesting a full jar.</z><z id="t1601586405" t="bozhidar Yep, the Clojure classloader doesn&apos;t have a notion of jars - it understands classfiles and Clojure source files, so on requiring something you&apos;ll have to supply one of those. As this was envisioned mostly to load things like development libraries (e.g. code completion) that&apos;s not a big deal as they are typically simple (often just a couple of namespaces)."><y>#</y><d>2020-10-01</d><h>21:06</h><w>bozhidar</w>Yep, the Clojure classloader doesn&apos;t have a notion of jars - it understands classfiles and Clojure source files, so on requiring something you&apos;ll have to supply one of those. As this was envisioned mostly to load things like development libraries (e.g. code completion) that&apos;s not a big deal as they are typically simple (often just a couple of namespaces).</z><z id="t1601586483" t="bozhidar I think Tutkain and iced-vim are already using the sideloader, so you can check their code for details. CIDER also has some pretty basic support, as I hadn&apos;t had much time for it lately."><y>#</y><d>2020-10-01</d><h>21:08</h><w>bozhidar</w>I think Tutkain and iced-vim are already using the sideloader, so you can check their code for details. CIDER also has some pretty basic support, as I hadn&apos;t had much time for it lately.</z><z id="t1601586541" t="bozhidar https://github.com/clojure-emacs/cider/blob/249d3b508434c770d22977fadb9e9a169f0dc746/cider-eval.el#L190"><y>#</y><d>2020-10-01</d><h>21:09</h><w>bozhidar</w><a href="https://github.com/clojure-emacs/cider/blob/249d3b508434c770d22977fadb9e9a169f0dc746/cider-eval.el#L190" target="_blank">https://github.com/clojure-emacs/cider/blob/249d3b508434c770d22977fadb9e9a169f0dc746/cider-eval.el#L190</a></z><z id="t1601586631" t="bozhidar As you can see from the code my idea was just to bundle some libraries with CIDER directly (e.g. Orchard and Compliment) and sideload them from there, but obviously you can go in whatever direction you want to."><y>#</y><d>2020-10-01</d><h>21:10</h><w>bozhidar</w>As you can see from the code my idea was just to bundle some libraries with CIDER directly (e.g. Orchard and Compliment) and sideload them from there, but obviously you can go in whatever direction you want to.</z><z id="t1601586658" t="bozhidar &gt; What I had envisioned for the sideloading had been more the namespaces that Cursive loads for e.g. completion, i.e. I callÂ cursive.runtime/completeÂ or whatever, the server sees it doesnâ€™t have that and requests it from the client."><y>#</y><d>2020-10-01</d><h>21:10</h><w>bozhidar</w>&gt; What I had envisioned for the sideloading had been more the namespaces that Cursive loads for e.g. completion, i.e. I callÂ cursive.runtime/completeÂ or whatever, the server sees it doesnâ€™t have that and requests it from the client.</z><z id="t1601586661" t="bozhidar Same as me then. ðŸ™‚"><y>#</y><d>2020-10-01</d><h>21:11</h><w>bozhidar</w>Same as me then. <b>ðŸ™‚</b></z><z id="t1601586693" t="bozhidar &gt; But for loading dependency jars, Iâ€™m not sure how that would work."><y>#</y><d>2020-10-01</d><h>21:11</h><w>bozhidar</w>&gt; But for loading dependency jars, Iâ€™m not sure how that would work.</z><z id="t1601586779" t="bozhidar Well, you can also utilize pomegranate as clj-refactor was doing it in the past. It had functionality very similar to what you&apos;re describing - you could select some library from clojars or Maven Central and load it into the running nREPL server."><y>#</y><d>2020-10-01</d><h>21:12</h><w>bozhidar</w>Well, you can also utilize pomegranate as clj-refactor was doing it in the past. It had functionality very similar to what you&apos;re describing - you could select some library from clojars or Maven Central and load it into the running nREPL server.</z><z id="t1601586867" t="bozhidar They were using alembic and it got broken with Java 9, though. Afterwards this code was never updated to use pomegranate or something else https://github.com/clojure-emacs/clj-refactor.el/issues/466"><y>#</y><d>2020-10-01</d><h>21:14</h><w>bozhidar</w>They were using alembic and it got broken with Java 9, though. Afterwards this code was never updated to use pomegranate or something else <a href="https://github.com/clojure-emacs/clj-refactor.el/issues/466" target="_blank">https://github.com/clojure-emacs/clj-refactor.el/issues/466</a></z><z id="t1601591098" t="cfleming Ok, thanks. I might look at using sideloading to load something like pomegranate, and then using that to load deps."><y>#</y><d>2020-10-01</d><h>22:24</h><w>cfleming</w>Ok, thanks. I might look at using sideloading to load something like pomegranate, and then using that to load deps.</z><z id="t1601597643" t="cfleming Iâ€™m curious - why does the sideloading require a sideloader-start message? Why not just call sideloader-lookup as required? Is that so that the client has to specifically acknowledge that itâ€™s sideloader-capable?"><y>#</y><d>2020-10-02</d><h>00:14</h><w>cfleming</w>Iâ€™m curious - why does the sideloading require a sideloader-start message? Why not just call sideloader-lookup as required? Is that so that the client has to specifically acknowledge that itâ€™s sideloader-capable?</z><z id="t1601618226" t="bozhidar To enable sideloading for a session explicitly, as the assumption is most people don&apos;t need it. With the sideloading enabled some evaluation of a missing require won&apos;t give you an error until you get a response from the client with the resource or signaling the resource doesn&apos;t exist."><y>#</y><d>2020-10-02</d><h>05:57</h><r>bozhidar</r>To enable sideloading for a session explicitly, as the assumption is most people don&apos;t need it. With the sideloading enabled some evaluation of a missing require won&apos;t give you an error until you get a response from the client with the resource or signaling the resource doesn&apos;t exist.</z><z id="t1601600174" t="hoppy greetings. I&apos;m a bit vexxed/overwhelmed by the myriad of docs on the subject, so perhaps I&apos;ll ask if there is somebody that can point me at what would be the most straightforward path to getting an nrepl server fired up from node on an embedded device? I have node there, but no java - seems like it should be possible, but I&apos;m having trouble how to assemble the parts. Shadow is in play, if that matters. I guess I&apos;m wanting to get a cljs repl fired up there, and do the piggieback bit on the desktop to get into it."><y>#</y><d>2020-10-02</d><h>00:56</h><w>hoppy</w>greetings.  I&apos;m a bit vexxed/overwhelmed by the myriad of docs on the subject, so perhaps I&apos;ll ask if there is somebody that can point me at what would be the most straightforward path to getting an nrepl server fired up from node on an embedded device?  I have node  there, but no java - seems like it should be possible, but I&apos;m having trouble how to assemble the parts.  Shadow is in play, if that matters.  I guess I&apos;m wanting to get a cljs repl fired up there, and do the piggieback bit on the desktop to get into it.</z><z id="t1601618322" t="bozhidar [:attrs {:href &quot;/_/_/users/U19EVCEBV&quot;}] if you don&apos;t have Java there you can&apos;t really start the reference nREPL implementation and would ideally need some self-hosted implementation of nREPL."><y>#</y><d>2020-10-02</d><h>05:58</h><w>bozhidar</w><a>@hoppy</a> if you don&apos;t have Java there you can&apos;t really start the reference nREPL implementation and would ideally need some self-hosted implementation of nREPL.</z><z id="t1601618373" t="bozhidar I guess this one would work https://github.com/djblue/nrepl-cljs although it&apos;s not exactly feature-complete."><y>#</y><d>2020-10-02</d><h>05:59</h><w>bozhidar</w>I guess this one would work <a href="https://github.com/djblue/nrepl-cljs" target="_blank">https://github.com/djblue/nrepl-cljs</a> although it&apos;s not exactly feature-complete.</z><z id="t1601635512" t="pez Does it mean Calva doesn&apos;t really need to inject anything but nrepl and can sideload anything else?"><y>#</y><d>2020-10-02</d><h>10:45</h><w>pez</w>Does it mean Calva doesn&apos;t really need to inject anything but nrepl and can sideload anything else?</z><z id="t1601635831" t="flowthing Yes, thatâ€™s why it was created, I think. Thatâ€™s what I do in my plugin (although I donâ€™t sideload CIDER or anything huge like that)."><y>#</y><d>2020-10-02</d><h>10:50</h><r>flowthing</r>Yes, thatâ€™s why it was created, I think. Thatâ€™s what I do in my plugin (although I donâ€™t sideload CIDER or anything huge like that).</z><z id="t1601635991" t="pez I think I mostly had those huge things in mind."><y>#</y><d>2020-10-02</d><h>10:53</h><r>pez</r>I think I mostly had those huge things in mind.</z><z id="t1601636007" t="flowthing Well, it should work there, too."><y>#</y><d>2020-10-02</d><h>10:53</h><r>flowthing</r>Well, it should work there, too.</z><z id="t1601636093" t="pez Could be worth considering for the stuff that only might be used during a session."><y>#</y><d>2020-10-02</d><h>10:54</h><r>pez</r>Could be worth considering for the stuff that only might be used during a session.</z><z id="t1601636178" t="flowthing https://metaredux.com/posts/2020/03/28/nrepl-0-7.html I found this blog post helpful when working on my implementation."><y>#</y><d>2020-10-02</d><h>10:56</h><r>flowthing</r><a href="https://metaredux.com/posts/2020/03/28/nrepl-0-7.html" target="_blank">https://metaredux.com/posts/2020/03/28/nrepl-0-7.html</a> I found this blog post helpful when working on my implementation.</z><z id="t1601636215" t="flowthing One thing I got bitten by was that youâ€™ll need to use a dedicated nREPL session for sideloading."><y>#</y><d>2020-10-02</d><h>10:56</h><r>flowthing</r>One thing I got bitten by was that youâ€™ll need to use a dedicated nREPL session for sideloading.</z><z id="t1601636602" t="pez Thanks. I&apos;ll check it out."><y>#</y><d>2020-10-02</d><h>11:03</h><r>pez</r>Thanks. I&apos;ll check it out.</z><z id="t1601979073" t="cfleming [:attrs {:href &quot;/_/_/users/U4ZDX466T&quot;}] Why do you need a dedicated nREPL session for sideloading?"><y>#</y><d>2020-10-06</d><h>10:11</h><r>cfleming</r><a>@U4ZDX466T</a> Why do you need a dedicated nREPL session for sideloading?</z><z id="t1601979998" t="flowthing I forget the specifics, and it appears theyâ€™re lost in the mists of Slack history, unfortunatelyâ€¦ [:attrs {:href &quot;/_/_/users/U1XERPZ18&quot;}] would be able to tell. IIRC, if you try using the session where you send sideloader-start for other things (like clojure.test integration), youâ€™ll get sideloader-provide requests for things you donâ€™t want them for. Thatâ€™s pretty much the extent of what I remember."><y>#</y><d>2020-10-06</d><h>10:26</h><r>flowthing</r>I forget the specifics, and it appears theyâ€™re lost in the mists of Slack history, unfortunatelyâ€¦ <a>@U1XERPZ18</a> would be able to tell. IIRC, if you try using the session where you send <code>sideloader-start</code> for other things (like clojure.test integration), youâ€™ll get <code>sideloader-provide</code> requests for things you donâ€™t want them for. Thatâ€™s pretty much the extent of what I remember.</z><z id="t1601980418" t="cfleming Yeah, that makes sense - I guess any time someone tries to require anything, even speculatively, itâ€™ll go back to the IDE for that."><y>#</y><d>2020-10-06</d><h>10:33</h><r>cfleming</r>Yeah, that makes sense - I guess any time someone tries to require anything, even speculatively, itâ€™ll go back to the IDE for that.</z><z id="t1601980440" t="cfleming Assuming itâ€™s not found locally, of course."><y>#</y><d>2020-10-06</d><h>10:34</h><r>cfleming</r>Assuming itâ€™s not found locally, of course.</z><z id="t1601980829" t="flowthing Yep, exactly."><y>#</y><d>2020-10-06</d><h>10:40</h><r>flowthing</r>Yep, exactly.</z><z id="t1601989759" t="shen There&apos;s quite a lot of non-obvious side effects to enabling sideloading, so isolating it in its own explicit session made sense. The design is based on unrepl version of the of the feature by Christophe. I assume it was made for similar reasons"><y>#</y><d>2020-10-06</d><h>13:09</h><r>shen</r>There&apos;s quite a lot of non-obvious side effects to enabling sideloading, so isolating it in its own explicit session made sense. The design is based on unrepl version of the of the feature by Christophe. I assume it was made for similar reasons</z><z id="t1601635621" t="pez ^ That was re: &gt; [:attrs {:href &quot;/_/_/users/U051BLM8F&quot;}] How does that work, then? Iâ€™m not sure how this should work from either a client implementation or a user UI point of view"><y>#</y><d>2020-10-02</d><h>10:47</h><w>pez</w>^ That was re:
&gt; <a>@bozhidar</a> How does that work, then? Iâ€™m not sure how this should work from either a client implementation or a user UI point of view</z><z id="t1601635759" t="pez Now I have read the rest of the convo, so never mind me. ðŸ˜ƒ"><y>#</y><d>2020-10-02</d><h>10:49</h><w>pez</w>Now I have read the rest of the convo, so never mind me. <b>ðŸ˜ƒ</b></z><z id="t1601645150" t="hoppy and then there is the work that sir [:attrs {:href &quot;/_/_/users/U04VDQDDY&quot;}] did with his esp32 board: https://github.com/mfikes/esprit - there is obviously not java anywhere to be found anywhere there, but rather something javascript-y that can eval the compiler output that was made on the desktop side - or I&apos;m not understanding what is going on at all. But it seems pretty cool/useful"><y>#</y><d>2020-10-02</d><h>13:25</h><w>hoppy</w>and then there is the work that sir <a>@mfikes</a> did with his esp32 board: <a href="https://github.com/mfikes/esprit" target="_blank">https://github.com/mfikes/esprit</a> - there is obviously not java anywhere to be found anywhere there, but rather something javascript-y that can eval the compiler output that was made on the desktop side - or I&apos;m not understanding what is going on at all.  But it seems pretty cool/useful</z><z id="t1605285989" t="Gleb Posobin ns-path behaves differently for clj and cljs. cljs: (cider-nrepl-send-sync-request `(&quot;op&quot; &quot;ns-path&quot; &quot;ns&quot; &quot;ampie-frontend.events.user&quot;)) -&gt; (dict &quot;status&quot; (&quot;done&quot;) &quot;id&quot; &quot;1009&quot; &quot;path&quot; &quot;ampie_frontend/events/user.cljs&quot; &quot;session&quot; &quot;1aa9e7df-efad-453e-968c-6c32fc32d531&quot;) clj: (cider-nrepl-send-sync-request `(&quot;op&quot; &quot;ns-path&quot; &quot;ns&quot; &quot;ampie-backend.users&quot;)) -&gt; (dict &quot;status&quot; (&quot;done&quot;) &quot;id&quot; &quot;443&quot; &quot;path&quot; &quot;file:/Users/posobin/2020/dev/ampie-backend/src/ampie_backend/users.clj&quot; &quot;session&quot; &quot;0a41d39a-4235-4b7e-9e01-5a83809bd891&quot;)"><y>#</y><d>2020-11-13</d><h>16:46</h><w>Gleb Posobin</w><code>ns-path</code> behaves differently for clj and cljs.
<pre>cljs: (cider-nrepl-send-sync-request `(&quot;op&quot; &quot;ns-path&quot; &quot;ns&quot; &quot;ampie-frontend.events.user&quot;)) -&gt; (dict &quot;status&quot; (&quot;done&quot;) &quot;id&quot; &quot;1009&quot; &quot;path&quot; &quot;ampie_frontend/events/user.cljs&quot; &quot;session&quot; &quot;1aa9e7df-efad-453e-968c-6c32fc32d531&quot;)

clj: (cider-nrepl-send-sync-request `(&quot;op&quot; &quot;ns-path&quot; &quot;ns&quot; &quot;ampie-backend.users&quot;)) -&gt; (dict &quot;status&quot; (&quot;done&quot;) &quot;id&quot; &quot;443&quot; &quot;path&quot; &quot;file:/Users/posobin/2020/dev/ampie-backend/src/ampie_backend/users.clj&quot; &quot;session&quot; &quot;0a41d39a-4235-4b7e-9e01-5a83809bd891&quot;)</pre></z><z id="t1605286132" t="Gleb Posobin The file path for cljs is relative to classpath looks like. Is there a way to fix this? Because of that cider&apos;s cider-find-ns doesn&apos;t work correctly on my cljs project, it switches to a wrong buffer, which is also called user.cljs , but in a different directory."><y>#</y><d>2020-11-13</d><h>16:48</h><w>Gleb Posobin</w>The file path for cljs is relative to classpath looks like. Is there a way to fix this? Because of that cider&apos;s <code>cider-find-ns</code> doesn&apos;t work correctly on my cljs project, it switches to a wrong buffer, which is also called <code>user.cljs</code> , but in a different directory.</z><z id="t1605286294" t="Gleb Posobin Should I file this as a bug to nrepl?"><y>#</y><d>2020-11-13</d><h>16:51</h><w>Gleb Posobin</w>Should I file this as a bug to nrepl?</z><z id="t1605354185" t="bozhidar [:attrs {:href &quot;/_/_/users/UQ4RJ22EA&quot;}] You should, but to cider-nrepl , as this functionality is coming from it."><y>#</y><d>2020-11-14</d><h>11:43</h><w>bozhidar</w><a>@posobin</a> You should, but to <code>cider-nrepl</code>, as this functionality is coming from it.</z><z id="t1605354200" t="bozhidar Seems to me that this should be an easy fix."><y>#</y><d>2020-11-14</d><h>11:43</h><w>bozhidar</w>Seems to me that this should be an easy fix.</z><z id="t1605364415" t="Gleb Posobin [:attrs {:href &quot;/_/_/users/U051BLM8F&quot;}] I am sending the ns-path request to nrepl using cider-nrepl, because not sure how else to call it."><y>#</y><d>2020-11-14</d><h>14:33</h><w>Gleb Posobin</w><a>@bozhidar</a> I am sending the ns-path request to nrepl using cider-nrepl, because not sure how else to call it.</z><z id="t1605368408" t="bozhidar Yeah, there&apos;s no other way to do so. ðŸ™‚ Lots of the middleware code has different branches for Clojure and ClojureScript which results in some inconsistencies from time to time."><y>#</y><d>2020-11-14</d><h>15:40</h><w>bozhidar</w>Yeah, there&apos;s no other way to do so. <b>ðŸ™‚</b> Lots of the middleware code has different branches for Clojure and ClojureScript which results in some inconsistencies from time to time.</z><z id="t1606907351" t="David Pham Hello everyone ðŸ™‚ I wonder if it was possible when using the cli command to evaluate code in the nrepl server? I would like to run the djblue/portal commands on start."><y>#</y><d>2020-12-02</d><h>11:09</h><w>David Pham</w>Hello everyone <b>ðŸ™‚</b> I wonder if it was possible when using the cli command to evaluate code in the nrepl server? I would like to run the djblue/portal commands on start.</z><z id="t1606908556" t="flowthing Not sure, I don&apos;t think so, but one option would be to do something like this: Î» cat deps.edn {:deps {nrepl/nrepl {:mvn/version &quot;0.8.3&quot;} djblue/portal {:mvn/version &quot;0.6.4&quot;}}} Î» cat src/user.clj (ns user (:require [portal.api :as p])) (p/open) (p/tap) Î» clojure -M -m nrepl.cmdline nREPL server started on port 61861 on host localhost - "><y>#</y><d>2020-12-02</d><h>11:29</h><r>flowthing</r>Not sure, I don&apos;t think so, but one option would be to do something like this:

<pre>Î» cat deps.edn
{:deps {nrepl/nrepl {:mvn/version &quot;0.8.3&quot;}
        djblue/portal {:mvn/version &quot;0.6.4&quot;}}}
Î» cat src/user.clj
(ns user
  (:require [portal.api :as p]))

(p/open)
(p/tap)
Î» clojure -M -m nrepl.cmdline
nREPL server started on port 61861 on host localhost - </pre></z><z id="t1606908656" t="David Pham thanks!"><y>#</y><d>2020-12-02</d><h>11:30</h><r>David Pham</r>thanks!</z><z id="t1606908661" t="flowthing Or https://github.com/gfredericks/user.clj if you don&apos;t want to do it per-project."><y>#</y><d>2020-12-02</d><h>11:31</h><r>flowthing</r>Or <a href="https://github.com/gfredericks/user.clj" target="_blank">https://github.com/gfredericks/user.clj</a> if you don&apos;t want to do it per-project.</z><z id="t1606908725" t="flowthing (I would probably have a function in user.clj that calls p/open and p/tap instead of calling them on the top level, but YMMV.)"><y>#</y><d>2020-12-02</d><h>11:32</h><r>flowthing</r>(I would probably have a function in <code>user.clj</code> that calls <code>p/open</code> and <code>p/tap</code> instead of calling them on the top level, but YMMV.)</z><z id="t1606908797" t="David Pham agrees"><y>#</y><d>2020-12-02</d><h>11:33</h><r>David Pham</r>agrees</z><z id="t1606908803" t="David Pham I wish we could have cljc though ðŸ™‚"><y>#</y><d>2020-12-02</d><h>11:33</h><r>David Pham</r>I wish we could have cljc though <b>ðŸ™‚</b></z><z id="t1606908928" t="flowthing Looks like there&apos;s a ticket for that: https://clojure.atlassian.net/browse/CLJ-2240"><y>#</y><d>2020-12-02</d><h>11:35</h><r>flowthing</r>Looks like there&apos;s a ticket for that: <a href="https://clojure.atlassian.net/browse/CLJ-2240" target="_blank">https://clojure.atlassian.net/browse/CLJ-2240</a></z><z id="t1606909190" t="David Pham Thanks"><y>#</y><d>2020-12-02</d><h>11:39</h><r>David Pham</r>Thanks</z><z id="t1606939474" t="djblue You can also add (.addShutdownHook (Runtime/getRuntime) (Thread. #(p/close))) to user.clj for cleanup"><y>#</y><d>2020-12-02</d><h>20:04</h><r>djblue</r>You can also add <code>(.addShutdownHook (Runtime/getRuntime) (Thread. #(p/close)))</code> to user.clj for cleanup</z><z id="t1606942251" t="bozhidar [:attrs {:href &quot;/_/_/users/UEQGQ6XH7&quot;}] You can also check out https://github.com/eraserhd/rep"><y>#</y><d>2020-12-02</d><h>20:50</h><w>bozhidar</w><a>@neo2551</a> You can also check out <a href="https://github.com/eraserhd/rep" target="_blank">https://github.com/eraserhd/rep</a></z><z id="t1606943623" t="borkdude This can also be accomplished with babashka. https://book.babashka.org/#_interacting_with_an_nrepl_server"><y>#</y><d>2020-12-02</d><h>21:13</h><w>borkdude</w>This can also be accomplished with babashka.
<a href="https://book.babashka.org/#_interacting_with_an_nrepl_server" target="_blank">https://book.babashka.org/#_interacting_with_an_nrepl_server</a></z><z id="t1607330815" t="ribelo I have a strange problem, which I have no idea what it comes from."><y>#</y><d>2020-12-07</d><h>08:46</h><w>ribelo</w>I have a strange problem, which I have no idea what it comes from.</z><z id="t1607330930" t="ribelo cider stopped working for me, but it&apos;s probably not his fault"><y>#</y><d>2020-12-07</d><h>08:48</h><w>ribelo</w>cider stopped working for me, but it&apos;s probably not his fault</z><z id="t1607330971" t="ribelo {:tag :a, :attrs {:href &quot;/cdn-cgi/l/email-protection&quot;, :class &quot;__cf_email__&quot;, :data-cfemail &quot;82f0ebe0e7eeedc2f0ebe0e7eeedaffaf2f1&quot;}, :content (&quot;[emailÂ protected]&quot;)} "><y>#</y><d>2020-12-07</d><h>08:49</h><w>ribelo</w><pre>{:tag :a, :attrs {:href &quot;/cdn-cgi/l/email-protection&quot;, :class &quot;__cf_email__&quot;, :data-cfemail &quot;82f0ebe0e7eeedc2f0ebe0e7eeedaffaf2f1&quot;}, :content (&quot;[emailÂ protected]&quot;)}</pre>
</z><z id="t1607331133" t="dominicm [:attrs {:href &quot;/_/_/users/U0BBFDED7&quot;}] what&apos;s in the REPL alias in deps.edn?"><y>#</y><d>2020-12-07</d><h>08:52</h><w>dominicm</w><a>@huxley</a> what&apos;s in the REPL alias in deps.edn?</z><z id="t1607331176" t="ribelo :nREPL {:extra-deps {nrepl/nrepl {:mvn/version &quot;0.8.3&quot;}} "><y>#</y><d>2020-12-07</d><h>08:52</h><w>ribelo</w><pre>:nREPL
            {:extra-deps
             {nrepl/nrepl {:mvn/version &quot;0.8.3&quot;}}</pre>
</z><z id="t1607331239" t="ribelo I checked different versions of Java, different versions of Clojure and different versions of nREPL. Always the same error."><y>#</y><d>2020-12-07</d><h>08:53</h><w>ribelo</w>I checked different versions of Java, different versions of Clojure and different versions of nREPL. Always the same error.</z><z id="t1607331255" t="dominicm You should definitely be using -M not -R btw"><y>#</y><d>2020-12-07</d><h>08:54</h><w>dominicm</w>You should definitely be using -M not -R btw</z><z id="t1607331501" t="ribelo {:tag :a, :attrs {:href &quot;/cdn-cgi/l/email-protection&quot;, :class &quot;__cf_email__&quot;, :data-cfemail &quot;62100b00070e0d22100b00070e0d4f1a1211&quot;}, :content (&quot;[emailÂ protected]&quot;)} "><y>#</y><d>2020-12-07</d><h>08:58</h><w>ribelo</w><pre>{:tag :a, :attrs {:href &quot;/cdn-cgi/l/email-protection&quot;, :class &quot;__cf_email__&quot;, :data-cfemail &quot;62100b00070e0d22100b00070e0d4f1a1211&quot;}, :content (&quot;[emailÂ protected]&quot;)}</pre>
</z><z id="t1607332513" t="flowthing That should work. Can you try clj -Srepro ... ? Also, just a sanity check: is :nREPL under the :aliases key in your deps.edn ?"><y>#</y><d>2020-12-07</d><h>09:15</h><w>flowthing</w>That should work. Can you try <code>clj -Srepro ...</code>? Also, just a sanity check: is <code>:nREPL</code> under the <code>:aliases</code> key in your <code>deps.edn</code>?</z><z id="t1607332743" t="ribelo removing $HOME/.m2 solved the problem"><y>#</y><d>2020-12-07</d><h>09:19</h><w>ribelo</w>removing <code>$HOME/.m2</code> solved the problem</z><z id="t1607956472" t="borkdude https://blog.djy.io/alda-and-the-nrepl-protocol/"><y>#</y><d>2020-12-14</d><h>14:34</h><w>borkdude</w><a href="https://blog.djy.io/alda-and-the-nrepl-protocol/" target="_blank">https://blog.djy.io/alda-and-the-nrepl-protocol/</a></z><z id="t1607960113" t="flowthing Certainly matches my experience of implementing an nREPL client. I did appreciate how easy it was. (Wonder why they&apos;re moving away from Clojure for Alda v2, though.)"><y>#</y><d>2020-12-14</d><h>15:35</h><r>flowthing</r>Certainly matches my experience of implementing an nREPL client. I did appreciate how easy it was.

(Wonder why they&apos;re moving away from Clojure for Alda v2, though.)</z><z id="t1607960651" t="borkdude I think he could have used GraalVM + Clojure to make things run fast for startup."><y>#</y><d>2020-12-14</d><h>15:44</h><r>borkdude</r>I think he could have used GraalVM + Clojure to make things run fast for startup.</z><z id="t1607960679" t="borkdude [:attrs {:href &quot;/_/_/users/U0AHJUHJN&quot;}]"><y>#</y><d>2020-12-14</d><h>15:44</h><r>borkdude</r><a>@U0AHJUHJN</a></z><z id="t1607961061" t="dave graalvm + clojure was definitely on my radar at the time when i was making the decision (~2 years ago or so), but it&apos;s not something i spent a whole lot of time looking into the most important factor for me was that whatever i chose, it had to be able to create 100% static, cross-platform executables for linux, macos and windows. of the things i tried, go seemed to be the best at doing that"><y>#</y><d>2020-12-14</d><h>15:51</h><r>dave</r>graalvm + clojure was definitely on my radar at the time when i was making the decision (~2 years ago or so), but it&apos;s not something i spent a whole lot of time looking into

the most important factor for me was that whatever i chose, it had to be able to create 100% static, cross-platform executables for linux, macos and windows. of the things i tried, go seemed to be the best at doing that</z><z id="t1607961116" t="flowthing Makes sense â€” Go definitely fits the bill there. :thumbsup: :skin-tone-2:"><y>#</y><d>2020-12-14</d><h>15:51</h><r>flowthing</r>Makes sense â€” Go definitely fits the bill there. <b>:thumbsup:</b><b>:skin-tone-2:</b></z><z id="t1607961172" t="flowthing I guess GraalVM can do that too these days?"><y>#</y><d>2020-12-14</d><h>15:52</h><r>flowthing</r>I guess GraalVM can do that too these days?</z><z id="t1607961226" t="dave i wouldn&apos;t be surprised if it can! i think a couple years ago, i was maybe feeling nervous about investing in graalvm. i wasn&apos;t sure about windows support and whatnot"><y>#</y><d>2020-12-14</d><h>15:53</h><r>dave</r>i wouldn&apos;t be surprised if it can! i think a couple years ago, i was maybe feeling nervous about investing in graalvm. i wasn&apos;t sure about windows support and whatnot</z><z id="t1607961472" t="flowthing Well, [:attrs {:href &quot;/_/_/users/U04V15CAJ&quot;}] would know best. ðŸ™‚ I believe it&apos;s come a long way in a couple of years."><y>#</y><d>2020-12-14</d><h>15:57</h><r>flowthing</r>Well, <a>@U04V15CAJ</a> would know best. <b>ðŸ™‚</b> I believe it&apos;s come a long way in a couple of years.</z><z id="t1607961753" t="borkdude I&apos;ve distributed several cross platform native binary over the years with GraalVM: clj-kondo and babashka being the most well known ones."><y>#</y><d>2020-12-14</d><h>16:02</h><r>borkdude</r>I&apos;ve distributed several cross platform native binary over the years with GraalVM: clj-kondo and babashka being the most well known ones.</z><z id="t1607965193" t="dave as i suspected. maybe at some point i&apos;ll get tired of go and rewrite it again in clojure + graalvm ðŸ˜„"><y>#</y><d>2020-12-14</d><h>16:59</h><r>dave</r>as i suspected. maybe at some point i&apos;ll get tired of go and rewrite it again in clojure + graalvm <b>ðŸ˜„</b></z><z id="t1607965201" t="dave i could probably reuse 99% of the alda v1 code"><y>#</y><d>2020-12-14</d><h>17:00</h><r>dave</r>i could probably reuse 99% of the alda v1 code</z><z id="t1607965394" t="borkdude Learning new things is always nice :)"><y>#</y><d>2020-12-14</d><h>17:03</h><r>borkdude</r>Learning new things is always nice :)</z><z id="t1607965529" t="flowthing I&apos;d certainly find a blog post on the topic of &quot;Writing Go &amp; Kotlin after Clojure&quot; very interesting. ðŸ™‚"><y>#</y><d>2020-12-14</d><h>17:05</h><r>flowthing</r>I&apos;d certainly find a blog post on the topic of &quot;Writing Go &amp; Kotlin after Clojure&quot; very interesting. <b>ðŸ™‚</b></z><z id="t1607965875" t="dave that&apos;s good to hear! i&apos;ve actually been thinking about jotting down some notes about that at some point. i&apos;m just not quite sure how to frame it"><y>#</y><d>2020-12-14</d><h>17:11</h><r>dave</r>that&apos;s good to hear! i&apos;ve actually been thinking about jotting down some notes about that at some point. i&apos;m just not quite sure how to frame it</z><z id="t1607965887" t="dave maybe an interesting way of putting it is that &quot;go is more similar to clojure than you think&quot; ðŸ™‚"><y>#</y><d>2020-12-14</d><h>17:11</h><r>dave</r>maybe an interesting way of putting it is that &quot;go is more similar to clojure than you think&quot; <b>ðŸ™‚</b></z><z id="t1607965992" t="borkdude I want to read it too!"><y>#</y><d>2020-12-14</d><h>17:13</h><r>borkdude</r>I want to read it too!</z><z id="t1607966063" t="flowthing &gt; maybe an interesting way of putting it is that &quot;go is more similar to clojure than you think&quot; That sounds like an interesting approach. At least to someone like me, who&apos;s never written a line of Go."><y>#</y><d>2020-12-14</d><h>17:14</h><r>flowthing</r>&gt; maybe an interesting way of putting it is that &quot;go is more similar to clojure than you think&quot; 
That sounds like an interesting approach. At least to someone like me, who&apos;s never written a line of Go.</z><z id="t1607966126" t="borkdude Brandon Bloom has also said this on Twitter"><y>#</y><d>2020-12-14</d><h>17:15</h><r>borkdude</r>Brandon Bloom has also said this on Twitter</z><z id="t1607966193" t="borkdude On the border of Clojure and Go: babashka supports a protocol similar to nREPL which allows you to talk to other binary programs using JSON (or EDN). Someone made a Go binary which can be used from babashka: https://github.com/tzzh/pod-tzzh-aws But the Go code is generated using Clojure (bb) itself :)"><y>#</y><d>2020-12-14</d><h>17:16</h><r>borkdude</r>On the border of Clojure and Go: babashka supports a protocol similar to nREPL which allows you to talk to other binary programs using JSON (or EDN). Someone made a Go binary which can be used from babashka:
<a href="https://github.com/tzzh/pod-tzzh-aws" target="_blank">https://github.com/tzzh/pod-tzzh-aws</a>
But the Go code is generated using Clojure (bb) itself :)</z><z id="t1607967526" t="dave wow, interesting!"><y>#</y><d>2020-12-14</d><h>17:38</h><r>dave</r>wow, interesting!</z><z id="t1607967573" t="borkdude [:attrs {:href &quot;/_/_/users/U0AHJUHJN&quot;}] I think Alda could also become a babashka pod, so you can control it from a bb script"><y>#</y><d>2020-12-14</d><h>17:39</h><r>borkdude</r><a>@U0AHJUHJN</a> I think Alda could also become a babashka pod, so you can control it from a bb script</z><z id="t1607967687" t="dave oh, that&apos;s cool i wonder how that would compare to the approach i&apos;ve taken in https://github.com/daveyarwood/alda-clj ? the approach i&apos;ve been taking is to use clojure.java.shell/sh to create a subprocess where i run alda with programmatically generated command line args"><y>#</y><d>2020-12-14</d><h>17:41</h><r>dave</r>oh, that&apos;s cool

i wonder how that would compare to the approach i&apos;ve taken in <a href="https://github.com/daveyarwood/alda-clj" target="_blank">https://github.com/daveyarwood/alda-clj</a> ?  the approach i&apos;ve been taking is to use <code>clojure.java.shell/sh</code> to create a subprocess where i run <code>alda</code> with programmatically generated command line args</z><z id="t1607967722" t="dave i guess the thing about that is that it&apos;s JVM clojure, so there is a startup cost"><y>#</y><d>2020-12-14</d><h>17:42</h><r>dave</r>i guess the thing about that is that it&apos;s JVM clojure, so there is a startup cost</z><z id="t1607967730" t="dave alda-clj is more of a REPL-oriented library"><y>#</y><d>2020-12-14</d><h>17:42</h><r>dave</r>alda-clj is more of a REPL-oriented library</z><z id="t1607967783" t="borkdude [:attrs {:href &quot;/_/_/users/U0AHJUHJN&quot;}] it is a similar approach to shelling out, but babashka has instant startup and a pod is also intended to have instant startup, so you pay only the added startup times which is still nearly instant"><y>#</y><d>2020-12-14</d><h>17:43</h><r>borkdude</r><a>@U0AHJUHJN</a> it is a similar approach to shelling out, but babashka has instant startup and a pod is also intended to have instant startup, so you pay only the added startup times which is still nearly instant</z><z id="t1607967805" t="dave that sounds promising. i may dig into that at some point"><y>#</y><d>2020-12-14</d><h>17:43</h><r>dave</r>that sounds promising. i may dig into that at some point</z><z id="t1607967889" t="borkdude and the fun thing about pods is that they can be implemented in totally different languages than Clojure"><y>#</y><d>2020-12-14</d><h>17:44</h><r>borkdude</r>and the fun thing about pods is that they can be implemented in totally different languages than Clojure</z><z id="t1607967912" t="borkdude e.g. go :)"><y>#</y><d>2020-12-14</d><h>17:45</h><r>borkdude</r>e.g. go :)</z><z id="t1607967941" t="borkdude If you ever want to work on it and have questions, don&apos;t hesitate to reach out"><y>#</y><d>2020-12-14</d><h>17:45</h><r>borkdude</r>If you ever want to work on it and have questions, don&apos;t hesitate to reach out</z><z id="t1607969238" t="dave thanks! this sounds like it&apos;d be a lot of fun to play with"><y>#</y><d>2020-12-14</d><h>18:07</h><r>dave</r>thanks! this sounds like it&apos;d be a lot of fun to play with</z><z id="t1608212715" t="glenjamin ðŸ‘‹ Does anyone know of a stand-alone nREPL client with similar featureset to REPL-y but with fewer/smaller dependencies? Ideally no JVM Readline and tab complete would be the main things Iâ€™m after"><y>#</y><d>2020-12-17</d><h>13:45</h><w>glenjamin</w><b>ðŸ‘‹</b> Does anyone know of a stand-alone nREPL client with similar featureset to REPL-y but with fewer/smaller dependencies? Ideally no JVM

Readline and tab complete would be the main things Iâ€™m after</z><z id="t1608213155" t="dave there is https://github.com/eraserhd/rep . i&apos;ve never tried it, so i can&apos;t speak to what features it has, but maybe it fits the bill"><y>#</y><d>2020-12-17</d><h>13:52</h><w>dave</w>there is <a href="https://github.com/eraserhd/rep" target="_blank">https://github.com/eraserhd/rep</a>. i&apos;ve never tried it, so i can&apos;t speak to what features it has, but maybe it fits the bill</z><z id="t1608213236" t="glenjamin the scenario is iâ€™ve got some tools weâ€™re bundling into a container that will include connecting to an nrepl server, and iâ€™d like to avoid having to include a whole jvm in there if possible"><y>#</y><d>2020-12-17</d><h>13:53</h><w>glenjamin</w>the scenario is iâ€™ve got some tools weâ€™re bundling into a container that will include connecting to an nrepl server, and iâ€™d like to avoid having to include a whole jvm in there if possible</z><z id="t1608213829" t="borkdude [:attrs {:href &quot;/_/_/users/U0FTAT30E&quot;}] it&apos;s possible to interact with an nREPL server from a bb script as well: https://book.babashka.org/#_interacting_with_an_nrepl_server"><y>#</y><d>2020-12-17</d><h>14:03</h><w>borkdude</w><a>@glenjamin</a> it&apos;s possible to interact with an nREPL server from a bb script as well:
<a href="https://book.babashka.org/#_interacting_with_an_nrepl_server" target="_blank">https://book.babashka.org/#_interacting_with_an_nrepl_server</a></z><z id="t1608213841" t="borkdude but this is possibly lower level than you would like"><y>#</y><d>2020-12-17</d><h>14:04</h><w>borkdude</w>but this is possibly lower level than you would like</z><z id="t1608213878" t="borkdude I&apos;m using this on our CI to send commands to our production app, e.g. to clear caches"><y>#</y><d>2020-12-17</d><h>14:04</h><w>borkdude</w>I&apos;m using this on our CI to send commands to our production app, e.g. to clear caches</z><z id="t1608214230" t="dave wow, that&apos;s an awesome idea"><y>#</y><d>2020-12-17</d><h>14:10</h><r>dave</r>wow, that&apos;s an awesome idea</z><z id="t1608213907" t="glenjamin i suspect for now weâ€™ll just bundle the usual lein repl stack, we did briefly try a graal compile and quickly abandoned it"><y>#</y><d>2020-12-17</d><h>14:05</h><w>glenjamin</w>i suspect for now weâ€™ll just bundle the usual <code>lein repl</code> stack, we did briefly try a graal compile and quickly abandoned it</z><z id="t1608214078" t="borkdude [:attrs {:href &quot;/_/_/users/U0FTAT30E&quot;}] if you would like to do without lein: clojure -Sdeps &apos;{:deps {reply/reply {:mvn/version &quot;0.4.4&quot;}}}&apos; -M -m reply.main --attach localhost:1667"><y>#</y><d>2020-12-17</d><h>14:07</h><w>borkdude</w><a>@glenjamin</a> if you would like to do without lein:
<pre>clojure -Sdeps &apos;{:deps {reply/reply {:mvn/version &quot;0.4.4&quot;}}}&apos; -M -m reply.main --attach localhost:1667</pre></z><z id="t1608214261" t="glenjamin cheers, we might try that, but i think once weâ€™ve got the JVM in there then lein isnâ€™t much on top"><y>#</y><d>2020-12-17</d><h>14:11</h><w>glenjamin</w>cheers, we might try that, but i think once weâ€™ve got the JVM in there then <code>lein</code> isnâ€™t much on top</z><z id="t1608214966" t="flowthing [:attrs {:href &quot;/_/_/users/U0FTAT30E&quot;}] There&apos;s a list of clients here: https://nrepl.org/nrepl/0.8/usage/clients.html#command-line-clients Not sure if any of them fit the bill."><y>#</y><d>2020-12-17</d><h>14:22</h><w>flowthing</w><a>@glenjamin</a> There&apos;s a list of clients here:

<a href="https://nrepl.org/nrepl/0.8/usage/clients.html#command-line-clients" target="_blank">https://nrepl.org/nrepl/0.8/usage/clients.html#command-line-clients</a>

Not sure if any of them fit the bill.</z><z id="t1608217255" t="borkdude [:attrs {:href &quot;/_/_/users/U0FTAT30E&quot;}] I have some success with reply on GraalVM, working around some issues in complete.core, reflection etc, etc. $ ./reply --attach localhost:52612 REPL-y 0.4.4, nREPL 0.6.0 Clojure 1.10.0 OpenJDK 64-Bit Server VM 11.0.8+10 Docs: (doc function-name-here) (find-doc &quot;part-of-name-here&quot;) Source: (source function-name-here) Javadoc: (javadoc java-object-or-class-here) Exit: Control+D or (exit) or (quit) Results: Stored in vars *1, *2, *3, an exception in *e user=&gt; (+ 1 2 3) ExecutionException java.io.FileNotFoundException: Could not locate reply/parsing__init.class, reply/parsing.clj or reply/parsing.cljc on classpath. This could potentially work. I&apos;m willing to take a bet that if nothing comes out of it, you owe me nothing, but if I get it working, I do want to get paid for the hours I&apos;m going to put in it :)"><y>#</y><d>2020-12-17</d><h>15:00</h><w>borkdude</w><a>@glenjamin</a> I have some success with reply on GraalVM, working around some issues in complete.core, reflection etc, etc.
<pre>$ ./reply --attach localhost:52612
REPL-y 0.4.4, nREPL 0.6.0
Clojure 1.10.0
OpenJDK 64-Bit Server VM 11.0.8+10
    Docs: (doc function-name-here)
          (find-doc &quot;part-of-name-here&quot;)
  Source: (source function-name-here)
 Javadoc: (javadoc java-object-or-class-here)
    Exit: Control+D or (exit) or (quit)
 Results: Stored in vars *1, *2, *3, an exception in *e

user=&gt; (+ 1 2 3)
ExecutionException java.io.FileNotFoundException: Could not locate reply/parsing__init.class, reply/parsing.clj or reply/parsing.cljc on classpath.</pre>
This could potentially work. I&apos;m willing to take a bet that if nothing comes out of it, you owe me nothing, but if I get it working, I do want to get paid for the hours I&apos;m going to put in it :)</z><z id="t1608217315" t="borkdude One of the issues is that reply &quot;complects&quot; the in-process REPL with the client"><y>#</y><d>2020-12-17</d><h>15:01</h><w>borkdude</w>One of the issues is that reply &quot;complects&quot; the in-process REPL with the client</z><z id="t1608217340" t="glenjamin please donâ€™t sink time into it on my account! This was only a â€œitâ€™d be nice if my container was a few hundred MB smallerâ€ idle thought"><y>#</y><d>2020-12-17</d><h>15:02</h><w>glenjamin</w>please donâ€™t sink time into it on my account! This was only a â€œitâ€™d be nice if my container was a few hundred MB smallerâ€ idle thought</z><z id="t1608217361" t="borkdude :thumbsup:"><y>#</y><d>2020-12-17</d><h>15:02</h><w>borkdude</w><b>:thumbsup:</b></z><z id="t1608217436" t="borkdude At least this works if I close the REPL: $ ./reply --attach localhost:52612 ConnectException Connection refused (Connection refused)"><y>#</y><d>2020-12-17</d><h>15:03</h><w>borkdude</w>At least this works if I close the REPL:
<pre>$ ./reply --attach localhost:52612
ConnectException Connection refused (Connection refused)</pre></z><z id="t1608217776" t="borkdude ehm... it works!"><y>#</y><d>2020-12-17</d><h>15:09</h><w>borkdude</w>ehm... it works!</z><z id="t1608217810" t="borkdude user=&gt; *clojure-version* {:major 1, :minor 10, :incremental 0, :qualifier nil}"><y>#</y><d>2020-12-17</d><h>15:10</h><w>borkdude</w><pre>user=&gt; *clojure-version*
{:major 1, :minor 10, :incremental 0, :qualifier nil}</pre></z><z id="t1608217868" t="borkdude $ ./reply --attach localhost:63307 &lt;&lt;&lt; &apos;(+ 1 2 3)&apos; REPL-y 0.4.4, nREPL 0.6.0 Clojure 1.10.0 OpenJDK 64-Bit Server VM 11.0.8+10 Docs: (doc function-name-here) (find-doc &quot;part-of-name-here&quot;) Source: (source function-name-here) Javadoc: (javadoc java-object-or-class-here) Exit: Control+D or (exit) or (quit) Results: Stored in vars *1, *2, *3, an exception in *e user=&gt; (+ 1 2 3) 6 user=&gt; Bye for now!"><y>#</y><d>2020-12-17</d><h>15:11</h><w>borkdude</w><pre>$ ./reply --attach localhost:63307 &lt;&lt;&lt; &apos;(+ 1 2 3)&apos;
REPL-y 0.4.4, nREPL 0.6.0
Clojure 1.10.0
OpenJDK 64-Bit Server VM 11.0.8+10
    Docs: (doc function-name-here)
          (find-doc &quot;part-of-name-here&quot;)
  Source: (source function-name-here)
 Javadoc: (javadoc java-object-or-class-here)
    Exit: Control+D or (exit) or (quit)
 Results: Stored in vars *1, *2, *3, an exception in *e

user=&gt; (+ 1 2 3)
6
user=&gt; Bye for now!</pre></z><z id="t1608217888" t="borkdude size of reply binary: 39867048"><y>#</y><d>2020-12-17</d><h>15:11</h><w>borkdude</w>size of reply binary: <code>39867048</code></z><z id="t1608217940" t="borkdude ^ [:attrs {:href &quot;/_/_/users/U0FTAT30E&quot;}] ..."><y>#</y><d>2020-12-17</d><h>15:12</h><w>borkdude</w>^ <a>@glenjamin</a>...</z><z id="t1608217966" t="glenjamin oh wow, nice one!"><y>#</y><d>2020-12-17</d><h>15:12</h><w>glenjamin</w>oh wow, nice one!</z><z id="t1608220714" t="borkdude [:attrs {:href &quot;/_/_/users/U0FTAT30E&quot;}] I just realized, I&apos;ve been using CircleCI so much for my open source projects, I owe at least to publish this code, if you&apos;re interested."><y>#</y><d>2020-12-17</d><h>15:58</h><w>borkdude</w><a>@glenjamin</a> I just realized, I&apos;ve been using CircleCI so much for my open source projects, I owe at least to publish this code, if you&apos;re interested.</z><z id="t1608220744" t="glenjamin that would be ace, i could imagine it would work as a PR to REPL-y?"><y>#</y><d>2020-12-17</d><h>15:59</h><r>glenjamin</r>that would be ace, i could imagine it would work as a PR to REPL-y?</z><z id="t1608220859" t="borkdude One of the issues is that some of the work is done in futures on the top-level. This causes trouble. So I just copied the source and fixed some of that. Some reflection issues. Some other hacks. It basically works if you run script/compile and set GRAALVM_HOME to 20.3.0 java 11. I&apos;ll make a private repo (which contains the hacky code, not meant for open source consumption yet)"><y>#</y><d>2020-12-17</d><h>16:00</h><r>borkdude</r>One of the issues is that some of the work is done in futures on the top-level. This causes trouble. So I just copied the source and fixed some of that. Some reflection issues. Some other hacks. It basically works if you run <code>script/compile</code> and set <code>GRAALVM_HOME</code> to 20.3.0 java 11. I&apos;ll make a private repo (which contains the hacky code, not meant for open source consumption yet)</z><z id="t1608221176" t="borkdude [:attrs {:href &quot;/_/_/users/U0FTAT30E&quot;}] I invited you to the repo"><y>#</y><d>2020-12-17</d><h>16:06</h><r>borkdude</r><a>@glenjamin</a> I invited you to the repo</z><z id="t1608221543" t="borkdude if I should invite more of your colleagues, let me know"><y>#</y><d>2020-12-17</d><h>16:12</h><r>borkdude</r>if I should invite more of your colleagues, let me know</z><z id="t1608221805" t="glenjamin perfect, thanks"><y>#</y><d>2020-12-17</d><h>16:16</h><r>glenjamin</r>perfect, thanks</z><z id="t1608221868" t="glenjamin could you invite c2nes please? is this something you intend to keep private?"><y>#</y><d>2020-12-17</d><h>16:17</h><r>glenjamin</r>could you invite <code>c2nes</code> please?

is this something you intend to keep private?</z><z id="t1608221988" t="borkdude depends. this is just scratch code for now, if I would open source it, it would need more testing"><y>#</y><d>2020-12-17</d><h>16:19</h><r>borkdude</r>depends. this is just scratch code for now, if I would open source it, it would need more testing</z><z id="t1608222032" t="borkdude I invited your colleague"><y>#</y><d>2020-12-17</d><h>16:20</h><r>borkdude</r>I invited your colleague</z><z id="t1608222798" t="glenjamin fair enough, i tend to throw a warning on the top and publish anyway - but my stuff isnâ€™t nearly as popular or polished as your usual stuff - so my bar is much lower ðŸ˜„"><y>#</y><d>2020-12-17</d><h>16:33</h><r>glenjamin</r>fair enough, i tend to throw a warning on the top and publish anyway - but my stuff isnâ€™t nearly as popular or polished as your usual stuff - so my bar is much lower <b>ðŸ˜„</b></z><z id="t1609175146" t="pez [:attrs {:href &quot;/_/_/users/U051BLM8F&quot;}] We have this strange issue on Calva where errors are delivered with a considerable lag. Also only if wifi is active. I tried using newer versions of nrepl and cider-nrepl, and it makes the problem go away. Wondering if this is something you have noticed and know about when it was fixed?"><y>#</y><d>2021-12-28</d><h>17:05</h><w>pez</w><a>@bozhidar</a> We have this strange issue on Calva where errors are delivered with a considerable lag. Also only if wifi is active. I tried using newer versions of nrepl and cider-nrepl, and it makes the problem go away. Wondering if this is something you have noticed and know about when it was fixed?</z><z id="t1609175401" t="bozhidar [:attrs {:href &quot;/_/_/users/U0ETXRFEW&quot;}] Don&apos;t recall encountering such an issue. Sounds like something timing out, maybe due to some uncaught exception somewhere, but if this was the case it wouldn&apos;t matter what type of connection you&apos;re using."><y>#</y><d>2021-12-28</d><h>17:10</h><w>bozhidar</w><a>@pez</a> Don&apos;t recall encountering such an issue. Sounds like something timing out, maybe due to some uncaught exception somewhere, but if this was the case it wouldn&apos;t matter what type of connection you&apos;re using.</z><z id="t1609175472" t="pez Iâ€™m not even using the connection. ðŸ˜ƒ"><y>#</y><d>2021-12-28</d><h>17:11</h><w>pez</w>Iâ€™m not even using the connection. <b>ðŸ˜ƒ</b></z><z id="t1609175547" t="pez Itâ€™s safe to use cider-nrepl 0.25.5?"><y>#</y><d>2021-12-28</d><h>17:12</h><w>pez</w>Itâ€™s safe to use cider-nrepl 0.25.5?</z><z id="t1609232609" t="bozhidar Yep. Newer is usually better. ðŸ™‚"><y>#</y><d>2021-12-29</d><h>09:03</h><w>bozhidar</w>Yep. Newer is usually better. <b>ðŸ™‚</b></z><z id="t1609857102" t="FiVo (def server (nrepl-server/start-server :port 35379)) (def conn (nrepl/connect :port 35379)) (nrepl/message (nrepl/client conn 1000) {:op &quot;eval&quot; :code &quot;(dotimes [i 3] (Thread/sleep 1000) (println (str \&quot;==&gt; \&quot; i)))&quot;}) ;; =&gt; () (def f (nrepl/client conn 1000)) (f) ;; =&gt; ({:id &quot;7a5fa37e-41ec-435b-b63c-5d58b611f4ac&quot;, ;; :out &quot;==&gt; 0\n&quot;, ;; :session &quot;19c38d39-e6fd-4026-8aae-2f7a307c95d3&quot;} ;; {:id &quot;7a5fa37e-41ec-435b-b63c-5d58b611f4ac&quot;, ;; :out &quot;==&gt; 1\n&quot;, ;; :session &quot;19c38d39-e6fd-4026-8aae-2f7a307c95d3&quot;} ;; {:id &quot;7a5fa37e-41ec-435b-b63c-5d58b611f4ac&quot;, ;; :out &quot;==&gt; 2\n&quot;, ;; :session &quot;19c38d39-e6fd-4026-8aae-2f7a307c95d3&quot;} ;; {:id &quot;7a5fa37e-41ec-435b-b63c-5d58b611f4ac&quot;, ;; :ns &quot;user&quot;, ;; :session &quot;19c38d39-e6fd-4026-8aae-2f7a307c95d3&quot;, ;; :value &quot;nil&quot;} ;; {:id &quot;7a5fa37e-41ec-435b-b63c-5d58b611f4ac&quot;, ;; :session &quot;19c38d39-e6fd-4026-8aae-2f7a307c95d3&quot;, ;; :status [&quot;done&quot;]}) Just some basic questions concerning the code above. The documentation of nrepl/client says &quot;Most REPL interactions are best performed via message and client-session on top of a client fn returned from this fn.&quot; So I am just wondering what the usual workflow is when reading stuff from the client and why I shouldn&apos;t use the f directly as above. message and client-session both seem to take a message as argument. What is the usual way to read repsonses asynchronously?"><y>#</y><d>2021-01-05</d><h>14:31</h><w>FiVo</w><pre>(def server (nrepl-server/start-server :port 35379))

  (def conn (nrepl/connect :port 35379))

  (nrepl/message (nrepl/client conn 1000)
                 {:op &quot;eval&quot; :code &quot;(dotimes [i 3] (Thread/sleep 1000) (println (str \&quot;==&gt; \&quot; i)))&quot;})
;; =&gt; ()
  (def f (nrepl/client conn 1000))

  (f)
;; =&gt; ({:id &quot;7a5fa37e-41ec-435b-b63c-5d58b611f4ac&quot;,
;;      :out &quot;==&gt; 0\n&quot;,
;;      :session &quot;19c38d39-e6fd-4026-8aae-2f7a307c95d3&quot;}
;;     {:id &quot;7a5fa37e-41ec-435b-b63c-5d58b611f4ac&quot;,
;;      :out &quot;==&gt; 1\n&quot;,
;;      :session &quot;19c38d39-e6fd-4026-8aae-2f7a307c95d3&quot;}
;;     {:id &quot;7a5fa37e-41ec-435b-b63c-5d58b611f4ac&quot;,
;;      :out &quot;==&gt; 2\n&quot;,
;;      :session &quot;19c38d39-e6fd-4026-8aae-2f7a307c95d3&quot;}
;;     {:id &quot;7a5fa37e-41ec-435b-b63c-5d58b611f4ac&quot;,
;;      :ns &quot;user&quot;,
;;      :session &quot;19c38d39-e6fd-4026-8aae-2f7a307c95d3&quot;,
;;      :value &quot;nil&quot;}
;;     {:id &quot;7a5fa37e-41ec-435b-b63c-5d58b611f4ac&quot;,
;;      :session &quot;19c38d39-e6fd-4026-8aae-2f7a307c95d3&quot;,
;;      :status [&quot;done&quot;]})</pre>
Just some basic questions concerning the code above. The documentation of <code>nrepl/client</code> says &quot;Most REPL interactions are best performed via message and client-session on top of
   a client fn returned from this fn.&quot; So I am just wondering what the usual workflow is when reading stuff from the client and why I shouldn&apos;t use the <code>f</code> directly as above. <code>message</code> and <code>client-session</code> both seem to take a message as argument. What is the usual way to read repsonses asynchronously?</z><z id="t1611452054" t="Andrey Hi, I have embedded nrepl in my Java application and need to initialize thread that is used to actually evaluate the expression by setting some session context to thread local variable (this approach cannot be changed). I wrote some simple middleware that utilizes long-lived sessions. In this middleware I just wrap the :code prepending it with initialisation of the session context: (defn inject-session-contextÂ  [h]Â  (fn [{:keys [op session transport code] :as msg}] Â  Â  (if (and session code) Â  Â  Â  (let [new-code (str &quot;(do (com.example.nrepl.middleware/set-session-context \&quot;&quot; session &quot;\&quot;)&quot; Â code &quot;)&quot;)] Â  Â  Â  Â  (h (assoc msg :code new-code))) Â  Â  Â  (h msg)))) It works, but in combination with cider-nrepl middleware disrupts debugging functionality. The only alternative solution (w/o nrepl source modification) that I found so far would be to check thread name, which has format &quot;NREPL-session uuid&quot; when theread local is accessed (it is necessary only in dev. mode), but I&apos;d like to avoid this fragile approach. Maybe there is a betterÂ option? Thank you."><y>#</y><d>2021-01-24</d><h>01:34</h><w>Andrey</w>Hi,
I have embedded nrepl in my Java application and need to initialize thread that is used to actually evaluate the expression by setting some session context to thread local variable (this approach cannot be changed). I wrote some simple middleware that utilizes long-lived sessions. In this middleware I just wrap the :code  prepending it with initialisation of the session context:
(defn inject-session-contextÂ  
  [h]Â  
  (fn [{:keys [op session transport code] :as msg}]	 Â  Â 
	(if (and session  code)	 Â  Â  Â 
		(let [new-code (str &quot;(do (com.example.nrepl.middleware/set-session-context \&quot;&quot; session &quot;\&quot;)&quot; Â code &quot;)&quot;)]	 Â  Â  Â  Â 
			(h (assoc msg :code new-code)))	 Â  Â  Â 
		(h msg))))

It works, but in combination with cider-nrepl middleware disrupts debugging functionality. The only alternative solution (w/o nrepl source modification) that I found so far would be to check thread name, which has format &quot;NREPL-session uuid&quot; when theread local is accessed (it is necessary only in dev. mode), but I&apos;d like to avoid this fragile approach. Maybe there is a betterÂ option?
Thank you.</z><z id="t1611516542" t="bozhidar Btw, what exactly are you aiming to achieve with this middleware? That&apos;s not clear to me, so I wanted to clarify this before discussing any potential options/solutions."><y>#</y><d>2021-01-24</d><h>19:29</h><r>bozhidar</r>Btw, what exactly are you aiming to achieve with this middleware? That&apos;s not clear to me, so I wanted to clarify this before discussing any potential options/solutions.</z><z id="t1611664875" t="Andrey The code that is called directly or indirectly in evaluated expression needs access to session context stored in thread local variable. Session context stores such information as long running hibernate session, login data. Currently as a workaround I just modified evaluate in interruptible-eval:"><y>#</y><d>2021-01-26</d><h>12:41</h><r>Andrey</r>The code that is called directly or indirectly in evaluated expression needs access to session context stored in thread local variable. Session context stores such information as long running hibernate session, login data. Currently as a workaround I just modified evaluate in interruptible-eval:</z><z id="t1611664890" t="Andrey :eval (let [eval-fn (if eval (find-var (symbol eval)) (com.example.clojure.nrepl.callbacks/gb-eval-fn session-id))]"><y>#</y><d>2021-01-26</d><h>12:41</h><r>Andrey</r>:eval (let [eval-fn (if eval (find-var (symbol eval)) (com.example.clojure.nrepl.callbacks/gb-eval-fn session-id))]</z><z id="t1611665002" t="Andrey Where gb-eval-fn just initialises session context if it is empty for this session, sets corresponding thread local and performs eval (defn gb-eval-fn Â [session-id] Â (fnÂ [code] Â (doÂ  Â Â (when session-id Â Â Â (set-session-context session-id)) Â Â Â (eval code))))"><y>#</y><d>2021-01-26</d><h>12:43</h><r>Andrey</r>Where gb-eval-fn just initialises session context if it is empty for this session, sets corresponding thread local and performs eval
(defn gb-eval-fn
Â [session-id]
Â (fnÂ [code]
	Â (doÂ 
	Â Â (when session-id
	Â Â Â (set-session-context session-id))
	Â Â Â (eval code))))</z><z id="t1611665137" t="Andrey I hope I answered the question. Basically there is big legacy java code base that is called by clojure code and it relies on the presence of the session context in the thread local var"><y>#</y><d>2021-01-26</d><h>12:45</h><r>Andrey</r>I hope I answered the question. Basically there is big legacy java code base that is called by clojure code and it relies on the presence of the session context in the thread local var</z><z id="t1612108060" t="Andrey Sorry for pinging [:attrs {:href &quot;/_/_/users/U051BLM8F&quot;}] , will do this only once - not sure how threads notification work. Would appreciate your feedback whenever you have time"><y>#</y><d>2021-01-31</d><h>15:47</h><r>Andrey</r>Sorry for pinging <a>@U051BLM8F</a> , will do this only once - not sure how threads notification work. Would appreciate your feedback whenever you have time</z><z id="t1612167715" t="bozhidar No worries. Can you open a discussion on the subject https://github.com/nrepl/nrepl/discussions so it&apos;d be less likely that I&apos;ll forget about this."><y>#</y><d>2021-02-01</d><h>08:21</h><r>bozhidar</r>No worries. Can you open a discussion on the subject <a href="https://github.com/nrepl/nrepl/discussions" target="_blank">https://github.com/nrepl/nrepl/discussions</a> so it&apos;d be less likely that I&apos;ll forget about this.</z><z id="t1612167889" t="bozhidar Generally it seems to me it&apos;d be preferable for you to modify the session but inserting some middleware before eval instead of modifying eval directly, but I might be missing something. I&apos;m also wondering if this https://github.com/nrepl/nrepl/pull/214 might be something that can be helpful in your case"><y>#</y><d>2021-02-01</d><h>08:24</h><r>bozhidar</r>Generally it seems to me it&apos;d be preferable for you to modify the session but inserting some middleware before eval instead of modifying eval directly, but I might be missing something. I&apos;m also wondering if this <a href="https://github.com/nrepl/nrepl/pull/214" target="_blank">https://github.com/nrepl/nrepl/pull/214</a> might be something that can be helpful in your case</z><z id="t1612167935" t="bozhidar With a configurable thread factory you might be able to move this init logic to it (I presume)."><y>#</y><d>2021-02-01</d><h>08:25</h><r>bozhidar</r>With a configurable thread factory you might be able to move this init logic to it (I presume).</z><z id="t1611482726" t="odie Hi all, I updated cider &amp; friends after some time away from clojure. I found that Iâ€™m repeatedly getting unhandled exceptions like this: ERROR: Unhandled REPL handler exception processing message {:op eldoc, ...} Hereâ€™s the startup cmd reported by cider: ;; Startup: /usr/local/bin/clojure -Sdeps &apos;{:deps {nrepl/nrepl {:mvn/version &quot;0.8.3&quot;} refactor-nrepl {:mvn/version &quot;2.5.0&quot;} cider/cider-nrepl {:mvn/version &quot;0.25.7&quot;}}}&apos; -m nrepl.cmdline --middleware &apos;[&quot;refactor-nrepl.middleware/wrap-refactor&quot;,&quot;cider.nrepl/cider-middleware&quot;]&apos; Am I missing something really obvious here?"><y>#</y><d>2021-01-24</d><h>10:05</h><w>odie</w>Hi all, I updated cider &amp; friends after some time away from clojure. I found that Iâ€™m repeatedly getting unhandled exceptions like this:
<pre>ERROR: Unhandled REPL handler exception processing message {:op eldoc, ...}</pre>
Hereâ€™s the startup cmd reported by cider:
<pre>;;  Startup: /usr/local/bin/clojure -Sdeps &apos;{:deps {nrepl/nrepl {:mvn/version &quot;0.8.3&quot;} refactor-nrepl {:mvn/version &quot;2.5.0&quot;} cider/cider-nrepl {:mvn/version &quot;0.25.7&quot;}}}&apos; -m nrepl.cmdline --middleware &apos;[&quot;refactor-nrepl.middleware/wrap-refactor&quot;,&quot;cider.nrepl/cider-middleware&quot;]&apos;</pre>
Am I missing something really obvious here?</z><z id="t1611511104" t="dpsutton Check #cider Someone was just in there reporting this. Hopefully thereâ€™s a ticket linked as well"><y>#</y><d>2021-01-24</d><h>17:58</h><w>dpsutton</w>Check #cider   Someone was just in there reporting this. Hopefully thereâ€™s a ticket linked as well</z><z id="t1611516374" t="bozhidar [:attrs {:href &quot;/_/_/users/U11BV7MTK&quot;}] [:attrs {:href &quot;/_/_/users/U05380FG9&quot;}] We already fixed this on Orchard&apos;s master ( https://github.com/clojure-emacs/orchard/commit/e3de281fa731ee81c3a012200c0c94b4e2cecded ), even though we&apos;re not quite sure how something like this might be happening and why it&apos;s affecting only some people."><y>#</y><d>2021-01-24</d><h>19:26</h><w>bozhidar</w><a>@dpsutton</a> <a>@odie</a> We already fixed this on Orchard&apos;s <code>master</code> (<a href="https://github.com/clojure-emacs/orchard/commit/e3de281fa731ee81c3a012200c0c94b4e2cecded" target="_blank">https://github.com/clojure-emacs/orchard/commit/e3de281fa731ee81c3a012200c0c94b4e2cecded</a>), even though we&apos;re not quite sure how something like this might be happening and why it&apos;s affecting only some people.</z><z id="t1611549916" t="odie [:attrs {:href &quot;/_/_/users/U11BV7MTK&quot;}] [:attrs {:href &quot;/_/_/users/U051BLM8F&quot;}] Thanks for the quick reply! Iâ€™ve rolled back to using cider-nrepl 0.25.6 for now. It seems to be working fine so far. :)"><y>#</y><d>2021-01-25</d><h>04:45</h><w>odie</w><a>@dpsutton</a> <a>@bozhidar</a> Thanks for the quick reply! Iâ€™ve rolled back to using cider-nrepl 0.25.6 for now. It seems to be working fine so far. :)</z><z id="t1611560500" t="bozhidar I&apos;ve cut 0.25.8 that should fix the issue you encountered."><y>#</y><d>2021-01-25</d><h>07:41</h><w>bozhidar</w>I&apos;ve cut 0.25.8 that should fix the issue you encountered.</z><z id="t1617570732" t="Joshua Suskalo I&apos;ve made a conditions+restarts library for clojure, and I want to implement an interactive debugger like Common Lisp&apos;s. I have a basic one that just reads from stdin to get what it needs, but I know nREPL provides me with a way that I could do something better. Is there a good place to start in the documentation for writing some code that will ask the nrepl client for some forms to evaluate and to send the client some objects, like exceptions, so that I can make an emacs package to interact with it?"><y>#</y><d>2021-04-04</d><h>21:12</h><w>Joshua Suskalo</w>I&apos;ve made a conditions+restarts library for clojure, and I want to implement an interactive debugger like Common Lisp&apos;s. I have a basic one that just reads from stdin to get what it needs, but I know nREPL provides me with a way that I could do something better. Is there a good place to start in the documentation for writing some code that will ask the nrepl client for some forms to evaluate and to send the client some objects, like exceptions, so that I can make an emacs package to interact with it?</z><z id="t1617571124" t="Joshua Suskalo I&apos;m guessing this would be a middleware"><y>#</y><d>2021-04-04</d><h>21:18</h><w>Joshua Suskalo</w>I&apos;m guessing this would be a middleware</z><z id="t1617604727" t="bozhidar Yeah, exactly. I think that https://nrepl.org has plenty of documentation, and you can also check some of the code in cider-nrepl as a reference."><y>#</y><d>2021-04-05</d><h>06:38</h><w>bozhidar</w>Yeah, exactly. I think that <a href="https://nrepl.org" target="_blank">https://nrepl.org</a> has plenty of documentation, and you can also check some of the code in <code>cider-nrepl</code> as a reference.</z><z id="t1617739634" t="Joshua Suskalo Thanks!"><y>#</y><d>2021-04-06</d><h>20:07</h><w>Joshua Suskalo</w>Thanks!</z><z id="t1620487034" t="Ale Hello, I&apos;m having some issues with cider starting a krell nrepl. I can run the app correcly, and can open a working cljs repl issuing clj -M -m krell.main -co build.edn -r at the command line. However, when I try to start the repl from cider or calva, I get this error ReferenceError: Can&apos;t find variable: cljs full stack trace here: https://gist.github.com/laynor/4944b74a36691b8c3be7bb852818fe87 The full project repo is here https://github.com/laynor/krelltest I previously asked for help in #beginners , and the project appears to work at least on [:attrs {:href &quot;/_/_/users/U0ETXRFEW&quot;}] machine, who helped me a lot to troubleshoot this issue. As a result of this issue, the cider repl is stuck at the user =&gt; prompt (clojure/java repl if I understand correctly) and never reaches the cljs.user =&gt; repl. Strangest thing, when I was troubleshooting this issue, I made a copy of the project in another directory. By mistake, while the app was running on the simulator from the second copy of the project, I jacked in with cider from the first copy, and I got a half working cljs.user =&gt; repl (I could execute code in the running application, but cljs.pprint.pprint was undefined so I was getting errors in the cider repl). Here are my system details: Os: Arch linux Emacs: recent version compiled from sources (master). native comp enabled Cider version: &quot;CIDER 1.1.0 (package: 20210422.802) (Plovdiv)&quot; clojure --version: Clojure CLI version 1.10.3.822 java version: openjdk version &quot;1.8.0_292&quot; OpenJDK Runtime Environment (build 1.8.0_292-b10) OpenJDK 64-Bit Server VM (build 25.292-b10, mixed mode) Node version 14.3.0 Any clue?"><y>#</y><d>2021-05-08</d><h>15:17</h><w>Ale</w>Hello, I&apos;m having some issues with cider starting a krell nrepl.
I can run the app correcly, and can open a working cljs repl  issuing
<pre>clj -M -m krell.main -co build.edn -r</pre>
at the command line.
However, when I try to start the repl from cider or calva, I get this error
<pre>ReferenceError: Can&apos;t find variable: cljs</pre>
full stack trace here: <a href="https://gist.github.com/laynor/4944b74a36691b8c3be7bb852818fe87" target="_blank">https://gist.github.com/laynor/4944b74a36691b8c3be7bb852818fe87</a>
The full project repo is here <a href="https://github.com/laynor/krelltest" target="_blank">https://github.com/laynor/krelltest</a>
I previously asked for help in #beginners , and the project appears to work at least on <a>@pez</a> machine, who helped me a lot to troubleshoot this issue.
As a result of this issue, the cider repl is stuck at the <code>user =&gt;</code> prompt (clojure/java repl if I understand correctly) and never reaches the <code>cljs.user =&gt;</code> repl.
Strangest thing, when I was troubleshooting this issue, I made a copy of the project in another directory.
By mistake, while the app was running on the simulator from the second copy of the project,  I jacked in with cider from the first copy, and I got a half working <code>cljs.user =&gt;</code> repl (I could execute code  in the running application, but <code>cljs.pprint.pprint</code> was undefined so I was getting errors in the cider repl).

Here are my system details:
Os: Arch linux
Emacs: recent version compiled from sources (master). native comp enabled
Cider version: &quot;CIDER 1.1.0 (package: 20210422.802) (Plovdiv)&quot;
clojure --version: Clojure CLI version 1.10.3.822
java version:
<pre>openjdk version &quot;1.8.0_292&quot;
OpenJDK Runtime Environment (build 1.8.0_292-b10)
OpenJDK 64-Bit Server VM (build 25.292-b10, mixed mode)</pre>
Node version 14.3.0

Any clue?</z><z id="t1620487701" t="pez I tried it with java8 (Adopt) and java15 (Amazon), and Clojure CLI 1.10.3.822. Also [:attrs {:href &quot;/_/_/users/U84UHA68P&quot;}] tried it with both CIDER and Calva with the same boring results."><y>#</y><d>2021-05-08</d><h>15:28</h><w>pez</w>I tried it with java8 (Adopt) and java15 (Amazon), and Clojure CLI 1.10.3.822. Also <a>@laynor</a> tried it with both CIDER and Calva with the same boring results.</z><z id="t1620543906" t="bozhidar I&apos;ve never used Krell, so I&apos;m afraid I can&apos;t offer much help here."><y>#</y><d>2021-05-09</d><h>07:05</h><w>bozhidar</w>I&apos;ve never used Krell, so I&apos;m afraid I can&apos;t offer much help here.</z><z id="t1620563113" t="Ale I&apos;ll try to post the same in #cider, maybe someone can help... I&apos;m still stuck. I tried cleaning up my home and reinstalling the relevant software but I still get the same issue."><y>#</y><d>2021-05-09</d><h>12:25</h><w>Ale</w>I&apos;ll try to post the same in #cider, maybe someone can help... I&apos;m still stuck. I tried cleaning up my home and reinstalling the relevant software but I still get the same issue.</z><z id="t1620730571" t="victorb is there any resources around either password protecting a nrepl connection, protecting it with keypairs or something similar?"><y>#</y><d>2021-05-11</d><h>10:56</h><w>victorb</w>is there any resources around either password protecting a nrepl connection, protecting it with keypairs or something similar?</z><z id="t1620806152" t="bozhidar Nothing that I&apos;m aware of. I know most people in such situation would use an SSH tunnel or something along those lines."><y>#</y><d>2021-05-12</d><h>07:55</h><w>bozhidar</w>Nothing that I&apos;m aware of. I know most people in such situation would use an SSH tunnel or something along those lines.</z><z id="t1621283941" t="Daniel Slutsky Hi! [:attrs {:href &quot;/_/_/users/U0FMV3MDK&quot;}] and I are creating a small middleware that listens to evaluation of code and keeps track of evaluation results. (This is part of an upcoming version of the Notespace project.) With :op &quot;eval&quot; , this seems to work nicely. However, we are also interested in :op &quot;load-file&quot; , since that is the kind of request when one evaluates a whole buffer in CIDER. Then, the nREPL response only tells about the evaluation result of the last top-level form. This kind of op directly calls clojure.lang.Compiler/load : https://github.com/clojure/tools.nrepl/blob/2263b6b/src/main/clojure/clojure/tools/nrepl/middleware/load_file.clj#L62 So, it seems that on whole-buffer evaluation, we will not be able to get the return values of intermediate top-level forms, but only of the last one. Any ideas about how to overcome that?"><y>#</y><d>2021-05-17</d><h>20:39</h><w>Daniel Slutsky</w>Hi!

<a>@sakalli</a> and I are creating a small middleware that listens to evaluation of code and keeps track of evaluation results. (This is part of an upcoming version of the Notespace project.)

With <code>:op &quot;eval&quot;</code>, this seems to work nicely.

However, we are also interested in <code>:op &quot;load-file&quot;</code>, since that is the kind of request when one evaluates a whole buffer in CIDER.
Then, the nREPL response only tells about the evaluation result of the last top-level form.

This kind of op directly calls <code>clojure.lang.Compiler/load</code>:
<a href="https://github.com/clojure/tools.nrepl/blob/2263b6b/src/main/clojure/clojure/tools/nrepl/middleware/load_file.clj#L62" target="_blank">https://github.com/clojure/tools.nrepl/blob/2263b6b/src/main/clojure/clojure/tools/nrepl/middleware/load_file.clj#L62</a>

So, it seems that on whole-buffer evaluation, we will not be able to get the return values of intermediate top-level forms, but only of the last one.

Any ideas about how to overcome that?</z><z id="t1621284137" t="bozhidar There&apos;s no way to circumvent this with load-file ."><y>#</y><d>2021-05-17</d><h>20:42</h><w>bozhidar</w>There&apos;s no way to circumvent this with <code>load-file</code>.</z><z id="t1621284196" t="bozhidar If you need to eval all top-level forms you&apos;ll need to walk over them and run eval for each. That won&apos;t be a problem if you eval in a single session as the evaluations will be serialized."><y>#</y><d>2021-05-17</d><h>20:43</h><w>bozhidar</w>If you need to eval all top-level forms you&apos;ll need to walk over them and run <code>eval</code> for each. That won&apos;t be a problem if you eval in a single session as the evaluations will be serialized.</z><z id="t1621284511" t="Daniel Slutsky Thanks for the quick help, [:attrs {:href &quot;/_/_/users/U051BLM8F&quot;}] ! We tried to evaluate a region with a few top-level forms (through :op &quot;eval&quot; ), and it actually sent us multiple responses with all evaluation values. Is it surprising? Request (removed the bit :session member, so that it prints nicely): {:transport #object[nrepl.middleware.caught$caught_transport$reify__915 0x5e5191a5 &quot; Response messages: {:id &quot;132&quot;, :session &quot;736cc68a-a5fe-44d5-8906-0ba56ca15dda&quot;, :ns &quot;notespace.nrepl&quot;, :value 3, :nrepl.middleware.print/keys #{:value}} {:id &quot;132&quot;, :session &quot;736cc68a-a5fe-44d5-8906-0ba56ca15dda&quot;, :ns &quot;notespace.nrepl&quot;, :value 7, :nrepl.middleware.print/keys #{:value}} {:id &quot;132&quot;, :session &quot;736cc68a-a5fe-44d5-8906-0ba56ca15dda&quot;, :status #{:done}}"><y>#</y><d>2021-05-17</d><h>20:48</h><w>Daniel Slutsky</w>Thanks for the quick help, <a>@bozhidar</a>!

We tried to evaluate a region with a few top-level forms (through <code>:op &quot;eval&quot;</code>), and it actually sent us multiple responses with all evaluation values.
Is it surprising?

Request (removed the bit <code>:session</code> member, so that it prints nicely):
<pre>{:transport
 #object[nrepl.middleware.caught$caught_transport$reify__915 0x5e5191a5 &quot;</pre>
Response messages:
<pre>{:id &quot;132&quot;,
 :session &quot;736cc68a-a5fe-44d5-8906-0ba56ca15dda&quot;,
 :ns &quot;notespace.nrepl&quot;,
 :value 3,
 :nrepl.middleware.print/keys #{:value}}

{:id &quot;132&quot;,
 :session &quot;736cc68a-a5fe-44d5-8906-0ba56ca15dda&quot;,
 :ns &quot;notespace.nrepl&quot;,
 :value 7,
 :nrepl.middleware.print/keys #{:value}}

{:id &quot;132&quot;,
 :session &quot;736cc68a-a5fe-44d5-8906-0ba56ca15dda&quot;,
 :status #{:done}}</pre></z><z id="t1621285021" t="Daniel Slutsky If it seems interesting, I can share a self-contained example tomorrow. Anyway, your comment already helped wonderfully. ðŸ™"><y>#</y><d>2021-05-17</d><h>20:57</h><w>Daniel Slutsky</w>If it seems interesting, I can share a self-contained example tomorrow.
Anyway, your comment already helped wonderfully. <b>ðŸ™</b></z><z id="t1621285108" t="dpsutton "><y>#</y><d>2021-05-17</d><h>20:58</h><w>dpsutton</w><code></code></z><z id="t1621285131" t="dpsutton that is expected to me. evaluating a region can (and here does) have multiple effects"><y>#</y><d>2021-05-17</d><h>20:58</h><w>dpsutton</w>that is expected to me. evaluating a region can (and here does) have multiple effects</z><z id="t1621285141" t="dpsutton load-file is a primitive offered by the clojure compiler"><y>#</y><d>2021-05-17</d><h>20:59</h><w>dpsutton</w>load-file is a primitive offered by the clojure compiler</z><z id="t1621285180" t="Daniel Slutsky Thanks, [:attrs {:href &quot;/_/_/users/U11BV7MTK&quot;}] !"><y>#</y><d>2021-05-17</d><h>20:59</h><w>Daniel Slutsky</w>Thanks, <a>@dpsutton</a>!</z><z id="t1621285725" t="pez I donâ€™t understand the answerâ€¦"><y>#</y><d>2021-05-17</d><h>21:08</h><w>pez</w>I donâ€™t understand the answerâ€¦</z><z id="t1621285962" t="pez Also, eval a region and get back results for each top level form in it surprises me. I would expect the reader to get the text, eval each form and give me back the result of the last thing evaled."><y>#</y><d>2021-05-17</d><h>21:12</h><w>pez</w>Also, eval a region and get back results for each top level form in it surprises me. I would expect the reader to get the text, eval each form and give me back the result of the last thing evaled.</z><z id="t1621286003" t="dpsutton that&apos;s just not what (def x 1)(def y 2) (def z 3) would ever do, and that&apos;s all evaling a region does, just send a region over to the repl"><y>#</y><d>2021-05-17</d><h>21:13</h><w>dpsutton</w>that&apos;s just not what <code>(def x 1)(def y 2) (def z 3)</code> would ever do, and that&apos;s all evaling a region does, just send a region over to the repl</z><z id="t1621286045" t="dpsutton /tmp â¯â¯â¯ clj Clojure 1.10.3 user=&gt; (def x 1)(def y 2)(def z 3) #&apos;user/x #&apos;user/y #&apos;user/z user=&gt; "><y>#</y><d>2021-05-17</d><h>21:14</h><w>dpsutton</w><pre>/tmp â¯â¯â¯ clj
Clojure 1.10.3
user=&gt; (def x 1)(def y 2)(def z 3)
#&apos;user/x
#&apos;user/y
#&apos;user/z
user=&gt;</pre>
</z><z id="t1621286299" t="pez Iâ€™m now realizing that Calva does not have a working eval region command."><y>#</y><d>2021-05-17</d><h>21:18</h><w>pez</w>Iâ€™m now realizing that Calva does not have a working eval region command.</z><z id="t1621286315" t="dpsutton it&apos;s probably quite infrequently used. i&apos;d wait for a feature request to be honest"><y>#</y><d>2021-05-17</d><h>21:18</h><w>dpsutton</w>it&apos;s probably quite infrequently used. i&apos;d wait for a feature request to be honest</z><z id="t1621286374" t="pez Well, the command is actually named Evaluate current form (or selection) so we are breaking the promiseâ€¦"><y>#</y><d>2021-05-17</d><h>21:19</h><w>pez</w>Well, the command is actually named Evaluate current form (or selection) so we are breaking the promiseâ€¦</z><z id="t1621286420" t="pez Noone has complained so far, and it must have been broken for quite a while. So you are probably right about infrequent."><y>#</y><d>2021-05-17</d><h>21:20</h><w>pez</w>Noone has complained so far, and it must have been broken for quite a while. So you are probably right about infrequent.</z><z id="t1621324174" t="Daniel Slutsky [:attrs {:href &quot;/_/_/users/U0ETXRFEW&quot;}] thanks. We will try the usefulness of eval-region in CIDER for Notespace (which is basically a Marginalia-like literate programming tool with dynamic user-experience and data visualizations). After we hopefully demonstrate that it is useful in CIDER, I&apos;ll ask you if you like to make it work in Calva. ðŸ™"><y>#</y><d>2021-05-18</d><h>07:49</h><w>Daniel Slutsky</w><a>@pez</a> thanks.

We will try the usefulness of eval-region in CIDER for Notespace (which is basically a Marginalia-like literate programming tool with dynamic user-experience and data visualizations).

After we hopefully demonstrate that it is useful in CIDER, I&apos;ll ask you if you like to make it work in Calva.  <b>ðŸ™</b></z><z id="t1621324946" t="pez Deal!"><y>#</y><d>2021-05-18</d><h>08:02</h><w>pez</w>Deal!</z><z id="t1621487735" t="Eddie Hello all, Iâ€™m a total newcomer to nrepl and I have a question about embedding an nrepl server in an application. I would like to automatically define some symbols whenever a client connects (new sessions). I thought the :greeting-fn might fit this need, so I tried this: (start-server :greeting-fn (fn [t] (-&gt; t (nt/send {:out &quot;Hello!&quot;}) (nt/send {:eval &quot;(def x 10)&quot;})))) When I connect to the repl, I see the â€œHello!â€ but the x symbol is not defined. Am I going about this incorrectly? Does anyone have any suggestions for how best to implicitly evaluate a form when a client connects? Thanks."><y>#</y><d>2021-05-20</d><h>05:15</h><w>Eddie</w>Hello all, Iâ€™m a total newcomer to nrepl and I have a question about embedding an nrepl server in an application. I would like to automatically define some symbols whenever a client connects (new sessions). I thought the <code>:greeting-fn</code> might fit this need, so I tried this:
<pre>(start-server :greeting-fn (fn [t]
                             (-&gt; t
                                 (nt/send {:out &quot;Hello!&quot;})
                                 (nt/send {:eval &quot;(def x 10)&quot;}))))</pre>
When I connect to the repl, I see the â€œHello!â€ but the <code>x</code> symbol is not defined. Am I going about this incorrectly? Does anyone have any suggestions for how best to  implicitly evaluate a form when a client connects? Thanks.</z><z id="t1621489417" t="dpsutton transport is how the server you are starting talks to the client. you can&apos;t ask the client to eval something, the server has to eval that. have you tried just (fn [t] (def x 10)) ? I can&apos;t imagine it&apos;s in the correct namespace though"><y>#</y><d>2021-05-20</d><h>05:43</h><w>dpsutton</w>transport is how the server you are starting talks to the client. you can&apos;t ask the client to eval something, the server has to eval that. have you tried just <code>(fn [t] (def x 10))</code>? I can&apos;t imagine it&apos;s in the correct namespace though</z><z id="t1621530962" t="Eddie Ah ok thanks, [:attrs {:href &quot;/_/_/users/U11BV7MTK&quot;}] . I see that understood the directionality of the transport wrong. Can you elaborate on your suggestion a little more? Where would you suggest I try putting the (fn [t] (def x 10)) ?"><y>#</y><d>2021-05-20</d><h>17:16</h><w>Eddie</w>Ah ok thanks, <a>@dpsutton</a>. I see that understood the directionality of the transport wrong. Can you elaborate on your suggestion a little more? Where would you suggest I try putting the <code>(fn [t] (def x 10))</code>?</z><z id="t1621531004" t="dpsutton your greeting function"><y>#</y><d>2021-05-20</d><h>17:16</h><w>dpsutton</w>your greeting function</z><z id="t1621567327" t="Eddie Ah, I see. You are correct that it works, but it defines x in the namespace where the server was started. There may be some ways to tweak this to do the right thing. Thanks for the help!"><y>#</y><d>2021-05-21</d><h>03:22</h><w>Eddie</w>Ah, I see. You are correct that it works, but it defines <code>x</code> in the namespace where the server was started. There may be some ways to tweak this to do the right thing. Thanks for the help!</z><z id="t1622569544" t="Daniel Slutsky Following nREPL requests during my CIDER sessions, I see that cider-eval-buffer sometimes results in :op &quot;load-file&quot; , but sometimes (on some sessions) it actually results in :op &quot;eval&quot; , where the request looks like the following (omitting the :session member for brevity): {:transport #object[nrepl.middleware.load_file$wrap_load_file$fn$reify__1455 0x7732719a &quot; I coulndn&apos;t put the finger on what may have happened in my setup that made this happen. Any idea why this happens? (It is not necessarily a problem. I&apos;m just wondering if this is typical, and if I should expect more kinds of behaviors when evaluating buffers.) ðŸ™"><y>#</y><d>2021-06-01</d><h>17:45</h><w>Daniel Slutsky</w>Following nREPL requests during my CIDER sessions, I see that <code>cider-eval-buffer</code> sometimes results in <code>:op &quot;load-file&quot;</code>, but sometimes (on some sessions) it actually results in <code>:op &quot;eval&quot;</code> , where the request looks like the following (omitting the <code>:session</code> member for brevity):
<pre>{:transport
 #object[nrepl.middleware.load_file$wrap_load_file$fn$reify__1455 0x7732719a &quot;</pre>
I coulndn&apos;t put the finger on what may have happened in my setup that made this happen.
Any idea why this happens?

(It is not necessarily a problem. I&apos;m just wondering if this is typical, and if I should expect more kinds of behaviors when evaluating buffers.)

<b>ðŸ™</b></z><z id="t1622616740" t="bozhidar First time I see this. Seems pretty odd to me, as I see that in the eval op you have the code of the load-file op. I don&apos;t recall them being implemented in terms of one another."><y>#</y><d>2021-06-02</d><h>06:52</h><w>bozhidar</w>First time I see this. Seems pretty odd to me, as I see that in the <code>eval</code> op you have the code of the <code>load-file</code> op. I don&apos;t recall them being implemented in terms of one another.</z><z id="t1622638825" t="Daniel Slutsky ðŸ™"><y>#</y><d>2021-06-02</d><h>13:00</h><w>Daniel Slutsky</w><b>ðŸ™</b></z><z id="t1623444580" t="awb99 Anyone who knows how to see if my jvm has jdk.doclet jar file ?"><y>#</y><d>2021-06-11</d><h>20:49</h><w>awb99</w>Anyone who knows how to see if my jvm has jdk.doclet jar file ?</z><z id="t1623444601" t="awb99 I want to get nrepl working on gnu guix, and this is preventing me from doing so."><y>#</y><d>2021-06-11</d><h>20:50</h><w>awb99</w>I want to get nrepl working on gnu guix, and this is preventing me from doing so.</z><z id="t1624995539" t="Eugen hello, I was looking at nrepl and the fact that it does not have authentication and I&apos;ve noticed the transports. Then I thought: why not an SSH transport ? That should provide auth and authz."><y>#</y><d>2021-06-29</d><h>19:38</h><w>Eugen</w>hello, I was looking at nrepl and the fact that it does not have authentication and I&apos;ve noticed the transports.
Then I thought: why not an SSH transport ?

That should provide auth and authz.</z><z id="t1624995658" t="Eugen I would like to work on this and contribute it to nrepl (I think it should be an extension, not in core) Considering I will have an &quot;SSH socket/endpoint&quot; how should I go about integrating it with nrepl ? is tty transport a good start ?"><y>#</y><d>2021-06-29</d><h>19:40</h><w>Eugen</w>I would like to work on this and contribute it to nrepl (I think it should be an extension, not in core)
Considering I will have an &quot;SSH socket/endpoint&quot; how should I go about integrating it with nrepl ?
is tty transport a good start ?</z><z id="t1624995675" t="Eugen is this something interesting for the project?"><y>#</y><d>2021-06-29</d><h>19:41</h><w>Eugen</w>is this something interesting for the project?</z><z id="t1625037272" t="bozhidar [:attrs {:href &quot;/_/_/users/U011NGC5FFY&quot;}] Most people use SSH tunneling to achieve more or less the same result. CIDER also supports this. I think it&apos;s a good balance between not adding complexity to nREPL and providing you with a secure connection."><y>#</y><d>2021-06-30</d><h>07:14</h><w>bozhidar</w><a>@eugen.stan</a> Most people use SSH tunneling to achieve more or less the same result. CIDER also supports this. I think it&apos;s a good balance between not adding complexity to nREPL and providing you with a secure connection.</z><z id="t1625037322" t="Eugen thanks, I think so too"><y>#</y><d>2021-06-30</d><h>07:15</h><w>Eugen</w>thanks, I think so too</z><z id="t1625062230" t="Eugen [:attrs {:href &quot;/_/_/users/U051BLM8F&quot;}] : any reason why (:import clojure.lang.RT is being imported? does not seem to be used but it seems to impact nrepl usage in babashka https://github.com/nrepl/nrepl/blob/f1ed475a0218852ad98899942e1865c75610c18a/src/clojure/nrepl/transport.clj#L12"><y>#</y><d>2021-06-30</d><h>14:10</h><w>Eugen</w><a>@bozhidar</a>: any reason why <code>(:import    clojure.lang.RT</code> is being imported?
does not seem to be used but it seems to impact nrepl usage in babashka

<a href="https://github.com/nrepl/nrepl/blob/f1ed475a0218852ad98899942e1865c75610c18a/src/clojure/nrepl/transport.clj#L12" target="_blank">https://github.com/nrepl/nrepl/blob/f1ed475a0218852ad98899942e1865c75610c18a/src/clojure/nrepl/transport.clj#L12</a></z><z id="t1625062362" t="bozhidar [:attrs {:href &quot;/_/_/users/U011NGC5FFY&quot;}] No idea. Seems it has been around forever, someone will have do dig the history. If everything works without it we can remove it."><y>#</y><d>2021-06-30</d><h>14:12</h><w>bozhidar</w><a>@eugen.stan</a> No idea. Seems it has been around forever, someone will have do dig the history. If everything works without it we can remove it.</z><z id="t1625062435" t="Eugen thanks, I will keep that in mind when I get to it if [:attrs {:href &quot;/_/_/users/U04V15CAJ&quot;}] does not get to it first"><y>#</y><d>2021-06-30</d><h>14:13</h><w>Eugen</w>thanks, I will keep that in mind when I get to it if <a>@borkdude</a> does not get to it first</z><z id="t1625062533" t="borkdude It&apos;s imported because it&apos;s used here: https://github.com/nrepl/nrepl/blob/f1ed475a0218852ad98899942e1865c75610c18a/src/clojure/nrepl/transport.clj#L62"><y>#</y><d>2021-06-30</d><h>14:15</h><w>borkdude</w>It&apos;s imported because it&apos;s used here:
<a href="https://github.com/nrepl/nrepl/blob/f1ed475a0218852ad98899942e1865c75610c18a/src/clojure/nrepl/transport.clj#L62" target="_blank">https://github.com/nrepl/nrepl/blob/f1ed475a0218852ad98899942e1865c75610c18a/src/clojure/nrepl/transport.clj#L62</a></z><z id="t1625062691" t="borkdude I think that can be safely replaced by (Class/forName &quot;[B&quot;)"><y>#</y><d>2021-06-30</d><h>14:18</h><w>borkdude</w>I think that can be safely replaced by <code>(Class/forName &quot;[B&quot;)</code></z><z id="t1625063498" t="bozhidar Yep, I&apos;m fairly sure you&apos;re right."><y>#</y><d>2021-06-30</d><h>14:31</h><w>bozhidar</w>Yep, I&apos;m fairly sure you&apos;re right.</z><z id="t1625063517" t="bozhidar I should have grepped first. ðŸ˜„"><y>#</y><d>2021-06-30</d><h>14:31</h><w>bozhidar</w>I should have grepped first. <b>ðŸ˜„</b></z><z id="t1625542522" t="zimablue Hi, I am connecting to the same nrepl server twice using socket-level connections (not Emacs-Cider). I&apos;m confused about how message routing works, messages send back which are seen in the first socket don&apos;t seem to be seen in the second, and ls-sessions returns an empty list (!?) even though the first session has successfully called clone"><y>#</y><d>2021-07-06</d><h>03:35</h><w>zimablue</w>Hi, I am connecting to the same nrepl server twice using socket-level connections (not Emacs-Cider). I&apos;m confused about how message routing works, messages send back which are seen in the first socket don&apos;t seem to be seen in the second, and ls-sessions returns an empty list (!?) even though the first session has successfully called clone</z><z id="t1625552376" t="zimablue trying more things, reading some docs and source code am i right that nrepl just doesn&apos;t do this? the &quot;concerto&quot; git repl/listed middleware seems to be trying to implement this"><y>#</y><d>2021-07-06</d><h>06:19</h><w>zimablue</w>trying more things, reading some docs and source code am i right that nrepl just doesn&apos;t do this? the &quot;concerto&quot; git repl/listed middleware seems to be trying to implement this</z><z id="t1632066344" t="devurandom Hi! I am trying to connect to an nREPL service created by someone else&apos;s software (Witchcraft plugin for Minecraft / Spigot) with Cursive 1.11.0, but I get this output when connecting: Connecting to remote nREPL server... =&gt; :clj =&gt; #&apos;cursive.repl.runtime/print-last-error =&gt; nil =&gt; #&apos;cursive.repl.runtime.class/class-defs Clojure 1.10.3 =&gt; nil =&gt; &quot;{:namespaces #{\&quot;refactor-nrepl.inlined-deps.rewrite-clj.v0v6v1.rewrite-clj.custom-zipper.core\&quot; [...] Something similar also happens when I enter commands into my REPL window. REPL-y on the other hand outputs: REPL-y 0.5.1, nREPL 0.8.3 Clojure 1.10.3 OpenJDK 64-Bit Server VM 16.0.2+7 reply.eval-modes.nrepl=&gt; WARNING: cat already refers to: #&apos;clojure.core/cat in namespace: net.cgrand.parsley.fold, being replaced by: #&apos;net.cgrand.parsley.fold/cat Exit: Control+D or (exit) or (quit) Commands: (user/help) Docs: (doc function-name-here) (find-doc &quot;part-of-name-here&quot;) Find by Name: (find-name &quot;part-of-name-here&quot;) Source: (source function-name-here) Javadoc: (javadoc java-object-or-class-here) Error loading namespace; falling back to user nil#object[clojure.lang.Namespace 0x3792b16b &quot;user&quot;]nil That looks a bit more &quot;normal&quot;. (Apart for the three strange outputs at the end.) Any idea what this is, or how to fix it?"><y>#</y><d>2021-09-19</d><h>15:45</h><w>devurandom</w>Hi! I am trying to connect to an nREPL service created by someone else&apos;s software (Witchcraft plugin for Minecraft / Spigot) with Cursive 1.11.0, but I get this output when connecting:
<pre>Connecting to remote nREPL server...
=&gt; :clj
=&gt; #&apos;cursive.repl.runtime/print-last-error
=&gt; nil
=&gt; #&apos;cursive.repl.runtime.class/class-defs
Clojure 1.10.3
=&gt; nil
=&gt;
&quot;{:namespaces #{\&quot;refactor-nrepl.inlined-deps.rewrite-clj.v0v6v1.rewrite-clj.custom-zipper.core\&quot;
[...]</pre>
Something similar also happens when I enter commands into my REPL window.

REPL-y on the other hand outputs:
<pre>REPL-y 0.5.1, nREPL 0.8.3
Clojure 1.10.3
OpenJDK 64-Bit Server VM 16.0.2+7
reply.eval-modes.nrepl=&gt; WARNING: cat already refers to: #&apos;clojure.core/cat in namespace: net.cgrand.parsley.fold, being replaced by: #&apos;net.cgrand.parsley.fold/cat
        Exit: Control+D or (exit) or (quit)
    Commands: (user/help)
        Docs: (doc function-name-here)
              (find-doc &quot;part-of-name-here&quot;)
Find by Name: (find-name &quot;part-of-name-here&quot;)
      Source: (source function-name-here)
     Javadoc: (javadoc java-object-or-class-here)

Error loading namespace; falling back to user

nil#object[clojure.lang.Namespace 0x3792b16b &quot;user&quot;]nil</pre>
That looks a bit more &quot;normal&quot;. (Apart for the three strange outputs at the end.)

Any idea what this is, or how to fix it?</z><z id="t1632148212" t="greg The second screen looks like an error when loading user namespace. Regarding the first one, if you are sure you made all steps correctly, I would report an issue on github: https://github.com/lambdaisland/witchcraft-plugin"><y>#</y><d>2021-09-20</d><h>14:30</h><r>greg</r>The second screen looks like an error when loading user namespace.

Regarding the first one, if you are sure you made all steps correctly, I would report an issue on github:
<a href="https://github.com/lambdaisland/witchcraft-plugin" target="_blank">https://github.com/lambdaisland/witchcraft-plugin</a></z><z id="t1632148227" t="greg Quote from README: &quot;Now you can connect with your nREPL-capable editor to port 25555 and start manipulating the game. If you get any errors at this stage please file "><y>#</y><d>2021-09-20</d><h>14:30</h><r>greg</r>Quote from README:
&quot;Now you can connect with your nREPL-capable editor to port 25555 and start manipulating the game. If you get any errors at this stage please file </z><z id="t1632226966" t="devurandom [:attrs {:href &quot;/_/_/users/U023TQF5FM3&quot;}] Thanks! I also got some support from [:attrs {:href &quot;/_/_/users/U0567Q30W&quot;}] (author of Cursive) in https://clojurians.slack.com/archives/C0744GXCJ/p1632066950143600 and [:attrs {:href &quot;/_/_/users/U07FP7QJ0&quot;}] (author of Witchcraft) in PMs. There are different hypothesis on what might cause this behaviour, one of which is that the message IDs of the nREPL responses might not match those of the requests. [:attrs {:href &quot;/_/_/users/U07FP7QJ0&quot;}] created https://github.com/lambdaisland/nrepl-proxy to help debug this on an nREPL message level. I will have a deeper look at the problem later this week. ðŸ™‚"><y>#</y><d>2021-09-21</d><h>12:22</h><r>devurandom</r><a>@U023TQF5FM3</a> Thanks!

I also got some support from <a>@U0567Q30W</a> (author of Cursive) in <a href="https://clojurians.slack.com/archives/C0744GXCJ/p1632066950143600" target="_blank">https://clojurians.slack.com/archives/C0744GXCJ/p1632066950143600</a> and <a>@U07FP7QJ0</a> (author of Witchcraft) in PMs. There are different hypothesis on what might cause this behaviour, one of which is that the message IDs of the nREPL responses might not match those of the requests. <a>@U07FP7QJ0</a> created <a href="https://github.com/lambdaisland/nrepl-proxy" target="_blank">https://github.com/lambdaisland/nrepl-proxy</a> to help debug this on an nREPL message level. I will have a deeper look at the problem later this week. <b>ðŸ™‚</b></z><z id="t1632289177" t="plexus Thanks for the help [:attrs {:href &quot;/_/_/users/U023TQF5FM3&quot;}] , we may have found a probable cause, I&apos;ve put out a fix."><y>#</y><d>2021-09-22</d><h>05:39</h><r>plexus</r>Thanks for the help <a>@U023TQF5FM3</a>, we may have found a probable cause, I&apos;ve put out a fix.</z><z id="t1632354634" t="greg You have done all the heavy lifting [:attrs {:href &quot;/_/_/users/U07FP7QJ0&quot;}] [:attrs {:href &quot;/_/_/users/U0567Q30W&quot;}] [:attrs {:href &quot;/_/_/users/U368JQA01&quot;}] ðŸ‘ ðŸ‘ ðŸ‘"><y>#</y><d>2021-09-22</d><h>23:50</h><r>greg</r>You have done all the heavy lifting <a>@U07FP7QJ0</a> <a>@U0567Q30W</a> <a>@U368JQA01</a> <b>ðŸ‘</b><b>ðŸ‘</b><b>ðŸ‘</b></z><z id="t1632424696" t="devurandom Thanks,Â  [:attrs {:href &quot;/_/_/users/U07FP7QJ0&quot;}] !Â  https://github.com/lambdaisland/witchcraft/commit/5bdb56a17a17d630fbca66167fff50cda275f59b Â fixed the issue with Cursive. ðŸ™‚"><y>#</y><d>2021-09-23</d><h>19:18</h><r>devurandom</r>Thanks,Â <a>@U07FP7QJ0</a>!Â <a href="https://github.com/lambdaisland/witchcraft/commit/5bdb56a17a17d630fbca66167fff50cda275f59b" target="_blank">https://github.com/lambdaisland/witchcraft/commit/5bdb56a17a17d630fbca66167fff50cda275f59b</a>Â fixed the issue with Cursive. <b>ðŸ™‚</b></z><z id="t1632296710" t="devurandom Hi! I just learnt that :status :done does not mean that all responses were sent (the message it is attached to being the final message) and different implementations and services use or handle it differently. Can someone explain what :done should be used for? What information does it actually convey? The docs say: &gt; :status Â The status of the response. Here there would either be something like &quot;done&quot; if a request has been fully processed [...] If some request generated multiple response messages only the final one would have the status attached to it. Should this be clarified? What exactly does &quot;fully processed&quot; mean?"><y>#</y><d>2021-09-22</d><h>07:45</h><w>devurandom</w>Hi!

I just learnt that <code>:status</code> <code>:done</code> does not mean that all responses were sent (the message it is attached to being the final message) and different implementations and services use or handle it differently.

Can someone explain what <code>:done</code> should be used for? What information does it actually convey?

The docs say:

&gt; <code>:status</code>Â The status of the response. Here there would either be something like &quot;done&quot; if a request has been fully processed [...] If some request generated multiple response messages only the final one would have the status attached to it.
Should this be clarified? What exactly does &quot;fully processed&quot; mean?</z><z id="t1632297173" t="devurandom Different topic: The only documentation of the session&apos;s metadata :exec key I could find was indirectly via https://cljdoc.org/d/nrepl/nrepl/0.9.0-beta2/api/nrepl.middleware.session#session-exec Is there a better documentation / documentation of the actual session metadata map?"><y>#</y><d>2021-09-22</d><h>07:52</h><w>devurandom</w>Different topic: The only documentation of the session&apos;s metadata <code>:exec</code> key I could find was indirectly via <a href="https://cljdoc.org/d/nrepl/nrepl/0.9.0-beta2/api/nrepl.middleware.session#session-exec" target="_blank">https://cljdoc.org/d/nrepl/nrepl/0.9.0-beta2/api/nrepl.middleware.session#session-exec</a>

Is there a better documentation / documentation of the actual session metadata map?</z><z id="t1632451225" t="Eddie My project depends on nrepl 0.8.3 using clojars coordinates, and it starts a server. When I assemble the project into an uberjar I get the following exception: Caused by: java.lang.ClassNotFoundException: nrepl.QuotaExceeded . I confirmed that my uberjar contains the nrepl classes, but it seems to be missing just the one QuotaExceeded class. I noticed that it is a Java class in the nrepl project. Is it pre-compiled in the library jar on clojars? If no, how should nrepl be packaged into uberjars?"><y>#</y><d>2021-09-24</d><h>02:40</h><w>Eddie</w>My project depends on nrepl 0.8.3 using clojars coordinates, and it starts a server. When I assemble the project into an uberjar I get the following exception: <code>Caused by: java.lang.ClassNotFoundException: nrepl.QuotaExceeded</code>. I confirmed that my uberjar contains the nrepl classes, but it seems to be missing just the one <code>QuotaExceeded</code> class. I noticed that it is a Java class in the nrepl project. Is it pre-compiled in the library jar on clojars? If no, how should nrepl be
packaged into uberjars?</z><z id="t1632755532" t="plexus You&apos;ll have to make sure the uberjaring tool you&apos;re using includes the QuotaExceeded.class file âžœ unzip -l /home/arne/.m2/repository/nrepl/nrepl/0.8.3/nrepl-0.8.3.jar | grep Quota 209 2020-10-25 11:25 nrepl/QuotaExceeded.class 66 2020-09-23 08:43 nrepl/QuotaExceeded.java "><y>#</y><d>2021-09-27</d><h>15:12</h><r>plexus</r>You&apos;ll have to make sure the uberjaring tool you&apos;re using includes the <code>QuotaExceeded.class</code> file
<pre>âžœ unzip -l /home/arne/.m2/repository/nrepl/nrepl/0.8.3/nrepl-0.8.3.jar | grep Quota
      209  2020-10-25 11:25   nrepl/QuotaExceeded.class
       66  2020-09-23 08:43   nrepl/QuotaExceeded.java</pre>
</z><z id="t1632594201" t="Luis Santos Hi everyone, I&apos;m currently using nrepl with cider and would like to run a clojure function every time a s-exp is evaluated. I&apos;m working on a cljfx project and I&apos;m trying to get my scene reloaded every time a function is re-evaluated. Does anyone knows where to start? Do I need to build a middleware or is there any to add a hook to my user.clj? Thanks"><y>#</y><d>2021-09-25</d><h>18:23</h><w>Luis Santos</w>Hi everyone,
I&apos;m currently using nrepl with cider and would like to run a clojure function every time a s-exp is evaluated.
I&apos;m working on a cljfx project and I&apos;m trying to get my scene reloaded every time a function is re-evaluated.
Does anyone knows where to start? Do I need to build a middleware or is there any to add a hook to my user.clj?
Thanks</z><z id="t1632600009" t="dominicm [:attrs {:href &quot;/_/_/users/UK00KCK6D&quot;}] a hook is what you&apos;re after I think!"><y>#</y><d>2021-09-25</d><h>20:00</h><w>dominicm</w><a>@luis559</a> a hook is what you&apos;re after I think!</z><z id="t1632600797" t="Luis Santos Thanks [:attrs {:href &quot;/_/_/users/U09LZR36F&quot;}] . What hook should I use? Is it an emacs/cider hook or a nrepl client hook or cider-nrepl client hook? Sorry I&apos;m new to the clojure ecosystem and I have to confess I don&apos;t know how all the pieces work."><y>#</y><d>2021-09-25</d><h>20:13</h><r>Luis Santos</r>Thanks <a>@U09LZR36F</a>. What hook should I use?
Is it an emacs/cider hook or a nrepl client hook or cider-nrepl client hook?
Sorry I&apos;m new to the clojure ecosystem and I have to confess I don&apos;t know how all the pieces work.</z><z id="t1632690137" t="dominicm Sorry, I was not 100% when I sent this. A middleware is what I meant to say facepalm"><y>#</y><d>2021-09-26</d><h>21:02</h><r>dominicm</r>Sorry, I was not 100% when I sent this.  A middleware is what I meant to say <b>facepalm</b></z><z id="t1632690212" t="dominicm A good example to start from is probably https://github.com/RickMoynihan/nrebl.middleware which does something similar to what you want - running a function after evaluation."><y>#</y><d>2021-09-26</d><h>21:03</h><r>dominicm</r>A good example to start from is probably <a href="https://github.com/RickMoynihan/nrebl.middleware" target="_blank">https://github.com/RickMoynihan/nrebl.middleware</a> which does something similar to what you want - running a function after evaluation.</z><z id="t1632690276" t="dominicm Hmm, actually that doesn&apos;t work how I expected. Lemme see if I can find you a better example."><y>#</y><d>2021-09-26</d><h>21:04</h><r>dominicm</r>Hmm, actually that doesn&apos;t work how I expected.  Lemme see if I can find you a better example.</z><z id="t1632690527" t="dominicm https://github.com/vvvvalvalval/scope-capture-nrepl is a pretty close example, but not quite what you&apos;re trying to do either. This middleware wraps eval/load-file so that when you call them, the code is wrapped by the library. But instead you just want to call the handler, then run your result, something like: (let [result (apply handler args)] (reload-cljfx!) result) "><y>#</y><d>2021-09-26</d><h>21:08</h><r>dominicm</r><a href="https://github.com/vvvvalvalval/scope-capture-nrepl" target="_blank">https://github.com/vvvvalvalval/scope-capture-nrepl</a> is a pretty close example, but not quite what you&apos;re trying to do either.

This middleware wraps eval/load-file so that when you call them, the code is wrapped by the library.  But instead you just want to call the handler, then run your result, something like:

<pre>(let [result (apply handler args)]
  (reload-cljfx!)
  result)</pre>
</z><z id="t1632734200" t="Luis Santos Thanks [:attrs {:href &quot;/_/_/users/U09LZR36F&quot;}] . This sounds a great start point. I will have a look. thanks3"><y>#</y><d>2021-09-27</d><h>09:16</h><r>Luis Santos</r>Thanks <a>@U09LZR36F</a>. This sounds a great start point. I will have a look. <b>thanks3</b></z><z id="t1632846972" t="pez Whatâ€™s the requirements for java source lookup working? It just works on my machine, but some Calva users do not get it working. I know there was somewhere when they stopped bundling the source with the JDKs, but I also saw in the cider-nrepl source (I think it was) that there is a fallback looking up source online."><y>#</y><d>2021-09-28</d><h>16:36</h><w>pez</w>Whatâ€™s the requirements for java source lookup working? It just works on my machine, but some Calva users do not get it working. I know there was somewhere when they stopped bundling the source with the JDKs, but I also saw in the cider-nrepl source (I think it was) that there is a fallback looking up source online.</z><z id="t1632857909" t="Eugen [:attrs {:href &quot;/_/_/users/U0ETXRFEW&quot;}] : Do you have any logging those people can report easily? For cases where there is no JVM source - is there some info panel in Calva that users can report - or a command they can run to say: with source /witout source ?!"><y>#</y><d>2021-09-28</d><h>19:38</h><w>Eugen</w><a>@pez</a>: Do you have any logging those people can report easily?
For cases where there is no JVM source - is there some info panel in Calva that users can report - or a command they can run to say: with source /witout source ?!</z><z id="t1632858221" t="pez I havenâ€™t got much of that. Weâ€™ll add an nrepl trace log inspired by CIDERâ€™s, which I think will help some."><y>#</y><d>2021-09-28</d><h>19:43</h><w>pez</w>I havenâ€™t got much of that. Weâ€™ll add an nrepl trace log inspired by CIDERâ€™s, which I think will help some.</z><z id="t1632953293" t="borkdude Got an nREPL working for #nbb : https://twitter.com/borkdude/status/1443309918564519939 More details here: https://github.com/borkdude/nbb/issues/13#issuecomment-930512258 Hopefully release later this week(end) :)"><y>#</y><d>2021-09-29</d><h>22:08</h><w>borkdude</w>Got an nREPL working for #nbb :

<a href="https://twitter.com/borkdude/status/1443309918564519939" target="_blank">https://twitter.com/borkdude/status/1443309918564519939</a>

More details here:

<a href="https://github.com/borkdude/nbb/issues/13#issuecomment-930512258" target="_blank">https://github.com/borkdude/nbb/issues/13#issuecomment-930512258</a>

Hopefully release later this week(end) :)</z><z id="t1632953330" t="borkdude Most of the work had already been done by [:attrs {:href &quot;/_/_/users/U06QSF3BK&quot;}] ,but need to make specific changes for nbb"><y>#</y><d>2021-09-29</d><h>22:08</h><w>borkdude</w>Most of the work had already been done by <a>@viesti</a>,but need to make specific changes for nbb</z><z id="t1633001061" t="thom Does anyone know if it&apos;s possible to prevent nrepl-refactor from eagerly calling warm-ast-cache on REPL startup?"><y>#</y><d>2021-09-30</d><h>11:24</h><w>thom</w>Does anyone know if it&apos;s possible to prevent nrepl-refactor from eagerly calling warm-ast-cache on REPL startup?</z><z id="t1633001964" t="vemv do you use clj-refactor.el?"><y>#</y><d>2021-09-30</d><h>11:39</h><r>vemv</r>do you use clj-refactor.el?</z><z id="t1633001989" t="thom I do"><y>#</y><d>2021-09-30</d><h>11:39</h><r>thom</r>I do</z><z id="t1633002214" t="vemv It&apos;s https://github.com/clojure-emacs/clj-refactor.el/blob/466822ff6f9da584f7cf72c868017b8840574dbd/clj-refactor.el#L161 then :)"><y>#</y><d>2021-09-30</d><h>11:43</h><r>vemv</r>It&apos;s <a href="https://github.com/clojure-emacs/clj-refactor.el/blob/466822ff6f9da584f7cf72c868017b8840574dbd/clj-refactor.el#L161" target="_blank">https://github.com/clojure-emacs/clj-refactor.el/blob/466822ff6f9da584f7cf72c868017b8840574dbd/clj-refactor.el#L161</a> then :)</z><z id="t1633002236" t="thom brilliant, thanks!"><y>#</y><d>2021-09-30</d><h>11:43</h><r>thom</r>brilliant, thanks!</z><z id="t1633002459" t="thom okay wonderful, this fixes my underlying issue which was that I&apos;m working on a JavaFX app and loading everything causes JavaFX to initialise and start its internal thread and generally cause havoc in my REPL. Thanks all!"><y>#</y><d>2021-09-30</d><h>11:47</h><r>thom</r>okay wonderful, this fixes my underlying issue which was that I&apos;m working on a JavaFX app and loading everything causes JavaFX to initialise and start its internal thread and generally cause havoc in my REPL. Thanks all!</z><z id="t1633002557" t="vemv Nice! btw, if you use https://clojars.org/refactor-nrepl/refactor-nrepl latest (i.e. the alphas you can see there), you&apos;ll see better performance, more accuracy, less extraneous code being evaluated, etc."><y>#</y><d>2021-09-30</d><h>11:49</h><r>vemv</r>Nice!

btw, if you use <a href="https://clojars.org/refactor-nrepl/refactor-nrepl" target="_blank">https://clojars.org/refactor-nrepl/refactor-nrepl</a> latest (i.e. the alphas you can see there), you&apos;ll see better performance, more accuracy, less extraneous code being evaluated, etc.</z><z id="t1633001828" t="bozhidar [:attrs {:href &quot;/_/_/users/UTF99QP7V&quot;}] I think there was some flag for this, but I don&apos;t recall how was it named. [:attrs {:href &quot;/_/_/users/U45T93RA6&quot;}] might know better."><y>#</y><d>2021-09-30</d><h>11:37</h><w>bozhidar</w><a>@thom704</a> I think there was some flag for this, but I don&apos;t recall how was it named. <a>@vemv</a> might know better.</z><z id="t1633083554" t="borkdude [:attrs {:href &quot;/_/_/users/U051BLM8F&quot;}] Hey. I released #nbb v0.0.82. nbb nrepl-server :port 1337 works when you connect with lein repl :connect 1337 $ lein repl :connect 1337 Connecting to nREPL at 127.0.0.1:1337 Could not resolve symbol: nrepl.core/versionniluser=&gt; nil user=&gt; (require &apos;[&quot;fs&quot; :as fs]) nil user=&gt; (fs/existsSync &quot;README.md&quot;) false user=&gt; (js/process.cwd) &quot;/private/tmp&quot;"><y>#</y><d>2021-10-01</d><h>10:19</h><w>borkdude</w><a>@bozhidar</a> Hey. I released #nbb v0.0.82.
<pre>nbb nrepl-server :port 1337</pre>
works when you connect with <code>lein repl :connect 1337</code>
<pre>$ lein repl :connect 1337
Connecting to nREPL at 127.0.0.1:1337
Could not resolve symbol: nrepl.core/versionniluser=&gt;
nil
user=&gt; (require &apos;[&quot;fs&quot; :as fs])
nil
user=&gt; (fs/existsSync &quot;README.md&quot;)
false
user=&gt; (js/process.cwd)
&quot;/private/tmp&quot;</pre></z><z id="t1633083571" t="borkdude But unfortunately it doesn&apos;t work with CIDER yet."><y>#</y><d>2021-10-01</d><h>10:19</h><w>borkdude</w>But unfortunately it doesn&apos;t work with CIDER yet.</z><z id="t1633083637" t="bozhidar Great progress! Thanks for letting me know."><y>#</y><d>2021-10-01</d><h>10:20</h><w>bozhidar</w>Great progress! Thanks for letting me know.</z><z id="t1633093723" t="borkdude [:attrs {:href &quot;/_/_/users/U051BLM8F&quot;}] somehow when I cider-connect to the server, I get: It also seems to try System/getProperty which isn&apos;t available. Should I try something else?"><y>#</y><d>2021-10-01</d><h>13:08</h><w>borkdude</w><a>@bozhidar</a> somehow when I <code>cider-connect</code> to the server, I get:
It also seems to try <code>System/getProperty</code> which isn&apos;t available. Should I try something else?</z><z id="t1633093820" t="borkdude I can try cider-connect-cljs custom"><y>#</y><d>2021-10-01</d><h>13:10</h><w>borkdude</w>I can try <code>cider-connect-cljs custom</code></z><z id="t1633093851" t="bozhidar I guessing that&apos;s for the welcome prompt."><y>#</y><d>2021-10-01</d><h>13:10</h><w>bozhidar</w>I guessing that&apos;s for the welcome prompt.</z><z id="t1633093874" t="bozhidar Let me check."><y>#</y><d>2021-10-01</d><h>13:11</h><w>bozhidar</w>Let me check.</z><z id="t1633093947" t="bozhidar Ah, no. That&apos;s for the classpath. I guess we should make this conditional or something, as I doubt the classpath makes sense in nodejs."><y>#</y><d>2021-10-01</d><h>13:12</h><w>bozhidar</w>Ah, no. That&apos;s for the classpath. I guess we should make this conditional or something, as I doubt the classpath makes sense in nodejs.</z><z id="t1633093999" t="borkdude nbb does have a classpath but it&apos;s more like CLJS (without the JVM, let&apos;s say self-hosted) than anything else"><y>#</y><d>2021-10-01</d><h>13:13</h><w>borkdude</w>nbb does have a classpath but it&apos;s more like CLJS (without the JVM, let&apos;s say self-hosted) than anything else</z><z id="t1633094091" t="borkdude did lumo support nREPL?"><y>#</y><d>2021-10-01</d><h>13:14</h><w>borkdude</w>did lumo support nREPL?</z><z id="t1633094097" t="borkdude it doesn&apos;t seem so but the use case would be similar"><y>#</y><d>2021-10-01</d><h>13:14</h><w>borkdude</w>it doesn&apos;t seem so but the use case would be similar</z><z id="t1633094268" t="borkdude ( [:attrs {:href &quot;/_/_/users/U06QSF3BK&quot;}] had you tested your work with CIDER?)"><y>#</y><d>2021-10-01</d><h>13:17</h><w>borkdude</w>(<a>@viesti</a> had you tested your work with CIDER?)</z><z id="t1633094292" t="viesti I think I did, made some hacks to please it a bit ðŸ™‚"><y>#</y><d>2021-10-01</d><h>13:18</h><w>viesti</w>I think I did, made some hacks to please it a bit <b>ðŸ™‚</b></z><z id="t1633094347" t="viesti something like this: https://github.com/viesti/nrepl-cljs-sci/commit/f172d5f7898be844d7434b2972cfb063a116cf33#diff-6d49d64b8894e5627407513f159ee5dd92efd3897361dc0a673e567540c27a03"><y>#</y><d>2021-10-01</d><h>13:19</h><w>viesti</w>something like this: <a href="https://github.com/viesti/nrepl-cljs-sci/commit/f172d5f7898be844d7434b2972cfb063a116cf33#diff-6d49d64b8894e5627407513f159ee5dd92efd3897361dc0a673e567540c27a03" target="_blank">https://github.com/viesti/nrepl-cljs-sci/commit/f172d5f7898be844d7434b2972cfb063a116cf33#diff-6d49d64b8894e5627407513f159ee5dd92efd3897361dc0a673e567540c27a03</a></z><z id="t1633094372" t="borkdude ooooh uuugh ;)"><y>#</y><d>2021-10-01</d><h>13:19</h><w>borkdude</w>ooooh uuugh ;)</z><z id="t1633094376" t="viesti yeah ðŸ™‚"><y>#</y><d>2021-10-01</d><h>13:19</h><w>viesti</w>yeah <b>ðŸ™‚</b></z><z id="t1633094393" t="viesti trying out different nrepl clients, they spew interesting things at the server ðŸ˜„"><y>#</y><d>2021-10-01</d><h>13:19</h><w>viesti</w>trying out different nrepl clients, they spew interesting things at the server <b>ðŸ˜„</b></z><z id="t1633094415" t="viesti like reply, which is in leinigen, sends the completion functionality on connect"><y>#</y><d>2021-10-01</d><h>13:20</h><w>viesti</w>like reply, which is in leinigen, sends the completion functionality on connect</z><z id="t1633094428" t="borkdude yeah, but it does work after that"><y>#</y><d>2021-10-01</d><h>13:20</h><w>borkdude</w>yeah, but it does work after that</z><z id="t1633094433" t="viesti yup"><y>#</y><d>2021-10-01</d><h>13:20</h><w>viesti</w>yup</z><z id="t1633094439" t="viesti just that you get some amount of errors"><y>#</y><d>2021-10-01</d><h>13:20</h><w>viesti</w>just that you get some amount of errors</z><z id="t1633094447" t="borkdude I think CIDER tries to see what kind of environment it deals with using System"><y>#</y><d>2021-10-01</d><h>13:20</h><w>borkdude</w>I think CIDER tries to see what kind of environment it deals with using <code>System</code></z><z id="t1633100039" t="bozhidar I think the environment is detected via the version op."><y>#</y><d>2021-10-01</d><h>14:53</h><r>bozhidar</r>I think the environment is detected via the <code>version</code> op.</z><z id="t1633100082" t="bozhidar My bad - via describe , as it returns versions ."><y>#</y><d>2021-10-01</d><h>14:54</h><r>bozhidar</r>My bad - via <code>describe</code>, as it returns <code>versions</code>.</z><z id="t1633094456" t="viesti that &quot;lisp expression&quot; probably cause by cider sending stuff to eval which then throws"><y>#</y><d>2021-10-01</d><h>13:20</h><w>viesti</w>that &quot;lisp expression&quot; probably cause by cider sending stuff to eval which then throws</z><z id="t1633094457" t="borkdude trench worked pretty well so far btw"><y>#</y><d>2021-10-01</d><h>13:20</h><w>borkdude</w><code>trench</code> worked pretty well so far btw</z><z id="t1633094466" t="viesti and cider not too prepared that something goes wrong"><y>#</y><d>2021-10-01</d><h>13:21</h><w>viesti</w>and cider not too prepared that something goes wrong</z><z id="t1633094489" t="viesti yup, trench more &quot;friendly&quot; to non-java nrepl servers ðŸ™‚"><y>#</y><d>2021-10-01</d><h>13:21</h><w>viesti</w>yup, trench more &quot;friendly&quot; to non-java nrepl servers <b>ðŸ™‚</b></z><z id="t1633094517" t="viesti don&apos;t actually know if there should be (maybe should bad word) a kind of &quot;handshake&quot;"><y>#</y><d>2021-10-01</d><h>13:21</h><w>viesti</w>don&apos;t actually know if there should be (maybe should bad word) a kind of &quot;handshake&quot;</z><z id="t1633094531" t="viesti server: &quot;Hi, server here, I&apos;m on JVM&quot; client: &quot;Oh nice, let me check your classpath&quot;"><y>#</y><d>2021-10-01</d><h>13:22</h><w>viesti</w>server: &quot;Hi, server here, I&apos;m on JVM&quot;
client: &quot;Oh nice, let me check your classpath&quot;</z><z id="t1633094662" t="borkdude well, nbb has a classpath too, just not the System stuff"><y>#</y><d>2021-10-01</d><h>13:24</h><w>borkdude</w>well, nbb has a classpath too, just not the System stuff</z><z id="t1633094673" t="borkdude and probably also a different API around it"><y>#</y><d>2021-10-01</d><h>13:24</h><w>borkdude</w>and probably also a different API around it</z><z id="t1633094810" t="borkdude I pushed nbb v0.0.83 with a small fix: noticed (require &apos;cljs.core) was done which it failed on, this should work now"><y>#</y><d>2021-10-01</d><h>13:26</h><w>borkdude</w>I pushed nbb v0.0.83 with a small fix: noticed <code>(require &apos;cljs.core)</code> was done which it failed on, this should work now</z><z id="t1633094845" t="borkdude hmm, crap that particular one doesn&apos;t. just a minute"><y>#</y><d>2021-10-01</d><h>13:27</h><w>borkdude</w>hmm, crap that particular one doesn&apos;t. just a minute</z><z id="t1633095012" t="viesti oh wau now just realised that this discussion is on #nrepl channel ðŸ˜„"><y>#</y><d>2021-10-01</d><h>13:30</h><w>viesti</w>oh wau now just realised that this discussion is on #nrepl channel <b>ðŸ˜„</b></z><z id="t1633095035" t="borkdude well, the topic is nrepl isn&apos;t it? ;)"><y>#</y><d>2021-10-01</d><h>13:30</h><w>borkdude</w>well, the topic is nrepl isn&apos;t it? ;)</z><z id="t1633095039" t="viesti hope bozhidar didn&apos;t get angry on the hacks I did ðŸ˜„"><y>#</y><d>2021-10-01</d><h>13:30</h><w>viesti</w>hope bozhidar didn&apos;t get angry on the hacks I did <b>ðŸ˜„</b></z><z id="t1633095045" t="viesti yeah, just typed away"><y>#</y><d>2021-10-01</d><h>13:30</h><w>viesti</w>yeah, just typed away</z><z id="t1633095049" t="viesti anyway, neat things"><y>#</y><d>2021-10-01</d><h>13:30</h><w>viesti</w>anyway, neat things</z><z id="t1633095059" t="borkdude I think he is used to greater hack to make nrepl work... is my guess :)"><y>#</y><d>2021-10-01</d><h>13:30</h><w>borkdude</w>I think he is used to greater hack to make nrepl work... is my guess :)</z><z id="t1633095066" t="viesti yup ðŸ™‚"><y>#</y><d>2021-10-01</d><h>13:31</h><w>viesti</w>yup <b>ðŸ™‚</b></z><z id="t1633095109" t="borkdude We can go into a thread however about #nbb and nrepl. ðŸ§µ"><y>#</y><d>2021-10-01</d><h>13:31</h><w>borkdude</w>We can go into a thread however about #nbb and nrepl. <b>ðŸ§µ</b></z><z id="t1633095188" t="borkdude Yes, the babashka nrepl works great with CIDER but there was also some ironing out of details that went on there"><y>#</y><d>2021-10-01</d><h>13:33</h><r>borkdude</r>Yes, the babashka nrepl works great with CIDER but there was also some ironing out of details that went on there</z><z id="t1633095197" t="viesti right"><y>#</y><d>2021-10-01</d><h>13:33</h><r>viesti</r>right</z><z id="t1633095258" t="borkdude [:attrs {:href &quot;/_/_/users/U051BLM8F&quot;}] So with cider-connect-cljs custom I do get a REPL buffer that works. Just the part of sending an expr to the REPL buffer doesn&apos;t work"><y>#</y><d>2021-10-01</d><h>13:34</h><r>borkdude</r><a>@bozhidar</a> So with <code>cider-connect-cljs custom</code> I do get a REPL buffer that works. Just the part of sending an expr to the REPL buffer doesn&apos;t work</z><z id="t1633095455" t="viesti I wonder if there could be a way to &quot;negotiate&quot; what the nrepl server we&apos;r connecting to actually is. But I guess cider-connect-cljs close to what a sci over node would be"><y>#</y><d>2021-10-01</d><h>13:37</h><r>viesti</r>I wonder if there could be a way to &quot;negotiate&quot; what the nrepl server we&apos;r connecting to actually is. But I guess <code>cider-connect-cljs</code> close to what a sci over node would be</z><z id="t1633095488" t="viesti I remember trying cider-connect-cljs custom too, but I don&apos;t now remember what the problem was"><y>#</y><d>2021-10-01</d><h>13:38</h><r>viesti</r>I remember trying <code>cider-connect-cljs custom</code> too, but I don&apos;t now remember what the problem was</z><z id="t1633095536" t="viesti probably tries to send some preamble that then fails to eval and cider is left wondering what happened"><y>#</y><d>2021-10-01</d><h>13:38</h><r>viesti</r>probably tries to send some preamble that then fails to eval and cider is left wondering what happened</z><z id="t1633095856" t="borkdude We are charting new territory here as lumo didn&apos;t even have an nREPL. I hope [:attrs {:href &quot;/_/_/users/U051BLM8F&quot;}] will be open to helping us out to get this thing in the air :)."><y>#</y><d>2021-10-01</d><h>13:44</h><r>borkdude</r>We are charting new territory here as lumo didn&apos;t even have an nREPL. I hope <a>@bozhidar</a> will be open to helping us out to get this thing in the air :).</z><z id="t1633100263" t="bozhidar Well, as long as we don&apos;t even some Clojure code from CIDER we should be good. It will require a bit more work than for Babashka, but I don&apos;t expect it will be hard to accommodate nbb."><y>#</y><d>2021-10-01</d><h>14:57</h><r>bozhidar</r>Well, as long as we don&apos;t even some Clojure code from CIDER we should be good. It will require a bit more work than for Babashka, but I don&apos;t expect it will be hard to accommodate nbb.</z><z id="t1633095117" t="viesti I don&apos;t remember how I checked babashka nrepl server"><y>#</y><d>2021-10-01</d><h>13:31</h><w>viesti</w>I don&apos;t remember how I checked babashka nrepl server</z><z id="t1633095148" t="viesti just had cider connection to it a minute ago, cider seems not to panick with it"><y>#</y><d>2021-10-01</d><h>13:32</h><w>viesti</w>just had cider connection to it a minute ago, cider seems not to panick with it</z><z id="t1633100183" t="bozhidar We need similar code in CIDER for nbb :"><y>#</y><d>2021-10-01</d><h>14:56</h><w>bozhidar</w>We need similar code in CIDER for <code>nbb</code>:</z><z id="t1633100185" t="bozhidar (defun cider--babashka-version () &quot;Retrieve the underlying connection&apos;s Babashka version.&quot; (with-current-buffer (cider-current-repl) (when nrepl-versions (nrepl-dict-get nrepl-versions &quot;babashka&quot;)))) (defun cider--babashka-nrepl-version () &quot;Retrieve the underlying connection&apos;s babashka.nrepl version.&quot; (with-current-buffer (cider-current-repl) (when nrepl-versions (nrepl-dict-get nrepl-versions &quot;babashka.nrepl&quot;)))) (defun cider-runtime () &quot;Return the runtime of the nREPl server.&quot; (cond ((cider--clojure-version) &apos;clojure) ((cider--babashka-version) &apos;babashka) (t &apos;generic)))"><y>#</y><d>2021-10-01</d><h>14:56</h><w>bozhidar</w><pre>(defun cider--babashka-version ()
  &quot;Retrieve the underlying connection&apos;s Babashka version.&quot;
  (with-current-buffer (cider-current-repl)
    (when nrepl-versions
      (nrepl-dict-get nrepl-versions &quot;babashka&quot;))))

(defun cider--babashka-nrepl-version ()
  &quot;Retrieve the underlying connection&apos;s babashka.nrepl version.&quot;
  (with-current-buffer (cider-current-repl)
    (when nrepl-versions
      (nrepl-dict-get nrepl-versions &quot;babashka.nrepl&quot;))))

(defun cider-runtime ()
  &quot;Return the runtime of the nREPl server.&quot;
  (cond
   ((cider--clojure-version) &apos;clojure)
   ((cider--babashka-version) &apos;babashka)
   (t &apos;generic)))</pre></z><z id="t1633100191" t="bozhidar Should be relatively simple IMO."><y>#</y><d>2021-10-01</d><h>14:56</h><w>bozhidar</w>Should be relatively simple IMO.</z><z id="t1633103932" t="viesti aah, neat!"><y>#</y><d>2021-10-01</d><h>15:58</h><w>viesti</w>aah, neat!</z><z id="t1633103961" t="viesti now I feel dumb not asking this earlier ðŸ˜„"><y>#</y><d>2021-10-01</d><h>15:59</h><w>viesti</w>now I feel dumb not asking this earlier <b>ðŸ˜„</b></z><z id="t1633123587" t="borkdude I found out that evaluation for #nbb works fine in a .clj buffer but just not in a .cljs buffer"><y>#</y><d>2021-10-01</d><h>21:26</h><w>borkdude</w>I found out that evaluation for #nbb works fine in a <code>.clj</code> buffer but just not in a <code>.cljs</code> buffer</z><z id="t1633123609" t="borkdude Actually both for #calva and CIDER/emacs"><y>#</y><d>2021-10-01</d><h>21:26</h><w>borkdude</w>Actually both for #calva and CIDER/emacs</z><z id="t1633125162" t="borkdude To get things rolling, I posted an issue here: https://github.com/clojure-emacs/cider/issues/3061"><y>#</y><d>2021-10-01</d><h>21:52</h><w>borkdude</w>To get things rolling, I posted an issue here: <a href="https://github.com/clojure-emacs/cider/issues/3061" target="_blank">https://github.com/clojure-emacs/cider/issues/3061</a></z><z id="t1633173818" t="borkdude Good news in nrepl land! #calva can talk to the #nbb nrepl server now! https://twitter.com/borkdude/status/1444260438007484428"><y>#</y><d>2021-10-02</d><h>11:23</h><w>borkdude</w>Good news in nrepl land! #calva can talk to the #nbb nrepl server now!
<a href="https://twitter.com/borkdude/status/1444260438007484428" target="_blank">https://twitter.com/borkdude/status/1444260438007484428</a></z><z id="t1633174521" t="pez The really good news is the cljs nrepl server! Tripped Calva assumptions up something bad, but we&apos;ll fix those. "><y>#</y><d>2021-10-02</d><h>11:35</h><w>pez</w>The really good news is the cljs nrepl server! Tripped Calva assumptions up something bad, but we&apos;ll fix those. </z><z id="t1633259086" t="bozhidar I&apos;ll be traveling without a computer for a couple of weeks, but I hope someone will do the necessary changes to Cider in my absence. If not - I&apos;ll tackle this when I&apos;m back. "><y>#</y><d>2021-10-03</d><h>11:04</h><w>bozhidar</w>I&apos;ll be traveling without a computer for a couple of weeks, but I hope someone will do the necessary changes to Cider in my absence. If not - I&apos;ll tackle this when I&apos;m back. </z><z id="t1633673462" t="pez How would I go about loading cider-nrepl after the fact on an nrepl server?"><y>#</y><d>2021-10-08</d><h>06:11</h><w>pez</w>How would I go about loading cider-nrepl after the fact on an nrepl server?</z><z id="t1633674381" t="pez Well, I found this. https://github.com/clojure-emacs/cider/pull/3044/files I think Iâ€™m good for now. ðŸ˜ƒ"><y>#</y><d>2021-10-08</d><h>06:26</h><r>pez</r>Well, I found this. <a href="https://github.com/clojure-emacs/cider/pull/3044/files" target="_blank">https://github.com/clojure-emacs/cider/pull/3044/files</a> I think Iâ€™m good for now. <b>ðŸ˜ƒ</b></z><z id="t1634063945" t="Rostislav Svoboda For the record, I got hit by Could not locate nrepl/cmdline__init.class, nrepl/cmdline.clj or nrepl/cmdline.cljc on classpath. (very similar to https://clojurians-log.clojureverse.org/nrepl/2020-12-07/1607330971.064100 ). [:attrs {:href &quot;/_/_/users/U0BBFDED7&quot;}] I my case removing $HOME/.m2 and(!) logout/login on my Ubuntu-Linux solved the problem. And no java or clojure process was running. Hmm, strange."><y>#</y><d>2021-10-12</d><h>18:39</h><w>Rostislav Svoboda</w>For the record, I got hit by
<pre>Could not locate nrepl/cmdline__init.class, nrepl/cmdline.clj or nrepl/cmdline.cljc on classpath.</pre>
(very similar to <a href="https://clojurians-log.clojureverse.org/nrepl/2020-12-07/1607330971.064100" target="_blank">https://clojurians-log.clojureverse.org/nrepl/2020-12-07/1607330971.064100</a>).
<a>@huxley</a> I my case removing <code>$HOME/.m2</code> and(!) logout/login on my Ubuntu-Linux solved the problem. And no java or clojure process was running. Hmm, strange.</z><z id="t1634075674" t="Rostislav Svoboda But a clj process was running! Grrrh"><y>#</y><d>2021-10-12</d><h>21:54</h><r>Rostislav Svoboda</r>But a clj process was running! Grrrh</z></g><g id="s9"><z id="t1634373476" t="dominicm I&apos;m just doing some profiling in vim, and a lot of time goes to finding the completion context. How are other editors doing this fast? I&apos;m considering whether I should just send the whole buffer or the last 400/next 400 lines or something like that."><y>#</y><d>2021-10-16</d><h>08:37</h><w>dominicm</w>I&apos;m just doing some profiling in vim, and a lot of time goes to finding the completion context.  How are other editors doing this fast?  I&apos;m considering whether I should just send the whole buffer or the last 400/next 400 lines or something like that.</z><z id="t1634380313" t="dominicm Dumb idea of just dumping the whole file doesn&apos;t work because compliment only reads a single form ðŸ™‚"><y>#</y><d>2021-10-16</d><h>10:31</h><r>dominicm</r>Dumb idea of just dumping the whole file doesn&apos;t work because compliment only reads a single form <b>ðŸ™‚</b></z><z id="t1634373608" t="dominicm https://github.com/tpope/vim-fireplace/blob/c9a155b88d629221628937eadb64a3e87f8d82d9/autoload/fireplace.vim#L195-L224 here&apos;s how it&apos;s being done in fireplace/vim."><y>#</y><d>2021-10-16</d><h>08:40</h><w>dominicm</w><a href="https://github.com/tpope/vim-fireplace/blob/c9a155b88d629221628937eadb64a3e87f8d82d9/autoload/fireplace.vim#L195-L224" target="_blank">https://github.com/tpope/vim-fireplace/blob/c9a155b88d629221628937eadb64a3e87f8d82d9/autoload/fireplace.vim#L195-L224</a> here&apos;s how it&apos;s being done in fireplace/vim.</z><z id="t1634376578" t="pez Calva does something similar. Take the text from start of top level form to in front on what is completed, take the text from end of what is completed to end of top level form, concatenate. Where is the time spend in the above snippet?"><y>#</y><d>2021-10-16</d><h>09:29</h><r>pez</r>Calva does something similar. Take the text from start of top level form to in front on what is completed, take the text from end of what is completed to end of top level form, concatenate. Where is the time spend in the above snippet?</z><z id="t1634380296" t="dominicm On finding the opening paren. In bigger functions this is pretty slow."><y>#</y><d>2021-10-16</d><h>10:31</h><r>dominicm</r>On finding the opening paren. In bigger functions this is pretty slow.</z><z id="t1634384111" t="pez Is it slow as in that the user notices a delay?"><y>#</y><d>2021-10-16</d><h>11:35</h><r>pez</r>Is it slow as in that the user notices a delay?</z><z id="t1634384569" t="pez Calva uses its Token Cursor for all things like this. So finding top level form is a super quick operation, because it is just to go downList() until you canâ€™t anymore, then the top level form is the same as the current form. If you have something like a token cursor, or zipper, or whatever, then probably that would be quick. OTH, maybe searchpairpos() uses something like that already?"><y>#</y><d>2021-10-16</d><h>11:42</h><r>pez</r>Calva uses its Token Cursor for all things like this. So finding top level form is a super quick operation, because it is just to go <code>downList()</code> until you canâ€™t anymore, then the top level form is the same as the current form. If you have something like a token cursor, or zipper, or whatever, then probably that would be quick. OTH, maybe <code>searchpairpos()</code> uses something like that already?</z><z id="t1634403114" t="dominicm Sorry, missed this. It&apos;s so slow I noticed delay while trying to work and just disabled everything. I felt like I was using vi ðŸ™‚"><y>#</y><d>2021-10-16</d><h>16:51</h><r>dominicm</r>Sorry, missed this. It&apos;s so slow I noticed delay while trying to work and just disabled everything.  I felt like I was using vi <b>ðŸ™‚</b></z><z id="t1634403157" t="dominicm I&apos;m not sure what a Token Cursor is, but my suspicion is that you&apos;ve got some kind of caching/incremental parsing going on there. Vim isn&apos;t that smart. It has to search the whole file every time to figure out if there&apos;s a cheeky ( at the start of the file to match."><y>#</y><d>2021-10-16</d><h>16:52</h><r>dominicm</r>I&apos;m not sure what a Token Cursor is, but my suspicion is that you&apos;ve got some kind of caching/incremental parsing going on there.  Vim isn&apos;t that smart.  It has to search the whole file every time to figure out if there&apos;s a cheeky <code>(</code> at the start of the file to match.</z><z id="t1634403350" t="dominicm Benchmarks indicate a reduction of 59ms to 0.26ms per call."><y>#</y><d>2021-10-16</d><h>16:55</h><r>dominicm</r>Benchmarks indicate a reduction of 59ms to 0.26ms per call.</z><z id="t1634403480" t="dominicm Apparently a 99.56% decrease ðŸ˜„"><y>#</y><d>2021-10-16</d><h>16:58</h><r>dominicm</r>Apparently a 99.56% decrease <b>ðŸ˜„</b></z><z id="t1634415826" t="pez A Token Cursor is an old invention for navigating LISP code. Hereâ€™s Up List from an 80s zmacs manual: &gt; Moves forward out of nesting levels. It moves forward one level of list structure. It searches for a close parenthesis and leaves point to the right of that close parenthesis. Also, if called inside of a string, it moves up out of that string, leaving point to the right of its ending quote. In Calva we maintain a sequence of tokens for all documents that are being edited. And then we use a structural â€œcursorâ€ to navigate the code. Totally inspired by that age old invention."><y>#</y><d>2021-10-16</d><h>20:23</h><r>pez</r>A Token Cursor is an old invention for navigating LISP code. Hereâ€™s Up List from an 80s zmacs manual:
&gt; Moves forward out of nesting levels. It moves forward one level of list structure. It searches for a close parenthesis and leaves point to the right of that close parenthesis. Also, if called inside of a string, it moves up out of that string, leaving point to the right of its ending quote.
In Calva we maintain a sequence of tokens for all documents that are being edited. And then we use a structural â€œcursorâ€ to navigate the code. Totally inspired by that age old invention.</z><z id="t1634415902" t="pez When you reached for TreeSitter you took a similar approach, I would say. Our token sequence is comparable to the AST that TreeSitter builds and uses."><y>#</y><d>2021-10-16</d><h>20:25</h><r>pez</r>When you reached for TreeSitter you took a similar approach, I would say. Our token sequence is comparable to the AST that TreeSitter builds and uses.</z><z id="t1634416174" t="pez Interestingly, the same manual says this about top level expressions: &gt; A Lisp file contains a sequence of expressions that we call top-level expressions, to distinguish them from their own sUbexpressions. Zmacs assumes that top-level expressions begin with an open parenthesis against the left margin. It does not parse top-level expressions by balancing parentheses, since parentheses do not always balance while programs are being written. The indentation represents the programmerâ€™s conception of program structure, and provides a better guide. So by top-level expression, we mean a section of text delimited by open parentheses at the beginning of two lines."><y>#</y><d>2021-10-16</d><h>20:29</h><r>pez</r>Interestingly, the same manual says this about top level expressions:
&gt; A Lisp file contains a sequence of expressions that we call top-level expressions, to distinguish them from their own sUbexpressions. Zmacs assumes that top-level expressions begin with an open parenthesis against the left margin. It does not parse top-level expressions by balancing parentheses, since parentheses do not always balance while programs are being written. The indentation represents the programmerâ€™s conception of program structure, and provides a better guide. So by top-level expression, we mean a section of text delimited by open parentheses at the beginning of two lines.</z><z id="t1634416243" t="pez Calva instead helps with keeping the document always balanced, and when it is not offers almost no help for editing it. ðŸ˜ƒ"><y>#</y><d>2021-10-16</d><h>20:30</h><r>pez</r>Calva instead helps with keeping the document always balanced, and when it is not offers almost no help for editing it. <b>ðŸ˜ƒ</b></z><z id="t1634416750" t="dominicm Ah, so it just searches backwards for ^( and then forwards for the same..."><y>#</y><d>2021-10-16</d><h>20:39</h><r>dominicm</r>Ah, so it just searches backwards for <code>^(</code> and then forwards for the same...</z><z id="t1634416787" t="dominicm Unfortunately, compliment only works on complete forms anyway ðŸ™‚"><y>#</y><d>2021-10-16</d><h>20:39</h><r>dominicm</r>Unfortunately, compliment only works on complete forms anyway <b>ðŸ™‚</b></z><z id="t1634416843" t="dominicm I might put forward that suggestion to tpope from the zmacs manual and see what he thinks."><y>#</y><d>2021-10-16</d><h>20:40</h><r>dominicm</r>I might put forward that suggestion to tpope from the zmacs manual and see what he thinks.</z><z id="t1634455930" t="pez Iâ€™m not sure how it was done in zmacs and its precursors, but Calva maintains a parsed representation of the document that is fast to navigate."><y>#</y><d>2021-10-17</d><h>07:32</h><r>pez</r>Iâ€™m not sure how it was done in zmacs and its precursors, but Calva maintains a parsed representation of the document that is fast to navigate.</z><z id="t1634459229" t="dominicm Does VSCode provide tools for assisting with maintenance of that parsed representation?"><y>#</y><d>2021-10-17</d><h>08:27</h><r>dominicm</r>Does VSCode provide tools for assisting with maintenance of that parsed representation?</z><z id="t1634459237" t="dominicm I can&apos;t imagine writing that myself!"><y>#</y><d>2021-10-17</d><h>08:27</h><r>dominicm</r>I can&apos;t imagine writing that myself!</z><z id="t1634462594" t="pez I wish. And it is pretty advanced tech, for sure. I got help creating the infrastructure from a developer who does such things in the sleep."><y>#</y><d>2021-10-17</d><h>09:23</h><r>pez</r>I wish. And it is pretty advanced tech, for sure. I got help creating the infrastructure from a developer who does such things in the sleep.</z><z id="t1634503864" t="dominicm Nice, I&apos;ll have to poke about some time."><y>#</y><d>2021-10-17</d><h>20:51</h><r>dominicm</r>Nice, I&apos;ll have to poke about some time.</z><z id="t1634543098" t="flowthing &gt; Vim isn&apos;t that smart.Â  It has to search the whole file every time to figure out if there&apos;s a cheekyÂ `(`Â at the start of the file to match. I got bit by the same thing (in a different context) in the thing I&apos;m making for Sublime Text. I solved it by just assuming that if ( is at the first column, it&apos;s the outermost form. ðŸ¤· It&apos;s not perfect, but it probably solves 99.9% of the cases. ðŸ˜›"><y>#</y><d>2021-10-18</d><h>07:44</h><r>flowthing</r>&gt; Vim isn&apos;t that smart.Â  It has to search the whole file every time to figure out if there&apos;s a cheekyÂ `(`Â at the start of the file to match.
I got bit by the same thing (in a different context) in the thing I&apos;m making for Sublime Text. I solved it by just assuming that if <code>(</code> is at the first column, it&apos;s the outermost form. <b>ðŸ¤·</b>  It&apos;s not perfect, but it probably solves 99.9% of the cases. <b>ðŸ˜›</b></z><z id="t1634545246" t="pez Thatâ€™s how zmacs solved it too. ðŸ˜ƒ But for a different reason."><y>#</y><d>2021-10-18</d><h>08:20</h><r>pez</r>Thatâ€™s how zmacs solved it too. <b>ðŸ˜ƒ</b> But for a different reason.</z><z id="t1634545588" t="flowthing Oh yes, I see that now in the quote you pasted earlier. ðŸ™‚"><y>#</y><d>2021-10-18</d><h>08:26</h><r>flowthing</r>Oh yes, I see that now in the quote you pasted earlier. <b>ðŸ™‚</b></z><z id="t1634545646" t="pez To be clear. VS Code is not helping much with this for Calva. We have added it with the help of only the onDocumentContentChanged events (which are also very bare and could be much more helpful, but there it is). We maintain a â€œmirrorâ€ document, which gets updated whenever the vs code document gets updated, and vice versa. This mirror document is parsed and we maintain the an array of tokens which we then use for navigating the document. The code for finding the top level form looks like so: rangeForDefun(offset: number, commentCreatesTopLevel = true): [number, number] { const cursor = this.doc.getTokenCursor(offset); let lastCandidateRange: [number, number] = cursor.rangeForCurrentForm(offset); while (cursor.forwardList() &amp;&amp; cursor.upList()) { const commentCursor = cursor.clone(); commentCursor.backwardDownList(); if (!commentCreatesTopLevel || commentCursor.getToken().raw !== &apos;)&apos; || commentCursor.getFunctionName() !== &apos;comment&apos;) { lastCandidateRange = cursor.rangeForCurrentForm(cursor.offsetStart); } } return lastCandidateRange; } Including the handling of rich comment top level forms."><y>#</y><d>2021-10-18</d><h>08:27</h><r>pez</r>To be clear. VS Code is not helping much with this for Calva. We have added it with the help of only the onDocumentContentChanged events (which are also very bare and could be much more helpful, but there it is). We maintain a â€œmirrorâ€ document, which gets updated whenever the vs code document gets updated, and vice versa. This mirror document is parsed and we maintain the an array of tokens which we then use for navigating the document. The code for finding the top level form looks like so:
<pre>rangeForDefun(offset: number, commentCreatesTopLevel = true): [number, number] {
        const cursor = this.doc.getTokenCursor(offset);
        let lastCandidateRange: [number, number] = cursor.rangeForCurrentForm(offset);
        while (cursor.forwardList() &amp;&amp; cursor.upList()) {
            const commentCursor = cursor.clone();
            commentCursor.backwardDownList();
            if (!commentCreatesTopLevel || commentCursor.getToken().raw !== &apos;)&apos; || commentCursor.getFunctionName() !== &apos;comment&apos;) {
                lastCandidateRange = cursor.rangeForCurrentForm(cursor.offsetStart);
            }
        }
        return lastCandidateRange;
    }</pre>
Including the handling of rich comment top level forms.</z><z id="t1634545918" t="pez Itâ€™s not only used for navigation. All structural edits in Calva are performed on this mirror document which is then mirrored to the â€œrealâ€ document."><y>#</y><d>2021-10-18</d><h>08:31</h><r>pez</r>Itâ€™s not only used for navigation. All structural edits in Calva are performed on this mirror document which is then mirrored to the â€œrealâ€ document.</z><z id="t1634546727" t="flowthing Goodness. That does sound sophisticated. I&apos;m basically just moving parens around. ðŸ¤ª And it&apos;s not too expensive to maintain that &quot;mirror&quot; document in the background?"><y>#</y><d>2021-10-18</d><h>08:45</h><r>flowthing</r>Goodness. That does sound sophisticated. I&apos;m basically just moving parens around. <b>ðŸ¤ª</b>  And it&apos;s not too expensive to maintain that &quot;mirror&quot; document in the background?</z><z id="t1634557062" t="pez Because LISP this cursor thing is also basically just moving parens around. Memorywise, every document consumes at least double (text + token array). And maybe more, I donâ€™t know how smart VS Code is about in-active documents, but Calva keeps the mirror around. That doesnâ€™t seem to be too expensive, though. Parsing the documents can be quite a lot of work, but still below 200ms for Clojure core. That could get a lot more efficient if we used DFA regexes, but so far I have resisted going down that rabbit hole. Traversing the token array can also get expensive if the forms are very large. Calva hates huge EDN structures. But they need to get pretty huge first. Calvaâ€™s rainbow parens and other highlight services built on this take care only to traverse forms that are in view, but with a huge EDN form, that doesnâ€™t help much."><y>#</y><d>2021-10-18</d><h>11:37</h><r>pez</r>Because LISP this cursor thing is also basically just moving parens around. Memorywise, every document consumes at least double (text + token array). And maybe more, I donâ€™t know how smart VS Code is about in-active documents, but Calva keeps the mirror around. That doesnâ€™t seem to be too expensive, though. Parsing the documents can be quite a lot of work, but still below 200ms for Clojure core. That could get a lot more efficient if we used DFA regexes, but so far I have resisted going down that rabbit hole. Traversing the token array can also get expensive if the forms are very large. Calva hates huge EDN structures. But they need to get pretty huge first. Calvaâ€™s rainbow parens and other highlight services built on this take care only to traverse forms that are in view, but with a huge EDN form, that doesnâ€™t help much.</z><z id="t1634557221" t="pez Iâ€™ve been trying to understand this article a bit, to see if I could use some of the approach, but so far it mostly passes over my head. https://code.visualstudio.com/blogs/2021/09/29/bracket-pair-colorization"><y>#</y><d>2021-10-18</d><h>11:40</h><r>pez</r>Iâ€™ve been trying to understand this article a bit, to see if I could use some of the approach, but so far it mostly passes over my head. <a href="https://code.visualstudio.com/blogs/2021/09/29/bracket-pair-colorization" target="_blank">https://code.visualstudio.com/blogs/2021/09/29/bracket-pair-colorization</a></z><z id="t1634562324" t="flowthing Interesting, thanks for the info!"><y>#</y><d>2021-10-18</d><h>13:05</h><r>flowthing</r>Interesting, thanks for the info!</z><z id="t1634562356" t="flowthing And yeah, I glanced at that bracket pair colorization article earlier, but, well, I&apos;m an English major, so... ðŸ˜›"><y>#</y><d>2021-10-18</d><h>13:05</h><r>flowthing</r>And yeah, I glanced at that bracket pair colorization article earlier, but, well, I&apos;m an English major, so... <b>ðŸ˜›</b></z><z id="t1634396543" t="dominicm I ended up rewriting it using treesitter/lua and now it doesn&apos;t even show up in the profile it&apos;s so fast.... Oh yeah!"><y>#</y><d>2021-10-16</d><h>15:02</h><w>dominicm</w>I ended up rewriting it using treesitter/lua and now it doesn&apos;t even show up in the profile it&apos;s so fast.... Oh yeah!</z><z id="t1634400813" t="pez Thatâ€™s a similar path as Calva uses, even if we are using a homegrown syntax parser."><y>#</y><d>2021-10-16</d><h>16:13</h><r>pez</r>Thatâ€™s a similar path as Calva uses, even if we are using a homegrown syntax parser.</z><z id="t1634539325" t="bozhidar Wasn&apos;t the context supposed to be just the containing form or something like this? Why would someone send the entire buffer?"><y>#</y><d>2021-10-18</d><h>06:42</h><w>bozhidar</w>Wasn&apos;t the context supposed to be just the containing form or something like this? Why would someone send the entire buffer?</z><z id="t1634578767" t="dominicm It is. But searching for matching parens so you only send the outermost form is expensive. I was trying to find an alternative that would be faster to run."><y>#</y><d>2021-10-18</d><h>17:39</h><r>dominicm</r>It is.  But searching for matching parens so you only send the outermost form is expensive.  I was trying to find an alternative that would be faster to run.</z><z id="t1634539356" t="bozhidar Seems to me that&apos;s compliment-specific, though, as nREPL&apos;s own completion doesn&apos;t even have a notion of completion context currently."><y>#</y><d>2021-10-18</d><h>06:42</h><w>bozhidar</w>Seems to me that&apos;s compliment-specific, though, as nREPL&apos;s own completion doesn&apos;t even have a notion of completion context currently.</z><z id="t1634562231" t="yuhan How can I start an nrepl server in some main ns that catches errors in the main application thread? I&apos;m not sure if that question makes sense, but say there&apos;s some UI or &quot;game loop&quot; that is continually running alongside the server, like this: (ns my-app (:require [nrepl.server :as server] cider.nrepl)) (defonce server (nrepl.server/start-server :port 7888 :handler (apply nrepl.server/default-handler cider.nrepl/cider-middleware))) (defn do-thing [] (Thread/sleep 1000) (println (System/currentTimeMillis)) ;; (inc nil) ) (defn -main [&amp; args] (loop [] (do-thing) (recur))) instead of starting the nrepl server using -m nrepl.cmdline . I can then connect to the server with Cider and interactively redefine the do-thing function, but if it throws an error (eg. uncomment the (inc nil) ), the entire process exits instead of triggering the stacktrace middleware."><y>#</y><d>2021-10-18</d><h>13:03</h><w>yuhan</w>How can I start an nrepl server in some main ns that catches errors in the main application thread?
I&apos;m not sure if that question makes sense, but say there&apos;s some UI or &quot;game loop&quot; that is continually running alongside the server, like this:

<pre>(ns my-app
  (:require [nrepl.server :as server]
            cider.nrepl))

(defonce server
  (nrepl.server/start-server
    :port 7888
    :handler (apply nrepl.server/default-handler cider.nrepl/cider-middleware)))

(defn do-thing []
  (Thread/sleep 1000)
  (println (System/currentTimeMillis))
  ;; (inc nil)
  )

(defn -main [&amp; args]
  (loop []
    (do-thing)
    (recur)))</pre>
 instead of starting the nrepl server using <code>-m nrepl.cmdline</code> .

I can then connect to the server with Cider and interactively redefine the <code>do-thing</code> function, but if it throws an error (eg. uncomment the <code>(inc nil)</code>), the entire process exits instead of triggering the stacktrace middleware.</z><z id="t1635400031" t="bozhidar Hmm, I never thought about this, so no answer immediately comes to mind. I assume the problem happens only for invocations that happen in -main right?"><y>#</y><d>2021-10-28</d><h>05:47</h><r>bozhidar</r>Hmm, I never thought about this, so no answer immediately comes to mind. I assume the problem happens only for invocations that happen in <code>-main</code> right?</z><z id="t1635400046" t="bozhidar Might be a good idea to post this on the issue tracker, so we won&apos;t forget about it."><y>#</y><d>2021-10-28</d><h>05:47</h><r>bozhidar</r>Might be a good idea to post this on the issue tracker, so we won&apos;t forget about it.</z><z id="t1635364178" t="Marc O&apos;Morain Iâ€™ve just noticed the cider-nrepl test op is marked as deprecated: https://docs.cider.mx/cider-nrepl/nrepl-api/ops.html#test Is there a suggested new way to run tests?"><y>#</y><d>2021-10-27</d><h>19:49</h><w>Marc O'Morain</w>Iâ€™ve just noticed the <code>cider-nrepl</code> <code>test</code> op is marked as deprecated:

<a href="https://docs.cider.mx/cider-nrepl/nrepl-api/ops.html#test" target="_blank">https://docs.cider.mx/cider-nrepl/nrepl-api/ops.html#test</a>

Is there a suggested new way to run tests?</z><z id="t1635364863" t="pez Calva uses test-var-query , which I think is the new way. At least I thought so when implementing it. ðŸ˜ƒ"><y>#</y><d>2021-10-27</d><h>20:01</h><r>pez</r>Calva uses <code>test-var-query</code>, which I think is the new way. At least I thought so when implementing it. <b>ðŸ˜ƒ</b></z><z id="t1635399780" t="bozhidar Yeah, that&apos;s true."><y>#</y><d>2021-10-28</d><h>05:43</h><r>bozhidar</r>Yeah, that&apos;s true.</z><z id="t1635399819" t="bozhidar It&apos;s basically one flexible op that replaces several highly specialized ops."><y>#</y><d>2021-10-28</d><h>05:43</h><r>bozhidar</r>It&apos;s basically one flexible op that replaces several highly specialized ops.</z><z id="t1636125841" t="Marc O&apos;Morain thanks :thumbsup:"><y>#</y><d>2021-11-05</d><h>15:24</h><r>Marc O'Morain</r>thanks <b>:thumbsup:</b></z><z id="t1635857263" t="vemv dunno if FAQ but I just noticed that if binding nrepl to 0.0.0.0 instead of localhost, it can resolve to an arbitrary domain within /etc/hosts which I use for adblocking: nREPL server started on port 9656 on host - "><y>#</y><d>2021-11-02</d><h>12:47</h><w>vemv</w>dunno if FAQ but I just noticed that if binding nrepl to 0.0.0.0 instead of localhost, it can resolve to an arbitrary domain within /etc/hosts which I use for adblocking:

<code>nREPL server started on port 9656 on host  - </code></z><z id="t1635857283" t="vemv seems an ugly way to greet users :rolling_on_the_floor_laughing:"><y>#</y><d>2021-11-02</d><h>12:48</h><w>vemv</w>seems an ugly way to greet users <b>:rolling_on_the_floor_laughing:</b></z><z id="t1635867999" t="bozhidar I recall there was some discussion in the past, but I don&apos;t remember the discussion. ðŸ˜„"><y>#</y><d>2021-11-02</d><h>15:46</h><w>bozhidar</w>I recall there was some discussion in the past, but I don&apos;t remember the discussion. <b>ðŸ˜„</b></z><z id="t1636947421" t="ericdallo Make nrepl compatible with graalvm :) graal-vm reviewplease https://github.com/nrepl/nrepl/pull/258"><y>#</y><d>2021-11-15</d><h>03:37</h><w>ericdallo</w>Make nrepl compatible with graalvm :)
<b>graal-vm</b> <b>reviewplease</b> <a href="https://github.com/nrepl/nrepl/pull/258" target="_blank">https://github.com/nrepl/nrepl/pull/258</a></z><z id="t1636964636" t="bozhidar [:attrs {:href &quot;/_/_/users/UKFSJSM38&quot;}] You can also add some instructions how to run nREPL with graalvm, as I&apos;m completely incompetent on the subject. ðŸ™‚"><y>#</y><d>2021-11-15</d><h>08:23</h><w>bozhidar</w><a>@ericdallo</a> You can also add some instructions how to run nREPL with graalvm, as I&apos;m completely incompetent on the subject. <b>ðŸ™‚</b></z><z id="t1636982901" t="ericdallo Sure [:attrs {:href &quot;/_/_/users/U051BLM8F&quot;}] ! Do you think a simple repo compiling a clojure program that uses nrepl would help?"><y>#</y><d>2021-11-15</d><h>13:28</h><w>ericdallo</w>Sure <a>@bozhidar</a>! Do you think a simple repo compiling a clojure program that uses nrepl would help?</z><z id="t1636984524" t="bozhidar Yeah, that&apos;d be great."><y>#</y><d>2021-11-15</d><h>13:55</h><w>bozhidar</w>Yeah, that&apos;d be great.</z><z id="t1636988571" t="ericdallo Done [:attrs {:href &quot;/_/_/users/U051BLM8F&quot;}] , LMK if need anything more"><y>#</y><d>2021-11-15</d><h>15:02</h><w>ericdallo</w>Done <a>@bozhidar</a>, LMK if need anything more</z><z id="t1637242814" t="Sam Ritchie Hey all! Questionâ€¦ is there some way to prevent cider-nrepl from installing the print-method implementations in this file? https://github.com/clojure-emacs/cider-nrepl/blob/master/src/cider/nrepl/print_method.clj#L1"><y>#</y><d>2021-11-18</d><h>13:40</h><w>Sam Ritchie</w>Hey all! Questionâ€¦ is there some way to prevent <code>cider-nrepl</code> from installing the <code>print-method</code> implementations in this file? <a href="https://github.com/clojure-emacs/cider-nrepl/blob/master/src/cider/nrepl/print_method.clj#L1" target="_blank">https://github.com/clojure-emacs/cider-nrepl/blob/master/src/cider/nrepl/print_method.clj#L1</a></z><z id="t1639470648" t="vemv Feel free to promote your question to an issue (further context also appreciated)"><y>#</y><d>2021-12-14</d><h>08:30</h><r>vemv</r>Feel free to promote your question to an issue (further context also appreciated)</z><z id="t1637242826" t="Sam Ritchie I am trying to provide my own and cider-nrepl always wins the race"><y>#</y><d>2021-11-18</d><h>13:40</h><w>Sam Ritchie</w>I am trying to provide my own and <code>cider-nrepl</code> always wins the race</z><z id="t1639470690" t="vemv Have you tried performing your own after a require cider.nrepl.print-method ?"><y>#</y><d>2021-12-14</d><h>08:31</h><r>vemv</r>Have you tried performing your own after a <code>require cider.nrepl.print-method</code> ?</z><z id="t1639485672" t="Sam Ritchie Yup, it works then but I could not find a reliable place to put it that would guarantee that mine would get evaluated after without manually executing the form "><y>#</y><d>2021-12-14</d><h>12:41</h><r>Sam Ritchie</r>Yup, it works then but I could not find a reliable place to put it that would guarantee that mine would get evaluated after without manually executing the form </z><z id="t1639486097" t="vemv user.clj might work, it has the semantic that it gets loaded automatically / before many things I don&apos;t recommend abusing those semantics much but I think this is pretty risk-free"><y>#</y><d>2021-12-14</d><h>12:48</h><r>vemv</r>user.clj might work, it has the semantic that it gets loaded automatically / before many things

I don&apos;t recommend abusing those semantics much but I think this is pretty risk-free</z><z id="t1640949358" t="pez I put some java code in a project ( https://blog.agical.se/posts/mixed-clojure-and-java/ ) to see how Calva behaves with it. Expecting that I should be able to navigate to the source since it is in the same project. But the info response seems to lack the path (and no navigation happens). Hereâ€™s the relevant (I think) negotiation. Are my expectations wrong or is something else wrong? nrepl 0.9.0, cider-nrepl 0.27.4. -&gt; sent { op: &apos;info&apos;, ns: &apos;pez.java-hello&apos;, symbol: &apos;HelloWorld/FOO&apos;, id: &apos;17&apos;, session: &apos;9ce19606-3d66-4c9d-9768-bbfc8688a841&apos; } &lt;- received { &apos;arglists-str&apos;: &apos;nil&apos;, class: &apos;pez.HelloWorld&apos;, id: &apos;17&apos;, javadoc: &apos;pez/HelloWorld.html#FOO&apos;, member: &apos;FOO&apos;, modifiers: &apos;#{:public :static}&apos;, session: &apos;9ce19606-3d66-4c9d-9768-bbfc8688a841&apos;, status: [ &apos;done&apos; ], type: &apos;java.lang.String&apos; }"><y>#</y><d>2022-12-31</d><h>11:15</h><w>pez</w>I put some java code in a project (<a href="https://blog.agical.se/posts/mixed-clojure-and-java/" target="_blank">https://blog.agical.se/posts/mixed-clojure-and-java/</a>) to see how Calva behaves with it. Expecting that I should be able to navigate to the source since it is in the same project. But the <code>info</code> response seems to lack the path (and no navigation happens). Hereâ€™s the relevant (I think) negotiation. Are my expectations wrong or is something else wrong? nrepl 0.9.0, cider-nrepl 0.27.4.
<pre>-&gt; sent
{
  op: &apos;info&apos;,
  ns: &apos;pez.java-hello&apos;,
  symbol: &apos;HelloWorld/FOO&apos;,
  id: &apos;17&apos;,
  session: &apos;9ce19606-3d66-4c9d-9768-bbfc8688a841&apos;
}

&lt;- received
{
  &apos;arglists-str&apos;: &apos;nil&apos;,
  class: &apos;pez.HelloWorld&apos;,
  id: &apos;17&apos;,
  javadoc: &apos;pez/HelloWorld.html#FOO&apos;,
  member: &apos;FOO&apos;,
  modifiers: &apos;#{:public :static}&apos;,
  session: &apos;9ce19606-3d66-4c9d-9768-bbfc8688a841&apos;,
  status: [ &apos;done&apos; ],
  type: &apos;java.lang.String&apos;
}</pre></z><z id="t1640966774" t="bozhidar If the path is missing then most likely the Java sources are not on Clojure&apos;s classpath."><y>#</y><d>2022-12-31</d><h>16:06</h><w>bozhidar</w>If the path is missing then most likely the Java sources are not on Clojure&apos;s classpath.</z><z id="t1640967024" t="pez The java sources are in the project, and the deps.edn is configured with :paths to find them."><y>#</y><d>2022-12-31</d><h>16:10</h><w>pez</w>The java sources are in the project, and the deps.edn is configured with <code>:paths</code>  to find them.</z><z id="t1640967292" t="pez (If by Java sources, you mean the source code for pez.HelloWorld .)"><y>#</y><d>2022-12-31</d><h>16:14</h><w>pez</w>(If by Java sources, you mean the source code for <code>pez.HelloWorld</code>.)</z><z id="t1641054937" t="bozhidar Is the code for the sample project on GitHub?"><y>#</y><d>2022-01-01</d><h>16:35</h><w>bozhidar</w>Is the code for the sample project on GitHub?</z><z id="t1641055754" t="pez Now it is ðŸ˜„ https://github.com/PEZ/clojure-java"><y>#</y><d>2022-01-01</d><h>16:49</h><w>pez</w>Now it is <b>ðŸ˜„</b> <a href="https://github.com/PEZ/clojure-java" target="_blank">https://github.com/PEZ/clojure-java</a></z><z id="t1641436870" t="CÃ©lio Hi, Iâ€™m playing with the sideloader middleware and something curious happened right out of the gate. When I evalâ€™d (ns core (:require [something])) I received a sideloader-lookup message with something__init.class as the name. I was expecting to receive a source file path instead, like something.clj . Is that something I can control, or am I missing something?"><y>#</y><d>2022-01-06</d><h>02:41</h><w>CÃ©lio</w>Hi, Iâ€™m playing with the sideloader middleware and something curious happened right out of the gate. When I evalâ€™d <code>(ns core (:require [something]))</code> I received a <code>sideloader-lookup</code> message with <code>something__init.class</code> as the name. I was expecting to receive a source file path instead, like <code>something.clj</code>. Is that something I can control, or am I missing something?</z><z id="t1641511751" t="CÃ©lio Nevermind, when I responded with content = empty string, I noticed the middleware attempts to lookup source file resources."><y>#</y><d>2022-01-06</d><h>23:29</h><r>CÃ©lio</r>Nevermind, when I responded with content = empty string, I noticed the middleware attempts to lookup source file resources.</z><z id="t1643042141" t="DenisMc Hi, Iâ€™m tearing my hair out with an issue that I think is to do with my nrepl config. I have a clojure project that I am running in a docker container, and I have logging (using logback) enabled for the project. I can see that logback is logging (as configured) to the console within the docker container, but when I connect to the running application locally using an nrepl (set up in IDEA/cursive), I am not getting the logback logs - but I am seeing messages that I (print) to the console within the application. That is to say, for the following code: (print &quot;this is printing in the nrepl...&quot;) (log/error &quot;this is not printing in the nrepl&quot;) The first line appears in the nrepl and the second does not - but both lines appear in the console for the docker container where the application is running. When I run the application entirely locally (no docker) via a normal repl the console logs appear as expected in the repl when I run tests and so on. So it appears to be a problem with my nrepl config. Any help gratefully accepted on this - I know this may be some typo or screwup in my deps.edn or something, but maybe someone has come across this sort of issue before and can point me in the right direction. Thanks in advance."><y>#</y><d>2022-01-24</d><h>16:35</h><w>DenisMc</w>Hi, Iâ€™m tearing my hair out with an issue that I think is to do with my nrepl config. I have a clojure project that I am running in a docker container, and I have logging (using logback) enabled for the project. I can see that logback is logging (as configured) to the console within the docker container, but when I connect to the running application locally using an nrepl (set up in IDEA/cursive), I am not getting the logback logs - but I am seeing messages that I (print) to the console within the application. That is to say, for the following code:

<pre>(print &quot;this is printing in the nrepl...&quot;)
(log/error &quot;this is not printing in the nrepl&quot;)</pre>
The first line appears in the nrepl and the second does not - but both lines appear in the console for the docker container where the application is running.

When I run the application entirely locally (no docker) via a normal repl the console logs appear as expected in the repl when I run tests and so on. So it appears to be a problem with my nrepl config.

Any help gratefully accepted on this - I know this may be some typo or screwup in my deps.edn or something, but maybe someone has come across this sort of issue before and can point me in the right direction. Thanks in advance.</z><z id="t1643061069" t="DenisMc Ok, Iâ€™ve found a workaround for this using this gist: https://gist.github.com/daviesian/4517859 . Iâ€™ve created a cursive command that I can run with a shortcut whenever I start a new repl and it fixes the issue. I donâ€™t know why stdout isnâ€™t printing to the repl (maybe because itâ€™s in docker?), but this fixes the problem."><y>#</y><d>2022-01-24</d><h>21:51</h><w>DenisMc</w>Ok, Iâ€™ve found a workaround for this using this gist: <a href="https://gist.github.com/daviesian/4517859" target="_blank">https://gist.github.com/daviesian/4517859</a>. Iâ€™ve created a cursive command that I can run with a shortcut whenever I start a new repl and it fixes the issue. I donâ€™t know why stdout isnâ€™t printing to the repl (maybe because itâ€™s in docker?), but this fixes the problem.</z><z id="t1644949166" t="Mikko Harju I removed my message since this was a classic PEBKAC. I just need to run the basic clj-process with nrepl and just go from there. ðŸ™‚"><y>#</y><d>2022-02-15</d><h>18:19</h><w>Mikko Harju</w>I removed my message since this was a classic PEBKAC. I just need to run the basic clj-process with nrepl and just go from there. <b>ðŸ™‚</b></z><z id="t1645364659" t="Daniel Slutsky Hi [:attrs {:href &quot;/_/_/users/U051BLM8F&quot;}] [:attrs {:href &quot;/_/_/users/U0ETXRFEW&quot;}] . Just noticed a little gap between CIDER and Calva. If we have the following code: ^:abcd [1] (that is, a vector with a number in it, with some metadata before it), and we put the cursor after this piece of code, then cider-eval-last-sexp would pass the code ^:abcd [1] to nREPL, while Calva: Evaluate Current Form would pass only [1] . I&apos;m wondering what might be better (I tend to prefer the CIDER behaviour here, since we sometimes use metadata in interactive visualization tools)."><y>#</y><d>2022-02-20</d><h>13:44</h><w>Daniel Slutsky</w>Hi <a>@bozhidar</a><a>@pez</a>.

Just noticed a little gap between CIDER and Calva.

If we have the following code:
<pre>^:abcd [1]</pre>
(that is, a vector with a number in it, with some metadata before it), and we put the cursor after this piece of code,
then <code>cider-eval-last-sexp</code> would pass the code <code>^:abcd [1]</code> to nREPL,
while <code>Calva: Evaluate Current Form</code> would pass only <code>[1]</code>.

 I&apos;m wondering what might be better (I tend to prefer the CIDER behaviour here, since we sometimes use metadata in interactive visualization tools).</z><z id="t1645365287" t="pez I think metadata should be considered as part of the form and evaluated together. Please file an issue on Calva about this."><y>#</y><d>2022-02-20</d><h>13:54</h><w>pez</w>I think metadata should be considered as part of the form and evaluated together. Please file an issue on Calva about this.</z><z id="t1645366385" t="Daniel Slutsky Here: https://github.com/BetterThanTomorrow/calva/issues/1551 Thank you so much."><y>#</y><d>2022-02-20</d><h>14:13</h><r>Daniel Slutsky</r>Here:
<a href="https://github.com/BetterThanTomorrow/calva/issues/1551" target="_blank">https://github.com/BetterThanTomorrow/calva/issues/1551</a>
Thank you so much.</z><z id="t1646157905" t="pez This was quite tricky to fix! In the end it is mostly some long overdue clean-ups of rats nests in the code, so I am quite happy I put in the work. ðŸ˜ƒ https://clojurians.slack.com/archives/CBE668G4R/p1646157715170719"><y>#</y><d>2022-03-01</d><h>18:05</h><r>pez</r>This was quite tricky to fix! In the end it is mostly some long overdue clean-ups of rats nests in the code, so I am quite happy I put in the work. <b>ðŸ˜ƒ</b>  <a href="https://clojurians.slack.com/archives/CBE668G4R/p1646157715170719" target="_blank">https://clojurians.slack.com/archives/CBE668G4R/p1646157715170719</a></z><z id="t1646157905" t="pez This was quite tricky to fix! In the end it is mostly some long overdue clean-ups of rats nests in the code, so I am quite happy I put in the work. ðŸ˜ƒ https://clojurians.slack.com/archives/CBE668G4R/p1646157715170719"><y>#</y><d>2022-03-01</d><h>18:05</h><w>pez</w>This was quite tricky to fix! In the end it is mostly some long overdue clean-ups of rats nests in the code, so I am quite happy I put in the work. <b>ðŸ˜ƒ</b>  <a href="https://clojurians.slack.com/archives/CBE668G4R/p1646157715170719" target="_blank">https://clojurians.slack.com/archives/CBE668G4R/p1646157715170719</a></z><z id="t1645838563" t="neilyio Iâ€™m working on a minimal ClojureScript setup with https://github.com/nrepl/weasel , but Iâ€™m getting a JSC_UNDEFINED_EXTERN_VAR_ERROR upon compilation as soon as I (require â€™weasel.repl) from ClojureScript. Hereâ€™s a minimal reproduction: ;; src/cljs/user.cljs (ns cljs.user (:require [weasel.repl :as repl])) ;; build.clj (running compiler) (cljs.build.api/build {:output-dir &quot;.compiled/cljs&quot;, :output-to &quot;.compiled/cljs/prebundle.js&quot;, :asset-path &quot;cljs&quot;, :main &quot;cljs.user&quot;, :install-deps true, :optimizations :simple, :target :bundle :bundle-cmd {:default [&quot;esbuild&quot; &quot;.compiled/cljs/prebundle.js&quot; &quot;--bundle&quot; &quot;--outfile=public/js/bundle.js&quot;]} :npm-deps {&quot;react&quot; &quot;17.0.2&quot;, &quot;react-dom&quot; &quot;17.0.2&quot;, &quot;@react-spring/web&quot; &quot;9.4.2&quot;}}) Iâ€™ll post the full error from the Clojure process in the thread below. I realize weasel isnâ€™t very actively maintained, but if anyone can give me a tip on how to go about debugging this, then Iâ€™d love to contribute the fix upstream. Iâ€™m working on some new ClojureScript tooling that I think weasel would be a great fit for."><y>#</y><d>2022-02-26</d><h>01:22</h><w>neilyio</w>Iâ€™m working on a minimal ClojureScript setup with <a href="https://github.com/nrepl/weasel" target="_blank">https://github.com/nrepl/weasel</a> , but Iâ€™m getting a JSC_UNDEFINED_EXTERN_VAR_ERROR upon compilation as soon as I (require â€™weasel.repl)  from ClojureScript. Hereâ€™s a minimal reproduction:
<pre>;; src/cljs/user.cljs
(ns cljs.user
  (:require [weasel.repl :as repl]))

;; build.clj (running compiler)
(cljs.build.api/build 
 {:output-dir    &quot;.compiled/cljs&quot;,
  :output-to     &quot;.compiled/cljs/prebundle.js&quot;,
  :asset-path    &quot;cljs&quot;,
  :main          &quot;cljs.user&quot;,
  :install-deps  true,
  :optimizations :simple,
  :target        :bundle
  :bundle-cmd    {:default [&quot;esbuild&quot;
                            &quot;.compiled/cljs/prebundle.js&quot;
                            &quot;--bundle&quot;
                            &quot;--outfile=public/js/bundle.js&quot;]}
  :npm-deps
  {&quot;react&quot; &quot;17.0.2&quot;, &quot;react-dom&quot; &quot;17.0.2&quot;, &quot;@react-spring/web&quot; &quot;9.4.2&quot;}}) </pre>
Iâ€™ll post the full error from the Clojure process in the thread below.

I realize weasel isnâ€™t very actively maintained, but if anyone can give me a tip on how to go about debugging this, then Iâ€™d love to contribute the fix upstream. Iâ€™m working on some new ClojureScript tooling that I think weasel would be a great fit for.</z><z id="t1645838594" t="neilyio Full error from the build call above: Feb 25, 2022 5:17:37 PM com.google.javascript.jscomp.LoggerErrorManager println WARNING: .compiled/cljs/inferred_externs.js:13:0: WARNING - [JSC_UNDEFINED_EXTERN_VAR_ERROR ] name goog is not defined in the externs. 13| goog.dependencies_; ^^^^ Feb 25, 2022 5:17:37 PM com.google.javascript.jscomp.LoggerErrorManager println WARNING: .compiled/cljs/inferred_externs.js:14:0: WARNING - [JSC_UNDEFINED_EXTERN_VAR_ERROR] name goog is not defined in the externs. 14| goog.dependencies_.nameToPath; ^^^^ Feb 25, 2022 5:17:37 PM com.google.javascript.jscomp.LoggerErrorManager println WARNING: .compiled/cljs/inferred_externs.js:15:0: WARNING - [JSC_UNDEFINED_EXTERN_VAR_ERROR] name goog is not defined in the externs. 15| goog.dependencies_.visited; ^^^^ Feb 25, 2022 5:17:37 PM com.google.javascript.jscomp.LoggerErrorManager println WARNING: .compiled/cljs/inferred_externs.js:16:0: WARNING - [JSC_UNDEFINED_EXTERN_VAR_ERROR] name goog is not defined in the externs. 16| goog.dependencies_.written; ^^^^ Feb 25, 2022 5:17:37 PM com.google.javascript.jscomp.LoggerErrorManager println WARNING: .compiled/cljs/inferred_externs.js:17:0: WARNING - [JSC_UNDEFINED_EXTERN_VAR_ERROR] name goog is not defined in the externs. 17| goog.basePath; ^^^^ Feb 25, 2022 5:17:37 PM com.google.javascript.jscomp.LoggerErrorManager println WARNING: .compiled/cljs/inferred_externs.js:18:0: WARNING - [JSC_UNDEFINED_EXTERN_VAR_ERROR] name goog is not defined in the externs. 18| goog.writeScriptTag_; ^^^^ Feb 25, 2022 5:17:37 PM com.google.javascript.jscomp.LoggerErrorManager println WARNING: .compiled/cljs/inferred_externs.js:19:0: WARNING - [JSC_UNDEFINED_EXTERN_VAR_ERROR] name goog is not defined in the externs. 19| goog.require; ^^^^ Feb 25, 2022 5:17:37 PM com.google.javascript.jscomp.LoggerErrorManager println WARNING: .compiled/cljs/inferred_externs.js:20:0: WARNING - [JSC_UNDEFINED_EXTERN_VAR_ERROR] name goog is not defined in the externs. 20| goog.require__; ^^^^ Feb 25, 2022 5:17:37 PM com.google.javascript.jscomp.LoggerErrorManager println WARNING: .compiled/cljs/inferred_externs.js:21:0: WARNING - [JSC_UNDEFINED_EXTERN_VAR_ERROR] name goog is not defined in the externs. 21| goog.writeScriptTag__; ^^^^ Feb 25, 2022 5:17:37 PM com.google.javascript.jscomp.LoggerErrorManager println WARNING: .compiled/cljs/inferred_externs.js:22:0: WARNING - [JSC_UNDEFINED_EXTERN_VAR_ERROR] name goog is not defined in the externs. 22| goog.writeScriptTag__.apply; ^^^^ Feb 25, 2022 5:17:37 PM com.google.javascript.jscomp.LoggerErrorManager println WARNING: .compiled/cljs/inferred_externs.js:23:0: WARNING - [JSC_UNDEFINED_EXTERN_VAR_ERROR] name goog is not defined in the externs. 23| goog.isInModuleLoader_; ^^^^ Feb 25, 2022 5:17:37 PM com.google.javascript.jscomp.LoggerErrorManager println WARNING: .compiled/cljs/inferred_externs.js:24:0: WARNING - [JSC_UNDEFINED_EXTERN_VAR_ERROR] name goog is not defined in the externs. 24| goog.module; ^^^^ Feb 25, 2022 5:17:37 PM com.google.javascript.jscomp.LoggerErrorManager println WARNING: .compiled/cljs/inferred_externs.js:25:0: WARNING - [JSC_UNDEFINED_EXTERN_VAR_ERROR] name goog is not defined in the externs. 25| goog.module.getInternal_; ^^^^ Feb 25, 2022 5:17:37 PM com.google.javascript.jscomp.LoggerErrorManager println WARNING: .compiled/cljs/inferred_externs.js:26:0: WARNING - [JSC_UNDEFINED_EXTERN_VAR_ERROR] name goog is not defined in the externs. 26| goog.isProvided_; ^^^^ Feb 25, 2022 5:17:37 PM com.google.javascript.jscomp.LoggerErrorManager println WARNING: .compiled/cljs/inferred_externs.js:27:0: WARNING - [JSC_UNDEFINED_EXTERN_VAR_ERROR] name goog is not defined in the externs. 27| goog.cljsReloadAll_; ^^^^ Feb 25, 2022 5:17:37 PM com.google.javascript.jscomp.LoggerErrorManager printSummary WARNING: 0 error(s), 15 warning(s) Feb 25, 2022 5:18:08 PM com.google.javascript.jscomp.LoggerErrorManager println WARNING: .compiled/cljs/inferred_externs.js:13:0: WARNING - [JSC_UNDEFINED_EXTERN_VAR_ERROR] name goog is not defined in the externs. 13| goog.dependencies_; ^^^^ Feb 25, 2022 5:18:08 PM com.google.javascript.jscomp.LoggerErrorManager println WARNING: .compiled/cljs/inferred_externs.js:14:0: WARNING - [JSC_UNDEFINED_EXTERN_VAR_ERROR] name goog is not defined in the externs. 14| goog.dependencies_.nameToPath; ^^^^ Feb 25, 2022 5:18:08 PM com.google.javascript.jscomp.LoggerErrorManager println WARNING: .compiled/cljs/inferred_externs.js:15:0: WARNING - [JSC_UNDEFINED_EXTERN_VAR_ERROR] name goog is not defined in the externs. 15| goog.dependencies_.visited; ^^^^ Feb 25, 2022 5:18:08 PM com.google.javascript.jscomp.LoggerErrorManager println WARNING: .compiled/cljs/inferred_externs.js:16:0: WARNING - [JSC_UNDEFINED_EXTERN_VAR_ERROR] name goog is not defined in the externs. 16| goog.dependencies_.written; ^^^^ Feb 25, 2022 5:18:08 PM com.google.javascript.jscomp.LoggerErrorManager println WARNING: .compiled/cljs/inferred_externs.js:17:0: WARNING - [JSC_UNDEFINED_EXTERN_VAR_ERROR] name goog is not defined in the externs. 17| goog.basePath; ^^^^ Feb 25, 2022 5:18:08 PM com.google.javascript.jscomp.LoggerErrorManager println WARNING: .compiled/cljs/inferred_externs.js:18:0: WARNING - [JSC_UNDEFINED_EXTERN_VAR_ERROR] name goog is not defined in the externs. 18| goog.writeScriptTag_; ^^^^ Feb 25, 2022 5:18:08 PM com.google.javascript.jscomp.LoggerErrorManager println WARNING: .compiled/cljs/inferred_externs.js:19:0: WARNING - [JSC_UNDEFINED_EXTERN_VAR_ERROR] name goog is not defined in the externs. 19| goog.require; ^^^^ Feb 25, 2022 5:18:08 PM com.google.javascript.jscomp.LoggerErrorManager println WARNING: .compiled/cljs/inferred_externs.js:20:0: WARNING - [JSC_UNDEFINED_EXTERN_VAR_ERROR] name goog is not defined in the externs. 20| goog.require__; ^^^^ Feb 25, 2022 5:18:08 PM com.google.javascript.jscomp.LoggerErrorManager println WARNING: .compiled/cljs/inferred_externs.js:21:0: WARNING - [JSC_UNDEFINED_EXTERN_VAR_ERROR] name goog is not defined in the externs. 21| goog.writeScriptTag__; ^^^^ Feb 25, 2022 5:18:08 PM com.google.javascript.jscomp.LoggerErrorManager println WARNING: .compiled/cljs/inferred_externs.js:22:0: WARNING - [JSC_UNDEFINED_EXTERN_VAR_ERROR] name goog is not defined in the externs. 22| goog.writeScriptTag__.apply; ^^^^ Feb 25, 2022 5:18:08 PM com.google.javascript.jscomp.LoggerErrorManager println WARNING: .compiled/cljs/inferred_externs.js:23:0: WARNING - [JSC_UNDEFINED_EXTERN_VAR_ERROR] name goog is not defined in the externs. 23| goog.isInModuleLoader_; ^^^^ Feb 25, 2022 5:18:08 PM com.google.javascript.jscomp.LoggerErrorManager println WARNING: .compiled/cljs/inferred_externs.js:24:0: WARNING - [JSC_UNDEFINED_EXTERN_VAR_ERROR] name goog is not defined in the externs. 24| goog.module; ^^^^ Feb 25, 2022 5:18:08 PM com.google.javascript.jscomp.LoggerErrorManager println WARNING: .compiled/cljs/inferred_externs.js:25:0: WARNING - [JSC_UNDEFINED_EXTERN_VAR_ERROR] name goog is not defined in the externs. 25| goog.module.getInternal_; ^^^^ Feb 25, 2022 5:18:08 PM com.google.javascript.jscomp.LoggerErrorManager println WARNING: .compiled/cljs/inferred_externs.js:26:0: WARNING - [JSC_UNDEFINED_EXTERN_VAR_ERROR] name goog is not defined in the externs. 26| goog.isProvided_; ^^^^ Feb 25, 2022 5:18:08 PM com.google.javascript.jscomp.LoggerErrorManager println WARNING: .compiled/cljs/inferred_externs.js:27:0: WARNING - [JSC_UNDEFINED_EXTERN_VAR_ERROR] name goog is not defined in the externs. 27| goog.cljsReloadAll_; ^^^^ Feb 25, 2022 5:18:08 PM com.google.javascript.jscomp.LoggerErrorManager printSummary WARNING: 0 error(s), 15 warning(s)"><y>#</y><d>2022-02-26</d><h>01:23</h><r>neilyio</r>Full error from the <code>build</code> call above:
<pre>Feb 25, 2022 5:17:37 PM com.google.javascript.jscomp.LoggerErrorManager println
WARNING: .compiled/cljs/inferred_externs.js:13:0: WARNING - [JSC_UNDEFINED_EXTERN_VAR_ERROR	] name goog is not defined in the externs.
  13| goog.dependencies_;
      ^^^^

Feb 25, 2022 5:17:37 PM com.google.javascript.jscomp.LoggerErrorManager println
WARNING: .compiled/cljs/inferred_externs.js:14:0: WARNING - [JSC_UNDEFINED_EXTERN_VAR_ERROR] name goog is not defined in the externs.
  14| goog.dependencies_.nameToPath;
      ^^^^

Feb 25, 2022 5:17:37 PM com.google.javascript.jscomp.LoggerErrorManager println
WARNING: .compiled/cljs/inferred_externs.js:15:0: WARNING - [JSC_UNDEFINED_EXTERN_VAR_ERROR] name goog is not defined in the externs.
  15| goog.dependencies_.visited;
      ^^^^

Feb 25, 2022 5:17:37 PM com.google.javascript.jscomp.LoggerErrorManager println
WARNING: .compiled/cljs/inferred_externs.js:16:0: WARNING - [JSC_UNDEFINED_EXTERN_VAR_ERROR] name goog is not defined in the externs.
  16| goog.dependencies_.written;
      ^^^^

Feb 25, 2022 5:17:37 PM com.google.javascript.jscomp.LoggerErrorManager println
WARNING: .compiled/cljs/inferred_externs.js:17:0: WARNING - [JSC_UNDEFINED_EXTERN_VAR_ERROR] name goog is not defined in the externs.
  17| goog.basePath;
      ^^^^

Feb 25, 2022 5:17:37 PM com.google.javascript.jscomp.LoggerErrorManager println
WARNING: .compiled/cljs/inferred_externs.js:18:0: WARNING - [JSC_UNDEFINED_EXTERN_VAR_ERROR] name goog is not defined in the externs.
  18| goog.writeScriptTag_;
      ^^^^

Feb 25, 2022 5:17:37 PM com.google.javascript.jscomp.LoggerErrorManager println
WARNING: .compiled/cljs/inferred_externs.js:19:0: WARNING - [JSC_UNDEFINED_EXTERN_VAR_ERROR] name goog is not defined in the externs.
  19| goog.require;
      ^^^^

Feb 25, 2022 5:17:37 PM com.google.javascript.jscomp.LoggerErrorManager println
WARNING: .compiled/cljs/inferred_externs.js:20:0: WARNING - [JSC_UNDEFINED_EXTERN_VAR_ERROR] name goog is not defined in the externs.
  20| goog.require__;
      ^^^^

Feb 25, 2022 5:17:37 PM com.google.javascript.jscomp.LoggerErrorManager println
WARNING: .compiled/cljs/inferred_externs.js:21:0: WARNING - [JSC_UNDEFINED_EXTERN_VAR_ERROR] name goog is not defined in the externs.
  21| goog.writeScriptTag__;
      ^^^^

Feb 25, 2022 5:17:37 PM com.google.javascript.jscomp.LoggerErrorManager println
WARNING: .compiled/cljs/inferred_externs.js:22:0: WARNING - [JSC_UNDEFINED_EXTERN_VAR_ERROR] name goog is not defined in the externs.
  22| goog.writeScriptTag__.apply;
      ^^^^

Feb 25, 2022 5:17:37 PM com.google.javascript.jscomp.LoggerErrorManager println
WARNING: .compiled/cljs/inferred_externs.js:23:0: WARNING - [JSC_UNDEFINED_EXTERN_VAR_ERROR] name goog is not defined in the externs.
  23| goog.isInModuleLoader_;
      ^^^^

Feb 25, 2022 5:17:37 PM com.google.javascript.jscomp.LoggerErrorManager println
WARNING: .compiled/cljs/inferred_externs.js:24:0: WARNING - [JSC_UNDEFINED_EXTERN_VAR_ERROR] name goog is not defined in the externs.
  24| goog.module;
      ^^^^

Feb 25, 2022 5:17:37 PM com.google.javascript.jscomp.LoggerErrorManager println
WARNING: .compiled/cljs/inferred_externs.js:25:0: WARNING - [JSC_UNDEFINED_EXTERN_VAR_ERROR] name goog is not defined in the externs.
  25| goog.module.getInternal_;
      ^^^^

Feb 25, 2022 5:17:37 PM com.google.javascript.jscomp.LoggerErrorManager println
WARNING: .compiled/cljs/inferred_externs.js:26:0: WARNING - [JSC_UNDEFINED_EXTERN_VAR_ERROR] name goog is not defined in the externs.
  26| goog.isProvided_;
      ^^^^

Feb 25, 2022 5:17:37 PM com.google.javascript.jscomp.LoggerErrorManager println
WARNING: .compiled/cljs/inferred_externs.js:27:0: WARNING - [JSC_UNDEFINED_EXTERN_VAR_ERROR] name goog is not defined in the externs.
  27| goog.cljsReloadAll_;
      ^^^^

Feb 25, 2022 5:17:37 PM com.google.javascript.jscomp.LoggerErrorManager printSummary
WARNING: 0 error(s), 15 warning(s)
Feb 25, 2022 5:18:08 PM com.google.javascript.jscomp.LoggerErrorManager println
WARNING: .compiled/cljs/inferred_externs.js:13:0: WARNING - [JSC_UNDEFINED_EXTERN_VAR_ERROR] name goog is not defined in the externs.
  13| goog.dependencies_;
      ^^^^

Feb 25, 2022 5:18:08 PM com.google.javascript.jscomp.LoggerErrorManager println
WARNING: .compiled/cljs/inferred_externs.js:14:0: WARNING - [JSC_UNDEFINED_EXTERN_VAR_ERROR] name goog is not defined in the externs.
  14| goog.dependencies_.nameToPath;
      ^^^^

Feb 25, 2022 5:18:08 PM com.google.javascript.jscomp.LoggerErrorManager println
WARNING: .compiled/cljs/inferred_externs.js:15:0: WARNING - [JSC_UNDEFINED_EXTERN_VAR_ERROR] name goog is not defined in the externs.
  15| goog.dependencies_.visited;
      ^^^^

Feb 25, 2022 5:18:08 PM com.google.javascript.jscomp.LoggerErrorManager println
WARNING: .compiled/cljs/inferred_externs.js:16:0: WARNING - [JSC_UNDEFINED_EXTERN_VAR_ERROR] name goog is not defined in the externs.
  16| goog.dependencies_.written;
      ^^^^

Feb 25, 2022 5:18:08 PM com.google.javascript.jscomp.LoggerErrorManager println
WARNING: .compiled/cljs/inferred_externs.js:17:0: WARNING - [JSC_UNDEFINED_EXTERN_VAR_ERROR] name goog is not defined in the externs.
  17| goog.basePath;
      ^^^^

Feb 25, 2022 5:18:08 PM com.google.javascript.jscomp.LoggerErrorManager println
WARNING: .compiled/cljs/inferred_externs.js:18:0: WARNING - [JSC_UNDEFINED_EXTERN_VAR_ERROR] name goog is not defined in the externs.
  18| goog.writeScriptTag_;
      ^^^^

Feb 25, 2022 5:18:08 PM com.google.javascript.jscomp.LoggerErrorManager println
WARNING: .compiled/cljs/inferred_externs.js:19:0: WARNING - [JSC_UNDEFINED_EXTERN_VAR_ERROR] name goog is not defined in the externs.
  19| goog.require;
      ^^^^

Feb 25, 2022 5:18:08 PM com.google.javascript.jscomp.LoggerErrorManager println
WARNING: .compiled/cljs/inferred_externs.js:20:0: WARNING - [JSC_UNDEFINED_EXTERN_VAR_ERROR] name goog is not defined in the externs.
  20| goog.require__;
      ^^^^

Feb 25, 2022 5:18:08 PM com.google.javascript.jscomp.LoggerErrorManager println
WARNING: .compiled/cljs/inferred_externs.js:21:0: WARNING - [JSC_UNDEFINED_EXTERN_VAR_ERROR] name goog is not defined in the externs.
  21| goog.writeScriptTag__;
      ^^^^

Feb 25, 2022 5:18:08 PM com.google.javascript.jscomp.LoggerErrorManager println
WARNING: .compiled/cljs/inferred_externs.js:22:0: WARNING - [JSC_UNDEFINED_EXTERN_VAR_ERROR] name goog is not defined in the externs.
  22| goog.writeScriptTag__.apply;
      ^^^^

Feb 25, 2022 5:18:08 PM com.google.javascript.jscomp.LoggerErrorManager println
WARNING: .compiled/cljs/inferred_externs.js:23:0: WARNING - [JSC_UNDEFINED_EXTERN_VAR_ERROR] name goog is not defined in the externs.
  23| goog.isInModuleLoader_;
      ^^^^

Feb 25, 2022 5:18:08 PM com.google.javascript.jscomp.LoggerErrorManager println
WARNING: .compiled/cljs/inferred_externs.js:24:0: WARNING - [JSC_UNDEFINED_EXTERN_VAR_ERROR] name goog is not defined in the externs.
  24| goog.module;
      ^^^^

Feb 25, 2022 5:18:08 PM com.google.javascript.jscomp.LoggerErrorManager println
WARNING: .compiled/cljs/inferred_externs.js:25:0: WARNING - [JSC_UNDEFINED_EXTERN_VAR_ERROR] name goog is not defined in the externs.
  25| goog.module.getInternal_;
      ^^^^

Feb 25, 2022 5:18:08 PM com.google.javascript.jscomp.LoggerErrorManager println
WARNING: .compiled/cljs/inferred_externs.js:26:0: WARNING - [JSC_UNDEFINED_EXTERN_VAR_ERROR] name goog is not defined in the externs.
  26| goog.isProvided_;
      ^^^^

Feb 25, 2022 5:18:08 PM com.google.javascript.jscomp.LoggerErrorManager println
WARNING: .compiled/cljs/inferred_externs.js:27:0: WARNING - [JSC_UNDEFINED_EXTERN_VAR_ERROR] name goog is not defined in the externs.
  27| goog.cljsReloadAll_;
      ^^^^

Feb 25, 2022 5:18:08 PM com.google.javascript.jscomp.LoggerErrorManager printSummary
WARNING: 0 error(s), 15 warning(s)</pre></z><z id="t1645838751" t="neilyio As additional context, the errors/warnings above donâ€™t actually make my build fail. They just start appearing as soon as I add (:require [weasel.repl :as repl]) . The problem really starts when I actually try to use weasel. With the user.cljs below: (ns cljs.user (:require [weasel.repl :as repl])) (when-not (repl/alive?) (repl/connect &quot;&quot;)) I get an error as soon as the browser loads: { &quot;message&quot;: &quot;Assertion failed: This browser does not support WebSocket&quot;, &quot;reportErrorToServer&quot;: true, &quot;messagePattern&quot;: &quot;Assertion failed: This browser does not support WebSocket&quot; }"><y>#</y><d>2022-02-26</d><h>01:25</h><r>neilyio</r>As additional context, the errors/warnings above donâ€™t actually make my build fail. They just start appearing as soon as I add <code>(:require [weasel.repl :as repl])</code>.

The problem really starts when I actually try to use weasel. With the <code>user.cljs</code> below:
<pre>(ns cljs.user
  (:require [weasel.repl :as repl]))

(when-not (repl/alive?)
  (repl/connect &quot;&quot;))</pre>
I get an error as soon as the browser loads:
<pre>{
    &quot;message&quot;: &quot;Assertion failed: This browser does not support WebSocket&quot;,
    &quot;reportErrorToServer&quot;: true,
    &quot;messagePattern&quot;: &quot;Assertion failed: This browser does not support WebSocket&quot;
}</pre></z><z id="t1647110217" t="Daniel Slutsky I&apos;ve been wondering about something. Some tools like to use nREPL middleware to listen to the user&apos;s code evaluations. For example, Reveal, Notespace, and the recent Portal-Clerk-Kindly-nREPL experiment ( https://github.com/scicloj/visual-tools-experiments/tree/main/portal-clerk-kindly-nrepl-1 ). As far as I understand, making it work always requires some setup on the user side. The required setup depends on the choice of tooling (clj, lein) x (CIDER, Calva, ... ) x (Reveal, Notespace, ...). Here is, for example, How to use Calva and Reveal together (with either clj or lein): https://calva.io/reveal/ It is quite nicely explained, but still could be troublesome for a new user, I think. What I&apos;m wondering about is whether and how such situations could be made easier."><y>#</y><d>2022-03-12</d><h>18:36</h><w>Daniel Slutsky</w>I&apos;ve been wondering about something.

Some tools like to use nREPL middleware to listen to the user&apos;s code evaluations.

For example, Reveal, Notespace, and the recent Portal-Clerk-Kindly-nREPL experiment (<a href="https://github.com/scicloj/visual-tools-experiments/tree/main/portal-clerk-kindly-nrepl-1" target="_blank">https://github.com/scicloj/visual-tools-experiments/tree/main/portal-clerk-kindly-nrepl-1</a>).

As far as I understand, making it work always requires some setup on the user side.
The required setup depends on the choice of tooling (clj, lein) x (CIDER, Calva, ... ) x (Reveal, Notespace, ...).

Here is, for example, <code>How to use Calva and Reveal together</code> (with either clj or lein): <a href="https://calva.io/reveal/" target="_blank">https://calva.io/reveal/</a>
It is quite nicely explained, but still could be troublesome for a new user, I think.

What I&apos;m wondering about is whether and how such situations could be made easier.</z><z id="t1647257110" t="bozhidar [:attrs {:href &quot;/_/_/users/U066L8B18&quot;}] If there&apos;s was a clear problem we are aiming to solve I guess we can do something about it."><y>#</y><d>2022-03-14</d><h>11:25</h><w>bozhidar</w><a>@daslu</a> If there&apos;s was a clear problem we are aiming to solve I guess we can do something about it.</z><z id="t1647257125" t="bozhidar &gt; Some tools like to use nREPL middleware to listen to the user&apos;s code evaluations. Can you expand on what do you mean by this?"><y>#</y><d>2022-03-14</d><h>11:25</h><w>bozhidar</w>&gt; Some tools like to use nREPL middleware to listen to the user&apos;s code evaluations.
Can you expand on what do you mean by this?</z><z id="t1647257703" t="Daniel Slutsky [:attrs {:href &quot;/_/_/users/U051BLM8F&quot;}] thanks, I guess what wrote was indeed a bit vague. ðŸ™ Here is what I have been practicing recently (in both CIDER and Calva): listening to user code evaluations through nREPL middleware, and sending the relevant values to Portal. Demo: https://www.youtube.com/watch?v=e3M4u1XIVTo&amp;amp;t=940s The related example project: https://github.com/scicloj/visual-tools-experiments/tree/main/portal-clerk-kindly-nrepl-1 Currently, some setup is needed (e.g., in the deps.edn file and the Emacs config). I am wondering about recommended practices for making it transparent to users. ðŸ™"><y>#</y><d>2022-03-14</d><h>11:35</h><r>Daniel Slutsky</r><a>@U051BLM8F</a> thanks, I guess what wrote was indeed a bit vague. <b>ðŸ™</b>

Here is what I have been practicing recently (in both CIDER and Calva): listening to user code evaluations through nREPL middleware, and sending the relevant values to Portal.

Demo: <a href="https://www.youtube.com/watch?v=e3M4u1XIVTo&amp;amp;t=940s" target="_blank">https://www.youtube.com/watch?v=e3M4u1XIVTo&amp;amp;t=940s</a>

The related example project: <a href="https://github.com/scicloj/visual-tools-experiments/tree/main/portal-clerk-kindly-nrepl-1" target="_blank">https://github.com/scicloj/visual-tools-experiments/tree/main/portal-clerk-kindly-nrepl-1</a>

Currently, some setup is needed (e.g., in the <code>deps.edn</code> file and the Emacs config).

I am wondering about recommended practices for making it transparent to users. <b>ðŸ™</b></z><z id="t1647261223" t="flowthing Curious why not tap&gt; ?"><y>#</y><d>2022-03-14</d><h>12:33</h><r>flowthing</r>Curious why not <code>tap&gt;</code>?</z><z id="t1647264775" t="Daniel Slutsky [:attrs {:href &quot;/_/_/users/U4ZDX466T&quot;}] We are hoping it would be possible to pick an existing piece of documentation -- e.g. this color tutorial: https://clojure2d.github.io/clojure2d/docs/notebooks/index.html#/notebooks/color.clj -- and then evaluate forms in the REPL and see the results in Portal, without any code change. I think (and maybe I&apos;m wrong) that needing to wrap with tap&gt; could be a bit of a nuisance for a user wishing to explore existing code examples. That is one of our short-term hopes at the #visual-tools group. (On the longer term, we are hoping we could listen to all user interactions in the editor &amp; REPL and automatically maintain a live-reloading document that makes sense out of them. Notespace v4 is one attempt of this kind (see the demo https://www.youtube.com/watch?v=uICA2SDa-ws ), but it is not complete yet, and not our current focus.)"><y>#</y><d>2022-03-14</d><h>13:32</h><r>Daniel Slutsky</r><a>@U4ZDX466T</a>
We are hoping it would be possible to pick an existing piece of documentation -- e.g. this color tutorial:
<a href="https://clojure2d.github.io/clojure2d/docs/notebooks/index.html#/notebooks/color.clj" target="_blank">https://clojure2d.github.io/clojure2d/docs/notebooks/index.html#/notebooks/color.clj</a>
-- and then evaluate forms in the REPL and see the results in Portal, without any code change.

I think (and maybe I&apos;m wrong) that needing to wrap with <code>tap&gt;</code> could be a bit of a nuisance for a user wishing to explore existing code examples.

That is one of our short-term hopes at the #visual-tools group.

(On the longer term, we are hoping we could listen to all user interactions in the editor &amp; REPL and automatically maintain a live-reloading document that makes sense out of them. Notespace v4 is one attempt of this kind (see the demo <a href="https://www.youtube.com/watch?v=uICA2SDa-ws" target="_blank">https://www.youtube.com/watch?v=uICA2SDa-ws</a>), but it is not complete yet, and not our current focus.)</z><z id="t1647265823" t="bozhidar Might be best file a ticket or some discussion on the subject and we can discuss this topic more there."><y>#</y><d>2022-03-14</d><h>13:50</h><r>bozhidar</r>Might be best file a ticket or some discussion on the subject and we can discuss this topic more there.</z><z id="t1647266490" t="Daniel Slutsky That is great, thanks [:attrs {:href &quot;/_/_/users/U051BLM8F&quot;}] -- an Issue at the nREPL repo, right? https://github.com/nrepl/nrepl"><y>#</y><d>2022-03-14</d><h>14:01</h><r>Daniel Slutsky</r>That is great, thanks <a>@U051BLM8F</a> -- an Issue at the nREPL repo, right?
<a href="https://github.com/nrepl/nrepl" target="_blank">https://github.com/nrepl/nrepl</a></z><z id="t1647268667" t="flowthing &gt; and then evaluate forms in the REPL and see the results in Portal, without any code change. I see, that makes sense. &gt; I think (and maybe I&apos;m wrong) that needing to wrap with tap&gt; could be a bit of a nuisance for a user wishing to explore existing code examples. I have a key binding that lets me evaluate (tap&gt; $0) , where $0 gets replaced with the form that&apos;s currently under my caret. I know it&apos;s not exactly the same thing, but just a thought."><y>#</y><d>2022-03-14</d><h>14:37</h><r>flowthing</r>&gt; and then evaluate forms in the REPL and see the results in Portal, without any code change.
I see, that makes sense.

&gt; I think (and maybe I&apos;m wrong) that needing to wrap with tap&gt; could be a bit of a nuisance for a user wishing to explore existing code examples.
I have a key binding that lets me evaluate <code>(tap&gt; $0)</code>, where <code>$0</code> gets replaced with the form that&apos;s currently under my caret. I know it&apos;s not exactly the same thing, but just a thought.</z><z id="t1647268930" t="Daniel Slutsky Nice!! Thanks, yes, eventually we might need some specific integration into specific environments (e.g., CIDER, Calva). I am just still hoping we would not need that, and find something that just works for any user. ðŸ˜Š"><y>#</y><d>2022-03-14</d><h>14:42</h><r>Daniel Slutsky</r>Nice!! Thanks, yes, eventually we might need some specific integration into specific environments (e.g., CIDER, Calva). I am just still hoping we would not need that, and find something that just works for any user. <b>ðŸ˜Š</b></z><z id="t1647269030" t="flowthing Certainly, that makes sense. An nREPL-based solution won&apos;t work for every user, although it certainly will for the vast majority."><y>#</y><d>2022-03-14</d><h>14:43</h><r>flowthing</r>Certainly, that makes sense. An nREPL-based solution won&apos;t work for every user, although it certainly will for the vast majority.</z><z id="t1647273112" t="Daniel Slutsky Created an issue here: https://github.com/nrepl/nrepl/issues/269 Thanks, [:attrs {:href &quot;/_/_/users/U051BLM8F&quot;}] &amp; [:attrs {:href &quot;/_/_/users/U4ZDX466T&quot;}] ."><y>#</y><d>2022-03-14</d><h>15:51</h><r>Daniel Slutsky</r>Created an issue here:
<a href="https://github.com/nrepl/nrepl/issues/269" target="_blank">https://github.com/nrepl/nrepl/issues/269</a>
Thanks, <a>@U051BLM8F</a> &amp; <a>@U4ZDX466T</a>.</z><z id="t1647440541" t="benny when running the nrepl, I have java sources included in the classpath but the repl doesnâ€™t seem to recognize them. can I only include compiled java on the classpath to consume in the repl?"><y>#</y><d>2022-03-16</d><h>14:22</h><w>benny</w>when running the nrepl, I have java sources included in the classpath but the repl doesnâ€™t seem to recognize them. can I only include compiled java on the classpath to consume in the repl?</z><z id="t1648453392" t="bozhidar Yeah, you need to compile the Java sources or use something like virgil to compile them for you."><y>#</y><d>2022-03-28</d><h>07:43</h><r>bozhidar</r>Yeah, you need to compile the Java sources or use something like virgil to compile them for you.</z><z id="t1648453415" t="bozhidar Perhaps we should document this somewhere, but as I rarely work with Java sources I completely forgot about this."><y>#</y><d>2022-03-28</d><h>07:43</h><r>bozhidar</r>Perhaps we should document this somewhere, but as I rarely work with Java sources I completely forgot about this.</z><z id="t1648279629" t="pez When Calva disconnects from the nREPL server I often see this error. Is it something we are doing wrong in Calva, or something wrong in nREPL?"><y>#</y><d>2022-03-26</d><h>07:27</h><w>pez</w>When Calva disconnects from the nREPL server I often see this error. Is it something we are doing wrong in Calva, or something wrong in nREPL?</z><z id="t1648453530" t="bozhidar I&apos;ve never seen this myself, it seems that the socket was closed before you tried to close the connection, which might be the result of a wrong sequence of operations. Might be best to open a ticket in the issue tracker so we won&apos;t forget to look into this more closely."><y>#</y><d>2022-03-28</d><h>07:45</h><r>bozhidar</r>I&apos;ve never seen this myself, it seems that the socket was closed before you tried to close the connection, which might be the result of a wrong sequence of operations. Might be best to open a ticket in the issue tracker so we won&apos;t forget to look into this more closely.</z><z id="t1648453575" t="bozhidar My availability continues to remain relatively low due to the war in Ukraine, but I hope things will improve soon."><y>#</y><d>2022-03-28</d><h>07:46</h><r>bozhidar</r>My availability continues to remain relatively low due to the war in Ukraine, but I hope things will improve soon.</z><z id="t1648384269" t="pez [:attrs {:href &quot;/_/_/users/U45T93RA6&quot;}] I&apos;m trying to add enrich-classpath support to Calva. I&apos;m at where the jack-in command looks like so when enrichment is enabled: lein update-in :dependencies conj &apos;[nrepl,&quot;0.9.0&quot;]&apos; -- update-in :plugins conj &apos;[cider/cider-nrepl,&quot;0.27.4&quot;]&apos; -- update-in :plugins conj &apos;[mx.cider/enrich-classpath,&quot;1.9.0&quot;]&apos; -- update-in &apos;[:repl-options,:nrepl-middleware]&apos; conj &apos;[&quot;cider.nrepl/cider-middleware&quot;]&apos; -- update-in &apos;[:repl-options,:nrepl-middleware]&apos; conj &apos;[&quot;cider.enrich-classpath/middleware&quot;]&apos; -- with-profile +repl repl :headless However, jacking in I see the nREPL server start, but can&apos;t see any activity from enrich-classpath. Do I need to do anything else for this to happen?"><y>#</y><d>2022-03-27</d><h>12:31</h><w>pez</w><a>@vemv</a> I&apos;m trying to add enrich-classpath support to Calva. I&apos;m at where the jack-in command looks like so when enrichment is enabled:
<pre>lein update-in :dependencies conj &apos;[nrepl,&quot;0.9.0&quot;]&apos; -- update-in :plugins conj &apos;[cider/cider-nrepl,&quot;0.27.4&quot;]&apos; -- update-in :plugins conj &apos;[mx.cider/enrich-classpath,&quot;1.9.0&quot;]&apos; -- update-in &apos;[:repl-options,:nrepl-middleware]&apos; conj &apos;[&quot;cider.nrepl/cider-middleware&quot;]&apos; -- update-in &apos;[:repl-options,:nrepl-middleware]&apos; conj &apos;[&quot;cider.enrich-classpath/middleware&quot;]&apos; -- with-profile +repl repl :headless</pre>
However, jacking in I see the nREPL server start, but can&apos;t see any activity from enrich-classpath. Do I need to do anything else for this to happen?</z><z id="t1648397768" t="vemv I&apos;ll be on it in a bit, in the meantime I&apos;d appreciate moving the convo to the Calva GH issue ðŸ˜‡"><y>#</y><d>2022-03-27</d><h>16:16</h><r>vemv</r>I&apos;ll be on it in a bit, in the meantime I&apos;d appreciate moving the convo to the Calva GH issue <b>ðŸ˜‡</b></z><z id="t1648398230" t="vemv enrich-classpath isn&apos;t nrepl middleware, it&apos;s Lein middleware Lein usage expects the plugin and Lein middleware to be activated"><y>#</y><d>2022-03-27</d><h>16:23</h><r>vemv</r>enrich-classpath isn&apos;t nrepl middleware, it&apos;s Lein middleware

Lein usage expects the plugin and Lein middleware to be activated</z><z id="t1648398263" t="vemv also note https://clojurians.slack.com/archives/GLRT1LZS6/p1648398031585609?thread_ts=1648390147.641379&amp;amp;cid=GLRT1LZS6 (`for the next iteration I&apos;m going to ditch the Lein plugin`)"><y>#</y><d>2022-03-27</d><h>16:24</h><r>vemv</r>also note <a href="https://clojurians.slack.com/archives/GLRT1LZS6/p1648398031585609?thread_ts=1648390147.641379&amp;amp;cid=GLRT1LZS6" target="_blank">https://clojurians.slack.com/archives/GLRT1LZS6/p1648398031585609?thread_ts=1648390147.641379&amp;amp;cid=GLRT1LZS6</a> (`for the next iteration I&apos;m going to ditch the Lein plugin`)</z><z id="t1648417095" t="borkdude [:attrs {:href &quot;/_/_/users/U0ETXRFEW&quot;}] FWIW, [:attrs {:href &quot;/_/_/users/UKFSJSM38&quot;}] and I are working on downloading the jdk classes locally in a cached zip file so they can be used for analysis + navigation. Perhaps calva could also use these. Adding the jdk as a git dep is fun, but probably a bad idea ;)"><y>#</y><d>2022-03-27</d><h>21:38</h><r>borkdude</r><a>@U0ETXRFEW</a> FWIW, <a>@UKFSJSM38</a> and I are working on downloading the jdk classes locally in a cached zip file so they can be used for analysis + navigation. Perhaps calva could also use these. Adding the jdk as a git dep is fun, but probably a bad idea ;)</z><z id="t1648418607" t="pez It might be a bad idea, but it seems something is broken when it throws errors like it did when I tried. "><y>#</y><d>2022-03-27</d><h>22:03</h><r>pez</r>It might be a bad idea, but it seems something is broken when it throws errors like it did when I tried. </z><z id="t1648448805" t="vemv downloading anything for the jdk is something I deliberately decided not to do. It&apos;s generally not necessary as the sources already are in the filesystem, along the JRE. enrich-classpath locates them, accurately for the precise jdk being used, and copies/zips/unzips them depending on what does one need to do (varies per JDK - 8 vs 9+) otherwise downloading jdks, besides from redundant (vs. what it&apos;s at hand already), seems prone to mismatches (e.g. different bugfix release, different distribution) or even licensing issues. in many Linux distros (but often not in CI!) sadly the sources are not installed along the JRE. In that case enrich-classpath simply logs a warn which is expanded in the README. It seems wise to let users understand the design of their distro and to have complete installation scripts (which means just running a one-liner)"><y>#</y><d>2022-03-28</d><h>06:26</h><r>vemv</r>downloading anything for the jdk is something I deliberately decided not to do. It&apos;s generally not necessary as the sources already are in the filesystem, along the JRE.

enrich-classpath locates them, accurately for the precise jdk being used, and copies/zips/unzips them depending on what does one need to do (varies per JDK - 8 vs 9+)

otherwise downloading jdks, besides from redundant (vs. what it&apos;s at hand already), seems prone to mismatches (e.g. different bugfix release, different distribution) or even licensing issues.

in many Linux distros (but often not in CI!) sadly the sources are not installed along the JRE. In that case enrich-classpath simply logs a warn which is expanded in the README. It seems wise to let users understand the design of their distro and to have complete installation scripts (which means just running a one-liner)</z><z id="t1648448979" t="vemv Even after solving the &quot;JDK sources&quot; problem, then you&apos;ll want to solve the &quot;Maven deps&apos; sources&quot; problem, and then &quot;Lein and tools.deps&quot; problem ...at which point you&apos;ve basically implemented enrich-classpath :) I&apos;d be super happy to receive an issue/PR if there&apos;s something that introduces friction. Other than that, like any decent program, Enrich is made of composable primitives which can be easily repurposed."><y>#</y><d>2022-03-28</d><h>06:29</h><r>vemv</r>Even after solving the &quot;JDK sources&quot; problem, then you&apos;ll want to solve the &quot;Maven deps&apos; sources&quot; problem, and then &quot;Lein and tools.deps&quot; problem

...at which point you&apos;ve basically implemented enrich-classpath :)

I&apos;d be super happy to receive an issue/PR if there&apos;s something that introduces friction. Other than that, like any decent program, Enrich is made of composable primitives which can be easily repurposed.</z><z id="t1648473913" t="ericdallo Thanks for the explanation [:attrs {:href &quot;/_/_/users/U45T93RA6&quot;}] , I was not aware that most JRE had src.zip available, that will make things better, would you mind elaborate or point to where enrich-classpath checks for JDK local? for clojure-lsp we may have the download as fallback but checking for local src.zip on specific places makes sense"><y>#</y><d>2022-03-28</d><h>13:25</h><r>ericdallo</r>Thanks for the explanation <a>@vemv</a>, I was not aware that most JRE had src.zip available, that will make things better, would you mind elaborate or point to where enrich-classpath checks for JDK local? for clojure-lsp we may have the download as fallback but checking for local src.zip on specific places makes sense</z><z id="t1648475045" t="ericdallo I think I https://github.com/clojure-emacs/enrich-classpath/blob/master/src/cider/enrich_classpath/jdk_sources.clj#L50"><y>#</y><d>2022-03-28</d><h>13:44</h><r>ericdallo</r>I think I <a href="https://github.com/clojure-emacs/enrich-classpath/blob/master/src/cider/enrich_classpath/jdk_sources.clj#L50" target="_blank">https://github.com/clojure-emacs/enrich-classpath/blob/master/src/cider/enrich_classpath/jdk_sources.clj#L50</a></z><z id="t1648478344" t="ericdallo I&apos;ll make some adaptations for clojure-lsp since that expects (System/getProperty &quot;java.home&quot;) is available, but for graal images it&apos;s not"><y>#</y><d>2022-03-28</d><h>14:39</h><r>ericdallo</r>I&apos;ll make some adaptations for clojure-lsp since that expects <code>(System/getProperty &quot;java.home&quot;)</code> is available, but for graal images it&apos;s not</z><z id="t1648486125" t="vemv :thumbsup: ! (worth emphasizing, this src.zip file is absent in many linux distros - the user would have to run sudo apt install openjdk-11-source or such - just like he would have to for many other purposes)"><y>#</y><d>2022-03-28</d><h>16:48</h><r>vemv</r><b>:thumbsup:</b> !

(worth emphasizing, this src.zip file is absent in many linux distros - the user would have to run <code>sudo apt install openjdk-11-source</code> or such - just like he would have to for many other purposes)</z><z id="t1648416419" t="pez I tried to add openjdk as a dependency in a project, like [:attrs {:href &quot;/_/_/users/U04V15CAJ&quot;}] does here: https://twitter.com/borkdude/status/1508156961958858757 But when the repl has started a ton of exceptions are thrown with the same type of error. clojure -Sdeps &apos;{:deps {nrepl/nrepl {:mvn/version,&quot;0.8.3&quot;},cider/cider-nrepl {:mvn/version,&quot;0.25.5&quot;}}}&apos; -M:repl -m nrepl.cmdline --middleware &quot;[cider.nrepl/cider-middleware]&quot; Checking out: at c2c0cb2a4372d78658326461562363de9a1a194f nREPL server started on port 58645 on host localhost - java.lang.NullPointerException: Cannot invoke &quot;jdk.javadoc.internal.doclets.formats.html.HtmlConfiguration.getOptions()&quot; because &quot;this.configuration&quot; is null at jdk.javadoc/jdk.javadoc.internal.doclets.formats.html.HtmlDoclet.getSupportedOptions(HtmlDoclet.java:426) at jdk.javadoc/jdk.javadoc.doclet.StandardDoclet.getSupportedOptions(StandardDoclet.java:93) at cider.nrepl.inlined_deps.orchard.v0v6v1.orchard.java.parser$parse_java$reify__4919.getSupportedOptions(parser.clj:77) at jdk.javadoc/jdk.javadoc.internal.tool.Start.getSupportedOptionsOf(Start.java:647) at jdk.javadoc/jdk.javadoc.internal.tool.Start.consumeDocletOption(Start.java:595) at jdk.javadoc/jdk.javadoc.internal.tool.Start.parseArgs(Start.java:801) at jdk.javadoc/jdk.javadoc.internal.tool.Start.parseAndExecute(Start.java:498) at jdk.javadoc/jdk.javadoc.internal.tool.Start.begin(Start.java:393) at jdk.javadoc/jdk.javadoc.internal.tool.Start.begin(Start.java:355) at jdk.javadoc/jdk.javadoc.internal.api.JavadocTaskImpl.call(JavadocTaskImpl.java:104) at cider.nrepl.inlined_deps.orchard.v0v6v1.orchard.java.parser$parse_java.invokeStatic(parser.clj:87) at cider.nrepl.inlined_deps.orchard.v0v6v1.orchard.java.parser$parse_java.invoke(parser.clj:64) at cider.nrepl.inlined_deps.orchard.v0v6v1.orchard.java.parser$source_info.invokeStatic(parser.clj:299) at cider.nrepl.inlined_deps.orchard.v0v6v1.orchard.java.parser$source_info.invoke(parser.clj:290) at clojure.lang.Var.invoke(Var.java:384) at cider.nrepl.inlined_deps.orchard.v0v6v1.orchard.java$class_info_STAR_.invokeStatic(java.clj:198) at cider.nrepl.inlined_deps.orchard.v0v6v1.orchard.java$class_info_STAR_.invoke(java.clj:189) at cider.nrepl.inlined_deps.orchard.v0v6v1.orchard.java$class_info.invokeStatic(java.clj:236) at cider.nrepl.inlined_deps.orchard.v0v6v1.orchard.java$class_info.invoke(java.clj:228) at cider.nrepl.inlined_deps.orchard.v0v6v1.orchard.java$eval5144$fn__5145.invoke(java.clj:403) at clojure.core$binding_conveyor_fn$fn__5754.invoke(core.clj:2030) at clojure.lang.AFn.call(AFn.java:18) at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264) at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) at java.base/java.lang.Thread.run(Thread.java:833) java.lang.NullPointerException: Cannot invoke &quot;jdk.javadoc.internal.doclets.formats.html.HtmlConfiguration.getOptions()&quot; because &quot;this.configuration&quot; is null at jdk.javadoc/jdk.javadoc.internal.doclets.formats.html.HtmlDoclet.getSupportedOptions(HtmlDoclet.java:426) at jdk.javadoc/jdk.javadoc.doclet.StandardDoclet.getSupportedOptions(StandardDoclet.java:93) ... And code navigation to Java sources does not start to happen."><y>#</y><d>2022-03-27</d><h>21:26</h><w>pez</w>I tried to add openjdk as a dependency in a project, like <a>@borkdude</a> does here: <a href="https://twitter.com/borkdude/status/1508156961958858757" target="_blank">https://twitter.com/borkdude/status/1508156961958858757</a> But when the repl has started a ton of exceptions are thrown with the same type of error.
<pre>clojure -Sdeps &apos;{:deps {nrepl/nrepl {:mvn/version,&quot;0.8.3&quot;},cider/cider-nrepl {:mvn/version,&quot;0.25.5&quot;}}}&apos; -M:repl -m nrepl.cmdline --middleware &quot;[cider.nrepl/cider-middleware]&quot;
Checking out:  at c2c0cb2a4372d78658326461562363de9a1a194f
nREPL server started on port 58645 on host localhost - 
java.lang.NullPointerException: Cannot invoke &quot;jdk.javadoc.internal.doclets.formats.html.HtmlConfiguration.getOptions()&quot; because &quot;this.configuration&quot; is null
        at jdk.javadoc/jdk.javadoc.internal.doclets.formats.html.HtmlDoclet.getSupportedOptions(HtmlDoclet.java:426)
        at jdk.javadoc/jdk.javadoc.doclet.StandardDoclet.getSupportedOptions(StandardDoclet.java:93)
        at cider.nrepl.inlined_deps.orchard.v0v6v1.orchard.java.parser$parse_java$reify__4919.getSupportedOptions(parser.clj:77)
        at jdk.javadoc/jdk.javadoc.internal.tool.Start.getSupportedOptionsOf(Start.java:647)
        at jdk.javadoc/jdk.javadoc.internal.tool.Start.consumeDocletOption(Start.java:595)
        at jdk.javadoc/jdk.javadoc.internal.tool.Start.parseArgs(Start.java:801)
        at jdk.javadoc/jdk.javadoc.internal.tool.Start.parseAndExecute(Start.java:498)
        at jdk.javadoc/jdk.javadoc.internal.tool.Start.begin(Start.java:393)
        at jdk.javadoc/jdk.javadoc.internal.tool.Start.begin(Start.java:355)
        at jdk.javadoc/jdk.javadoc.internal.api.JavadocTaskImpl.call(JavadocTaskImpl.java:104)
        at cider.nrepl.inlined_deps.orchard.v0v6v1.orchard.java.parser$parse_java.invokeStatic(parser.clj:87)
        at cider.nrepl.inlined_deps.orchard.v0v6v1.orchard.java.parser$parse_java.invoke(parser.clj:64)
        at cider.nrepl.inlined_deps.orchard.v0v6v1.orchard.java.parser$source_info.invokeStatic(parser.clj:299)
        at cider.nrepl.inlined_deps.orchard.v0v6v1.orchard.java.parser$source_info.invoke(parser.clj:290)
        at clojure.lang.Var.invoke(Var.java:384)
        at cider.nrepl.inlined_deps.orchard.v0v6v1.orchard.java$class_info_STAR_.invokeStatic(java.clj:198)
        at cider.nrepl.inlined_deps.orchard.v0v6v1.orchard.java$class_info_STAR_.invoke(java.clj:189)
        at cider.nrepl.inlined_deps.orchard.v0v6v1.orchard.java$class_info.invokeStatic(java.clj:236)
        at cider.nrepl.inlined_deps.orchard.v0v6v1.orchard.java$class_info.invoke(java.clj:228)
        at cider.nrepl.inlined_deps.orchard.v0v6v1.orchard.java$eval5144$fn__5145.invoke(java.clj:403)
        at clojure.core$binding_conveyor_fn$fn__5754.invoke(core.clj:2030)
        at clojure.lang.AFn.call(AFn.java:18)
        at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)
        at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)
        at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)
        at java.base/java.lang.Thread.run(Thread.java:833)
java.lang.NullPointerException: Cannot invoke &quot;jdk.javadoc.internal.doclets.formats.html.HtmlConfiguration.getOptions()&quot; because &quot;this.configuration&quot; is null
        at jdk.javadoc/jdk.javadoc.internal.doclets.formats.html.HtmlDoclet.getSupportedOptions(HtmlDoclet.java:426)
        at jdk.javadoc/jdk.javadoc.doclet.StandardDoclet.getSupportedOptions(StandardDoclet.java:93)
...</pre>
And code navigation to Java sources does not start to happen.</z><z id="t1649338991" t="manas_marthi How to embed clojure and nrepl in a spring boot app"><y>#</y><d>2022-04-07</d><h>13:43</h><w>manas_marthi</w>How to embed clojure and nrepl in a spring boot app</z><z id="t1649345852" t="plexus I don&apos;t know about spring boot in particular, but you can call any Clojure code from Java, this is explained here: https://clojure.org/reference/java_interop#_calling_clojure_from_java"><y>#</y><d>2022-04-07</d><h>15:37</h><w>plexus</w>I don&apos;t know about spring boot in particular, but you can call any Clojure code from Java, this is explained here: <a href="https://clojure.org/reference/java_interop#_calling_clojure_from_java" target="_blank">https://clojure.org/reference/java_interop#_calling_clojure_from_java</a></z><z id="t1649349803" t="manas_marthi Thanks plexus."><y>#</y><d>2022-04-07</d><h>16:43</h><w>manas_marthi</w>Thanks plexus.</z><z id="t1649349808" t="manas_marthi I found the answrr"><y>#</y><d>2022-04-07</d><h>16:43</h><w>manas_marthi</w>I found the answrr</z><z id="t1649349874" t="manas_marthi It is in https://GitHub.com/nrepl/nrepl-java-example"><y>#</y><d>2022-04-07</d><h>16:44</h><w>manas_marthi</w>It is in <a href="https://GitHub.com/nrepl/nrepl-java-example" target="_blank">https://GitHub.com/nrepl/nrepl-java-example</a></z><z id="t1649349926" t="manas_marthi Trying to figure out how to use clojure-maven-plugin to get the build clojure sources.."><y>#</y><d>2022-04-07</d><h>16:45</h><w>manas_marthi</w>Trying to figure out how to use clojure-maven-plugin to get the build clojure sources..</z><z id="t1649844339" t="manas_marthi I got it working using apache-storm pom.xml"><y>#</y><d>2022-04-13</d><h>10:05</h><r>manas_marthi</r>I got it working using apache-storm pom.xml</z><z id="t1649514852" t="Daniel Slutsky Clay is a new little tool that relies on nREPL middleware to respond to user evaluations of Clojure forms in their editor and REPL. https://scicloj.github.io/clay/#/notebooks/intro.clj Such recent experiences (with Clay, and previously with Notespace) have made me appreciate nREPL and middleware very much! ðŸ’œ One thing I am wondering about is how to make the setup seamless to the user. I am wondering whether the instructions I wrote at the Setup subsection in the document above make sense, and whether they could be made easier somehow. Any ideas? (For reference, added a comment to the related github issue as well: https://github.com/nrepl/nrepl/issues/269#issuecomment-1094043514 )"><y>#</y><d>2022-04-09</d><h>14:34</h><w>Daniel Slutsky</w>Clay is a new little tool that relies on nREPL middleware to respond to user evaluations of Clojure forms in their editor and REPL.
<a href="https://scicloj.github.io/clay/#/notebooks/intro.clj" target="_blank">https://scicloj.github.io/clay/#/notebooks/intro.clj</a>

Such recent experiences (with Clay, and previously with Notespace) have made me appreciate nREPL and middleware very much! <b>ðŸ’œ</b>

One thing I am wondering about is how to make the setup seamless to the user.
I am wondering whether the instructions I wrote at the <code>Setup</code> subsection in the document above make sense, and whether they could be made easier somehow.


Any ideas?

(For reference, added a comment to the related github issue as well:
<a href="https://github.com/nrepl/nrepl/issues/269#issuecomment-1094043514" target="_blank">https://github.com/nrepl/nrepl/issues/269#issuecomment-1094043514</a>)</z><z id="t1650297373" t="bozhidar [:attrs {:href &quot;/_/_/users/U066L8B18&quot;}] Looks cool! I&apos;ll take a closer look when I can, the past couple of months have been brutal for my OSS productivity. ðŸ˜ž"><y>#</y><d>2022-04-18</d><h>15:56</h><w>bozhidar</w><a>@daslu</a> Looks cool! I&apos;ll take a closer look when I can, the past couple of months have been brutal for my OSS productivity. <b>ðŸ˜ž</b></z><z id="t1650297543" t="Daniel Slutsky Thanks! These are more long-term thoughts, of course."><y>#</y><d>2022-04-18</d><h>15:59</h><r>Daniel Slutsky</r>Thanks!

These are more long-term thoughts, of course.</z><z id="t1650297443" t="bozhidar The instructions seem fine to me, although as Lein user I always appreciate it when people provide instructions for Lein as well. ðŸ™‚"><y>#</y><d>2022-04-18</d><h>15:57</h><w>bozhidar</w>The instructions seem fine to me, although as Lein user I always appreciate it when people provide instructions for Lein as well. <b>ðŸ™‚</b></z><z id="t1650297559" t="Daniel Slutsky Good idea to add Lein, thanks!"><y>#</y><d>2022-04-18</d><h>15:59</h><r>Daniel Slutsky</r>Good idea to add Lein, thanks!</z><z id="t1650569085" t="Daniel Slutsky edit: I should have used the cider-jack-in-nrepl-middlewares variable. sorry and thanks ðŸ™ ~{:tag :span, :attrs {:class &quot;username&quot;}, :content ({:tag :a, :attrs {:href &quot;/_/_/users/U051BLM8F&quot;}, :content (&quot;@bozhidar&quot;)})}~ ~The problem with the way I&apos;m recommending to use Clay is that it overrides the ~ ~{:tag :a, :attrs {:href &quot;https://github.com/scicloj/clay/blob/07b40a/examples/example-project/deps.edn#L7&quot;}, :content (&quot;https://github.com/scicloj/clay/blob/07b40a/examples/example-project/deps.edn#L7&quot;)}~ ~This means users will lose the usual middleware that is injected by packages such as sayid, java-decompiler, refactor-nrepl.~ ~So, if a tool like Clay wants to inject its own middleware in a graceful way, it needs an Emacs package, like Sayid and other tools have.~ ~Is that right?~"><y>#</y><d>2022-04-21</d><h>19:24</h><w>Daniel Slutsky</w>edit: I should have used the <code>cider-jack-in-nrepl-middlewares</code> variable.  sorry and thanks <b>ðŸ™</b>


~{:tag :span, :attrs {:class &quot;username&quot;}, :content ({:tag :a, :attrs {:href &quot;/_/_/users/U051BLM8F&quot;}, :content (&quot;@bozhidar&quot;)})}~

~The problem with the way I&apos;m recommending to use Clay is that it overrides the ~
~{:tag :a, :attrs {:href &quot;https://github.com/scicloj/clay/blob/07b40a/examples/example-project/deps.edn#L7&quot;}, :content (&quot;https://github.com/scicloj/clay/blob/07b40a/examples/example-project/deps.edn#L7&quot;)}~

~This means users will lose the usual middleware that is injected by packages such as sayid, java-decompiler, refactor-nrepl.~

~So, if a tool like Clay wants to inject its own middleware in a graceful way, it needs an Emacs package, like Sayid and other tools have.~
~Is that right?~</z><z id="t1650570319" t="genmeblog It may be related to this: https://github.com/nrepl/nrepl/issues/55"><y>#</y><d>2022-04-21</d><h>19:45</h><r>genmeblog</r>It may be related to this: <a href="https://github.com/nrepl/nrepl/issues/55" target="_blank">https://github.com/nrepl/nrepl/issues/55</a></z><z id="t1650621590" t="Daniel Slutsky [:attrs {:href &quot;/_/_/users/U1EP3BZ3Q&quot;}] explained to me that the following practice would work better: in .dir-locals.el : ((clojure-mode . ((eval . (add-to-list &apos;cider-jack-in-nrepl-middlewares &quot;scicloj.clay.v1.nrepl/middleware&quot;))))) "><y>#</y><d>2022-04-22</d><h>09:59</h><r>Daniel Slutsky</r><a>@tsulej</a> explained to me that the following practice would work better: in <code>.dir-locals.el</code> :
<pre>((clojure-mode . ((eval . (add-to-list &apos;cider-jack-in-nrepl-middlewares &quot;scicloj.clay.v1.nrepl/middleware&quot;)))))</pre>
</z><z id="t1650869203" t="bozhidar Yeah, you definite don&apos;t need a package per-se, unless you also want to provide some extra Emacs functionality."><y>#</y><d>2022-04-25</d><h>06:46</h><r>bozhidar</r>Yeah, you definite don&apos;t need a package per-se, unless you also want to provide some extra Emacs functionality.</z><z id="t1650869270" t="bozhidar As mentioned on GH, I don&apos;t think there&apos;s also an issue to recommend people to just update their main Emacs setup, if they want to be using some middleware all the time. And I like the concept of Lein plugins (as a Lein user). I never got to using clj much, that&apos;s why I still care a lot more about the experience for Lein users. ðŸ˜„"><y>#</y><d>2022-04-25</d><h>06:47</h><r>bozhidar</r>As mentioned on GH, I don&apos;t think there&apos;s also an issue to recommend people to just update their main Emacs setup, if they want to be using some middleware all the time. And I like the concept of Lein plugins (as a Lein user). I never got to using <code>clj</code> much, that&apos;s why I still care a lot more about the experience for Lein users. <b>ðŸ˜„</b></z><z id="t1650869583" t="Daniel Slutsky Thanks! And thank for this reminder to support Lein users, that is important. :)"><y>#</y><d>2022-04-25</d><h>06:53</h><r>Daniel Slutsky</r>Thanks!

And thank for this reminder to support Lein users, that is important. :)</z><z id="t1651436546" t="Daniel Slutsky By the way, the recommendation above &gt; ((clojure-mode . ((eval . (add-to-list &apos;cider-jack-in-nrepl-middlewares &quot;scicloj.clay.v1.nrepl/middleware&quot;))))) seems still problematic, since the middleware stays in the list afterwards, and that does not make sense if the user later opens another projects which does not need that middleware."><y>#</y><d>2022-05-01</d><h>20:22</h><r>Daniel Slutsky</r>By the way, the recommendation above
&gt;  <code>((clojure-mode . ((eval . (add-to-list &apos;cider-jack-in-nrepl-middlewares &quot;scicloj.clay.v1.nrepl/middleware&quot;)))))</code>
seems still problematic, since the middleware stays in the list afterwards, and that does not make sense if the user later opens another projects which does not need that middleware.</z><z id="t1650723482" t="Daniel Slutsky It turns out that CIDER has a variable cider-jack-in-nrepl-middlewares , that can be used to add middlewares to the clj command. [:attrs {:href &quot;/_/_/users/U0ETXRFEW&quot;}] do you know if Calva has such an option?"><y>#</y><d>2022-04-23</d><h>14:18</h><w>Daniel Slutsky</w>It turns out that CIDER has a variable <code>cider-jack-in-nrepl-middlewares</code>, that can be used to add middlewares to the clj command.

<a>@pez</a> do you know if Calva has such an option?</z><z id="t1650723871" t="pez We don&apos;t have that in Calva, but it should be pretty easy to add. Please file an issue about it. Meanwhile the closest you get is to use the Copy Jack-in command line to Clipboard command and then modify that one, starting your REPL from the command line and then use connect instead of Jack-in."><y>#</y><d>2022-04-23</d><h>14:24</h><r>pez</r>We don&apos;t have that in Calva, but it should be pretty easy to add. Please file an issue about it. Meanwhile the closest you get is to use the Copy Jack-in command line to Clipboard command and then modify that one, starting your REPL from the command line and then use connect instead of Jack-in.</z><z id="t1650723980" t="Daniel Slutsky Thanks!"><y>#</y><d>2022-04-23</d><h>14:26</h><r>Daniel Slutsky</r>Thanks!</z><z id="t1650724267" t="Daniel Slutsky Here: https://github.com/BetterThanTomorrow/calva/issues/1691 Thanks!"><y>#</y><d>2022-04-23</d><h>14:31</h><r>Daniel Slutsky</r>Here:
<a href="https://github.com/BetterThanTomorrow/calva/issues/1691" target="_blank">https://github.com/BetterThanTomorrow/calva/issues/1691</a>
Thanks!</z><z id="t1650870040" t="Daniel Slutsky Hi [:attrs {:href &quot;/_/_/users/U051BLM8F&quot;}] , following recent discussions of middleware, What I am wondering about is whether we could somehow avoid the need of user setup altogether in such a case (like the Clay tool), where all we need is to listen to user evaluations as they go through nREPL."><y>#</y><d>2022-04-25</d><h>07:00</h><w>Daniel Slutsky</w>Hi <a>@bozhidar</a>, following recent discussions of middleware,

What I am wondering about is whether we could somehow avoid the need of user setup altogether in such a case (like the Clay tool), where all we need is to listen to user evaluations as they go through nREPL.</z><z id="t1650874973" t="bozhidar Well, you can also inject the middleware dynamically at runtime, but this would still require some setup on the client-side. In general I can&apos;t think of an arrangement that would require 0 setup unless either clients setup this (via configuration or runtime injection) or it&apos;s part of the standard middleware bundled with nREPL."><y>#</y><d>2022-04-25</d><h>08:22</h><w>bozhidar</w>Well, you can also inject the middleware dynamically at runtime, but this would still require some setup on the client-side. In general I can&apos;t think of an arrangement that would require 0 setup unless either clients setup this (via configuration or runtime injection) or it&apos;s part of the standard middleware bundled with nREPL.</z><z id="t1650876209" t="Daniel Slutsky Thanks! Good to know. ðŸ™"><y>#</y><d>2022-04-25</d><h>08:43</h><r>Daniel Slutsky</r>Thanks! Good to know. <b>ðŸ™</b></z><z id="t1650876392" t="pez In Calva, for some features, we look for some â€contributionsâ€ (or whatever it should be called) among dependencies. [:attrs {:href &quot;/_/_/users/U02EMBDU2JU&quot;}] can describe it better than I can. Maybe we could do something like that for middleware... So if we find, say, a file named .editor-config/nrepl-middleware in the library, we can pick that up and use it to inject the middleware at runtime. Clay would be a dependency of the app, right?"><y>#</y><d>2022-04-25</d><h>08:46</h><r>pez</r>In Calva, for some features, we look for some â€contributionsâ€ (or whatever it should be called) among dependencies. <a>@U02EMBDU2JU</a> can describe it better than I can. Maybe we could do something like that for middleware... So if we find, say, a file named <code>.editor-config/nrepl-middleware</code> in the library, we can pick that up and use it to inject the middleware at runtime. Clay would be a dependency of the app, right?</z><z id="t1650878548" t="Daniel Slutsky Right. That sounds great. ðŸ™"><y>#</y><d>2022-04-25</d><h>09:22</h><r>Daniel Slutsky</r>Right. That sounds great. <b>ðŸ™</b></z><z id="t1650888061" t="Lukas Domagala [:attrs {:href &quot;/_/_/users/U0ETXRFEW&quot;}] do we have the capability to inject nrepl-middleware into a running process in Calva? Isnâ€™t that the â€œside-loaderâ€ bit that hasnâ€™t been finished yet?"><y>#</y><d>2022-04-25</d><h>12:01</h><r>Lukas Domagala</r><a>@U0ETXRFEW</a> do we have the capability to inject nrepl-middleware into a running process in Calva? Isnâ€™t that the â€œside-loaderâ€ bit that hasnâ€™t been finished yet?</z><z id="t1650888832" t="pez Could be, could be. If so we will have a use case here. ðŸ˜ƒ But idk, tbh. Would it be done via side-loading, [:attrs {:href &quot;/_/_/users/U051BLM8F&quot;}] ?"><y>#</y><d>2022-04-25</d><h>12:13</h><r>pez</r>Could be, could be. If so we will have a use case here. <b>ðŸ˜ƒ</b> But idk, tbh. Would it be done via side-loading, <a>@bozhidar</a>?</z><z id="t1650890541" t="Daniel Slutsky Thanks. IIUC, there is an (experimental) option of dynamic loading, where an nREPL client can ask an nREPL server to change its middleware: https://nrepl.org/nrepl/design/middleware.html#dynamic-middleware-loading That is something that Calva &amp; CIDER can use at runtime. The situation with a tool such as Clay, which is just a Clojure library, is maybe a bit different: even though it is running in the same JVM Clojure process as the nREPL server, it does not have a connection to the nREPL server and thus does not know how to send operations to it -- &quot;the camel does not see its own hump&quot;. (Or am I missing something?)"><y>#</y><d>2022-04-25</d><h>12:42</h><r>Daniel Slutsky</r>Thanks.

IIUC, there is an (experimental) option of dynamic loading, where an nREPL client can ask an nREPL server to change its middleware:
<a href="https://nrepl.org/nrepl/design/middleware.html#dynamic-middleware-loading" target="_blank">https://nrepl.org/nrepl/design/middleware.html#dynamic-middleware-loading</a>

That is something that Calva &amp; CIDER can use at runtime.

The situation with a tool such as Clay, which is just a Clojure library, is maybe a bit different: even though it is running in the same JVM Clojure process as the nREPL server, it does not have a connection to the nREPL server and thus does not know how to send operations to it -- &quot;the camel does not see its own hump&quot;.
(Or am I missing something?)</z><z id="t1650890964" t="Lukas Domagala You are right [:attrs {:href &quot;/_/_/users/U066L8B18&quot;}] , but calva does have the connection and we could add the middleware for you, similar to the https://calva.io/custom-commands/ I put into Calva. Adding the Calva side wouldn&apos;t be that hard. Not sure about the dynamic middleware loading bit, I&apos;d have to look deeper into that bit."><y>#</y><d>2022-04-25</d><h>12:49</h><r>Lukas Domagala</r>You are right <a>@U066L8B18</a>, but calva does have the connection and we could add the middleware for you, similar to the <a href="https://calva.io/custom-commands/" target="_blank">https://calva.io/custom-commands/</a> I put into Calva. Adding the Calva side wouldn&apos;t be that hard. Not sure about the dynamic middleware loading bit, I&apos;d have to look deeper into that bit.</z><z id="t1650891050" t="Lukas Domagala It would be helpful to have an example of the calls Calva would have to make to add the middleware, not sure if it&apos;s on use anywhere yet."><y>#</y><d>2022-04-25</d><h>12:50</h><r>Lukas Domagala</r>It would be helpful to have an example of the calls Calva would have to make to add the middleware, not sure if it&apos;s on use anywhere yet.</z><z id="t1650891155" t="Daniel Slutsky Thanks! I&apos;ll look into it later or tomorrow, to figure out the necessary nREPL ops."><y>#</y><d>2022-04-25</d><h>12:52</h><r>Daniel Slutsky</r>Thanks!

I&apos;ll look into it later or tomorrow, to figure out the necessary nREPL ops.</z><z id="t1651271657" t="Daniel Slutsky Hi [:attrs {:href &quot;/_/_/users/U02EMBDU2JU&quot;}] ! Here is the dynamic middleware example I promised a few days ago, thanks for your patience. ðŸ˜Š (ns scratch (:require [nrepl.server] [nrepl.core :as nrepl])) (defonce server (nrepl.server/start-server :port 1234)) ;; Adding the Clay middleware to the nREPL server using an op sent by an nREPL client: (with-open [conn (nrepl/connect :port 1234)] (-&gt; (nrepl/client conn 1000) (nrepl/message {:op &quot;add-middleware&quot; :middleware [&quot;scicloj.clay.v1.nrepl/middleware&quot;]}) doall println)) ;; To test it: (require &apos;[scicloj.clay.v1.api :as clay] &apos;[scicloj.clay.v1.tools :as tools]) (clay/restart! {:tools [tools/scittle]}) ;; Open the browser at localhost:1971 (with-open [conn (nrepl/connect :port 1234)] (-&gt; (nrepl/client conn 1000) (nrepl/message {:op &quot;eval&quot; :code &quot;(+ 1 2)&quot;}) doall println)) ;; You should see &quot;3&quot; printed in the browser, ;; which means the Clay middleware is working. "><y>#</y><d>2022-04-29</d><h>22:34</h><r>Daniel Slutsky</r>Hi <a>@U02EMBDU2JU</a>! Here is the dynamic middleware example I promised a few days ago, thanks for your patience. <b>ðŸ˜Š</b>

<pre>(ns scratch
  (:require [nrepl.server]
            [nrepl.core :as nrepl]))

(defonce server
  (nrepl.server/start-server :port 1234))

;; Adding the Clay middleware to the nREPL server using an op sent by an nREPL client:

(with-open [conn (nrepl/connect :port 1234)]
  (-&gt; (nrepl/client conn 1000)
      (nrepl/message {:op &quot;add-middleware&quot;
                      :middleware [&quot;scicloj.clay.v1.nrepl/middleware&quot;]})
      doall
      println))

;; To test it:

(require &apos;[scicloj.clay.v1.api :as clay]
         &apos;[scicloj.clay.v1.tools :as tools])

(clay/restart! {:tools [tools/scittle]})

;; Open the browser at localhost:1971

(with-open [conn (nrepl/connect :port 1234)]
  (-&gt; (nrepl/client conn 1000)
      (nrepl/message {:op &quot;eval&quot;
                      :code &quot;(+ 1 2)&quot;})
      doall
      println))

;; You should see &quot;3&quot; printed in the browser,
;; which means the Clay middleware is working.</pre>
</z><z id="t1651271742" t="Daniel Slutsky I learned it on this blog post by Arne: https://lambdaisland.com/blog/2021-11-24-making-nrepl-cider-more-dynamic-2"><y>#</y><d>2022-04-29</d><h>22:35</h><r>Daniel Slutsky</r>I learned it on this blog post by Arne:
<a href="https://lambdaisland.com/blog/2021-11-24-making-nrepl-cider-more-dynamic-2" target="_blank">https://lambdaisland.com/blog/2021-11-24-making-nrepl-cider-more-dynamic-2</a></z><z id="t1651271783" t="Daniel Slutsky To make the above example work, we need Clay as a dependency. https://clojars.org/org.scicloj/clay"><y>#</y><d>2022-04-29</d><h>22:36</h><r>Daniel Slutsky</r>To make the above example work, we need Clay as a dependency.
<a href="https://clojars.org/org.scicloj/clay" target="_blank">https://clojars.org/org.scicloj/clay</a></z><z id="t1651769839" t="Daniel Slutsky Following the various setup issues, and differences between Calva and CIDER, Lein and CLI, etc., I am wondering if I should abandon the nREPL-middleware approach and rely on tap&gt; . This would also require editor-specific setup, but it looks like the tap&gt; approach gets more community attention and would thus be more unsurprising and in harmony with other tools &amp; habits. Both CIDER and Calva offer ways to comfortably tap&gt; all evaluated values. https://github.com/clojure-emacs/cider/issues/3094 https://github.com/BetterThanTomorrow/calva/issues/1011 I&apos;ll explore that a bit. ðŸ™"><y>#</y><d>2022-05-05</d><h>16:57</h><r>Daniel Slutsky</r>Following the various setup issues, and differences between Calva and CIDER, Lein and CLI, etc., I am wondering if I should abandon the nREPL-middleware approach and rely on <code>tap&gt;</code> .

This would also require editor-specific setup, but it looks like the <code>tap&gt;</code> approach gets more community attention and would thus be more unsurprising and in harmony with other tools &amp; habits.

Both CIDER and Calva offer ways to comfortably <code>tap&gt;</code> all evaluated values.
<a href="https://github.com/clojure-emacs/cider/issues/3094" target="_blank">https://github.com/clojure-emacs/cider/issues/3094</a>
<a href="https://github.com/BetterThanTomorrow/calva/issues/1011" target="_blank">https://github.com/BetterThanTomorrow/calva/issues/1011</a>

I&apos;ll explore that a bit. <b>ðŸ™</b></z><z id="t1651769931" t="Daniel Slutsky &gt; You are right [:attrs {:href &quot;/_/_/users/U066L8B18&quot;}] , but calva does have the connection and we could add the middleware for you, similar to the https://calva.io/custom-commands/ I put into Calva. Adding the Calva side wouldn&apos;t be that hard. Not sure about the dynamic middleware loading bit, I&apos;d have to look deeper into that bit. [:attrs {:href &quot;/_/_/users/U02EMBDU2JU&quot;}] , following this kind suggestion above -- maybe it is better to wait a bit (unless you find it useful in general) -- since I am exploring the tap&gt; alternative."><y>#</y><d>2022-05-05</d><h>16:58</h><r>Daniel Slutsky</r>&gt;  You are right <a>@U066L8B18</a>, but calva does have the connection and we could add the middleware for you, similar to the <a href="https://calva.io/custom-commands/" target="_blank">https://calva.io/custom-commands/</a> I put into Calva. Adding the Calva side wouldn&apos;t be that hard. Not sure about the dynamic middleware loading bit, I&apos;d have to look deeper into that bit.
<a>@U02EMBDU2JU</a>, following this kind suggestion above -- maybe it is better to wait a bit (unless you find it useful in general) -- since I am exploring the <code>tap&gt;</code> alternative.</z><z id="t1651770230" t="Lukas Domagala Iâ€™m drowning in stuff anyway, so itâ€™s going to take some time from my side ðŸ˜› (I should have taken the clojurists together funding for something calva/lsp related ðŸ™‚ ) Iâ€™d love to get dynamic middleware into calva anyway, but I like your tap&gt; idea. Basing everything on nrepl seems fine, since CIDER + Calva sit on top of it, but if itâ€™s possible to also support cursive or socket repls it would be great"><y>#</y><d>2022-05-05</d><h>17:03</h><r>Lukas Domagala</r>Iâ€™m drowning in stuff anyway, so itâ€™s going to take some time from my side <b>ðŸ˜›</b> (I should have taken the clojurists together funding for something calva/lsp related <b>ðŸ™‚</b> )
Iâ€™d love to get dynamic middleware into calva anyway, but I like your tap&gt; idea. Basing everything on nrepl seems fine, since CIDER + Calva sit on top of it, but if itâ€™s possible to also support cursive or socket repls it would be great</z><z id="t1651770416" t="pez Cursive uses nREPL, doesn&apos;t it?"><y>#</y><d>2022-05-05</d><h>17:06</h><r>pez</r>Cursive uses nREPL, doesn&apos;t it?</z><z id="t1651770494" t="Lukas Domagala I thought cursive does mostly static analysis stuff and works with any repl? Iâ€™ve never been a cursive user though, [:attrs {:href &quot;/_/_/users/U0ETXRFEW&quot;}] immediately pulled me to the dark side ðŸ™‚"><y>#</y><d>2022-05-05</d><h>17:08</h><r>Lukas Domagala</r>I thought cursive does mostly static analysis stuff and works with any repl? Iâ€™ve never been a cursive user though, <a>@U0ETXRFEW</a> immediately pulled me to the dark side <b>ðŸ™‚</b></z><z id="t1651770553" t="pez Well, any repl would include nREPL?"><y>#</y><d>2022-05-05</d><h>17:09</h><r>pez</r>Well, any repl would include nREPL?</z><z id="t1651770794" t="Lukas Domagala True. My thinking was more along the lines of: Calva is probably happy to add some extra nREPL config stuff to enable sideloading and CIDER already has it, but if the editor isnâ€™t nrepl based it probably wouldnâ€™t want to add extra support for such things"><y>#</y><d>2022-05-05</d><h>17:13</h><r>Lukas Domagala</r>True. My thinking was more along the lines of: Calva is probably happy to add some extra nREPL config stuff to enable sideloading and CIDER already has it, but if the editor isnâ€™t nrepl based it probably wouldnâ€™t want to add extra support for such things</z><z id="t1651770848" t="Lukas Domagala And if the same effect thing can be done without extra middleware, itâ€™s going to be compatible in more situations."><y>#</y><d>2022-05-05</d><h>17:14</h><r>Lukas Domagala</r>And if the same effect thing can be done without extra middleware, itâ€™s going to be compatible in more situations.</z><z id="t1651771121" t="Daniel Slutsky Also with the middleware approach indeed we noticed some slightly different behaviors across different editor setups. E.g. Sometime some special eval ops are being sent. Also, could not make the eval listener work in Conjure, not sure why. Maybe relying on tapping would provide a more standardized behavior, as you said."><y>#</y><d>2022-05-05</d><h>17:18</h><r>Daniel Slutsky</r>Also with the middleware approach indeed we noticed some slightly different behaviors across different editor setups. E.g. Sometime some special eval ops are being sent.
Also, could not make the eval listener work in Conjure, not sure why. Maybe relying on tapping would provide a more standardized behavior, as you said.</z><z id="t1651771328" t="Lukas Domagala If tap&gt; doesnâ€™t do everything you want, it might be a good â€œbaseâ€ that works for everyone and we can have a richer experience in editors that support it or that are based on nrepl. Kind of like a website that works without js but has more features if you enable it."><y>#</y><d>2022-05-05</d><h>17:22</h><r>Lukas Domagala</r>If tap&gt; doesnâ€™t do everything you want, it might be a good â€œbaseâ€ that works for everyone and we can have a richer experience in editors that support it or that are based on nrepl. Kind of like a website that works without js but has more features if you enable it.</z><z id="t1651786475" t="Daniel Slutsky You were right, the tap&gt; case is indeed less informative -- we get the result value, but not the original code. Passing the code itself from the editor to Clojure would require some care of escaping, etc."><y>#</y><d>2022-05-05</d><h>21:34</h><r>Daniel Slutsky</r>You were right, the <code>tap&gt;</code> case is indeed less informative -- we get the result value, but not the original code.
Passing the code itself from the editor to Clojure would require some care of escaping, etc.</z><z id="t1651788187" t="Daniel Slutsky (.. but it looks like it will be ok, at least in Emacs)"><y>#</y><d>2022-05-05</d><h>22:03</h><r>Daniel Slutsky</r>(.. but it looks like it will be ok, at least in Emacs)</z><z id="t1651917590" t="bozhidar I&apos;m on vacation these days and I don&apos;t have much time for Slack, but I&apos;m certain that the middleware route is the better approach for most nREPL clients."><y>#</y><d>2022-05-07</d><h>09:59</h><r>bozhidar</r>I&apos;m on vacation these days and I don&apos;t have much time for Slack, but I&apos;m certain that the middleware route is the better approach for most nREPL clients.</z><z id="t1651917625" t="bozhidar Obviously we can get far with eval , but that&apos;s not without problems as well, especially when we factor in different Clojure implementations."><y>#</y><d>2022-05-07</d><h>10:00</h><r>bozhidar</r>Obviously we can get far with <code>eval</code>, but that&apos;s not without problems as well, especially when we factor in different Clojure implementations.</z><z id="t1651917671" t="bozhidar E.g. recently people were complaining that CIDER was evaluating some Clojure code here and there and this caused issues with different runtimes (e.g. bbn)."><y>#</y><d>2022-05-07</d><h>10:01</h><r>bozhidar</r>E.g. recently people were complaining that CIDER was evaluating some Clojure code here and there and this caused issues with different runtimes (e.g. bbn).</z><z id="t1651919527" t="Daniel Slutsky Thanks so much, [:attrs {:href &quot;/_/_/users/U051BLM8F&quot;}] , wishing you a good vacation. The important realization was that we needed some editor-specific setup (as you wrote in the beginning of this thread). Given that, the tap&gt; way can provide for our very basic needs at the moment, but it will be great to explore more of the nREPL way and its benefits."><y>#</y><d>2022-05-07</d><h>10:32</h><r>Daniel Slutsky</r>Thanks so much, <a>@bozhidar</a>, wishing you a good vacation.

The important realization was that we needed some editor-specific setup (as you wrote in the beginning of this thread).
Given that, the <code>tap&gt;</code> way can provide for our very basic needs at the moment, but it will be great to explore more of the nREPL way and its benefits.</z><z id="t1651684457" t="Jason is it possible to set nrepl.middleware.print/*quota* and nrepl.middleware.print/*print-fn* before or during server startup when using embedded nrepl?"><y>#</y><d>2022-05-04</d><h>17:14</h><w>Jason</w>is it possible to set
<pre>nrepl.middleware.print/*quota*</pre>
and
<pre>nrepl.middleware.print/*print-fn*</pre>
before or during server startup when using embedded nrepl?</z><z id="t1651770118" t="Daniel Slutsky Another thing I am wondering about following the recent middleware explorations: I understand that it is not possible to know the nREPL connection details (host and port) from within the runtime of the REPL itself -- the camel does not see its own hump. Is it intentional? Or would it be a good idea to look for a way to hack around it?"><y>#</y><d>2022-05-05</d><h>17:01</h><w>Daniel Slutsky</w>Another thing I am wondering about following the recent middleware explorations:

I understand that it is not possible to know the nREPL connection details (host and port) from within the runtime of the REPL itself -- the camel does not see its own hump.

Is it intentional?
Or would it be a good idea to look for a way to hack around it?</z><z id="t1652680816" t="bozhidar Well, if you started the server process from a REPL it&apos;d be pretty easy to figure out it&apos;s host/port. ðŸ™‚"><y>#</y><d>2022-05-16</d><h>06:00</h><w>bozhidar</w>Well, if you started the server process from a REPL it&apos;d be pretty easy to figure out it&apos;s host/port. <b>ðŸ™‚</b></z><z id="t1652682880" t="Daniel Slutsky Thanks! ðŸ™‚ My use case was being able to add a middleware at runtime, from a function call at the runtime itself (rather than from CIDER/Calva). This way, libraries would be able to add middleware without needing any editor-specific setup. (Does it make sense to desire that?) (Anyway, for me this use case is on hold at the moment. In the thread above, I decided to rely on other methods to listen to user evaluations, for now -- just to avoid the setup details that caused some confusion. I&apos;m hoping to explore the nREPL middeware option again in the future.)"><y>#</y><d>2022-05-16</d><h>06:34</h><r>Daniel Slutsky</r>Thanks! <b>ðŸ™‚</b>

My use case was being able to add a middleware at runtime, from a function call at the runtime itself (rather than from CIDER/Calva).
This way, libraries would be able to add middleware without needing any editor-specific setup.
(Does it make sense to desire that?)

(Anyway, for me this use case is on hold at the moment. In the thread above, I decided to rely on other methods to listen to user evaluations, for now -- just to avoid the setup details that caused some confusion. I&apos;m hoping to explore the nREPL middeware option again in the future.)</z><z id="t1652680902" t="bozhidar [:attrs {:href &quot;/_/_/users/U066L8B18&quot;}] Why do you need to extract those from the runtime? After all that&apos;s usually static type of information that&apos;s known at connection time."><y>#</y><d>2022-05-16</d><h>06:01</h><w>bozhidar</w><a>@daslu</a> Why do you need to extract those from the runtime? After all that&apos;s usually static type of information that&apos;s known at connection time.</z><z id="t1652680950" t="bozhidar There&apos;s:"><y>#</y><d>2022-05-16</d><h>06:02</h><w>bozhidar</w>There&apos;s:</z><z id="t1652680953" t="bozhidar --ack ACK-PORT Acknowledge the port of this server to another nREPL server running on ACK-PORT."><y>#</y><d>2022-05-16</d><h>06:02</h><w>bozhidar</w><pre>--ack ACK-PORT              Acknowledge the port of this server to another nREPL server running on ACK-PORT.</pre></z><z id="t1652680963" t="bozhidar But I doubt that&apos;s what you&apos;re looking for."><y>#</y><d>2022-05-16</d><h>06:02</h><w>bozhidar</w>But I doubt that&apos;s what you&apos;re looking for.</z><z id="t1655630998" t="victorb I have a script that launches a nrepl session, my editor and now I&apos;m trying to automatically start the server defined in my clojure application together with this. My approach is to wait for the .nrepl-port file to be available, and then doing something like echo &quot;(do (require &apos;my-app.core) (my-app.core/start-server))&quot; | clj -M:nREPL -m nrepl.cmdline --connect --port $(cat .nrepl-port) . The command works in itself, but it seems that not all namespaces are available even when nrepl starts accepting remote connections, so when I run this command, I&apos;m getting different exceptions each time about various namespaces not being available. I added a sleep 5 between checking for the .nrepl-port file and running the command, but this is brittle as sometimes it seems it takes even longer for the namespaces to be available, would depend on the general load of my system when running. So I guess the question is, anyone know of any better approach here? Or even, can I somehow wait for a namespace to be available before running the command? One idea is to have some sort of retry logic in my remote-sent command, so it&apos;ll retry for X times before accepting defeat, but maybe there is a better approach out there"><y>#</y><d>2022-06-19</d><h>09:29</h><w>victorb</w>I have a script that launches a nrepl session, my editor and now I&apos;m trying to automatically start the server defined in my clojure application together with this. My approach is to wait for the .nrepl-port file to be available, and then doing something like <code>echo &quot;(do (require &apos;my-app.core) (my-app.core/start-server))&quot; | clj -M:nREPL -m nrepl.cmdline --connect --port $(cat .nrepl-port)</code> . The command works in itself, but it seems that not all namespaces are available even when nrepl starts accepting remote connections, so when I run this command, I&apos;m getting different exceptions each time about various namespaces not being available. I added a <code>sleep 5</code> between checking for the .nrepl-port file and running the command, but this is brittle as sometimes it seems it takes even longer for the namespaces to be available, would depend on the general load of my system when running.

So I guess the question is, anyone know of any better approach here? Or even, can I somehow wait for a namespace to be available before running the command? One idea is to have some sort of retry logic in my remote-sent command, so it&apos;ll retry for X times before accepting defeat, but maybe there is a better approach out there</z><z id="t1655631121" t="victorb I guess another approach could be to embed the nrepl server in my application instead of launching it standalone, and then I can be sure that all the namespaces are available once the nrepl server is running, as it&apos;s running after the namespaces have been available"><y>#</y><d>2022-06-19</d><h>09:32</h><w>victorb</w>I guess another approach could be to embed the nrepl server in my application instead of launching it standalone, and then I can be sure that all the namespaces are available once the nrepl server is running, as it&apos;s running after the namespaces have been available</z><z id="t1659976888" t="danm ðŸ‘‹ :skin-tone-2: New to looking at the internals of nREPL, and I&apos;m trying to understand what&apos;s going on here. We launch a REPL within our application using the standard CIDER set of middleware. This works fine for my colleagues who use CIDER, they connect to it on a host and port and get all the output back that they expect. However it doesn&apos;t seem to work for those of us using Cursive. stderr messages are printed to the tty the REPL server is running in (a docker container, remote process on a K8s node, etc), but don&apos;t appear on my Cursive REPL session. Likewise, stdout from external applications that have been triggered from within our app (e.g. by using conch to shell out to something) appear in the remote tty but not my session. If I launch the REPL directly from Cursive using it&apos;s lein integration, I get the expected output, but of course that only works for a local REPL. Everything contained within Clojure/Java seems OK, but not anything going directly to the default *out* . The nREPL docs says that ls-middleware is a core operation ( https://nrepl.org/nrepl/ops.html#ls-middleware ), but I&apos;m failing to find it in the API docs to know what namespace to load to run it from, to at least verify that the expected middleware (`cider.nrepl/wrap-out` in this case, I believe) is even loaded. Can anyone point me in a good starting direction?"><y>#</y><d>2022-08-08</d><h>16:41</h><w>danm</w><b>ðŸ‘‹</b><b>:skin-tone-2:</b> New to looking at the internals of nREPL, and I&apos;m trying to understand what&apos;s going on here. We launch a REPL within our application using the standard CIDER set of middleware. This works fine for my colleagues who use CIDER, they connect to it on a host and port and get all the output back that they expect. However it doesn&apos;t seem to work for those of us using Cursive. <code>stderr</code> messages are printed to the tty the REPL server is running in (a docker container, remote process on a K8s node, etc), but don&apos;t appear on my Cursive REPL session. Likewise, <code>stdout</code> from external applications that have been triggered from within our app (e.g. by using <code>conch</code> to shell out to something) appear in the remote tty but not my session. If I launch the REPL directly from Cursive using it&apos;s <code>lein</code> integration, I get the expected output, but of course that only works for a local REPL. Everything contained within Clojure/Java seems OK, but not anything going directly to the default <code>*out*</code>.

The nREPL docs says that <code>ls-middleware</code> is a core operation (<a href="https://nrepl.org/nrepl/ops.html#ls-middleware" target="_blank">https://nrepl.org/nrepl/ops.html#ls-middleware</a>), but I&apos;m failing to find it in the API docs to know what namespace to load to run it from, to at least verify that the expected middleware (`cider.nrepl/wrap-out` in this case, I believe) is even loaded. Can anyone point me in a good starting direction?</z><z id="t1659977276" t="dpsutton you might want to send a message of â€œout-subscribeâ€ https://github.com/clojure-emacs/cider-nrepl/blob/master/src/cider/nrepl/middleware/out.clj#L180 When CIDER starts up it will run ;; Redirect the nREPL&apos;s terminal output to a REPL buffer. ;; If we don&apos;t do this the server&apos;s output will end up ;; in the *nrepl-server* buffer. (when (and cider-redirect-server-output-to-repl (cider-nrepl-op-supported-p &quot;out-subscribe&quot;)) (cider--subscribe-repl-to-server-out))"><y>#</y><d>2022-08-08</d><h>16:47</h><r>dpsutton</r>you might want to send a message of â€œout-subscribeâ€ <a href="https://github.com/clojure-emacs/cider-nrepl/blob/master/src/cider/nrepl/middleware/out.clj#L180" target="_blank">https://github.com/clojure-emacs/cider-nrepl/blob/master/src/cider/nrepl/middleware/out.clj#L180</a>

When CIDER starts up it will run
<pre>;; Redirect the nREPL&apos;s terminal output to a REPL buffer.
         ;; If we don&apos;t do this the server&apos;s output will end up
         ;; in the *nrepl-server* buffer.
         (when (and cider-redirect-server-output-to-repl
                    (cider-nrepl-op-supported-p &quot;out-subscribe&quot;))
           (cider--subscribe-repl-to-server-out))</pre></z><z id="t1659981012" t="danm Yessss, that&apos;s got it. Ta!"><y>#</y><d>2022-08-08</d><h>17:50</h><r>danm</r>Yessss, that&apos;s got it. Ta!</z><z id="t1659982385" t="Ivar Refsdal Hi, for cursive etc. you might want to look at this issue: https://github.com/nrepl/nrepl/issues/119 which links a gist that solves this issue."><y>#</y><d>2022-08-08</d><h>18:13</h><r>Ivar Refsdal</r>Hi, for cursive etc. you might want to look at this issue:
<a href="https://github.com/nrepl/nrepl/issues/119" target="_blank">https://github.com/nrepl/nrepl/issues/119</a>

which links a gist that solves this issue.</z><z id="t1660037787" t="cfleming Is the cider-redirect-server-output-to-repl part in that CIDER code snippet a config flag? Is this something the user has to opt-in to or is this on by default in CIDER?"><y>#</y><d>2022-08-09</d><h>09:36</h><r>cfleming</r>Is the <code>cider-redirect-server-output-to-repl</code> part in that CIDER code snippet a config flag? Is this something the user has to opt-in to or is this on by default in CIDER?</z><z id="t1660038997" t="dpsutton That&apos;s part of the code that runs when the repl connects. It&apos;s actually opt out. Unless they&apos;ve set some preference, if the repl supports it it subscribes out"><y>#</y><d>2022-08-09</d><h>09:56</h><r>dpsutton</r>That&apos;s part of the code that runs when the repl connects. It&apos;s actually opt out. Unless they&apos;ve set some preference, if the repl supports it it subscribes out</z><z id="t1659997576" t="cfleming Is it possible to dynamically load middleware from the client these days? Thinking about this issue: https://clojurians.slack.com/archives/C17JYSA3H/p1659976888613829 , it would be nice to be able to load the middleware from the client."><y>#</y><d>2022-08-08</d><h>22:26</h><w>cfleming</w>Is it possible to dynamically load middleware from the client these days? Thinking about this issue: <a href="https://clojurians.slack.com/archives/C17JYSA3H/p1659976888613829" target="_blank">https://clojurians.slack.com/archives/C17JYSA3H/p1659976888613829</a>, it would be nice to be able to load the middleware from the client.</z><z id="t1660004814" t="cfleming Actually, never mind me, Iâ€™ve just seen the add-middleware op."><y>#</y><d>2022-08-09</d><h>00:26</h><r>cfleming</r>Actually, never mind me, Iâ€™ve just seen the add-middleware op.</z><z id="t1660145236" t="plexus https://lambdaisland.com/blog/2021-11-24-making-nrepl-cider-more-dynamic-2"><y>#</y><d>2022-08-10</d><h>15:27</h><r>plexus</r><a href="https://lambdaisland.com/blog/2021-11-24-making-nrepl-cider-more-dynamic-2" target="_blank">https://lambdaisland.com/blog/2021-11-24-making-nrepl-cider-more-dynamic-2</a></z><z id="t1660191364" t="cfleming Thanks, very interesting! I hadnâ€™t seen that one before."><y>#</y><d>2022-08-11</d><h>04:16</h><r>cfleming</r>Thanks, very interesting! I hadnâ€™t seen that one before.</z><z id="t1660237346" t="borkdude Does nREPL have something for displaying stacktraces, e.g. by sending over stack trace data? Right now the stacktrace with babashka + CIDER isn&apos;t very useful, but bb does have useful data that it could send to the client"><y>#</y><d>2022-08-11</d><h>17:02</h><w>borkdude</w>Does nREPL have something for displaying stacktraces, e.g. by sending over stack trace data?
Right now the stacktrace with babashka + CIDER isn&apos;t very useful, but bb does have useful data that it could send to the client</z><z id="t1660237687" t="borkdude This is how the exception now displays. The ex-data contains the interpreter stacktrace"><y>#</y><d>2022-08-11</d><h>17:08</h><r>borkdude</r>This is how the exception now displays. The ex-data contains the interpreter stacktrace</z><z id="t1660237714" t="borkdude cc [:attrs {:href &quot;/_/_/users/U051BLM8F&quot;}]"><y>#</y><d>2022-08-11</d><h>17:08</h><r>borkdude</r>cc <a>@U051BLM8F</a></z><z id="t1660289033" t="bozhidar The only built-in facility currently is ex-info . cider-nrepl has an additional stracktrace middleware that can display structured stack traces, though. Both ex-info and stacktrace predate the addition of the rich ex-data that was added around Clojure 1.10 if I recall correctly."><y>#</y><d>2022-08-12</d><h>07:23</h><r>bozhidar</r>The only built-in facility currently is <code>ex-info</code>. <code>cider-nrepl</code> has an additional <code>stracktrace</code> middleware that can display structured stack traces, though. Both <code>ex-info</code> and <code>stacktrace</code> predate the addition of the rich <code>ex-data</code> that was added around Clojure 1.10 if I recall correctly.</z><z id="t1660289103" t="borkdude ex-data the function in clojure or is this something in nREPL?"><y>#</y><d>2022-08-12</d><h>07:25</h><r>borkdude</r><code>ex-data</code> the function in clojure or is this something in nREPL?</z><z id="t1660289136" t="borkdude [:attrs {:href &quot;/_/_/users/U051BLM8F&quot;}] Let&apos;s start with the most simple thing though: how do I communicate the file, line and column of an error to an nREPL client in 2022?"><y>#</y><d>2022-08-12</d><h>07:25</h><r>borkdude</r><a>@U051BLM8F</a> Let&apos;s start with the most simple thing though: how do I communicate the file, line and column of an error to an nREPL client in 2022?</z><z id="t1660289145" t="borkdude That already doesn&apos;t work properly for bb"><y>#</y><d>2022-08-12</d><h>07:25</h><r>borkdude</r>That already doesn&apos;t work properly for bb</z><z id="t1660289764" t="bozhidar Out of the box currently you can only supply an exception class and an error message for the failed eval: (&lt;-- id &quot;25&quot; session &quot;bdae3a62-a52e-46d4-959a-4ea1f6d1a735&quot; time-stamp &quot;2022-08-12 09:31:02.571684633&quot; err &quot;ArithmeticException Divide by zero clojure.lang.Numbers.divide (Numbers.java:158) &quot; ) (&lt;-- id &quot;25&quot; session &quot;bdae3a62-a52e-46d4-959a-4ea1f6d1a735&quot; time-stamp &quot;2022-08-12 09:31:02.574206251&quot; ex &quot;class java.lang.ArithmeticException&quot; root-ex &quot;class java.lang.ArithmeticException&quot; status (&quot;eval-error&quot;) )"><y>#</y><d>2022-08-12</d><h>07:36</h><r>bozhidar</r>Out of the box currently you can only supply an exception class and an error message for the failed eval:

<pre>(&lt;--
  id         &quot;25&quot;
  session    &quot;bdae3a62-a52e-46d4-959a-4ea1f6d1a735&quot;
  time-stamp &quot;2022-08-12 09:31:02.571684633&quot;
  err        &quot;ArithmeticException Divide by zero  clojure.lang.Numbers.divide (Numbers.java:158)
&quot;
)
(&lt;--
  id         &quot;25&quot;
  session    &quot;bdae3a62-a52e-46d4-959a-4ea1f6d1a735&quot;
  time-stamp &quot;2022-08-12 09:31:02.574206251&quot;
  ex         &quot;class java.lang.ArithmeticException&quot;
  root-ex    &quot;class java.lang.ArithmeticException&quot;
  status     (&quot;eval-error&quot;)
)</pre></z><z id="t1660289807" t="bozhidar The expectation is that clients will parse the err message and extract the filename and the location from it."><y>#</y><d>2022-08-12</d><h>07:36</h><r>bozhidar</r>The expectation is that clients will parse the <code>err</code> message and extract the filename and the location from it.</z><z id="t1660289907" t="bozhidar Probably it&apos;d be nice if we made this more flexible and made it possible to return the map with exception metadata as well, so newer clients would use it instead. (e.g. there could ex-data is the second eval-error message)"><y>#</y><d>2022-08-12</d><h>07:38</h><r>bozhidar</r>Probably it&apos;d be nice if we made this more flexible and made it possible to return the map with exception metadata as well, so newer clients would use it instead. (e.g. there could <code>ex-data</code> is the second <code>eval-error</code> message)</z><z id="t1660289956" t="borkdude The thing I&apos;d be interested in is have a data-driven way to make CIDER highlight the error in the right location in the babashka script"><y>#</y><d>2022-08-12</d><h>07:39</h><r>borkdude</r>The thing I&apos;d be interested in is have a data-driven way to make CIDER highlight the error in the right location in the babashka script</z><z id="t1660289969" t="borkdude This info is normally not on the ex-data"><y>#</y><d>2022-08-12</d><h>07:39</h><r>borkdude</r>This info is normally not on the ex-data</z><z id="t1660290081" t="bozhidar CIDER parses the err message (using a regular expression) and uses it to highlight an entire line as the cause of the exception. In the presence of the stacktrace middleware it gets more precise data from it."><y>#</y><d>2022-08-12</d><h>07:41</h><r>bozhidar</r>CIDER parses the err message (using a regular expression) and uses it to highlight an entire line as the cause of the exception. In the presence of the stacktrace middleware it gets more precise data from it.</z><z id="t1660290115" t="borkdude So if bb.nrepl printed the error in this format, it should work. I&apos;ll give that a try"><y>#</y><d>2022-08-12</d><h>07:41</h><r>borkdude</r>So if bb.nrepl printed the error in this format, it should work. I&apos;ll give that a try</z><z id="t1660290179" t="borkdude hmm wait"><y>#</y><d>2022-08-12</d><h>07:42</h><r>borkdude</r>hmm wait</z><z id="t1660290199" t="borkdude in ArithmeticException Divide by zero clojure.lang.Numbers.divide (Numbers.java:158) there is no reference to the user&apos;s clojure file where the error happened"><y>#</y><d>2022-08-12</d><h>07:43</h><r>borkdude</r>in <code>ArithmeticException Divide by zero  clojure.lang.Numbers.divide (Numbers.java:158)</code> there is no reference to the user&apos;s clojure file where the error happened</z><z id="t1660290206" t="borkdude so how is that going to work"><y>#</y><d>2022-08-12</d><h>07:43</h><r>borkdude</r>so how is that going to work</z><z id="t1660290604" t="bozhidar Bad example I guess - for most exceptions there&apos;s actually file in which the exception was raised. Probably / is defined in Numbers.java ."><y>#</y><d>2022-08-12</d><h>07:50</h><r>bozhidar</r>Bad example I guess - for most exceptions there&apos;s actually file in which the exception was raised. Probably <code>/</code> is defined in <code>Numbers.java</code>.</z><z id="t1660290658" t="bozhidar Perhaps nREPL can work harder to find the most relevant frame of the stacktrace - I guess that was the top frame and that&apos;s what we use by default. I haven&apos;t looked at this code in ages, so I don&apos;t remember well how it works at this point."><y>#</y><d>2022-08-12</d><h>07:50</h><r>bozhidar</r>Perhaps nREPL can work harder to find the most relevant frame of the stacktrace - I guess that was the top frame and that&apos;s what we use by default. I haven&apos;t looked at this code in ages, so I don&apos;t remember well how it works at this point.</z><z id="t1660290807" t="bozhidar Some examples from the tests in CIDER how we use this https://github.com/clojure-emacs/cider/blob/65a23e54227e3575f5a909dcfbdbbaef70d1438b/test/cider-error-parsing-tests.el"><y>#</y><d>2022-08-12</d><h>07:53</h><r>bozhidar</r>Some examples from the tests in CIDER how we use this <a href="https://github.com/clojure-emacs/cider/blob/65a23e54227e3575f5a909dcfbdbbaef70d1438b/test/cider-error-parsing-tests.el" target="_blank">https://github.com/clojure-emacs/cider/blob/65a23e54227e3575f5a909dcfbdbbaef70d1438b/test/cider-error-parsing-tests.el</a></z><z id="t1660990951" t="Lukas Domagala Iâ€™m trying to get nrepl eval to return metadata for our notebooks. I seem to be doing something wrong, just not sure what. Any ideas? -&gt; sent { id: &apos;47&apos;, op: &apos;eval&apos;, session: &apos;00da353e-8b48-4ff2-bc1c-972fb31f9a1b&apos;, code: &apos;^{:portal.viewer/default :portal.viewer/hiccup} [:h1 &quot;hello, world&quot;]&apos;, &apos;nrepl.middleware.print/options&apos;: { &apos;print-meta&apos;: true }, &apos;nrepl.middleware.print/print&apos;: &apos;cider.nrepl.pprint/pprint&apos;, file: &apos;/Users/lukas/Workspace/clojure/calva/test-data/notebook.clj&apos;, line: 29, column: 3, stdout: [Function: stdout], stderr: [Function: stderr], pprint: true } &lt;- received { id: &apos;47&apos;, ns: &apos;notebook&apos;, session: &apos;00da353e-8b48-4ff2-bc1c-972fb31f9a1b&apos;, value: &apos;[:h1 &quot;hello, world&quot;]&apos; }"><y>#</y><d>2022-08-20</d><h>10:22</h><w>Lukas Domagala</w>Iâ€™m trying to get nrepl eval to return metadata for our notebooks. I seem to be doing something wrong, just not sure what. Any ideas?
<pre>-&gt; sent
{
  id: &apos;47&apos;,
  op: &apos;eval&apos;,
  session: &apos;00da353e-8b48-4ff2-bc1c-972fb31f9a1b&apos;,
  code: &apos;^{:portal.viewer/default :portal.viewer/hiccup} [:h1 &quot;hello, world&quot;]&apos;,
  &apos;nrepl.middleware.print/options&apos;: { &apos;print-meta&apos;: true },
  &apos;nrepl.middleware.print/print&apos;: &apos;cider.nrepl.pprint/pprint&apos;,
  file: &apos;/Users/lukas/Workspace/clojure/calva/test-data/notebook.clj&apos;,
  line: 29,
  column: 3,
  stdout: [Function: stdout],
  stderr: [Function: stderr],
  pprint: true
}

&lt;- received
{
  id: &apos;47&apos;,
  ns: &apos;notebook&apos;,
  session: &apos;00da353e-8b48-4ff2-bc1c-972fb31f9a1b&apos;,
  value: &apos;[:h1 &quot;hello, world&quot;]&apos;
}</pre></z><z id="t1661167610" t="bozhidar [:attrs {:href &quot;/_/_/users/U02EMBDU2JU&quot;}] Have you seen this https://github.com/clojure-emacs/cider/issues/2791 ?"><y>#</y><d>2022-08-22</d><h>11:26</h><w>bozhidar</w><a>@domagala.lukas</a> Have you seen this <a href="https://github.com/clojure-emacs/cider/issues/2791" target="_blank">https://github.com/clojure-emacs/cider/issues/2791</a> ?</z><z id="t1661169431" t="Lukas Domagala Thank you for pointing me to that, it helped a lot! Itâ€™s still a little weird, but at least I have a workaround now. -&gt; sent { id: &apos;16&apos;, op: &apos;eval&apos;, session: &apos;8df8145d-ecfe-41e1-9e99-9e9ce33861aa&apos;, code: &apos;^{:portal.viewer/default :portal.viewer/hiccup}[:h1 &quot;hello, world&quot;]&apos;, file: &apos;/Users/lukas/Workspace/clojure/calva/test-data/notebook.clj&apos;, line: 37, column: 3, stdout: [Function: stdout], stderr: [Function: stderr], pprint: false, &apos;nrepl.middleware.print/print&apos;: &apos;nrepl.util.print/pr&apos;, &apos;nrepl.middleware.print/options&apos;: { &apos;print-meta&apos;: true } } &lt;- received { id: &apos;16&apos;, ns: &apos;notebook&apos;, session: &apos;8df8145d-ecfe-41e1-9e99-9e9ce33861aa&apos;, value: &apos;^#:portal.viewer{:default :portal.viewer/hiccup} [:h1 &quot;hello, world&quot;]&apos; } The weird thing is that the bug is apparently fixed in 1.10.2: https://clojure.atlassian.net/browse/CLJ-1445 And even if I send pprint false together with { â€˜print-metaâ€™: true } its not working. Ah well, Iâ€™m happy to just send both options for now and investigate it later. Thanks again!"><y>#</y><d>2022-08-22</d><h>11:57</h><r>Lukas Domagala</r>Thank you for pointing me to that, it helped a lot! Itâ€™s still a little weird, but at least I have a workaround now.
<pre>-&gt; sent
{
  id: &apos;16&apos;,
  op: &apos;eval&apos;,
  session: &apos;8df8145d-ecfe-41e1-9e99-9e9ce33861aa&apos;,
  code: &apos;^{:portal.viewer/default :portal.viewer/hiccup}[:h1 &quot;hello, world&quot;]&apos;,
  file: &apos;/Users/lukas/Workspace/clojure/calva/test-data/notebook.clj&apos;,
  line: 37,
  column: 3,
  stdout: [Function: stdout],
  stderr: [Function: stderr],
  pprint: false,
  &apos;nrepl.middleware.print/print&apos;: &apos;nrepl.util.print/pr&apos;,
  &apos;nrepl.middleware.print/options&apos;: { &apos;print-meta&apos;: true }
}

&lt;- received
{
  id: &apos;16&apos;,
  ns: &apos;notebook&apos;,
  session: &apos;8df8145d-ecfe-41e1-9e99-9e9ce33861aa&apos;,
  value: &apos;^#:portal.viewer{:default :portal.viewer/hiccup} [:h1 &quot;hello, world&quot;]&apos;
}</pre>
The weird thing is that the bug is apparently fixed in 1.10.2: <a href="https://clojure.atlassian.net/browse/CLJ-1445" target="_blank">https://clojure.atlassian.net/browse/CLJ-1445</a>
And even if I send pprint false together with { â€˜print-metaâ€™: true } its not working.
Ah well, Iâ€™m happy to just send both options for now and investigate it later. Thanks again!</z><z id="t1661432995" t="bozhidar You&apos;re welcome!"><y>#</y><d>2022-08-25</d><h>13:09</h><r>bozhidar</r>You&apos;re welcome!</z><z id="t1661433008" t="bozhidar FYI https://metaredux.com/posts/2022/08/25/nrepl-1-0.html"><y>#</y><d>2022-08-25</d><h>13:10</h><w>bozhidar</w>FYI <a href="https://metaredux.com/posts/2022/08/25/nrepl-1-0.html" target="_blank">https://metaredux.com/posts/2022/08/25/nrepl-1-0.html</a></z><z id="t1662003019" t="zhuxun2 When using tool.deps, how/where to specify options like :init-ns, :welcome, etc.?"><y>#</y><d>2022-09-01</d><h>03:30</h><w>zhuxun2</w>When using tool.deps, how/where to specify options like :init-ns, :welcome, etc.?</z><z id="t1662036730" t="bozhidar [:attrs {:href &quot;/_/_/users/U6SEJ4ZUH&quot;}] When using tools.deps you can only specify whatever cant be set via .nrepl.edn or the command-line flags."><y>#</y><d>2022-09-01</d><h>12:52</h><w>bozhidar</w><a>@zhuxun2</a> When using <code>tools.deps</code> you can only specify whatever cant be set via <code>.nrepl.edn</code> or the command-line flags.</z><z id="t1662036753" t="bozhidar FYI - TLS support is close https://github.com/nrepl/nrepl/pull/283"><y>#</y><d>2022-09-01</d><h>12:52</h><w>bozhidar</w>FYI - TLS support is close <a href="https://github.com/nrepl/nrepl/pull/283" target="_blank">https://github.com/nrepl/nrepl/pull/283</a></z><z id="t1665059059" t="Mikko Harju Hi! I embedded a repl with TTY-transport to my production app that I can access via VPN â€“ if I typo something (for instance forget a closing paren) the connection cuts off and I must redo everything â€“ could not find with a simple search how to handle that situation? ðŸ™‚"><y>#</y><d>2022-10-06</d><h>12:24</h><w>Mikko Harju</w>Hi! I embedded a repl with TTY-transport to my production app that I can access via VPN â€“ if I typo something (for instance forget a closing paren) the connection cuts off and I must redo everything â€“ could not find with a simple search how to handle that situation? <b>ðŸ™‚</b></z><z id="t1665077761" t="hiredman what do you mean the connection cuts off?"><y>#</y><d>2022-10-06</d><h>17:36</h><w>hiredman</w>what do you mean the connection cuts off?</z><z id="t1665129792" t="Mikko Harju user=&gt; ()) &lt;disconnected&gt; On the server it crashes with: 2022-10-07T07:57:30.247 app[57874099] fra [info] ERROR: 2022-10-07T07:57:30.247 app[57874099] fra [info] java.lang.RuntimeException: EOF while reading 2022-10-07T07:57:30.247 app[57874099] fra [info] at clojure.lang.Util.runtimeException(Util.java:221) .... 2022-10-07T08:01:53.561 app[57874099] fra [info] ERROR: 2022-10-07T08:01:53.561 app[57874099] fra [info] java.lang.RuntimeException: Unmatched delimiter: ) 2022-10-07T08:01:53.561 app[57874099] fra [info] at clojure.lang.Util.runtimeException(Util.java:221) 2022-10-07T08:01:53.561 app[57874099] fra [info] at clojure.lang.LispReader$UnmatchedDelimiterReader.invoke(LispReader.java:1373) .... `"><y>#</y><d>2022-10-07</d><h>08:03</h><r>Mikko Harju</r><pre>user=&gt; ())

&lt;disconnected&gt;</pre>
On the server it crashes with:

<pre>2022-10-07T07:57:30.247 app[57874099] fra [info] ERROR:

2022-10-07T07:57:30.247 app[57874099] fra [info] java.lang.RuntimeException: EOF while reading

2022-10-07T07:57:30.247 app[57874099] fra [info] at clojure.lang.Util.runtimeException(Util.java:221)
....
2022-10-07T08:01:53.561 app[57874099] fra [info] ERROR:

2022-10-07T08:01:53.561 app[57874099] fra [info] java.lang.RuntimeException: Unmatched delimiter: )

2022-10-07T08:01:53.561 app[57874099] fra [info] at clojure.lang.Util.runtimeException(Util.java:221)

2022-10-07T08:01:53.561 app[57874099] fra [info] at clojure.lang.LispReader$UnmatchedDelimiterReader.invoke(LispReader.java:1373)
....
</pre>`</z><z id="t1666689060" t="JÃ©rÃ©mie Salvucci Hi, I&apos;m using Emacs to write Clojure. It&apos;s quite easy from Emacs to select a namespace based on the project I&apos;m working on. However, teammates can use different editors and I&apos;d like to find a nice way to open a specific namespace. I&apos;m using deps.edn where I have an alias to run nrepl and it defaults to user namespace. Does somebody know how to deal with this?"><y>#</y><d>2022-10-25</d><h>09:11</h><w>JÃ©rÃ©mie Salvucci</w>Hi, I&apos;m using Emacs to write Clojure. It&apos;s quite easy from Emacs to select a namespace based on the project I&apos;m working on. However, teammates can use different editors and I&apos;d like to find a nice way to open a specific namespace. I&apos;m using deps.edn where I have an alias to run nrepl and it defaults to user namespace. Does somebody know how to deal with this?</z><z id="t1666821079" t="JÃ©rÃ©mie Salvucci So right now, I use different classpaths + user.clj to get the wanted behavior. Not fully satisfying but it works well"><y>#</y><d>2022-10-26</d><h>21:51</h><r>JÃ©rÃ©mie Salvucci</r>So right now, I use different classpaths + user.clj to get the wanted behavior. Not fully satisfying but it works well</z><z id="t1669841849" t="orestis Can nREPL servers send unsolicited messages back to clients? Example, a nREPL server could insert a tap&gt; sink, and forward tapped data to the nREPL client (e.g. an editor)"><y>#</y><d>2022-11-30</d><h>20:57</h><w>orestis</w>Can nREPL servers send unsolicited messages back to clients? Example, a nREPL server could insert a tap&gt; sink, and forward tapped data to the nREPL client (e.g. an editor)</z><z id="t1669843337" t="phronmophobic I&apos;m pretty sure that&apos;s how printing works. The server listens to stdout/stderr and forwards those to the nrepl client for the editor to print."><y>#</y><d>2022-11-30</d><h>21:22</h><r>phronmophobic</r>I&apos;m pretty sure that&apos;s how printing works. The server listens to stdout/stderr and forwards those to the nrepl client for the editor to print.</z><z id="t1669843514" t="dpsutton this happens because nrepl provides a â€œsubscribe-outâ€ operation which closes over the transport (i think). I donâ€™t think thereâ€™s an easy way to ad-hoc send things back without changing some code in nrepl"><y>#</y><d>2022-11-30</d><h>21:25</h><r>dpsutton</r>this happens because nrepl provides a â€œsubscribe-outâ€ operation which closes over the transport (i think). I donâ€™t think thereâ€™s an easy way to ad-hoc send things back without changing some code in nrepl</z><z id="t1669844587" t="phronmophobic It&apos;s been a while since I&apos;ve looked at this, but I think something like the following should work: â€¢ create a middleware that requires the eval middleware â€¢ idempotently add a tap that will send a message to the client "><y>#</y><d>2022-11-30</d><h>21:43</h><r>phronmophobic</r>It&apos;s been a while since I&apos;ve looked at this, but I think something like the following should work:
â€¢ create a middleware that requires the eval middleware
â€¢ idempotently add a tap that will send a message to the client
</z><z id="t1670585775" t="dev-hartmann hey folks, quick question"><y>#</y><d>2022-12-09</d><h>11:36</h><w>dev-hartmann</w>hey folks, quick question</z><z id="t1670585861" t="dev-hartmann I created this alias in my deps.edn to start portal, but the code inside the :main-opts â€œ-eâ€ will not be called"><y>#</y><d>2022-12-09</d><h>11:37</h><w>dev-hartmann</w>I created this alias in my deps.edn to start portal, but the code inside the :main-opts â€œ-eâ€ will not be called</z><z id="t1670585864" t="dev-hartmann :portal {:extra-deps {cider/cider-nrepl {:mvn/version &quot;0.28.5&quot;} djblue/portal {:mvn/version &quot;0.35.0&quot;}} :main-opts [&quot;-m&quot; &quot;nrepl.cmdline&quot; &quot;--middleware&quot; &quot;[portal.nrepl/wrap-portal, cider.nrepl/cider-middleware]&quot; &quot;-e&quot; &quot;(require,&apos;[portal.api,:as,p]),(def,p,(p/open))&quot;]}"><y>#</y><d>2022-12-09</d><h>11:37</h><w>dev-hartmann</w><pre>:portal {:extra-deps {cider/cider-nrepl {:mvn/version &quot;0.28.5&quot;}
                                 djblue/portal     {:mvn/version &quot;0.35.0&quot;}}
                    :main-opts [&quot;-m&quot; &quot;nrepl.cmdline&quot;
                                &quot;--middleware&quot; &quot;[portal.nrepl/wrap-portal, cider.nrepl/cider-middleware]&quot;
                                &quot;-e&quot; &quot;(require,&apos;[portal.api,:as,p]),(def,p,(p/open))&quot;]}</pre></z><z id="t1670594497" t="dpsutton clojure.main understands an option -e https://github.com/clojure/clojure/blob/master/src/clj/clojure/main.clj#L499 But you arenâ€™t calling this main entry point, you are calling nrepl.cmdline which doesnâ€™t support that option"><y>#</y><d>2022-12-09</d><h>14:01</h><r>dpsutton</r><code>clojure.main</code> understands an option <code>-e</code> <a href="https://github.com/clojure/clojure/blob/master/src/clj/clojure/main.clj#L499" target="_blank">https://github.com/clojure/clojure/blob/master/src/clj/clojure/main.clj#L499</a>
But you arenâ€™t calling this main entry point, you are calling <code>nrepl.cmdline</code> which doesnâ€™t support that option</z><z id="t1670594595" t="dev-hartmann Ah, i See. So i have to manually load that code later."><y>#</y><d>2022-12-09</d><h>14:03</h><r>dev-hartmann</r>Ah, i See. So i have to manually load that code later.</z><z id="t1670594602" t="dev-hartmann Thx!"><y>#</y><d>2022-12-09</d><h>14:03</h><r>dev-hartmann</r>Thx!</z><z id="t1670585933" t="dev-hartmann any hints why this isnâ€™t working?"><y>#</y><d>2022-12-09</d><h>11:38</h><w>dev-hartmann</w>any hints why this isnâ€™t working?</z><z id="t1670940630" t="7e27 Hi:) I&apos;m not sure if this is the right place to ask this question, but I have a remote server that also starts an nrepl on a socket, doing something like (nrpel/start-server :socket &quot;/tmp/hello.nrepl&quot;) . Is there a way to connect to that socket from cider?"><y>#</y><d>2022-12-13</d><h>14:10</h><w>7e27</w>Hi:) I&apos;m not sure if this is the right place to ask this question, but I have a remote server that also starts an nrepl on a socket, doing something like <code>(nrpel/start-server :socket &quot;/tmp/hello.nrepl&quot;)</code> . Is there a way to connect to that socket from cider?</z><z id="t1670941084" t="7e27 I&apos;m thinking about connecting to the remote server via ssh, and starting a new nrepl process that proxies to the already running service, and then connect to that from cider via an ssh tunnel. clj -Sdeps &apos;{:deps {nrepl/nrepl {:mvn/version &quot;1.0.0&quot;} cider/cider-nrepl {:mvn/version &quot;0.28.5&quot;}} :aliases {:cider/nrepl {:main-opts [&quot;-m&quot; &quot;nrepl.cmdline&quot; &quot;--middleware&quot; &quot;[cider.nrepl/cider-middleware]&quot;]}}}&apos; -M:cider/nrepl -b 0.0.0.0 -p 11111 -c -s &quot;/tmp/hello.nrepl&quot; Isn&apos;t working, but it&apos;s something like that I&apos;m looking for, or is there a better way?"><y>#</y><d>2022-12-13</d><h>14:18</h><w>7e27</w>I&apos;m thinking about connecting to the remote server via ssh, and starting a new nrepl process that proxies to the already running service, and then connect to that from cider via an ssh tunnel.
<pre>clj -Sdeps &apos;{:deps {nrepl/nrepl {:mvn/version &quot;1.0.0&quot;} cider/cider-nrepl {:mvn/version &quot;0.28.5&quot;}} :aliases {:cider/nrepl {:main-opts [&quot;-m&quot; &quot;nrepl.cmdline&quot; &quot;--middleware&quot; &quot;[cider.nrepl/cider-middleware]&quot;]}}}&apos; -M:cider/nrepl -b 0.0.0.0 -p 11111 -c -s &quot;/tmp/hello.nrepl&quot;</pre>
Isn&apos;t working, but it&apos;s something like that I&apos;m looking for, or is there a better way?</z><z id="t1671004283" t="7e27 Yeah, you&apos;re right, it might be too complicated, and what you are suggesting could definitely be a solution, thanks:) I think I just wanted to see how to make use of the socket option in nrepl, and at the same time I&apos;m a bit concerned about exposing the repl on the network."><y>#</y><d>2022-12-14</d><h>07:51</h><r>7e27</r>Yeah, you&apos;re right, it might be too complicated, and what you are suggesting could definitely be a solution, thanks:) I think I just wanted to see how to make use of the socket option in nrepl, and at the same time I&apos;m a bit concerned about exposing the repl on the network.</z><z id="t1671456440" t="bozhidar [:attrs {:href &quot;/_/_/users/UMUPLHXRV&quot;}] Have you read the docs about Unix sockets https://docs.cider.mx/cider/basics/up_and_running.html#connecting-via-unix-domain-file-socket"><y>#</y><d>2022-12-19</d><h>13:27</h><w>bozhidar</w><a>@7e27</a> Have you read the docs about Unix sockets <a href="https://docs.cider.mx/cider/basics/up_and_running.html#connecting-via-unix-domain-file-socket" target="_blank">https://docs.cider.mx/cider/basics/up_and_running.html#connecting-via-unix-domain-file-socket</a></z><z id="t1673437306" t="7e27 Thanks for sharing! I have read it, but somehow missed the part of it being experimental - so thank you:)"><y>#</y><d>2023-01-11</d><h>11:41</h><r>7e27</r>Thanks for sharing! I have read it, but somehow missed the part of it being experimental - so thank you:)</z><z id="t1672754294" t="pez I run into problems trying to inject nrepl middleware in Leiningen projects. I&apos;ll paste the repro in a comment."><y>#</y><d>2023-01-03</d><h>13:58</h><w>pez</w>I run into problems trying to inject nrepl middleware in Leiningen projects. I&apos;ll paste the repro in a comment.</z><z id="t1672754370" t="pez Here I create a new lein project and try to inject cider-middleware: ~/Projects/tests(:|âœ”) % lein new new-leiningen Generating a project called new-leiningen based on the &apos;default&apos; template. The default template is intended for library projects, not applications. To see other templates (app, plugin, etc), try `lein help new`. ~/Projects/tests(:|âœ”) % cd new-leiningen ~/Projects/tests/new-leiningen(:|âœ”) % lein update-in :dependencies conj &apos;[nrepl,&quot;1.0.0&quot;]&apos; -- update-in :plugins conj &apos;[cider/cider-nrepl,&quot;0.28.5&quot;]&apos; -- update-in :repl-options:nrepl-middleware conj &apos;[cider.nrepl/cider-middleware]&apos; -- repl :headless ERROR: java.io.FileNotFoundException: Could not locate [[cider/nrepl__init.class, [[cider/nrepl.clj or [[cider/nrepl.cljc on classpath. at clojure.lang.RT.load(RT.java:462) at clojure.lang.RT.load(RT.java:424) at clojure.core$load$fn__6908.invoke(core.clj:6161) at clojure.core$load.invokeStatic(core.clj:6160) at clojure.core$load.doInvoke(core.clj:6144) at clojure.lang.RestFn.invoke(RestFn.java:408) at clojure.core$load_one.invokeStatic(core.clj:5933) at clojure.core$load_one.invoke(core.clj:5928) at clojure.core$load_lib$fn__6850.invoke(core.clj:5975) at clojure.core$load_lib.invokeStatic(core.clj:5974) at clojure.core$load_lib.doInvoke(core.clj:5953) at clojure.lang.RestFn.applyTo(RestFn.java:142) at clojure.core$apply.invokeStatic(core.clj:669) at clojure.core$load_libs.invokeStatic(core.clj:6016) at clojure.core$load_libs.doInvoke(core.clj:6000) at clojure.lang.RestFn.applyTo(RestFn.java:137) at clojure.core$apply.invokeStatic(core.clj:669) at clojure.core$require.invokeStatic(core.clj:6038) at clojure.core$require.doInvoke(core.clj:6038) at clojure.lang.RestFn.invoke(RestFn.java:408) at nrepl.misc$requiring_resolve.invokeStatic(misc.clj:73) at nrepl.misc$requiring_resolve.doInvoke(misc.clj:66) at clojure.lang.RestFn.invoke(RestFn.java:423) at nrepl.middleware.dynamic_loader$update_stack_BANG_$fn__1445$fn__1446.invoke(dynamic_loader.clj:36) at clojure.core$map$fn__5935.invoke(core.clj:2772) at clojure.lang.LazySeq.sval(LazySeq.java:42) at clojure.lang.LazySeq.seq(LazySeq.java:51) at clojure.lang.RT.seq(RT.java:535) at clojure.core$seq__5467.invokeStatic(core.clj:139) at clojure.core$concat$fn__5558.invoke(core.clj:727) at clojure.lang.LazySeq.sval(LazySeq.java:42) at clojure.lang.LazySeq.seq(LazySeq.java:51) at clojure.lang.RT.seq(RT.java:535) at clojure.core$seq__5467.invokeStatic(core.clj:139) at clojure.core$filter$fn__5962.invoke(core.clj:2826) at clojure.lang.LazySeq.sval(LazySeq.java:42) at clojure.lang.LazySeq.seq(LazySeq.java:58) at clojure.lang.RT.seq(RT.java:535) at clojure.core$seq__5467.invokeStatic(core.clj:139) at clojure.core$seq__5467.invoke(core.clj:139) at nrepl.middleware$extend_deps.invokeStatic(middleware.clj:116) at nrepl.middleware$extend_deps.invoke(middleware.clj:108) at nrepl.middleware$linearize_middleware_stack.invokeStatic(middleware.clj:183) at nrepl.middleware$linearize_middleware_stack.invoke(middleware.clj:179) at nrepl.middleware.dynamic_loader$update_stack_BANG_$fn__1445.invoke(dynamic_loader.clj:38) at clojure.lang.AFn.applyToHelper(AFn.java:152) at clojure.lang.AFn.applyTo(AFn.java:144) at clojure.core$apply.invokeStatic(core.clj:667) at clojure.core$with_bindings_STAR_.invokeStatic(core.clj:1990) at clojure.core$with_bindings_STAR_.doInvoke(core.clj:1990) at clojure.lang.RestFn.invoke(RestFn.java:425) at nrepl.middleware.dynamic_loader$update_stack_BANG_.invokeStatic(dynamic_loader.clj:29) at nrepl.middleware.dynamic_loader$update_stack_BANG_.invoke(dynamic_loader.clj:27) at nrepl.middleware.dynamic_loader$wrap_dynamic_loader$fn__1488.invoke(dynamic_loader.clj:86) at nrepl.middleware$wrap_conj_descriptor$fn__966.invoke(middleware.clj:16) at nrepl.server$default_handler$fn__1971.invoke(server.clj:136) at nrepl.server$default_handler.invokeStatic(server.clj:135) at nrepl.server$default_handler.doInvoke(server.clj:120) at clojure.lang.RestFn.invoke(RestFn.java:3894) at new_leiningen.core$eval2775.invokeStatic(form-init8684492935391380567.clj:1) at new_leiningen.core$eval2775.invoke(form-init8684492935391380567.clj:1) at clojure.lang.Compiler.eval(Compiler.java:7194) at clojure.lang.Compiler.eval(Compiler.java:7184) at clojure.lang.Compiler.eval(Compiler.java:7184) at clojure.lang.Compiler.load(Compiler.java:7653) at clojure.lang.Compiler.loadFile(Compiler.java:7591) at clojure.main$load_script.invokeStatic(main.clj:475) at clojure.main$init_opt.invokeStatic(main.clj:477) at clojure.main$init_opt.invoke(main.clj:477) at clojure.main$initialize.invokeStatic(main.clj:508) at clojure.main$null_opt.invokeStatic(main.clj:542) at clojure.main$null_opt.invoke(main.clj:539) at clojure.main$main.invokeStatic(main.clj:664) at clojure.main$main.doInvoke(main.clj:616) at clojure.lang.RestFn.applyTo(RestFn.java:137) at clojure.lang.Var.applyTo(Var.java:705) at clojure.main.main(main.java:40) [WARNING] No nREPL middleware descriptor in metadata of null, see nrepl.middleware/set-descriptor! nREPL server started on port 55589 on host 127.0.0.1 - "><y>#</y><d>2023-01-03</d><h>13:59</h><r>pez</r>Here I create a new lein project and try to inject cider-middleware:
<pre>~/Projects/tests(:|âœ”) % lein new new-leiningen
Generating a project called new-leiningen based on the &apos;default&apos; template.
The default template is intended for library projects, not applications.
To see other templates (app, plugin, etc), try `lein help new`.
~/Projects/tests(:|âœ”) % cd new-leiningen
~/Projects/tests/new-leiningen(:|âœ”) % lein update-in :dependencies conj &apos;[nrepl,&quot;1.0.0&quot;]&apos; -- update-in :plugins conj &apos;[cider/cider-nrepl,&quot;0.28.5&quot;]&apos; -- update-in :repl-options:nrepl-middleware conj &apos;[cider.nrepl/cider-middleware]&apos; -- repl :headless
ERROR:
java.io.FileNotFoundException: Could not locate [[cider/nrepl__init.class, [[cider/nrepl.clj or [[cider/nrepl.cljc on classpath.
	at clojure.lang.RT.load(RT.java:462)
	at clojure.lang.RT.load(RT.java:424)
	at clojure.core$load$fn__6908.invoke(core.clj:6161)
	at clojure.core$load.invokeStatic(core.clj:6160)
	at clojure.core$load.doInvoke(core.clj:6144)
	at clojure.lang.RestFn.invoke(RestFn.java:408)
	at clojure.core$load_one.invokeStatic(core.clj:5933)
	at clojure.core$load_one.invoke(core.clj:5928)
	at clojure.core$load_lib$fn__6850.invoke(core.clj:5975)
	at clojure.core$load_lib.invokeStatic(core.clj:5974)
	at clojure.core$load_lib.doInvoke(core.clj:5953)
	at clojure.lang.RestFn.applyTo(RestFn.java:142)
	at clojure.core$apply.invokeStatic(core.clj:669)
	at clojure.core$load_libs.invokeStatic(core.clj:6016)
	at clojure.core$load_libs.doInvoke(core.clj:6000)
	at clojure.lang.RestFn.applyTo(RestFn.java:137)
	at clojure.core$apply.invokeStatic(core.clj:669)
	at clojure.core$require.invokeStatic(core.clj:6038)
	at clojure.core$require.doInvoke(core.clj:6038)
	at clojure.lang.RestFn.invoke(RestFn.java:408)
	at nrepl.misc$requiring_resolve.invokeStatic(misc.clj:73)
	at nrepl.misc$requiring_resolve.doInvoke(misc.clj:66)
	at clojure.lang.RestFn.invoke(RestFn.java:423)
	at nrepl.middleware.dynamic_loader$update_stack_BANG_$fn__1445$fn__1446.invoke(dynamic_loader.clj:36)
	at clojure.core$map$fn__5935.invoke(core.clj:2772)
	at clojure.lang.LazySeq.sval(LazySeq.java:42)
	at clojure.lang.LazySeq.seq(LazySeq.java:51)
	at clojure.lang.RT.seq(RT.java:535)
	at clojure.core$seq__5467.invokeStatic(core.clj:139)
	at clojure.core$concat$fn__5558.invoke(core.clj:727)
	at clojure.lang.LazySeq.sval(LazySeq.java:42)
	at clojure.lang.LazySeq.seq(LazySeq.java:51)
	at clojure.lang.RT.seq(RT.java:535)
	at clojure.core$seq__5467.invokeStatic(core.clj:139)
	at clojure.core$filter$fn__5962.invoke(core.clj:2826)
	at clojure.lang.LazySeq.sval(LazySeq.java:42)
	at clojure.lang.LazySeq.seq(LazySeq.java:58)
	at clojure.lang.RT.seq(RT.java:535)
	at clojure.core$seq__5467.invokeStatic(core.clj:139)
	at clojure.core$seq__5467.invoke(core.clj:139)
	at nrepl.middleware$extend_deps.invokeStatic(middleware.clj:116)
	at nrepl.middleware$extend_deps.invoke(middleware.clj:108)
	at nrepl.middleware$linearize_middleware_stack.invokeStatic(middleware.clj:183)
	at nrepl.middleware$linearize_middleware_stack.invoke(middleware.clj:179)
	at nrepl.middleware.dynamic_loader$update_stack_BANG_$fn__1445.invoke(dynamic_loader.clj:38)
	at clojure.lang.AFn.applyToHelper(AFn.java:152)
	at clojure.lang.AFn.applyTo(AFn.java:144)
	at clojure.core$apply.invokeStatic(core.clj:667)
	at clojure.core$with_bindings_STAR_.invokeStatic(core.clj:1990)
	at clojure.core$with_bindings_STAR_.doInvoke(core.clj:1990)
	at clojure.lang.RestFn.invoke(RestFn.java:425)
	at nrepl.middleware.dynamic_loader$update_stack_BANG_.invokeStatic(dynamic_loader.clj:29)
	at nrepl.middleware.dynamic_loader$update_stack_BANG_.invoke(dynamic_loader.clj:27)
	at nrepl.middleware.dynamic_loader$wrap_dynamic_loader$fn__1488.invoke(dynamic_loader.clj:86)
	at nrepl.middleware$wrap_conj_descriptor$fn__966.invoke(middleware.clj:16)
	at nrepl.server$default_handler$fn__1971.invoke(server.clj:136)
	at nrepl.server$default_handler.invokeStatic(server.clj:135)
	at nrepl.server$default_handler.doInvoke(server.clj:120)
	at clojure.lang.RestFn.invoke(RestFn.java:3894)
	at new_leiningen.core$eval2775.invokeStatic(form-init8684492935391380567.clj:1)
	at new_leiningen.core$eval2775.invoke(form-init8684492935391380567.clj:1)
	at clojure.lang.Compiler.eval(Compiler.java:7194)
	at clojure.lang.Compiler.eval(Compiler.java:7184)
	at clojure.lang.Compiler.eval(Compiler.java:7184)
	at clojure.lang.Compiler.load(Compiler.java:7653)
	at clojure.lang.Compiler.loadFile(Compiler.java:7591)
	at clojure.main$load_script.invokeStatic(main.clj:475)
	at clojure.main$init_opt.invokeStatic(main.clj:477)
	at clojure.main$init_opt.invoke(main.clj:477)
	at clojure.main$initialize.invokeStatic(main.clj:508)
	at clojure.main$null_opt.invokeStatic(main.clj:542)
	at clojure.main$null_opt.invoke(main.clj:539)
	at clojure.main$main.invokeStatic(main.clj:664)
	at clojure.main$main.doInvoke(main.clj:616)
	at clojure.lang.RestFn.applyTo(RestFn.java:137)
	at clojure.lang.Var.applyTo(Var.java:705)
	at clojure.main.main(main.java:40)
[WARNING] No nREPL middleware descriptor in metadata of null, see nrepl.middleware/set-descriptor!
nREPL server started on port 55589 on host 127.0.0.1 - </pre></z><z id="t1672754506" t="pez As noted on this issue https://codeberg.org/leiningen/leiningen/issues/10#issuecomment-755869 we don&apos;t get this trace if instead of repl :headless we run some Clojure code requiring cider-nrepl: ~/Projects/tests/new-leiningen(:|âœ”) % lein update-in :dependencies conj &apos;[nrepl,&quot;1.0.0&quot;]&apos; -- update-in :plugins conj &apos;[cider/cider-nrepl,&quot;0.28.5&quot;]&apos; -- update-in :repl-options:nrepl-middleware conj &apos;[cider.nrepl/cider-middleware]&apos; -- run -m clojure.main -e &quot;(require &apos;cider.nrepl)&quot; ~/Projects/tests/new-leiningen(:|âœ”) %"><y>#</y><d>2023-01-03</d><h>14:01</h><r>pez</r>As noted on this issue <a href="https://codeberg.org/leiningen/leiningen/issues/10#issuecomment-755869" target="_blank">https://codeberg.org/leiningen/leiningen/issues/10#issuecomment-755869</a> we don&apos;t get this trace if instead of <code>repl :headless</code> we run some Clojure code requiring cider-nrepl:
<pre>~/Projects/tests/new-leiningen(:|âœ”) % lein update-in :dependencies conj &apos;[nrepl,&quot;1.0.0&quot;]&apos; -- update-in :plugins conj &apos;[cider/cider-nrepl,&quot;0.28.5&quot;]&apos; -- update-in :repl-options:nrepl-middleware conj &apos;[cider.nrepl/cider-middleware]&apos; -- run -m clojure.main -e &quot;(require &apos;cider.nrepl)&quot;
~/Projects/tests/new-leiningen(:|âœ”) %</pre></z><z id="t1675175063" t="dominicm I&apos;m wondering if there&apos;s an alternative way to allow set! to work on vars. I just wrote this middleware that I can call from user.clj, otherwise: (ns io.dominic.nrepl-bind (:require [nrepl.middleware :as middleware :refer [set-descriptor!]])) (def ^:private bind-vars (atom #{})) (defn add-bound-var [var] (swap! bind-vars conj var) nil) (defmacro try-bind-vars [&amp; syms] `(run! add-bound-var (keep requiring-resolve (quote ~syms)))) ;; the handler (defn- wrap-bind [h] (fn [{:keys [session] :as msg}] (swap! session (fn [session] (reduce (fn [session var] (cond-&gt; session (not (contains? session var)) (assoc var @var))) session @bind-vars))) (h msg))) (set-descriptor! #&apos;wrap-bind {:requires #{&quot;clone&quot;}}) "><y>#</y><d>2023-01-31</d><h>14:24</h><w>dominicm</w>I&apos;m wondering if there&apos;s an alternative way to allow <code>set!</code> to work on vars. I just wrote this middleware that I can call from user.clj, otherwise:

<pre>(ns io.dominic.nrepl-bind
  (:require
   [nrepl.middleware :as middleware :refer [set-descriptor!]]))

(def ^:private bind-vars (atom #{}))
(defn add-bound-var
  [var]
  (swap! bind-vars conj var)
  nil)

(defmacro try-bind-vars
  [&amp; syms]
  `(run! add-bound-var (keep requiring-resolve (quote ~syms))))

;; the handler
(defn- wrap-bind
  [h]
  (fn [{:keys [session] :as msg}]
    (swap!
      session
      (fn [session]
        (reduce
          (fn [session var]
            (cond-&gt; session
              (not (contains? session var))
              (assoc var @var)))
          session
          @bind-vars)))
    (h msg)))

(set-descriptor! #&apos;wrap-bind {:requires #{&quot;clone&quot;}})</pre>
</z></g></div></body>